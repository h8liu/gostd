<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>regexp/syntax</h2>
<ul>
<li><a href="/gostd/regexp/syntax/compile.go.html">compile.go</a></li>
<li><a href="/gostd/regexp/syntax/doc.go.html">doc.go</a></li>
<li><a href="/gostd/regexp/syntax/parse.go.html" class="current">parse.go</a></li>
<li><a href="/gostd/regexp/syntax/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/regexp/syntax/perl_groups.go.html">perl_groups.go</a></li>
<li><a href="/gostd/regexp/syntax/prog.go.html">prog.go</a></li>
<li><a href="/gostd/regexp/syntax/prog_test.go.html">prog_test.go</a></li>
<li><a href="/gostd/regexp/syntax/regexp.go.html">regexp.go</a></li>
<li><a href="/gostd/regexp/syntax/simplify.go.html">simplify.go</a></li>
<li><a href="/gostd/regexp/syntax/simplify_test.go.html">simplify_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5213987">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5214043">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5214097">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5214148">package</span>&nbsp;<span class="ident" id="5214156">syntax</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5214164">import</span>&nbsp;<span class="op" id="5214171">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5214174">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5214182">&#34;strings&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5214193">&#34;unicode&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5214204">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="5214219">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5214222">//&nbsp;An&nbsp;Error&nbsp;describes&nbsp;a&nbsp;failure&nbsp;to&nbsp;parse&nbsp;a&nbsp;regular&nbsp;expression</span><br>
<span class="lineno">15</span><span class="comment" id="5214284">//&nbsp;and&nbsp;gives&nbsp;the&nbsp;offending&nbsp;expression.</span><br>
<span class="lineno"></span><span class="keyword" id="5214323">type</span>&nbsp;<span class="ident" id="5214328">Error</span>&nbsp;<span class="keyword" id="5214334">struct</span>&nbsp;<span class="op" id="5214341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5214344">Code</span>&nbsp;<span class="ident" id="5214349">ErrorCode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5214360">Expr</span>&nbsp;<span class="builtintype" id="5214365">string</span><br>
<span class="lineno"></span><span class="op" id="5214372">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="5214375">func</span>&nbsp;<span class="op" id="5214380">(</span><span class="ident" id="5214381">e</span>&nbsp;<span class="op" id="5214383">*</span><span class="ident" id="5214384">Error</span><span class="op" id="5214389">)</span>&nbsp;<span class="ident" id="5214391">Error</span><span class="op" id="5214396">(</span><span class="op" id="5214397">)</span>&nbsp;<span class="builtintype" id="5214399">string</span>&nbsp;<span class="op" id="5214406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5214409">return</span>&nbsp;<span class="string" id="5214416">&#34;error&nbsp;parsing&nbsp;regexp:&nbsp;&#34;</span>&nbsp;<span class="op" id="5214441">+</span>&nbsp;<span class="ident" id="5214443">e</span><span class="op" id="5214444">.</span><span class="ident" id="5214445">Code</span><span class="op" id="5214449">.</span><span class="ident" id="5214450">String</span><span class="op" id="5214456">(</span><span class="op" id="5214457">)</span>&nbsp;<span class="op" id="5214459">+</span>&nbsp;<span class="string" id="5214461">&#34;:&nbsp;`&#34;</span>&nbsp;<span class="op" id="5214467">+</span>&nbsp;<span class="ident" id="5214469">e</span><span class="op" id="5214470">.</span><span class="ident" id="5214471">Expr</span>&nbsp;<span class="op" id="5214476">+</span>&nbsp;<span class="string" id="5214478">&#34;`&#34;</span><br>
<span class="lineno"></span><span class="op" id="5214482">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="5214485">//&nbsp;An&nbsp;ErrorCode&nbsp;describes&nbsp;a&nbsp;failure&nbsp;to&nbsp;parse&nbsp;a&nbsp;regular&nbsp;expression.</span><br>
<span class="lineno"></span><span class="keyword" id="5214552">type</span>&nbsp;<span class="ident" id="5214557">ErrorCode</span>&nbsp;<span class="builtintype" id="5214567">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5214575">const</span>&nbsp;<span class="op" id="5214581">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5214584">//&nbsp;Unexpected&nbsp;error</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5214605">ErrInternalError</span>&nbsp;<span class="ident" id="5214622">ErrorCode</span>&nbsp;<span class="op" id="5214632">=</span>&nbsp;<span class="string" id="5214634">&#34;regexp/syntax:&nbsp;internal&nbsp;error&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5214668">//&nbsp;Parse&nbsp;errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5214685">ErrInvalidCharClass</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5214710">ErrorCode</span>&nbsp;<span class="op" id="5214720">=</span>&nbsp;<span class="string" id="5214722">&#34;invalid&nbsp;character&nbsp;class&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5214749">ErrInvalidCharRange</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5214774">ErrorCode</span>&nbsp;<span class="op" id="5214784">=</span>&nbsp;<span class="string" id="5214786">&#34;invalid&nbsp;character&nbsp;class&nbsp;range&#34;</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5214819">ErrInvalidEscape</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5214844">ErrorCode</span>&nbsp;<span class="op" id="5214854">=</span>&nbsp;<span class="string" id="5214856">&#34;invalid&nbsp;escape&nbsp;sequence&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5214883">ErrInvalidNamedCapture</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5214908">ErrorCode</span>&nbsp;<span class="op" id="5214918">=</span>&nbsp;<span class="string" id="5214920">&#34;invalid&nbsp;named&nbsp;capture&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5214945">ErrInvalidPerlOp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5214970">ErrorCode</span>&nbsp;<span class="op" id="5214980">=</span>&nbsp;<span class="string" id="5214982">&#34;invalid&nbsp;or&nbsp;unsupported&nbsp;Perl&nbsp;syntax&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5215020">ErrInvalidRepeatOp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5215045">ErrorCode</span>&nbsp;<span class="op" id="5215055">=</span>&nbsp;<span class="string" id="5215057">&#34;invalid&nbsp;nested&nbsp;repetition&nbsp;operator&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5215095">ErrInvalidRepeatSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5215120">ErrorCode</span>&nbsp;<span class="op" id="5215130">=</span>&nbsp;<span class="string" id="5215132">&#34;invalid&nbsp;repeat&nbsp;count&#34;</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5215156">ErrInvalidUTF8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5215181">ErrorCode</span>&nbsp;<span class="op" id="5215191">=</span>&nbsp;<span class="string" id="5215193">&#34;invalid&nbsp;UTF-8&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5215210">ErrMissingBracket</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5215235">ErrorCode</span>&nbsp;<span class="op" id="5215245">=</span>&nbsp;<span class="string" id="5215247">&#34;missing&nbsp;closing&nbsp;]&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5215268">ErrMissingParen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5215293">ErrorCode</span>&nbsp;<span class="op" id="5215303">=</span>&nbsp;<span class="string" id="5215305">&#34;missing&nbsp;closing&nbsp;)&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5215326">ErrMissingRepeatArgument</span>&nbsp;<span class="ident" id="5215351">ErrorCode</span>&nbsp;<span class="op" id="5215361">=</span>&nbsp;<span class="string" id="5215363">&#34;missing&nbsp;argument&nbsp;to&nbsp;repetition&nbsp;operator&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5215406">ErrTrailingBackslash</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5215431">ErrorCode</span>&nbsp;<span class="op" id="5215441">=</span>&nbsp;<span class="string" id="5215443">&#34;trailing&nbsp;backslash&nbsp;at&nbsp;end&nbsp;of&nbsp;expression&#34;</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5215486">ErrUnexpectedParen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5215511">ErrorCode</span>&nbsp;<span class="op" id="5215521">=</span>&nbsp;<span class="string" id="5215523">&#34;unexpected&nbsp;)&#34;</span><br>
<span class="lineno"></span><span class="op" id="5215538">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5215541">func</span>&nbsp;<span class="op" id="5215546">(</span><span class="ident" id="5215547">e</span>&nbsp;<span class="ident" id="5215549">ErrorCode</span><span class="op" id="5215558">)</span>&nbsp;<span class="ident" id="5215560">String</span><span class="op" id="5215566">(</span><span class="op" id="5215567">)</span>&nbsp;<span class="builtintype" id="5215569">string</span>&nbsp;<span class="op" id="5215576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5215579">return</span>&nbsp;<span class="builtintype" id="5215586">string</span><span class="op" id="5215592">(</span><span class="ident" id="5215593">e</span><span class="op" id="5215594">)</span><br>
<span class="lineno">50</span><span class="op" id="5215596">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5215599">//&nbsp;Flags&nbsp;control&nbsp;the&nbsp;behavior&nbsp;of&nbsp;the&nbsp;parser&nbsp;and&nbsp;record&nbsp;information&nbsp;about&nbsp;regexp&nbsp;context.</span><br>
<span class="lineno"></span><span class="keyword" id="5215688">type</span>&nbsp;<span class="ident" id="5215693">Flags</span>&nbsp;<span class="builtintype" id="5215699">uint16</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="5215707">const</span>&nbsp;<span class="op" id="5215713">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5215716">FoldCase</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5215730">Flags</span>&nbsp;<span class="op" id="5215736">=</span>&nbsp;<span class="num" id="5215738">1</span>&nbsp;<span class="op" id="5215740">&lt;&lt;</span>&nbsp;<span class="ident" id="5215743">iota</span>&nbsp;<span class="comment" id="5215748">//&nbsp;case-insensitive&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5215775">Literal</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5215807">//&nbsp;treat&nbsp;pattern&nbsp;as&nbsp;literal&nbsp;string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5215843">ClassNL</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5215875">//&nbsp;allow&nbsp;character&nbsp;classes&nbsp;like&nbsp;[^a-z]&nbsp;and&nbsp;[[:space:]]&nbsp;to&nbsp;match&nbsp;newline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5215948">DotNL</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5215980">//&nbsp;allow&nbsp;.&nbsp;to&nbsp;match&nbsp;newline</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5216009">OneLine</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5216041">//&nbsp;treat&nbsp;^&nbsp;and&nbsp;$&nbsp;as&nbsp;only&nbsp;matching&nbsp;at&nbsp;beginning&nbsp;and&nbsp;end&nbsp;of&nbsp;text</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5216105">NonGreedy</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5216137">//&nbsp;make&nbsp;repetition&nbsp;operators&nbsp;default&nbsp;to&nbsp;non-greedy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5216189">PerlX</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5216221">//&nbsp;allow&nbsp;Perl&nbsp;extensions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5216247">UnicodeGroups</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5216279">//&nbsp;allow&nbsp;\p{Han},&nbsp;\P{Han}&nbsp;for&nbsp;Unicode&nbsp;group&nbsp;and&nbsp;negation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5216337">WasDollar</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5216369">//&nbsp;regexp&nbsp;OpEndText&nbsp;was&nbsp;$,&nbsp;not&nbsp;\z</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5216404">Simple</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5216436">//&nbsp;regexp&nbsp;contains&nbsp;no&nbsp;counted&nbsp;repetition</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5216479">MatchNL</span>&nbsp;<span class="op" id="5216487">=</span>&nbsp;<span class="ident" id="5216489">ClassNL</span>&nbsp;<span class="op" id="5216497">|</span>&nbsp;<span class="ident" id="5216499">DotNL</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5216507">Perl</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5216519">=</span>&nbsp;<span class="ident" id="5216521">ClassNL</span>&nbsp;<span class="op" id="5216529">|</span>&nbsp;<span class="ident" id="5216531">OneLine</span>&nbsp;<span class="op" id="5216539">|</span>&nbsp;<span class="ident" id="5216541">PerlX</span>&nbsp;<span class="op" id="5216547">|</span>&nbsp;<span class="ident" id="5216549">UnicodeGroups</span>&nbsp;<span class="comment" id="5216563">//&nbsp;as&nbsp;close&nbsp;to&nbsp;Perl&nbsp;as&nbsp;possible</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5216596">POSIX</span>&nbsp;<span class="ident" id="5216602">Flags</span>&nbsp;<span class="op" id="5216608">=</span>&nbsp;<span class="num" id="5216610">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5216652">//&nbsp;POSIX&nbsp;syntax</span><br>
<span class="lineno"></span><span class="op" id="5216668">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5216671">//&nbsp;Pseudo-ops&nbsp;for&nbsp;parsing&nbsp;stack.</span><br>
<span class="lineno"></span><span class="keyword" id="5216704">const</span>&nbsp;<span class="op" id="5216710">(</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5216713">opLeftParen</span>&nbsp;<span class="op" id="5216725">=</span>&nbsp;<span class="ident" id="5216727">opPseudo</span>&nbsp;<span class="op" id="5216736">+</span>&nbsp;<span class="ident" id="5216738">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5216744">opVerticalBar</span><br>
<span class="lineno"></span><span class="op" id="5216758">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5216761">type</span>&nbsp;<span class="ident" id="5216766">parser</span>&nbsp;<span class="keyword" id="5216773">struct</span>&nbsp;<span class="op" id="5216780">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5216783">flags</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5216795">Flags</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5216805">//&nbsp;parse&nbsp;mode&nbsp;flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5216826">stack</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5216838">[</span><span class="op" id="5216839">]</span><span class="op" id="5216840">*</span><span class="ident" id="5216841">Regexp</span>&nbsp;<span class="comment" id="5216848">//&nbsp;stack&nbsp;of&nbsp;parsed&nbsp;expressions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5216880">free</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5216892">*</span><span class="ident" id="5216893">Regexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5216901">numCap</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5216913">int</span>&nbsp;<span class="comment" id="5216917">//&nbsp;number&nbsp;of&nbsp;capturing&nbsp;groups&nbsp;seen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5216953">wholeRegexp</span>&nbsp;<span class="builtintype" id="5216965">string</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5216973">tmpClass</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5216985">[</span><span class="op" id="5216986">]</span><span class="builtintype" id="5216987">rune</span>&nbsp;<span class="comment" id="5216992">//&nbsp;temporary&nbsp;char&nbsp;class&nbsp;work&nbsp;space</span><br>
<span class="lineno"></span><span class="op" id="5217027">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5217030">func</span>&nbsp;<span class="op" id="5217035">(</span><span class="ident" id="5217036">p</span>&nbsp;<span class="op" id="5217038">*</span><span class="ident" id="5217039">parser</span><span class="op" id="5217045">)</span>&nbsp;<span class="ident" id="5217047">newRegexp</span><span class="op" id="5217056">(</span><span class="ident" id="5217057">op</span>&nbsp;<span class="ident" id="5217060">Op</span><span class="op" id="5217062">)</span>&nbsp;<span class="op" id="5217064">*</span><span class="ident" id="5217065">Regexp</span>&nbsp;<span class="op" id="5217072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5217075">re</span>&nbsp;<span class="op" id="5217078">:=</span>&nbsp;<span class="ident" id="5217081">p</span><span class="op" id="5217082">.</span><span class="ident" id="5217083">free</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5217089">if</span>&nbsp;<span class="ident" id="5217092">re</span>&nbsp;<span class="op" id="5217095">!=</span>&nbsp;<span class="builtintype" id="5217098">nil</span>&nbsp;<span class="op" id="5217102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5217106">p</span><span class="op" id="5217107">.</span><span class="ident" id="5217108">free</span>&nbsp;<span class="op" id="5217113">=</span>&nbsp;<span class="ident" id="5217115">re</span><span class="op" id="5217117">.</span><span class="ident" id="5217118">Sub0</span><span class="op" id="5217122">[</span><span class="num" id="5217123">0</span><span class="op" id="5217124">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5217128">*</span><span class="ident" id="5217129">re</span>&nbsp;<span class="op" id="5217132">=</span>&nbsp;<span class="ident" id="5217134">Regexp</span><span class="op" id="5217140">{</span><span class="op" id="5217141">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5217144">}</span>&nbsp;<span class="keyword" id="5217146">else</span>&nbsp;<span class="op" id="5217151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5217155">re</span>&nbsp;<span class="op" id="5217158">=</span>&nbsp;<span class="builtinfunc" id="5217160">new</span><span class="op" id="5217163">(</span><span class="ident" id="5217164">Regexp</span><span class="op" id="5217170">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5217173">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5217176">re</span><span class="op" id="5217178">.</span><span class="ident" id="5217179">Op</span>&nbsp;<span class="op" id="5217182">=</span>&nbsp;<span class="ident" id="5217184">op</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5217188">return</span>&nbsp;<span class="ident" id="5217195">re</span><br>
<span class="lineno"></span><span class="op" id="5217198">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="keyword" id="5217201">func</span>&nbsp;<span class="op" id="5217206">(</span><span class="ident" id="5217207">p</span>&nbsp;<span class="op" id="5217209">*</span><span class="ident" id="5217210">parser</span><span class="op" id="5217216">)</span>&nbsp;<span class="ident" id="5217218">reuse</span><span class="op" id="5217223">(</span><span class="ident" id="5217224">re</span>&nbsp;<span class="op" id="5217227">*</span><span class="ident" id="5217228">Regexp</span><span class="op" id="5217234">)</span>&nbsp;<span class="op" id="5217236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5217239">re</span><span class="op" id="5217241">.</span><span class="ident" id="5217242">Sub0</span><span class="op" id="5217246">[</span><span class="num" id="5217247">0</span><span class="op" id="5217248">]</span>&nbsp;<span class="op" id="5217250">=</span>&nbsp;<span class="ident" id="5217252">p</span><span class="op" id="5217253">.</span><span class="ident" id="5217254">free</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5217260">p</span><span class="op" id="5217261">.</span><span class="ident" id="5217262">free</span>&nbsp;<span class="op" id="5217267">=</span>&nbsp;<span class="ident" id="5217269">re</span><br>
<span class="lineno"></span><span class="op" id="5217272">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="5217275">//&nbsp;Parse&nbsp;stack&nbsp;manipulation.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5217305">//&nbsp;push&nbsp;pushes&nbsp;the&nbsp;regexp&nbsp;re&nbsp;onto&nbsp;the&nbsp;parse&nbsp;stack&nbsp;and&nbsp;returns&nbsp;the&nbsp;regexp.</span><br>
<span class="lineno"></span><span class="keyword" id="5217379">func</span>&nbsp;<span class="op" id="5217384">(</span><span class="ident" id="5217385">p</span>&nbsp;<span class="op" id="5217387">*</span><span class="ident" id="5217388">parser</span><span class="op" id="5217394">)</span>&nbsp;<span class="ident" id="5217396">push</span><span class="op" id="5217400">(</span><span class="ident" id="5217401">re</span>&nbsp;<span class="op" id="5217404">*</span><span class="ident" id="5217405">Regexp</span><span class="op" id="5217411">)</span>&nbsp;<span class="op" id="5217413">*</span><span class="ident" id="5217414">Regexp</span>&nbsp;<span class="op" id="5217421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5217424">if</span>&nbsp;<span class="ident" id="5217427">re</span><span class="op" id="5217429">.</span><span class="ident" id="5217430">Op</span>&nbsp;<span class="op" id="5217433">==</span>&nbsp;<span class="ident" id="5217436">OpCharClass</span>&nbsp;<span class="op" id="5217448">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5217451">len</span><span class="op" id="5217454">(</span><span class="ident" id="5217455">re</span><span class="op" id="5217457">.</span><span class="ident" id="5217458">Rune</span><span class="op" id="5217462">)</span>&nbsp;<span class="op" id="5217464">==</span>&nbsp;<span class="num" id="5217467">2</span>&nbsp;<span class="op" id="5217469">&amp;&amp;</span>&nbsp;<span class="ident" id="5217472">re</span><span class="op" id="5217474">.</span><span class="ident" id="5217475">Rune</span><span class="op" id="5217479">[</span><span class="num" id="5217480">0</span><span class="op" id="5217481">]</span>&nbsp;<span class="op" id="5217483">==</span>&nbsp;<span class="ident" id="5217486">re</span><span class="op" id="5217488">.</span><span class="ident" id="5217489">Rune</span><span class="op" id="5217493">[</span><span class="num" id="5217494">1</span><span class="op" id="5217495">]</span>&nbsp;<span class="op" id="5217497">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5217501">//&nbsp;Single&nbsp;rune.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5217519">if</span>&nbsp;<span class="ident" id="5217522">p</span><span class="op" id="5217523">.</span><span class="ident" id="5217524">maybeConcat</span><span class="op" id="5217535">(</span><span class="ident" id="5217536">re</span><span class="op" id="5217538">.</span><span class="ident" id="5217539">Rune</span><span class="op" id="5217543">[</span><span class="num" id="5217544">0</span><span class="op" id="5217545">]</span><span class="op" id="5217546">,</span>&nbsp;<span class="ident" id="5217548">p</span><span class="op" id="5217549">.</span><span class="ident" id="5217550">flags</span><span class="op" id="5217555">&amp;^</span><span class="ident" id="5217557">FoldCase</span><span class="op" id="5217565">)</span>&nbsp;<span class="op" id="5217567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5217572">return</span>&nbsp;<span class="builtintype" id="5217579">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5217585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5217589">re</span><span class="op" id="5217591">.</span><span class="ident" id="5217592">Op</span>&nbsp;<span class="op" id="5217595">=</span>&nbsp;<span class="ident" id="5217597">OpLiteral</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5217609">re</span><span class="op" id="5217611">.</span><span class="ident" id="5217612">Rune</span>&nbsp;<span class="op" id="5217617">=</span>&nbsp;<span class="ident" id="5217619">re</span><span class="op" id="5217621">.</span><span class="ident" id="5217622">Rune</span><span class="op" id="5217626">[</span><span class="op" id="5217627">:</span><span class="num" id="5217628">1</span><span class="op" id="5217629">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5217633">re</span><span class="op" id="5217635">.</span><span class="ident" id="5217636">Flags</span>&nbsp;<span class="op" id="5217642">=</span>&nbsp;<span class="ident" id="5217644">p</span><span class="op" id="5217645">.</span><span class="ident" id="5217646">flags</span>&nbsp;<span class="op" id="5217652">&amp;^</span>&nbsp;<span class="ident" id="5217655">FoldCase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5217665">}</span>&nbsp;<span class="keyword" id="5217667">else</span>&nbsp;<span class="keyword" id="5217672">if</span>&nbsp;<span class="ident" id="5217675">re</span><span class="op" id="5217677">.</span><span class="ident" id="5217678">Op</span>&nbsp;<span class="op" id="5217681">==</span>&nbsp;<span class="ident" id="5217684">OpCharClass</span>&nbsp;<span class="op" id="5217696">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5217699">len</span><span class="op" id="5217702">(</span><span class="ident" id="5217703">re</span><span class="op" id="5217705">.</span><span class="ident" id="5217706">Rune</span><span class="op" id="5217710">)</span>&nbsp;<span class="op" id="5217712">==</span>&nbsp;<span class="num" id="5217715">4</span>&nbsp;<span class="op" id="5217717">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5217722">re</span><span class="op" id="5217724">.</span><span class="ident" id="5217725">Rune</span><span class="op" id="5217729">[</span><span class="num" id="5217730">0</span><span class="op" id="5217731">]</span>&nbsp;<span class="op" id="5217733">==</span>&nbsp;<span class="ident" id="5217736">re</span><span class="op" id="5217738">.</span><span class="ident" id="5217739">Rune</span><span class="op" id="5217743">[</span><span class="num" id="5217744">1</span><span class="op" id="5217745">]</span>&nbsp;<span class="op" id="5217747">&amp;&amp;</span>&nbsp;<span class="ident" id="5217750">re</span><span class="op" id="5217752">.</span><span class="ident" id="5217753">Rune</span><span class="op" id="5217757">[</span><span class="num" id="5217758">2</span><span class="op" id="5217759">]</span>&nbsp;<span class="op" id="5217761">==</span>&nbsp;<span class="ident" id="5217764">re</span><span class="op" id="5217766">.</span><span class="ident" id="5217767">Rune</span><span class="op" id="5217771">[</span><span class="num" id="5217772">3</span><span class="op" id="5217773">]</span>&nbsp;<span class="op" id="5217775">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5217780">unicode</span><span class="op" id="5217787">.</span><span class="ident" id="5217788">SimpleFold</span><span class="op" id="5217798">(</span><span class="ident" id="5217799">re</span><span class="op" id="5217801">.</span><span class="ident" id="5217802">Rune</span><span class="op" id="5217806">[</span><span class="num" id="5217807">0</span><span class="op" id="5217808">]</span><span class="op" id="5217809">)</span>&nbsp;<span class="op" id="5217811">==</span>&nbsp;<span class="ident" id="5217814">re</span><span class="op" id="5217816">.</span><span class="ident" id="5217817">Rune</span><span class="op" id="5217821">[</span><span class="num" id="5217822">2</span><span class="op" id="5217823">]</span>&nbsp;<span class="op" id="5217825">&amp;&amp;</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5217830">unicode</span><span class="op" id="5217837">.</span><span class="ident" id="5217838">SimpleFold</span><span class="op" id="5217848">(</span><span class="ident" id="5217849">re</span><span class="op" id="5217851">.</span><span class="ident" id="5217852">Rune</span><span class="op" id="5217856">[</span><span class="num" id="5217857">2</span><span class="op" id="5217858">]</span><span class="op" id="5217859">)</span>&nbsp;<span class="op" id="5217861">==</span>&nbsp;<span class="ident" id="5217864">re</span><span class="op" id="5217866">.</span><span class="ident" id="5217867">Rune</span><span class="op" id="5217871">[</span><span class="num" id="5217872">0</span><span class="op" id="5217873">]</span>&nbsp;<span class="op" id="5217875">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5217880">re</span><span class="op" id="5217882">.</span><span class="ident" id="5217883">Op</span>&nbsp;<span class="op" id="5217886">==</span>&nbsp;<span class="ident" id="5217889">OpCharClass</span>&nbsp;<span class="op" id="5217901">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5217904">len</span><span class="op" id="5217907">(</span><span class="ident" id="5217908">re</span><span class="op" id="5217910">.</span><span class="ident" id="5217911">Rune</span><span class="op" id="5217915">)</span>&nbsp;<span class="op" id="5217917">==</span>&nbsp;<span class="num" id="5217920">2</span>&nbsp;<span class="op" id="5217922">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5217928">re</span><span class="op" id="5217930">.</span><span class="ident" id="5217931">Rune</span><span class="op" id="5217935">[</span><span class="num" id="5217936">0</span><span class="op" id="5217937">]</span><span class="op" id="5217938">+</span><span class="num" id="5217939">1</span>&nbsp;<span class="op" id="5217941">==</span>&nbsp;<span class="ident" id="5217944">re</span><span class="op" id="5217946">.</span><span class="ident" id="5217947">Rune</span><span class="op" id="5217951">[</span><span class="num" id="5217952">1</span><span class="op" id="5217953">]</span>&nbsp;<span class="op" id="5217955">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5217961">unicode</span><span class="op" id="5217968">.</span><span class="ident" id="5217969">SimpleFold</span><span class="op" id="5217979">(</span><span class="ident" id="5217980">re</span><span class="op" id="5217982">.</span><span class="ident" id="5217983">Rune</span><span class="op" id="5217987">[</span><span class="num" id="5217988">0</span><span class="op" id="5217989">]</span><span class="op" id="5217990">)</span>&nbsp;<span class="op" id="5217992">==</span>&nbsp;<span class="ident" id="5217995">re</span><span class="op" id="5217997">.</span><span class="ident" id="5217998">Rune</span><span class="op" id="5218002">[</span><span class="num" id="5218003">1</span><span class="op" id="5218004">]</span>&nbsp;<span class="op" id="5218006">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5218012">unicode</span><span class="op" id="5218019">.</span><span class="ident" id="5218020">SimpleFold</span><span class="op" id="5218030">(</span><span class="ident" id="5218031">re</span><span class="op" id="5218033">.</span><span class="ident" id="5218034">Rune</span><span class="op" id="5218038">[</span><span class="num" id="5218039">1</span><span class="op" id="5218040">]</span><span class="op" id="5218041">)</span>&nbsp;<span class="op" id="5218043">==</span>&nbsp;<span class="ident" id="5218046">re</span><span class="op" id="5218048">.</span><span class="ident" id="5218049">Rune</span><span class="op" id="5218053">[</span><span class="num" id="5218054">0</span><span class="op" id="5218055">]</span>&nbsp;<span class="op" id="5218057">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5218061">//&nbsp;Case-insensitive&nbsp;rune&nbsp;like&nbsp;[Aa]&nbsp;or&nbsp;[Δδ].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5218109">if</span>&nbsp;<span class="ident" id="5218112">p</span><span class="op" id="5218113">.</span><span class="ident" id="5218114">maybeConcat</span><span class="op" id="5218125">(</span><span class="ident" id="5218126">re</span><span class="op" id="5218128">.</span><span class="ident" id="5218129">Rune</span><span class="op" id="5218133">[</span><span class="num" id="5218134">0</span><span class="op" id="5218135">]</span><span class="op" id="5218136">,</span>&nbsp;<span class="ident" id="5218138">p</span><span class="op" id="5218139">.</span><span class="ident" id="5218140">flags</span><span class="op" id="5218145">|</span><span class="ident" id="5218146">FoldCase</span><span class="op" id="5218154">)</span>&nbsp;<span class="op" id="5218156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5218161">return</span>&nbsp;<span class="builtintype" id="5218168">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5218174">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5218179">//&nbsp;Rewrite&nbsp;as&nbsp;(case-insensitive)&nbsp;literal.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5218223">re</span><span class="op" id="5218225">.</span><span class="ident" id="5218226">Op</span>&nbsp;<span class="op" id="5218229">=</span>&nbsp;<span class="ident" id="5218231">OpLiteral</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5218243">re</span><span class="op" id="5218245">.</span><span class="ident" id="5218246">Rune</span>&nbsp;<span class="op" id="5218251">=</span>&nbsp;<span class="ident" id="5218253">re</span><span class="op" id="5218255">.</span><span class="ident" id="5218256">Rune</span><span class="op" id="5218260">[</span><span class="op" id="5218261">:</span><span class="num" id="5218262">1</span><span class="op" id="5218263">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5218267">re</span><span class="op" id="5218269">.</span><span class="ident" id="5218270">Flags</span>&nbsp;<span class="op" id="5218276">=</span>&nbsp;<span class="ident" id="5218278">p</span><span class="op" id="5218279">.</span><span class="ident" id="5218280">flags</span>&nbsp;<span class="op" id="5218286">|</span>&nbsp;<span class="ident" id="5218288">FoldCase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5218298">}</span>&nbsp;<span class="keyword" id="5218300">else</span>&nbsp;<span class="op" id="5218305">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5218309">//&nbsp;Incremental&nbsp;concatenation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5218341">p</span><span class="op" id="5218342">.</span><span class="ident" id="5218343">maybeConcat</span><span class="op" id="5218354">(</span><span class="op" id="5218355">-</span><span class="num" id="5218356">1</span><span class="op" id="5218357">,</span>&nbsp;<span class="num" id="5218359">0</span><span class="op" id="5218360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5218363">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5218367">p</span><span class="op" id="5218368">.</span><span class="ident" id="5218369">stack</span>&nbsp;<span class="op" id="5218375">=</span>&nbsp;<span class="builtinfunc" id="5218377">append</span><span class="op" id="5218383">(</span><span class="ident" id="5218384">p</span><span class="op" id="5218385">.</span><span class="ident" id="5218386">stack</span><span class="op" id="5218391">,</span>&nbsp;<span class="ident" id="5218393">re</span><span class="op" id="5218395">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5218398">return</span>&nbsp;<span class="ident" id="5218405">re</span><br>
<span class="lineno"></span><span class="op" id="5218408">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5218411">//&nbsp;maybeConcat&nbsp;implements&nbsp;incremental&nbsp;concatenation</span><br>
<span class="lineno"></span><span class="comment" id="5218463">//&nbsp;of&nbsp;literal&nbsp;runes&nbsp;into&nbsp;string&nbsp;nodes.&nbsp;&nbsp;The&nbsp;parser&nbsp;calls&nbsp;this</span><br>
<span class="lineno">145</span><span class="comment" id="5218525">//&nbsp;before&nbsp;each&nbsp;push,&nbsp;so&nbsp;only&nbsp;the&nbsp;top&nbsp;fragment&nbsp;of&nbsp;the&nbsp;stack</span><br>
<span class="lineno"></span><span class="comment" id="5218584">//&nbsp;might&nbsp;need&nbsp;processing.&nbsp;&nbsp;Since&nbsp;this&nbsp;is&nbsp;called&nbsp;before&nbsp;a&nbsp;push,</span><br>
<span class="lineno"></span><span class="comment" id="5218647">//&nbsp;the&nbsp;topmost&nbsp;literal&nbsp;is&nbsp;no&nbsp;longer&nbsp;subject&nbsp;to&nbsp;operators&nbsp;like&nbsp;*</span><br>
<span class="lineno"></span><span class="comment" id="5218711">//&nbsp;(Otherwise&nbsp;ab*&nbsp;would&nbsp;turn&nbsp;into&nbsp;(ab)*.)</span><br>
<span class="lineno"></span><span class="comment" id="5218753">//&nbsp;If&nbsp;r&nbsp;&gt;=&nbsp;0&nbsp;and&nbsp;there&#39;s&nbsp;a&nbsp;node&nbsp;left&nbsp;over,&nbsp;maybeConcat&nbsp;uses&nbsp;it</span><br>
<span class="lineno">150</span><span class="comment" id="5218816">//&nbsp;to&nbsp;push&nbsp;r&nbsp;with&nbsp;the&nbsp;given&nbsp;flags.</span><br>
<span class="lineno"></span><span class="comment" id="5218851">//&nbsp;maybeConcat&nbsp;reports&nbsp;whether&nbsp;r&nbsp;was&nbsp;pushed.</span><br>
<span class="lineno"></span><span class="keyword" id="5218896">func</span>&nbsp;<span class="op" id="5218901">(</span><span class="ident" id="5218902">p</span>&nbsp;<span class="op" id="5218904">*</span><span class="ident" id="5218905">parser</span><span class="op" id="5218911">)</span>&nbsp;<span class="ident" id="5218913">maybeConcat</span><span class="op" id="5218924">(</span><span class="ident" id="5218925">r</span>&nbsp;<span class="builtintype" id="5218927">rune</span><span class="op" id="5218931">,</span>&nbsp;<span class="ident" id="5218933">flags</span>&nbsp;<span class="ident" id="5218939">Flags</span><span class="op" id="5218944">)</span>&nbsp;<span class="builtintype" id="5218946">bool</span>&nbsp;<span class="op" id="5218951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5218954">n</span>&nbsp;<span class="op" id="5218956">:=</span>&nbsp;<span class="builtinfunc" id="5218959">len</span><span class="op" id="5218962">(</span><span class="ident" id="5218963">p</span><span class="op" id="5218964">.</span><span class="ident" id="5218965">stack</span><span class="op" id="5218970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5218973">if</span>&nbsp;<span class="ident" id="5218976">n</span>&nbsp;<span class="op" id="5218978">&lt;</span>&nbsp;<span class="num" id="5218980">2</span>&nbsp;<span class="op" id="5218982">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5218986">return</span>&nbsp;<span class="builtintype" id="5218993">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5219000">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5219004">re1</span>&nbsp;<span class="op" id="5219008">:=</span>&nbsp;<span class="ident" id="5219011">p</span><span class="op" id="5219012">.</span><span class="ident" id="5219013">stack</span><span class="op" id="5219018">[</span><span class="ident" id="5219019">n</span><span class="op" id="5219020">-</span><span class="num" id="5219021">1</span><span class="op" id="5219022">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5219025">re2</span>&nbsp;<span class="op" id="5219029">:=</span>&nbsp;<span class="ident" id="5219032">p</span><span class="op" id="5219033">.</span><span class="ident" id="5219034">stack</span><span class="op" id="5219039">[</span><span class="ident" id="5219040">n</span><span class="op" id="5219041">-</span><span class="num" id="5219042">2</span><span class="op" id="5219043">]</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5219046">if</span>&nbsp;<span class="ident" id="5219049">re1</span><span class="op" id="5219052">.</span><span class="ident" id="5219053">Op</span>&nbsp;<span class="op" id="5219056">!=</span>&nbsp;<span class="ident" id="5219059">OpLiteral</span>&nbsp;<span class="op" id="5219069">||</span>&nbsp;<span class="ident" id="5219072">re2</span><span class="op" id="5219075">.</span><span class="ident" id="5219076">Op</span>&nbsp;<span class="op" id="5219079">!=</span>&nbsp;<span class="ident" id="5219082">OpLiteral</span>&nbsp;<span class="op" id="5219092">||</span>&nbsp;<span class="ident" id="5219095">re1</span><span class="op" id="5219098">.</span><span class="ident" id="5219099">Flags</span><span class="op" id="5219104">&amp;</span><span class="ident" id="5219105">FoldCase</span>&nbsp;<span class="op" id="5219114">!=</span>&nbsp;<span class="ident" id="5219117">re2</span><span class="op" id="5219120">.</span><span class="ident" id="5219121">Flags</span><span class="op" id="5219126">&amp;</span><span class="ident" id="5219127">FoldCase</span>&nbsp;<span class="op" id="5219136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5219140">return</span>&nbsp;<span class="builtintype" id="5219147">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5219154">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5219158">//&nbsp;Push&nbsp;re1&nbsp;into&nbsp;re2.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5219181">re2</span><span class="op" id="5219184">.</span><span class="ident" id="5219185">Rune</span>&nbsp;<span class="op" id="5219190">=</span>&nbsp;<span class="builtinfunc" id="5219192">append</span><span class="op" id="5219198">(</span><span class="ident" id="5219199">re2</span><span class="op" id="5219202">.</span><span class="ident" id="5219203">Rune</span><span class="op" id="5219207">,</span>&nbsp;<span class="ident" id="5219209">re1</span><span class="op" id="5219212">.</span><span class="ident" id="5219213">Rune</span><span class="op" id="5219217">...</span><span class="op" id="5219220">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5219224">//&nbsp;Reuse&nbsp;re1&nbsp;if&nbsp;possible.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5219251">if</span>&nbsp;<span class="ident" id="5219254">r</span>&nbsp;<span class="op" id="5219256">&gt;=</span>&nbsp;<span class="num" id="5219259">0</span>&nbsp;<span class="op" id="5219261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5219265">re1</span><span class="op" id="5219268">.</span><span class="ident" id="5219269">Rune</span>&nbsp;<span class="op" id="5219274">=</span>&nbsp;<span class="ident" id="5219276">re1</span><span class="op" id="5219279">.</span><span class="ident" id="5219280">Rune0</span><span class="op" id="5219285">[</span><span class="op" id="5219286">:</span><span class="num" id="5219287">1</span><span class="op" id="5219288">]</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5219292">re1</span><span class="op" id="5219295">.</span><span class="ident" id="5219296">Rune</span><span class="op" id="5219300">[</span><span class="num" id="5219301">0</span><span class="op" id="5219302">]</span>&nbsp;<span class="op" id="5219304">=</span>&nbsp;<span class="ident" id="5219306">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5219310">re1</span><span class="op" id="5219313">.</span><span class="ident" id="5219314">Flags</span>&nbsp;<span class="op" id="5219320">=</span>&nbsp;<span class="ident" id="5219322">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5219330">return</span>&nbsp;<span class="builtintype" id="5219337">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5219343">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5219347">p</span><span class="op" id="5219348">.</span><span class="ident" id="5219349">stack</span>&nbsp;<span class="op" id="5219355">=</span>&nbsp;<span class="ident" id="5219357">p</span><span class="op" id="5219358">.</span><span class="ident" id="5219359">stack</span><span class="op" id="5219364">[</span><span class="op" id="5219365">:</span><span class="ident" id="5219366">n</span><span class="op" id="5219367">-</span><span class="num" id="5219368">1</span><span class="op" id="5219369">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5219372">p</span><span class="op" id="5219373">.</span><span class="ident" id="5219374">reuse</span><span class="op" id="5219379">(</span><span class="ident" id="5219380">re1</span><span class="op" id="5219383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5219386">return</span>&nbsp;<span class="builtintype" id="5219393">false</span>&nbsp;<span class="comment" id="5219399">//&nbsp;did&nbsp;not&nbsp;push&nbsp;r</span><br>
<span class="lineno"></span><span class="op" id="5219417">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="comment" id="5219420">//&nbsp;newLiteral&nbsp;returns&nbsp;a&nbsp;new&nbsp;OpLiteral&nbsp;Regexp&nbsp;with&nbsp;the&nbsp;given&nbsp;flags</span><br>
<span class="lineno"></span><span class="keyword" id="5219486">func</span>&nbsp;<span class="op" id="5219491">(</span><span class="ident" id="5219492">p</span>&nbsp;<span class="op" id="5219494">*</span><span class="ident" id="5219495">parser</span><span class="op" id="5219501">)</span>&nbsp;<span class="ident" id="5219503">newLiteral</span><span class="op" id="5219513">(</span><span class="ident" id="5219514">r</span>&nbsp;<span class="builtintype" id="5219516">rune</span><span class="op" id="5219520">,</span>&nbsp;<span class="ident" id="5219522">flags</span>&nbsp;<span class="ident" id="5219528">Flags</span><span class="op" id="5219533">)</span>&nbsp;<span class="op" id="5219535">*</span><span class="ident" id="5219536">Regexp</span>&nbsp;<span class="op" id="5219543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5219546">re</span>&nbsp;<span class="op" id="5219549">:=</span>&nbsp;<span class="ident" id="5219552">p</span><span class="op" id="5219553">.</span><span class="ident" id="5219554">newRegexp</span><span class="op" id="5219563">(</span><span class="ident" id="5219564">OpLiteral</span><span class="op" id="5219573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5219576">re</span><span class="op" id="5219578">.</span><span class="ident" id="5219579">Flags</span>&nbsp;<span class="op" id="5219585">=</span>&nbsp;<span class="ident" id="5219587">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5219594">if</span>&nbsp;<span class="ident" id="5219597">flags</span><span class="op" id="5219602">&amp;</span><span class="ident" id="5219603">FoldCase</span>&nbsp;<span class="op" id="5219612">!=</span>&nbsp;<span class="num" id="5219615">0</span>&nbsp;<span class="op" id="5219617">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5219621">r</span>&nbsp;<span class="op" id="5219623">=</span>&nbsp;<span class="ident" id="5219625">minFoldRune</span><span class="op" id="5219636">(</span><span class="ident" id="5219637">r</span><span class="op" id="5219638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5219641">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5219644">re</span><span class="op" id="5219646">.</span><span class="ident" id="5219647">Rune0</span><span class="op" id="5219652">[</span><span class="num" id="5219653">0</span><span class="op" id="5219654">]</span>&nbsp;<span class="op" id="5219656">=</span>&nbsp;<span class="ident" id="5219658">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5219661">re</span><span class="op" id="5219663">.</span><span class="ident" id="5219664">Rune</span>&nbsp;<span class="op" id="5219669">=</span>&nbsp;<span class="ident" id="5219671">re</span><span class="op" id="5219673">.</span><span class="ident" id="5219674">Rune0</span><span class="op" id="5219679">[</span><span class="op" id="5219680">:</span><span class="num" id="5219681">1</span><span class="op" id="5219682">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5219685">return</span>&nbsp;<span class="ident" id="5219692">re</span><br>
<span class="lineno">190</span><span class="op" id="5219695">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5219698">//&nbsp;minFoldRune&nbsp;returns&nbsp;the&nbsp;minimum&nbsp;rune&nbsp;fold-equivalent&nbsp;to&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="5219760">func</span>&nbsp;<span class="ident" id="5219765">minFoldRune</span><span class="op" id="5219776">(</span><span class="ident" id="5219777">r</span>&nbsp;<span class="builtintype" id="5219779">rune</span><span class="op" id="5219783">)</span>&nbsp;<span class="builtintype" id="5219785">rune</span>&nbsp;<span class="op" id="5219790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5219793">if</span>&nbsp;<span class="ident" id="5219796">r</span>&nbsp;<span class="op" id="5219798">&lt;</span>&nbsp;<span class="ident" id="5219800">minFold</span>&nbsp;<span class="op" id="5219808">||</span>&nbsp;<span class="ident" id="5219811">r</span>&nbsp;<span class="op" id="5219813">&gt;</span>&nbsp;<span class="ident" id="5219815">maxFold</span>&nbsp;<span class="op" id="5219823">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5219827">return</span>&nbsp;<span class="ident" id="5219834">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5219837">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5219840">min</span>&nbsp;<span class="op" id="5219844">:=</span>&nbsp;<span class="ident" id="5219847">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5219850">r0</span>&nbsp;<span class="op" id="5219853">:=</span>&nbsp;<span class="ident" id="5219856">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5219859">for</span>&nbsp;<span class="ident" id="5219863">r</span>&nbsp;<span class="op" id="5219865">=</span>&nbsp;<span class="ident" id="5219867">unicode</span><span class="op" id="5219874">.</span><span class="ident" id="5219875">SimpleFold</span><span class="op" id="5219885">(</span><span class="ident" id="5219886">r</span><span class="op" id="5219887">)</span><span class="op" id="5219888">;</span>&nbsp;<span class="ident" id="5219890">r</span>&nbsp;<span class="op" id="5219892">!=</span>&nbsp;<span class="ident" id="5219895">r0</span><span class="op" id="5219897">;</span>&nbsp;<span class="ident" id="5219899">r</span>&nbsp;<span class="op" id="5219901">=</span>&nbsp;<span class="ident" id="5219903">unicode</span><span class="op" id="5219910">.</span><span class="ident" id="5219911">SimpleFold</span><span class="op" id="5219921">(</span><span class="ident" id="5219922">r</span><span class="op" id="5219923">)</span>&nbsp;<span class="op" id="5219925">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5219929">if</span>&nbsp;<span class="ident" id="5219932">min</span>&nbsp;<span class="op" id="5219936">&gt;</span>&nbsp;<span class="ident" id="5219938">r</span>&nbsp;<span class="op" id="5219940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5219945">min</span>&nbsp;<span class="op" id="5219949">=</span>&nbsp;<span class="ident" id="5219951">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5219955">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5219958">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5219961">return</span>&nbsp;<span class="ident" id="5219968">min</span><br>
<span class="lineno">205</span><span class="op" id="5219972">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5219975">//&nbsp;literal&nbsp;pushes&nbsp;a&nbsp;literal&nbsp;regexp&nbsp;for&nbsp;the&nbsp;rune&nbsp;r&nbsp;on&nbsp;the&nbsp;stack</span><br>
<span class="lineno"></span><span class="comment" id="5220038">//&nbsp;and&nbsp;returns&nbsp;that&nbsp;regexp.</span><br>
<span class="lineno"></span><span class="keyword" id="5220066">func</span>&nbsp;<span class="op" id="5220071">(</span><span class="ident" id="5220072">p</span>&nbsp;<span class="op" id="5220074">*</span><span class="ident" id="5220075">parser</span><span class="op" id="5220081">)</span>&nbsp;<span class="ident" id="5220083">literal</span><span class="op" id="5220090">(</span><span class="ident" id="5220091">r</span>&nbsp;<span class="builtintype" id="5220093">rune</span><span class="op" id="5220097">)</span>&nbsp;<span class="op" id="5220099">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5220102">p</span><span class="op" id="5220103">.</span><span class="ident" id="5220104">push</span><span class="op" id="5220108">(</span><span class="ident" id="5220109">p</span><span class="op" id="5220110">.</span><span class="ident" id="5220111">newLiteral</span><span class="op" id="5220121">(</span><span class="ident" id="5220122">r</span><span class="op" id="5220123">,</span>&nbsp;<span class="ident" id="5220125">p</span><span class="op" id="5220126">.</span><span class="ident" id="5220127">flags</span><span class="op" id="5220132">)</span><span class="op" id="5220133">)</span><br>
<span class="lineno"></span><span class="op" id="5220135">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5220138">//&nbsp;op&nbsp;pushes&nbsp;a&nbsp;regexp&nbsp;with&nbsp;the&nbsp;given&nbsp;op&nbsp;onto&nbsp;the&nbsp;stack</span><br>
<span class="lineno"></span><span class="comment" id="5220193">//&nbsp;and&nbsp;returns&nbsp;that&nbsp;regexp.</span><br>
<span class="lineno">215</span><span class="keyword" id="5220221">func</span>&nbsp;<span class="op" id="5220226">(</span><span class="ident" id="5220227">p</span>&nbsp;<span class="op" id="5220229">*</span><span class="ident" id="5220230">parser</span><span class="op" id="5220236">)</span>&nbsp;<span class="ident" id="5220238">op</span><span class="op" id="5220240">(</span><span class="ident" id="5220241">op</span>&nbsp;<span class="ident" id="5220244">Op</span><span class="op" id="5220246">)</span>&nbsp;<span class="op" id="5220248">*</span><span class="ident" id="5220249">Regexp</span>&nbsp;<span class="op" id="5220256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5220259">re</span>&nbsp;<span class="op" id="5220262">:=</span>&nbsp;<span class="ident" id="5220265">p</span><span class="op" id="5220266">.</span><span class="ident" id="5220267">newRegexp</span><span class="op" id="5220276">(</span><span class="ident" id="5220277">op</span><span class="op" id="5220279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5220282">re</span><span class="op" id="5220284">.</span><span class="ident" id="5220285">Flags</span>&nbsp;<span class="op" id="5220291">=</span>&nbsp;<span class="ident" id="5220293">p</span><span class="op" id="5220294">.</span><span class="ident" id="5220295">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5220302">return</span>&nbsp;<span class="ident" id="5220309">p</span><span class="op" id="5220310">.</span><span class="ident" id="5220311">push</span><span class="op" id="5220315">(</span><span class="ident" id="5220316">re</span><span class="op" id="5220318">)</span><br>
<span class="lineno"></span><span class="op" id="5220320">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="5220323">//&nbsp;repeat&nbsp;replaces&nbsp;the&nbsp;top&nbsp;stack&nbsp;element&nbsp;with&nbsp;itself&nbsp;repeated&nbsp;according&nbsp;to&nbsp;op,&nbsp;min,&nbsp;max.</span><br>
<span class="lineno"></span><span class="comment" id="5220412">//&nbsp;before&nbsp;is&nbsp;the&nbsp;regexp&nbsp;suffix&nbsp;starting&nbsp;at&nbsp;the&nbsp;repetition&nbsp;operator.</span><br>
<span class="lineno"></span><span class="comment" id="5220480">//&nbsp;after&nbsp;is&nbsp;the&nbsp;regexp&nbsp;suffix&nbsp;following&nbsp;after&nbsp;the&nbsp;repetition&nbsp;operator.</span><br>
<span class="lineno"></span><span class="comment" id="5220551">//&nbsp;repeat&nbsp;returns&nbsp;an&nbsp;updated&nbsp;&#39;after&#39;&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno">225</span><span class="keyword" id="5220610">func</span>&nbsp;<span class="op" id="5220615">(</span><span class="ident" id="5220616">p</span>&nbsp;<span class="op" id="5220618">*</span><span class="ident" id="5220619">parser</span><span class="op" id="5220625">)</span>&nbsp;<span class="ident" id="5220627">repeat</span><span class="op" id="5220633">(</span><span class="ident" id="5220634">op</span>&nbsp;<span class="ident" id="5220637">Op</span><span class="op" id="5220639">,</span>&nbsp;<span class="ident" id="5220641">min</span><span class="op" id="5220644">,</span>&nbsp;<span class="ident" id="5220646">max</span>&nbsp;<span class="builtintype" id="5220650">int</span><span class="op" id="5220653">,</span>&nbsp;<span class="ident" id="5220655">before</span><span class="op" id="5220661">,</span>&nbsp;<span class="ident" id="5220663">after</span><span class="op" id="5220668">,</span>&nbsp;<span class="ident" id="5220670">lastRepeat</span>&nbsp;<span class="builtintype" id="5220681">string</span><span class="op" id="5220687">)</span>&nbsp;<span class="op" id="5220689">(</span><span class="builtintype" id="5220690">string</span><span class="op" id="5220696">,</span>&nbsp;<span class="builtintype" id="5220698">error</span><span class="op" id="5220703">)</span>&nbsp;<span class="op" id="5220705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5220708">flags</span>&nbsp;<span class="op" id="5220714">:=</span>&nbsp;<span class="ident" id="5220717">p</span><span class="op" id="5220718">.</span><span class="ident" id="5220719">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5220726">if</span>&nbsp;<span class="ident" id="5220729">p</span><span class="op" id="5220730">.</span><span class="ident" id="5220731">flags</span><span class="op" id="5220736">&amp;</span><span class="ident" id="5220737">PerlX</span>&nbsp;<span class="op" id="5220743">!=</span>&nbsp;<span class="num" id="5220746">0</span>&nbsp;<span class="op" id="5220748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5220752">if</span>&nbsp;<span class="builtinfunc" id="5220755">len</span><span class="op" id="5220758">(</span><span class="ident" id="5220759">after</span><span class="op" id="5220764">)</span>&nbsp;<span class="op" id="5220766">&gt;</span>&nbsp;<span class="num" id="5220768">0</span>&nbsp;<span class="op" id="5220770">&amp;&amp;</span>&nbsp;<span class="ident" id="5220773">after</span><span class="op" id="5220778">[</span><span class="num" id="5220779">0</span><span class="op" id="5220780">]</span>&nbsp;<span class="op" id="5220782">==</span>&nbsp;<span class="string" id="5220785">&#39;?&#39;</span>&nbsp;<span class="op" id="5220789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5220794">after</span>&nbsp;<span class="op" id="5220800">=</span>&nbsp;<span class="ident" id="5220802">after</span><span class="op" id="5220807">[</span><span class="num" id="5220808">1</span><span class="op" id="5220809">:</span><span class="op" id="5220810">]</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5220815">flags</span>&nbsp;<span class="op" id="5220821">^=</span>&nbsp;<span class="ident" id="5220824">NonGreedy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5220836">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5220840">if</span>&nbsp;<span class="ident" id="5220843">lastRepeat</span>&nbsp;<span class="op" id="5220854">!=</span>&nbsp;<span class="string" id="5220857">&#34;&#34;</span>&nbsp;<span class="op" id="5220860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5220865">//&nbsp;In&nbsp;Perl&nbsp;it&nbsp;is&nbsp;not&nbsp;allowed&nbsp;to&nbsp;stack&nbsp;repetition&nbsp;operators:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5220928">//&nbsp;a**&nbsp;is&nbsp;a&nbsp;syntax&nbsp;error,&nbsp;not&nbsp;a&nbsp;doubled&nbsp;star,&nbsp;and&nbsp;a++&nbsp;means</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5220991">//&nbsp;something&nbsp;else&nbsp;entirely,&nbsp;which&nbsp;we&nbsp;don&#39;t&nbsp;support!</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5221046">return</span>&nbsp;<span class="string" id="5221053">&#34;&#34;</span><span class="op" id="5221055">,</span>&nbsp;<span class="op" id="5221057">&amp;</span><span class="ident" id="5221058">Error</span><span class="op" id="5221063">{</span><span class="ident" id="5221064">ErrInvalidRepeatOp</span><span class="op" id="5221082">,</span>&nbsp;<span class="ident" id="5221084">lastRepeat</span><span class="op" id="5221094">[</span><span class="op" id="5221095">:</span><span class="builtinfunc" id="5221096">len</span><span class="op" id="5221099">(</span><span class="ident" id="5221100">lastRepeat</span><span class="op" id="5221110">)</span><span class="op" id="5221111">-</span><span class="builtinfunc" id="5221112">len</span><span class="op" id="5221115">(</span><span class="ident" id="5221116">after</span><span class="op" id="5221121">)</span><span class="op" id="5221122">]</span><span class="op" id="5221123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5221127">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5221130">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5221133">n</span>&nbsp;<span class="op" id="5221135">:=</span>&nbsp;<span class="builtinfunc" id="5221138">len</span><span class="op" id="5221141">(</span><span class="ident" id="5221142">p</span><span class="op" id="5221143">.</span><span class="ident" id="5221144">stack</span><span class="op" id="5221149">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5221152">if</span>&nbsp;<span class="ident" id="5221155">n</span>&nbsp;<span class="op" id="5221157">==</span>&nbsp;<span class="num" id="5221160">0</span>&nbsp;<span class="op" id="5221162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5221166">return</span>&nbsp;<span class="string" id="5221173">&#34;&#34;</span><span class="op" id="5221175">,</span>&nbsp;<span class="op" id="5221177">&amp;</span><span class="ident" id="5221178">Error</span><span class="op" id="5221183">{</span><span class="ident" id="5221184">ErrMissingRepeatArgument</span><span class="op" id="5221208">,</span>&nbsp;<span class="ident" id="5221210">before</span><span class="op" id="5221216">[</span><span class="op" id="5221217">:</span><span class="builtinfunc" id="5221218">len</span><span class="op" id="5221221">(</span><span class="ident" id="5221222">before</span><span class="op" id="5221228">)</span><span class="op" id="5221229">-</span><span class="builtinfunc" id="5221230">len</span><span class="op" id="5221233">(</span><span class="ident" id="5221234">after</span><span class="op" id="5221239">)</span><span class="op" id="5221240">]</span><span class="op" id="5221241">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5221244">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5221247">sub</span>&nbsp;<span class="op" id="5221251">:=</span>&nbsp;<span class="ident" id="5221254">p</span><span class="op" id="5221255">.</span><span class="ident" id="5221256">stack</span><span class="op" id="5221261">[</span><span class="ident" id="5221262">n</span><span class="op" id="5221263">-</span><span class="num" id="5221264">1</span><span class="op" id="5221265">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5221268">if</span>&nbsp;<span class="ident" id="5221271">sub</span><span class="op" id="5221274">.</span><span class="ident" id="5221275">Op</span>&nbsp;<span class="op" id="5221278">&gt;=</span>&nbsp;<span class="ident" id="5221281">opPseudo</span>&nbsp;<span class="op" id="5221290">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5221294">return</span>&nbsp;<span class="string" id="5221301">&#34;&#34;</span><span class="op" id="5221303">,</span>&nbsp;<span class="op" id="5221305">&amp;</span><span class="ident" id="5221306">Error</span><span class="op" id="5221311">{</span><span class="ident" id="5221312">ErrMissingRepeatArgument</span><span class="op" id="5221336">,</span>&nbsp;<span class="ident" id="5221338">before</span><span class="op" id="5221344">[</span><span class="op" id="5221345">:</span><span class="builtinfunc" id="5221346">len</span><span class="op" id="5221349">(</span><span class="ident" id="5221350">before</span><span class="op" id="5221356">)</span><span class="op" id="5221357">-</span><span class="builtinfunc" id="5221358">len</span><span class="op" id="5221361">(</span><span class="ident" id="5221362">after</span><span class="op" id="5221367">)</span><span class="op" id="5221368">]</span><span class="op" id="5221369">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5221372">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5221376">re</span>&nbsp;<span class="op" id="5221379">:=</span>&nbsp;<span class="ident" id="5221382">p</span><span class="op" id="5221383">.</span><span class="ident" id="5221384">newRegexp</span><span class="op" id="5221393">(</span><span class="ident" id="5221394">op</span><span class="op" id="5221396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5221399">re</span><span class="op" id="5221401">.</span><span class="ident" id="5221402">Min</span>&nbsp;<span class="op" id="5221406">=</span>&nbsp;<span class="ident" id="5221408">min</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5221413">re</span><span class="op" id="5221415">.</span><span class="ident" id="5221416">Max</span>&nbsp;<span class="op" id="5221420">=</span>&nbsp;<span class="ident" id="5221422">max</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5221427">re</span><span class="op" id="5221429">.</span><span class="ident" id="5221430">Flags</span>&nbsp;<span class="op" id="5221436">=</span>&nbsp;<span class="ident" id="5221438">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5221445">re</span><span class="op" id="5221447">.</span><span class="ident" id="5221448">Sub</span>&nbsp;<span class="op" id="5221452">=</span>&nbsp;<span class="ident" id="5221454">re</span><span class="op" id="5221456">.</span><span class="ident" id="5221457">Sub0</span><span class="op" id="5221461">[</span><span class="op" id="5221462">:</span><span class="num" id="5221463">1</span><span class="op" id="5221464">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5221467">re</span><span class="op" id="5221469">.</span><span class="ident" id="5221470">Sub</span><span class="op" id="5221473">[</span><span class="num" id="5221474">0</span><span class="op" id="5221475">]</span>&nbsp;<span class="op" id="5221477">=</span>&nbsp;<span class="ident" id="5221479">sub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5221484">p</span><span class="op" id="5221485">.</span><span class="ident" id="5221486">stack</span><span class="op" id="5221491">[</span><span class="ident" id="5221492">n</span><span class="op" id="5221493">-</span><span class="num" id="5221494">1</span><span class="op" id="5221495">]</span>&nbsp;<span class="op" id="5221497">=</span>&nbsp;<span class="ident" id="5221499">re</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5221504">if</span>&nbsp;<span class="ident" id="5221507">op</span>&nbsp;<span class="op" id="5221510">==</span>&nbsp;<span class="ident" id="5221513">OpRepeat</span>&nbsp;<span class="op" id="5221522">&amp;&amp;</span>&nbsp;<span class="op" id="5221525">(</span><span class="ident" id="5221526">min</span>&nbsp;<span class="op" id="5221530">&gt;=</span>&nbsp;<span class="num" id="5221533">2</span>&nbsp;<span class="op" id="5221535">||</span>&nbsp;<span class="ident" id="5221538">max</span>&nbsp;<span class="op" id="5221542">&gt;=</span>&nbsp;<span class="num" id="5221545">2</span><span class="op" id="5221546">)</span>&nbsp;<span class="op" id="5221548">&amp;&amp;</span>&nbsp;<span class="op" id="5221551">!</span><span class="ident" id="5221552">repeatIsValid</span><span class="op" id="5221565">(</span><span class="ident" id="5221566">re</span><span class="op" id="5221568">,</span>&nbsp;<span class="num" id="5221570">1000</span><span class="op" id="5221574">)</span>&nbsp;<span class="op" id="5221576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5221580">return</span>&nbsp;<span class="string" id="5221587">&#34;&#34;</span><span class="op" id="5221589">,</span>&nbsp;<span class="op" id="5221591">&amp;</span><span class="ident" id="5221592">Error</span><span class="op" id="5221597">{</span><span class="ident" id="5221598">ErrInvalidRepeatSize</span><span class="op" id="5221618">,</span>&nbsp;<span class="ident" id="5221620">before</span><span class="op" id="5221626">[</span><span class="op" id="5221627">:</span><span class="builtinfunc" id="5221628">len</span><span class="op" id="5221631">(</span><span class="ident" id="5221632">before</span><span class="op" id="5221638">)</span><span class="op" id="5221639">-</span><span class="builtinfunc" id="5221640">len</span><span class="op" id="5221643">(</span><span class="ident" id="5221644">after</span><span class="op" id="5221649">)</span><span class="op" id="5221650">]</span><span class="op" id="5221651">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5221654">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5221658">return</span>&nbsp;<span class="ident" id="5221665">after</span><span class="op" id="5221670">,</span>&nbsp;<span class="builtintype" id="5221672">nil</span><br>
<span class="lineno"></span><span class="op" id="5221676">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5221679">//&nbsp;repeatIsValid&nbsp;reports&nbsp;whether&nbsp;the&nbsp;repetition&nbsp;re&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="comment" id="5221740">//&nbsp;Valid&nbsp;means&nbsp;that&nbsp;the&nbsp;combination&nbsp;of&nbsp;the&nbsp;top-level&nbsp;repetition</span><br>
<span class="lineno">265</span><span class="comment" id="5221804">//&nbsp;and&nbsp;any&nbsp;inner&nbsp;repetitions&nbsp;does&nbsp;not&nbsp;exceed&nbsp;n&nbsp;copies&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5221865">//&nbsp;innermost&nbsp;thing.</span><br>
<span class="lineno"></span><span class="comment" id="5221885">//&nbsp;This&nbsp;function&nbsp;rewalks&nbsp;the&nbsp;regexp&nbsp;tree&nbsp;and&nbsp;is&nbsp;called&nbsp;for&nbsp;every&nbsp;repetition,</span><br>
<span class="lineno"></span><span class="comment" id="5221962">//&nbsp;so&nbsp;we&nbsp;have&nbsp;to&nbsp;worry&nbsp;about&nbsp;inducing&nbsp;quadratic&nbsp;behavior&nbsp;in&nbsp;the&nbsp;parser.</span><br>
<span class="lineno"></span><span class="comment" id="5222034">//&nbsp;We&nbsp;avoid&nbsp;this&nbsp;by&nbsp;only&nbsp;calling&nbsp;repeatIsValid&nbsp;when&nbsp;min&nbsp;or&nbsp;max&nbsp;&gt;=&nbsp;2.</span><br>
<span class="lineno">270</span><span class="comment" id="5222103">//&nbsp;In&nbsp;that&nbsp;case&nbsp;the&nbsp;depth&nbsp;of&nbsp;any&nbsp;&gt;=&nbsp;2&nbsp;nesting&nbsp;can&nbsp;only&nbsp;get&nbsp;to&nbsp;9&nbsp;without</span><br>
<span class="lineno"></span><span class="comment" id="5222175">//&nbsp;triggering&nbsp;a&nbsp;parse&nbsp;error,&nbsp;so&nbsp;each&nbsp;subtree&nbsp;can&nbsp;only&nbsp;be&nbsp;rewalked&nbsp;9&nbsp;times.</span><br>
<span class="lineno"></span><span class="keyword" id="5222250">func</span>&nbsp;<span class="ident" id="5222255">repeatIsValid</span><span class="op" id="5222268">(</span><span class="ident" id="5222269">re</span>&nbsp;<span class="op" id="5222272">*</span><span class="ident" id="5222273">Regexp</span><span class="op" id="5222279">,</span>&nbsp;<span class="ident" id="5222281">n</span>&nbsp;<span class="builtintype" id="5222283">int</span><span class="op" id="5222286">)</span>&nbsp;<span class="builtintype" id="5222288">bool</span>&nbsp;<span class="op" id="5222293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5222296">if</span>&nbsp;<span class="ident" id="5222299">re</span><span class="op" id="5222301">.</span><span class="ident" id="5222302">Op</span>&nbsp;<span class="op" id="5222305">==</span>&nbsp;<span class="ident" id="5222308">OpRepeat</span>&nbsp;<span class="op" id="5222317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5222321">m</span>&nbsp;<span class="op" id="5222323">:=</span>&nbsp;<span class="ident" id="5222326">re</span><span class="op" id="5222328">.</span><span class="ident" id="5222329">Max</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5222335">if</span>&nbsp;<span class="ident" id="5222338">m</span>&nbsp;<span class="op" id="5222340">==</span>&nbsp;<span class="num" id="5222343">0</span>&nbsp;<span class="op" id="5222345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5222350">return</span>&nbsp;<span class="builtintype" id="5222357">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5222364">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5222368">if</span>&nbsp;<span class="ident" id="5222371">m</span>&nbsp;<span class="op" id="5222373">&lt;</span>&nbsp;<span class="num" id="5222375">0</span>&nbsp;<span class="op" id="5222377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5222382">m</span>&nbsp;<span class="op" id="5222384">=</span>&nbsp;<span class="ident" id="5222386">re</span><span class="op" id="5222388">.</span><span class="ident" id="5222389">Min</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5222395">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5222399">if</span>&nbsp;<span class="ident" id="5222402">m</span>&nbsp;<span class="op" id="5222404">&gt;</span>&nbsp;<span class="ident" id="5222406">n</span>&nbsp;<span class="op" id="5222408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5222413">return</span>&nbsp;<span class="builtintype" id="5222420">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5222428">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5222432">if</span>&nbsp;<span class="ident" id="5222435">m</span>&nbsp;<span class="op" id="5222437">&gt;</span>&nbsp;<span class="num" id="5222439">0</span>&nbsp;<span class="op" id="5222441">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5222446">n</span>&nbsp;<span class="op" id="5222448">/=</span>&nbsp;<span class="ident" id="5222451">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5222455">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5222458">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5222461">for</span>&nbsp;<span class="ident" id="5222465">_</span><span class="op" id="5222466">,</span>&nbsp;<span class="ident" id="5222468">sub</span>&nbsp;<span class="op" id="5222472">:=</span>&nbsp;<span class="keyword" id="5222475">range</span>&nbsp;<span class="ident" id="5222481">re</span><span class="op" id="5222483">.</span><span class="ident" id="5222484">Sub</span>&nbsp;<span class="op" id="5222488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5222492">if</span>&nbsp;<span class="op" id="5222495">!</span><span class="ident" id="5222496">repeatIsValid</span><span class="op" id="5222509">(</span><span class="ident" id="5222510">sub</span><span class="op" id="5222513">,</span>&nbsp;<span class="ident" id="5222515">n</span><span class="op" id="5222516">)</span>&nbsp;<span class="op" id="5222518">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5222523">return</span>&nbsp;<span class="builtintype" id="5222530">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5222538">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5222541">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5222544">return</span>&nbsp;<span class="builtintype" id="5222551">true</span><br>
<span class="lineno"></span><span class="op" id="5222556">}</span><br>
<span class="lineno">295</span><br>
<span class="lineno"></span><span class="comment" id="5222559">//&nbsp;concat&nbsp;replaces&nbsp;the&nbsp;top&nbsp;of&nbsp;the&nbsp;stack&nbsp;(above&nbsp;the&nbsp;topmost&nbsp;&#39;|&#39;&nbsp;or&nbsp;&#39;(&#39;)&nbsp;with&nbsp;its&nbsp;concatenation.</span><br>
<span class="lineno"></span><span class="keyword" id="5222654">func</span>&nbsp;<span class="op" id="5222659">(</span><span class="ident" id="5222660">p</span>&nbsp;<span class="op" id="5222662">*</span><span class="ident" id="5222663">parser</span><span class="op" id="5222669">)</span>&nbsp;<span class="ident" id="5222671">concat</span><span class="op" id="5222677">(</span><span class="op" id="5222678">)</span>&nbsp;<span class="op" id="5222680">*</span><span class="ident" id="5222681">Regexp</span>&nbsp;<span class="op" id="5222688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5222691">p</span><span class="op" id="5222692">.</span><span class="ident" id="5222693">maybeConcat</span><span class="op" id="5222704">(</span><span class="op" id="5222705">-</span><span class="num" id="5222706">1</span><span class="op" id="5222707">,</span>&nbsp;<span class="num" id="5222709">0</span><span class="op" id="5222710">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5222714">//&nbsp;Scan&nbsp;down&nbsp;to&nbsp;find&nbsp;pseudo-operator&nbsp;|&nbsp;or&nbsp;(.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5222760">i</span>&nbsp;<span class="op" id="5222762">:=</span>&nbsp;<span class="builtinfunc" id="5222765">len</span><span class="op" id="5222768">(</span><span class="ident" id="5222769">p</span><span class="op" id="5222770">.</span><span class="ident" id="5222771">stack</span><span class="op" id="5222776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5222779">for</span>&nbsp;<span class="ident" id="5222783">i</span>&nbsp;<span class="op" id="5222785">&gt;</span>&nbsp;<span class="num" id="5222787">0</span>&nbsp;<span class="op" id="5222789">&amp;&amp;</span>&nbsp;<span class="ident" id="5222792">p</span><span class="op" id="5222793">.</span><span class="ident" id="5222794">stack</span><span class="op" id="5222799">[</span><span class="ident" id="5222800">i</span><span class="op" id="5222801">-</span><span class="num" id="5222802">1</span><span class="op" id="5222803">]</span><span class="op" id="5222804">.</span><span class="ident" id="5222805">Op</span>&nbsp;<span class="op" id="5222808">&lt;</span>&nbsp;<span class="ident" id="5222810">opPseudo</span>&nbsp;<span class="op" id="5222819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5222823">i</span><span class="op" id="5222824">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5222828">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5222831">subs</span>&nbsp;<span class="op" id="5222836">:=</span>&nbsp;<span class="ident" id="5222839">p</span><span class="op" id="5222840">.</span><span class="ident" id="5222841">stack</span><span class="op" id="5222846">[</span><span class="ident" id="5222847">i</span><span class="op" id="5222848">:</span><span class="op" id="5222849">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5222852">p</span><span class="op" id="5222853">.</span><span class="ident" id="5222854">stack</span>&nbsp;<span class="op" id="5222860">=</span>&nbsp;<span class="ident" id="5222862">p</span><span class="op" id="5222863">.</span><span class="ident" id="5222864">stack</span><span class="op" id="5222869">[</span><span class="op" id="5222870">:</span><span class="ident" id="5222871">i</span><span class="op" id="5222872">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5222876">//&nbsp;Empty&nbsp;concatenation&nbsp;is&nbsp;special&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5222917">if</span>&nbsp;<span class="builtinfunc" id="5222920">len</span><span class="op" id="5222923">(</span><span class="ident" id="5222924">subs</span><span class="op" id="5222928">)</span>&nbsp;<span class="op" id="5222930">==</span>&nbsp;<span class="num" id="5222933">0</span>&nbsp;<span class="op" id="5222935">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5222939">return</span>&nbsp;<span class="ident" id="5222946">p</span><span class="op" id="5222947">.</span><span class="ident" id="5222948">push</span><span class="op" id="5222952">(</span><span class="ident" id="5222953">p</span><span class="op" id="5222954">.</span><span class="ident" id="5222955">newRegexp</span><span class="op" id="5222964">(</span><span class="ident" id="5222965">OpEmptyMatch</span><span class="op" id="5222977">)</span><span class="op" id="5222978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5222981">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5222985">return</span>&nbsp;<span class="ident" id="5222992">p</span><span class="op" id="5222993">.</span><span class="ident" id="5222994">push</span><span class="op" id="5222998">(</span><span class="ident" id="5222999">p</span><span class="op" id="5223000">.</span><span class="ident" id="5223001">collapse</span><span class="op" id="5223009">(</span><span class="ident" id="5223010">subs</span><span class="op" id="5223014">,</span>&nbsp;<span class="ident" id="5223016">OpConcat</span><span class="op" id="5223024">)</span><span class="op" id="5223025">)</span><br>
<span class="lineno"></span><span class="op" id="5223027">}</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span><span class="comment" id="5223030">//&nbsp;alternate&nbsp;replaces&nbsp;the&nbsp;top&nbsp;of&nbsp;the&nbsp;stack&nbsp;(above&nbsp;the&nbsp;topmost&nbsp;&#39;(&#39;)&nbsp;with&nbsp;its&nbsp;alternation.</span><br>
<span class="lineno"></span><span class="keyword" id="5223119">func</span>&nbsp;<span class="op" id="5223124">(</span><span class="ident" id="5223125">p</span>&nbsp;<span class="op" id="5223127">*</span><span class="ident" id="5223128">parser</span><span class="op" id="5223134">)</span>&nbsp;<span class="ident" id="5223136">alternate</span><span class="op" id="5223145">(</span><span class="op" id="5223146">)</span>&nbsp;<span class="op" id="5223148">*</span><span class="ident" id="5223149">Regexp</span>&nbsp;<span class="op" id="5223156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5223159">//&nbsp;Scan&nbsp;down&nbsp;to&nbsp;find&nbsp;pseudo-operator&nbsp;(.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5223200">//&nbsp;There&nbsp;are&nbsp;no&nbsp;|&nbsp;above&nbsp;(.</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5223228">i</span>&nbsp;<span class="op" id="5223230">:=</span>&nbsp;<span class="builtinfunc" id="5223233">len</span><span class="op" id="5223236">(</span><span class="ident" id="5223237">p</span><span class="op" id="5223238">.</span><span class="ident" id="5223239">stack</span><span class="op" id="5223244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5223247">for</span>&nbsp;<span class="ident" id="5223251">i</span>&nbsp;<span class="op" id="5223253">&gt;</span>&nbsp;<span class="num" id="5223255">0</span>&nbsp;<span class="op" id="5223257">&amp;&amp;</span>&nbsp;<span class="ident" id="5223260">p</span><span class="op" id="5223261">.</span><span class="ident" id="5223262">stack</span><span class="op" id="5223267">[</span><span class="ident" id="5223268">i</span><span class="op" id="5223269">-</span><span class="num" id="5223270">1</span><span class="op" id="5223271">]</span><span class="op" id="5223272">.</span><span class="ident" id="5223273">Op</span>&nbsp;<span class="op" id="5223276">&lt;</span>&nbsp;<span class="ident" id="5223278">opPseudo</span>&nbsp;<span class="op" id="5223287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5223291">i</span><span class="op" id="5223292">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5223296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5223299">subs</span>&nbsp;<span class="op" id="5223304">:=</span>&nbsp;<span class="ident" id="5223307">p</span><span class="op" id="5223308">.</span><span class="ident" id="5223309">stack</span><span class="op" id="5223314">[</span><span class="ident" id="5223315">i</span><span class="op" id="5223316">:</span><span class="op" id="5223317">]</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5223320">p</span><span class="op" id="5223321">.</span><span class="ident" id="5223322">stack</span>&nbsp;<span class="op" id="5223328">=</span>&nbsp;<span class="ident" id="5223330">p</span><span class="op" id="5223331">.</span><span class="ident" id="5223332">stack</span><span class="op" id="5223337">[</span><span class="op" id="5223338">:</span><span class="ident" id="5223339">i</span><span class="op" id="5223340">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5223344">//&nbsp;Make&nbsp;sure&nbsp;top&nbsp;class&nbsp;is&nbsp;clean.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5223378">//&nbsp;All&nbsp;the&nbsp;others&nbsp;already&nbsp;are&nbsp;(see&nbsp;swapVerticalBar).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5223432">if</span>&nbsp;<span class="builtinfunc" id="5223435">len</span><span class="op" id="5223438">(</span><span class="ident" id="5223439">subs</span><span class="op" id="5223443">)</span>&nbsp;<span class="op" id="5223445">&gt;</span>&nbsp;<span class="num" id="5223447">0</span>&nbsp;<span class="op" id="5223449">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5223453">cleanAlt</span><span class="op" id="5223461">(</span><span class="ident" id="5223462">subs</span><span class="op" id="5223466">[</span><span class="builtinfunc" id="5223467">len</span><span class="op" id="5223470">(</span><span class="ident" id="5223471">subs</span><span class="op" id="5223475">)</span><span class="op" id="5223476">-</span><span class="num" id="5223477">1</span><span class="op" id="5223478">]</span><span class="op" id="5223479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5223482">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5223486">//&nbsp;Empty&nbsp;alternate&nbsp;is&nbsp;special&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5223522">//&nbsp;(shouldn&#39;t&nbsp;happen&nbsp;but&nbsp;easy&nbsp;to&nbsp;handle).</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5223565">if</span>&nbsp;<span class="builtinfunc" id="5223568">len</span><span class="op" id="5223571">(</span><span class="ident" id="5223572">subs</span><span class="op" id="5223576">)</span>&nbsp;<span class="op" id="5223578">==</span>&nbsp;<span class="num" id="5223581">0</span>&nbsp;<span class="op" id="5223583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5223587">return</span>&nbsp;<span class="ident" id="5223594">p</span><span class="op" id="5223595">.</span><span class="ident" id="5223596">push</span><span class="op" id="5223600">(</span><span class="ident" id="5223601">p</span><span class="op" id="5223602">.</span><span class="ident" id="5223603">newRegexp</span><span class="op" id="5223612">(</span><span class="ident" id="5223613">OpNoMatch</span><span class="op" id="5223622">)</span><span class="op" id="5223623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5223626">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5223630">return</span>&nbsp;<span class="ident" id="5223637">p</span><span class="op" id="5223638">.</span><span class="ident" id="5223639">push</span><span class="op" id="5223643">(</span><span class="ident" id="5223644">p</span><span class="op" id="5223645">.</span><span class="ident" id="5223646">collapse</span><span class="op" id="5223654">(</span><span class="ident" id="5223655">subs</span><span class="op" id="5223659">,</span>&nbsp;<span class="ident" id="5223661">OpAlternate</span><span class="op" id="5223672">)</span><span class="op" id="5223673">)</span><br>
<span class="lineno">340</span><span class="op" id="5223675">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5223678">//&nbsp;cleanAlt&nbsp;cleans&nbsp;re&nbsp;for&nbsp;eventual&nbsp;inclusion&nbsp;in&nbsp;an&nbsp;alternation.</span><br>
<span class="lineno"></span><span class="keyword" id="5223742">func</span>&nbsp;<span class="ident" id="5223747">cleanAlt</span><span class="op" id="5223755">(</span><span class="ident" id="5223756">re</span>&nbsp;<span class="op" id="5223759">*</span><span class="ident" id="5223760">Regexp</span><span class="op" id="5223766">)</span>&nbsp;<span class="op" id="5223768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5223771">switch</span>&nbsp;<span class="ident" id="5223778">re</span><span class="op" id="5223780">.</span><span class="ident" id="5223781">Op</span>&nbsp;<span class="op" id="5223784">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5223787">case</span>&nbsp;<span class="ident" id="5223792">OpCharClass</span><span class="op" id="5223803">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5223807">re</span><span class="op" id="5223809">.</span><span class="ident" id="5223810">Rune</span>&nbsp;<span class="op" id="5223815">=</span>&nbsp;<span class="ident" id="5223817">cleanClass</span><span class="op" id="5223827">(</span><span class="op" id="5223828">&amp;</span><span class="ident" id="5223829">re</span><span class="op" id="5223831">.</span><span class="ident" id="5223832">Rune</span><span class="op" id="5223836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5223840">if</span>&nbsp;<span class="builtinfunc" id="5223843">len</span><span class="op" id="5223846">(</span><span class="ident" id="5223847">re</span><span class="op" id="5223849">.</span><span class="ident" id="5223850">Rune</span><span class="op" id="5223854">)</span>&nbsp;<span class="op" id="5223856">==</span>&nbsp;<span class="num" id="5223859">2</span>&nbsp;<span class="op" id="5223861">&amp;&amp;</span>&nbsp;<span class="ident" id="5223864">re</span><span class="op" id="5223866">.</span><span class="ident" id="5223867">Rune</span><span class="op" id="5223871">[</span><span class="num" id="5223872">0</span><span class="op" id="5223873">]</span>&nbsp;<span class="op" id="5223875">==</span>&nbsp;<span class="num" id="5223878">0</span>&nbsp;<span class="op" id="5223880">&amp;&amp;</span>&nbsp;<span class="ident" id="5223883">re</span><span class="op" id="5223885">.</span><span class="ident" id="5223886">Rune</span><span class="op" id="5223890">[</span><span class="num" id="5223891">1</span><span class="op" id="5223892">]</span>&nbsp;<span class="op" id="5223894">==</span>&nbsp;<span class="ident" id="5223897">unicode</span><span class="op" id="5223904">.</span><span class="ident" id="5223905">MaxRune</span>&nbsp;<span class="op" id="5223913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5223918">re</span><span class="op" id="5223920">.</span><span class="ident" id="5223921">Rune</span>&nbsp;<span class="op" id="5223926">=</span>&nbsp;<span class="builtintype" id="5223928">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5223935">re</span><span class="op" id="5223937">.</span><span class="ident" id="5223938">Op</span>&nbsp;<span class="op" id="5223941">=</span>&nbsp;<span class="ident" id="5223943">OpAnyChar</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5223956">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5223965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5223969">if</span>&nbsp;<span class="builtinfunc" id="5223972">len</span><span class="op" id="5223975">(</span><span class="ident" id="5223976">re</span><span class="op" id="5223978">.</span><span class="ident" id="5223979">Rune</span><span class="op" id="5223983">)</span>&nbsp;<span class="op" id="5223985">==</span>&nbsp;<span class="num" id="5223988">4</span>&nbsp;<span class="op" id="5223990">&amp;&amp;</span>&nbsp;<span class="ident" id="5223993">re</span><span class="op" id="5223995">.</span><span class="ident" id="5223996">Rune</span><span class="op" id="5224000">[</span><span class="num" id="5224001">0</span><span class="op" id="5224002">]</span>&nbsp;<span class="op" id="5224004">==</span>&nbsp;<span class="num" id="5224007">0</span>&nbsp;<span class="op" id="5224009">&amp;&amp;</span>&nbsp;<span class="ident" id="5224012">re</span><span class="op" id="5224014">.</span><span class="ident" id="5224015">Rune</span><span class="op" id="5224019">[</span><span class="num" id="5224020">1</span><span class="op" id="5224021">]</span>&nbsp;<span class="op" id="5224023">==</span>&nbsp;<span class="string" id="5224026">&#39;\n&#39;</span><span class="op" id="5224030">-</span><span class="num" id="5224031">1</span>&nbsp;<span class="op" id="5224033">&amp;&amp;</span>&nbsp;<span class="ident" id="5224036">re</span><span class="op" id="5224038">.</span><span class="ident" id="5224039">Rune</span><span class="op" id="5224043">[</span><span class="num" id="5224044">2</span><span class="op" id="5224045">]</span>&nbsp;<span class="op" id="5224047">==</span>&nbsp;<span class="string" id="5224050">&#39;\n&#39;</span><span class="op" id="5224054">+</span><span class="num" id="5224055">1</span>&nbsp;<span class="op" id="5224057">&amp;&amp;</span>&nbsp;<span class="ident" id="5224060">re</span><span class="op" id="5224062">.</span><span class="ident" id="5224063">Rune</span><span class="op" id="5224067">[</span><span class="num" id="5224068">3</span><span class="op" id="5224069">]</span>&nbsp;<span class="op" id="5224071">==</span>&nbsp;<span class="ident" id="5224074">unicode</span><span class="op" id="5224081">.</span><span class="ident" id="5224082">MaxRune</span>&nbsp;<span class="op" id="5224090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5224095">re</span><span class="op" id="5224097">.</span><span class="ident" id="5224098">Rune</span>&nbsp;<span class="op" id="5224103">=</span>&nbsp;<span class="builtintype" id="5224105">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5224112">re</span><span class="op" id="5224114">.</span><span class="ident" id="5224115">Op</span>&nbsp;<span class="op" id="5224118">=</span>&nbsp;<span class="ident" id="5224120">OpAnyCharNotNL</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5224138">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5224147">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5224151">if</span>&nbsp;<span class="builtinfunc" id="5224154">cap</span><span class="op" id="5224157">(</span><span class="ident" id="5224158">re</span><span class="op" id="5224160">.</span><span class="ident" id="5224161">Rune</span><span class="op" id="5224165">)</span><span class="op" id="5224166">-</span><span class="builtinfunc" id="5224167">len</span><span class="op" id="5224170">(</span><span class="ident" id="5224171">re</span><span class="op" id="5224173">.</span><span class="ident" id="5224174">Rune</span><span class="op" id="5224178">)</span>&nbsp;<span class="op" id="5224180">&gt;</span>&nbsp;<span class="num" id="5224182">100</span>&nbsp;<span class="op" id="5224186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5224191">//&nbsp;re.Rune&nbsp;will&nbsp;not&nbsp;grow&nbsp;any&nbsp;more.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5224229">//&nbsp;Make&nbsp;a&nbsp;copy&nbsp;or&nbsp;inline&nbsp;to&nbsp;reclaim&nbsp;storage.</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5224277">re</span><span class="op" id="5224279">.</span><span class="ident" id="5224280">Rune</span>&nbsp;<span class="op" id="5224285">=</span>&nbsp;<span class="builtinfunc" id="5224287">append</span><span class="op" id="5224293">(</span><span class="ident" id="5224294">re</span><span class="op" id="5224296">.</span><span class="ident" id="5224297">Rune0</span><span class="op" id="5224302">[</span><span class="op" id="5224303">:</span><span class="num" id="5224304">0</span><span class="op" id="5224305">]</span><span class="op" id="5224306">,</span>&nbsp;<span class="ident" id="5224308">re</span><span class="op" id="5224310">.</span><span class="ident" id="5224311">Rune</span><span class="op" id="5224315">...</span><span class="op" id="5224318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5224322">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5224325">}</span><br>
<span class="lineno"></span><span class="op" id="5224327">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="comment" id="5224330">//&nbsp;collapse&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;applying&nbsp;op&nbsp;to&nbsp;sub.</span><br>
<span class="lineno"></span><span class="comment" id="5224384">//&nbsp;If&nbsp;sub&nbsp;contains&nbsp;op&nbsp;nodes,&nbsp;they&nbsp;all&nbsp;get&nbsp;hoisted&nbsp;up</span><br>
<span class="lineno"></span><span class="comment" id="5224437">//&nbsp;so&nbsp;that&nbsp;there&nbsp;is&nbsp;never&nbsp;a&nbsp;concat&nbsp;of&nbsp;a&nbsp;concat&nbsp;or&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="5224490">//&nbsp;alternate&nbsp;of&nbsp;an&nbsp;alternate.</span><br>
<span class="lineno"></span><span class="keyword" id="5224520">func</span>&nbsp;<span class="op" id="5224525">(</span><span class="ident" id="5224526">p</span>&nbsp;<span class="op" id="5224528">*</span><span class="ident" id="5224529">parser</span><span class="op" id="5224535">)</span>&nbsp;<span class="ident" id="5224537">collapse</span><span class="op" id="5224545">(</span><span class="ident" id="5224546">subs</span>&nbsp;<span class="op" id="5224551">[</span><span class="op" id="5224552">]</span><span class="op" id="5224553">*</span><span class="ident" id="5224554">Regexp</span><span class="op" id="5224560">,</span>&nbsp;<span class="ident" id="5224562">op</span>&nbsp;<span class="ident" id="5224565">Op</span><span class="op" id="5224567">)</span>&nbsp;<span class="op" id="5224569">*</span><span class="ident" id="5224570">Regexp</span>&nbsp;<span class="op" id="5224577">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5224580">if</span>&nbsp;<span class="builtinfunc" id="5224583">len</span><span class="op" id="5224586">(</span><span class="ident" id="5224587">subs</span><span class="op" id="5224591">)</span>&nbsp;<span class="op" id="5224593">==</span>&nbsp;<span class="num" id="5224596">1</span>&nbsp;<span class="op" id="5224598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5224602">return</span>&nbsp;<span class="ident" id="5224609">subs</span><span class="op" id="5224613">[</span><span class="num" id="5224614">0</span><span class="op" id="5224615">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5224618">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5224621">re</span>&nbsp;<span class="op" id="5224624">:=</span>&nbsp;<span class="ident" id="5224627">p</span><span class="op" id="5224628">.</span><span class="ident" id="5224629">newRegexp</span><span class="op" id="5224638">(</span><span class="ident" id="5224639">op</span><span class="op" id="5224641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5224644">re</span><span class="op" id="5224646">.</span><span class="ident" id="5224647">Sub</span>&nbsp;<span class="op" id="5224651">=</span>&nbsp;<span class="ident" id="5224653">re</span><span class="op" id="5224655">.</span><span class="ident" id="5224656">Sub0</span><span class="op" id="5224660">[</span><span class="op" id="5224661">:</span><span class="num" id="5224662">0</span><span class="op" id="5224663">]</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5224666">for</span>&nbsp;<span class="ident" id="5224670">_</span><span class="op" id="5224671">,</span>&nbsp;<span class="ident" id="5224673">sub</span>&nbsp;<span class="op" id="5224677">:=</span>&nbsp;<span class="keyword" id="5224680">range</span>&nbsp;<span class="ident" id="5224686">subs</span>&nbsp;<span class="op" id="5224691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5224695">if</span>&nbsp;<span class="ident" id="5224698">sub</span><span class="op" id="5224701">.</span><span class="ident" id="5224702">Op</span>&nbsp;<span class="op" id="5224705">==</span>&nbsp;<span class="ident" id="5224708">op</span>&nbsp;<span class="op" id="5224711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5224716">re</span><span class="op" id="5224718">.</span><span class="ident" id="5224719">Sub</span>&nbsp;<span class="op" id="5224723">=</span>&nbsp;<span class="builtinfunc" id="5224725">append</span><span class="op" id="5224731">(</span><span class="ident" id="5224732">re</span><span class="op" id="5224734">.</span><span class="ident" id="5224735">Sub</span><span class="op" id="5224738">,</span>&nbsp;<span class="ident" id="5224740">sub</span><span class="op" id="5224743">.</span><span class="ident" id="5224744">Sub</span><span class="op" id="5224747">...</span><span class="op" id="5224750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5224755">p</span><span class="op" id="5224756">.</span><span class="ident" id="5224757">reuse</span><span class="op" id="5224762">(</span><span class="ident" id="5224763">sub</span><span class="op" id="5224766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5224770">}</span>&nbsp;<span class="keyword" id="5224772">else</span>&nbsp;<span class="op" id="5224777">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5224782">re</span><span class="op" id="5224784">.</span><span class="ident" id="5224785">Sub</span>&nbsp;<span class="op" id="5224789">=</span>&nbsp;<span class="builtinfunc" id="5224791">append</span><span class="op" id="5224797">(</span><span class="ident" id="5224798">re</span><span class="op" id="5224800">.</span><span class="ident" id="5224801">Sub</span><span class="op" id="5224804">,</span>&nbsp;<span class="ident" id="5224806">sub</span><span class="op" id="5224809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5224813">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5224816">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5224819">if</span>&nbsp;<span class="ident" id="5224822">op</span>&nbsp;<span class="op" id="5224825">==</span>&nbsp;<span class="ident" id="5224828">OpAlternate</span>&nbsp;<span class="op" id="5224840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5224844">re</span><span class="op" id="5224846">.</span><span class="ident" id="5224847">Sub</span>&nbsp;<span class="op" id="5224851">=</span>&nbsp;<span class="ident" id="5224853">p</span><span class="op" id="5224854">.</span><span class="ident" id="5224855">factor</span><span class="op" id="5224861">(</span><span class="ident" id="5224862">re</span><span class="op" id="5224864">.</span><span class="ident" id="5224865">Sub</span><span class="op" id="5224868">,</span>&nbsp;<span class="ident" id="5224870">re</span><span class="op" id="5224872">.</span><span class="ident" id="5224873">Flags</span><span class="op" id="5224878">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5224882">if</span>&nbsp;<span class="builtinfunc" id="5224885">len</span><span class="op" id="5224888">(</span><span class="ident" id="5224889">re</span><span class="op" id="5224891">.</span><span class="ident" id="5224892">Sub</span><span class="op" id="5224895">)</span>&nbsp;<span class="op" id="5224897">==</span>&nbsp;<span class="num" id="5224900">1</span>&nbsp;<span class="op" id="5224902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5224907">old</span>&nbsp;<span class="op" id="5224911">:=</span>&nbsp;<span class="ident" id="5224914">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5224920">re</span>&nbsp;<span class="op" id="5224923">=</span>&nbsp;<span class="ident" id="5224925">re</span><span class="op" id="5224927">.</span><span class="ident" id="5224928">Sub</span><span class="op" id="5224931">[</span><span class="num" id="5224932">0</span><span class="op" id="5224933">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5224938">p</span><span class="op" id="5224939">.</span><span class="ident" id="5224940">reuse</span><span class="op" id="5224945">(</span><span class="ident" id="5224946">old</span><span class="op" id="5224949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5224953">}</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5224956">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5224959">return</span>&nbsp;<span class="ident" id="5224966">re</span><br>
<span class="lineno"></span><span class="op" id="5224969">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5224972">//&nbsp;factor&nbsp;factors&nbsp;common&nbsp;prefixes&nbsp;from&nbsp;the&nbsp;alternation&nbsp;list&nbsp;sub.</span><br>
<span class="lineno">395</span><span class="comment" id="5225037">//&nbsp;It&nbsp;returns&nbsp;a&nbsp;replacement&nbsp;list&nbsp;that&nbsp;reuses&nbsp;the&nbsp;same&nbsp;storage&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5225103">//&nbsp;frees&nbsp;(passes&nbsp;to&nbsp;p.reuse)&nbsp;any&nbsp;removed&nbsp;*Regexps.</span><br>
<span class="lineno"></span><span class="comment" id="5225154">//</span><br>
<span class="lineno"></span><span class="comment" id="5225157">//&nbsp;For&nbsp;example,</span><br>
<span class="lineno"></span><span class="comment" id="5225173">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ABC|ABD|AEF|BCX|BCY</span><br>
<span class="lineno">400</span><span class="comment" id="5225200">//&nbsp;simplifies&nbsp;by&nbsp;literal&nbsp;prefix&nbsp;extraction&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5225246">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A(B(C|D)|EF)|BC(X|Y)</span><br>
<span class="lineno"></span><span class="comment" id="5225274">//&nbsp;which&nbsp;simplifies&nbsp;by&nbsp;character&nbsp;class&nbsp;introduction&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5225329">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A(B[CD]|EF)|BC[XY]</span><br>
<span class="lineno"></span><span class="comment" id="5225355">//</span><br>
<span class="lineno">405</span><span class="keyword" id="5225358">func</span>&nbsp;<span class="op" id="5225363">(</span><span class="ident" id="5225364">p</span>&nbsp;<span class="op" id="5225366">*</span><span class="ident" id="5225367">parser</span><span class="op" id="5225373">)</span>&nbsp;<span class="ident" id="5225375">factor</span><span class="op" id="5225381">(</span><span class="ident" id="5225382">sub</span>&nbsp;<span class="op" id="5225386">[</span><span class="op" id="5225387">]</span><span class="op" id="5225388">*</span><span class="ident" id="5225389">Regexp</span><span class="op" id="5225395">,</span>&nbsp;<span class="ident" id="5225397">flags</span>&nbsp;<span class="ident" id="5225403">Flags</span><span class="op" id="5225408">)</span>&nbsp;<span class="op" id="5225410">[</span><span class="op" id="5225411">]</span><span class="op" id="5225412">*</span><span class="ident" id="5225413">Regexp</span>&nbsp;<span class="op" id="5225420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5225423">if</span>&nbsp;<span class="builtinfunc" id="5225426">len</span><span class="op" id="5225429">(</span><span class="ident" id="5225430">sub</span><span class="op" id="5225433">)</span>&nbsp;<span class="op" id="5225435">&lt;</span>&nbsp;<span class="num" id="5225437">2</span>&nbsp;<span class="op" id="5225439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5225443">return</span>&nbsp;<span class="ident" id="5225450">sub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5225455">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5225459">//&nbsp;Round&nbsp;1:&nbsp;Factor&nbsp;out&nbsp;common&nbsp;literal&nbsp;prefixes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5225508">var</span>&nbsp;<span class="ident" id="5225512">str</span>&nbsp;<span class="op" id="5225516">[</span><span class="op" id="5225517">]</span><span class="builtintype" id="5225518">rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5225524">var</span>&nbsp;<span class="ident" id="5225528">strflags</span>&nbsp;<span class="ident" id="5225537">Flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5225544">start</span>&nbsp;<span class="op" id="5225550">:=</span>&nbsp;<span class="num" id="5225553">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5225556">out</span>&nbsp;<span class="op" id="5225560">:=</span>&nbsp;<span class="ident" id="5225563">sub</span><span class="op" id="5225566">[</span><span class="op" id="5225567">:</span><span class="num" id="5225568">0</span><span class="op" id="5225569">]</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5225572">for</span>&nbsp;<span class="ident" id="5225576">i</span>&nbsp;<span class="op" id="5225578">:=</span>&nbsp;<span class="num" id="5225581">0</span><span class="op" id="5225582">;</span>&nbsp;<span class="ident" id="5225584">i</span>&nbsp;<span class="op" id="5225586">&lt;=</span>&nbsp;<span class="builtinfunc" id="5225589">len</span><span class="op" id="5225592">(</span><span class="ident" id="5225593">sub</span><span class="op" id="5225596">)</span><span class="op" id="5225597">;</span>&nbsp;<span class="ident" id="5225599">i</span><span class="op" id="5225600">++</span>&nbsp;<span class="op" id="5225603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5225607">//&nbsp;Invariant:&nbsp;the&nbsp;Regexps&nbsp;that&nbsp;were&nbsp;in&nbsp;sub[0:start]&nbsp;have&nbsp;been</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5225671">//&nbsp;used&nbsp;or&nbsp;marked&nbsp;for&nbsp;reuse,&nbsp;and&nbsp;the&nbsp;slice&nbsp;space&nbsp;has&nbsp;been&nbsp;reused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5225738">//&nbsp;for&nbsp;out&nbsp;(len(out)&nbsp;&lt;=&nbsp;start).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5225772">//</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5225777">//&nbsp;Invariant:&nbsp;sub[start:i]&nbsp;consists&nbsp;of&nbsp;regexps&nbsp;that&nbsp;all&nbsp;begin</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5225841">//&nbsp;with&nbsp;str&nbsp;as&nbsp;modified&nbsp;by&nbsp;strflags.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5225880">var</span>&nbsp;<span class="ident" id="5225884">istr</span>&nbsp;<span class="op" id="5225889">[</span><span class="op" id="5225890">]</span><span class="builtintype" id="5225891">rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5225898">var</span>&nbsp;<span class="ident" id="5225902">iflags</span>&nbsp;<span class="ident" id="5225909">Flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5225917">if</span>&nbsp;<span class="ident" id="5225920">i</span>&nbsp;<span class="op" id="5225922">&lt;</span>&nbsp;<span class="builtinfunc" id="5225924">len</span><span class="op" id="5225927">(</span><span class="ident" id="5225928">sub</span><span class="op" id="5225931">)</span>&nbsp;<span class="op" id="5225933">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5225938">istr</span><span class="op" id="5225942">,</span>&nbsp;<span class="ident" id="5225944">iflags</span>&nbsp;<span class="op" id="5225951">=</span>&nbsp;<span class="ident" id="5225953">p</span><span class="op" id="5225954">.</span><span class="ident" id="5225955">leadingString</span><span class="op" id="5225968">(</span><span class="ident" id="5225969">sub</span><span class="op" id="5225972">[</span><span class="ident" id="5225973">i</span><span class="op" id="5225974">]</span><span class="op" id="5225975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5225980">if</span>&nbsp;<span class="ident" id="5225983">iflags</span>&nbsp;<span class="op" id="5225990">==</span>&nbsp;<span class="ident" id="5225993">strflags</span>&nbsp;<span class="op" id="5226002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5226008">same</span>&nbsp;<span class="op" id="5226013">:=</span>&nbsp;<span class="num" id="5226016">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5226022">for</span>&nbsp;<span class="ident" id="5226026">same</span>&nbsp;<span class="op" id="5226031">&lt;</span>&nbsp;<span class="builtinfunc" id="5226033">len</span><span class="op" id="5226036">(</span><span class="ident" id="5226037">str</span><span class="op" id="5226040">)</span>&nbsp;<span class="op" id="5226042">&amp;&amp;</span>&nbsp;<span class="ident" id="5226045">same</span>&nbsp;<span class="op" id="5226050">&lt;</span>&nbsp;<span class="builtinfunc" id="5226052">len</span><span class="op" id="5226055">(</span><span class="ident" id="5226056">istr</span><span class="op" id="5226060">)</span>&nbsp;<span class="op" id="5226062">&amp;&amp;</span>&nbsp;<span class="ident" id="5226065">str</span><span class="op" id="5226068">[</span><span class="ident" id="5226069">same</span><span class="op" id="5226073">]</span>&nbsp;<span class="op" id="5226075">==</span>&nbsp;<span class="ident" id="5226078">istr</span><span class="op" id="5226082">[</span><span class="ident" id="5226083">same</span><span class="op" id="5226087">]</span>&nbsp;<span class="op" id="5226089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5226096">same</span><span class="op" id="5226100">++</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5226107">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5226113">if</span>&nbsp;<span class="ident" id="5226116">same</span>&nbsp;<span class="op" id="5226121">&gt;</span>&nbsp;<span class="num" id="5226123">0</span>&nbsp;<span class="op" id="5226125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5226132">//&nbsp;Matches&nbsp;at&nbsp;least&nbsp;one&nbsp;rune&nbsp;in&nbsp;current&nbsp;range.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5226184">//&nbsp;Keep&nbsp;going&nbsp;around.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5226211">str</span>&nbsp;<span class="op" id="5226215">=</span>&nbsp;<span class="ident" id="5226217">str</span><span class="op" id="5226220">[</span><span class="op" id="5226221">:</span><span class="ident" id="5226222">same</span><span class="op" id="5226226">]</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5226233">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5226246">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5226251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5226255">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5226260">//&nbsp;Found&nbsp;end&nbsp;of&nbsp;a&nbsp;run&nbsp;with&nbsp;common&nbsp;leading&nbsp;literal&nbsp;string:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5226320">//&nbsp;sub[start:i]&nbsp;all&nbsp;begin&nbsp;with&nbsp;str[0:len(str)],&nbsp;but&nbsp;sub[i]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5226381">//&nbsp;does&nbsp;not&nbsp;even&nbsp;begin&nbsp;with&nbsp;str[0].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5226419">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5226424">//&nbsp;Factor&nbsp;out&nbsp;common&nbsp;string&nbsp;and&nbsp;append&nbsp;factored&nbsp;expression&nbsp;to&nbsp;out.</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5226493">if</span>&nbsp;<span class="ident" id="5226496">i</span>&nbsp;<span class="op" id="5226498">==</span>&nbsp;<span class="ident" id="5226501">start</span>&nbsp;<span class="op" id="5226507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5226512">//&nbsp;Nothing&nbsp;to&nbsp;do&nbsp;-&nbsp;run&nbsp;of&nbsp;length&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5226550">}</span>&nbsp;<span class="keyword" id="5226552">else</span>&nbsp;<span class="keyword" id="5226557">if</span>&nbsp;<span class="ident" id="5226560">i</span>&nbsp;<span class="op" id="5226562">==</span>&nbsp;<span class="ident" id="5226565">start</span><span class="op" id="5226570">+</span><span class="num" id="5226571">1</span>&nbsp;<span class="op" id="5226573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5226578">//&nbsp;Just&nbsp;one:&nbsp;don&#39;t&nbsp;bother&nbsp;factoring.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5226618">out</span>&nbsp;<span class="op" id="5226622">=</span>&nbsp;<span class="builtinfunc" id="5226624">append</span><span class="op" id="5226630">(</span><span class="ident" id="5226631">out</span><span class="op" id="5226634">,</span>&nbsp;<span class="ident" id="5226636">sub</span><span class="op" id="5226639">[</span><span class="ident" id="5226640">start</span><span class="op" id="5226645">]</span><span class="op" id="5226646">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5226650">}</span>&nbsp;<span class="keyword" id="5226652">else</span>&nbsp;<span class="op" id="5226657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5226662">//&nbsp;Construct&nbsp;factored&nbsp;form:&nbsp;prefix(suffix1|suffix2|...)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5226721">prefix</span>&nbsp;<span class="op" id="5226728">:=</span>&nbsp;<span class="ident" id="5226731">p</span><span class="op" id="5226732">.</span><span class="ident" id="5226733">newRegexp</span><span class="op" id="5226742">(</span><span class="ident" id="5226743">OpLiteral</span><span class="op" id="5226752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5226757">prefix</span><span class="op" id="5226763">.</span><span class="ident" id="5226764">Flags</span>&nbsp;<span class="op" id="5226770">=</span>&nbsp;<span class="ident" id="5226772">strflags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5226784">prefix</span><span class="op" id="5226790">.</span><span class="ident" id="5226791">Rune</span>&nbsp;<span class="op" id="5226796">=</span>&nbsp;<span class="builtinfunc" id="5226798">append</span><span class="op" id="5226804">(</span><span class="ident" id="5226805">prefix</span><span class="op" id="5226811">.</span><span class="ident" id="5226812">Rune</span><span class="op" id="5226816">[</span><span class="op" id="5226817">:</span><span class="num" id="5226818">0</span><span class="op" id="5226819">]</span><span class="op" id="5226820">,</span>&nbsp;<span class="ident" id="5226822">str</span><span class="op" id="5226825">...</span><span class="op" id="5226828">)</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5226834">for</span>&nbsp;<span class="ident" id="5226838">j</span>&nbsp;<span class="op" id="5226840">:=</span>&nbsp;<span class="ident" id="5226843">start</span><span class="op" id="5226848">;</span>&nbsp;<span class="ident" id="5226850">j</span>&nbsp;<span class="op" id="5226852">&lt;</span>&nbsp;<span class="ident" id="5226854">i</span><span class="op" id="5226855">;</span>&nbsp;<span class="ident" id="5226857">j</span><span class="op" id="5226858">++</span>&nbsp;<span class="op" id="5226861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5226867">sub</span><span class="op" id="5226870">[</span><span class="ident" id="5226871">j</span><span class="op" id="5226872">]</span>&nbsp;<span class="op" id="5226874">=</span>&nbsp;<span class="ident" id="5226876">p</span><span class="op" id="5226877">.</span><span class="ident" id="5226878">removeLeadingString</span><span class="op" id="5226897">(</span><span class="ident" id="5226898">sub</span><span class="op" id="5226901">[</span><span class="ident" id="5226902">j</span><span class="op" id="5226903">]</span><span class="op" id="5226904">,</span>&nbsp;<span class="builtinfunc" id="5226906">len</span><span class="op" id="5226909">(</span><span class="ident" id="5226910">str</span><span class="op" id="5226913">)</span><span class="op" id="5226914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5226919">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5226924">suffix</span>&nbsp;<span class="op" id="5226931">:=</span>&nbsp;<span class="ident" id="5226934">p</span><span class="op" id="5226935">.</span><span class="ident" id="5226936">collapse</span><span class="op" id="5226944">(</span><span class="ident" id="5226945">sub</span><span class="op" id="5226948">[</span><span class="ident" id="5226949">start</span><span class="op" id="5226954">:</span><span class="ident" id="5226955">i</span><span class="op" id="5226956">]</span><span class="op" id="5226957">,</span>&nbsp;<span class="ident" id="5226959">OpAlternate</span><span class="op" id="5226970">)</span>&nbsp;<span class="comment" id="5226972">//&nbsp;recurse</span><br>
<span class="lineno">460</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5226987">re</span>&nbsp;<span class="op" id="5226990">:=</span>&nbsp;<span class="ident" id="5226993">p</span><span class="op" id="5226994">.</span><span class="ident" id="5226995">newRegexp</span><span class="op" id="5227004">(</span><span class="ident" id="5227005">OpConcat</span><span class="op" id="5227013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5227018">re</span><span class="op" id="5227020">.</span><span class="ident" id="5227021">Sub</span>&nbsp;<span class="op" id="5227025">=</span>&nbsp;<span class="builtinfunc" id="5227027">append</span><span class="op" id="5227033">(</span><span class="ident" id="5227034">re</span><span class="op" id="5227036">.</span><span class="ident" id="5227037">Sub</span><span class="op" id="5227040">[</span><span class="op" id="5227041">:</span><span class="num" id="5227042">0</span><span class="op" id="5227043">]</span><span class="op" id="5227044">,</span>&nbsp;<span class="ident" id="5227046">prefix</span><span class="op" id="5227052">,</span>&nbsp;<span class="ident" id="5227054">suffix</span><span class="op" id="5227060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5227065">out</span>&nbsp;<span class="op" id="5227069">=</span>&nbsp;<span class="builtinfunc" id="5227071">append</span><span class="op" id="5227077">(</span><span class="ident" id="5227078">out</span><span class="op" id="5227081">,</span>&nbsp;<span class="ident" id="5227083">re</span><span class="op" id="5227085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5227089">}</span><br>
<span class="lineno">465</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5227094">//&nbsp;Prepare&nbsp;for&nbsp;next&nbsp;iteration.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5227127">start</span>&nbsp;<span class="op" id="5227133">=</span>&nbsp;<span class="ident" id="5227135">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5227139">str</span>&nbsp;<span class="op" id="5227143">=</span>&nbsp;<span class="ident" id="5227145">istr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5227152">strflags</span>&nbsp;<span class="op" id="5227161">=</span>&nbsp;<span class="ident" id="5227163">iflags</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5227171">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5227174">sub</span>&nbsp;<span class="op" id="5227178">=</span>&nbsp;<span class="ident" id="5227180">out</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5227186">//&nbsp;Round&nbsp;2:&nbsp;Factor&nbsp;out&nbsp;common&nbsp;complex&nbsp;prefixes,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5227235">//&nbsp;just&nbsp;the&nbsp;first&nbsp;piece&nbsp;of&nbsp;each&nbsp;concatenation,</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5227283">//&nbsp;whatever&nbsp;it&nbsp;is.&nbsp;&nbsp;This&nbsp;is&nbsp;good&nbsp;enough&nbsp;a&nbsp;lot&nbsp;of&nbsp;the&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5227343">start</span>&nbsp;<span class="op" id="5227349">=</span>&nbsp;<span class="num" id="5227351">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5227354">out</span>&nbsp;<span class="op" id="5227358">=</span>&nbsp;<span class="ident" id="5227360">sub</span><span class="op" id="5227363">[</span><span class="op" id="5227364">:</span><span class="num" id="5227365">0</span><span class="op" id="5227366">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5227369">var</span>&nbsp;<span class="ident" id="5227373">first</span>&nbsp;<span class="op" id="5227379">*</span><span class="ident" id="5227380">Regexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5227388">for</span>&nbsp;<span class="ident" id="5227392">i</span>&nbsp;<span class="op" id="5227394">:=</span>&nbsp;<span class="num" id="5227397">0</span><span class="op" id="5227398">;</span>&nbsp;<span class="ident" id="5227400">i</span>&nbsp;<span class="op" id="5227402">&lt;=</span>&nbsp;<span class="builtinfunc" id="5227405">len</span><span class="op" id="5227408">(</span><span class="ident" id="5227409">sub</span><span class="op" id="5227412">)</span><span class="op" id="5227413">;</span>&nbsp;<span class="ident" id="5227415">i</span><span class="op" id="5227416">++</span>&nbsp;<span class="op" id="5227419">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5227423">//&nbsp;Invariant:&nbsp;the&nbsp;Regexps&nbsp;that&nbsp;were&nbsp;in&nbsp;sub[0:start]&nbsp;have&nbsp;been</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5227487">//&nbsp;used&nbsp;or&nbsp;marked&nbsp;for&nbsp;reuse,&nbsp;and&nbsp;the&nbsp;slice&nbsp;space&nbsp;has&nbsp;been&nbsp;reused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5227554">//&nbsp;for&nbsp;out&nbsp;(len(out)&nbsp;&lt;=&nbsp;start).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5227588">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5227593">//&nbsp;Invariant:&nbsp;sub[start:i]&nbsp;consists&nbsp;of&nbsp;regexps&nbsp;that&nbsp;all&nbsp;begin&nbsp;with&nbsp;ifirst.</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5227670">var</span>&nbsp;<span class="ident" id="5227674">ifirst</span>&nbsp;<span class="op" id="5227681">*</span><span class="ident" id="5227682">Regexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5227691">if</span>&nbsp;<span class="ident" id="5227694">i</span>&nbsp;<span class="op" id="5227696">&lt;</span>&nbsp;<span class="builtinfunc" id="5227698">len</span><span class="op" id="5227701">(</span><span class="ident" id="5227702">sub</span><span class="op" id="5227705">)</span>&nbsp;<span class="op" id="5227707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5227712">ifirst</span>&nbsp;<span class="op" id="5227719">=</span>&nbsp;<span class="ident" id="5227721">p</span><span class="op" id="5227722">.</span><span class="ident" id="5227723">leadingRegexp</span><span class="op" id="5227736">(</span><span class="ident" id="5227737">sub</span><span class="op" id="5227740">[</span><span class="ident" id="5227741">i</span><span class="op" id="5227742">]</span><span class="op" id="5227743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5227748">if</span>&nbsp;<span class="ident" id="5227751">first</span>&nbsp;<span class="op" id="5227757">!=</span>&nbsp;<span class="builtintype" id="5227760">nil</span>&nbsp;<span class="op" id="5227764">&amp;&amp;</span>&nbsp;<span class="ident" id="5227767">first</span><span class="op" id="5227772">.</span><span class="ident" id="5227773">Equal</span><span class="op" id="5227778">(</span><span class="ident" id="5227779">ifirst</span><span class="op" id="5227785">)</span>&nbsp;<span class="op" id="5227787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5227793">continue</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5227805">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5227809">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5227814">//&nbsp;Found&nbsp;end&nbsp;of&nbsp;a&nbsp;run&nbsp;with&nbsp;common&nbsp;leading&nbsp;regexp:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5227866">//&nbsp;sub[start:i]&nbsp;all&nbsp;begin&nbsp;with&nbsp;first&nbsp;but&nbsp;sub[i]&nbsp;does&nbsp;not.</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5227926">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5227931">//&nbsp;Factor&nbsp;out&nbsp;common&nbsp;regexp&nbsp;and&nbsp;append&nbsp;factored&nbsp;expression&nbsp;to&nbsp;out.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5228000">if</span>&nbsp;<span class="ident" id="5228003">i</span>&nbsp;<span class="op" id="5228005">==</span>&nbsp;<span class="ident" id="5228008">start</span>&nbsp;<span class="op" id="5228014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5228019">//&nbsp;Nothing&nbsp;to&nbsp;do&nbsp;-&nbsp;run&nbsp;of&nbsp;length&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5228057">}</span>&nbsp;<span class="keyword" id="5228059">else</span>&nbsp;<span class="keyword" id="5228064">if</span>&nbsp;<span class="ident" id="5228067">i</span>&nbsp;<span class="op" id="5228069">==</span>&nbsp;<span class="ident" id="5228072">start</span><span class="op" id="5228077">+</span><span class="num" id="5228078">1</span>&nbsp;<span class="op" id="5228080">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5228085">//&nbsp;Just&nbsp;one:&nbsp;don&#39;t&nbsp;bother&nbsp;factoring.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5228125">out</span>&nbsp;<span class="op" id="5228129">=</span>&nbsp;<span class="builtinfunc" id="5228131">append</span><span class="op" id="5228137">(</span><span class="ident" id="5228138">out</span><span class="op" id="5228141">,</span>&nbsp;<span class="ident" id="5228143">sub</span><span class="op" id="5228146">[</span><span class="ident" id="5228147">start</span><span class="op" id="5228152">]</span><span class="op" id="5228153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5228157">}</span>&nbsp;<span class="keyword" id="5228159">else</span>&nbsp;<span class="op" id="5228164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5228169">//&nbsp;Construct&nbsp;factored&nbsp;form:&nbsp;prefix(suffix1|suffix2|...)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5228228">prefix</span>&nbsp;<span class="op" id="5228235">:=</span>&nbsp;<span class="ident" id="5228238">first</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5228247">for</span>&nbsp;<span class="ident" id="5228251">j</span>&nbsp;<span class="op" id="5228253">:=</span>&nbsp;<span class="ident" id="5228256">start</span><span class="op" id="5228261">;</span>&nbsp;<span class="ident" id="5228263">j</span>&nbsp;<span class="op" id="5228265">&lt;</span>&nbsp;<span class="ident" id="5228267">i</span><span class="op" id="5228268">;</span>&nbsp;<span class="ident" id="5228270">j</span><span class="op" id="5228271">++</span>&nbsp;<span class="op" id="5228274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5228280">reuse</span>&nbsp;<span class="op" id="5228286">:=</span>&nbsp;<span class="ident" id="5228289">j</span>&nbsp;<span class="op" id="5228291">!=</span>&nbsp;<span class="ident" id="5228294">start</span>&nbsp;<span class="comment" id="5228300">//&nbsp;prefix&nbsp;came&nbsp;from&nbsp;sub[start]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5228335">sub</span><span class="op" id="5228338">[</span><span class="ident" id="5228339">j</span><span class="op" id="5228340">]</span>&nbsp;<span class="op" id="5228342">=</span>&nbsp;<span class="ident" id="5228344">p</span><span class="op" id="5228345">.</span><span class="ident" id="5228346">removeLeadingRegexp</span><span class="op" id="5228365">(</span><span class="ident" id="5228366">sub</span><span class="op" id="5228369">[</span><span class="ident" id="5228370">j</span><span class="op" id="5228371">]</span><span class="op" id="5228372">,</span>&nbsp;<span class="ident" id="5228374">reuse</span><span class="op" id="5228379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5228384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5228389">suffix</span>&nbsp;<span class="op" id="5228396">:=</span>&nbsp;<span class="ident" id="5228399">p</span><span class="op" id="5228400">.</span><span class="ident" id="5228401">collapse</span><span class="op" id="5228409">(</span><span class="ident" id="5228410">sub</span><span class="op" id="5228413">[</span><span class="ident" id="5228414">start</span><span class="op" id="5228419">:</span><span class="ident" id="5228420">i</span><span class="op" id="5228421">]</span><span class="op" id="5228422">,</span>&nbsp;<span class="ident" id="5228424">OpAlternate</span><span class="op" id="5228435">)</span>&nbsp;<span class="comment" id="5228437">//&nbsp;recurse</span><br>
<span class="lineno">510</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5228452">re</span>&nbsp;<span class="op" id="5228455">:=</span>&nbsp;<span class="ident" id="5228458">p</span><span class="op" id="5228459">.</span><span class="ident" id="5228460">newRegexp</span><span class="op" id="5228469">(</span><span class="ident" id="5228470">OpConcat</span><span class="op" id="5228478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5228483">re</span><span class="op" id="5228485">.</span><span class="ident" id="5228486">Sub</span>&nbsp;<span class="op" id="5228490">=</span>&nbsp;<span class="builtinfunc" id="5228492">append</span><span class="op" id="5228498">(</span><span class="ident" id="5228499">re</span><span class="op" id="5228501">.</span><span class="ident" id="5228502">Sub</span><span class="op" id="5228505">[</span><span class="op" id="5228506">:</span><span class="num" id="5228507">0</span><span class="op" id="5228508">]</span><span class="op" id="5228509">,</span>&nbsp;<span class="ident" id="5228511">prefix</span><span class="op" id="5228517">,</span>&nbsp;<span class="ident" id="5228519">suffix</span><span class="op" id="5228525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5228530">out</span>&nbsp;<span class="op" id="5228534">=</span>&nbsp;<span class="builtinfunc" id="5228536">append</span><span class="op" id="5228542">(</span><span class="ident" id="5228543">out</span><span class="op" id="5228546">,</span>&nbsp;<span class="ident" id="5228548">re</span><span class="op" id="5228550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5228554">}</span><br>
<span class="lineno">515</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5228559">//&nbsp;Prepare&nbsp;for&nbsp;next&nbsp;iteration.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5228592">start</span>&nbsp;<span class="op" id="5228598">=</span>&nbsp;<span class="ident" id="5228600">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5228604">first</span>&nbsp;<span class="op" id="5228610">=</span>&nbsp;<span class="ident" id="5228612">ifirst</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5228620">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5228623">sub</span>&nbsp;<span class="op" id="5228627">=</span>&nbsp;<span class="ident" id="5228629">out</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5228635">//&nbsp;Round&nbsp;3:&nbsp;Collapse&nbsp;runs&nbsp;of&nbsp;single&nbsp;literals&nbsp;into&nbsp;character&nbsp;classes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5228705">start</span>&nbsp;<span class="op" id="5228711">=</span>&nbsp;<span class="num" id="5228713">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5228716">out</span>&nbsp;<span class="op" id="5228720">=</span>&nbsp;<span class="ident" id="5228722">sub</span><span class="op" id="5228725">[</span><span class="op" id="5228726">:</span><span class="num" id="5228727">0</span><span class="op" id="5228728">]</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5228731">for</span>&nbsp;<span class="ident" id="5228735">i</span>&nbsp;<span class="op" id="5228737">:=</span>&nbsp;<span class="num" id="5228740">0</span><span class="op" id="5228741">;</span>&nbsp;<span class="ident" id="5228743">i</span>&nbsp;<span class="op" id="5228745">&lt;=</span>&nbsp;<span class="builtinfunc" id="5228748">len</span><span class="op" id="5228751">(</span><span class="ident" id="5228752">sub</span><span class="op" id="5228755">)</span><span class="op" id="5228756">;</span>&nbsp;<span class="ident" id="5228758">i</span><span class="op" id="5228759">++</span>&nbsp;<span class="op" id="5228762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5228766">//&nbsp;Invariant:&nbsp;the&nbsp;Regexps&nbsp;that&nbsp;were&nbsp;in&nbsp;sub[0:start]&nbsp;have&nbsp;been</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5228830">//&nbsp;used&nbsp;or&nbsp;marked&nbsp;for&nbsp;reuse,&nbsp;and&nbsp;the&nbsp;slice&nbsp;space&nbsp;has&nbsp;been&nbsp;reused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5228897">//&nbsp;for&nbsp;out&nbsp;(len(out)&nbsp;&lt;=&nbsp;start).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5228931">//</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5228936">//&nbsp;Invariant:&nbsp;sub[start:i]&nbsp;consists&nbsp;of&nbsp;regexps&nbsp;that&nbsp;are&nbsp;either</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5229001">//&nbsp;literal&nbsp;runes&nbsp;or&nbsp;character&nbsp;classes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5229042">if</span>&nbsp;<span class="ident" id="5229045">i</span>&nbsp;<span class="op" id="5229047">&lt;</span>&nbsp;<span class="builtinfunc" id="5229049">len</span><span class="op" id="5229052">(</span><span class="ident" id="5229053">sub</span><span class="op" id="5229056">)</span>&nbsp;<span class="op" id="5229058">&amp;&amp;</span>&nbsp;<span class="ident" id="5229061">isCharClass</span><span class="op" id="5229072">(</span><span class="ident" id="5229073">sub</span><span class="op" id="5229076">[</span><span class="ident" id="5229077">i</span><span class="op" id="5229078">]</span><span class="op" id="5229079">)</span>&nbsp;<span class="op" id="5229081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5229086">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5229097">}</span><br>
<span class="lineno">535</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5229102">//&nbsp;sub[i]&nbsp;is&nbsp;not&nbsp;a&nbsp;char&nbsp;or&nbsp;char&nbsp;class;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5229143">//&nbsp;emit&nbsp;char&nbsp;class&nbsp;for&nbsp;sub[start:i]...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5229184">if</span>&nbsp;<span class="ident" id="5229187">i</span>&nbsp;<span class="op" id="5229189">==</span>&nbsp;<span class="ident" id="5229192">start</span>&nbsp;<span class="op" id="5229198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5229203">//&nbsp;Nothing&nbsp;to&nbsp;do&nbsp;-&nbsp;run&nbsp;of&nbsp;length&nbsp;0.</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5229241">}</span>&nbsp;<span class="keyword" id="5229243">else</span>&nbsp;<span class="keyword" id="5229248">if</span>&nbsp;<span class="ident" id="5229251">i</span>&nbsp;<span class="op" id="5229253">==</span>&nbsp;<span class="ident" id="5229256">start</span><span class="op" id="5229261">+</span><span class="num" id="5229262">1</span>&nbsp;<span class="op" id="5229264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5229269">out</span>&nbsp;<span class="op" id="5229273">=</span>&nbsp;<span class="builtinfunc" id="5229275">append</span><span class="op" id="5229281">(</span><span class="ident" id="5229282">out</span><span class="op" id="5229285">,</span>&nbsp;<span class="ident" id="5229287">sub</span><span class="op" id="5229290">[</span><span class="ident" id="5229291">start</span><span class="op" id="5229296">]</span><span class="op" id="5229297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5229301">}</span>&nbsp;<span class="keyword" id="5229303">else</span>&nbsp;<span class="op" id="5229308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5229313">//&nbsp;Make&nbsp;new&nbsp;char&nbsp;class.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5229340">//&nbsp;Start&nbsp;with&nbsp;most&nbsp;complex&nbsp;regexp&nbsp;in&nbsp;sub[start].</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5229392">max</span>&nbsp;<span class="op" id="5229396">:=</span>&nbsp;<span class="ident" id="5229399">start</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5229408">for</span>&nbsp;<span class="ident" id="5229412">j</span>&nbsp;<span class="op" id="5229414">:=</span>&nbsp;<span class="ident" id="5229417">start</span>&nbsp;<span class="op" id="5229423">+</span>&nbsp;<span class="num" id="5229425">1</span><span class="op" id="5229426">;</span>&nbsp;<span class="ident" id="5229428">j</span>&nbsp;<span class="op" id="5229430">&lt;</span>&nbsp;<span class="ident" id="5229432">i</span><span class="op" id="5229433">;</span>&nbsp;<span class="ident" id="5229435">j</span><span class="op" id="5229436">++</span>&nbsp;<span class="op" id="5229439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5229445">if</span>&nbsp;<span class="ident" id="5229448">sub</span><span class="op" id="5229451">[</span><span class="ident" id="5229452">max</span><span class="op" id="5229455">]</span><span class="op" id="5229456">.</span><span class="ident" id="5229457">Op</span>&nbsp;<span class="op" id="5229460">&lt;</span>&nbsp;<span class="ident" id="5229462">sub</span><span class="op" id="5229465">[</span><span class="ident" id="5229466">j</span><span class="op" id="5229467">]</span><span class="op" id="5229468">.</span><span class="ident" id="5229469">Op</span>&nbsp;<span class="op" id="5229472">||</span>&nbsp;<span class="ident" id="5229475">sub</span><span class="op" id="5229478">[</span><span class="ident" id="5229479">max</span><span class="op" id="5229482">]</span><span class="op" id="5229483">.</span><span class="ident" id="5229484">Op</span>&nbsp;<span class="op" id="5229487">==</span>&nbsp;<span class="ident" id="5229490">sub</span><span class="op" id="5229493">[</span><span class="ident" id="5229494">j</span><span class="op" id="5229495">]</span><span class="op" id="5229496">.</span><span class="ident" id="5229497">Op</span>&nbsp;<span class="op" id="5229500">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5229503">len</span><span class="op" id="5229506">(</span><span class="ident" id="5229507">sub</span><span class="op" id="5229510">[</span><span class="ident" id="5229511">max</span><span class="op" id="5229514">]</span><span class="op" id="5229515">.</span><span class="ident" id="5229516">Rune</span><span class="op" id="5229520">)</span>&nbsp;<span class="op" id="5229522">&lt;</span>&nbsp;<span class="builtinfunc" id="5229524">len</span><span class="op" id="5229527">(</span><span class="ident" id="5229528">sub</span><span class="op" id="5229531">[</span><span class="ident" id="5229532">j</span><span class="op" id="5229533">]</span><span class="op" id="5229534">.</span><span class="ident" id="5229535">Rune</span><span class="op" id="5229539">)</span>&nbsp;<span class="op" id="5229541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5229548">max</span>&nbsp;<span class="op" id="5229552">=</span>&nbsp;<span class="ident" id="5229554">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5229560">}</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5229565">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5229570">sub</span><span class="op" id="5229573">[</span><span class="ident" id="5229574">start</span><span class="op" id="5229579">]</span><span class="op" id="5229580">,</span>&nbsp;<span class="ident" id="5229582">sub</span><span class="op" id="5229585">[</span><span class="ident" id="5229586">max</span><span class="op" id="5229589">]</span>&nbsp;<span class="op" id="5229591">=</span>&nbsp;<span class="ident" id="5229593">sub</span><span class="op" id="5229596">[</span><span class="ident" id="5229597">max</span><span class="op" id="5229600">]</span><span class="op" id="5229601">,</span>&nbsp;<span class="ident" id="5229603">sub</span><span class="op" id="5229606">[</span><span class="ident" id="5229607">start</span><span class="op" id="5229612">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5229618">for</span>&nbsp;<span class="ident" id="5229622">j</span>&nbsp;<span class="op" id="5229624">:=</span>&nbsp;<span class="ident" id="5229627">start</span>&nbsp;<span class="op" id="5229633">+</span>&nbsp;<span class="num" id="5229635">1</span><span class="op" id="5229636">;</span>&nbsp;<span class="ident" id="5229638">j</span>&nbsp;<span class="op" id="5229640">&lt;</span>&nbsp;<span class="ident" id="5229642">i</span><span class="op" id="5229643">;</span>&nbsp;<span class="ident" id="5229645">j</span><span class="op" id="5229646">++</span>&nbsp;<span class="op" id="5229649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5229655">mergeCharClass</span><span class="op" id="5229669">(</span><span class="ident" id="5229670">sub</span><span class="op" id="5229673">[</span><span class="ident" id="5229674">start</span><span class="op" id="5229679">]</span><span class="op" id="5229680">,</span>&nbsp;<span class="ident" id="5229682">sub</span><span class="op" id="5229685">[</span><span class="ident" id="5229686">j</span><span class="op" id="5229687">]</span><span class="op" id="5229688">)</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5229694">p</span><span class="op" id="5229695">.</span><span class="ident" id="5229696">reuse</span><span class="op" id="5229701">(</span><span class="ident" id="5229702">sub</span><span class="op" id="5229705">[</span><span class="ident" id="5229706">j</span><span class="op" id="5229707">]</span><span class="op" id="5229708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5229713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5229718">cleanAlt</span><span class="op" id="5229726">(</span><span class="ident" id="5229727">sub</span><span class="op" id="5229730">[</span><span class="ident" id="5229731">start</span><span class="op" id="5229736">]</span><span class="op" id="5229737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5229742">out</span>&nbsp;<span class="op" id="5229746">=</span>&nbsp;<span class="builtinfunc" id="5229748">append</span><span class="op" id="5229754">(</span><span class="ident" id="5229755">out</span><span class="op" id="5229758">,</span>&nbsp;<span class="ident" id="5229760">sub</span><span class="op" id="5229763">[</span><span class="ident" id="5229764">start</span><span class="op" id="5229769">]</span><span class="op" id="5229770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5229774">}</span><br>
<span class="lineno">560</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5229779">//&nbsp;...&nbsp;and&nbsp;then&nbsp;emit&nbsp;sub[i].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5229810">if</span>&nbsp;<span class="ident" id="5229813">i</span>&nbsp;<span class="op" id="5229815">&lt;</span>&nbsp;<span class="builtinfunc" id="5229817">len</span><span class="op" id="5229820">(</span><span class="ident" id="5229821">sub</span><span class="op" id="5229824">)</span>&nbsp;<span class="op" id="5229826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5229831">out</span>&nbsp;<span class="op" id="5229835">=</span>&nbsp;<span class="builtinfunc" id="5229837">append</span><span class="op" id="5229843">(</span><span class="ident" id="5229844">out</span><span class="op" id="5229847">,</span>&nbsp;<span class="ident" id="5229849">sub</span><span class="op" id="5229852">[</span><span class="ident" id="5229853">i</span><span class="op" id="5229854">]</span><span class="op" id="5229855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5229859">}</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5229863">start</span>&nbsp;<span class="op" id="5229869">=</span>&nbsp;<span class="ident" id="5229871">i</span>&nbsp;<span class="op" id="5229873">+</span>&nbsp;<span class="num" id="5229875">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5229878">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5229881">sub</span>&nbsp;<span class="op" id="5229885">=</span>&nbsp;<span class="ident" id="5229887">out</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5229893">//&nbsp;Round&nbsp;4:&nbsp;Collapse&nbsp;runs&nbsp;of&nbsp;empty&nbsp;matches&nbsp;into&nbsp;a&nbsp;single&nbsp;empty&nbsp;match.</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5229964">start</span>&nbsp;<span class="op" id="5229970">=</span>&nbsp;<span class="num" id="5229972">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5229975">out</span>&nbsp;<span class="op" id="5229979">=</span>&nbsp;<span class="ident" id="5229981">sub</span><span class="op" id="5229984">[</span><span class="op" id="5229985">:</span><span class="num" id="5229986">0</span><span class="op" id="5229987">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5229990">for</span>&nbsp;<span class="ident" id="5229994">i</span>&nbsp;<span class="op" id="5229996">:=</span>&nbsp;<span class="keyword" id="5229999">range</span>&nbsp;<span class="ident" id="5230005">sub</span>&nbsp;<span class="op" id="5230009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5230013">if</span>&nbsp;<span class="ident" id="5230016">i</span><span class="op" id="5230017">+</span><span class="num" id="5230018">1</span>&nbsp;<span class="op" id="5230020">&lt;</span>&nbsp;<span class="builtinfunc" id="5230022">len</span><span class="op" id="5230025">(</span><span class="ident" id="5230026">sub</span><span class="op" id="5230029">)</span>&nbsp;<span class="op" id="5230031">&amp;&amp;</span>&nbsp;<span class="ident" id="5230034">sub</span><span class="op" id="5230037">[</span><span class="ident" id="5230038">i</span><span class="op" id="5230039">]</span><span class="op" id="5230040">.</span><span class="ident" id="5230041">Op</span>&nbsp;<span class="op" id="5230044">==</span>&nbsp;<span class="ident" id="5230047">OpEmptyMatch</span>&nbsp;<span class="op" id="5230060">&amp;&amp;</span>&nbsp;<span class="ident" id="5230063">sub</span><span class="op" id="5230066">[</span><span class="ident" id="5230067">i</span><span class="op" id="5230068">+</span><span class="num" id="5230069">1</span><span class="op" id="5230070">]</span><span class="op" id="5230071">.</span><span class="ident" id="5230072">Op</span>&nbsp;<span class="op" id="5230075">==</span>&nbsp;<span class="ident" id="5230078">OpEmptyMatch</span>&nbsp;<span class="op" id="5230091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5230096">continue</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5230107">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5230111">out</span>&nbsp;<span class="op" id="5230115">=</span>&nbsp;<span class="builtinfunc" id="5230117">append</span><span class="op" id="5230123">(</span><span class="ident" id="5230124">out</span><span class="op" id="5230127">,</span>&nbsp;<span class="ident" id="5230129">sub</span><span class="op" id="5230132">[</span><span class="ident" id="5230133">i</span><span class="op" id="5230134">]</span><span class="op" id="5230135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5230138">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5230141">sub</span>&nbsp;<span class="op" id="5230145">=</span>&nbsp;<span class="ident" id="5230147">out</span><br>
<span class="lineno"></span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5230153">return</span>&nbsp;<span class="ident" id="5230160">sub</span><br>
<span class="lineno"></span><span class="op" id="5230164">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5230167">//&nbsp;leadingString&nbsp;returns&nbsp;the&nbsp;leading&nbsp;literal&nbsp;string&nbsp;that&nbsp;re&nbsp;begins&nbsp;with.</span><br>
<span class="lineno"></span><span class="comment" id="5230240">//&nbsp;The&nbsp;string&nbsp;refers&nbsp;to&nbsp;storage&nbsp;in&nbsp;re&nbsp;or&nbsp;its&nbsp;children.</span><br>
<span class="lineno">585</span><span class="keyword" id="5230295">func</span>&nbsp;<span class="op" id="5230300">(</span><span class="ident" id="5230301">p</span>&nbsp;<span class="op" id="5230303">*</span><span class="ident" id="5230304">parser</span><span class="op" id="5230310">)</span>&nbsp;<span class="ident" id="5230312">leadingString</span><span class="op" id="5230325">(</span><span class="ident" id="5230326">re</span>&nbsp;<span class="op" id="5230329">*</span><span class="ident" id="5230330">Regexp</span><span class="op" id="5230336">)</span>&nbsp;<span class="op" id="5230338">(</span><span class="op" id="5230339">[</span><span class="op" id="5230340">]</span><span class="builtintype" id="5230341">rune</span><span class="op" id="5230345">,</span>&nbsp;<span class="ident" id="5230347">Flags</span><span class="op" id="5230352">)</span>&nbsp;<span class="op" id="5230354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5230357">if</span>&nbsp;<span class="ident" id="5230360">re</span><span class="op" id="5230362">.</span><span class="ident" id="5230363">Op</span>&nbsp;<span class="op" id="5230366">==</span>&nbsp;<span class="ident" id="5230369">OpConcat</span>&nbsp;<span class="op" id="5230378">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5230381">len</span><span class="op" id="5230384">(</span><span class="ident" id="5230385">re</span><span class="op" id="5230387">.</span><span class="ident" id="5230388">Sub</span><span class="op" id="5230391">)</span>&nbsp;<span class="op" id="5230393">&gt;</span>&nbsp;<span class="num" id="5230395">0</span>&nbsp;<span class="op" id="5230397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5230401">re</span>&nbsp;<span class="op" id="5230404">=</span>&nbsp;<span class="ident" id="5230406">re</span><span class="op" id="5230408">.</span><span class="ident" id="5230409">Sub</span><span class="op" id="5230412">[</span><span class="num" id="5230413">0</span><span class="op" id="5230414">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5230417">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5230420">if</span>&nbsp;<span class="ident" id="5230423">re</span><span class="op" id="5230425">.</span><span class="ident" id="5230426">Op</span>&nbsp;<span class="op" id="5230429">!=</span>&nbsp;<span class="ident" id="5230432">OpLiteral</span>&nbsp;<span class="op" id="5230442">{</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5230446">return</span>&nbsp;<span class="builtintype" id="5230453">nil</span><span class="op" id="5230456">,</span>&nbsp;<span class="num" id="5230458">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5230461">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5230464">return</span>&nbsp;<span class="ident" id="5230471">re</span><span class="op" id="5230473">.</span><span class="ident" id="5230474">Rune</span><span class="op" id="5230478">,</span>&nbsp;<span class="ident" id="5230480">re</span><span class="op" id="5230482">.</span><span class="ident" id="5230483">Flags</span>&nbsp;<span class="op" id="5230489">&amp;</span>&nbsp;<span class="ident" id="5230491">FoldCase</span><br>
<span class="lineno"></span><span class="op" id="5230500">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">595</span><span class="comment" id="5230503">//&nbsp;removeLeadingString&nbsp;removes&nbsp;the&nbsp;first&nbsp;n&nbsp;leading&nbsp;runes</span><br>
<span class="lineno"></span><span class="comment" id="5230560">//&nbsp;from&nbsp;the&nbsp;beginning&nbsp;of&nbsp;re.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;replacement&nbsp;for&nbsp;re.</span><br>
<span class="lineno"></span><span class="keyword" id="5230625">func</span>&nbsp;<span class="op" id="5230630">(</span><span class="ident" id="5230631">p</span>&nbsp;<span class="op" id="5230633">*</span><span class="ident" id="5230634">parser</span><span class="op" id="5230640">)</span>&nbsp;<span class="ident" id="5230642">removeLeadingString</span><span class="op" id="5230661">(</span><span class="ident" id="5230662">re</span>&nbsp;<span class="op" id="5230665">*</span><span class="ident" id="5230666">Regexp</span><span class="op" id="5230672">,</span>&nbsp;<span class="ident" id="5230674">n</span>&nbsp;<span class="builtintype" id="5230676">int</span><span class="op" id="5230679">)</span>&nbsp;<span class="op" id="5230681">*</span><span class="ident" id="5230682">Regexp</span>&nbsp;<span class="op" id="5230689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5230692">if</span>&nbsp;<span class="ident" id="5230695">re</span><span class="op" id="5230697">.</span><span class="ident" id="5230698">Op</span>&nbsp;<span class="op" id="5230701">==</span>&nbsp;<span class="ident" id="5230704">OpConcat</span>&nbsp;<span class="op" id="5230713">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5230716">len</span><span class="op" id="5230719">(</span><span class="ident" id="5230720">re</span><span class="op" id="5230722">.</span><span class="ident" id="5230723">Sub</span><span class="op" id="5230726">)</span>&nbsp;<span class="op" id="5230728">&gt;</span>&nbsp;<span class="num" id="5230730">0</span>&nbsp;<span class="op" id="5230732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5230736">//&nbsp;Removing&nbsp;a&nbsp;leading&nbsp;string&nbsp;in&nbsp;a&nbsp;concatenation</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5230786">//&nbsp;might&nbsp;simplify&nbsp;the&nbsp;concatenation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5230825">sub</span>&nbsp;<span class="op" id="5230829">:=</span>&nbsp;<span class="ident" id="5230832">re</span><span class="op" id="5230834">.</span><span class="ident" id="5230835">Sub</span><span class="op" id="5230838">[</span><span class="num" id="5230839">0</span><span class="op" id="5230840">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5230844">sub</span>&nbsp;<span class="op" id="5230848">=</span>&nbsp;<span class="ident" id="5230850">p</span><span class="op" id="5230851">.</span><span class="ident" id="5230852">removeLeadingString</span><span class="op" id="5230871">(</span><span class="ident" id="5230872">sub</span><span class="op" id="5230875">,</span>&nbsp;<span class="ident" id="5230877">n</span><span class="op" id="5230878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5230882">re</span><span class="op" id="5230884">.</span><span class="ident" id="5230885">Sub</span><span class="op" id="5230888">[</span><span class="num" id="5230889">0</span><span class="op" id="5230890">]</span>&nbsp;<span class="op" id="5230892">=</span>&nbsp;<span class="ident" id="5230894">sub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5230900">if</span>&nbsp;<span class="ident" id="5230903">sub</span><span class="op" id="5230906">.</span><span class="ident" id="5230907">Op</span>&nbsp;<span class="op" id="5230910">==</span>&nbsp;<span class="ident" id="5230913">OpEmptyMatch</span>&nbsp;<span class="op" id="5230926">{</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5230931">p</span><span class="op" id="5230932">.</span><span class="ident" id="5230933">reuse</span><span class="op" id="5230938">(</span><span class="ident" id="5230939">sub</span><span class="op" id="5230942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5230947">switch</span>&nbsp;<span class="builtinfunc" id="5230954">len</span><span class="op" id="5230957">(</span><span class="ident" id="5230958">re</span><span class="op" id="5230960">.</span><span class="ident" id="5230961">Sub</span><span class="op" id="5230964">)</span>&nbsp;<span class="op" id="5230966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5230971">case</span>&nbsp;<span class="num" id="5230976">0</span><span class="op" id="5230977">,</span>&nbsp;<span class="num" id="5230979">1</span><span class="op" id="5230980">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5230986">//&nbsp;Impossible&nbsp;but&nbsp;handle.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5231016">re</span><span class="op" id="5231018">.</span><span class="ident" id="5231019">Op</span>&nbsp;<span class="op" id="5231022">=</span>&nbsp;<span class="ident" id="5231024">OpEmptyMatch</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5231041">re</span><span class="op" id="5231043">.</span><span class="ident" id="5231044">Sub</span>&nbsp;<span class="op" id="5231048">=</span>&nbsp;<span class="builtintype" id="5231050">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5231057">case</span>&nbsp;<span class="num" id="5231062">2</span><span class="op" id="5231063">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5231069">old</span>&nbsp;<span class="op" id="5231073">:=</span>&nbsp;<span class="ident" id="5231076">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5231083">re</span>&nbsp;<span class="op" id="5231086">=</span>&nbsp;<span class="ident" id="5231088">re</span><span class="op" id="5231090">.</span><span class="ident" id="5231091">Sub</span><span class="op" id="5231094">[</span><span class="num" id="5231095">1</span><span class="op" id="5231096">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5231102">p</span><span class="op" id="5231103">.</span><span class="ident" id="5231104">reuse</span><span class="op" id="5231109">(</span><span class="ident" id="5231110">old</span><span class="op" id="5231113">)</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5231118">default</span><span class="op" id="5231125">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5231131">copy</span><span class="op" id="5231135">(</span><span class="ident" id="5231136">re</span><span class="op" id="5231138">.</span><span class="ident" id="5231139">Sub</span><span class="op" id="5231142">,</span>&nbsp;<span class="ident" id="5231144">re</span><span class="op" id="5231146">.</span><span class="ident" id="5231147">Sub</span><span class="op" id="5231150">[</span><span class="num" id="5231151">1</span><span class="op" id="5231152">:</span><span class="op" id="5231153">]</span><span class="op" id="5231154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5231160">re</span><span class="op" id="5231162">.</span><span class="ident" id="5231163">Sub</span>&nbsp;<span class="op" id="5231167">=</span>&nbsp;<span class="ident" id="5231169">re</span><span class="op" id="5231171">.</span><span class="ident" id="5231172">Sub</span><span class="op" id="5231175">[</span><span class="op" id="5231176">:</span><span class="builtinfunc" id="5231177">len</span><span class="op" id="5231180">(</span><span class="ident" id="5231181">re</span><span class="op" id="5231183">.</span><span class="ident" id="5231184">Sub</span><span class="op" id="5231187">)</span><span class="op" id="5231188">-</span><span class="num" id="5231189">1</span><span class="op" id="5231190">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5231195">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5231199">}</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5231203">return</span>&nbsp;<span class="ident" id="5231210">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5231214">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5231218">if</span>&nbsp;<span class="ident" id="5231221">re</span><span class="op" id="5231223">.</span><span class="ident" id="5231224">Op</span>&nbsp;<span class="op" id="5231227">==</span>&nbsp;<span class="ident" id="5231230">OpLiteral</span>&nbsp;<span class="op" id="5231240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5231244">re</span><span class="op" id="5231246">.</span><span class="ident" id="5231247">Rune</span>&nbsp;<span class="op" id="5231252">=</span>&nbsp;<span class="ident" id="5231254">re</span><span class="op" id="5231256">.</span><span class="ident" id="5231257">Rune</span><span class="op" id="5231261">[</span><span class="op" id="5231262">:</span><span class="builtinfunc" id="5231263">copy</span><span class="op" id="5231267">(</span><span class="ident" id="5231268">re</span><span class="op" id="5231270">.</span><span class="ident" id="5231271">Rune</span><span class="op" id="5231275">,</span>&nbsp;<span class="ident" id="5231277">re</span><span class="op" id="5231279">.</span><span class="ident" id="5231280">Rune</span><span class="op" id="5231284">[</span><span class="ident" id="5231285">n</span><span class="op" id="5231286">:</span><span class="op" id="5231287">]</span><span class="op" id="5231288">)</span><span class="op" id="5231289">]</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5231293">if</span>&nbsp;<span class="builtinfunc" id="5231296">len</span><span class="op" id="5231299">(</span><span class="ident" id="5231300">re</span><span class="op" id="5231302">.</span><span class="ident" id="5231303">Rune</span><span class="op" id="5231307">)</span>&nbsp;<span class="op" id="5231309">==</span>&nbsp;<span class="num" id="5231312">0</span>&nbsp;<span class="op" id="5231314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5231319">re</span><span class="op" id="5231321">.</span><span class="ident" id="5231322">Op</span>&nbsp;<span class="op" id="5231325">=</span>&nbsp;<span class="ident" id="5231327">OpEmptyMatch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5231342">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5231345">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5231348">return</span>&nbsp;<span class="ident" id="5231355">re</span><br>
<span class="lineno">630</span><span class="op" id="5231358">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5231361">//&nbsp;leadingRegexp&nbsp;returns&nbsp;the&nbsp;leading&nbsp;regexp&nbsp;that&nbsp;re&nbsp;begins&nbsp;with.</span><br>
<span class="lineno"></span><span class="comment" id="5231426">//&nbsp;The&nbsp;regexp&nbsp;refers&nbsp;to&nbsp;storage&nbsp;in&nbsp;re&nbsp;or&nbsp;its&nbsp;children.</span><br>
<span class="lineno"></span><span class="keyword" id="5231481">func</span>&nbsp;<span class="op" id="5231486">(</span><span class="ident" id="5231487">p</span>&nbsp;<span class="op" id="5231489">*</span><span class="ident" id="5231490">parser</span><span class="op" id="5231496">)</span>&nbsp;<span class="ident" id="5231498">leadingRegexp</span><span class="op" id="5231511">(</span><span class="ident" id="5231512">re</span>&nbsp;<span class="op" id="5231515">*</span><span class="ident" id="5231516">Regexp</span><span class="op" id="5231522">)</span>&nbsp;<span class="op" id="5231524">*</span><span class="ident" id="5231525">Regexp</span>&nbsp;<span class="op" id="5231532">{</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5231535">if</span>&nbsp;<span class="ident" id="5231538">re</span><span class="op" id="5231540">.</span><span class="ident" id="5231541">Op</span>&nbsp;<span class="op" id="5231544">==</span>&nbsp;<span class="ident" id="5231547">OpEmptyMatch</span>&nbsp;<span class="op" id="5231560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5231564">return</span>&nbsp;<span class="builtintype" id="5231571">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5231576">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5231579">if</span>&nbsp;<span class="ident" id="5231582">re</span><span class="op" id="5231584">.</span><span class="ident" id="5231585">Op</span>&nbsp;<span class="op" id="5231588">==</span>&nbsp;<span class="ident" id="5231591">OpConcat</span>&nbsp;<span class="op" id="5231600">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5231603">len</span><span class="op" id="5231606">(</span><span class="ident" id="5231607">re</span><span class="op" id="5231609">.</span><span class="ident" id="5231610">Sub</span><span class="op" id="5231613">)</span>&nbsp;<span class="op" id="5231615">&gt;</span>&nbsp;<span class="num" id="5231617">0</span>&nbsp;<span class="op" id="5231619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5231623">sub</span>&nbsp;<span class="op" id="5231627">:=</span>&nbsp;<span class="ident" id="5231630">re</span><span class="op" id="5231632">.</span><span class="ident" id="5231633">Sub</span><span class="op" id="5231636">[</span><span class="num" id="5231637">0</span><span class="op" id="5231638">]</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5231642">if</span>&nbsp;<span class="ident" id="5231645">sub</span><span class="op" id="5231648">.</span><span class="ident" id="5231649">Op</span>&nbsp;<span class="op" id="5231652">==</span>&nbsp;<span class="ident" id="5231655">OpEmptyMatch</span>&nbsp;<span class="op" id="5231668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5231673">return</span>&nbsp;<span class="builtintype" id="5231680">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5231686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5231690">return</span>&nbsp;<span class="ident" id="5231697">sub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5231702">}</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5231705">return</span>&nbsp;<span class="ident" id="5231712">re</span><br>
<span class="lineno"></span><span class="op" id="5231715">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5231718">//&nbsp;removeLeadingRegexp&nbsp;removes&nbsp;the&nbsp;leading&nbsp;regexp&nbsp;in&nbsp;re.</span><br>
<span class="lineno"></span><span class="comment" id="5231775">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;replacement&nbsp;for&nbsp;re.</span><br>
<span class="lineno">650</span><span class="comment" id="5231813">//&nbsp;If&nbsp;reuse&nbsp;is&nbsp;true,&nbsp;it&nbsp;passes&nbsp;the&nbsp;removed&nbsp;regexp&nbsp;(if&nbsp;no&nbsp;longer&nbsp;needed)&nbsp;to&nbsp;p.reuse.</span><br>
<span class="lineno"></span><span class="keyword" id="5231897">func</span>&nbsp;<span class="op" id="5231902">(</span><span class="ident" id="5231903">p</span>&nbsp;<span class="op" id="5231905">*</span><span class="ident" id="5231906">parser</span><span class="op" id="5231912">)</span>&nbsp;<span class="ident" id="5231914">removeLeadingRegexp</span><span class="op" id="5231933">(</span><span class="ident" id="5231934">re</span>&nbsp;<span class="op" id="5231937">*</span><span class="ident" id="5231938">Regexp</span><span class="op" id="5231944">,</span>&nbsp;<span class="ident" id="5231946">reuse</span>&nbsp;<span class="builtintype" id="5231952">bool</span><span class="op" id="5231956">)</span>&nbsp;<span class="op" id="5231958">*</span><span class="ident" id="5231959">Regexp</span>&nbsp;<span class="op" id="5231966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5231969">if</span>&nbsp;<span class="ident" id="5231972">re</span><span class="op" id="5231974">.</span><span class="ident" id="5231975">Op</span>&nbsp;<span class="op" id="5231978">==</span>&nbsp;<span class="ident" id="5231981">OpConcat</span>&nbsp;<span class="op" id="5231990">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5231993">len</span><span class="op" id="5231996">(</span><span class="ident" id="5231997">re</span><span class="op" id="5231999">.</span><span class="ident" id="5232000">Sub</span><span class="op" id="5232003">)</span>&nbsp;<span class="op" id="5232005">&gt;</span>&nbsp;<span class="num" id="5232007">0</span>&nbsp;<span class="op" id="5232009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5232013">if</span>&nbsp;<span class="ident" id="5232016">reuse</span>&nbsp;<span class="op" id="5232022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5232027">p</span><span class="op" id="5232028">.</span><span class="ident" id="5232029">reuse</span><span class="op" id="5232034">(</span><span class="ident" id="5232035">re</span><span class="op" id="5232037">.</span><span class="ident" id="5232038">Sub</span><span class="op" id="5232041">[</span><span class="num" id="5232042">0</span><span class="op" id="5232043">]</span><span class="op" id="5232044">)</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5232048">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5232052">re</span><span class="op" id="5232054">.</span><span class="ident" id="5232055">Sub</span>&nbsp;<span class="op" id="5232059">=</span>&nbsp;<span class="ident" id="5232061">re</span><span class="op" id="5232063">.</span><span class="ident" id="5232064">Sub</span><span class="op" id="5232067">[</span><span class="op" id="5232068">:</span><span class="builtinfunc" id="5232069">copy</span><span class="op" id="5232073">(</span><span class="ident" id="5232074">re</span><span class="op" id="5232076">.</span><span class="ident" id="5232077">Sub</span><span class="op" id="5232080">,</span>&nbsp;<span class="ident" id="5232082">re</span><span class="op" id="5232084">.</span><span class="ident" id="5232085">Sub</span><span class="op" id="5232088">[</span><span class="num" id="5232089">1</span><span class="op" id="5232090">:</span><span class="op" id="5232091">]</span><span class="op" id="5232092">)</span><span class="op" id="5232093">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5232097">switch</span>&nbsp;<span class="builtinfunc" id="5232104">len</span><span class="op" id="5232107">(</span><span class="ident" id="5232108">re</span><span class="op" id="5232110">.</span><span class="ident" id="5232111">Sub</span><span class="op" id="5232114">)</span>&nbsp;<span class="op" id="5232116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5232120">case</span>&nbsp;<span class="num" id="5232125">0</span><span class="op" id="5232126">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5232131">re</span><span class="op" id="5232133">.</span><span class="ident" id="5232134">Op</span>&nbsp;<span class="op" id="5232137">=</span>&nbsp;<span class="ident" id="5232139">OpEmptyMatch</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5232155">re</span><span class="op" id="5232157">.</span><span class="ident" id="5232158">Sub</span>&nbsp;<span class="op" id="5232162">=</span>&nbsp;<span class="builtintype" id="5232164">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5232170">case</span>&nbsp;<span class="num" id="5232175">1</span><span class="op" id="5232176">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5232181">old</span>&nbsp;<span class="op" id="5232185">:=</span>&nbsp;<span class="ident" id="5232188">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5232194">re</span>&nbsp;<span class="op" id="5232197">=</span>&nbsp;<span class="ident" id="5232199">re</span><span class="op" id="5232201">.</span><span class="ident" id="5232202">Sub</span><span class="op" id="5232205">[</span><span class="num" id="5232206">0</span><span class="op" id="5232207">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5232212">p</span><span class="op" id="5232213">.</span><span class="ident" id="5232214">reuse</span><span class="op" id="5232219">(</span><span class="ident" id="5232220">old</span><span class="op" id="5232223">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5232227">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5232231">return</span>&nbsp;<span class="ident" id="5232238">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5232242">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5232245">if</span>&nbsp;<span class="ident" id="5232248">reuse</span>&nbsp;<span class="op" id="5232254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5232258">p</span><span class="op" id="5232259">.</span><span class="ident" id="5232260">reuse</span><span class="op" id="5232265">(</span><span class="ident" id="5232266">re</span><span class="op" id="5232268">)</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5232271">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5232274">return</span>&nbsp;<span class="ident" id="5232281">p</span><span class="op" id="5232282">.</span><span class="ident" id="5232283">newRegexp</span><span class="op" id="5232292">(</span><span class="ident" id="5232293">OpEmptyMatch</span><span class="op" id="5232305">)</span><br>
<span class="lineno"></span><span class="op" id="5232307">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5232310">func</span>&nbsp;<span class="ident" id="5232315">literalRegexp</span><span class="op" id="5232328">(</span><span class="ident" id="5232329">s</span>&nbsp;<span class="builtintype" id="5232331">string</span><span class="op" id="5232337">,</span>&nbsp;<span class="ident" id="5232339">flags</span>&nbsp;<span class="ident" id="5232345">Flags</span><span class="op" id="5232350">)</span>&nbsp;<span class="op" id="5232352">*</span><span class="ident" id="5232353">Regexp</span>&nbsp;<span class="op" id="5232360">{</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5232363">re</span>&nbsp;<span class="op" id="5232366">:=</span>&nbsp;<span class="op" id="5232369">&amp;</span><span class="ident" id="5232370">Regexp</span><span class="op" id="5232376">{</span><span class="ident" id="5232377">Op</span><span class="op" id="5232379">:</span>&nbsp;<span class="ident" id="5232381">OpLiteral</span><span class="op" id="5232390">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5232393">re</span><span class="op" id="5232395">.</span><span class="ident" id="5232396">Flags</span>&nbsp;<span class="op" id="5232402">=</span>&nbsp;<span class="ident" id="5232404">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5232411">re</span><span class="op" id="5232413">.</span><span class="ident" id="5232414">Rune</span>&nbsp;<span class="op" id="5232419">=</span>&nbsp;<span class="ident" id="5232421">re</span><span class="op" id="5232423">.</span><span class="ident" id="5232424">Rune0</span><span class="op" id="5232429">[</span><span class="op" id="5232430">:</span><span class="num" id="5232431">0</span><span class="op" id="5232432">]</span>&nbsp;<span class="comment" id="5232434">//&nbsp;use&nbsp;local&nbsp;storage&nbsp;for&nbsp;small&nbsp;strings</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5232474">for</span>&nbsp;<span class="ident" id="5232478">_</span><span class="op" id="5232479">,</span>&nbsp;<span class="ident" id="5232481">c</span>&nbsp;<span class="op" id="5232483">:=</span>&nbsp;<span class="keyword" id="5232486">range</span>&nbsp;<span class="ident" id="5232492">s</span>&nbsp;<span class="op" id="5232494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5232498">if</span>&nbsp;<span class="builtinfunc" id="5232501">len</span><span class="op" id="5232504">(</span><span class="ident" id="5232505">re</span><span class="op" id="5232507">.</span><span class="ident" id="5232508">Rune</span><span class="op" id="5232512">)</span>&nbsp;<span class="op" id="5232514">&gt;=</span>&nbsp;<span class="builtinfunc" id="5232517">cap</span><span class="op" id="5232520">(</span><span class="ident" id="5232521">re</span><span class="op" id="5232523">.</span><span class="ident" id="5232524">Rune</span><span class="op" id="5232528">)</span>&nbsp;<span class="op" id="5232530">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5232535">//&nbsp;string&nbsp;is&nbsp;too&nbsp;long&nbsp;to&nbsp;fit&nbsp;in&nbsp;Rune0.&nbsp;&nbsp;let&nbsp;Go&nbsp;handle&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5232595">re</span><span class="op" id="5232597">.</span><span class="ident" id="5232598">Rune</span>&nbsp;<span class="op" id="5232603">=</span>&nbsp;<span class="op" id="5232605">[</span><span class="op" id="5232606">]</span><span class="builtintype" id="5232607">rune</span><span class="op" id="5232611">(</span><span class="ident" id="5232612">s</span><span class="op" id="5232613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5232618">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5232626">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5232630">re</span><span class="op" id="5232632">.</span><span class="ident" id="5232633">Rune</span>&nbsp;<span class="op" id="5232638">=</span>&nbsp;<span class="builtinfunc" id="5232640">append</span><span class="op" id="5232646">(</span><span class="ident" id="5232647">re</span><span class="op" id="5232649">.</span><span class="ident" id="5232650">Rune</span><span class="op" id="5232654">,</span>&nbsp;<span class="ident" id="5232656">c</span><span class="op" id="5232657">)</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5232660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5232663">return</span>&nbsp;<span class="ident" id="5232670">re</span><br>
<span class="lineno"></span><span class="op" id="5232673">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5232676">//&nbsp;Parsing.</span><br>
<span class="lineno">690</span><br>
<span class="lineno"></span><span class="comment" id="5232689">//&nbsp;Parse&nbsp;parses&nbsp;a&nbsp;regular&nbsp;expression&nbsp;string&nbsp;s,&nbsp;controlled&nbsp;by&nbsp;the&nbsp;specified</span><br>
<span class="lineno"></span><span class="comment" id="5232764">//&nbsp;Flags,&nbsp;and&nbsp;returns&nbsp;a&nbsp;regular&nbsp;expression&nbsp;parse&nbsp;tree.&nbsp;The&nbsp;syntax&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="5232833">//&nbsp;described&nbsp;in&nbsp;the&nbsp;top-level&nbsp;comment.</span><br>
<span class="lineno"></span><span class="keyword" id="5232872">func</span>&nbsp;<span class="ident" id="5232877">Parse</span><span class="op" id="5232882">(</span><span class="ident" id="5232883">s</span>&nbsp;<span class="builtintype" id="5232885">string</span><span class="op" id="5232891">,</span>&nbsp;<span class="ident" id="5232893">flags</span>&nbsp;<span class="ident" id="5232899">Flags</span><span class="op" id="5232904">)</span>&nbsp;<span class="op" id="5232906">(</span><span class="op" id="5232907">*</span><span class="ident" id="5232908">Regexp</span><span class="op" id="5232914">,</span>&nbsp;<span class="builtintype" id="5232916">error</span><span class="op" id="5232921">)</span>&nbsp;<span class="op" id="5232923">{</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5232926">if</span>&nbsp;<span class="ident" id="5232929">flags</span><span class="op" id="5232934">&amp;</span><span class="ident" id="5232935">Literal</span>&nbsp;<span class="op" id="5232943">!=</span>&nbsp;<span class="num" id="5232946">0</span>&nbsp;<span class="op" id="5232948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5232952">//&nbsp;Trivial&nbsp;parser&nbsp;for&nbsp;literal&nbsp;string.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5232992">if</span>&nbsp;<span class="ident" id="5232995">err</span>&nbsp;<span class="op" id="5232999">:=</span>&nbsp;<span class="ident" id="5233002">checkUTF8</span><span class="op" id="5233011">(</span><span class="ident" id="5233012">s</span><span class="op" id="5233013">)</span><span class="op" id="5233014">;</span>&nbsp;<span class="ident" id="5233016">err</span>&nbsp;<span class="op" id="5233020">!=</span>&nbsp;<span class="builtintype" id="5233023">nil</span>&nbsp;<span class="op" id="5233027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5233032">return</span>&nbsp;<span class="builtintype" id="5233039">nil</span><span class="op" id="5233042">,</span>&nbsp;<span class="ident" id="5233044">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5233050">}</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5233054">return</span>&nbsp;<span class="ident" id="5233061">literalRegexp</span><span class="op" id="5233074">(</span><span class="ident" id="5233075">s</span><span class="op" id="5233076">,</span>&nbsp;<span class="ident" id="5233078">flags</span><span class="op" id="5233083">)</span><span class="op" id="5233084">,</span>&nbsp;<span class="builtintype" id="5233086">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5233091">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5233095">//&nbsp;Otherwise,&nbsp;must&nbsp;do&nbsp;real&nbsp;work.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5233129">var</span>&nbsp;<span class="op" id="5233133">(</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5233137">p</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5233148">parser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5233157">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5233168">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5233176">c</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5233187">rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5233194">op</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5233205">Op</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5233210">lastRepeat</span>&nbsp;<span class="builtintype" id="5233221">string</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5233229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5233232">p</span><span class="op" id="5233233">.</span><span class="ident" id="5233234">flags</span>&nbsp;<span class="op" id="5233240">=</span>&nbsp;<span class="ident" id="5233242">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5233249">p</span><span class="op" id="5233250">.</span><span class="ident" id="5233251">wholeRegexp</span>&nbsp;<span class="op" id="5233263">=</span>&nbsp;<span class="ident" id="5233265">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5233268">t</span>&nbsp;<span class="op" id="5233270">:=</span>&nbsp;<span class="ident" id="5233273">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5233276">for</span>&nbsp;<span class="ident" id="5233280">t</span>&nbsp;<span class="op" id="5233282">!=</span>&nbsp;<span class="string" id="5233285">&#34;&#34;</span>&nbsp;<span class="op" id="5233288">{</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5233292">repeat</span>&nbsp;<span class="op" id="5233299">:=</span>&nbsp;<span class="string" id="5233302">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5233306">BigSwitch</span><span class="op" id="5233315">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5233319">switch</span>&nbsp;<span class="ident" id="5233326">t</span><span class="op" id="5233327">[</span><span class="num" id="5233328">0</span><span class="op" id="5233329">]</span>&nbsp;<span class="op" id="5233331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5233335">default</span><span class="op" id="5233342">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5233347">if</span>&nbsp;<span class="ident" id="5233350">c</span><span class="op" id="5233351">,</span>&nbsp;<span class="ident" id="5233353">t</span><span class="op" id="5233354">,</span>&nbsp;<span class="ident" id="5233356">err</span>&nbsp;<span class="op" id="5233360">=</span>&nbsp;<span class="ident" id="5233362">nextRune</span><span class="op" id="5233370">(</span><span class="ident" id="5233371">t</span><span class="op" id="5233372">)</span><span class="op" id="5233373">;</span>&nbsp;<span class="ident" id="5233375">err</span>&nbsp;<span class="op" id="5233379">!=</span>&nbsp;<span class="builtintype" id="5233382">nil</span>&nbsp;<span class="op" id="5233386">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5233392">return</span>&nbsp;<span class="builtintype" id="5233399">nil</span><span class="op" id="5233402">,</span>&nbsp;<span class="ident" id="5233404">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5233411">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5233416">p</span><span class="op" id="5233417">.</span><span class="ident" id="5233418">literal</span><span class="op" id="5233425">(</span><span class="ident" id="5233426">c</span><span class="op" id="5233427">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5233432">case</span>&nbsp;<span class="string" id="5233437">&#39;(&#39;</span><span class="op" id="5233440">:</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5233445">if</span>&nbsp;<span class="ident" id="5233448">p</span><span class="op" id="5233449">.</span><span class="ident" id="5233450">flags</span><span class="op" id="5233455">&amp;</span><span class="ident" id="5233456">PerlX</span>&nbsp;<span class="op" id="5233462">!=</span>&nbsp;<span class="num" id="5233465">0</span>&nbsp;<span class="op" id="5233467">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5233470">len</span><span class="op" id="5233473">(</span><span class="ident" id="5233474">t</span><span class="op" id="5233475">)</span>&nbsp;<span class="op" id="5233477">&gt;=</span>&nbsp;<span class="num" id="5233480">2</span>&nbsp;<span class="op" id="5233482">&amp;&amp;</span>&nbsp;<span class="ident" id="5233485">t</span><span class="op" id="5233486">[</span><span class="num" id="5233487">1</span><span class="op" id="5233488">]</span>&nbsp;<span class="op" id="5233490">==</span>&nbsp;<span class="string" id="5233493">&#39;?&#39;</span>&nbsp;<span class="op" id="5233497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5233503">//&nbsp;Flag&nbsp;changes&nbsp;and&nbsp;non-capturing&nbsp;groups.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5233549">if</span>&nbsp;<span class="ident" id="5233552">t</span><span class="op" id="5233553">,</span>&nbsp;<span class="ident" id="5233555">err</span>&nbsp;<span class="op" id="5233559">=</span>&nbsp;<span class="ident" id="5233561">p</span><span class="op" id="5233562">.</span><span class="ident" id="5233563">parsePerlFlags</span><span class="op" id="5233577">(</span><span class="ident" id="5233578">t</span><span class="op" id="5233579">)</span><span class="op" id="5233580">;</span>&nbsp;<span class="ident" id="5233582">err</span>&nbsp;<span class="op" id="5233586">!=</span>&nbsp;<span class="builtintype" id="5233589">nil</span>&nbsp;<span class="op" id="5233593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5233600">return</span>&nbsp;<span class="builtintype" id="5233607">nil</span><span class="op" id="5233610">,</span>&nbsp;<span class="ident" id="5233612">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5233620">}</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5233626">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5233635">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5233640">p</span><span class="op" id="5233641">.</span><span class="ident" id="5233642">numCap</span><span class="op" id="5233648">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5233654">p</span><span class="op" id="5233655">.</span><span class="ident" id="5233656">op</span><span class="op" id="5233658">(</span><span class="ident" id="5233659">opLeftParen</span><span class="op" id="5233670">)</span><span class="op" id="5233671">.</span><span class="ident" id="5233672">Cap</span>&nbsp;<span class="op" id="5233676">=</span>&nbsp;<span class="ident" id="5233678">p</span><span class="op" id="5233679">.</span><span class="ident" id="5233680">numCap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5233690">t</span>&nbsp;<span class="op" id="5233692">=</span>&nbsp;<span class="ident" id="5233694">t</span><span class="op" id="5233695">[</span><span class="num" id="5233696">1</span><span class="op" id="5233697">:</span><span class="op" id="5233698">]</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5233702">case</span>&nbsp;<span class="string" id="5233707">&#39;|&#39;</span><span class="op" id="5233710">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5233715">if</span>&nbsp;<span class="ident" id="5233718">err</span>&nbsp;<span class="op" id="5233722">=</span>&nbsp;<span class="ident" id="5233724">p</span><span class="op" id="5233725">.</span><span class="ident" id="5233726">parseVerticalBar</span><span class="op" id="5233742">(</span><span class="op" id="5233743">)</span><span class="op" id="5233744">;</span>&nbsp;<span class="ident" id="5233746">err</span>&nbsp;<span class="op" id="5233750">!=</span>&nbsp;<span class="builtintype" id="5233753">nil</span>&nbsp;<span class="op" id="5233757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5233763">return</span>&nbsp;<span class="builtintype" id="5233770">nil</span><span class="op" id="5233773">,</span>&nbsp;<span class="ident" id="5233775">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5233782">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5233787">t</span>&nbsp;<span class="op" id="5233789">=</span>&nbsp;<span class="ident" id="5233791">t</span><span class="op" id="5233792">[</span><span class="num" id="5233793">1</span><span class="op" id="5233794">:</span><span class="op" id="5233795">]</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5233799">case</span>&nbsp;<span class="string" id="5233804">&#39;)&#39;</span><span class="op" id="5233807">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5233812">if</span>&nbsp;<span class="ident" id="5233815">err</span>&nbsp;<span class="op" id="5233819">=</span>&nbsp;<span class="ident" id="5233821">p</span><span class="op" id="5233822">.</span><span class="ident" id="5233823">parseRightParen</span><span class="op" id="5233838">(</span><span class="op" id="5233839">)</span><span class="op" id="5233840">;</span>&nbsp;<span class="ident" id="5233842">err</span>&nbsp;<span class="op" id="5233846">!=</span>&nbsp;<span class="builtintype" id="5233849">nil</span>&nbsp;<span class="op" id="5233853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5233859">return</span>&nbsp;<span class="builtintype" id="5233866">nil</span><span class="op" id="5233869">,</span>&nbsp;<span class="ident" id="5233871">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5233878">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5233883">t</span>&nbsp;<span class="op" id="5233885">=</span>&nbsp;<span class="ident" id="5233887">t</span><span class="op" id="5233888">[</span><span class="num" id="5233889">1</span><span class="op" id="5233890">:</span><span class="op" id="5233891">]</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5233895">case</span>&nbsp;<span class="string" id="5233900">&#39;^&#39;</span><span class="op" id="5233903">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5233908">if</span>&nbsp;<span class="ident" id="5233911">p</span><span class="op" id="5233912">.</span><span class="ident" id="5233913">flags</span><span class="op" id="5233918">&amp;</span><span class="ident" id="5233919">OneLine</span>&nbsp;<span class="op" id="5233927">!=</span>&nbsp;<span class="num" id="5233930">0</span>&nbsp;<span class="op" id="5233932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5233938">p</span><span class="op" id="5233939">.</span><span class="ident" id="5233940">op</span><span class="op" id="5233942">(</span><span class="ident" id="5233943">OpBeginText</span><span class="op" id="5233954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5233959">}</span>&nbsp;<span class="keyword" id="5233961">else</span>&nbsp;<span class="op" id="5233966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5233972">p</span><span class="op" id="5233973">.</span><span class="ident" id="5233974">op</span><span class="op" id="5233976">(</span><span class="ident" id="5233977">OpBeginLine</span><span class="op" id="5233988">)</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5233993">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5233998">t</span>&nbsp;<span class="op" id="5234000">=</span>&nbsp;<span class="ident" id="5234002">t</span><span class="op" id="5234003">[</span><span class="num" id="5234004">1</span><span class="op" id="5234005">:</span><span class="op" id="5234006">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5234010">case</span>&nbsp;<span class="string" id="5234015">&#39;$&#39;</span><span class="op" id="5234018">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5234023">if</span>&nbsp;<span class="ident" id="5234026">p</span><span class="op" id="5234027">.</span><span class="ident" id="5234028">flags</span><span class="op" id="5234033">&amp;</span><span class="ident" id="5234034">OneLine</span>&nbsp;<span class="op" id="5234042">!=</span>&nbsp;<span class="num" id="5234045">0</span>&nbsp;<span class="op" id="5234047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5234053">p</span><span class="op" id="5234054">.</span><span class="ident" id="5234055">op</span><span class="op" id="5234057">(</span><span class="ident" id="5234058">OpEndText</span><span class="op" id="5234067">)</span><span class="op" id="5234068">.</span><span class="ident" id="5234069">Flags</span>&nbsp;<span class="op" id="5234075">|=</span>&nbsp;<span class="ident" id="5234078">WasDollar</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5234091">}</span>&nbsp;<span class="keyword" id="5234093">else</span>&nbsp;<span class="op" id="5234098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5234104">p</span><span class="op" id="5234105">.</span><span class="ident" id="5234106">op</span><span class="op" id="5234108">(</span><span class="ident" id="5234109">OpEndLine</span><span class="op" id="5234118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5234123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5234128">t</span>&nbsp;<span class="op" id="5234130">=</span>&nbsp;<span class="ident" id="5234132">t</span><span class="op" id="5234133">[</span><span class="num" id="5234134">1</span><span class="op" id="5234135">:</span><span class="op" id="5234136">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5234140">case</span>&nbsp;<span class="string" id="5234145">&#39;.&#39;</span><span class="op" id="5234148">:</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5234153">if</span>&nbsp;<span class="ident" id="5234156">p</span><span class="op" id="5234157">.</span><span class="ident" id="5234158">flags</span><span class="op" id="5234163">&amp;</span><span class="ident" id="5234164">DotNL</span>&nbsp;<span class="op" id="5234170">!=</span>&nbsp;<span class="num" id="5234173">0</span>&nbsp;<span class="op" id="5234175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5234181">p</span><span class="op" id="5234182">.</span><span class="ident" id="5234183">op</span><span class="op" id="5234185">(</span><span class="ident" id="5234186">OpAnyChar</span><span class="op" id="5234195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5234200">}</span>&nbsp;<span class="keyword" id="5234202">else</span>&nbsp;<span class="op" id="5234207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5234213">p</span><span class="op" id="5234214">.</span><span class="ident" id="5234215">op</span><span class="op" id="5234217">(</span><span class="ident" id="5234218">OpAnyCharNotNL</span><span class="op" id="5234232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5234237">}</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5234242">t</span>&nbsp;<span class="op" id="5234244">=</span>&nbsp;<span class="ident" id="5234246">t</span><span class="op" id="5234247">[</span><span class="num" id="5234248">1</span><span class="op" id="5234249">:</span><span class="op" id="5234250">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5234254">case</span>&nbsp;<span class="string" id="5234259">&#39;[&#39;</span><span class="op" id="5234262">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5234267">if</span>&nbsp;<span class="ident" id="5234270">t</span><span class="op" id="5234271">,</span>&nbsp;<span class="ident" id="5234273">err</span>&nbsp;<span class="op" id="5234277">=</span>&nbsp;<span class="ident" id="5234279">p</span><span class="op" id="5234280">.</span><span class="ident" id="5234281">parseClass</span><span class="op" id="5234291">(</span><span class="ident" id="5234292">t</span><span class="op" id="5234293">)</span><span class="op" id="5234294">;</span>&nbsp;<span class="ident" id="5234296">err</span>&nbsp;<span class="op" id="5234300">!=</span>&nbsp;<span class="builtintype" id="5234303">nil</span>&nbsp;<span class="op" id="5234307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5234313">return</span>&nbsp;<span class="builtintype" id="5234320">nil</span><span class="op" id="5234323">,</span>&nbsp;<span class="ident" id="5234325">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5234332">}</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5234336">case</span>&nbsp;<span class="string" id="5234341">&#39;*&#39;</span><span class="op" id="5234344">,</span>&nbsp;<span class="string" id="5234346">&#39;+&#39;</span><span class="op" id="5234349">,</span>&nbsp;<span class="string" id="5234351">&#39;?&#39;</span><span class="op" id="5234354">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5234359">before</span>&nbsp;<span class="op" id="5234366">:=</span>&nbsp;<span class="ident" id="5234369">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5234374">switch</span>&nbsp;<span class="ident" id="5234381">t</span><span class="op" id="5234382">[</span><span class="num" id="5234383">0</span><span class="op" id="5234384">]</span>&nbsp;<span class="op" id="5234386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5234391">case</span>&nbsp;<span class="string" id="5234396">&#39;*&#39;</span><span class="op" id="5234399">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5234405">op</span>&nbsp;<span class="op" id="5234408">=</span>&nbsp;<span class="ident" id="5234410">OpStar</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5234420">case</span>&nbsp;<span class="string" id="5234425">&#39;+&#39;</span><span class="op" id="5234428">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5234434">op</span>&nbsp;<span class="op" id="5234437">=</span>&nbsp;<span class="ident" id="5234439">OpPlus</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5234449">case</span>&nbsp;<span class="string" id="5234454">&#39;?&#39;</span><span class="op" id="5234457">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5234463">op</span>&nbsp;<span class="op" id="5234466">=</span>&nbsp;<span class="ident" id="5234468">OpQuest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5234479">}</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5234484">after</span>&nbsp;<span class="op" id="5234490">:=</span>&nbsp;<span class="ident" id="5234493">t</span><span class="op" id="5234494">[</span><span class="num" id="5234495">1</span><span class="op" id="5234496">:</span><span class="op" id="5234497">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5234502">if</span>&nbsp;<span class="ident" id="5234505">after</span><span class="op" id="5234510">,</span>&nbsp;<span class="ident" id="5234512">err</span>&nbsp;<span class="op" id="5234516">=</span>&nbsp;<span class="ident" id="5234518">p</span><span class="op" id="5234519">.</span><span class="ident" id="5234520">repeat</span><span class="op" id="5234526">(</span><span class="ident" id="5234527">op</span><span class="op" id="5234529">,</span>&nbsp;<span class="num" id="5234531">0</span><span class="op" id="5234532">,</span>&nbsp;<span class="num" id="5234534">0</span><span class="op" id="5234535">,</span>&nbsp;<span class="ident" id="5234537">before</span><span class="op" id="5234543">,</span>&nbsp;<span class="ident" id="5234545">after</span><span class="op" id="5234550">,</span>&nbsp;<span class="ident" id="5234552">lastRepeat</span><span class="op" id="5234562">)</span><span class="op" id="5234563">;</span>&nbsp;<span class="ident" id="5234565">err</span>&nbsp;<span class="op" id="5234569">!=</span>&nbsp;<span class="builtintype" id="5234572">nil</span>&nbsp;<span class="op" id="5234576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5234582">return</span>&nbsp;<span class="builtintype" id="5234589">nil</span><span class="op" id="5234592">,</span>&nbsp;<span class="ident" id="5234594">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5234601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5234606">repeat</span>&nbsp;<span class="op" id="5234613">=</span>&nbsp;<span class="ident" id="5234615">before</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5234625">t</span>&nbsp;<span class="op" id="5234627">=</span>&nbsp;<span class="ident" id="5234629">after</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5234637">case</span>&nbsp;<span class="string" id="5234642">&#39;{&#39;</span><span class="op" id="5234645">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5234650">op</span>&nbsp;<span class="op" id="5234653">=</span>&nbsp;<span class="ident" id="5234655">OpRepeat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5234667">before</span>&nbsp;<span class="op" id="5234674">:=</span>&nbsp;<span class="ident" id="5234677">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5234682">min</span><span class="op" id="5234685">,</span>&nbsp;<span class="ident" id="5234687">max</span><span class="op" id="5234690">,</span>&nbsp;<span class="ident" id="5234692">after</span><span class="op" id="5234697">,</span>&nbsp;<span class="ident" id="5234699">ok</span>&nbsp;<span class="op" id="5234702">:=</span>&nbsp;<span class="ident" id="5234705">p</span><span class="op" id="5234706">.</span><span class="ident" id="5234707">parseRepeat</span><span class="op" id="5234718">(</span><span class="ident" id="5234719">t</span><span class="op" id="5234720">)</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5234725">if</span>&nbsp;<span class="op" id="5234728">!</span><span class="ident" id="5234729">ok</span>&nbsp;<span class="op" id="5234732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5234738">//&nbsp;If&nbsp;the&nbsp;repeat&nbsp;cannot&nbsp;be&nbsp;parsed,&nbsp;{&nbsp;is&nbsp;a&nbsp;literal.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5234793">p</span><span class="op" id="5234794">.</span><span class="ident" id="5234795">literal</span><span class="op" id="5234802">(</span><span class="string" id="5234803">&#39;{&#39;</span><span class="op" id="5234806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5234812">t</span>&nbsp;<span class="op" id="5234814">=</span>&nbsp;<span class="ident" id="5234816">t</span><span class="op" id="5234817">[</span><span class="num" id="5234818">1</span><span class="op" id="5234819">:</span><span class="op" id="5234820">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5234826">break</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5234835">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5234840">if</span>&nbsp;<span class="ident" id="5234843">min</span>&nbsp;<span class="op" id="5234847">&lt;</span>&nbsp;<span class="num" id="5234849">0</span>&nbsp;<span class="op" id="5234851">||</span>&nbsp;<span class="ident" id="5234854">min</span>&nbsp;<span class="op" id="5234858">&gt;</span>&nbsp;<span class="num" id="5234860">1000</span>&nbsp;<span class="op" id="5234865">||</span>&nbsp;<span class="ident" id="5234868">max</span>&nbsp;<span class="op" id="5234872">&gt;</span>&nbsp;<span class="num" id="5234874">1000</span>&nbsp;<span class="op" id="5234879">||</span>&nbsp;<span class="ident" id="5234882">max</span>&nbsp;<span class="op" id="5234886">&gt;=</span>&nbsp;<span class="num" id="5234889">0</span>&nbsp;<span class="op" id="5234891">&amp;&amp;</span>&nbsp;<span class="ident" id="5234894">min</span>&nbsp;<span class="op" id="5234898">&gt;</span>&nbsp;<span class="ident" id="5234900">max</span>&nbsp;<span class="op" id="5234904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5234910">//&nbsp;Numbers&nbsp;were&nbsp;too&nbsp;big,&nbsp;or&nbsp;max&nbsp;is&nbsp;present&nbsp;and&nbsp;min&nbsp;&gt;&nbsp;max.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5234972">return</span>&nbsp;<span class="builtintype" id="5234979">nil</span><span class="op" id="5234982">,</span>&nbsp;<span class="op" id="5234984">&amp;</span><span class="ident" id="5234985">Error</span><span class="op" id="5234990">{</span><span class="ident" id="5234991">ErrInvalidRepeatSize</span><span class="op" id="5235011">,</span>&nbsp;<span class="ident" id="5235013">before</span><span class="op" id="5235019">[</span><span class="op" id="5235020">:</span><span class="builtinfunc" id="5235021">len</span><span class="op" id="5235024">(</span><span class="ident" id="5235025">before</span><span class="op" id="5235031">)</span><span class="op" id="5235032">-</span><span class="builtinfunc" id="5235033">len</span><span class="op" id="5235036">(</span><span class="ident" id="5235037">after</span><span class="op" id="5235042">)</span><span class="op" id="5235043">]</span><span class="op" id="5235044">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5235049">}</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5235054">if</span>&nbsp;<span class="ident" id="5235057">after</span><span class="op" id="5235062">,</span>&nbsp;<span class="ident" id="5235064">err</span>&nbsp;<span class="op" id="5235068">=</span>&nbsp;<span class="ident" id="5235070">p</span><span class="op" id="5235071">.</span><span class="ident" id="5235072">repeat</span><span class="op" id="5235078">(</span><span class="ident" id="5235079">op</span><span class="op" id="5235081">,</span>&nbsp;<span class="ident" id="5235083">min</span><span class="op" id="5235086">,</span>&nbsp;<span class="ident" id="5235088">max</span><span class="op" id="5235091">,</span>&nbsp;<span class="ident" id="5235093">before</span><span class="op" id="5235099">,</span>&nbsp;<span class="ident" id="5235101">after</span><span class="op" id="5235106">,</span>&nbsp;<span class="ident" id="5235108">lastRepeat</span><span class="op" id="5235118">)</span><span class="op" id="5235119">;</span>&nbsp;<span class="ident" id="5235121">err</span>&nbsp;<span class="op" id="5235125">!=</span>&nbsp;<span class="builtintype" id="5235128">nil</span>&nbsp;<span class="op" id="5235132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5235138">return</span>&nbsp;<span class="builtintype" id="5235145">nil</span><span class="op" id="5235148">,</span>&nbsp;<span class="ident" id="5235150">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5235157">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5235162">repeat</span>&nbsp;<span class="op" id="5235169">=</span>&nbsp;<span class="ident" id="5235171">before</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5235181">t</span>&nbsp;<span class="op" id="5235183">=</span>&nbsp;<span class="ident" id="5235185">after</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5235193">case</span>&nbsp;<span class="string" id="5235198">&#39;\\&#39;</span><span class="op" id="5235202">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5235207">if</span>&nbsp;<span class="ident" id="5235210">p</span><span class="op" id="5235211">.</span><span class="ident" id="5235212">flags</span><span class="op" id="5235217">&amp;</span><span class="ident" id="5235218">PerlX</span>&nbsp;<span class="op" id="5235224">!=</span>&nbsp;<span class="num" id="5235227">0</span>&nbsp;<span class="op" id="5235229">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5235232">len</span><span class="op" id="5235235">(</span><span class="ident" id="5235236">t</span><span class="op" id="5235237">)</span>&nbsp;<span class="op" id="5235239">&gt;=</span>&nbsp;<span class="num" id="5235242">2</span>&nbsp;<span class="op" id="5235244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5235250">switch</span>&nbsp;<span class="ident" id="5235257">t</span><span class="op" id="5235258">[</span><span class="num" id="5235259">1</span><span class="op" id="5235260">]</span>&nbsp;<span class="op" id="5235262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5235268">case</span>&nbsp;<span class="string" id="5235273">&#39;A&#39;</span><span class="op" id="5235276">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5235283">p</span><span class="op" id="5235284">.</span><span class="ident" id="5235285">op</span><span class="op" id="5235287">(</span><span class="ident" id="5235288">OpBeginText</span><span class="op" id="5235299">)</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5235306">t</span>&nbsp;<span class="op" id="5235308">=</span>&nbsp;<span class="ident" id="5235310">t</span><span class="op" id="5235311">[</span><span class="num" id="5235312">2</span><span class="op" id="5235313">:</span><span class="op" id="5235314">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5235321">break</span>&nbsp;<span class="ident" id="5235327">BigSwitch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5235341">case</span>&nbsp;<span class="string" id="5235346">&#39;b&#39;</span><span class="op" id="5235349">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5235356">p</span><span class="op" id="5235357">.</span><span class="ident" id="5235358">op</span><span class="op" id="5235360">(</span><span class="ident" id="5235361">OpWordBoundary</span><span class="op" id="5235375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5235382">t</span>&nbsp;<span class="op" id="5235384">=</span>&nbsp;<span class="ident" id="5235386">t</span><span class="op" id="5235387">[</span><span class="num" id="5235388">2</span><span class="op" id="5235389">:</span><span class="op" id="5235390">]</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5235397">break</span>&nbsp;<span class="ident" id="5235403">BigSwitch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5235417">case</span>&nbsp;<span class="string" id="5235422">&#39;B&#39;</span><span class="op" id="5235425">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5235432">p</span><span class="op" id="5235433">.</span><span class="ident" id="5235434">op</span><span class="op" id="5235436">(</span><span class="ident" id="5235437">OpNoWordBoundary</span><span class="op" id="5235453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5235460">t</span>&nbsp;<span class="op" id="5235462">=</span>&nbsp;<span class="ident" id="5235464">t</span><span class="op" id="5235465">[</span><span class="num" id="5235466">2</span><span class="op" id="5235467">:</span><span class="op" id="5235468">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5235475">break</span>&nbsp;<span class="ident" id="5235481">BigSwitch</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5235495">case</span>&nbsp;<span class="string" id="5235500">&#39;C&#39;</span><span class="op" id="5235503">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5235510">//&nbsp;any&nbsp;byte;&nbsp;not&nbsp;supported</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5235542">return</span>&nbsp;<span class="builtintype" id="5235549">nil</span><span class="op" id="5235552">,</span>&nbsp;<span class="op" id="5235554">&amp;</span><span class="ident" id="5235555">Error</span><span class="op" id="5235560">{</span><span class="ident" id="5235561">ErrInvalidEscape</span><span class="op" id="5235577">,</span>&nbsp;<span class="ident" id="5235579">t</span><span class="op" id="5235580">[</span><span class="op" id="5235581">:</span><span class="num" id="5235582">2</span><span class="op" id="5235583">]</span><span class="op" id="5235584">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5235590">case</span>&nbsp;<span class="string" id="5235595">&#39;Q&#39;</span><span class="op" id="5235598">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5235605">//&nbsp;\Q&nbsp;...&nbsp;\E:&nbsp;the&nbsp;...&nbsp;is&nbsp;always&nbsp;literals</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5235651">var</span>&nbsp;<span class="ident" id="5235655">lit</span>&nbsp;<span class="builtintype" id="5235659">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5235671">if</span>&nbsp;<span class="ident" id="5235674">i</span>&nbsp;<span class="op" id="5235676">:=</span>&nbsp;<span class="ident" id="5235679">strings</span><span class="op" id="5235686">.</span><span class="ident" id="5235687">Index</span><span class="op" id="5235692">(</span><span class="ident" id="5235693">t</span><span class="op" id="5235694">,</span>&nbsp;<span class="string" id="5235696">`\E`</span><span class="op" id="5235700">)</span><span class="op" id="5235701">;</span>&nbsp;<span class="ident" id="5235703">i</span>&nbsp;<span class="op" id="5235705">&lt;</span>&nbsp;<span class="num" id="5235707">0</span>&nbsp;<span class="op" id="5235709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5235717">lit</span>&nbsp;<span class="op" id="5235721">=</span>&nbsp;<span class="ident" id="5235723">t</span><span class="op" id="5235724">[</span><span class="num" id="5235725">2</span><span class="op" id="5235726">:</span><span class="op" id="5235727">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5235735">t</span>&nbsp;<span class="op" id="5235737">=</span>&nbsp;<span class="string" id="5235739">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5235747">}</span>&nbsp;<span class="keyword" id="5235749">else</span>&nbsp;<span class="op" id="5235754">{</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5235762">lit</span>&nbsp;<span class="op" id="5235766">=</span>&nbsp;<span class="ident" id="5235768">t</span><span class="op" id="5235769">[</span><span class="num" id="5235770">2</span><span class="op" id="5235771">:</span><span class="ident" id="5235772">i</span><span class="op" id="5235773">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5235781">t</span>&nbsp;<span class="op" id="5235783">=</span>&nbsp;<span class="ident" id="5235785">t</span><span class="op" id="5235786">[</span><span class="ident" id="5235787">i</span><span class="op" id="5235788">+</span><span class="num" id="5235789">2</span><span class="op" id="5235790">:</span><span class="op" id="5235791">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5235798">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5235805">p</span><span class="op" id="5235806">.</span><span class="ident" id="5235807">push</span><span class="op" id="5235811">(</span><span class="ident" id="5235812">literalRegexp</span><span class="op" id="5235825">(</span><span class="ident" id="5235826">lit</span><span class="op" id="5235829">,</span>&nbsp;<span class="ident" id="5235831">p</span><span class="op" id="5235832">.</span><span class="ident" id="5235833">flags</span><span class="op" id="5235838">)</span><span class="op" id="5235839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5235846">break</span>&nbsp;<span class="ident" id="5235852">BigSwitch</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5235866">case</span>&nbsp;<span class="string" id="5235871">&#39;z&#39;</span><span class="op" id="5235874">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5235881">p</span><span class="op" id="5235882">.</span><span class="ident" id="5235883">op</span><span class="op" id="5235885">(</span><span class="ident" id="5235886">OpEndText</span><span class="op" id="5235895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5235902">t</span>&nbsp;<span class="op" id="5235904">=</span>&nbsp;<span class="ident" id="5235906">t</span><span class="op" id="5235907">[</span><span class="num" id="5235908">2</span><span class="op" id="5235909">:</span><span class="op" id="5235910">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5235917">break</span>&nbsp;<span class="ident" id="5235923">BigSwitch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5235937">}</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5235942">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5235948">re</span>&nbsp;<span class="op" id="5235951">:=</span>&nbsp;<span class="ident" id="5235954">p</span><span class="op" id="5235955">.</span><span class="ident" id="5235956">newRegexp</span><span class="op" id="5235965">(</span><span class="ident" id="5235966">OpCharClass</span><span class="op" id="5235977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5235982">re</span><span class="op" id="5235984">.</span><span class="ident" id="5235985">Flags</span>&nbsp;<span class="op" id="5235991">=</span>&nbsp;<span class="ident" id="5235993">p</span><span class="op" id="5235994">.</span><span class="ident" id="5235995">flags</span><br>
<span class="lineno"></span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5236005">//&nbsp;Look&nbsp;for&nbsp;Unicode&nbsp;character&nbsp;group&nbsp;like&nbsp;\p{Han}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5236057">if</span>&nbsp;<span class="builtinfunc" id="5236060">len</span><span class="op" id="5236063">(</span><span class="ident" id="5236064">t</span><span class="op" id="5236065">)</span>&nbsp;<span class="op" id="5236067">&gt;=</span>&nbsp;<span class="num" id="5236070">2</span>&nbsp;<span class="op" id="5236072">&amp;&amp;</span>&nbsp;<span class="op" id="5236075">(</span><span class="ident" id="5236076">t</span><span class="op" id="5236077">[</span><span class="num" id="5236078">1</span><span class="op" id="5236079">]</span>&nbsp;<span class="op" id="5236081">==</span>&nbsp;<span class="string" id="5236084">&#39;p&#39;</span>&nbsp;<span class="op" id="5236088">||</span>&nbsp;<span class="ident" id="5236091">t</span><span class="op" id="5236092">[</span><span class="num" id="5236093">1</span><span class="op" id="5236094">]</span>&nbsp;<span class="op" id="5236096">==</span>&nbsp;<span class="string" id="5236099">&#39;P&#39;</span><span class="op" id="5236102">)</span>&nbsp;<span class="op" id="5236104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5236110">r</span><span class="op" id="5236111">,</span>&nbsp;<span class="ident" id="5236113">rest</span><span class="op" id="5236117">,</span>&nbsp;<span class="ident" id="5236119">err</span>&nbsp;<span class="op" id="5236123">:=</span>&nbsp;<span class="ident" id="5236126">p</span><span class="op" id="5236127">.</span><span class="ident" id="5236128">parseUnicodeClass</span><span class="op" id="5236145">(</span><span class="ident" id="5236146">t</span><span class="op" id="5236147">,</span>&nbsp;<span class="ident" id="5236149">re</span><span class="op" id="5236151">.</span><span class="ident" id="5236152">Rune0</span><span class="op" id="5236157">[</span><span class="op" id="5236158">:</span><span class="num" id="5236159">0</span><span class="op" id="5236160">]</span><span class="op" id="5236161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5236167">if</span>&nbsp;<span class="ident" id="5236170">err</span>&nbsp;<span class="op" id="5236174">!=</span>&nbsp;<span class="builtintype" id="5236177">nil</span>&nbsp;<span class="op" id="5236181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5236188">return</span>&nbsp;<span class="builtintype" id="5236195">nil</span><span class="op" id="5236198">,</span>&nbsp;<span class="ident" id="5236200">err</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5236208">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5236214">if</span>&nbsp;<span class="ident" id="5236217">r</span>&nbsp;<span class="op" id="5236219">!=</span>&nbsp;<span class="builtintype" id="5236222">nil</span>&nbsp;<span class="op" id="5236226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5236233">re</span><span class="op" id="5236235">.</span><span class="ident" id="5236236">Rune</span>&nbsp;<span class="op" id="5236241">=</span>&nbsp;<span class="ident" id="5236243">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5236250">t</span>&nbsp;<span class="op" id="5236252">=</span>&nbsp;<span class="ident" id="5236254">rest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5236264">p</span><span class="op" id="5236265">.</span><span class="ident" id="5236266">push</span><span class="op" id="5236270">(</span><span class="ident" id="5236271">re</span><span class="op" id="5236273">)</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5236280">break</span>&nbsp;<span class="ident" id="5236286">BigSwitch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5236300">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5236305">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5236311">//&nbsp;Perl&nbsp;character&nbsp;class&nbsp;escape.</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5236346">if</span>&nbsp;<span class="ident" id="5236349">r</span><span class="op" id="5236350">,</span>&nbsp;<span class="ident" id="5236352">rest</span>&nbsp;<span class="op" id="5236357">:=</span>&nbsp;<span class="ident" id="5236360">p</span><span class="op" id="5236361">.</span><span class="ident" id="5236362">parsePerlClassEscape</span><span class="op" id="5236382">(</span><span class="ident" id="5236383">t</span><span class="op" id="5236384">,</span>&nbsp;<span class="ident" id="5236386">re</span><span class="op" id="5236388">.</span><span class="ident" id="5236389">Rune0</span><span class="op" id="5236394">[</span><span class="op" id="5236395">:</span><span class="num" id="5236396">0</span><span class="op" id="5236397">]</span><span class="op" id="5236398">)</span><span class="op" id="5236399">;</span>&nbsp;<span class="ident" id="5236401">r</span>&nbsp;<span class="op" id="5236403">!=</span>&nbsp;<span class="builtintype" id="5236406">nil</span>&nbsp;<span class="op" id="5236410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5236416">re</span><span class="op" id="5236418">.</span><span class="ident" id="5236419">Rune</span>&nbsp;<span class="op" id="5236424">=</span>&nbsp;<span class="ident" id="5236426">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5236432">t</span>&nbsp;<span class="op" id="5236434">=</span>&nbsp;<span class="ident" id="5236436">rest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5236445">p</span><span class="op" id="5236446">.</span><span class="ident" id="5236447">push</span><span class="op" id="5236451">(</span><span class="ident" id="5236452">re</span><span class="op" id="5236454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5236460">break</span>&nbsp;<span class="ident" id="5236466">BigSwitch</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5236479">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5236484">p</span><span class="op" id="5236485">.</span><span class="ident" id="5236486">reuse</span><span class="op" id="5236491">(</span><span class="ident" id="5236492">re</span><span class="op" id="5236494">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5236500">//&nbsp;Ordinary&nbsp;single-character&nbsp;escape.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5236540">if</span>&nbsp;<span class="ident" id="5236543">c</span><span class="op" id="5236544">,</span>&nbsp;<span class="ident" id="5236546">t</span><span class="op" id="5236547">,</span>&nbsp;<span class="ident" id="5236549">err</span>&nbsp;<span class="op" id="5236553">=</span>&nbsp;<span class="ident" id="5236555">p</span><span class="op" id="5236556">.</span><span class="ident" id="5236557">parseEscape</span><span class="op" id="5236568">(</span><span class="ident" id="5236569">t</span><span class="op" id="5236570">)</span><span class="op" id="5236571">;</span>&nbsp;<span class="ident" id="5236573">err</span>&nbsp;<span class="op" id="5236577">!=</span>&nbsp;<span class="builtintype" id="5236580">nil</span>&nbsp;<span class="op" id="5236584">{</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5236590">return</span>&nbsp;<span class="builtintype" id="5236597">nil</span><span class="op" id="5236600">,</span>&nbsp;<span class="ident" id="5236602">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5236609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5236614">p</span><span class="op" id="5236615">.</span><span class="ident" id="5236616">literal</span><span class="op" id="5236623">(</span><span class="ident" id="5236624">c</span><span class="op" id="5236625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5236629">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5236633">lastRepeat</span>&nbsp;<span class="op" id="5236644">=</span>&nbsp;<span class="ident" id="5236646">repeat</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5236654">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5236658">p</span><span class="op" id="5236659">.</span><span class="ident" id="5236660">concat</span><span class="op" id="5236666">(</span><span class="op" id="5236667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5236670">if</span>&nbsp;<span class="ident" id="5236673">p</span><span class="op" id="5236674">.</span><span class="ident" id="5236675">swapVerticalBar</span><span class="op" id="5236690">(</span><span class="op" id="5236691">)</span>&nbsp;<span class="op" id="5236693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5236697">//&nbsp;pop&nbsp;vertical&nbsp;bar</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5236719">p</span><span class="op" id="5236720">.</span><span class="ident" id="5236721">stack</span>&nbsp;<span class="op" id="5236727">=</span>&nbsp;<span class="ident" id="5236729">p</span><span class="op" id="5236730">.</span><span class="ident" id="5236731">stack</span><span class="op" id="5236736">[</span><span class="op" id="5236737">:</span><span class="builtinfunc" id="5236738">len</span><span class="op" id="5236741">(</span><span class="ident" id="5236742">p</span><span class="op" id="5236743">.</span><span class="ident" id="5236744">stack</span><span class="op" id="5236749">)</span><span class="op" id="5236750">-</span><span class="num" id="5236751">1</span><span class="op" id="5236752">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5236755">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5236758">p</span><span class="op" id="5236759">.</span><span class="ident" id="5236760">alternate</span><span class="op" id="5236769">(</span><span class="op" id="5236770">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5236774">n</span>&nbsp;<span class="op" id="5236776">:=</span>&nbsp;<span class="builtinfunc" id="5236779">len</span><span class="op" id="5236782">(</span><span class="ident" id="5236783">p</span><span class="op" id="5236784">.</span><span class="ident" id="5236785">stack</span><span class="op" id="5236790">)</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5236793">if</span>&nbsp;<span class="ident" id="5236796">n</span>&nbsp;<span class="op" id="5236798">!=</span>&nbsp;<span class="num" id="5236801">1</span>&nbsp;<span class="op" id="5236803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5236807">return</span>&nbsp;<span class="builtintype" id="5236814">nil</span><span class="op" id="5236817">,</span>&nbsp;<span class="op" id="5236819">&amp;</span><span class="ident" id="5236820">Error</span><span class="op" id="5236825">{</span><span class="ident" id="5236826">ErrMissingParen</span><span class="op" id="5236841">,</span>&nbsp;<span class="ident" id="5236843">s</span><span class="op" id="5236844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5236847">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5236850">return</span>&nbsp;<span class="ident" id="5236857">p</span><span class="op" id="5236858">.</span><span class="ident" id="5236859">stack</span><span class="op" id="5236864">[</span><span class="num" id="5236865">0</span><span class="op" id="5236866">]</span><span class="op" id="5236867">,</span>&nbsp;<span class="builtintype" id="5236869">nil</span><br>
<span class="lineno"></span><span class="op" id="5236873">}</span><br>
<span class="lineno">890</span><br>
<span class="lineno"></span><span class="comment" id="5236876">//&nbsp;parseRepeat&nbsp;parses&nbsp;{min}&nbsp;(max=min)&nbsp;or&nbsp;{min,}&nbsp;(max=-1)&nbsp;or&nbsp;{min,max}.</span><br>
<span class="lineno"></span><span class="comment" id="5236947">//&nbsp;If&nbsp;s&nbsp;is&nbsp;not&nbsp;of&nbsp;that&nbsp;form,&nbsp;it&nbsp;returns&nbsp;ok&nbsp;==&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="5237000">//&nbsp;If&nbsp;s&nbsp;has&nbsp;the&nbsp;right&nbsp;form&nbsp;but&nbsp;the&nbsp;values&nbsp;are&nbsp;too&nbsp;big,&nbsp;it&nbsp;returns&nbsp;min&nbsp;==&nbsp;-1,&nbsp;ok&nbsp;==&nbsp;true.</span><br>
<span class="lineno"></span><span class="keyword" id="5237089">func</span>&nbsp;<span class="op" id="5237094">(</span><span class="ident" id="5237095">p</span>&nbsp;<span class="op" id="5237097">*</span><span class="ident" id="5237098">parser</span><span class="op" id="5237104">)</span>&nbsp;<span class="ident" id="5237106">parseRepeat</span><span class="op" id="5237117">(</span><span class="ident" id="5237118">s</span>&nbsp;<span class="builtintype" id="5237120">string</span><span class="op" id="5237126">)</span>&nbsp;<span class="op" id="5237128">(</span><span class="ident" id="5237129">min</span><span class="op" id="5237132">,</span>&nbsp;<span class="ident" id="5237134">max</span>&nbsp;<span class="builtintype" id="5237138">int</span><span class="op" id="5237141">,</span>&nbsp;<span class="ident" id="5237143">rest</span>&nbsp;<span class="builtintype" id="5237148">string</span><span class="op" id="5237154">,</span>&nbsp;<span class="ident" id="5237156">ok</span>&nbsp;<span class="builtintype" id="5237159">bool</span><span class="op" id="5237163">)</span>&nbsp;<span class="op" id="5237165">{</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5237168">if</span>&nbsp;<span class="ident" id="5237171">s</span>&nbsp;<span class="op" id="5237173">==</span>&nbsp;<span class="string" id="5237176">&#34;&#34;</span>&nbsp;<span class="op" id="5237179">||</span>&nbsp;<span class="ident" id="5237182">s</span><span class="op" id="5237183">[</span><span class="num" id="5237184">0</span><span class="op" id="5237185">]</span>&nbsp;<span class="op" id="5237187">!=</span>&nbsp;<span class="string" id="5237190">&#39;{&#39;</span>&nbsp;<span class="op" id="5237194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5237198">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5237206">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5237209">s</span>&nbsp;<span class="op" id="5237211">=</span>&nbsp;<span class="ident" id="5237213">s</span><span class="op" id="5237214">[</span><span class="num" id="5237215">1</span><span class="op" id="5237216">:</span><span class="op" id="5237217">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5237220">var</span>&nbsp;<span class="ident" id="5237224">ok1</span>&nbsp;<span class="builtintype" id="5237228">bool</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5237234">if</span>&nbsp;<span class="ident" id="5237237">min</span><span class="op" id="5237240">,</span>&nbsp;<span class="ident" id="5237242">s</span><span class="op" id="5237243">,</span>&nbsp;<span class="ident" id="5237245">ok1</span>&nbsp;<span class="op" id="5237249">=</span>&nbsp;<span class="ident" id="5237251">p</span><span class="op" id="5237252">.</span><span class="ident" id="5237253">parseInt</span><span class="op" id="5237261">(</span><span class="ident" id="5237262">s</span><span class="op" id="5237263">)</span><span class="op" id="5237264">;</span>&nbsp;<span class="op" id="5237266">!</span><span class="ident" id="5237267">ok1</span>&nbsp;<span class="op" id="5237271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5237275">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5237283">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5237286">if</span>&nbsp;<span class="ident" id="5237289">s</span>&nbsp;<span class="op" id="5237291">==</span>&nbsp;<span class="string" id="5237294">&#34;&#34;</span>&nbsp;<span class="op" id="5237297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5237301">return</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5237309">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5237312">if</span>&nbsp;<span class="ident" id="5237315">s</span><span class="op" id="5237316">[</span><span class="num" id="5237317">0</span><span class="op" id="5237318">]</span>&nbsp;<span class="op" id="5237320">!=</span>&nbsp;<span class="string" id="5237323">&#39;,&#39;</span>&nbsp;<span class="op" id="5237327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5237331">max</span>&nbsp;<span class="op" id="5237335">=</span>&nbsp;<span class="ident" id="5237337">min</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5237342">}</span>&nbsp;<span class="keyword" id="5237344">else</span>&nbsp;<span class="op" id="5237349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5237353">s</span>&nbsp;<span class="op" id="5237355">=</span>&nbsp;<span class="ident" id="5237357">s</span><span class="op" id="5237358">[</span><span class="num" id="5237359">1</span><span class="op" id="5237360">:</span><span class="op" id="5237361">]</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5237365">if</span>&nbsp;<span class="ident" id="5237368">s</span>&nbsp;<span class="op" id="5237370">==</span>&nbsp;<span class="string" id="5237373">&#34;&#34;</span>&nbsp;<span class="op" id="5237376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5237381">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5237390">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5237394">if</span>&nbsp;<span class="ident" id="5237397">s</span><span class="op" id="5237398">[</span><span class="num" id="5237399">0</span><span class="op" id="5237400">]</span>&nbsp;<span class="op" id="5237402">==</span>&nbsp;<span class="string" id="5237405">&#39;}&#39;</span>&nbsp;<span class="op" id="5237409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5237414">max</span>&nbsp;<span class="op" id="5237418">=</span>&nbsp;<span class="op" id="5237420">-</span><span class="num" id="5237421">1</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5237425">}</span>&nbsp;<span class="keyword" id="5237427">else</span>&nbsp;<span class="keyword" id="5237432">if</span>&nbsp;<span class="ident" id="5237435">max</span><span class="op" id="5237438">,</span>&nbsp;<span class="ident" id="5237440">s</span><span class="op" id="5237441">,</span>&nbsp;<span class="ident" id="5237443">ok1</span>&nbsp;<span class="op" id="5237447">=</span>&nbsp;<span class="ident" id="5237449">p</span><span class="op" id="5237450">.</span><span class="ident" id="5237451">parseInt</span><span class="op" id="5237459">(</span><span class="ident" id="5237460">s</span><span class="op" id="5237461">)</span><span class="op" id="5237462">;</span>&nbsp;<span class="op" id="5237464">!</span><span class="ident" id="5237465">ok1</span>&nbsp;<span class="op" id="5237469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5237474">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5237483">}</span>&nbsp;<span class="keyword" id="5237485">else</span>&nbsp;<span class="keyword" id="5237490">if</span>&nbsp;<span class="ident" id="5237493">max</span>&nbsp;<span class="op" id="5237497">&lt;</span>&nbsp;<span class="num" id="5237499">0</span>&nbsp;<span class="op" id="5237501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5237506">//&nbsp;parseInt&nbsp;found&nbsp;too&nbsp;big&nbsp;a&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5237544">min</span>&nbsp;<span class="op" id="5237548">=</span>&nbsp;<span class="op" id="5237550">-</span><span class="num" id="5237551">1</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5237555">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5237558">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5237561">if</span>&nbsp;<span class="ident" id="5237564">s</span>&nbsp;<span class="op" id="5237566">==</span>&nbsp;<span class="string" id="5237569">&#34;&#34;</span>&nbsp;<span class="op" id="5237572">||</span>&nbsp;<span class="ident" id="5237575">s</span><span class="op" id="5237576">[</span><span class="num" id="5237577">0</span><span class="op" id="5237578">]</span>&nbsp;<span class="op" id="5237580">!=</span>&nbsp;<span class="string" id="5237583">&#39;}&#39;</span>&nbsp;<span class="op" id="5237587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5237591">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5237599">}</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5237602">rest</span>&nbsp;<span class="op" id="5237607">=</span>&nbsp;<span class="ident" id="5237609">s</span><span class="op" id="5237610">[</span><span class="num" id="5237611">1</span><span class="op" id="5237612">:</span><span class="op" id="5237613">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5237616">ok</span>&nbsp;<span class="op" id="5237619">=</span>&nbsp;<span class="builtintype" id="5237621">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5237627">return</span><br>
<span class="lineno"></span><span class="op" id="5237634">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">930</span><span class="comment" id="5237637">//&nbsp;parsePerlFlags&nbsp;parses&nbsp;a&nbsp;Perl&nbsp;flag&nbsp;setting&nbsp;or&nbsp;non-capturing&nbsp;group&nbsp;or&nbsp;both,</span><br>
<span class="lineno"></span><span class="comment" id="5237714">//&nbsp;like&nbsp;(?i)&nbsp;or&nbsp;(?:&nbsp;or&nbsp;(?i:.&nbsp;&nbsp;It&nbsp;removes&nbsp;the&nbsp;prefix&nbsp;from&nbsp;s&nbsp;and&nbsp;updates&nbsp;the&nbsp;parse&nbsp;state.</span><br>
<span class="lineno"></span><span class="comment" id="5237802">//&nbsp;The&nbsp;caller&nbsp;must&nbsp;have&nbsp;ensured&nbsp;that&nbsp;s&nbsp;begins&nbsp;with&nbsp;&#34;(?&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="5237859">func</span>&nbsp;<span class="op" id="5237864">(</span><span class="ident" id="5237865">p</span>&nbsp;<span class="op" id="5237867">*</span><span class="ident" id="5237868">parser</span><span class="op" id="5237874">)</span>&nbsp;<span class="ident" id="5237876">parsePerlFlags</span><span class="op" id="5237890">(</span><span class="ident" id="5237891">s</span>&nbsp;<span class="builtintype" id="5237893">string</span><span class="op" id="5237899">)</span>&nbsp;<span class="op" id="5237901">(</span><span class="ident" id="5237902">rest</span>&nbsp;<span class="builtintype" id="5237907">string</span><span class="op" id="5237913">,</span>&nbsp;<span class="ident" id="5237915">err</span>&nbsp;<span class="builtintype" id="5237919">error</span><span class="op" id="5237924">)</span>&nbsp;<span class="op" id="5237926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5237929">t</span>&nbsp;<span class="op" id="5237931">:=</span>&nbsp;<span class="ident" id="5237934">s</span><br>
<span class="lineno">935</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5237938">//&nbsp;Check&nbsp;for&nbsp;named&nbsp;captures,&nbsp;first&nbsp;introduced&nbsp;in&nbsp;Python&#39;s&nbsp;regexp&nbsp;library.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5238013">//&nbsp;As&nbsp;usual,&nbsp;there&nbsp;are&nbsp;three&nbsp;slightly&nbsp;different&nbsp;syntaxes:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5238072">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5238076">//&nbsp;&nbsp;&nbsp;(?P&lt;name&gt;expr)&nbsp;&nbsp;&nbsp;the&nbsp;original,&nbsp;introduced&nbsp;by&nbsp;Python</span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5238134">//&nbsp;&nbsp;&nbsp;(?&lt;name&gt;expr)&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;.NET&nbsp;alteration,&nbsp;adopted&nbsp;by&nbsp;Perl&nbsp;5.10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5238199">//&nbsp;&nbsp;&nbsp;(?&#39;name&#39;expr)&nbsp;&nbsp;&nbsp;&nbsp;another&nbsp;.NET&nbsp;alteration,&nbsp;adopted&nbsp;by&nbsp;Perl&nbsp;5.10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5238268">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5238272">//&nbsp;Perl&nbsp;5.10&nbsp;gave&nbsp;in&nbsp;and&nbsp;implemented&nbsp;the&nbsp;Python&nbsp;version&nbsp;too,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5238334">//&nbsp;but&nbsp;they&nbsp;claim&nbsp;that&nbsp;the&nbsp;last&nbsp;two&nbsp;are&nbsp;the&nbsp;preferred&nbsp;forms.</span><br>
<span class="lineno">945</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5238396">//&nbsp;PCRE&nbsp;and&nbsp;languages&nbsp;based&nbsp;on&nbsp;it&nbsp;(specifically,&nbsp;PHP&nbsp;and&nbsp;Ruby)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5238460">//&nbsp;support&nbsp;all&nbsp;three&nbsp;as&nbsp;well.&nbsp;&nbsp;EcmaScript&nbsp;4&nbsp;uses&nbsp;only&nbsp;the&nbsp;Python&nbsp;form.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5238532">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5238536">//&nbsp;In&nbsp;both&nbsp;the&nbsp;open&nbsp;source&nbsp;world&nbsp;(via&nbsp;Code&nbsp;Search)&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5238596">//&nbsp;Google&nbsp;source&nbsp;tree,&nbsp;(?P&lt;expr&gt;name)&nbsp;is&nbsp;the&nbsp;dominant&nbsp;form,</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5238657">//&nbsp;so&nbsp;that&#39;s&nbsp;the&nbsp;one&nbsp;we&nbsp;implement.&nbsp;&nbsp;One&nbsp;is&nbsp;enough.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5238709">if</span>&nbsp;<span class="builtinfunc" id="5238712">len</span><span class="op" id="5238715">(</span><span class="ident" id="5238716">t</span><span class="op" id="5238717">)</span>&nbsp;<span class="op" id="5238719">&gt;</span>&nbsp;<span class="num" id="5238721">4</span>&nbsp;<span class="op" id="5238723">&amp;&amp;</span>&nbsp;<span class="ident" id="5238726">t</span><span class="op" id="5238727">[</span><span class="num" id="5238728">2</span><span class="op" id="5238729">]</span>&nbsp;<span class="op" id="5238731">==</span>&nbsp;<span class="string" id="5238734">&#39;P&#39;</span>&nbsp;<span class="op" id="5238738">&amp;&amp;</span>&nbsp;<span class="ident" id="5238741">t</span><span class="op" id="5238742">[</span><span class="num" id="5238743">3</span><span class="op" id="5238744">]</span>&nbsp;<span class="op" id="5238746">==</span>&nbsp;<span class="string" id="5238749">&#39;&lt;&#39;</span>&nbsp;<span class="op" id="5238753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5238757">//&nbsp;Pull&nbsp;out&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5238777">end</span>&nbsp;<span class="op" id="5238781">:=</span>&nbsp;<span class="ident" id="5238784">strings</span><span class="op" id="5238791">.</span><span class="ident" id="5238792">IndexRune</span><span class="op" id="5238801">(</span><span class="ident" id="5238802">t</span><span class="op" id="5238803">,</span>&nbsp;<span class="string" id="5238805">&#39;&gt;&#39;</span><span class="op" id="5238808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5238812">if</span>&nbsp;<span class="ident" id="5238815">end</span>&nbsp;<span class="op" id="5238819">&lt;</span>&nbsp;<span class="num" id="5238821">0</span>&nbsp;<span class="op" id="5238823">{</span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5238828">if</span>&nbsp;<span class="ident" id="5238831">err</span>&nbsp;<span class="op" id="5238835">=</span>&nbsp;<span class="ident" id="5238837">checkUTF8</span><span class="op" id="5238846">(</span><span class="ident" id="5238847">t</span><span class="op" id="5238848">)</span><span class="op" id="5238849">;</span>&nbsp;<span class="ident" id="5238851">err</span>&nbsp;<span class="op" id="5238855">!=</span>&nbsp;<span class="builtintype" id="5238858">nil</span>&nbsp;<span class="op" id="5238862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5238868">return</span>&nbsp;<span class="string" id="5238875">&#34;&#34;</span><span class="op" id="5238877">,</span>&nbsp;<span class="ident" id="5238879">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5238886">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5238891">return</span>&nbsp;<span class="string" id="5238898">&#34;&#34;</span><span class="op" id="5238900">,</span>&nbsp;<span class="op" id="5238902">&amp;</span><span class="ident" id="5238903">Error</span><span class="op" id="5238908">{</span><span class="ident" id="5238909">ErrInvalidNamedCapture</span><span class="op" id="5238931">,</span>&nbsp;<span class="ident" id="5238933">s</span><span class="op" id="5238934">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5238938">}</span><br>
<span class="lineno">960</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5238943">capture</span>&nbsp;<span class="op" id="5238951">:=</span>&nbsp;<span class="ident" id="5238954">t</span><span class="op" id="5238955">[</span><span class="op" id="5238956">:</span><span class="ident" id="5238957">end</span><span class="op" id="5238960">+</span><span class="num" id="5238961">1</span><span class="op" id="5238962">]</span>&nbsp;<span class="comment" id="5238964">//&nbsp;&#34;(?P&lt;name&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5238981">name</span>&nbsp;<span class="op" id="5238986">:=</span>&nbsp;<span class="ident" id="5238989">t</span><span class="op" id="5238990">[</span><span class="num" id="5238991">4</span><span class="op" id="5238992">:</span><span class="ident" id="5238993">end</span><span class="op" id="5238996">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5239002">//&nbsp;&#34;name&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5239014">if</span>&nbsp;<span class="ident" id="5239017">err</span>&nbsp;<span class="op" id="5239021">=</span>&nbsp;<span class="ident" id="5239023">checkUTF8</span><span class="op" id="5239032">(</span><span class="ident" id="5239033">name</span><span class="op" id="5239037">)</span><span class="op" id="5239038">;</span>&nbsp;<span class="ident" id="5239040">err</span>&nbsp;<span class="op" id="5239044">!=</span>&nbsp;<span class="builtintype" id="5239047">nil</span>&nbsp;<span class="op" id="5239051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5239056">return</span>&nbsp;<span class="string" id="5239063">&#34;&#34;</span><span class="op" id="5239065">,</span>&nbsp;<span class="ident" id="5239067">err</span><br>
<span class="lineno">965</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5239073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5239077">if</span>&nbsp;<span class="op" id="5239080">!</span><span class="ident" id="5239081">isValidCaptureName</span><span class="op" id="5239099">(</span><span class="ident" id="5239100">name</span><span class="op" id="5239104">)</span>&nbsp;<span class="op" id="5239106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5239111">return</span>&nbsp;<span class="string" id="5239118">&#34;&#34;</span><span class="op" id="5239120">,</span>&nbsp;<span class="op" id="5239122">&amp;</span><span class="ident" id="5239123">Error</span><span class="op" id="5239128">{</span><span class="ident" id="5239129">ErrInvalidNamedCapture</span><span class="op" id="5239151">,</span>&nbsp;<span class="ident" id="5239153">capture</span><span class="op" id="5239160">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5239164">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">970</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5239169">//&nbsp;Like&nbsp;ordinary&nbsp;capture,&nbsp;but&nbsp;named.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5239208">p</span><span class="op" id="5239209">.</span><span class="ident" id="5239210">numCap</span><span class="op" id="5239216">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5239221">re</span>&nbsp;<span class="op" id="5239224">:=</span>&nbsp;<span class="ident" id="5239227">p</span><span class="op" id="5239228">.</span><span class="ident" id="5239229">op</span><span class="op" id="5239231">(</span><span class="ident" id="5239232">opLeftParen</span><span class="op" id="5239243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5239247">re</span><span class="op" id="5239249">.</span><span class="ident" id="5239250">Cap</span>&nbsp;<span class="op" id="5239254">=</span>&nbsp;<span class="ident" id="5239256">p</span><span class="op" id="5239257">.</span><span class="ident" id="5239258">numCap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5239267">re</span><span class="op" id="5239269">.</span><span class="ident" id="5239270">Name</span>&nbsp;<span class="op" id="5239275">=</span>&nbsp;<span class="ident" id="5239277">name</span><br>
<span class="lineno">975</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5239284">return</span>&nbsp;<span class="ident" id="5239291">t</span><span class="op" id="5239292">[</span><span class="ident" id="5239293">end</span><span class="op" id="5239296">+</span><span class="num" id="5239297">1</span><span class="op" id="5239298">:</span><span class="op" id="5239299">]</span><span class="op" id="5239300">,</span>&nbsp;<span class="builtintype" id="5239302">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5239307">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5239311">//&nbsp;Non-capturing&nbsp;group.&nbsp;&nbsp;Might&nbsp;also&nbsp;twiddle&nbsp;Perl&nbsp;flags.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5239368">var</span>&nbsp;<span class="ident" id="5239372">c</span>&nbsp;<span class="builtintype" id="5239374">rune</span><br>
<span class="lineno">980</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5239380">t</span>&nbsp;<span class="op" id="5239382">=</span>&nbsp;<span class="ident" id="5239384">t</span><span class="op" id="5239385">[</span><span class="num" id="5239386">2</span><span class="op" id="5239387">:</span><span class="op" id="5239388">]</span>&nbsp;<span class="comment" id="5239390">//&nbsp;skip&nbsp;(?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5239402">flags</span>&nbsp;<span class="op" id="5239408">:=</span>&nbsp;<span class="ident" id="5239411">p</span><span class="op" id="5239412">.</span><span class="ident" id="5239413">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5239420">sign</span>&nbsp;<span class="op" id="5239425">:=</span>&nbsp;<span class="op" id="5239428">+</span><span class="num" id="5239429">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5239432">sawFlag</span>&nbsp;<span class="op" id="5239440">:=</span>&nbsp;<span class="builtintype" id="5239443">false</span><br>
<span class="lineno"></span><span class="ident" id="5239449">Loop</span><span class="op" id="5239453">:</span><br>
<span class="lineno">985</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5239456">for</span>&nbsp;<span class="ident" id="5239460">t</span>&nbsp;<span class="op" id="5239462">!=</span>&nbsp;<span class="string" id="5239465">&#34;&#34;</span>&nbsp;<span class="op" id="5239468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5239472">if</span>&nbsp;<span class="ident" id="5239475">c</span><span class="op" id="5239476">,</span>&nbsp;<span class="ident" id="5239478">t</span><span class="op" id="5239479">,</span>&nbsp;<span class="ident" id="5239481">err</span>&nbsp;<span class="op" id="5239485">=</span>&nbsp;<span class="ident" id="5239487">nextRune</span><span class="op" id="5239495">(</span><span class="ident" id="5239496">t</span><span class="op" id="5239497">)</span><span class="op" id="5239498">;</span>&nbsp;<span class="ident" id="5239500">err</span>&nbsp;<span class="op" id="5239504">!=</span>&nbsp;<span class="builtintype" id="5239507">nil</span>&nbsp;<span class="op" id="5239511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5239516">return</span>&nbsp;<span class="string" id="5239523">&#34;&#34;</span><span class="op" id="5239525">,</span>&nbsp;<span class="ident" id="5239527">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5239533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5239537">switch</span>&nbsp;<span class="ident" id="5239544">c</span>&nbsp;<span class="op" id="5239546">{</span><br>
<span class="lineno">990</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5239550">default</span><span class="op" id="5239557">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5239562">break</span>&nbsp;<span class="ident" id="5239568">Loop</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5239576">//&nbsp;Flags.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5239588">case</span>&nbsp;<span class="string" id="5239593">&#39;i&#39;</span><span class="op" id="5239596">:</span><br>
<span class="lineno">995</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5239601">flags</span>&nbsp;<span class="op" id="5239607">|=</span>&nbsp;<span class="ident" id="5239610">FoldCase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5239622">sawFlag</span>&nbsp;<span class="op" id="5239630">=</span>&nbsp;<span class="builtintype" id="5239632">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5239639">case</span>&nbsp;<span class="string" id="5239644">&#39;m&#39;</span><span class="op" id="5239647">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5239652">flags</span>&nbsp;<span class="op" id="5239658">&amp;^=</span>&nbsp;<span class="ident" id="5239662">OneLine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5239673">sawFlag</span>&nbsp;<span class="op" id="5239681">=</span>&nbsp;<span class="builtintype" id="5239683">true</span><br>
<span class="lineno">1000</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5239690">case</span>&nbsp;<span class="string" id="5239695">&#39;s&#39;</span><span class="op" id="5239698">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5239703">flags</span>&nbsp;<span class="op" id="5239709">|=</span>&nbsp;<span class="ident" id="5239712">DotNL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5239721">sawFlag</span>&nbsp;<span class="op" id="5239729">=</span>&nbsp;<span class="builtintype" id="5239731">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5239738">case</span>&nbsp;<span class="string" id="5239743">&#39;U&#39;</span><span class="op" id="5239746">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5239751">flags</span>&nbsp;<span class="op" id="5239757">|=</span>&nbsp;<span class="ident" id="5239760">NonGreedy</span><br>
<span class="lineno">1005</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5239773">sawFlag</span>&nbsp;<span class="op" id="5239781">=</span>&nbsp;<span class="builtintype" id="5239783">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5239791">//&nbsp;Switch&nbsp;to&nbsp;negation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5239816">case</span>&nbsp;<span class="string" id="5239821">&#39;-&#39;</span><span class="op" id="5239824">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5239829">if</span>&nbsp;<span class="ident" id="5239832">sign</span>&nbsp;<span class="op" id="5239837">&lt;</span>&nbsp;<span class="num" id="5239839">0</span>&nbsp;<span class="op" id="5239841">{</span><br>
<span class="lineno">1010</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5239847">break</span>&nbsp;<span class="ident" id="5239853">Loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5239861">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5239866">sign</span>&nbsp;<span class="op" id="5239871">=</span>&nbsp;<span class="op" id="5239873">-</span><span class="num" id="5239874">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5239879">//&nbsp;Invert&nbsp;flags&nbsp;so&nbsp;that&nbsp;|&nbsp;above&nbsp;turn&nbsp;into&nbsp;&amp;^&nbsp;and&nbsp;vice&nbsp;versa.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5239943">//&nbsp;We&#39;ll&nbsp;invert&nbsp;flags&nbsp;again&nbsp;before&nbsp;using&nbsp;it&nbsp;below.</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5239997">flags</span>&nbsp;<span class="op" id="5240003">=</span>&nbsp;<span class="op" id="5240005">^</span><span class="ident" id="5240006">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5240015">sawFlag</span>&nbsp;<span class="op" id="5240023">=</span>&nbsp;<span class="builtintype" id="5240025">false</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5240034">//&nbsp;End&nbsp;of&nbsp;flags,&nbsp;starting&nbsp;group&nbsp;or&nbsp;not.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5240076">case</span>&nbsp;<span class="string" id="5240081">&#39;:&#39;</span><span class="op" id="5240084">,</span>&nbsp;<span class="string" id="5240086">&#39;)&#39;</span><span class="op" id="5240089">:</span><br>
<span class="lineno">1020</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5240094">if</span>&nbsp;<span class="ident" id="5240097">sign</span>&nbsp;<span class="op" id="5240102">&lt;</span>&nbsp;<span class="num" id="5240104">0</span>&nbsp;<span class="op" id="5240106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5240112">if</span>&nbsp;<span class="op" id="5240115">!</span><span class="ident" id="5240116">sawFlag</span>&nbsp;<span class="op" id="5240124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5240131">break</span>&nbsp;<span class="ident" id="5240137">Loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5240146">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5240152">flags</span>&nbsp;<span class="op" id="5240158">=</span>&nbsp;<span class="op" id="5240160">^</span><span class="ident" id="5240161">flags</span><br>
<span class="lineno">1025</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5240170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5240175">if</span>&nbsp;<span class="ident" id="5240178">c</span>&nbsp;<span class="op" id="5240180">==</span>&nbsp;<span class="string" id="5240183">&#39;:&#39;</span>&nbsp;<span class="op" id="5240187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5240193">//&nbsp;Open&nbsp;new&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5240215">p</span><span class="op" id="5240216">.</span><span class="ident" id="5240217">op</span><span class="op" id="5240219">(</span><span class="ident" id="5240220">opLeftParen</span><span class="op" id="5240231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5240236">}</span><br>
<span class="lineno">1030</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5240241">p</span><span class="op" id="5240242">.</span><span class="ident" id="5240243">flags</span>&nbsp;<span class="op" id="5240249">=</span>&nbsp;<span class="ident" id="5240251">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5240260">return</span>&nbsp;<span class="ident" id="5240267">t</span><span class="op" id="5240268">,</span>&nbsp;<span class="builtintype" id="5240270">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5240276">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5240279">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5240283">return</span>&nbsp;<span class="string" id="5240290">&#34;&#34;</span><span class="op" id="5240292">,</span>&nbsp;<span class="op" id="5240294">&amp;</span><span class="ident" id="5240295">Error</span><span class="op" id="5240300">{</span><span class="ident" id="5240301">ErrInvalidPerlOp</span><span class="op" id="5240317">,</span>&nbsp;<span class="ident" id="5240319">s</span><span class="op" id="5240320">[</span><span class="op" id="5240321">:</span><span class="builtinfunc" id="5240322">len</span><span class="op" id="5240325">(</span><span class="ident" id="5240326">s</span><span class="op" id="5240327">)</span><span class="op" id="5240328">-</span><span class="builtinfunc" id="5240329">len</span><span class="op" id="5240332">(</span><span class="ident" id="5240333">t</span><span class="op" id="5240334">)</span><span class="op" id="5240335">]</span><span class="op" id="5240336">}</span><br>
<span class="lineno"></span><span class="op" id="5240338">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5240341">//&nbsp;isValidCaptureName&nbsp;reports&nbsp;whether&nbsp;name</span><br>
<span class="lineno"></span><span class="comment" id="5240384">//&nbsp;is&nbsp;a&nbsp;valid&nbsp;capture&nbsp;name:&nbsp;[A-Za-z0-9_]+.</span><br>
<span class="lineno">1040</span><span class="comment" id="5240427">//&nbsp;PCRE&nbsp;limits&nbsp;names&nbsp;to&nbsp;32&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="comment" id="5240461">//&nbsp;Python&nbsp;rejects&nbsp;names&nbsp;starting&nbsp;with&nbsp;digits.</span><br>
<span class="lineno"></span><span class="comment" id="5240507">//&nbsp;We&nbsp;don&#39;t&nbsp;enforce&nbsp;either&nbsp;of&nbsp;those.</span><br>
<span class="lineno"></span><span class="keyword" id="5240544">func</span>&nbsp;<span class="ident" id="5240549">isValidCaptureName</span><span class="op" id="5240567">(</span><span class="ident" id="5240568">name</span>&nbsp;<span class="builtintype" id="5240573">string</span><span class="op" id="5240579">)</span>&nbsp;<span class="builtintype" id="5240581">bool</span>&nbsp;<span class="op" id="5240586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5240589">if</span>&nbsp;<span class="ident" id="5240592">name</span>&nbsp;<span class="op" id="5240597">==</span>&nbsp;<span class="string" id="5240600">&#34;&#34;</span>&nbsp;<span class="op" id="5240603">{</span><br>
<span class="lineno">1045</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5240607">return</span>&nbsp;<span class="builtintype" id="5240614">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5240621">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5240624">for</span>&nbsp;<span class="ident" id="5240628">_</span><span class="op" id="5240629">,</span>&nbsp;<span class="ident" id="5240631">c</span>&nbsp;<span class="op" id="5240633">:=</span>&nbsp;<span class="keyword" id="5240636">range</span>&nbsp;<span class="ident" id="5240642">name</span>&nbsp;<span class="op" id="5240647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5240651">if</span>&nbsp;<span class="ident" id="5240654">c</span>&nbsp;<span class="op" id="5240656">!=</span>&nbsp;<span class="string" id="5240659">&#39;_&#39;</span>&nbsp;<span class="op" id="5240663">&amp;&amp;</span>&nbsp;<span class="op" id="5240666">!</span><span class="ident" id="5240667">isalnum</span><span class="op" id="5240674">(</span><span class="ident" id="5240675">c</span><span class="op" id="5240676">)</span>&nbsp;<span class="op" id="5240678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5240683">return</span>&nbsp;<span class="builtintype" id="5240690">false</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5240698">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5240701">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5240704">return</span>&nbsp;<span class="builtintype" id="5240711">true</span><br>
<span class="lineno"></span><span class="op" id="5240716">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1055</span><span class="comment" id="5240719">//&nbsp;parseInt&nbsp;parses&nbsp;a&nbsp;decimal&nbsp;integer.</span><br>
<span class="lineno"></span><span class="keyword" id="5240757">func</span>&nbsp;<span class="op" id="5240762">(</span><span class="ident" id="5240763">p</span>&nbsp;<span class="op" id="5240765">*</span><span class="ident" id="5240766">parser</span><span class="op" id="5240772">)</span>&nbsp;<span class="ident" id="5240774">parseInt</span><span class="op" id="5240782">(</span><span class="ident" id="5240783">s</span>&nbsp;<span class="builtintype" id="5240785">string</span><span class="op" id="5240791">)</span>&nbsp;<span class="op" id="5240793">(</span><span class="ident" id="5240794">n</span>&nbsp;<span class="builtintype" id="5240796">int</span><span class="op" id="5240799">,</span>&nbsp;<span class="ident" id="5240801">rest</span>&nbsp;<span class="builtintype" id="5240806">string</span><span class="op" id="5240812">,</span>&nbsp;<span class="ident" id="5240814">ok</span>&nbsp;<span class="builtintype" id="5240817">bool</span><span class="op" id="5240821">)</span>&nbsp;<span class="op" id="5240823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5240826">if</span>&nbsp;<span class="ident" id="5240829">s</span>&nbsp;<span class="op" id="5240831">==</span>&nbsp;<span class="string" id="5240834">&#34;&#34;</span>&nbsp;<span class="op" id="5240837">||</span>&nbsp;<span class="ident" id="5240840">s</span><span class="op" id="5240841">[</span><span class="num" id="5240842">0</span><span class="op" id="5240843">]</span>&nbsp;<span class="op" id="5240845">&lt;</span>&nbsp;<span class="string" id="5240847">&#39;0&#39;</span>&nbsp;<span class="op" id="5240851">||</span>&nbsp;<span class="string" id="5240854">&#39;9&#39;</span>&nbsp;<span class="op" id="5240858">&lt;</span>&nbsp;<span class="ident" id="5240860">s</span><span class="op" id="5240861">[</span><span class="num" id="5240862">0</span><span class="op" id="5240863">]</span>&nbsp;<span class="op" id="5240865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5240869">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5240877">}</span><br>
<span class="lineno">1060</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5240880">//&nbsp;Disallow&nbsp;leading&nbsp;zeros.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5240908">if</span>&nbsp;<span class="builtinfunc" id="5240911">len</span><span class="op" id="5240914">(</span><span class="ident" id="5240915">s</span><span class="op" id="5240916">)</span>&nbsp;<span class="op" id="5240918">&gt;=</span>&nbsp;<span class="num" id="5240921">2</span>&nbsp;<span class="op" id="5240923">&amp;&amp;</span>&nbsp;<span class="ident" id="5240926">s</span><span class="op" id="5240927">[</span><span class="num" id="5240928">0</span><span class="op" id="5240929">]</span>&nbsp;<span class="op" id="5240931">==</span>&nbsp;<span class="string" id="5240934">&#39;0&#39;</span>&nbsp;<span class="op" id="5240938">&amp;&amp;</span>&nbsp;<span class="string" id="5240941">&#39;0&#39;</span>&nbsp;<span class="op" id="5240945">&lt;=</span>&nbsp;<span class="ident" id="5240948">s</span><span class="op" id="5240949">[</span><span class="num" id="5240950">1</span><span class="op" id="5240951">]</span>&nbsp;<span class="op" id="5240953">&amp;&amp;</span>&nbsp;<span class="ident" id="5240956">s</span><span class="op" id="5240957">[</span><span class="num" id="5240958">1</span><span class="op" id="5240959">]</span>&nbsp;<span class="op" id="5240961">&lt;=</span>&nbsp;<span class="string" id="5240964">&#39;9&#39;</span>&nbsp;<span class="op" id="5240968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5240972">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5240980">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5240983">t</span>&nbsp;<span class="op" id="5240985">:=</span>&nbsp;<span class="ident" id="5240988">s</span><br>
<span class="lineno">1065</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5240991">for</span>&nbsp;<span class="ident" id="5240995">s</span>&nbsp;<span class="op" id="5240997">!=</span>&nbsp;<span class="string" id="5241000">&#34;&#34;</span>&nbsp;<span class="op" id="5241003">&amp;&amp;</span>&nbsp;<span class="string" id="5241006">&#39;0&#39;</span>&nbsp;<span class="op" id="5241010">&lt;=</span>&nbsp;<span class="ident" id="5241013">s</span><span class="op" id="5241014">[</span><span class="num" id="5241015">0</span><span class="op" id="5241016">]</span>&nbsp;<span class="op" id="5241018">&amp;&amp;</span>&nbsp;<span class="ident" id="5241021">s</span><span class="op" id="5241022">[</span><span class="num" id="5241023">0</span><span class="op" id="5241024">]</span>&nbsp;<span class="op" id="5241026">&lt;=</span>&nbsp;<span class="string" id="5241029">&#39;9&#39;</span>&nbsp;<span class="op" id="5241033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5241037">s</span>&nbsp;<span class="op" id="5241039">=</span>&nbsp;<span class="ident" id="5241041">s</span><span class="op" id="5241042">[</span><span class="num" id="5241043">1</span><span class="op" id="5241044">:</span><span class="op" id="5241045">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5241048">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5241051">rest</span>&nbsp;<span class="op" id="5241056">=</span>&nbsp;<span class="ident" id="5241058">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5241061">ok</span>&nbsp;<span class="op" id="5241064">=</span>&nbsp;<span class="builtintype" id="5241066">true</span><br>
<span class="lineno">1070</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5241072">//&nbsp;Have&nbsp;digits,&nbsp;compute&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5241104">t</span>&nbsp;<span class="op" id="5241106">=</span>&nbsp;<span class="ident" id="5241108">t</span><span class="op" id="5241109">[</span><span class="op" id="5241110">:</span><span class="builtinfunc" id="5241111">len</span><span class="op" id="5241114">(</span><span class="ident" id="5241115">t</span><span class="op" id="5241116">)</span><span class="op" id="5241117">-</span><span class="builtinfunc" id="5241118">len</span><span class="op" id="5241121">(</span><span class="ident" id="5241122">s</span><span class="op" id="5241123">)</span><span class="op" id="5241124">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5241127">for</span>&nbsp;<span class="ident" id="5241131">i</span>&nbsp;<span class="op" id="5241133">:=</span>&nbsp;<span class="num" id="5241136">0</span><span class="op" id="5241137">;</span>&nbsp;<span class="ident" id="5241139">i</span>&nbsp;<span class="op" id="5241141">&lt;</span>&nbsp;<span class="builtinfunc" id="5241143">len</span><span class="op" id="5241146">(</span><span class="ident" id="5241147">t</span><span class="op" id="5241148">)</span><span class="op" id="5241149">;</span>&nbsp;<span class="ident" id="5241151">i</span><span class="op" id="5241152">++</span>&nbsp;<span class="op" id="5241155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5241159">//&nbsp;Avoid&nbsp;overflow.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5241180">if</span>&nbsp;<span class="ident" id="5241183">n</span>&nbsp;<span class="op" id="5241185">&gt;=</span>&nbsp;<span class="num" id="5241188">1e8</span>&nbsp;<span class="op" id="5241192">{</span><br>
<span class="lineno">1075</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5241197">n</span>&nbsp;<span class="op" id="5241199">=</span>&nbsp;<span class="op" id="5241201">-</span><span class="num" id="5241202">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5241207">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5241215">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5241219">n</span>&nbsp;<span class="op" id="5241221">=</span>&nbsp;<span class="ident" id="5241223">n</span><span class="op" id="5241224">*</span><span class="num" id="5241225">10</span>&nbsp;<span class="op" id="5241228">+</span>&nbsp;<span class="builtintype" id="5241230">int</span><span class="op" id="5241233">(</span><span class="ident" id="5241234">t</span><span class="op" id="5241235">[</span><span class="ident" id="5241236">i</span><span class="op" id="5241237">]</span><span class="op" id="5241238">)</span>&nbsp;<span class="op" id="5241240">-</span>&nbsp;<span class="string" id="5241242">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5241247">}</span><br>
<span class="lineno">1080</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5241250">return</span><br>
<span class="lineno"></span><span class="op" id="5241257">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5241260">//&nbsp;can&nbsp;this&nbsp;be&nbsp;represented&nbsp;as&nbsp;a&nbsp;character&nbsp;class?</span><br>
<span class="lineno"></span><span class="comment" id="5241309">//&nbsp;single-rune&nbsp;literal&nbsp;string,&nbsp;char&nbsp;class,&nbsp;.,&nbsp;and&nbsp;.|\n.</span><br>
<span class="lineno">1085</span><span class="keyword" id="5241365">func</span>&nbsp;<span class="ident" id="5241370">isCharClass</span><span class="op" id="5241381">(</span><span class="ident" id="5241382">re</span>&nbsp;<span class="op" id="5241385">*</span><span class="ident" id="5241386">Regexp</span><span class="op" id="5241392">)</span>&nbsp;<span class="builtintype" id="5241394">bool</span>&nbsp;<span class="op" id="5241399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5241402">return</span>&nbsp;<span class="ident" id="5241409">re</span><span class="op" id="5241411">.</span><span class="ident" id="5241412">Op</span>&nbsp;<span class="op" id="5241415">==</span>&nbsp;<span class="ident" id="5241418">OpLiteral</span>&nbsp;<span class="op" id="5241428">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5241431">len</span><span class="op" id="5241434">(</span><span class="ident" id="5241435">re</span><span class="op" id="5241437">.</span><span class="ident" id="5241438">Rune</span><span class="op" id="5241442">)</span>&nbsp;<span class="op" id="5241444">==</span>&nbsp;<span class="num" id="5241447">1</span>&nbsp;<span class="op" id="5241449">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5241454">re</span><span class="op" id="5241456">.</span><span class="ident" id="5241457">Op</span>&nbsp;<span class="op" id="5241460">==</span>&nbsp;<span class="ident" id="5241463">OpCharClass</span>&nbsp;<span class="op" id="5241475">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5241480">re</span><span class="op" id="5241482">.</span><span class="ident" id="5241483">Op</span>&nbsp;<span class="op" id="5241486">==</span>&nbsp;<span class="ident" id="5241489">OpAnyCharNotNL</span>&nbsp;<span class="op" id="5241504">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5241509">re</span><span class="op" id="5241511">.</span><span class="ident" id="5241512">Op</span>&nbsp;<span class="op" id="5241515">==</span>&nbsp;<span class="ident" id="5241518">OpAnyChar</span><br>
<span class="lineno">1090</span><span class="op" id="5241528">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5241531">//&nbsp;does&nbsp;re&nbsp;match&nbsp;r?</span><br>
<span class="lineno"></span><span class="keyword" id="5241551">func</span>&nbsp;<span class="ident" id="5241556">matchRune</span><span class="op" id="5241565">(</span><span class="ident" id="5241566">re</span>&nbsp;<span class="op" id="5241569">*</span><span class="ident" id="5241570">Regexp</span><span class="op" id="5241576">,</span>&nbsp;<span class="ident" id="5241578">r</span>&nbsp;<span class="builtintype" id="5241580">rune</span><span class="op" id="5241584">)</span>&nbsp;<span class="builtintype" id="5241586">bool</span>&nbsp;<span class="op" id="5241591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5241594">switch</span>&nbsp;<span class="ident" id="5241601">re</span><span class="op" id="5241603">.</span><span class="ident" id="5241604">Op</span>&nbsp;<span class="op" id="5241607">{</span><br>
<span class="lineno">1095</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5241610">case</span>&nbsp;<span class="ident" id="5241615">OpLiteral</span><span class="op" id="5241624">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5241628">return</span>&nbsp;<span class="builtinfunc" id="5241635">len</span><span class="op" id="5241638">(</span><span class="ident" id="5241639">re</span><span class="op" id="5241641">.</span><span class="ident" id="5241642">Rune</span><span class="op" id="5241646">)</span>&nbsp;<span class="op" id="5241648">==</span>&nbsp;<span class="num" id="5241651">1</span>&nbsp;<span class="op" id="5241653">&amp;&amp;</span>&nbsp;<span class="ident" id="5241656">re</span><span class="op" id="5241658">.</span><span class="ident" id="5241659">Rune</span><span class="op" id="5241663">[</span><span class="num" id="5241664">0</span><span class="op" id="5241665">]</span>&nbsp;<span class="op" id="5241667">==</span>&nbsp;<span class="ident" id="5241670">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5241673">case</span>&nbsp;<span class="ident" id="5241678">OpCharClass</span><span class="op" id="5241689">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5241693">for</span>&nbsp;<span class="ident" id="5241697">i</span>&nbsp;<span class="op" id="5241699">:=</span>&nbsp;<span class="num" id="5241702">0</span><span class="op" id="5241703">;</span>&nbsp;<span class="ident" id="5241705">i</span>&nbsp;<span class="op" id="5241707">&lt;</span>&nbsp;<span class="builtinfunc" id="5241709">len</span><span class="op" id="5241712">(</span><span class="ident" id="5241713">re</span><span class="op" id="5241715">.</span><span class="ident" id="5241716">Rune</span><span class="op" id="5241720">)</span><span class="op" id="5241721">;</span>&nbsp;<span class="ident" id="5241723">i</span>&nbsp;<span class="op" id="5241725">+=</span>&nbsp;<span class="num" id="5241728">2</span>&nbsp;<span class="op" id="5241730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5241735">if</span>&nbsp;<span class="ident" id="5241738">re</span><span class="op" id="5241740">.</span><span class="ident" id="5241741">Rune</span><span class="op" id="5241745">[</span><span class="ident" id="5241746">i</span><span class="op" id="5241747">]</span>&nbsp;<span class="op" id="5241749">&lt;=</span>&nbsp;<span class="ident" id="5241752">r</span>&nbsp;<span class="op" id="5241754">&amp;&amp;</span>&nbsp;<span class="ident" id="5241757">r</span>&nbsp;<span class="op" id="5241759">&lt;=</span>&nbsp;<span class="ident" id="5241762">re</span><span class="op" id="5241764">.</span><span class="ident" id="5241765">Rune</span><span class="op" id="5241769">[</span><span class="ident" id="5241770">i</span><span class="op" id="5241771">+</span><span class="num" id="5241772">1</span><span class="op" id="5241773">]</span>&nbsp;<span class="op" id="5241775">{</span><br>
<span class="lineno">1100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5241781">return</span>&nbsp;<span class="builtintype" id="5241788">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5241796">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5241800">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5241804">return</span>&nbsp;<span class="builtintype" id="5241811">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5241818">case</span>&nbsp;<span class="ident" id="5241823">OpAnyCharNotNL</span><span class="op" id="5241837">:</span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5241841">return</span>&nbsp;<span class="ident" id="5241848">r</span>&nbsp;<span class="op" id="5241850">!=</span>&nbsp;<span class="string" id="5241853">&#39;\n&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5241859">case</span>&nbsp;<span class="ident" id="5241864">OpAnyChar</span><span class="op" id="5241873">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5241877">return</span>&nbsp;<span class="builtintype" id="5241884">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5241890">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5241893">return</span>&nbsp;<span class="builtintype" id="5241900">false</span><br>
<span class="lineno">1110</span><span class="op" id="5241906">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5241909">//&nbsp;parseVerticalBar&nbsp;handles&nbsp;a&nbsp;|&nbsp;in&nbsp;the&nbsp;input.</span><br>
<span class="lineno"></span><span class="keyword" id="5241955">func</span>&nbsp;<span class="op" id="5241960">(</span><span class="ident" id="5241961">p</span>&nbsp;<span class="op" id="5241963">*</span><span class="ident" id="5241964">parser</span><span class="op" id="5241970">)</span>&nbsp;<span class="ident" id="5241972">parseVerticalBar</span><span class="op" id="5241988">(</span><span class="op" id="5241989">)</span>&nbsp;<span class="builtintype" id="5241991">error</span>&nbsp;<span class="op" id="5241997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5242000">p</span><span class="op" id="5242001">.</span><span class="ident" id="5242002">concat</span><span class="op" id="5242008">(</span><span class="op" id="5242009">)</span><br>
<span class="lineno">1115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5242013">//&nbsp;The&nbsp;concatenation&nbsp;we&nbsp;just&nbsp;parsed&nbsp;is&nbsp;on&nbsp;top&nbsp;of&nbsp;the&nbsp;stack.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5242074">//&nbsp;If&nbsp;it&nbsp;sits&nbsp;above&nbsp;an&nbsp;opVerticalBar,&nbsp;swap&nbsp;it&nbsp;below</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5242127">//&nbsp;(things&nbsp;below&nbsp;an&nbsp;opVerticalBar&nbsp;become&nbsp;an&nbsp;alternation).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5242186">//&nbsp;Otherwise,&nbsp;push&nbsp;a&nbsp;new&nbsp;vertical&nbsp;bar.</span><br>
<span class="lineno">1120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5242226">if</span>&nbsp;<span class="op" id="5242229">!</span><span class="ident" id="5242230">p</span><span class="op" id="5242231">.</span><span class="ident" id="5242232">swapVerticalBar</span><span class="op" id="5242247">(</span><span class="op" id="5242248">)</span>&nbsp;<span class="op" id="5242250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5242254">p</span><span class="op" id="5242255">.</span><span class="ident" id="5242256">op</span><span class="op" id="5242258">(</span><span class="ident" id="5242259">opVerticalBar</span><span class="op" id="5242272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5242275">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5242279">return</span>&nbsp;<span class="builtintype" id="5242286">nil</span><br>
<span class="lineno">1125</span><span class="op" id="5242290">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5242293">//&nbsp;mergeCharClass&nbsp;makes&nbsp;dst&nbsp;=&nbsp;dst|src.</span><br>
<span class="lineno"></span><span class="comment" id="5242332">//&nbsp;The&nbsp;caller&nbsp;must&nbsp;ensure&nbsp;that&nbsp;dst.Op&nbsp;&gt;=&nbsp;src.Op,</span><br>
<span class="lineno"></span><span class="comment" id="5242381">//&nbsp;to&nbsp;reduce&nbsp;the&nbsp;amount&nbsp;of&nbsp;copying.</span><br>
<span class="lineno">1130</span><span class="keyword" id="5242417">func</span>&nbsp;<span class="ident" id="5242422">mergeCharClass</span><span class="op" id="5242436">(</span><span class="ident" id="5242437">dst</span><span class="op" id="5242440">,</span>&nbsp;<span class="ident" id="5242442">src</span>&nbsp;<span class="op" id="5242446">*</span><span class="ident" id="5242447">Regexp</span><span class="op" id="5242453">)</span>&nbsp;<span class="op" id="5242455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5242458">switch</span>&nbsp;<span class="ident" id="5242465">dst</span><span class="op" id="5242468">.</span><span class="ident" id="5242469">Op</span>&nbsp;<span class="op" id="5242472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5242475">case</span>&nbsp;<span class="ident" id="5242480">OpAnyChar</span><span class="op" id="5242489">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5242493">//&nbsp;src&nbsp;doesn&#39;t&nbsp;add&nbsp;anything.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5242523">case</span>&nbsp;<span class="ident" id="5242528">OpAnyCharNotNL</span><span class="op" id="5242542">:</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5242546">//&nbsp;src&nbsp;might&nbsp;add&nbsp;\n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5242568">if</span>&nbsp;<span class="ident" id="5242571">matchRune</span><span class="op" id="5242580">(</span><span class="ident" id="5242581">src</span><span class="op" id="5242584">,</span>&nbsp;<span class="string" id="5242586">&#39;\n&#39;</span><span class="op" id="5242590">)</span>&nbsp;<span class="op" id="5242592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5242597">dst</span><span class="op" id="5242600">.</span><span class="ident" id="5242601">Op</span>&nbsp;<span class="op" id="5242604">=</span>&nbsp;<span class="ident" id="5242606">OpAnyChar</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5242618">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5242621">case</span>&nbsp;<span class="ident" id="5242626">OpCharClass</span><span class="op" id="5242637">:</span><br>
<span class="lineno">1140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5242641">//&nbsp;src&nbsp;is&nbsp;simpler,&nbsp;so&nbsp;either&nbsp;literal&nbsp;or&nbsp;char&nbsp;class</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5242694">if</span>&nbsp;<span class="ident" id="5242697">src</span><span class="op" id="5242700">.</span><span class="ident" id="5242701">Op</span>&nbsp;<span class="op" id="5242704">==</span>&nbsp;<span class="ident" id="5242707">OpLiteral</span>&nbsp;<span class="op" id="5242717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5242722">dst</span><span class="op" id="5242725">.</span><span class="ident" id="5242726">Rune</span>&nbsp;<span class="op" id="5242731">=</span>&nbsp;<span class="ident" id="5242733">appendLiteral</span><span class="op" id="5242746">(</span><span class="ident" id="5242747">dst</span><span class="op" id="5242750">.</span><span class="ident" id="5242751">Rune</span><span class="op" id="5242755">,</span>&nbsp;<span class="ident" id="5242757">src</span><span class="op" id="5242760">.</span><span class="ident" id="5242761">Rune</span><span class="op" id="5242765">[</span><span class="num" id="5242766">0</span><span class="op" id="5242767">]</span><span class="op" id="5242768">,</span>&nbsp;<span class="ident" id="5242770">src</span><span class="op" id="5242773">.</span><span class="ident" id="5242774">Flags</span><span class="op" id="5242779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5242783">}</span>&nbsp;<span class="keyword" id="5242785">else</span>&nbsp;<span class="op" id="5242790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5242795">dst</span><span class="op" id="5242798">.</span><span class="ident" id="5242799">Rune</span>&nbsp;<span class="op" id="5242804">=</span>&nbsp;<span class="ident" id="5242806">appendClass</span><span class="op" id="5242817">(</span><span class="ident" id="5242818">dst</span><span class="op" id="5242821">.</span><span class="ident" id="5242822">Rune</span><span class="op" id="5242826">,</span>&nbsp;<span class="ident" id="5242828">src</span><span class="op" id="5242831">.</span><span class="ident" id="5242832">Rune</span><span class="op" id="5242836">)</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5242840">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5242843">case</span>&nbsp;<span class="ident" id="5242848">OpLiteral</span><span class="op" id="5242857">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5242861">//&nbsp;both&nbsp;literal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5242879">if</span>&nbsp;<span class="ident" id="5242882">src</span><span class="op" id="5242885">.</span><span class="ident" id="5242886">Rune</span><span class="op" id="5242890">[</span><span class="num" id="5242891">0</span><span class="op" id="5242892">]</span>&nbsp;<span class="op" id="5242894">==</span>&nbsp;<span class="ident" id="5242897">dst</span><span class="op" id="5242900">.</span><span class="ident" id="5242901">Rune</span><span class="op" id="5242905">[</span><span class="num" id="5242906">0</span><span class="op" id="5242907">]</span>&nbsp;<span class="op" id="5242909">&amp;&amp;</span>&nbsp;<span class="ident" id="5242912">src</span><span class="op" id="5242915">.</span><span class="ident" id="5242916">Flags</span>&nbsp;<span class="op" id="5242922">==</span>&nbsp;<span class="ident" id="5242925">dst</span><span class="op" id="5242928">.</span><span class="ident" id="5242929">Flags</span>&nbsp;<span class="op" id="5242935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5242940">break</span><br>
<span class="lineno">1150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5242948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5242952">dst</span><span class="op" id="5242955">.</span><span class="ident" id="5242956">Op</span>&nbsp;<span class="op" id="5242959">=</span>&nbsp;<span class="ident" id="5242961">OpCharClass</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5242975">dst</span><span class="op" id="5242978">.</span><span class="ident" id="5242979">Rune</span>&nbsp;<span class="op" id="5242984">=</span>&nbsp;<span class="ident" id="5242986">appendLiteral</span><span class="op" id="5242999">(</span><span class="ident" id="5243000">dst</span><span class="op" id="5243003">.</span><span class="ident" id="5243004">Rune</span><span class="op" id="5243008">[</span><span class="op" id="5243009">:</span><span class="num" id="5243010">0</span><span class="op" id="5243011">]</span><span class="op" id="5243012">,</span>&nbsp;<span class="ident" id="5243014">dst</span><span class="op" id="5243017">.</span><span class="ident" id="5243018">Rune</span><span class="op" id="5243022">[</span><span class="num" id="5243023">0</span><span class="op" id="5243024">]</span><span class="op" id="5243025">,</span>&nbsp;<span class="ident" id="5243027">dst</span><span class="op" id="5243030">.</span><span class="ident" id="5243031">Flags</span><span class="op" id="5243036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5243040">dst</span><span class="op" id="5243043">.</span><span class="ident" id="5243044">Rune</span>&nbsp;<span class="op" id="5243049">=</span>&nbsp;<span class="ident" id="5243051">appendLiteral</span><span class="op" id="5243064">(</span><span class="ident" id="5243065">dst</span><span class="op" id="5243068">.</span><span class="ident" id="5243069">Rune</span><span class="op" id="5243073">,</span>&nbsp;<span class="ident" id="5243075">src</span><span class="op" id="5243078">.</span><span class="ident" id="5243079">Rune</span><span class="op" id="5243083">[</span><span class="num" id="5243084">0</span><span class="op" id="5243085">]</span><span class="op" id="5243086">,</span>&nbsp;<span class="ident" id="5243088">src</span><span class="op" id="5243091">.</span><span class="ident" id="5243092">Flags</span><span class="op" id="5243097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5243100">}</span><br>
<span class="lineno">1155</span><span class="op" id="5243102">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5243105">//&nbsp;If&nbsp;the&nbsp;top&nbsp;of&nbsp;the&nbsp;stack&nbsp;is&nbsp;an&nbsp;element&nbsp;followed&nbsp;by&nbsp;an&nbsp;opVerticalBar</span><br>
<span class="lineno"></span><span class="comment" id="5243175">//&nbsp;swapVerticalBar&nbsp;swaps&nbsp;the&nbsp;two&nbsp;and&nbsp;returns&nbsp;true.</span><br>
<span class="lineno"></span><span class="comment" id="5243226">//&nbsp;Otherwise&nbsp;it&nbsp;returns&nbsp;false.</span><br>
<span class="lineno">1160</span><span class="keyword" id="5243257">func</span>&nbsp;<span class="op" id="5243262">(</span><span class="ident" id="5243263">p</span>&nbsp;<span class="op" id="5243265">*</span><span class="ident" id="5243266">parser</span><span class="op" id="5243272">)</span>&nbsp;<span class="ident" id="5243274">swapVerticalBar</span><span class="op" id="5243289">(</span><span class="op" id="5243290">)</span>&nbsp;<span class="builtintype" id="5243292">bool</span>&nbsp;<span class="op" id="5243297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5243300">//&nbsp;If&nbsp;above&nbsp;and&nbsp;below&nbsp;vertical&nbsp;bar&nbsp;are&nbsp;literal&nbsp;or&nbsp;char&nbsp;class,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5243363">//&nbsp;can&nbsp;merge&nbsp;into&nbsp;a&nbsp;single&nbsp;char&nbsp;class.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5243403">n</span>&nbsp;<span class="op" id="5243405">:=</span>&nbsp;<span class="builtinfunc" id="5243408">len</span><span class="op" id="5243411">(</span><span class="ident" id="5243412">p</span><span class="op" id="5243413">.</span><span class="ident" id="5243414">stack</span><span class="op" id="5243419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5243422">if</span>&nbsp;<span class="ident" id="5243425">n</span>&nbsp;<span class="op" id="5243427">&gt;=</span>&nbsp;<span class="num" id="5243430">3</span>&nbsp;<span class="op" id="5243432">&amp;&amp;</span>&nbsp;<span class="ident" id="5243435">p</span><span class="op" id="5243436">.</span><span class="ident" id="5243437">stack</span><span class="op" id="5243442">[</span><span class="ident" id="5243443">n</span><span class="op" id="5243444">-</span><span class="num" id="5243445">2</span><span class="op" id="5243446">]</span><span class="op" id="5243447">.</span><span class="ident" id="5243448">Op</span>&nbsp;<span class="op" id="5243451">==</span>&nbsp;<span class="ident" id="5243454">opVerticalBar</span>&nbsp;<span class="op" id="5243468">&amp;&amp;</span>&nbsp;<span class="ident" id="5243471">isCharClass</span><span class="op" id="5243482">(</span><span class="ident" id="5243483">p</span><span class="op" id="5243484">.</span><span class="ident" id="5243485">stack</span><span class="op" id="5243490">[</span><span class="ident" id="5243491">n</span><span class="op" id="5243492">-</span><span class="num" id="5243493">1</span><span class="op" id="5243494">]</span><span class="op" id="5243495">)</span>&nbsp;<span class="op" id="5243497">&amp;&amp;</span>&nbsp;<span class="ident" id="5243500">isCharClass</span><span class="op" id="5243511">(</span><span class="ident" id="5243512">p</span><span class="op" id="5243513">.</span><span class="ident" id="5243514">stack</span><span class="op" id="5243519">[</span><span class="ident" id="5243520">n</span><span class="op" id="5243521">-</span><span class="num" id="5243522">3</span><span class="op" id="5243523">]</span><span class="op" id="5243524">)</span>&nbsp;<span class="op" id="5243526">{</span><br>
<span class="lineno">1165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5243530">re1</span>&nbsp;<span class="op" id="5243534">:=</span>&nbsp;<span class="ident" id="5243537">p</span><span class="op" id="5243538">.</span><span class="ident" id="5243539">stack</span><span class="op" id="5243544">[</span><span class="ident" id="5243545">n</span><span class="op" id="5243546">-</span><span class="num" id="5243547">1</span><span class="op" id="5243548">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5243552">re3</span>&nbsp;<span class="op" id="5243556">:=</span>&nbsp;<span class="ident" id="5243559">p</span><span class="op" id="5243560">.</span><span class="ident" id="5243561">stack</span><span class="op" id="5243566">[</span><span class="ident" id="5243567">n</span><span class="op" id="5243568">-</span><span class="num" id="5243569">3</span><span class="op" id="5243570">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5243574">//&nbsp;Make&nbsp;re3&nbsp;the&nbsp;more&nbsp;complex&nbsp;of&nbsp;the&nbsp;two.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5243617">if</span>&nbsp;<span class="ident" id="5243620">re1</span><span class="op" id="5243623">.</span><span class="ident" id="5243624">Op</span>&nbsp;<span class="op" id="5243627">&gt;</span>&nbsp;<span class="ident" id="5243629">re3</span><span class="op" id="5243632">.</span><span class="ident" id="5243633">Op</span>&nbsp;<span class="op" id="5243636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5243641">re1</span><span class="op" id="5243644">,</span>&nbsp;<span class="ident" id="5243646">re3</span>&nbsp;<span class="op" id="5243650">=</span>&nbsp;<span class="ident" id="5243652">re3</span><span class="op" id="5243655">,</span>&nbsp;<span class="ident" id="5243657">re1</span><br>
<span class="lineno">1170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5243664">p</span><span class="op" id="5243665">.</span><span class="ident" id="5243666">stack</span><span class="op" id="5243671">[</span><span class="ident" id="5243672">n</span><span class="op" id="5243673">-</span><span class="num" id="5243674">3</span><span class="op" id="5243675">]</span>&nbsp;<span class="op" id="5243677">=</span>&nbsp;<span class="ident" id="5243679">re3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5243685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5243689">mergeCharClass</span><span class="op" id="5243703">(</span><span class="ident" id="5243704">re3</span><span class="op" id="5243707">,</span>&nbsp;<span class="ident" id="5243709">re1</span><span class="op" id="5243712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5243716">p</span><span class="op" id="5243717">.</span><span class="ident" id="5243718">reuse</span><span class="op" id="5243723">(</span><span class="ident" id="5243724">re1</span><span class="op" id="5243727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5243731">p</span><span class="op" id="5243732">.</span><span class="ident" id="5243733">stack</span>&nbsp;<span class="op" id="5243739">=</span>&nbsp;<span class="ident" id="5243741">p</span><span class="op" id="5243742">.</span><span class="ident" id="5243743">stack</span><span class="op" id="5243748">[</span><span class="op" id="5243749">:</span><span class="ident" id="5243750">n</span><span class="op" id="5243751">-</span><span class="num" id="5243752">1</span><span class="op" id="5243753">]</span><br>
<span class="lineno">1175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5243757">return</span>&nbsp;<span class="builtintype" id="5243764">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5243770">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5243774">if</span>&nbsp;<span class="ident" id="5243777">n</span>&nbsp;<span class="op" id="5243779">&gt;=</span>&nbsp;<span class="num" id="5243782">2</span>&nbsp;<span class="op" id="5243784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5243788">re1</span>&nbsp;<span class="op" id="5243792">:=</span>&nbsp;<span class="ident" id="5243795">p</span><span class="op" id="5243796">.</span><span class="ident" id="5243797">stack</span><span class="op" id="5243802">[</span><span class="ident" id="5243803">n</span><span class="op" id="5243804">-</span><span class="num" id="5243805">1</span><span class="op" id="5243806">]</span><br>
<span class="lineno">1180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5243810">re2</span>&nbsp;<span class="op" id="5243814">:=</span>&nbsp;<span class="ident" id="5243817">p</span><span class="op" id="5243818">.</span><span class="ident" id="5243819">stack</span><span class="op" id="5243824">[</span><span class="ident" id="5243825">n</span><span class="op" id="5243826">-</span><span class="num" id="5243827">2</span><span class="op" id="5243828">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5243832">if</span>&nbsp;<span class="ident" id="5243835">re2</span><span class="op" id="5243838">.</span><span class="ident" id="5243839">Op</span>&nbsp;<span class="op" id="5243842">==</span>&nbsp;<span class="ident" id="5243845">opVerticalBar</span>&nbsp;<span class="op" id="5243859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5243864">if</span>&nbsp;<span class="ident" id="5243867">n</span>&nbsp;<span class="op" id="5243869">&gt;=</span>&nbsp;<span class="num" id="5243872">3</span>&nbsp;<span class="op" id="5243874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5243880">//&nbsp;Now&nbsp;out&nbsp;of&nbsp;reach.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5243905">//&nbsp;Clean&nbsp;opportunistically.</span><br>
<span class="lineno">1185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5243937">cleanAlt</span><span class="op" id="5243945">(</span><span class="ident" id="5243946">p</span><span class="op" id="5243947">.</span><span class="ident" id="5243948">stack</span><span class="op" id="5243953">[</span><span class="ident" id="5243954">n</span><span class="op" id="5243955">-</span><span class="num" id="5243956">3</span><span class="op" id="5243957">]</span><span class="op" id="5243958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5243963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5243968">p</span><span class="op" id="5243969">.</span><span class="ident" id="5243970">stack</span><span class="op" id="5243975">[</span><span class="ident" id="5243976">n</span><span class="op" id="5243977">-</span><span class="num" id="5243978">2</span><span class="op" id="5243979">]</span>&nbsp;<span class="op" id="5243981">=</span>&nbsp;<span class="ident" id="5243983">re1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5243990">p</span><span class="op" id="5243991">.</span><span class="ident" id="5243992">stack</span><span class="op" id="5243997">[</span><span class="ident" id="5243998">n</span><span class="op" id="5243999">-</span><span class="num" id="5244000">1</span><span class="op" id="5244001">]</span>&nbsp;<span class="op" id="5244003">=</span>&nbsp;<span class="ident" id="5244005">re2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5244012">return</span>&nbsp;<span class="builtintype" id="5244019">true</span><br>
<span class="lineno">1190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5244026">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5244029">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5244032">return</span>&nbsp;<span class="builtintype" id="5244039">false</span><br>
<span class="lineno"></span><span class="op" id="5244045">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1195</span><span class="comment" id="5244048">//&nbsp;parseRightParen&nbsp;handles&nbsp;a&nbsp;)&nbsp;in&nbsp;the&nbsp;input.</span><br>
<span class="lineno"></span><span class="keyword" id="5244093">func</span>&nbsp;<span class="op" id="5244098">(</span><span class="ident" id="5244099">p</span>&nbsp;<span class="op" id="5244101">*</span><span class="ident" id="5244102">parser</span><span class="op" id="5244108">)</span>&nbsp;<span class="ident" id="5244110">parseRightParen</span><span class="op" id="5244125">(</span><span class="op" id="5244126">)</span>&nbsp;<span class="builtintype" id="5244128">error</span>&nbsp;<span class="op" id="5244134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5244137">p</span><span class="op" id="5244138">.</span><span class="ident" id="5244139">concat</span><span class="op" id="5244145">(</span><span class="op" id="5244146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5244149">if</span>&nbsp;<span class="ident" id="5244152">p</span><span class="op" id="5244153">.</span><span class="ident" id="5244154">swapVerticalBar</span><span class="op" id="5244169">(</span><span class="op" id="5244170">)</span>&nbsp;<span class="op" id="5244172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5244176">//&nbsp;pop&nbsp;vertical&nbsp;bar</span><br>
<span class="lineno">1200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5244198">p</span><span class="op" id="5244199">.</span><span class="ident" id="5244200">stack</span>&nbsp;<span class="op" id="5244206">=</span>&nbsp;<span class="ident" id="5244208">p</span><span class="op" id="5244209">.</span><span class="ident" id="5244210">stack</span><span class="op" id="5244215">[</span><span class="op" id="5244216">:</span><span class="builtinfunc" id="5244217">len</span><span class="op" id="5244220">(</span><span class="ident" id="5244221">p</span><span class="op" id="5244222">.</span><span class="ident" id="5244223">stack</span><span class="op" id="5244228">)</span><span class="op" id="5244229">-</span><span class="num" id="5244230">1</span><span class="op" id="5244231">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5244234">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5244237">p</span><span class="op" id="5244238">.</span><span class="ident" id="5244239">alternate</span><span class="op" id="5244248">(</span><span class="op" id="5244249">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5244253">n</span>&nbsp;<span class="op" id="5244255">:=</span>&nbsp;<span class="builtinfunc" id="5244258">len</span><span class="op" id="5244261">(</span><span class="ident" id="5244262">p</span><span class="op" id="5244263">.</span><span class="ident" id="5244264">stack</span><span class="op" id="5244269">)</span><br>
<span class="lineno">1205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5244272">if</span>&nbsp;<span class="ident" id="5244275">n</span>&nbsp;<span class="op" id="5244277">&lt;</span>&nbsp;<span class="num" id="5244279">2</span>&nbsp;<span class="op" id="5244281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5244285">return</span>&nbsp;<span class="op" id="5244292">&amp;</span><span class="ident" id="5244293">Error</span><span class="op" id="5244298">{</span><span class="ident" id="5244299">ErrUnexpectedParen</span><span class="op" id="5244317">,</span>&nbsp;<span class="ident" id="5244319">p</span><span class="op" id="5244320">.</span><span class="ident" id="5244321">wholeRegexp</span><span class="op" id="5244332">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5244335">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5244338">re1</span>&nbsp;<span class="op" id="5244342">:=</span>&nbsp;<span class="ident" id="5244345">p</span><span class="op" id="5244346">.</span><span class="ident" id="5244347">stack</span><span class="op" id="5244352">[</span><span class="ident" id="5244353">n</span><span class="op" id="5244354">-</span><span class="num" id="5244355">1</span><span class="op" id="5244356">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5244359">re2</span>&nbsp;<span class="op" id="5244363">:=</span>&nbsp;<span class="ident" id="5244366">p</span><span class="op" id="5244367">.</span><span class="ident" id="5244368">stack</span><span class="op" id="5244373">[</span><span class="ident" id="5244374">n</span><span class="op" id="5244375">-</span><span class="num" id="5244376">2</span><span class="op" id="5244377">]</span><br>
<span class="lineno">1210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5244380">p</span><span class="op" id="5244381">.</span><span class="ident" id="5244382">stack</span>&nbsp;<span class="op" id="5244388">=</span>&nbsp;<span class="ident" id="5244390">p</span><span class="op" id="5244391">.</span><span class="ident" id="5244392">stack</span><span class="op" id="5244397">[</span><span class="op" id="5244398">:</span><span class="ident" id="5244399">n</span><span class="op" id="5244400">-</span><span class="num" id="5244401">2</span><span class="op" id="5244402">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5244405">if</span>&nbsp;<span class="ident" id="5244408">re2</span><span class="op" id="5244411">.</span><span class="ident" id="5244412">Op</span>&nbsp;<span class="op" id="5244415">!=</span>&nbsp;<span class="ident" id="5244418">opLeftParen</span>&nbsp;<span class="op" id="5244430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5244434">return</span>&nbsp;<span class="op" id="5244441">&amp;</span><span class="ident" id="5244442">Error</span><span class="op" id="5244447">{</span><span class="ident" id="5244448">ErrUnexpectedParen</span><span class="op" id="5244466">,</span>&nbsp;<span class="ident" id="5244468">p</span><span class="op" id="5244469">.</span><span class="ident" id="5244470">wholeRegexp</span><span class="op" id="5244481">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5244484">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5244487">//&nbsp;Restore&nbsp;flags&nbsp;at&nbsp;time&nbsp;of&nbsp;paren.</span><br>
<span class="lineno">1215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5244523">p</span><span class="op" id="5244524">.</span><span class="ident" id="5244525">flags</span>&nbsp;<span class="op" id="5244531">=</span>&nbsp;<span class="ident" id="5244533">re2</span><span class="op" id="5244536">.</span><span class="ident" id="5244537">Flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5244544">if</span>&nbsp;<span class="ident" id="5244547">re2</span><span class="op" id="5244550">.</span><span class="ident" id="5244551">Cap</span>&nbsp;<span class="op" id="5244555">==</span>&nbsp;<span class="num" id="5244558">0</span>&nbsp;<span class="op" id="5244560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5244564">//&nbsp;Just&nbsp;for&nbsp;grouping.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5244588">p</span><span class="op" id="5244589">.</span><span class="ident" id="5244590">push</span><span class="op" id="5244594">(</span><span class="ident" id="5244595">re1</span><span class="op" id="5244598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5244601">}</span>&nbsp;<span class="keyword" id="5244603">else</span>&nbsp;<span class="op" id="5244608">{</span><br>
<span class="lineno">1220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5244612">re2</span><span class="op" id="5244615">.</span><span class="ident" id="5244616">Op</span>&nbsp;<span class="op" id="5244619">=</span>&nbsp;<span class="ident" id="5244621">OpCapture</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5244633">re2</span><span class="op" id="5244636">.</span><span class="ident" id="5244637">Sub</span>&nbsp;<span class="op" id="5244641">=</span>&nbsp;<span class="ident" id="5244643">re2</span><span class="op" id="5244646">.</span><span class="ident" id="5244647">Sub0</span><span class="op" id="5244651">[</span><span class="op" id="5244652">:</span><span class="num" id="5244653">1</span><span class="op" id="5244654">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5244658">re2</span><span class="op" id="5244661">.</span><span class="ident" id="5244662">Sub</span><span class="op" id="5244665">[</span><span class="num" id="5244666">0</span><span class="op" id="5244667">]</span>&nbsp;<span class="op" id="5244669">=</span>&nbsp;<span class="ident" id="5244671">re1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5244677">p</span><span class="op" id="5244678">.</span><span class="ident" id="5244679">push</span><span class="op" id="5244683">(</span><span class="ident" id="5244684">re2</span><span class="op" id="5244687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5244690">}</span><br>
<span class="lineno">1225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5244693">return</span>&nbsp;<span class="builtintype" id="5244700">nil</span><br>
<span class="lineno"></span><span class="op" id="5244704">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5244707">//&nbsp;parseEscape&nbsp;parses&nbsp;an&nbsp;escape&nbsp;sequence&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;s</span><br>
<span class="lineno"></span><span class="comment" id="5244770">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;rune.</span><br>
<span class="lineno">1230</span><span class="keyword" id="5244795">func</span>&nbsp;<span class="op" id="5244800">(</span><span class="ident" id="5244801">p</span>&nbsp;<span class="op" id="5244803">*</span><span class="ident" id="5244804">parser</span><span class="op" id="5244810">)</span>&nbsp;<span class="ident" id="5244812">parseEscape</span><span class="op" id="5244823">(</span><span class="ident" id="5244824">s</span>&nbsp;<span class="builtintype" id="5244826">string</span><span class="op" id="5244832">)</span>&nbsp;<span class="op" id="5244834">(</span><span class="ident" id="5244835">r</span>&nbsp;<span class="builtintype" id="5244837">rune</span><span class="op" id="5244841">,</span>&nbsp;<span class="ident" id="5244843">rest</span>&nbsp;<span class="builtintype" id="5244848">string</span><span class="op" id="5244854">,</span>&nbsp;<span class="ident" id="5244856">err</span>&nbsp;<span class="builtintype" id="5244860">error</span><span class="op" id="5244865">)</span>&nbsp;<span class="op" id="5244867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5244870">t</span>&nbsp;<span class="op" id="5244872">:=</span>&nbsp;<span class="ident" id="5244875">s</span><span class="op" id="5244876">[</span><span class="num" id="5244877">1</span><span class="op" id="5244878">:</span><span class="op" id="5244879">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5244882">if</span>&nbsp;<span class="ident" id="5244885">t</span>&nbsp;<span class="op" id="5244887">==</span>&nbsp;<span class="string" id="5244890">&#34;&#34;</span>&nbsp;<span class="op" id="5244893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5244897">return</span>&nbsp;<span class="num" id="5244904">0</span><span class="op" id="5244905">,</span>&nbsp;<span class="string" id="5244907">&#34;&#34;</span><span class="op" id="5244909">,</span>&nbsp;<span class="op" id="5244911">&amp;</span><span class="ident" id="5244912">Error</span><span class="op" id="5244917">{</span><span class="ident" id="5244918">ErrTrailingBackslash</span><span class="op" id="5244938">,</span>&nbsp;<span class="string" id="5244940">&#34;&#34;</span><span class="op" id="5244942">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5244945">}</span><br>
<span class="lineno">1235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5244948">c</span><span class="op" id="5244949">,</span>&nbsp;<span class="ident" id="5244951">t</span><span class="op" id="5244952">,</span>&nbsp;<span class="ident" id="5244954">err</span>&nbsp;<span class="op" id="5244958">:=</span>&nbsp;<span class="ident" id="5244961">nextRune</span><span class="op" id="5244969">(</span><span class="ident" id="5244970">t</span><span class="op" id="5244971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5244974">if</span>&nbsp;<span class="ident" id="5244977">err</span>&nbsp;<span class="op" id="5244981">!=</span>&nbsp;<span class="builtintype" id="5244984">nil</span>&nbsp;<span class="op" id="5244988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5244992">return</span>&nbsp;<span class="num" id="5244999">0</span><span class="op" id="5245000">,</span>&nbsp;<span class="string" id="5245002">&#34;&#34;</span><span class="op" id="5245004">,</span>&nbsp;<span class="ident" id="5245006">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5245011">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1240</span><span class="ident" id="5245014">Switch</span><span class="op" id="5245020">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5245023">switch</span>&nbsp;<span class="ident" id="5245030">c</span>&nbsp;<span class="op" id="5245032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5245035">default</span><span class="op" id="5245042">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5245046">if</span>&nbsp;<span class="ident" id="5245049">c</span>&nbsp;<span class="op" id="5245051">&lt;</span>&nbsp;<span class="ident" id="5245053">utf8</span><span class="op" id="5245057">.</span><span class="ident" id="5245058">RuneSelf</span>&nbsp;<span class="op" id="5245067">&amp;&amp;</span>&nbsp;<span class="op" id="5245070">!</span><span class="ident" id="5245071">isalnum</span><span class="op" id="5245078">(</span><span class="ident" id="5245079">c</span><span class="op" id="5245080">)</span>&nbsp;<span class="op" id="5245082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5245087">//&nbsp;Escaped&nbsp;non-word&nbsp;characters&nbsp;are&nbsp;always&nbsp;themselves.</span><br>
<span class="lineno">1245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5245144">//&nbsp;PCRE&nbsp;is&nbsp;not&nbsp;quite&nbsp;so&nbsp;rigorous:&nbsp;it&nbsp;accepts&nbsp;things&nbsp;like</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5245204">//&nbsp;\q,&nbsp;but&nbsp;we&nbsp;don&#39;t.&nbsp;&nbsp;We&nbsp;once&nbsp;rejected&nbsp;\_,&nbsp;but&nbsp;too&nbsp;many</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5245263">//&nbsp;programs&nbsp;and&nbsp;people&nbsp;insist&nbsp;on&nbsp;using&nbsp;it,&nbsp;so&nbsp;allow&nbsp;\_.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5245322">return</span>&nbsp;<span class="ident" id="5245329">c</span><span class="op" id="5245330">,</span>&nbsp;<span class="ident" id="5245332">t</span><span class="op" id="5245333">,</span>&nbsp;<span class="builtintype" id="5245335">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5245341">}</span><br>
<span class="lineno">1250</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5245345">//&nbsp;Octal&nbsp;escapes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5245364">case</span>&nbsp;<span class="string" id="5245369">&#39;1&#39;</span><span class="op" id="5245372">,</span>&nbsp;<span class="string" id="5245374">&#39;2&#39;</span><span class="op" id="5245377">,</span>&nbsp;<span class="string" id="5245379">&#39;3&#39;</span><span class="op" id="5245382">,</span>&nbsp;<span class="string" id="5245384">&#39;4&#39;</span><span class="op" id="5245387">,</span>&nbsp;<span class="string" id="5245389">&#39;5&#39;</span><span class="op" id="5245392">,</span>&nbsp;<span class="string" id="5245394">&#39;6&#39;</span><span class="op" id="5245397">,</span>&nbsp;<span class="string" id="5245399">&#39;7&#39;</span><span class="op" id="5245402">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5245406">//&nbsp;Single&nbsp;non-zero&nbsp;digit&nbsp;is&nbsp;a&nbsp;backreference;&nbsp;not&nbsp;supported</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5245467">if</span>&nbsp;<span class="ident" id="5245470">t</span>&nbsp;<span class="op" id="5245472">==</span>&nbsp;<span class="string" id="5245475">&#34;&#34;</span>&nbsp;<span class="op" id="5245478">||</span>&nbsp;<span class="ident" id="5245481">t</span><span class="op" id="5245482">[</span><span class="num" id="5245483">0</span><span class="op" id="5245484">]</span>&nbsp;<span class="op" id="5245486">&lt;</span>&nbsp;<span class="string" id="5245488">&#39;0&#39;</span>&nbsp;<span class="op" id="5245492">||</span>&nbsp;<span class="ident" id="5245495">t</span><span class="op" id="5245496">[</span><span class="num" id="5245497">0</span><span class="op" id="5245498">]</span>&nbsp;<span class="op" id="5245500">&gt;</span>&nbsp;<span class="string" id="5245502">&#39;7&#39;</span>&nbsp;<span class="op" id="5245506">{</span><br>
<span class="lineno">1255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5245511">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5245519">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5245523">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5245536">case</span>&nbsp;<span class="string" id="5245541">&#39;0&#39;</span><span class="op" id="5245544">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5245548">//&nbsp;Consume&nbsp;up&nbsp;to&nbsp;three&nbsp;octal&nbsp;digits;&nbsp;already&nbsp;have&nbsp;one.</span><br>
<span class="lineno">1260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5245605">r</span>&nbsp;<span class="op" id="5245607">=</span>&nbsp;<span class="ident" id="5245609">c</span>&nbsp;<span class="op" id="5245611">-</span>&nbsp;<span class="string" id="5245613">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5245619">for</span>&nbsp;<span class="ident" id="5245623">i</span>&nbsp;<span class="op" id="5245625">:=</span>&nbsp;<span class="num" id="5245628">1</span><span class="op" id="5245629">;</span>&nbsp;<span class="ident" id="5245631">i</span>&nbsp;<span class="op" id="5245633">&lt;</span>&nbsp;<span class="num" id="5245635">3</span><span class="op" id="5245636">;</span>&nbsp;<span class="ident" id="5245638">i</span><span class="op" id="5245639">++</span>&nbsp;<span class="op" id="5245642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5245647">if</span>&nbsp;<span class="ident" id="5245650">t</span>&nbsp;<span class="op" id="5245652">==</span>&nbsp;<span class="string" id="5245655">&#34;&#34;</span>&nbsp;<span class="op" id="5245658">||</span>&nbsp;<span class="ident" id="5245661">t</span><span class="op" id="5245662">[</span><span class="num" id="5245663">0</span><span class="op" id="5245664">]</span>&nbsp;<span class="op" id="5245666">&lt;</span>&nbsp;<span class="string" id="5245668">&#39;0&#39;</span>&nbsp;<span class="op" id="5245672">||</span>&nbsp;<span class="ident" id="5245675">t</span><span class="op" id="5245676">[</span><span class="num" id="5245677">0</span><span class="op" id="5245678">]</span>&nbsp;<span class="op" id="5245680">&gt;</span>&nbsp;<span class="string" id="5245682">&#39;7&#39;</span>&nbsp;<span class="op" id="5245686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5245692">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5245701">}</span><br>
<span class="lineno">1265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5245706">r</span>&nbsp;<span class="op" id="5245708">=</span>&nbsp;<span class="ident" id="5245710">r</span><span class="op" id="5245711">*</span><span class="num" id="5245712">8</span>&nbsp;<span class="op" id="5245714">+</span>&nbsp;<span class="builtintype" id="5245716">rune</span><span class="op" id="5245720">(</span><span class="ident" id="5245721">t</span><span class="op" id="5245722">[</span><span class="num" id="5245723">0</span><span class="op" id="5245724">]</span><span class="op" id="5245725">)</span>&nbsp;<span class="op" id="5245727">-</span>&nbsp;<span class="string" id="5245729">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5245736">t</span>&nbsp;<span class="op" id="5245738">=</span>&nbsp;<span class="ident" id="5245740">t</span><span class="op" id="5245741">[</span><span class="num" id="5245742">1</span><span class="op" id="5245743">:</span><span class="op" id="5245744">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5245748">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5245752">return</span>&nbsp;<span class="ident" id="5245759">r</span><span class="op" id="5245760">,</span>&nbsp;<span class="ident" id="5245762">t</span><span class="op" id="5245763">,</span>&nbsp;<span class="builtintype" id="5245765">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno">1270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5245771">//&nbsp;Hexadecimal&nbsp;escapes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5245796">case</span>&nbsp;<span class="string" id="5245801">&#39;x&#39;</span><span class="op" id="5245804">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5245808">if</span>&nbsp;<span class="ident" id="5245811">t</span>&nbsp;<span class="op" id="5245813">==</span>&nbsp;<span class="string" id="5245816">&#34;&#34;</span>&nbsp;<span class="op" id="5245819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5245824">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5245832">}</span><br>
<span class="lineno">1275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5245836">if</span>&nbsp;<span class="ident" id="5245839">c</span><span class="op" id="5245840">,</span>&nbsp;<span class="ident" id="5245842">t</span><span class="op" id="5245843">,</span>&nbsp;<span class="ident" id="5245845">err</span>&nbsp;<span class="op" id="5245849">=</span>&nbsp;<span class="ident" id="5245851">nextRune</span><span class="op" id="5245859">(</span><span class="ident" id="5245860">t</span><span class="op" id="5245861">)</span><span class="op" id="5245862">;</span>&nbsp;<span class="ident" id="5245864">err</span>&nbsp;<span class="op" id="5245868">!=</span>&nbsp;<span class="builtintype" id="5245871">nil</span>&nbsp;<span class="op" id="5245875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5245880">return</span>&nbsp;<span class="num" id="5245887">0</span><span class="op" id="5245888">,</span>&nbsp;<span class="string" id="5245890">&#34;&#34;</span><span class="op" id="5245892">,</span>&nbsp;<span class="ident" id="5245894">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5245900">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5245904">if</span>&nbsp;<span class="ident" id="5245907">c</span>&nbsp;<span class="op" id="5245909">==</span>&nbsp;<span class="string" id="5245912">&#39;{&#39;</span>&nbsp;<span class="op" id="5245916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5245921">//&nbsp;Any&nbsp;number&nbsp;of&nbsp;digits&nbsp;in&nbsp;braces.</span><br>
<span class="lineno">1280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5245959">//&nbsp;Perl&nbsp;accepts&nbsp;any&nbsp;text&nbsp;at&nbsp;all;&nbsp;it&nbsp;ignores&nbsp;all&nbsp;text</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5246015">//&nbsp;after&nbsp;the&nbsp;first&nbsp;non-hex&nbsp;digit.&nbsp;&nbsp;We&nbsp;require&nbsp;only&nbsp;hex&nbsp;digits,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5246081">//&nbsp;and&nbsp;at&nbsp;least&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5246105">nhex</span>&nbsp;<span class="op" id="5246110">:=</span>&nbsp;<span class="num" id="5246113">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5246118">r</span>&nbsp;<span class="op" id="5246120">=</span>&nbsp;<span class="num" id="5246122">0</span><br>
<span class="lineno">1285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5246127">for</span>&nbsp;<span class="op" id="5246131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5246137">if</span>&nbsp;<span class="ident" id="5246140">t</span>&nbsp;<span class="op" id="5246142">==</span>&nbsp;<span class="string" id="5246145">&#34;&#34;</span>&nbsp;<span class="op" id="5246148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5246155">break</span>&nbsp;<span class="ident" id="5246161">Switch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5246172">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5246178">if</span>&nbsp;<span class="ident" id="5246181">c</span><span class="op" id="5246182">,</span>&nbsp;<span class="ident" id="5246184">t</span><span class="op" id="5246185">,</span>&nbsp;<span class="ident" id="5246187">err</span>&nbsp;<span class="op" id="5246191">=</span>&nbsp;<span class="ident" id="5246193">nextRune</span><span class="op" id="5246201">(</span><span class="ident" id="5246202">t</span><span class="op" id="5246203">)</span><span class="op" id="5246204">;</span>&nbsp;<span class="ident" id="5246206">err</span>&nbsp;<span class="op" id="5246210">!=</span>&nbsp;<span class="builtintype" id="5246213">nil</span>&nbsp;<span class="op" id="5246217">{</span><br>
<span class="lineno">1290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5246224">return</span>&nbsp;<span class="num" id="5246231">0</span><span class="op" id="5246232">,</span>&nbsp;<span class="string" id="5246234">&#34;&#34;</span><span class="op" id="5246236">,</span>&nbsp;<span class="ident" id="5246238">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5246246">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5246252">if</span>&nbsp;<span class="ident" id="5246255">c</span>&nbsp;<span class="op" id="5246257">==</span>&nbsp;<span class="string" id="5246260">&#39;}&#39;</span>&nbsp;<span class="op" id="5246264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5246271">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5246281">}</span><br>
<span class="lineno">1295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5246287">v</span>&nbsp;<span class="op" id="5246289">:=</span>&nbsp;<span class="ident" id="5246292">unhex</span><span class="op" id="5246297">(</span><span class="ident" id="5246298">c</span><span class="op" id="5246299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5246305">if</span>&nbsp;<span class="ident" id="5246308">v</span>&nbsp;<span class="op" id="5246310">&lt;</span>&nbsp;<span class="num" id="5246312">0</span>&nbsp;<span class="op" id="5246314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5246321">break</span>&nbsp;<span class="ident" id="5246327">Switch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5246338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5246344">r</span>&nbsp;<span class="op" id="5246346">=</span>&nbsp;<span class="ident" id="5246348">r</span><span class="op" id="5246349">*</span><span class="num" id="5246350">16</span>&nbsp;<span class="op" id="5246353">+</span>&nbsp;<span class="ident" id="5246355">v</span><br>
<span class="lineno">1300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5246361">if</span>&nbsp;<span class="ident" id="5246364">r</span>&nbsp;<span class="op" id="5246366">&gt;</span>&nbsp;<span class="ident" id="5246368">unicode</span><span class="op" id="5246375">.</span><span class="ident" id="5246376">MaxRune</span>&nbsp;<span class="op" id="5246384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5246391">break</span>&nbsp;<span class="ident" id="5246397">Switch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5246408">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5246414">nhex</span><span class="op" id="5246418">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5246424">}</span><br>
<span class="lineno">1305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5246429">if</span>&nbsp;<span class="ident" id="5246432">nhex</span>&nbsp;<span class="op" id="5246437">==</span>&nbsp;<span class="num" id="5246440">0</span>&nbsp;<span class="op" id="5246442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5246448">break</span>&nbsp;<span class="ident" id="5246454">Switch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5246464">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5246469">return</span>&nbsp;<span class="ident" id="5246476">r</span><span class="op" id="5246477">,</span>&nbsp;<span class="ident" id="5246479">t</span><span class="op" id="5246480">,</span>&nbsp;<span class="builtintype" id="5246482">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5246488">}</span><br>
<span class="lineno">1310</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5246493">//&nbsp;Easy&nbsp;case:&nbsp;two&nbsp;hex&nbsp;digits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5246525">x</span>&nbsp;<span class="op" id="5246527">:=</span>&nbsp;<span class="ident" id="5246530">unhex</span><span class="op" id="5246535">(</span><span class="ident" id="5246536">c</span><span class="op" id="5246537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5246541">if</span>&nbsp;<span class="ident" id="5246544">c</span><span class="op" id="5246545">,</span>&nbsp;<span class="ident" id="5246547">t</span><span class="op" id="5246548">,</span>&nbsp;<span class="ident" id="5246550">err</span>&nbsp;<span class="op" id="5246554">=</span>&nbsp;<span class="ident" id="5246556">nextRune</span><span class="op" id="5246564">(</span><span class="ident" id="5246565">t</span><span class="op" id="5246566">)</span><span class="op" id="5246567">;</span>&nbsp;<span class="ident" id="5246569">err</span>&nbsp;<span class="op" id="5246573">!=</span>&nbsp;<span class="builtintype" id="5246576">nil</span>&nbsp;<span class="op" id="5246580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5246585">return</span>&nbsp;<span class="num" id="5246592">0</span><span class="op" id="5246593">,</span>&nbsp;<span class="string" id="5246595">&#34;&#34;</span><span class="op" id="5246597">,</span>&nbsp;<span class="ident" id="5246599">err</span><br>
<span class="lineno">1315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5246605">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5246609">y</span>&nbsp;<span class="op" id="5246611">:=</span>&nbsp;<span class="ident" id="5246614">unhex</span><span class="op" id="5246619">(</span><span class="ident" id="5246620">c</span><span class="op" id="5246621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5246625">if</span>&nbsp;<span class="ident" id="5246628">x</span>&nbsp;<span class="op" id="5246630">&lt;</span>&nbsp;<span class="num" id="5246632">0</span>&nbsp;<span class="op" id="5246634">||</span>&nbsp;<span class="ident" id="5246637">y</span>&nbsp;<span class="op" id="5246639">&lt;</span>&nbsp;<span class="num" id="5246641">0</span>&nbsp;<span class="op" id="5246643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5246648">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5246656">}</span><br>
<span class="lineno">1320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5246660">return</span>&nbsp;<span class="ident" id="5246667">x</span><span class="op" id="5246668">*</span><span class="num" id="5246669">16</span>&nbsp;<span class="op" id="5246672">+</span>&nbsp;<span class="ident" id="5246674">y</span><span class="op" id="5246675">,</span>&nbsp;<span class="ident" id="5246677">t</span><span class="op" id="5246678">,</span>&nbsp;<span class="builtintype" id="5246680">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5246686">//&nbsp;C&nbsp;escapes.&nbsp;&nbsp;There&nbsp;is&nbsp;no&nbsp;case&nbsp;&#39;b&#39;,&nbsp;to&nbsp;avoid&nbsp;misparsing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5246744">//&nbsp;the&nbsp;Perl&nbsp;word-boundary&nbsp;\b&nbsp;as&nbsp;the&nbsp;C&nbsp;backspace&nbsp;\b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5246796">//&nbsp;when&nbsp;in&nbsp;POSIX&nbsp;mode.&nbsp;&nbsp;In&nbsp;Perl,&nbsp;/\b/&nbsp;means&nbsp;word-boundary</span><br>
<span class="lineno">1325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5246855">//&nbsp;but&nbsp;/[\b]/&nbsp;means&nbsp;backspace.&nbsp;&nbsp;We&nbsp;don&#39;t&nbsp;support&nbsp;that.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5246911">//&nbsp;If&nbsp;you&nbsp;want&nbsp;a&nbsp;backspace,&nbsp;embed&nbsp;a&nbsp;literal&nbsp;backspace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5246966">//&nbsp;character&nbsp;or&nbsp;use&nbsp;\x08.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5246993">case</span>&nbsp;<span class="string" id="5246998">&#39;a&#39;</span><span class="op" id="5247001">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5247005">return</span>&nbsp;<span class="string" id="5247012">&#39;\a&#39;</span><span class="op" id="5247016">,</span>&nbsp;<span class="ident" id="5247018">t</span><span class="op" id="5247019">,</span>&nbsp;<span class="ident" id="5247021">err</span><br>
<span class="lineno">1330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5247026">case</span>&nbsp;<span class="string" id="5247031">&#39;f&#39;</span><span class="op" id="5247034">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5247038">return</span>&nbsp;<span class="string" id="5247045">&#39;\f&#39;</span><span class="op" id="5247049">,</span>&nbsp;<span class="ident" id="5247051">t</span><span class="op" id="5247052">,</span>&nbsp;<span class="ident" id="5247054">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5247059">case</span>&nbsp;<span class="string" id="5247064">&#39;n&#39;</span><span class="op" id="5247067">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5247071">return</span>&nbsp;<span class="string" id="5247078">&#39;\n&#39;</span><span class="op" id="5247082">,</span>&nbsp;<span class="ident" id="5247084">t</span><span class="op" id="5247085">,</span>&nbsp;<span class="ident" id="5247087">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5247092">case</span>&nbsp;<span class="string" id="5247097">&#39;r&#39;</span><span class="op" id="5247100">:</span><br>
<span class="lineno">1335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5247104">return</span>&nbsp;<span class="string" id="5247111">&#39;\r&#39;</span><span class="op" id="5247115">,</span>&nbsp;<span class="ident" id="5247117">t</span><span class="op" id="5247118">,</span>&nbsp;<span class="ident" id="5247120">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5247125">case</span>&nbsp;<span class="string" id="5247130">&#39;t&#39;</span><span class="op" id="5247133">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5247137">return</span>&nbsp;<span class="string" id="5247144">&#39;\t&#39;</span><span class="op" id="5247148">,</span>&nbsp;<span class="ident" id="5247150">t</span><span class="op" id="5247151">,</span>&nbsp;<span class="ident" id="5247153">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5247158">case</span>&nbsp;<span class="string" id="5247163">&#39;v&#39;</span><span class="op" id="5247166">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5247170">return</span>&nbsp;<span class="string" id="5247177">&#39;\v&#39;</span><span class="op" id="5247181">,</span>&nbsp;<span class="ident" id="5247183">t</span><span class="op" id="5247184">,</span>&nbsp;<span class="ident" id="5247186">err</span><br>
<span class="lineno">1340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5247191">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5247194">return</span>&nbsp;<span class="num" id="5247201">0</span><span class="op" id="5247202">,</span>&nbsp;<span class="string" id="5247204">&#34;&#34;</span><span class="op" id="5247206">,</span>&nbsp;<span class="op" id="5247208">&amp;</span><span class="ident" id="5247209">Error</span><span class="op" id="5247214">{</span><span class="ident" id="5247215">ErrInvalidEscape</span><span class="op" id="5247231">,</span>&nbsp;<span class="ident" id="5247233">s</span><span class="op" id="5247234">[</span><span class="op" id="5247235">:</span><span class="builtinfunc" id="5247236">len</span><span class="op" id="5247239">(</span><span class="ident" id="5247240">s</span><span class="op" id="5247241">)</span><span class="op" id="5247242">-</span><span class="builtinfunc" id="5247243">len</span><span class="op" id="5247246">(</span><span class="ident" id="5247247">t</span><span class="op" id="5247248">)</span><span class="op" id="5247249">]</span><span class="op" id="5247250">}</span><br>
<span class="lineno"></span><span class="op" id="5247252">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5247255">//&nbsp;parseClassChar&nbsp;parses&nbsp;a&nbsp;character&nbsp;class&nbsp;character&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;s</span><br>
<span class="lineno">1345</span><span class="comment" id="5247330">//&nbsp;and&nbsp;returns&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="5247349">func</span>&nbsp;<span class="op" id="5247354">(</span><span class="ident" id="5247355">p</span>&nbsp;<span class="op" id="5247357">*</span><span class="ident" id="5247358">parser</span><span class="op" id="5247364">)</span>&nbsp;<span class="ident" id="5247366">parseClassChar</span><span class="op" id="5247380">(</span><span class="ident" id="5247381">s</span><span class="op" id="5247382">,</span>&nbsp;<span class="ident" id="5247384">wholeClass</span>&nbsp;<span class="builtintype" id="5247395">string</span><span class="op" id="5247401">)</span>&nbsp;<span class="op" id="5247403">(</span><span class="ident" id="5247404">r</span>&nbsp;<span class="builtintype" id="5247406">rune</span><span class="op" id="5247410">,</span>&nbsp;<span class="ident" id="5247412">rest</span>&nbsp;<span class="builtintype" id="5247417">string</span><span class="op" id="5247423">,</span>&nbsp;<span class="ident" id="5247425">err</span>&nbsp;<span class="builtintype" id="5247429">error</span><span class="op" id="5247434">)</span>&nbsp;<span class="op" id="5247436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5247439">if</span>&nbsp;<span class="ident" id="5247442">s</span>&nbsp;<span class="op" id="5247444">==</span>&nbsp;<span class="string" id="5247447">&#34;&#34;</span>&nbsp;<span class="op" id="5247450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5247454">return</span>&nbsp;<span class="num" id="5247461">0</span><span class="op" id="5247462">,</span>&nbsp;<span class="string" id="5247464">&#34;&#34;</span><span class="op" id="5247466">,</span>&nbsp;<span class="op" id="5247468">&amp;</span><span class="ident" id="5247469">Error</span><span class="op" id="5247474">{</span><span class="ident" id="5247475">Code</span><span class="op" id="5247479">:</span>&nbsp;<span class="ident" id="5247481">ErrMissingBracket</span><span class="op" id="5247498">,</span>&nbsp;<span class="ident" id="5247500">Expr</span><span class="op" id="5247504">:</span>&nbsp;<span class="ident" id="5247506">wholeClass</span><span class="op" id="5247516">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5247519">}</span><br>
<span class="lineno">1350</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5247523">//&nbsp;Allow&nbsp;regular&nbsp;escape&nbsp;sequences&nbsp;even&nbsp;though</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5247570">//&nbsp;many&nbsp;need&nbsp;not&nbsp;be&nbsp;escaped&nbsp;in&nbsp;this&nbsp;context.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5247616">if</span>&nbsp;<span class="ident" id="5247619">s</span><span class="op" id="5247620">[</span><span class="num" id="5247621">0</span><span class="op" id="5247622">]</span>&nbsp;<span class="op" id="5247624">==</span>&nbsp;<span class="string" id="5247627">&#39;\\&#39;</span>&nbsp;<span class="op" id="5247632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5247636">return</span>&nbsp;<span class="ident" id="5247643">p</span><span class="op" id="5247644">.</span><span class="ident" id="5247645">parseEscape</span><span class="op" id="5247656">(</span><span class="ident" id="5247657">s</span><span class="op" id="5247658">)</span><br>
<span class="lineno">1355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5247661">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5247665">return</span>&nbsp;<span class="ident" id="5247672">nextRune</span><span class="op" id="5247680">(</span><span class="ident" id="5247681">s</span><span class="op" id="5247682">)</span><br>
<span class="lineno"></span><span class="op" id="5247684">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1360</span><span class="keyword" id="5247687">type</span>&nbsp;<span class="ident" id="5247692">charGroup</span>&nbsp;<span class="keyword" id="5247702">struct</span>&nbsp;<span class="op" id="5247709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5247712">sign</span>&nbsp;&nbsp;<span class="builtintype" id="5247718">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5247723">class</span>&nbsp;<span class="op" id="5247729">[</span><span class="op" id="5247730">]</span><span class="builtintype" id="5247731">rune</span><br>
<span class="lineno"></span><span class="op" id="5247736">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1365</span><span class="comment" id="5247739">//&nbsp;parsePerlClassEscape&nbsp;parses&nbsp;a&nbsp;leading&nbsp;Perl&nbsp;character&nbsp;class&nbsp;escape&nbsp;like&nbsp;\d</span><br>
<span class="lineno"></span><span class="comment" id="5247816">//&nbsp;from&nbsp;the&nbsp;beginning&nbsp;of&nbsp;s.&nbsp;&nbsp;If&nbsp;one&nbsp;is&nbsp;present,&nbsp;it&nbsp;appends&nbsp;the&nbsp;characters&nbsp;to&nbsp;r</span><br>
<span class="lineno"></span><span class="comment" id="5247895">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;slice&nbsp;r&nbsp;and&nbsp;the&nbsp;remainder&nbsp;of&nbsp;the&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="5247959">func</span>&nbsp;<span class="op" id="5247964">(</span><span class="ident" id="5247965">p</span>&nbsp;<span class="op" id="5247967">*</span><span class="ident" id="5247968">parser</span><span class="op" id="5247974">)</span>&nbsp;<span class="ident" id="5247976">parsePerlClassEscape</span><span class="op" id="5247996">(</span><span class="ident" id="5247997">s</span>&nbsp;<span class="builtintype" id="5247999">string</span><span class="op" id="5248005">,</span>&nbsp;<span class="ident" id="5248007">r</span>&nbsp;<span class="op" id="5248009">[</span><span class="op" id="5248010">]</span><span class="builtintype" id="5248011">rune</span><span class="op" id="5248015">)</span>&nbsp;<span class="op" id="5248017">(</span><span class="ident" id="5248018">out</span>&nbsp;<span class="op" id="5248022">[</span><span class="op" id="5248023">]</span><span class="builtintype" id="5248024">rune</span><span class="op" id="5248028">,</span>&nbsp;<span class="ident" id="5248030">rest</span>&nbsp;<span class="builtintype" id="5248035">string</span><span class="op" id="5248041">)</span>&nbsp;<span class="op" id="5248043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5248046">if</span>&nbsp;<span class="ident" id="5248049">p</span><span class="op" id="5248050">.</span><span class="ident" id="5248051">flags</span><span class="op" id="5248056">&amp;</span><span class="ident" id="5248057">PerlX</span>&nbsp;<span class="op" id="5248063">==</span>&nbsp;<span class="num" id="5248066">0</span>&nbsp;<span class="op" id="5248068">||</span>&nbsp;<span class="builtinfunc" id="5248071">len</span><span class="op" id="5248074">(</span><span class="ident" id="5248075">s</span><span class="op" id="5248076">)</span>&nbsp;<span class="op" id="5248078">&lt;</span>&nbsp;<span class="num" id="5248080">2</span>&nbsp;<span class="op" id="5248082">||</span>&nbsp;<span class="ident" id="5248085">s</span><span class="op" id="5248086">[</span><span class="num" id="5248087">0</span><span class="op" id="5248088">]</span>&nbsp;<span class="op" id="5248090">!=</span>&nbsp;<span class="string" id="5248093">&#39;\\&#39;</span>&nbsp;<span class="op" id="5248098">{</span><br>
<span class="lineno">1370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5248102">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5248110">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5248113">g</span>&nbsp;<span class="op" id="5248115">:=</span>&nbsp;<span class="ident" id="5248118">perlGroup</span><span class="op" id="5248127">[</span><span class="ident" id="5248128">s</span><span class="op" id="5248129">[</span><span class="num" id="5248130">0</span><span class="op" id="5248131">:</span><span class="num" id="5248132">2</span><span class="op" id="5248133">]</span><span class="op" id="5248134">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5248137">if</span>&nbsp;<span class="ident" id="5248140">g</span><span class="op" id="5248141">.</span><span class="ident" id="5248142">sign</span>&nbsp;<span class="op" id="5248147">==</span>&nbsp;<span class="num" id="5248150">0</span>&nbsp;<span class="op" id="5248152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5248156">return</span><br>
<span class="lineno">1375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5248164">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5248167">return</span>&nbsp;<span class="ident" id="5248174">p</span><span class="op" id="5248175">.</span><span class="ident" id="5248176">appendGroup</span><span class="op" id="5248187">(</span><span class="ident" id="5248188">r</span><span class="op" id="5248189">,</span>&nbsp;<span class="ident" id="5248191">g</span><span class="op" id="5248192">)</span><span class="op" id="5248193">,</span>&nbsp;<span class="ident" id="5248195">s</span><span class="op" id="5248196">[</span><span class="num" id="5248197">2</span><span class="op" id="5248198">:</span><span class="op" id="5248199">]</span><br>
<span class="lineno"></span><span class="op" id="5248201">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5248204">//&nbsp;parseNamedClass&nbsp;parses&nbsp;a&nbsp;leading&nbsp;POSIX&nbsp;named&nbsp;character&nbsp;class&nbsp;like&nbsp;[:alnum:]</span><br>
<span class="lineno">1380</span><span class="comment" id="5248283">//&nbsp;from&nbsp;the&nbsp;beginning&nbsp;of&nbsp;s.&nbsp;&nbsp;If&nbsp;one&nbsp;is&nbsp;present,&nbsp;it&nbsp;appends&nbsp;the&nbsp;characters&nbsp;to&nbsp;r</span><br>
<span class="lineno"></span><span class="comment" id="5248362">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;slice&nbsp;r&nbsp;and&nbsp;the&nbsp;remainder&nbsp;of&nbsp;the&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="5248426">func</span>&nbsp;<span class="op" id="5248431">(</span><span class="ident" id="5248432">p</span>&nbsp;<span class="op" id="5248434">*</span><span class="ident" id="5248435">parser</span><span class="op" id="5248441">)</span>&nbsp;<span class="ident" id="5248443">parseNamedClass</span><span class="op" id="5248458">(</span><span class="ident" id="5248459">s</span>&nbsp;<span class="builtintype" id="5248461">string</span><span class="op" id="5248467">,</span>&nbsp;<span class="ident" id="5248469">r</span>&nbsp;<span class="op" id="5248471">[</span><span class="op" id="5248472">]</span><span class="builtintype" id="5248473">rune</span><span class="op" id="5248477">)</span>&nbsp;<span class="op" id="5248479">(</span><span class="ident" id="5248480">out</span>&nbsp;<span class="op" id="5248484">[</span><span class="op" id="5248485">]</span><span class="builtintype" id="5248486">rune</span><span class="op" id="5248490">,</span>&nbsp;<span class="ident" id="5248492">rest</span>&nbsp;<span class="builtintype" id="5248497">string</span><span class="op" id="5248503">,</span>&nbsp;<span class="ident" id="5248505">err</span>&nbsp;<span class="builtintype" id="5248509">error</span><span class="op" id="5248514">)</span>&nbsp;<span class="op" id="5248516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5248519">if</span>&nbsp;<span class="builtinfunc" id="5248522">len</span><span class="op" id="5248525">(</span><span class="ident" id="5248526">s</span><span class="op" id="5248527">)</span>&nbsp;<span class="op" id="5248529">&lt;</span>&nbsp;<span class="num" id="5248531">2</span>&nbsp;<span class="op" id="5248533">||</span>&nbsp;<span class="ident" id="5248536">s</span><span class="op" id="5248537">[</span><span class="num" id="5248538">0</span><span class="op" id="5248539">]</span>&nbsp;<span class="op" id="5248541">!=</span>&nbsp;<span class="string" id="5248544">&#39;[&#39;</span>&nbsp;<span class="op" id="5248548">||</span>&nbsp;<span class="ident" id="5248551">s</span><span class="op" id="5248552">[</span><span class="num" id="5248553">1</span><span class="op" id="5248554">]</span>&nbsp;<span class="op" id="5248556">!=</span>&nbsp;<span class="string" id="5248559">&#39;:&#39;</span>&nbsp;<span class="op" id="5248563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5248567">return</span><br>
<span class="lineno">1385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5248575">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5248579">i</span>&nbsp;<span class="op" id="5248581">:=</span>&nbsp;<span class="ident" id="5248584">strings</span><span class="op" id="5248591">.</span><span class="ident" id="5248592">Index</span><span class="op" id="5248597">(</span><span class="ident" id="5248598">s</span><span class="op" id="5248599">[</span><span class="num" id="5248600">2</span><span class="op" id="5248601">:</span><span class="op" id="5248602">]</span><span class="op" id="5248603">,</span>&nbsp;<span class="string" id="5248605">&#34;:]&#34;</span><span class="op" id="5248609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5248612">if</span>&nbsp;<span class="ident" id="5248615">i</span>&nbsp;<span class="op" id="5248617">&lt;</span>&nbsp;<span class="num" id="5248619">0</span>&nbsp;<span class="op" id="5248621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5248625">return</span><br>
<span class="lineno">1390</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5248633">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5248636">i</span>&nbsp;<span class="op" id="5248638">+=</span>&nbsp;<span class="num" id="5248641">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5248644">name</span><span class="op" id="5248648">,</span>&nbsp;<span class="ident" id="5248650">s</span>&nbsp;<span class="op" id="5248652">:=</span>&nbsp;<span class="ident" id="5248655">s</span><span class="op" id="5248656">[</span><span class="num" id="5248657">0</span><span class="op" id="5248658">:</span><span class="ident" id="5248659">i</span><span class="op" id="5248660">+</span><span class="num" id="5248661">2</span><span class="op" id="5248662">]</span><span class="op" id="5248663">,</span>&nbsp;<span class="ident" id="5248665">s</span><span class="op" id="5248666">[</span><span class="ident" id="5248667">i</span><span class="op" id="5248668">+</span><span class="num" id="5248669">2</span><span class="op" id="5248670">:</span><span class="op" id="5248671">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5248674">g</span>&nbsp;<span class="op" id="5248676">:=</span>&nbsp;<span class="ident" id="5248679">posixGroup</span><span class="op" id="5248689">[</span><span class="ident" id="5248690">name</span><span class="op" id="5248694">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5248697">if</span>&nbsp;<span class="ident" id="5248700">g</span><span class="op" id="5248701">.</span><span class="ident" id="5248702">sign</span>&nbsp;<span class="op" id="5248707">==</span>&nbsp;<span class="num" id="5248710">0</span>&nbsp;<span class="op" id="5248712">{</span><br>
<span class="lineno">1395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5248716">return</span>&nbsp;<span class="builtintype" id="5248723">nil</span><span class="op" id="5248726">,</span>&nbsp;<span class="string" id="5248728">&#34;&#34;</span><span class="op" id="5248730">,</span>&nbsp;<span class="op" id="5248732">&amp;</span><span class="ident" id="5248733">Error</span><span class="op" id="5248738">{</span><span class="ident" id="5248739">ErrInvalidCharRange</span><span class="op" id="5248758">,</span>&nbsp;<span class="ident" id="5248760">name</span><span class="op" id="5248764">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5248767">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5248770">return</span>&nbsp;<span class="ident" id="5248777">p</span><span class="op" id="5248778">.</span><span class="ident" id="5248779">appendGroup</span><span class="op" id="5248790">(</span><span class="ident" id="5248791">r</span><span class="op" id="5248792">,</span>&nbsp;<span class="ident" id="5248794">g</span><span class="op" id="5248795">)</span><span class="op" id="5248796">,</span>&nbsp;<span class="ident" id="5248798">s</span><span class="op" id="5248799">,</span>&nbsp;<span class="builtintype" id="5248801">nil</span><br>
<span class="lineno"></span><span class="op" id="5248805">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1400</span><span class="keyword" id="5248808">func</span>&nbsp;<span class="op" id="5248813">(</span><span class="ident" id="5248814">p</span>&nbsp;<span class="op" id="5248816">*</span><span class="ident" id="5248817">parser</span><span class="op" id="5248823">)</span>&nbsp;<span class="ident" id="5248825">appendGroup</span><span class="op" id="5248836">(</span><span class="ident" id="5248837">r</span>&nbsp;<span class="op" id="5248839">[</span><span class="op" id="5248840">]</span><span class="builtintype" id="5248841">rune</span><span class="op" id="5248845">,</span>&nbsp;<span class="ident" id="5248847">g</span>&nbsp;<span class="ident" id="5248849">charGroup</span><span class="op" id="5248858">)</span>&nbsp;<span class="op" id="5248860">[</span><span class="op" id="5248861">]</span><span class="builtintype" id="5248862">rune</span>&nbsp;<span class="op" id="5248867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5248870">if</span>&nbsp;<span class="ident" id="5248873">p</span><span class="op" id="5248874">.</span><span class="ident" id="5248875">flags</span><span class="op" id="5248880">&amp;</span><span class="ident" id="5248881">FoldCase</span>&nbsp;<span class="op" id="5248890">==</span>&nbsp;<span class="num" id="5248893">0</span>&nbsp;<span class="op" id="5248895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5248899">if</span>&nbsp;<span class="ident" id="5248902">g</span><span class="op" id="5248903">.</span><span class="ident" id="5248904">sign</span>&nbsp;<span class="op" id="5248909">&lt;</span>&nbsp;<span class="num" id="5248911">0</span>&nbsp;<span class="op" id="5248913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5248918">r</span>&nbsp;<span class="op" id="5248920">=</span>&nbsp;<span class="ident" id="5248922">appendNegatedClass</span><span class="op" id="5248940">(</span><span class="ident" id="5248941">r</span><span class="op" id="5248942">,</span>&nbsp;<span class="ident" id="5248944">g</span><span class="op" id="5248945">.</span><span class="ident" id="5248946">class</span><span class="op" id="5248951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5248955">}</span>&nbsp;<span class="keyword" id="5248957">else</span>&nbsp;<span class="op" id="5248962">{</span><br>
<span class="lineno">1405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5248967">r</span>&nbsp;<span class="op" id="5248969">=</span>&nbsp;<span class="ident" id="5248971">appendClass</span><span class="op" id="5248982">(</span><span class="ident" id="5248983">r</span><span class="op" id="5248984">,</span>&nbsp;<span class="ident" id="5248986">g</span><span class="op" id="5248987">.</span><span class="ident" id="5248988">class</span><span class="op" id="5248993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5248997">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5249000">}</span>&nbsp;<span class="keyword" id="5249002">else</span>&nbsp;<span class="op" id="5249007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5249011">tmp</span>&nbsp;<span class="op" id="5249015">:=</span>&nbsp;<span class="ident" id="5249018">p</span><span class="op" id="5249019">.</span><span class="ident" id="5249020">tmpClass</span><span class="op" id="5249028">[</span><span class="op" id="5249029">:</span><span class="num" id="5249030">0</span><span class="op" id="5249031">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5249035">tmp</span>&nbsp;<span class="op" id="5249039">=</span>&nbsp;<span class="ident" id="5249041">appendFoldedClass</span><span class="op" id="5249058">(</span><span class="ident" id="5249059">tmp</span><span class="op" id="5249062">,</span>&nbsp;<span class="ident" id="5249064">g</span><span class="op" id="5249065">.</span><span class="ident" id="5249066">class</span><span class="op" id="5249071">)</span><br>
<span class="lineno">1410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5249075">p</span><span class="op" id="5249076">.</span><span class="ident" id="5249077">tmpClass</span>&nbsp;<span class="op" id="5249086">=</span>&nbsp;<span class="ident" id="5249088">tmp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5249094">tmp</span>&nbsp;<span class="op" id="5249098">=</span>&nbsp;<span class="ident" id="5249100">cleanClass</span><span class="op" id="5249110">(</span><span class="op" id="5249111">&amp;</span><span class="ident" id="5249112">p</span><span class="op" id="5249113">.</span><span class="ident" id="5249114">tmpClass</span><span class="op" id="5249122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5249126">if</span>&nbsp;<span class="ident" id="5249129">g</span><span class="op" id="5249130">.</span><span class="ident" id="5249131">sign</span>&nbsp;<span class="op" id="5249136">&lt;</span>&nbsp;<span class="num" id="5249138">0</span>&nbsp;<span class="op" id="5249140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5249145">r</span>&nbsp;<span class="op" id="5249147">=</span>&nbsp;<span class="ident" id="5249149">appendNegatedClass</span><span class="op" id="5249167">(</span><span class="ident" id="5249168">r</span><span class="op" id="5249169">,</span>&nbsp;<span class="ident" id="5249171">tmp</span><span class="op" id="5249174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5249178">}</span>&nbsp;<span class="keyword" id="5249180">else</span>&nbsp;<span class="op" id="5249185">{</span><br>
<span class="lineno">1415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5249190">r</span>&nbsp;<span class="op" id="5249192">=</span>&nbsp;<span class="ident" id="5249194">appendClass</span><span class="op" id="5249205">(</span><span class="ident" id="5249206">r</span><span class="op" id="5249207">,</span>&nbsp;<span class="ident" id="5249209">tmp</span><span class="op" id="5249212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5249216">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5249219">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5249222">return</span>&nbsp;<span class="ident" id="5249229">r</span><br>
<span class="lineno"></span><span class="op" id="5249231">}</span><br>
<span class="lineno">1420</span><br>
<span class="lineno"></span><span class="keyword" id="5249234">var</span>&nbsp;<span class="ident" id="5249238">anyTable</span>&nbsp;<span class="op" id="5249247">=</span>&nbsp;<span class="op" id="5249249">&amp;</span><span class="ident" id="5249250">unicode</span><span class="op" id="5249257">.</span><span class="ident" id="5249258">RangeTable</span><span class="op" id="5249268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5249271">R16</span><span class="op" id="5249274">:</span>&nbsp;<span class="op" id="5249276">[</span><span class="op" id="5249277">]</span><span class="ident" id="5249278">unicode</span><span class="op" id="5249285">.</span><span class="ident" id="5249286">Range16</span><span class="op" id="5249293">{</span><span class="op" id="5249294">{</span><span class="ident" id="5249295">Lo</span><span class="op" id="5249297">:</span>&nbsp;<span class="num" id="5249299">0</span><span class="op" id="5249300">,</span>&nbsp;<span class="ident" id="5249302">Hi</span><span class="op" id="5249304">:</span>&nbsp;<span class="num" id="5249306">1</span><span class="op" id="5249307">&lt;&lt;</span><span class="num" id="5249309">16</span>&nbsp;<span class="op" id="5249312">-</span>&nbsp;<span class="num" id="5249314">1</span><span class="op" id="5249315">,</span>&nbsp;<span class="ident" id="5249317">Stride</span><span class="op" id="5249323">:</span>&nbsp;<span class="num" id="5249325">1</span><span class="op" id="5249326">}</span><span class="op" id="5249327">}</span><span class="op" id="5249328">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5249331">R32</span><span class="op" id="5249334">:</span>&nbsp;<span class="op" id="5249336">[</span><span class="op" id="5249337">]</span><span class="ident" id="5249338">unicode</span><span class="op" id="5249345">.</span><span class="ident" id="5249346">Range32</span><span class="op" id="5249353">{</span><span class="op" id="5249354">{</span><span class="ident" id="5249355">Lo</span><span class="op" id="5249357">:</span>&nbsp;<span class="num" id="5249359">1</span>&nbsp;<span class="op" id="5249361">&lt;&lt;</span>&nbsp;<span class="num" id="5249364">16</span><span class="op" id="5249366">,</span>&nbsp;<span class="ident" id="5249368">Hi</span><span class="op" id="5249370">:</span>&nbsp;<span class="ident" id="5249372">unicode</span><span class="op" id="5249379">.</span><span class="ident" id="5249380">MaxRune</span><span class="op" id="5249387">,</span>&nbsp;<span class="ident" id="5249389">Stride</span><span class="op" id="5249395">:</span>&nbsp;<span class="num" id="5249397">1</span><span class="op" id="5249398">}</span><span class="op" id="5249399">}</span><span class="op" id="5249400">,</span><br>
<span class="lineno"></span><span class="op" id="5249402">}</span><br>
<span class="lineno">1425</span><br>
<span class="lineno"></span><span class="comment" id="5249405">//&nbsp;unicodeTable&nbsp;returns&nbsp;the&nbsp;unicode.RangeTable&nbsp;identified&nbsp;by&nbsp;name</span><br>
<span class="lineno"></span><span class="comment" id="5249471">//&nbsp;and&nbsp;the&nbsp;table&nbsp;of&nbsp;additional&nbsp;fold-equivalent&nbsp;code&nbsp;points.</span><br>
<span class="lineno"></span><span class="keyword" id="5249531">func</span>&nbsp;<span class="ident" id="5249536">unicodeTable</span><span class="op" id="5249548">(</span><span class="ident" id="5249549">name</span>&nbsp;<span class="builtintype" id="5249554">string</span><span class="op" id="5249560">)</span>&nbsp;<span class="op" id="5249562">(</span><span class="op" id="5249563">*</span><span class="ident" id="5249564">unicode</span><span class="op" id="5249571">.</span><span class="ident" id="5249572">RangeTable</span><span class="op" id="5249582">,</span>&nbsp;<span class="op" id="5249584">*</span><span class="ident" id="5249585">unicode</span><span class="op" id="5249592">.</span><span class="ident" id="5249593">RangeTable</span><span class="op" id="5249603">)</span>&nbsp;<span class="op" id="5249605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5249608">//&nbsp;Special&nbsp;case:&nbsp;&#34;Any&#34;&nbsp;means&nbsp;any.</span><br>
<span class="lineno">1430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5249643">if</span>&nbsp;<span class="ident" id="5249646">name</span>&nbsp;<span class="op" id="5249651">==</span>&nbsp;<span class="string" id="5249654">&#34;Any&#34;</span>&nbsp;<span class="op" id="5249660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5249664">return</span>&nbsp;<span class="ident" id="5249671">anyTable</span><span class="op" id="5249679">,</span>&nbsp;<span class="ident" id="5249681">anyTable</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5249691">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5249694">if</span>&nbsp;<span class="ident" id="5249697">t</span>&nbsp;<span class="op" id="5249699">:=</span>&nbsp;<span class="ident" id="5249702">unicode</span><span class="op" id="5249709">.</span><span class="ident" id="5249710">Categories</span><span class="op" id="5249720">[</span><span class="ident" id="5249721">name</span><span class="op" id="5249725">]</span><span class="op" id="5249726">;</span>&nbsp;<span class="ident" id="5249728">t</span>&nbsp;<span class="op" id="5249730">!=</span>&nbsp;<span class="builtintype" id="5249733">nil</span>&nbsp;<span class="op" id="5249737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5249741">return</span>&nbsp;<span class="ident" id="5249748">t</span><span class="op" id="5249749">,</span>&nbsp;<span class="ident" id="5249751">unicode</span><span class="op" id="5249758">.</span><span class="ident" id="5249759">FoldCategory</span><span class="op" id="5249771">[</span><span class="ident" id="5249772">name</span><span class="op" id="5249776">]</span><br>
<span class="lineno">1435</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5249779">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5249782">if</span>&nbsp;<span class="ident" id="5249785">t</span>&nbsp;<span class="op" id="5249787">:=</span>&nbsp;<span class="ident" id="5249790">unicode</span><span class="op" id="5249797">.</span><span class="ident" id="5249798">Scripts</span><span class="op" id="5249805">[</span><span class="ident" id="5249806">name</span><span class="op" id="5249810">]</span><span class="op" id="5249811">;</span>&nbsp;<span class="ident" id="5249813">t</span>&nbsp;<span class="op" id="5249815">!=</span>&nbsp;<span class="builtintype" id="5249818">nil</span>&nbsp;<span class="op" id="5249822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5249826">return</span>&nbsp;<span class="ident" id="5249833">t</span><span class="op" id="5249834">,</span>&nbsp;<span class="ident" id="5249836">unicode</span><span class="op" id="5249843">.</span><span class="ident" id="5249844">FoldScript</span><span class="op" id="5249854">[</span><span class="ident" id="5249855">name</span><span class="op" id="5249859">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5249862">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5249865">return</span>&nbsp;<span class="builtintype" id="5249872">nil</span><span class="op" id="5249875">,</span>&nbsp;<span class="builtintype" id="5249877">nil</span><br>
<span class="lineno">1440</span><span class="op" id="5249881">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5249884">//&nbsp;parseUnicodeClass&nbsp;parses&nbsp;a&nbsp;leading&nbsp;Unicode&nbsp;character&nbsp;class&nbsp;like&nbsp;\p{Han}</span><br>
<span class="lineno"></span><span class="comment" id="5249959">//&nbsp;from&nbsp;the&nbsp;beginning&nbsp;of&nbsp;s.&nbsp;&nbsp;If&nbsp;one&nbsp;is&nbsp;present,&nbsp;it&nbsp;appends&nbsp;the&nbsp;characters&nbsp;to&nbsp;r</span><br>
<span class="lineno"></span><span class="comment" id="5250038">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;slice&nbsp;r&nbsp;and&nbsp;the&nbsp;remainder&nbsp;of&nbsp;the&nbsp;string.</span><br>
<span class="lineno">1445</span><span class="keyword" id="5250102">func</span>&nbsp;<span class="op" id="5250107">(</span><span class="ident" id="5250108">p</span>&nbsp;<span class="op" id="5250110">*</span><span class="ident" id="5250111">parser</span><span class="op" id="5250117">)</span>&nbsp;<span class="ident" id="5250119">parseUnicodeClass</span><span class="op" id="5250136">(</span><span class="ident" id="5250137">s</span>&nbsp;<span class="builtintype" id="5250139">string</span><span class="op" id="5250145">,</span>&nbsp;<span class="ident" id="5250147">r</span>&nbsp;<span class="op" id="5250149">[</span><span class="op" id="5250150">]</span><span class="builtintype" id="5250151">rune</span><span class="op" id="5250155">)</span>&nbsp;<span class="op" id="5250157">(</span><span class="ident" id="5250158">out</span>&nbsp;<span class="op" id="5250162">[</span><span class="op" id="5250163">]</span><span class="builtintype" id="5250164">rune</span><span class="op" id="5250168">,</span>&nbsp;<span class="ident" id="5250170">rest</span>&nbsp;<span class="builtintype" id="5250175">string</span><span class="op" id="5250181">,</span>&nbsp;<span class="ident" id="5250183">err</span>&nbsp;<span class="builtintype" id="5250187">error</span><span class="op" id="5250192">)</span>&nbsp;<span class="op" id="5250194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5250197">if</span>&nbsp;<span class="ident" id="5250200">p</span><span class="op" id="5250201">.</span><span class="ident" id="5250202">flags</span><span class="op" id="5250207">&amp;</span><span class="ident" id="5250208">UnicodeGroups</span>&nbsp;<span class="op" id="5250222">==</span>&nbsp;<span class="num" id="5250225">0</span>&nbsp;<span class="op" id="5250227">||</span>&nbsp;<span class="builtinfunc" id="5250230">len</span><span class="op" id="5250233">(</span><span class="ident" id="5250234">s</span><span class="op" id="5250235">)</span>&nbsp;<span class="op" id="5250237">&lt;</span>&nbsp;<span class="num" id="5250239">2</span>&nbsp;<span class="op" id="5250241">||</span>&nbsp;<span class="ident" id="5250244">s</span><span class="op" id="5250245">[</span><span class="num" id="5250246">0</span><span class="op" id="5250247">]</span>&nbsp;<span class="op" id="5250249">!=</span>&nbsp;<span class="string" id="5250252">&#39;\\&#39;</span>&nbsp;<span class="op" id="5250257">||</span>&nbsp;<span class="ident" id="5250260">s</span><span class="op" id="5250261">[</span><span class="num" id="5250262">1</span><span class="op" id="5250263">]</span>&nbsp;<span class="op" id="5250265">!=</span>&nbsp;<span class="string" id="5250268">&#39;p&#39;</span>&nbsp;<span class="op" id="5250272">&amp;&amp;</span>&nbsp;<span class="ident" id="5250275">s</span><span class="op" id="5250276">[</span><span class="num" id="5250277">1</span><span class="op" id="5250278">]</span>&nbsp;<span class="op" id="5250280">!=</span>&nbsp;<span class="string" id="5250283">&#39;P&#39;</span>&nbsp;<span class="op" id="5250287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5250291">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5250299">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5250303">//&nbsp;Committed&nbsp;to&nbsp;parse&nbsp;or&nbsp;return&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5250343">sign</span>&nbsp;<span class="op" id="5250348">:=</span>&nbsp;<span class="op" id="5250351">+</span><span class="num" id="5250352">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5250355">if</span>&nbsp;<span class="ident" id="5250358">s</span><span class="op" id="5250359">[</span><span class="num" id="5250360">1</span><span class="op" id="5250361">]</span>&nbsp;<span class="op" id="5250363">==</span>&nbsp;<span class="string" id="5250366">&#39;P&#39;</span>&nbsp;<span class="op" id="5250370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5250374">sign</span>&nbsp;<span class="op" id="5250379">=</span>&nbsp;<span class="op" id="5250381">-</span><span class="num" id="5250382">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5250385">}</span><br>
<span class="lineno">1455</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5250388">t</span>&nbsp;<span class="op" id="5250390">:=</span>&nbsp;<span class="ident" id="5250393">s</span><span class="op" id="5250394">[</span><span class="num" id="5250395">2</span><span class="op" id="5250396">:</span><span class="op" id="5250397">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5250400">c</span><span class="op" id="5250401">,</span>&nbsp;<span class="ident" id="5250403">t</span><span class="op" id="5250404">,</span>&nbsp;<span class="ident" id="5250406">err</span>&nbsp;<span class="op" id="5250410">:=</span>&nbsp;<span class="ident" id="5250413">nextRune</span><span class="op" id="5250421">(</span><span class="ident" id="5250422">t</span><span class="op" id="5250423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5250426">if</span>&nbsp;<span class="ident" id="5250429">err</span>&nbsp;<span class="op" id="5250433">!=</span>&nbsp;<span class="builtintype" id="5250436">nil</span>&nbsp;<span class="op" id="5250440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5250444">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5250452">}</span><br>
<span class="lineno">1460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5250455">var</span>&nbsp;<span class="ident" id="5250459">seq</span><span class="op" id="5250462">,</span>&nbsp;<span class="ident" id="5250464">name</span>&nbsp;<span class="builtintype" id="5250469">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5250477">if</span>&nbsp;<span class="ident" id="5250480">c</span>&nbsp;<span class="op" id="5250482">!=</span>&nbsp;<span class="string" id="5250485">&#39;{&#39;</span>&nbsp;<span class="op" id="5250489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5250493">//&nbsp;Single-letter&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5250518">seq</span>&nbsp;<span class="op" id="5250522">=</span>&nbsp;<span class="ident" id="5250524">s</span><span class="op" id="5250525">[</span><span class="op" id="5250526">:</span><span class="builtinfunc" id="5250527">len</span><span class="op" id="5250530">(</span><span class="ident" id="5250531">s</span><span class="op" id="5250532">)</span><span class="op" id="5250533">-</span><span class="builtinfunc" id="5250534">len</span><span class="op" id="5250537">(</span><span class="ident" id="5250538">t</span><span class="op" id="5250539">)</span><span class="op" id="5250540">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5250544">name</span>&nbsp;<span class="op" id="5250549">=</span>&nbsp;<span class="ident" id="5250551">seq</span><span class="op" id="5250554">[</span><span class="num" id="5250555">2</span><span class="op" id="5250556">:</span><span class="op" id="5250557">]</span><br>
<span class="lineno">1465</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5250560">}</span>&nbsp;<span class="keyword" id="5250562">else</span>&nbsp;<span class="op" id="5250567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5250571">//&nbsp;Name&nbsp;is&nbsp;in&nbsp;braces.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5250595">end</span>&nbsp;<span class="op" id="5250599">:=</span>&nbsp;<span class="ident" id="5250602">strings</span><span class="op" id="5250609">.</span><span class="ident" id="5250610">IndexRune</span><span class="op" id="5250619">(</span><span class="ident" id="5250620">s</span><span class="op" id="5250621">,</span>&nbsp;<span class="string" id="5250623">&#39;}&#39;</span><span class="op" id="5250626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5250630">if</span>&nbsp;<span class="ident" id="5250633">end</span>&nbsp;<span class="op" id="5250637">&lt;</span>&nbsp;<span class="num" id="5250639">0</span>&nbsp;<span class="op" id="5250641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5250646">if</span>&nbsp;<span class="ident" id="5250649">err</span>&nbsp;<span class="op" id="5250653">=</span>&nbsp;<span class="ident" id="5250655">checkUTF8</span><span class="op" id="5250664">(</span><span class="ident" id="5250665">s</span><span class="op" id="5250666">)</span><span class="op" id="5250667">;</span>&nbsp;<span class="ident" id="5250669">err</span>&nbsp;<span class="op" id="5250673">!=</span>&nbsp;<span class="builtintype" id="5250676">nil</span>&nbsp;<span class="op" id="5250680">{</span><br>
<span class="lineno">1470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5250686">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5250696">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5250701">return</span>&nbsp;<span class="builtintype" id="5250708">nil</span><span class="op" id="5250711">,</span>&nbsp;<span class="string" id="5250713">&#34;&#34;</span><span class="op" id="5250715">,</span>&nbsp;<span class="op" id="5250717">&amp;</span><span class="ident" id="5250718">Error</span><span class="op" id="5250723">{</span><span class="ident" id="5250724">ErrInvalidCharRange</span><span class="op" id="5250743">,</span>&nbsp;<span class="ident" id="5250745">s</span><span class="op" id="5250746">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5250750">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5250754">seq</span><span class="op" id="5250757">,</span>&nbsp;<span class="ident" id="5250759">t</span>&nbsp;<span class="op" id="5250761">=</span>&nbsp;<span class="ident" id="5250763">s</span><span class="op" id="5250764">[</span><span class="op" id="5250765">:</span><span class="ident" id="5250766">end</span><span class="op" id="5250769">+</span><span class="num" id="5250770">1</span><span class="op" id="5250771">]</span><span class="op" id="5250772">,</span>&nbsp;<span class="ident" id="5250774">s</span><span class="op" id="5250775">[</span><span class="ident" id="5250776">end</span><span class="op" id="5250779">+</span><span class="num" id="5250780">1</span><span class="op" id="5250781">:</span><span class="op" id="5250782">]</span><br>
<span class="lineno">1475</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5250786">name</span>&nbsp;<span class="op" id="5250791">=</span>&nbsp;<span class="ident" id="5250793">s</span><span class="op" id="5250794">[</span><span class="num" id="5250795">3</span><span class="op" id="5250796">:</span><span class="ident" id="5250797">end</span><span class="op" id="5250800">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5250804">if</span>&nbsp;<span class="ident" id="5250807">err</span>&nbsp;<span class="op" id="5250811">=</span>&nbsp;<span class="ident" id="5250813">checkUTF8</span><span class="op" id="5250822">(</span><span class="ident" id="5250823">name</span><span class="op" id="5250827">)</span><span class="op" id="5250828">;</span>&nbsp;<span class="ident" id="5250830">err</span>&nbsp;<span class="op" id="5250834">!=</span>&nbsp;<span class="builtintype" id="5250837">nil</span>&nbsp;<span class="op" id="5250841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5250846">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5250855">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5250858">}</span><br>
<span class="lineno">1480</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5250862">//&nbsp;Group&nbsp;can&nbsp;have&nbsp;leading&nbsp;negation&nbsp;too.&nbsp;&nbsp;\p{^Han}&nbsp;==&nbsp;\P{Han},&nbsp;\P{^Han}&nbsp;==&nbsp;\p{Han}.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5250946">if</span>&nbsp;<span class="ident" id="5250949">name</span>&nbsp;<span class="op" id="5250954">!=</span>&nbsp;<span class="string" id="5250957">&#34;&#34;</span>&nbsp;<span class="op" id="5250960">&amp;&amp;</span>&nbsp;<span class="ident" id="5250963">name</span><span class="op" id="5250967">[</span><span class="num" id="5250968">0</span><span class="op" id="5250969">]</span>&nbsp;<span class="op" id="5250971">==</span>&nbsp;<span class="string" id="5250974">&#39;^&#39;</span>&nbsp;<span class="op" id="5250978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5250982">sign</span>&nbsp;<span class="op" id="5250987">=</span>&nbsp;<span class="op" id="5250989">-</span><span class="ident" id="5250990">sign</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5250997">name</span>&nbsp;<span class="op" id="5251002">=</span>&nbsp;<span class="ident" id="5251004">name</span><span class="op" id="5251008">[</span><span class="num" id="5251009">1</span><span class="op" id="5251010">:</span><span class="op" id="5251011">]</span><br>
<span class="lineno">1485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5251014">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5251018">tab</span><span class="op" id="5251021">,</span>&nbsp;<span class="ident" id="5251023">fold</span>&nbsp;<span class="op" id="5251028">:=</span>&nbsp;<span class="ident" id="5251031">unicodeTable</span><span class="op" id="5251043">(</span><span class="ident" id="5251044">name</span><span class="op" id="5251048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5251051">if</span>&nbsp;<span class="ident" id="5251054">tab</span>&nbsp;<span class="op" id="5251058">==</span>&nbsp;<span class="builtintype" id="5251061">nil</span>&nbsp;<span class="op" id="5251065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5251069">return</span>&nbsp;<span class="builtintype" id="5251076">nil</span><span class="op" id="5251079">,</span>&nbsp;<span class="string" id="5251081">&#34;&#34;</span><span class="op" id="5251083">,</span>&nbsp;<span class="op" id="5251085">&amp;</span><span class="ident" id="5251086">Error</span><span class="op" id="5251091">{</span><span class="ident" id="5251092">ErrInvalidCharRange</span><span class="op" id="5251111">,</span>&nbsp;<span class="ident" id="5251113">seq</span><span class="op" id="5251116">}</span><br>
<span class="lineno">1490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5251119">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5251123">if</span>&nbsp;<span class="ident" id="5251126">p</span><span class="op" id="5251127">.</span><span class="ident" id="5251128">flags</span><span class="op" id="5251133">&amp;</span><span class="ident" id="5251134">FoldCase</span>&nbsp;<span class="op" id="5251143">==</span>&nbsp;<span class="num" id="5251146">0</span>&nbsp;<span class="op" id="5251148">||</span>&nbsp;<span class="ident" id="5251151">fold</span>&nbsp;<span class="op" id="5251156">==</span>&nbsp;<span class="builtintype" id="5251159">nil</span>&nbsp;<span class="op" id="5251163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5251167">if</span>&nbsp;<span class="ident" id="5251170">sign</span>&nbsp;<span class="op" id="5251175">&gt;</span>&nbsp;<span class="num" id="5251177">0</span>&nbsp;<span class="op" id="5251179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5251184">r</span>&nbsp;<span class="op" id="5251186">=</span>&nbsp;<span class="ident" id="5251188">appendTable</span><span class="op" id="5251199">(</span><span class="ident" id="5251200">r</span><span class="op" id="5251201">,</span>&nbsp;<span class="ident" id="5251203">tab</span><span class="op" id="5251206">)</span><br>
<span class="lineno">1495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5251210">}</span>&nbsp;<span class="keyword" id="5251212">else</span>&nbsp;<span class="op" id="5251217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5251222">r</span>&nbsp;<span class="op" id="5251224">=</span>&nbsp;<span class="ident" id="5251226">appendNegatedTable</span><span class="op" id="5251244">(</span><span class="ident" id="5251245">r</span><span class="op" id="5251246">,</span>&nbsp;<span class="ident" id="5251248">tab</span><span class="op" id="5251251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5251255">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5251258">}</span>&nbsp;<span class="keyword" id="5251260">else</span>&nbsp;<span class="op" id="5251265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5251269">//&nbsp;Merge&nbsp;and&nbsp;clean&nbsp;tab&nbsp;and&nbsp;fold&nbsp;in&nbsp;a&nbsp;temporary&nbsp;buffer.</span><br>
<span class="lineno">1500</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5251326">//&nbsp;This&nbsp;is&nbsp;necessary&nbsp;for&nbsp;the&nbsp;negative&nbsp;case&nbsp;and&nbsp;just&nbsp;tidy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5251385">//&nbsp;for&nbsp;the&nbsp;positive&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5251413">tmp</span>&nbsp;<span class="op" id="5251417">:=</span>&nbsp;<span class="ident" id="5251420">p</span><span class="op" id="5251421">.</span><span class="ident" id="5251422">tmpClass</span><span class="op" id="5251430">[</span><span class="op" id="5251431">:</span><span class="num" id="5251432">0</span><span class="op" id="5251433">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5251437">tmp</span>&nbsp;<span class="op" id="5251441">=</span>&nbsp;<span class="ident" id="5251443">appendTable</span><span class="op" id="5251454">(</span><span class="ident" id="5251455">tmp</span><span class="op" id="5251458">,</span>&nbsp;<span class="ident" id="5251460">tab</span><span class="op" id="5251463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5251467">tmp</span>&nbsp;<span class="op" id="5251471">=</span>&nbsp;<span class="ident" id="5251473">appendTable</span><span class="op" id="5251484">(</span><span class="ident" id="5251485">tmp</span><span class="op" id="5251488">,</span>&nbsp;<span class="ident" id="5251490">fold</span><span class="op" id="5251494">)</span><br>
<span class="lineno">1505</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5251498">p</span><span class="op" id="5251499">.</span><span class="ident" id="5251500">tmpClass</span>&nbsp;<span class="op" id="5251509">=</span>&nbsp;<span class="ident" id="5251511">tmp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5251517">tmp</span>&nbsp;<span class="op" id="5251521">=</span>&nbsp;<span class="ident" id="5251523">cleanClass</span><span class="op" id="5251533">(</span><span class="op" id="5251534">&amp;</span><span class="ident" id="5251535">p</span><span class="op" id="5251536">.</span><span class="ident" id="5251537">tmpClass</span><span class="op" id="5251545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5251549">if</span>&nbsp;<span class="ident" id="5251552">sign</span>&nbsp;<span class="op" id="5251557">&gt;</span>&nbsp;<span class="num" id="5251559">0</span>&nbsp;<span class="op" id="5251561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5251566">r</span>&nbsp;<span class="op" id="5251568">=</span>&nbsp;<span class="ident" id="5251570">appendClass</span><span class="op" id="5251581">(</span><span class="ident" id="5251582">r</span><span class="op" id="5251583">,</span>&nbsp;<span class="ident" id="5251585">tmp</span><span class="op" id="5251588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5251592">}</span>&nbsp;<span class="keyword" id="5251594">else</span>&nbsp;<span class="op" id="5251599">{</span><br>
<span class="lineno">1510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5251604">r</span>&nbsp;<span class="op" id="5251606">=</span>&nbsp;<span class="ident" id="5251608">appendNegatedClass</span><span class="op" id="5251626">(</span><span class="ident" id="5251627">r</span><span class="op" id="5251628">,</span>&nbsp;<span class="ident" id="5251630">tmp</span><span class="op" id="5251633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5251637">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5251640">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5251643">return</span>&nbsp;<span class="ident" id="5251650">r</span><span class="op" id="5251651">,</span>&nbsp;<span class="ident" id="5251653">t</span><span class="op" id="5251654">,</span>&nbsp;<span class="builtintype" id="5251656">nil</span><br>
<span class="lineno"></span><span class="op" id="5251660">}</span><br>
<span class="lineno">1515</span><br>
<span class="lineno"></span><span class="comment" id="5251663">//&nbsp;parseClass&nbsp;parses&nbsp;a&nbsp;character&nbsp;class&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;s</span><br>
<span class="lineno"></span><span class="comment" id="5251724">//&nbsp;and&nbsp;pushes&nbsp;it&nbsp;onto&nbsp;the&nbsp;parse&nbsp;stack.</span><br>
<span class="lineno"></span><span class="keyword" id="5251763">func</span>&nbsp;<span class="op" id="5251768">(</span><span class="ident" id="5251769">p</span>&nbsp;<span class="op" id="5251771">*</span><span class="ident" id="5251772">parser</span><span class="op" id="5251778">)</span>&nbsp;<span class="ident" id="5251780">parseClass</span><span class="op" id="5251790">(</span><span class="ident" id="5251791">s</span>&nbsp;<span class="builtintype" id="5251793">string</span><span class="op" id="5251799">)</span>&nbsp;<span class="op" id="5251801">(</span><span class="ident" id="5251802">rest</span>&nbsp;<span class="builtintype" id="5251807">string</span><span class="op" id="5251813">,</span>&nbsp;<span class="ident" id="5251815">err</span>&nbsp;<span class="builtintype" id="5251819">error</span><span class="op" id="5251824">)</span>&nbsp;<span class="op" id="5251826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5251829">t</span>&nbsp;<span class="op" id="5251831">:=</span>&nbsp;<span class="ident" id="5251834">s</span><span class="op" id="5251835">[</span><span class="num" id="5251836">1</span><span class="op" id="5251837">:</span><span class="op" id="5251838">]</span>&nbsp;<span class="comment" id="5251840">//&nbsp;chop&nbsp;[</span><br>
<span class="lineno">1520</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5251851">re</span>&nbsp;<span class="op" id="5251854">:=</span>&nbsp;<span class="ident" id="5251857">p</span><span class="op" id="5251858">.</span><span class="ident" id="5251859">newRegexp</span><span class="op" id="5251868">(</span><span class="ident" id="5251869">OpCharClass</span><span class="op" id="5251880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5251883">re</span><span class="op" id="5251885">.</span><span class="ident" id="5251886">Flags</span>&nbsp;<span class="op" id="5251892">=</span>&nbsp;<span class="ident" id="5251894">p</span><span class="op" id="5251895">.</span><span class="ident" id="5251896">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5251903">re</span><span class="op" id="5251905">.</span><span class="ident" id="5251906">Rune</span>&nbsp;<span class="op" id="5251911">=</span>&nbsp;<span class="ident" id="5251913">re</span><span class="op" id="5251915">.</span><span class="ident" id="5251916">Rune0</span><span class="op" id="5251921">[</span><span class="op" id="5251922">:</span><span class="num" id="5251923">0</span><span class="op" id="5251924">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5251928">sign</span>&nbsp;<span class="op" id="5251933">:=</span>&nbsp;<span class="op" id="5251936">+</span><span class="num" id="5251937">1</span><br>
<span class="lineno">1525</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5251940">if</span>&nbsp;<span class="ident" id="5251943">t</span>&nbsp;<span class="op" id="5251945">!=</span>&nbsp;<span class="string" id="5251948">&#34;&#34;</span>&nbsp;<span class="op" id="5251951">&amp;&amp;</span>&nbsp;<span class="ident" id="5251954">t</span><span class="op" id="5251955">[</span><span class="num" id="5251956">0</span><span class="op" id="5251957">]</span>&nbsp;<span class="op" id="5251959">==</span>&nbsp;<span class="string" id="5251962">&#39;^&#39;</span>&nbsp;<span class="op" id="5251966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5251970">sign</span>&nbsp;<span class="op" id="5251975">=</span>&nbsp;<span class="op" id="5251977">-</span><span class="num" id="5251978">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5251982">t</span>&nbsp;<span class="op" id="5251984">=</span>&nbsp;<span class="ident" id="5251986">t</span><span class="op" id="5251987">[</span><span class="num" id="5251988">1</span><span class="op" id="5251989">:</span><span class="op" id="5251990">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5251995">//&nbsp;If&nbsp;character&nbsp;class&nbsp;does&nbsp;not&nbsp;match&nbsp;\n,&nbsp;add&nbsp;it&nbsp;here,</span><br>
<span class="lineno">1530</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5252051">//&nbsp;so&nbsp;that&nbsp;negation&nbsp;later&nbsp;will&nbsp;do&nbsp;the&nbsp;right&nbsp;thing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5252104">if</span>&nbsp;<span class="ident" id="5252107">p</span><span class="op" id="5252108">.</span><span class="ident" id="5252109">flags</span><span class="op" id="5252114">&amp;</span><span class="ident" id="5252115">ClassNL</span>&nbsp;<span class="op" id="5252123">==</span>&nbsp;<span class="num" id="5252126">0</span>&nbsp;<span class="op" id="5252128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5252133">re</span><span class="op" id="5252135">.</span><span class="ident" id="5252136">Rune</span>&nbsp;<span class="op" id="5252141">=</span>&nbsp;<span class="builtinfunc" id="5252143">append</span><span class="op" id="5252149">(</span><span class="ident" id="5252150">re</span><span class="op" id="5252152">.</span><span class="ident" id="5252153">Rune</span><span class="op" id="5252157">,</span>&nbsp;<span class="string" id="5252159">&#39;\n&#39;</span><span class="op" id="5252163">,</span>&nbsp;<span class="string" id="5252165">&#39;\n&#39;</span><span class="op" id="5252169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5252173">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5252176">}</span><br>
<span class="lineno">1535</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5252180">class</span>&nbsp;<span class="op" id="5252186">:=</span>&nbsp;<span class="ident" id="5252189">re</span><span class="op" id="5252191">.</span><span class="ident" id="5252192">Rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5252198">first</span>&nbsp;<span class="op" id="5252204">:=</span>&nbsp;<span class="builtintype" id="5252207">true</span>&nbsp;<span class="comment" id="5252212">//&nbsp;]&nbsp;and&nbsp;-&nbsp;are&nbsp;okay&nbsp;as&nbsp;first&nbsp;char&nbsp;in&nbsp;class</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5252256">for</span>&nbsp;<span class="ident" id="5252260">t</span>&nbsp;<span class="op" id="5252262">==</span>&nbsp;<span class="string" id="5252265">&#34;&#34;</span>&nbsp;<span class="op" id="5252268">||</span>&nbsp;<span class="ident" id="5252271">t</span><span class="op" id="5252272">[</span><span class="num" id="5252273">0</span><span class="op" id="5252274">]</span>&nbsp;<span class="op" id="5252276">!=</span>&nbsp;<span class="string" id="5252279">&#39;]&#39;</span>&nbsp;<span class="op" id="5252283">||</span>&nbsp;<span class="ident" id="5252286">first</span>&nbsp;<span class="op" id="5252292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5252296">//&nbsp;POSIX:&nbsp;-&nbsp;is&nbsp;only&nbsp;okay&nbsp;unescaped&nbsp;as&nbsp;first&nbsp;or&nbsp;last&nbsp;in&nbsp;class.</span><br>
<span class="lineno">1540</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5252360">//&nbsp;Perl:&nbsp;-&nbsp;is&nbsp;okay&nbsp;anywhere.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5252391">if</span>&nbsp;<span class="ident" id="5252394">t</span>&nbsp;<span class="op" id="5252396">!=</span>&nbsp;<span class="string" id="5252399">&#34;&#34;</span>&nbsp;<span class="op" id="5252402">&amp;&amp;</span>&nbsp;<span class="ident" id="5252405">t</span><span class="op" id="5252406">[</span><span class="num" id="5252407">0</span><span class="op" id="5252408">]</span>&nbsp;<span class="op" id="5252410">==</span>&nbsp;<span class="string" id="5252413">&#39;-&#39;</span>&nbsp;<span class="op" id="5252417">&amp;&amp;</span>&nbsp;<span class="ident" id="5252420">p</span><span class="op" id="5252421">.</span><span class="ident" id="5252422">flags</span><span class="op" id="5252427">&amp;</span><span class="ident" id="5252428">PerlX</span>&nbsp;<span class="op" id="5252434">==</span>&nbsp;<span class="num" id="5252437">0</span>&nbsp;<span class="op" id="5252439">&amp;&amp;</span>&nbsp;<span class="op" id="5252442">!</span><span class="ident" id="5252443">first</span>&nbsp;<span class="op" id="5252449">&amp;&amp;</span>&nbsp;<span class="op" id="5252452">(</span><span class="builtinfunc" id="5252453">len</span><span class="op" id="5252456">(</span><span class="ident" id="5252457">t</span><span class="op" id="5252458">)</span>&nbsp;<span class="op" id="5252460">==</span>&nbsp;<span class="num" id="5252463">1</span>&nbsp;<span class="op" id="5252465">||</span>&nbsp;<span class="ident" id="5252468">t</span><span class="op" id="5252469">[</span><span class="num" id="5252470">1</span><span class="op" id="5252471">]</span>&nbsp;<span class="op" id="5252473">!=</span>&nbsp;<span class="string" id="5252476">&#39;]&#39;</span><span class="op" id="5252479">)</span>&nbsp;<span class="op" id="5252481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5252486">_</span><span class="op" id="5252487">,</span>&nbsp;<span class="ident" id="5252489">size</span>&nbsp;<span class="op" id="5252494">:=</span>&nbsp;<span class="ident" id="5252497">utf8</span><span class="op" id="5252501">.</span><span class="ident" id="5252502">DecodeRuneInString</span><span class="op" id="5252520">(</span><span class="ident" id="5252521">t</span><span class="op" id="5252522">[</span><span class="num" id="5252523">1</span><span class="op" id="5252524">:</span><span class="op" id="5252525">]</span><span class="op" id="5252526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5252531">return</span>&nbsp;<span class="string" id="5252538">&#34;&#34;</span><span class="op" id="5252540">,</span>&nbsp;<span class="op" id="5252542">&amp;</span><span class="ident" id="5252543">Error</span><span class="op" id="5252548">{</span><span class="ident" id="5252549">Code</span><span class="op" id="5252553">:</span>&nbsp;<span class="ident" id="5252555">ErrInvalidCharRange</span><span class="op" id="5252574">,</span>&nbsp;<span class="ident" id="5252576">Expr</span><span class="op" id="5252580">:</span>&nbsp;<span class="ident" id="5252582">t</span><span class="op" id="5252583">[</span><span class="op" id="5252584">:</span><span class="num" id="5252585">1</span><span class="op" id="5252586">+</span><span class="ident" id="5252587">size</span><span class="op" id="5252591">]</span><span class="op" id="5252592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5252596">}</span><br>
<span class="lineno">1545</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5252600">first</span>&nbsp;<span class="op" id="5252606">=</span>&nbsp;<span class="builtintype" id="5252608">false</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5252617">//&nbsp;Look&nbsp;for&nbsp;POSIX&nbsp;[:alnum:]&nbsp;etc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5252652">if</span>&nbsp;<span class="builtinfunc" id="5252655">len</span><span class="op" id="5252658">(</span><span class="ident" id="5252659">t</span><span class="op" id="5252660">)</span>&nbsp;<span class="op" id="5252662">&gt;</span>&nbsp;<span class="num" id="5252664">2</span>&nbsp;<span class="op" id="5252666">&amp;&amp;</span>&nbsp;<span class="ident" id="5252669">t</span><span class="op" id="5252670">[</span><span class="num" id="5252671">0</span><span class="op" id="5252672">]</span>&nbsp;<span class="op" id="5252674">==</span>&nbsp;<span class="string" id="5252677">&#39;[&#39;</span>&nbsp;<span class="op" id="5252681">&amp;&amp;</span>&nbsp;<span class="ident" id="5252684">t</span><span class="op" id="5252685">[</span><span class="num" id="5252686">1</span><span class="op" id="5252687">]</span>&nbsp;<span class="op" id="5252689">==</span>&nbsp;<span class="string" id="5252692">&#39;:&#39;</span>&nbsp;<span class="op" id="5252696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5252701">nclass</span><span class="op" id="5252707">,</span>&nbsp;<span class="ident" id="5252709">nt</span><span class="op" id="5252711">,</span>&nbsp;<span class="ident" id="5252713">err</span>&nbsp;<span class="op" id="5252717">:=</span>&nbsp;<span class="ident" id="5252720">p</span><span class="op" id="5252721">.</span><span class="ident" id="5252722">parseNamedClass</span><span class="op" id="5252737">(</span><span class="ident" id="5252738">t</span><span class="op" id="5252739">,</span>&nbsp;<span class="ident" id="5252741">class</span><span class="op" id="5252746">)</span><br>
<span class="lineno">1550</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5252751">if</span>&nbsp;<span class="ident" id="5252754">err</span>&nbsp;<span class="op" id="5252758">!=</span>&nbsp;<span class="builtintype" id="5252761">nil</span>&nbsp;<span class="op" id="5252765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5252771">return</span>&nbsp;<span class="string" id="5252778">&#34;&#34;</span><span class="op" id="5252780">,</span>&nbsp;<span class="ident" id="5252782">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5252789">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5252794">if</span>&nbsp;<span class="ident" id="5252797">nclass</span>&nbsp;<span class="op" id="5252804">!=</span>&nbsp;<span class="builtintype" id="5252807">nil</span>&nbsp;<span class="op" id="5252811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5252817">class</span><span class="op" id="5252822">,</span>&nbsp;<span class="ident" id="5252824">t</span>&nbsp;<span class="op" id="5252826">=</span>&nbsp;<span class="ident" id="5252828">nclass</span><span class="op" id="5252834">,</span>&nbsp;<span class="ident" id="5252836">nt</span><br>
<span class="lineno">1555</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5252843">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5252855">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5252859">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5252864">//&nbsp;Look&nbsp;for&nbsp;Unicode&nbsp;character&nbsp;group&nbsp;like&nbsp;\p{Han}.</span><br>
<span class="lineno">1560</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5252916">nclass</span><span class="op" id="5252922">,</span>&nbsp;<span class="ident" id="5252924">nt</span><span class="op" id="5252926">,</span>&nbsp;<span class="ident" id="5252928">err</span>&nbsp;<span class="op" id="5252932">:=</span>&nbsp;<span class="ident" id="5252935">p</span><span class="op" id="5252936">.</span><span class="ident" id="5252937">parseUnicodeClass</span><span class="op" id="5252954">(</span><span class="ident" id="5252955">t</span><span class="op" id="5252956">,</span>&nbsp;<span class="ident" id="5252958">class</span><span class="op" id="5252963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5252967">if</span>&nbsp;<span class="ident" id="5252970">err</span>&nbsp;<span class="op" id="5252974">!=</span>&nbsp;<span class="builtintype" id="5252977">nil</span>&nbsp;<span class="op" id="5252981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5252986">return</span>&nbsp;<span class="string" id="5252993">&#34;&#34;</span><span class="op" id="5252995">,</span>&nbsp;<span class="ident" id="5252997">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5253003">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5253007">if</span>&nbsp;<span class="ident" id="5253010">nclass</span>&nbsp;<span class="op" id="5253017">!=</span>&nbsp;<span class="builtintype" id="5253020">nil</span>&nbsp;<span class="op" id="5253024">{</span><br>
<span class="lineno">1565</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5253029">class</span><span class="op" id="5253034">,</span>&nbsp;<span class="ident" id="5253036">t</span>&nbsp;<span class="op" id="5253038">=</span>&nbsp;<span class="ident" id="5253040">nclass</span><span class="op" id="5253046">,</span>&nbsp;<span class="ident" id="5253048">nt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5253054">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5253065">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5253070">//&nbsp;Look&nbsp;for&nbsp;Perl&nbsp;character&nbsp;class&nbsp;symbols&nbsp;(extension).</span><br>
<span class="lineno">1570</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5253126">if</span>&nbsp;<span class="ident" id="5253129">nclass</span><span class="op" id="5253135">,</span>&nbsp;<span class="ident" id="5253137">nt</span>&nbsp;<span class="op" id="5253140">:=</span>&nbsp;<span class="ident" id="5253143">p</span><span class="op" id="5253144">.</span><span class="ident" id="5253145">parsePerlClassEscape</span><span class="op" id="5253165">(</span><span class="ident" id="5253166">t</span><span class="op" id="5253167">,</span>&nbsp;<span class="ident" id="5253169">class</span><span class="op" id="5253174">)</span><span class="op" id="5253175">;</span>&nbsp;<span class="ident" id="5253177">nclass</span>&nbsp;<span class="op" id="5253184">!=</span>&nbsp;<span class="builtintype" id="5253187">nil</span>&nbsp;<span class="op" id="5253191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5253196">class</span><span class="op" id="5253201">,</span>&nbsp;<span class="ident" id="5253203">t</span>&nbsp;<span class="op" id="5253205">=</span>&nbsp;<span class="ident" id="5253207">nclass</span><span class="op" id="5253213">,</span>&nbsp;<span class="ident" id="5253215">nt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5253221">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5253232">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1575</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5253237">//&nbsp;Single&nbsp;character&nbsp;or&nbsp;simple&nbsp;range.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5253276">rng</span>&nbsp;<span class="op" id="5253280">:=</span>&nbsp;<span class="ident" id="5253283">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5253287">var</span>&nbsp;<span class="ident" id="5253291">lo</span><span class="op" id="5253293">,</span>&nbsp;<span class="ident" id="5253295">hi</span>&nbsp;<span class="builtintype" id="5253298">rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5253305">if</span>&nbsp;<span class="ident" id="5253308">lo</span><span class="op" id="5253310">,</span>&nbsp;<span class="ident" id="5253312">t</span><span class="op" id="5253313">,</span>&nbsp;<span class="ident" id="5253315">err</span>&nbsp;<span class="op" id="5253319">=</span>&nbsp;<span class="ident" id="5253321">p</span><span class="op" id="5253322">.</span><span class="ident" id="5253323">parseClassChar</span><span class="op" id="5253337">(</span><span class="ident" id="5253338">t</span><span class="op" id="5253339">,</span>&nbsp;<span class="ident" id="5253341">s</span><span class="op" id="5253342">)</span><span class="op" id="5253343">;</span>&nbsp;<span class="ident" id="5253345">err</span>&nbsp;<span class="op" id="5253349">!=</span>&nbsp;<span class="builtintype" id="5253352">nil</span>&nbsp;<span class="op" id="5253356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5253361">return</span>&nbsp;<span class="string" id="5253368">&#34;&#34;</span><span class="op" id="5253370">,</span>&nbsp;<span class="ident" id="5253372">err</span><br>
<span class="lineno">1580</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5253378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5253382">hi</span>&nbsp;<span class="op" id="5253385">=</span>&nbsp;<span class="ident" id="5253387">lo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5253392">//&nbsp;[a-]&nbsp;means&nbsp;(a|-)&nbsp;so&nbsp;check&nbsp;for&nbsp;final&nbsp;].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5253436">if</span>&nbsp;<span class="builtinfunc" id="5253439">len</span><span class="op" id="5253442">(</span><span class="ident" id="5253443">t</span><span class="op" id="5253444">)</span>&nbsp;<span class="op" id="5253446">&gt;=</span>&nbsp;<span class="num" id="5253449">2</span>&nbsp;<span class="op" id="5253451">&amp;&amp;</span>&nbsp;<span class="ident" id="5253454">t</span><span class="op" id="5253455">[</span><span class="num" id="5253456">0</span><span class="op" id="5253457">]</span>&nbsp;<span class="op" id="5253459">==</span>&nbsp;<span class="string" id="5253462">&#39;-&#39;</span>&nbsp;<span class="op" id="5253466">&amp;&amp;</span>&nbsp;<span class="ident" id="5253469">t</span><span class="op" id="5253470">[</span><span class="num" id="5253471">1</span><span class="op" id="5253472">]</span>&nbsp;<span class="op" id="5253474">!=</span>&nbsp;<span class="string" id="5253477">&#39;]&#39;</span>&nbsp;<span class="op" id="5253481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5253486">t</span>&nbsp;<span class="op" id="5253488">=</span>&nbsp;<span class="ident" id="5253490">t</span><span class="op" id="5253491">[</span><span class="num" id="5253492">1</span><span class="op" id="5253493">:</span><span class="op" id="5253494">]</span><br>
<span class="lineno">1585</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5253499">if</span>&nbsp;<span class="ident" id="5253502">hi</span><span class="op" id="5253504">,</span>&nbsp;<span class="ident" id="5253506">t</span><span class="op" id="5253507">,</span>&nbsp;<span class="ident" id="5253509">err</span>&nbsp;<span class="op" id="5253513">=</span>&nbsp;<span class="ident" id="5253515">p</span><span class="op" id="5253516">.</span><span class="ident" id="5253517">parseClassChar</span><span class="op" id="5253531">(</span><span class="ident" id="5253532">t</span><span class="op" id="5253533">,</span>&nbsp;<span class="ident" id="5253535">s</span><span class="op" id="5253536">)</span><span class="op" id="5253537">;</span>&nbsp;<span class="ident" id="5253539">err</span>&nbsp;<span class="op" id="5253543">!=</span>&nbsp;<span class="builtintype" id="5253546">nil</span>&nbsp;<span class="op" id="5253550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5253556">return</span>&nbsp;<span class="string" id="5253563">&#34;&#34;</span><span class="op" id="5253565">,</span>&nbsp;<span class="ident" id="5253567">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5253574">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5253579">if</span>&nbsp;<span class="ident" id="5253582">hi</span>&nbsp;<span class="op" id="5253585">&lt;</span>&nbsp;<span class="ident" id="5253587">lo</span>&nbsp;<span class="op" id="5253590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5253596">rng</span>&nbsp;<span class="op" id="5253600">=</span>&nbsp;<span class="ident" id="5253602">rng</span><span class="op" id="5253605">[</span><span class="op" id="5253606">:</span><span class="builtinfunc" id="5253607">len</span><span class="op" id="5253610">(</span><span class="ident" id="5253611">rng</span><span class="op" id="5253614">)</span><span class="op" id="5253615">-</span><span class="builtinfunc" id="5253616">len</span><span class="op" id="5253619">(</span><span class="ident" id="5253620">t</span><span class="op" id="5253621">)</span><span class="op" id="5253622">]</span><br>
<span class="lineno">1590</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5253628">return</span>&nbsp;<span class="string" id="5253635">&#34;&#34;</span><span class="op" id="5253637">,</span>&nbsp;<span class="op" id="5253639">&amp;</span><span class="ident" id="5253640">Error</span><span class="op" id="5253645">{</span><span class="ident" id="5253646">Code</span><span class="op" id="5253650">:</span>&nbsp;<span class="ident" id="5253652">ErrInvalidCharRange</span><span class="op" id="5253671">,</span>&nbsp;<span class="ident" id="5253673">Expr</span><span class="op" id="5253677">:</span>&nbsp;<span class="ident" id="5253679">rng</span><span class="op" id="5253682">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5253687">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5253691">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5253695">if</span>&nbsp;<span class="ident" id="5253698">p</span><span class="op" id="5253699">.</span><span class="ident" id="5253700">flags</span><span class="op" id="5253705">&amp;</span><span class="ident" id="5253706">FoldCase</span>&nbsp;<span class="op" id="5253715">==</span>&nbsp;<span class="num" id="5253718">0</span>&nbsp;<span class="op" id="5253720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5253725">class</span>&nbsp;<span class="op" id="5253731">=</span>&nbsp;<span class="ident" id="5253733">appendRange</span><span class="op" id="5253744">(</span><span class="ident" id="5253745">class</span><span class="op" id="5253750">,</span>&nbsp;<span class="ident" id="5253752">lo</span><span class="op" id="5253754">,</span>&nbsp;<span class="ident" id="5253756">hi</span><span class="op" id="5253758">)</span><br>
<span class="lineno">1595</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5253762">}</span>&nbsp;<span class="keyword" id="5253764">else</span>&nbsp;<span class="op" id="5253769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5253774">class</span>&nbsp;<span class="op" id="5253780">=</span>&nbsp;<span class="ident" id="5253782">appendFoldedRange</span><span class="op" id="5253799">(</span><span class="ident" id="5253800">class</span><span class="op" id="5253805">,</span>&nbsp;<span class="ident" id="5253807">lo</span><span class="op" id="5253809">,</span>&nbsp;<span class="ident" id="5253811">hi</span><span class="op" id="5253813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5253817">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5253820">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5253823">t</span>&nbsp;<span class="op" id="5253825">=</span>&nbsp;<span class="ident" id="5253827">t</span><span class="op" id="5253828">[</span><span class="num" id="5253829">1</span><span class="op" id="5253830">:</span><span class="op" id="5253831">]</span>&nbsp;<span class="comment" id="5253833">//&nbsp;chop&nbsp;]</span><br>
<span class="lineno">1600</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5253845">//&nbsp;Use&nbsp;&amp;re.Rune&nbsp;instead&nbsp;of&nbsp;&amp;class&nbsp;to&nbsp;avoid&nbsp;allocation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5253901">re</span><span class="op" id="5253903">.</span><span class="ident" id="5253904">Rune</span>&nbsp;<span class="op" id="5253909">=</span>&nbsp;<span class="ident" id="5253911">class</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5253918">class</span>&nbsp;<span class="op" id="5253924">=</span>&nbsp;<span class="ident" id="5253926">cleanClass</span><span class="op" id="5253936">(</span><span class="op" id="5253937">&amp;</span><span class="ident" id="5253938">re</span><span class="op" id="5253940">.</span><span class="ident" id="5253941">Rune</span><span class="op" id="5253945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5253948">if</span>&nbsp;<span class="ident" id="5253951">sign</span>&nbsp;<span class="op" id="5253956">&lt;</span>&nbsp;<span class="num" id="5253958">0</span>&nbsp;<span class="op" id="5253960">{</span><br>
<span class="lineno">1605</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5253964">class</span>&nbsp;<span class="op" id="5253970">=</span>&nbsp;<span class="ident" id="5253972">negateClass</span><span class="op" id="5253983">(</span><span class="ident" id="5253984">class</span><span class="op" id="5253989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5253992">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5253995">re</span><span class="op" id="5253997">.</span><span class="ident" id="5253998">Rune</span>&nbsp;<span class="op" id="5254003">=</span>&nbsp;<span class="ident" id="5254005">class</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5254012">p</span><span class="op" id="5254013">.</span><span class="ident" id="5254014">push</span><span class="op" id="5254018">(</span><span class="ident" id="5254019">re</span><span class="op" id="5254021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5254024">return</span>&nbsp;<span class="ident" id="5254031">t</span><span class="op" id="5254032">,</span>&nbsp;<span class="builtintype" id="5254034">nil</span><br>
<span class="lineno">1610</span><span class="op" id="5254038">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5254041">//&nbsp;cleanClass&nbsp;sorts&nbsp;the&nbsp;ranges&nbsp;(pairs&nbsp;of&nbsp;elements&nbsp;of&nbsp;r),</span><br>
<span class="lineno"></span><span class="comment" id="5254098">//&nbsp;merges&nbsp;them,&nbsp;and&nbsp;eliminates&nbsp;duplicates.</span><br>
<span class="lineno"></span><span class="keyword" id="5254141">func</span>&nbsp;<span class="ident" id="5254146">cleanClass</span><span class="op" id="5254156">(</span><span class="ident" id="5254157">rp</span>&nbsp;<span class="op" id="5254160">*</span><span class="op" id="5254161">[</span><span class="op" id="5254162">]</span><span class="builtintype" id="5254163">rune</span><span class="op" id="5254167">)</span>&nbsp;<span class="op" id="5254169">[</span><span class="op" id="5254170">]</span><span class="builtintype" id="5254171">rune</span>&nbsp;<span class="op" id="5254176">{</span><br>
<span class="lineno">1615</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5254180">//&nbsp;Sort&nbsp;by&nbsp;lo&nbsp;increasing,&nbsp;hi&nbsp;decreasing&nbsp;to&nbsp;break&nbsp;ties.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5254236">sort</span><span class="op" id="5254240">.</span><span class="ident" id="5254241">Sort</span><span class="op" id="5254245">(</span><span class="ident" id="5254246">ranges</span><span class="op" id="5254252">{</span><span class="ident" id="5254253">rp</span><span class="op" id="5254255">}</span><span class="op" id="5254256">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5254260">r</span>&nbsp;<span class="op" id="5254262">:=</span>&nbsp;<span class="op" id="5254265">*</span><span class="ident" id="5254266">rp</span><br>
<span class="lineno">1620</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5254270">if</span>&nbsp;<span class="builtinfunc" id="5254273">len</span><span class="op" id="5254276">(</span><span class="ident" id="5254277">r</span><span class="op" id="5254278">)</span>&nbsp;<span class="op" id="5254280">&lt;</span>&nbsp;<span class="num" id="5254282">2</span>&nbsp;<span class="op" id="5254284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5254288">return</span>&nbsp;<span class="ident" id="5254295">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5254298">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5254302">//&nbsp;Merge&nbsp;abutting,&nbsp;overlapping.</span><br>
<span class="lineno">1625</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5254335">w</span>&nbsp;<span class="op" id="5254337">:=</span>&nbsp;<span class="num" id="5254340">2</span>&nbsp;<span class="comment" id="5254342">//&nbsp;write&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5254358">for</span>&nbsp;<span class="ident" id="5254362">i</span>&nbsp;<span class="op" id="5254364">:=</span>&nbsp;<span class="num" id="5254367">2</span><span class="op" id="5254368">;</span>&nbsp;<span class="ident" id="5254370">i</span>&nbsp;<span class="op" id="5254372">&lt;</span>&nbsp;<span class="builtinfunc" id="5254374">len</span><span class="op" id="5254377">(</span><span class="ident" id="5254378">r</span><span class="op" id="5254379">)</span><span class="op" id="5254380">;</span>&nbsp;<span class="ident" id="5254382">i</span>&nbsp;<span class="op" id="5254384">+=</span>&nbsp;<span class="num" id="5254387">2</span>&nbsp;<span class="op" id="5254389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5254393">lo</span><span class="op" id="5254395">,</span>&nbsp;<span class="ident" id="5254397">hi</span>&nbsp;<span class="op" id="5254400">:=</span>&nbsp;<span class="ident" id="5254403">r</span><span class="op" id="5254404">[</span><span class="ident" id="5254405">i</span><span class="op" id="5254406">]</span><span class="op" id="5254407">,</span>&nbsp;<span class="ident" id="5254409">r</span><span class="op" id="5254410">[</span><span class="ident" id="5254411">i</span><span class="op" id="5254412">+</span><span class="num" id="5254413">1</span><span class="op" id="5254414">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5254418">if</span>&nbsp;<span class="ident" id="5254421">lo</span>&nbsp;<span class="op" id="5254424">&lt;=</span>&nbsp;<span class="ident" id="5254427">r</span><span class="op" id="5254428">[</span><span class="ident" id="5254429">w</span><span class="op" id="5254430">-</span><span class="num" id="5254431">1</span><span class="op" id="5254432">]</span><span class="op" id="5254433">+</span><span class="num" id="5254434">1</span>&nbsp;<span class="op" id="5254436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5254441">//&nbsp;merge&nbsp;with&nbsp;previous&nbsp;range</span><br>
<span class="lineno">1630</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5254473">if</span>&nbsp;<span class="ident" id="5254476">hi</span>&nbsp;<span class="op" id="5254479">&gt;</span>&nbsp;<span class="ident" id="5254481">r</span><span class="op" id="5254482">[</span><span class="ident" id="5254483">w</span><span class="op" id="5254484">-</span><span class="num" id="5254485">1</span><span class="op" id="5254486">]</span>&nbsp;<span class="op" id="5254488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5254494">r</span><span class="op" id="5254495">[</span><span class="ident" id="5254496">w</span><span class="op" id="5254497">-</span><span class="num" id="5254498">1</span><span class="op" id="5254499">]</span>&nbsp;<span class="op" id="5254501">=</span>&nbsp;<span class="ident" id="5254503">hi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5254509">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5254514">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5254525">}</span><br>
<span class="lineno">1635</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5254529">//&nbsp;new&nbsp;disjoint&nbsp;range</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5254553">r</span><span class="op" id="5254554">[</span><span class="ident" id="5254555">w</span><span class="op" id="5254556">]</span>&nbsp;<span class="op" id="5254558">=</span>&nbsp;<span class="ident" id="5254560">lo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5254565">r</span><span class="op" id="5254566">[</span><span class="ident" id="5254567">w</span><span class="op" id="5254568">+</span><span class="num" id="5254569">1</span><span class="op" id="5254570">]</span>&nbsp;<span class="op" id="5254572">=</span>&nbsp;<span class="ident" id="5254574">hi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5254579">w</span>&nbsp;<span class="op" id="5254581">+=</span>&nbsp;<span class="num" id="5254584">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5254587">}</span><br>
<span class="lineno">1640</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5254591">return</span>&nbsp;<span class="ident" id="5254598">r</span><span class="op" id="5254599">[</span><span class="op" id="5254600">:</span><span class="ident" id="5254601">w</span><span class="op" id="5254602">]</span><br>
<span class="lineno"></span><span class="op" id="5254604">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5254607">//&nbsp;appendLiteral&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;the&nbsp;literal&nbsp;x&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno">1645</span><span class="keyword" id="5254686">func</span>&nbsp;<span class="ident" id="5254691">appendLiteral</span><span class="op" id="5254704">(</span><span class="ident" id="5254705">r</span>&nbsp;<span class="op" id="5254707">[</span><span class="op" id="5254708">]</span><span class="builtintype" id="5254709">rune</span><span class="op" id="5254713">,</span>&nbsp;<span class="ident" id="5254715">x</span>&nbsp;<span class="builtintype" id="5254717">rune</span><span class="op" id="5254721">,</span>&nbsp;<span class="ident" id="5254723">flags</span>&nbsp;<span class="ident" id="5254729">Flags</span><span class="op" id="5254734">)</span>&nbsp;<span class="op" id="5254736">[</span><span class="op" id="5254737">]</span><span class="builtintype" id="5254738">rune</span>&nbsp;<span class="op" id="5254743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5254746">if</span>&nbsp;<span class="ident" id="5254749">flags</span><span class="op" id="5254754">&amp;</span><span class="ident" id="5254755">FoldCase</span>&nbsp;<span class="op" id="5254764">!=</span>&nbsp;<span class="num" id="5254767">0</span>&nbsp;<span class="op" id="5254769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5254773">return</span>&nbsp;<span class="ident" id="5254780">appendFoldedRange</span><span class="op" id="5254797">(</span><span class="ident" id="5254798">r</span><span class="op" id="5254799">,</span>&nbsp;<span class="ident" id="5254801">x</span><span class="op" id="5254802">,</span>&nbsp;<span class="ident" id="5254804">x</span><span class="op" id="5254805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5254808">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5254811">return</span>&nbsp;<span class="ident" id="5254818">appendRange</span><span class="op" id="5254829">(</span><span class="ident" id="5254830">r</span><span class="op" id="5254831">,</span>&nbsp;<span class="ident" id="5254833">x</span><span class="op" id="5254834">,</span>&nbsp;<span class="ident" id="5254836">x</span><span class="op" id="5254837">)</span><br>
<span class="lineno">1650</span><span class="op" id="5254839">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5254842">//&nbsp;appendRange&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;the&nbsp;range&nbsp;lo-hi&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="5254921">func</span>&nbsp;<span class="ident" id="5254926">appendRange</span><span class="op" id="5254937">(</span><span class="ident" id="5254938">r</span>&nbsp;<span class="op" id="5254940">[</span><span class="op" id="5254941">]</span><span class="builtintype" id="5254942">rune</span><span class="op" id="5254946">,</span>&nbsp;<span class="ident" id="5254948">lo</span><span class="op" id="5254950">,</span>&nbsp;<span class="ident" id="5254952">hi</span>&nbsp;<span class="builtintype" id="5254955">rune</span><span class="op" id="5254959">)</span>&nbsp;<span class="op" id="5254961">[</span><span class="op" id="5254962">]</span><span class="builtintype" id="5254963">rune</span>&nbsp;<span class="op" id="5254968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5254971">//&nbsp;Expand&nbsp;last&nbsp;range&nbsp;or&nbsp;next&nbsp;to&nbsp;last&nbsp;range&nbsp;if&nbsp;it&nbsp;overlaps&nbsp;or&nbsp;abuts.</span><br>
<span class="lineno">1655</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5255040">//&nbsp;Checking&nbsp;two&nbsp;ranges&nbsp;helps&nbsp;when&nbsp;appending&nbsp;case-folded</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5255097">//&nbsp;alphabets,&nbsp;so&nbsp;that&nbsp;one&nbsp;range&nbsp;can&nbsp;be&nbsp;expanding&nbsp;A-Z&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5255159">//&nbsp;other&nbsp;expanding&nbsp;a-z.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5255184">n</span>&nbsp;<span class="op" id="5255186">:=</span>&nbsp;<span class="builtinfunc" id="5255189">len</span><span class="op" id="5255192">(</span><span class="ident" id="5255193">r</span><span class="op" id="5255194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5255197">for</span>&nbsp;<span class="ident" id="5255201">i</span>&nbsp;<span class="op" id="5255203">:=</span>&nbsp;<span class="num" id="5255206">2</span><span class="op" id="5255207">;</span>&nbsp;<span class="ident" id="5255209">i</span>&nbsp;<span class="op" id="5255211">&lt;=</span>&nbsp;<span class="num" id="5255214">4</span><span class="op" id="5255215">;</span>&nbsp;<span class="ident" id="5255217">i</span>&nbsp;<span class="op" id="5255219">+=</span>&nbsp;<span class="num" id="5255222">2</span>&nbsp;<span class="op" id="5255224">{</span>&nbsp;<span class="comment" id="5255226">//&nbsp;twice,&nbsp;using&nbsp;i=2,&nbsp;i=4</span><br>
<span class="lineno">1660</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5255253">if</span>&nbsp;<span class="ident" id="5255256">n</span>&nbsp;<span class="op" id="5255258">&gt;=</span>&nbsp;<span class="ident" id="5255261">i</span>&nbsp;<span class="op" id="5255263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5255268">rlo</span><span class="op" id="5255271">,</span>&nbsp;<span class="ident" id="5255273">rhi</span>&nbsp;<span class="op" id="5255277">:=</span>&nbsp;<span class="ident" id="5255280">r</span><span class="op" id="5255281">[</span><span class="ident" id="5255282">n</span><span class="op" id="5255283">-</span><span class="ident" id="5255284">i</span><span class="op" id="5255285">]</span><span class="op" id="5255286">,</span>&nbsp;<span class="ident" id="5255288">r</span><span class="op" id="5255289">[</span><span class="ident" id="5255290">n</span><span class="op" id="5255291">-</span><span class="ident" id="5255292">i</span><span class="op" id="5255293">+</span><span class="num" id="5255294">1</span><span class="op" id="5255295">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5255300">if</span>&nbsp;<span class="ident" id="5255303">lo</span>&nbsp;<span class="op" id="5255306">&lt;=</span>&nbsp;<span class="ident" id="5255309">rhi</span><span class="op" id="5255312">+</span><span class="num" id="5255313">1</span>&nbsp;<span class="op" id="5255315">&amp;&amp;</span>&nbsp;<span class="ident" id="5255318">rlo</span>&nbsp;<span class="op" id="5255322">&lt;=</span>&nbsp;<span class="ident" id="5255325">hi</span><span class="op" id="5255327">+</span><span class="num" id="5255328">1</span>&nbsp;<span class="op" id="5255330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5255336">if</span>&nbsp;<span class="ident" id="5255339">lo</span>&nbsp;<span class="op" id="5255342">&lt;</span>&nbsp;<span class="ident" id="5255344">rlo</span>&nbsp;<span class="op" id="5255348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5255355">r</span><span class="op" id="5255356">[</span><span class="ident" id="5255357">n</span><span class="op" id="5255358">-</span><span class="ident" id="5255359">i</span><span class="op" id="5255360">]</span>&nbsp;<span class="op" id="5255362">=</span>&nbsp;<span class="ident" id="5255364">lo</span><br>
<span class="lineno">1665</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5255371">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5255377">if</span>&nbsp;<span class="ident" id="5255380">hi</span>&nbsp;<span class="op" id="5255383">&gt;</span>&nbsp;<span class="ident" id="5255385">rhi</span>&nbsp;<span class="op" id="5255389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5255396">r</span><span class="op" id="5255397">[</span><span class="ident" id="5255398">n</span><span class="op" id="5255399">-</span><span class="ident" id="5255400">i</span><span class="op" id="5255401">+</span><span class="num" id="5255402">1</span><span class="op" id="5255403">]</span>&nbsp;<span class="op" id="5255405">=</span>&nbsp;<span class="ident" id="5255407">hi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5255414">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5255420">return</span>&nbsp;<span class="ident" id="5255427">r</span><br>
<span class="lineno">1670</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5255432">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5255436">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5255439">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5255443">return</span>&nbsp;<span class="builtinfunc" id="5255450">append</span><span class="op" id="5255456">(</span><span class="ident" id="5255457">r</span><span class="op" id="5255458">,</span>&nbsp;<span class="ident" id="5255460">lo</span><span class="op" id="5255462">,</span>&nbsp;<span class="ident" id="5255464">hi</span><span class="op" id="5255466">)</span><br>
<span class="lineno">1675</span><span class="op" id="5255468">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5255471">const</span>&nbsp;<span class="op" id="5255477">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5255480">//&nbsp;minimum&nbsp;and&nbsp;maximum&nbsp;runes&nbsp;involved&nbsp;in&nbsp;folding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5255531">//&nbsp;checked&nbsp;during&nbsp;test.</span><br>
<span class="lineno">1680</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5255556">minFold</span>&nbsp;<span class="op" id="5255564">=</span>&nbsp;<span class="num" id="5255566">0x0041</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5255574">maxFold</span>&nbsp;<span class="op" id="5255582">=</span>&nbsp;<span class="num" id="5255584">0x118df</span><br>
<span class="lineno"></span><span class="op" id="5255592">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5255595">//&nbsp;appendFoldedRange&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;the&nbsp;range&nbsp;lo-hi</span><br>
<span class="lineno">1685</span><span class="comment" id="5255664">//&nbsp;and&nbsp;its&nbsp;case&nbsp;folding-equivalent&nbsp;runes&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="5255721">func</span>&nbsp;<span class="ident" id="5255726">appendFoldedRange</span><span class="op" id="5255743">(</span><span class="ident" id="5255744">r</span>&nbsp;<span class="op" id="5255746">[</span><span class="op" id="5255747">]</span><span class="builtintype" id="5255748">rune</span><span class="op" id="5255752">,</span>&nbsp;<span class="ident" id="5255754">lo</span><span class="op" id="5255756">,</span>&nbsp;<span class="ident" id="5255758">hi</span>&nbsp;<span class="builtintype" id="5255761">rune</span><span class="op" id="5255765">)</span>&nbsp;<span class="op" id="5255767">[</span><span class="op" id="5255768">]</span><span class="builtintype" id="5255769">rune</span>&nbsp;<span class="op" id="5255774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5255777">//&nbsp;Optimizations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5255796">if</span>&nbsp;<span class="ident" id="5255799">lo</span>&nbsp;<span class="op" id="5255802">&lt;=</span>&nbsp;<span class="ident" id="5255805">minFold</span>&nbsp;<span class="op" id="5255813">&amp;&amp;</span>&nbsp;<span class="ident" id="5255816">hi</span>&nbsp;<span class="op" id="5255819">&gt;=</span>&nbsp;<span class="ident" id="5255822">maxFold</span>&nbsp;<span class="op" id="5255830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5255834">//&nbsp;Range&nbsp;is&nbsp;full:&nbsp;folding&nbsp;can&#39;t&nbsp;add&nbsp;more.</span><br>
<span class="lineno">1690</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5255878">return</span>&nbsp;<span class="ident" id="5255885">appendRange</span><span class="op" id="5255896">(</span><span class="ident" id="5255897">r</span><span class="op" id="5255898">,</span>&nbsp;<span class="ident" id="5255900">lo</span><span class="op" id="5255902">,</span>&nbsp;<span class="ident" id="5255904">hi</span><span class="op" id="5255906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5255909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5255912">if</span>&nbsp;<span class="ident" id="5255915">hi</span>&nbsp;<span class="op" id="5255918">&lt;</span>&nbsp;<span class="ident" id="5255920">minFold</span>&nbsp;<span class="op" id="5255928">||</span>&nbsp;<span class="ident" id="5255931">lo</span>&nbsp;<span class="op" id="5255934">&gt;</span>&nbsp;<span class="ident" id="5255936">maxFold</span>&nbsp;<span class="op" id="5255944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5255948">//&nbsp;Range&nbsp;is&nbsp;outside&nbsp;folding&nbsp;possibilities.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5255993">return</span>&nbsp;<span class="ident" id="5256000">appendRange</span><span class="op" id="5256011">(</span><span class="ident" id="5256012">r</span><span class="op" id="5256013">,</span>&nbsp;<span class="ident" id="5256015">lo</span><span class="op" id="5256017">,</span>&nbsp;<span class="ident" id="5256019">hi</span><span class="op" id="5256021">)</span><br>
<span class="lineno">1695</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5256024">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5256027">if</span>&nbsp;<span class="ident" id="5256030">lo</span>&nbsp;<span class="op" id="5256033">&lt;</span>&nbsp;<span class="ident" id="5256035">minFold</span>&nbsp;<span class="op" id="5256043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5256047">//&nbsp;[lo,&nbsp;minFold-1]&nbsp;needs&nbsp;no&nbsp;folding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5256086">r</span>&nbsp;<span class="op" id="5256088">=</span>&nbsp;<span class="ident" id="5256090">appendRange</span><span class="op" id="5256101">(</span><span class="ident" id="5256102">r</span><span class="op" id="5256103">,</span>&nbsp;<span class="ident" id="5256105">lo</span><span class="op" id="5256107">,</span>&nbsp;<span class="ident" id="5256109">minFold</span><span class="op" id="5256116">-</span><span class="num" id="5256117">1</span><span class="op" id="5256118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5256122">lo</span>&nbsp;<span class="op" id="5256125">=</span>&nbsp;<span class="ident" id="5256127">minFold</span><br>
<span class="lineno">1700</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5256136">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5256139">if</span>&nbsp;<span class="ident" id="5256142">hi</span>&nbsp;<span class="op" id="5256145">&gt;</span>&nbsp;<span class="ident" id="5256147">maxFold</span>&nbsp;<span class="op" id="5256155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5256159">//&nbsp;[maxFold+1,&nbsp;hi]&nbsp;needs&nbsp;no&nbsp;folding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5256198">r</span>&nbsp;<span class="op" id="5256200">=</span>&nbsp;<span class="ident" id="5256202">appendRange</span><span class="op" id="5256213">(</span><span class="ident" id="5256214">r</span><span class="op" id="5256215">,</span>&nbsp;<span class="ident" id="5256217">maxFold</span><span class="op" id="5256224">+</span><span class="num" id="5256225">1</span><span class="op" id="5256226">,</span>&nbsp;<span class="ident" id="5256228">hi</span><span class="op" id="5256230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5256234">hi</span>&nbsp;<span class="op" id="5256237">=</span>&nbsp;<span class="ident" id="5256239">maxFold</span><br>
<span class="lineno">1705</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5256248">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5256252">//&nbsp;Brute&nbsp;force.&nbsp;&nbsp;Depend&nbsp;on&nbsp;appendRange&nbsp;to&nbsp;coalesce&nbsp;ranges&nbsp;on&nbsp;the&nbsp;fly.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5256323">for</span>&nbsp;<span class="ident" id="5256327">c</span>&nbsp;<span class="op" id="5256329">:=</span>&nbsp;<span class="ident" id="5256332">lo</span><span class="op" id="5256334">;</span>&nbsp;<span class="ident" id="5256336">c</span>&nbsp;<span class="op" id="5256338">&lt;=</span>&nbsp;<span class="ident" id="5256341">hi</span><span class="op" id="5256343">;</span>&nbsp;<span class="ident" id="5256345">c</span><span class="op" id="5256346">++</span>&nbsp;<span class="op" id="5256349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5256353">r</span>&nbsp;<span class="op" id="5256355">=</span>&nbsp;<span class="ident" id="5256357">appendRange</span><span class="op" id="5256368">(</span><span class="ident" id="5256369">r</span><span class="op" id="5256370">,</span>&nbsp;<span class="ident" id="5256372">c</span><span class="op" id="5256373">,</span>&nbsp;<span class="ident" id="5256375">c</span><span class="op" id="5256376">)</span><br>
<span class="lineno">1710</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5256380">f</span>&nbsp;<span class="op" id="5256382">:=</span>&nbsp;<span class="ident" id="5256385">unicode</span><span class="op" id="5256392">.</span><span class="ident" id="5256393">SimpleFold</span><span class="op" id="5256403">(</span><span class="ident" id="5256404">c</span><span class="op" id="5256405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5256409">for</span>&nbsp;<span class="ident" id="5256413">f</span>&nbsp;<span class="op" id="5256415">!=</span>&nbsp;<span class="ident" id="5256418">c</span>&nbsp;<span class="op" id="5256420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5256425">r</span>&nbsp;<span class="op" id="5256427">=</span>&nbsp;<span class="ident" id="5256429">appendRange</span><span class="op" id="5256440">(</span><span class="ident" id="5256441">r</span><span class="op" id="5256442">,</span>&nbsp;<span class="ident" id="5256444">f</span><span class="op" id="5256445">,</span>&nbsp;<span class="ident" id="5256447">f</span><span class="op" id="5256448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5256453">f</span>&nbsp;<span class="op" id="5256455">=</span>&nbsp;<span class="ident" id="5256457">unicode</span><span class="op" id="5256464">.</span><span class="ident" id="5256465">SimpleFold</span><span class="op" id="5256475">(</span><span class="ident" id="5256476">f</span><span class="op" id="5256477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5256481">}</span><br>
<span class="lineno">1715</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5256484">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5256487">return</span>&nbsp;<span class="ident" id="5256494">r</span><br>
<span class="lineno"></span><span class="op" id="5256496">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5256499">//&nbsp;appendClass&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;the&nbsp;class&nbsp;x&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno">1720</span><span class="comment" id="5256574">//&nbsp;It&nbsp;assume&nbsp;x&nbsp;is&nbsp;clean.</span><br>
<span class="lineno"></span><span class="keyword" id="5256599">func</span>&nbsp;<span class="ident" id="5256604">appendClass</span><span class="op" id="5256615">(</span><span class="ident" id="5256616">r</span>&nbsp;<span class="op" id="5256618">[</span><span class="op" id="5256619">]</span><span class="builtintype" id="5256620">rune</span><span class="op" id="5256624">,</span>&nbsp;<span class="ident" id="5256626">x</span>&nbsp;<span class="op" id="5256628">[</span><span class="op" id="5256629">]</span><span class="builtintype" id="5256630">rune</span><span class="op" id="5256634">)</span>&nbsp;<span class="op" id="5256636">[</span><span class="op" id="5256637">]</span><span class="builtintype" id="5256638">rune</span>&nbsp;<span class="op" id="5256643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5256646">for</span>&nbsp;<span class="ident" id="5256650">i</span>&nbsp;<span class="op" id="5256652">:=</span>&nbsp;<span class="num" id="5256655">0</span><span class="op" id="5256656">;</span>&nbsp;<span class="ident" id="5256658">i</span>&nbsp;<span class="op" id="5256660">&lt;</span>&nbsp;<span class="builtinfunc" id="5256662">len</span><span class="op" id="5256665">(</span><span class="ident" id="5256666">x</span><span class="op" id="5256667">)</span><span class="op" id="5256668">;</span>&nbsp;<span class="ident" id="5256670">i</span>&nbsp;<span class="op" id="5256672">+=</span>&nbsp;<span class="num" id="5256675">2</span>&nbsp;<span class="op" id="5256677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5256681">r</span>&nbsp;<span class="op" id="5256683">=</span>&nbsp;<span class="ident" id="5256685">appendRange</span><span class="op" id="5256696">(</span><span class="ident" id="5256697">r</span><span class="op" id="5256698">,</span>&nbsp;<span class="ident" id="5256700">x</span><span class="op" id="5256701">[</span><span class="ident" id="5256702">i</span><span class="op" id="5256703">]</span><span class="op" id="5256704">,</span>&nbsp;<span class="ident" id="5256706">x</span><span class="op" id="5256707">[</span><span class="ident" id="5256708">i</span><span class="op" id="5256709">+</span><span class="num" id="5256710">1</span><span class="op" id="5256711">]</span><span class="op" id="5256712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5256715">}</span><br>
<span class="lineno">1725</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5256718">return</span>&nbsp;<span class="ident" id="5256725">r</span><br>
<span class="lineno"></span><span class="op" id="5256727">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5256730">//&nbsp;appendFolded&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;the&nbsp;case&nbsp;folding&nbsp;of&nbsp;the&nbsp;class&nbsp;x&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="5256826">func</span>&nbsp;<span class="ident" id="5256831">appendFoldedClass</span><span class="op" id="5256848">(</span><span class="ident" id="5256849">r</span>&nbsp;<span class="op" id="5256851">[</span><span class="op" id="5256852">]</span><span class="builtintype" id="5256853">rune</span><span class="op" id="5256857">,</span>&nbsp;<span class="ident" id="5256859">x</span>&nbsp;<span class="op" id="5256861">[</span><span class="op" id="5256862">]</span><span class="builtintype" id="5256863">rune</span><span class="op" id="5256867">)</span>&nbsp;<span class="op" id="5256869">[</span><span class="op" id="5256870">]</span><span class="builtintype" id="5256871">rune</span>&nbsp;<span class="op" id="5256876">{</span><br>
<span class="lineno">1730</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5256879">for</span>&nbsp;<span class="ident" id="5256883">i</span>&nbsp;<span class="op" id="5256885">:=</span>&nbsp;<span class="num" id="5256888">0</span><span class="op" id="5256889">;</span>&nbsp;<span class="ident" id="5256891">i</span>&nbsp;<span class="op" id="5256893">&lt;</span>&nbsp;<span class="builtinfunc" id="5256895">len</span><span class="op" id="5256898">(</span><span class="ident" id="5256899">x</span><span class="op" id="5256900">)</span><span class="op" id="5256901">;</span>&nbsp;<span class="ident" id="5256903">i</span>&nbsp;<span class="op" id="5256905">+=</span>&nbsp;<span class="num" id="5256908">2</span>&nbsp;<span class="op" id="5256910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5256914">r</span>&nbsp;<span class="op" id="5256916">=</span>&nbsp;<span class="ident" id="5256918">appendFoldedRange</span><span class="op" id="5256935">(</span><span class="ident" id="5256936">r</span><span class="op" id="5256937">,</span>&nbsp;<span class="ident" id="5256939">x</span><span class="op" id="5256940">[</span><span class="ident" id="5256941">i</span><span class="op" id="5256942">]</span><span class="op" id="5256943">,</span>&nbsp;<span class="ident" id="5256945">x</span><span class="op" id="5256946">[</span><span class="ident" id="5256947">i</span><span class="op" id="5256948">+</span><span class="num" id="5256949">1</span><span class="op" id="5256950">]</span><span class="op" id="5256951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5256954">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5256957">return</span>&nbsp;<span class="ident" id="5256964">r</span><br>
<span class="lineno"></span><span class="op" id="5256966">}</span><br>
<span class="lineno">1735</span><br>
<span class="lineno"></span><span class="comment" id="5256969">//&nbsp;appendNegatedClass&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;the&nbsp;negation&nbsp;of&nbsp;the&nbsp;class&nbsp;x&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="5257067">//&nbsp;It&nbsp;assumes&nbsp;x&nbsp;is&nbsp;clean.</span><br>
<span class="lineno"></span><span class="keyword" id="5257093">func</span>&nbsp;<span class="ident" id="5257098">appendNegatedClass</span><span class="op" id="5257116">(</span><span class="ident" id="5257117">r</span>&nbsp;<span class="op" id="5257119">[</span><span class="op" id="5257120">]</span><span class="builtintype" id="5257121">rune</span><span class="op" id="5257125">,</span>&nbsp;<span class="ident" id="5257127">x</span>&nbsp;<span class="op" id="5257129">[</span><span class="op" id="5257130">]</span><span class="builtintype" id="5257131">rune</span><span class="op" id="5257135">)</span>&nbsp;<span class="op" id="5257137">[</span><span class="op" id="5257138">]</span><span class="builtintype" id="5257139">rune</span>&nbsp;<span class="op" id="5257144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5257147">nextLo</span>&nbsp;<span class="op" id="5257154">:=</span>&nbsp;<span class="string" id="5257157">&#39;\u0000&#39;</span><br>
<span class="lineno">1740</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5257167">for</span>&nbsp;<span class="ident" id="5257171">i</span>&nbsp;<span class="op" id="5257173">:=</span>&nbsp;<span class="num" id="5257176">0</span><span class="op" id="5257177">;</span>&nbsp;<span class="ident" id="5257179">i</span>&nbsp;<span class="op" id="5257181">&lt;</span>&nbsp;<span class="builtinfunc" id="5257183">len</span><span class="op" id="5257186">(</span><span class="ident" id="5257187">x</span><span class="op" id="5257188">)</span><span class="op" id="5257189">;</span>&nbsp;<span class="ident" id="5257191">i</span>&nbsp;<span class="op" id="5257193">+=</span>&nbsp;<span class="num" id="5257196">2</span>&nbsp;<span class="op" id="5257198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5257202">lo</span><span class="op" id="5257204">,</span>&nbsp;<span class="ident" id="5257206">hi</span>&nbsp;<span class="op" id="5257209">:=</span>&nbsp;<span class="ident" id="5257212">x</span><span class="op" id="5257213">[</span><span class="ident" id="5257214">i</span><span class="op" id="5257215">]</span><span class="op" id="5257216">,</span>&nbsp;<span class="ident" id="5257218">x</span><span class="op" id="5257219">[</span><span class="ident" id="5257220">i</span><span class="op" id="5257221">+</span><span class="num" id="5257222">1</span><span class="op" id="5257223">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5257227">if</span>&nbsp;<span class="ident" id="5257230">nextLo</span>&nbsp;<span class="op" id="5257237">&lt;=</span>&nbsp;<span class="ident" id="5257240">lo</span><span class="op" id="5257242">-</span><span class="num" id="5257243">1</span>&nbsp;<span class="op" id="5257245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5257250">r</span>&nbsp;<span class="op" id="5257252">=</span>&nbsp;<span class="ident" id="5257254">appendRange</span><span class="op" id="5257265">(</span><span class="ident" id="5257266">r</span><span class="op" id="5257267">,</span>&nbsp;<span class="ident" id="5257269">nextLo</span><span class="op" id="5257275">,</span>&nbsp;<span class="ident" id="5257277">lo</span><span class="op" id="5257279">-</span><span class="num" id="5257280">1</span><span class="op" id="5257281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5257285">}</span><br>
<span class="lineno">1745</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5257289">nextLo</span>&nbsp;<span class="op" id="5257296">=</span>&nbsp;<span class="ident" id="5257298">hi</span>&nbsp;<span class="op" id="5257301">+</span>&nbsp;<span class="num" id="5257303">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5257306">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5257309">if</span>&nbsp;<span class="ident" id="5257312">nextLo</span>&nbsp;<span class="op" id="5257319">&lt;=</span>&nbsp;<span class="ident" id="5257322">unicode</span><span class="op" id="5257329">.</span><span class="ident" id="5257330">MaxRune</span>&nbsp;<span class="op" id="5257338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5257342">r</span>&nbsp;<span class="op" id="5257344">=</span>&nbsp;<span class="ident" id="5257346">appendRange</span><span class="op" id="5257357">(</span><span class="ident" id="5257358">r</span><span class="op" id="5257359">,</span>&nbsp;<span class="ident" id="5257361">nextLo</span><span class="op" id="5257367">,</span>&nbsp;<span class="ident" id="5257369">unicode</span><span class="op" id="5257376">.</span><span class="ident" id="5257377">MaxRune</span><span class="op" id="5257384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5257387">}</span><br>
<span class="lineno">1750</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5257390">return</span>&nbsp;<span class="ident" id="5257397">r</span><br>
<span class="lineno"></span><span class="op" id="5257399">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5257402">//&nbsp;appendTable&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;x&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="5257467">func</span>&nbsp;<span class="ident" id="5257472">appendTable</span><span class="op" id="5257483">(</span><span class="ident" id="5257484">r</span>&nbsp;<span class="op" id="5257486">[</span><span class="op" id="5257487">]</span><span class="builtintype" id="5257488">rune</span><span class="op" id="5257492">,</span>&nbsp;<span class="ident" id="5257494">x</span>&nbsp;<span class="op" id="5257496">*</span><span class="ident" id="5257497">unicode</span><span class="op" id="5257504">.</span><span class="ident" id="5257505">RangeTable</span><span class="op" id="5257515">)</span>&nbsp;<span class="op" id="5257517">[</span><span class="op" id="5257518">]</span><span class="builtintype" id="5257519">rune</span>&nbsp;<span class="op" id="5257524">{</span><br>
<span class="lineno">1755</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5257527">for</span>&nbsp;<span class="ident" id="5257531">_</span><span class="op" id="5257532">,</span>&nbsp;<span class="ident" id="5257534">xr</span>&nbsp;<span class="op" id="5257537">:=</span>&nbsp;<span class="keyword" id="5257540">range</span>&nbsp;<span class="ident" id="5257546">x</span><span class="op" id="5257547">.</span><span class="ident" id="5257548">R16</span>&nbsp;<span class="op" id="5257552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5257556">lo</span><span class="op" id="5257558">,</span>&nbsp;<span class="ident" id="5257560">hi</span><span class="op" id="5257562">,</span>&nbsp;<span class="ident" id="5257564">stride</span>&nbsp;<span class="op" id="5257571">:=</span>&nbsp;<span class="builtintype" id="5257574">rune</span><span class="op" id="5257578">(</span><span class="ident" id="5257579">xr</span><span class="op" id="5257581">.</span><span class="ident" id="5257582">Lo</span><span class="op" id="5257584">)</span><span class="op" id="5257585">,</span>&nbsp;<span class="builtintype" id="5257587">rune</span><span class="op" id="5257591">(</span><span class="ident" id="5257592">xr</span><span class="op" id="5257594">.</span><span class="ident" id="5257595">Hi</span><span class="op" id="5257597">)</span><span class="op" id="5257598">,</span>&nbsp;<span class="builtintype" id="5257600">rune</span><span class="op" id="5257604">(</span><span class="ident" id="5257605">xr</span><span class="op" id="5257607">.</span><span class="ident" id="5257608">Stride</span><span class="op" id="5257614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5257618">if</span>&nbsp;<span class="ident" id="5257621">stride</span>&nbsp;<span class="op" id="5257628">==</span>&nbsp;<span class="num" id="5257631">1</span>&nbsp;<span class="op" id="5257633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5257638">r</span>&nbsp;<span class="op" id="5257640">=</span>&nbsp;<span class="ident" id="5257642">appendRange</span><span class="op" id="5257653">(</span><span class="ident" id="5257654">r</span><span class="op" id="5257655">,</span>&nbsp;<span class="ident" id="5257657">lo</span><span class="op" id="5257659">,</span>&nbsp;<span class="ident" id="5257661">hi</span><span class="op" id="5257663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5257668">continue</span><br>
<span class="lineno">1760</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5257679">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5257683">for</span>&nbsp;<span class="ident" id="5257687">c</span>&nbsp;<span class="op" id="5257689">:=</span>&nbsp;<span class="ident" id="5257692">lo</span><span class="op" id="5257694">;</span>&nbsp;<span class="ident" id="5257696">c</span>&nbsp;<span class="op" id="5257698">&lt;=</span>&nbsp;<span class="ident" id="5257701">hi</span><span class="op" id="5257703">;</span>&nbsp;<span class="ident" id="5257705">c</span>&nbsp;<span class="op" id="5257707">+=</span>&nbsp;<span class="ident" id="5257710">stride</span>&nbsp;<span class="op" id="5257717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5257722">r</span>&nbsp;<span class="op" id="5257724">=</span>&nbsp;<span class="ident" id="5257726">appendRange</span><span class="op" id="5257737">(</span><span class="ident" id="5257738">r</span><span class="op" id="5257739">,</span>&nbsp;<span class="ident" id="5257741">c</span><span class="op" id="5257742">,</span>&nbsp;<span class="ident" id="5257744">c</span><span class="op" id="5257745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5257749">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5257752">}</span><br>
<span class="lineno">1765</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5257755">for</span>&nbsp;<span class="ident" id="5257759">_</span><span class="op" id="5257760">,</span>&nbsp;<span class="ident" id="5257762">xr</span>&nbsp;<span class="op" id="5257765">:=</span>&nbsp;<span class="keyword" id="5257768">range</span>&nbsp;<span class="ident" id="5257774">x</span><span class="op" id="5257775">.</span><span class="ident" id="5257776">R32</span>&nbsp;<span class="op" id="5257780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5257784">lo</span><span class="op" id="5257786">,</span>&nbsp;<span class="ident" id="5257788">hi</span><span class="op" id="5257790">,</span>&nbsp;<span class="ident" id="5257792">stride</span>&nbsp;<span class="op" id="5257799">:=</span>&nbsp;<span class="builtintype" id="5257802">rune</span><span class="op" id="5257806">(</span><span class="ident" id="5257807">xr</span><span class="op" id="5257809">.</span><span class="ident" id="5257810">Lo</span><span class="op" id="5257812">)</span><span class="op" id="5257813">,</span>&nbsp;<span class="builtintype" id="5257815">rune</span><span class="op" id="5257819">(</span><span class="ident" id="5257820">xr</span><span class="op" id="5257822">.</span><span class="ident" id="5257823">Hi</span><span class="op" id="5257825">)</span><span class="op" id="5257826">,</span>&nbsp;<span class="builtintype" id="5257828">rune</span><span class="op" id="5257832">(</span><span class="ident" id="5257833">xr</span><span class="op" id="5257835">.</span><span class="ident" id="5257836">Stride</span><span class="op" id="5257842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5257846">if</span>&nbsp;<span class="ident" id="5257849">stride</span>&nbsp;<span class="op" id="5257856">==</span>&nbsp;<span class="num" id="5257859">1</span>&nbsp;<span class="op" id="5257861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5257866">r</span>&nbsp;<span class="op" id="5257868">=</span>&nbsp;<span class="ident" id="5257870">appendRange</span><span class="op" id="5257881">(</span><span class="ident" id="5257882">r</span><span class="op" id="5257883">,</span>&nbsp;<span class="ident" id="5257885">lo</span><span class="op" id="5257887">,</span>&nbsp;<span class="ident" id="5257889">hi</span><span class="op" id="5257891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5257896">continue</span><br>
<span class="lineno">1770</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5257907">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5257911">for</span>&nbsp;<span class="ident" id="5257915">c</span>&nbsp;<span class="op" id="5257917">:=</span>&nbsp;<span class="ident" id="5257920">lo</span><span class="op" id="5257922">;</span>&nbsp;<span class="ident" id="5257924">c</span>&nbsp;<span class="op" id="5257926">&lt;=</span>&nbsp;<span class="ident" id="5257929">hi</span><span class="op" id="5257931">;</span>&nbsp;<span class="ident" id="5257933">c</span>&nbsp;<span class="op" id="5257935">+=</span>&nbsp;<span class="ident" id="5257938">stride</span>&nbsp;<span class="op" id="5257945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5257950">r</span>&nbsp;<span class="op" id="5257952">=</span>&nbsp;<span class="ident" id="5257954">appendRange</span><span class="op" id="5257965">(</span><span class="ident" id="5257966">r</span><span class="op" id="5257967">,</span>&nbsp;<span class="ident" id="5257969">c</span><span class="op" id="5257970">,</span>&nbsp;<span class="ident" id="5257972">c</span><span class="op" id="5257973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5257977">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5257980">}</span><br>
<span class="lineno">1775</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5257983">return</span>&nbsp;<span class="ident" id="5257990">r</span><br>
<span class="lineno"></span><span class="op" id="5257992">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5257995">//&nbsp;appendNegatedTable&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;the&nbsp;negation&nbsp;of&nbsp;x&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="5258083">func</span>&nbsp;<span class="ident" id="5258088">appendNegatedTable</span><span class="op" id="5258106">(</span><span class="ident" id="5258107">r</span>&nbsp;<span class="op" id="5258109">[</span><span class="op" id="5258110">]</span><span class="builtintype" id="5258111">rune</span><span class="op" id="5258115">,</span>&nbsp;<span class="ident" id="5258117">x</span>&nbsp;<span class="op" id="5258119">*</span><span class="ident" id="5258120">unicode</span><span class="op" id="5258127">.</span><span class="ident" id="5258128">RangeTable</span><span class="op" id="5258138">)</span>&nbsp;<span class="op" id="5258140">[</span><span class="op" id="5258141">]</span><span class="builtintype" id="5258142">rune</span>&nbsp;<span class="op" id="5258147">{</span><br>
<span class="lineno">1780</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5258150">nextLo</span>&nbsp;<span class="op" id="5258157">:=</span>&nbsp;<span class="string" id="5258160">&#39;\u0000&#39;</span>&nbsp;<span class="comment" id="5258169">//&nbsp;lo&nbsp;end&nbsp;of&nbsp;next&nbsp;class&nbsp;to&nbsp;add</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5258201">for</span>&nbsp;<span class="ident" id="5258205">_</span><span class="op" id="5258206">,</span>&nbsp;<span class="ident" id="5258208">xr</span>&nbsp;<span class="op" id="5258211">:=</span>&nbsp;<span class="keyword" id="5258214">range</span>&nbsp;<span class="ident" id="5258220">x</span><span class="op" id="5258221">.</span><span class="ident" id="5258222">R16</span>&nbsp;<span class="op" id="5258226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5258230">lo</span><span class="op" id="5258232">,</span>&nbsp;<span class="ident" id="5258234">hi</span><span class="op" id="5258236">,</span>&nbsp;<span class="ident" id="5258238">stride</span>&nbsp;<span class="op" id="5258245">:=</span>&nbsp;<span class="builtintype" id="5258248">rune</span><span class="op" id="5258252">(</span><span class="ident" id="5258253">xr</span><span class="op" id="5258255">.</span><span class="ident" id="5258256">Lo</span><span class="op" id="5258258">)</span><span class="op" id="5258259">,</span>&nbsp;<span class="builtintype" id="5258261">rune</span><span class="op" id="5258265">(</span><span class="ident" id="5258266">xr</span><span class="op" id="5258268">.</span><span class="ident" id="5258269">Hi</span><span class="op" id="5258271">)</span><span class="op" id="5258272">,</span>&nbsp;<span class="builtintype" id="5258274">rune</span><span class="op" id="5258278">(</span><span class="ident" id="5258279">xr</span><span class="op" id="5258281">.</span><span class="ident" id="5258282">Stride</span><span class="op" id="5258288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5258292">if</span>&nbsp;<span class="ident" id="5258295">stride</span>&nbsp;<span class="op" id="5258302">==</span>&nbsp;<span class="num" id="5258305">1</span>&nbsp;<span class="op" id="5258307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5258312">if</span>&nbsp;<span class="ident" id="5258315">nextLo</span>&nbsp;<span class="op" id="5258322">&lt;=</span>&nbsp;<span class="ident" id="5258325">lo</span><span class="op" id="5258327">-</span><span class="num" id="5258328">1</span>&nbsp;<span class="op" id="5258330">{</span><br>
<span class="lineno">1785</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5258336">r</span>&nbsp;<span class="op" id="5258338">=</span>&nbsp;<span class="ident" id="5258340">appendRange</span><span class="op" id="5258351">(</span><span class="ident" id="5258352">r</span><span class="op" id="5258353">,</span>&nbsp;<span class="ident" id="5258355">nextLo</span><span class="op" id="5258361">,</span>&nbsp;<span class="ident" id="5258363">lo</span><span class="op" id="5258365">-</span><span class="num" id="5258366">1</span><span class="op" id="5258367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5258372">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5258377">nextLo</span>&nbsp;<span class="op" id="5258384">=</span>&nbsp;<span class="ident" id="5258386">hi</span>&nbsp;<span class="op" id="5258389">+</span>&nbsp;<span class="num" id="5258391">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5258396">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5258407">}</span><br>
<span class="lineno">1790</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5258411">for</span>&nbsp;<span class="ident" id="5258415">c</span>&nbsp;<span class="op" id="5258417">:=</span>&nbsp;<span class="ident" id="5258420">lo</span><span class="op" id="5258422">;</span>&nbsp;<span class="ident" id="5258424">c</span>&nbsp;<span class="op" id="5258426">&lt;=</span>&nbsp;<span class="ident" id="5258429">hi</span><span class="op" id="5258431">;</span>&nbsp;<span class="ident" id="5258433">c</span>&nbsp;<span class="op" id="5258435">+=</span>&nbsp;<span class="ident" id="5258438">stride</span>&nbsp;<span class="op" id="5258445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5258450">if</span>&nbsp;<span class="ident" id="5258453">nextLo</span>&nbsp;<span class="op" id="5258460">&lt;=</span>&nbsp;<span class="ident" id="5258463">c</span><span class="op" id="5258464">-</span><span class="num" id="5258465">1</span>&nbsp;<span class="op" id="5258467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5258473">r</span>&nbsp;<span class="op" id="5258475">=</span>&nbsp;<span class="ident" id="5258477">appendRange</span><span class="op" id="5258488">(</span><span class="ident" id="5258489">r</span><span class="op" id="5258490">,</span>&nbsp;<span class="ident" id="5258492">nextLo</span><span class="op" id="5258498">,</span>&nbsp;<span class="ident" id="5258500">c</span><span class="op" id="5258501">-</span><span class="num" id="5258502">1</span><span class="op" id="5258503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5258508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5258513">nextLo</span>&nbsp;<span class="op" id="5258520">=</span>&nbsp;<span class="ident" id="5258522">c</span>&nbsp;<span class="op" id="5258524">+</span>&nbsp;<span class="num" id="5258526">1</span><br>
<span class="lineno">1795</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5258530">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5258533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5258536">for</span>&nbsp;<span class="ident" id="5258540">_</span><span class="op" id="5258541">,</span>&nbsp;<span class="ident" id="5258543">xr</span>&nbsp;<span class="op" id="5258546">:=</span>&nbsp;<span class="keyword" id="5258549">range</span>&nbsp;<span class="ident" id="5258555">x</span><span class="op" id="5258556">.</span><span class="ident" id="5258557">R32</span>&nbsp;<span class="op" id="5258561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5258565">lo</span><span class="op" id="5258567">,</span>&nbsp;<span class="ident" id="5258569">hi</span><span class="op" id="5258571">,</span>&nbsp;<span class="ident" id="5258573">stride</span>&nbsp;<span class="op" id="5258580">:=</span>&nbsp;<span class="builtintype" id="5258583">rune</span><span class="op" id="5258587">(</span><span class="ident" id="5258588">xr</span><span class="op" id="5258590">.</span><span class="ident" id="5258591">Lo</span><span class="op" id="5258593">)</span><span class="op" id="5258594">,</span>&nbsp;<span class="builtintype" id="5258596">rune</span><span class="op" id="5258600">(</span><span class="ident" id="5258601">xr</span><span class="op" id="5258603">.</span><span class="ident" id="5258604">Hi</span><span class="op" id="5258606">)</span><span class="op" id="5258607">,</span>&nbsp;<span class="builtintype" id="5258609">rune</span><span class="op" id="5258613">(</span><span class="ident" id="5258614">xr</span><span class="op" id="5258616">.</span><span class="ident" id="5258617">Stride</span><span class="op" id="5258623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5258627">if</span>&nbsp;<span class="ident" id="5258630">stride</span>&nbsp;<span class="op" id="5258637">==</span>&nbsp;<span class="num" id="5258640">1</span>&nbsp;<span class="op" id="5258642">{</span><br>
<span class="lineno">1800</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5258647">if</span>&nbsp;<span class="ident" id="5258650">nextLo</span>&nbsp;<span class="op" id="5258657">&lt;=</span>&nbsp;<span class="ident" id="5258660">lo</span><span class="op" id="5258662">-</span><span class="num" id="5258663">1</span>&nbsp;<span class="op" id="5258665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5258671">r</span>&nbsp;<span class="op" id="5258673">=</span>&nbsp;<span class="ident" id="5258675">appendRange</span><span class="op" id="5258686">(</span><span class="ident" id="5258687">r</span><span class="op" id="5258688">,</span>&nbsp;<span class="ident" id="5258690">nextLo</span><span class="op" id="5258696">,</span>&nbsp;<span class="ident" id="5258698">lo</span><span class="op" id="5258700">-</span><span class="num" id="5258701">1</span><span class="op" id="5258702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5258707">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5258712">nextLo</span>&nbsp;<span class="op" id="5258719">=</span>&nbsp;<span class="ident" id="5258721">hi</span>&nbsp;<span class="op" id="5258724">+</span>&nbsp;<span class="num" id="5258726">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5258731">continue</span><br>
<span class="lineno">1805</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5258742">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5258746">for</span>&nbsp;<span class="ident" id="5258750">c</span>&nbsp;<span class="op" id="5258752">:=</span>&nbsp;<span class="ident" id="5258755">lo</span><span class="op" id="5258757">;</span>&nbsp;<span class="ident" id="5258759">c</span>&nbsp;<span class="op" id="5258761">&lt;=</span>&nbsp;<span class="ident" id="5258764">hi</span><span class="op" id="5258766">;</span>&nbsp;<span class="ident" id="5258768">c</span>&nbsp;<span class="op" id="5258770">+=</span>&nbsp;<span class="ident" id="5258773">stride</span>&nbsp;<span class="op" id="5258780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5258785">if</span>&nbsp;<span class="ident" id="5258788">nextLo</span>&nbsp;<span class="op" id="5258795">&lt;=</span>&nbsp;<span class="ident" id="5258798">c</span><span class="op" id="5258799">-</span><span class="num" id="5258800">1</span>&nbsp;<span class="op" id="5258802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5258808">r</span>&nbsp;<span class="op" id="5258810">=</span>&nbsp;<span class="ident" id="5258812">appendRange</span><span class="op" id="5258823">(</span><span class="ident" id="5258824">r</span><span class="op" id="5258825">,</span>&nbsp;<span class="ident" id="5258827">nextLo</span><span class="op" id="5258833">,</span>&nbsp;<span class="ident" id="5258835">c</span><span class="op" id="5258836">-</span><span class="num" id="5258837">1</span><span class="op" id="5258838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5258843">}</span><br>
<span class="lineno">1810</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5258848">nextLo</span>&nbsp;<span class="op" id="5258855">=</span>&nbsp;<span class="ident" id="5258857">c</span>&nbsp;<span class="op" id="5258859">+</span>&nbsp;<span class="num" id="5258861">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5258865">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5258868">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5258871">if</span>&nbsp;<span class="ident" id="5258874">nextLo</span>&nbsp;<span class="op" id="5258881">&lt;=</span>&nbsp;<span class="ident" id="5258884">unicode</span><span class="op" id="5258891">.</span><span class="ident" id="5258892">MaxRune</span>&nbsp;<span class="op" id="5258900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5258904">r</span>&nbsp;<span class="op" id="5258906">=</span>&nbsp;<span class="ident" id="5258908">appendRange</span><span class="op" id="5258919">(</span><span class="ident" id="5258920">r</span><span class="op" id="5258921">,</span>&nbsp;<span class="ident" id="5258923">nextLo</span><span class="op" id="5258929">,</span>&nbsp;<span class="ident" id="5258931">unicode</span><span class="op" id="5258938">.</span><span class="ident" id="5258939">MaxRune</span><span class="op" id="5258946">)</span><br>
<span class="lineno">1815</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5258949">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5258952">return</span>&nbsp;<span class="ident" id="5258959">r</span><br>
<span class="lineno"></span><span class="op" id="5258961">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5258964">//&nbsp;negateClass&nbsp;overwrites&nbsp;r&nbsp;and&nbsp;returns&nbsp;r&#39;s&nbsp;negation.</span><br>
<span class="lineno">1820</span><span class="comment" id="5259018">//&nbsp;It&nbsp;assumes&nbsp;the&nbsp;class&nbsp;r&nbsp;is&nbsp;already&nbsp;clean.</span><br>
<span class="lineno"></span><span class="keyword" id="5259062">func</span>&nbsp;<span class="ident" id="5259067">negateClass</span><span class="op" id="5259078">(</span><span class="ident" id="5259079">r</span>&nbsp;<span class="op" id="5259081">[</span><span class="op" id="5259082">]</span><span class="builtintype" id="5259083">rune</span><span class="op" id="5259087">)</span>&nbsp;<span class="op" id="5259089">[</span><span class="op" id="5259090">]</span><span class="builtintype" id="5259091">rune</span>&nbsp;<span class="op" id="5259096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5259099">nextLo</span>&nbsp;<span class="op" id="5259106">:=</span>&nbsp;<span class="string" id="5259109">&#39;\u0000&#39;</span>&nbsp;<span class="comment" id="5259118">//&nbsp;lo&nbsp;end&nbsp;of&nbsp;next&nbsp;class&nbsp;to&nbsp;add</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5259150">w</span>&nbsp;<span class="op" id="5259152">:=</span>&nbsp;<span class="num" id="5259155">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5259169">//&nbsp;write&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5259185">for</span>&nbsp;<span class="ident" id="5259189">i</span>&nbsp;<span class="op" id="5259191">:=</span>&nbsp;<span class="num" id="5259194">0</span><span class="op" id="5259195">;</span>&nbsp;<span class="ident" id="5259197">i</span>&nbsp;<span class="op" id="5259199">&lt;</span>&nbsp;<span class="builtinfunc" id="5259201">len</span><span class="op" id="5259204">(</span><span class="ident" id="5259205">r</span><span class="op" id="5259206">)</span><span class="op" id="5259207">;</span>&nbsp;<span class="ident" id="5259209">i</span>&nbsp;<span class="op" id="5259211">+=</span>&nbsp;<span class="num" id="5259214">2</span>&nbsp;<span class="op" id="5259216">{</span><br>
<span class="lineno">1825</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5259220">lo</span><span class="op" id="5259222">,</span>&nbsp;<span class="ident" id="5259224">hi</span>&nbsp;<span class="op" id="5259227">:=</span>&nbsp;<span class="ident" id="5259230">r</span><span class="op" id="5259231">[</span><span class="ident" id="5259232">i</span><span class="op" id="5259233">]</span><span class="op" id="5259234">,</span>&nbsp;<span class="ident" id="5259236">r</span><span class="op" id="5259237">[</span><span class="ident" id="5259238">i</span><span class="op" id="5259239">+</span><span class="num" id="5259240">1</span><span class="op" id="5259241">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5259245">if</span>&nbsp;<span class="ident" id="5259248">nextLo</span>&nbsp;<span class="op" id="5259255">&lt;=</span>&nbsp;<span class="ident" id="5259258">lo</span><span class="op" id="5259260">-</span><span class="num" id="5259261">1</span>&nbsp;<span class="op" id="5259263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5259268">r</span><span class="op" id="5259269">[</span><span class="ident" id="5259270">w</span><span class="op" id="5259271">]</span>&nbsp;<span class="op" id="5259273">=</span>&nbsp;<span class="ident" id="5259275">nextLo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5259285">r</span><span class="op" id="5259286">[</span><span class="ident" id="5259287">w</span><span class="op" id="5259288">+</span><span class="num" id="5259289">1</span><span class="op" id="5259290">]</span>&nbsp;<span class="op" id="5259292">=</span>&nbsp;<span class="ident" id="5259294">lo</span>&nbsp;<span class="op" id="5259297">-</span>&nbsp;<span class="num" id="5259299">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5259304">w</span>&nbsp;<span class="op" id="5259306">+=</span>&nbsp;<span class="num" id="5259309">2</span><br>
<span class="lineno">1830</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5259313">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5259317">nextLo</span>&nbsp;<span class="op" id="5259324">=</span>&nbsp;<span class="ident" id="5259326">hi</span>&nbsp;<span class="op" id="5259329">+</span>&nbsp;<span class="num" id="5259331">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5259334">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5259337">r</span>&nbsp;<span class="op" id="5259339">=</span>&nbsp;<span class="ident" id="5259341">r</span><span class="op" id="5259342">[</span><span class="op" id="5259343">:</span><span class="ident" id="5259344">w</span><span class="op" id="5259345">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5259348">if</span>&nbsp;<span class="ident" id="5259351">nextLo</span>&nbsp;<span class="op" id="5259358">&lt;=</span>&nbsp;<span class="ident" id="5259361">unicode</span><span class="op" id="5259368">.</span><span class="ident" id="5259369">MaxRune</span>&nbsp;<span class="op" id="5259377">{</span><br>
<span class="lineno">1835</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5259381">//&nbsp;It&#39;s&nbsp;possible&nbsp;for&nbsp;the&nbsp;negation&nbsp;to&nbsp;have&nbsp;one&nbsp;more</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5259434">//&nbsp;range&nbsp;-&nbsp;this&nbsp;one&nbsp;-&nbsp;than&nbsp;the&nbsp;original&nbsp;class,&nbsp;so&nbsp;use&nbsp;append.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5259498">r</span>&nbsp;<span class="op" id="5259500">=</span>&nbsp;<span class="builtinfunc" id="5259502">append</span><span class="op" id="5259508">(</span><span class="ident" id="5259509">r</span><span class="op" id="5259510">,</span>&nbsp;<span class="ident" id="5259512">nextLo</span><span class="op" id="5259518">,</span>&nbsp;<span class="ident" id="5259520">unicode</span><span class="op" id="5259527">.</span><span class="ident" id="5259528">MaxRune</span><span class="op" id="5259535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5259538">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5259541">return</span>&nbsp;<span class="ident" id="5259548">r</span><br>
<span class="lineno">1840</span><span class="op" id="5259550">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5259553">//&nbsp;ranges&nbsp;implements&nbsp;sort.Interface&nbsp;on&nbsp;a&nbsp;[]rune.</span><br>
<span class="lineno"></span><span class="comment" id="5259602">//&nbsp;The&nbsp;choice&nbsp;of&nbsp;receiver&nbsp;type&nbsp;definition&nbsp;is&nbsp;strange</span><br>
<span class="lineno"></span><span class="comment" id="5259655">//&nbsp;but&nbsp;avoids&nbsp;an&nbsp;allocation&nbsp;since&nbsp;we&nbsp;already&nbsp;have</span><br>
<span class="lineno">1845</span><span class="comment" id="5259705">//&nbsp;a&nbsp;*[]rune.</span><br>
<span class="lineno"></span><span class="keyword" id="5259719">type</span>&nbsp;<span class="ident" id="5259724">ranges</span>&nbsp;<span class="keyword" id="5259731">struct</span>&nbsp;<span class="op" id="5259738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5259741">p</span>&nbsp;<span class="op" id="5259743">*</span><span class="op" id="5259744">[</span><span class="op" id="5259745">]</span><span class="builtintype" id="5259746">rune</span><br>
<span class="lineno"></span><span class="op" id="5259751">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1850</span><span class="keyword" id="5259754">func</span>&nbsp;<span class="op" id="5259759">(</span><span class="ident" id="5259760">ra</span>&nbsp;<span class="ident" id="5259763">ranges</span><span class="op" id="5259769">)</span>&nbsp;<span class="ident" id="5259771">Less</span><span class="op" id="5259775">(</span><span class="ident" id="5259776">i</span><span class="op" id="5259777">,</span>&nbsp;<span class="ident" id="5259779">j</span>&nbsp;<span class="builtintype" id="5259781">int</span><span class="op" id="5259784">)</span>&nbsp;<span class="builtintype" id="5259786">bool</span>&nbsp;<span class="op" id="5259791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5259794">p</span>&nbsp;<span class="op" id="5259796">:=</span>&nbsp;<span class="op" id="5259799">*</span><span class="ident" id="5259800">ra</span><span class="op" id="5259802">.</span><span class="ident" id="5259803">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5259806">i</span>&nbsp;<span class="op" id="5259808">*=</span>&nbsp;<span class="num" id="5259811">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5259814">j</span>&nbsp;<span class="op" id="5259816">*=</span>&nbsp;<span class="num" id="5259819">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5259822">return</span>&nbsp;<span class="ident" id="5259829">p</span><span class="op" id="5259830">[</span><span class="ident" id="5259831">i</span><span class="op" id="5259832">]</span>&nbsp;<span class="op" id="5259834">&lt;</span>&nbsp;<span class="ident" id="5259836">p</span><span class="op" id="5259837">[</span><span class="ident" id="5259838">j</span><span class="op" id="5259839">]</span>&nbsp;<span class="op" id="5259841">||</span>&nbsp;<span class="ident" id="5259844">p</span><span class="op" id="5259845">[</span><span class="ident" id="5259846">i</span><span class="op" id="5259847">]</span>&nbsp;<span class="op" id="5259849">==</span>&nbsp;<span class="ident" id="5259852">p</span><span class="op" id="5259853">[</span><span class="ident" id="5259854">j</span><span class="op" id="5259855">]</span>&nbsp;<span class="op" id="5259857">&amp;&amp;</span>&nbsp;<span class="ident" id="5259860">p</span><span class="op" id="5259861">[</span><span class="ident" id="5259862">i</span><span class="op" id="5259863">+</span><span class="num" id="5259864">1</span><span class="op" id="5259865">]</span>&nbsp;<span class="op" id="5259867">&gt;</span>&nbsp;<span class="ident" id="5259869">p</span><span class="op" id="5259870">[</span><span class="ident" id="5259871">j</span><span class="op" id="5259872">+</span><span class="num" id="5259873">1</span><span class="op" id="5259874">]</span><br>
<span class="lineno">1855</span><span class="op" id="5259876">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5259879">func</span>&nbsp;<span class="op" id="5259884">(</span><span class="ident" id="5259885">ra</span>&nbsp;<span class="ident" id="5259888">ranges</span><span class="op" id="5259894">)</span>&nbsp;<span class="ident" id="5259896">Len</span><span class="op" id="5259899">(</span><span class="op" id="5259900">)</span>&nbsp;<span class="builtintype" id="5259902">int</span>&nbsp;<span class="op" id="5259906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5259909">return</span>&nbsp;<span class="builtinfunc" id="5259916">len</span><span class="op" id="5259919">(</span><span class="op" id="5259920">*</span><span class="ident" id="5259921">ra</span><span class="op" id="5259923">.</span><span class="ident" id="5259924">p</span><span class="op" id="5259925">)</span>&nbsp;<span class="op" id="5259927">/</span>&nbsp;<span class="num" id="5259929">2</span><br>
<span class="lineno"></span><span class="op" id="5259931">}</span><br>
<span class="lineno">1860</span><br>
<span class="lineno"></span><span class="keyword" id="5259934">func</span>&nbsp;<span class="op" id="5259939">(</span><span class="ident" id="5259940">ra</span>&nbsp;<span class="ident" id="5259943">ranges</span><span class="op" id="5259949">)</span>&nbsp;<span class="ident" id="5259951">Swap</span><span class="op" id="5259955">(</span><span class="ident" id="5259956">i</span><span class="op" id="5259957">,</span>&nbsp;<span class="ident" id="5259959">j</span>&nbsp;<span class="builtintype" id="5259961">int</span><span class="op" id="5259964">)</span>&nbsp;<span class="op" id="5259966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5259969">p</span>&nbsp;<span class="op" id="5259971">:=</span>&nbsp;<span class="op" id="5259974">*</span><span class="ident" id="5259975">ra</span><span class="op" id="5259977">.</span><span class="ident" id="5259978">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5259981">i</span>&nbsp;<span class="op" id="5259983">*=</span>&nbsp;<span class="num" id="5259986">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5259989">j</span>&nbsp;<span class="op" id="5259991">*=</span>&nbsp;<span class="num" id="5259994">2</span><br>
<span class="lineno">1865</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5259997">p</span><span class="op" id="5259998">[</span><span class="ident" id="5259999">i</span><span class="op" id="5260000">]</span><span class="op" id="5260001">,</span>&nbsp;<span class="ident" id="5260003">p</span><span class="op" id="5260004">[</span><span class="ident" id="5260005">i</span><span class="op" id="5260006">+</span><span class="num" id="5260007">1</span><span class="op" id="5260008">]</span><span class="op" id="5260009">,</span>&nbsp;<span class="ident" id="5260011">p</span><span class="op" id="5260012">[</span><span class="ident" id="5260013">j</span><span class="op" id="5260014">]</span><span class="op" id="5260015">,</span>&nbsp;<span class="ident" id="5260017">p</span><span class="op" id="5260018">[</span><span class="ident" id="5260019">j</span><span class="op" id="5260020">+</span><span class="num" id="5260021">1</span><span class="op" id="5260022">]</span>&nbsp;<span class="op" id="5260024">=</span>&nbsp;<span class="ident" id="5260026">p</span><span class="op" id="5260027">[</span><span class="ident" id="5260028">j</span><span class="op" id="5260029">]</span><span class="op" id="5260030">,</span>&nbsp;<span class="ident" id="5260032">p</span><span class="op" id="5260033">[</span><span class="ident" id="5260034">j</span><span class="op" id="5260035">+</span><span class="num" id="5260036">1</span><span class="op" id="5260037">]</span><span class="op" id="5260038">,</span>&nbsp;<span class="ident" id="5260040">p</span><span class="op" id="5260041">[</span><span class="ident" id="5260042">i</span><span class="op" id="5260043">]</span><span class="op" id="5260044">,</span>&nbsp;<span class="ident" id="5260046">p</span><span class="op" id="5260047">[</span><span class="ident" id="5260048">i</span><span class="op" id="5260049">+</span><span class="num" id="5260050">1</span><span class="op" id="5260051">]</span><br>
<span class="lineno"></span><span class="op" id="5260053">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5260056">func</span>&nbsp;<span class="ident" id="5260061">checkUTF8</span><span class="op" id="5260070">(</span><span class="ident" id="5260071">s</span>&nbsp;<span class="builtintype" id="5260073">string</span><span class="op" id="5260079">)</span>&nbsp;<span class="builtintype" id="5260081">error</span>&nbsp;<span class="op" id="5260087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5260090">for</span>&nbsp;<span class="ident" id="5260094">s</span>&nbsp;<span class="op" id="5260096">!=</span>&nbsp;<span class="string" id="5260099">&#34;&#34;</span>&nbsp;<span class="op" id="5260102">{</span><br>
<span class="lineno">1870</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5260106">rune</span><span class="op" id="5260110">,</span>&nbsp;<span class="ident" id="5260112">size</span>&nbsp;<span class="op" id="5260117">:=</span>&nbsp;<span class="ident" id="5260120">utf8</span><span class="op" id="5260124">.</span><span class="ident" id="5260125">DecodeRuneInString</span><span class="op" id="5260143">(</span><span class="ident" id="5260144">s</span><span class="op" id="5260145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5260149">if</span>&nbsp;<span class="builtintype" id="5260152">rune</span>&nbsp;<span class="op" id="5260157">==</span>&nbsp;<span class="ident" id="5260160">utf8</span><span class="op" id="5260164">.</span><span class="ident" id="5260165">RuneError</span>&nbsp;<span class="op" id="5260175">&amp;&amp;</span>&nbsp;<span class="ident" id="5260178">size</span>&nbsp;<span class="op" id="5260183">==</span>&nbsp;<span class="num" id="5260186">1</span>&nbsp;<span class="op" id="5260188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5260193">return</span>&nbsp;<span class="op" id="5260200">&amp;</span><span class="ident" id="5260201">Error</span><span class="op" id="5260206">{</span><span class="ident" id="5260207">Code</span><span class="op" id="5260211">:</span>&nbsp;<span class="ident" id="5260213">ErrInvalidUTF8</span><span class="op" id="5260227">,</span>&nbsp;<span class="ident" id="5260229">Expr</span><span class="op" id="5260233">:</span>&nbsp;<span class="ident" id="5260235">s</span><span class="op" id="5260236">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5260240">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5260244">s</span>&nbsp;<span class="op" id="5260246">=</span>&nbsp;<span class="ident" id="5260248">s</span><span class="op" id="5260249">[</span><span class="ident" id="5260250">size</span><span class="op" id="5260254">:</span><span class="op" id="5260255">]</span><br>
<span class="lineno">1875</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5260258">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5260261">return</span>&nbsp;<span class="builtintype" id="5260268">nil</span><br>
<span class="lineno"></span><span class="op" id="5260272">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5260275">func</span>&nbsp;<span class="ident" id="5260280">nextRune</span><span class="op" id="5260288">(</span><span class="ident" id="5260289">s</span>&nbsp;<span class="builtintype" id="5260291">string</span><span class="op" id="5260297">)</span>&nbsp;<span class="op" id="5260299">(</span><span class="ident" id="5260300">c</span>&nbsp;<span class="builtintype" id="5260302">rune</span><span class="op" id="5260306">,</span>&nbsp;<span class="ident" id="5260308">t</span>&nbsp;<span class="builtintype" id="5260310">string</span><span class="op" id="5260316">,</span>&nbsp;<span class="ident" id="5260318">err</span>&nbsp;<span class="builtintype" id="5260322">error</span><span class="op" id="5260327">)</span>&nbsp;<span class="op" id="5260329">{</span><br>
<span class="lineno">1880</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5260332">c</span><span class="op" id="5260333">,</span>&nbsp;<span class="ident" id="5260335">size</span>&nbsp;<span class="op" id="5260340">:=</span>&nbsp;<span class="ident" id="5260343">utf8</span><span class="op" id="5260347">.</span><span class="ident" id="5260348">DecodeRuneInString</span><span class="op" id="5260366">(</span><span class="ident" id="5260367">s</span><span class="op" id="5260368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5260371">if</span>&nbsp;<span class="ident" id="5260374">c</span>&nbsp;<span class="op" id="5260376">==</span>&nbsp;<span class="ident" id="5260379">utf8</span><span class="op" id="5260383">.</span><span class="ident" id="5260384">RuneError</span>&nbsp;<span class="op" id="5260394">&amp;&amp;</span>&nbsp;<span class="ident" id="5260397">size</span>&nbsp;<span class="op" id="5260402">==</span>&nbsp;<span class="num" id="5260405">1</span>&nbsp;<span class="op" id="5260407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5260411">return</span>&nbsp;<span class="num" id="5260418">0</span><span class="op" id="5260419">,</span>&nbsp;<span class="string" id="5260421">&#34;&#34;</span><span class="op" id="5260423">,</span>&nbsp;<span class="op" id="5260425">&amp;</span><span class="ident" id="5260426">Error</span><span class="op" id="5260431">{</span><span class="ident" id="5260432">Code</span><span class="op" id="5260436">:</span>&nbsp;<span class="ident" id="5260438">ErrInvalidUTF8</span><span class="op" id="5260452">,</span>&nbsp;<span class="ident" id="5260454">Expr</span><span class="op" id="5260458">:</span>&nbsp;<span class="ident" id="5260460">s</span><span class="op" id="5260461">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5260464">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5260467">return</span>&nbsp;<span class="ident" id="5260474">c</span><span class="op" id="5260475">,</span>&nbsp;<span class="ident" id="5260477">s</span><span class="op" id="5260478">[</span><span class="ident" id="5260479">size</span><span class="op" id="5260483">:</span><span class="op" id="5260484">]</span><span class="op" id="5260485">,</span>&nbsp;<span class="builtintype" id="5260487">nil</span><br>
<span class="lineno">1885</span><span class="op" id="5260491">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5260494">func</span>&nbsp;<span class="ident" id="5260499">isalnum</span><span class="op" id="5260506">(</span><span class="ident" id="5260507">c</span>&nbsp;<span class="builtintype" id="5260509">rune</span><span class="op" id="5260513">)</span>&nbsp;<span class="builtintype" id="5260515">bool</span>&nbsp;<span class="op" id="5260520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5260523">return</span>&nbsp;<span class="string" id="5260530">&#39;0&#39;</span>&nbsp;<span class="op" id="5260534">&lt;=</span>&nbsp;<span class="ident" id="5260537">c</span>&nbsp;<span class="op" id="5260539">&amp;&amp;</span>&nbsp;<span class="ident" id="5260542">c</span>&nbsp;<span class="op" id="5260544">&lt;=</span>&nbsp;<span class="string" id="5260547">&#39;9&#39;</span>&nbsp;<span class="op" id="5260551">||</span>&nbsp;<span class="string" id="5260554">&#39;A&#39;</span>&nbsp;<span class="op" id="5260558">&lt;=</span>&nbsp;<span class="ident" id="5260561">c</span>&nbsp;<span class="op" id="5260563">&amp;&amp;</span>&nbsp;<span class="ident" id="5260566">c</span>&nbsp;<span class="op" id="5260568">&lt;=</span>&nbsp;<span class="string" id="5260571">&#39;Z&#39;</span>&nbsp;<span class="op" id="5260575">||</span>&nbsp;<span class="string" id="5260578">&#39;a&#39;</span>&nbsp;<span class="op" id="5260582">&lt;=</span>&nbsp;<span class="ident" id="5260585">c</span>&nbsp;<span class="op" id="5260587">&amp;&amp;</span>&nbsp;<span class="ident" id="5260590">c</span>&nbsp;<span class="op" id="5260592">&lt;=</span>&nbsp;<span class="string" id="5260595">&#39;z&#39;</span><br>
<span class="lineno"></span><span class="op" id="5260599">}</span><br>
<span class="lineno">1890</span><br>
<span class="lineno"></span><span class="keyword" id="5260602">func</span>&nbsp;<span class="ident" id="5260607">unhex</span><span class="op" id="5260612">(</span><span class="ident" id="5260613">c</span>&nbsp;<span class="builtintype" id="5260615">rune</span><span class="op" id="5260619">)</span>&nbsp;<span class="builtintype" id="5260621">rune</span>&nbsp;<span class="op" id="5260626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5260629">if</span>&nbsp;<span class="string" id="5260632">&#39;0&#39;</span>&nbsp;<span class="op" id="5260636">&lt;=</span>&nbsp;<span class="ident" id="5260639">c</span>&nbsp;<span class="op" id="5260641">&amp;&amp;</span>&nbsp;<span class="ident" id="5260644">c</span>&nbsp;<span class="op" id="5260646">&lt;=</span>&nbsp;<span class="string" id="5260649">&#39;9&#39;</span>&nbsp;<span class="op" id="5260653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5260657">return</span>&nbsp;<span class="ident" id="5260664">c</span>&nbsp;<span class="op" id="5260666">-</span>&nbsp;<span class="string" id="5260668">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5260673">}</span><br>
<span class="lineno">1895</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5260676">if</span>&nbsp;<span class="string" id="5260679">&#39;a&#39;</span>&nbsp;<span class="op" id="5260683">&lt;=</span>&nbsp;<span class="ident" id="5260686">c</span>&nbsp;<span class="op" id="5260688">&amp;&amp;</span>&nbsp;<span class="ident" id="5260691">c</span>&nbsp;<span class="op" id="5260693">&lt;=</span>&nbsp;<span class="string" id="5260696">&#39;f&#39;</span>&nbsp;<span class="op" id="5260700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5260704">return</span>&nbsp;<span class="ident" id="5260711">c</span>&nbsp;<span class="op" id="5260713">-</span>&nbsp;<span class="string" id="5260715">&#39;a&#39;</span>&nbsp;<span class="op" id="5260719">+</span>&nbsp;<span class="num" id="5260721">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5260725">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5260728">if</span>&nbsp;<span class="string" id="5260731">&#39;A&#39;</span>&nbsp;<span class="op" id="5260735">&lt;=</span>&nbsp;<span class="ident" id="5260738">c</span>&nbsp;<span class="op" id="5260740">&amp;&amp;</span>&nbsp;<span class="ident" id="5260743">c</span>&nbsp;<span class="op" id="5260745">&lt;=</span>&nbsp;<span class="string" id="5260748">&#39;F&#39;</span>&nbsp;<span class="op" id="5260752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5260756">return</span>&nbsp;<span class="ident" id="5260763">c</span>&nbsp;<span class="op" id="5260765">-</span>&nbsp;<span class="string" id="5260767">&#39;A&#39;</span>&nbsp;<span class="op" id="5260771">+</span>&nbsp;<span class="num" id="5260773">10</span><br>
<span class="lineno">1900</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5260777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5260780">return</span>&nbsp;<span class="op" id="5260787">-</span><span class="num" id="5260788">1</span><br>
<span class="lineno"></span><span class="op" id="5260790">}</span>
</div>
</body>
</html>
