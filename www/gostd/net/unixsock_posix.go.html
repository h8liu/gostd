<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3312705">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3312761">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3312815">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3312866">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris&nbsp;windows</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3312944">package</span>&nbsp;<span class="ident" id="3312952">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3312957">import</span>&nbsp;<span class="op" id="3312964">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3312967">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3312977">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3312983">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3312994">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3313001">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="3313004">func</span>&nbsp;<span class="ident" id="3313009">unixSocket</span><span class="op" id="3313019">(</span><span class="ident" id="3313020">net</span>&nbsp;<span class="builtintype" id="3313024">string</span><span class="op" id="3313030">,</span>&nbsp;<span class="ident" id="3313032">laddr</span><span class="op" id="3313037">,</span>&nbsp;<span class="ident" id="3313039">raddr</span>&nbsp;<span class="ident" id="3313045">sockaddr</span><span class="op" id="3313053">,</span>&nbsp;<span class="ident" id="3313055">mode</span>&nbsp;<span class="builtintype" id="3313060">string</span><span class="op" id="3313066">,</span>&nbsp;<span class="ident" id="3313068">deadline</span>&nbsp;<span class="ident" id="3313077">time</span><span class="op" id="3313081">.</span><span class="ident" id="3313082">Time</span><span class="op" id="3313086">)</span>&nbsp;<span class="op" id="3313088">(</span><span class="op" id="3313089">*</span><span class="ident" id="3313090">netFD</span><span class="op" id="3313095">,</span>&nbsp;<span class="builtintype" id="3313097">error</span><span class="op" id="3313102">)</span>&nbsp;<span class="op" id="3313104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3313107">var</span>&nbsp;<span class="ident" id="3313111">sotype</span>&nbsp;<span class="builtintype" id="3313118">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3313123">switch</span>&nbsp;<span class="ident" id="3313130">net</span>&nbsp;<span class="op" id="3313134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3313137">case</span>&nbsp;<span class="string" id="3313142">&#34;unix&#34;</span><span class="op" id="3313148">:</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3313152">sotype</span>&nbsp;<span class="op" id="3313159">=</span>&nbsp;<span class="ident" id="3313161">syscall</span><span class="op" id="3313168">.</span><span class="ident" id="3313169">SOCK_STREAM</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3313182">case</span>&nbsp;<span class="string" id="3313187">&#34;unixgram&#34;</span><span class="op" id="3313197">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3313201">sotype</span>&nbsp;<span class="op" id="3313208">=</span>&nbsp;<span class="ident" id="3313210">syscall</span><span class="op" id="3313217">.</span><span class="ident" id="3313218">SOCK_DGRAM</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3313230">case</span>&nbsp;<span class="string" id="3313235">&#34;unixpacket&#34;</span><span class="op" id="3313247">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3313251">sotype</span>&nbsp;<span class="op" id="3313258">=</span>&nbsp;<span class="ident" id="3313260">syscall</span><span class="op" id="3313267">.</span><span class="ident" id="3313268">SOCK_SEQPACKET</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3313284">default</span><span class="op" id="3313291">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3313295">return</span>&nbsp;<span class="ident" id="3313302">nil</span><span class="op" id="3313305">,</span>&nbsp;<span class="ident" id="3313307">UnknownNetworkError</span><span class="op" id="3313326">(</span><span class="ident" id="3313327">net</span><span class="op" id="3313330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3313333">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3313337">switch</span>&nbsp;<span class="ident" id="3313344">mode</span>&nbsp;<span class="op" id="3313349">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3313352">case</span>&nbsp;<span class="string" id="3313357">&#34;dial&#34;</span><span class="op" id="3313363">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3313367">if</span>&nbsp;<span class="ident" id="3313370">laddr</span>&nbsp;<span class="op" id="3313376">!=</span>&nbsp;<span class="ident" id="3313379">nil</span>&nbsp;<span class="op" id="3313383">&amp;&amp;</span>&nbsp;<span class="ident" id="3313386">laddr</span><span class="op" id="3313391">.</span><span class="ident" id="3313392">isWildcard</span><span class="op" id="3313402">(</span><span class="op" id="3313403">)</span>&nbsp;<span class="op" id="3313405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3313410">laddr</span>&nbsp;<span class="op" id="3313416">=</span>&nbsp;<span class="ident" id="3313418">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3313424">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3313428">if</span>&nbsp;<span class="ident" id="3313431">raddr</span>&nbsp;<span class="op" id="3313437">!=</span>&nbsp;<span class="ident" id="3313440">nil</span>&nbsp;<span class="op" id="3313444">&amp;&amp;</span>&nbsp;<span class="ident" id="3313447">raddr</span><span class="op" id="3313452">.</span><span class="ident" id="3313453">isWildcard</span><span class="op" id="3313463">(</span><span class="op" id="3313464">)</span>&nbsp;<span class="op" id="3313466">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3313471">raddr</span>&nbsp;<span class="op" id="3313477">=</span>&nbsp;<span class="ident" id="3313479">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3313485">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3313489">if</span>&nbsp;<span class="ident" id="3313492">raddr</span>&nbsp;<span class="op" id="3313498">==</span>&nbsp;<span class="ident" id="3313501">nil</span>&nbsp;<span class="op" id="3313505">&amp;&amp;</span>&nbsp;<span class="op" id="3313508">(</span><span class="ident" id="3313509">sotype</span>&nbsp;<span class="op" id="3313516">!=</span>&nbsp;<span class="ident" id="3313519">syscall</span><span class="op" id="3313526">.</span><span class="ident" id="3313527">SOCK_DGRAM</span>&nbsp;<span class="op" id="3313538">||</span>&nbsp;<span class="ident" id="3313541">laddr</span>&nbsp;<span class="op" id="3313547">==</span>&nbsp;<span class="ident" id="3313550">nil</span><span class="op" id="3313553">)</span>&nbsp;<span class="op" id="3313555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3313560">return</span>&nbsp;<span class="ident" id="3313567">nil</span><span class="op" id="3313570">,</span>&nbsp;<span class="ident" id="3313572">errMissingAddress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3313592">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3313595">case</span>&nbsp;<span class="string" id="3313600">&#34;listen&#34;</span><span class="op" id="3313608">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3313611">default</span><span class="op" id="3313618">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3313622">return</span>&nbsp;<span class="ident" id="3313629">nil</span><span class="op" id="3313632">,</span>&nbsp;<span class="ident" id="3313634">errors</span><span class="op" id="3313640">.</span><span class="ident" id="3313641">New</span><span class="op" id="3313644">(</span><span class="string" id="3313645">&#34;unknown&nbsp;mode:&nbsp;&#34;</span>&nbsp;<span class="op" id="3313662">+</span>&nbsp;<span class="ident" id="3313664">mode</span><span class="op" id="3313668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3313671">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3313675">fd</span><span class="op" id="3313677">,</span>&nbsp;<span class="ident" id="3313679">err</span>&nbsp;<span class="op" id="3313683">:=</span>&nbsp;<span class="ident" id="3313686">socket</span><span class="op" id="3313692">(</span><span class="ident" id="3313693">net</span><span class="op" id="3313696">,</span>&nbsp;<span class="ident" id="3313698">syscall</span><span class="op" id="3313705">.</span><span class="ident" id="3313706">AF_UNIX</span><span class="op" id="3313713">,</span>&nbsp;<span class="ident" id="3313715">sotype</span><span class="op" id="3313721">,</span>&nbsp;<span class="num" id="3313723">0</span><span class="op" id="3313724">,</span>&nbsp;<span class="builtintype" id="3313726">false</span><span class="op" id="3313731">,</span>&nbsp;<span class="ident" id="3313733">laddr</span><span class="op" id="3313738">,</span>&nbsp;<span class="ident" id="3313740">raddr</span><span class="op" id="3313745">,</span>&nbsp;<span class="ident" id="3313747">deadline</span><span class="op" id="3313755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3313758">if</span>&nbsp;<span class="ident" id="3313761">err</span>&nbsp;<span class="op" id="3313765">!=</span>&nbsp;<span class="ident" id="3313768">nil</span>&nbsp;<span class="op" id="3313772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3313776">return</span>&nbsp;<span class="ident" id="3313783">nil</span><span class="op" id="3313786">,</span>&nbsp;<span class="ident" id="3313788">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3313793">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3313796">return</span>&nbsp;<span class="ident" id="3313803">fd</span><span class="op" id="3313805">,</span>&nbsp;<span class="ident" id="3313807">nil</span><br>
<span class="lineno">50</span><span class="op" id="3313811">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3313814">func</span>&nbsp;<span class="ident" id="3313819">sockaddrToUnix</span><span class="op" id="3313833">(</span><span class="ident" id="3313834">sa</span>&nbsp;<span class="ident" id="3313837">syscall</span><span class="op" id="3313844">.</span><span class="ident" id="3313845">Sockaddr</span><span class="op" id="3313853">)</span>&nbsp;<span class="ident" id="3313855">Addr</span>&nbsp;<span class="op" id="3313860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3313863">if</span>&nbsp;<span class="ident" id="3313866">s</span><span class="op" id="3313867">,</span>&nbsp;<span class="ident" id="3313869">ok</span>&nbsp;<span class="op" id="3313872">:=</span>&nbsp;<span class="ident" id="3313875">sa</span><span class="op" id="3313877">.</span><span class="op" id="3313878">(</span><span class="op" id="3313879">*</span><span class="ident" id="3313880">syscall</span><span class="op" id="3313887">.</span><span class="ident" id="3313888">SockaddrUnix</span><span class="op" id="3313900">)</span><span class="op" id="3313901">;</span>&nbsp;<span class="ident" id="3313903">ok</span>&nbsp;<span class="op" id="3313906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3313910">return</span>&nbsp;<span class="op" id="3313917">&amp;</span><span class="ident" id="3313918">UnixAddr</span><span class="op" id="3313926">{</span><span class="ident" id="3313927">Name</span><span class="op" id="3313931">:</span>&nbsp;<span class="ident" id="3313933">s</span><span class="op" id="3313934">.</span><span class="ident" id="3313935">Name</span><span class="op" id="3313939">,</span>&nbsp;<span class="ident" id="3313941">Net</span><span class="op" id="3313944">:</span>&nbsp;<span class="string" id="3313946">&#34;unix&#34;</span><span class="op" id="3313952">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3313955">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3313958">return</span>&nbsp;<span class="ident" id="3313965">nil</span><br>
<span class="lineno"></span><span class="op" id="3313969">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3313972">func</span>&nbsp;<span class="ident" id="3313977">sockaddrToUnixgram</span><span class="op" id="3313995">(</span><span class="ident" id="3313996">sa</span>&nbsp;<span class="ident" id="3313999">syscall</span><span class="op" id="3314006">.</span><span class="ident" id="3314007">Sockaddr</span><span class="op" id="3314015">)</span>&nbsp;<span class="ident" id="3314017">Addr</span>&nbsp;<span class="op" id="3314022">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3314025">if</span>&nbsp;<span class="ident" id="3314028">s</span><span class="op" id="3314029">,</span>&nbsp;<span class="ident" id="3314031">ok</span>&nbsp;<span class="op" id="3314034">:=</span>&nbsp;<span class="ident" id="3314037">sa</span><span class="op" id="3314039">.</span><span class="op" id="3314040">(</span><span class="op" id="3314041">*</span><span class="ident" id="3314042">syscall</span><span class="op" id="3314049">.</span><span class="ident" id="3314050">SockaddrUnix</span><span class="op" id="3314062">)</span><span class="op" id="3314063">;</span>&nbsp;<span class="ident" id="3314065">ok</span>&nbsp;<span class="op" id="3314068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3314072">return</span>&nbsp;<span class="op" id="3314079">&amp;</span><span class="ident" id="3314080">UnixAddr</span><span class="op" id="3314088">{</span><span class="ident" id="3314089">Name</span><span class="op" id="3314093">:</span>&nbsp;<span class="ident" id="3314095">s</span><span class="op" id="3314096">.</span><span class="ident" id="3314097">Name</span><span class="op" id="3314101">,</span>&nbsp;<span class="ident" id="3314103">Net</span><span class="op" id="3314106">:</span>&nbsp;<span class="string" id="3314108">&#34;unixgram&#34;</span><span class="op" id="3314118">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3314121">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3314124">return</span>&nbsp;<span class="ident" id="3314131">nil</span><br>
<span class="lineno"></span><span class="op" id="3314135">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="3314138">func</span>&nbsp;<span class="ident" id="3314143">sockaddrToUnixpacket</span><span class="op" id="3314163">(</span><span class="ident" id="3314164">sa</span>&nbsp;<span class="ident" id="3314167">syscall</span><span class="op" id="3314174">.</span><span class="ident" id="3314175">Sockaddr</span><span class="op" id="3314183">)</span>&nbsp;<span class="ident" id="3314185">Addr</span>&nbsp;<span class="op" id="3314190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3314193">if</span>&nbsp;<span class="ident" id="3314196">s</span><span class="op" id="3314197">,</span>&nbsp;<span class="ident" id="3314199">ok</span>&nbsp;<span class="op" id="3314202">:=</span>&nbsp;<span class="ident" id="3314205">sa</span><span class="op" id="3314207">.</span><span class="op" id="3314208">(</span><span class="op" id="3314209">*</span><span class="ident" id="3314210">syscall</span><span class="op" id="3314217">.</span><span class="ident" id="3314218">SockaddrUnix</span><span class="op" id="3314230">)</span><span class="op" id="3314231">;</span>&nbsp;<span class="ident" id="3314233">ok</span>&nbsp;<span class="op" id="3314236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3314240">return</span>&nbsp;<span class="op" id="3314247">&amp;</span><span class="ident" id="3314248">UnixAddr</span><span class="op" id="3314256">{</span><span class="ident" id="3314257">Name</span><span class="op" id="3314261">:</span>&nbsp;<span class="ident" id="3314263">s</span><span class="op" id="3314264">.</span><span class="ident" id="3314265">Name</span><span class="op" id="3314269">,</span>&nbsp;<span class="ident" id="3314271">Net</span><span class="op" id="3314274">:</span>&nbsp;<span class="string" id="3314276">&#34;unixpacket&#34;</span><span class="op" id="3314288">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3314291">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3314294">return</span>&nbsp;<span class="ident" id="3314301">nil</span><br>
<span class="lineno"></span><span class="op" id="3314305">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3314308">func</span>&nbsp;<span class="ident" id="3314313">sotypeToNet</span><span class="op" id="3314324">(</span><span class="ident" id="3314325">sotype</span>&nbsp;<span class="builtintype" id="3314332">int</span><span class="op" id="3314335">)</span>&nbsp;<span class="builtintype" id="3314337">string</span>&nbsp;<span class="op" id="3314344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3314347">switch</span>&nbsp;<span class="ident" id="3314354">sotype</span>&nbsp;<span class="op" id="3314361">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3314364">case</span>&nbsp;<span class="ident" id="3314369">syscall</span><span class="op" id="3314376">.</span><span class="ident" id="3314377">SOCK_STREAM</span><span class="op" id="3314388">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3314392">return</span>&nbsp;<span class="string" id="3314399">&#34;unix&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3314407">case</span>&nbsp;<span class="ident" id="3314412">syscall</span><span class="op" id="3314419">.</span><span class="ident" id="3314420">SOCK_DGRAM</span><span class="op" id="3314430">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3314434">return</span>&nbsp;<span class="string" id="3314441">&#34;unixgram&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3314453">case</span>&nbsp;<span class="ident" id="3314458">syscall</span><span class="op" id="3314465">.</span><span class="ident" id="3314466">SOCK_SEQPACKET</span><span class="op" id="3314480">:</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3314484">return</span>&nbsp;<span class="string" id="3314491">&#34;unixpacket&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3314505">default</span><span class="op" id="3314512">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3314516">panic</span><span class="op" id="3314521">(</span><span class="string" id="3314522">&#34;sotypeToNet&nbsp;unknown&nbsp;socket&nbsp;type&#34;</span><span class="op" id="3314555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3314558">}</span><br>
<span class="lineno"></span><span class="op" id="3314560">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="keyword" id="3314563">func</span>&nbsp;<span class="op" id="3314568">(</span><span class="ident" id="3314569">a</span>&nbsp;<span class="op" id="3314571">*</span><span class="ident" id="3314572">UnixAddr</span><span class="op" id="3314580">)</span>&nbsp;<span class="ident" id="3314582">family</span><span class="op" id="3314588">(</span><span class="op" id="3314589">)</span>&nbsp;<span class="builtintype" id="3314591">int</span>&nbsp;<span class="op" id="3314595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3314598">return</span>&nbsp;<span class="ident" id="3314605">syscall</span><span class="op" id="3314612">.</span><span class="ident" id="3314613">AF_UNIX</span><br>
<span class="lineno"></span><span class="op" id="3314621">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="3314624">func</span>&nbsp;<span class="op" id="3314629">(</span><span class="ident" id="3314630">a</span>&nbsp;<span class="op" id="3314632">*</span><span class="ident" id="3314633">UnixAddr</span><span class="op" id="3314641">)</span>&nbsp;<span class="ident" id="3314643">isWildcard</span><span class="op" id="3314653">(</span><span class="op" id="3314654">)</span>&nbsp;<span class="builtintype" id="3314656">bool</span>&nbsp;<span class="op" id="3314661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3314664">return</span>&nbsp;<span class="ident" id="3314671">a</span>&nbsp;<span class="op" id="3314673">==</span>&nbsp;<span class="ident" id="3314676">nil</span>&nbsp;<span class="op" id="3314680">||</span>&nbsp;<span class="ident" id="3314683">a</span><span class="op" id="3314684">.</span><span class="ident" id="3314685">Name</span>&nbsp;<span class="op" id="3314690">==</span>&nbsp;<span class="string" id="3314693">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="3314696">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3314699">func</span>&nbsp;<span class="op" id="3314704">(</span><span class="ident" id="3314705">a</span>&nbsp;<span class="op" id="3314707">*</span><span class="ident" id="3314708">UnixAddr</span><span class="op" id="3314716">)</span>&nbsp;<span class="ident" id="3314718">sockaddr</span><span class="op" id="3314726">(</span><span class="ident" id="3314727">family</span>&nbsp;<span class="builtintype" id="3314734">int</span><span class="op" id="3314737">)</span>&nbsp;<span class="op" id="3314739">(</span><span class="ident" id="3314740">syscall</span><span class="op" id="3314747">.</span><span class="ident" id="3314748">Sockaddr</span><span class="op" id="3314756">,</span>&nbsp;<span class="builtintype" id="3314758">error</span><span class="op" id="3314763">)</span>&nbsp;<span class="op" id="3314765">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3314768">if</span>&nbsp;<span class="ident" id="3314771">a</span>&nbsp;<span class="op" id="3314773">==</span>&nbsp;<span class="ident" id="3314776">nil</span>&nbsp;<span class="op" id="3314780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3314784">return</span>&nbsp;<span class="ident" id="3314791">nil</span><span class="op" id="3314794">,</span>&nbsp;<span class="ident" id="3314796">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3314801">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3314804">return</span>&nbsp;<span class="op" id="3314811">&amp;</span><span class="ident" id="3314812">syscall</span><span class="op" id="3314819">.</span><span class="ident" id="3314820">SockaddrUnix</span><span class="op" id="3314832">{</span><span class="ident" id="3314833">Name</span><span class="op" id="3314837">:</span>&nbsp;<span class="ident" id="3314839">a</span><span class="op" id="3314840">.</span><span class="ident" id="3314841">Name</span><span class="op" id="3314845">}</span><span class="op" id="3314846">,</span>&nbsp;<span class="ident" id="3314848">nil</span><br>
<span class="lineno"></span><span class="op" id="3314852">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="comment" id="3314855">//&nbsp;UnixConn&nbsp;is&nbsp;an&nbsp;implementation&nbsp;of&nbsp;the&nbsp;Conn&nbsp;interface&nbsp;for&nbsp;connections</span><br>
<span class="lineno"></span><span class="comment" id="3314926">//&nbsp;to&nbsp;Unix&nbsp;domain&nbsp;sockets.</span><br>
<span class="lineno"></span><span class="keyword" id="3314953">type</span>&nbsp;<span class="ident" id="3314958">UnixConn</span>&nbsp;<span class="keyword" id="3314967">struct</span>&nbsp;<span class="op" id="3314974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3314977">conn</span><br>
<span class="lineno">105</span><span class="op" id="3314982">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3314985">func</span>&nbsp;<span class="ident" id="3314990">newUnixConn</span><span class="op" id="3315001">(</span><span class="ident" id="3315002">fd</span>&nbsp;<span class="op" id="3315005">*</span><span class="ident" id="3315006">netFD</span><span class="op" id="3315011">)</span>&nbsp;<span class="op" id="3315013">*</span><span class="ident" id="3315014">UnixConn</span>&nbsp;<span class="op" id="3315023">{</span>&nbsp;<span class="keyword" id="3315025">return</span>&nbsp;<span class="op" id="3315032">&amp;</span><span class="ident" id="3315033">UnixConn</span><span class="op" id="3315041">{</span><span class="ident" id="3315042">conn</span><span class="op" id="3315046">{</span><span class="ident" id="3315047">fd</span><span class="op" id="3315049">}</span><span class="op" id="3315050">}</span>&nbsp;<span class="op" id="3315052">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3315055">//&nbsp;ReadFromUnix&nbsp;reads&nbsp;a&nbsp;packet&nbsp;from&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;into&nbsp;b.&nbsp;&nbsp;It</span><br>
<span class="lineno">110</span><span class="comment" id="3315126">//&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;b&nbsp;and&nbsp;the&nbsp;source&nbsp;address&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3315197">//&nbsp;the&nbsp;packet.</span><br>
<span class="lineno"></span><span class="comment" id="3315212">//</span><br>
<span class="lineno"></span><span class="comment" id="3315215">//&nbsp;ReadFromUnix&nbsp;can&nbsp;be&nbsp;made&nbsp;to&nbsp;time&nbsp;out&nbsp;and&nbsp;return&nbsp;an&nbsp;error&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="3315280">//&nbsp;Timeout()&nbsp;==&nbsp;true&nbsp;after&nbsp;a&nbsp;fixed&nbsp;time&nbsp;limit;&nbsp;see&nbsp;SetDeadline&nbsp;and</span><br>
<span class="lineno">115</span><span class="comment" id="3315347">//&nbsp;SetReadDeadline.</span><br>
<span class="lineno"></span><span class="keyword" id="3315367">func</span>&nbsp;<span class="op" id="3315372">(</span><span class="ident" id="3315373">c</span>&nbsp;<span class="op" id="3315375">*</span><span class="ident" id="3315376">UnixConn</span><span class="op" id="3315384">)</span>&nbsp;<span class="ident" id="3315386">ReadFromUnix</span><span class="op" id="3315398">(</span><span class="ident" id="3315399">b</span>&nbsp;<span class="op" id="3315401">[</span><span class="op" id="3315402">]</span><span class="builtintype" id="3315403">byte</span><span class="op" id="3315407">)</span>&nbsp;<span class="op" id="3315409">(</span><span class="ident" id="3315410">n</span>&nbsp;<span class="builtintype" id="3315412">int</span><span class="op" id="3315415">,</span>&nbsp;<span class="ident" id="3315417">addr</span>&nbsp;<span class="op" id="3315422">*</span><span class="ident" id="3315423">UnixAddr</span><span class="op" id="3315431">,</span>&nbsp;<span class="ident" id="3315433">err</span>&nbsp;<span class="builtintype" id="3315437">error</span><span class="op" id="3315442">)</span>&nbsp;<span class="op" id="3315444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3315447">if</span>&nbsp;<span class="op" id="3315450">!</span><span class="ident" id="3315451">c</span><span class="op" id="3315452">.</span><span class="ident" id="3315453">ok</span><span class="op" id="3315455">(</span><span class="op" id="3315456">)</span>&nbsp;<span class="op" id="3315458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3315462">return</span>&nbsp;<span class="num" id="3315469">0</span><span class="op" id="3315470">,</span>&nbsp;<span class="ident" id="3315472">nil</span><span class="op" id="3315475">,</span>&nbsp;<span class="ident" id="3315477">syscall</span><span class="op" id="3315484">.</span><span class="ident" id="3315485">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3315493">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3315496">n</span><span class="op" id="3315497">,</span>&nbsp;<span class="ident" id="3315499">sa</span><span class="op" id="3315501">,</span>&nbsp;<span class="ident" id="3315503">err</span>&nbsp;<span class="op" id="3315507">:=</span>&nbsp;<span class="ident" id="3315510">c</span><span class="op" id="3315511">.</span><span class="ident" id="3315512">fd</span><span class="op" id="3315514">.</span><span class="ident" id="3315515">readFrom</span><span class="op" id="3315523">(</span><span class="ident" id="3315524">b</span><span class="op" id="3315525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3315528">switch</span>&nbsp;<span class="ident" id="3315535">sa</span>&nbsp;<span class="op" id="3315538">:=</span>&nbsp;<span class="ident" id="3315541">sa</span><span class="op" id="3315543">.</span><span class="op" id="3315544">(</span><span class="keyword" id="3315545">type</span><span class="op" id="3315549">)</span>&nbsp;<span class="op" id="3315551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3315554">case</span>&nbsp;<span class="op" id="3315559">*</span><span class="ident" id="3315560">syscall</span><span class="op" id="3315567">.</span><span class="ident" id="3315568">SockaddrUnix</span><span class="op" id="3315580">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3315584">if</span>&nbsp;<span class="ident" id="3315587">sa</span><span class="op" id="3315589">.</span><span class="ident" id="3315590">Name</span>&nbsp;<span class="op" id="3315595">!=</span>&nbsp;<span class="string" id="3315598">&#34;&#34;</span>&nbsp;<span class="op" id="3315601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3315606">addr</span>&nbsp;<span class="op" id="3315611">=</span>&nbsp;<span class="op" id="3315613">&amp;</span><span class="ident" id="3315614">UnixAddr</span><span class="op" id="3315622">{</span><span class="ident" id="3315623">Name</span><span class="op" id="3315627">:</span>&nbsp;<span class="ident" id="3315629">sa</span><span class="op" id="3315631">.</span><span class="ident" id="3315632">Name</span><span class="op" id="3315636">,</span>&nbsp;<span class="ident" id="3315638">Net</span><span class="op" id="3315641">:</span>&nbsp;<span class="ident" id="3315643">sotypeToNet</span><span class="op" id="3315654">(</span><span class="ident" id="3315655">c</span><span class="op" id="3315656">.</span><span class="ident" id="3315657">fd</span><span class="op" id="3315659">.</span><span class="ident" id="3315660">sotype</span><span class="op" id="3315666">)</span><span class="op" id="3315667">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3315671">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3315674">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3315677">return</span><br>
<span class="lineno"></span><span class="op" id="3315684">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="3315687">//&nbsp;ReadFrom&nbsp;implements&nbsp;the&nbsp;PacketConn&nbsp;ReadFrom&nbsp;method.</span><br>
<span class="lineno"></span><span class="keyword" id="3315742">func</span>&nbsp;<span class="op" id="3315747">(</span><span class="ident" id="3315748">c</span>&nbsp;<span class="op" id="3315750">*</span><span class="ident" id="3315751">UnixConn</span><span class="op" id="3315759">)</span>&nbsp;<span class="ident" id="3315761">ReadFrom</span><span class="op" id="3315769">(</span><span class="ident" id="3315770">b</span>&nbsp;<span class="op" id="3315772">[</span><span class="op" id="3315773">]</span><span class="builtintype" id="3315774">byte</span><span class="op" id="3315778">)</span>&nbsp;<span class="op" id="3315780">(</span><span class="builtintype" id="3315781">int</span><span class="op" id="3315784">,</span>&nbsp;<span class="ident" id="3315786">Addr</span><span class="op" id="3315790">,</span>&nbsp;<span class="builtintype" id="3315792">error</span><span class="op" id="3315797">)</span>&nbsp;<span class="op" id="3315799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3315802">if</span>&nbsp;<span class="op" id="3315805">!</span><span class="ident" id="3315806">c</span><span class="op" id="3315807">.</span><span class="ident" id="3315808">ok</span><span class="op" id="3315810">(</span><span class="op" id="3315811">)</span>&nbsp;<span class="op" id="3315813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3315817">return</span>&nbsp;<span class="num" id="3315824">0</span><span class="op" id="3315825">,</span>&nbsp;<span class="ident" id="3315827">nil</span><span class="op" id="3315830">,</span>&nbsp;<span class="ident" id="3315832">syscall</span><span class="op" id="3315839">.</span><span class="ident" id="3315840">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3315848">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3315851">n</span><span class="op" id="3315852">,</span>&nbsp;<span class="ident" id="3315854">addr</span><span class="op" id="3315858">,</span>&nbsp;<span class="ident" id="3315860">err</span>&nbsp;<span class="op" id="3315864">:=</span>&nbsp;<span class="ident" id="3315867">c</span><span class="op" id="3315868">.</span><span class="ident" id="3315869">ReadFromUnix</span><span class="op" id="3315881">(</span><span class="ident" id="3315882">b</span><span class="op" id="3315883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3315886">return</span>&nbsp;<span class="ident" id="3315893">n</span><span class="op" id="3315894">,</span>&nbsp;<span class="ident" id="3315896">addr</span><span class="op" id="3315900">.</span><span class="ident" id="3315901">toAddr</span><span class="op" id="3315907">(</span><span class="op" id="3315908">)</span><span class="op" id="3315909">,</span>&nbsp;<span class="ident" id="3315911">err</span><br>
<span class="lineno"></span><span class="op" id="3315915">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3315918">//&nbsp;ReadMsgUnix&nbsp;reads&nbsp;a&nbsp;packet&nbsp;from&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;into&nbsp;b&nbsp;and</span><br>
<span class="lineno">140</span><span class="comment" id="3315987">//&nbsp;the&nbsp;associated&nbsp;out-of-band&nbsp;data&nbsp;into&nbsp;oob.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3316058">//&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;b,&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;oob,&nbsp;the&nbsp;flags</span><br>
<span class="lineno"></span><span class="comment" id="3316129">//&nbsp;that&nbsp;were&nbsp;set&nbsp;on&nbsp;the&nbsp;packet,&nbsp;and&nbsp;the&nbsp;source&nbsp;address&nbsp;of&nbsp;the&nbsp;packet.</span><br>
<span class="lineno"></span><span class="keyword" id="3316199">func</span>&nbsp;<span class="op" id="3316204">(</span><span class="ident" id="3316205">c</span>&nbsp;<span class="op" id="3316207">*</span><span class="ident" id="3316208">UnixConn</span><span class="op" id="3316216">)</span>&nbsp;<span class="ident" id="3316218">ReadMsgUnix</span><span class="op" id="3316229">(</span><span class="ident" id="3316230">b</span><span class="op" id="3316231">,</span>&nbsp;<span class="ident" id="3316233">oob</span>&nbsp;<span class="op" id="3316237">[</span><span class="op" id="3316238">]</span><span class="builtintype" id="3316239">byte</span><span class="op" id="3316243">)</span>&nbsp;<span class="op" id="3316245">(</span><span class="ident" id="3316246">n</span><span class="op" id="3316247">,</span>&nbsp;<span class="ident" id="3316249">oobn</span><span class="op" id="3316253">,</span>&nbsp;<span class="ident" id="3316255">flags</span>&nbsp;<span class="builtintype" id="3316261">int</span><span class="op" id="3316264">,</span>&nbsp;<span class="ident" id="3316266">addr</span>&nbsp;<span class="op" id="3316271">*</span><span class="ident" id="3316272">UnixAddr</span><span class="op" id="3316280">,</span>&nbsp;<span class="ident" id="3316282">err</span>&nbsp;<span class="builtintype" id="3316286">error</span><span class="op" id="3316291">)</span>&nbsp;<span class="op" id="3316293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3316296">if</span>&nbsp;<span class="op" id="3316299">!</span><span class="ident" id="3316300">c</span><span class="op" id="3316301">.</span><span class="ident" id="3316302">ok</span><span class="op" id="3316304">(</span><span class="op" id="3316305">)</span>&nbsp;<span class="op" id="3316307">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3316311">return</span>&nbsp;<span class="num" id="3316318">0</span><span class="op" id="3316319">,</span>&nbsp;<span class="num" id="3316321">0</span><span class="op" id="3316322">,</span>&nbsp;<span class="num" id="3316324">0</span><span class="op" id="3316325">,</span>&nbsp;<span class="ident" id="3316327">nil</span><span class="op" id="3316330">,</span>&nbsp;<span class="ident" id="3316332">syscall</span><span class="op" id="3316339">.</span><span class="ident" id="3316340">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3316348">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3316351">n</span><span class="op" id="3316352">,</span>&nbsp;<span class="ident" id="3316354">oobn</span><span class="op" id="3316358">,</span>&nbsp;<span class="ident" id="3316360">flags</span><span class="op" id="3316365">,</span>&nbsp;<span class="ident" id="3316367">sa</span><span class="op" id="3316369">,</span>&nbsp;<span class="ident" id="3316371">err</span>&nbsp;<span class="op" id="3316375">:=</span>&nbsp;<span class="ident" id="3316378">c</span><span class="op" id="3316379">.</span><span class="ident" id="3316380">fd</span><span class="op" id="3316382">.</span><span class="ident" id="3316383">readMsg</span><span class="op" id="3316390">(</span><span class="ident" id="3316391">b</span><span class="op" id="3316392">,</span>&nbsp;<span class="ident" id="3316394">oob</span><span class="op" id="3316397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3316400">switch</span>&nbsp;<span class="ident" id="3316407">sa</span>&nbsp;<span class="op" id="3316410">:=</span>&nbsp;<span class="ident" id="3316413">sa</span><span class="op" id="3316415">.</span><span class="op" id="3316416">(</span><span class="keyword" id="3316417">type</span><span class="op" id="3316421">)</span>&nbsp;<span class="op" id="3316423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3316426">case</span>&nbsp;<span class="op" id="3316431">*</span><span class="ident" id="3316432">syscall</span><span class="op" id="3316439">.</span><span class="ident" id="3316440">SockaddrUnix</span><span class="op" id="3316452">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3316456">if</span>&nbsp;<span class="ident" id="3316459">sa</span><span class="op" id="3316461">.</span><span class="ident" id="3316462">Name</span>&nbsp;<span class="op" id="3316467">!=</span>&nbsp;<span class="string" id="3316470">&#34;&#34;</span>&nbsp;<span class="op" id="3316473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3316478">addr</span>&nbsp;<span class="op" id="3316483">=</span>&nbsp;<span class="op" id="3316485">&amp;</span><span class="ident" id="3316486">UnixAddr</span><span class="op" id="3316494">{</span><span class="ident" id="3316495">Name</span><span class="op" id="3316499">:</span>&nbsp;<span class="ident" id="3316501">sa</span><span class="op" id="3316503">.</span><span class="ident" id="3316504">Name</span><span class="op" id="3316508">,</span>&nbsp;<span class="ident" id="3316510">Net</span><span class="op" id="3316513">:</span>&nbsp;<span class="ident" id="3316515">sotypeToNet</span><span class="op" id="3316526">(</span><span class="ident" id="3316527">c</span><span class="op" id="3316528">.</span><span class="ident" id="3316529">fd</span><span class="op" id="3316531">.</span><span class="ident" id="3316532">sotype</span><span class="op" id="3316538">)</span><span class="op" id="3316539">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3316543">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3316546">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3316549">return</span><br>
<span class="lineno">155</span><span class="op" id="3316556">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3316559">//&nbsp;WriteToUnix&nbsp;writes&nbsp;a&nbsp;packet&nbsp;to&nbsp;addr&nbsp;via&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;from&nbsp;b.</span><br>
<span class="lineno"></span><span class="comment" id="3316633">//</span><br>
<span class="lineno"></span><span class="comment" id="3316636">//&nbsp;WriteToUnix&nbsp;can&nbsp;be&nbsp;made&nbsp;to&nbsp;time&nbsp;out&nbsp;and&nbsp;return&nbsp;an&nbsp;error&nbsp;with</span><br>
<span class="lineno">160</span><span class="comment" id="3316700">//&nbsp;Timeout()&nbsp;==&nbsp;true&nbsp;after&nbsp;a&nbsp;fixed&nbsp;time&nbsp;limit;&nbsp;see&nbsp;SetDeadline&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3316767">//&nbsp;SetWriteDeadline.&nbsp;&nbsp;On&nbsp;packet-oriented&nbsp;connections,&nbsp;write&nbsp;timeouts</span><br>
<span class="lineno"></span><span class="comment" id="3316836">//&nbsp;are&nbsp;rare.</span><br>
<span class="lineno"></span><span class="keyword" id="3316849">func</span>&nbsp;<span class="op" id="3316854">(</span><span class="ident" id="3316855">c</span>&nbsp;<span class="op" id="3316857">*</span><span class="ident" id="3316858">UnixConn</span><span class="op" id="3316866">)</span>&nbsp;<span class="ident" id="3316868">WriteToUnix</span><span class="op" id="3316879">(</span><span class="ident" id="3316880">b</span>&nbsp;<span class="op" id="3316882">[</span><span class="op" id="3316883">]</span><span class="builtintype" id="3316884">byte</span><span class="op" id="3316888">,</span>&nbsp;<span class="ident" id="3316890">addr</span>&nbsp;<span class="op" id="3316895">*</span><span class="ident" id="3316896">UnixAddr</span><span class="op" id="3316904">)</span>&nbsp;<span class="op" id="3316906">(</span><span class="ident" id="3316907">n</span>&nbsp;<span class="builtintype" id="3316909">int</span><span class="op" id="3316912">,</span>&nbsp;<span class="ident" id="3316914">err</span>&nbsp;<span class="builtintype" id="3316918">error</span><span class="op" id="3316923">)</span>&nbsp;<span class="op" id="3316925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3316928">if</span>&nbsp;<span class="op" id="3316931">!</span><span class="ident" id="3316932">c</span><span class="op" id="3316933">.</span><span class="ident" id="3316934">ok</span><span class="op" id="3316936">(</span><span class="op" id="3316937">)</span>&nbsp;<span class="op" id="3316939">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3316943">return</span>&nbsp;<span class="num" id="3316950">0</span><span class="op" id="3316951">,</span>&nbsp;<span class="ident" id="3316953">syscall</span><span class="op" id="3316960">.</span><span class="ident" id="3316961">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3316969">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3316972">if</span>&nbsp;<span class="ident" id="3316975">c</span><span class="op" id="3316976">.</span><span class="ident" id="3316977">fd</span><span class="op" id="3316979">.</span><span class="ident" id="3316980">isConnected</span>&nbsp;<span class="op" id="3316992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3316996">return</span>&nbsp;<span class="num" id="3317003">0</span><span class="op" id="3317004">,</span>&nbsp;<span class="op" id="3317006">&amp;</span><span class="ident" id="3317007">OpError</span><span class="op" id="3317014">{</span><span class="ident" id="3317015">Op</span><span class="op" id="3317017">:</span>&nbsp;<span class="string" id="3317019">&#34;write&#34;</span><span class="op" id="3317026">,</span>&nbsp;<span class="ident" id="3317028">Net</span><span class="op" id="3317031">:</span>&nbsp;<span class="ident" id="3317033">c</span><span class="op" id="3317034">.</span><span class="ident" id="3317035">fd</span><span class="op" id="3317037">.</span><span class="ident" id="3317038">net</span><span class="op" id="3317041">,</span>&nbsp;<span class="ident" id="3317043">Addr</span><span class="op" id="3317047">:</span>&nbsp;<span class="ident" id="3317049">addr</span><span class="op" id="3317053">,</span>&nbsp;<span class="ident" id="3317055">Err</span><span class="op" id="3317058">:</span>&nbsp;<span class="ident" id="3317060">ErrWriteToConnected</span><span class="op" id="3317079">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3317082">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3317085">if</span>&nbsp;<span class="ident" id="3317088">addr</span>&nbsp;<span class="op" id="3317093">==</span>&nbsp;<span class="ident" id="3317096">nil</span>&nbsp;<span class="op" id="3317100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3317104">return</span>&nbsp;<span class="num" id="3317111">0</span><span class="op" id="3317112">,</span>&nbsp;<span class="op" id="3317114">&amp;</span><span class="ident" id="3317115">OpError</span><span class="op" id="3317122">{</span><span class="ident" id="3317123">Op</span><span class="op" id="3317125">:</span>&nbsp;<span class="string" id="3317127">&#34;write&#34;</span><span class="op" id="3317134">,</span>&nbsp;<span class="ident" id="3317136">Net</span><span class="op" id="3317139">:</span>&nbsp;<span class="ident" id="3317141">c</span><span class="op" id="3317142">.</span><span class="ident" id="3317143">fd</span><span class="op" id="3317145">.</span><span class="ident" id="3317146">net</span><span class="op" id="3317149">,</span>&nbsp;<span class="ident" id="3317151">Addr</span><span class="op" id="3317155">:</span>&nbsp;<span class="ident" id="3317157">nil</span><span class="op" id="3317160">,</span>&nbsp;<span class="ident" id="3317162">Err</span><span class="op" id="3317165">:</span>&nbsp;<span class="ident" id="3317167">errMissingAddress</span><span class="op" id="3317184">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3317187">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3317190">if</span>&nbsp;<span class="ident" id="3317193">addr</span><span class="op" id="3317197">.</span><span class="ident" id="3317198">Net</span>&nbsp;<span class="op" id="3317202">!=</span>&nbsp;<span class="ident" id="3317205">sotypeToNet</span><span class="op" id="3317216">(</span><span class="ident" id="3317217">c</span><span class="op" id="3317218">.</span><span class="ident" id="3317219">fd</span><span class="op" id="3317221">.</span><span class="ident" id="3317222">sotype</span><span class="op" id="3317228">)</span>&nbsp;<span class="op" id="3317230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3317234">return</span>&nbsp;<span class="num" id="3317241">0</span><span class="op" id="3317242">,</span>&nbsp;<span class="ident" id="3317244">syscall</span><span class="op" id="3317251">.</span><span class="ident" id="3317252">EAFNOSUPPORT</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3317266">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3317269">sa</span>&nbsp;<span class="op" id="3317272">:=</span>&nbsp;<span class="op" id="3317275">&amp;</span><span class="ident" id="3317276">syscall</span><span class="op" id="3317283">.</span><span class="ident" id="3317284">SockaddrUnix</span><span class="op" id="3317296">{</span><span class="ident" id="3317297">Name</span><span class="op" id="3317301">:</span>&nbsp;<span class="ident" id="3317303">addr</span><span class="op" id="3317307">.</span><span class="ident" id="3317308">Name</span><span class="op" id="3317312">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3317315">return</span>&nbsp;<span class="ident" id="3317322">c</span><span class="op" id="3317323">.</span><span class="ident" id="3317324">fd</span><span class="op" id="3317326">.</span><span class="ident" id="3317327">writeTo</span><span class="op" id="3317334">(</span><span class="ident" id="3317335">b</span><span class="op" id="3317336">,</span>&nbsp;<span class="ident" id="3317338">sa</span><span class="op" id="3317340">)</span><br>
<span class="lineno"></span><span class="op" id="3317342">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="comment" id="3317345">//&nbsp;WriteTo&nbsp;implements&nbsp;the&nbsp;PacketConn&nbsp;WriteTo&nbsp;method.</span><br>
<span class="lineno"></span><span class="keyword" id="3317398">func</span>&nbsp;<span class="op" id="3317403">(</span><span class="ident" id="3317404">c</span>&nbsp;<span class="op" id="3317406">*</span><span class="ident" id="3317407">UnixConn</span><span class="op" id="3317415">)</span>&nbsp;<span class="ident" id="3317417">WriteTo</span><span class="op" id="3317424">(</span><span class="ident" id="3317425">b</span>&nbsp;<span class="op" id="3317427">[</span><span class="op" id="3317428">]</span><span class="builtintype" id="3317429">byte</span><span class="op" id="3317433">,</span>&nbsp;<span class="ident" id="3317435">addr</span>&nbsp;<span class="ident" id="3317440">Addr</span><span class="op" id="3317444">)</span>&nbsp;<span class="op" id="3317446">(</span><span class="ident" id="3317447">n</span>&nbsp;<span class="builtintype" id="3317449">int</span><span class="op" id="3317452">,</span>&nbsp;<span class="ident" id="3317454">err</span>&nbsp;<span class="builtintype" id="3317458">error</span><span class="op" id="3317463">)</span>&nbsp;<span class="op" id="3317465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3317468">if</span>&nbsp;<span class="op" id="3317471">!</span><span class="ident" id="3317472">c</span><span class="op" id="3317473">.</span><span class="ident" id="3317474">ok</span><span class="op" id="3317476">(</span><span class="op" id="3317477">)</span>&nbsp;<span class="op" id="3317479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3317483">return</span>&nbsp;<span class="num" id="3317490">0</span><span class="op" id="3317491">,</span>&nbsp;<span class="ident" id="3317493">syscall</span><span class="op" id="3317500">.</span><span class="ident" id="3317501">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3317509">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3317512">a</span><span class="op" id="3317513">,</span>&nbsp;<span class="ident" id="3317515">ok</span>&nbsp;<span class="op" id="3317518">:=</span>&nbsp;<span class="ident" id="3317521">addr</span><span class="op" id="3317525">.</span><span class="op" id="3317526">(</span><span class="op" id="3317527">*</span><span class="ident" id="3317528">UnixAddr</span><span class="op" id="3317536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3317539">if</span>&nbsp;<span class="op" id="3317542">!</span><span class="ident" id="3317543">ok</span>&nbsp;<span class="op" id="3317546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3317550">return</span>&nbsp;<span class="num" id="3317557">0</span><span class="op" id="3317558">,</span>&nbsp;<span class="op" id="3317560">&amp;</span><span class="ident" id="3317561">OpError</span><span class="op" id="3317568">{</span><span class="string" id="3317569">&#34;write&#34;</span><span class="op" id="3317576">,</span>&nbsp;<span class="ident" id="3317578">c</span><span class="op" id="3317579">.</span><span class="ident" id="3317580">fd</span><span class="op" id="3317582">.</span><span class="ident" id="3317583">net</span><span class="op" id="3317586">,</span>&nbsp;<span class="ident" id="3317588">addr</span><span class="op" id="3317592">,</span>&nbsp;<span class="ident" id="3317594">syscall</span><span class="op" id="3317601">.</span><span class="ident" id="3317602">EINVAL</span><span class="op" id="3317608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3317611">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3317614">return</span>&nbsp;<span class="ident" id="3317621">c</span><span class="op" id="3317622">.</span><span class="ident" id="3317623">WriteToUnix</span><span class="op" id="3317634">(</span><span class="ident" id="3317635">b</span><span class="op" id="3317636">,</span>&nbsp;<span class="ident" id="3317638">a</span><span class="op" id="3317639">)</span><br>
<span class="lineno">190</span><span class="op" id="3317641">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3317644">//&nbsp;WriteMsgUnix&nbsp;writes&nbsp;a&nbsp;packet&nbsp;to&nbsp;addr&nbsp;via&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload</span><br>
<span class="lineno"></span><span class="comment" id="3317711">//&nbsp;from&nbsp;b&nbsp;and&nbsp;the&nbsp;associated&nbsp;out-of-band&nbsp;data&nbsp;from&nbsp;oob.&nbsp;&nbsp;It&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="3317779">//&nbsp;the&nbsp;number&nbsp;of&nbsp;payload&nbsp;and&nbsp;out-of-band&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno">195</span><span class="keyword" id="3317835">func</span>&nbsp;<span class="op" id="3317840">(</span><span class="ident" id="3317841">c</span>&nbsp;<span class="op" id="3317843">*</span><span class="ident" id="3317844">UnixConn</span><span class="op" id="3317852">)</span>&nbsp;<span class="ident" id="3317854">WriteMsgUnix</span><span class="op" id="3317866">(</span><span class="ident" id="3317867">b</span><span class="op" id="3317868">,</span>&nbsp;<span class="ident" id="3317870">oob</span>&nbsp;<span class="op" id="3317874">[</span><span class="op" id="3317875">]</span><span class="builtintype" id="3317876">byte</span><span class="op" id="3317880">,</span>&nbsp;<span class="ident" id="3317882">addr</span>&nbsp;<span class="op" id="3317887">*</span><span class="ident" id="3317888">UnixAddr</span><span class="op" id="3317896">)</span>&nbsp;<span class="op" id="3317898">(</span><span class="ident" id="3317899">n</span><span class="op" id="3317900">,</span>&nbsp;<span class="ident" id="3317902">oobn</span>&nbsp;<span class="builtintype" id="3317907">int</span><span class="op" id="3317910">,</span>&nbsp;<span class="ident" id="3317912">err</span>&nbsp;<span class="builtintype" id="3317916">error</span><span class="op" id="3317921">)</span>&nbsp;<span class="op" id="3317923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3317926">if</span>&nbsp;<span class="op" id="3317929">!</span><span class="ident" id="3317930">c</span><span class="op" id="3317931">.</span><span class="ident" id="3317932">ok</span><span class="op" id="3317934">(</span><span class="op" id="3317935">)</span>&nbsp;<span class="op" id="3317937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3317941">return</span>&nbsp;<span class="num" id="3317948">0</span><span class="op" id="3317949">,</span>&nbsp;<span class="num" id="3317951">0</span><span class="op" id="3317952">,</span>&nbsp;<span class="ident" id="3317954">syscall</span><span class="op" id="3317961">.</span><span class="ident" id="3317962">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3317970">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3317973">if</span>&nbsp;<span class="ident" id="3317976">c</span><span class="op" id="3317977">.</span><span class="ident" id="3317978">fd</span><span class="op" id="3317980">.</span><span class="ident" id="3317981">sotype</span>&nbsp;<span class="op" id="3317988">==</span>&nbsp;<span class="ident" id="3317991">syscall</span><span class="op" id="3317998">.</span><span class="ident" id="3317999">SOCK_DGRAM</span>&nbsp;<span class="op" id="3318010">&amp;&amp;</span>&nbsp;<span class="ident" id="3318013">c</span><span class="op" id="3318014">.</span><span class="ident" id="3318015">fd</span><span class="op" id="3318017">.</span><span class="ident" id="3318018">isConnected</span>&nbsp;<span class="op" id="3318030">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318034">return</span>&nbsp;<span class="num" id="3318041">0</span><span class="op" id="3318042">,</span>&nbsp;<span class="num" id="3318044">0</span><span class="op" id="3318045">,</span>&nbsp;<span class="op" id="3318047">&amp;</span><span class="ident" id="3318048">OpError</span><span class="op" id="3318055">{</span><span class="ident" id="3318056">Op</span><span class="op" id="3318058">:</span>&nbsp;<span class="string" id="3318060">&#34;write&#34;</span><span class="op" id="3318067">,</span>&nbsp;<span class="ident" id="3318069">Net</span><span class="op" id="3318072">:</span>&nbsp;<span class="ident" id="3318074">c</span><span class="op" id="3318075">.</span><span class="ident" id="3318076">fd</span><span class="op" id="3318078">.</span><span class="ident" id="3318079">net</span><span class="op" id="3318082">,</span>&nbsp;<span class="ident" id="3318084">Addr</span><span class="op" id="3318088">:</span>&nbsp;<span class="ident" id="3318090">addr</span><span class="op" id="3318094">,</span>&nbsp;<span class="ident" id="3318096">Err</span><span class="op" id="3318099">:</span>&nbsp;<span class="ident" id="3318101">ErrWriteToConnected</span><span class="op" id="3318120">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3318123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318126">if</span>&nbsp;<span class="ident" id="3318129">addr</span>&nbsp;<span class="op" id="3318134">!=</span>&nbsp;<span class="ident" id="3318137">nil</span>&nbsp;<span class="op" id="3318141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318145">if</span>&nbsp;<span class="ident" id="3318148">addr</span><span class="op" id="3318152">.</span><span class="ident" id="3318153">Net</span>&nbsp;<span class="op" id="3318157">!=</span>&nbsp;<span class="ident" id="3318160">sotypeToNet</span><span class="op" id="3318171">(</span><span class="ident" id="3318172">c</span><span class="op" id="3318173">.</span><span class="ident" id="3318174">fd</span><span class="op" id="3318176">.</span><span class="ident" id="3318177">sotype</span><span class="op" id="3318183">)</span>&nbsp;<span class="op" id="3318185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318190">return</span>&nbsp;<span class="num" id="3318197">0</span><span class="op" id="3318198">,</span>&nbsp;<span class="num" id="3318200">0</span><span class="op" id="3318201">,</span>&nbsp;<span class="ident" id="3318203">syscall</span><span class="op" id="3318210">.</span><span class="ident" id="3318211">EAFNOSUPPORT</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3318226">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3318230">sa</span>&nbsp;<span class="op" id="3318233">:=</span>&nbsp;<span class="op" id="3318236">&amp;</span><span class="ident" id="3318237">syscall</span><span class="op" id="3318244">.</span><span class="ident" id="3318245">SockaddrUnix</span><span class="op" id="3318257">{</span><span class="ident" id="3318258">Name</span><span class="op" id="3318262">:</span>&nbsp;<span class="ident" id="3318264">addr</span><span class="op" id="3318268">.</span><span class="ident" id="3318269">Name</span><span class="op" id="3318273">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318277">return</span>&nbsp;<span class="ident" id="3318284">c</span><span class="op" id="3318285">.</span><span class="ident" id="3318286">fd</span><span class="op" id="3318288">.</span><span class="ident" id="3318289">writeMsg</span><span class="op" id="3318297">(</span><span class="ident" id="3318298">b</span><span class="op" id="3318299">,</span>&nbsp;<span class="ident" id="3318301">oob</span><span class="op" id="3318304">,</span>&nbsp;<span class="ident" id="3318306">sa</span><span class="op" id="3318308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3318311">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318314">return</span>&nbsp;<span class="ident" id="3318321">c</span><span class="op" id="3318322">.</span><span class="ident" id="3318323">fd</span><span class="op" id="3318325">.</span><span class="ident" id="3318326">writeMsg</span><span class="op" id="3318334">(</span><span class="ident" id="3318335">b</span><span class="op" id="3318336">,</span>&nbsp;<span class="ident" id="3318338">oob</span><span class="op" id="3318341">,</span>&nbsp;<span class="ident" id="3318343">nil</span><span class="op" id="3318346">)</span><br>
<span class="lineno">210</span><span class="op" id="3318348">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3318351">//&nbsp;CloseRead&nbsp;shuts&nbsp;down&nbsp;the&nbsp;reading&nbsp;side&nbsp;of&nbsp;the&nbsp;Unix&nbsp;domain&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="3318423">//&nbsp;Most&nbsp;callers&nbsp;should&nbsp;just&nbsp;use&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="3318462">func</span>&nbsp;<span class="op" id="3318467">(</span><span class="ident" id="3318468">c</span>&nbsp;<span class="op" id="3318470">*</span><span class="ident" id="3318471">UnixConn</span><span class="op" id="3318479">)</span>&nbsp;<span class="ident" id="3318481">CloseRead</span><span class="op" id="3318490">(</span><span class="op" id="3318491">)</span>&nbsp;<span class="builtintype" id="3318493">error</span>&nbsp;<span class="op" id="3318499">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318502">if</span>&nbsp;<span class="op" id="3318505">!</span><span class="ident" id="3318506">c</span><span class="op" id="3318507">.</span><span class="ident" id="3318508">ok</span><span class="op" id="3318510">(</span><span class="op" id="3318511">)</span>&nbsp;<span class="op" id="3318513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318517">return</span>&nbsp;<span class="ident" id="3318524">syscall</span><span class="op" id="3318531">.</span><span class="ident" id="3318532">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3318540">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318543">return</span>&nbsp;<span class="ident" id="3318550">c</span><span class="op" id="3318551">.</span><span class="ident" id="3318552">fd</span><span class="op" id="3318554">.</span><span class="ident" id="3318555">closeRead</span><span class="op" id="3318564">(</span><span class="op" id="3318565">)</span><br>
<span class="lineno"></span><span class="op" id="3318567">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="3318570">//&nbsp;CloseWrite&nbsp;shuts&nbsp;down&nbsp;the&nbsp;writing&nbsp;side&nbsp;of&nbsp;the&nbsp;Unix&nbsp;domain&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="3318643">//&nbsp;Most&nbsp;callers&nbsp;should&nbsp;just&nbsp;use&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="3318682">func</span>&nbsp;<span class="op" id="3318687">(</span><span class="ident" id="3318688">c</span>&nbsp;<span class="op" id="3318690">*</span><span class="ident" id="3318691">UnixConn</span><span class="op" id="3318699">)</span>&nbsp;<span class="ident" id="3318701">CloseWrite</span><span class="op" id="3318711">(</span><span class="op" id="3318712">)</span>&nbsp;<span class="builtintype" id="3318714">error</span>&nbsp;<span class="op" id="3318720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318723">if</span>&nbsp;<span class="op" id="3318726">!</span><span class="ident" id="3318727">c</span><span class="op" id="3318728">.</span><span class="ident" id="3318729">ok</span><span class="op" id="3318731">(</span><span class="op" id="3318732">)</span>&nbsp;<span class="op" id="3318734">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318738">return</span>&nbsp;<span class="ident" id="3318745">syscall</span><span class="op" id="3318752">.</span><span class="ident" id="3318753">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3318761">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318764">return</span>&nbsp;<span class="ident" id="3318771">c</span><span class="op" id="3318772">.</span><span class="ident" id="3318773">fd</span><span class="op" id="3318775">.</span><span class="ident" id="3318776">closeWrite</span><span class="op" id="3318786">(</span><span class="op" id="3318787">)</span><br>
<span class="lineno"></span><span class="op" id="3318789">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="comment" id="3318792">//&nbsp;DialUnix&nbsp;connects&nbsp;to&nbsp;the&nbsp;remote&nbsp;address&nbsp;raddr&nbsp;on&nbsp;the&nbsp;network&nbsp;net,</span><br>
<span class="lineno"></span><span class="comment" id="3318861">//&nbsp;which&nbsp;must&nbsp;be&nbsp;&#34;unix&#34;,&nbsp;&#34;unixgram&#34;&nbsp;or&nbsp;&#34;unixpacket&#34;.&nbsp;&nbsp;If&nbsp;laddr&nbsp;is&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="3318931">//&nbsp;nil,&nbsp;it&nbsp;is&nbsp;used&nbsp;as&nbsp;the&nbsp;local&nbsp;address&nbsp;for&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="3318991">func</span>&nbsp;<span class="ident" id="3318996">DialUnix</span><span class="op" id="3319004">(</span><span class="ident" id="3319005">net</span>&nbsp;<span class="builtintype" id="3319009">string</span><span class="op" id="3319015">,</span>&nbsp;<span class="ident" id="3319017">laddr</span><span class="op" id="3319022">,</span>&nbsp;<span class="ident" id="3319024">raddr</span>&nbsp;<span class="op" id="3319030">*</span><span class="ident" id="3319031">UnixAddr</span><span class="op" id="3319039">)</span>&nbsp;<span class="op" id="3319041">(</span><span class="op" id="3319042">*</span><span class="ident" id="3319043">UnixConn</span><span class="op" id="3319051">,</span>&nbsp;<span class="builtintype" id="3319053">error</span><span class="op" id="3319058">)</span>&nbsp;<span class="op" id="3319060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3319063">switch</span>&nbsp;<span class="ident" id="3319070">net</span>&nbsp;<span class="op" id="3319074">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3319077">case</span>&nbsp;<span class="string" id="3319082">&#34;unix&#34;</span><span class="op" id="3319088">,</span>&nbsp;<span class="string" id="3319090">&#34;unixgram&#34;</span><span class="op" id="3319100">,</span>&nbsp;<span class="string" id="3319102">&#34;unixpacket&#34;</span><span class="op" id="3319114">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3319117">default</span><span class="op" id="3319124">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3319128">return</span>&nbsp;<span class="ident" id="3319135">nil</span><span class="op" id="3319138">,</span>&nbsp;<span class="op" id="3319140">&amp;</span><span class="ident" id="3319141">OpError</span><span class="op" id="3319148">{</span><span class="ident" id="3319149">Op</span><span class="op" id="3319151">:</span>&nbsp;<span class="string" id="3319153">&#34;dial&#34;</span><span class="op" id="3319159">,</span>&nbsp;<span class="ident" id="3319161">Net</span><span class="op" id="3319164">:</span>&nbsp;<span class="ident" id="3319166">net</span><span class="op" id="3319169">,</span>&nbsp;<span class="ident" id="3319171">Addr</span><span class="op" id="3319175">:</span>&nbsp;<span class="ident" id="3319177">raddr</span><span class="op" id="3319182">,</span>&nbsp;<span class="ident" id="3319184">Err</span><span class="op" id="3319187">:</span>&nbsp;<span class="ident" id="3319189">UnknownNetworkError</span><span class="op" id="3319208">(</span><span class="ident" id="3319209">net</span><span class="op" id="3319212">)</span><span class="op" id="3319213">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3319216">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3319219">return</span>&nbsp;<span class="ident" id="3319226">dialUnix</span><span class="op" id="3319234">(</span><span class="ident" id="3319235">net</span><span class="op" id="3319238">,</span>&nbsp;<span class="ident" id="3319240">laddr</span><span class="op" id="3319245">,</span>&nbsp;<span class="ident" id="3319247">raddr</span><span class="op" id="3319252">,</span>&nbsp;<span class="ident" id="3319254">noDeadline</span><span class="op" id="3319264">)</span><br>
<span class="lineno">240</span><span class="op" id="3319266">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3319269">func</span>&nbsp;<span class="ident" id="3319274">dialUnix</span><span class="op" id="3319282">(</span><span class="ident" id="3319283">net</span>&nbsp;<span class="builtintype" id="3319287">string</span><span class="op" id="3319293">,</span>&nbsp;<span class="ident" id="3319295">laddr</span><span class="op" id="3319300">,</span>&nbsp;<span class="ident" id="3319302">raddr</span>&nbsp;<span class="op" id="3319308">*</span><span class="ident" id="3319309">UnixAddr</span><span class="op" id="3319317">,</span>&nbsp;<span class="ident" id="3319319">deadline</span>&nbsp;<span class="ident" id="3319328">time</span><span class="op" id="3319332">.</span><span class="ident" id="3319333">Time</span><span class="op" id="3319337">)</span>&nbsp;<span class="op" id="3319339">(</span><span class="op" id="3319340">*</span><span class="ident" id="3319341">UnixConn</span><span class="op" id="3319349">,</span>&nbsp;<span class="builtintype" id="3319351">error</span><span class="op" id="3319356">)</span>&nbsp;<span class="op" id="3319358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3319361">fd</span><span class="op" id="3319363">,</span>&nbsp;<span class="ident" id="3319365">err</span>&nbsp;<span class="op" id="3319369">:=</span>&nbsp;<span class="ident" id="3319372">unixSocket</span><span class="op" id="3319382">(</span><span class="ident" id="3319383">net</span><span class="op" id="3319386">,</span>&nbsp;<span class="ident" id="3319388">laddr</span><span class="op" id="3319393">,</span>&nbsp;<span class="ident" id="3319395">raddr</span><span class="op" id="3319400">,</span>&nbsp;<span class="string" id="3319402">&#34;dial&#34;</span><span class="op" id="3319408">,</span>&nbsp;<span class="ident" id="3319410">deadline</span><span class="op" id="3319418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3319421">if</span>&nbsp;<span class="ident" id="3319424">err</span>&nbsp;<span class="op" id="3319428">!=</span>&nbsp;<span class="ident" id="3319431">nil</span>&nbsp;<span class="op" id="3319435">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3319439">return</span>&nbsp;<span class="ident" id="3319446">nil</span><span class="op" id="3319449">,</span>&nbsp;<span class="op" id="3319451">&amp;</span><span class="ident" id="3319452">OpError</span><span class="op" id="3319459">{</span><span class="ident" id="3319460">Op</span><span class="op" id="3319462">:</span>&nbsp;<span class="string" id="3319464">&#34;dial&#34;</span><span class="op" id="3319470">,</span>&nbsp;<span class="ident" id="3319472">Net</span><span class="op" id="3319475">:</span>&nbsp;<span class="ident" id="3319477">net</span><span class="op" id="3319480">,</span>&nbsp;<span class="ident" id="3319482">Addr</span><span class="op" id="3319486">:</span>&nbsp;<span class="ident" id="3319488">raddr</span><span class="op" id="3319493">,</span>&nbsp;<span class="ident" id="3319495">Err</span><span class="op" id="3319498">:</span>&nbsp;<span class="ident" id="3319500">err</span><span class="op" id="3319503">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3319506">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3319509">return</span>&nbsp;<span class="ident" id="3319516">newUnixConn</span><span class="op" id="3319527">(</span><span class="ident" id="3319528">fd</span><span class="op" id="3319530">)</span><span class="op" id="3319531">,</span>&nbsp;<span class="ident" id="3319533">nil</span><br>
<span class="lineno"></span><span class="op" id="3319537">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="comment" id="3319540">//&nbsp;UnixListener&nbsp;is&nbsp;a&nbsp;Unix&nbsp;domain&nbsp;socket&nbsp;listener.&nbsp;&nbsp;Clients&nbsp;should</span><br>
<span class="lineno"></span><span class="comment" id="3319606">//&nbsp;typically&nbsp;use&nbsp;variables&nbsp;of&nbsp;type&nbsp;Listener&nbsp;instead&nbsp;of&nbsp;assuming&nbsp;Unix</span><br>
<span class="lineno"></span><span class="comment" id="3319675">//&nbsp;domain&nbsp;sockets.</span><br>
<span class="lineno"></span><span class="keyword" id="3319694">type</span>&nbsp;<span class="ident" id="3319699">UnixListener</span>&nbsp;<span class="keyword" id="3319712">struct</span>&nbsp;<span class="op" id="3319719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3319722">fd</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3319727">*</span><span class="ident" id="3319728">netFD</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3319735">path</span>&nbsp;<span class="builtintype" id="3319740">string</span><br>
<span class="lineno"></span><span class="op" id="3319747">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3319750">//&nbsp;ListenUnix&nbsp;announces&nbsp;on&nbsp;the&nbsp;Unix&nbsp;domain&nbsp;socket&nbsp;laddr&nbsp;and&nbsp;returns&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3319820">//&nbsp;Unix&nbsp;listener.&nbsp;&nbsp;The&nbsp;network&nbsp;net&nbsp;must&nbsp;be&nbsp;&#34;unix&#34;&nbsp;or&nbsp;&#34;unixpacket&#34;.</span><br>
<span class="lineno">260</span><span class="keyword" id="3319887">func</span>&nbsp;<span class="ident" id="3319892">ListenUnix</span><span class="op" id="3319902">(</span><span class="ident" id="3319903">net</span>&nbsp;<span class="builtintype" id="3319907">string</span><span class="op" id="3319913">,</span>&nbsp;<span class="ident" id="3319915">laddr</span>&nbsp;<span class="op" id="3319921">*</span><span class="ident" id="3319922">UnixAddr</span><span class="op" id="3319930">)</span>&nbsp;<span class="op" id="3319932">(</span><span class="op" id="3319933">*</span><span class="ident" id="3319934">UnixListener</span><span class="op" id="3319946">,</span>&nbsp;<span class="builtintype" id="3319948">error</span><span class="op" id="3319953">)</span>&nbsp;<span class="op" id="3319955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3319958">switch</span>&nbsp;<span class="ident" id="3319965">net</span>&nbsp;<span class="op" id="3319969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3319972">case</span>&nbsp;<span class="string" id="3319977">&#34;unix&#34;</span><span class="op" id="3319983">,</span>&nbsp;<span class="string" id="3319985">&#34;unixpacket&#34;</span><span class="op" id="3319997">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3320000">default</span><span class="op" id="3320007">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3320011">return</span>&nbsp;<span class="ident" id="3320018">nil</span><span class="op" id="3320021">,</span>&nbsp;<span class="op" id="3320023">&amp;</span><span class="ident" id="3320024">OpError</span><span class="op" id="3320031">{</span><span class="ident" id="3320032">Op</span><span class="op" id="3320034">:</span>&nbsp;<span class="string" id="3320036">&#34;listen&#34;</span><span class="op" id="3320044">,</span>&nbsp;<span class="ident" id="3320046">Net</span><span class="op" id="3320049">:</span>&nbsp;<span class="ident" id="3320051">net</span><span class="op" id="3320054">,</span>&nbsp;<span class="ident" id="3320056">Addr</span><span class="op" id="3320060">:</span>&nbsp;<span class="ident" id="3320062">laddr</span><span class="op" id="3320067">,</span>&nbsp;<span class="ident" id="3320069">Err</span><span class="op" id="3320072">:</span>&nbsp;<span class="ident" id="3320074">UnknownNetworkError</span><span class="op" id="3320093">(</span><span class="ident" id="3320094">net</span><span class="op" id="3320097">)</span><span class="op" id="3320098">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3320101">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3320104">if</span>&nbsp;<span class="ident" id="3320107">laddr</span>&nbsp;<span class="op" id="3320113">==</span>&nbsp;<span class="ident" id="3320116">nil</span>&nbsp;<span class="op" id="3320120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3320124">return</span>&nbsp;<span class="ident" id="3320131">nil</span><span class="op" id="3320134">,</span>&nbsp;<span class="op" id="3320136">&amp;</span><span class="ident" id="3320137">OpError</span><span class="op" id="3320144">{</span><span class="ident" id="3320145">Op</span><span class="op" id="3320147">:</span>&nbsp;<span class="string" id="3320149">&#34;listen&#34;</span><span class="op" id="3320157">,</span>&nbsp;<span class="ident" id="3320159">Net</span><span class="op" id="3320162">:</span>&nbsp;<span class="ident" id="3320164">net</span><span class="op" id="3320167">,</span>&nbsp;<span class="ident" id="3320169">Addr</span><span class="op" id="3320173">:</span>&nbsp;<span class="ident" id="3320175">nil</span><span class="op" id="3320178">,</span>&nbsp;<span class="ident" id="3320180">Err</span><span class="op" id="3320183">:</span>&nbsp;<span class="ident" id="3320185">errMissingAddress</span><span class="op" id="3320202">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3320205">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3320208">fd</span><span class="op" id="3320210">,</span>&nbsp;<span class="ident" id="3320212">err</span>&nbsp;<span class="op" id="3320216">:=</span>&nbsp;<span class="ident" id="3320219">unixSocket</span><span class="op" id="3320229">(</span><span class="ident" id="3320230">net</span><span class="op" id="3320233">,</span>&nbsp;<span class="ident" id="3320235">laddr</span><span class="op" id="3320240">,</span>&nbsp;<span class="ident" id="3320242">nil</span><span class="op" id="3320245">,</span>&nbsp;<span class="string" id="3320247">&#34;listen&#34;</span><span class="op" id="3320255">,</span>&nbsp;<span class="ident" id="3320257">noDeadline</span><span class="op" id="3320267">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3320270">if</span>&nbsp;<span class="ident" id="3320273">err</span>&nbsp;<span class="op" id="3320277">!=</span>&nbsp;<span class="ident" id="3320280">nil</span>&nbsp;<span class="op" id="3320284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3320288">return</span>&nbsp;<span class="ident" id="3320295">nil</span><span class="op" id="3320298">,</span>&nbsp;<span class="op" id="3320300">&amp;</span><span class="ident" id="3320301">OpError</span><span class="op" id="3320308">{</span><span class="ident" id="3320309">Op</span><span class="op" id="3320311">:</span>&nbsp;<span class="string" id="3320313">&#34;listen&#34;</span><span class="op" id="3320321">,</span>&nbsp;<span class="ident" id="3320323">Net</span><span class="op" id="3320326">:</span>&nbsp;<span class="ident" id="3320328">net</span><span class="op" id="3320331">,</span>&nbsp;<span class="ident" id="3320333">Addr</span><span class="op" id="3320337">:</span>&nbsp;<span class="ident" id="3320339">laddr</span><span class="op" id="3320344">,</span>&nbsp;<span class="ident" id="3320346">Err</span><span class="op" id="3320349">:</span>&nbsp;<span class="ident" id="3320351">err</span><span class="op" id="3320354">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3320357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3320360">return</span>&nbsp;<span class="op" id="3320367">&amp;</span><span class="ident" id="3320368">UnixListener</span><span class="op" id="3320380">{</span><span class="ident" id="3320381">fd</span><span class="op" id="3320383">,</span>&nbsp;<span class="ident" id="3320385">fd</span><span class="op" id="3320387">.</span><span class="ident" id="3320388">laddr</span><span class="op" id="3320393">.</span><span class="ident" id="3320394">String</span><span class="op" id="3320400">(</span><span class="op" id="3320401">)</span><span class="op" id="3320402">}</span><span class="op" id="3320403">,</span>&nbsp;<span class="ident" id="3320405">nil</span><br>
<span class="lineno"></span><span class="op" id="3320409">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span><span class="comment" id="3320412">//&nbsp;AcceptUnix&nbsp;accepts&nbsp;the&nbsp;next&nbsp;incoming&nbsp;call&nbsp;and&nbsp;returns&nbsp;the&nbsp;new</span><br>
<span class="lineno"></span><span class="comment" id="3320477">//&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="3320492">func</span>&nbsp;<span class="op" id="3320497">(</span><span class="ident" id="3320498">l</span>&nbsp;<span class="op" id="3320500">*</span><span class="ident" id="3320501">UnixListener</span><span class="op" id="3320513">)</span>&nbsp;<span class="ident" id="3320515">AcceptUnix</span><span class="op" id="3320525">(</span><span class="op" id="3320526">)</span>&nbsp;<span class="op" id="3320528">(</span><span class="op" id="3320529">*</span><span class="ident" id="3320530">UnixConn</span><span class="op" id="3320538">,</span>&nbsp;<span class="builtintype" id="3320540">error</span><span class="op" id="3320545">)</span>&nbsp;<span class="op" id="3320547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3320550">if</span>&nbsp;<span class="ident" id="3320553">l</span>&nbsp;<span class="op" id="3320555">==</span>&nbsp;<span class="ident" id="3320558">nil</span>&nbsp;<span class="op" id="3320562">||</span>&nbsp;<span class="ident" id="3320565">l</span><span class="op" id="3320566">.</span><span class="ident" id="3320567">fd</span>&nbsp;<span class="op" id="3320570">==</span>&nbsp;<span class="ident" id="3320573">nil</span>&nbsp;<span class="op" id="3320577">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3320581">return</span>&nbsp;<span class="ident" id="3320588">nil</span><span class="op" id="3320591">,</span>&nbsp;<span class="ident" id="3320593">syscall</span><span class="op" id="3320600">.</span><span class="ident" id="3320601">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3320609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3320612">fd</span><span class="op" id="3320614">,</span>&nbsp;<span class="ident" id="3320616">err</span>&nbsp;<span class="op" id="3320620">:=</span>&nbsp;<span class="ident" id="3320623">l</span><span class="op" id="3320624">.</span><span class="ident" id="3320625">fd</span><span class="op" id="3320627">.</span><span class="ident" id="3320628">accept</span><span class="op" id="3320634">(</span><span class="op" id="3320635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3320638">if</span>&nbsp;<span class="ident" id="3320641">err</span>&nbsp;<span class="op" id="3320645">!=</span>&nbsp;<span class="ident" id="3320648">nil</span>&nbsp;<span class="op" id="3320652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3320656">return</span>&nbsp;<span class="ident" id="3320663">nil</span><span class="op" id="3320666">,</span>&nbsp;<span class="ident" id="3320668">err</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3320673">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3320676">c</span>&nbsp;<span class="op" id="3320678">:=</span>&nbsp;<span class="ident" id="3320681">newUnixConn</span><span class="op" id="3320692">(</span><span class="ident" id="3320693">fd</span><span class="op" id="3320695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3320698">return</span>&nbsp;<span class="ident" id="3320705">c</span><span class="op" id="3320706">,</span>&nbsp;<span class="ident" id="3320708">nil</span><br>
<span class="lineno"></span><span class="op" id="3320712">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">290</span><span class="comment" id="3320715">//&nbsp;Accept&nbsp;implements&nbsp;the&nbsp;Accept&nbsp;method&nbsp;in&nbsp;the&nbsp;Listener&nbsp;interface;&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="3320784">//&nbsp;waits&nbsp;for&nbsp;the&nbsp;next&nbsp;call&nbsp;and&nbsp;returns&nbsp;a&nbsp;generic&nbsp;Conn.</span><br>
<span class="lineno"></span><span class="keyword" id="3320839">func</span>&nbsp;<span class="op" id="3320844">(</span><span class="ident" id="3320845">l</span>&nbsp;<span class="op" id="3320847">*</span><span class="ident" id="3320848">UnixListener</span><span class="op" id="3320860">)</span>&nbsp;<span class="ident" id="3320862">Accept</span><span class="op" id="3320868">(</span><span class="op" id="3320869">)</span>&nbsp;<span class="op" id="3320871">(</span><span class="ident" id="3320872">c</span>&nbsp;<span class="ident" id="3320874">Conn</span><span class="op" id="3320878">,</span>&nbsp;<span class="ident" id="3320880">err</span>&nbsp;<span class="builtintype" id="3320884">error</span><span class="op" id="3320889">)</span>&nbsp;<span class="op" id="3320891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3320894">c1</span><span class="op" id="3320896">,</span>&nbsp;<span class="ident" id="3320898">err</span>&nbsp;<span class="op" id="3320902">:=</span>&nbsp;<span class="ident" id="3320905">l</span><span class="op" id="3320906">.</span><span class="ident" id="3320907">AcceptUnix</span><span class="op" id="3320917">(</span><span class="op" id="3320918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3320921">if</span>&nbsp;<span class="ident" id="3320924">err</span>&nbsp;<span class="op" id="3320928">!=</span>&nbsp;<span class="ident" id="3320931">nil</span>&nbsp;<span class="op" id="3320935">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3320939">return</span>&nbsp;<span class="ident" id="3320946">nil</span><span class="op" id="3320949">,</span>&nbsp;<span class="ident" id="3320951">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3320956">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3320959">return</span>&nbsp;<span class="ident" id="3320966">c1</span><span class="op" id="3320968">,</span>&nbsp;<span class="ident" id="3320970">nil</span><br>
<span class="lineno"></span><span class="op" id="3320974">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span><span class="comment" id="3320977">//&nbsp;Close&nbsp;stops&nbsp;listening&nbsp;on&nbsp;the&nbsp;Unix&nbsp;address.&nbsp;&nbsp;Already&nbsp;accepted</span><br>
<span class="lineno"></span><span class="comment" id="3321041">//&nbsp;connections&nbsp;are&nbsp;not&nbsp;closed.</span><br>
<span class="lineno"></span><span class="keyword" id="3321072">func</span>&nbsp;<span class="op" id="3321077">(</span><span class="ident" id="3321078">l</span>&nbsp;<span class="op" id="3321080">*</span><span class="ident" id="3321081">UnixListener</span><span class="op" id="3321093">)</span>&nbsp;<span class="ident" id="3321095">Close</span><span class="op" id="3321100">(</span><span class="op" id="3321101">)</span>&nbsp;<span class="builtintype" id="3321103">error</span>&nbsp;<span class="op" id="3321109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3321112">if</span>&nbsp;<span class="ident" id="3321115">l</span>&nbsp;<span class="op" id="3321117">==</span>&nbsp;<span class="ident" id="3321120">nil</span>&nbsp;<span class="op" id="3321124">||</span>&nbsp;<span class="ident" id="3321127">l</span><span class="op" id="3321128">.</span><span class="ident" id="3321129">fd</span>&nbsp;<span class="op" id="3321132">==</span>&nbsp;<span class="ident" id="3321135">nil</span>&nbsp;<span class="op" id="3321139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3321143">return</span>&nbsp;<span class="ident" id="3321150">syscall</span><span class="op" id="3321157">.</span><span class="ident" id="3321158">EINVAL</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3321166">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3321170">//&nbsp;The&nbsp;operating&nbsp;system&nbsp;doesn&#39;t&nbsp;clean&nbsp;up</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3321212">//&nbsp;the&nbsp;file&nbsp;that&nbsp;announcing&nbsp;created,&nbsp;so</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3321253">//&nbsp;we&nbsp;have&nbsp;to&nbsp;clean&nbsp;it&nbsp;up&nbsp;ourselves.</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3321291">//&nbsp;There&#39;s&nbsp;a&nbsp;race&nbsp;here--we&nbsp;can&#39;t&nbsp;know&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3321334">//&nbsp;sure&nbsp;whether&nbsp;someone&nbsp;else&nbsp;has&nbsp;come&nbsp;along</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3321379">//&nbsp;and&nbsp;replaced&nbsp;our&nbsp;socket&nbsp;name&nbsp;already--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3321422">//&nbsp;but&nbsp;this&nbsp;sequence&nbsp;(remove&nbsp;then&nbsp;close)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3321464">//&nbsp;is&nbsp;at&nbsp;least&nbsp;compatible&nbsp;with&nbsp;the&nbsp;auto-remove</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3321512">//&nbsp;sequence&nbsp;in&nbsp;ListenUnix.&nbsp;&nbsp;It&#39;s&nbsp;only&nbsp;non-Go</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3321558">//&nbsp;programs&nbsp;that&nbsp;can&nbsp;mess&nbsp;us&nbsp;up.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3321592">if</span>&nbsp;<span class="ident" id="3321595">l</span><span class="op" id="3321596">.</span><span class="ident" id="3321597">path</span><span class="op" id="3321601">[</span><span class="num" id="3321602">0</span><span class="op" id="3321603">]</span>&nbsp;<span class="op" id="3321605">!=</span>&nbsp;<span class="string" id="3321608">&#39;@&#39;</span>&nbsp;<span class="op" id="3321612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3321616">syscall</span><span class="op" id="3321623">.</span><span class="ident" id="3321624">Unlink</span><span class="op" id="3321630">(</span><span class="ident" id="3321631">l</span><span class="op" id="3321632">.</span><span class="ident" id="3321633">path</span><span class="op" id="3321637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3321640">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3321643">return</span>&nbsp;<span class="ident" id="3321650">l</span><span class="op" id="3321651">.</span><span class="ident" id="3321652">fd</span><span class="op" id="3321654">.</span><span class="ident" id="3321655">Close</span><span class="op" id="3321660">(</span><span class="op" id="3321661">)</span><br>
<span class="lineno"></span><span class="op" id="3321663">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3321666">//&nbsp;Addr&nbsp;returns&nbsp;the&nbsp;listener&#39;s&nbsp;network&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="3321714">func</span>&nbsp;<span class="op" id="3321719">(</span><span class="ident" id="3321720">l</span>&nbsp;<span class="op" id="3321722">*</span><span class="ident" id="3321723">UnixListener</span><span class="op" id="3321735">)</span>&nbsp;<span class="ident" id="3321737">Addr</span><span class="op" id="3321741">(</span><span class="op" id="3321742">)</span>&nbsp;<span class="ident" id="3321744">Addr</span>&nbsp;<span class="op" id="3321749">{</span>&nbsp;<span class="keyword" id="3321751">return</span>&nbsp;<span class="ident" id="3321758">l</span><span class="op" id="3321759">.</span><span class="ident" id="3321760">fd</span><span class="op" id="3321762">.</span><span class="ident" id="3321763">laddr</span>&nbsp;<span class="op" id="3321769">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="comment" id="3321772">//&nbsp;SetDeadline&nbsp;sets&nbsp;the&nbsp;deadline&nbsp;associated&nbsp;with&nbsp;the&nbsp;listener.</span><br>
<span class="lineno"></span><span class="comment" id="3321835">//&nbsp;A&nbsp;zero&nbsp;time&nbsp;value&nbsp;disables&nbsp;the&nbsp;deadline.</span><br>
<span class="lineno"></span><span class="keyword" id="3321879">func</span>&nbsp;<span class="op" id="3321884">(</span><span class="ident" id="3321885">l</span>&nbsp;<span class="op" id="3321887">*</span><span class="ident" id="3321888">UnixListener</span><span class="op" id="3321900">)</span>&nbsp;<span class="ident" id="3321902">SetDeadline</span><span class="op" id="3321913">(</span><span class="ident" id="3321914">t</span>&nbsp;<span class="ident" id="3321916">time</span><span class="op" id="3321920">.</span><span class="ident" id="3321921">Time</span><span class="op" id="3321925">)</span>&nbsp;<span class="op" id="3321927">(</span><span class="ident" id="3321928">err</span>&nbsp;<span class="builtintype" id="3321932">error</span><span class="op" id="3321937">)</span>&nbsp;<span class="op" id="3321939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3321942">if</span>&nbsp;<span class="ident" id="3321945">l</span>&nbsp;<span class="op" id="3321947">==</span>&nbsp;<span class="ident" id="3321950">nil</span>&nbsp;<span class="op" id="3321954">||</span>&nbsp;<span class="ident" id="3321957">l</span><span class="op" id="3321958">.</span><span class="ident" id="3321959">fd</span>&nbsp;<span class="op" id="3321962">==</span>&nbsp;<span class="ident" id="3321965">nil</span>&nbsp;<span class="op" id="3321969">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3321973">return</span>&nbsp;<span class="ident" id="3321980">syscall</span><span class="op" id="3321987">.</span><span class="ident" id="3321988">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3321996">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3321999">return</span>&nbsp;<span class="ident" id="3322006">l</span><span class="op" id="3322007">.</span><span class="ident" id="3322008">fd</span><span class="op" id="3322010">.</span><span class="ident" id="3322011">setDeadline</span><span class="op" id="3322022">(</span><span class="ident" id="3322023">t</span><span class="op" id="3322024">)</span><br>
<span class="lineno"></span><span class="op" id="3322026">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span><span class="comment" id="3322029">//&nbsp;File&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;underlying&nbsp;os.File,&nbsp;set&nbsp;to&nbsp;blocking</span><br>
<span class="lineno"></span><span class="comment" id="3322095">//&nbsp;mode.&nbsp;&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;close&nbsp;f&nbsp;when&nbsp;finished.</span><br>
<span class="lineno"></span><span class="comment" id="3322165">//&nbsp;Closing&nbsp;l&nbsp;does&nbsp;not&nbsp;affect&nbsp;f,&nbsp;and&nbsp;closing&nbsp;f&nbsp;does&nbsp;not&nbsp;affect&nbsp;l.</span><br>
<span class="lineno"></span><span class="comment" id="3322230">//</span><br>
<span class="lineno"></span><span class="comment" id="3322233">//&nbsp;The&nbsp;returned&nbsp;os.File&#39;s&nbsp;file&nbsp;descriptor&nbsp;is&nbsp;different&nbsp;from&nbsp;the</span><br>
<span class="lineno">340</span><span class="comment" id="3322297">//&nbsp;connection&#39;s.&nbsp;&nbsp;Attempting&nbsp;to&nbsp;change&nbsp;properties&nbsp;of&nbsp;the&nbsp;original</span><br>
<span class="lineno"></span><span class="comment" id="3322363">//&nbsp;using&nbsp;this&nbsp;duplicate&nbsp;may&nbsp;or&nbsp;may&nbsp;not&nbsp;have&nbsp;the&nbsp;desired&nbsp;effect.</span><br>
<span class="lineno"></span><span class="keyword" id="3322427">func</span>&nbsp;<span class="op" id="3322432">(</span><span class="ident" id="3322433">l</span>&nbsp;<span class="op" id="3322435">*</span><span class="ident" id="3322436">UnixListener</span><span class="op" id="3322448">)</span>&nbsp;<span class="ident" id="3322450">File</span><span class="op" id="3322454">(</span><span class="op" id="3322455">)</span>&nbsp;<span class="op" id="3322457">(</span><span class="ident" id="3322458">f</span>&nbsp;<span class="op" id="3322460">*</span><span class="ident" id="3322461">os</span><span class="op" id="3322463">.</span><span class="ident" id="3322464">File</span><span class="op" id="3322468">,</span>&nbsp;<span class="ident" id="3322470">err</span>&nbsp;<span class="builtintype" id="3322474">error</span><span class="op" id="3322479">)</span>&nbsp;<span class="op" id="3322481">{</span>&nbsp;<span class="keyword" id="3322483">return</span>&nbsp;<span class="ident" id="3322490">l</span><span class="op" id="3322491">.</span><span class="ident" id="3322492">fd</span><span class="op" id="3322494">.</span><span class="ident" id="3322495">dup</span><span class="op" id="3322498">(</span><span class="op" id="3322499">)</span>&nbsp;<span class="op" id="3322501">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3322504">//&nbsp;ListenUnixgram&nbsp;listens&nbsp;for&nbsp;incoming&nbsp;Unix&nbsp;datagram&nbsp;packets&nbsp;addressed</span><br>
<span class="lineno">345</span><span class="comment" id="3322575">//&nbsp;to&nbsp;the&nbsp;local&nbsp;address&nbsp;laddr.&nbsp;&nbsp;The&nbsp;network&nbsp;net&nbsp;must&nbsp;be&nbsp;&#34;unixgram&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3322643">//&nbsp;The&nbsp;returned&nbsp;connection&#39;s&nbsp;ReadFrom&nbsp;and&nbsp;WriteTo&nbsp;methods&nbsp;can&nbsp;be&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="3322713">//&nbsp;to&nbsp;receive&nbsp;and&nbsp;send&nbsp;packets&nbsp;with&nbsp;per-packet&nbsp;addressing.</span><br>
<span class="lineno"></span><span class="keyword" id="3322772">func</span>&nbsp;<span class="ident" id="3322777">ListenUnixgram</span><span class="op" id="3322791">(</span><span class="ident" id="3322792">net</span>&nbsp;<span class="builtintype" id="3322796">string</span><span class="op" id="3322802">,</span>&nbsp;<span class="ident" id="3322804">laddr</span>&nbsp;<span class="op" id="3322810">*</span><span class="ident" id="3322811">UnixAddr</span><span class="op" id="3322819">)</span>&nbsp;<span class="op" id="3322821">(</span><span class="op" id="3322822">*</span><span class="ident" id="3322823">UnixConn</span><span class="op" id="3322831">,</span>&nbsp;<span class="builtintype" id="3322833">error</span><span class="op" id="3322838">)</span>&nbsp;<span class="op" id="3322840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3322843">switch</span>&nbsp;<span class="ident" id="3322850">net</span>&nbsp;<span class="op" id="3322854">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3322857">case</span>&nbsp;<span class="string" id="3322862">&#34;unixgram&#34;</span><span class="op" id="3322872">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3322875">default</span><span class="op" id="3322882">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3322886">return</span>&nbsp;<span class="ident" id="3322893">nil</span><span class="op" id="3322896">,</span>&nbsp;<span class="op" id="3322898">&amp;</span><span class="ident" id="3322899">OpError</span><span class="op" id="3322906">{</span><span class="ident" id="3322907">Op</span><span class="op" id="3322909">:</span>&nbsp;<span class="string" id="3322911">&#34;listen&#34;</span><span class="op" id="3322919">,</span>&nbsp;<span class="ident" id="3322921">Net</span><span class="op" id="3322924">:</span>&nbsp;<span class="ident" id="3322926">net</span><span class="op" id="3322929">,</span>&nbsp;<span class="ident" id="3322931">Addr</span><span class="op" id="3322935">:</span>&nbsp;<span class="ident" id="3322937">laddr</span><span class="op" id="3322942">,</span>&nbsp;<span class="ident" id="3322944">Err</span><span class="op" id="3322947">:</span>&nbsp;<span class="ident" id="3322949">UnknownNetworkError</span><span class="op" id="3322968">(</span><span class="ident" id="3322969">net</span><span class="op" id="3322972">)</span><span class="op" id="3322973">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3322976">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3322979">if</span>&nbsp;<span class="ident" id="3322982">laddr</span>&nbsp;<span class="op" id="3322988">==</span>&nbsp;<span class="ident" id="3322991">nil</span>&nbsp;<span class="op" id="3322995">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3322999">return</span>&nbsp;<span class="ident" id="3323006">nil</span><span class="op" id="3323009">,</span>&nbsp;<span class="op" id="3323011">&amp;</span><span class="ident" id="3323012">OpError</span><span class="op" id="3323019">{</span><span class="ident" id="3323020">Op</span><span class="op" id="3323022">:</span>&nbsp;<span class="string" id="3323024">&#34;listen&#34;</span><span class="op" id="3323032">,</span>&nbsp;<span class="ident" id="3323034">Net</span><span class="op" id="3323037">:</span>&nbsp;<span class="ident" id="3323039">net</span><span class="op" id="3323042">,</span>&nbsp;<span class="ident" id="3323044">Addr</span><span class="op" id="3323048">:</span>&nbsp;<span class="ident" id="3323050">nil</span><span class="op" id="3323053">,</span>&nbsp;<span class="ident" id="3323055">Err</span><span class="op" id="3323058">:</span>&nbsp;<span class="ident" id="3323060">errMissingAddress</span><span class="op" id="3323077">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3323080">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3323083">fd</span><span class="op" id="3323085">,</span>&nbsp;<span class="ident" id="3323087">err</span>&nbsp;<span class="op" id="3323091">:=</span>&nbsp;<span class="ident" id="3323094">unixSocket</span><span class="op" id="3323104">(</span><span class="ident" id="3323105">net</span><span class="op" id="3323108">,</span>&nbsp;<span class="ident" id="3323110">laddr</span><span class="op" id="3323115">,</span>&nbsp;<span class="ident" id="3323117">nil</span><span class="op" id="3323120">,</span>&nbsp;<span class="string" id="3323122">&#34;listen&#34;</span><span class="op" id="3323130">,</span>&nbsp;<span class="ident" id="3323132">noDeadline</span><span class="op" id="3323142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3323145">if</span>&nbsp;<span class="ident" id="3323148">err</span>&nbsp;<span class="op" id="3323152">!=</span>&nbsp;<span class="ident" id="3323155">nil</span>&nbsp;<span class="op" id="3323159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3323163">return</span>&nbsp;<span class="ident" id="3323170">nil</span><span class="op" id="3323173">,</span>&nbsp;<span class="op" id="3323175">&amp;</span><span class="ident" id="3323176">OpError</span><span class="op" id="3323183">{</span><span class="ident" id="3323184">Op</span><span class="op" id="3323186">:</span>&nbsp;<span class="string" id="3323188">&#34;listen&#34;</span><span class="op" id="3323196">,</span>&nbsp;<span class="ident" id="3323198">Net</span><span class="op" id="3323201">:</span>&nbsp;<span class="ident" id="3323203">net</span><span class="op" id="3323206">,</span>&nbsp;<span class="ident" id="3323208">Addr</span><span class="op" id="3323212">:</span>&nbsp;<span class="ident" id="3323214">laddr</span><span class="op" id="3323219">,</span>&nbsp;<span class="ident" id="3323221">Err</span><span class="op" id="3323224">:</span>&nbsp;<span class="ident" id="3323226">err</span><span class="op" id="3323229">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3323232">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3323235">return</span>&nbsp;<span class="ident" id="3323242">newUnixConn</span><span class="op" id="3323253">(</span><span class="ident" id="3323254">fd</span><span class="op" id="3323256">)</span><span class="op" id="3323257">,</span>&nbsp;<span class="ident" id="3323259">nil</span><br>
<span class="lineno"></span><span class="op" id="3323263">}</span>
</div>
</body>
</html>
