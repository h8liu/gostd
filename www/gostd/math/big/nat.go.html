<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>math/big</h2>
<ul>
<li><a href="/gostd/math/big/arith.go.html">arith.go</a></li>
<li><a href="/gostd/math/big/arith_decl.go.html">arith_decl.go</a></li>
<li><a href="/gostd/math/big/arith_test.go.html">arith_test.go</a></li>
<li><a href="/gostd/math/big/calibrate_test.go.html">calibrate_test.go</a></li>
<li><a href="/gostd/math/big/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/math/big/gcd_test.go.html">gcd_test.go</a></li>
<li><a href="/gostd/math/big/hilbert_test.go.html">hilbert_test.go</a></li>
<li><a href="/gostd/math/big/int.go.html">int.go</a></li>
<li><a href="/gostd/math/big/int_test.go.html">int_test.go</a></li>
<li><a href="/gostd/math/big/nat.go.html">nat.go</a></li>
<li><a href="/gostd/math/big/nat_test.go.html">nat_test.go</a></li>
<li><a href="/gostd/math/big/rat.go.html">rat.go</a></li>
<li><a href="/gostd/math/big/rat_test.go.html">rat_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3757766">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3757821">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3757875">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3757926">//&nbsp;Package&nbsp;big&nbsp;implements&nbsp;multi-precision&nbsp;arithmetic&nbsp;(big&nbsp;numbers).</span><br>
<span class="lineno"></span><span class="comment" id="3757994">//&nbsp;The&nbsp;following&nbsp;numeric&nbsp;types&nbsp;are&nbsp;supported:</span><br>
<span class="lineno"></span><span class="comment" id="3758040">//</span><br>
<span class="lineno"></span><span class="comment" id="3758043">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;Int&nbsp;&nbsp;&nbsp;&nbspsigned&nbsp;integers</span><br>
<span class="lineno"></span><span class="comment" id="3758068">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;Rat&nbsp;&nbsp;&nbsp;&nbsprational&nbsp;numbers</span><br>
<span class="lineno">10</span><span class="comment" id="3758094">//</span><br>
<span class="lineno"></span><span class="comment" id="3758097">//&nbsp;Methods&nbsp;are&nbsp;typically&nbsp;of&nbsp;the&nbsp;form:</span><br>
<span class="lineno"></span><span class="comment" id="3758135">//</span><br>
<span class="lineno"></span><span class="comment" id="3758138">//&nbsp;&nbsp;&nbsp;&nbspfunc&nbsp;(z&nbsp;*Int)&nbsp;Op(x,&nbsp;y&nbsp;*Int)&nbsp;*Int&nbsp;&nbsp;&nbsp;&nbsp(similar&nbsp;for&nbsp;*Rat)</span><br>
<span class="lineno"></span><span class="comment" id="3758193">//</span><br>
<span class="lineno">15</span><span class="comment" id="3758196">//&nbsp;and&nbsp;implement&nbsp;operations&nbsp;z&nbsp;=&nbsp;x&nbsp;Op&nbsp;y&nbsp;with&nbsp;the&nbsp;result&nbsp;as&nbsp;receiver;&nbsp;if&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="3758270">//&nbsp;is&nbsp;one&nbsp;of&nbsp;the&nbsp;operands&nbsp;it&nbsp;may&nbsp;be&nbsp;overwritten&nbsp;(and&nbsp;its&nbsp;memory&nbsp;reused).</span><br>
<span class="lineno"></span><span class="comment" id="3758343">//&nbsp;To&nbsp;enable&nbsp;chaining&nbsp;of&nbsp;operations,&nbsp;the&nbsp;result&nbsp;is&nbsp;also&nbsp;returned.&nbsp;Methods</span><br>
<span class="lineno"></span><span class="comment" id="3758417">//&nbsp;returning&nbsp;a&nbsp;result&nbsp;other&nbsp;than&nbsp;*Int&nbsp;or&nbsp;*Rat&nbsp;take&nbsp;one&nbsp;of&nbsp;the&nbsp;operands&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="3758491">//&nbsp;the&nbsp;receiver.</span><br>
<span class="lineno">20</span><span class="comment" id="3758508">//</span><br>
<span class="lineno"></span><span class="keyword" id="3758511">package</span>&nbsp;<span class="ident" id="3758519">big</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3758524">//&nbsp;This&nbsp;file&nbsp;contains&nbsp;operations&nbsp;on&nbsp;unsigned&nbsp;multi-precision&nbsp;integers.</span><br>
<span class="lineno"></span><span class="comment" id="3758595">//&nbsp;These&nbsp;are&nbsp;the&nbsp;building&nbsp;blocks&nbsp;for&nbsp;the&nbsp;operations&nbsp;on&nbsp;signed&nbsp;integers</span><br>
<span class="lineno">25</span><span class="comment" id="3758666">//&nbsp;and&nbsp;rationals.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3758685">import</span>&nbsp;<span class="op" id="3758692">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3758695">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3758705">&#34;io&#34;</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3758711">&#34;math&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3758719">&#34;math/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3758732">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="3758739">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="3758742">//&nbsp;An&nbsp;unsigned&nbsp;integer&nbsp;x&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="3758779">//</span><br>
<span class="lineno"></span><span class="comment" id="3758782">//&nbsp;&nbsp;&nbsp;x&nbsp;=&nbsp;x[n-1]*_B^(n-1)&nbsp;+&nbsp;x[n-2]*_B^(n-2)&nbsp;+&nbsp;...&nbsp;+&nbsp;x[1]*_B&nbsp;+&nbsp;x[0]</span><br>
<span class="lineno"></span><span class="comment" id="3758848">//</span><br>
<span class="lineno"></span><span class="comment" id="3758851">//&nbsp;with&nbsp;0&nbsp;&lt;=&nbsp;x[i]&nbsp;&lt;&nbsp;_B&nbsp;and&nbsp;0&nbsp;&lt;=&nbsp;i&nbsp;&lt;&nbsp;n&nbsp;is&nbsp;stored&nbsp;in&nbsp;a&nbsp;slice&nbsp;of&nbsp;length&nbsp;n,</span><br>
<span class="lineno">40</span><span class="comment" id="3758923">//&nbsp;with&nbsp;the&nbsp;digits&nbsp;x[i]&nbsp;as&nbsp;the&nbsp;slice&nbsp;elements.</span><br>
<span class="lineno"></span><span class="comment" id="3758970">//</span><br>
<span class="lineno"></span><span class="comment" id="3758973">//&nbsp;A&nbsp;number&nbsp;is&nbsp;normalized&nbsp;if&nbsp;the&nbsp;slice&nbsp;contains&nbsp;no&nbsp;leading&nbsp;0&nbsp;digits.</span><br>
<span class="lineno"></span><span class="comment" id="3759042">//&nbsp;During&nbsp;arithmetic&nbsp;operations,&nbsp;denormalized&nbsp;values&nbsp;may&nbsp;occur&nbsp;but&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="3759113">//&nbsp;always&nbsp;normalized&nbsp;before&nbsp;returning&nbsp;the&nbsp;final&nbsp;result.&nbsp;The&nbsp;normalized</span><br>
<span class="lineno">45</span><span class="comment" id="3759184">//&nbsp;representation&nbsp;of&nbsp;0&nbsp;is&nbsp;the&nbsp;empty&nbsp;or&nbsp;nil&nbsp;slice&nbsp;(length&nbsp;=&nbsp;0).</span><br>
<span class="lineno"></span><span class="comment" id="3759247">//</span><br>
<span class="lineno"></span><span class="keyword" id="3759250">type</span>&nbsp;<span class="ident" id="3759255">nat</span>&nbsp;<span class="op" id="3759259">[</span><span class="op" id="3759260">]</span><span class="ident" id="3759261">Word</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3759267">var</span>&nbsp;<span class="op" id="3759271">(</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3759274">natOne</span>&nbsp;<span class="op" id="3759281">=</span>&nbsp;<span class="ident" id="3759283">nat</span><span class="op" id="3759286">{</span><span class="num" id="3759287">1</span><span class="op" id="3759288">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3759291">natTwo</span>&nbsp;<span class="op" id="3759298">=</span>&nbsp;<span class="ident" id="3759300">nat</span><span class="op" id="3759303">{</span><span class="num" id="3759304">2</span><span class="op" id="3759305">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3759308">natTen</span>&nbsp;<span class="op" id="3759315">=</span>&nbsp;<span class="ident" id="3759317">nat</span><span class="op" id="3759320">{</span><span class="num" id="3759321">10</span><span class="op" id="3759323">}</span><br>
<span class="lineno"></span><span class="op" id="3759325">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="3759328">func</span>&nbsp;<span class="op" id="3759333">(</span><span class="ident" id="3759334">z</span>&nbsp;<span class="ident" id="3759336">nat</span><span class="op" id="3759339">)</span>&nbsp;<span class="ident" id="3759341">clear</span><span class="op" id="3759346">(</span><span class="op" id="3759347">)</span>&nbsp;<span class="op" id="3759349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3759352">for</span>&nbsp;<span class="ident" id="3759356">i</span>&nbsp;<span class="op" id="3759358">:=</span>&nbsp;<span class="keyword" id="3759361">range</span>&nbsp;<span class="ident" id="3759367">z</span>&nbsp;<span class="op" id="3759369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3759373">z</span><span class="op" id="3759374">[</span><span class="ident" id="3759375">i</span><span class="op" id="3759376">]</span>&nbsp;<span class="op" id="3759378">=</span>&nbsp;<span class="num" id="3759380">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3759383">}</span><br>
<span class="lineno"></span><span class="op" id="3759385">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="3759388">func</span>&nbsp;<span class="op" id="3759393">(</span><span class="ident" id="3759394">z</span>&nbsp;<span class="ident" id="3759396">nat</span><span class="op" id="3759399">)</span>&nbsp;<span class="ident" id="3759401">norm</span><span class="op" id="3759405">(</span><span class="op" id="3759406">)</span>&nbsp;<span class="ident" id="3759408">nat</span>&nbsp;<span class="op" id="3759412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3759415">i</span>&nbsp;<span class="op" id="3759417">:=</span>&nbsp;<span class="builtinfunc" id="3759420">len</span><span class="op" id="3759423">(</span><span class="ident" id="3759424">z</span><span class="op" id="3759425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3759428">for</span>&nbsp;<span class="ident" id="3759432">i</span>&nbsp;<span class="op" id="3759434">&gt;</span>&nbsp;<span class="num" id="3759436">0</span>&nbsp;<span class="op" id="3759438">&amp;&amp;</span>&nbsp;<span class="ident" id="3759441">z</span><span class="op" id="3759442">[</span><span class="ident" id="3759443">i</span><span class="op" id="3759444">-</span><span class="num" id="3759445">1</span><span class="op" id="3759446">]</span>&nbsp;<span class="op" id="3759448">==</span>&nbsp;<span class="num" id="3759451">0</span>&nbsp;<span class="op" id="3759453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3759457">i</span><span class="op" id="3759458">--</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3759462">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3759465">return</span>&nbsp;<span class="ident" id="3759472">z</span><span class="op" id="3759473">[</span><span class="num" id="3759474">0</span><span class="op" id="3759475">:</span><span class="ident" id="3759476">i</span><span class="op" id="3759477">]</span><br>
<span class="lineno"></span><span class="op" id="3759479">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3759482">func</span>&nbsp;<span class="op" id="3759487">(</span><span class="ident" id="3759488">z</span>&nbsp;<span class="ident" id="3759490">nat</span><span class="op" id="3759493">)</span>&nbsp;<span class="builtinfunc" id="3759495">make</span><span class="op" id="3759499">(</span><span class="ident" id="3759500">n</span>&nbsp;<span class="builtintype" id="3759502">int</span><span class="op" id="3759505">)</span>&nbsp;<span class="ident" id="3759507">nat</span>&nbsp;<span class="op" id="3759511">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3759514">if</span>&nbsp;<span class="ident" id="3759517">n</span>&nbsp;<span class="op" id="3759519">&lt;=</span>&nbsp;<span class="builtinfunc" id="3759522">cap</span><span class="op" id="3759525">(</span><span class="ident" id="3759526">z</span><span class="op" id="3759527">)</span>&nbsp;<span class="op" id="3759529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3759533">return</span>&nbsp;<span class="ident" id="3759540">z</span><span class="op" id="3759541">[</span><span class="num" id="3759542">0</span><span class="op" id="3759543">:</span><span class="ident" id="3759544">n</span><span class="op" id="3759545">]</span>&nbsp;<span class="comment" id="3759547">//&nbsp;reuse&nbsp;z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3759559">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3759562">//&nbsp;Choosing&nbsp;a&nbsp;good&nbsp;value&nbsp;for&nbsp;e&nbsp;has&nbsp;significant&nbsp;performance&nbsp;impact</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3759629">//&nbsp;because&nbsp;it&nbsp;increases&nbsp;the&nbsp;chance&nbsp;that&nbsp;a&nbsp;value&nbsp;can&nbsp;be&nbsp;reused.</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3759693">const</span>&nbsp;<span class="ident" id="3759699">e</span>&nbsp;<span class="op" id="3759701">=</span>&nbsp;<span class="num" id="3759703">4</span>&nbsp;<span class="comment" id="3759705">//&nbsp;extra&nbsp;capacity</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3759724">return</span>&nbsp;<span class="builtinfunc" id="3759731">make</span><span class="op" id="3759735">(</span><span class="ident" id="3759736">nat</span><span class="op" id="3759739">,</span>&nbsp;<span class="ident" id="3759741">n</span><span class="op" id="3759742">,</span>&nbsp;<span class="ident" id="3759744">n</span><span class="op" id="3759745">+</span><span class="ident" id="3759746">e</span><span class="op" id="3759747">)</span><br>
<span class="lineno"></span><span class="op" id="3759749">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3759752">func</span>&nbsp;<span class="op" id="3759757">(</span><span class="ident" id="3759758">z</span>&nbsp;<span class="ident" id="3759760">nat</span><span class="op" id="3759763">)</span>&nbsp;<span class="ident" id="3759765">setWord</span><span class="op" id="3759772">(</span><span class="ident" id="3759773">x</span>&nbsp;<span class="ident" id="3759775">Word</span><span class="op" id="3759779">)</span>&nbsp;<span class="ident" id="3759781">nat</span>&nbsp;<span class="op" id="3759785">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3759788">if</span>&nbsp;<span class="ident" id="3759791">x</span>&nbsp;<span class="op" id="3759793">==</span>&nbsp;<span class="num" id="3759796">0</span>&nbsp;<span class="op" id="3759798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3759802">return</span>&nbsp;<span class="ident" id="3759809">z</span><span class="op" id="3759810">.</span><span class="builtinfunc" id="3759811">make</span><span class="op" id="3759815">(</span><span class="num" id="3759816">0</span><span class="op" id="3759817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3759820">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3759823">z</span>&nbsp;<span class="op" id="3759825">=</span>&nbsp;<span class="ident" id="3759827">z</span><span class="op" id="3759828">.</span><span class="builtinfunc" id="3759829">make</span><span class="op" id="3759833">(</span><span class="num" id="3759834">1</span><span class="op" id="3759835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3759838">z</span><span class="op" id="3759839">[</span><span class="num" id="3759840">0</span><span class="op" id="3759841">]</span>&nbsp;<span class="op" id="3759843">=</span>&nbsp;<span class="ident" id="3759845">x</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3759848">return</span>&nbsp;<span class="ident" id="3759855">z</span><br>
<span class="lineno"></span><span class="op" id="3759857">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3759860">func</span>&nbsp;<span class="op" id="3759865">(</span><span class="ident" id="3759866">z</span>&nbsp;<span class="ident" id="3759868">nat</span><span class="op" id="3759871">)</span>&nbsp;<span class="ident" id="3759873">setUint64</span><span class="op" id="3759882">(</span><span class="ident" id="3759883">x</span>&nbsp;<span class="ident" id="3759885">uint64</span><span class="op" id="3759891">)</span>&nbsp;<span class="ident" id="3759893">nat</span>&nbsp;<span class="op" id="3759897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3759900">//&nbsp;single-digit&nbsp;values</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3759924">if</span>&nbsp;<span class="ident" id="3759927">w</span>&nbsp;<span class="op" id="3759929">:=</span>&nbsp;<span class="ident" id="3759932">Word</span><span class="op" id="3759936">(</span><span class="ident" id="3759937">x</span><span class="op" id="3759938">)</span><span class="op" id="3759939">;</span>&nbsp;<span class="ident" id="3759941">uint64</span><span class="op" id="3759947">(</span><span class="ident" id="3759948">w</span><span class="op" id="3759949">)</span>&nbsp;<span class="op" id="3759951">==</span>&nbsp;<span class="ident" id="3759954">x</span>&nbsp;<span class="op" id="3759956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3759960">return</span>&nbsp;<span class="ident" id="3759967">z</span><span class="op" id="3759968">.</span><span class="ident" id="3759969">setWord</span><span class="op" id="3759976">(</span><span class="ident" id="3759977">w</span><span class="op" id="3759978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3759981">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3759985">//&nbsp;compute&nbsp;number&nbsp;of&nbsp;words&nbsp;n&nbsp;required&nbsp;to&nbsp;represent&nbsp;x</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3760039">n</span>&nbsp;<span class="op" id="3760041">:=</span>&nbsp;<span class="num" id="3760044">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3760047">for</span>&nbsp;<span class="ident" id="3760051">t</span>&nbsp;<span class="op" id="3760053">:=</span>&nbsp;<span class="ident" id="3760056">x</span><span class="op" id="3760057">;</span>&nbsp;<span class="ident" id="3760059">t</span>&nbsp;<span class="op" id="3760061">&gt;</span>&nbsp;<span class="num" id="3760063">0</span><span class="op" id="3760064">;</span>&nbsp;<span class="ident" id="3760066">t</span>&nbsp;<span class="op" id="3760068">&gt;&gt;=</span>&nbsp;<span class="ident" id="3760072">_W</span>&nbsp;<span class="op" id="3760075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3760079">n</span><span class="op" id="3760080">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3760084">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3760088">//&nbsp;split&nbsp;x&nbsp;into&nbsp;n&nbsp;words</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3760113">z</span>&nbsp;<span class="op" id="3760115">=</span>&nbsp;<span class="ident" id="3760117">z</span><span class="op" id="3760118">.</span><span class="builtinfunc" id="3760119">make</span><span class="op" id="3760123">(</span><span class="ident" id="3760124">n</span><span class="op" id="3760125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3760128">for</span>&nbsp;<span class="ident" id="3760132">i</span>&nbsp;<span class="op" id="3760134">:=</span>&nbsp;<span class="keyword" id="3760137">range</span>&nbsp;<span class="ident" id="3760143">z</span>&nbsp;<span class="op" id="3760145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3760149">z</span><span class="op" id="3760150">[</span><span class="ident" id="3760151">i</span><span class="op" id="3760152">]</span>&nbsp;<span class="op" id="3760154">=</span>&nbsp;<span class="ident" id="3760156">Word</span><span class="op" id="3760160">(</span><span class="ident" id="3760161">x</span>&nbsp;<span class="op" id="3760163">&amp;</span>&nbsp;<span class="ident" id="3760165">_M</span><span class="op" id="3760167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3760171">x</span>&nbsp;<span class="op" id="3760173">&gt;&gt;=</span>&nbsp;<span class="ident" id="3760177">_W</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3760181">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3760185">return</span>&nbsp;<span class="ident" id="3760192">z</span><br>
<span class="lineno"></span><span class="op" id="3760194">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="keyword" id="3760197">func</span>&nbsp;<span class="op" id="3760202">(</span><span class="ident" id="3760203">z</span>&nbsp;<span class="ident" id="3760205">nat</span><span class="op" id="3760208">)</span>&nbsp;<span class="ident" id="3760210">set</span><span class="op" id="3760213">(</span><span class="ident" id="3760214">x</span>&nbsp;<span class="ident" id="3760216">nat</span><span class="op" id="3760219">)</span>&nbsp;<span class="ident" id="3760221">nat</span>&nbsp;<span class="op" id="3760225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3760228">z</span>&nbsp;<span class="op" id="3760230">=</span>&nbsp;<span class="ident" id="3760232">z</span><span class="op" id="3760233">.</span><span class="builtinfunc" id="3760234">make</span><span class="op" id="3760238">(</span><span class="builtinfunc" id="3760239">len</span><span class="op" id="3760242">(</span><span class="ident" id="3760243">x</span><span class="op" id="3760244">)</span><span class="op" id="3760245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3760248">copy</span><span class="op" id="3760252">(</span><span class="ident" id="3760253">z</span><span class="op" id="3760254">,</span>&nbsp;<span class="ident" id="3760256">x</span><span class="op" id="3760257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3760260">return</span>&nbsp;<span class="ident" id="3760267">z</span><br>
<span class="lineno"></span><span class="op" id="3760269">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="keyword" id="3760272">func</span>&nbsp;<span class="op" id="3760277">(</span><span class="ident" id="3760278">z</span>&nbsp;<span class="ident" id="3760280">nat</span><span class="op" id="3760283">)</span>&nbsp;<span class="ident" id="3760285">add</span><span class="op" id="3760288">(</span><span class="ident" id="3760289">x</span><span class="op" id="3760290">,</span>&nbsp;<span class="ident" id="3760292">y</span>&nbsp;<span class="ident" id="3760294">nat</span><span class="op" id="3760297">)</span>&nbsp;<span class="ident" id="3760299">nat</span>&nbsp;<span class="op" id="3760303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3760306">m</span>&nbsp;<span class="op" id="3760308">:=</span>&nbsp;<span class="builtinfunc" id="3760311">len</span><span class="op" id="3760314">(</span><span class="ident" id="3760315">x</span><span class="op" id="3760316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3760319">n</span>&nbsp;<span class="op" id="3760321">:=</span>&nbsp;<span class="builtinfunc" id="3760324">len</span><span class="op" id="3760327">(</span><span class="ident" id="3760328">y</span><span class="op" id="3760329">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3760333">switch</span>&nbsp;<span class="op" id="3760340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3760343">case</span>&nbsp;<span class="ident" id="3760348">m</span>&nbsp;<span class="op" id="3760350">&lt;</span>&nbsp;<span class="ident" id="3760352">n</span><span class="op" id="3760353">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3760357">return</span>&nbsp;<span class="ident" id="3760364">z</span><span class="op" id="3760365">.</span><span class="ident" id="3760366">add</span><span class="op" id="3760369">(</span><span class="ident" id="3760370">y</span><span class="op" id="3760371">,</span>&nbsp;<span class="ident" id="3760373">x</span><span class="op" id="3760374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3760377">case</span>&nbsp;<span class="ident" id="3760382">m</span>&nbsp;<span class="op" id="3760384">==</span>&nbsp;<span class="num" id="3760387">0</span><span class="op" id="3760388">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3760392">//&nbsp;n&nbsp;==&nbsp;0&nbsp;because&nbsp;m&nbsp;&gt;=&nbsp;n;&nbsp;result&nbsp;is&nbsp;0</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3760432">return</span>&nbsp;<span class="ident" id="3760439">z</span><span class="op" id="3760440">.</span><span class="builtinfunc" id="3760441">make</span><span class="op" id="3760445">(</span><span class="num" id="3760446">0</span><span class="op" id="3760447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3760450">case</span>&nbsp;<span class="ident" id="3760455">n</span>&nbsp;<span class="op" id="3760457">==</span>&nbsp;<span class="num" id="3760460">0</span><span class="op" id="3760461">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3760465">//&nbsp;result&nbsp;is&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3760482">return</span>&nbsp;<span class="ident" id="3760489">z</span><span class="op" id="3760490">.</span><span class="ident" id="3760491">set</span><span class="op" id="3760494">(</span><span class="ident" id="3760495">x</span><span class="op" id="3760496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3760499">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3760502">//&nbsp;m&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3760513">z</span>&nbsp;<span class="op" id="3760515">=</span>&nbsp;<span class="ident" id="3760517">z</span><span class="op" id="3760518">.</span><span class="builtinfunc" id="3760519">make</span><span class="op" id="3760523">(</span><span class="ident" id="3760524">m</span>&nbsp;<span class="op" id="3760526">+</span>&nbsp;<span class="num" id="3760528">1</span><span class="op" id="3760529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3760532">c</span>&nbsp;<span class="op" id="3760534">:=</span>&nbsp;<span class="ident" id="3760537">addVV</span><span class="op" id="3760542">(</span><span class="ident" id="3760543">z</span><span class="op" id="3760544">[</span><span class="num" id="3760545">0</span><span class="op" id="3760546">:</span><span class="ident" id="3760547">n</span><span class="op" id="3760548">]</span><span class="op" id="3760549">,</span>&nbsp;<span class="ident" id="3760551">x</span><span class="op" id="3760552">,</span>&nbsp;<span class="ident" id="3760554">y</span><span class="op" id="3760555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3760558">if</span>&nbsp;<span class="ident" id="3760561">m</span>&nbsp;<span class="op" id="3760563">&gt;</span>&nbsp;<span class="ident" id="3760565">n</span>&nbsp;<span class="op" id="3760567">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3760571">c</span>&nbsp;<span class="op" id="3760573">=</span>&nbsp;<span class="ident" id="3760575">addVW</span><span class="op" id="3760580">(</span><span class="ident" id="3760581">z</span><span class="op" id="3760582">[</span><span class="ident" id="3760583">n</span><span class="op" id="3760584">:</span><span class="ident" id="3760585">m</span><span class="op" id="3760586">]</span><span class="op" id="3760587">,</span>&nbsp;<span class="ident" id="3760589">x</span><span class="op" id="3760590">[</span><span class="ident" id="3760591">n</span><span class="op" id="3760592">:</span><span class="op" id="3760593">]</span><span class="op" id="3760594">,</span>&nbsp;<span class="ident" id="3760596">c</span><span class="op" id="3760597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3760600">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3760603">z</span><span class="op" id="3760604">[</span><span class="ident" id="3760605">m</span><span class="op" id="3760606">]</span>&nbsp;<span class="op" id="3760608">=</span>&nbsp;<span class="ident" id="3760610">c</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3760614">return</span>&nbsp;<span class="ident" id="3760621">z</span><span class="op" id="3760622">.</span><span class="ident" id="3760623">norm</span><span class="op" id="3760627">(</span><span class="op" id="3760628">)</span><br>
<span class="lineno">140</span><span class="op" id="3760630">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3760633">func</span>&nbsp;<span class="op" id="3760638">(</span><span class="ident" id="3760639">z</span>&nbsp;<span class="ident" id="3760641">nat</span><span class="op" id="3760644">)</span>&nbsp;<span class="ident" id="3760646">sub</span><span class="op" id="3760649">(</span><span class="ident" id="3760650">x</span><span class="op" id="3760651">,</span>&nbsp;<span class="ident" id="3760653">y</span>&nbsp;<span class="ident" id="3760655">nat</span><span class="op" id="3760658">)</span>&nbsp;<span class="ident" id="3760660">nat</span>&nbsp;<span class="op" id="3760664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3760667">m</span>&nbsp;<span class="op" id="3760669">:=</span>&nbsp;<span class="builtinfunc" id="3760672">len</span><span class="op" id="3760675">(</span><span class="ident" id="3760676">x</span><span class="op" id="3760677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3760680">n</span>&nbsp;<span class="op" id="3760682">:=</span>&nbsp;<span class="builtinfunc" id="3760685">len</span><span class="op" id="3760688">(</span><span class="ident" id="3760689">y</span><span class="op" id="3760690">)</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3760694">switch</span>&nbsp;<span class="op" id="3760701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3760704">case</span>&nbsp;<span class="ident" id="3760709">m</span>&nbsp;<span class="op" id="3760711">&lt;</span>&nbsp;<span class="ident" id="3760713">n</span><span class="op" id="3760714">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3760718">panic</span><span class="op" id="3760723">(</span><span class="string" id="3760724">&#34;underflow&#34;</span><span class="op" id="3760735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3760738">case</span>&nbsp;<span class="ident" id="3760743">m</span>&nbsp;<span class="op" id="3760745">==</span>&nbsp;<span class="num" id="3760748">0</span><span class="op" id="3760749">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3760753">//&nbsp;n&nbsp;==&nbsp;0&nbsp;because&nbsp;m&nbsp;&gt;=&nbsp;n;&nbsp;result&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3760793">return</span>&nbsp;<span class="ident" id="3760800">z</span><span class="op" id="3760801">.</span><span class="builtinfunc" id="3760802">make</span><span class="op" id="3760806">(</span><span class="num" id="3760807">0</span><span class="op" id="3760808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3760811">case</span>&nbsp;<span class="ident" id="3760816">n</span>&nbsp;<span class="op" id="3760818">==</span>&nbsp;<span class="num" id="3760821">0</span><span class="op" id="3760822">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3760826">//&nbsp;result&nbsp;is&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3760843">return</span>&nbsp;<span class="ident" id="3760850">z</span><span class="op" id="3760851">.</span><span class="ident" id="3760852">set</span><span class="op" id="3760855">(</span><span class="ident" id="3760856">x</span><span class="op" id="3760857">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3760860">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3760863">//&nbsp;m&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3760874">z</span>&nbsp;<span class="op" id="3760876">=</span>&nbsp;<span class="ident" id="3760878">z</span><span class="op" id="3760879">.</span><span class="builtinfunc" id="3760880">make</span><span class="op" id="3760884">(</span><span class="ident" id="3760885">m</span><span class="op" id="3760886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3760889">c</span>&nbsp;<span class="op" id="3760891">:=</span>&nbsp;<span class="ident" id="3760894">subVV</span><span class="op" id="3760899">(</span><span class="ident" id="3760900">z</span><span class="op" id="3760901">[</span><span class="num" id="3760902">0</span><span class="op" id="3760903">:</span><span class="ident" id="3760904">n</span><span class="op" id="3760905">]</span><span class="op" id="3760906">,</span>&nbsp;<span class="ident" id="3760908">x</span><span class="op" id="3760909">,</span>&nbsp;<span class="ident" id="3760911">y</span><span class="op" id="3760912">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3760915">if</span>&nbsp;<span class="ident" id="3760918">m</span>&nbsp;<span class="op" id="3760920">&gt;</span>&nbsp;<span class="ident" id="3760922">n</span>&nbsp;<span class="op" id="3760924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3760928">c</span>&nbsp;<span class="op" id="3760930">=</span>&nbsp;<span class="ident" id="3760932">subVW</span><span class="op" id="3760937">(</span><span class="ident" id="3760938">z</span><span class="op" id="3760939">[</span><span class="ident" id="3760940">n</span><span class="op" id="3760941">:</span><span class="op" id="3760942">]</span><span class="op" id="3760943">,</span>&nbsp;<span class="ident" id="3760945">x</span><span class="op" id="3760946">[</span><span class="ident" id="3760947">n</span><span class="op" id="3760948">:</span><span class="op" id="3760949">]</span><span class="op" id="3760950">,</span>&nbsp;<span class="ident" id="3760952">c</span><span class="op" id="3760953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3760956">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3760959">if</span>&nbsp;<span class="ident" id="3760962">c</span>&nbsp;<span class="op" id="3760964">!=</span>&nbsp;<span class="num" id="3760967">0</span>&nbsp;<span class="op" id="3760969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3760973">panic</span><span class="op" id="3760978">(</span><span class="string" id="3760979">&#34;underflow&#34;</span><span class="op" id="3760990">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3760993">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3760997">return</span>&nbsp;<span class="ident" id="3761004">z</span><span class="op" id="3761005">.</span><span class="ident" id="3761006">norm</span><span class="op" id="3761010">(</span><span class="op" id="3761011">)</span><br>
<span class="lineno"></span><span class="op" id="3761013">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="3761016">func</span>&nbsp;<span class="op" id="3761021">(</span><span class="ident" id="3761022">x</span>&nbsp;<span class="ident" id="3761024">nat</span><span class="op" id="3761027">)</span>&nbsp;<span class="ident" id="3761029">cmp</span><span class="op" id="3761032">(</span><span class="ident" id="3761033">y</span>&nbsp;<span class="ident" id="3761035">nat</span><span class="op" id="3761038">)</span>&nbsp;<span class="op" id="3761040">(</span><span class="ident" id="3761041">r</span>&nbsp;<span class="builtintype" id="3761043">int</span><span class="op" id="3761046">)</span>&nbsp;<span class="op" id="3761048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3761051">m</span>&nbsp;<span class="op" id="3761053">:=</span>&nbsp;<span class="builtinfunc" id="3761056">len</span><span class="op" id="3761059">(</span><span class="ident" id="3761060">x</span><span class="op" id="3761061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3761064">n</span>&nbsp;<span class="op" id="3761066">:=</span>&nbsp;<span class="builtinfunc" id="3761069">len</span><span class="op" id="3761072">(</span><span class="ident" id="3761073">y</span><span class="op" id="3761074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3761077">if</span>&nbsp;<span class="ident" id="3761080">m</span>&nbsp;<span class="op" id="3761082">!=</span>&nbsp;<span class="ident" id="3761085">n</span>&nbsp;<span class="op" id="3761087">||</span>&nbsp;<span class="ident" id="3761090">m</span>&nbsp;<span class="op" id="3761092">==</span>&nbsp;<span class="num" id="3761095">0</span>&nbsp;<span class="op" id="3761097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3761101">switch</span>&nbsp;<span class="op" id="3761108">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3761112">case</span>&nbsp;<span class="ident" id="3761117">m</span>&nbsp;<span class="op" id="3761119">&lt;</span>&nbsp;<span class="ident" id="3761121">n</span><span class="op" id="3761122">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3761127">r</span>&nbsp;<span class="op" id="3761129">=</span>&nbsp;<span class="op" id="3761131">-</span><span class="num" id="3761132">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3761136">case</span>&nbsp;<span class="ident" id="3761141">m</span>&nbsp;<span class="op" id="3761143">&gt;</span>&nbsp;<span class="ident" id="3761145">n</span><span class="op" id="3761146">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3761151">r</span>&nbsp;<span class="op" id="3761153">=</span>&nbsp;<span class="num" id="3761155">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3761159">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3761163">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3761171">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3761175">i</span>&nbsp;<span class="op" id="3761177">:=</span>&nbsp;<span class="ident" id="3761180">m</span>&nbsp;<span class="op" id="3761182">-</span>&nbsp;<span class="num" id="3761184">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3761187">for</span>&nbsp;<span class="ident" id="3761191">i</span>&nbsp;<span class="op" id="3761193">&gt;</span>&nbsp;<span class="num" id="3761195">0</span>&nbsp;<span class="op" id="3761197">&amp;&amp;</span>&nbsp;<span class="ident" id="3761200">x</span><span class="op" id="3761201">[</span><span class="ident" id="3761202">i</span><span class="op" id="3761203">]</span>&nbsp;<span class="op" id="3761205">==</span>&nbsp;<span class="ident" id="3761208">y</span><span class="op" id="3761209">[</span><span class="ident" id="3761210">i</span><span class="op" id="3761211">]</span>&nbsp;<span class="op" id="3761213">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3761217">i</span><span class="op" id="3761218">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3761222">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3761226">switch</span>&nbsp;<span class="op" id="3761233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3761236">case</span>&nbsp;<span class="ident" id="3761241">x</span><span class="op" id="3761242">[</span><span class="ident" id="3761243">i</span><span class="op" id="3761244">]</span>&nbsp;<span class="op" id="3761246">&lt;</span>&nbsp;<span class="ident" id="3761248">y</span><span class="op" id="3761249">[</span><span class="ident" id="3761250">i</span><span class="op" id="3761251">]</span><span class="op" id="3761252">:</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3761256">r</span>&nbsp;<span class="op" id="3761258">=</span>&nbsp;<span class="op" id="3761260">-</span><span class="num" id="3761261">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3761264">case</span>&nbsp;<span class="ident" id="3761269">x</span><span class="op" id="3761270">[</span><span class="ident" id="3761271">i</span><span class="op" id="3761272">]</span>&nbsp;<span class="op" id="3761274">&gt;</span>&nbsp;<span class="ident" id="3761276">y</span><span class="op" id="3761277">[</span><span class="ident" id="3761278">i</span><span class="op" id="3761279">]</span><span class="op" id="3761280">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3761284">r</span>&nbsp;<span class="op" id="3761286">=</span>&nbsp;<span class="num" id="3761288">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3761291">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3761294">return</span><br>
<span class="lineno">195</span><span class="op" id="3761301">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3761304">func</span>&nbsp;<span class="op" id="3761309">(</span><span class="ident" id="3761310">z</span>&nbsp;<span class="ident" id="3761312">nat</span><span class="op" id="3761315">)</span>&nbsp;<span class="ident" id="3761317">mulAddWW</span><span class="op" id="3761325">(</span><span class="ident" id="3761326">x</span>&nbsp;<span class="ident" id="3761328">nat</span><span class="op" id="3761331">,</span>&nbsp;<span class="ident" id="3761333">y</span><span class="op" id="3761334">,</span>&nbsp;<span class="ident" id="3761336">r</span>&nbsp;<span class="ident" id="3761338">Word</span><span class="op" id="3761342">)</span>&nbsp;<span class="ident" id="3761344">nat</span>&nbsp;<span class="op" id="3761348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3761351">m</span>&nbsp;<span class="op" id="3761353">:=</span>&nbsp;<span class="builtinfunc" id="3761356">len</span><span class="op" id="3761359">(</span><span class="ident" id="3761360">x</span><span class="op" id="3761361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3761364">if</span>&nbsp;<span class="ident" id="3761367">m</span>&nbsp;<span class="op" id="3761369">==</span>&nbsp;<span class="num" id="3761372">0</span>&nbsp;<span class="op" id="3761374">||</span>&nbsp;<span class="ident" id="3761377">y</span>&nbsp;<span class="op" id="3761379">==</span>&nbsp;<span class="num" id="3761382">0</span>&nbsp;<span class="op" id="3761384">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3761388">return</span>&nbsp;<span class="ident" id="3761395">z</span><span class="op" id="3761396">.</span><span class="ident" id="3761397">setWord</span><span class="op" id="3761404">(</span><span class="ident" id="3761405">r</span><span class="op" id="3761406">)</span>&nbsp;<span class="comment" id="3761408">//&nbsp;result&nbsp;is&nbsp;r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3761424">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3761427">//&nbsp;m&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3761438">z</span>&nbsp;<span class="op" id="3761440">=</span>&nbsp;<span class="ident" id="3761442">z</span><span class="op" id="3761443">.</span><span class="builtinfunc" id="3761444">make</span><span class="op" id="3761448">(</span><span class="ident" id="3761449">m</span>&nbsp;<span class="op" id="3761451">+</span>&nbsp;<span class="num" id="3761453">1</span><span class="op" id="3761454">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3761457">z</span><span class="op" id="3761458">[</span><span class="ident" id="3761459">m</span><span class="op" id="3761460">]</span>&nbsp;<span class="op" id="3761462">=</span>&nbsp;<span class="ident" id="3761464">mulAddVWW</span><span class="op" id="3761473">(</span><span class="ident" id="3761474">z</span><span class="op" id="3761475">[</span><span class="num" id="3761476">0</span><span class="op" id="3761477">:</span><span class="ident" id="3761478">m</span><span class="op" id="3761479">]</span><span class="op" id="3761480">,</span>&nbsp;<span class="ident" id="3761482">x</span><span class="op" id="3761483">,</span>&nbsp;<span class="ident" id="3761485">y</span><span class="op" id="3761486">,</span>&nbsp;<span class="ident" id="3761488">r</span><span class="op" id="3761489">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3761493">return</span>&nbsp;<span class="ident" id="3761500">z</span><span class="op" id="3761501">.</span><span class="ident" id="3761502">norm</span><span class="op" id="3761506">(</span><span class="op" id="3761507">)</span><br>
<span class="lineno"></span><span class="op" id="3761509">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="comment" id="3761512">//&nbsp;basicMul&nbsp;multiplies&nbsp;x&nbsp;and&nbsp;y&nbsp;and&nbsp;leaves&nbsp;the&nbsp;result&nbsp;in&nbsp;z.</span><br>
<span class="lineno"></span><span class="comment" id="3761571">//&nbsp;The&nbsp;(non-normalized)&nbsp;result&nbsp;is&nbsp;placed&nbsp;in&nbsp;z[0&nbsp;:&nbsp;len(x)&nbsp;+&nbsp;len(y)].</span><br>
<span class="lineno"></span><span class="keyword" id="3761639">func</span>&nbsp;<span class="ident" id="3761644">basicMul</span><span class="op" id="3761652">(</span><span class="ident" id="3761653">z</span><span class="op" id="3761654">,</span>&nbsp;<span class="ident" id="3761656">x</span><span class="op" id="3761657">,</span>&nbsp;<span class="ident" id="3761659">y</span>&nbsp;<span class="ident" id="3761661">nat</span><span class="op" id="3761664">)</span>&nbsp;<span class="op" id="3761666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3761669">z</span><span class="op" id="3761670">[</span><span class="num" id="3761671">0</span>&nbsp;<span class="op" id="3761673">:</span>&nbsp;<span class="builtinfunc" id="3761675">len</span><span class="op" id="3761678">(</span><span class="ident" id="3761679">x</span><span class="op" id="3761680">)</span><span class="op" id="3761681">+</span><span class="builtinfunc" id="3761682">len</span><span class="op" id="3761685">(</span><span class="ident" id="3761686">y</span><span class="op" id="3761687">)</span><span class="op" id="3761688">]</span><span class="op" id="3761689">.</span><span class="ident" id="3761690">clear</span><span class="op" id="3761695">(</span><span class="op" id="3761696">)</span>&nbsp;<span class="comment" id="3761698">//&nbsp;initialize&nbsp;z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3761715">for</span>&nbsp;<span class="ident" id="3761719">i</span><span class="op" id="3761720">,</span>&nbsp;<span class="ident" id="3761722">d</span>&nbsp;<span class="op" id="3761724">:=</span>&nbsp;<span class="keyword" id="3761727">range</span>&nbsp;<span class="ident" id="3761733">y</span>&nbsp;<span class="op" id="3761735">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3761739">if</span>&nbsp;<span class="ident" id="3761742">d</span>&nbsp;<span class="op" id="3761744">!=</span>&nbsp;<span class="num" id="3761747">0</span>&nbsp;<span class="op" id="3761749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3761754">z</span><span class="op" id="3761755">[</span><span class="builtinfunc" id="3761756">len</span><span class="op" id="3761759">(</span><span class="ident" id="3761760">x</span><span class="op" id="3761761">)</span><span class="op" id="3761762">+</span><span class="ident" id="3761763">i</span><span class="op" id="3761764">]</span>&nbsp;<span class="op" id="3761766">=</span>&nbsp;<span class="ident" id="3761768">addMulVVW</span><span class="op" id="3761777">(</span><span class="ident" id="3761778">z</span><span class="op" id="3761779">[</span><span class="ident" id="3761780">i</span><span class="op" id="3761781">:</span><span class="ident" id="3761782">i</span><span class="op" id="3761783">+</span><span class="builtinfunc" id="3761784">len</span><span class="op" id="3761787">(</span><span class="ident" id="3761788">x</span><span class="op" id="3761789">)</span><span class="op" id="3761790">]</span><span class="op" id="3761791">,</span>&nbsp;<span class="ident" id="3761793">x</span><span class="op" id="3761794">,</span>&nbsp;<span class="ident" id="3761796">d</span><span class="op" id="3761797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3761801">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3761804">}</span><br>
<span class="lineno"></span><span class="op" id="3761806">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="3761809">//&nbsp;Fast&nbsp;version&nbsp;of&nbsp;z[0:n+n&gt;&gt;1].add(z[0:n+n&gt;&gt;1],&nbsp;x[0:n])&nbsp;w/o&nbsp;bounds&nbsp;checks.</span><br>
<span class="lineno"></span><span class="comment" id="3761884">//&nbsp;Factored&nbsp;out&nbsp;for&nbsp;readability&nbsp;-&nbsp;do&nbsp;not&nbsp;use&nbsp;outside&nbsp;karatsuba.</span><br>
<span class="lineno"></span><span class="keyword" id="3761948">func</span>&nbsp;<span class="ident" id="3761953">karatsubaAdd</span><span class="op" id="3761965">(</span><span class="ident" id="3761966">z</span><span class="op" id="3761967">,</span>&nbsp;<span class="ident" id="3761969">x</span>&nbsp;<span class="ident" id="3761971">nat</span><span class="op" id="3761974">,</span>&nbsp;<span class="ident" id="3761976">n</span>&nbsp;<span class="builtintype" id="3761978">int</span><span class="op" id="3761981">)</span>&nbsp;<span class="op" id="3761983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3761986">if</span>&nbsp;<span class="ident" id="3761989">c</span>&nbsp;<span class="op" id="3761991">:=</span>&nbsp;<span class="ident" id="3761994">addVV</span><span class="op" id="3761999">(</span><span class="ident" id="3762000">z</span><span class="op" id="3762001">[</span><span class="num" id="3762002">0</span><span class="op" id="3762003">:</span><span class="ident" id="3762004">n</span><span class="op" id="3762005">]</span><span class="op" id="3762006">,</span>&nbsp;<span class="ident" id="3762008">z</span><span class="op" id="3762009">,</span>&nbsp;<span class="ident" id="3762011">x</span><span class="op" id="3762012">)</span><span class="op" id="3762013">;</span>&nbsp;<span class="ident" id="3762015">c</span>&nbsp;<span class="op" id="3762017">!=</span>&nbsp;<span class="num" id="3762020">0</span>&nbsp;<span class="op" id="3762022">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3762026">addVW</span><span class="op" id="3762031">(</span><span class="ident" id="3762032">z</span><span class="op" id="3762033">[</span><span class="ident" id="3762034">n</span><span class="op" id="3762035">:</span><span class="ident" id="3762036">n</span><span class="op" id="3762037">+</span><span class="ident" id="3762038">n</span><span class="op" id="3762039">&gt;&gt;</span><span class="num" id="3762041">1</span><span class="op" id="3762042">]</span><span class="op" id="3762043">,</span>&nbsp;<span class="ident" id="3762045">z</span><span class="op" id="3762046">[</span><span class="ident" id="3762047">n</span><span class="op" id="3762048">:</span><span class="op" id="3762049">]</span><span class="op" id="3762050">,</span>&nbsp;<span class="ident" id="3762052">c</span><span class="op" id="3762053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3762056">}</span><br>
<span class="lineno"></span><span class="op" id="3762058">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3762061">//&nbsp;Like&nbsp;karatsubaAdd,&nbsp;but&nbsp;does&nbsp;subtract.</span><br>
<span class="lineno">230</span><span class="keyword" id="3762102">func</span>&nbsp;<span class="ident" id="3762107">karatsubaSub</span><span class="op" id="3762119">(</span><span class="ident" id="3762120">z</span><span class="op" id="3762121">,</span>&nbsp;<span class="ident" id="3762123">x</span>&nbsp;<span class="ident" id="3762125">nat</span><span class="op" id="3762128">,</span>&nbsp;<span class="ident" id="3762130">n</span>&nbsp;<span class="builtintype" id="3762132">int</span><span class="op" id="3762135">)</span>&nbsp;<span class="op" id="3762137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3762140">if</span>&nbsp;<span class="ident" id="3762143">c</span>&nbsp;<span class="op" id="3762145">:=</span>&nbsp;<span class="ident" id="3762148">subVV</span><span class="op" id="3762153">(</span><span class="ident" id="3762154">z</span><span class="op" id="3762155">[</span><span class="num" id="3762156">0</span><span class="op" id="3762157">:</span><span class="ident" id="3762158">n</span><span class="op" id="3762159">]</span><span class="op" id="3762160">,</span>&nbsp;<span class="ident" id="3762162">z</span><span class="op" id="3762163">,</span>&nbsp;<span class="ident" id="3762165">x</span><span class="op" id="3762166">)</span><span class="op" id="3762167">;</span>&nbsp;<span class="ident" id="3762169">c</span>&nbsp;<span class="op" id="3762171">!=</span>&nbsp;<span class="num" id="3762174">0</span>&nbsp;<span class="op" id="3762176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3762180">subVW</span><span class="op" id="3762185">(</span><span class="ident" id="3762186">z</span><span class="op" id="3762187">[</span><span class="ident" id="3762188">n</span><span class="op" id="3762189">:</span><span class="ident" id="3762190">n</span><span class="op" id="3762191">+</span><span class="ident" id="3762192">n</span><span class="op" id="3762193">&gt;&gt;</span><span class="num" id="3762195">1</span><span class="op" id="3762196">]</span><span class="op" id="3762197">,</span>&nbsp;<span class="ident" id="3762199">z</span><span class="op" id="3762200">[</span><span class="ident" id="3762201">n</span><span class="op" id="3762202">:</span><span class="op" id="3762203">]</span><span class="op" id="3762204">,</span>&nbsp;<span class="ident" id="3762206">c</span><span class="op" id="3762207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3762210">}</span><br>
<span class="lineno"></span><span class="op" id="3762212">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span><span class="comment" id="3762215">//&nbsp;Operands&nbsp;that&nbsp;are&nbsp;shorter&nbsp;than&nbsp;karatsubaThreshold&nbsp;are&nbsp;multiplied&nbsp;using</span><br>
<span class="lineno"></span><span class="comment" id="3762289">//&nbsp;&#34;grade&nbsp;school&#34;&nbsp;multiplication;&nbsp;for&nbsp;longer&nbsp;operands&nbsp;the&nbsp;Karatsuba&nbsp;algorithm</span><br>
<span class="lineno"></span><span class="comment" id="3762367">//&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span><span class="keyword" id="3762379">var</span>&nbsp;<span class="ident" id="3762383">karatsubaThreshold</span>&nbsp;<span class="builtintype" id="3762402">int</span>&nbsp;<span class="op" id="3762406">=</span>&nbsp;<span class="num" id="3762408">40</span>&nbsp;<span class="comment" id="3762411">//&nbsp;computed&nbsp;by&nbsp;calibrate.go</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="comment" id="3762440">//&nbsp;karatsuba&nbsp;multiplies&nbsp;x&nbsp;and&nbsp;y&nbsp;and&nbsp;leaves&nbsp;the&nbsp;result&nbsp;in&nbsp;z.</span><br>
<span class="lineno"></span><span class="comment" id="3762500">//&nbsp;Both&nbsp;x&nbsp;and&nbsp;y&nbsp;must&nbsp;have&nbsp;the&nbsp;same&nbsp;length&nbsp;n&nbsp;and&nbsp;n&nbsp;must&nbsp;be&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3762560">//&nbsp;power&nbsp;of&nbsp;2.&nbsp;The&nbsp;result&nbsp;vector&nbsp;z&nbsp;must&nbsp;have&nbsp;len(z)&nbsp;&gt;=&nbsp;6*n.</span><br>
<span class="lineno"></span><span class="comment" id="3762620">//&nbsp;The&nbsp;(non-normalized)&nbsp;result&nbsp;is&nbsp;placed&nbsp;in&nbsp;z[0&nbsp;:&nbsp;2*n].</span><br>
<span class="lineno">245</span><span class="keyword" id="3762676">func</span>&nbsp;<span class="ident" id="3762681">karatsuba</span><span class="op" id="3762690">(</span><span class="ident" id="3762691">z</span><span class="op" id="3762692">,</span>&nbsp;<span class="ident" id="3762694">x</span><span class="op" id="3762695">,</span>&nbsp;<span class="ident" id="3762697">y</span>&nbsp;<span class="ident" id="3762699">nat</span><span class="op" id="3762702">)</span>&nbsp;<span class="op" id="3762704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3762707">n</span>&nbsp;<span class="op" id="3762709">:=</span>&nbsp;<span class="builtinfunc" id="3762712">len</span><span class="op" id="3762715">(</span><span class="ident" id="3762716">y</span><span class="op" id="3762717">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3762721">//&nbsp;Switch&nbsp;to&nbsp;basic&nbsp;multiplication&nbsp;if&nbsp;numbers&nbsp;are&nbsp;odd&nbsp;or&nbsp;small.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3762785">//&nbsp;(n&nbsp;is&nbsp;always&nbsp;even&nbsp;if&nbsp;karatsubaThreshold&nbsp;is&nbsp;even,&nbsp;but&nbsp;be</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3762845">//&nbsp;conservative)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3762863">if</span>&nbsp;<span class="ident" id="3762866">n</span><span class="op" id="3762867">&amp;</span><span class="num" id="3762868">1</span>&nbsp;<span class="op" id="3762870">!=</span>&nbsp;<span class="num" id="3762873">0</span>&nbsp;<span class="op" id="3762875">||</span>&nbsp;<span class="ident" id="3762878">n</span>&nbsp;<span class="op" id="3762880">&lt;</span>&nbsp;<span class="ident" id="3762882">karatsubaThreshold</span>&nbsp;<span class="op" id="3762901">||</span>&nbsp;<span class="ident" id="3762904">n</span>&nbsp;<span class="op" id="3762906">&lt;</span>&nbsp;<span class="num" id="3762908">2</span>&nbsp;<span class="op" id="3762910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3762914">basicMul</span><span class="op" id="3762922">(</span><span class="ident" id="3762923">z</span><span class="op" id="3762924">,</span>&nbsp;<span class="ident" id="3762926">x</span><span class="op" id="3762927">,</span>&nbsp;<span class="ident" id="3762929">y</span><span class="op" id="3762930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3762934">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3762942">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3762945">//&nbsp;n&amp;1&nbsp;==&nbsp;0&nbsp;&amp;&amp;&nbsp;n&nbsp;&gt;=&nbsp;karatsubaThreshold&nbsp;&amp;&amp;&nbsp;n&nbsp;&gt;=&nbsp;2</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3762996">//&nbsp;Karatsuba&nbsp;multiplication&nbsp;is&nbsp;based&nbsp;on&nbsp;the&nbsp;observation&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3763058">//&nbsp;for&nbsp;two&nbsp;numbers&nbsp;x&nbsp;and&nbsp;y&nbsp;with:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3763092">//</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3763096">//&nbsp;&nbsp;&nbsp;x&nbsp;=&nbsp;x1*b&nbsp;+&nbsp;x0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3763116">//&nbsp;&nbsp;&nbsp;y&nbsp;=&nbsp;y1*b&nbsp;+&nbsp;y0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3763136">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3763140">//&nbsp;the&nbsp;product&nbsp;x*y&nbsp;can&nbsp;be&nbsp;obtained&nbsp;with&nbsp;3&nbsp;products&nbsp;z2,&nbsp;z1,&nbsp;z0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3763203">//&nbsp;instead&nbsp;of&nbsp;4:</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3763221">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3763225">//&nbsp;&nbsp;&nbsp;x*y&nbsp;=&nbsp;x1*y1*b*b&nbsp;+&nbsp;(x1*y0&nbsp;+&nbsp;x0*y1)*b&nbsp;+&nbsp;x0*y0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3763275">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;z2*b*b&nbsp;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;z1*b&nbsp;+&nbsp;&nbsp;&nbsp;&nbsp;z0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3763325">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3763329">//&nbsp;with:</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3763339">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3763343">//&nbsp;&nbsp;&nbsp;xd&nbsp;=&nbsp;x1&nbsp;-&nbsp;x0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3763362">//&nbsp;&nbsp;&nbsp;yd&nbsp;=&nbsp;y0&nbsp;-&nbsp;y1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3763381">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3763385">//&nbsp;&nbsp;&nbsp;z1&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xd*yd&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;z2&nbsp;+&nbsp;z0</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3763436">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;(x1-x0)*(y0&nbsp;-&nbsp;y1)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;z2&nbsp;+&nbsp;z0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3763487">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;x1*y0&nbsp;-&nbsp;x1*y1&nbsp;-&nbsp;x0*y0&nbsp;+&nbsp;x0*y1&nbsp;+&nbsp;z2&nbsp;+&nbsp;z0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3763538">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;x1*y0&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;z2&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;z0&nbsp;+&nbsp;x0*y1&nbsp;+&nbsp;z2&nbsp;+&nbsp;z0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3763589">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;x1*y0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;x0*y1</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3763631">//&nbsp;split&nbsp;x,&nbsp;y&nbsp;into&nbsp;&#34;digits&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3763660">n2</span>&nbsp;<span class="op" id="3763663">:=</span>&nbsp;<span class="ident" id="3763666">n</span>&nbsp;<span class="op" id="3763668">&gt;&gt;</span>&nbsp;<span class="num" id="3763671">1</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3763686">//&nbsp;n2&nbsp;&gt;=&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3763698">x1</span><span class="op" id="3763700">,</span>&nbsp;<span class="ident" id="3763702">x0</span>&nbsp;<span class="op" id="3763705">:=</span>&nbsp;<span class="ident" id="3763708">x</span><span class="op" id="3763709">[</span><span class="ident" id="3763710">n2</span><span class="op" id="3763712">:</span><span class="op" id="3763713">]</span><span class="op" id="3763714">,</span>&nbsp;<span class="ident" id="3763716">x</span><span class="op" id="3763717">[</span><span class="num" id="3763718">0</span><span class="op" id="3763719">:</span><span class="ident" id="3763720">n2</span><span class="op" id="3763722">]</span>&nbsp;<span class="comment" id="3763724">//&nbsp;x&nbsp;=&nbsp;x1*b&nbsp;+&nbsp;y0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3763742">y1</span><span class="op" id="3763744">,</span>&nbsp;<span class="ident" id="3763746">y0</span>&nbsp;<span class="op" id="3763749">:=</span>&nbsp;<span class="ident" id="3763752">y</span><span class="op" id="3763753">[</span><span class="ident" id="3763754">n2</span><span class="op" id="3763756">:</span><span class="op" id="3763757">]</span><span class="op" id="3763758">,</span>&nbsp;<span class="ident" id="3763760">y</span><span class="op" id="3763761">[</span><span class="num" id="3763762">0</span><span class="op" id="3763763">:</span><span class="ident" id="3763764">n2</span><span class="op" id="3763766">]</span>&nbsp;<span class="comment" id="3763768">//&nbsp;y&nbsp;=&nbsp;y1*b&nbsp;+&nbsp;y0</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3763787">//&nbsp;z&nbsp;is&nbsp;used&nbsp;for&nbsp;the&nbsp;result&nbsp;and&nbsp;temporary&nbsp;storage:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3763839">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3763843">//&nbsp;&nbsp;&nbsp;6*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0*n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3763901">//&nbsp;z&nbsp;=&nbsp;[z2&nbsp;copy|z0&nbsp;copy|&nbsp;xd*yd&nbsp;|&nbsp;yd:xd&nbsp;|&nbsp;x1*y1&nbsp;|&nbsp;x0*y0&nbsp;]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3763959">//</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3763963">//&nbsp;For&nbsp;each&nbsp;recursive&nbsp;call&nbsp;of&nbsp;karatsuba,&nbsp;an&nbsp;unused&nbsp;slice&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3764024">//&nbsp;z&nbsp;is&nbsp;passed&nbsp;in&nbsp;that&nbsp;has&nbsp;(at&nbsp;least)&nbsp;half&nbsp;the&nbsp;length&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3764086">//&nbsp;caller&#39;s&nbsp;z.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3764103">//&nbsp;compute&nbsp;z0&nbsp;and&nbsp;z2&nbsp;with&nbsp;the&nbsp;result&nbsp;&#34;in&nbsp;place&#34;&nbsp;in&nbsp;z</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3764157">karatsuba</span><span class="op" id="3764166">(</span><span class="ident" id="3764167">z</span><span class="op" id="3764168">,</span>&nbsp;<span class="ident" id="3764170">x0</span><span class="op" id="3764172">,</span>&nbsp;<span class="ident" id="3764174">y0</span><span class="op" id="3764176">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3764182">//&nbsp;z0&nbsp;=&nbsp;x0*y0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3764197">karatsuba</span><span class="op" id="3764206">(</span><span class="ident" id="3764207">z</span><span class="op" id="3764208">[</span><span class="ident" id="3764209">n</span><span class="op" id="3764210">:</span><span class="op" id="3764211">]</span><span class="op" id="3764212">,</span>&nbsp;<span class="ident" id="3764214">x1</span><span class="op" id="3764216">,</span>&nbsp;<span class="ident" id="3764218">y1</span><span class="op" id="3764220">)</span>&nbsp;<span class="comment" id="3764222">//&nbsp;z2&nbsp;=&nbsp;x1*y1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3764238">//&nbsp;compute&nbsp;xd&nbsp;(or&nbsp;the&nbsp;negative&nbsp;value&nbsp;if&nbsp;underflow&nbsp;occurs)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3764297">s</span>&nbsp;<span class="op" id="3764299">:=</span>&nbsp;<span class="num" id="3764302">1</span>&nbsp;<span class="comment" id="3764304">//&nbsp;sign&nbsp;of&nbsp;product&nbsp;xd*yd</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3764330">xd</span>&nbsp;<span class="op" id="3764333">:=</span>&nbsp;<span class="ident" id="3764336">z</span><span class="op" id="3764337">[</span><span class="num" id="3764338">2</span><span class="op" id="3764339">*</span><span class="ident" id="3764340">n</span>&nbsp;<span class="op" id="3764342">:</span>&nbsp;<span class="num" id="3764344">2</span><span class="op" id="3764345">*</span><span class="ident" id="3764346">n</span><span class="op" id="3764347">+</span><span class="ident" id="3764348">n2</span><span class="op" id="3764350">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3764353">if</span>&nbsp;<span class="ident" id="3764356">subVV</span><span class="op" id="3764361">(</span><span class="ident" id="3764362">xd</span><span class="op" id="3764364">,</span>&nbsp;<span class="ident" id="3764366">x1</span><span class="op" id="3764368">,</span>&nbsp;<span class="ident" id="3764370">x0</span><span class="op" id="3764372">)</span>&nbsp;<span class="op" id="3764374">!=</span>&nbsp;<span class="num" id="3764377">0</span>&nbsp;<span class="op" id="3764379">{</span>&nbsp;<span class="comment" id="3764381">//&nbsp;x1-x0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3764392">s</span>&nbsp;<span class="op" id="3764394">=</span>&nbsp;<span class="op" id="3764396">-</span><span class="ident" id="3764397">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3764401">subVV</span><span class="op" id="3764406">(</span><span class="ident" id="3764407">xd</span><span class="op" id="3764409">,</span>&nbsp;<span class="ident" id="3764411">x0</span><span class="op" id="3764413">,</span>&nbsp;<span class="ident" id="3764415">x1</span><span class="op" id="3764417">)</span>&nbsp;<span class="comment" id="3764419">//&nbsp;x0-x1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3764429">}</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3764433">//&nbsp;compute&nbsp;yd&nbsp;(or&nbsp;the&nbsp;negative&nbsp;value&nbsp;if&nbsp;underflow&nbsp;occurs)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3764492">yd</span>&nbsp;<span class="op" id="3764495">:=</span>&nbsp;<span class="ident" id="3764498">z</span><span class="op" id="3764499">[</span><span class="num" id="3764500">2</span><span class="op" id="3764501">*</span><span class="ident" id="3764502">n</span><span class="op" id="3764503">+</span><span class="ident" id="3764504">n2</span>&nbsp;<span class="op" id="3764507">:</span>&nbsp;<span class="num" id="3764509">3</span><span class="op" id="3764510">*</span><span class="ident" id="3764511">n</span><span class="op" id="3764512">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3764515">if</span>&nbsp;<span class="ident" id="3764518">subVV</span><span class="op" id="3764523">(</span><span class="ident" id="3764524">yd</span><span class="op" id="3764526">,</span>&nbsp;<span class="ident" id="3764528">y0</span><span class="op" id="3764530">,</span>&nbsp;<span class="ident" id="3764532">y1</span><span class="op" id="3764534">)</span>&nbsp;<span class="op" id="3764536">!=</span>&nbsp;<span class="num" id="3764539">0</span>&nbsp;<span class="op" id="3764541">{</span>&nbsp;<span class="comment" id="3764543">//&nbsp;y0-y1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3764554">s</span>&nbsp;<span class="op" id="3764556">=</span>&nbsp;<span class="op" id="3764558">-</span><span class="ident" id="3764559">s</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3764563">subVV</span><span class="op" id="3764568">(</span><span class="ident" id="3764569">yd</span><span class="op" id="3764571">,</span>&nbsp;<span class="ident" id="3764573">y1</span><span class="op" id="3764575">,</span>&nbsp;<span class="ident" id="3764577">y0</span><span class="op" id="3764579">)</span>&nbsp;<span class="comment" id="3764581">//&nbsp;y1-y0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3764591">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3764595">//&nbsp;p&nbsp;=&nbsp;(x1-x0)*(y0-y1)&nbsp;==&nbsp;x1*y0&nbsp;-&nbsp;x1*y1&nbsp;-&nbsp;x0*y0&nbsp;+&nbsp;x0*y1&nbsp;for&nbsp;s&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3764662">//&nbsp;p&nbsp;=&nbsp;(x0-x1)*(y0-y1)&nbsp;==&nbsp;x0*y0&nbsp;-&nbsp;x0*y1&nbsp;-&nbsp;x1*y0&nbsp;+&nbsp;x1*y1&nbsp;for&nbsp;s&nbsp;&lt;&nbsp;0</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3764729">p</span>&nbsp;<span class="op" id="3764731">:=</span>&nbsp;<span class="ident" id="3764734">z</span><span class="op" id="3764735">[</span><span class="ident" id="3764736">n</span><span class="op" id="3764737">*</span><span class="num" id="3764738">3</span><span class="op" id="3764739">:</span><span class="op" id="3764740">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3764743">karatsuba</span><span class="op" id="3764752">(</span><span class="ident" id="3764753">p</span><span class="op" id="3764754">,</span>&nbsp;<span class="ident" id="3764756">xd</span><span class="op" id="3764758">,</span>&nbsp;<span class="ident" id="3764760">yd</span><span class="op" id="3764762">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3764766">//&nbsp;save&nbsp;original&nbsp;z2:z0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3764790">//&nbsp;(ok&nbsp;to&nbsp;use&nbsp;upper&nbsp;half&nbsp;of&nbsp;z&nbsp;since&nbsp;we&#39;re&nbsp;done&nbsp;recursing)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3764849">r</span>&nbsp;<span class="op" id="3764851">:=</span>&nbsp;<span class="ident" id="3764854">z</span><span class="op" id="3764855">[</span><span class="ident" id="3764856">n</span><span class="op" id="3764857">*</span><span class="num" id="3764858">4</span><span class="op" id="3764859">:</span><span class="op" id="3764860">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3764863">copy</span><span class="op" id="3764867">(</span><span class="ident" id="3764868">r</span><span class="op" id="3764869">,</span>&nbsp;<span class="ident" id="3764871">z</span><span class="op" id="3764872">[</span><span class="op" id="3764873">:</span><span class="ident" id="3764874">n</span><span class="op" id="3764875">*</span><span class="num" id="3764876">2</span><span class="op" id="3764877">]</span><span class="op" id="3764878">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3764882">//&nbsp;add&nbsp;up&nbsp;all&nbsp;partial&nbsp;products</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3764914">//</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3764918">//&nbsp;&nbsp;&nbsp;2*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3764940">//&nbsp;z&nbsp;=&nbsp;[&nbsp;z2&nbsp;&nbsp;|&nbsp;z0&nbsp;&nbsp;]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3764962">//&nbsp;&nbsp;&nbsp;+&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;z0&nbsp;&nbsp;]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3764981">//&nbsp;&nbsp;&nbsp;+&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;z2&nbsp;&nbsp;]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3765000">//&nbsp;&nbsp;&nbsp;+&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;&nbsp;p&nbsp;&nbsp;]</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3765019">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3765023">karatsubaAdd</span><span class="op" id="3765035">(</span><span class="ident" id="3765036">z</span><span class="op" id="3765037">[</span><span class="ident" id="3765038">n2</span><span class="op" id="3765040">:</span><span class="op" id="3765041">]</span><span class="op" id="3765042">,</span>&nbsp;<span class="ident" id="3765044">r</span><span class="op" id="3765045">,</span>&nbsp;<span class="ident" id="3765047">n</span><span class="op" id="3765048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3765051">karatsubaAdd</span><span class="op" id="3765063">(</span><span class="ident" id="3765064">z</span><span class="op" id="3765065">[</span><span class="ident" id="3765066">n2</span><span class="op" id="3765068">:</span><span class="op" id="3765069">]</span><span class="op" id="3765070">,</span>&nbsp;<span class="ident" id="3765072">r</span><span class="op" id="3765073">[</span><span class="ident" id="3765074">n</span><span class="op" id="3765075">:</span><span class="op" id="3765076">]</span><span class="op" id="3765077">,</span>&nbsp;<span class="ident" id="3765079">n</span><span class="op" id="3765080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3765083">if</span>&nbsp;<span class="ident" id="3765086">s</span>&nbsp;<span class="op" id="3765088">&gt;</span>&nbsp;<span class="num" id="3765090">0</span>&nbsp;<span class="op" id="3765092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3765096">karatsubaAdd</span><span class="op" id="3765108">(</span><span class="ident" id="3765109">z</span><span class="op" id="3765110">[</span><span class="ident" id="3765111">n2</span><span class="op" id="3765113">:</span><span class="op" id="3765114">]</span><span class="op" id="3765115">,</span>&nbsp;<span class="ident" id="3765117">p</span><span class="op" id="3765118">,</span>&nbsp;<span class="ident" id="3765120">n</span><span class="op" id="3765121">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3765124">}</span>&nbsp;<span class="keyword" id="3765126">else</span>&nbsp;<span class="op" id="3765131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3765135">karatsubaSub</span><span class="op" id="3765147">(</span><span class="ident" id="3765148">z</span><span class="op" id="3765149">[</span><span class="ident" id="3765150">n2</span><span class="op" id="3765152">:</span><span class="op" id="3765153">]</span><span class="op" id="3765154">,</span>&nbsp;<span class="ident" id="3765156">p</span><span class="op" id="3765157">,</span>&nbsp;<span class="ident" id="3765159">n</span><span class="op" id="3765160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3765163">}</span><br>
<span class="lineno"></span><span class="op" id="3765165">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span><span class="comment" id="3765168">//&nbsp;alias&nbsp;returns&nbsp;true&nbsp;if&nbsp;x&nbsp;and&nbsp;y&nbsp;share&nbsp;the&nbsp;same&nbsp;base&nbsp;array.</span><br>
<span class="lineno"></span><span class="keyword" id="3765228">func</span>&nbsp;<span class="ident" id="3765233">alias</span><span class="op" id="3765238">(</span><span class="ident" id="3765239">x</span><span class="op" id="3765240">,</span>&nbsp;<span class="ident" id="3765242">y</span>&nbsp;<span class="ident" id="3765244">nat</span><span class="op" id="3765247">)</span>&nbsp;<span class="builtintype" id="3765249">bool</span>&nbsp;<span class="op" id="3765254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3765257">return</span>&nbsp;<span class="builtinfunc" id="3765264">cap</span><span class="op" id="3765267">(</span><span class="ident" id="3765268">x</span><span class="op" id="3765269">)</span>&nbsp;<span class="op" id="3765271">&gt;</span>&nbsp;<span class="num" id="3765273">0</span>&nbsp;<span class="op" id="3765275">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3765278">cap</span><span class="op" id="3765281">(</span><span class="ident" id="3765282">y</span><span class="op" id="3765283">)</span>&nbsp;<span class="op" id="3765285">&gt;</span>&nbsp;<span class="num" id="3765287">0</span>&nbsp;<span class="op" id="3765289">&amp;&amp;</span>&nbsp;<span class="op" id="3765292">&amp;</span><span class="ident" id="3765293">x</span><span class="op" id="3765294">[</span><span class="num" id="3765295">0</span><span class="op" id="3765296">:</span><span class="builtinfunc" id="3765297">cap</span><span class="op" id="3765300">(</span><span class="ident" id="3765301">x</span><span class="op" id="3765302">)</span><span class="op" id="3765303">]</span><span class="op" id="3765304">[</span><span class="builtinfunc" id="3765305">cap</span><span class="op" id="3765308">(</span><span class="ident" id="3765309">x</span><span class="op" id="3765310">)</span><span class="op" id="3765311">-</span><span class="num" id="3765312">1</span><span class="op" id="3765313">]</span>&nbsp;<span class="op" id="3765315">==</span>&nbsp;<span class="op" id="3765318">&amp;</span><span class="ident" id="3765319">y</span><span class="op" id="3765320">[</span><span class="num" id="3765321">0</span><span class="op" id="3765322">:</span><span class="builtinfunc" id="3765323">cap</span><span class="op" id="3765326">(</span><span class="ident" id="3765327">y</span><span class="op" id="3765328">)</span><span class="op" id="3765329">]</span><span class="op" id="3765330">[</span><span class="builtinfunc" id="3765331">cap</span><span class="op" id="3765334">(</span><span class="ident" id="3765335">y</span><span class="op" id="3765336">)</span><span class="op" id="3765337">-</span><span class="num" id="3765338">1</span><span class="op" id="3765339">]</span><br>
<span class="lineno"></span><span class="op" id="3765341">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span><span class="comment" id="3765344">//&nbsp;addAt&nbsp;implements&nbsp;z&nbsp;+=&nbsp;x&lt;&lt;(_W*i);&nbsp;z&nbsp;must&nbsp;be&nbsp;long&nbsp;enough.</span><br>
<span class="lineno"></span><span class="comment" id="3765403">//&nbsp;(we&nbsp;don&#39;t&nbsp;use&nbsp;nat.add&nbsp;because&nbsp;we&nbsp;need&nbsp;z&nbsp;to&nbsp;stay&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span><span class="comment" id="3765463">//&nbsp;slice,&nbsp;and&nbsp;we&nbsp;don&#39;t&nbsp;need&nbsp;to&nbsp;normalize&nbsp;z&nbsp;after&nbsp;each&nbsp;addition)</span><br>
<span class="lineno"></span><span class="keyword" id="3765527">func</span>&nbsp;<span class="ident" id="3765532">addAt</span><span class="op" id="3765537">(</span><span class="ident" id="3765538">z</span><span class="op" id="3765539">,</span>&nbsp;<span class="ident" id="3765541">x</span>&nbsp;<span class="ident" id="3765543">nat</span><span class="op" id="3765546">,</span>&nbsp;<span class="ident" id="3765548">i</span>&nbsp;<span class="builtintype" id="3765550">int</span><span class="op" id="3765553">)</span>&nbsp;<span class="op" id="3765555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3765558">if</span>&nbsp;<span class="ident" id="3765561">n</span>&nbsp;<span class="op" id="3765563">:=</span>&nbsp;<span class="builtinfunc" id="3765566">len</span><span class="op" id="3765569">(</span><span class="ident" id="3765570">x</span><span class="op" id="3765571">)</span><span class="op" id="3765572">;</span>&nbsp;<span class="ident" id="3765574">n</span>&nbsp;<span class="op" id="3765576">&gt;</span>&nbsp;<span class="num" id="3765578">0</span>&nbsp;<span class="op" id="3765580">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3765584">if</span>&nbsp;<span class="ident" id="3765587">c</span>&nbsp;<span class="op" id="3765589">:=</span>&nbsp;<span class="ident" id="3765592">addVV</span><span class="op" id="3765597">(</span><span class="ident" id="3765598">z</span><span class="op" id="3765599">[</span><span class="ident" id="3765600">i</span><span class="op" id="3765601">:</span><span class="ident" id="3765602">i</span><span class="op" id="3765603">+</span><span class="ident" id="3765604">n</span><span class="op" id="3765605">]</span><span class="op" id="3765606">,</span>&nbsp;<span class="ident" id="3765608">z</span><span class="op" id="3765609">[</span><span class="ident" id="3765610">i</span><span class="op" id="3765611">:</span><span class="op" id="3765612">]</span><span class="op" id="3765613">,</span>&nbsp;<span class="ident" id="3765615">x</span><span class="op" id="3765616">)</span><span class="op" id="3765617">;</span>&nbsp;<span class="ident" id="3765619">c</span>&nbsp;<span class="op" id="3765621">!=</span>&nbsp;<span class="num" id="3765624">0</span>&nbsp;<span class="op" id="3765626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3765631">j</span>&nbsp;<span class="op" id="3765633">:=</span>&nbsp;<span class="ident" id="3765636">i</span>&nbsp;<span class="op" id="3765638">+</span>&nbsp;<span class="ident" id="3765640">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3765645">if</span>&nbsp;<span class="ident" id="3765648">j</span>&nbsp;<span class="op" id="3765650">&lt;</span>&nbsp;<span class="builtinfunc" id="3765652">len</span><span class="op" id="3765655">(</span><span class="ident" id="3765656">z</span><span class="op" id="3765657">)</span>&nbsp;<span class="op" id="3765659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3765665">addVW</span><span class="op" id="3765670">(</span><span class="ident" id="3765671">z</span><span class="op" id="3765672">[</span><span class="ident" id="3765673">j</span><span class="op" id="3765674">:</span><span class="op" id="3765675">]</span><span class="op" id="3765676">,</span>&nbsp;<span class="ident" id="3765678">z</span><span class="op" id="3765679">[</span><span class="ident" id="3765680">j</span><span class="op" id="3765681">:</span><span class="op" id="3765682">]</span><span class="op" id="3765683">,</span>&nbsp;<span class="ident" id="3765685">c</span><span class="op" id="3765686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3765691">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3765695">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3765698">}</span><br>
<span class="lineno"></span><span class="op" id="3765700">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3765703">func</span>&nbsp;<span class="ident" id="3765708">max</span><span class="op" id="3765711">(</span><span class="ident" id="3765712">x</span><span class="op" id="3765713">,</span>&nbsp;<span class="ident" id="3765715">y</span>&nbsp;<span class="builtintype" id="3765717">int</span><span class="op" id="3765720">)</span>&nbsp;<span class="builtintype" id="3765722">int</span>&nbsp;<span class="op" id="3765726">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3765729">if</span>&nbsp;<span class="ident" id="3765732">x</span>&nbsp;<span class="op" id="3765734">&gt;</span>&nbsp;<span class="ident" id="3765736">y</span>&nbsp;<span class="op" id="3765738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3765742">return</span>&nbsp;<span class="ident" id="3765749">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3765752">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3765755">return</span>&nbsp;<span class="ident" id="3765762">y</span><br>
<span class="lineno"></span><span class="op" id="3765764">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="comment" id="3765767">//&nbsp;karatsubaLen&nbsp;computes&nbsp;an&nbsp;approximation&nbsp;to&nbsp;the&nbsp;maximum&nbsp;k&nbsp;&lt;=&nbsp;n&nbsp;such&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="3765841">//&nbsp;k&nbsp;=&nbsp;p&lt;&lt;i&nbsp;for&nbsp;a&nbsp;number&nbsp;p&nbsp;&lt;=&nbsp;karatsubaThreshold&nbsp;and&nbsp;an&nbsp;i&nbsp;&gt;=&nbsp;0.&nbsp;Thus,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3765915">//&nbsp;result&nbsp;is&nbsp;the&nbsp;largest&nbsp;number&nbsp;that&nbsp;can&nbsp;be&nbsp;divided&nbsp;repeatedly&nbsp;by&nbsp;2&nbsp;before</span><br>
<span class="lineno"></span><span class="comment" id="3765990">//&nbsp;becoming&nbsp;about&nbsp;the&nbsp;value&nbsp;of&nbsp;karatsubaThreshold.</span><br>
<span class="lineno">370</span><span class="keyword" id="3766041">func</span>&nbsp;<span class="ident" id="3766046">karatsubaLen</span><span class="op" id="3766058">(</span><span class="ident" id="3766059">n</span>&nbsp;<span class="builtintype" id="3766061">int</span><span class="op" id="3766064">)</span>&nbsp;<span class="builtintype" id="3766066">int</span>&nbsp;<span class="op" id="3766070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3766073">i</span>&nbsp;<span class="op" id="3766075">:=</span>&nbsp;<span class="builtintype" id="3766078">uint</span><span class="op" id="3766082">(</span><span class="num" id="3766083">0</span><span class="op" id="3766084">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3766087">for</span>&nbsp;<span class="ident" id="3766091">n</span>&nbsp;<span class="op" id="3766093">&gt;</span>&nbsp;<span class="ident" id="3766095">karatsubaThreshold</span>&nbsp;<span class="op" id="3766114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3766118">n</span>&nbsp;<span class="op" id="3766120">&gt;&gt;=</span>&nbsp;<span class="num" id="3766124">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3766128">i</span><span class="op" id="3766129">++</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3766133">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3766136">return</span>&nbsp;<span class="ident" id="3766143">n</span>&nbsp;<span class="op" id="3766145">&lt;&lt;</span>&nbsp;<span class="ident" id="3766148">i</span><br>
<span class="lineno"></span><span class="op" id="3766150">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3766153">func</span>&nbsp;<span class="op" id="3766158">(</span><span class="ident" id="3766159">z</span>&nbsp;<span class="ident" id="3766161">nat</span><span class="op" id="3766164">)</span>&nbsp;<span class="ident" id="3766166">mul</span><span class="op" id="3766169">(</span><span class="ident" id="3766170">x</span><span class="op" id="3766171">,</span>&nbsp;<span class="ident" id="3766173">y</span>&nbsp;<span class="ident" id="3766175">nat</span><span class="op" id="3766178">)</span>&nbsp;<span class="ident" id="3766180">nat</span>&nbsp;<span class="op" id="3766184">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3766187">m</span>&nbsp;<span class="op" id="3766189">:=</span>&nbsp;<span class="builtinfunc" id="3766192">len</span><span class="op" id="3766195">(</span><span class="ident" id="3766196">x</span><span class="op" id="3766197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3766200">n</span>&nbsp;<span class="op" id="3766202">:=</span>&nbsp;<span class="builtinfunc" id="3766205">len</span><span class="op" id="3766208">(</span><span class="ident" id="3766209">y</span><span class="op" id="3766210">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3766214">switch</span>&nbsp;<span class="op" id="3766221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3766224">case</span>&nbsp;<span class="ident" id="3766229">m</span>&nbsp;<span class="op" id="3766231">&lt;</span>&nbsp;<span class="ident" id="3766233">n</span><span class="op" id="3766234">:</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3766238">return</span>&nbsp;<span class="ident" id="3766245">z</span><span class="op" id="3766246">.</span><span class="ident" id="3766247">mul</span><span class="op" id="3766250">(</span><span class="ident" id="3766251">y</span><span class="op" id="3766252">,</span>&nbsp;<span class="ident" id="3766254">x</span><span class="op" id="3766255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3766258">case</span>&nbsp;<span class="ident" id="3766263">m</span>&nbsp;<span class="op" id="3766265">==</span>&nbsp;<span class="num" id="3766268">0</span>&nbsp;<span class="op" id="3766270">||</span>&nbsp;<span class="ident" id="3766273">n</span>&nbsp;<span class="op" id="3766275">==</span>&nbsp;<span class="num" id="3766278">0</span><span class="op" id="3766279">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3766283">return</span>&nbsp;<span class="ident" id="3766290">z</span><span class="op" id="3766291">.</span><span class="builtinfunc" id="3766292">make</span><span class="op" id="3766296">(</span><span class="num" id="3766297">0</span><span class="op" id="3766298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3766301">case</span>&nbsp;<span class="ident" id="3766306">n</span>&nbsp;<span class="op" id="3766308">==</span>&nbsp;<span class="num" id="3766311">1</span><span class="op" id="3766312">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3766316">return</span>&nbsp;<span class="ident" id="3766323">z</span><span class="op" id="3766324">.</span><span class="ident" id="3766325">mulAddWW</span><span class="op" id="3766333">(</span><span class="ident" id="3766334">x</span><span class="op" id="3766335">,</span>&nbsp;<span class="ident" id="3766337">y</span><span class="op" id="3766338">[</span><span class="num" id="3766339">0</span><span class="op" id="3766340">]</span><span class="op" id="3766341">,</span>&nbsp;<span class="num" id="3766343">0</span><span class="op" id="3766344">)</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3766347">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3766350">//&nbsp;m&nbsp;&gt;=&nbsp;n&nbsp;&gt;&nbsp;1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3766366">//&nbsp;determine&nbsp;if&nbsp;z&nbsp;can&nbsp;be&nbsp;reused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3766399">if</span>&nbsp;<span class="ident" id="3766402">alias</span><span class="op" id="3766407">(</span><span class="ident" id="3766408">z</span><span class="op" id="3766409">,</span>&nbsp;<span class="ident" id="3766411">x</span><span class="op" id="3766412">)</span>&nbsp;<span class="op" id="3766414">||</span>&nbsp;<span class="ident" id="3766417">alias</span><span class="op" id="3766422">(</span><span class="ident" id="3766423">z</span><span class="op" id="3766424">,</span>&nbsp;<span class="ident" id="3766426">y</span><span class="op" id="3766427">)</span>&nbsp;<span class="op" id="3766429">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3766433">z</span>&nbsp;<span class="op" id="3766435">=</span>&nbsp;<span class="ident" id="3766437">nil</span>&nbsp;<span class="comment" id="3766441">//&nbsp;z&nbsp;is&nbsp;an&nbsp;alias&nbsp;for&nbsp;x&nbsp;or&nbsp;y&nbsp;-&nbsp;cannot&nbsp;reuse</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3766485">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3766489">//&nbsp;use&nbsp;basic&nbsp;multiplication&nbsp;if&nbsp;the&nbsp;numbers&nbsp;are&nbsp;small</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3766543">if</span>&nbsp;<span class="ident" id="3766546">n</span>&nbsp;<span class="op" id="3766548">&lt;</span>&nbsp;<span class="ident" id="3766550">karatsubaThreshold</span>&nbsp;<span class="op" id="3766569">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3766573">z</span>&nbsp;<span class="op" id="3766575">=</span>&nbsp;<span class="ident" id="3766577">z</span><span class="op" id="3766578">.</span><span class="builtinfunc" id="3766579">make</span><span class="op" id="3766583">(</span><span class="ident" id="3766584">m</span>&nbsp;<span class="op" id="3766586">+</span>&nbsp;<span class="ident" id="3766588">n</span><span class="op" id="3766589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3766593">basicMul</span><span class="op" id="3766601">(</span><span class="ident" id="3766602">z</span><span class="op" id="3766603">,</span>&nbsp;<span class="ident" id="3766605">x</span><span class="op" id="3766606">,</span>&nbsp;<span class="ident" id="3766608">y</span><span class="op" id="3766609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3766613">return</span>&nbsp;<span class="ident" id="3766620">z</span><span class="op" id="3766621">.</span><span class="ident" id="3766622">norm</span><span class="op" id="3766626">(</span><span class="op" id="3766627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3766630">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3766633">//&nbsp;m&nbsp;&gt;=&nbsp;n&nbsp;&amp;&amp;&nbsp;n&nbsp;&gt;=&nbsp;karatsubaThreshold&nbsp;&amp;&amp;&nbsp;n&nbsp;&gt;=&nbsp;2</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3766682">//&nbsp;determine&nbsp;Karatsuba&nbsp;length&nbsp;k&nbsp;such&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3766725">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3766729">//&nbsp;&nbsp;&nbsp;x&nbsp;=&nbsp;xh*b&nbsp;+&nbsp;x0&nbsp;&nbsp;(0&nbsp;&lt;=&nbsp;x0&nbsp;&lt;&nbsp;b)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3766764">//&nbsp;&nbsp;&nbsp;y&nbsp;=&nbsp;yh*b&nbsp;+&nbsp;y0&nbsp;&nbsp;(0&nbsp;&lt;=&nbsp;y0&nbsp;&lt;&nbsp;b)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3766799">//&nbsp;&nbsp;&nbsp;b&nbsp;=&nbsp;1&lt;&lt;(_W*k)&nbsp;&nbsp;(&#34;base&#34;&nbsp;of&nbsp;digits&nbsp;xi,&nbsp;yi)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3766846">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3766850">k</span>&nbsp;<span class="op" id="3766852">:=</span>&nbsp;<span class="ident" id="3766855">karatsubaLen</span><span class="op" id="3766867">(</span><span class="ident" id="3766868">n</span><span class="op" id="3766869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3766872">//&nbsp;k&nbsp;&lt;=&nbsp;n</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3766884">//&nbsp;multiply&nbsp;x0&nbsp;and&nbsp;y0&nbsp;via&nbsp;Karatsuba</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3766921">x0</span>&nbsp;<span class="op" id="3766924">:=</span>&nbsp;<span class="ident" id="3766927">x</span><span class="op" id="3766928">[</span><span class="num" id="3766929">0</span><span class="op" id="3766930">:</span><span class="ident" id="3766931">k</span><span class="op" id="3766932">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3766947">//&nbsp;x0&nbsp;is&nbsp;not&nbsp;normalized</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3766972">y0</span>&nbsp;<span class="op" id="3766975">:=</span>&nbsp;<span class="ident" id="3766978">y</span><span class="op" id="3766979">[</span><span class="num" id="3766980">0</span><span class="op" id="3766981">:</span><span class="ident" id="3766982">k</span><span class="op" id="3766983">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3766998">//&nbsp;y0&nbsp;is&nbsp;not&nbsp;normalized</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3767023">z</span>&nbsp;<span class="op" id="3767025">=</span>&nbsp;<span class="ident" id="3767027">z</span><span class="op" id="3767028">.</span><span class="builtinfunc" id="3767029">make</span><span class="op" id="3767033">(</span><span class="ident" id="3767034">max</span><span class="op" id="3767037">(</span><span class="num" id="3767038">6</span><span class="op" id="3767039">*</span><span class="ident" id="3767040">k</span><span class="op" id="3767041">,</span>&nbsp;<span class="ident" id="3767043">m</span><span class="op" id="3767044">+</span><span class="ident" id="3767045">n</span><span class="op" id="3767046">)</span><span class="op" id="3767047">)</span>&nbsp;<span class="comment" id="3767049">//&nbsp;enough&nbsp;space&nbsp;for&nbsp;karatsuba&nbsp;of&nbsp;x0*y0&nbsp;and&nbsp;full&nbsp;result&nbsp;of&nbsp;x*y</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3767112">karatsuba</span><span class="op" id="3767121">(</span><span class="ident" id="3767122">z</span><span class="op" id="3767123">,</span>&nbsp;<span class="ident" id="3767125">x0</span><span class="op" id="3767127">,</span>&nbsp;<span class="ident" id="3767129">y0</span><span class="op" id="3767131">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3767134">z</span>&nbsp;<span class="op" id="3767136">=</span>&nbsp;<span class="ident" id="3767138">z</span><span class="op" id="3767139">[</span><span class="num" id="3767140">0</span>&nbsp;<span class="op" id="3767142">:</span>&nbsp;<span class="ident" id="3767144">m</span><span class="op" id="3767145">+</span><span class="ident" id="3767146">n</span><span class="op" id="3767147">]</span>&nbsp;&nbsp;<span class="comment" id="3767150">//&nbsp;z&nbsp;has&nbsp;final&nbsp;length&nbsp;but&nbsp;may&nbsp;be&nbsp;incomplete</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3767195">z</span><span class="op" id="3767196">[</span><span class="num" id="3767197">2</span><span class="op" id="3767198">*</span><span class="ident" id="3767199">k</span><span class="op" id="3767200">:</span><span class="op" id="3767201">]</span><span class="op" id="3767202">.</span><span class="ident" id="3767203">clear</span><span class="op" id="3767208">(</span><span class="op" id="3767209">)</span>&nbsp;<span class="comment" id="3767211">//&nbsp;upper&nbsp;portion&nbsp;of&nbsp;z&nbsp;is&nbsp;garbage&nbsp;(and&nbsp;2*k&nbsp;&lt;=&nbsp;m+n&nbsp;since&nbsp;k&nbsp;&lt;=&nbsp;n&nbsp;&lt;=&nbsp;m)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3767281">//&nbsp;If&nbsp;xh&nbsp;!=&nbsp;0&nbsp;or&nbsp;yh&nbsp;!=&nbsp;0,&nbsp;add&nbsp;the&nbsp;missing&nbsp;terms&nbsp;to&nbsp;z.&nbsp;For</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3767340">//</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3767344">//&nbsp;&nbsp;&nbsp;xh&nbsp;=&nbsp;xi*b^i&nbsp;+&nbsp;...&nbsp;+&nbsp;x2*b^2&nbsp;+&nbsp;x1*b&nbsp;(0&nbsp;&lt;=&nbsp;xi&nbsp;&lt;&nbsp;b)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3767398">//&nbsp;&nbsp;&nbsp;yh&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y1*b&nbsp;(0&nbsp;&lt;=&nbsp;y1&nbsp;&lt;&nbsp;b)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3767452">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3767456">//&nbsp;the&nbsp;missing&nbsp;terms&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3767482">//</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3767486">//&nbsp;&nbsp;&nbsp;x0*y1*b&nbsp;and&nbsp;xi*y0*b^i,&nbsp;xi*y1*b^(i+1)&nbsp;for&nbsp;i&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3767539">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3767543">//&nbsp;since&nbsp;all&nbsp;the&nbsp;yi&nbsp;for&nbsp;i&nbsp;&gt;&nbsp;1&nbsp;are&nbsp;0&nbsp;by&nbsp;choice&nbsp;of&nbsp;k:&nbsp;If&nbsp;any&nbsp;of&nbsp;them</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3767611">//&nbsp;were&nbsp;&gt;&nbsp;0,&nbsp;then&nbsp;yh&nbsp;&gt;=&nbsp;b^2&nbsp;and&nbsp;thus&nbsp;y&nbsp;&gt;=&nbsp;b^2.&nbsp;Then&nbsp;k&#39;&nbsp;=&nbsp;k*2&nbsp;would</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3767679">//&nbsp;be&nbsp;a&nbsp;larger&nbsp;valid&nbsp;threshold&nbsp;contradicting&nbsp;the&nbsp;assumption&nbsp;about&nbsp;k.</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3767749">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3767753">if</span>&nbsp;<span class="ident" id="3767756">k</span>&nbsp;<span class="op" id="3767758">&lt;</span>&nbsp;<span class="ident" id="3767760">n</span>&nbsp;<span class="op" id="3767762">||</span>&nbsp;<span class="ident" id="3767765">m</span>&nbsp;<span class="op" id="3767767">!=</span>&nbsp;<span class="ident" id="3767770">n</span>&nbsp;<span class="op" id="3767772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3767776">var</span>&nbsp;<span class="ident" id="3767780">t</span>&nbsp;<span class="ident" id="3767782">nat</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3767789">//&nbsp;add&nbsp;x0*y1*b</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3767806">x0</span>&nbsp;<span class="op" id="3767809">:=</span>&nbsp;<span class="ident" id="3767812">x0</span><span class="op" id="3767814">.</span><span class="ident" id="3767815">norm</span><span class="op" id="3767819">(</span><span class="op" id="3767820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3767824">y1</span>&nbsp;<span class="op" id="3767827">:=</span>&nbsp;<span class="ident" id="3767830">y</span><span class="op" id="3767831">[</span><span class="ident" id="3767832">k</span><span class="op" id="3767833">:</span><span class="op" id="3767834">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3767842">//&nbsp;y1&nbsp;is&nbsp;normalized&nbsp;because&nbsp;y&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3767877">t</span>&nbsp;<span class="op" id="3767879">=</span>&nbsp;<span class="ident" id="3767881">t</span><span class="op" id="3767882">.</span><span class="ident" id="3767883">mul</span><span class="op" id="3767886">(</span><span class="ident" id="3767887">x0</span><span class="op" id="3767889">,</span>&nbsp;<span class="ident" id="3767891">y1</span><span class="op" id="3767893">)</span>&nbsp;<span class="comment" id="3767895">//&nbsp;update&nbsp;t&nbsp;so&nbsp;we&nbsp;don&#39;t&nbsp;lose&nbsp;t&#39;s&nbsp;underlying&nbsp;array</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3767947">addAt</span><span class="op" id="3767952">(</span><span class="ident" id="3767953">z</span><span class="op" id="3767954">,</span>&nbsp;<span class="ident" id="3767956">t</span><span class="op" id="3767957">,</span>&nbsp;<span class="ident" id="3767959">k</span><span class="op" id="3767960">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3767965">//&nbsp;add&nbsp;xi*y0&lt;&lt;i,&nbsp;xi*y1*b&lt;&lt;(i+k)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3767999">y0</span>&nbsp;<span class="op" id="3768002">:=</span>&nbsp;<span class="ident" id="3768005">y0</span><span class="op" id="3768007">.</span><span class="ident" id="3768008">norm</span><span class="op" id="3768012">(</span><span class="op" id="3768013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3768017">for</span>&nbsp;<span class="ident" id="3768021">i</span>&nbsp;<span class="op" id="3768023">:=</span>&nbsp;<span class="ident" id="3768026">k</span><span class="op" id="3768027">;</span>&nbsp;<span class="ident" id="3768029">i</span>&nbsp;<span class="op" id="3768031">&lt;</span>&nbsp;<span class="builtinfunc" id="3768033">len</span><span class="op" id="3768036">(</span><span class="ident" id="3768037">x</span><span class="op" id="3768038">)</span><span class="op" id="3768039">;</span>&nbsp;<span class="ident" id="3768041">i</span>&nbsp;<span class="op" id="3768043">+=</span>&nbsp;<span class="ident" id="3768046">k</span>&nbsp;<span class="op" id="3768048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3768053">xi</span>&nbsp;<span class="op" id="3768056">:=</span>&nbsp;<span class="ident" id="3768059">x</span><span class="op" id="3768060">[</span><span class="ident" id="3768061">i</span><span class="op" id="3768062">:</span><span class="op" id="3768063">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3768068">if</span>&nbsp;<span class="builtinfunc" id="3768071">len</span><span class="op" id="3768074">(</span><span class="ident" id="3768075">xi</span><span class="op" id="3768077">)</span>&nbsp;<span class="op" id="3768079">&gt;</span>&nbsp;<span class="ident" id="3768081">k</span>&nbsp;<span class="op" id="3768083">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3768089">xi</span>&nbsp;<span class="op" id="3768092">=</span>&nbsp;<span class="ident" id="3768094">xi</span><span class="op" id="3768096">[</span><span class="op" id="3768097">:</span><span class="ident" id="3768098">k</span><span class="op" id="3768099">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3768104">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3768109">xi</span>&nbsp;<span class="op" id="3768112">=</span>&nbsp;<span class="ident" id="3768114">xi</span><span class="op" id="3768116">.</span><span class="ident" id="3768117">norm</span><span class="op" id="3768121">(</span><span class="op" id="3768122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3768127">t</span>&nbsp;<span class="op" id="3768129">=</span>&nbsp;<span class="ident" id="3768131">t</span><span class="op" id="3768132">.</span><span class="ident" id="3768133">mul</span><span class="op" id="3768136">(</span><span class="ident" id="3768137">xi</span><span class="op" id="3768139">,</span>&nbsp;<span class="ident" id="3768141">y0</span><span class="op" id="3768143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3768148">addAt</span><span class="op" id="3768153">(</span><span class="ident" id="3768154">z</span><span class="op" id="3768155">,</span>&nbsp;<span class="ident" id="3768157">t</span><span class="op" id="3768158">,</span>&nbsp;<span class="ident" id="3768160">i</span><span class="op" id="3768161">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3768166">t</span>&nbsp;<span class="op" id="3768168">=</span>&nbsp;<span class="ident" id="3768170">t</span><span class="op" id="3768171">.</span><span class="ident" id="3768172">mul</span><span class="op" id="3768175">(</span><span class="ident" id="3768176">xi</span><span class="op" id="3768178">,</span>&nbsp;<span class="ident" id="3768180">y1</span><span class="op" id="3768182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3768187">addAt</span><span class="op" id="3768192">(</span><span class="ident" id="3768193">z</span><span class="op" id="3768194">,</span>&nbsp;<span class="ident" id="3768196">t</span><span class="op" id="3768197">,</span>&nbsp;<span class="ident" id="3768199">i</span><span class="op" id="3768200">+</span><span class="ident" id="3768201">k</span><span class="op" id="3768202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3768206">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3768209">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3768213">return</span>&nbsp;<span class="ident" id="3768220">z</span><span class="op" id="3768221">.</span><span class="ident" id="3768222">norm</span><span class="op" id="3768226">(</span><span class="op" id="3768227">)</span><br>
<span class="lineno"></span><span class="op" id="3768229">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3768232">//&nbsp;mulRange&nbsp;computes&nbsp;the&nbsp;product&nbsp;of&nbsp;all&nbsp;the&nbsp;unsigned&nbsp;integers&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3768301">//&nbsp;range&nbsp;[a,&nbsp;b]&nbsp;inclusively.&nbsp;If&nbsp;a&nbsp;&gt;&nbsp;b&nbsp;(empty&nbsp;range),&nbsp;the&nbsp;result&nbsp;is&nbsp;1.</span><br>
<span class="lineno">465</span><span class="keyword" id="3768371">func</span>&nbsp;<span class="op" id="3768376">(</span><span class="ident" id="3768377">z</span>&nbsp;<span class="ident" id="3768379">nat</span><span class="op" id="3768382">)</span>&nbsp;<span class="ident" id="3768384">mulRange</span><span class="op" id="3768392">(</span><span class="ident" id="3768393">a</span><span class="op" id="3768394">,</span>&nbsp;<span class="ident" id="3768396">b</span>&nbsp;<span class="ident" id="3768398">uint64</span><span class="op" id="3768404">)</span>&nbsp;<span class="ident" id="3768406">nat</span>&nbsp;<span class="op" id="3768410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3768413">switch</span>&nbsp;<span class="op" id="3768420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3768423">case</span>&nbsp;<span class="ident" id="3768428">a</span>&nbsp;<span class="op" id="3768430">==</span>&nbsp;<span class="num" id="3768433">0</span><span class="op" id="3768434">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3768438">//&nbsp;cut&nbsp;long&nbsp;ranges&nbsp;short&nbsp;(optimization)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3768480">return</span>&nbsp;<span class="ident" id="3768487">z</span><span class="op" id="3768488">.</span><span class="ident" id="3768489">setUint64</span><span class="op" id="3768498">(</span><span class="num" id="3768499">0</span><span class="op" id="3768500">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3768503">case</span>&nbsp;<span class="ident" id="3768508">a</span>&nbsp;<span class="op" id="3768510">&gt;</span>&nbsp;<span class="ident" id="3768512">b</span><span class="op" id="3768513">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3768517">return</span>&nbsp;<span class="ident" id="3768524">z</span><span class="op" id="3768525">.</span><span class="ident" id="3768526">setUint64</span><span class="op" id="3768535">(</span><span class="num" id="3768536">1</span><span class="op" id="3768537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3768540">case</span>&nbsp;<span class="ident" id="3768545">a</span>&nbsp;<span class="op" id="3768547">==</span>&nbsp;<span class="ident" id="3768550">b</span><span class="op" id="3768551">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3768555">return</span>&nbsp;<span class="ident" id="3768562">z</span><span class="op" id="3768563">.</span><span class="ident" id="3768564">setUint64</span><span class="op" id="3768573">(</span><span class="ident" id="3768574">a</span><span class="op" id="3768575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3768578">case</span>&nbsp;<span class="ident" id="3768583">a</span><span class="op" id="3768584">+</span><span class="num" id="3768585">1</span>&nbsp;<span class="op" id="3768587">==</span>&nbsp;<span class="ident" id="3768590">b</span><span class="op" id="3768591">:</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3768595">return</span>&nbsp;<span class="ident" id="3768602">z</span><span class="op" id="3768603">.</span><span class="ident" id="3768604">mul</span><span class="op" id="3768607">(</span><span class="ident" id="3768608">nat</span><span class="op" id="3768611">(</span><span class="ident" id="3768612">nil</span><span class="op" id="3768615">)</span><span class="op" id="3768616">.</span><span class="ident" id="3768617">setUint64</span><span class="op" id="3768626">(</span><span class="ident" id="3768627">a</span><span class="op" id="3768628">)</span><span class="op" id="3768629">,</span>&nbsp;<span class="ident" id="3768631">nat</span><span class="op" id="3768634">(</span><span class="ident" id="3768635">nil</span><span class="op" id="3768638">)</span><span class="op" id="3768639">.</span><span class="ident" id="3768640">setUint64</span><span class="op" id="3768649">(</span><span class="ident" id="3768650">b</span><span class="op" id="3768651">)</span><span class="op" id="3768652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3768655">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3768658">m</span>&nbsp;<span class="op" id="3768660">:=</span>&nbsp;<span class="op" id="3768663">(</span><span class="ident" id="3768664">a</span>&nbsp;<span class="op" id="3768666">+</span>&nbsp;<span class="ident" id="3768668">b</span><span class="op" id="3768669">)</span>&nbsp;<span class="op" id="3768671">/</span>&nbsp;<span class="num" id="3768673">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3768676">return</span>&nbsp;<span class="ident" id="3768683">z</span><span class="op" id="3768684">.</span><span class="ident" id="3768685">mul</span><span class="op" id="3768688">(</span><span class="ident" id="3768689">nat</span><span class="op" id="3768692">(</span><span class="ident" id="3768693">nil</span><span class="op" id="3768696">)</span><span class="op" id="3768697">.</span><span class="ident" id="3768698">mulRange</span><span class="op" id="3768706">(</span><span class="ident" id="3768707">a</span><span class="op" id="3768708">,</span>&nbsp;<span class="ident" id="3768710">m</span><span class="op" id="3768711">)</span><span class="op" id="3768712">,</span>&nbsp;<span class="ident" id="3768714">nat</span><span class="op" id="3768717">(</span><span class="ident" id="3768718">nil</span><span class="op" id="3768721">)</span><span class="op" id="3768722">.</span><span class="ident" id="3768723">mulRange</span><span class="op" id="3768731">(</span><span class="ident" id="3768732">m</span><span class="op" id="3768733">+</span><span class="num" id="3768734">1</span><span class="op" id="3768735">,</span>&nbsp;<span class="ident" id="3768737">b</span><span class="op" id="3768738">)</span><span class="op" id="3768739">)</span><br>
<span class="lineno"></span><span class="op" id="3768741">}</span><br>
<span class="lineno">480</span><br>
<span class="lineno"></span><span class="comment" id="3768744">//&nbsp;q&nbsp;=&nbsp;(x-r)/y,&nbsp;with&nbsp;0&nbsp;&lt;=&nbsp;r&nbsp;&lt;&nbsp;y</span><br>
<span class="lineno"></span><span class="keyword" id="3768776">func</span>&nbsp;<span class="op" id="3768781">(</span><span class="ident" id="3768782">z</span>&nbsp;<span class="ident" id="3768784">nat</span><span class="op" id="3768787">)</span>&nbsp;<span class="ident" id="3768789">divW</span><span class="op" id="3768793">(</span><span class="ident" id="3768794">x</span>&nbsp;<span class="ident" id="3768796">nat</span><span class="op" id="3768799">,</span>&nbsp;<span class="ident" id="3768801">y</span>&nbsp;<span class="ident" id="3768803">Word</span><span class="op" id="3768807">)</span>&nbsp;<span class="op" id="3768809">(</span><span class="ident" id="3768810">q</span>&nbsp;<span class="ident" id="3768812">nat</span><span class="op" id="3768815">,</span>&nbsp;<span class="ident" id="3768817">r</span>&nbsp;<span class="ident" id="3768819">Word</span><span class="op" id="3768823">)</span>&nbsp;<span class="op" id="3768825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3768828">m</span>&nbsp;<span class="op" id="3768830">:=</span>&nbsp;<span class="builtinfunc" id="3768833">len</span><span class="op" id="3768836">(</span><span class="ident" id="3768837">x</span><span class="op" id="3768838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3768841">switch</span>&nbsp;<span class="op" id="3768848">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3768851">case</span>&nbsp;<span class="ident" id="3768856">y</span>&nbsp;<span class="op" id="3768858">==</span>&nbsp;<span class="num" id="3768861">0</span><span class="op" id="3768862">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3768866">panic</span><span class="op" id="3768871">(</span><span class="string" id="3768872">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="3768890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3768893">case</span>&nbsp;<span class="ident" id="3768898">y</span>&nbsp;<span class="op" id="3768900">==</span>&nbsp;<span class="num" id="3768903">1</span><span class="op" id="3768904">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3768908">q</span>&nbsp;<span class="op" id="3768910">=</span>&nbsp;<span class="ident" id="3768912">z</span><span class="op" id="3768913">.</span><span class="ident" id="3768914">set</span><span class="op" id="3768917">(</span><span class="ident" id="3768918">x</span><span class="op" id="3768919">)</span>&nbsp;<span class="comment" id="3768921">//&nbsp;result&nbsp;is&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3768938">return</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3768946">case</span>&nbsp;<span class="ident" id="3768951">m</span>&nbsp;<span class="op" id="3768953">==</span>&nbsp;<span class="num" id="3768956">0</span><span class="op" id="3768957">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3768961">q</span>&nbsp;<span class="op" id="3768963">=</span>&nbsp;<span class="ident" id="3768965">z</span><span class="op" id="3768966">.</span><span class="builtinfunc" id="3768967">make</span><span class="op" id="3768971">(</span><span class="num" id="3768972">0</span><span class="op" id="3768973">)</span>&nbsp;<span class="comment" id="3768975">//&nbsp;result&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3768992">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3769000">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3769003">//&nbsp;m&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3769013">z</span>&nbsp;<span class="op" id="3769015">=</span>&nbsp;<span class="ident" id="3769017">z</span><span class="op" id="3769018">.</span><span class="builtinfunc" id="3769019">make</span><span class="op" id="3769023">(</span><span class="ident" id="3769024">m</span><span class="op" id="3769025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3769028">r</span>&nbsp;<span class="op" id="3769030">=</span>&nbsp;<span class="ident" id="3769032">divWVW</span><span class="op" id="3769038">(</span><span class="ident" id="3769039">z</span><span class="op" id="3769040">,</span>&nbsp;<span class="num" id="3769042">0</span><span class="op" id="3769043">,</span>&nbsp;<span class="ident" id="3769045">x</span><span class="op" id="3769046">,</span>&nbsp;<span class="ident" id="3769048">y</span><span class="op" id="3769049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3769052">q</span>&nbsp;<span class="op" id="3769054">=</span>&nbsp;<span class="ident" id="3769056">z</span><span class="op" id="3769057">.</span><span class="ident" id="3769058">norm</span><span class="op" id="3769062">(</span><span class="op" id="3769063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3769066">return</span><br>
<span class="lineno"></span><span class="op" id="3769073">}</span><br>
<span class="lineno">500</span><br>
<span class="lineno"></span><span class="keyword" id="3769076">func</span>&nbsp;<span class="op" id="3769081">(</span><span class="ident" id="3769082">z</span>&nbsp;<span class="ident" id="3769084">nat</span><span class="op" id="3769087">)</span>&nbsp;<span class="ident" id="3769089">div</span><span class="op" id="3769092">(</span><span class="ident" id="3769093">z2</span><span class="op" id="3769095">,</span>&nbsp;<span class="ident" id="3769097">u</span><span class="op" id="3769098">,</span>&nbsp;<span class="ident" id="3769100">v</span>&nbsp;<span class="ident" id="3769102">nat</span><span class="op" id="3769105">)</span>&nbsp;<span class="op" id="3769107">(</span><span class="ident" id="3769108">q</span><span class="op" id="3769109">,</span>&nbsp;<span class="ident" id="3769111">r</span>&nbsp;<span class="ident" id="3769113">nat</span><span class="op" id="3769116">)</span>&nbsp;<span class="op" id="3769118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3769121">if</span>&nbsp;<span class="builtinfunc" id="3769124">len</span><span class="op" id="3769127">(</span><span class="ident" id="3769128">v</span><span class="op" id="3769129">)</span>&nbsp;<span class="op" id="3769131">==</span>&nbsp;<span class="num" id="3769134">0</span>&nbsp;<span class="op" id="3769136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3769140">panic</span><span class="op" id="3769145">(</span><span class="string" id="3769146">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="3769164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3769167">}</span><br>
<span class="lineno">505</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3769171">if</span>&nbsp;<span class="ident" id="3769174">u</span><span class="op" id="3769175">.</span><span class="ident" id="3769176">cmp</span><span class="op" id="3769179">(</span><span class="ident" id="3769180">v</span><span class="op" id="3769181">)</span>&nbsp;<span class="op" id="3769183">&lt;</span>&nbsp;<span class="num" id="3769185">0</span>&nbsp;<span class="op" id="3769187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3769191">q</span>&nbsp;<span class="op" id="3769193">=</span>&nbsp;<span class="ident" id="3769195">z</span><span class="op" id="3769196">.</span><span class="builtinfunc" id="3769197">make</span><span class="op" id="3769201">(</span><span class="num" id="3769202">0</span><span class="op" id="3769203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3769207">r</span>&nbsp;<span class="op" id="3769209">=</span>&nbsp;<span class="ident" id="3769211">z2</span><span class="op" id="3769213">.</span><span class="ident" id="3769214">set</span><span class="op" id="3769217">(</span><span class="ident" id="3769218">u</span><span class="op" id="3769219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3769223">return</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3769231">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3769235">if</span>&nbsp;<span class="builtinfunc" id="3769238">len</span><span class="op" id="3769241">(</span><span class="ident" id="3769242">v</span><span class="op" id="3769243">)</span>&nbsp;<span class="op" id="3769245">==</span>&nbsp;<span class="num" id="3769248">1</span>&nbsp;<span class="op" id="3769250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3769254">var</span>&nbsp;<span class="ident" id="3769258">r2</span>&nbsp;<span class="ident" id="3769261">Word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3769268">q</span><span class="op" id="3769269">,</span>&nbsp;<span class="ident" id="3769271">r2</span>&nbsp;<span class="op" id="3769274">=</span>&nbsp;<span class="ident" id="3769276">z</span><span class="op" id="3769277">.</span><span class="ident" id="3769278">divW</span><span class="op" id="3769282">(</span><span class="ident" id="3769283">u</span><span class="op" id="3769284">,</span>&nbsp;<span class="ident" id="3769286">v</span><span class="op" id="3769287">[</span><span class="num" id="3769288">0</span><span class="op" id="3769289">]</span><span class="op" id="3769290">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3769294">r</span>&nbsp;<span class="op" id="3769296">=</span>&nbsp;<span class="ident" id="3769298">z2</span><span class="op" id="3769300">.</span><span class="ident" id="3769301">setWord</span><span class="op" id="3769308">(</span><span class="ident" id="3769309">r2</span><span class="op" id="3769311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3769315">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3769323">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3769327">q</span><span class="op" id="3769328">,</span>&nbsp;<span class="ident" id="3769330">r</span>&nbsp;<span class="op" id="3769332">=</span>&nbsp;<span class="ident" id="3769334">z</span><span class="op" id="3769335">.</span><span class="ident" id="3769336">divLarge</span><span class="op" id="3769344">(</span><span class="ident" id="3769345">z2</span><span class="op" id="3769347">,</span>&nbsp;<span class="ident" id="3769349">u</span><span class="op" id="3769350">,</span>&nbsp;<span class="ident" id="3769352">v</span><span class="op" id="3769353">)</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3769356">return</span><br>
<span class="lineno"></span><span class="op" id="3769363">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3769366">//&nbsp;q&nbsp;=&nbsp;(uIn-r)/v,&nbsp;with&nbsp;0&nbsp;&lt;=&nbsp;r&nbsp;&lt;&nbsp;y</span><br>
<span class="lineno"></span><span class="comment" id="3769400">//&nbsp;Uses&nbsp;z&nbsp;as&nbsp;storage&nbsp;for&nbsp;q,&nbsp;and&nbsp;u&nbsp;as&nbsp;storage&nbsp;for&nbsp;r&nbsp;if&nbsp;possible.</span><br>
<span class="lineno">525</span><span class="comment" id="3769464">//&nbsp;See&nbsp;Knuth,&nbsp;Volume&nbsp;2,&nbsp;section&nbsp;4.3.1,&nbsp;Algorithm&nbsp;D.</span><br>
<span class="lineno"></span><span class="comment" id="3769516">//&nbsp;Preconditions:</span><br>
<span class="lineno"></span><span class="comment" id="3769534">//&nbsp;&nbsp;&nbsp;&nbsp;len(v)&nbsp;&gt;=&nbsp;2</span><br>
<span class="lineno"></span><span class="comment" id="3769552">//&nbsp;&nbsp;&nbsp;&nbsp;len(uIn)&nbsp;&gt;=&nbsp;len(v)</span><br>
<span class="lineno"></span><span class="keyword" id="3769577">func</span>&nbsp;<span class="op" id="3769582">(</span><span class="ident" id="3769583">z</span>&nbsp;<span class="ident" id="3769585">nat</span><span class="op" id="3769588">)</span>&nbsp;<span class="ident" id="3769590">divLarge</span><span class="op" id="3769598">(</span><span class="ident" id="3769599">u</span><span class="op" id="3769600">,</span>&nbsp;<span class="ident" id="3769602">uIn</span><span class="op" id="3769605">,</span>&nbsp;<span class="ident" id="3769607">v</span>&nbsp;<span class="ident" id="3769609">nat</span><span class="op" id="3769612">)</span>&nbsp;<span class="op" id="3769614">(</span><span class="ident" id="3769615">q</span><span class="op" id="3769616">,</span>&nbsp;<span class="ident" id="3769618">r</span>&nbsp;<span class="ident" id="3769620">nat</span><span class="op" id="3769623">)</span>&nbsp;<span class="op" id="3769625">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3769628">n</span>&nbsp;<span class="op" id="3769630">:=</span>&nbsp;<span class="builtinfunc" id="3769633">len</span><span class="op" id="3769636">(</span><span class="ident" id="3769637">v</span><span class="op" id="3769638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3769641">m</span>&nbsp;<span class="op" id="3769643">:=</span>&nbsp;<span class="builtinfunc" id="3769646">len</span><span class="op" id="3769649">(</span><span class="ident" id="3769650">uIn</span><span class="op" id="3769653">)</span>&nbsp;<span class="op" id="3769655">-</span>&nbsp;<span class="ident" id="3769657">n</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3769661">//&nbsp;determine&nbsp;if&nbsp;z&nbsp;can&nbsp;be&nbsp;reused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3769694">//&nbsp;TODO(gri)&nbsp;should&nbsp;find&nbsp;a&nbsp;better&nbsp;solution&nbsp;-&nbsp;this&nbsp;if&nbsp;statement</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3769758">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is&nbsp;very&nbsp;costly&nbsp;(see&nbsp;e.g.&nbsp;time&nbsp;pidigits&nbsp;-s&nbsp;-n&nbsp;10000)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3769824">if</span>&nbsp;<span class="ident" id="3769827">alias</span><span class="op" id="3769832">(</span><span class="ident" id="3769833">z</span><span class="op" id="3769834">,</span>&nbsp;<span class="ident" id="3769836">uIn</span><span class="op" id="3769839">)</span>&nbsp;<span class="op" id="3769841">||</span>&nbsp;<span class="ident" id="3769844">alias</span><span class="op" id="3769849">(</span><span class="ident" id="3769850">z</span><span class="op" id="3769851">,</span>&nbsp;<span class="ident" id="3769853">v</span><span class="op" id="3769854">)</span>&nbsp;<span class="op" id="3769856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3769860">z</span>&nbsp;<span class="op" id="3769862">=</span>&nbsp;<span class="ident" id="3769864">nil</span>&nbsp;<span class="comment" id="3769868">//&nbsp;z&nbsp;is&nbsp;an&nbsp;alias&nbsp;for&nbsp;uIn&nbsp;or&nbsp;v&nbsp;-&nbsp;cannot&nbsp;reuse</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3769914">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3769917">q</span>&nbsp;<span class="op" id="3769919">=</span>&nbsp;<span class="ident" id="3769921">z</span><span class="op" id="3769922">.</span><span class="builtinfunc" id="3769923">make</span><span class="op" id="3769927">(</span><span class="ident" id="3769928">m</span>&nbsp;<span class="op" id="3769930">+</span>&nbsp;<span class="num" id="3769932">1</span><span class="op" id="3769933">)</span><br>
<span class="lineno">540</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3769937">qhatv</span>&nbsp;<span class="op" id="3769943">:=</span>&nbsp;<span class="builtinfunc" id="3769946">make</span><span class="op" id="3769950">(</span><span class="ident" id="3769951">nat</span><span class="op" id="3769954">,</span>&nbsp;<span class="ident" id="3769956">n</span><span class="op" id="3769957">+</span><span class="num" id="3769958">1</span><span class="op" id="3769959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3769962">if</span>&nbsp;<span class="ident" id="3769965">alias</span><span class="op" id="3769970">(</span><span class="ident" id="3769971">u</span><span class="op" id="3769972">,</span>&nbsp;<span class="ident" id="3769974">uIn</span><span class="op" id="3769977">)</span>&nbsp;<span class="op" id="3769979">||</span>&nbsp;<span class="ident" id="3769982">alias</span><span class="op" id="3769987">(</span><span class="ident" id="3769988">u</span><span class="op" id="3769989">,</span>&nbsp;<span class="ident" id="3769991">v</span><span class="op" id="3769992">)</span>&nbsp;<span class="op" id="3769994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3769998">u</span>&nbsp;<span class="op" id="3770000">=</span>&nbsp;<span class="ident" id="3770002">nil</span>&nbsp;<span class="comment" id="3770006">//&nbsp;u&nbsp;is&nbsp;an&nbsp;alias&nbsp;for&nbsp;uIn&nbsp;or&nbsp;v&nbsp;-&nbsp;cannot&nbsp;reuse</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3770052">}</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3770055">u</span>&nbsp;<span class="op" id="3770057">=</span>&nbsp;<span class="ident" id="3770059">u</span><span class="op" id="3770060">.</span><span class="builtinfunc" id="3770061">make</span><span class="op" id="3770065">(</span><span class="builtinfunc" id="3770066">len</span><span class="op" id="3770069">(</span><span class="ident" id="3770070">uIn</span><span class="op" id="3770073">)</span>&nbsp;<span class="op" id="3770075">+</span>&nbsp;<span class="num" id="3770077">1</span><span class="op" id="3770078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3770081">u</span><span class="op" id="3770082">.</span><span class="ident" id="3770083">clear</span><span class="op" id="3770088">(</span><span class="op" id="3770089">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3770093">//&nbsp;D1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3770101">shift</span>&nbsp;<span class="op" id="3770107">:=</span>&nbsp;<span class="ident" id="3770110">leadingZeros</span><span class="op" id="3770122">(</span><span class="ident" id="3770123">v</span><span class="op" id="3770124">[</span><span class="ident" id="3770125">n</span><span class="op" id="3770126">-</span><span class="num" id="3770127">1</span><span class="op" id="3770128">]</span><span class="op" id="3770129">)</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3770132">if</span>&nbsp;<span class="ident" id="3770135">shift</span>&nbsp;<span class="op" id="3770141">&gt;</span>&nbsp;<span class="num" id="3770143">0</span>&nbsp;<span class="op" id="3770145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3770149">//&nbsp;do&nbsp;not&nbsp;modify&nbsp;v,&nbsp;it&nbsp;may&nbsp;be&nbsp;used&nbsp;by&nbsp;another&nbsp;goroutine&nbsp;simultaneously</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3770222">v1</span>&nbsp;<span class="op" id="3770225">:=</span>&nbsp;<span class="builtinfunc" id="3770228">make</span><span class="op" id="3770232">(</span><span class="ident" id="3770233">nat</span><span class="op" id="3770236">,</span>&nbsp;<span class="ident" id="3770238">n</span><span class="op" id="3770239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3770243">shlVU</span><span class="op" id="3770248">(</span><span class="ident" id="3770249">v1</span><span class="op" id="3770251">,</span>&nbsp;<span class="ident" id="3770253">v</span><span class="op" id="3770254">,</span>&nbsp;<span class="ident" id="3770256">shift</span><span class="op" id="3770261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3770265">v</span>&nbsp;<span class="op" id="3770267">=</span>&nbsp;<span class="ident" id="3770269">v1</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3770273">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3770276">u</span><span class="op" id="3770277">[</span><span class="builtinfunc" id="3770278">len</span><span class="op" id="3770281">(</span><span class="ident" id="3770282">uIn</span><span class="op" id="3770285">)</span><span class="op" id="3770286">]</span>&nbsp;<span class="op" id="3770288">=</span>&nbsp;<span class="ident" id="3770290">shlVU</span><span class="op" id="3770295">(</span><span class="ident" id="3770296">u</span><span class="op" id="3770297">[</span><span class="num" id="3770298">0</span><span class="op" id="3770299">:</span><span class="builtinfunc" id="3770300">len</span><span class="op" id="3770303">(</span><span class="ident" id="3770304">uIn</span><span class="op" id="3770307">)</span><span class="op" id="3770308">]</span><span class="op" id="3770309">,</span>&nbsp;<span class="ident" id="3770311">uIn</span><span class="op" id="3770314">,</span>&nbsp;<span class="ident" id="3770316">shift</span><span class="op" id="3770321">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3770325">//&nbsp;D2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3770333">for</span>&nbsp;<span class="ident" id="3770337">j</span>&nbsp;<span class="op" id="3770339">:=</span>&nbsp;<span class="ident" id="3770342">m</span><span class="op" id="3770343">;</span>&nbsp;<span class="ident" id="3770345">j</span>&nbsp;<span class="op" id="3770347">&gt;=</span>&nbsp;<span class="num" id="3770350">0</span><span class="op" id="3770351">;</span>&nbsp;<span class="ident" id="3770353">j</span><span class="op" id="3770354">--</span>&nbsp;<span class="op" id="3770357">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3770361">//&nbsp;D3.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3770370">qhat</span>&nbsp;<span class="op" id="3770375">:=</span>&nbsp;<span class="ident" id="3770378">Word</span><span class="op" id="3770382">(</span><span class="ident" id="3770383">_M</span><span class="op" id="3770385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3770389">if</span>&nbsp;<span class="ident" id="3770392">u</span><span class="op" id="3770393">[</span><span class="ident" id="3770394">j</span><span class="op" id="3770395">+</span><span class="ident" id="3770396">n</span><span class="op" id="3770397">]</span>&nbsp;<span class="op" id="3770399">!=</span>&nbsp;<span class="ident" id="3770402">v</span><span class="op" id="3770403">[</span><span class="ident" id="3770404">n</span><span class="op" id="3770405">-</span><span class="num" id="3770406">1</span><span class="op" id="3770407">]</span>&nbsp;<span class="op" id="3770409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3770414">var</span>&nbsp;<span class="ident" id="3770418">rhat</span>&nbsp;<span class="ident" id="3770423">Word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3770431">qhat</span><span class="op" id="3770435">,</span>&nbsp;<span class="ident" id="3770437">rhat</span>&nbsp;<span class="op" id="3770442">=</span>&nbsp;<span class="ident" id="3770444">divWW</span><span class="op" id="3770449">(</span><span class="ident" id="3770450">u</span><span class="op" id="3770451">[</span><span class="ident" id="3770452">j</span><span class="op" id="3770453">+</span><span class="ident" id="3770454">n</span><span class="op" id="3770455">]</span><span class="op" id="3770456">,</span>&nbsp;<span class="ident" id="3770458">u</span><span class="op" id="3770459">[</span><span class="ident" id="3770460">j</span><span class="op" id="3770461">+</span><span class="ident" id="3770462">n</span><span class="op" id="3770463">-</span><span class="num" id="3770464">1</span><span class="op" id="3770465">]</span><span class="op" id="3770466">,</span>&nbsp;<span class="ident" id="3770468">v</span><span class="op" id="3770469">[</span><span class="ident" id="3770470">n</span><span class="op" id="3770471">-</span><span class="num" id="3770472">1</span><span class="op" id="3770473">]</span><span class="op" id="3770474">)</span><br>
<span class="lineno">565</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3770480">//&nbsp;x1&nbsp;|&nbsp;x2&nbsp;=&nbsp;q̂v_{n-2}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3770507">x1</span><span class="op" id="3770509">,</span>&nbsp;<span class="ident" id="3770511">x2</span>&nbsp;<span class="op" id="3770514">:=</span>&nbsp;<span class="ident" id="3770517">mulWW</span><span class="op" id="3770522">(</span><span class="ident" id="3770523">qhat</span><span class="op" id="3770527">,</span>&nbsp;<span class="ident" id="3770529">v</span><span class="op" id="3770530">[</span><span class="ident" id="3770531">n</span><span class="op" id="3770532">-</span><span class="num" id="3770533">2</span><span class="op" id="3770534">]</span><span class="op" id="3770535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3770540">//&nbsp;test&nbsp;if&nbsp;q̂v_{n-2}&nbsp;&gt;&nbsp;br̂&nbsp;+&nbsp;u_{j+n-2}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3770584">for</span>&nbsp;<span class="ident" id="3770588">greaterThan</span><span class="op" id="3770599">(</span><span class="ident" id="3770600">x1</span><span class="op" id="3770602">,</span>&nbsp;<span class="ident" id="3770604">x2</span><span class="op" id="3770606">,</span>&nbsp;<span class="ident" id="3770608">rhat</span><span class="op" id="3770612">,</span>&nbsp;<span class="ident" id="3770614">u</span><span class="op" id="3770615">[</span><span class="ident" id="3770616">j</span><span class="op" id="3770617">+</span><span class="ident" id="3770618">n</span><span class="op" id="3770619">-</span><span class="num" id="3770620">2</span><span class="op" id="3770621">]</span><span class="op" id="3770622">)</span>&nbsp;<span class="op" id="3770624">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3770630">qhat</span><span class="op" id="3770634">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3770641">prevRhat</span>&nbsp;<span class="op" id="3770650">:=</span>&nbsp;<span class="ident" id="3770653">rhat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3770662">rhat</span>&nbsp;<span class="op" id="3770667">+=</span>&nbsp;<span class="ident" id="3770670">v</span><span class="op" id="3770671">[</span><span class="ident" id="3770672">n</span><span class="op" id="3770673">-</span><span class="num" id="3770674">1</span><span class="op" id="3770675">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3770681">//&nbsp;v[n-1]&nbsp;&gt;=&nbsp;0,&nbsp;so&nbsp;this&nbsp;tests&nbsp;for&nbsp;overflow.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3770729">if</span>&nbsp;<span class="ident" id="3770732">rhat</span>&nbsp;<span class="op" id="3770737">&lt;</span>&nbsp;<span class="ident" id="3770739">prevRhat</span>&nbsp;<span class="op" id="3770748">{</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3770755">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3770765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3770771">x1</span><span class="op" id="3770773">,</span>&nbsp;<span class="ident" id="3770775">x2</span>&nbsp;<span class="op" id="3770778">=</span>&nbsp;<span class="ident" id="3770780">mulWW</span><span class="op" id="3770785">(</span><span class="ident" id="3770786">qhat</span><span class="op" id="3770790">,</span>&nbsp;<span class="ident" id="3770792">v</span><span class="op" id="3770793">[</span><span class="ident" id="3770794">n</span><span class="op" id="3770795">-</span><span class="num" id="3770796">2</span><span class="op" id="3770797">]</span><span class="op" id="3770798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3770803">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3770807">}</span><br>
<span class="lineno">580</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3770812">//&nbsp;D4.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3770821">qhatv</span><span class="op" id="3770826">[</span><span class="ident" id="3770827">n</span><span class="op" id="3770828">]</span>&nbsp;<span class="op" id="3770830">=</span>&nbsp;<span class="ident" id="3770832">mulAddVWW</span><span class="op" id="3770841">(</span><span class="ident" id="3770842">qhatv</span><span class="op" id="3770847">[</span><span class="num" id="3770848">0</span><span class="op" id="3770849">:</span><span class="ident" id="3770850">n</span><span class="op" id="3770851">]</span><span class="op" id="3770852">,</span>&nbsp;<span class="ident" id="3770854">v</span><span class="op" id="3770855">,</span>&nbsp;<span class="ident" id="3770857">qhat</span><span class="op" id="3770861">,</span>&nbsp;<span class="num" id="3770863">0</span><span class="op" id="3770864">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3770869">c</span>&nbsp;<span class="op" id="3770871">:=</span>&nbsp;<span class="ident" id="3770874">subVV</span><span class="op" id="3770879">(</span><span class="ident" id="3770880">u</span><span class="op" id="3770881">[</span><span class="ident" id="3770882">j</span><span class="op" id="3770883">:</span><span class="ident" id="3770884">j</span><span class="op" id="3770885">+</span><span class="builtinfunc" id="3770886">len</span><span class="op" id="3770889">(</span><span class="ident" id="3770890">qhatv</span><span class="op" id="3770895">)</span><span class="op" id="3770896">]</span><span class="op" id="3770897">,</span>&nbsp;<span class="ident" id="3770899">u</span><span class="op" id="3770900">[</span><span class="ident" id="3770901">j</span><span class="op" id="3770902">:</span><span class="op" id="3770903">]</span><span class="op" id="3770904">,</span>&nbsp;<span class="ident" id="3770906">qhatv</span><span class="op" id="3770911">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3770915">if</span>&nbsp;<span class="ident" id="3770918">c</span>&nbsp;<span class="op" id="3770920">!=</span>&nbsp;<span class="num" id="3770923">0</span>&nbsp;<span class="op" id="3770925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3770930">c</span>&nbsp;<span class="op" id="3770932">:=</span>&nbsp;<span class="ident" id="3770935">addVV</span><span class="op" id="3770940">(</span><span class="ident" id="3770941">u</span><span class="op" id="3770942">[</span><span class="ident" id="3770943">j</span><span class="op" id="3770944">:</span><span class="ident" id="3770945">j</span><span class="op" id="3770946">+</span><span class="ident" id="3770947">n</span><span class="op" id="3770948">]</span><span class="op" id="3770949">,</span>&nbsp;<span class="ident" id="3770951">u</span><span class="op" id="3770952">[</span><span class="ident" id="3770953">j</span><span class="op" id="3770954">:</span><span class="op" id="3770955">]</span><span class="op" id="3770956">,</span>&nbsp;<span class="ident" id="3770958">v</span><span class="op" id="3770959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3770964">u</span><span class="op" id="3770965">[</span><span class="ident" id="3770966">j</span><span class="op" id="3770967">+</span><span class="ident" id="3770968">n</span><span class="op" id="3770969">]</span>&nbsp;<span class="op" id="3770971">+=</span>&nbsp;<span class="ident" id="3770974">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3770979">qhat</span><span class="op" id="3770983">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3770988">}</span><br>
<span class="lineno">590</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3770993">q</span><span class="op" id="3770994">[</span><span class="ident" id="3770995">j</span><span class="op" id="3770996">]</span>&nbsp;<span class="op" id="3770998">=</span>&nbsp;<span class="ident" id="3771000">qhat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3771006">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3771010">q</span>&nbsp;<span class="op" id="3771012">=</span>&nbsp;<span class="ident" id="3771014">q</span><span class="op" id="3771015">.</span><span class="ident" id="3771016">norm</span><span class="op" id="3771020">(</span><span class="op" id="3771021">)</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3771024">shrVU</span><span class="op" id="3771029">(</span><span class="ident" id="3771030">u</span><span class="op" id="3771031">,</span>&nbsp;<span class="ident" id="3771033">u</span><span class="op" id="3771034">,</span>&nbsp;<span class="ident" id="3771036">shift</span><span class="op" id="3771041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3771044">r</span>&nbsp;<span class="op" id="3771046">=</span>&nbsp;<span class="ident" id="3771048">u</span><span class="op" id="3771049">.</span><span class="ident" id="3771050">norm</span><span class="op" id="3771054">(</span><span class="op" id="3771055">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3771059">return</span>&nbsp;<span class="ident" id="3771066">q</span><span class="op" id="3771067">,</span>&nbsp;<span class="ident" id="3771069">r</span><br>
<span class="lineno"></span><span class="op" id="3771071">}</span><br>
<span class="lineno">600</span><br>
<span class="lineno"></span><span class="comment" id="3771074">//&nbsp;Length&nbsp;of&nbsp;x&nbsp;in&nbsp;bits.&nbsp;x&nbsp;must&nbsp;be&nbsp;normalized.</span><br>
<span class="lineno"></span><span class="keyword" id="3771120">func</span>&nbsp;<span class="op" id="3771125">(</span><span class="ident" id="3771126">x</span>&nbsp;<span class="ident" id="3771128">nat</span><span class="op" id="3771131">)</span>&nbsp;<span class="ident" id="3771133">bitLen</span><span class="op" id="3771139">(</span><span class="op" id="3771140">)</span>&nbsp;<span class="builtintype" id="3771142">int</span>&nbsp;<span class="op" id="3771146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3771149">if</span>&nbsp;<span class="ident" id="3771152">i</span>&nbsp;<span class="op" id="3771154">:=</span>&nbsp;<span class="builtinfunc" id="3771157">len</span><span class="op" id="3771160">(</span><span class="ident" id="3771161">x</span><span class="op" id="3771162">)</span>&nbsp;<span class="op" id="3771164">-</span>&nbsp;<span class="num" id="3771166">1</span><span class="op" id="3771167">;</span>&nbsp;<span class="ident" id="3771169">i</span>&nbsp;<span class="op" id="3771171">&gt;=</span>&nbsp;<span class="num" id="3771174">0</span>&nbsp;<span class="op" id="3771176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3771180">return</span>&nbsp;<span class="ident" id="3771187">i</span><span class="op" id="3771188">*</span><span class="ident" id="3771189">_W</span>&nbsp;<span class="op" id="3771192">+</span>&nbsp;<span class="ident" id="3771194">bitLen</span><span class="op" id="3771200">(</span><span class="ident" id="3771201">x</span><span class="op" id="3771202">[</span><span class="ident" id="3771203">i</span><span class="op" id="3771204">]</span><span class="op" id="3771205">)</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3771208">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3771211">return</span>&nbsp;<span class="num" id="3771218">0</span><br>
<span class="lineno"></span><span class="op" id="3771220">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3771223">//&nbsp;MaxBase&nbsp;is&nbsp;the&nbsp;largest&nbsp;number&nbsp;base&nbsp;accepted&nbsp;for&nbsp;string&nbsp;conversions.</span><br>
<span class="lineno">610</span><span class="keyword" id="3771294">const</span>&nbsp;<span class="ident" id="3771300">MaxBase</span>&nbsp;<span class="op" id="3771308">=</span>&nbsp;<span class="string" id="3771310">&#39;z&#39;</span>&nbsp;<span class="op" id="3771314">-</span>&nbsp;<span class="string" id="3771316">&#39;a&#39;</span>&nbsp;<span class="op" id="3771320">+</span>&nbsp;<span class="num" id="3771322">10</span>&nbsp;<span class="op" id="3771325">+</span>&nbsp;<span class="num" id="3771327">1</span>&nbsp;<span class="comment" id="3771329">//&nbsp;=&nbsp;hexValue(&#39;z&#39;)&nbsp;+&nbsp;1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3771353">func</span>&nbsp;<span class="ident" id="3771358">hexValue</span><span class="op" id="3771366">(</span><span class="ident" id="3771367">ch</span>&nbsp;<span class="builtintype" id="3771370">rune</span><span class="op" id="3771374">)</span>&nbsp;<span class="ident" id="3771376">Word</span>&nbsp;<span class="op" id="3771381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3771384">d</span>&nbsp;<span class="op" id="3771386">:=</span>&nbsp;<span class="builtintype" id="3771389">int</span><span class="op" id="3771392">(</span><span class="ident" id="3771393">MaxBase</span>&nbsp;<span class="op" id="3771401">+</span>&nbsp;<span class="num" id="3771403">1</span><span class="op" id="3771404">)</span>&nbsp;<span class="comment" id="3771406">//&nbsp;illegal&nbsp;base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3771423">switch</span>&nbsp;<span class="op" id="3771430">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3771433">case</span>&nbsp;<span class="string" id="3771438">&#39;0&#39;</span>&nbsp;<span class="op" id="3771442">&lt;=</span>&nbsp;<span class="ident" id="3771445">ch</span>&nbsp;<span class="op" id="3771448">&amp;&amp;</span>&nbsp;<span class="ident" id="3771451">ch</span>&nbsp;<span class="op" id="3771454">&lt;=</span>&nbsp;<span class="string" id="3771457">&#39;9&#39;</span><span class="op" id="3771460">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3771464">d</span>&nbsp;<span class="op" id="3771466">=</span>&nbsp;<span class="builtintype" id="3771468">int</span><span class="op" id="3771471">(</span><span class="ident" id="3771472">ch</span>&nbsp;<span class="op" id="3771475">-</span>&nbsp;<span class="string" id="3771477">&#39;0&#39;</span><span class="op" id="3771480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3771483">case</span>&nbsp;<span class="string" id="3771488">&#39;a&#39;</span>&nbsp;<span class="op" id="3771492">&lt;=</span>&nbsp;<span class="ident" id="3771495">ch</span>&nbsp;<span class="op" id="3771498">&amp;&amp;</span>&nbsp;<span class="ident" id="3771501">ch</span>&nbsp;<span class="op" id="3771504">&lt;=</span>&nbsp;<span class="string" id="3771507">&#39;z&#39;</span><span class="op" id="3771510">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3771514">d</span>&nbsp;<span class="op" id="3771516">=</span>&nbsp;<span class="builtintype" id="3771518">int</span><span class="op" id="3771521">(</span><span class="ident" id="3771522">ch</span>&nbsp;<span class="op" id="3771525">-</span>&nbsp;<span class="string" id="3771527">&#39;a&#39;</span>&nbsp;<span class="op" id="3771531">+</span>&nbsp;<span class="num" id="3771533">10</span><span class="op" id="3771535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3771538">case</span>&nbsp;<span class="string" id="3771543">&#39;A&#39;</span>&nbsp;<span class="op" id="3771547">&lt;=</span>&nbsp;<span class="ident" id="3771550">ch</span>&nbsp;<span class="op" id="3771553">&amp;&amp;</span>&nbsp;<span class="ident" id="3771556">ch</span>&nbsp;<span class="op" id="3771559">&lt;=</span>&nbsp;<span class="string" id="3771562">&#39;Z&#39;</span><span class="op" id="3771565">:</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3771569">d</span>&nbsp;<span class="op" id="3771571">=</span>&nbsp;<span class="builtintype" id="3771573">int</span><span class="op" id="3771576">(</span><span class="ident" id="3771577">ch</span>&nbsp;<span class="op" id="3771580">-</span>&nbsp;<span class="string" id="3771582">&#39;A&#39;</span>&nbsp;<span class="op" id="3771586">+</span>&nbsp;<span class="num" id="3771588">10</span><span class="op" id="3771590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3771593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3771596">return</span>&nbsp;<span class="ident" id="3771603">Word</span><span class="op" id="3771607">(</span><span class="ident" id="3771608">d</span><span class="op" id="3771609">)</span><br>
<span class="lineno"></span><span class="op" id="3771611">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">625</span><span class="comment" id="3771614">//&nbsp;scan&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;natural&nbsp;number&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;longest&nbsp;possible&nbsp;prefix</span><br>
<span class="lineno"></span><span class="comment" id="3771696">//&nbsp;read&nbsp;from&nbsp;r&nbsp;representing&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;in&nbsp;a&nbsp;given&nbsp;conversion&nbsp;base.</span><br>
<span class="lineno"></span><span class="comment" id="3771772">//&nbsp;It&nbsp;returns&nbsp;z,&nbsp;the&nbsp;actual&nbsp;conversion&nbsp;base&nbsp;used,&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.&nbsp;In&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3771851">//&nbsp;error&nbsp;case,&nbsp;the&nbsp;value&nbsp;of&nbsp;z&nbsp;is&nbsp;undefined.&nbsp;The&nbsp;syntax&nbsp;follows&nbsp;the&nbsp;syntax&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3771928">//&nbsp;unsigned&nbsp;integer&nbsp;literals&nbsp;in&nbsp;Go.</span><br>
<span class="lineno">630</span><span class="comment" id="3771964">//</span><br>
<span class="lineno"></span><span class="comment" id="3771967">//&nbsp;The&nbsp;base&nbsp;argument&nbsp;must&nbsp;be&nbsp;0&nbsp;or&nbsp;a&nbsp;value&nbsp;from&nbsp;2&nbsp;through&nbsp;MaxBase.&nbsp;If&nbsp;the&nbsp;base</span><br>
<span class="lineno"></span><span class="comment" id="3772045">//&nbsp;is&nbsp;0,&nbsp;the&nbsp;string&nbsp;prefix&nbsp;determines&nbsp;the&nbsp;actual&nbsp;conversion&nbsp;base.&nbsp;A&nbsp;prefix&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3772123">//&nbsp;``0x&#39;&#39;&nbsp;or&nbsp;``0X&#39;&#39;&nbsp;selects&nbsp;base&nbsp;16;&nbsp;the&nbsp;``0&#39;&#39;&nbsp;prefix&nbsp;selects&nbsp;base&nbsp;8,&nbsp;and&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3772199">//&nbsp;``0b&#39;&#39;&nbsp;or&nbsp;``0B&#39;&#39;&nbsp;prefix&nbsp;selects&nbsp;base&nbsp;2.&nbsp;Otherwise&nbsp;the&nbsp;selected&nbsp;base&nbsp;is&nbsp;10.</span><br>
<span class="lineno">635</span><span class="comment" id="3772277">//</span><br>
<span class="lineno"></span><span class="keyword" id="3772280">func</span>&nbsp;<span class="op" id="3772285">(</span><span class="ident" id="3772286">z</span>&nbsp;<span class="ident" id="3772288">nat</span><span class="op" id="3772291">)</span>&nbsp;<span class="ident" id="3772293">scan</span><span class="op" id="3772297">(</span><span class="ident" id="3772298">r</span>&nbsp;<span class="ident" id="3772300">io</span><span class="op" id="3772302">.</span><span class="ident" id="3772303">RuneScanner</span><span class="op" id="3772314">,</span>&nbsp;<span class="ident" id="3772316">base</span>&nbsp;<span class="builtintype" id="3772321">int</span><span class="op" id="3772324">)</span>&nbsp;<span class="op" id="3772326">(</span><span class="ident" id="3772327">nat</span><span class="op" id="3772330">,</span>&nbsp;<span class="builtintype" id="3772332">int</span><span class="op" id="3772335">,</span>&nbsp;<span class="builtintype" id="3772337">error</span><span class="op" id="3772342">)</span>&nbsp;<span class="op" id="3772344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3772347">//&nbsp;reject&nbsp;illegal&nbsp;bases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772372">if</span>&nbsp;<span class="ident" id="3772375">base</span>&nbsp;<span class="op" id="3772380">&lt;</span>&nbsp;<span class="num" id="3772382">0</span>&nbsp;<span class="op" id="3772384">||</span>&nbsp;<span class="ident" id="3772387">base</span>&nbsp;<span class="op" id="3772392">==</span>&nbsp;<span class="num" id="3772395">1</span>&nbsp;<span class="op" id="3772397">||</span>&nbsp;<span class="ident" id="3772400">MaxBase</span>&nbsp;<span class="op" id="3772408">&lt;</span>&nbsp;<span class="ident" id="3772410">base</span>&nbsp;<span class="op" id="3772415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772419">return</span>&nbsp;<span class="ident" id="3772426">z</span><span class="op" id="3772427">,</span>&nbsp;<span class="num" id="3772429">0</span><span class="op" id="3772430">,</span>&nbsp;<span class="ident" id="3772432">errors</span><span class="op" id="3772438">.</span><span class="ident" id="3772439">New</span><span class="op" id="3772442">(</span><span class="string" id="3772443">&#34;illegal&nbsp;number&nbsp;base&#34;</span><span class="op" id="3772464">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3772467">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3772471">//&nbsp;one&nbsp;char&nbsp;look-ahead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3772495">ch</span><span class="op" id="3772497">,</span>&nbsp;<span class="ident" id="3772499">_</span><span class="op" id="3772500">,</span>&nbsp;<span class="ident" id="3772502">err</span>&nbsp;<span class="op" id="3772506">:=</span>&nbsp;<span class="ident" id="3772509">r</span><span class="op" id="3772510">.</span><span class="ident" id="3772511">ReadRune</span><span class="op" id="3772519">(</span><span class="op" id="3772520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772523">if</span>&nbsp;<span class="ident" id="3772526">err</span>&nbsp;<span class="op" id="3772530">!=</span>&nbsp;<span class="ident" id="3772533">nil</span>&nbsp;<span class="op" id="3772537">{</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772541">return</span>&nbsp;<span class="ident" id="3772548">z</span><span class="op" id="3772549">,</span>&nbsp;<span class="num" id="3772551">0</span><span class="op" id="3772552">,</span>&nbsp;<span class="ident" id="3772554">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3772559">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3772563">//&nbsp;determine&nbsp;base&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3772595">b</span>&nbsp;<span class="op" id="3772597">:=</span>&nbsp;<span class="ident" id="3772600">Word</span><span class="op" id="3772604">(</span><span class="ident" id="3772605">base</span><span class="op" id="3772609">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772612">if</span>&nbsp;<span class="ident" id="3772615">base</span>&nbsp;<span class="op" id="3772620">==</span>&nbsp;<span class="num" id="3772623">0</span>&nbsp;<span class="op" id="3772625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3772629">b</span>&nbsp;<span class="op" id="3772631">=</span>&nbsp;<span class="num" id="3772633">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772638">if</span>&nbsp;<span class="ident" id="3772641">ch</span>&nbsp;<span class="op" id="3772644">==</span>&nbsp;<span class="string" id="3772647">&#39;0&#39;</span>&nbsp;<span class="op" id="3772651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772656">switch</span>&nbsp;<span class="ident" id="3772663">ch</span><span class="op" id="3772665">,</span>&nbsp;<span class="ident" id="3772667">_</span><span class="op" id="3772668">,</span>&nbsp;<span class="ident" id="3772670">err</span>&nbsp;<span class="op" id="3772674">=</span>&nbsp;<span class="ident" id="3772676">r</span><span class="op" id="3772677">.</span><span class="ident" id="3772678">ReadRune</span><span class="op" id="3772686">(</span><span class="op" id="3772687">)</span><span class="op" id="3772688">;</span>&nbsp;<span class="ident" id="3772690">err</span>&nbsp;<span class="op" id="3772694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772699">case</span>&nbsp;<span class="ident" id="3772704">nil</span><span class="op" id="3772707">:</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3772713">b</span>&nbsp;<span class="op" id="3772715">=</span>&nbsp;<span class="num" id="3772717">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772723">switch</span>&nbsp;<span class="ident" id="3772730">ch</span>&nbsp;<span class="op" id="3772733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772739">case</span>&nbsp;<span class="string" id="3772744">&#39;x&#39;</span><span class="op" id="3772747">,</span>&nbsp;<span class="string" id="3772749">&#39;X&#39;</span><span class="op" id="3772752">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3772759">b</span>&nbsp;<span class="op" id="3772761">=</span>&nbsp;<span class="num" id="3772763">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772770">case</span>&nbsp;<span class="string" id="3772775">&#39;b&#39;</span><span class="op" id="3772778">,</span>&nbsp;<span class="string" id="3772780">&#39;B&#39;</span><span class="op" id="3772783">:</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3772790">b</span>&nbsp;<span class="op" id="3772792">=</span>&nbsp;<span class="num" id="3772794">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3772800">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772806">if</span>&nbsp;<span class="ident" id="3772809">b</span>&nbsp;<span class="op" id="3772811">==</span>&nbsp;<span class="num" id="3772814">2</span>&nbsp;<span class="op" id="3772816">||</span>&nbsp;<span class="ident" id="3772819">b</span>&nbsp;<span class="op" id="3772821">==</span>&nbsp;<span class="num" id="3772824">16</span>&nbsp;<span class="op" id="3772827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772834">if</span>&nbsp;<span class="ident" id="3772837">ch</span><span class="op" id="3772839">,</span>&nbsp;<span class="ident" id="3772841">_</span><span class="op" id="3772842">,</span>&nbsp;<span class="ident" id="3772844">err</span>&nbsp;<span class="op" id="3772848">=</span>&nbsp;<span class="ident" id="3772850">r</span><span class="op" id="3772851">.</span><span class="ident" id="3772852">ReadRune</span><span class="op" id="3772860">(</span><span class="op" id="3772861">)</span><span class="op" id="3772862">;</span>&nbsp;<span class="ident" id="3772864">err</span>&nbsp;<span class="op" id="3772868">!=</span>&nbsp;<span class="ident" id="3772871">nil</span>&nbsp;<span class="op" id="3772875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772883">return</span>&nbsp;<span class="ident" id="3772890">z</span><span class="op" id="3772891">,</span>&nbsp;<span class="num" id="3772893">0</span><span class="op" id="3772894">,</span>&nbsp;<span class="ident" id="3772896">err</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3772905">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3772911">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772916">case</span>&nbsp;<span class="ident" id="3772921">io</span><span class="op" id="3772923">.</span><span class="ident" id="3772924">EOF</span><span class="op" id="3772927">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772933">return</span>&nbsp;<span class="ident" id="3772940">z</span><span class="op" id="3772941">.</span><span class="builtinfunc" id="3772942">make</span><span class="op" id="3772946">(</span><span class="num" id="3772947">0</span><span class="op" id="3772948">)</span><span class="op" id="3772949">,</span>&nbsp;<span class="num" id="3772951">10</span><span class="op" id="3772953">,</span>&nbsp;<span class="ident" id="3772955">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772962">default</span><span class="op" id="3772969">:</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772975">return</span>&nbsp;<span class="ident" id="3772982">z</span><span class="op" id="3772983">,</span>&nbsp;<span class="num" id="3772985">10</span><span class="op" id="3772987">,</span>&nbsp;<span class="ident" id="3772989">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3772996">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3773000">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3773003">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773007">//&nbsp;convert&nbsp;string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773026">//&nbsp;-&nbsp;group&nbsp;as&nbsp;many&nbsp;digits&nbsp;d&nbsp;as&nbsp;possible&nbsp;together&nbsp;into&nbsp;a&nbsp;&#34;super-digit&#34;&nbsp;dd&nbsp;with&nbsp;&#34;super-base&#34;&nbsp;bb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773121">//&nbsp;-&nbsp;only&nbsp;when&nbsp;bb&nbsp;does&nbsp;not&nbsp;fit&nbsp;into&nbsp;a&nbsp;word&nbsp;anymore,&nbsp;do&nbsp;a&nbsp;full&nbsp;number&nbsp;mulAddWW&nbsp;using&nbsp;bb&nbsp;and&nbsp;dd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3773216">z</span>&nbsp;<span class="op" id="3773218">=</span>&nbsp;<span class="ident" id="3773220">z</span><span class="op" id="3773221">.</span><span class="builtinfunc" id="3773222">make</span><span class="op" id="3773226">(</span><span class="num" id="3773227">0</span><span class="op" id="3773228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3773231">bb</span>&nbsp;<span class="op" id="3773234">:=</span>&nbsp;<span class="ident" id="3773237">Word</span><span class="op" id="3773241">(</span><span class="num" id="3773242">1</span><span class="op" id="3773243">)</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3773246">dd</span>&nbsp;<span class="op" id="3773249">:=</span>&nbsp;<span class="ident" id="3773252">Word</span><span class="op" id="3773256">(</span><span class="num" id="3773257">0</span><span class="op" id="3773258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3773261">for</span>&nbsp;<span class="ident" id="3773265">max</span>&nbsp;<span class="op" id="3773269">:=</span>&nbsp;<span class="ident" id="3773272">_M</span>&nbsp;<span class="op" id="3773275">/</span>&nbsp;<span class="ident" id="3773277">b</span><span class="op" id="3773278">;</span>&nbsp;<span class="op" id="3773280">;</span>&nbsp;<span class="op" id="3773282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3773286">d</span>&nbsp;<span class="op" id="3773288">:=</span>&nbsp;<span class="ident" id="3773291">hexValue</span><span class="op" id="3773299">(</span><span class="ident" id="3773300">ch</span><span class="op" id="3773302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3773306">if</span>&nbsp;<span class="ident" id="3773309">d</span>&nbsp;<span class="op" id="3773311">&gt;=</span>&nbsp;<span class="ident" id="3773314">b</span>&nbsp;<span class="op" id="3773316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3773321">r</span><span class="op" id="3773322">.</span><span class="ident" id="3773323">UnreadRune</span><span class="op" id="3773333">(</span><span class="op" id="3773334">)</span>&nbsp;<span class="comment" id="3773336">//&nbsp;ch&nbsp;does&nbsp;not&nbsp;belong&nbsp;to&nbsp;number&nbsp;anymore</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3773379">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3773387">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3773392">if</span>&nbsp;<span class="ident" id="3773395">bb</span>&nbsp;<span class="op" id="3773398">&lt;=</span>&nbsp;<span class="ident" id="3773401">max</span>&nbsp;<span class="op" id="3773405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3773410">bb</span>&nbsp;<span class="op" id="3773413">*=</span>&nbsp;<span class="ident" id="3773416">b</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3773421">dd</span>&nbsp;<span class="op" id="3773424">=</span>&nbsp;<span class="ident" id="3773426">dd</span><span class="op" id="3773428">*</span><span class="ident" id="3773429">b</span>&nbsp;<span class="op" id="3773431">+</span>&nbsp;<span class="ident" id="3773433">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3773437">}</span>&nbsp;<span class="keyword" id="3773439">else</span>&nbsp;<span class="op" id="3773444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773449">//&nbsp;bb&nbsp;*&nbsp;b&nbsp;would&nbsp;overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3773477">z</span>&nbsp;<span class="op" id="3773479">=</span>&nbsp;<span class="ident" id="3773481">z</span><span class="op" id="3773482">.</span><span class="ident" id="3773483">mulAddWW</span><span class="op" id="3773491">(</span><span class="ident" id="3773492">z</span><span class="op" id="3773493">,</span>&nbsp;<span class="ident" id="3773495">bb</span><span class="op" id="3773497">,</span>&nbsp;<span class="ident" id="3773499">dd</span><span class="op" id="3773501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3773506">bb</span>&nbsp;<span class="op" id="3773509">=</span>&nbsp;<span class="ident" id="3773511">b</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3773516">dd</span>&nbsp;<span class="op" id="3773519">=</span>&nbsp;<span class="ident" id="3773521">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3773525">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3773530">if</span>&nbsp;<span class="ident" id="3773533">ch</span><span class="op" id="3773535">,</span>&nbsp;<span class="ident" id="3773537">_</span><span class="op" id="3773538">,</span>&nbsp;<span class="ident" id="3773540">err</span>&nbsp;<span class="op" id="3773544">=</span>&nbsp;<span class="ident" id="3773546">r</span><span class="op" id="3773547">.</span><span class="ident" id="3773548">ReadRune</span><span class="op" id="3773556">(</span><span class="op" id="3773557">)</span><span class="op" id="3773558">;</span>&nbsp;<span class="ident" id="3773560">err</span>&nbsp;<span class="op" id="3773564">!=</span>&nbsp;<span class="ident" id="3773567">nil</span>&nbsp;<span class="op" id="3773571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3773576">if</span>&nbsp;<span class="ident" id="3773579">err</span>&nbsp;<span class="op" id="3773583">!=</span>&nbsp;<span class="ident" id="3773586">io</span><span class="op" id="3773588">.</span><span class="ident" id="3773589">EOF</span>&nbsp;<span class="op" id="3773593">{</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3773599">return</span>&nbsp;<span class="ident" id="3773606">z</span><span class="op" id="3773607">,</span>&nbsp;<span class="builtintype" id="3773609">int</span><span class="op" id="3773612">(</span><span class="ident" id="3773613">b</span><span class="op" id="3773614">)</span><span class="op" id="3773615">,</span>&nbsp;<span class="ident" id="3773617">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3773624">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3773629">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3773637">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3773640">}</span><br>
<span class="lineno">705</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3773644">switch</span>&nbsp;<span class="op" id="3773651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3773654">case</span>&nbsp;<span class="ident" id="3773659">bb</span>&nbsp;<span class="op" id="3773662">&gt;</span>&nbsp;<span class="num" id="3773664">1</span><span class="op" id="3773665">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773669">//&nbsp;there&nbsp;was&nbsp;at&nbsp;least&nbsp;one&nbsp;mantissa&nbsp;digit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3773712">z</span>&nbsp;<span class="op" id="3773714">=</span>&nbsp;<span class="ident" id="3773716">z</span><span class="op" id="3773717">.</span><span class="ident" id="3773718">mulAddWW</span><span class="op" id="3773726">(</span><span class="ident" id="3773727">z</span><span class="op" id="3773728">,</span>&nbsp;<span class="ident" id="3773730">bb</span><span class="op" id="3773732">,</span>&nbsp;<span class="ident" id="3773734">dd</span><span class="op" id="3773736">)</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3773739">case</span>&nbsp;<span class="ident" id="3773744">base</span>&nbsp;<span class="op" id="3773749">==</span>&nbsp;<span class="num" id="3773752">0</span>&nbsp;<span class="op" id="3773754">&amp;&amp;</span>&nbsp;<span class="ident" id="3773757">b</span>&nbsp;<span class="op" id="3773759">==</span>&nbsp;<span class="num" id="3773762">8</span><span class="op" id="3773763">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773767">//&nbsp;there&nbsp;was&nbsp;only&nbsp;the&nbsp;octal&nbsp;prefix&nbsp;0&nbsp;(possibly&nbsp;followed&nbsp;by&nbsp;digits&nbsp;&gt;&nbsp;7);</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773841">//&nbsp;return&nbsp;base&nbsp;10,&nbsp;not&nbsp;8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3773868">return</span>&nbsp;<span class="ident" id="3773875">z</span><span class="op" id="3773876">,</span>&nbsp;<span class="num" id="3773878">10</span><span class="op" id="3773880">,</span>&nbsp;<span class="ident" id="3773882">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3773887">case</span>&nbsp;<span class="ident" id="3773892">base</span>&nbsp;<span class="op" id="3773897">!=</span>&nbsp;<span class="num" id="3773900">0</span>&nbsp;<span class="op" id="3773902">||</span>&nbsp;<span class="ident" id="3773905">b</span>&nbsp;<span class="op" id="3773907">!=</span>&nbsp;<span class="num" id="3773910">8</span><span class="op" id="3773911">:</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773915">//&nbsp;there&nbsp;was&nbsp;neither&nbsp;a&nbsp;mantissa&nbsp;digit&nbsp;nor&nbsp;the&nbsp;octal&nbsp;prefix&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3773978">return</span>&nbsp;<span class="ident" id="3773985">z</span><span class="op" id="3773986">,</span>&nbsp;<span class="builtintype" id="3773988">int</span><span class="op" id="3773991">(</span><span class="ident" id="3773992">b</span><span class="op" id="3773993">)</span><span class="op" id="3773994">,</span>&nbsp;<span class="ident" id="3773996">errors</span><span class="op" id="3774002">.</span><span class="ident" id="3774003">New</span><span class="op" id="3774006">(</span><span class="string" id="3774007">&#34;syntax&nbsp;error&nbsp;scanning&nbsp;number&#34;</span><span class="op" id="3774037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3774040">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3774044">return</span>&nbsp;<span class="ident" id="3774051">z</span><span class="op" id="3774052">.</span><span class="ident" id="3774053">norm</span><span class="op" id="3774057">(</span><span class="op" id="3774058">)</span><span class="op" id="3774059">,</span>&nbsp;<span class="builtintype" id="3774061">int</span><span class="op" id="3774064">(</span><span class="ident" id="3774065">b</span><span class="op" id="3774066">)</span><span class="op" id="3774067">,</span>&nbsp;<span class="ident" id="3774069">nil</span><br>
<span class="lineno">720</span><span class="op" id="3774073">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3774076">//&nbsp;Character&nbsp;sets&nbsp;for&nbsp;string&nbsp;conversion.</span><br>
<span class="lineno"></span><span class="keyword" id="3774117">const</span>&nbsp;<span class="op" id="3774123">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3774126">lowercaseDigits</span>&nbsp;<span class="op" id="3774142">=</span>&nbsp;<span class="string" id="3774144">&#34;0123456789abcdefghijklmnopqrstuvwxyz&#34;</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3774184">uppercaseDigits</span>&nbsp;<span class="op" id="3774200">=</span>&nbsp;<span class="string" id="3774202">&#34;0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&#34;</span><br>
<span class="lineno"></span><span class="op" id="3774241">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3774244">//&nbsp;decimalString&nbsp;returns&nbsp;a&nbsp;decimal&nbsp;representation&nbsp;of&nbsp;x.</span><br>
<span class="lineno"></span><span class="comment" id="3774300">//&nbsp;It&nbsp;calls&nbsp;x.string&nbsp;with&nbsp;the&nbsp;charset&nbsp;&#34;0123456789&#34;.</span><br>
<span class="lineno">730</span><span class="keyword" id="3774352">func</span>&nbsp;<span class="op" id="3774357">(</span><span class="ident" id="3774358">x</span>&nbsp;<span class="ident" id="3774360">nat</span><span class="op" id="3774363">)</span>&nbsp;<span class="ident" id="3774365">decimalString</span><span class="op" id="3774378">(</span><span class="op" id="3774379">)</span>&nbsp;<span class="builtintype" id="3774381">string</span>&nbsp;<span class="op" id="3774388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3774391">return</span>&nbsp;<span class="ident" id="3774398">x</span><span class="op" id="3774399">.</span><span class="builtintype" id="3774400">string</span><span class="op" id="3774406">(</span><span class="ident" id="3774407">lowercaseDigits</span><span class="op" id="3774422">[</span><span class="num" id="3774423">0</span><span class="op" id="3774424">:</span><span class="num" id="3774425">10</span><span class="op" id="3774427">]</span><span class="op" id="3774428">)</span><br>
<span class="lineno"></span><span class="op" id="3774430">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3774433">//&nbsp;string&nbsp;converts&nbsp;x&nbsp;to&nbsp;a&nbsp;string&nbsp;using&nbsp;digits&nbsp;from&nbsp;a&nbsp;charset;&nbsp;a&nbsp;digit&nbsp;with</span><br>
<span class="lineno">735</span><span class="comment" id="3774508">//&nbsp;value&nbsp;d&nbsp;is&nbsp;represented&nbsp;by&nbsp;charset[d].&nbsp;The&nbsp;conversion&nbsp;base&nbsp;is&nbsp;determined</span><br>
<span class="lineno"></span><span class="comment" id="3774583">//&nbsp;by&nbsp;len(charset),&nbsp;which&nbsp;must&nbsp;be&nbsp;&gt;=&nbsp;2&nbsp;and&nbsp;&lt;=&nbsp;256.</span><br>
<span class="lineno"></span><span class="keyword" id="3774634">func</span>&nbsp;<span class="op" id="3774639">(</span><span class="ident" id="3774640">x</span>&nbsp;<span class="ident" id="3774642">nat</span><span class="op" id="3774645">)</span>&nbsp;<span class="builtintype" id="3774647">string</span><span class="op" id="3774653">(</span><span class="ident" id="3774654">charset</span>&nbsp;<span class="builtintype" id="3774662">string</span><span class="op" id="3774668">)</span>&nbsp;<span class="builtintype" id="3774670">string</span>&nbsp;<span class="op" id="3774677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3774680">b</span>&nbsp;<span class="op" id="3774682">:=</span>&nbsp;<span class="ident" id="3774685">Word</span><span class="op" id="3774689">(</span><span class="builtinfunc" id="3774690">len</span><span class="op" id="3774693">(</span><span class="ident" id="3774694">charset</span><span class="op" id="3774701">)</span><span class="op" id="3774702">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3774706">//&nbsp;special&nbsp;cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3774724">switch</span>&nbsp;<span class="op" id="3774731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3774734">case</span>&nbsp;<span class="ident" id="3774739">b</span>&nbsp;<span class="op" id="3774741">&lt;</span>&nbsp;<span class="num" id="3774743">2</span>&nbsp;<span class="op" id="3774745">||</span>&nbsp;<span class="ident" id="3774748">MaxBase</span>&nbsp;<span class="op" id="3774756">&gt;</span>&nbsp;<span class="num" id="3774758">256</span><span class="op" id="3774761">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3774765">panic</span><span class="op" id="3774770">(</span><span class="string" id="3774771">&#34;illegal&nbsp;base&#34;</span><span class="op" id="3774785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3774788">case</span>&nbsp;<span class="builtinfunc" id="3774793">len</span><span class="op" id="3774796">(</span><span class="ident" id="3774797">x</span><span class="op" id="3774798">)</span>&nbsp;<span class="op" id="3774800">==</span>&nbsp;<span class="num" id="3774803">0</span><span class="op" id="3774804">:</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3774808">return</span>&nbsp;<span class="builtintype" id="3774815">string</span><span class="op" id="3774821">(</span><span class="ident" id="3774822">charset</span><span class="op" id="3774829">[</span><span class="num" id="3774830">0</span><span class="op" id="3774831">]</span><span class="op" id="3774832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3774835">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3774839">//&nbsp;allocate&nbsp;buffer&nbsp;for&nbsp;conversion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3774874">i</span>&nbsp;<span class="op" id="3774876">:=</span>&nbsp;<span class="builtintype" id="3774879">int</span><span class="op" id="3774882">(</span><span class="builtintype" id="3774883">float64</span><span class="op" id="3774890">(</span><span class="ident" id="3774891">x</span><span class="op" id="3774892">.</span><span class="ident" id="3774893">bitLen</span><span class="op" id="3774899">(</span><span class="op" id="3774900">)</span><span class="op" id="3774901">)</span><span class="op" id="3774902">/</span><span class="ident" id="3774903">math</span><span class="op" id="3774907">.</span><span class="ident" id="3774908">Log2</span><span class="op" id="3774912">(</span><span class="builtintype" id="3774913">float64</span><span class="op" id="3774920">(</span><span class="ident" id="3774921">b</span><span class="op" id="3774922">)</span><span class="op" id="3774923">)</span><span class="op" id="3774924">)</span>&nbsp;<span class="op" id="3774926">+</span>&nbsp;<span class="num" id="3774928">1</span>&nbsp;<span class="comment" id="3774930">//&nbsp;off&nbsp;by&nbsp;one&nbsp;at&nbsp;most</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3774953">s</span>&nbsp;<span class="op" id="3774955">:=</span>&nbsp;<span class="builtinfunc" id="3774958">make</span><span class="op" id="3774962">(</span><span class="op" id="3774963">[</span><span class="op" id="3774964">]</span><span class="builtintype" id="3774965">byte</span><span class="op" id="3774969">,</span>&nbsp;<span class="ident" id="3774971">i</span><span class="op" id="3774972">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3774976">//&nbsp;convert&nbsp;power&nbsp;of&nbsp;two&nbsp;and&nbsp;non&nbsp;power&nbsp;of&nbsp;two&nbsp;bases&nbsp;separately</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3775039">if</span>&nbsp;<span class="ident" id="3775042">b</span>&nbsp;<span class="op" id="3775044">==</span>&nbsp;<span class="ident" id="3775047">b</span><span class="op" id="3775048">&amp;</span><span class="op" id="3775049">-</span><span class="ident" id="3775050">b</span>&nbsp;<span class="op" id="3775052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3775056">//&nbsp;shift&nbsp;is&nbsp;base-b&nbsp;digit&nbsp;size&nbsp;in&nbsp;bits</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3775096">shift</span>&nbsp;<span class="op" id="3775102">:=</span>&nbsp;<span class="ident" id="3775105">trailingZeroBits</span><span class="op" id="3775121">(</span><span class="ident" id="3775122">b</span><span class="op" id="3775123">)</span>&nbsp;<span class="comment" id="3775125">//&nbsp;shift&nbsp;&gt;&nbsp;0&nbsp;because&nbsp;b&nbsp;&gt;=&nbsp;2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3775155">mask</span>&nbsp;<span class="op" id="3775160">:=</span>&nbsp;<span class="ident" id="3775163">Word</span><span class="op" id="3775167">(</span><span class="num" id="3775168">1</span><span class="op" id="3775169">)</span><span class="op" id="3775170">&lt;&lt;</span><span class="ident" id="3775172">shift</span>&nbsp;<span class="op" id="3775178">-</span>&nbsp;<span class="num" id="3775180">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3775184">w</span>&nbsp;<span class="op" id="3775186">:=</span>&nbsp;<span class="ident" id="3775189">x</span><span class="op" id="3775190">[</span><span class="num" id="3775191">0</span><span class="op" id="3775192">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3775196">nbits</span>&nbsp;<span class="op" id="3775202">:=</span>&nbsp;<span class="builtintype" id="3775205">uint</span><span class="op" id="3775209">(</span><span class="ident" id="3775210">_W</span><span class="op" id="3775212">)</span>&nbsp;<span class="comment" id="3775214">//&nbsp;number&nbsp;of&nbsp;unprocessed&nbsp;bits&nbsp;in&nbsp;w</span><br>
<span class="lineno"></span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3775252">//&nbsp;convert&nbsp;less-significant&nbsp;words</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3775288">for</span>&nbsp;<span class="ident" id="3775292">k</span>&nbsp;<span class="op" id="3775294">:=</span>&nbsp;<span class="num" id="3775297">1</span><span class="op" id="3775298">;</span>&nbsp;<span class="ident" id="3775300">k</span>&nbsp;<span class="op" id="3775302">&lt;</span>&nbsp;<span class="builtinfunc" id="3775304">len</span><span class="op" id="3775307">(</span><span class="ident" id="3775308">x</span><span class="op" id="3775309">)</span><span class="op" id="3775310">;</span>&nbsp;<span class="ident" id="3775312">k</span><span class="op" id="3775313">++</span>&nbsp;<span class="op" id="3775316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3775321">//&nbsp;convert&nbsp;full&nbsp;digits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3775347">for</span>&nbsp;<span class="ident" id="3775351">nbits</span>&nbsp;<span class="op" id="3775357">&gt;=</span>&nbsp;<span class="ident" id="3775360">shift</span>&nbsp;<span class="op" id="3775366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3775372">i</span><span class="op" id="3775373">--</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3775380">s</span><span class="op" id="3775381">[</span><span class="ident" id="3775382">i</span><span class="op" id="3775383">]</span>&nbsp;<span class="op" id="3775385">=</span>&nbsp;<span class="ident" id="3775387">charset</span><span class="op" id="3775394">[</span><span class="ident" id="3775395">w</span><span class="op" id="3775396">&amp;</span><span class="ident" id="3775397">mask</span><span class="op" id="3775401">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3775407">w</span>&nbsp;<span class="op" id="3775409">&gt;&gt;=</span>&nbsp;<span class="ident" id="3775413">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3775423">nbits</span>&nbsp;<span class="op" id="3775429">-=</span>&nbsp;<span class="ident" id="3775432">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3775441">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3775447">//&nbsp;convert&nbsp;any&nbsp;partial&nbsp;leading&nbsp;digit&nbsp;and&nbsp;advance&nbsp;to&nbsp;next&nbsp;word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3775512">if</span>&nbsp;<span class="ident" id="3775515">nbits</span>&nbsp;<span class="op" id="3775521">==</span>&nbsp;<span class="num" id="3775524">0</span>&nbsp;<span class="op" id="3775526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3775532">//&nbsp;no&nbsp;partial&nbsp;digit&nbsp;remaining,&nbsp;just&nbsp;advance</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3775580">w</span>&nbsp;<span class="op" id="3775582">=</span>&nbsp;<span class="ident" id="3775584">x</span><span class="op" id="3775585">[</span><span class="ident" id="3775586">k</span><span class="op" id="3775587">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3775593">nbits</span>&nbsp;<span class="op" id="3775599">=</span>&nbsp;<span class="ident" id="3775601">_W</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3775607">}</span>&nbsp;<span class="keyword" id="3775609">else</span>&nbsp;<span class="op" id="3775614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3775620">//&nbsp;partial&nbsp;digit&nbsp;in&nbsp;current&nbsp;(k-1)&nbsp;and&nbsp;next&nbsp;(k)&nbsp;word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3775676">w</span>&nbsp;<span class="op" id="3775678">|=</span>&nbsp;<span class="ident" id="3775681">x</span><span class="op" id="3775682">[</span><span class="ident" id="3775683">k</span><span class="op" id="3775684">]</span>&nbsp;<span class="op" id="3775686">&lt;&lt;</span>&nbsp;<span class="ident" id="3775689">nbits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3775699">i</span><span class="op" id="3775700">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3775707">s</span><span class="op" id="3775708">[</span><span class="ident" id="3775709">i</span><span class="op" id="3775710">]</span>&nbsp;<span class="op" id="3775712">=</span>&nbsp;<span class="ident" id="3775714">charset</span><span class="op" id="3775721">[</span><span class="ident" id="3775722">w</span><span class="op" id="3775723">&amp;</span><span class="ident" id="3775724">mask</span><span class="op" id="3775728">]</span><br>
<span class="lineno">780</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3775735">//&nbsp;advance</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3775750">w</span>&nbsp;<span class="op" id="3775752">=</span>&nbsp;<span class="ident" id="3775754">x</span><span class="op" id="3775755">[</span><span class="ident" id="3775756">k</span><span class="op" id="3775757">]</span>&nbsp;<span class="op" id="3775759">&gt;&gt;</span>&nbsp;<span class="op" id="3775762">(</span><span class="ident" id="3775763">shift</span>&nbsp;<span class="op" id="3775769">-</span>&nbsp;<span class="ident" id="3775771">nbits</span><span class="op" id="3775776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3775782">nbits</span>&nbsp;<span class="op" id="3775788">=</span>&nbsp;<span class="ident" id="3775790">_W</span>&nbsp;<span class="op" id="3775793">-</span>&nbsp;<span class="op" id="3775795">(</span><span class="ident" id="3775796">shift</span>&nbsp;<span class="op" id="3775802">-</span>&nbsp;<span class="ident" id="3775804">nbits</span><span class="op" id="3775809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3775814">}</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3775818">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3775823">//&nbsp;convert&nbsp;digits&nbsp;of&nbsp;most-significant&nbsp;word&nbsp;(omit&nbsp;leading&nbsp;zeros)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3775889">for</span>&nbsp;<span class="ident" id="3775893">nbits</span>&nbsp;<span class="op" id="3775899">&gt;=</span>&nbsp;<span class="num" id="3775902">0</span>&nbsp;<span class="op" id="3775904">&amp;&amp;</span>&nbsp;<span class="ident" id="3775907">w</span>&nbsp;<span class="op" id="3775909">!=</span>&nbsp;<span class="num" id="3775912">0</span>&nbsp;<span class="op" id="3775914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3775919">i</span><span class="op" id="3775920">--</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3775926">s</span><span class="op" id="3775927">[</span><span class="ident" id="3775928">i</span><span class="op" id="3775929">]</span>&nbsp;<span class="op" id="3775931">=</span>&nbsp;<span class="ident" id="3775933">charset</span><span class="op" id="3775940">[</span><span class="ident" id="3775941">w</span><span class="op" id="3775942">&amp;</span><span class="ident" id="3775943">mask</span><span class="op" id="3775947">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3775952">w</span>&nbsp;<span class="op" id="3775954">&gt;&gt;=</span>&nbsp;<span class="ident" id="3775958">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3775967">nbits</span>&nbsp;<span class="op" id="3775973">-=</span>&nbsp;<span class="ident" id="3775976">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3775984">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3775988">}</span>&nbsp;<span class="keyword" id="3775990">else</span>&nbsp;<span class="op" id="3775995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3775999">//&nbsp;determine&nbsp;&#34;big&nbsp;base&#34;;&nbsp;i.e.,&nbsp;the&nbsp;largest&nbsp;possible&nbsp;value&nbsp;bb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3776062">//&nbsp;that&nbsp;is&nbsp;a&nbsp;power&nbsp;of&nbsp;base&nbsp;b&nbsp;and&nbsp;still&nbsp;fits&nbsp;into&nbsp;a&nbsp;Word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3776120">//&nbsp;(as&nbsp;in&nbsp;10^19&nbsp;for&nbsp;19&nbsp;decimal&nbsp;digits&nbsp;in&nbsp;a&nbsp;64bit&nbsp;Word)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3776177">bb</span>&nbsp;<span class="op" id="3776180">:=</span>&nbsp;<span class="ident" id="3776183">b</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3776190">//&nbsp;big&nbsp;base&nbsp;is&nbsp;b**ndigits</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3776218">ndigits</span>&nbsp;<span class="op" id="3776226">:=</span>&nbsp;<span class="num" id="3776229">1</span>&nbsp;<span class="comment" id="3776231">//&nbsp;number&nbsp;of&nbsp;base&nbsp;b&nbsp;digits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3776260">for</span>&nbsp;<span class="ident" id="3776264">max</span>&nbsp;<span class="op" id="3776268">:=</span>&nbsp;<span class="ident" id="3776271">Word</span><span class="op" id="3776275">(</span><span class="ident" id="3776276">_M</span>&nbsp;<span class="op" id="3776279">/</span>&nbsp;<span class="ident" id="3776281">b</span><span class="op" id="3776282">)</span><span class="op" id="3776283">;</span>&nbsp;<span class="ident" id="3776285">bb</span>&nbsp;<span class="op" id="3776288">&lt;=</span>&nbsp;<span class="ident" id="3776291">max</span><span class="op" id="3776294">;</span>&nbsp;<span class="ident" id="3776296">bb</span>&nbsp;<span class="op" id="3776299">*=</span>&nbsp;<span class="ident" id="3776302">b</span>&nbsp;<span class="op" id="3776304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3776309">ndigits</span><span class="op" id="3776316">++</span>&nbsp;<span class="comment" id="3776319">//&nbsp;maximize&nbsp;ndigits&nbsp;where&nbsp;bb&nbsp;=&nbsp;b**ndigits,&nbsp;bb&nbsp;&lt;=&nbsp;_M</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3776373">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3776378">//&nbsp;construct&nbsp;table&nbsp;of&nbsp;successive&nbsp;squares&nbsp;of&nbsp;bb*leafSize&nbsp;to&nbsp;use&nbsp;in&nbsp;subdivisions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3776459">//&nbsp;result&nbsp;(table&nbsp;!=&nbsp;nil)&nbsp;&lt;=&gt;&nbsp;(len(x)&nbsp;&gt;&nbsp;leafSize&nbsp;&gt;&nbsp;0)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3776514">table</span>&nbsp;<span class="op" id="3776520">:=</span>&nbsp;<span class="ident" id="3776523">divisors</span><span class="op" id="3776531">(</span><span class="builtinfunc" id="3776532">len</span><span class="op" id="3776535">(</span><span class="ident" id="3776536">x</span><span class="op" id="3776537">)</span><span class="op" id="3776538">,</span>&nbsp;<span class="ident" id="3776540">b</span><span class="op" id="3776541">,</span>&nbsp;<span class="ident" id="3776543">ndigits</span><span class="op" id="3776550">,</span>&nbsp;<span class="ident" id="3776552">bb</span><span class="op" id="3776554">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3776559">//&nbsp;preserve&nbsp;x,&nbsp;create&nbsp;local&nbsp;copy&nbsp;for&nbsp;use&nbsp;by&nbsp;convertWords</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3776618">q</span>&nbsp;<span class="op" id="3776620">:=</span>&nbsp;<span class="ident" id="3776623">nat</span><span class="op" id="3776626">(</span><span class="ident" id="3776627">nil</span><span class="op" id="3776630">)</span><span class="op" id="3776631">.</span><span class="ident" id="3776632">set</span><span class="op" id="3776635">(</span><span class="ident" id="3776636">x</span><span class="op" id="3776637">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3776642">//&nbsp;convert&nbsp;q&nbsp;to&nbsp;string&nbsp;s&nbsp;in&nbsp;base&nbsp;b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3776679">q</span><span class="op" id="3776680">.</span><span class="ident" id="3776681">convertWords</span><span class="op" id="3776693">(</span><span class="ident" id="3776694">s</span><span class="op" id="3776695">,</span>&nbsp;<span class="ident" id="3776697">charset</span><span class="op" id="3776704">,</span>&nbsp;<span class="ident" id="3776706">b</span><span class="op" id="3776707">,</span>&nbsp;<span class="ident" id="3776709">ndigits</span><span class="op" id="3776716">,</span>&nbsp;<span class="ident" id="3776718">bb</span><span class="op" id="3776720">,</span>&nbsp;<span class="ident" id="3776722">table</span><span class="op" id="3776727">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3776732">//&nbsp;strip&nbsp;leading&nbsp;zeros</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3776757">//&nbsp;(x&nbsp;!=&nbsp;0;&nbsp;thus&nbsp;s&nbsp;must&nbsp;contain&nbsp;at&nbsp;least&nbsp;one&nbsp;non-zero&nbsp;digit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3776819">//&nbsp;and&nbsp;the&nbsp;loop&nbsp;will&nbsp;terminate)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3776853">i</span>&nbsp;<span class="op" id="3776855">=</span>&nbsp;<span class="num" id="3776857">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3776861">for</span>&nbsp;<span class="ident" id="3776865">zero</span>&nbsp;<span class="op" id="3776870">:=</span>&nbsp;<span class="ident" id="3776873">charset</span><span class="op" id="3776880">[</span><span class="num" id="3776881">0</span><span class="op" id="3776882">]</span><span class="op" id="3776883">;</span>&nbsp;<span class="ident" id="3776885">s</span><span class="op" id="3776886">[</span><span class="ident" id="3776887">i</span><span class="op" id="3776888">]</span>&nbsp;<span class="op" id="3776890">==</span>&nbsp;<span class="ident" id="3776893">zero</span><span class="op" id="3776897">;</span>&nbsp;<span class="op" id="3776899">{</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3776904">i</span><span class="op" id="3776905">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3776910">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3776913">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3776917">return</span>&nbsp;<span class="builtintype" id="3776924">string</span><span class="op" id="3776930">(</span><span class="ident" id="3776931">s</span><span class="op" id="3776932">[</span><span class="ident" id="3776933">i</span><span class="op" id="3776934">:</span><span class="op" id="3776935">]</span><span class="op" id="3776936">)</span><br>
<span class="lineno">825</span><span class="op" id="3776938">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3776941">//&nbsp;Convert&nbsp;words&nbsp;of&nbsp;q&nbsp;to&nbsp;base&nbsp;b&nbsp;digits&nbsp;in&nbsp;s.&nbsp;If&nbsp;q&nbsp;is&nbsp;large,&nbsp;it&nbsp;is&nbsp;recursively&nbsp;&#34;split&nbsp;in&nbsp;half&#34;</span><br>
<span class="lineno"></span><span class="comment" id="3777035">//&nbsp;by&nbsp;nat/nat&nbsp;division&nbsp;using&nbsp;tabulated&nbsp;divisors.&nbsp;Otherwise,&nbsp;it&nbsp;is&nbsp;converted&nbsp;iteratively&nbsp;using</span><br>
<span class="lineno"></span><span class="comment" id="3777129">//&nbsp;repeated&nbsp;nat/Word&nbsp;division.</span><br>
<span class="lineno">830</span><span class="comment" id="3777160">//</span><br>
<span class="lineno"></span><span class="comment" id="3777163">//&nbsp;The&nbsp;iterative&nbsp;method&nbsp;processes&nbsp;n&nbsp;Words&nbsp;by&nbsp;n&nbsp;divW()&nbsp;calls,&nbsp;each&nbsp;of&nbsp;which&nbsp;visits&nbsp;every&nbsp;Word&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3777263">//&nbsp;incrementally&nbsp;shortened&nbsp;q&nbsp;for&nbsp;a&nbsp;total&nbsp;of&nbsp;n&nbsp;+&nbsp;(n-1)&nbsp;+&nbsp;(n-2)&nbsp;...&nbsp;+&nbsp;2&nbsp;+&nbsp;1,&nbsp;or&nbsp;n(n+1)/2&nbsp;divW()&#39;s.</span><br>
<span class="lineno"></span><span class="comment" id="3777360">//&nbsp;Recursive&nbsp;conversion&nbsp;divides&nbsp;q&nbsp;by&nbsp;its&nbsp;approximate&nbsp;square&nbsp;root,&nbsp;yielding&nbsp;two&nbsp;parts,&nbsp;each&nbsp;half</span><br>
<span class="lineno"></span><span class="comment" id="3777456">//&nbsp;the&nbsp;size&nbsp;of&nbsp;q.&nbsp;Using&nbsp;the&nbsp;iterative&nbsp;method&nbsp;on&nbsp;both&nbsp;halves&nbsp;means&nbsp;2&nbsp;*&nbsp;(n/2)(n/2&nbsp;+&nbsp;1)/2&nbsp;divW()&#39;s</span><br>
<span class="lineno">835</span><span class="comment" id="3777552">//&nbsp;plus&nbsp;the&nbsp;expensive&nbsp;long&nbsp;div().&nbsp;Asymptotically,&nbsp;the&nbsp;ratio&nbsp;is&nbsp;favorable&nbsp;at&nbsp;1/2&nbsp;the&nbsp;divW()&#39;s,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3777650">//&nbsp;is&nbsp;made&nbsp;better&nbsp;by&nbsp;splitting&nbsp;the&nbsp;subblocks&nbsp;recursively.&nbsp;Best&nbsp;is&nbsp;to&nbsp;split&nbsp;blocks&nbsp;until&nbsp;one&nbsp;more</span><br>
<span class="lineno"></span><span class="comment" id="3777747">//&nbsp;split&nbsp;would&nbsp;take&nbsp;longer&nbsp;(because&nbsp;of&nbsp;the&nbsp;nat/nat&nbsp;div())&nbsp;than&nbsp;the&nbsp;twice&nbsp;as&nbsp;many&nbsp;divW()&#39;s&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3777844">//&nbsp;iterative&nbsp;approach.&nbsp;This&nbsp;threshold&nbsp;is&nbsp;represented&nbsp;by&nbsp;leafSize.&nbsp;Benchmarking&nbsp;of&nbsp;leafSize&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3777942">//&nbsp;range&nbsp;2..64&nbsp;shows&nbsp;that&nbsp;values&nbsp;of&nbsp;8&nbsp;and&nbsp;16&nbsp;work&nbsp;well,&nbsp;with&nbsp;a&nbsp;4x&nbsp;speedup&nbsp;at&nbsp;medium&nbsp;lengths&nbsp;and</span><br>
<span class="lineno">840</span><span class="comment" id="3778038">//&nbsp;~30x&nbsp;for&nbsp;20000&nbsp;digits.&nbsp;Use&nbsp;nat_test.go&#39;s&nbsp;BenchmarkLeafSize&nbsp;tests&nbsp;to&nbsp;optimize&nbsp;leafSize&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="3778131">//&nbsp;specific&nbsp;hardware.</span><br>
<span class="lineno"></span><span class="comment" id="3778153">//</span><br>
<span class="lineno"></span><span class="keyword" id="3778156">func</span>&nbsp;<span class="op" id="3778161">(</span><span class="ident" id="3778162">q</span>&nbsp;<span class="ident" id="3778164">nat</span><span class="op" id="3778167">)</span>&nbsp;<span class="ident" id="3778169">convertWords</span><span class="op" id="3778181">(</span><span class="ident" id="3778182">s</span>&nbsp;<span class="op" id="3778184">[</span><span class="op" id="3778185">]</span><span class="builtintype" id="3778186">byte</span><span class="op" id="3778190">,</span>&nbsp;<span class="ident" id="3778192">charset</span>&nbsp;<span class="builtintype" id="3778200">string</span><span class="op" id="3778206">,</span>&nbsp;<span class="ident" id="3778208">b</span>&nbsp;<span class="ident" id="3778210">Word</span><span class="op" id="3778214">,</span>&nbsp;<span class="ident" id="3778216">ndigits</span>&nbsp;<span class="builtintype" id="3778224">int</span><span class="op" id="3778227">,</span>&nbsp;<span class="ident" id="3778229">bb</span>&nbsp;<span class="ident" id="3778232">Word</span><span class="op" id="3778236">,</span>&nbsp;<span class="ident" id="3778238">table</span>&nbsp;<span class="op" id="3778244">[</span><span class="op" id="3778245">]</span><span class="ident" id="3778246">divisor</span><span class="op" id="3778253">)</span>&nbsp;<span class="op" id="3778255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3778258">//&nbsp;split&nbsp;larger&nbsp;blocks&nbsp;recursively</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3778294">if</span>&nbsp;<span class="ident" id="3778297">table</span>&nbsp;<span class="op" id="3778303">!=</span>&nbsp;<span class="ident" id="3778306">nil</span>&nbsp;<span class="op" id="3778310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3778314">//&nbsp;len(q)&nbsp;&gt;&nbsp;leafSize&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3778341">var</span>&nbsp;<span class="ident" id="3778345">r</span>&nbsp;<span class="ident" id="3778347">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3778353">index</span>&nbsp;<span class="op" id="3778359">:=</span>&nbsp;<span class="builtinfunc" id="3778362">len</span><span class="op" id="3778365">(</span><span class="ident" id="3778366">table</span><span class="op" id="3778371">)</span>&nbsp;<span class="op" id="3778373">-</span>&nbsp;<span class="num" id="3778375">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3778379">for</span>&nbsp;<span class="builtinfunc" id="3778383">len</span><span class="op" id="3778386">(</span><span class="ident" id="3778387">q</span><span class="op" id="3778388">)</span>&nbsp;<span class="op" id="3778390">&gt;</span>&nbsp;<span class="ident" id="3778392">leafSize</span>&nbsp;<span class="op" id="3778401">{</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3778406">//&nbsp;find&nbsp;divisor&nbsp;close&nbsp;to&nbsp;sqrt(q)&nbsp;if&nbsp;possible,&nbsp;but&nbsp;in&nbsp;any&nbsp;case&nbsp;&lt;&nbsp;q</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3778475">maxLength</span>&nbsp;<span class="op" id="3778485">:=</span>&nbsp;<span class="ident" id="3778488">q</span><span class="op" id="3778489">.</span><span class="ident" id="3778490">bitLen</span><span class="op" id="3778496">(</span><span class="op" id="3778497">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3778503">//&nbsp;~=&nbsp;log2&nbsp;q,&nbsp;or&nbsp;at&nbsp;of&nbsp;least&nbsp;largest&nbsp;possible&nbsp;q&nbsp;of&nbsp;this&nbsp;bit&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3778573">minLength</span>&nbsp;<span class="op" id="3778583">:=</span>&nbsp;<span class="ident" id="3778586">maxLength</span>&nbsp;<span class="op" id="3778596">&gt;&gt;</span>&nbsp;<span class="num" id="3778599">1</span>&nbsp;<span class="comment" id="3778601">//&nbsp;~=&nbsp;log2&nbsp;sqrt(q)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3778623">for</span>&nbsp;<span class="ident" id="3778627">index</span>&nbsp;<span class="op" id="3778633">&gt;</span>&nbsp;<span class="num" id="3778635">0</span>&nbsp;<span class="op" id="3778637">&amp;&amp;</span>&nbsp;<span class="ident" id="3778640">table</span><span class="op" id="3778645">[</span><span class="ident" id="3778646">index</span><span class="op" id="3778651">-</span><span class="num" id="3778652">1</span><span class="op" id="3778653">]</span><span class="op" id="3778654">.</span><span class="ident" id="3778655">nbits</span>&nbsp;<span class="op" id="3778661">&gt;</span>&nbsp;<span class="ident" id="3778663">minLength</span>&nbsp;<span class="op" id="3778673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3778679">index</span><span class="op" id="3778684">--</span>&nbsp;<span class="comment" id="3778687">//&nbsp;desired</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3778701">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3778706">if</span>&nbsp;<span class="ident" id="3778709">table</span><span class="op" id="3778714">[</span><span class="ident" id="3778715">index</span><span class="op" id="3778720">]</span><span class="op" id="3778721">.</span><span class="ident" id="3778722">nbits</span>&nbsp;<span class="op" id="3778728">&gt;=</span>&nbsp;<span class="ident" id="3778731">maxLength</span>&nbsp;<span class="op" id="3778741">&amp;&amp;</span>&nbsp;<span class="ident" id="3778744">table</span><span class="op" id="3778749">[</span><span class="ident" id="3778750">index</span><span class="op" id="3778755">]</span><span class="op" id="3778756">.</span><span class="ident" id="3778757">bbb</span><span class="op" id="3778760">.</span><span class="ident" id="3778761">cmp</span><span class="op" id="3778764">(</span><span class="ident" id="3778765">q</span><span class="op" id="3778766">)</span>&nbsp;<span class="op" id="3778768">&gt;=</span>&nbsp;<span class="num" id="3778771">0</span>&nbsp;<span class="op" id="3778773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3778779">index</span><span class="op" id="3778784">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3778791">if</span>&nbsp;<span class="ident" id="3778794">index</span>&nbsp;<span class="op" id="3778800">&lt;</span>&nbsp;<span class="num" id="3778802">0</span>&nbsp;<span class="op" id="3778804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3778811">panic</span><span class="op" id="3778816">(</span><span class="string" id="3778817">&#34;internal&nbsp;inconsistency&#34;</span><span class="op" id="3778841">)</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3778847">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3778852">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3778858">//&nbsp;split&nbsp;q&nbsp;into&nbsp;the&nbsp;two&nbsp;digit&nbsp;number&nbsp;(q&#39;*bbb&nbsp;+&nbsp;r)&nbsp;to&nbsp;form&nbsp;independent&nbsp;subblocks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3778941">q</span><span class="op" id="3778942">,</span>&nbsp;<span class="ident" id="3778944">r</span>&nbsp;<span class="op" id="3778946">=</span>&nbsp;<span class="ident" id="3778948">q</span><span class="op" id="3778949">.</span><span class="ident" id="3778950">div</span><span class="op" id="3778953">(</span><span class="ident" id="3778954">r</span><span class="op" id="3778955">,</span>&nbsp;<span class="ident" id="3778957">q</span><span class="op" id="3778958">,</span>&nbsp;<span class="ident" id="3778960">table</span><span class="op" id="3778965">[</span><span class="ident" id="3778966">index</span><span class="op" id="3778971">]</span><span class="op" id="3778972">.</span><span class="ident" id="3778973">bbb</span><span class="op" id="3778976">)</span><br>
<span class="lineno">865</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3778982">//&nbsp;convert&nbsp;subblocks&nbsp;and&nbsp;collect&nbsp;results&nbsp;in&nbsp;s[:h]&nbsp;and&nbsp;s[h:]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3779045">h</span>&nbsp;<span class="op" id="3779047">:=</span>&nbsp;<span class="builtinfunc" id="3779050">len</span><span class="op" id="3779053">(</span><span class="ident" id="3779054">s</span><span class="op" id="3779055">)</span>&nbsp;<span class="op" id="3779057">-</span>&nbsp;<span class="ident" id="3779059">table</span><span class="op" id="3779064">[</span><span class="ident" id="3779065">index</span><span class="op" id="3779070">]</span><span class="op" id="3779071">.</span><span class="ident" id="3779072">ndigits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3779083">r</span><span class="op" id="3779084">.</span><span class="ident" id="3779085">convertWords</span><span class="op" id="3779097">(</span><span class="ident" id="3779098">s</span><span class="op" id="3779099">[</span><span class="ident" id="3779100">h</span><span class="op" id="3779101">:</span><span class="op" id="3779102">]</span><span class="op" id="3779103">,</span>&nbsp;<span class="ident" id="3779105">charset</span><span class="op" id="3779112">,</span>&nbsp;<span class="ident" id="3779114">b</span><span class="op" id="3779115">,</span>&nbsp;<span class="ident" id="3779117">ndigits</span><span class="op" id="3779124">,</span>&nbsp;<span class="ident" id="3779126">bb</span><span class="op" id="3779128">,</span>&nbsp;<span class="ident" id="3779130">table</span><span class="op" id="3779135">[</span><span class="num" id="3779136">0</span><span class="op" id="3779137">:</span><span class="ident" id="3779138">index</span><span class="op" id="3779143">]</span><span class="op" id="3779144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3779149">s</span>&nbsp;<span class="op" id="3779151">=</span>&nbsp;<span class="ident" id="3779153">s</span><span class="op" id="3779154">[</span><span class="op" id="3779155">:</span><span class="ident" id="3779156">h</span><span class="op" id="3779157">]</span>&nbsp;<span class="comment" id="3779159">//&nbsp;==&nbsp;q.convertWords(s,&nbsp;charset,&nbsp;b,&nbsp;ndigits,&nbsp;bb,&nbsp;table[0:index+1])</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3779228">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3779231">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3779235">//&nbsp;having&nbsp;split&nbsp;any&nbsp;large&nbsp;blocks&nbsp;now&nbsp;process&nbsp;the&nbsp;remaining&nbsp;(small)&nbsp;block&nbsp;iteratively</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3779321">i</span>&nbsp;<span class="op" id="3779323">:=</span>&nbsp;<span class="builtinfunc" id="3779326">len</span><span class="op" id="3779329">(</span><span class="ident" id="3779330">s</span><span class="op" id="3779331">)</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3779334">var</span>&nbsp;<span class="ident" id="3779338">r</span>&nbsp;<span class="ident" id="3779340">Word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3779346">if</span>&nbsp;<span class="ident" id="3779349">b</span>&nbsp;<span class="op" id="3779351">==</span>&nbsp;<span class="num" id="3779354">10</span>&nbsp;<span class="op" id="3779357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3779361">//&nbsp;hard-coding&nbsp;for&nbsp;10&nbsp;here&nbsp;speeds&nbsp;this&nbsp;up&nbsp;by&nbsp;1.25x&nbsp;(allows&nbsp;for&nbsp;/&nbsp;and&nbsp;%&nbsp;by&nbsp;constants)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3779448">for</span>&nbsp;<span class="builtinfunc" id="3779452">len</span><span class="op" id="3779455">(</span><span class="ident" id="3779456">q</span><span class="op" id="3779457">)</span>&nbsp;<span class="op" id="3779459">&gt;</span>&nbsp;<span class="num" id="3779461">0</span>&nbsp;<span class="op" id="3779463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3779468">//&nbsp;extract&nbsp;least&nbsp;significant,&nbsp;base&nbsp;bb&nbsp;&#34;digit&#34;</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3779517">q</span><span class="op" id="3779518">,</span>&nbsp;<span class="ident" id="3779520">r</span>&nbsp;<span class="op" id="3779522">=</span>&nbsp;<span class="ident" id="3779524">q</span><span class="op" id="3779525">.</span><span class="ident" id="3779526">divW</span><span class="op" id="3779530">(</span><span class="ident" id="3779531">q</span><span class="op" id="3779532">,</span>&nbsp;<span class="ident" id="3779534">bb</span><span class="op" id="3779536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3779541">for</span>&nbsp;<span class="ident" id="3779545">j</span>&nbsp;<span class="op" id="3779547">:=</span>&nbsp;<span class="num" id="3779550">0</span><span class="op" id="3779551">;</span>&nbsp;<span class="ident" id="3779553">j</span>&nbsp;<span class="op" id="3779555">&lt;</span>&nbsp;<span class="ident" id="3779557">ndigits</span>&nbsp;<span class="op" id="3779565">&amp;&amp;</span>&nbsp;<span class="ident" id="3779568">i</span>&nbsp;<span class="op" id="3779570">&gt;</span>&nbsp;<span class="num" id="3779572">0</span><span class="op" id="3779573">;</span>&nbsp;<span class="ident" id="3779575">j</span><span class="op" id="3779576">++</span>&nbsp;<span class="op" id="3779579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3779585">i</span><span class="op" id="3779586">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3779593">//&nbsp;avoid&nbsp;%&nbsp;computation&nbsp;since&nbsp;r%10&nbsp;==&nbsp;r&nbsp;-&nbsp;int(r/10)*10;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3779652">//&nbsp;this&nbsp;appears&nbsp;to&nbsp;be&nbsp;faster&nbsp;for&nbsp;BenchmarkString10000Base10</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3779716">//&nbsp;and&nbsp;smaller&nbsp;strings&nbsp;(but&nbsp;a&nbsp;bit&nbsp;slower&nbsp;for&nbsp;larger&nbsp;ones)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3779778">t</span>&nbsp;<span class="op" id="3779780">:=</span>&nbsp;<span class="ident" id="3779783">r</span>&nbsp;<span class="op" id="3779785">/</span>&nbsp;<span class="num" id="3779787">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3779794">s</span><span class="op" id="3779795">[</span><span class="ident" id="3779796">i</span><span class="op" id="3779797">]</span>&nbsp;<span class="op" id="3779799">=</span>&nbsp;<span class="ident" id="3779801">charset</span><span class="op" id="3779808">[</span><span class="ident" id="3779809">r</span><span class="op" id="3779810">-</span><span class="ident" id="3779811">t</span><span class="op" id="3779812">&lt;&lt;</span><span class="num" id="3779814">3</span><span class="op" id="3779815">-</span><span class="ident" id="3779816">t</span><span class="op" id="3779817">-</span><span class="ident" id="3779818">t</span><span class="op" id="3779819">]</span>&nbsp;<span class="comment" id="3779821">//&nbsp;TODO(gri)&nbsp;replace&nbsp;w/&nbsp;t*10&nbsp;once&nbsp;compiler&nbsp;produces&nbsp;better&nbsp;code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3779889">r</span>&nbsp;<span class="op" id="3779891">=</span>&nbsp;<span class="ident" id="3779893">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3779898">}</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3779902">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3779905">}</span>&nbsp;<span class="keyword" id="3779907">else</span>&nbsp;<span class="op" id="3779912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3779916">for</span>&nbsp;<span class="builtinfunc" id="3779920">len</span><span class="op" id="3779923">(</span><span class="ident" id="3779924">q</span><span class="op" id="3779925">)</span>&nbsp;<span class="op" id="3779927">&gt;</span>&nbsp;<span class="num" id="3779929">0</span>&nbsp;<span class="op" id="3779931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3779936">//&nbsp;extract&nbsp;least&nbsp;significant,&nbsp;base&nbsp;bb&nbsp;&#34;digit&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3779985">q</span><span class="op" id="3779986">,</span>&nbsp;<span class="ident" id="3779988">r</span>&nbsp;<span class="op" id="3779990">=</span>&nbsp;<span class="ident" id="3779992">q</span><span class="op" id="3779993">.</span><span class="ident" id="3779994">divW</span><span class="op" id="3779998">(</span><span class="ident" id="3779999">q</span><span class="op" id="3780000">,</span>&nbsp;<span class="ident" id="3780002">bb</span><span class="op" id="3780004">)</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3780009">for</span>&nbsp;<span class="ident" id="3780013">j</span>&nbsp;<span class="op" id="3780015">:=</span>&nbsp;<span class="num" id="3780018">0</span><span class="op" id="3780019">;</span>&nbsp;<span class="ident" id="3780021">j</span>&nbsp;<span class="op" id="3780023">&lt;</span>&nbsp;<span class="ident" id="3780025">ndigits</span>&nbsp;<span class="op" id="3780033">&amp;&amp;</span>&nbsp;<span class="ident" id="3780036">i</span>&nbsp;<span class="op" id="3780038">&gt;</span>&nbsp;<span class="num" id="3780040">0</span><span class="op" id="3780041">;</span>&nbsp;<span class="ident" id="3780043">j</span><span class="op" id="3780044">++</span>&nbsp;<span class="op" id="3780047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3780053">i</span><span class="op" id="3780054">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3780061">s</span><span class="op" id="3780062">[</span><span class="ident" id="3780063">i</span><span class="op" id="3780064">]</span>&nbsp;<span class="op" id="3780066">=</span>&nbsp;<span class="ident" id="3780068">charset</span><span class="op" id="3780075">[</span><span class="ident" id="3780076">r</span><span class="op" id="3780077">%</span><span class="ident" id="3780078">b</span><span class="op" id="3780079">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3780085">r</span>&nbsp;<span class="op" id="3780087">/=</span>&nbsp;<span class="ident" id="3780090">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3780095">}</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3780099">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3780102">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3780106">//&nbsp;prepend&nbsp;high-order&nbsp;zeroes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3780136">zero</span>&nbsp;<span class="op" id="3780141">:=</span>&nbsp;<span class="ident" id="3780144">charset</span><span class="op" id="3780151">[</span><span class="num" id="3780152">0</span><span class="op" id="3780153">]</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3780156">for</span>&nbsp;<span class="ident" id="3780160">i</span>&nbsp;<span class="op" id="3780162">&gt;</span>&nbsp;<span class="num" id="3780164">0</span>&nbsp;<span class="op" id="3780166">{</span>&nbsp;<span class="comment" id="3780168">//&nbsp;while&nbsp;need&nbsp;more&nbsp;leading&nbsp;zeroes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3780204">i</span><span class="op" id="3780205">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3780210">s</span><span class="op" id="3780211">[</span><span class="ident" id="3780212">i</span><span class="op" id="3780213">]</span>&nbsp;<span class="op" id="3780215">=</span>&nbsp;<span class="ident" id="3780217">zero</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3780223">}</span><br>
<span class="lineno"></span><span class="op" id="3780225">}</span><br>
<span class="lineno">910</span><br>
<span class="lineno"></span><span class="comment" id="3780228">//&nbsp;Split&nbsp;blocks&nbsp;greater&nbsp;than&nbsp;leafSize&nbsp;Words&nbsp;(or&nbsp;set&nbsp;to&nbsp;0&nbsp;to&nbsp;disable&nbsp;recursive&nbsp;conversion)</span><br>
<span class="lineno"></span><span class="comment" id="3780318">//&nbsp;Benchmark&nbsp;and&nbsp;configure&nbsp;leafSize&nbsp;using:&nbsp;go&nbsp;test&nbsp;-bench=&#34;Leaf&#34;</span><br>
<span class="lineno"></span><span class="comment" id="3780383">//&nbsp;&nbsp;&nbsp;8&nbsp;and&nbsp;16&nbsp;effective&nbsp;on&nbsp;3.0&nbsp;GHz&nbsp;Xeon&nbsp;&#34;Clovertown&#34;&nbsp;CPU&nbsp;(128&nbsp;byte&nbsp;cache&nbsp;lines)</span><br>
<span class="lineno"></span><span class="comment" id="3780463">//&nbsp;&nbsp;&nbsp;8&nbsp;and&nbsp;16&nbsp;effective&nbsp;on&nbsp;2.66&nbsp;GHz&nbsp;Core&nbsp;2&nbsp;Duo&nbsp;&#34;Penryn&#34;&nbsp;CPU</span><br>
<span class="lineno">915</span><span class="keyword" id="3780523">var</span>&nbsp;<span class="ident" id="3780527">leafSize</span>&nbsp;<span class="builtintype" id="3780536">int</span>&nbsp;<span class="op" id="3780540">=</span>&nbsp;<span class="num" id="3780542">8</span>&nbsp;<span class="comment" id="3780544">//&nbsp;number&nbsp;of&nbsp;Word-size&nbsp;binary&nbsp;values&nbsp;treat&nbsp;as&nbsp;a&nbsp;monolithic&nbsp;block</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3780610">type</span>&nbsp;<span class="ident" id="3780615">divisor</span>&nbsp;<span class="keyword" id="3780623">struct</span>&nbsp;<span class="op" id="3780630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3780633">bbb</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3780641">nat</span>&nbsp;<span class="comment" id="3780645">//&nbsp;divisor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3780657">nbits</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3780665">int</span>&nbsp;<span class="comment" id="3780669">//&nbsp;bit&nbsp;length&nbsp;of&nbsp;divisor&nbsp;(discounting&nbsp;leading&nbsp;zeroes)&nbsp;~=&nbsp;log2(bbb)</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3780737">ndigits</span>&nbsp;<span class="builtintype" id="3780745">int</span>&nbsp;<span class="comment" id="3780749">//&nbsp;digit&nbsp;length&nbsp;of&nbsp;divisor&nbsp;in&nbsp;terms&nbsp;of&nbsp;output&nbsp;base&nbsp;digits</span><br>
<span class="lineno"></span><span class="op" id="3780807">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3780810">var</span>&nbsp;<span class="ident" id="3780814">cacheBase10</span>&nbsp;<span class="keyword" id="3780826">struct</span>&nbsp;<span class="op" id="3780833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3780836">sync</span><span class="op" id="3780840">.</span><span class="ident" id="3780841">Mutex</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3780848">table</span>&nbsp;<span class="op" id="3780854">[</span><span class="num" id="3780855">64</span><span class="op" id="3780857">]</span><span class="ident" id="3780858">divisor</span>&nbsp;<span class="comment" id="3780866">//&nbsp;cached&nbsp;divisors&nbsp;for&nbsp;base&nbsp;10</span><br>
<span class="lineno"></span><span class="op" id="3780897">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3780900">//&nbsp;expWW&nbsp;computes&nbsp;x**y</span><br>
<span class="lineno"></span><span class="keyword" id="3780923">func</span>&nbsp;<span class="op" id="3780928">(</span><span class="ident" id="3780929">z</span>&nbsp;<span class="ident" id="3780931">nat</span><span class="op" id="3780934">)</span>&nbsp;<span class="ident" id="3780936">expWW</span><span class="op" id="3780941">(</span><span class="ident" id="3780942">x</span><span class="op" id="3780943">,</span>&nbsp;<span class="ident" id="3780945">y</span>&nbsp;<span class="ident" id="3780947">Word</span><span class="op" id="3780951">)</span>&nbsp;<span class="ident" id="3780953">nat</span>&nbsp;<span class="op" id="3780957">{</span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3780960">return</span>&nbsp;<span class="ident" id="3780967">z</span><span class="op" id="3780968">.</span><span class="ident" id="3780969">expNN</span><span class="op" id="3780974">(</span><span class="ident" id="3780975">nat</span><span class="op" id="3780978">(</span><span class="ident" id="3780979">nil</span><span class="op" id="3780982">)</span><span class="op" id="3780983">.</span><span class="ident" id="3780984">setWord</span><span class="op" id="3780991">(</span><span class="ident" id="3780992">x</span><span class="op" id="3780993">)</span><span class="op" id="3780994">,</span>&nbsp;<span class="ident" id="3780996">nat</span><span class="op" id="3780999">(</span><span class="ident" id="3781000">nil</span><span class="op" id="3781003">)</span><span class="op" id="3781004">.</span><span class="ident" id="3781005">setWord</span><span class="op" id="3781012">(</span><span class="ident" id="3781013">y</span><span class="op" id="3781014">)</span><span class="op" id="3781015">,</span>&nbsp;<span class="ident" id="3781017">nil</span><span class="op" id="3781020">)</span><br>
<span class="lineno"></span><span class="op" id="3781022">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3781025">//&nbsp;construct&nbsp;table&nbsp;of&nbsp;powers&nbsp;of&nbsp;bb*leafSize&nbsp;to&nbsp;use&nbsp;in&nbsp;subdivisions</span><br>
<span class="lineno"></span><span class="keyword" id="3781092">func</span>&nbsp;<span class="ident" id="3781097">divisors</span><span class="op" id="3781105">(</span><span class="ident" id="3781106">m</span>&nbsp;<span class="builtintype" id="3781108">int</span><span class="op" id="3781111">,</span>&nbsp;<span class="ident" id="3781113">b</span>&nbsp;<span class="ident" id="3781115">Word</span><span class="op" id="3781119">,</span>&nbsp;<span class="ident" id="3781121">ndigits</span>&nbsp;<span class="builtintype" id="3781129">int</span><span class="op" id="3781132">,</span>&nbsp;<span class="ident" id="3781134">bb</span>&nbsp;<span class="ident" id="3781137">Word</span><span class="op" id="3781141">)</span>&nbsp;<span class="op" id="3781143">[</span><span class="op" id="3781144">]</span><span class="ident" id="3781145">divisor</span>&nbsp;<span class="op" id="3781153">{</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3781156">//&nbsp;only&nbsp;compute&nbsp;table&nbsp;when&nbsp;recursive&nbsp;conversion&nbsp;is&nbsp;enabled&nbsp;and&nbsp;x&nbsp;is&nbsp;large</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3781231">if</span>&nbsp;<span class="ident" id="3781234">leafSize</span>&nbsp;<span class="op" id="3781243">==</span>&nbsp;<span class="num" id="3781246">0</span>&nbsp;<span class="op" id="3781248">||</span>&nbsp;<span class="ident" id="3781251">m</span>&nbsp;<span class="op" id="3781253">&lt;=</span>&nbsp;<span class="ident" id="3781256">leafSize</span>&nbsp;<span class="op" id="3781265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3781269">return</span>&nbsp;<span class="ident" id="3781276">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3781281">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3781285">//&nbsp;determine&nbsp;k&nbsp;where&nbsp;(bb**leafSize)**(2**k)&nbsp;&gt;=&nbsp;sqrt(x)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3781341">k</span>&nbsp;<span class="op" id="3781343">:=</span>&nbsp;<span class="num" id="3781346">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3781349">for</span>&nbsp;<span class="ident" id="3781353">words</span>&nbsp;<span class="op" id="3781359">:=</span>&nbsp;<span class="ident" id="3781362">leafSize</span><span class="op" id="3781370">;</span>&nbsp;<span class="ident" id="3781372">words</span>&nbsp;<span class="op" id="3781378">&lt;</span>&nbsp;<span class="ident" id="3781380">m</span><span class="op" id="3781381">&gt;&gt;</span><span class="num" id="3781383">1</span>&nbsp;<span class="op" id="3781385">&amp;&amp;</span>&nbsp;<span class="ident" id="3781388">k</span>&nbsp;<span class="op" id="3781390">&lt;</span>&nbsp;<span class="builtinfunc" id="3781392">len</span><span class="op" id="3781395">(</span><span class="ident" id="3781396">cacheBase10</span><span class="op" id="3781407">.</span><span class="ident" id="3781408">table</span><span class="op" id="3781413">)</span><span class="op" id="3781414">;</span>&nbsp;<span class="ident" id="3781416">words</span>&nbsp;<span class="op" id="3781422">&lt;&lt;=</span>&nbsp;<span class="num" id="3781426">1</span>&nbsp;<span class="op" id="3781428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3781432">k</span><span class="op" id="3781433">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3781437">}</span><br>
<span class="lineno">945</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3781441">//&nbsp;reuse&nbsp;and&nbsp;extend&nbsp;existing&nbsp;table&nbsp;of&nbsp;divisors&nbsp;or&nbsp;create&nbsp;new&nbsp;table&nbsp;as&nbsp;appropriate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3781524">var</span>&nbsp;<span class="ident" id="3781528">table</span>&nbsp;<span class="op" id="3781534">[</span><span class="op" id="3781535">]</span><span class="ident" id="3781536">divisor</span>&nbsp;<span class="comment" id="3781544">//&nbsp;for&nbsp;b&nbsp;==&nbsp;10,&nbsp;table&nbsp;overlaps&nbsp;with&nbsp;cacheBase10.table</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3781599">if</span>&nbsp;<span class="ident" id="3781602">b</span>&nbsp;<span class="op" id="3781604">==</span>&nbsp;<span class="num" id="3781607">10</span>&nbsp;<span class="op" id="3781610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3781614">cacheBase10</span><span class="op" id="3781625">.</span><span class="ident" id="3781626">Lock</span><span class="op" id="3781630">(</span><span class="op" id="3781631">)</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3781635">table</span>&nbsp;<span class="op" id="3781641">=</span>&nbsp;<span class="ident" id="3781643">cacheBase10</span><span class="op" id="3781654">.</span><span class="ident" id="3781655">table</span><span class="op" id="3781660">[</span><span class="num" id="3781661">0</span><span class="op" id="3781662">:</span><span class="ident" id="3781663">k</span><span class="op" id="3781664">]</span>&nbsp;<span class="comment" id="3781666">//&nbsp;reuse&nbsp;old&nbsp;table&nbsp;for&nbsp;this&nbsp;conversion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3781706">}</span>&nbsp;<span class="keyword" id="3781708">else</span>&nbsp;<span class="op" id="3781713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3781717">table</span>&nbsp;<span class="op" id="3781723">=</span>&nbsp;<span class="builtinfunc" id="3781725">make</span><span class="op" id="3781729">(</span><span class="op" id="3781730">[</span><span class="op" id="3781731">]</span><span class="ident" id="3781732">divisor</span><span class="op" id="3781739">,</span>&nbsp;<span class="ident" id="3781741">k</span><span class="op" id="3781742">)</span>&nbsp;<span class="comment" id="3781744">//&nbsp;create&nbsp;new&nbsp;table&nbsp;for&nbsp;this&nbsp;conversion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3781785">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3781789">//&nbsp;extend&nbsp;table</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3781806">if</span>&nbsp;<span class="ident" id="3781809">table</span><span class="op" id="3781814">[</span><span class="ident" id="3781815">k</span><span class="op" id="3781816">-</span><span class="num" id="3781817">1</span><span class="op" id="3781818">]</span><span class="op" id="3781819">.</span><span class="ident" id="3781820">ndigits</span>&nbsp;<span class="op" id="3781828">==</span>&nbsp;<span class="num" id="3781831">0</span>&nbsp;<span class="op" id="3781833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3781837">//&nbsp;add&nbsp;new&nbsp;entries&nbsp;as&nbsp;needed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3781868">var</span>&nbsp;<span class="ident" id="3781872">larger</span>&nbsp;<span class="ident" id="3781879">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3781885">for</span>&nbsp;<span class="ident" id="3781889">i</span>&nbsp;<span class="op" id="3781891">:=</span>&nbsp;<span class="num" id="3781894">0</span><span class="op" id="3781895">;</span>&nbsp;<span class="ident" id="3781897">i</span>&nbsp;<span class="op" id="3781899">&lt;</span>&nbsp;<span class="ident" id="3781901">k</span><span class="op" id="3781902">;</span>&nbsp;<span class="ident" id="3781904">i</span><span class="op" id="3781905">++</span>&nbsp;<span class="op" id="3781908">{</span><br>
<span class="lineno">960</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3781913">if</span>&nbsp;<span class="ident" id="3781916">table</span><span class="op" id="3781921">[</span><span class="ident" id="3781922">i</span><span class="op" id="3781923">]</span><span class="op" id="3781924">.</span><span class="ident" id="3781925">ndigits</span>&nbsp;<span class="op" id="3781933">==</span>&nbsp;<span class="num" id="3781936">0</span>&nbsp;<span class="op" id="3781938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3781944">if</span>&nbsp;<span class="ident" id="3781947">i</span>&nbsp;<span class="op" id="3781949">==</span>&nbsp;<span class="num" id="3781952">0</span>&nbsp;<span class="op" id="3781954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3781961">table</span><span class="op" id="3781966">[</span><span class="num" id="3781967">0</span><span class="op" id="3781968">]</span><span class="op" id="3781969">.</span><span class="ident" id="3781970">bbb</span>&nbsp;<span class="op" id="3781974">=</span>&nbsp;<span class="ident" id="3781976">nat</span><span class="op" id="3781979">(</span><span class="ident" id="3781980">nil</span><span class="op" id="3781983">)</span><span class="op" id="3781984">.</span><span class="ident" id="3781985">expWW</span><span class="op" id="3781990">(</span><span class="ident" id="3781991">bb</span><span class="op" id="3781993">,</span>&nbsp;<span class="ident" id="3781995">Word</span><span class="op" id="3781999">(</span><span class="ident" id="3782000">leafSize</span><span class="op" id="3782008">)</span><span class="op" id="3782009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3782016">table</span><span class="op" id="3782021">[</span><span class="num" id="3782022">0</span><span class="op" id="3782023">]</span><span class="op" id="3782024">.</span><span class="ident" id="3782025">ndigits</span>&nbsp;<span class="op" id="3782033">=</span>&nbsp;<span class="ident" id="3782035">ndigits</span>&nbsp;<span class="op" id="3782043">*</span>&nbsp;<span class="ident" id="3782045">leafSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3782058">}</span>&nbsp;<span class="keyword" id="3782060">else</span>&nbsp;<span class="op" id="3782065">{</span><br>
<span class="lineno">965</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3782072">table</span><span class="op" id="3782077">[</span><span class="ident" id="3782078">i</span><span class="op" id="3782079">]</span><span class="op" id="3782080">.</span><span class="ident" id="3782081">bbb</span>&nbsp;<span class="op" id="3782085">=</span>&nbsp;<span class="ident" id="3782087">nat</span><span class="op" id="3782090">(</span><span class="ident" id="3782091">nil</span><span class="op" id="3782094">)</span><span class="op" id="3782095">.</span><span class="ident" id="3782096">mul</span><span class="op" id="3782099">(</span><span class="ident" id="3782100">table</span><span class="op" id="3782105">[</span><span class="ident" id="3782106">i</span><span class="op" id="3782107">-</span><span class="num" id="3782108">1</span><span class="op" id="3782109">]</span><span class="op" id="3782110">.</span><span class="ident" id="3782111">bbb</span><span class="op" id="3782114">,</span>&nbsp;<span class="ident" id="3782116">table</span><span class="op" id="3782121">[</span><span class="ident" id="3782122">i</span><span class="op" id="3782123">-</span><span class="num" id="3782124">1</span><span class="op" id="3782125">]</span><span class="op" id="3782126">.</span><span class="ident" id="3782127">bbb</span><span class="op" id="3782130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3782137">table</span><span class="op" id="3782142">[</span><span class="ident" id="3782143">i</span><span class="op" id="3782144">]</span><span class="op" id="3782145">.</span><span class="ident" id="3782146">ndigits</span>&nbsp;<span class="op" id="3782154">=</span>&nbsp;<span class="num" id="3782156">2</span>&nbsp;<span class="op" id="3782158">*</span>&nbsp;<span class="ident" id="3782160">table</span><span class="op" id="3782165">[</span><span class="ident" id="3782166">i</span><span class="op" id="3782167">-</span><span class="num" id="3782168">1</span><span class="op" id="3782169">]</span><span class="op" id="3782170">.</span><span class="ident" id="3782171">ndigits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3782183">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3782190">//&nbsp;optimization:&nbsp;exploit&nbsp;aggregated&nbsp;extra&nbsp;bits&nbsp;in&nbsp;macro&nbsp;blocks</span><br>
<span class="lineno">970</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3782257">larger</span>&nbsp;<span class="op" id="3782264">=</span>&nbsp;<span class="ident" id="3782266">nat</span><span class="op" id="3782269">(</span><span class="ident" id="3782270">nil</span><span class="op" id="3782273">)</span><span class="op" id="3782274">.</span><span class="ident" id="3782275">set</span><span class="op" id="3782278">(</span><span class="ident" id="3782279">table</span><span class="op" id="3782284">[</span><span class="ident" id="3782285">i</span><span class="op" id="3782286">]</span><span class="op" id="3782287">.</span><span class="ident" id="3782288">bbb</span><span class="op" id="3782291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3782297">for</span>&nbsp;<span class="ident" id="3782301">mulAddVWW</span><span class="op" id="3782310">(</span><span class="ident" id="3782311">larger</span><span class="op" id="3782317">,</span>&nbsp;<span class="ident" id="3782319">larger</span><span class="op" id="3782325">,</span>&nbsp;<span class="ident" id="3782327">b</span><span class="op" id="3782328">,</span>&nbsp;<span class="num" id="3782330">0</span><span class="op" id="3782331">)</span>&nbsp;<span class="op" id="3782333">==</span>&nbsp;<span class="num" id="3782336">0</span>&nbsp;<span class="op" id="3782338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3782345">table</span><span class="op" id="3782350">[</span><span class="ident" id="3782351">i</span><span class="op" id="3782352">]</span><span class="op" id="3782353">.</span><span class="ident" id="3782354">bbb</span>&nbsp;<span class="op" id="3782358">=</span>&nbsp;<span class="ident" id="3782360">table</span><span class="op" id="3782365">[</span><span class="ident" id="3782366">i</span><span class="op" id="3782367">]</span><span class="op" id="3782368">.</span><span class="ident" id="3782369">bbb</span><span class="op" id="3782372">.</span><span class="ident" id="3782373">set</span><span class="op" id="3782376">(</span><span class="ident" id="3782377">larger</span><span class="op" id="3782383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3782390">table</span><span class="op" id="3782395">[</span><span class="ident" id="3782396">i</span><span class="op" id="3782397">]</span><span class="op" id="3782398">.</span><span class="ident" id="3782399">ndigits</span><span class="op" id="3782406">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3782413">}</span><br>
<span class="lineno">975</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3782420">table</span><span class="op" id="3782425">[</span><span class="ident" id="3782426">i</span><span class="op" id="3782427">]</span><span class="op" id="3782428">.</span><span class="ident" id="3782429">nbits</span>&nbsp;<span class="op" id="3782435">=</span>&nbsp;<span class="ident" id="3782437">table</span><span class="op" id="3782442">[</span><span class="ident" id="3782443">i</span><span class="op" id="3782444">]</span><span class="op" id="3782445">.</span><span class="ident" id="3782446">bbb</span><span class="op" id="3782449">.</span><span class="ident" id="3782450">bitLen</span><span class="op" id="3782456">(</span><span class="op" id="3782457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3782462">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3782466">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3782469">}</span><br>
<span class="lineno">980</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3782473">if</span>&nbsp;<span class="ident" id="3782476">b</span>&nbsp;<span class="op" id="3782478">==</span>&nbsp;<span class="num" id="3782481">10</span>&nbsp;<span class="op" id="3782484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3782488">cacheBase10</span><span class="op" id="3782499">.</span><span class="ident" id="3782500">Unlock</span><span class="op" id="3782506">(</span><span class="op" id="3782507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3782510">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">985</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3782514">return</span>&nbsp;<span class="ident" id="3782521">table</span><br>
<span class="lineno"></span><span class="op" id="3782527">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3782530">const</span>&nbsp;<span class="ident" id="3782536">deBruijn32</span>&nbsp;<span class="op" id="3782547">=</span>&nbsp;<span class="num" id="3782549">0x077CB531</span><br>
<span class="lineno"></span><br>
<span class="lineno">990</span><span class="keyword" id="3782561">var</span>&nbsp;<span class="ident" id="3782565">deBruijn32Lookup</span>&nbsp;<span class="op" id="3782582">=</span>&nbsp;<span class="op" id="3782584">[</span><span class="op" id="3782585">]</span><span class="builtintype" id="3782586">byte</span><span class="op" id="3782590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3782593">0</span><span class="op" id="3782594">,</span>&nbsp;<span class="num" id="3782596">1</span><span class="op" id="3782597">,</span>&nbsp;<span class="num" id="3782599">28</span><span class="op" id="3782601">,</span>&nbsp;<span class="num" id="3782603">2</span><span class="op" id="3782604">,</span>&nbsp;<span class="num" id="3782606">29</span><span class="op" id="3782608">,</span>&nbsp;<span class="num" id="3782610">14</span><span class="op" id="3782612">,</span>&nbsp;<span class="num" id="3782614">24</span><span class="op" id="3782616">,</span>&nbsp;<span class="num" id="3782618">3</span><span class="op" id="3782619">,</span>&nbsp;<span class="num" id="3782621">30</span><span class="op" id="3782623">,</span>&nbsp;<span class="num" id="3782625">22</span><span class="op" id="3782627">,</span>&nbsp;<span class="num" id="3782629">20</span><span class="op" id="3782631">,</span>&nbsp;<span class="num" id="3782633">15</span><span class="op" id="3782635">,</span>&nbsp;<span class="num" id="3782637">25</span><span class="op" id="3782639">,</span>&nbsp;<span class="num" id="3782641">17</span><span class="op" id="3782643">,</span>&nbsp;<span class="num" id="3782645">4</span><span class="op" id="3782646">,</span>&nbsp;<span class="num" id="3782648">8</span><span class="op" id="3782649">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3782652">31</span><span class="op" id="3782654">,</span>&nbsp;<span class="num" id="3782656">27</span><span class="op" id="3782658">,</span>&nbsp;<span class="num" id="3782660">13</span><span class="op" id="3782662">,</span>&nbsp;<span class="num" id="3782664">23</span><span class="op" id="3782666">,</span>&nbsp;<span class="num" id="3782668">21</span><span class="op" id="3782670">,</span>&nbsp;<span class="num" id="3782672">19</span><span class="op" id="3782674">,</span>&nbsp;<span class="num" id="3782676">16</span><span class="op" id="3782678">,</span>&nbsp;<span class="num" id="3782680">7</span><span class="op" id="3782681">,</span>&nbsp;<span class="num" id="3782683">26</span><span class="op" id="3782685">,</span>&nbsp;<span class="num" id="3782687">12</span><span class="op" id="3782689">,</span>&nbsp;<span class="num" id="3782691">18</span><span class="op" id="3782693">,</span>&nbsp;<span class="num" id="3782695">6</span><span class="op" id="3782696">,</span>&nbsp;<span class="num" id="3782698">11</span><span class="op" id="3782700">,</span>&nbsp;<span class="num" id="3782702">5</span><span class="op" id="3782703">,</span>&nbsp;<span class="num" id="3782705">10</span><span class="op" id="3782707">,</span>&nbsp;<span class="num" id="3782709">9</span><span class="op" id="3782710">,</span><br>
<span class="lineno"></span><span class="op" id="3782712">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">995</span><span class="keyword" id="3782715">const</span>&nbsp;<span class="ident" id="3782721">deBruijn64</span>&nbsp;<span class="op" id="3782732">=</span>&nbsp;<span class="num" id="3782734">0x03f79d71b4ca8b09</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3782754">var</span>&nbsp;<span class="ident" id="3782758">deBruijn64Lookup</span>&nbsp;<span class="op" id="3782775">=</span>&nbsp;<span class="op" id="3782777">[</span><span class="op" id="3782778">]</span><span class="builtintype" id="3782779">byte</span><span class="op" id="3782783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3782786">0</span><span class="op" id="3782787">,</span>&nbsp;<span class="num" id="3782789">1</span><span class="op" id="3782790">,</span>&nbsp;<span class="num" id="3782792">56</span><span class="op" id="3782794">,</span>&nbsp;<span class="num" id="3782796">2</span><span class="op" id="3782797">,</span>&nbsp;<span class="num" id="3782799">57</span><span class="op" id="3782801">,</span>&nbsp;<span class="num" id="3782803">49</span><span class="op" id="3782805">,</span>&nbsp;<span class="num" id="3782807">28</span><span class="op" id="3782809">,</span>&nbsp;<span class="num" id="3782811">3</span><span class="op" id="3782812">,</span>&nbsp;<span class="num" id="3782814">61</span><span class="op" id="3782816">,</span>&nbsp;<span class="num" id="3782818">58</span><span class="op" id="3782820">,</span>&nbsp;<span class="num" id="3782822">42</span><span class="op" id="3782824">,</span>&nbsp;<span class="num" id="3782826">50</span><span class="op" id="3782828">,</span>&nbsp;<span class="num" id="3782830">38</span><span class="op" id="3782832">,</span>&nbsp;<span class="num" id="3782834">29</span><span class="op" id="3782836">,</span>&nbsp;<span class="num" id="3782838">17</span><span class="op" id="3782840">,</span>&nbsp;<span class="num" id="3782842">4</span><span class="op" id="3782843">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3782846">62</span><span class="op" id="3782848">,</span>&nbsp;<span class="num" id="3782850">47</span><span class="op" id="3782852">,</span>&nbsp;<span class="num" id="3782854">59</span><span class="op" id="3782856">,</span>&nbsp;<span class="num" id="3782858">36</span><span class="op" id="3782860">,</span>&nbsp;<span class="num" id="3782862">45</span><span class="op" id="3782864">,</span>&nbsp;<span class="num" id="3782866">43</span><span class="op" id="3782868">,</span>&nbsp;<span class="num" id="3782870">51</span><span class="op" id="3782872">,</span>&nbsp;<span class="num" id="3782874">22</span><span class="op" id="3782876">,</span>&nbsp;<span class="num" id="3782878">53</span><span class="op" id="3782880">,</span>&nbsp;<span class="num" id="3782882">39</span><span class="op" id="3782884">,</span>&nbsp;<span class="num" id="3782886">33</span><span class="op" id="3782888">,</span>&nbsp;<span class="num" id="3782890">30</span><span class="op" id="3782892">,</span>&nbsp;<span class="num" id="3782894">24</span><span class="op" id="3782896">,</span>&nbsp;<span class="num" id="3782898">18</span><span class="op" id="3782900">,</span>&nbsp;<span class="num" id="3782902">12</span><span class="op" id="3782904">,</span>&nbsp;<span class="num" id="3782906">5</span><span class="op" id="3782907">,</span><br>
<span class="lineno">1000</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3782910">63</span><span class="op" id="3782912">,</span>&nbsp;<span class="num" id="3782914">55</span><span class="op" id="3782916">,</span>&nbsp;<span class="num" id="3782918">48</span><span class="op" id="3782920">,</span>&nbsp;<span class="num" id="3782922">27</span><span class="op" id="3782924">,</span>&nbsp;<span class="num" id="3782926">60</span><span class="op" id="3782928">,</span>&nbsp;<span class="num" id="3782930">41</span><span class="op" id="3782932">,</span>&nbsp;<span class="num" id="3782934">37</span><span class="op" id="3782936">,</span>&nbsp;<span class="num" id="3782938">16</span><span class="op" id="3782940">,</span>&nbsp;<span class="num" id="3782942">46</span><span class="op" id="3782944">,</span>&nbsp;<span class="num" id="3782946">35</span><span class="op" id="3782948">,</span>&nbsp;<span class="num" id="3782950">44</span><span class="op" id="3782952">,</span>&nbsp;<span class="num" id="3782954">21</span><span class="op" id="3782956">,</span>&nbsp;<span class="num" id="3782958">52</span><span class="op" id="3782960">,</span>&nbsp;<span class="num" id="3782962">32</span><span class="op" id="3782964">,</span>&nbsp;<span class="num" id="3782966">23</span><span class="op" id="3782968">,</span>&nbsp;<span class="num" id="3782970">11</span><span class="op" id="3782972">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3782975">54</span><span class="op" id="3782977">,</span>&nbsp;<span class="num" id="3782979">26</span><span class="op" id="3782981">,</span>&nbsp;<span class="num" id="3782983">40</span><span class="op" id="3782985">,</span>&nbsp;<span class="num" id="3782987">15</span><span class="op" id="3782989">,</span>&nbsp;<span class="num" id="3782991">34</span><span class="op" id="3782993">,</span>&nbsp;<span class="num" id="3782995">20</span><span class="op" id="3782997">,</span>&nbsp;<span class="num" id="3782999">31</span><span class="op" id="3783001">,</span>&nbsp;<span class="num" id="3783003">10</span><span class="op" id="3783005">,</span>&nbsp;<span class="num" id="3783007">25</span><span class="op" id="3783009">,</span>&nbsp;<span class="num" id="3783011">14</span><span class="op" id="3783013">,</span>&nbsp;<span class="num" id="3783015">19</span><span class="op" id="3783017">,</span>&nbsp;<span class="num" id="3783019">9</span><span class="op" id="3783020">,</span>&nbsp;<span class="num" id="3783022">13</span><span class="op" id="3783024">,</span>&nbsp;<span class="num" id="3783026">8</span><span class="op" id="3783027">,</span>&nbsp;<span class="num" id="3783029">7</span><span class="op" id="3783030">,</span>&nbsp;<span class="num" id="3783032">6</span><span class="op" id="3783033">,</span><br>
<span class="lineno"></span><span class="op" id="3783035">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3783038">//&nbsp;trailingZeroBits&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;consecutive&nbsp;least&nbsp;significant&nbsp;zero</span><br>
<span class="lineno">1005</span><span class="comment" id="3783115">//&nbsp;bits&nbsp;of&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="3783129">func</span>&nbsp;<span class="ident" id="3783134">trailingZeroBits</span><span class="op" id="3783150">(</span><span class="ident" id="3783151">x</span>&nbsp;<span class="ident" id="3783153">Word</span><span class="op" id="3783157">)</span>&nbsp;<span class="builtintype" id="3783159">uint</span>&nbsp;<span class="op" id="3783164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3783167">//&nbsp;x&nbsp;&amp;&nbsp;-x&nbsp;leaves&nbsp;only&nbsp;the&nbsp;right-most&nbsp;bit&nbsp;set&nbsp;in&nbsp;the&nbsp;word.&nbsp;Let&nbsp;k&nbsp;be&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3783239">//&nbsp;index&nbsp;of&nbsp;that&nbsp;bit.&nbsp;Since&nbsp;only&nbsp;a&nbsp;single&nbsp;bit&nbsp;is&nbsp;set,&nbsp;the&nbsp;value&nbsp;is&nbsp;two</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3783311">//&nbsp;to&nbsp;the&nbsp;power&nbsp;of&nbsp;k.&nbsp;Multiplying&nbsp;by&nbsp;a&nbsp;power&nbsp;of&nbsp;two&nbsp;is&nbsp;equivalent&nbsp;to</span><br>
<span class="lineno">1010</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3783381">//&nbsp;left&nbsp;shifting,&nbsp;in&nbsp;this&nbsp;case&nbsp;by&nbsp;k&nbsp;bits.&nbsp;&nbsp;The&nbsp;de&nbsp;Bruijn&nbsp;constant&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3783451">//&nbsp;such&nbsp;that&nbsp;all&nbsp;six&nbsp;bit,&nbsp;consecutive&nbsp;substrings&nbsp;are&nbsp;distinct.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3783515">//&nbsp;Therefore,&nbsp;if&nbsp;we&nbsp;have&nbsp;a&nbsp;left&nbsp;shifted&nbsp;version&nbsp;of&nbsp;this&nbsp;constant&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3783588">//&nbsp;find&nbsp;by&nbsp;how&nbsp;many&nbsp;bits&nbsp;it&nbsp;was&nbsp;shifted&nbsp;by&nbsp;looking&nbsp;at&nbsp;which&nbsp;six&nbsp;bit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3783657">//&nbsp;substring&nbsp;ended&nbsp;up&nbsp;at&nbsp;the&nbsp;top&nbsp;of&nbsp;the&nbsp;word.</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3783704">//&nbsp;(Knuth,&nbsp;volume&nbsp;4,&nbsp;section&nbsp;7.3.1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3783741">switch</span>&nbsp;<span class="ident" id="3783748">_W</span>&nbsp;<span class="op" id="3783751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3783754">case</span>&nbsp;<span class="num" id="3783759">32</span><span class="op" id="3783761">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3783765">return</span>&nbsp;<span class="builtintype" id="3783772">uint</span><span class="op" id="3783776">(</span><span class="ident" id="3783777">deBruijn32Lookup</span><span class="op" id="3783793">[</span><span class="op" id="3783794">(</span><span class="op" id="3783795">(</span><span class="ident" id="3783796">x</span><span class="op" id="3783797">&amp;</span><span class="op" id="3783798">-</span><span class="ident" id="3783799">x</span><span class="op" id="3783800">)</span><span class="op" id="3783801">*</span><span class="ident" id="3783802">deBruijn32</span><span class="op" id="3783812">)</span><span class="op" id="3783813">&gt;&gt;</span><span class="num" id="3783815">27</span><span class="op" id="3783817">]</span><span class="op" id="3783818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3783821">case</span>&nbsp;<span class="num" id="3783826">64</span><span class="op" id="3783828">:</span><br>
<span class="lineno">1020</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3783832">return</span>&nbsp;<span class="builtintype" id="3783839">uint</span><span class="op" id="3783843">(</span><span class="ident" id="3783844">deBruijn64Lookup</span><span class="op" id="3783860">[</span><span class="op" id="3783861">(</span><span class="op" id="3783862">(</span><span class="ident" id="3783863">x</span><span class="op" id="3783864">&amp;</span><span class="op" id="3783865">-</span><span class="ident" id="3783866">x</span><span class="op" id="3783867">)</span><span class="op" id="3783868">*</span><span class="op" id="3783869">(</span><span class="ident" id="3783870">deBruijn64</span><span class="op" id="3783880">&amp;</span><span class="ident" id="3783881">_M</span><span class="op" id="3783883">)</span><span class="op" id="3783884">)</span><span class="op" id="3783885">&gt;&gt;</span><span class="num" id="3783887">58</span><span class="op" id="3783889">]</span><span class="op" id="3783890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3783893">default</span><span class="op" id="3783900">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3783904">panic</span><span class="op" id="3783909">(</span><span class="string" id="3783910">&#34;unknown&nbsp;word&nbsp;size&#34;</span><span class="op" id="3783929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3783932">}</span><br>
<span class="lineno"></span><span class="op" id="3783934">}</span><br>
<span class="lineno">1025</span><br>
<span class="lineno"></span><span class="comment" id="3783937">//&nbsp;trailingZeroBits&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;consecutive&nbsp;least&nbsp;significant&nbsp;zero</span><br>
<span class="lineno"></span><span class="comment" id="3784014">//&nbsp;bits&nbsp;of&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="3784028">func</span>&nbsp;<span class="op" id="3784033">(</span><span class="ident" id="3784034">x</span>&nbsp;<span class="ident" id="3784036">nat</span><span class="op" id="3784039">)</span>&nbsp;<span class="ident" id="3784041">trailingZeroBits</span><span class="op" id="3784057">(</span><span class="op" id="3784058">)</span>&nbsp;<span class="builtintype" id="3784060">uint</span>&nbsp;<span class="op" id="3784065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3784068">if</span>&nbsp;<span class="builtinfunc" id="3784071">len</span><span class="op" id="3784074">(</span><span class="ident" id="3784075">x</span><span class="op" id="3784076">)</span>&nbsp;<span class="op" id="3784078">==</span>&nbsp;<span class="num" id="3784081">0</span>&nbsp;<span class="op" id="3784083">{</span><br>
<span class="lineno">1030</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3784087">return</span>&nbsp;<span class="num" id="3784094">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3784097">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3784100">var</span>&nbsp;<span class="ident" id="3784104">i</span>&nbsp;<span class="builtintype" id="3784106">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3784112">for</span>&nbsp;<span class="ident" id="3784116">x</span><span class="op" id="3784117">[</span><span class="ident" id="3784118">i</span><span class="op" id="3784119">]</span>&nbsp;<span class="op" id="3784121">==</span>&nbsp;<span class="num" id="3784124">0</span>&nbsp;<span class="op" id="3784126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3784130">i</span><span class="op" id="3784131">++</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3784135">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3784138">//&nbsp;x[i]&nbsp;!=&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3784152">return</span>&nbsp;<span class="ident" id="3784159">i</span><span class="op" id="3784160">*</span><span class="ident" id="3784161">_W</span>&nbsp;<span class="op" id="3784164">+</span>&nbsp;<span class="ident" id="3784166">trailingZeroBits</span><span class="op" id="3784182">(</span><span class="ident" id="3784183">x</span><span class="op" id="3784184">[</span><span class="ident" id="3784185">i</span><span class="op" id="3784186">]</span><span class="op" id="3784187">)</span><br>
<span class="lineno"></span><span class="op" id="3784189">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1040</span><span class="comment" id="3784192">//&nbsp;z&nbsp;=&nbsp;x&nbsp;&lt;&lt;&nbsp;s</span><br>
<span class="lineno"></span><span class="keyword" id="3784206">func</span>&nbsp;<span class="op" id="3784211">(</span><span class="ident" id="3784212">z</span>&nbsp;<span class="ident" id="3784214">nat</span><span class="op" id="3784217">)</span>&nbsp;<span class="ident" id="3784219">shl</span><span class="op" id="3784222">(</span><span class="ident" id="3784223">x</span>&nbsp;<span class="ident" id="3784225">nat</span><span class="op" id="3784228">,</span>&nbsp;<span class="ident" id="3784230">s</span>&nbsp;<span class="builtintype" id="3784232">uint</span><span class="op" id="3784236">)</span>&nbsp;<span class="ident" id="3784238">nat</span>&nbsp;<span class="op" id="3784242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3784245">m</span>&nbsp;<span class="op" id="3784247">:=</span>&nbsp;<span class="builtinfunc" id="3784250">len</span><span class="op" id="3784253">(</span><span class="ident" id="3784254">x</span><span class="op" id="3784255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3784258">if</span>&nbsp;<span class="ident" id="3784261">m</span>&nbsp;<span class="op" id="3784263">==</span>&nbsp;<span class="num" id="3784266">0</span>&nbsp;<span class="op" id="3784268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3784272">return</span>&nbsp;<span class="ident" id="3784279">z</span><span class="op" id="3784280">.</span><span class="builtinfunc" id="3784281">make</span><span class="op" id="3784285">(</span><span class="num" id="3784286">0</span><span class="op" id="3784287">)</span><br>
<span class="lineno">1045</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3784290">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3784293">//&nbsp;m&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3784304">n</span>&nbsp;<span class="op" id="3784306">:=</span>&nbsp;<span class="ident" id="3784309">m</span>&nbsp;<span class="op" id="3784311">+</span>&nbsp;<span class="builtintype" id="3784313">int</span><span class="op" id="3784316">(</span><span class="ident" id="3784317">s</span><span class="op" id="3784318">/</span><span class="ident" id="3784319">_W</span><span class="op" id="3784321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3784324">z</span>&nbsp;<span class="op" id="3784326">=</span>&nbsp;<span class="ident" id="3784328">z</span><span class="op" id="3784329">.</span><span class="builtinfunc" id="3784330">make</span><span class="op" id="3784334">(</span><span class="ident" id="3784335">n</span>&nbsp;<span class="op" id="3784337">+</span>&nbsp;<span class="num" id="3784339">1</span><span class="op" id="3784340">)</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3784343">z</span><span class="op" id="3784344">[</span><span class="ident" id="3784345">n</span><span class="op" id="3784346">]</span>&nbsp;<span class="op" id="3784348">=</span>&nbsp;<span class="ident" id="3784350">shlVU</span><span class="op" id="3784355">(</span><span class="ident" id="3784356">z</span><span class="op" id="3784357">[</span><span class="ident" id="3784358">n</span><span class="op" id="3784359">-</span><span class="ident" id="3784360">m</span><span class="op" id="3784361">:</span><span class="ident" id="3784362">n</span><span class="op" id="3784363">]</span><span class="op" id="3784364">,</span>&nbsp;<span class="ident" id="3784366">x</span><span class="op" id="3784367">,</span>&nbsp;<span class="ident" id="3784369">s</span><span class="op" id="3784370">%</span><span class="ident" id="3784371">_W</span><span class="op" id="3784373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3784376">z</span><span class="op" id="3784377">[</span><span class="num" id="3784378">0</span>&nbsp;<span class="op" id="3784380">:</span>&nbsp;<span class="ident" id="3784382">n</span><span class="op" id="3784383">-</span><span class="ident" id="3784384">m</span><span class="op" id="3784385">]</span><span class="op" id="3784386">.</span><span class="ident" id="3784387">clear</span><span class="op" id="3784392">(</span><span class="op" id="3784393">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3784397">return</span>&nbsp;<span class="ident" id="3784404">z</span><span class="op" id="3784405">.</span><span class="ident" id="3784406">norm</span><span class="op" id="3784410">(</span><span class="op" id="3784411">)</span><br>
<span class="lineno"></span><span class="op" id="3784413">}</span><br>
<span class="lineno">1055</span><br>
<span class="lineno"></span><span class="comment" id="3784416">//&nbsp;z&nbsp;=&nbsp;x&nbsp;&gt;&gt;&nbsp;s</span><br>
<span class="lineno"></span><span class="keyword" id="3784430">func</span>&nbsp;<span class="op" id="3784435">(</span><span class="ident" id="3784436">z</span>&nbsp;<span class="ident" id="3784438">nat</span><span class="op" id="3784441">)</span>&nbsp;<span class="ident" id="3784443">shr</span><span class="op" id="3784446">(</span><span class="ident" id="3784447">x</span>&nbsp;<span class="ident" id="3784449">nat</span><span class="op" id="3784452">,</span>&nbsp;<span class="ident" id="3784454">s</span>&nbsp;<span class="builtintype" id="3784456">uint</span><span class="op" id="3784460">)</span>&nbsp;<span class="ident" id="3784462">nat</span>&nbsp;<span class="op" id="3784466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3784469">m</span>&nbsp;<span class="op" id="3784471">:=</span>&nbsp;<span class="builtinfunc" id="3784474">len</span><span class="op" id="3784477">(</span><span class="ident" id="3784478">x</span><span class="op" id="3784479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3784482">n</span>&nbsp;<span class="op" id="3784484">:=</span>&nbsp;<span class="ident" id="3784487">m</span>&nbsp;<span class="op" id="3784489">-</span>&nbsp;<span class="builtintype" id="3784491">int</span><span class="op" id="3784494">(</span><span class="ident" id="3784495">s</span><span class="op" id="3784496">/</span><span class="ident" id="3784497">_W</span><span class="op" id="3784499">)</span><br>
<span class="lineno">1060</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3784502">if</span>&nbsp;<span class="ident" id="3784505">n</span>&nbsp;<span class="op" id="3784507">&lt;=</span>&nbsp;<span class="num" id="3784510">0</span>&nbsp;<span class="op" id="3784512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3784516">return</span>&nbsp;<span class="ident" id="3784523">z</span><span class="op" id="3784524">.</span><span class="builtinfunc" id="3784525">make</span><span class="op" id="3784529">(</span><span class="num" id="3784530">0</span><span class="op" id="3784531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3784534">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3784537">//&nbsp;n&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno">1065</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3784548">z</span>&nbsp;<span class="op" id="3784550">=</span>&nbsp;<span class="ident" id="3784552">z</span><span class="op" id="3784553">.</span><span class="builtinfunc" id="3784554">make</span><span class="op" id="3784558">(</span><span class="ident" id="3784559">n</span><span class="op" id="3784560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3784563">shrVU</span><span class="op" id="3784568">(</span><span class="ident" id="3784569">z</span><span class="op" id="3784570">,</span>&nbsp;<span class="ident" id="3784572">x</span><span class="op" id="3784573">[</span><span class="ident" id="3784574">m</span><span class="op" id="3784575">-</span><span class="ident" id="3784576">n</span><span class="op" id="3784577">:</span><span class="op" id="3784578">]</span><span class="op" id="3784579">,</span>&nbsp;<span class="ident" id="3784581">s</span><span class="op" id="3784582">%</span><span class="ident" id="3784583">_W</span><span class="op" id="3784585">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3784589">return</span>&nbsp;<span class="ident" id="3784596">z</span><span class="op" id="3784597">.</span><span class="ident" id="3784598">norm</span><span class="op" id="3784602">(</span><span class="op" id="3784603">)</span><br>
<span class="lineno"></span><span class="op" id="3784605">}</span><br>
<span class="lineno">1070</span><br>
<span class="lineno"></span><span class="keyword" id="3784608">func</span>&nbsp;<span class="op" id="3784613">(</span><span class="ident" id="3784614">z</span>&nbsp;<span class="ident" id="3784616">nat</span><span class="op" id="3784619">)</span>&nbsp;<span class="ident" id="3784621">setBit</span><span class="op" id="3784627">(</span><span class="ident" id="3784628">x</span>&nbsp;<span class="ident" id="3784630">nat</span><span class="op" id="3784633">,</span>&nbsp;<span class="ident" id="3784635">i</span>&nbsp;<span class="builtintype" id="3784637">uint</span><span class="op" id="3784641">,</span>&nbsp;<span class="ident" id="3784643">b</span>&nbsp;<span class="builtintype" id="3784645">uint</span><span class="op" id="3784649">)</span>&nbsp;<span class="ident" id="3784651">nat</span>&nbsp;<span class="op" id="3784655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3784658">j</span>&nbsp;<span class="op" id="3784660">:=</span>&nbsp;<span class="builtintype" id="3784663">int</span><span class="op" id="3784666">(</span><span class="ident" id="3784667">i</span>&nbsp;<span class="op" id="3784669">/</span>&nbsp;<span class="ident" id="3784671">_W</span><span class="op" id="3784673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3784676">m</span>&nbsp;<span class="op" id="3784678">:=</span>&nbsp;<span class="ident" id="3784681">Word</span><span class="op" id="3784685">(</span><span class="num" id="3784686">1</span><span class="op" id="3784687">)</span>&nbsp;<span class="op" id="3784689">&lt;&lt;</span>&nbsp;<span class="op" id="3784692">(</span><span class="ident" id="3784693">i</span>&nbsp;<span class="op" id="3784695">%</span>&nbsp;<span class="ident" id="3784697">_W</span><span class="op" id="3784699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3784702">n</span>&nbsp;<span class="op" id="3784704">:=</span>&nbsp;<span class="builtinfunc" id="3784707">len</span><span class="op" id="3784710">(</span><span class="ident" id="3784711">x</span><span class="op" id="3784712">)</span><br>
<span class="lineno">1075</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3784715">switch</span>&nbsp;<span class="ident" id="3784722">b</span>&nbsp;<span class="op" id="3784724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3784727">case</span>&nbsp;<span class="num" id="3784732">0</span><span class="op" id="3784733">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3784737">z</span>&nbsp;<span class="op" id="3784739">=</span>&nbsp;<span class="ident" id="3784741">z</span><span class="op" id="3784742">.</span><span class="builtinfunc" id="3784743">make</span><span class="op" id="3784747">(</span><span class="ident" id="3784748">n</span><span class="op" id="3784749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3784753">copy</span><span class="op" id="3784757">(</span><span class="ident" id="3784758">z</span><span class="op" id="3784759">,</span>&nbsp;<span class="ident" id="3784761">x</span><span class="op" id="3784762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3784766">if</span>&nbsp;<span class="ident" id="3784769">j</span>&nbsp;<span class="op" id="3784771">&gt;=</span>&nbsp;<span class="ident" id="3784774">n</span>&nbsp;<span class="op" id="3784776">{</span><br>
<span class="lineno">1080</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3784781">//&nbsp;no&nbsp;need&nbsp;to&nbsp;grow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3784803">return</span>&nbsp;<span class="ident" id="3784810">z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3784814">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3784818">z</span><span class="op" id="3784819">[</span><span class="ident" id="3784820">j</span><span class="op" id="3784821">]</span>&nbsp;<span class="op" id="3784823">&amp;^=</span>&nbsp;<span class="ident" id="3784827">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3784831">return</span>&nbsp;<span class="ident" id="3784838">z</span><span class="op" id="3784839">.</span><span class="ident" id="3784840">norm</span><span class="op" id="3784844">(</span><span class="op" id="3784845">)</span><br>
<span class="lineno">1085</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3784848">case</span>&nbsp;<span class="num" id="3784853">1</span><span class="op" id="3784854">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3784858">if</span>&nbsp;<span class="ident" id="3784861">j</span>&nbsp;<span class="op" id="3784863">&gt;=</span>&nbsp;<span class="ident" id="3784866">n</span>&nbsp;<span class="op" id="3784868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3784873">z</span>&nbsp;<span class="op" id="3784875">=</span>&nbsp;<span class="ident" id="3784877">z</span><span class="op" id="3784878">.</span><span class="builtinfunc" id="3784879">make</span><span class="op" id="3784883">(</span><span class="ident" id="3784884">j</span>&nbsp;<span class="op" id="3784886">+</span>&nbsp;<span class="num" id="3784888">1</span><span class="op" id="3784889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3784894">z</span><span class="op" id="3784895">[</span><span class="ident" id="3784896">n</span><span class="op" id="3784897">:</span><span class="op" id="3784898">]</span><span class="op" id="3784899">.</span><span class="ident" id="3784900">clear</span><span class="op" id="3784905">(</span><span class="op" id="3784906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3784910">}</span>&nbsp;<span class="keyword" id="3784912">else</span>&nbsp;<span class="op" id="3784917">{</span><br>
<span class="lineno">1090</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3784922">z</span>&nbsp;<span class="op" id="3784924">=</span>&nbsp;<span class="ident" id="3784926">z</span><span class="op" id="3784927">.</span><span class="builtinfunc" id="3784928">make</span><span class="op" id="3784932">(</span><span class="ident" id="3784933">n</span><span class="op" id="3784934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3784938">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3784942">copy</span><span class="op" id="3784946">(</span><span class="ident" id="3784947">z</span><span class="op" id="3784948">,</span>&nbsp;<span class="ident" id="3784950">x</span><span class="op" id="3784951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3784955">z</span><span class="op" id="3784956">[</span><span class="ident" id="3784957">j</span><span class="op" id="3784958">]</span>&nbsp;<span class="op" id="3784960">|=</span>&nbsp;<span class="ident" id="3784963">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3784967">//&nbsp;no&nbsp;need&nbsp;to&nbsp;normalize</span><br>
<span class="lineno">1095</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3784993">return</span>&nbsp;<span class="ident" id="3785000">z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3785003">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3785006">panic</span><span class="op" id="3785011">(</span><span class="string" id="3785012">&#34;set&nbsp;bit&nbsp;is&nbsp;not&nbsp;0&nbsp;or&nbsp;1&#34;</span><span class="op" id="3785035">)</span><br>
<span class="lineno"></span><span class="op" id="3785037">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1100</span><span class="keyword" id="3785040">func</span>&nbsp;<span class="op" id="3785045">(</span><span class="ident" id="3785046">z</span>&nbsp;<span class="ident" id="3785048">nat</span><span class="op" id="3785051">)</span>&nbsp;<span class="ident" id="3785053">bit</span><span class="op" id="3785056">(</span><span class="ident" id="3785057">i</span>&nbsp;<span class="builtintype" id="3785059">uint</span><span class="op" id="3785063">)</span>&nbsp;<span class="builtintype" id="3785065">uint</span>&nbsp;<span class="op" id="3785070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3785073">j</span>&nbsp;<span class="op" id="3785075">:=</span>&nbsp;<span class="builtintype" id="3785078">int</span><span class="op" id="3785081">(</span><span class="ident" id="3785082">i</span>&nbsp;<span class="op" id="3785084">/</span>&nbsp;<span class="ident" id="3785086">_W</span><span class="op" id="3785088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3785091">if</span>&nbsp;<span class="ident" id="3785094">j</span>&nbsp;<span class="op" id="3785096">&gt;=</span>&nbsp;<span class="builtinfunc" id="3785099">len</span><span class="op" id="3785102">(</span><span class="ident" id="3785103">z</span><span class="op" id="3785104">)</span>&nbsp;<span class="op" id="3785106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3785110">return</span>&nbsp;<span class="num" id="3785117">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3785120">}</span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3785123">return</span>&nbsp;<span class="builtintype" id="3785130">uint</span><span class="op" id="3785134">(</span><span class="ident" id="3785135">z</span><span class="op" id="3785136">[</span><span class="ident" id="3785137">j</span><span class="op" id="3785138">]</span>&nbsp;<span class="op" id="3785140">&gt;&gt;</span>&nbsp;<span class="op" id="3785143">(</span><span class="ident" id="3785144">i</span>&nbsp;<span class="op" id="3785146">%</span>&nbsp;<span class="ident" id="3785148">_W</span><span class="op" id="3785150">)</span>&nbsp;<span class="op" id="3785152">&amp;</span>&nbsp;<span class="num" id="3785154">1</span><span class="op" id="3785155">)</span><br>
<span class="lineno"></span><span class="op" id="3785157">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3785160">func</span>&nbsp;<span class="op" id="3785165">(</span><span class="ident" id="3785166">z</span>&nbsp;<span class="ident" id="3785168">nat</span><span class="op" id="3785171">)</span>&nbsp;<span class="ident" id="3785173">and</span><span class="op" id="3785176">(</span><span class="ident" id="3785177">x</span><span class="op" id="3785178">,</span>&nbsp;<span class="ident" id="3785180">y</span>&nbsp;<span class="ident" id="3785182">nat</span><span class="op" id="3785185">)</span>&nbsp;<span class="ident" id="3785187">nat</span>&nbsp;<span class="op" id="3785191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3785194">m</span>&nbsp;<span class="op" id="3785196">:=</span>&nbsp;<span class="builtinfunc" id="3785199">len</span><span class="op" id="3785202">(</span><span class="ident" id="3785203">x</span><span class="op" id="3785204">)</span><br>
<span class="lineno">1110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3785207">n</span>&nbsp;<span class="op" id="3785209">:=</span>&nbsp;<span class="builtinfunc" id="3785212">len</span><span class="op" id="3785215">(</span><span class="ident" id="3785216">y</span><span class="op" id="3785217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3785220">if</span>&nbsp;<span class="ident" id="3785223">m</span>&nbsp;<span class="op" id="3785225">&gt;</span>&nbsp;<span class="ident" id="3785227">n</span>&nbsp;<span class="op" id="3785229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3785233">m</span>&nbsp;<span class="op" id="3785235">=</span>&nbsp;<span class="ident" id="3785237">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3785240">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3785243">//&nbsp;m&nbsp;&lt;=&nbsp;n</span><br>
<span class="lineno">1115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3785255">z</span>&nbsp;<span class="op" id="3785257">=</span>&nbsp;<span class="ident" id="3785259">z</span><span class="op" id="3785260">.</span><span class="builtinfunc" id="3785261">make</span><span class="op" id="3785265">(</span><span class="ident" id="3785266">m</span><span class="op" id="3785267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3785270">for</span>&nbsp;<span class="ident" id="3785274">i</span>&nbsp;<span class="op" id="3785276">:=</span>&nbsp;<span class="num" id="3785279">0</span><span class="op" id="3785280">;</span>&nbsp;<span class="ident" id="3785282">i</span>&nbsp;<span class="op" id="3785284">&lt;</span>&nbsp;<span class="ident" id="3785286">m</span><span class="op" id="3785287">;</span>&nbsp;<span class="ident" id="3785289">i</span><span class="op" id="3785290">++</span>&nbsp;<span class="op" id="3785293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3785297">z</span><span class="op" id="3785298">[</span><span class="ident" id="3785299">i</span><span class="op" id="3785300">]</span>&nbsp;<span class="op" id="3785302">=</span>&nbsp;<span class="ident" id="3785304">x</span><span class="op" id="3785305">[</span><span class="ident" id="3785306">i</span><span class="op" id="3785307">]</span>&nbsp;<span class="op" id="3785309">&amp;</span>&nbsp;<span class="ident" id="3785311">y</span><span class="op" id="3785312">[</span><span class="ident" id="3785313">i</span><span class="op" id="3785314">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3785317">}</span><br>
<span class="lineno">1120</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3785321">return</span>&nbsp;<span class="ident" id="3785328">z</span><span class="op" id="3785329">.</span><span class="ident" id="3785330">norm</span><span class="op" id="3785334">(</span><span class="op" id="3785335">)</span><br>
<span class="lineno"></span><span class="op" id="3785337">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3785340">func</span>&nbsp;<span class="op" id="3785345">(</span><span class="ident" id="3785346">z</span>&nbsp;<span class="ident" id="3785348">nat</span><span class="op" id="3785351">)</span>&nbsp;<span class="ident" id="3785353">andNot</span><span class="op" id="3785359">(</span><span class="ident" id="3785360">x</span><span class="op" id="3785361">,</span>&nbsp;<span class="ident" id="3785363">y</span>&nbsp;<span class="ident" id="3785365">nat</span><span class="op" id="3785368">)</span>&nbsp;<span class="ident" id="3785370">nat</span>&nbsp;<span class="op" id="3785374">{</span><br>
<span class="lineno">1125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3785377">m</span>&nbsp;<span class="op" id="3785379">:=</span>&nbsp;<span class="builtinfunc" id="3785382">len</span><span class="op" id="3785385">(</span><span class="ident" id="3785386">x</span><span class="op" id="3785387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3785390">n</span>&nbsp;<span class="op" id="3785392">:=</span>&nbsp;<span class="builtinfunc" id="3785395">len</span><span class="op" id="3785398">(</span><span class="ident" id="3785399">y</span><span class="op" id="3785400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3785403">if</span>&nbsp;<span class="ident" id="3785406">n</span>&nbsp;<span class="op" id="3785408">&gt;</span>&nbsp;<span class="ident" id="3785410">m</span>&nbsp;<span class="op" id="3785412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3785416">n</span>&nbsp;<span class="op" id="3785418">=</span>&nbsp;<span class="ident" id="3785420">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3785423">}</span><br>
<span class="lineno">1130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3785426">//&nbsp;m&nbsp;&gt;=&nbsp;n</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3785438">z</span>&nbsp;<span class="op" id="3785440">=</span>&nbsp;<span class="ident" id="3785442">z</span><span class="op" id="3785443">.</span><span class="builtinfunc" id="3785444">make</span><span class="op" id="3785448">(</span><span class="ident" id="3785449">m</span><span class="op" id="3785450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3785453">for</span>&nbsp;<span class="ident" id="3785457">i</span>&nbsp;<span class="op" id="3785459">:=</span>&nbsp;<span class="num" id="3785462">0</span><span class="op" id="3785463">;</span>&nbsp;<span class="ident" id="3785465">i</span>&nbsp;<span class="op" id="3785467">&lt;</span>&nbsp;<span class="ident" id="3785469">n</span><span class="op" id="3785470">;</span>&nbsp;<span class="ident" id="3785472">i</span><span class="op" id="3785473">++</span>&nbsp;<span class="op" id="3785476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3785480">z</span><span class="op" id="3785481">[</span><span class="ident" id="3785482">i</span><span class="op" id="3785483">]</span>&nbsp;<span class="op" id="3785485">=</span>&nbsp;<span class="ident" id="3785487">x</span><span class="op" id="3785488">[</span><span class="ident" id="3785489">i</span><span class="op" id="3785490">]</span>&nbsp;<span class="op" id="3785492">&amp;^</span>&nbsp;<span class="ident" id="3785495">y</span><span class="op" id="3785496">[</span><span class="ident" id="3785497">i</span><span class="op" id="3785498">]</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3785501">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3785504">copy</span><span class="op" id="3785508">(</span><span class="ident" id="3785509">z</span><span class="op" id="3785510">[</span><span class="ident" id="3785511">n</span><span class="op" id="3785512">:</span><span class="ident" id="3785513">m</span><span class="op" id="3785514">]</span><span class="op" id="3785515">,</span>&nbsp;<span class="ident" id="3785517">x</span><span class="op" id="3785518">[</span><span class="ident" id="3785519">n</span><span class="op" id="3785520">:</span><span class="ident" id="3785521">m</span><span class="op" id="3785522">]</span><span class="op" id="3785523">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3785527">return</span>&nbsp;<span class="ident" id="3785534">z</span><span class="op" id="3785535">.</span><span class="ident" id="3785536">norm</span><span class="op" id="3785540">(</span><span class="op" id="3785541">)</span><br>
<span class="lineno"></span><span class="op" id="3785543">}</span><br>
<span class="lineno">1140</span><br>
<span class="lineno"></span><span class="keyword" id="3785546">func</span>&nbsp;<span class="op" id="3785551">(</span><span class="ident" id="3785552">z</span>&nbsp;<span class="ident" id="3785554">nat</span><span class="op" id="3785557">)</span>&nbsp;<span class="ident" id="3785559">or</span><span class="op" id="3785561">(</span><span class="ident" id="3785562">x</span><span class="op" id="3785563">,</span>&nbsp;<span class="ident" id="3785565">y</span>&nbsp;<span class="ident" id="3785567">nat</span><span class="op" id="3785570">)</span>&nbsp;<span class="ident" id="3785572">nat</span>&nbsp;<span class="op" id="3785576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3785579">m</span>&nbsp;<span class="op" id="3785581">:=</span>&nbsp;<span class="builtinfunc" id="3785584">len</span><span class="op" id="3785587">(</span><span class="ident" id="3785588">x</span><span class="op" id="3785589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3785592">n</span>&nbsp;<span class="op" id="3785594">:=</span>&nbsp;<span class="builtinfunc" id="3785597">len</span><span class="op" id="3785600">(</span><span class="ident" id="3785601">y</span><span class="op" id="3785602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3785605">s</span>&nbsp;<span class="op" id="3785607">:=</span>&nbsp;<span class="ident" id="3785610">x</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3785613">if</span>&nbsp;<span class="ident" id="3785616">m</span>&nbsp;<span class="op" id="3785618">&lt;</span>&nbsp;<span class="ident" id="3785620">n</span>&nbsp;<span class="op" id="3785622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3785626">n</span><span class="op" id="3785627">,</span>&nbsp;<span class="ident" id="3785629">m</span>&nbsp;<span class="op" id="3785631">=</span>&nbsp;<span class="ident" id="3785633">m</span><span class="op" id="3785634">,</span>&nbsp;<span class="ident" id="3785636">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3785640">s</span>&nbsp;<span class="op" id="3785642">=</span>&nbsp;<span class="ident" id="3785644">y</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3785647">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3785650">//&nbsp;m&nbsp;&gt;=&nbsp;n</span><br>
<span class="lineno">1150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3785662">z</span>&nbsp;<span class="op" id="3785664">=</span>&nbsp;<span class="ident" id="3785666">z</span><span class="op" id="3785667">.</span><span class="builtinfunc" id="3785668">make</span><span class="op" id="3785672">(</span><span class="ident" id="3785673">m</span><span class="op" id="3785674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3785677">for</span>&nbsp;<span class="ident" id="3785681">i</span>&nbsp;<span class="op" id="3785683">:=</span>&nbsp;<span class="num" id="3785686">0</span><span class="op" id="3785687">;</span>&nbsp;<span class="ident" id="3785689">i</span>&nbsp;<span class="op" id="3785691">&lt;</span>&nbsp;<span class="ident" id="3785693">n</span><span class="op" id="3785694">;</span>&nbsp;<span class="ident" id="3785696">i</span><span class="op" id="3785697">++</span>&nbsp;<span class="op" id="3785700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3785704">z</span><span class="op" id="3785705">[</span><span class="ident" id="3785706">i</span><span class="op" id="3785707">]</span>&nbsp;<span class="op" id="3785709">=</span>&nbsp;<span class="ident" id="3785711">x</span><span class="op" id="3785712">[</span><span class="ident" id="3785713">i</span><span class="op" id="3785714">]</span>&nbsp;<span class="op" id="3785716">|</span>&nbsp;<span class="ident" id="3785718">y</span><span class="op" id="3785719">[</span><span class="ident" id="3785720">i</span><span class="op" id="3785721">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3785724">}</span><br>
<span class="lineno">1155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3785727">copy</span><span class="op" id="3785731">(</span><span class="ident" id="3785732">z</span><span class="op" id="3785733">[</span><span class="ident" id="3785734">n</span><span class="op" id="3785735">:</span><span class="ident" id="3785736">m</span><span class="op" id="3785737">]</span><span class="op" id="3785738">,</span>&nbsp;<span class="ident" id="3785740">s</span><span class="op" id="3785741">[</span><span class="ident" id="3785742">n</span><span class="op" id="3785743">:</span><span class="ident" id="3785744">m</span><span class="op" id="3785745">]</span><span class="op" id="3785746">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3785750">return</span>&nbsp;<span class="ident" id="3785757">z</span><span class="op" id="3785758">.</span><span class="ident" id="3785759">norm</span><span class="op" id="3785763">(</span><span class="op" id="3785764">)</span><br>
<span class="lineno"></span><span class="op" id="3785766">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1160</span><span class="keyword" id="3785769">func</span>&nbsp;<span class="op" id="3785774">(</span><span class="ident" id="3785775">z</span>&nbsp;<span class="ident" id="3785777">nat</span><span class="op" id="3785780">)</span>&nbsp;<span class="ident" id="3785782">xor</span><span class="op" id="3785785">(</span><span class="ident" id="3785786">x</span><span class="op" id="3785787">,</span>&nbsp;<span class="ident" id="3785789">y</span>&nbsp;<span class="ident" id="3785791">nat</span><span class="op" id="3785794">)</span>&nbsp;<span class="ident" id="3785796">nat</span>&nbsp;<span class="op" id="3785800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3785803">m</span>&nbsp;<span class="op" id="3785805">:=</span>&nbsp;<span class="builtinfunc" id="3785808">len</span><span class="op" id="3785811">(</span><span class="ident" id="3785812">x</span><span class="op" id="3785813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3785816">n</span>&nbsp;<span class="op" id="3785818">:=</span>&nbsp;<span class="builtinfunc" id="3785821">len</span><span class="op" id="3785824">(</span><span class="ident" id="3785825">y</span><span class="op" id="3785826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3785829">s</span>&nbsp;<span class="op" id="3785831">:=</span>&nbsp;<span class="ident" id="3785834">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3785837">if</span>&nbsp;<span class="ident" id="3785840">m</span>&nbsp;<span class="op" id="3785842">&lt;</span>&nbsp;<span class="ident" id="3785844">n</span>&nbsp;<span class="op" id="3785846">{</span><br>
<span class="lineno">1165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3785850">n</span><span class="op" id="3785851">,</span>&nbsp;<span class="ident" id="3785853">m</span>&nbsp;<span class="op" id="3785855">=</span>&nbsp;<span class="ident" id="3785857">m</span><span class="op" id="3785858">,</span>&nbsp;<span class="ident" id="3785860">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3785864">s</span>&nbsp;<span class="op" id="3785866">=</span>&nbsp;<span class="ident" id="3785868">y</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3785871">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3785874">//&nbsp;m&nbsp;&gt;=&nbsp;n</span><br>
<span class="lineno"></span><br>
<span class="lineno">1170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3785886">z</span>&nbsp;<span class="op" id="3785888">=</span>&nbsp;<span class="ident" id="3785890">z</span><span class="op" id="3785891">.</span><span class="builtinfunc" id="3785892">make</span><span class="op" id="3785896">(</span><span class="ident" id="3785897">m</span><span class="op" id="3785898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3785901">for</span>&nbsp;<span class="ident" id="3785905">i</span>&nbsp;<span class="op" id="3785907">:=</span>&nbsp;<span class="num" id="3785910">0</span><span class="op" id="3785911">;</span>&nbsp;<span class="ident" id="3785913">i</span>&nbsp;<span class="op" id="3785915">&lt;</span>&nbsp;<span class="ident" id="3785917">n</span><span class="op" id="3785918">;</span>&nbsp;<span class="ident" id="3785920">i</span><span class="op" id="3785921">++</span>&nbsp;<span class="op" id="3785924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3785928">z</span><span class="op" id="3785929">[</span><span class="ident" id="3785930">i</span><span class="op" id="3785931">]</span>&nbsp;<span class="op" id="3785933">=</span>&nbsp;<span class="ident" id="3785935">x</span><span class="op" id="3785936">[</span><span class="ident" id="3785937">i</span><span class="op" id="3785938">]</span>&nbsp;<span class="op" id="3785940">^</span>&nbsp;<span class="ident" id="3785942">y</span><span class="op" id="3785943">[</span><span class="ident" id="3785944">i</span><span class="op" id="3785945">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3785948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3785951">copy</span><span class="op" id="3785955">(</span><span class="ident" id="3785956">z</span><span class="op" id="3785957">[</span><span class="ident" id="3785958">n</span><span class="op" id="3785959">:</span><span class="ident" id="3785960">m</span><span class="op" id="3785961">]</span><span class="op" id="3785962">,</span>&nbsp;<span class="ident" id="3785964">s</span><span class="op" id="3785965">[</span><span class="ident" id="3785966">n</span><span class="op" id="3785967">:</span><span class="ident" id="3785968">m</span><span class="op" id="3785969">]</span><span class="op" id="3785970">)</span><br>
<span class="lineno">1175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3785974">return</span>&nbsp;<span class="ident" id="3785981">z</span><span class="op" id="3785982">.</span><span class="ident" id="3785983">norm</span><span class="op" id="3785987">(</span><span class="op" id="3785988">)</span><br>
<span class="lineno"></span><span class="op" id="3785990">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3785993">//&nbsp;greaterThan&nbsp;returns&nbsp;true&nbsp;iff&nbsp;(x1&lt;&lt;_W&nbsp;+&nbsp;x2)&nbsp;&gt;&nbsp;(y1&lt;&lt;_W&nbsp;+&nbsp;y2)</span><br>
<span class="lineno">1180</span><span class="keyword" id="3786055">func</span>&nbsp;<span class="ident" id="3786060">greaterThan</span><span class="op" id="3786071">(</span><span class="ident" id="3786072">x1</span><span class="op" id="3786074">,</span>&nbsp;<span class="ident" id="3786076">x2</span><span class="op" id="3786078">,</span>&nbsp;<span class="ident" id="3786080">y1</span><span class="op" id="3786082">,</span>&nbsp;<span class="ident" id="3786084">y2</span>&nbsp;<span class="ident" id="3786087">Word</span><span class="op" id="3786091">)</span>&nbsp;<span class="builtintype" id="3786093">bool</span>&nbsp;<span class="op" id="3786098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3786101">return</span>&nbsp;<span class="ident" id="3786108">x1</span>&nbsp;<span class="op" id="3786111">&gt;</span>&nbsp;<span class="ident" id="3786113">y1</span>&nbsp;<span class="op" id="3786116">||</span>&nbsp;<span class="ident" id="3786119">x1</span>&nbsp;<span class="op" id="3786122">==</span>&nbsp;<span class="ident" id="3786125">y1</span>&nbsp;<span class="op" id="3786128">&amp;&amp;</span>&nbsp;<span class="ident" id="3786131">x2</span>&nbsp;<span class="op" id="3786134">&gt;</span>&nbsp;<span class="ident" id="3786136">y2</span><br>
<span class="lineno"></span><span class="op" id="3786139">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3786142">//&nbsp;modW&nbsp;returns&nbsp;x&nbsp;%&nbsp;d.</span><br>
<span class="lineno">1185</span><span class="keyword" id="3786165">func</span>&nbsp;<span class="op" id="3786170">(</span><span class="ident" id="3786171">x</span>&nbsp;<span class="ident" id="3786173">nat</span><span class="op" id="3786176">)</span>&nbsp;<span class="ident" id="3786178">modW</span><span class="op" id="3786182">(</span><span class="ident" id="3786183">d</span>&nbsp;<span class="ident" id="3786185">Word</span><span class="op" id="3786189">)</span>&nbsp;<span class="op" id="3786191">(</span><span class="ident" id="3786192">r</span>&nbsp;<span class="ident" id="3786194">Word</span><span class="op" id="3786198">)</span>&nbsp;<span class="op" id="3786200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3786203">//&nbsp;TODO(agl):&nbsp;we&nbsp;don&#39;t&nbsp;actually&nbsp;need&nbsp;to&nbsp;store&nbsp;the&nbsp;q&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3786263">var</span>&nbsp;<span class="ident" id="3786267">q</span>&nbsp;<span class="ident" id="3786269">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3786274">q</span>&nbsp;<span class="op" id="3786276">=</span>&nbsp;<span class="ident" id="3786278">q</span><span class="op" id="3786279">.</span><span class="builtinfunc" id="3786280">make</span><span class="op" id="3786284">(</span><span class="builtinfunc" id="3786285">len</span><span class="op" id="3786288">(</span><span class="ident" id="3786289">x</span><span class="op" id="3786290">)</span><span class="op" id="3786291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3786294">return</span>&nbsp;<span class="ident" id="3786301">divWVW</span><span class="op" id="3786307">(</span><span class="ident" id="3786308">q</span><span class="op" id="3786309">,</span>&nbsp;<span class="num" id="3786311">0</span><span class="op" id="3786312">,</span>&nbsp;<span class="ident" id="3786314">x</span><span class="op" id="3786315">,</span>&nbsp;<span class="ident" id="3786317">d</span><span class="op" id="3786318">)</span><br>
<span class="lineno">1190</span><span class="op" id="3786320">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3786323">//&nbsp;random&nbsp;creates&nbsp;a&nbsp;random&nbsp;integer&nbsp;in&nbsp;[0..limit),&nbsp;using&nbsp;the&nbsp;space&nbsp;in&nbsp;z&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="3786397">//&nbsp;possible.&nbsp;n&nbsp;is&nbsp;the&nbsp;bit&nbsp;length&nbsp;of&nbsp;limit.</span><br>
<span class="lineno"></span><span class="keyword" id="3786440">func</span>&nbsp;<span class="op" id="3786445">(</span><span class="ident" id="3786446">z</span>&nbsp;<span class="ident" id="3786448">nat</span><span class="op" id="3786451">)</span>&nbsp;<span class="ident" id="3786453">random</span><span class="op" id="3786459">(</span><span class="ident" id="3786460">rand</span>&nbsp;<span class="op" id="3786465">*</span><span class="ident" id="3786466">rand</span><span class="op" id="3786470">.</span><span class="ident" id="3786471">Rand</span><span class="op" id="3786475">,</span>&nbsp;<span class="ident" id="3786477">limit</span>&nbsp;<span class="ident" id="3786483">nat</span><span class="op" id="3786486">,</span>&nbsp;<span class="ident" id="3786488">n</span>&nbsp;<span class="builtintype" id="3786490">int</span><span class="op" id="3786493">)</span>&nbsp;<span class="ident" id="3786495">nat</span>&nbsp;<span class="op" id="3786499">{</span><br>
<span class="lineno">1195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3786502">if</span>&nbsp;<span class="ident" id="3786505">alias</span><span class="op" id="3786510">(</span><span class="ident" id="3786511">z</span><span class="op" id="3786512">,</span>&nbsp;<span class="ident" id="3786514">limit</span><span class="op" id="3786519">)</span>&nbsp;<span class="op" id="3786521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3786525">z</span>&nbsp;<span class="op" id="3786527">=</span>&nbsp;<span class="ident" id="3786529">nil</span>&nbsp;<span class="comment" id="3786533">//&nbsp;z&nbsp;is&nbsp;an&nbsp;alias&nbsp;for&nbsp;limit&nbsp;-&nbsp;cannot&nbsp;reuse</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3786576">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3786579">z</span>&nbsp;<span class="op" id="3786581">=</span>&nbsp;<span class="ident" id="3786583">z</span><span class="op" id="3786584">.</span><span class="builtinfunc" id="3786585">make</span><span class="op" id="3786589">(</span><span class="builtinfunc" id="3786590">len</span><span class="op" id="3786593">(</span><span class="ident" id="3786594">limit</span><span class="op" id="3786599">)</span><span class="op" id="3786600">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3786604">bitLengthOfMSW</span>&nbsp;<span class="op" id="3786619">:=</span>&nbsp;<span class="builtintype" id="3786622">uint</span><span class="op" id="3786626">(</span><span class="ident" id="3786627">n</span>&nbsp;<span class="op" id="3786629">%</span>&nbsp;<span class="ident" id="3786631">_W</span><span class="op" id="3786633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3786636">if</span>&nbsp;<span class="ident" id="3786639">bitLengthOfMSW</span>&nbsp;<span class="op" id="3786654">==</span>&nbsp;<span class="num" id="3786657">0</span>&nbsp;<span class="op" id="3786659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3786663">bitLengthOfMSW</span>&nbsp;<span class="op" id="3786678">=</span>&nbsp;<span class="ident" id="3786680">_W</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3786684">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3786687">mask</span>&nbsp;<span class="op" id="3786692">:=</span>&nbsp;<span class="ident" id="3786695">Word</span><span class="op" id="3786699">(</span><span class="op" id="3786700">(</span><span class="num" id="3786701">1</span>&nbsp;<span class="op" id="3786703">&lt;&lt;</span>&nbsp;<span class="ident" id="3786706">bitLengthOfMSW</span><span class="op" id="3786720">)</span>&nbsp;<span class="op" id="3786722">-</span>&nbsp;<span class="num" id="3786724">1</span><span class="op" id="3786725">)</span><br>
<span class="lineno">1205</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3786729">for</span>&nbsp;<span class="op" id="3786733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3786737">switch</span>&nbsp;<span class="ident" id="3786744">_W</span>&nbsp;<span class="op" id="3786747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3786751">case</span>&nbsp;<span class="num" id="3786756">32</span><span class="op" id="3786758">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3786763">for</span>&nbsp;<span class="ident" id="3786767">i</span>&nbsp;<span class="op" id="3786769">:=</span>&nbsp;<span class="keyword" id="3786772">range</span>&nbsp;<span class="ident" id="3786778">z</span>&nbsp;<span class="op" id="3786780">{</span><br>
<span class="lineno">1210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3786786">z</span><span class="op" id="3786787">[</span><span class="ident" id="3786788">i</span><span class="op" id="3786789">]</span>&nbsp;<span class="op" id="3786791">=</span>&nbsp;<span class="ident" id="3786793">Word</span><span class="op" id="3786797">(</span><span class="ident" id="3786798">rand</span><span class="op" id="3786802">.</span><span class="ident" id="3786803">Uint32</span><span class="op" id="3786809">(</span><span class="op" id="3786810">)</span><span class="op" id="3786811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3786816">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3786820">case</span>&nbsp;<span class="num" id="3786825">64</span><span class="op" id="3786827">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3786832">for</span>&nbsp;<span class="ident" id="3786836">i</span>&nbsp;<span class="op" id="3786838">:=</span>&nbsp;<span class="keyword" id="3786841">range</span>&nbsp;<span class="ident" id="3786847">z</span>&nbsp;<span class="op" id="3786849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3786855">z</span><span class="op" id="3786856">[</span><span class="ident" id="3786857">i</span><span class="op" id="3786858">]</span>&nbsp;<span class="op" id="3786860">=</span>&nbsp;<span class="ident" id="3786862">Word</span><span class="op" id="3786866">(</span><span class="ident" id="3786867">rand</span><span class="op" id="3786871">.</span><span class="ident" id="3786872">Uint32</span><span class="op" id="3786878">(</span><span class="op" id="3786879">)</span><span class="op" id="3786880">)</span>&nbsp;<span class="op" id="3786882">|</span>&nbsp;<span class="ident" id="3786884">Word</span><span class="op" id="3786888">(</span><span class="ident" id="3786889">rand</span><span class="op" id="3786893">.</span><span class="ident" id="3786894">Uint32</span><span class="op" id="3786900">(</span><span class="op" id="3786901">)</span><span class="op" id="3786902">)</span><span class="op" id="3786903">&lt;&lt;</span><span class="num" id="3786905">32</span><br>
<span class="lineno">1215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3786911">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3786915">default</span><span class="op" id="3786922">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3786927">panic</span><span class="op" id="3786932">(</span><span class="string" id="3786933">&#34;unknown&nbsp;word&nbsp;size&#34;</span><span class="op" id="3786952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3786956">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3786960">z</span><span class="op" id="3786961">[</span><span class="builtinfunc" id="3786962">len</span><span class="op" id="3786965">(</span><span class="ident" id="3786966">limit</span><span class="op" id="3786971">)</span><span class="op" id="3786972">-</span><span class="num" id="3786973">1</span><span class="op" id="3786974">]</span>&nbsp;<span class="op" id="3786976">&amp;=</span>&nbsp;<span class="ident" id="3786979">mask</span><br>
<span class="lineno">1220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3786986">if</span>&nbsp;<span class="ident" id="3786989">z</span><span class="op" id="3786990">.</span><span class="ident" id="3786991">cmp</span><span class="op" id="3786994">(</span><span class="ident" id="3786995">limit</span><span class="op" id="3787000">)</span>&nbsp;<span class="op" id="3787002">&lt;</span>&nbsp;<span class="num" id="3787004">0</span>&nbsp;<span class="op" id="3787006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3787011">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3787019">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3787022">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3787026">return</span>&nbsp;<span class="ident" id="3787033">z</span><span class="op" id="3787034">.</span><span class="ident" id="3787035">norm</span><span class="op" id="3787039">(</span><span class="op" id="3787040">)</span><br>
<span class="lineno"></span><span class="op" id="3787042">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3787045">//&nbsp;If&nbsp;m&nbsp;!=&nbsp;0&nbsp;(i.e.,&nbsp;len(m)&nbsp;!=&nbsp;0),&nbsp;expNN&nbsp;sets&nbsp;z&nbsp;to&nbsp;x**y&nbsp;mod&nbsp;m;</span><br>
<span class="lineno"></span><span class="comment" id="3787107">//&nbsp;otherwise&nbsp;it&nbsp;sets&nbsp;z&nbsp;to&nbsp;x**y.&nbsp;The&nbsp;result&nbsp;is&nbsp;the&nbsp;value&nbsp;of&nbsp;z.</span><br>
<span class="lineno">1230</span><span class="keyword" id="3787169">func</span>&nbsp;<span class="op" id="3787174">(</span><span class="ident" id="3787175">z</span>&nbsp;<span class="ident" id="3787177">nat</span><span class="op" id="3787180">)</span>&nbsp;<span class="ident" id="3787182">expNN</span><span class="op" id="3787187">(</span><span class="ident" id="3787188">x</span><span class="op" id="3787189">,</span>&nbsp;<span class="ident" id="3787191">y</span><span class="op" id="3787192">,</span>&nbsp;<span class="ident" id="3787194">m</span>&nbsp;<span class="ident" id="3787196">nat</span><span class="op" id="3787199">)</span>&nbsp;<span class="ident" id="3787201">nat</span>&nbsp;<span class="op" id="3787205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3787208">if</span>&nbsp;<span class="ident" id="3787211">alias</span><span class="op" id="3787216">(</span><span class="ident" id="3787217">z</span><span class="op" id="3787218">,</span>&nbsp;<span class="ident" id="3787220">x</span><span class="op" id="3787221">)</span>&nbsp;<span class="op" id="3787223">||</span>&nbsp;<span class="ident" id="3787226">alias</span><span class="op" id="3787231">(</span><span class="ident" id="3787232">z</span><span class="op" id="3787233">,</span>&nbsp;<span class="ident" id="3787235">y</span><span class="op" id="3787236">)</span>&nbsp;<span class="op" id="3787238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3787242">//&nbsp;We&nbsp;cannot&nbsp;allow&nbsp;in-place&nbsp;modification&nbsp;of&nbsp;x&nbsp;or&nbsp;y.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3787296">z</span>&nbsp;<span class="op" id="3787298">=</span>&nbsp;<span class="ident" id="3787300">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3787305">}</span><br>
<span class="lineno">1235</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3787309">//&nbsp;x**y&nbsp;mod&nbsp;1&nbsp;==&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3787329">if</span>&nbsp;<span class="builtinfunc" id="3787332">len</span><span class="op" id="3787335">(</span><span class="ident" id="3787336">m</span><span class="op" id="3787337">)</span>&nbsp;<span class="op" id="3787339">==</span>&nbsp;<span class="num" id="3787342">1</span>&nbsp;<span class="op" id="3787344">&amp;&amp;</span>&nbsp;<span class="ident" id="3787347">m</span><span class="op" id="3787348">[</span><span class="num" id="3787349">0</span><span class="op" id="3787350">]</span>&nbsp;<span class="op" id="3787352">==</span>&nbsp;<span class="num" id="3787355">1</span>&nbsp;<span class="op" id="3787357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3787361">return</span>&nbsp;<span class="ident" id="3787368">z</span><span class="op" id="3787369">.</span><span class="ident" id="3787370">setWord</span><span class="op" id="3787377">(</span><span class="num" id="3787378">0</span><span class="op" id="3787379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3787382">}</span><br>
<span class="lineno">1240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3787385">//&nbsp;m&nbsp;==&nbsp;0&nbsp;||&nbsp;m&nbsp;&gt;&nbsp;1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3787406">//&nbsp;x**0&nbsp;==&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3787420">if</span>&nbsp;<span class="builtinfunc" id="3787423">len</span><span class="op" id="3787426">(</span><span class="ident" id="3787427">y</span><span class="op" id="3787428">)</span>&nbsp;<span class="op" id="3787430">==</span>&nbsp;<span class="num" id="3787433">0</span>&nbsp;<span class="op" id="3787435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3787439">return</span>&nbsp;<span class="ident" id="3787446">z</span><span class="op" id="3787447">.</span><span class="ident" id="3787448">setWord</span><span class="op" id="3787455">(</span><span class="num" id="3787456">1</span><span class="op" id="3787457">)</span><br>
<span class="lineno">1245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3787460">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3787463">//&nbsp;y&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3787474">if</span>&nbsp;<span class="builtinfunc" id="3787477">len</span><span class="op" id="3787480">(</span><span class="ident" id="3787481">m</span><span class="op" id="3787482">)</span>&nbsp;<span class="op" id="3787484">!=</span>&nbsp;<span class="num" id="3787487">0</span>&nbsp;<span class="op" id="3787489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3787493">//&nbsp;We&nbsp;likely&nbsp;end&nbsp;up&nbsp;being&nbsp;as&nbsp;long&nbsp;as&nbsp;the&nbsp;modulus.</span><br>
<span class="lineno">1250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3787545">z</span>&nbsp;<span class="op" id="3787547">=</span>&nbsp;<span class="ident" id="3787549">z</span><span class="op" id="3787550">.</span><span class="builtinfunc" id="3787551">make</span><span class="op" id="3787555">(</span><span class="builtinfunc" id="3787556">len</span><span class="op" id="3787559">(</span><span class="ident" id="3787560">m</span><span class="op" id="3787561">)</span><span class="op" id="3787562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3787565">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3787568">z</span>&nbsp;<span class="op" id="3787570">=</span>&nbsp;<span class="ident" id="3787572">z</span><span class="op" id="3787573">.</span><span class="ident" id="3787574">set</span><span class="op" id="3787577">(</span><span class="ident" id="3787578">x</span><span class="op" id="3787579">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3787583">//&nbsp;If&nbsp;the&nbsp;base&nbsp;is&nbsp;non-trivial&nbsp;and&nbsp;the&nbsp;exponent&nbsp;is&nbsp;large,&nbsp;we&nbsp;use</span><br>
<span class="lineno">1255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3787648">//&nbsp;4-bit,&nbsp;windowed&nbsp;exponentiation.&nbsp;This&nbsp;involves&nbsp;precomputing&nbsp;14&nbsp;values</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3787721">//&nbsp;(x^2...x^15)&nbsp;but&nbsp;then&nbsp;reduces&nbsp;the&nbsp;number&nbsp;of&nbsp;multiply-reduces&nbsp;by&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3787791">//&nbsp;third.&nbsp;Even&nbsp;for&nbsp;a&nbsp;32-bit&nbsp;exponent,&nbsp;this&nbsp;reduces&nbsp;the&nbsp;number&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3787857">//&nbsp;operations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3787873">if</span>&nbsp;<span class="builtinfunc" id="3787876">len</span><span class="op" id="3787879">(</span><span class="ident" id="3787880">x</span><span class="op" id="3787881">)</span>&nbsp;<span class="op" id="3787883">&gt;</span>&nbsp;<span class="num" id="3787885">1</span>&nbsp;<span class="op" id="3787887">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3787890">len</span><span class="op" id="3787893">(</span><span class="ident" id="3787894">y</span><span class="op" id="3787895">)</span>&nbsp;<span class="op" id="3787897">&gt;</span>&nbsp;<span class="num" id="3787899">1</span>&nbsp;<span class="op" id="3787901">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3787904">len</span><span class="op" id="3787907">(</span><span class="ident" id="3787908">m</span><span class="op" id="3787909">)</span>&nbsp;<span class="op" id="3787911">&gt;</span>&nbsp;<span class="num" id="3787913">0</span>&nbsp;<span class="op" id="3787915">{</span><br>
<span class="lineno">1260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3787919">return</span>&nbsp;<span class="ident" id="3787926">z</span><span class="op" id="3787927">.</span><span class="ident" id="3787928">expNNWindowed</span><span class="op" id="3787941">(</span><span class="ident" id="3787942">x</span><span class="op" id="3787943">,</span>&nbsp;<span class="ident" id="3787945">y</span><span class="op" id="3787946">,</span>&nbsp;<span class="ident" id="3787948">m</span><span class="op" id="3787949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3787952">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3787956">v</span>&nbsp;<span class="op" id="3787958">:=</span>&nbsp;<span class="ident" id="3787961">y</span><span class="op" id="3787962">[</span><span class="builtinfunc" id="3787963">len</span><span class="op" id="3787966">(</span><span class="ident" id="3787967">y</span><span class="op" id="3787968">)</span><span class="op" id="3787969">-</span><span class="num" id="3787970">1</span><span class="op" id="3787971">]</span>&nbsp;<span class="comment" id="3787973">//&nbsp;v&nbsp;&gt;&nbsp;0&nbsp;because&nbsp;y&nbsp;is&nbsp;normalized&nbsp;and&nbsp;y&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3788017">shift</span>&nbsp;<span class="op" id="3788023">:=</span>&nbsp;<span class="ident" id="3788026">leadingZeros</span><span class="op" id="3788038">(</span><span class="ident" id="3788039">v</span><span class="op" id="3788040">)</span>&nbsp;<span class="op" id="3788042">+</span>&nbsp;<span class="num" id="3788044">1</span><br>
<span class="lineno">1265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3788047">v</span>&nbsp;<span class="op" id="3788049">&lt;&lt;=</span>&nbsp;<span class="ident" id="3788053">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3788060">var</span>&nbsp;<span class="ident" id="3788064">q</span>&nbsp;<span class="ident" id="3788066">nat</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3788072">const</span>&nbsp;<span class="ident" id="3788078">mask</span>&nbsp;<span class="op" id="3788083">=</span>&nbsp;<span class="num" id="3788085">1</span>&nbsp;<span class="op" id="3788087">&lt;&lt;</span>&nbsp;<span class="op" id="3788090">(</span><span class="ident" id="3788091">_W</span>&nbsp;<span class="op" id="3788094">-</span>&nbsp;<span class="num" id="3788096">1</span><span class="op" id="3788097">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3788101">//&nbsp;We&nbsp;walk&nbsp;through&nbsp;the&nbsp;bits&nbsp;of&nbsp;the&nbsp;exponent&nbsp;one&nbsp;by&nbsp;one.&nbsp;Each&nbsp;time&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3788171">//&nbsp;see&nbsp;a&nbsp;bit,&nbsp;we&nbsp;square,&nbsp;thus&nbsp;doubling&nbsp;the&nbsp;power.&nbsp;If&nbsp;the&nbsp;bit&nbsp;is&nbsp;a&nbsp;one,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3788243">//&nbsp;we&nbsp;also&nbsp;multiply&nbsp;by&nbsp;x,&nbsp;thus&nbsp;adding&nbsp;one&nbsp;to&nbsp;the&nbsp;power.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3788301">w</span>&nbsp;<span class="op" id="3788303">:=</span>&nbsp;<span class="ident" id="3788306">_W</span>&nbsp;<span class="op" id="3788309">-</span>&nbsp;<span class="builtintype" id="3788311">int</span><span class="op" id="3788314">(</span><span class="ident" id="3788315">shift</span><span class="op" id="3788320">)</span><br>
<span class="lineno">1275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3788323">//&nbsp;zz&nbsp;and&nbsp;r&nbsp;are&nbsp;used&nbsp;to&nbsp;avoid&nbsp;allocating&nbsp;in&nbsp;mul&nbsp;and&nbsp;div&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3788383">//&nbsp;otherwise&nbsp;the&nbsp;arguments&nbsp;would&nbsp;alias.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3788424">var</span>&nbsp;<span class="ident" id="3788428">zz</span><span class="op" id="3788430">,</span>&nbsp;<span class="ident" id="3788432">r</span>&nbsp;<span class="ident" id="3788434">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3788439">for</span>&nbsp;<span class="ident" id="3788443">j</span>&nbsp;<span class="op" id="3788445">:=</span>&nbsp;<span class="num" id="3788448">0</span><span class="op" id="3788449">;</span>&nbsp;<span class="ident" id="3788451">j</span>&nbsp;<span class="op" id="3788453">&lt;</span>&nbsp;<span class="ident" id="3788455">w</span><span class="op" id="3788456">;</span>&nbsp;<span class="ident" id="3788458">j</span><span class="op" id="3788459">++</span>&nbsp;<span class="op" id="3788462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3788466">zz</span>&nbsp;<span class="op" id="3788469">=</span>&nbsp;<span class="ident" id="3788471">zz</span><span class="op" id="3788473">.</span><span class="ident" id="3788474">mul</span><span class="op" id="3788477">(</span><span class="ident" id="3788478">z</span><span class="op" id="3788479">,</span>&nbsp;<span class="ident" id="3788481">z</span><span class="op" id="3788482">)</span><br>
<span class="lineno">1280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3788486">zz</span><span class="op" id="3788488">,</span>&nbsp;<span class="ident" id="3788490">z</span>&nbsp;<span class="op" id="3788492">=</span>&nbsp;<span class="ident" id="3788494">z</span><span class="op" id="3788495">,</span>&nbsp;<span class="ident" id="3788497">zz</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3788503">if</span>&nbsp;<span class="ident" id="3788506">v</span><span class="op" id="3788507">&amp;</span><span class="ident" id="3788508">mask</span>&nbsp;<span class="op" id="3788513">!=</span>&nbsp;<span class="num" id="3788516">0</span>&nbsp;<span class="op" id="3788518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3788523">zz</span>&nbsp;<span class="op" id="3788526">=</span>&nbsp;<span class="ident" id="3788528">zz</span><span class="op" id="3788530">.</span><span class="ident" id="3788531">mul</span><span class="op" id="3788534">(</span><span class="ident" id="3788535">z</span><span class="op" id="3788536">,</span>&nbsp;<span class="ident" id="3788538">x</span><span class="op" id="3788539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3788544">zz</span><span class="op" id="3788546">,</span>&nbsp;<span class="ident" id="3788548">z</span>&nbsp;<span class="op" id="3788550">=</span>&nbsp;<span class="ident" id="3788552">z</span><span class="op" id="3788553">,</span>&nbsp;<span class="ident" id="3788555">zz</span><br>
<span class="lineno">1285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3788560">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3788565">if</span>&nbsp;<span class="builtinfunc" id="3788568">len</span><span class="op" id="3788571">(</span><span class="ident" id="3788572">m</span><span class="op" id="3788573">)</span>&nbsp;<span class="op" id="3788575">!=</span>&nbsp;<span class="num" id="3788578">0</span>&nbsp;<span class="op" id="3788580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3788585">zz</span><span class="op" id="3788587">,</span>&nbsp;<span class="ident" id="3788589">r</span>&nbsp;<span class="op" id="3788591">=</span>&nbsp;<span class="ident" id="3788593">zz</span><span class="op" id="3788595">.</span><span class="ident" id="3788596">div</span><span class="op" id="3788599">(</span><span class="ident" id="3788600">r</span><span class="op" id="3788601">,</span>&nbsp;<span class="ident" id="3788603">z</span><span class="op" id="3788604">,</span>&nbsp;<span class="ident" id="3788606">m</span><span class="op" id="3788607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3788612">zz</span><span class="op" id="3788614">,</span>&nbsp;<span class="ident" id="3788616">r</span><span class="op" id="3788617">,</span>&nbsp;<span class="ident" id="3788619">q</span><span class="op" id="3788620">,</span>&nbsp;<span class="ident" id="3788622">z</span>&nbsp;<span class="op" id="3788624">=</span>&nbsp;<span class="ident" id="3788626">q</span><span class="op" id="3788627">,</span>&nbsp;<span class="ident" id="3788629">z</span><span class="op" id="3788630">,</span>&nbsp;<span class="ident" id="3788632">zz</span><span class="op" id="3788634">,</span>&nbsp;<span class="ident" id="3788636">r</span><br>
<span class="lineno">1290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3788640">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3788645">v</span>&nbsp;<span class="op" id="3788647">&lt;&lt;=</span>&nbsp;<span class="num" id="3788651">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3788654">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3788658">for</span>&nbsp;<span class="ident" id="3788662">i</span>&nbsp;<span class="op" id="3788664">:=</span>&nbsp;<span class="builtinfunc" id="3788667">len</span><span class="op" id="3788670">(</span><span class="ident" id="3788671">y</span><span class="op" id="3788672">)</span>&nbsp;<span class="op" id="3788674">-</span>&nbsp;<span class="num" id="3788676">2</span><span class="op" id="3788677">;</span>&nbsp;<span class="ident" id="3788679">i</span>&nbsp;<span class="op" id="3788681">&gt;=</span>&nbsp;<span class="num" id="3788684">0</span><span class="op" id="3788685">;</span>&nbsp;<span class="ident" id="3788687">i</span><span class="op" id="3788688">--</span>&nbsp;<span class="op" id="3788691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3788695">v</span>&nbsp;<span class="op" id="3788697">=</span>&nbsp;<span class="ident" id="3788699">y</span><span class="op" id="3788700">[</span><span class="ident" id="3788701">i</span><span class="op" id="3788702">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3788707">for</span>&nbsp;<span class="ident" id="3788711">j</span>&nbsp;<span class="op" id="3788713">:=</span>&nbsp;<span class="num" id="3788716">0</span><span class="op" id="3788717">;</span>&nbsp;<span class="ident" id="3788719">j</span>&nbsp;<span class="op" id="3788721">&lt;</span>&nbsp;<span class="ident" id="3788723">_W</span><span class="op" id="3788725">;</span>&nbsp;<span class="ident" id="3788727">j</span><span class="op" id="3788728">++</span>&nbsp;<span class="op" id="3788731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3788736">zz</span>&nbsp;<span class="op" id="3788739">=</span>&nbsp;<span class="ident" id="3788741">zz</span><span class="op" id="3788743">.</span><span class="ident" id="3788744">mul</span><span class="op" id="3788747">(</span><span class="ident" id="3788748">z</span><span class="op" id="3788749">,</span>&nbsp;<span class="ident" id="3788751">z</span><span class="op" id="3788752">)</span><br>
<span class="lineno">1300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3788757">zz</span><span class="op" id="3788759">,</span>&nbsp;<span class="ident" id="3788761">z</span>&nbsp;<span class="op" id="3788763">=</span>&nbsp;<span class="ident" id="3788765">z</span><span class="op" id="3788766">,</span>&nbsp;<span class="ident" id="3788768">zz</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3788775">if</span>&nbsp;<span class="ident" id="3788778">v</span><span class="op" id="3788779">&amp;</span><span class="ident" id="3788780">mask</span>&nbsp;<span class="op" id="3788785">!=</span>&nbsp;<span class="num" id="3788788">0</span>&nbsp;<span class="op" id="3788790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3788796">zz</span>&nbsp;<span class="op" id="3788799">=</span>&nbsp;<span class="ident" id="3788801">zz</span><span class="op" id="3788803">.</span><span class="ident" id="3788804">mul</span><span class="op" id="3788807">(</span><span class="ident" id="3788808">z</span><span class="op" id="3788809">,</span>&nbsp;<span class="ident" id="3788811">x</span><span class="op" id="3788812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3788818">zz</span><span class="op" id="3788820">,</span>&nbsp;<span class="ident" id="3788822">z</span>&nbsp;<span class="op" id="3788824">=</span>&nbsp;<span class="ident" id="3788826">z</span><span class="op" id="3788827">,</span>&nbsp;<span class="ident" id="3788829">zz</span><br>
<span class="lineno">1305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3788835">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3788841">if</span>&nbsp;<span class="builtinfunc" id="3788844">len</span><span class="op" id="3788847">(</span><span class="ident" id="3788848">m</span><span class="op" id="3788849">)</span>&nbsp;<span class="op" id="3788851">!=</span>&nbsp;<span class="num" id="3788854">0</span>&nbsp;<span class="op" id="3788856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3788862">zz</span><span class="op" id="3788864">,</span>&nbsp;<span class="ident" id="3788866">r</span>&nbsp;<span class="op" id="3788868">=</span>&nbsp;<span class="ident" id="3788870">zz</span><span class="op" id="3788872">.</span><span class="ident" id="3788873">div</span><span class="op" id="3788876">(</span><span class="ident" id="3788877">r</span><span class="op" id="3788878">,</span>&nbsp;<span class="ident" id="3788880">z</span><span class="op" id="3788881">,</span>&nbsp;<span class="ident" id="3788883">m</span><span class="op" id="3788884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3788890">zz</span><span class="op" id="3788892">,</span>&nbsp;<span class="ident" id="3788894">r</span><span class="op" id="3788895">,</span>&nbsp;<span class="ident" id="3788897">q</span><span class="op" id="3788898">,</span>&nbsp;<span class="ident" id="3788900">z</span>&nbsp;<span class="op" id="3788902">=</span>&nbsp;<span class="ident" id="3788904">q</span><span class="op" id="3788905">,</span>&nbsp;<span class="ident" id="3788907">z</span><span class="op" id="3788908">,</span>&nbsp;<span class="ident" id="3788910">zz</span><span class="op" id="3788912">,</span>&nbsp;<span class="ident" id="3788914">r</span><br>
<span class="lineno">1310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3788919">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3788925">v</span>&nbsp;<span class="op" id="3788927">&lt;&lt;=</span>&nbsp;<span class="num" id="3788931">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3788935">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3788938">}</span><br>
<span class="lineno">1315</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3788942">return</span>&nbsp;<span class="ident" id="3788949">z</span><span class="op" id="3788950">.</span><span class="ident" id="3788951">norm</span><span class="op" id="3788955">(</span><span class="op" id="3788956">)</span><br>
<span class="lineno"></span><span class="op" id="3788958">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3788961">//&nbsp;expNNWindowed&nbsp;calculates&nbsp;x**y&nbsp;mod&nbsp;m&nbsp;using&nbsp;a&nbsp;fixed,&nbsp;4-bit&nbsp;window.</span><br>
<span class="lineno">1320</span><span class="keyword" id="3789029">func</span>&nbsp;<span class="op" id="3789034">(</span><span class="ident" id="3789035">z</span>&nbsp;<span class="ident" id="3789037">nat</span><span class="op" id="3789040">)</span>&nbsp;<span class="ident" id="3789042">expNNWindowed</span><span class="op" id="3789055">(</span><span class="ident" id="3789056">x</span><span class="op" id="3789057">,</span>&nbsp;<span class="ident" id="3789059">y</span><span class="op" id="3789060">,</span>&nbsp;<span class="ident" id="3789062">m</span>&nbsp;<span class="ident" id="3789064">nat</span><span class="op" id="3789067">)</span>&nbsp;<span class="ident" id="3789069">nat</span>&nbsp;<span class="op" id="3789073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3789076">//&nbsp;zz&nbsp;and&nbsp;r&nbsp;are&nbsp;used&nbsp;to&nbsp;avoid&nbsp;allocating&nbsp;in&nbsp;mul&nbsp;and&nbsp;div&nbsp;as&nbsp;otherwise</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3789146">//&nbsp;the&nbsp;arguments&nbsp;would&nbsp;alias.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3789177">var</span>&nbsp;<span class="ident" id="3789181">zz</span><span class="op" id="3789183">,</span>&nbsp;<span class="ident" id="3789185">r</span>&nbsp;<span class="ident" id="3789187">nat</span><br>
<span class="lineno"></span><br>
<span class="lineno">1325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3789193">const</span>&nbsp;<span class="ident" id="3789199">n</span>&nbsp;<span class="op" id="3789201">=</span>&nbsp;<span class="num" id="3789203">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3789206">//&nbsp;powers[i]&nbsp;contains&nbsp;x^i.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3789234">var</span>&nbsp;<span class="ident" id="3789238">powers</span>&nbsp;<span class="op" id="3789245">[</span><span class="num" id="3789246">1</span>&nbsp;<span class="op" id="3789248">&lt;&lt;</span>&nbsp;<span class="ident" id="3789251">n</span><span class="op" id="3789252">]</span><span class="ident" id="3789253">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3789258">powers</span><span class="op" id="3789264">[</span><span class="num" id="3789265">0</span><span class="op" id="3789266">]</span>&nbsp;<span class="op" id="3789268">=</span>&nbsp;<span class="ident" id="3789270">natOne</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3789278">powers</span><span class="op" id="3789284">[</span><span class="num" id="3789285">1</span><span class="op" id="3789286">]</span>&nbsp;<span class="op" id="3789288">=</span>&nbsp;<span class="ident" id="3789290">x</span><br>
<span class="lineno">1330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3789293">for</span>&nbsp;<span class="ident" id="3789297">i</span>&nbsp;<span class="op" id="3789299">:=</span>&nbsp;<span class="num" id="3789302">2</span><span class="op" id="3789303">;</span>&nbsp;<span class="ident" id="3789305">i</span>&nbsp;<span class="op" id="3789307">&lt;</span>&nbsp;<span class="num" id="3789309">1</span><span class="op" id="3789310">&lt;&lt;</span><span class="ident" id="3789312">n</span><span class="op" id="3789313">;</span>&nbsp;<span class="ident" id="3789315">i</span>&nbsp;<span class="op" id="3789317">+=</span>&nbsp;<span class="num" id="3789320">2</span>&nbsp;<span class="op" id="3789322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3789326">p2</span><span class="op" id="3789328">,</span>&nbsp;<span class="ident" id="3789330">p</span><span class="op" id="3789331">,</span>&nbsp;<span class="ident" id="3789333">p1</span>&nbsp;<span class="op" id="3789336">:=</span>&nbsp;<span class="op" id="3789339">&amp;</span><span class="ident" id="3789340">powers</span><span class="op" id="3789346">[</span><span class="ident" id="3789347">i</span><span class="op" id="3789348">/</span><span class="num" id="3789349">2</span><span class="op" id="3789350">]</span><span class="op" id="3789351">,</span>&nbsp;<span class="op" id="3789353">&amp;</span><span class="ident" id="3789354">powers</span><span class="op" id="3789360">[</span><span class="ident" id="3789361">i</span><span class="op" id="3789362">]</span><span class="op" id="3789363">,</span>&nbsp;<span class="op" id="3789365">&amp;</span><span class="ident" id="3789366">powers</span><span class="op" id="3789372">[</span><span class="ident" id="3789373">i</span><span class="op" id="3789374">+</span><span class="num" id="3789375">1</span><span class="op" id="3789376">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3789380">*</span><span class="ident" id="3789381">p</span>&nbsp;<span class="op" id="3789383">=</span>&nbsp;<span class="ident" id="3789385">p</span><span class="op" id="3789386">.</span><span class="ident" id="3789387">mul</span><span class="op" id="3789390">(</span><span class="op" id="3789391">*</span><span class="ident" id="3789392">p2</span><span class="op" id="3789394">,</span>&nbsp;<span class="op" id="3789396">*</span><span class="ident" id="3789397">p2</span><span class="op" id="3789399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3789403">zz</span><span class="op" id="3789405">,</span>&nbsp;<span class="ident" id="3789407">r</span>&nbsp;<span class="op" id="3789409">=</span>&nbsp;<span class="ident" id="3789411">zz</span><span class="op" id="3789413">.</span><span class="ident" id="3789414">div</span><span class="op" id="3789417">(</span><span class="ident" id="3789418">r</span><span class="op" id="3789419">,</span>&nbsp;<span class="op" id="3789421">*</span><span class="ident" id="3789422">p</span><span class="op" id="3789423">,</span>&nbsp;<span class="ident" id="3789425">m</span><span class="op" id="3789426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3789430">*</span><span class="ident" id="3789431">p</span><span class="op" id="3789432">,</span>&nbsp;<span class="ident" id="3789434">r</span>&nbsp;<span class="op" id="3789436">=</span>&nbsp;<span class="ident" id="3789438">r</span><span class="op" id="3789439">,</span>&nbsp;<span class="op" id="3789441">*</span><span class="ident" id="3789442">p</span><br>
<span class="lineno">1335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3789446">*</span><span class="ident" id="3789447">p1</span>&nbsp;<span class="op" id="3789450">=</span>&nbsp;<span class="ident" id="3789452">p1</span><span class="op" id="3789454">.</span><span class="ident" id="3789455">mul</span><span class="op" id="3789458">(</span><span class="op" id="3789459">*</span><span class="ident" id="3789460">p</span><span class="op" id="3789461">,</span>&nbsp;<span class="ident" id="3789463">x</span><span class="op" id="3789464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3789468">zz</span><span class="op" id="3789470">,</span>&nbsp;<span class="ident" id="3789472">r</span>&nbsp;<span class="op" id="3789474">=</span>&nbsp;<span class="ident" id="3789476">zz</span><span class="op" id="3789478">.</span><span class="ident" id="3789479">div</span><span class="op" id="3789482">(</span><span class="ident" id="3789483">r</span><span class="op" id="3789484">,</span>&nbsp;<span class="op" id="3789486">*</span><span class="ident" id="3789487">p1</span><span class="op" id="3789489">,</span>&nbsp;<span class="ident" id="3789491">m</span><span class="op" id="3789492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3789496">*</span><span class="ident" id="3789497">p1</span><span class="op" id="3789499">,</span>&nbsp;<span class="ident" id="3789501">r</span>&nbsp;<span class="op" id="3789503">=</span>&nbsp;<span class="ident" id="3789505">r</span><span class="op" id="3789506">,</span>&nbsp;<span class="op" id="3789508">*</span><span class="ident" id="3789509">p1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3789513">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3789517">z</span>&nbsp;<span class="op" id="3789519">=</span>&nbsp;<span class="ident" id="3789521">z</span><span class="op" id="3789522">.</span><span class="ident" id="3789523">setWord</span><span class="op" id="3789530">(</span><span class="num" id="3789531">1</span><span class="op" id="3789532">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3789536">for</span>&nbsp;<span class="ident" id="3789540">i</span>&nbsp;<span class="op" id="3789542">:=</span>&nbsp;<span class="builtinfunc" id="3789545">len</span><span class="op" id="3789548">(</span><span class="ident" id="3789549">y</span><span class="op" id="3789550">)</span>&nbsp;<span class="op" id="3789552">-</span>&nbsp;<span class="num" id="3789554">1</span><span class="op" id="3789555">;</span>&nbsp;<span class="ident" id="3789557">i</span>&nbsp;<span class="op" id="3789559">&gt;=</span>&nbsp;<span class="num" id="3789562">0</span><span class="op" id="3789563">;</span>&nbsp;<span class="ident" id="3789565">i</span><span class="op" id="3789566">--</span>&nbsp;<span class="op" id="3789569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3789573">yi</span>&nbsp;<span class="op" id="3789576">:=</span>&nbsp;<span class="ident" id="3789579">y</span><span class="op" id="3789580">[</span><span class="ident" id="3789581">i</span><span class="op" id="3789582">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3789586">for</span>&nbsp;<span class="ident" id="3789590">j</span>&nbsp;<span class="op" id="3789592">:=</span>&nbsp;<span class="num" id="3789595">0</span><span class="op" id="3789596">;</span>&nbsp;<span class="ident" id="3789598">j</span>&nbsp;<span class="op" id="3789600">&lt;</span>&nbsp;<span class="ident" id="3789602">_W</span><span class="op" id="3789604">;</span>&nbsp;<span class="ident" id="3789606">j</span>&nbsp;<span class="op" id="3789608">+=</span>&nbsp;<span class="ident" id="3789611">n</span>&nbsp;<span class="op" id="3789613">{</span><br>
<span class="lineno">1345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3789618">if</span>&nbsp;<span class="ident" id="3789621">i</span>&nbsp;<span class="op" id="3789623">!=</span>&nbsp;<span class="builtinfunc" id="3789626">len</span><span class="op" id="3789629">(</span><span class="ident" id="3789630">y</span><span class="op" id="3789631">)</span><span class="op" id="3789632">-</span><span class="num" id="3789633">1</span>&nbsp;<span class="op" id="3789635">||</span>&nbsp;<span class="ident" id="3789638">j</span>&nbsp;<span class="op" id="3789640">!=</span>&nbsp;<span class="num" id="3789643">0</span>&nbsp;<span class="op" id="3789645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3789651">//&nbsp;Unrolled&nbsp;loop&nbsp;for&nbsp;significant&nbsp;performance</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3789700">//&nbsp;gain.&nbsp;&nbsp;Use&nbsp;go&nbsp;test&nbsp;-bench=&#34;.*&#34;&nbsp;in&nbsp;crypto/rsa</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3789752">//&nbsp;to&nbsp;check&nbsp;performance&nbsp;before&nbsp;making&nbsp;changes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3789803">zz</span>&nbsp;<span class="op" id="3789806">=</span>&nbsp;<span class="ident" id="3789808">zz</span><span class="op" id="3789810">.</span><span class="ident" id="3789811">mul</span><span class="op" id="3789814">(</span><span class="ident" id="3789815">z</span><span class="op" id="3789816">,</span>&nbsp;<span class="ident" id="3789818">z</span><span class="op" id="3789819">)</span><br>
<span class="lineno">1350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3789825">zz</span><span class="op" id="3789827">,</span>&nbsp;<span class="ident" id="3789829">z</span>&nbsp;<span class="op" id="3789831">=</span>&nbsp;<span class="ident" id="3789833">z</span><span class="op" id="3789834">,</span>&nbsp;<span class="ident" id="3789836">zz</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3789843">zz</span><span class="op" id="3789845">,</span>&nbsp;<span class="ident" id="3789847">r</span>&nbsp;<span class="op" id="3789849">=</span>&nbsp;<span class="ident" id="3789851">zz</span><span class="op" id="3789853">.</span><span class="ident" id="3789854">div</span><span class="op" id="3789857">(</span><span class="ident" id="3789858">r</span><span class="op" id="3789859">,</span>&nbsp;<span class="ident" id="3789861">z</span><span class="op" id="3789862">,</span>&nbsp;<span class="ident" id="3789864">m</span><span class="op" id="3789865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3789871">z</span><span class="op" id="3789872">,</span>&nbsp;<span class="ident" id="3789874">r</span>&nbsp;<span class="op" id="3789876">=</span>&nbsp;<span class="ident" id="3789878">r</span><span class="op" id="3789879">,</span>&nbsp;<span class="ident" id="3789881">z</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3789888">zz</span>&nbsp;<span class="op" id="3789891">=</span>&nbsp;<span class="ident" id="3789893">zz</span><span class="op" id="3789895">.</span><span class="ident" id="3789896">mul</span><span class="op" id="3789899">(</span><span class="ident" id="3789900">z</span><span class="op" id="3789901">,</span>&nbsp;<span class="ident" id="3789903">z</span><span class="op" id="3789904">)</span><br>
<span class="lineno">1355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3789910">zz</span><span class="op" id="3789912">,</span>&nbsp;<span class="ident" id="3789914">z</span>&nbsp;<span class="op" id="3789916">=</span>&nbsp;<span class="ident" id="3789918">z</span><span class="op" id="3789919">,</span>&nbsp;<span class="ident" id="3789921">zz</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3789928">zz</span><span class="op" id="3789930">,</span>&nbsp;<span class="ident" id="3789932">r</span>&nbsp;<span class="op" id="3789934">=</span>&nbsp;<span class="ident" id="3789936">zz</span><span class="op" id="3789938">.</span><span class="ident" id="3789939">div</span><span class="op" id="3789942">(</span><span class="ident" id="3789943">r</span><span class="op" id="3789944">,</span>&nbsp;<span class="ident" id="3789946">z</span><span class="op" id="3789947">,</span>&nbsp;<span class="ident" id="3789949">m</span><span class="op" id="3789950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3789956">z</span><span class="op" id="3789957">,</span>&nbsp;<span class="ident" id="3789959">r</span>&nbsp;<span class="op" id="3789961">=</span>&nbsp;<span class="ident" id="3789963">r</span><span class="op" id="3789964">,</span>&nbsp;<span class="ident" id="3789966">z</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3789973">zz</span>&nbsp;<span class="op" id="3789976">=</span>&nbsp;<span class="ident" id="3789978">zz</span><span class="op" id="3789980">.</span><span class="ident" id="3789981">mul</span><span class="op" id="3789984">(</span><span class="ident" id="3789985">z</span><span class="op" id="3789986">,</span>&nbsp;<span class="ident" id="3789988">z</span><span class="op" id="3789989">)</span><br>
<span class="lineno">1360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3789995">zz</span><span class="op" id="3789997">,</span>&nbsp;<span class="ident" id="3789999">z</span>&nbsp;<span class="op" id="3790001">=</span>&nbsp;<span class="ident" id="3790003">z</span><span class="op" id="3790004">,</span>&nbsp;<span class="ident" id="3790006">zz</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3790013">zz</span><span class="op" id="3790015">,</span>&nbsp;<span class="ident" id="3790017">r</span>&nbsp;<span class="op" id="3790019">=</span>&nbsp;<span class="ident" id="3790021">zz</span><span class="op" id="3790023">.</span><span class="ident" id="3790024">div</span><span class="op" id="3790027">(</span><span class="ident" id="3790028">r</span><span class="op" id="3790029">,</span>&nbsp;<span class="ident" id="3790031">z</span><span class="op" id="3790032">,</span>&nbsp;<span class="ident" id="3790034">m</span><span class="op" id="3790035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3790041">z</span><span class="op" id="3790042">,</span>&nbsp;<span class="ident" id="3790044">r</span>&nbsp;<span class="op" id="3790046">=</span>&nbsp;<span class="ident" id="3790048">r</span><span class="op" id="3790049">,</span>&nbsp;<span class="ident" id="3790051">z</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3790058">zz</span>&nbsp;<span class="op" id="3790061">=</span>&nbsp;<span class="ident" id="3790063">zz</span><span class="op" id="3790065">.</span><span class="ident" id="3790066">mul</span><span class="op" id="3790069">(</span><span class="ident" id="3790070">z</span><span class="op" id="3790071">,</span>&nbsp;<span class="ident" id="3790073">z</span><span class="op" id="3790074">)</span><br>
<span class="lineno">1365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3790080">zz</span><span class="op" id="3790082">,</span>&nbsp;<span class="ident" id="3790084">z</span>&nbsp;<span class="op" id="3790086">=</span>&nbsp;<span class="ident" id="3790088">z</span><span class="op" id="3790089">,</span>&nbsp;<span class="ident" id="3790091">zz</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3790098">zz</span><span class="op" id="3790100">,</span>&nbsp;<span class="ident" id="3790102">r</span>&nbsp;<span class="op" id="3790104">=</span>&nbsp;<span class="ident" id="3790106">zz</span><span class="op" id="3790108">.</span><span class="ident" id="3790109">div</span><span class="op" id="3790112">(</span><span class="ident" id="3790113">r</span><span class="op" id="3790114">,</span>&nbsp;<span class="ident" id="3790116">z</span><span class="op" id="3790117">,</span>&nbsp;<span class="ident" id="3790119">m</span><span class="op" id="3790120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3790126">z</span><span class="op" id="3790127">,</span>&nbsp;<span class="ident" id="3790129">r</span>&nbsp;<span class="op" id="3790131">=</span>&nbsp;<span class="ident" id="3790133">r</span><span class="op" id="3790134">,</span>&nbsp;<span class="ident" id="3790136">z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3790141">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3790147">zz</span>&nbsp;<span class="op" id="3790150">=</span>&nbsp;<span class="ident" id="3790152">zz</span><span class="op" id="3790154">.</span><span class="ident" id="3790155">mul</span><span class="op" id="3790158">(</span><span class="ident" id="3790159">z</span><span class="op" id="3790160">,</span>&nbsp;<span class="ident" id="3790162">powers</span><span class="op" id="3790168">[</span><span class="ident" id="3790169">yi</span><span class="op" id="3790171">&gt;&gt;</span><span class="op" id="3790173">(</span><span class="ident" id="3790174">_W</span><span class="op" id="3790176">-</span><span class="ident" id="3790177">n</span><span class="op" id="3790178">)</span><span class="op" id="3790179">]</span><span class="op" id="3790180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3790185">zz</span><span class="op" id="3790187">,</span>&nbsp;<span class="ident" id="3790189">z</span>&nbsp;<span class="op" id="3790191">=</span>&nbsp;<span class="ident" id="3790193">z</span><span class="op" id="3790194">,</span>&nbsp;<span class="ident" id="3790196">zz</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3790202">zz</span><span class="op" id="3790204">,</span>&nbsp;<span class="ident" id="3790206">r</span>&nbsp;<span class="op" id="3790208">=</span>&nbsp;<span class="ident" id="3790210">zz</span><span class="op" id="3790212">.</span><span class="ident" id="3790213">div</span><span class="op" id="3790216">(</span><span class="ident" id="3790217">r</span><span class="op" id="3790218">,</span>&nbsp;<span class="ident" id="3790220">z</span><span class="op" id="3790221">,</span>&nbsp;<span class="ident" id="3790223">m</span><span class="op" id="3790224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3790229">z</span><span class="op" id="3790230">,</span>&nbsp;<span class="ident" id="3790232">r</span>&nbsp;<span class="op" id="3790234">=</span>&nbsp;<span class="ident" id="3790236">r</span><span class="op" id="3790237">,</span>&nbsp;<span class="ident" id="3790239">z</span><br>
<span class="lineno"></span><br>
<span class="lineno">1375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3790245">yi</span>&nbsp;<span class="op" id="3790248">&lt;&lt;=</span>&nbsp;<span class="ident" id="3790252">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3790256">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3790259">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3790263">return</span>&nbsp;<span class="ident" id="3790270">z</span><span class="op" id="3790271">.</span><span class="ident" id="3790272">norm</span><span class="op" id="3790276">(</span><span class="op" id="3790277">)</span><br>
<span class="lineno">1380</span><span class="op" id="3790279">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3790282">//&nbsp;probablyPrime&nbsp;performs&nbsp;reps&nbsp;Miller-Rabin&nbsp;tests&nbsp;to&nbsp;check&nbsp;whether&nbsp;n&nbsp;is&nbsp;prime.</span><br>
<span class="lineno"></span><span class="comment" id="3790361">//&nbsp;If&nbsp;it&nbsp;returns&nbsp;true,&nbsp;n&nbsp;is&nbsp;prime&nbsp;with&nbsp;probability&nbsp;1&nbsp;-&nbsp;1/4^reps.</span><br>
<span class="lineno"></span><span class="comment" id="3790426">//&nbsp;If&nbsp;it&nbsp;returns&nbsp;false,&nbsp;n&nbsp;is&nbsp;not&nbsp;prime.</span><br>
<span class="lineno">1385</span><span class="keyword" id="3790466">func</span>&nbsp;<span class="op" id="3790471">(</span><span class="ident" id="3790472">n</span>&nbsp;<span class="ident" id="3790474">nat</span><span class="op" id="3790477">)</span>&nbsp;<span class="ident" id="3790479">probablyPrime</span><span class="op" id="3790492">(</span><span class="ident" id="3790493">reps</span>&nbsp;<span class="builtintype" id="3790498">int</span><span class="op" id="3790501">)</span>&nbsp;<span class="builtintype" id="3790503">bool</span>&nbsp;<span class="op" id="3790508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3790511">if</span>&nbsp;<span class="builtinfunc" id="3790514">len</span><span class="op" id="3790517">(</span><span class="ident" id="3790518">n</span><span class="op" id="3790519">)</span>&nbsp;<span class="op" id="3790521">==</span>&nbsp;<span class="num" id="3790524">0</span>&nbsp;<span class="op" id="3790526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3790530">return</span>&nbsp;<span class="builtintype" id="3790537">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3790544">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3790548">if</span>&nbsp;<span class="builtinfunc" id="3790551">len</span><span class="op" id="3790554">(</span><span class="ident" id="3790555">n</span><span class="op" id="3790556">)</span>&nbsp;<span class="op" id="3790558">==</span>&nbsp;<span class="num" id="3790561">1</span>&nbsp;<span class="op" id="3790563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3790567">if</span>&nbsp;<span class="ident" id="3790570">n</span><span class="op" id="3790571">[</span><span class="num" id="3790572">0</span><span class="op" id="3790573">]</span>&nbsp;<span class="op" id="3790575">&lt;</span>&nbsp;<span class="num" id="3790577">2</span>&nbsp;<span class="op" id="3790579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3790584">return</span>&nbsp;<span class="builtintype" id="3790591">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3790599">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3790604">if</span>&nbsp;<span class="ident" id="3790607">n</span><span class="op" id="3790608">[</span><span class="num" id="3790609">0</span><span class="op" id="3790610">]</span><span class="op" id="3790611">%</span><span class="num" id="3790612">2</span>&nbsp;<span class="op" id="3790614">==</span>&nbsp;<span class="num" id="3790617">0</span>&nbsp;<span class="op" id="3790619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3790624">return</span>&nbsp;<span class="ident" id="3790631">n</span><span class="op" id="3790632">[</span><span class="num" id="3790633">0</span><span class="op" id="3790634">]</span>&nbsp;<span class="op" id="3790636">==</span>&nbsp;<span class="num" id="3790639">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3790643">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3790648">//&nbsp;We&nbsp;have&nbsp;to&nbsp;exclude&nbsp;these&nbsp;cases&nbsp;because&nbsp;we&nbsp;reject&nbsp;all</span><br>
<span class="lineno">1400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3790706">//&nbsp;multiples&nbsp;of&nbsp;these&nbsp;numbers&nbsp;below.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3790745">switch</span>&nbsp;<span class="ident" id="3790752">n</span><span class="op" id="3790753">[</span><span class="num" id="3790754">0</span><span class="op" id="3790755">]</span>&nbsp;<span class="op" id="3790757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3790761">case</span>&nbsp;<span class="num" id="3790766">3</span><span class="op" id="3790767">,</span>&nbsp;<span class="num" id="3790769">5</span><span class="op" id="3790770">,</span>&nbsp;<span class="num" id="3790772">7</span><span class="op" id="3790773">,</span>&nbsp;<span class="num" id="3790775">11</span><span class="op" id="3790777">,</span>&nbsp;<span class="num" id="3790779">13</span><span class="op" id="3790781">,</span>&nbsp;<span class="num" id="3790783">17</span><span class="op" id="3790785">,</span>&nbsp;<span class="num" id="3790787">19</span><span class="op" id="3790789">,</span>&nbsp;<span class="num" id="3790791">23</span><span class="op" id="3790793">,</span>&nbsp;<span class="num" id="3790795">29</span><span class="op" id="3790797">,</span>&nbsp;<span class="num" id="3790799">31</span><span class="op" id="3790801">,</span>&nbsp;<span class="num" id="3790803">37</span><span class="op" id="3790805">,</span>&nbsp;<span class="num" id="3790807">41</span><span class="op" id="3790809">,</span>&nbsp;<span class="num" id="3790811">43</span><span class="op" id="3790813">,</span>&nbsp;<span class="num" id="3790815">47</span><span class="op" id="3790817">,</span>&nbsp;<span class="num" id="3790819">53</span><span class="op" id="3790821">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3790826">return</span>&nbsp;<span class="builtintype" id="3790833">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3790840">}</span><br>
<span class="lineno">1405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3790843">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3790847">const</span>&nbsp;<span class="ident" id="3790853">primesProduct32</span>&nbsp;<span class="op" id="3790869">=</span>&nbsp;<span class="num" id="3790871">0xC0CFD797</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3790890">//&nbsp;Π&nbsp;{p&nbsp;∈&nbsp;primes,&nbsp;2&nbsp;&lt;&nbsp;p&nbsp;&lt;=&nbsp;29}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3790925">const</span>&nbsp;<span class="ident" id="3790931">primesProduct64</span>&nbsp;<span class="op" id="3790947">=</span>&nbsp;<span class="num" id="3790949">0xE221F97C30E94E1D</span>&nbsp;<span class="comment" id="3790968">//&nbsp;Π&nbsp;{p&nbsp;∈&nbsp;primes,&nbsp;2&nbsp;&lt;&nbsp;p&nbsp;&lt;=&nbsp;53}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3791004">var</span>&nbsp;<span class="ident" id="3791008">r</span>&nbsp;<span class="ident" id="3791010">Word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3791016">switch</span>&nbsp;<span class="ident" id="3791023">_W</span>&nbsp;<span class="op" id="3791026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3791029">case</span>&nbsp;<span class="num" id="3791034">32</span><span class="op" id="3791036">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3791040">r</span>&nbsp;<span class="op" id="3791042">=</span>&nbsp;<span class="ident" id="3791044">n</span><span class="op" id="3791045">.</span><span class="ident" id="3791046">modW</span><span class="op" id="3791050">(</span><span class="ident" id="3791051">primesProduct32</span><span class="op" id="3791066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3791069">case</span>&nbsp;<span class="num" id="3791074">64</span><span class="op" id="3791076">:</span><br>
<span class="lineno">1415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3791080">r</span>&nbsp;<span class="op" id="3791082">=</span>&nbsp;<span class="ident" id="3791084">n</span><span class="op" id="3791085">.</span><span class="ident" id="3791086">modW</span><span class="op" id="3791090">(</span><span class="ident" id="3791091">primesProduct64</span>&nbsp;<span class="op" id="3791107">&amp;</span>&nbsp;<span class="ident" id="3791109">_M</span><span class="op" id="3791111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3791114">default</span><span class="op" id="3791121">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3791125">panic</span><span class="op" id="3791130">(</span><span class="string" id="3791131">&#34;Unknown&nbsp;word&nbsp;size&#34;</span><span class="op" id="3791150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3791153">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3791157">if</span>&nbsp;<span class="ident" id="3791160">r</span><span class="op" id="3791161">%</span><span class="num" id="3791162">3</span>&nbsp;<span class="op" id="3791164">==</span>&nbsp;<span class="num" id="3791167">0</span>&nbsp;<span class="op" id="3791169">||</span>&nbsp;<span class="ident" id="3791172">r</span><span class="op" id="3791173">%</span><span class="num" id="3791174">5</span>&nbsp;<span class="op" id="3791176">==</span>&nbsp;<span class="num" id="3791179">0</span>&nbsp;<span class="op" id="3791181">||</span>&nbsp;<span class="ident" id="3791184">r</span><span class="op" id="3791185">%</span><span class="num" id="3791186">7</span>&nbsp;<span class="op" id="3791188">==</span>&nbsp;<span class="num" id="3791191">0</span>&nbsp;<span class="op" id="3791193">||</span>&nbsp;<span class="ident" id="3791196">r</span><span class="op" id="3791197">%</span><span class="num" id="3791198">11</span>&nbsp;<span class="op" id="3791201">==</span>&nbsp;<span class="num" id="3791204">0</span>&nbsp;<span class="op" id="3791206">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3791211">r</span><span class="op" id="3791212">%</span><span class="num" id="3791213">13</span>&nbsp;<span class="op" id="3791216">==</span>&nbsp;<span class="num" id="3791219">0</span>&nbsp;<span class="op" id="3791221">||</span>&nbsp;<span class="ident" id="3791224">r</span><span class="op" id="3791225">%</span><span class="num" id="3791226">17</span>&nbsp;<span class="op" id="3791229">==</span>&nbsp;<span class="num" id="3791232">0</span>&nbsp;<span class="op" id="3791234">||</span>&nbsp;<span class="ident" id="3791237">r</span><span class="op" id="3791238">%</span><span class="num" id="3791239">19</span>&nbsp;<span class="op" id="3791242">==</span>&nbsp;<span class="num" id="3791245">0</span>&nbsp;<span class="op" id="3791247">||</span>&nbsp;<span class="ident" id="3791250">r</span><span class="op" id="3791251">%</span><span class="num" id="3791252">23</span>&nbsp;<span class="op" id="3791255">==</span>&nbsp;<span class="num" id="3791258">0</span>&nbsp;<span class="op" id="3791260">||</span>&nbsp;<span class="ident" id="3791263">r</span><span class="op" id="3791264">%</span><span class="num" id="3791265">29</span>&nbsp;<span class="op" id="3791268">==</span>&nbsp;<span class="num" id="3791271">0</span>&nbsp;<span class="op" id="3791273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3791277">return</span>&nbsp;<span class="builtintype" id="3791284">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3791291">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3791295">if</span>&nbsp;<span class="ident" id="3791298">_W</span>&nbsp;<span class="op" id="3791301">==</span>&nbsp;<span class="num" id="3791304">64</span>&nbsp;<span class="op" id="3791307">&amp;&amp;</span>&nbsp;<span class="op" id="3791310">(</span><span class="ident" id="3791311">r</span><span class="op" id="3791312">%</span><span class="num" id="3791313">31</span>&nbsp;<span class="op" id="3791316">==</span>&nbsp;<span class="num" id="3791319">0</span>&nbsp;<span class="op" id="3791321">||</span>&nbsp;<span class="ident" id="3791324">r</span><span class="op" id="3791325">%</span><span class="num" id="3791326">37</span>&nbsp;<span class="op" id="3791329">==</span>&nbsp;<span class="num" id="3791332">0</span>&nbsp;<span class="op" id="3791334">||</span>&nbsp;<span class="ident" id="3791337">r</span><span class="op" id="3791338">%</span><span class="num" id="3791339">41</span>&nbsp;<span class="op" id="3791342">==</span>&nbsp;<span class="num" id="3791345">0</span>&nbsp;<span class="op" id="3791347">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3791352">r</span><span class="op" id="3791353">%</span><span class="num" id="3791354">43</span>&nbsp;<span class="op" id="3791357">==</span>&nbsp;<span class="num" id="3791360">0</span>&nbsp;<span class="op" id="3791362">||</span>&nbsp;<span class="ident" id="3791365">r</span><span class="op" id="3791366">%</span><span class="num" id="3791367">47</span>&nbsp;<span class="op" id="3791370">==</span>&nbsp;<span class="num" id="3791373">0</span>&nbsp;<span class="op" id="3791375">||</span>&nbsp;<span class="ident" id="3791378">r</span><span class="op" id="3791379">%</span><span class="num" id="3791380">53</span>&nbsp;<span class="op" id="3791383">==</span>&nbsp;<span class="num" id="3791386">0</span><span class="op" id="3791387">)</span>&nbsp;<span class="op" id="3791389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3791393">return</span>&nbsp;<span class="builtintype" id="3791400">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3791407">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3791411">nm1</span>&nbsp;<span class="op" id="3791415">:=</span>&nbsp;<span class="ident" id="3791418">nat</span><span class="op" id="3791421">(</span><span class="ident" id="3791422">nil</span><span class="op" id="3791425">)</span><span class="op" id="3791426">.</span><span class="ident" id="3791427">sub</span><span class="op" id="3791430">(</span><span class="ident" id="3791431">n</span><span class="op" id="3791432">,</span>&nbsp;<span class="ident" id="3791434">natOne</span><span class="op" id="3791440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3791443">//&nbsp;determine&nbsp;q,&nbsp;k&nbsp;such&nbsp;that&nbsp;nm1&nbsp;=&nbsp;q&nbsp;&lt;&lt;&nbsp;k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3791485">k</span>&nbsp;<span class="op" id="3791487">:=</span>&nbsp;<span class="ident" id="3791490">nm1</span><span class="op" id="3791493">.</span><span class="ident" id="3791494">trailingZeroBits</span><span class="op" id="3791510">(</span><span class="op" id="3791511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3791514">q</span>&nbsp;<span class="op" id="3791516">:=</span>&nbsp;<span class="ident" id="3791519">nat</span><span class="op" id="3791522">(</span><span class="ident" id="3791523">nil</span><span class="op" id="3791526">)</span><span class="op" id="3791527">.</span><span class="ident" id="3791528">shr</span><span class="op" id="3791531">(</span><span class="ident" id="3791532">nm1</span><span class="op" id="3791535">,</span>&nbsp;<span class="ident" id="3791537">k</span><span class="op" id="3791538">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3791542">nm3</span>&nbsp;<span class="op" id="3791546">:=</span>&nbsp;<span class="ident" id="3791549">nat</span><span class="op" id="3791552">(</span><span class="ident" id="3791553">nil</span><span class="op" id="3791556">)</span><span class="op" id="3791557">.</span><span class="ident" id="3791558">sub</span><span class="op" id="3791561">(</span><span class="ident" id="3791562">nm1</span><span class="op" id="3791565">,</span>&nbsp;<span class="ident" id="3791567">natTwo</span><span class="op" id="3791573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3791576">rand</span>&nbsp;<span class="op" id="3791581">:=</span>&nbsp;<span class="ident" id="3791584">rand</span><span class="op" id="3791588">.</span><span class="ident" id="3791589">New</span><span class="op" id="3791592">(</span><span class="ident" id="3791593">rand</span><span class="op" id="3791597">.</span><span class="ident" id="3791598">NewSource</span><span class="op" id="3791607">(</span><span class="ident" id="3791608">int64</span><span class="op" id="3791613">(</span><span class="ident" id="3791614">n</span><span class="op" id="3791615">[</span><span class="num" id="3791616">0</span><span class="op" id="3791617">]</span><span class="op" id="3791618">)</span><span class="op" id="3791619">)</span><span class="op" id="3791620">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3791624">var</span>&nbsp;<span class="ident" id="3791628">x</span><span class="op" id="3791629">,</span>&nbsp;<span class="ident" id="3791631">y</span><span class="op" id="3791632">,</span>&nbsp;<span class="ident" id="3791634">quotient</span>&nbsp;<span class="ident" id="3791643">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3791648">nm3Len</span>&nbsp;<span class="op" id="3791655">:=</span>&nbsp;<span class="ident" id="3791658">nm3</span><span class="op" id="3791661">.</span><span class="ident" id="3791662">bitLen</span><span class="op" id="3791668">(</span><span class="op" id="3791669">)</span><br>
<span class="lineno">1440</span><br>
<span class="lineno"></span><span class="ident" id="3791672">NextRandom</span><span class="op" id="3791682">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3791685">for</span>&nbsp;<span class="ident" id="3791689">i</span>&nbsp;<span class="op" id="3791691">:=</span>&nbsp;<span class="num" id="3791694">0</span><span class="op" id="3791695">;</span>&nbsp;<span class="ident" id="3791697">i</span>&nbsp;<span class="op" id="3791699">&lt;</span>&nbsp;<span class="ident" id="3791701">reps</span><span class="op" id="3791705">;</span>&nbsp;<span class="ident" id="3791707">i</span><span class="op" id="3791708">++</span>&nbsp;<span class="op" id="3791711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3791715">x</span>&nbsp;<span class="op" id="3791717">=</span>&nbsp;<span class="ident" id="3791719">x</span><span class="op" id="3791720">.</span><span class="ident" id="3791721">random</span><span class="op" id="3791727">(</span><span class="ident" id="3791728">rand</span><span class="op" id="3791732">,</span>&nbsp;<span class="ident" id="3791734">nm3</span><span class="op" id="3791737">,</span>&nbsp;<span class="ident" id="3791739">nm3Len</span><span class="op" id="3791745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3791749">x</span>&nbsp;<span class="op" id="3791751">=</span>&nbsp;<span class="ident" id="3791753">x</span><span class="op" id="3791754">.</span><span class="ident" id="3791755">add</span><span class="op" id="3791758">(</span><span class="ident" id="3791759">x</span><span class="op" id="3791760">,</span>&nbsp;<span class="ident" id="3791762">natTwo</span><span class="op" id="3791768">)</span><br>
<span class="lineno">1445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3791772">y</span>&nbsp;<span class="op" id="3791774">=</span>&nbsp;<span class="ident" id="3791776">y</span><span class="op" id="3791777">.</span><span class="ident" id="3791778">expNN</span><span class="op" id="3791783">(</span><span class="ident" id="3791784">x</span><span class="op" id="3791785">,</span>&nbsp;<span class="ident" id="3791787">q</span><span class="op" id="3791788">,</span>&nbsp;<span class="ident" id="3791790">n</span><span class="op" id="3791791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3791795">if</span>&nbsp;<span class="ident" id="3791798">y</span><span class="op" id="3791799">.</span><span class="ident" id="3791800">cmp</span><span class="op" id="3791803">(</span><span class="ident" id="3791804">natOne</span><span class="op" id="3791810">)</span>&nbsp;<span class="op" id="3791812">==</span>&nbsp;<span class="num" id="3791815">0</span>&nbsp;<span class="op" id="3791817">||</span>&nbsp;<span class="ident" id="3791820">y</span><span class="op" id="3791821">.</span><span class="ident" id="3791822">cmp</span><span class="op" id="3791825">(</span><span class="ident" id="3791826">nm1</span><span class="op" id="3791829">)</span>&nbsp;<span class="op" id="3791831">==</span>&nbsp;<span class="num" id="3791834">0</span>&nbsp;<span class="op" id="3791836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3791841">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3791852">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3791856">for</span>&nbsp;<span class="ident" id="3791860">j</span>&nbsp;<span class="op" id="3791862">:=</span>&nbsp;<span class="builtintype" id="3791865">uint</span><span class="op" id="3791869">(</span><span class="num" id="3791870">1</span><span class="op" id="3791871">)</span><span class="op" id="3791872">;</span>&nbsp;<span class="ident" id="3791874">j</span>&nbsp;<span class="op" id="3791876">&lt;</span>&nbsp;<span class="ident" id="3791878">k</span><span class="op" id="3791879">;</span>&nbsp;<span class="ident" id="3791881">j</span><span class="op" id="3791882">++</span>&nbsp;<span class="op" id="3791885">{</span><br>
<span class="lineno">1450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3791890">y</span>&nbsp;<span class="op" id="3791892">=</span>&nbsp;<span class="ident" id="3791894">y</span><span class="op" id="3791895">.</span><span class="ident" id="3791896">mul</span><span class="op" id="3791899">(</span><span class="ident" id="3791900">y</span><span class="op" id="3791901">,</span>&nbsp;<span class="ident" id="3791903">y</span><span class="op" id="3791904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3791909">quotient</span><span class="op" id="3791917">,</span>&nbsp;<span class="ident" id="3791919">y</span>&nbsp;<span class="op" id="3791921">=</span>&nbsp;<span class="ident" id="3791923">quotient</span><span class="op" id="3791931">.</span><span class="ident" id="3791932">div</span><span class="op" id="3791935">(</span><span class="ident" id="3791936">y</span><span class="op" id="3791937">,</span>&nbsp;<span class="ident" id="3791939">y</span><span class="op" id="3791940">,</span>&nbsp;<span class="ident" id="3791942">n</span><span class="op" id="3791943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3791948">if</span>&nbsp;<span class="ident" id="3791951">y</span><span class="op" id="3791952">.</span><span class="ident" id="3791953">cmp</span><span class="op" id="3791956">(</span><span class="ident" id="3791957">nm1</span><span class="op" id="3791960">)</span>&nbsp;<span class="op" id="3791962">==</span>&nbsp;<span class="num" id="3791965">0</span>&nbsp;<span class="op" id="3791967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3791973">continue</span>&nbsp;<span class="ident" id="3791982">NextRandom</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3791996">}</span><br>
<span class="lineno">1455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3792001">if</span>&nbsp;<span class="ident" id="3792004">y</span><span class="op" id="3792005">.</span><span class="ident" id="3792006">cmp</span><span class="op" id="3792009">(</span><span class="ident" id="3792010">natOne</span><span class="op" id="3792016">)</span>&nbsp;<span class="op" id="3792018">==</span>&nbsp;<span class="num" id="3792021">0</span>&nbsp;<span class="op" id="3792023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3792029">return</span>&nbsp;<span class="builtintype" id="3792036">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3792045">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3792049">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3792053">return</span>&nbsp;<span class="builtintype" id="3792060">false</span><br>
<span class="lineno">1460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3792067">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3792071">return</span>&nbsp;<span class="builtintype" id="3792078">true</span><br>
<span class="lineno"></span><span class="op" id="3792083">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1465</span><span class="comment" id="3792086">//&nbsp;bytes&nbsp;writes&nbsp;the&nbsp;value&nbsp;of&nbsp;z&nbsp;into&nbsp;buf&nbsp;using&nbsp;big-endian&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="comment" id="3792153">//&nbsp;len(buf)&nbsp;must&nbsp;be&nbsp;&gt;=&nbsp;len(z)*_S.&nbsp;The&nbsp;value&nbsp;of&nbsp;z&nbsp;is&nbsp;encoded&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3792220">//&nbsp;slice&nbsp;buf[i:].&nbsp;The&nbsp;number&nbsp;i&nbsp;of&nbsp;unused&nbsp;bytes&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3792287">//&nbsp;buf&nbsp;is&nbsp;returned&nbsp;as&nbsp;result.</span><br>
<span class="lineno"></span><span class="keyword" id="3792317">func</span>&nbsp;<span class="op" id="3792322">(</span><span class="ident" id="3792323">z</span>&nbsp;<span class="ident" id="3792325">nat</span><span class="op" id="3792328">)</span>&nbsp;<span class="ident" id="3792330">bytes</span><span class="op" id="3792335">(</span><span class="ident" id="3792336">buf</span>&nbsp;<span class="op" id="3792340">[</span><span class="op" id="3792341">]</span><span class="builtintype" id="3792342">byte</span><span class="op" id="3792346">)</span>&nbsp;<span class="op" id="3792348">(</span><span class="ident" id="3792349">i</span>&nbsp;<span class="builtintype" id="3792351">int</span><span class="op" id="3792354">)</span>&nbsp;<span class="op" id="3792356">{</span><br>
<span class="lineno">1470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3792359">i</span>&nbsp;<span class="op" id="3792361">=</span>&nbsp;<span class="builtinfunc" id="3792363">len</span><span class="op" id="3792366">(</span><span class="ident" id="3792367">buf</span><span class="op" id="3792370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3792373">for</span>&nbsp;<span class="ident" id="3792377">_</span><span class="op" id="3792378">,</span>&nbsp;<span class="ident" id="3792380">d</span>&nbsp;<span class="op" id="3792382">:=</span>&nbsp;<span class="keyword" id="3792385">range</span>&nbsp;<span class="ident" id="3792391">z</span>&nbsp;<span class="op" id="3792393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3792397">for</span>&nbsp;<span class="ident" id="3792401">j</span>&nbsp;<span class="op" id="3792403">:=</span>&nbsp;<span class="num" id="3792406">0</span><span class="op" id="3792407">;</span>&nbsp;<span class="ident" id="3792409">j</span>&nbsp;<span class="op" id="3792411">&lt;</span>&nbsp;<span class="ident" id="3792413">_S</span><span class="op" id="3792415">;</span>&nbsp;<span class="ident" id="3792417">j</span><span class="op" id="3792418">++</span>&nbsp;<span class="op" id="3792421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3792426">i</span><span class="op" id="3792427">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3792433">buf</span><span class="op" id="3792436">[</span><span class="ident" id="3792437">i</span><span class="op" id="3792438">]</span>&nbsp;<span class="op" id="3792440">=</span>&nbsp;<span class="builtintype" id="3792442">byte</span><span class="op" id="3792446">(</span><span class="ident" id="3792447">d</span><span class="op" id="3792448">)</span><br>
<span class="lineno">1475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3792453">d</span>&nbsp;<span class="op" id="3792455">&gt;&gt;=</span>&nbsp;<span class="num" id="3792459">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3792463">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3792466">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3792470">for</span>&nbsp;<span class="ident" id="3792474">i</span>&nbsp;<span class="op" id="3792476">&lt;</span>&nbsp;<span class="builtinfunc" id="3792478">len</span><span class="op" id="3792481">(</span><span class="ident" id="3792482">buf</span><span class="op" id="3792485">)</span>&nbsp;<span class="op" id="3792487">&amp;&amp;</span>&nbsp;<span class="ident" id="3792490">buf</span><span class="op" id="3792493">[</span><span class="ident" id="3792494">i</span><span class="op" id="3792495">]</span>&nbsp;<span class="op" id="3792497">==</span>&nbsp;<span class="num" id="3792500">0</span>&nbsp;<span class="op" id="3792502">{</span><br>
<span class="lineno">1480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3792506">i</span><span class="op" id="3792507">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3792511">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3792515">return</span><br>
<span class="lineno"></span><span class="op" id="3792522">}</span><br>
<span class="lineno">1485</span><br>
<span class="lineno"></span><span class="comment" id="3792525">//&nbsp;setBytes&nbsp;interprets&nbsp;buf&nbsp;as&nbsp;the&nbsp;bytes&nbsp;of&nbsp;a&nbsp;big-endian&nbsp;unsigned</span><br>
<span class="lineno"></span><span class="comment" id="3792590">//&nbsp;integer,&nbsp;sets&nbsp;z&nbsp;to&nbsp;that&nbsp;value,&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="3792639">func</span>&nbsp;<span class="op" id="3792644">(</span><span class="ident" id="3792645">z</span>&nbsp;<span class="ident" id="3792647">nat</span><span class="op" id="3792650">)</span>&nbsp;<span class="ident" id="3792652">setBytes</span><span class="op" id="3792660">(</span><span class="ident" id="3792661">buf</span>&nbsp;<span class="op" id="3792665">[</span><span class="op" id="3792666">]</span><span class="builtintype" id="3792667">byte</span><span class="op" id="3792671">)</span>&nbsp;<span class="ident" id="3792673">nat</span>&nbsp;<span class="op" id="3792677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3792680">z</span>&nbsp;<span class="op" id="3792682">=</span>&nbsp;<span class="ident" id="3792684">z</span><span class="op" id="3792685">.</span><span class="builtinfunc" id="3792686">make</span><span class="op" id="3792690">(</span><span class="op" id="3792691">(</span><span class="builtinfunc" id="3792692">len</span><span class="op" id="3792695">(</span><span class="ident" id="3792696">buf</span><span class="op" id="3792699">)</span>&nbsp;<span class="op" id="3792701">+</span>&nbsp;<span class="ident" id="3792703">_S</span>&nbsp;<span class="op" id="3792706">-</span>&nbsp;<span class="num" id="3792708">1</span><span class="op" id="3792709">)</span>&nbsp;<span class="op" id="3792711">/</span>&nbsp;<span class="ident" id="3792713">_S</span><span class="op" id="3792715">)</span><br>
<span class="lineno">1490</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3792719">k</span>&nbsp;<span class="op" id="3792721">:=</span>&nbsp;<span class="num" id="3792724">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3792727">s</span>&nbsp;<span class="op" id="3792729">:=</span>&nbsp;<span class="builtintype" id="3792732">uint</span><span class="op" id="3792736">(</span><span class="num" id="3792737">0</span><span class="op" id="3792738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3792741">var</span>&nbsp;<span class="ident" id="3792745">d</span>&nbsp;<span class="ident" id="3792747">Word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3792753">for</span>&nbsp;<span class="ident" id="3792757">i</span>&nbsp;<span class="op" id="3792759">:=</span>&nbsp;<span class="builtinfunc" id="3792762">len</span><span class="op" id="3792765">(</span><span class="ident" id="3792766">buf</span><span class="op" id="3792769">)</span><span class="op" id="3792770">;</span>&nbsp;<span class="ident" id="3792772">i</span>&nbsp;<span class="op" id="3792774">&gt;</span>&nbsp;<span class="num" id="3792776">0</span><span class="op" id="3792777">;</span>&nbsp;<span class="ident" id="3792779">i</span><span class="op" id="3792780">--</span>&nbsp;<span class="op" id="3792783">{</span><br>
<span class="lineno">1495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3792787">d</span>&nbsp;<span class="op" id="3792789">|=</span>&nbsp;<span class="ident" id="3792792">Word</span><span class="op" id="3792796">(</span><span class="ident" id="3792797">buf</span><span class="op" id="3792800">[</span><span class="ident" id="3792801">i</span><span class="op" id="3792802">-</span><span class="num" id="3792803">1</span><span class="op" id="3792804">]</span><span class="op" id="3792805">)</span>&nbsp;<span class="op" id="3792807">&lt;&lt;</span>&nbsp;<span class="ident" id="3792810">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3792814">if</span>&nbsp;<span class="ident" id="3792817">s</span>&nbsp;<span class="op" id="3792819">+=</span>&nbsp;<span class="num" id="3792822">8</span><span class="op" id="3792823">;</span>&nbsp;<span class="ident" id="3792825">s</span>&nbsp;<span class="op" id="3792827">==</span>&nbsp;<span class="ident" id="3792830">_S</span><span class="op" id="3792832">*</span><span class="num" id="3792833">8</span>&nbsp;<span class="op" id="3792835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3792840">z</span><span class="op" id="3792841">[</span><span class="ident" id="3792842">k</span><span class="op" id="3792843">]</span>&nbsp;<span class="op" id="3792845">=</span>&nbsp;<span class="ident" id="3792847">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3792852">k</span><span class="op" id="3792853">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3792859">s</span>&nbsp;<span class="op" id="3792861">=</span>&nbsp;<span class="num" id="3792863">0</span><br>
<span class="lineno">1500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3792868">d</span>&nbsp;<span class="op" id="3792870">=</span>&nbsp;<span class="num" id="3792872">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3792876">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3792879">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3792882">if</span>&nbsp;<span class="ident" id="3792885">k</span>&nbsp;<span class="op" id="3792887">&lt;</span>&nbsp;<span class="builtinfunc" id="3792889">len</span><span class="op" id="3792892">(</span><span class="ident" id="3792893">z</span><span class="op" id="3792894">)</span>&nbsp;<span class="op" id="3792896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3792900">z</span><span class="op" id="3792901">[</span><span class="ident" id="3792902">k</span><span class="op" id="3792903">]</span>&nbsp;<span class="op" id="3792905">=</span>&nbsp;<span class="ident" id="3792907">d</span><br>
<span class="lineno">1505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3792910">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3792914">return</span>&nbsp;<span class="ident" id="3792921">z</span><span class="op" id="3792922">.</span><span class="ident" id="3792923">norm</span><span class="op" id="3792927">(</span><span class="op" id="3792928">)</span><br>
<span class="lineno"></span><span class="op" id="3792930">}</span>
</div>
</body>
</html>
