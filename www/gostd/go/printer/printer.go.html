<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/printer</h2>
<ul>
<li><a href="/gostd/go/printer/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/printer/nodes.go.html">nodes.go</a></li>
<li><a href="/gostd/go/printer/performance_test.go.html">performance_test.go</a></li>
<li><a href="/gostd/go/printer/printer.go.html" class="current">printer.go</a></li>
<li><a href="/gostd/go/printer/printer_test.go.html">printer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5066908">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5066963">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5067017">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5067068">//&nbsp;Package&nbsp;printer&nbsp;implements&nbsp;printing&nbsp;of&nbsp;AST&nbsp;nodes.</span><br>
<span class="lineno"></span><span class="keyword" id="5067121">package</span>&nbsp;<span class="ident" id="5067129">printer</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5067138">import</span>&nbsp;<span class="op" id="5067145">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5067148">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5067155">&#34;go/ast&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5067165">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5067177">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5067183">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5067189">&#34;strconv&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5067200">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5067211">&#34;text/tabwriter&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5067229">&#34;unicode&#34;</span><br>
<span class="lineno"></span><span class="op" id="5067239">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="5067242">const</span>&nbsp;<span class="op" id="5067248">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5067251">maxNewlines</span>&nbsp;<span class="op" id="5067263">=</span>&nbsp;<span class="num" id="5067265">2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5067271">//&nbsp;max.&nbsp;number&nbsp;of&nbsp;newlines&nbsp;between&nbsp;source&nbsp;text</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5067319">debug</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5067331">=</span>&nbsp;<span class="builtintype" id="5067333">false</span>&nbsp;<span class="comment" id="5067339">//&nbsp;enable&nbsp;for&nbsp;debugging</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5067364">infinity</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5067376">=</span>&nbsp;<span class="num" id="5067378">1</span>&nbsp;<span class="op" id="5067380">&lt;&lt;</span>&nbsp;<span class="num" id="5067383">30</span><br>
<span class="lineno"></span><span class="op" id="5067386">)</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="5067389">type</span>&nbsp;<span class="ident" id="5067394">whiteSpace</span>&nbsp;<span class="builtintype" id="5067405">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5067411">const</span>&nbsp;<span class="op" id="5067417">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5067420">ignore</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5067429">=</span>&nbsp;<span class="ident" id="5067431">whiteSpace</span><span class="op" id="5067441">(</span><span class="num" id="5067442">0</span><span class="op" id="5067443">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5067446">blank</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5067455">=</span>&nbsp;<span class="ident" id="5067457">whiteSpace</span><span class="op" id="5067467">(</span><span class="string" id="5067468">&#39;&nbsp;&#39;</span><span class="op" id="5067471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5067474">vtab</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5067483">=</span>&nbsp;<span class="ident" id="5067485">whiteSpace</span><span class="op" id="5067495">(</span><span class="string" id="5067496">&#39;\v&#39;</span><span class="op" id="5067500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5067503">newline</span>&nbsp;&nbsp;<span class="op" id="5067512">=</span>&nbsp;<span class="ident" id="5067514">whiteSpace</span><span class="op" id="5067524">(</span><span class="string" id="5067525">&#39;\n&#39;</span><span class="op" id="5067529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5067532">formfeed</span>&nbsp;<span class="op" id="5067541">=</span>&nbsp;<span class="ident" id="5067543">whiteSpace</span><span class="op" id="5067553">(</span><span class="string" id="5067554">&#39;\f&#39;</span><span class="op" id="5067558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5067561">indent</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5067570">=</span>&nbsp;<span class="ident" id="5067572">whiteSpace</span><span class="op" id="5067582">(</span><span class="string" id="5067583">&#39;&gt;&#39;</span><span class="op" id="5067586">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5067589">unindent</span>&nbsp;<span class="op" id="5067598">=</span>&nbsp;<span class="ident" id="5067600">whiteSpace</span><span class="op" id="5067610">(</span><span class="string" id="5067611">&#39;&lt;&#39;</span><span class="op" id="5067614">)</span><br>
<span class="lineno"></span><span class="op" id="5067616">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5067619">//&nbsp;A&nbsp;pmode&nbsp;value&nbsp;represents&nbsp;the&nbsp;current&nbsp;printer&nbsp;mode.</span><br>
<span class="lineno"></span><span class="keyword" id="5067673">type</span>&nbsp;<span class="ident" id="5067678">pmode</span>&nbsp;<span class="builtintype" id="5067684">int</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="5067689">const</span>&nbsp;<span class="op" id="5067695">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5067698">noExtraBlank</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5067715">pmode</span>&nbsp;<span class="op" id="5067721">=</span>&nbsp;<span class="num" id="5067723">1</span>&nbsp;<span class="op" id="5067725">&lt;&lt;</span>&nbsp;<span class="ident" id="5067728">iota</span>&nbsp;<span class="comment" id="5067733">//&nbsp;disables&nbsp;extra&nbsp;blank&nbsp;after&nbsp;/*-style&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5067781">noExtraLinebreak</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5067816">//&nbsp;disables&nbsp;extra&nbsp;line&nbsp;break&nbsp;after&nbsp;/*-style&nbsp;comment</span><br>
<span class="lineno"></span><span class="op" id="5067868">)</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="5067871">type</span>&nbsp;<span class="ident" id="5067876">commentInfo</span>&nbsp;<span class="keyword" id="5067888">struct</span>&nbsp;<span class="op" id="5067895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5067898">cindex</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5067913">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5067931">//&nbsp;current&nbsp;comment&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5067957">comment</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5067972">*</span><span class="ident" id="5067973">ast</span><span class="op" id="5067976">.</span><span class="ident" id="5067977">CommentGroup</span>&nbsp;<span class="comment" id="5067990">//&nbsp;=&nbsp;printer.comments[cindex];&nbsp;or&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5068029">commentOffset</span>&nbsp;&nbsp;<span class="builtintype" id="5068044">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5068062">//&nbsp;=&nbsp;printer.posFor(printer.comments[cindex].List[0].Pos()).Offset;&nbsp;or&nbsp;infinity</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5068143">commentNewline</span>&nbsp;<span class="builtintype" id="5068158">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5068176">//&nbsp;true&nbsp;if&nbsp;the&nbsp;comment&nbsp;group&nbsp;contains&nbsp;newlines</span><br>
<span class="lineno"></span><span class="op" id="5068223">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5068226">type</span>&nbsp;<span class="ident" id="5068231">printer</span>&nbsp;<span class="keyword" id="5068239">struct</span>&nbsp;<span class="op" id="5068246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5068249">//&nbsp;Configuration&nbsp;(does&nbsp;not&nbsp;change&nbsp;after&nbsp;initialization)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5068306">Config</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5068314">fset</span>&nbsp;<span class="op" id="5068319">*</span><span class="ident" id="5068320">token</span><span class="op" id="5068325">.</span><span class="ident" id="5068326">FileSet</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5068336">//&nbsp;Current&nbsp;state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5068354">output</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5068366">[</span><span class="op" id="5068367">]</span><span class="builtintype" id="5068368">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5068379">//&nbsp;raw&nbsp;printer&nbsp;result</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5068402">indent</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5068414">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5068427">//&nbsp;current&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5068451">mode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5068463">pmode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5068476">//&nbsp;current&nbsp;printer&nbsp;mode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5068501">impliedSemi</span>&nbsp;<span class="builtintype" id="5068513">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5068526">//&nbsp;if&nbsp;set,&nbsp;a&nbsp;linebreak&nbsp;implies&nbsp;a&nbsp;semicolon</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5068570">lastTok</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5068582">token</span><span class="op" id="5068587">.</span><span class="ident" id="5068588">Token</span>&nbsp;&nbsp;<span class="comment" id="5068595">//&nbsp;last&nbsp;token&nbsp;printed&nbsp;(token.ILLEGAL&nbsp;if&nbsp;it&#39;s&nbsp;whitespace)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5068653">prevOpen</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5068665">token</span><span class="op" id="5068670">.</span><span class="ident" id="5068671">Token</span>&nbsp;&nbsp;<span class="comment" id="5068678">//&nbsp;previous&nbsp;non-brace&nbsp;&#34;open&#34;&nbsp;token&nbsp;(,&nbsp;[,&nbsp;or&nbsp;token.ILLEGAL</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5068737">wsbuf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5068749">[</span><span class="op" id="5068750">]</span><span class="ident" id="5068751">whiteSpace</span>&nbsp;<span class="comment" id="5068762">//&nbsp;delayed&nbsp;white&nbsp;space</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5068787">//&nbsp;Positions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5068801">//&nbsp;The&nbsp;out&nbsp;position&nbsp;differs&nbsp;from&nbsp;the&nbsp;pos&nbsp;position&nbsp;when&nbsp;the&nbsp;result</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5068868">//&nbsp;formatting&nbsp;differs&nbsp;from&nbsp;the&nbsp;source&nbsp;formatting&nbsp;(in&nbsp;the&nbsp;amount&nbsp;of</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5068936">//&nbsp;white&nbsp;space).&nbsp;If&nbsp;there&#39;s&nbsp;a&nbsp;difference&nbsp;and&nbsp;SourcePos&nbsp;is&nbsp;set&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5069002">//&nbsp;ConfigMode,&nbsp;//line&nbsp;comments&nbsp;are&nbsp;used&nbsp;in&nbsp;the&nbsp;output&nbsp;to&nbsp;restore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5069068">//&nbsp;original&nbsp;source&nbsp;positions&nbsp;for&nbsp;a&nbsp;reader.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5069112">pos</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5069120">token</span><span class="op" id="5069125">.</span><span class="ident" id="5069126">Position</span>&nbsp;<span class="comment" id="5069135">//&nbsp;current&nbsp;position&nbsp;in&nbsp;AST&nbsp;(source)&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5069178">out</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5069186">token</span><span class="op" id="5069191">.</span><span class="ident" id="5069192">Position</span>&nbsp;<span class="comment" id="5069201">//&nbsp;current&nbsp;position&nbsp;in&nbsp;output&nbsp;space</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5069238">last</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5069246">token</span><span class="op" id="5069251">.</span><span class="ident" id="5069252">Position</span>&nbsp;<span class="comment" id="5069261">//&nbsp;value&nbsp;of&nbsp;pos&nbsp;after&nbsp;calling&nbsp;writeString</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5069304">linePtr</span>&nbsp;<span class="op" id="5069312">*</span><span class="builtintype" id="5069313">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5069327">//&nbsp;if&nbsp;set,&nbsp;record&nbsp;out.Line&nbsp;for&nbsp;the&nbsp;next&nbsp;token&nbsp;in&nbsp;*linePtr</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5069387">//&nbsp;The&nbsp;list&nbsp;of&nbsp;all&nbsp;source&nbsp;comments,&nbsp;in&nbsp;order&nbsp;of&nbsp;appearance.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5069448">comments</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5069464">[</span><span class="op" id="5069465">]</span><span class="op" id="5069466">*</span><span class="ident" id="5069467">ast</span><span class="op" id="5069470">.</span><span class="ident" id="5069471">CommentGroup</span>&nbsp;<span class="comment" id="5069484">//&nbsp;may&nbsp;be&nbsp;nil</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5069499">useNodeComments</span>&nbsp;<span class="builtintype" id="5069515">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5069535">//&nbsp;if&nbsp;not&nbsp;set,&nbsp;ignore&nbsp;lead&nbsp;and&nbsp;line&nbsp;comments&nbsp;of&nbsp;nodes</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5069591">//&nbsp;Information&nbsp;about&nbsp;p.comments[p.cindex];&nbsp;set&nbsp;up&nbsp;by&nbsp;nextComment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5069658">commentInfo</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5069672">//&nbsp;Cache&nbsp;of&nbsp;already&nbsp;computed&nbsp;node&nbsp;sizes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5069714">nodeSizes</span>&nbsp;<span class="keyword" id="5069724">map</span><span class="op" id="5069727">[</span><span class="ident" id="5069728">ast</span><span class="op" id="5069731">.</span><span class="ident" id="5069732">Node</span><span class="op" id="5069736">]</span><span class="builtintype" id="5069737">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5069743">//&nbsp;Cache&nbsp;of&nbsp;most&nbsp;recently&nbsp;computed&nbsp;line&nbsp;position.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5069794">cachedPos</span>&nbsp;&nbsp;<span class="ident" id="5069805">token</span><span class="op" id="5069810">.</span><span class="ident" id="5069811">Pos</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5069816">cachedLine</span>&nbsp;<span class="builtintype" id="5069827">int</span>&nbsp;<span class="comment" id="5069831">//&nbsp;line&nbsp;corresponding&nbsp;to&nbsp;cachedPos</span><br>
<span class="lineno"></span><span class="op" id="5069866">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5069869">func</span>&nbsp;<span class="op" id="5069874">(</span><span class="ident" id="5069875">p</span>&nbsp;<span class="op" id="5069877">*</span><span class="ident" id="5069878">printer</span><span class="op" id="5069885">)</span>&nbsp;<span class="ident" id="5069887">init</span><span class="op" id="5069891">(</span><span class="ident" id="5069892">cfg</span>&nbsp;<span class="op" id="5069896">*</span><span class="ident" id="5069897">Config</span><span class="op" id="5069903">,</span>&nbsp;<span class="ident" id="5069905">fset</span>&nbsp;<span class="op" id="5069910">*</span><span class="ident" id="5069911">token</span><span class="op" id="5069916">.</span><span class="ident" id="5069917">FileSet</span><span class="op" id="5069924">,</span>&nbsp;<span class="ident" id="5069926">nodeSizes</span>&nbsp;<span class="keyword" id="5069936">map</span><span class="op" id="5069939">[</span><span class="ident" id="5069940">ast</span><span class="op" id="5069943">.</span><span class="ident" id="5069944">Node</span><span class="op" id="5069948">]</span><span class="builtintype" id="5069949">int</span><span class="op" id="5069952">)</span>&nbsp;<span class="op" id="5069954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5069957">p</span><span class="op" id="5069958">.</span><span class="ident" id="5069959">Config</span>&nbsp;<span class="op" id="5069966">=</span>&nbsp;<span class="op" id="5069968">*</span><span class="ident" id="5069969">cfg</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5069974">p</span><span class="op" id="5069975">.</span><span class="ident" id="5069976">fset</span>&nbsp;<span class="op" id="5069981">=</span>&nbsp;<span class="ident" id="5069983">fset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5069989">p</span><span class="op" id="5069990">.</span><span class="ident" id="5069991">pos</span>&nbsp;<span class="op" id="5069995">=</span>&nbsp;<span class="ident" id="5069997">token</span><span class="op" id="5070002">.</span><span class="ident" id="5070003">Position</span><span class="op" id="5070011">{</span><span class="ident" id="5070012">Line</span><span class="op" id="5070016">:</span>&nbsp;<span class="num" id="5070018">1</span><span class="op" id="5070019">,</span>&nbsp;<span class="ident" id="5070021">Column</span><span class="op" id="5070027">:</span>&nbsp;<span class="num" id="5070029">1</span><span class="op" id="5070030">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5070033">p</span><span class="op" id="5070034">.</span><span class="ident" id="5070035">out</span>&nbsp;<span class="op" id="5070039">=</span>&nbsp;<span class="ident" id="5070041">token</span><span class="op" id="5070046">.</span><span class="ident" id="5070047">Position</span><span class="op" id="5070055">{</span><span class="ident" id="5070056">Line</span><span class="op" id="5070060">:</span>&nbsp;<span class="num" id="5070062">1</span><span class="op" id="5070063">,</span>&nbsp;<span class="ident" id="5070065">Column</span><span class="op" id="5070071">:</span>&nbsp;<span class="num" id="5070073">1</span><span class="op" id="5070074">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5070077">p</span><span class="op" id="5070078">.</span><span class="ident" id="5070079">wsbuf</span>&nbsp;<span class="op" id="5070085">=</span>&nbsp;<span class="builtinfunc" id="5070087">make</span><span class="op" id="5070091">(</span><span class="op" id="5070092">[</span><span class="op" id="5070093">]</span><span class="ident" id="5070094">whiteSpace</span><span class="op" id="5070104">,</span>&nbsp;<span class="num" id="5070106">0</span><span class="op" id="5070107">,</span>&nbsp;<span class="num" id="5070109">16</span><span class="op" id="5070111">)</span>&nbsp;<span class="comment" id="5070113">//&nbsp;whitespace&nbsp;sequences&nbsp;are&nbsp;short</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5070148">p</span><span class="op" id="5070149">.</span><span class="ident" id="5070150">nodeSizes</span>&nbsp;<span class="op" id="5070160">=</span>&nbsp;<span class="ident" id="5070162">nodeSizes</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5070173">p</span><span class="op" id="5070174">.</span><span class="ident" id="5070175">cachedPos</span>&nbsp;<span class="op" id="5070185">=</span>&nbsp;<span class="op" id="5070187">-</span><span class="num" id="5070188">1</span><br>
<span class="lineno"></span><span class="op" id="5070190">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5070193">func</span>&nbsp;<span class="op" id="5070198">(</span><span class="ident" id="5070199">p</span>&nbsp;<span class="op" id="5070201">*</span><span class="ident" id="5070202">printer</span><span class="op" id="5070209">)</span>&nbsp;<span class="ident" id="5070211">internalError</span><span class="op" id="5070224">(</span><span class="ident" id="5070225">msg</span>&nbsp;<span class="op" id="5070229">...</span><span class="keyword" id="5070232">interface</span><span class="op" id="5070241">{</span><span class="op" id="5070242">}</span><span class="op" id="5070243">)</span>&nbsp;<span class="op" id="5070245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5070248">if</span>&nbsp;<span class="ident" id="5070251">debug</span>&nbsp;<span class="op" id="5070257">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5070261">fmt</span><span class="op" id="5070264">.</span><span class="ident" id="5070265">Print</span><span class="op" id="5070270">(</span><span class="ident" id="5070271">p</span><span class="op" id="5070272">.</span><span class="ident" id="5070273">pos</span><span class="op" id="5070276">.</span><span class="ident" id="5070277">String</span><span class="op" id="5070283">(</span><span class="op" id="5070284">)</span>&nbsp;<span class="op" id="5070286">+</span>&nbsp;<span class="string" id="5070288">&#34;:&nbsp;&#34;</span><span class="op" id="5070292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5070296">fmt</span><span class="op" id="5070299">.</span><span class="ident" id="5070300">Println</span><span class="op" id="5070307">(</span><span class="ident" id="5070308">msg</span><span class="op" id="5070311">...</span><span class="op" id="5070314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5070318">panic</span><span class="op" id="5070323">(</span><span class="string" id="5070324">&#34;go/printer&#34;</span><span class="op" id="5070336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5070339">}</span><br>
<span class="lineno"></span><span class="op" id="5070341">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="comment" id="5070344">//&nbsp;commentsHaveNewline&nbsp;reports&nbsp;whether&nbsp;a&nbsp;list&nbsp;of&nbsp;comments&nbsp;belonging&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5070415">//&nbsp;an&nbsp;*ast.CommentGroup&nbsp;contains&nbsp;newlines.&nbsp;Because&nbsp;the&nbsp;position&nbsp;information</span><br>
<span class="lineno"></span><span class="comment" id="5070491">//&nbsp;may&nbsp;only&nbsp;be&nbsp;partially&nbsp;correct,&nbsp;we&nbsp;also&nbsp;have&nbsp;to&nbsp;read&nbsp;the&nbsp;comment&nbsp;text.</span><br>
<span class="lineno"></span><span class="keyword" id="5070564">func</span>&nbsp;<span class="op" id="5070569">(</span><span class="ident" id="5070570">p</span>&nbsp;<span class="op" id="5070572">*</span><span class="ident" id="5070573">printer</span><span class="op" id="5070580">)</span>&nbsp;<span class="ident" id="5070582">commentsHaveNewline</span><span class="op" id="5070601">(</span><span class="ident" id="5070602">list</span>&nbsp;<span class="op" id="5070607">[</span><span class="op" id="5070608">]</span><span class="op" id="5070609">*</span><span class="ident" id="5070610">ast</span><span class="op" id="5070613">.</span><span class="ident" id="5070614">Comment</span><span class="op" id="5070621">)</span>&nbsp;<span class="builtintype" id="5070623">bool</span>&nbsp;<span class="op" id="5070628">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5070631">//&nbsp;len(list)&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5070649">line</span>&nbsp;<span class="op" id="5070654">:=</span>&nbsp;<span class="ident" id="5070657">p</span><span class="op" id="5070658">.</span><span class="ident" id="5070659">lineFor</span><span class="op" id="5070666">(</span><span class="ident" id="5070667">list</span><span class="op" id="5070671">[</span><span class="num" id="5070672">0</span><span class="op" id="5070673">]</span><span class="op" id="5070674">.</span><span class="ident" id="5070675">Pos</span><span class="op" id="5070678">(</span><span class="op" id="5070679">)</span><span class="op" id="5070680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5070683">for</span>&nbsp;<span class="ident" id="5070687">i</span><span class="op" id="5070688">,</span>&nbsp;<span class="ident" id="5070690">c</span>&nbsp;<span class="op" id="5070692">:=</span>&nbsp;<span class="keyword" id="5070695">range</span>&nbsp;<span class="ident" id="5070701">list</span>&nbsp;<span class="op" id="5070706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5070710">if</span>&nbsp;<span class="ident" id="5070713">i</span>&nbsp;<span class="op" id="5070715">&gt;</span>&nbsp;<span class="num" id="5070717">0</span>&nbsp;<span class="op" id="5070719">&amp;&amp;</span>&nbsp;<span class="ident" id="5070722">p</span><span class="op" id="5070723">.</span><span class="ident" id="5070724">lineFor</span><span class="op" id="5070731">(</span><span class="ident" id="5070732">list</span><span class="op" id="5070736">[</span><span class="ident" id="5070737">i</span><span class="op" id="5070738">]</span><span class="op" id="5070739">.</span><span class="ident" id="5070740">Pos</span><span class="op" id="5070743">(</span><span class="op" id="5070744">)</span><span class="op" id="5070745">)</span>&nbsp;<span class="op" id="5070747">!=</span>&nbsp;<span class="ident" id="5070750">line</span>&nbsp;<span class="op" id="5070755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5070760">//&nbsp;not&nbsp;all&nbsp;comments&nbsp;on&nbsp;the&nbsp;same&nbsp;line</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5070800">return</span>&nbsp;<span class="builtintype" id="5070807">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5070814">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5070818">if</span>&nbsp;<span class="ident" id="5070821">t</span>&nbsp;<span class="op" id="5070823">:=</span>&nbsp;<span class="ident" id="5070826">c</span><span class="op" id="5070827">.</span><span class="ident" id="5070828">Text</span><span class="op" id="5070832">;</span>&nbsp;<span class="builtinfunc" id="5070834">len</span><span class="op" id="5070837">(</span><span class="ident" id="5070838">t</span><span class="op" id="5070839">)</span>&nbsp;<span class="op" id="5070841">&gt;=</span>&nbsp;<span class="num" id="5070844">2</span>&nbsp;<span class="op" id="5070846">&amp;&amp;</span>&nbsp;<span class="op" id="5070849">(</span><span class="ident" id="5070850">t</span><span class="op" id="5070851">[</span><span class="num" id="5070852">1</span><span class="op" id="5070853">]</span>&nbsp;<span class="op" id="5070855">==</span>&nbsp;<span class="string" id="5070858">&#39;/&#39;</span>&nbsp;<span class="op" id="5070862">||</span>&nbsp;<span class="ident" id="5070865">strings</span><span class="op" id="5070872">.</span><span class="ident" id="5070873">Contains</span><span class="op" id="5070881">(</span><span class="ident" id="5070882">t</span><span class="op" id="5070883">,</span>&nbsp;<span class="string" id="5070885">&#34;\n&#34;</span><span class="op" id="5070889">)</span><span class="op" id="5070890">)</span>&nbsp;<span class="op" id="5070892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5070897">return</span>&nbsp;<span class="builtintype" id="5070904">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5070911">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5070914">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5070917">_</span>&nbsp;<span class="op" id="5070919">=</span>&nbsp;<span class="ident" id="5070921">line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5070927">return</span>&nbsp;<span class="builtintype" id="5070934">false</span><br>
<span class="lineno"></span><span class="op" id="5070940">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="5070943">func</span>&nbsp;<span class="op" id="5070948">(</span><span class="ident" id="5070949">p</span>&nbsp;<span class="op" id="5070951">*</span><span class="ident" id="5070952">printer</span><span class="op" id="5070959">)</span>&nbsp;<span class="ident" id="5070961">nextComment</span><span class="op" id="5070972">(</span><span class="op" id="5070973">)</span>&nbsp;<span class="op" id="5070975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5070978">for</span>&nbsp;<span class="ident" id="5070982">p</span><span class="op" id="5070983">.</span><span class="ident" id="5070984">cindex</span>&nbsp;<span class="op" id="5070991">&lt;</span>&nbsp;<span class="builtinfunc" id="5070993">len</span><span class="op" id="5070996">(</span><span class="ident" id="5070997">p</span><span class="op" id="5070998">.</span><span class="ident" id="5070999">comments</span><span class="op" id="5071007">)</span>&nbsp;<span class="op" id="5071009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5071013">c</span>&nbsp;<span class="op" id="5071015">:=</span>&nbsp;<span class="ident" id="5071018">p</span><span class="op" id="5071019">.</span><span class="ident" id="5071020">comments</span><span class="op" id="5071028">[</span><span class="ident" id="5071029">p</span><span class="op" id="5071030">.</span><span class="ident" id="5071031">cindex</span><span class="op" id="5071037">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5071041">p</span><span class="op" id="5071042">.</span><span class="ident" id="5071043">cindex</span><span class="op" id="5071049">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5071054">if</span>&nbsp;<span class="ident" id="5071057">list</span>&nbsp;<span class="op" id="5071062">:=</span>&nbsp;<span class="ident" id="5071065">c</span><span class="op" id="5071066">.</span><span class="ident" id="5071067">List</span><span class="op" id="5071071">;</span>&nbsp;<span class="builtinfunc" id="5071073">len</span><span class="op" id="5071076">(</span><span class="ident" id="5071077">list</span><span class="op" id="5071081">)</span>&nbsp;<span class="op" id="5071083">&gt;</span>&nbsp;<span class="num" id="5071085">0</span>&nbsp;<span class="op" id="5071087">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5071092">p</span><span class="op" id="5071093">.</span><span class="ident" id="5071094">comment</span>&nbsp;<span class="op" id="5071102">=</span>&nbsp;<span class="ident" id="5071104">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5071109">p</span><span class="op" id="5071110">.</span><span class="ident" id="5071111">commentOffset</span>&nbsp;<span class="op" id="5071125">=</span>&nbsp;<span class="ident" id="5071127">p</span><span class="op" id="5071128">.</span><span class="ident" id="5071129">posFor</span><span class="op" id="5071135">(</span><span class="ident" id="5071136">list</span><span class="op" id="5071140">[</span><span class="num" id="5071141">0</span><span class="op" id="5071142">]</span><span class="op" id="5071143">.</span><span class="ident" id="5071144">Pos</span><span class="op" id="5071147">(</span><span class="op" id="5071148">)</span><span class="op" id="5071149">)</span><span class="op" id="5071150">.</span><span class="ident" id="5071151">Offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5071161">p</span><span class="op" id="5071162">.</span><span class="ident" id="5071163">commentNewline</span>&nbsp;<span class="op" id="5071178">=</span>&nbsp;<span class="ident" id="5071180">p</span><span class="op" id="5071181">.</span><span class="ident" id="5071182">commentsHaveNewline</span><span class="op" id="5071201">(</span><span class="ident" id="5071202">list</span><span class="op" id="5071206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5071211">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5071220">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5071224">//&nbsp;we&nbsp;should&nbsp;not&nbsp;reach&nbsp;here&nbsp;(correct&nbsp;ASTs&nbsp;don&#39;t&nbsp;have&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5071285">//&nbsp;ast.CommentGroup&nbsp;nodes),&nbsp;but&nbsp;be&nbsp;conservative&nbsp;and&nbsp;try&nbsp;again</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5071348">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5071351">//&nbsp;no&nbsp;more&nbsp;comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5071372">p</span><span class="op" id="5071373">.</span><span class="ident" id="5071374">commentOffset</span>&nbsp;<span class="op" id="5071388">=</span>&nbsp;<span class="ident" id="5071390">infinity</span><br>
<span class="lineno">145</span><span class="op" id="5071399">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5071402">//&nbsp;commentBefore&nbsp;returns&nbsp;true&nbsp;iff&nbsp;the&nbsp;current&nbsp;comment&nbsp;group&nbsp;occurs</span><br>
<span class="lineno"></span><span class="comment" id="5071469">//&nbsp;before&nbsp;the&nbsp;next&nbsp;position&nbsp;in&nbsp;the&nbsp;source&nbsp;code&nbsp;and&nbsp;printing&nbsp;it&nbsp;does</span><br>
<span class="lineno"></span><span class="comment" id="5071537">//&nbsp;not&nbsp;introduce&nbsp;implicit&nbsp;semicolons.</span><br>
<span class="lineno">150</span><span class="comment" id="5071575">//</span><br>
<span class="lineno"></span><span class="keyword" id="5071578">func</span>&nbsp;<span class="op" id="5071583">(</span><span class="ident" id="5071584">p</span>&nbsp;<span class="op" id="5071586">*</span><span class="ident" id="5071587">printer</span><span class="op" id="5071594">)</span>&nbsp;<span class="ident" id="5071596">commentBefore</span><span class="op" id="5071609">(</span><span class="ident" id="5071610">next</span>&nbsp;<span class="ident" id="5071615">token</span><span class="op" id="5071620">.</span><span class="ident" id="5071621">Position</span><span class="op" id="5071629">)</span>&nbsp;<span class="builtintype" id="5071631">bool</span>&nbsp;<span class="op" id="5071636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5071639">return</span>&nbsp;<span class="ident" id="5071646">p</span><span class="op" id="5071647">.</span><span class="ident" id="5071648">commentOffset</span>&nbsp;<span class="op" id="5071662">&lt;</span>&nbsp;<span class="ident" id="5071664">next</span><span class="op" id="5071668">.</span><span class="ident" id="5071669">Offset</span>&nbsp;<span class="op" id="5071676">&amp;&amp;</span>&nbsp;<span class="op" id="5071679">(</span><span class="op" id="5071680">!</span><span class="ident" id="5071681">p</span><span class="op" id="5071682">.</span><span class="ident" id="5071683">impliedSemi</span>&nbsp;<span class="op" id="5071695">||</span>&nbsp;<span class="op" id="5071698">!</span><span class="ident" id="5071699">p</span><span class="op" id="5071700">.</span><span class="ident" id="5071701">commentNewline</span><span class="op" id="5071715">)</span><br>
<span class="lineno"></span><span class="op" id="5071717">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span><span class="comment" id="5071720">//&nbsp;commentSizeBefore&nbsp;returns&nbsp;the&nbsp;estimated&nbsp;size&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5071775">//&nbsp;comments&nbsp;on&nbsp;the&nbsp;same&nbsp;line&nbsp;before&nbsp;the&nbsp;next&nbsp;position.</span><br>
<span class="lineno"></span><span class="comment" id="5071830">//</span><br>
<span class="lineno"></span><span class="keyword" id="5071833">func</span>&nbsp;<span class="op" id="5071838">(</span><span class="ident" id="5071839">p</span>&nbsp;<span class="op" id="5071841">*</span><span class="ident" id="5071842">printer</span><span class="op" id="5071849">)</span>&nbsp;<span class="ident" id="5071851">commentSizeBefore</span><span class="op" id="5071868">(</span><span class="ident" id="5071869">next</span>&nbsp;<span class="ident" id="5071874">token</span><span class="op" id="5071879">.</span><span class="ident" id="5071880">Position</span><span class="op" id="5071888">)</span>&nbsp;<span class="builtintype" id="5071890">int</span>&nbsp;<span class="op" id="5071894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5071897">//&nbsp;save/restore&nbsp;current&nbsp;p.commentInfo&nbsp;(p.nextComment()&nbsp;modifies&nbsp;it)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5071966">defer</span>&nbsp;<span class="keyword" id="5071972">func</span><span class="op" id="5071976">(</span><span class="ident" id="5071977">info</span>&nbsp;<span class="ident" id="5071982">commentInfo</span><span class="op" id="5071993">)</span>&nbsp;<span class="op" id="5071995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5071999">p</span><span class="op" id="5072000">.</span><span class="ident" id="5072001">commentInfo</span>&nbsp;<span class="op" id="5072013">=</span>&nbsp;<span class="ident" id="5072015">info</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5072021">}</span><span class="op" id="5072022">(</span><span class="ident" id="5072023">p</span><span class="op" id="5072024">.</span><span class="ident" id="5072025">commentInfo</span><span class="op" id="5072036">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5072040">size</span>&nbsp;<span class="op" id="5072045">:=</span>&nbsp;<span class="num" id="5072048">0</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5072051">for</span>&nbsp;<span class="ident" id="5072055">p</span><span class="op" id="5072056">.</span><span class="ident" id="5072057">commentBefore</span><span class="op" id="5072070">(</span><span class="ident" id="5072071">next</span><span class="op" id="5072075">)</span>&nbsp;<span class="op" id="5072077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5072081">for</span>&nbsp;<span class="ident" id="5072085">_</span><span class="op" id="5072086">,</span>&nbsp;<span class="ident" id="5072088">c</span>&nbsp;<span class="op" id="5072090">:=</span>&nbsp;<span class="keyword" id="5072093">range</span>&nbsp;<span class="ident" id="5072099">p</span><span class="op" id="5072100">.</span><span class="ident" id="5072101">comment</span><span class="op" id="5072108">.</span><span class="ident" id="5072109">List</span>&nbsp;<span class="op" id="5072114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5072119">size</span>&nbsp;<span class="op" id="5072124">+=</span>&nbsp;<span class="builtinfunc" id="5072127">len</span><span class="op" id="5072130">(</span><span class="ident" id="5072131">c</span><span class="op" id="5072132">.</span><span class="ident" id="5072133">Text</span><span class="op" id="5072137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5072141">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5072145">p</span><span class="op" id="5072146">.</span><span class="ident" id="5072147">nextComment</span><span class="op" id="5072158">(</span><span class="op" id="5072159">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5072162">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5072165">return</span>&nbsp;<span class="ident" id="5072172">size</span><br>
<span class="lineno"></span><span class="op" id="5072177">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5072180">//&nbsp;recordLine&nbsp;records&nbsp;the&nbsp;output&nbsp;line&nbsp;number&nbsp;for&nbsp;the&nbsp;next&nbsp;non-whitespace</span><br>
<span class="lineno">175</span><span class="comment" id="5072253">//&nbsp;token&nbsp;in&nbsp;*linePtr.&nbsp;It&nbsp;is&nbsp;used&nbsp;to&nbsp;compute&nbsp;an&nbsp;accurate&nbsp;line&nbsp;number&nbsp;for&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5072327">//&nbsp;formatted&nbsp;construct,&nbsp;independent&nbsp;of&nbsp;pending&nbsp;(not&nbsp;yet&nbsp;emitted)&nbsp;whitespace</span><br>
<span class="lineno"></span><span class="comment" id="5072403">//&nbsp;or&nbsp;comments.</span><br>
<span class="lineno"></span><span class="comment" id="5072419">//</span><br>
<span class="lineno"></span><span class="keyword" id="5072422">func</span>&nbsp;<span class="op" id="5072427">(</span><span class="ident" id="5072428">p</span>&nbsp;<span class="op" id="5072430">*</span><span class="ident" id="5072431">printer</span><span class="op" id="5072438">)</span>&nbsp;<span class="ident" id="5072440">recordLine</span><span class="op" id="5072450">(</span><span class="ident" id="5072451">linePtr</span>&nbsp;<span class="op" id="5072459">*</span><span class="builtintype" id="5072460">int</span><span class="op" id="5072463">)</span>&nbsp;<span class="op" id="5072465">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5072468">p</span><span class="op" id="5072469">.</span><span class="ident" id="5072470">linePtr</span>&nbsp;<span class="op" id="5072478">=</span>&nbsp;<span class="ident" id="5072480">linePtr</span><br>
<span class="lineno"></span><span class="op" id="5072488">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5072491">//&nbsp;linesFrom&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;output&nbsp;lines&nbsp;between&nbsp;the&nbsp;current</span><br>
<span class="lineno"></span><span class="comment" id="5072559">//&nbsp;output&nbsp;line&nbsp;and&nbsp;the&nbsp;line&nbsp;argument,&nbsp;ignoring&nbsp;any&nbsp;pending&nbsp;(not&nbsp;yet</span><br>
<span class="lineno">185</span><span class="comment" id="5072627">//&nbsp;emitted)&nbsp;whitespace&nbsp;or&nbsp;comments.&nbsp;It&nbsp;is&nbsp;used&nbsp;to&nbsp;compute&nbsp;an&nbsp;accurate</span><br>
<span class="lineno"></span><span class="comment" id="5072697">//&nbsp;size&nbsp;(in&nbsp;number&nbsp;of&nbsp;lines)&nbsp;for&nbsp;a&nbsp;formatted&nbsp;construct.</span><br>
<span class="lineno"></span><span class="comment" id="5072753">//</span><br>
<span class="lineno"></span><span class="keyword" id="5072756">func</span>&nbsp;<span class="op" id="5072761">(</span><span class="ident" id="5072762">p</span>&nbsp;<span class="op" id="5072764">*</span><span class="ident" id="5072765">printer</span><span class="op" id="5072772">)</span>&nbsp;<span class="ident" id="5072774">linesFrom</span><span class="op" id="5072783">(</span><span class="ident" id="5072784">line</span>&nbsp;<span class="builtintype" id="5072789">int</span><span class="op" id="5072792">)</span>&nbsp;<span class="builtintype" id="5072794">int</span>&nbsp;<span class="op" id="5072798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5072801">return</span>&nbsp;<span class="ident" id="5072808">p</span><span class="op" id="5072809">.</span><span class="ident" id="5072810">out</span><span class="op" id="5072813">.</span><span class="ident" id="5072814">Line</span>&nbsp;<span class="op" id="5072819">-</span>&nbsp;<span class="ident" id="5072821">line</span><br>
<span class="lineno">190</span><span class="op" id="5072826">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5072829">func</span>&nbsp;<span class="op" id="5072834">(</span><span class="ident" id="5072835">p</span>&nbsp;<span class="op" id="5072837">*</span><span class="ident" id="5072838">printer</span><span class="op" id="5072845">)</span>&nbsp;<span class="ident" id="5072847">posFor</span><span class="op" id="5072853">(</span><span class="ident" id="5072854">pos</span>&nbsp;<span class="ident" id="5072858">token</span><span class="op" id="5072863">.</span><span class="ident" id="5072864">Pos</span><span class="op" id="5072867">)</span>&nbsp;<span class="ident" id="5072869">token</span><span class="op" id="5072874">.</span><span class="ident" id="5072875">Position</span>&nbsp;<span class="op" id="5072884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5072887">//&nbsp;not&nbsp;used&nbsp;frequently&nbsp;enough&nbsp;to&nbsp;cache&nbsp;entire&nbsp;token.Position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5072949">return</span>&nbsp;<span class="ident" id="5072956">p</span><span class="op" id="5072957">.</span><span class="ident" id="5072958">fset</span><span class="op" id="5072962">.</span><span class="ident" id="5072963">Position</span><span class="op" id="5072971">(</span><span class="ident" id="5072972">pos</span><span class="op" id="5072975">)</span><br>
<span class="lineno">195</span><span class="op" id="5072977">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5072980">func</span>&nbsp;<span class="op" id="5072985">(</span><span class="ident" id="5072986">p</span>&nbsp;<span class="op" id="5072988">*</span><span class="ident" id="5072989">printer</span><span class="op" id="5072996">)</span>&nbsp;<span class="ident" id="5072998">lineFor</span><span class="op" id="5073005">(</span><span class="ident" id="5073006">pos</span>&nbsp;<span class="ident" id="5073010">token</span><span class="op" id="5073015">.</span><span class="ident" id="5073016">Pos</span><span class="op" id="5073019">)</span>&nbsp;<span class="builtintype" id="5073021">int</span>&nbsp;<span class="op" id="5073025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5073028">if</span>&nbsp;<span class="ident" id="5073031">pos</span>&nbsp;<span class="op" id="5073035">!=</span>&nbsp;<span class="ident" id="5073038">p</span><span class="op" id="5073039">.</span><span class="ident" id="5073040">cachedPos</span>&nbsp;<span class="op" id="5073050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5073054">p</span><span class="op" id="5073055">.</span><span class="ident" id="5073056">cachedPos</span>&nbsp;<span class="op" id="5073066">=</span>&nbsp;<span class="ident" id="5073068">pos</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5073074">p</span><span class="op" id="5073075">.</span><span class="ident" id="5073076">cachedLine</span>&nbsp;<span class="op" id="5073087">=</span>&nbsp;<span class="ident" id="5073089">p</span><span class="op" id="5073090">.</span><span class="ident" id="5073091">fset</span><span class="op" id="5073095">.</span><span class="ident" id="5073096">Position</span><span class="op" id="5073104">(</span><span class="ident" id="5073105">pos</span><span class="op" id="5073108">)</span><span class="op" id="5073109">.</span><span class="ident" id="5073110">Line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5073116">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5073119">return</span>&nbsp;<span class="ident" id="5073126">p</span><span class="op" id="5073127">.</span><span class="ident" id="5073128">cachedLine</span><br>
<span class="lineno"></span><span class="op" id="5073139">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="comment" id="5073142">//&nbsp;atLineBegin&nbsp;emits&nbsp;a&nbsp;//line&nbsp;comment&nbsp;if&nbsp;necessary&nbsp;and&nbsp;prints&nbsp;indentation.</span><br>
<span class="lineno"></span><span class="keyword" id="5073217">func</span>&nbsp;<span class="op" id="5073222">(</span><span class="ident" id="5073223">p</span>&nbsp;<span class="op" id="5073225">*</span><span class="ident" id="5073226">printer</span><span class="op" id="5073233">)</span>&nbsp;<span class="ident" id="5073235">atLineBegin</span><span class="op" id="5073246">(</span><span class="ident" id="5073247">pos</span>&nbsp;<span class="ident" id="5073251">token</span><span class="op" id="5073256">.</span><span class="ident" id="5073257">Position</span><span class="op" id="5073265">)</span>&nbsp;<span class="op" id="5073267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5073270">//&nbsp;write&nbsp;a&nbsp;//line&nbsp;comment&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5073310">if</span>&nbsp;<span class="ident" id="5073313">p</span><span class="op" id="5073314">.</span><span class="ident" id="5073315">Config</span><span class="op" id="5073321">.</span><span class="ident" id="5073322">Mode</span><span class="op" id="5073326">&amp;</span><span class="ident" id="5073327">SourcePos</span>&nbsp;<span class="op" id="5073337">!=</span>&nbsp;<span class="num" id="5073340">0</span>&nbsp;<span class="op" id="5073342">&amp;&amp;</span>&nbsp;<span class="ident" id="5073345">pos</span><span class="op" id="5073348">.</span><span class="ident" id="5073349">IsValid</span><span class="op" id="5073356">(</span><span class="op" id="5073357">)</span>&nbsp;<span class="op" id="5073359">&amp;&amp;</span>&nbsp;<span class="op" id="5073362">(</span><span class="ident" id="5073363">p</span><span class="op" id="5073364">.</span><span class="ident" id="5073365">out</span><span class="op" id="5073368">.</span><span class="ident" id="5073369">Line</span>&nbsp;<span class="op" id="5073374">!=</span>&nbsp;<span class="ident" id="5073377">pos</span><span class="op" id="5073380">.</span><span class="ident" id="5073381">Line</span>&nbsp;<span class="op" id="5073386">||</span>&nbsp;<span class="ident" id="5073389">p</span><span class="op" id="5073390">.</span><span class="ident" id="5073391">out</span><span class="op" id="5073394">.</span><span class="ident" id="5073395">Filename</span>&nbsp;<span class="op" id="5073404">!=</span>&nbsp;<span class="ident" id="5073407">pos</span><span class="op" id="5073410">.</span><span class="ident" id="5073411">Filename</span><span class="op" id="5073419">)</span>&nbsp;<span class="op" id="5073421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5073425">p</span><span class="op" id="5073426">.</span><span class="ident" id="5073427">output</span>&nbsp;<span class="op" id="5073434">=</span>&nbsp;<span class="builtinfunc" id="5073436">append</span><span class="op" id="5073442">(</span><span class="ident" id="5073443">p</span><span class="op" id="5073444">.</span><span class="ident" id="5073445">output</span><span class="op" id="5073451">,</span>&nbsp;<span class="ident" id="5073453">tabwriter</span><span class="op" id="5073462">.</span><span class="ident" id="5073463">Escape</span><span class="op" id="5073469">)</span>&nbsp;<span class="comment" id="5073471">//&nbsp;protect&nbsp;&#39;\n&#39;&nbsp;in&nbsp;//line&nbsp;from&nbsp;tabwriter&nbsp;interpretation</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5073529">p</span><span class="op" id="5073530">.</span><span class="ident" id="5073531">output</span>&nbsp;<span class="op" id="5073538">=</span>&nbsp;<span class="builtinfunc" id="5073540">append</span><span class="op" id="5073546">(</span><span class="ident" id="5073547">p</span><span class="op" id="5073548">.</span><span class="ident" id="5073549">output</span><span class="op" id="5073555">,</span>&nbsp;<span class="ident" id="5073557">fmt</span><span class="op" id="5073560">.</span><span class="ident" id="5073561">Sprintf</span><span class="op" id="5073568">(</span><span class="string" id="5073569">&#34;//line&nbsp;%s:%d\n&#34;</span><span class="op" id="5073585">,</span>&nbsp;<span class="ident" id="5073587">pos</span><span class="op" id="5073590">.</span><span class="ident" id="5073591">Filename</span><span class="op" id="5073599">,</span>&nbsp;<span class="ident" id="5073601">pos</span><span class="op" id="5073604">.</span><span class="ident" id="5073605">Line</span><span class="op" id="5073609">)</span><span class="op" id="5073610">...</span><span class="op" id="5073613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5073617">p</span><span class="op" id="5073618">.</span><span class="ident" id="5073619">output</span>&nbsp;<span class="op" id="5073626">=</span>&nbsp;<span class="builtinfunc" id="5073628">append</span><span class="op" id="5073634">(</span><span class="ident" id="5073635">p</span><span class="op" id="5073636">.</span><span class="ident" id="5073637">output</span><span class="op" id="5073643">,</span>&nbsp;<span class="ident" id="5073645">tabwriter</span><span class="op" id="5073654">.</span><span class="ident" id="5073655">Escape</span><span class="op" id="5073661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5073665">//&nbsp;p.out&nbsp;must&nbsp;match&nbsp;the&nbsp;//line&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5073706">p</span><span class="op" id="5073707">.</span><span class="ident" id="5073708">out</span><span class="op" id="5073711">.</span><span class="ident" id="5073712">Filename</span>&nbsp;<span class="op" id="5073721">=</span>&nbsp;<span class="ident" id="5073723">pos</span><span class="op" id="5073726">.</span><span class="ident" id="5073727">Filename</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5073738">p</span><span class="op" id="5073739">.</span><span class="ident" id="5073740">out</span><span class="op" id="5073743">.</span><span class="ident" id="5073744">Line</span>&nbsp;<span class="op" id="5073749">=</span>&nbsp;<span class="ident" id="5073751">pos</span><span class="op" id="5073754">.</span><span class="ident" id="5073755">Line</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5073761">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5073765">//&nbsp;write&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5073787">//&nbsp;use&nbsp;&#34;hard&#34;&nbsp;htabs&nbsp;-&nbsp;indentation&nbsp;columns</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5073830">//&nbsp;must&nbsp;not&nbsp;be&nbsp;discarded&nbsp;by&nbsp;the&nbsp;tabwriter</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5073873">n</span>&nbsp;<span class="op" id="5073875">:=</span>&nbsp;<span class="ident" id="5073878">p</span><span class="op" id="5073879">.</span><span class="ident" id="5073880">Config</span><span class="op" id="5073886">.</span><span class="ident" id="5073887">Indent</span>&nbsp;<span class="op" id="5073894">+</span>&nbsp;<span class="ident" id="5073896">p</span><span class="op" id="5073897">.</span><span class="ident" id="5073898">indent</span>&nbsp;<span class="comment" id="5073905">//&nbsp;include&nbsp;base&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5073934">for</span>&nbsp;<span class="ident" id="5073938">i</span>&nbsp;<span class="op" id="5073940">:=</span>&nbsp;<span class="num" id="5073943">0</span><span class="op" id="5073944">;</span>&nbsp;<span class="ident" id="5073946">i</span>&nbsp;<span class="op" id="5073948">&lt;</span>&nbsp;<span class="ident" id="5073950">n</span><span class="op" id="5073951">;</span>&nbsp;<span class="ident" id="5073953">i</span><span class="op" id="5073954">++</span>&nbsp;<span class="op" id="5073957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5073961">p</span><span class="op" id="5073962">.</span><span class="ident" id="5073963">output</span>&nbsp;<span class="op" id="5073970">=</span>&nbsp;<span class="builtinfunc" id="5073972">append</span><span class="op" id="5073978">(</span><span class="ident" id="5073979">p</span><span class="op" id="5073980">.</span><span class="ident" id="5073981">output</span><span class="op" id="5073987">,</span>&nbsp;<span class="string" id="5073989">&#39;\t&#39;</span><span class="op" id="5073993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5073996">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5074000">//&nbsp;update&nbsp;positions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5074021">p</span><span class="op" id="5074022">.</span><span class="ident" id="5074023">pos</span><span class="op" id="5074026">.</span><span class="ident" id="5074027">Offset</span>&nbsp;<span class="op" id="5074034">+=</span>&nbsp;<span class="ident" id="5074037">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5074040">p</span><span class="op" id="5074041">.</span><span class="ident" id="5074042">pos</span><span class="op" id="5074045">.</span><span class="ident" id="5074046">Column</span>&nbsp;<span class="op" id="5074053">+=</span>&nbsp;<span class="ident" id="5074056">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5074059">p</span><span class="op" id="5074060">.</span><span class="ident" id="5074061">out</span><span class="op" id="5074064">.</span><span class="ident" id="5074065">Column</span>&nbsp;<span class="op" id="5074072">+=</span>&nbsp;<span class="ident" id="5074075">n</span><br>
<span class="lineno"></span><span class="op" id="5074077">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="5074080">//&nbsp;writeByte&nbsp;writes&nbsp;ch&nbsp;n&nbsp;times&nbsp;to&nbsp;p.output&nbsp;and&nbsp;updates&nbsp;p.pos.</span><br>
<span class="lineno"></span><span class="keyword" id="5074142">func</span>&nbsp;<span class="op" id="5074147">(</span><span class="ident" id="5074148">p</span>&nbsp;<span class="op" id="5074150">*</span><span class="ident" id="5074151">printer</span><span class="op" id="5074158">)</span>&nbsp;<span class="ident" id="5074160">writeByte</span><span class="op" id="5074169">(</span><span class="ident" id="5074170">ch</span>&nbsp;<span class="builtintype" id="5074173">byte</span><span class="op" id="5074177">,</span>&nbsp;<span class="ident" id="5074179">n</span>&nbsp;<span class="builtintype" id="5074181">int</span><span class="op" id="5074184">)</span>&nbsp;<span class="op" id="5074186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5074189">if</span>&nbsp;<span class="ident" id="5074192">p</span><span class="op" id="5074193">.</span><span class="ident" id="5074194">out</span><span class="op" id="5074197">.</span><span class="ident" id="5074198">Column</span>&nbsp;<span class="op" id="5074205">==</span>&nbsp;<span class="num" id="5074208">1</span>&nbsp;<span class="op" id="5074210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5074214">p</span><span class="op" id="5074215">.</span><span class="ident" id="5074216">atLineBegin</span><span class="op" id="5074227">(</span><span class="ident" id="5074228">p</span><span class="op" id="5074229">.</span><span class="ident" id="5074230">pos</span><span class="op" id="5074233">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5074236">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5074240">for</span>&nbsp;<span class="ident" id="5074244">i</span>&nbsp;<span class="op" id="5074246">:=</span>&nbsp;<span class="num" id="5074249">0</span><span class="op" id="5074250">;</span>&nbsp;<span class="ident" id="5074252">i</span>&nbsp;<span class="op" id="5074254">&lt;</span>&nbsp;<span class="ident" id="5074256">n</span><span class="op" id="5074257">;</span>&nbsp;<span class="ident" id="5074259">i</span><span class="op" id="5074260">++</span>&nbsp;<span class="op" id="5074263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5074267">p</span><span class="op" id="5074268">.</span><span class="ident" id="5074269">output</span>&nbsp;<span class="op" id="5074276">=</span>&nbsp;<span class="builtinfunc" id="5074278">append</span><span class="op" id="5074284">(</span><span class="ident" id="5074285">p</span><span class="op" id="5074286">.</span><span class="ident" id="5074287">output</span><span class="op" id="5074293">,</span>&nbsp;<span class="ident" id="5074295">ch</span><span class="op" id="5074297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5074300">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5074304">//&nbsp;update&nbsp;positions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5074325">p</span><span class="op" id="5074326">.</span><span class="ident" id="5074327">pos</span><span class="op" id="5074330">.</span><span class="ident" id="5074331">Offset</span>&nbsp;<span class="op" id="5074338">+=</span>&nbsp;<span class="ident" id="5074341">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5074344">if</span>&nbsp;<span class="ident" id="5074347">ch</span>&nbsp;<span class="op" id="5074350">==</span>&nbsp;<span class="string" id="5074353">&#39;\n&#39;</span>&nbsp;<span class="op" id="5074358">||</span>&nbsp;<span class="ident" id="5074361">ch</span>&nbsp;<span class="op" id="5074364">==</span>&nbsp;<span class="string" id="5074367">&#39;\f&#39;</span>&nbsp;<span class="op" id="5074372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5074376">p</span><span class="op" id="5074377">.</span><span class="ident" id="5074378">pos</span><span class="op" id="5074381">.</span><span class="ident" id="5074382">Line</span>&nbsp;<span class="op" id="5074387">+=</span>&nbsp;<span class="ident" id="5074390">n</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5074394">p</span><span class="op" id="5074395">.</span><span class="ident" id="5074396">out</span><span class="op" id="5074399">.</span><span class="ident" id="5074400">Line</span>&nbsp;<span class="op" id="5074405">+=</span>&nbsp;<span class="ident" id="5074408">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5074412">p</span><span class="op" id="5074413">.</span><span class="ident" id="5074414">pos</span><span class="op" id="5074417">.</span><span class="ident" id="5074418">Column</span>&nbsp;<span class="op" id="5074425">=</span>&nbsp;<span class="num" id="5074427">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5074431">p</span><span class="op" id="5074432">.</span><span class="ident" id="5074433">out</span><span class="op" id="5074436">.</span><span class="ident" id="5074437">Column</span>&nbsp;<span class="op" id="5074444">=</span>&nbsp;<span class="num" id="5074446">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5074450">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5074458">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5074461">p</span><span class="op" id="5074462">.</span><span class="ident" id="5074463">pos</span><span class="op" id="5074466">.</span><span class="ident" id="5074467">Column</span>&nbsp;<span class="op" id="5074474">+=</span>&nbsp;<span class="ident" id="5074477">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5074480">p</span><span class="op" id="5074481">.</span><span class="ident" id="5074482">out</span><span class="op" id="5074485">.</span><span class="ident" id="5074486">Column</span>&nbsp;<span class="op" id="5074493">+=</span>&nbsp;<span class="ident" id="5074496">n</span><br>
<span class="lineno"></span><span class="op" id="5074498">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5074501">//&nbsp;writeString&nbsp;writes&nbsp;the&nbsp;string&nbsp;s&nbsp;to&nbsp;p.output&nbsp;and&nbsp;updates&nbsp;p.pos,&nbsp;p.out,</span><br>
<span class="lineno">255</span><span class="comment" id="5074574">//&nbsp;and&nbsp;p.last.&nbsp;If&nbsp;isLit&nbsp;is&nbsp;set,&nbsp;s&nbsp;is&nbsp;escaped&nbsp;w/&nbsp;tabwriter.Escape&nbsp;characters</span><br>
<span class="lineno"></span><span class="comment" id="5074650">//&nbsp;to&nbsp;protect&nbsp;s&nbsp;from&nbsp;being&nbsp;interpreted&nbsp;by&nbsp;the&nbsp;tabwriter.</span><br>
<span class="lineno"></span><span class="comment" id="5074707">//</span><br>
<span class="lineno"></span><span class="comment" id="5074710">//&nbsp;Note:&nbsp;writeString&nbsp;is&nbsp;only&nbsp;used&nbsp;to&nbsp;write&nbsp;Go&nbsp;tokens,&nbsp;literals,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5074778">//&nbsp;comments,&nbsp;all&nbsp;of&nbsp;which&nbsp;must&nbsp;be&nbsp;written&nbsp;literally.&nbsp;Thus,&nbsp;it&nbsp;is&nbsp;correct</span><br>
<span class="lineno">260</span><span class="comment" id="5074851">//&nbsp;to&nbsp;always&nbsp;set&nbsp;isLit&nbsp;=&nbsp;true.&nbsp;However,&nbsp;setting&nbsp;it&nbsp;explicitly&nbsp;only&nbsp;when</span><br>
<span class="lineno"></span><span class="comment" id="5074923">//&nbsp;needed&nbsp;(i.e.,&nbsp;when&nbsp;we&nbsp;don&#39;t&nbsp;know&nbsp;that&nbsp;s&nbsp;contains&nbsp;no&nbsp;tabs&nbsp;or&nbsp;line&nbsp;breaks)</span><br>
<span class="lineno"></span><span class="comment" id="5074999">//&nbsp;avoids&nbsp;processing&nbsp;extra&nbsp;escape&nbsp;characters&nbsp;and&nbsp;reduces&nbsp;run&nbsp;time&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5075072">//&nbsp;printer&nbsp;benchmark&nbsp;by&nbsp;up&nbsp;to&nbsp;10%.</span><br>
<span class="lineno"></span><span class="comment" id="5075107">//</span><br>
<span class="lineno">265</span><span class="keyword" id="5075110">func</span>&nbsp;<span class="op" id="5075115">(</span><span class="ident" id="5075116">p</span>&nbsp;<span class="op" id="5075118">*</span><span class="ident" id="5075119">printer</span><span class="op" id="5075126">)</span>&nbsp;<span class="ident" id="5075128">writeString</span><span class="op" id="5075139">(</span><span class="ident" id="5075140">pos</span>&nbsp;<span class="ident" id="5075144">token</span><span class="op" id="5075149">.</span><span class="ident" id="5075150">Position</span><span class="op" id="5075158">,</span>&nbsp;<span class="ident" id="5075160">s</span>&nbsp;<span class="builtintype" id="5075162">string</span><span class="op" id="5075168">,</span>&nbsp;<span class="ident" id="5075170">isLit</span>&nbsp;<span class="builtintype" id="5075176">bool</span><span class="op" id="5075180">)</span>&nbsp;<span class="op" id="5075182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5075185">if</span>&nbsp;<span class="ident" id="5075188">p</span><span class="op" id="5075189">.</span><span class="ident" id="5075190">out</span><span class="op" id="5075193">.</span><span class="ident" id="5075194">Column</span>&nbsp;<span class="op" id="5075201">==</span>&nbsp;<span class="num" id="5075204">1</span>&nbsp;<span class="op" id="5075206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5075210">p</span><span class="op" id="5075211">.</span><span class="ident" id="5075212">atLineBegin</span><span class="op" id="5075223">(</span><span class="ident" id="5075224">pos</span><span class="op" id="5075227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5075230">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5075234">if</span>&nbsp;<span class="ident" id="5075237">pos</span><span class="op" id="5075240">.</span><span class="ident" id="5075241">IsValid</span><span class="op" id="5075248">(</span><span class="op" id="5075249">)</span>&nbsp;<span class="op" id="5075251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5075255">//&nbsp;update&nbsp;p.pos&nbsp;(if&nbsp;pos&nbsp;is&nbsp;invalid,&nbsp;continue&nbsp;with&nbsp;existing&nbsp;p.pos)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5075323">//&nbsp;Note:&nbsp;Must&nbsp;do&nbsp;this&nbsp;after&nbsp;handling&nbsp;line&nbsp;beginnings&nbsp;because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5075386">//&nbsp;atLineBegin&nbsp;updates&nbsp;p.pos&nbsp;if&nbsp;there&#39;s&nbsp;indentation,&nbsp;but&nbsp;p.pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5075451">//&nbsp;is&nbsp;the&nbsp;position&nbsp;of&nbsp;s.</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5075478">p</span><span class="op" id="5075479">.</span><span class="ident" id="5075480">pos</span>&nbsp;<span class="op" id="5075484">=</span>&nbsp;<span class="ident" id="5075486">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5075491">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5075495">if</span>&nbsp;<span class="ident" id="5075498">isLit</span>&nbsp;<span class="op" id="5075504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5075508">//&nbsp;Protect&nbsp;s&nbsp;such&nbsp;that&nbsp;is&nbsp;passes&nbsp;through&nbsp;the&nbsp;tabwriter</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5075565">//&nbsp;unchanged.&nbsp;Note&nbsp;that&nbsp;valid&nbsp;Go&nbsp;programs&nbsp;cannot&nbsp;contain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5075624">//&nbsp;tabwriter.Escape&nbsp;bytes&nbsp;since&nbsp;they&nbsp;do&nbsp;not&nbsp;appear&nbsp;in&nbsp;legal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5075686">//&nbsp;UTF-8&nbsp;sequences.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5075708">p</span><span class="op" id="5075709">.</span><span class="ident" id="5075710">output</span>&nbsp;<span class="op" id="5075717">=</span>&nbsp;<span class="builtinfunc" id="5075719">append</span><span class="op" id="5075725">(</span><span class="ident" id="5075726">p</span><span class="op" id="5075727">.</span><span class="ident" id="5075728">output</span><span class="op" id="5075734">,</span>&nbsp;<span class="ident" id="5075736">tabwriter</span><span class="op" id="5075745">.</span><span class="ident" id="5075746">Escape</span><span class="op" id="5075752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5075755">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5075759">if</span>&nbsp;<span class="ident" id="5075762">debug</span>&nbsp;<span class="op" id="5075768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5075772">p</span><span class="op" id="5075773">.</span><span class="ident" id="5075774">output</span>&nbsp;<span class="op" id="5075781">=</span>&nbsp;<span class="builtinfunc" id="5075783">append</span><span class="op" id="5075789">(</span><span class="ident" id="5075790">p</span><span class="op" id="5075791">.</span><span class="ident" id="5075792">output</span><span class="op" id="5075798">,</span>&nbsp;<span class="ident" id="5075800">fmt</span><span class="op" id="5075803">.</span><span class="ident" id="5075804">Sprintf</span><span class="op" id="5075811">(</span><span class="string" id="5075812">&#34;/*%s*/&#34;</span><span class="op" id="5075820">,</span>&nbsp;<span class="ident" id="5075822">pos</span><span class="op" id="5075825">)</span><span class="op" id="5075826">...</span><span class="op" id="5075829">)</span>&nbsp;<span class="comment" id="5075831">//&nbsp;do&nbsp;not&nbsp;update&nbsp;p.pos!</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5075856">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5075859">p</span><span class="op" id="5075860">.</span><span class="ident" id="5075861">output</span>&nbsp;<span class="op" id="5075868">=</span>&nbsp;<span class="builtinfunc" id="5075870">append</span><span class="op" id="5075876">(</span><span class="ident" id="5075877">p</span><span class="op" id="5075878">.</span><span class="ident" id="5075879">output</span><span class="op" id="5075885">,</span>&nbsp;<span class="ident" id="5075887">s</span><span class="op" id="5075888">...</span><span class="op" id="5075891">)</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5075895">//&nbsp;update&nbsp;positions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5075916">nlines</span>&nbsp;<span class="op" id="5075923">:=</span>&nbsp;<span class="num" id="5075926">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5075929">var</span>&nbsp;<span class="ident" id="5075933">li</span>&nbsp;<span class="builtintype" id="5075936">int</span>&nbsp;<span class="comment" id="5075940">//&nbsp;index&nbsp;of&nbsp;last&nbsp;newline;&nbsp;valid&nbsp;if&nbsp;nlines&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5075987">for</span>&nbsp;<span class="ident" id="5075991">i</span>&nbsp;<span class="op" id="5075993">:=</span>&nbsp;<span class="num" id="5075996">0</span><span class="op" id="5075997">;</span>&nbsp;<span class="ident" id="5075999">i</span>&nbsp;<span class="op" id="5076001">&lt;</span>&nbsp;<span class="builtinfunc" id="5076003">len</span><span class="op" id="5076006">(</span><span class="ident" id="5076007">s</span><span class="op" id="5076008">)</span><span class="op" id="5076009">;</span>&nbsp;<span class="ident" id="5076011">i</span><span class="op" id="5076012">++</span>&nbsp;<span class="op" id="5076015">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5076019">//&nbsp;Go&nbsp;tokens&nbsp;cannot&nbsp;contain&nbsp;&#39;\f&#39;&nbsp;-&nbsp;no&nbsp;need&nbsp;to&nbsp;look&nbsp;for&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5076079">if</span>&nbsp;<span class="ident" id="5076082">s</span><span class="op" id="5076083">[</span><span class="ident" id="5076084">i</span><span class="op" id="5076085">]</span>&nbsp;<span class="op" id="5076087">==</span>&nbsp;<span class="string" id="5076090">&#39;\n&#39;</span>&nbsp;<span class="op" id="5076095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5076100">nlines</span><span class="op" id="5076106">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5076112">li</span>&nbsp;<span class="op" id="5076115">=</span>&nbsp;<span class="ident" id="5076117">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5076121">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5076124">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5076127">p</span><span class="op" id="5076128">.</span><span class="ident" id="5076129">pos</span><span class="op" id="5076132">.</span><span class="ident" id="5076133">Offset</span>&nbsp;<span class="op" id="5076140">+=</span>&nbsp;<span class="builtinfunc" id="5076143">len</span><span class="op" id="5076146">(</span><span class="ident" id="5076147">s</span><span class="op" id="5076148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5076151">if</span>&nbsp;<span class="ident" id="5076154">nlines</span>&nbsp;<span class="op" id="5076161">&gt;</span>&nbsp;<span class="num" id="5076163">0</span>&nbsp;<span class="op" id="5076165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5076169">p</span><span class="op" id="5076170">.</span><span class="ident" id="5076171">pos</span><span class="op" id="5076174">.</span><span class="ident" id="5076175">Line</span>&nbsp;<span class="op" id="5076180">+=</span>&nbsp;<span class="ident" id="5076183">nlines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5076192">p</span><span class="op" id="5076193">.</span><span class="ident" id="5076194">out</span><span class="op" id="5076197">.</span><span class="ident" id="5076198">Line</span>&nbsp;<span class="op" id="5076203">+=</span>&nbsp;<span class="ident" id="5076206">nlines</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5076215">c</span>&nbsp;<span class="op" id="5076217">:=</span>&nbsp;<span class="builtinfunc" id="5076220">len</span><span class="op" id="5076223">(</span><span class="ident" id="5076224">s</span><span class="op" id="5076225">)</span>&nbsp;<span class="op" id="5076227">-</span>&nbsp;<span class="ident" id="5076229">li</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5076234">p</span><span class="op" id="5076235">.</span><span class="ident" id="5076236">pos</span><span class="op" id="5076239">.</span><span class="ident" id="5076240">Column</span>&nbsp;<span class="op" id="5076247">=</span>&nbsp;<span class="ident" id="5076249">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5076253">p</span><span class="op" id="5076254">.</span><span class="ident" id="5076255">out</span><span class="op" id="5076258">.</span><span class="ident" id="5076259">Column</span>&nbsp;<span class="op" id="5076266">=</span>&nbsp;<span class="ident" id="5076268">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5076271">}</span>&nbsp;<span class="keyword" id="5076273">else</span>&nbsp;<span class="op" id="5076278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5076282">p</span><span class="op" id="5076283">.</span><span class="ident" id="5076284">pos</span><span class="op" id="5076287">.</span><span class="ident" id="5076288">Column</span>&nbsp;<span class="op" id="5076295">+=</span>&nbsp;<span class="builtinfunc" id="5076298">len</span><span class="op" id="5076301">(</span><span class="ident" id="5076302">s</span><span class="op" id="5076303">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5076307">p</span><span class="op" id="5076308">.</span><span class="ident" id="5076309">out</span><span class="op" id="5076312">.</span><span class="ident" id="5076313">Column</span>&nbsp;<span class="op" id="5076320">+=</span>&nbsp;<span class="builtinfunc" id="5076323">len</span><span class="op" id="5076326">(</span><span class="ident" id="5076327">s</span><span class="op" id="5076328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5076331">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5076335">if</span>&nbsp;<span class="ident" id="5076338">isLit</span>&nbsp;<span class="op" id="5076344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5076348">p</span><span class="op" id="5076349">.</span><span class="ident" id="5076350">output</span>&nbsp;<span class="op" id="5076357">=</span>&nbsp;<span class="builtinfunc" id="5076359">append</span><span class="op" id="5076365">(</span><span class="ident" id="5076366">p</span><span class="op" id="5076367">.</span><span class="ident" id="5076368">output</span><span class="op" id="5076374">,</span>&nbsp;<span class="ident" id="5076376">tabwriter</span><span class="op" id="5076385">.</span><span class="ident" id="5076386">Escape</span><span class="op" id="5076392">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5076395">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5076399">p</span><span class="op" id="5076400">.</span><span class="ident" id="5076401">last</span>&nbsp;<span class="op" id="5076406">=</span>&nbsp;<span class="ident" id="5076408">p</span><span class="op" id="5076409">.</span><span class="ident" id="5076410">pos</span><br>
<span class="lineno"></span><span class="op" id="5076414">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">320</span><span class="comment" id="5076417">//&nbsp;writeCommentPrefix&nbsp;writes&nbsp;the&nbsp;whitespace&nbsp;before&nbsp;a&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="5076479">//&nbsp;If&nbsp;there&nbsp;is&nbsp;any&nbsp;pending&nbsp;whitespace,&nbsp;it&nbsp;consumes&nbsp;as&nbsp;much&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5076541">//&nbsp;it&nbsp;as&nbsp;is&nbsp;likely&nbsp;to&nbsp;help&nbsp;position&nbsp;the&nbsp;comment&nbsp;nicely.</span><br>
<span class="lineno"></span><span class="comment" id="5076597">//&nbsp;pos&nbsp;is&nbsp;the&nbsp;comment&nbsp;position,&nbsp;next&nbsp;the&nbsp;position&nbsp;of&nbsp;the&nbsp;item</span><br>
<span class="lineno"></span><span class="comment" id="5076659">//&nbsp;after&nbsp;all&nbsp;pending&nbsp;comments,&nbsp;prev&nbsp;is&nbsp;the&nbsp;previous&nbsp;comment&nbsp;in</span><br>
<span class="lineno">325</span><span class="comment" id="5076722">//&nbsp;a&nbsp;group&nbsp;of&nbsp;comments&nbsp;(or&nbsp;nil),&nbsp;and&nbsp;tok&nbsp;is&nbsp;the&nbsp;next&nbsp;token.</span><br>
<span class="lineno"></span><span class="comment" id="5076782">//</span><br>
<span class="lineno"></span><span class="keyword" id="5076785">func</span>&nbsp;<span class="op" id="5076790">(</span><span class="ident" id="5076791">p</span>&nbsp;<span class="op" id="5076793">*</span><span class="ident" id="5076794">printer</span><span class="op" id="5076801">)</span>&nbsp;<span class="ident" id="5076803">writeCommentPrefix</span><span class="op" id="5076821">(</span><span class="ident" id="5076822">pos</span><span class="op" id="5076825">,</span>&nbsp;<span class="ident" id="5076827">next</span>&nbsp;<span class="ident" id="5076832">token</span><span class="op" id="5076837">.</span><span class="ident" id="5076838">Position</span><span class="op" id="5076846">,</span>&nbsp;<span class="ident" id="5076848">prev</span><span class="op" id="5076852">,</span>&nbsp;<span class="ident" id="5076854">comment</span>&nbsp;<span class="op" id="5076862">*</span><span class="ident" id="5076863">ast</span><span class="op" id="5076866">.</span><span class="ident" id="5076867">Comment</span><span class="op" id="5076874">,</span>&nbsp;<span class="ident" id="5076876">tok</span>&nbsp;<span class="ident" id="5076880">token</span><span class="op" id="5076885">.</span><span class="ident" id="5076886">Token</span><span class="op" id="5076891">)</span>&nbsp;<span class="op" id="5076893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5076896">if</span>&nbsp;<span class="builtinfunc" id="5076899">len</span><span class="op" id="5076902">(</span><span class="ident" id="5076903">p</span><span class="op" id="5076904">.</span><span class="ident" id="5076905">output</span><span class="op" id="5076911">)</span>&nbsp;<span class="op" id="5076913">==</span>&nbsp;<span class="num" id="5076916">0</span>&nbsp;<span class="op" id="5076918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5076922">//&nbsp;the&nbsp;comment&nbsp;is&nbsp;the&nbsp;first&nbsp;item&nbsp;to&nbsp;be&nbsp;printed&nbsp;-&nbsp;don&#39;t&nbsp;write&nbsp;any&nbsp;whitespace</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5077000">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5077008">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5077012">if</span>&nbsp;<span class="ident" id="5077015">pos</span><span class="op" id="5077018">.</span><span class="ident" id="5077019">IsValid</span><span class="op" id="5077026">(</span><span class="op" id="5077027">)</span>&nbsp;<span class="op" id="5077029">&amp;&amp;</span>&nbsp;<span class="ident" id="5077032">pos</span><span class="op" id="5077035">.</span><span class="ident" id="5077036">Filename</span>&nbsp;<span class="op" id="5077045">!=</span>&nbsp;<span class="ident" id="5077048">p</span><span class="op" id="5077049">.</span><span class="ident" id="5077050">last</span><span class="op" id="5077054">.</span><span class="ident" id="5077055">Filename</span>&nbsp;<span class="op" id="5077064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5077068">//&nbsp;comment&nbsp;in&nbsp;a&nbsp;different&nbsp;file&nbsp;-&nbsp;separate&nbsp;with&nbsp;newlines</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5077126">p</span><span class="op" id="5077127">.</span><span class="ident" id="5077128">writeByte</span><span class="op" id="5077137">(</span><span class="string" id="5077138">&#39;\f&#39;</span><span class="op" id="5077142">,</span>&nbsp;<span class="ident" id="5077144">maxNewlines</span><span class="op" id="5077155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5077159">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5077167">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5077171">if</span>&nbsp;<span class="ident" id="5077174">pos</span><span class="op" id="5077177">.</span><span class="ident" id="5077178">Line</span>&nbsp;<span class="op" id="5077183">==</span>&nbsp;<span class="ident" id="5077186">p</span><span class="op" id="5077187">.</span><span class="ident" id="5077188">last</span><span class="op" id="5077192">.</span><span class="ident" id="5077193">Line</span>&nbsp;<span class="op" id="5077198">&amp;&amp;</span>&nbsp;<span class="op" id="5077201">(</span><span class="ident" id="5077202">prev</span>&nbsp;<span class="op" id="5077207">==</span>&nbsp;<span class="builtintype" id="5077210">nil</span>&nbsp;<span class="op" id="5077214">||</span>&nbsp;<span class="ident" id="5077217">prev</span><span class="op" id="5077221">.</span><span class="ident" id="5077222">Text</span><span class="op" id="5077226">[</span><span class="num" id="5077227">1</span><span class="op" id="5077228">]</span>&nbsp;<span class="op" id="5077230">!=</span>&nbsp;<span class="string" id="5077233">&#39;/&#39;</span><span class="op" id="5077236">)</span>&nbsp;<span class="op" id="5077238">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5077242">//&nbsp;comment&nbsp;on&nbsp;the&nbsp;same&nbsp;line&nbsp;as&nbsp;last&nbsp;item:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5077286">//&nbsp;separate&nbsp;with&nbsp;at&nbsp;least&nbsp;one&nbsp;separator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5077328">hasSep</span>&nbsp;<span class="op" id="5077335">:=</span>&nbsp;<span class="builtintype" id="5077338">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5077346">if</span>&nbsp;<span class="ident" id="5077349">prev</span>&nbsp;<span class="op" id="5077354">==</span>&nbsp;<span class="builtintype" id="5077357">nil</span>&nbsp;<span class="op" id="5077361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5077366">//&nbsp;first&nbsp;comment&nbsp;of&nbsp;a&nbsp;comment&nbsp;group</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5077405">j</span>&nbsp;<span class="op" id="5077407">:=</span>&nbsp;<span class="num" id="5077410">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5077415">for</span>&nbsp;<span class="ident" id="5077419">i</span><span class="op" id="5077420">,</span>&nbsp;<span class="ident" id="5077422">ch</span>&nbsp;<span class="op" id="5077425">:=</span>&nbsp;<span class="keyword" id="5077428">range</span>&nbsp;<span class="ident" id="5077434">p</span><span class="op" id="5077435">.</span><span class="ident" id="5077436">wsbuf</span>&nbsp;<span class="op" id="5077442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5077448">switch</span>&nbsp;<span class="ident" id="5077455">ch</span>&nbsp;<span class="op" id="5077458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5077464">case</span>&nbsp;<span class="ident" id="5077469">blank</span><span class="op" id="5077474">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5077481">//&nbsp;ignore&nbsp;any&nbsp;blanks&nbsp;before&nbsp;a&nbsp;comment</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5077524">p</span><span class="op" id="5077525">.</span><span class="ident" id="5077526">wsbuf</span><span class="op" id="5077531">[</span><span class="ident" id="5077532">i</span><span class="op" id="5077533">]</span>&nbsp;<span class="op" id="5077535">=</span>&nbsp;<span class="ident" id="5077537">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5077549">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5077562">case</span>&nbsp;<span class="ident" id="5077567">vtab</span><span class="op" id="5077571">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5077578">//&nbsp;respect&nbsp;existing&nbsp;tabs&nbsp;-&nbsp;important</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5077620">//&nbsp;for&nbsp;proper&nbsp;formatting&nbsp;of&nbsp;commented&nbsp;structs</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5077671">hasSep</span>&nbsp;<span class="op" id="5077678">=</span>&nbsp;<span class="builtintype" id="5077680">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5077690">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5077703">case</span>&nbsp;<span class="ident" id="5077708">indent</span><span class="op" id="5077714">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5077721">//&nbsp;apply&nbsp;pending&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5077755">continue</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5077768">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5077774">j</span>&nbsp;<span class="op" id="5077776">=</span>&nbsp;<span class="ident" id="5077778">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5077784">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5077793">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5077798">p</span><span class="op" id="5077799">.</span><span class="ident" id="5077800">writeWhitespace</span><span class="op" id="5077815">(</span><span class="ident" id="5077816">j</span><span class="op" id="5077817">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5077821">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5077825">//&nbsp;make&nbsp;sure&nbsp;there&nbsp;is&nbsp;at&nbsp;least&nbsp;one&nbsp;separator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5077872">if</span>&nbsp;<span class="op" id="5077875">!</span><span class="ident" id="5077876">hasSep</span>&nbsp;<span class="op" id="5077883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5077888">sep</span>&nbsp;<span class="op" id="5077892">:=</span>&nbsp;<span class="builtintype" id="5077895">byte</span><span class="op" id="5077899">(</span><span class="string" id="5077900">&#39;\t&#39;</span><span class="op" id="5077904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5077909">if</span>&nbsp;<span class="ident" id="5077912">pos</span><span class="op" id="5077915">.</span><span class="ident" id="5077916">Line</span>&nbsp;<span class="op" id="5077921">==</span>&nbsp;<span class="ident" id="5077924">next</span><span class="op" id="5077928">.</span><span class="ident" id="5077929">Line</span>&nbsp;<span class="op" id="5077934">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5077940">//&nbsp;next&nbsp;item&nbsp;is&nbsp;on&nbsp;the&nbsp;same&nbsp;line&nbsp;as&nbsp;the&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5077992">//&nbsp;(which&nbsp;must&nbsp;be&nbsp;a&nbsp;/*-style&nbsp;comment):&nbsp;separate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5078044">//&nbsp;with&nbsp;a&nbsp;blank&nbsp;instead&nbsp;of&nbsp;a&nbsp;tab</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5078081">sep</span>&nbsp;<span class="op" id="5078085">=</span>&nbsp;<span class="string" id="5078087">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5078094">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5078099">p</span><span class="op" id="5078100">.</span><span class="ident" id="5078101">writeByte</span><span class="op" id="5078110">(</span><span class="ident" id="5078111">sep</span><span class="op" id="5078114">,</span>&nbsp;<span class="num" id="5078116">1</span><span class="op" id="5078117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5078121">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5078125">}</span>&nbsp;<span class="keyword" id="5078127">else</span>&nbsp;<span class="op" id="5078132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5078136">//&nbsp;comment&nbsp;on&nbsp;a&nbsp;different&nbsp;line:</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5078170">//&nbsp;separate&nbsp;with&nbsp;at&nbsp;least&nbsp;one&nbsp;line&nbsp;break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5078213">droppedLinebreak</span>&nbsp;<span class="op" id="5078230">:=</span>&nbsp;<span class="builtintype" id="5078233">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5078241">j</span>&nbsp;<span class="op" id="5078243">:=</span>&nbsp;<span class="num" id="5078246">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5078250">for</span>&nbsp;<span class="ident" id="5078254">i</span><span class="op" id="5078255">,</span>&nbsp;<span class="ident" id="5078257">ch</span>&nbsp;<span class="op" id="5078260">:=</span>&nbsp;<span class="keyword" id="5078263">range</span>&nbsp;<span class="ident" id="5078269">p</span><span class="op" id="5078270">.</span><span class="ident" id="5078271">wsbuf</span>&nbsp;<span class="op" id="5078277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5078282">switch</span>&nbsp;<span class="ident" id="5078289">ch</span>&nbsp;<span class="op" id="5078292">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5078297">case</span>&nbsp;<span class="ident" id="5078302">blank</span><span class="op" id="5078307">,</span>&nbsp;<span class="ident" id="5078309">vtab</span><span class="op" id="5078313">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5078319">//&nbsp;ignore&nbsp;any&nbsp;horizontal&nbsp;whitespace&nbsp;before&nbsp;line&nbsp;breaks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5078378">p</span><span class="op" id="5078379">.</span><span class="ident" id="5078380">wsbuf</span><span class="op" id="5078385">[</span><span class="ident" id="5078386">i</span><span class="op" id="5078387">]</span>&nbsp;<span class="op" id="5078389">=</span>&nbsp;<span class="ident" id="5078391">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5078402">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5078414">case</span>&nbsp;<span class="ident" id="5078419">indent</span><span class="op" id="5078425">:</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5078431">//&nbsp;apply&nbsp;pending&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5078464">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5078476">case</span>&nbsp;<span class="ident" id="5078481">unindent</span><span class="op" id="5078489">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5078495">//&nbsp;if&nbsp;this&nbsp;is&nbsp;not&nbsp;the&nbsp;last&nbsp;unindent,&nbsp;apply&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5078545">//&nbsp;as&nbsp;it&nbsp;is&nbsp;(likely)&nbsp;belonging&nbsp;to&nbsp;the&nbsp;last</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5078592">//&nbsp;construct&nbsp;(e.g.,&nbsp;a&nbsp;multi-line&nbsp;expression&nbsp;list)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5078646">//&nbsp;and&nbsp;is&nbsp;not&nbsp;part&nbsp;of&nbsp;closing&nbsp;a&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5078688">if</span>&nbsp;<span class="ident" id="5078691">i</span><span class="op" id="5078692">+</span><span class="num" id="5078693">1</span>&nbsp;<span class="op" id="5078695">&lt;</span>&nbsp;<span class="builtinfunc" id="5078697">len</span><span class="op" id="5078700">(</span><span class="ident" id="5078701">p</span><span class="op" id="5078702">.</span><span class="ident" id="5078703">wsbuf</span><span class="op" id="5078708">)</span>&nbsp;<span class="op" id="5078710">&amp;&amp;</span>&nbsp;<span class="ident" id="5078713">p</span><span class="op" id="5078714">.</span><span class="ident" id="5078715">wsbuf</span><span class="op" id="5078720">[</span><span class="ident" id="5078721">i</span><span class="op" id="5078722">+</span><span class="num" id="5078723">1</span><span class="op" id="5078724">]</span>&nbsp;<span class="op" id="5078726">==</span>&nbsp;<span class="ident" id="5078729">unindent</span>&nbsp;<span class="op" id="5078738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5078745">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5078758">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5078764">//&nbsp;if&nbsp;the&nbsp;next&nbsp;token&nbsp;is&nbsp;not&nbsp;a&nbsp;closing&nbsp;},&nbsp;apply&nbsp;the&nbsp;unindent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5078828">//&nbsp;if&nbsp;it&nbsp;appears&nbsp;that&nbsp;the&nbsp;comment&nbsp;is&nbsp;aligned&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5078886">//&nbsp;token;&nbsp;otherwise&nbsp;assume&nbsp;the&nbsp;unindent&nbsp;is&nbsp;part&nbsp;of&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5078943">//&nbsp;closing&nbsp;block&nbsp;and&nbsp;stop&nbsp;(this&nbsp;scenario&nbsp;appears&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5079001">//&nbsp;comments&nbsp;before&nbsp;a&nbsp;case&nbsp;label&nbsp;where&nbsp;the&nbsp;comments</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5079056">//&nbsp;apply&nbsp;to&nbsp;the&nbsp;next&nbsp;case&nbsp;instead&nbsp;of&nbsp;the&nbsp;current&nbsp;one)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5079114">if</span>&nbsp;<span class="ident" id="5079117">tok</span>&nbsp;<span class="op" id="5079121">!=</span>&nbsp;<span class="ident" id="5079124">token</span><span class="op" id="5079129">.</span><span class="ident" id="5079130">RBRACE</span>&nbsp;<span class="op" id="5079137">&amp;&amp;</span>&nbsp;<span class="ident" id="5079140">pos</span><span class="op" id="5079143">.</span><span class="ident" id="5079144">Column</span>&nbsp;<span class="op" id="5079151">==</span>&nbsp;<span class="ident" id="5079154">next</span><span class="op" id="5079158">.</span><span class="ident" id="5079159">Column</span>&nbsp;<span class="op" id="5079166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5079173">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5079186">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5079191">case</span>&nbsp;<span class="ident" id="5079196">newline</span><span class="op" id="5079203">,</span>&nbsp;<span class="ident" id="5079205">formfeed</span><span class="op" id="5079213">:</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5079219">p</span><span class="op" id="5079220">.</span><span class="ident" id="5079221">wsbuf</span><span class="op" id="5079226">[</span><span class="ident" id="5079227">i</span><span class="op" id="5079228">]</span>&nbsp;<span class="op" id="5079230">=</span>&nbsp;<span class="ident" id="5079232">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5079243">droppedLinebreak</span>&nbsp;<span class="op" id="5079260">=</span>&nbsp;<span class="ident" id="5079262">prev</span>&nbsp;<span class="op" id="5079267">==</span>&nbsp;<span class="builtintype" id="5079270">nil</span>&nbsp;<span class="comment" id="5079274">//&nbsp;record&nbsp;only&nbsp;if&nbsp;first&nbsp;comment&nbsp;of&nbsp;a&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5079320">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5079325">j</span>&nbsp;<span class="op" id="5079327">=</span>&nbsp;<span class="ident" id="5079329">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5079334">break</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5079342">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5079346">p</span><span class="op" id="5079347">.</span><span class="ident" id="5079348">writeWhitespace</span><span class="op" id="5079363">(</span><span class="ident" id="5079364">j</span><span class="op" id="5079365">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5079370">//&nbsp;determine&nbsp;number&nbsp;of&nbsp;linebreaks&nbsp;before&nbsp;the&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5079425">n</span>&nbsp;<span class="op" id="5079427">:=</span>&nbsp;<span class="num" id="5079430">0</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5079434">if</span>&nbsp;<span class="ident" id="5079437">pos</span><span class="op" id="5079440">.</span><span class="ident" id="5079441">IsValid</span><span class="op" id="5079448">(</span><span class="op" id="5079449">)</span>&nbsp;<span class="op" id="5079451">&amp;&amp;</span>&nbsp;<span class="ident" id="5079454">p</span><span class="op" id="5079455">.</span><span class="ident" id="5079456">last</span><span class="op" id="5079460">.</span><span class="ident" id="5079461">IsValid</span><span class="op" id="5079468">(</span><span class="op" id="5079469">)</span>&nbsp;<span class="op" id="5079471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5079476">n</span>&nbsp;<span class="op" id="5079478">=</span>&nbsp;<span class="ident" id="5079480">pos</span><span class="op" id="5079483">.</span><span class="ident" id="5079484">Line</span>&nbsp;<span class="op" id="5079489">-</span>&nbsp;<span class="ident" id="5079491">p</span><span class="op" id="5079492">.</span><span class="ident" id="5079493">last</span><span class="op" id="5079497">.</span><span class="ident" id="5079498">Line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5079506">if</span>&nbsp;<span class="ident" id="5079509">n</span>&nbsp;<span class="op" id="5079511">&lt;</span>&nbsp;<span class="num" id="5079513">0</span>&nbsp;<span class="op" id="5079515">{</span>&nbsp;<span class="comment" id="5079517">//&nbsp;should&nbsp;never&nbsp;happen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5079544">n</span>&nbsp;<span class="op" id="5079546">=</span>&nbsp;<span class="num" id="5079548">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5079553">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5079557">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5079562">//&nbsp;at&nbsp;the&nbsp;package&nbsp;scope&nbsp;level&nbsp;only&nbsp;(p.indent&nbsp;==&nbsp;0),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5079616">//&nbsp;add&nbsp;an&nbsp;extra&nbsp;newline&nbsp;if&nbsp;we&nbsp;dropped&nbsp;one&nbsp;before:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5079668">//&nbsp;this&nbsp;preserves&nbsp;a&nbsp;blank&nbsp;line&nbsp;before&nbsp;documentation</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5079722">//&nbsp;comments&nbsp;at&nbsp;the&nbsp;package&nbsp;scope&nbsp;level&nbsp;(issue&nbsp;2570)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5079776">if</span>&nbsp;<span class="ident" id="5079779">p</span><span class="op" id="5079780">.</span><span class="ident" id="5079781">indent</span>&nbsp;<span class="op" id="5079788">==</span>&nbsp;<span class="num" id="5079791">0</span>&nbsp;<span class="op" id="5079793">&amp;&amp;</span>&nbsp;<span class="ident" id="5079796">droppedLinebreak</span>&nbsp;<span class="op" id="5079813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5079818">n</span><span class="op" id="5079819">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5079824">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5079829">//&nbsp;make&nbsp;sure&nbsp;there&nbsp;is&nbsp;at&nbsp;least&nbsp;one&nbsp;line&nbsp;break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5079877">//&nbsp;if&nbsp;the&nbsp;previous&nbsp;comment&nbsp;was&nbsp;a&nbsp;line&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5079925">if</span>&nbsp;<span class="ident" id="5079928">n</span>&nbsp;<span class="op" id="5079930">==</span>&nbsp;<span class="num" id="5079933">0</span>&nbsp;<span class="op" id="5079935">&amp;&amp;</span>&nbsp;<span class="ident" id="5079938">prev</span>&nbsp;<span class="op" id="5079943">!=</span>&nbsp;<span class="builtintype" id="5079946">nil</span>&nbsp;<span class="op" id="5079950">&amp;&amp;</span>&nbsp;<span class="ident" id="5079953">prev</span><span class="op" id="5079957">.</span><span class="ident" id="5079958">Text</span><span class="op" id="5079962">[</span><span class="num" id="5079963">1</span><span class="op" id="5079964">]</span>&nbsp;<span class="op" id="5079966">==</span>&nbsp;<span class="string" id="5079969">&#39;/&#39;</span>&nbsp;<span class="op" id="5079973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5079978">n</span>&nbsp;<span class="op" id="5079980">=</span>&nbsp;<span class="num" id="5079982">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5079986">}</span><br>
<span class="lineno">440</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5079991">if</span>&nbsp;<span class="ident" id="5079994">n</span>&nbsp;<span class="op" id="5079996">&gt;</span>&nbsp;<span class="num" id="5079998">0</span>&nbsp;<span class="op" id="5080000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5080005">//&nbsp;use&nbsp;formfeeds&nbsp;to&nbsp;break&nbsp;columns&nbsp;before&nbsp;a&nbsp;comment;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5080060">//&nbsp;this&nbsp;is&nbsp;analogous&nbsp;to&nbsp;using&nbsp;formfeeds&nbsp;to&nbsp;separate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5080115">//&nbsp;individual&nbsp;lines&nbsp;of&nbsp;/*-style&nbsp;comments</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5080159">p</span><span class="op" id="5080160">.</span><span class="ident" id="5080161">writeByte</span><span class="op" id="5080170">(</span><span class="string" id="5080171">&#39;\f&#39;</span><span class="op" id="5080175">,</span>&nbsp;<span class="ident" id="5080177">nlimit</span><span class="op" id="5080183">(</span><span class="ident" id="5080184">n</span><span class="op" id="5080185">)</span><span class="op" id="5080186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5080190">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5080193">}</span><br>
<span class="lineno"></span><span class="op" id="5080195">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">450</span><span class="comment" id="5080198">//&nbsp;Returns&nbsp;true&nbsp;if&nbsp;s&nbsp;contains&nbsp;only&nbsp;white&nbsp;space</span><br>
<span class="lineno"></span><span class="comment" id="5080245">//&nbsp;(only&nbsp;tabs&nbsp;and&nbsp;blanks&nbsp;can&nbsp;appear&nbsp;in&nbsp;the&nbsp;printer&#39;s&nbsp;context).</span><br>
<span class="lineno"></span><span class="comment" id="5080308">//</span><br>
<span class="lineno"></span><span class="keyword" id="5080311">func</span>&nbsp;<span class="ident" id="5080316">isBlank</span><span class="op" id="5080323">(</span><span class="ident" id="5080324">s</span>&nbsp;<span class="builtintype" id="5080326">string</span><span class="op" id="5080332">)</span>&nbsp;<span class="builtintype" id="5080334">bool</span>&nbsp;<span class="op" id="5080339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5080342">for</span>&nbsp;<span class="ident" id="5080346">i</span>&nbsp;<span class="op" id="5080348">:=</span>&nbsp;<span class="num" id="5080351">0</span><span class="op" id="5080352">;</span>&nbsp;<span class="ident" id="5080354">i</span>&nbsp;<span class="op" id="5080356">&lt;</span>&nbsp;<span class="builtinfunc" id="5080358">len</span><span class="op" id="5080361">(</span><span class="ident" id="5080362">s</span><span class="op" id="5080363">)</span><span class="op" id="5080364">;</span>&nbsp;<span class="ident" id="5080366">i</span><span class="op" id="5080367">++</span>&nbsp;<span class="op" id="5080370">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5080374">if</span>&nbsp;<span class="ident" id="5080377">s</span><span class="op" id="5080378">[</span><span class="ident" id="5080379">i</span><span class="op" id="5080380">]</span>&nbsp;<span class="op" id="5080382">&gt;</span>&nbsp;<span class="string" id="5080384">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="5080388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5080393">return</span>&nbsp;<span class="builtintype" id="5080400">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5080408">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5080411">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5080414">return</span>&nbsp;<span class="builtintype" id="5080421">true</span><br>
<span class="lineno">460</span><span class="op" id="5080426">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5080429">//&nbsp;commonPrefix&nbsp;returns&nbsp;the&nbsp;common&nbsp;prefix&nbsp;of&nbsp;a&nbsp;and&nbsp;b.</span><br>
<span class="lineno"></span><span class="keyword" id="5080483">func</span>&nbsp;<span class="ident" id="5080488">commonPrefix</span><span class="op" id="5080500">(</span><span class="ident" id="5080501">a</span><span class="op" id="5080502">,</span>&nbsp;<span class="ident" id="5080504">b</span>&nbsp;<span class="builtintype" id="5080506">string</span><span class="op" id="5080512">)</span>&nbsp;<span class="builtintype" id="5080514">string</span>&nbsp;<span class="op" id="5080521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5080524">i</span>&nbsp;<span class="op" id="5080526">:=</span>&nbsp;<span class="num" id="5080529">0</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5080532">for</span>&nbsp;<span class="ident" id="5080536">i</span>&nbsp;<span class="op" id="5080538">&lt;</span>&nbsp;<span class="builtinfunc" id="5080540">len</span><span class="op" id="5080543">(</span><span class="ident" id="5080544">a</span><span class="op" id="5080545">)</span>&nbsp;<span class="op" id="5080547">&amp;&amp;</span>&nbsp;<span class="ident" id="5080550">i</span>&nbsp;<span class="op" id="5080552">&lt;</span>&nbsp;<span class="builtinfunc" id="5080554">len</span><span class="op" id="5080557">(</span><span class="ident" id="5080558">b</span><span class="op" id="5080559">)</span>&nbsp;<span class="op" id="5080561">&amp;&amp;</span>&nbsp;<span class="ident" id="5080564">a</span><span class="op" id="5080565">[</span><span class="ident" id="5080566">i</span><span class="op" id="5080567">]</span>&nbsp;<span class="op" id="5080569">==</span>&nbsp;<span class="ident" id="5080572">b</span><span class="op" id="5080573">[</span><span class="ident" id="5080574">i</span><span class="op" id="5080575">]</span>&nbsp;<span class="op" id="5080577">&amp;&amp;</span>&nbsp;<span class="op" id="5080580">(</span><span class="ident" id="5080581">a</span><span class="op" id="5080582">[</span><span class="ident" id="5080583">i</span><span class="op" id="5080584">]</span>&nbsp;<span class="op" id="5080586">&lt;=</span>&nbsp;<span class="string" id="5080589">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="5080593">||</span>&nbsp;<span class="ident" id="5080596">a</span><span class="op" id="5080597">[</span><span class="ident" id="5080598">i</span><span class="op" id="5080599">]</span>&nbsp;<span class="op" id="5080601">==</span>&nbsp;<span class="string" id="5080604">&#39;*&#39;</span><span class="op" id="5080607">)</span>&nbsp;<span class="op" id="5080609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5080613">i</span><span class="op" id="5080614">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5080618">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5080621">return</span>&nbsp;<span class="ident" id="5080628">a</span><span class="op" id="5080629">[</span><span class="num" id="5080630">0</span><span class="op" id="5080631">:</span><span class="ident" id="5080632">i</span><span class="op" id="5080633">]</span><br>
<span class="lineno"></span><span class="op" id="5080635">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span><span class="comment" id="5080638">//&nbsp;trimRight&nbsp;returns&nbsp;s&nbsp;with&nbsp;trailing&nbsp;whitespace&nbsp;removed.</span><br>
<span class="lineno"></span><span class="keyword" id="5080695">func</span>&nbsp;<span class="ident" id="5080700">trimRight</span><span class="op" id="5080709">(</span><span class="ident" id="5080710">s</span>&nbsp;<span class="builtintype" id="5080712">string</span><span class="op" id="5080718">)</span>&nbsp;<span class="builtintype" id="5080720">string</span>&nbsp;<span class="op" id="5080727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5080730">return</span>&nbsp;<span class="ident" id="5080737">strings</span><span class="op" id="5080744">.</span><span class="ident" id="5080745">TrimRightFunc</span><span class="op" id="5080758">(</span><span class="ident" id="5080759">s</span><span class="op" id="5080760">,</span>&nbsp;<span class="ident" id="5080762">unicode</span><span class="op" id="5080769">.</span><span class="ident" id="5080770">IsSpace</span><span class="op" id="5080777">)</span><br>
<span class="lineno"></span><span class="op" id="5080779">}</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span><span class="comment" id="5080782">//&nbsp;stripCommonPrefix&nbsp;removes&nbsp;a&nbsp;common&nbsp;prefix&nbsp;from&nbsp;/*-style&nbsp;comment&nbsp;lines&nbsp;(unless&nbsp;no</span><br>
<span class="lineno"></span><span class="comment" id="5080866">//&nbsp;comment&nbsp;line&nbsp;is&nbsp;indented,&nbsp;all&nbsp;but&nbsp;the&nbsp;first&nbsp;line&nbsp;have&nbsp;some&nbsp;form&nbsp;of&nbsp;space&nbsp;prefix).</span><br>
<span class="lineno"></span><span class="comment" id="5080951">//&nbsp;The&nbsp;prefix&nbsp;is&nbsp;computed&nbsp;using&nbsp;heuristics&nbsp;such&nbsp;that&nbsp;is&nbsp;likely&nbsp;that&nbsp;the&nbsp;comment</span><br>
<span class="lineno"></span><span class="comment" id="5081031">//&nbsp;contents&nbsp;are&nbsp;nicely&nbsp;laid&nbsp;out&nbsp;after&nbsp;re-printing&nbsp;each&nbsp;line&nbsp;using&nbsp;the&nbsp;printer&#39;s</span><br>
<span class="lineno">480</span><span class="comment" id="5081111">//&nbsp;current&nbsp;indentation.</span><br>
<span class="lineno"></span><span class="comment" id="5081135">//</span><br>
<span class="lineno"></span><span class="keyword" id="5081138">func</span>&nbsp;<span class="ident" id="5081143">stripCommonPrefix</span><span class="op" id="5081160">(</span><span class="ident" id="5081161">lines</span>&nbsp;<span class="op" id="5081167">[</span><span class="op" id="5081168">]</span><span class="builtintype" id="5081169">string</span><span class="op" id="5081175">)</span>&nbsp;<span class="op" id="5081177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5081180">if</span>&nbsp;<span class="builtinfunc" id="5081183">len</span><span class="op" id="5081186">(</span><span class="ident" id="5081187">lines</span><span class="op" id="5081192">)</span>&nbsp;<span class="op" id="5081194">&lt;=</span>&nbsp;<span class="num" id="5081197">1</span>&nbsp;<span class="op" id="5081199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5081203">return</span>&nbsp;<span class="comment" id="5081210">//&nbsp;at&nbsp;most&nbsp;one&nbsp;line&nbsp;-&nbsp;nothing&nbsp;to&nbsp;do</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5081247">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5081250">//&nbsp;len(lines)&nbsp;&gt;&nbsp;1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5081270">//&nbsp;The&nbsp;heuristic&nbsp;in&nbsp;this&nbsp;function&nbsp;tries&nbsp;to&nbsp;handle&nbsp;a&nbsp;few</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5081327">//&nbsp;common&nbsp;patterns&nbsp;of&nbsp;/*-style&nbsp;comments:&nbsp;Comments&nbsp;where</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5081384">//&nbsp;the&nbsp;opening&nbsp;/*&nbsp;and&nbsp;closing&nbsp;*/&nbsp;are&nbsp;aligned&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5081438">//&nbsp;rest&nbsp;of&nbsp;the&nbsp;comment&nbsp;text&nbsp;is&nbsp;aligned&nbsp;and&nbsp;indented&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5081496">//&nbsp;blanks&nbsp;or&nbsp;tabs,&nbsp;cases&nbsp;with&nbsp;a&nbsp;vertical&nbsp;&#34;line&nbsp;of&nbsp;stars&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5081554">//&nbsp;on&nbsp;the&nbsp;left,&nbsp;and&nbsp;cases&nbsp;where&nbsp;the&nbsp;closing&nbsp;*/&nbsp;is&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5081612">//&nbsp;same&nbsp;line&nbsp;as&nbsp;the&nbsp;last&nbsp;comment&nbsp;text.</span><br>
<span class="lineno">495</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5081653">//&nbsp;Compute&nbsp;maximum&nbsp;common&nbsp;white&nbsp;prefix&nbsp;of&nbsp;all&nbsp;but&nbsp;the&nbsp;first,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5081715">//&nbsp;last,&nbsp;and&nbsp;blank&nbsp;lines,&nbsp;and&nbsp;replace&nbsp;blank&nbsp;lines&nbsp;with&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5081777">//&nbsp;lines&nbsp;(the&nbsp;first&nbsp;line&nbsp;starts&nbsp;with&nbsp;/*&nbsp;and&nbsp;has&nbsp;no&nbsp;prefix).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5081838">//&nbsp;In&nbsp;case&nbsp;of&nbsp;two-line&nbsp;comments,&nbsp;consider&nbsp;the&nbsp;last&nbsp;line&nbsp;for</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5081899">//&nbsp;the&nbsp;prefix&nbsp;computation&nbsp;since&nbsp;otherwise&nbsp;the&nbsp;prefix&nbsp;would</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5081959">//&nbsp;be&nbsp;empty.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5081973">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5081977">//&nbsp;Note&nbsp;that&nbsp;the&nbsp;first&nbsp;and&nbsp;last&nbsp;line&nbsp;are&nbsp;never&nbsp;empty&nbsp;(they</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5082037">//&nbsp;contain&nbsp;the&nbsp;opening&nbsp;/*&nbsp;and&nbsp;closing&nbsp;*/&nbsp;respectively)&nbsp;and</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5082097">//&nbsp;thus&nbsp;they&nbsp;can&nbsp;be&nbsp;ignored&nbsp;by&nbsp;the&nbsp;blank&nbsp;line&nbsp;check.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5082151">var</span>&nbsp;<span class="ident" id="5082155">prefix</span>&nbsp;<span class="builtintype" id="5082162">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5082170">if</span>&nbsp;<span class="builtinfunc" id="5082173">len</span><span class="op" id="5082176">(</span><span class="ident" id="5082177">lines</span><span class="op" id="5082182">)</span>&nbsp;<span class="op" id="5082184">&gt;</span>&nbsp;<span class="num" id="5082186">2</span>&nbsp;<span class="op" id="5082188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5082192">first</span>&nbsp;<span class="op" id="5082198">:=</span>&nbsp;<span class="builtintype" id="5082201">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5082208">for</span>&nbsp;<span class="ident" id="5082212">i</span><span class="op" id="5082213">,</span>&nbsp;<span class="ident" id="5082215">line</span>&nbsp;<span class="op" id="5082220">:=</span>&nbsp;<span class="keyword" id="5082223">range</span>&nbsp;<span class="ident" id="5082229">lines</span><span class="op" id="5082234">[</span><span class="num" id="5082235">1</span>&nbsp;<span class="op" id="5082237">:</span>&nbsp;<span class="builtinfunc" id="5082239">len</span><span class="op" id="5082242">(</span><span class="ident" id="5082243">lines</span><span class="op" id="5082248">)</span><span class="op" id="5082249">-</span><span class="num" id="5082250">1</span><span class="op" id="5082251">]</span>&nbsp;<span class="op" id="5082253">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5082258">switch</span>&nbsp;<span class="op" id="5082265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5082270">case</span>&nbsp;<span class="ident" id="5082275">isBlank</span><span class="op" id="5082282">(</span><span class="ident" id="5082283">line</span><span class="op" id="5082287">)</span><span class="op" id="5082288">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5082294">lines</span><span class="op" id="5082299">[</span><span class="num" id="5082300">1</span><span class="op" id="5082301">+</span><span class="ident" id="5082302">i</span><span class="op" id="5082303">]</span>&nbsp;<span class="op" id="5082305">=</span>&nbsp;<span class="string" id="5082307">&#34;&#34;</span>&nbsp;<span class="comment" id="5082310">//&nbsp;range&nbsp;starts&nbsp;with&nbsp;lines[1]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5082343">case</span>&nbsp;<span class="ident" id="5082348">first</span><span class="op" id="5082353">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5082359">prefix</span>&nbsp;<span class="op" id="5082366">=</span>&nbsp;<span class="ident" id="5082368">commonPrefix</span><span class="op" id="5082380">(</span><span class="ident" id="5082381">line</span><span class="op" id="5082385">,</span>&nbsp;<span class="ident" id="5082387">line</span><span class="op" id="5082391">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5082397">first</span>&nbsp;<span class="op" id="5082403">=</span>&nbsp;<span class="builtintype" id="5082405">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5082414">default</span><span class="op" id="5082421">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5082427">prefix</span>&nbsp;<span class="op" id="5082434">=</span>&nbsp;<span class="ident" id="5082436">commonPrefix</span><span class="op" id="5082448">(</span><span class="ident" id="5082449">prefix</span><span class="op" id="5082455">,</span>&nbsp;<span class="ident" id="5082457">line</span><span class="op" id="5082461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5082466">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5082470">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5082473">}</span>&nbsp;<span class="keyword" id="5082475">else</span>&nbsp;<span class="op" id="5082480">{</span>&nbsp;<span class="comment" id="5082482">//&nbsp;len(lines)&nbsp;==&nbsp;2,&nbsp;lines&nbsp;cannot&nbsp;be&nbsp;blank&nbsp;(contain&nbsp;/*&nbsp;and&nbsp;*/)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5082546">line</span>&nbsp;<span class="op" id="5082551">:=</span>&nbsp;<span class="ident" id="5082554">lines</span><span class="op" id="5082559">[</span><span class="num" id="5082560">1</span><span class="op" id="5082561">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5082565">prefix</span>&nbsp;<span class="op" id="5082572">=</span>&nbsp;<span class="ident" id="5082574">commonPrefix</span><span class="op" id="5082586">(</span><span class="ident" id="5082587">line</span><span class="op" id="5082591">,</span>&nbsp;<span class="ident" id="5082593">line</span><span class="op" id="5082597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5082600">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5082604">/*<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Check&nbsp;for&nbsp;vertical&nbsp;&#34;line&nbsp;of&nbsp;stars&#34;&nbsp;and&nbsp;correct&nbsp;prefix&nbsp;accordingly.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5082684">lineOfStars</span>&nbsp;<span class="op" id="5082696">:=</span>&nbsp;<span class="builtintype" id="5082699">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5082706">if</span>&nbsp;<span class="ident" id="5082709">i</span>&nbsp;<span class="op" id="5082711">:=</span>&nbsp;<span class="ident" id="5082714">strings</span><span class="op" id="5082721">.</span><span class="ident" id="5082722">Index</span><span class="op" id="5082727">(</span><span class="ident" id="5082728">prefix</span><span class="op" id="5082734">,</span>&nbsp;<span class="string" id="5082736">&#34;*&#34;</span><span class="op" id="5082739">)</span><span class="op" id="5082740">;</span>&nbsp;<span class="ident" id="5082742">i</span>&nbsp;<span class="op" id="5082744">&gt;=</span>&nbsp;<span class="num" id="5082747">0</span>&nbsp;<span class="op" id="5082749">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5082753">//&nbsp;Line&nbsp;of&nbsp;stars&nbsp;present.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5082781">if</span>&nbsp;<span class="ident" id="5082784">i</span>&nbsp;<span class="op" id="5082786">&gt;</span>&nbsp;<span class="num" id="5082788">0</span>&nbsp;<span class="op" id="5082790">&amp;&amp;</span>&nbsp;<span class="ident" id="5082793">prefix</span><span class="op" id="5082799">[</span><span class="ident" id="5082800">i</span><span class="op" id="5082801">-</span><span class="num" id="5082802">1</span><span class="op" id="5082803">]</span>&nbsp;<span class="op" id="5082805">==</span>&nbsp;<span class="string" id="5082808">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="5082812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5082817">i</span><span class="op" id="5082818">--</span>&nbsp;<span class="comment" id="5082821">//&nbsp;remove&nbsp;trailing&nbsp;blank&nbsp;from&nbsp;prefix&nbsp;so&nbsp;stars&nbsp;remain&nbsp;aligned</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5082884">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5082888">prefix</span>&nbsp;<span class="op" id="5082895">=</span>&nbsp;<span class="ident" id="5082897">prefix</span><span class="op" id="5082903">[</span><span class="num" id="5082904">0</span><span class="op" id="5082905">:</span><span class="ident" id="5082906">i</span><span class="op" id="5082907">]</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5082911">lineOfStars</span>&nbsp;<span class="op" id="5082923">=</span>&nbsp;<span class="builtintype" id="5082925">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5082931">}</span>&nbsp;<span class="keyword" id="5082933">else</span>&nbsp;<span class="op" id="5082938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5082942">//&nbsp;No&nbsp;line&nbsp;of&nbsp;stars&nbsp;present.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5082973">//&nbsp;Determine&nbsp;the&nbsp;white&nbsp;space&nbsp;on&nbsp;the&nbsp;first&nbsp;line&nbsp;after&nbsp;the&nbsp;/*</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5083035">//&nbsp;and&nbsp;before&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;comment&nbsp;text,&nbsp;assume&nbsp;two</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5083097">//&nbsp;blanks&nbsp;instead&nbsp;of&nbsp;the&nbsp;/*&nbsp;unless&nbsp;the&nbsp;first&nbsp;character&nbsp;after</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5083160">//&nbsp;the&nbsp;/*&nbsp;is&nbsp;a&nbsp;tab.&nbsp;If&nbsp;the&nbsp;first&nbsp;comment&nbsp;line&nbsp;is&nbsp;empty&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5083221">//&nbsp;for&nbsp;the&nbsp;opening&nbsp;/*,&nbsp;assume&nbsp;up&nbsp;to&nbsp;3&nbsp;blanks&nbsp;or&nbsp;a&nbsp;tab.&nbsp;This</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5083283">//&nbsp;whitespace&nbsp;may&nbsp;be&nbsp;found&nbsp;as&nbsp;suffix&nbsp;in&nbsp;the&nbsp;common&nbsp;prefix.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5083344">first</span>&nbsp;<span class="op" id="5083350">:=</span>&nbsp;<span class="ident" id="5083353">lines</span><span class="op" id="5083358">[</span><span class="num" id="5083359">0</span><span class="op" id="5083360">]</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5083364">if</span>&nbsp;<span class="ident" id="5083367">isBlank</span><span class="op" id="5083374">(</span><span class="ident" id="5083375">first</span><span class="op" id="5083380">[</span><span class="num" id="5083381">2</span><span class="op" id="5083382">:</span><span class="op" id="5083383">]</span><span class="op" id="5083384">)</span>&nbsp;<span class="op" id="5083386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5083391">//&nbsp;no&nbsp;comment&nbsp;text&nbsp;on&nbsp;the&nbsp;first&nbsp;line:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5083432">//&nbsp;reduce&nbsp;prefix&nbsp;by&nbsp;up&nbsp;to&nbsp;3&nbsp;blanks&nbsp;or&nbsp;a&nbsp;tab</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5083479">//&nbsp;if&nbsp;present&nbsp;-&nbsp;this&nbsp;keeps&nbsp;comment&nbsp;text&nbsp;indented</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5083531">//&nbsp;relative&nbsp;to&nbsp;the&nbsp;/*&nbsp;and&nbsp;*/&#39;s&nbsp;if&nbsp;it&nbsp;was&nbsp;indented</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5083584">//&nbsp;in&nbsp;the&nbsp;first&nbsp;place</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5083609">i</span>&nbsp;<span class="op" id="5083611">:=</span>&nbsp;<span class="builtinfunc" id="5083614">len</span><span class="op" id="5083617">(</span><span class="ident" id="5083618">prefix</span><span class="op" id="5083624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5083629">for</span>&nbsp;<span class="ident" id="5083633">n</span>&nbsp;<span class="op" id="5083635">:=</span>&nbsp;<span class="num" id="5083638">0</span><span class="op" id="5083639">;</span>&nbsp;<span class="ident" id="5083641">n</span>&nbsp;<span class="op" id="5083643">&lt;</span>&nbsp;<span class="num" id="5083645">3</span>&nbsp;<span class="op" id="5083647">&amp;&amp;</span>&nbsp;<span class="ident" id="5083650">i</span>&nbsp;<span class="op" id="5083652">&gt;</span>&nbsp;<span class="num" id="5083654">0</span>&nbsp;<span class="op" id="5083656">&amp;&amp;</span>&nbsp;<span class="ident" id="5083659">prefix</span><span class="op" id="5083665">[</span><span class="ident" id="5083666">i</span><span class="op" id="5083667">-</span><span class="num" id="5083668">1</span><span class="op" id="5083669">]</span>&nbsp;<span class="op" id="5083671">==</span>&nbsp;<span class="string" id="5083674">&#39;&nbsp;&#39;</span><span class="op" id="5083677">;</span>&nbsp;<span class="ident" id="5083679">n</span><span class="op" id="5083680">++</span>&nbsp;<span class="op" id="5083683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5083689">i</span><span class="op" id="5083690">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5083696">}</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5083701">if</span>&nbsp;<span class="ident" id="5083704">i</span>&nbsp;<span class="op" id="5083706">==</span>&nbsp;<span class="builtinfunc" id="5083709">len</span><span class="op" id="5083712">(</span><span class="ident" id="5083713">prefix</span><span class="op" id="5083719">)</span>&nbsp;<span class="op" id="5083721">&amp;&amp;</span>&nbsp;<span class="ident" id="5083724">i</span>&nbsp;<span class="op" id="5083726">&gt;</span>&nbsp;<span class="num" id="5083728">0</span>&nbsp;<span class="op" id="5083730">&amp;&amp;</span>&nbsp;<span class="ident" id="5083733">prefix</span><span class="op" id="5083739">[</span><span class="ident" id="5083740">i</span><span class="op" id="5083741">-</span><span class="num" id="5083742">1</span><span class="op" id="5083743">]</span>&nbsp;<span class="op" id="5083745">==</span>&nbsp;<span class="string" id="5083748">&#39;\t&#39;</span>&nbsp;<span class="op" id="5083753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5083759">i</span><span class="op" id="5083760">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5083766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5083771">prefix</span>&nbsp;<span class="op" id="5083778">=</span>&nbsp;<span class="ident" id="5083780">prefix</span><span class="op" id="5083786">[</span><span class="num" id="5083787">0</span><span class="op" id="5083788">:</span><span class="ident" id="5083789">i</span><span class="op" id="5083790">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5083794">}</span>&nbsp;<span class="keyword" id="5083796">else</span>&nbsp;<span class="op" id="5083801">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5083806">//&nbsp;comment&nbsp;text&nbsp;on&nbsp;the&nbsp;first&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5083843">suffix</span>&nbsp;<span class="op" id="5083850">:=</span>&nbsp;<span class="builtinfunc" id="5083853">make</span><span class="op" id="5083857">(</span><span class="op" id="5083858">[</span><span class="op" id="5083859">]</span><span class="builtintype" id="5083860">byte</span><span class="op" id="5083864">,</span>&nbsp;<span class="builtinfunc" id="5083866">len</span><span class="op" id="5083869">(</span><span class="ident" id="5083870">first</span><span class="op" id="5083875">)</span><span class="op" id="5083876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5083881">n</span>&nbsp;<span class="op" id="5083883">:=</span>&nbsp;<span class="num" id="5083886">2</span>&nbsp;<span class="comment" id="5083888">//&nbsp;start&nbsp;after&nbsp;opening&nbsp;/*</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5083917">for</span>&nbsp;<span class="ident" id="5083921">n</span>&nbsp;<span class="op" id="5083923">&lt;</span>&nbsp;<span class="builtinfunc" id="5083925">len</span><span class="op" id="5083928">(</span><span class="ident" id="5083929">first</span><span class="op" id="5083934">)</span>&nbsp;<span class="op" id="5083936">&amp;&amp;</span>&nbsp;<span class="ident" id="5083939">first</span><span class="op" id="5083944">[</span><span class="ident" id="5083945">n</span><span class="op" id="5083946">]</span>&nbsp;<span class="op" id="5083948">&lt;=</span>&nbsp;<span class="string" id="5083951">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="5083955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5083961">suffix</span><span class="op" id="5083967">[</span><span class="ident" id="5083968">n</span><span class="op" id="5083969">]</span>&nbsp;<span class="op" id="5083971">=</span>&nbsp;<span class="ident" id="5083973">first</span><span class="op" id="5083978">[</span><span class="ident" id="5083979">n</span><span class="op" id="5083980">]</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5083986">n</span><span class="op" id="5083987">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5083993">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5083998">if</span>&nbsp;<span class="ident" id="5084001">n</span>&nbsp;<span class="op" id="5084003">&gt;</span>&nbsp;<span class="num" id="5084005">2</span>&nbsp;<span class="op" id="5084007">&amp;&amp;</span>&nbsp;<span class="ident" id="5084010">suffix</span><span class="op" id="5084016">[</span><span class="num" id="5084017">2</span><span class="op" id="5084018">]</span>&nbsp;<span class="op" id="5084020">==</span>&nbsp;<span class="string" id="5084023">&#39;\t&#39;</span>&nbsp;<span class="op" id="5084028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5084034">//&nbsp;assume&nbsp;the&nbsp;&#39;\t&#39;&nbsp;compensates&nbsp;for&nbsp;the&nbsp;/*</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5084080">suffix</span>&nbsp;<span class="op" id="5084087">=</span>&nbsp;<span class="ident" id="5084089">suffix</span><span class="op" id="5084095">[</span><span class="num" id="5084096">2</span><span class="op" id="5084097">:</span><span class="ident" id="5084098">n</span><span class="op" id="5084099">]</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5084104">}</span>&nbsp;<span class="keyword" id="5084106">else</span>&nbsp;<span class="op" id="5084111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5084117">//&nbsp;otherwise&nbsp;assume&nbsp;two&nbsp;blanks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5084152">suffix</span><span class="op" id="5084158">[</span><span class="num" id="5084159">0</span><span class="op" id="5084160">]</span><span class="op" id="5084161">,</span>&nbsp;<span class="ident" id="5084163">suffix</span><span class="op" id="5084169">[</span><span class="num" id="5084170">1</span><span class="op" id="5084171">]</span>&nbsp;<span class="op" id="5084173">=</span>&nbsp;<span class="string" id="5084175">&#39;&nbsp;&#39;</span><span class="op" id="5084178">,</span>&nbsp;<span class="string" id="5084180">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5084188">suffix</span>&nbsp;<span class="op" id="5084195">=</span>&nbsp;<span class="ident" id="5084197">suffix</span><span class="op" id="5084203">[</span><span class="num" id="5084204">0</span><span class="op" id="5084205">:</span><span class="ident" id="5084206">n</span><span class="op" id="5084207">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5084212">}</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5084217">//&nbsp;Shorten&nbsp;the&nbsp;computed&nbsp;common&nbsp;prefix&nbsp;by&nbsp;the&nbsp;length&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5084275">//&nbsp;suffix,&nbsp;if&nbsp;it&nbsp;is&nbsp;found&nbsp;as&nbsp;suffix&nbsp;of&nbsp;the&nbsp;prefix.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5084329">prefix</span>&nbsp;<span class="op" id="5084336">=</span>&nbsp;<span class="ident" id="5084338">strings</span><span class="op" id="5084345">.</span><span class="ident" id="5084346">TrimSuffix</span><span class="op" id="5084356">(</span><span class="ident" id="5084357">prefix</span><span class="op" id="5084363">,</span>&nbsp;<span class="builtintype" id="5084365">string</span><span class="op" id="5084371">(</span><span class="ident" id="5084372">suffix</span><span class="op" id="5084378">)</span><span class="op" id="5084379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5084383">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5084386">}</span><br>
<span class="lineno">580</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5084390">//&nbsp;Handle&nbsp;last&nbsp;line:&nbsp;If&nbsp;it&nbsp;only&nbsp;contains&nbsp;a&nbsp;closing&nbsp;*/,&nbsp;align&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5084455">//&nbsp;with&nbsp;the&nbsp;opening&nbsp;/*,&nbsp;otherwise&nbsp;align&nbsp;the&nbsp;text&nbsp;with&nbsp;the&nbsp;other</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5084520">//&nbsp;lines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5084531">last</span>&nbsp;<span class="op" id="5084536">:=</span>&nbsp;<span class="ident" id="5084539">lines</span><span class="op" id="5084544">[</span><span class="builtinfunc" id="5084545">len</span><span class="op" id="5084548">(</span><span class="ident" id="5084549">lines</span><span class="op" id="5084554">)</span><span class="op" id="5084555">-</span><span class="num" id="5084556">1</span><span class="op" id="5084557">]</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5084560">closing</span>&nbsp;<span class="op" id="5084568">:=</span>&nbsp;<span class="string" id="5084571">&#34;*/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5084577">i</span>&nbsp;<span class="op" id="5084579">:=</span>&nbsp;<span class="ident" id="5084582">strings</span><span class="op" id="5084589">.</span><span class="ident" id="5084590">Index</span><span class="op" id="5084595">(</span><span class="ident" id="5084596">last</span><span class="op" id="5084600">,</span>&nbsp;<span class="ident" id="5084602">closing</span><span class="op" id="5084609">)</span>&nbsp;<span class="comment" id="5084611">//&nbsp;i&nbsp;&gt;=&nbsp;0&nbsp;(closing&nbsp;is&nbsp;always&nbsp;present)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5084650">if</span>&nbsp;<span class="ident" id="5084653">isBlank</span><span class="op" id="5084660">(</span><span class="ident" id="5084661">last</span><span class="op" id="5084665">[</span><span class="num" id="5084666">0</span><span class="op" id="5084667">:</span><span class="ident" id="5084668">i</span><span class="op" id="5084669">]</span><span class="op" id="5084670">)</span>&nbsp;<span class="op" id="5084672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5084676">//&nbsp;last&nbsp;line&nbsp;only&nbsp;contains&nbsp;closing&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5084716">if</span>&nbsp;<span class="ident" id="5084719">lineOfStars</span>&nbsp;<span class="op" id="5084731">{</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5084736">closing</span>&nbsp;<span class="op" id="5084744">=</span>&nbsp;<span class="string" id="5084746">&#34;&nbsp;*/&#34;</span>&nbsp;<span class="comment" id="5084752">//&nbsp;add&nbsp;blank&nbsp;to&nbsp;align&nbsp;final&nbsp;star</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5084787">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5084791">lines</span><span class="op" id="5084796">[</span><span class="builtinfunc" id="5084797">len</span><span class="op" id="5084800">(</span><span class="ident" id="5084801">lines</span><span class="op" id="5084806">)</span><span class="op" id="5084807">-</span><span class="num" id="5084808">1</span><span class="op" id="5084809">]</span>&nbsp;<span class="op" id="5084811">=</span>&nbsp;<span class="ident" id="5084813">prefix</span>&nbsp;<span class="op" id="5084820">+</span>&nbsp;<span class="ident" id="5084822">closing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5084831">}</span>&nbsp;<span class="keyword" id="5084833">else</span>&nbsp;<span class="op" id="5084838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5084842">//&nbsp;last&nbsp;line&nbsp;contains&nbsp;more&nbsp;comment&nbsp;text&nbsp;-&nbsp;assume</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5084893">//&nbsp;it&nbsp;is&nbsp;aligned&nbsp;like&nbsp;the&nbsp;other&nbsp;lines&nbsp;and&nbsp;include</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5084945">//&nbsp;in&nbsp;prefix&nbsp;computation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5084972">prefix</span>&nbsp;<span class="op" id="5084979">=</span>&nbsp;<span class="ident" id="5084981">commonPrefix</span><span class="op" id="5084993">(</span><span class="ident" id="5084994">prefix</span><span class="op" id="5085000">,</span>&nbsp;<span class="ident" id="5085002">last</span><span class="op" id="5085006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5085009">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5085013">//&nbsp;Remove&nbsp;the&nbsp;common&nbsp;prefix&nbsp;from&nbsp;all&nbsp;but&nbsp;the&nbsp;first&nbsp;and&nbsp;empty&nbsp;lines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5085082">for</span>&nbsp;<span class="ident" id="5085086">i</span><span class="op" id="5085087">,</span>&nbsp;<span class="ident" id="5085089">line</span>&nbsp;<span class="op" id="5085094">:=</span>&nbsp;<span class="keyword" id="5085097">range</span>&nbsp;<span class="ident" id="5085103">lines</span>&nbsp;<span class="op" id="5085109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5085113">if</span>&nbsp;<span class="ident" id="5085116">i</span>&nbsp;<span class="op" id="5085118">&gt;</span>&nbsp;<span class="num" id="5085120">0</span>&nbsp;<span class="op" id="5085122">&amp;&amp;</span>&nbsp;<span class="ident" id="5085125">line</span>&nbsp;<span class="op" id="5085130">!=</span>&nbsp;<span class="string" id="5085133">&#34;&#34;</span>&nbsp;<span class="op" id="5085136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5085141">lines</span><span class="op" id="5085146">[</span><span class="ident" id="5085147">i</span><span class="op" id="5085148">]</span>&nbsp;<span class="op" id="5085150">=</span>&nbsp;<span class="ident" id="5085152">line</span><span class="op" id="5085156">[</span><span class="builtinfunc" id="5085157">len</span><span class="op" id="5085160">(</span><span class="ident" id="5085161">prefix</span><span class="op" id="5085167">)</span><span class="op" id="5085168">:</span><span class="op" id="5085169">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5085173">}</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5085176">}</span><br>
<span class="lineno"></span><span class="op" id="5085178">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5085181">func</span>&nbsp;<span class="op" id="5085186">(</span><span class="ident" id="5085187">p</span>&nbsp;<span class="op" id="5085189">*</span><span class="ident" id="5085190">printer</span><span class="op" id="5085197">)</span>&nbsp;<span class="ident" id="5085199">writeComment</span><span class="op" id="5085211">(</span><span class="ident" id="5085212">comment</span>&nbsp;<span class="op" id="5085220">*</span><span class="ident" id="5085221">ast</span><span class="op" id="5085224">.</span><span class="ident" id="5085225">Comment</span><span class="op" id="5085232">)</span>&nbsp;<span class="op" id="5085234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5085237">text</span>&nbsp;<span class="op" id="5085242">:=</span>&nbsp;<span class="ident" id="5085245">comment</span><span class="op" id="5085252">.</span><span class="ident" id="5085253">Text</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5085259">pos</span>&nbsp;<span class="op" id="5085263">:=</span>&nbsp;<span class="ident" id="5085266">p</span><span class="op" id="5085267">.</span><span class="ident" id="5085268">posFor</span><span class="op" id="5085274">(</span><span class="ident" id="5085275">comment</span><span class="op" id="5085282">.</span><span class="ident" id="5085283">Pos</span><span class="op" id="5085286">(</span><span class="op" id="5085287">)</span><span class="op" id="5085288">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5085292">const</span>&nbsp;<span class="ident" id="5085298">linePrefix</span>&nbsp;<span class="op" id="5085309">=</span>&nbsp;<span class="string" id="5085311">&#34;//line&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5085322">if</span>&nbsp;<span class="ident" id="5085325">strings</span><span class="op" id="5085332">.</span><span class="ident" id="5085333">HasPrefix</span><span class="op" id="5085342">(</span><span class="ident" id="5085343">text</span><span class="op" id="5085347">,</span>&nbsp;<span class="ident" id="5085349">linePrefix</span><span class="op" id="5085359">)</span>&nbsp;<span class="op" id="5085361">&amp;&amp;</span>&nbsp;<span class="op" id="5085364">(</span><span class="op" id="5085365">!</span><span class="ident" id="5085366">pos</span><span class="op" id="5085369">.</span><span class="ident" id="5085370">IsValid</span><span class="op" id="5085377">(</span><span class="op" id="5085378">)</span>&nbsp;<span class="op" id="5085380">||</span>&nbsp;<span class="ident" id="5085383">pos</span><span class="op" id="5085386">.</span><span class="ident" id="5085387">Column</span>&nbsp;<span class="op" id="5085394">==</span>&nbsp;<span class="num" id="5085397">1</span><span class="op" id="5085398">)</span>&nbsp;<span class="op" id="5085400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5085404">//&nbsp;possibly&nbsp;a&nbsp;line&nbsp;directive</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5085435">ldir</span>&nbsp;<span class="op" id="5085440">:=</span>&nbsp;<span class="ident" id="5085443">strings</span><span class="op" id="5085450">.</span><span class="ident" id="5085451">TrimSpace</span><span class="op" id="5085460">(</span><span class="ident" id="5085461">text</span><span class="op" id="5085465">[</span><span class="builtinfunc" id="5085466">len</span><span class="op" id="5085469">(</span><span class="ident" id="5085470">linePrefix</span><span class="op" id="5085480">)</span><span class="op" id="5085481">:</span><span class="op" id="5085482">]</span><span class="op" id="5085483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5085487">if</span>&nbsp;<span class="ident" id="5085490">i</span>&nbsp;<span class="op" id="5085492">:=</span>&nbsp;<span class="ident" id="5085495">strings</span><span class="op" id="5085502">.</span><span class="ident" id="5085503">LastIndex</span><span class="op" id="5085512">(</span><span class="ident" id="5085513">ldir</span><span class="op" id="5085517">,</span>&nbsp;<span class="string" id="5085519">&#34;:&#34;</span><span class="op" id="5085522">)</span><span class="op" id="5085523">;</span>&nbsp;<span class="ident" id="5085525">i</span>&nbsp;<span class="op" id="5085527">&gt;=</span>&nbsp;<span class="num" id="5085530">0</span>&nbsp;<span class="op" id="5085532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5085537">if</span>&nbsp;<span class="ident" id="5085540">line</span><span class="op" id="5085544">,</span>&nbsp;<span class="ident" id="5085546">err</span>&nbsp;<span class="op" id="5085550">:=</span>&nbsp;<span class="ident" id="5085553">strconv</span><span class="op" id="5085560">.</span><span class="ident" id="5085561">Atoi</span><span class="op" id="5085565">(</span><span class="ident" id="5085566">ldir</span><span class="op" id="5085570">[</span><span class="ident" id="5085571">i</span><span class="op" id="5085572">+</span><span class="num" id="5085573">1</span><span class="op" id="5085574">:</span><span class="op" id="5085575">]</span><span class="op" id="5085576">)</span><span class="op" id="5085577">;</span>&nbsp;<span class="ident" id="5085579">err</span>&nbsp;<span class="op" id="5085583">==</span>&nbsp;<span class="builtintype" id="5085586">nil</span>&nbsp;<span class="op" id="5085590">&amp;&amp;</span>&nbsp;<span class="ident" id="5085593">line</span>&nbsp;<span class="op" id="5085598">&gt;</span>&nbsp;<span class="num" id="5085600">0</span>&nbsp;<span class="op" id="5085602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5085608">//&nbsp;The&nbsp;line&nbsp;directive&nbsp;we&nbsp;are&nbsp;about&nbsp;to&nbsp;print&nbsp;changed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5085664">//&nbsp;the&nbsp;Filename&nbsp;and&nbsp;Line&nbsp;number&nbsp;used&nbsp;for&nbsp;subsequent</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5085720">//&nbsp;tokens.&nbsp;We&nbsp;have&nbsp;to&nbsp;update&nbsp;our&nbsp;AST-space&nbsp;position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5085776">//&nbsp;accordingly&nbsp;and&nbsp;suspend&nbsp;indentation&nbsp;temporarily.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5085832">indent</span>&nbsp;<span class="op" id="5085839">:=</span>&nbsp;<span class="ident" id="5085842">p</span><span class="op" id="5085843">.</span><span class="ident" id="5085844">indent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5085855">p</span><span class="op" id="5085856">.</span><span class="ident" id="5085857">indent</span>&nbsp;<span class="op" id="5085864">=</span>&nbsp;<span class="num" id="5085866">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5085872">defer</span>&nbsp;<span class="keyword" id="5085878">func</span><span class="op" id="5085882">(</span><span class="op" id="5085883">)</span>&nbsp;<span class="op" id="5085885">{</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5085892">p</span><span class="op" id="5085893">.</span><span class="ident" id="5085894">pos</span><span class="op" id="5085897">.</span><span class="ident" id="5085898">Filename</span>&nbsp;<span class="op" id="5085907">=</span>&nbsp;<span class="ident" id="5085909">ldir</span><span class="op" id="5085913">[</span><span class="op" id="5085914">:</span><span class="ident" id="5085915">i</span><span class="op" id="5085916">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5085923">p</span><span class="op" id="5085924">.</span><span class="ident" id="5085925">pos</span><span class="op" id="5085928">.</span><span class="ident" id="5085929">Line</span>&nbsp;<span class="op" id="5085934">=</span>&nbsp;<span class="ident" id="5085936">line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5085946">p</span><span class="op" id="5085947">.</span><span class="ident" id="5085948">pos</span><span class="op" id="5085951">.</span><span class="ident" id="5085952">Column</span>&nbsp;<span class="op" id="5085959">=</span>&nbsp;<span class="num" id="5085961">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5085968">p</span><span class="op" id="5085969">.</span><span class="ident" id="5085970">indent</span>&nbsp;<span class="op" id="5085977">=</span>&nbsp;<span class="ident" id="5085979">indent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5085990">}</span><span class="op" id="5085991">(</span><span class="op" id="5085992">)</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5085997">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5086001">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5086004">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5086008">//&nbsp;shortcut&nbsp;common&nbsp;case&nbsp;of&nbsp;//-style&nbsp;comments</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5086054">if</span>&nbsp;<span class="ident" id="5086057">text</span><span class="op" id="5086061">[</span><span class="num" id="5086062">1</span><span class="op" id="5086063">]</span>&nbsp;<span class="op" id="5086065">==</span>&nbsp;<span class="string" id="5086068">&#39;/&#39;</span>&nbsp;<span class="op" id="5086072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5086076">p</span><span class="op" id="5086077">.</span><span class="ident" id="5086078">writeString</span><span class="op" id="5086089">(</span><span class="ident" id="5086090">pos</span><span class="op" id="5086093">,</span>&nbsp;<span class="ident" id="5086095">trimRight</span><span class="op" id="5086104">(</span><span class="ident" id="5086105">text</span><span class="op" id="5086109">)</span><span class="op" id="5086110">,</span>&nbsp;<span class="builtintype" id="5086112">true</span><span class="op" id="5086116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5086120">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5086128">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5086132">//&nbsp;for&nbsp;/*-style&nbsp;comments,&nbsp;print&nbsp;line&nbsp;by&nbsp;line&nbsp;and&nbsp;let&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5086190">//&nbsp;write&nbsp;function&nbsp;take&nbsp;care&nbsp;of&nbsp;the&nbsp;proper&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5086245">lines</span>&nbsp;<span class="op" id="5086251">:=</span>&nbsp;<span class="ident" id="5086254">strings</span><span class="op" id="5086261">.</span><span class="ident" id="5086262">Split</span><span class="op" id="5086267">(</span><span class="ident" id="5086268">text</span><span class="op" id="5086272">,</span>&nbsp;<span class="string" id="5086274">&#34;\n&#34;</span><span class="op" id="5086278">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5086282">//&nbsp;The&nbsp;comment&nbsp;started&nbsp;in&nbsp;the&nbsp;first&nbsp;column&nbsp;but&nbsp;is&nbsp;going</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5086339">//&nbsp;to&nbsp;be&nbsp;indented.&nbsp;For&nbsp;an&nbsp;idempotent&nbsp;result,&nbsp;add&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5086401">//&nbsp;to&nbsp;all&nbsp;lines&nbsp;such&nbsp;that&nbsp;they&nbsp;look&nbsp;like&nbsp;they&nbsp;were&nbsp;indented</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5086462">//&nbsp;before&nbsp;-&nbsp;this&nbsp;will&nbsp;make&nbsp;sure&nbsp;the&nbsp;common&nbsp;prefix&nbsp;computation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5086525">//&nbsp;is&nbsp;the&nbsp;same&nbsp;independent&nbsp;of&nbsp;how&nbsp;many&nbsp;times&nbsp;formatting&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5086585">//&nbsp;applied&nbsp;(was&nbsp;issue&nbsp;1835).</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5086615">if</span>&nbsp;<span class="ident" id="5086618">pos</span><span class="op" id="5086621">.</span><span class="ident" id="5086622">IsValid</span><span class="op" id="5086629">(</span><span class="op" id="5086630">)</span>&nbsp;<span class="op" id="5086632">&amp;&amp;</span>&nbsp;<span class="ident" id="5086635">pos</span><span class="op" id="5086638">.</span><span class="ident" id="5086639">Column</span>&nbsp;<span class="op" id="5086646">==</span>&nbsp;<span class="num" id="5086649">1</span>&nbsp;<span class="op" id="5086651">&amp;&amp;</span>&nbsp;<span class="ident" id="5086654">p</span><span class="op" id="5086655">.</span><span class="ident" id="5086656">indent</span>&nbsp;<span class="op" id="5086663">&gt;</span>&nbsp;<span class="num" id="5086665">0</span>&nbsp;<span class="op" id="5086667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5086671">for</span>&nbsp;<span class="ident" id="5086675">i</span><span class="op" id="5086676">,</span>&nbsp;<span class="ident" id="5086678">line</span>&nbsp;<span class="op" id="5086683">:=</span>&nbsp;<span class="keyword" id="5086686">range</span>&nbsp;<span class="ident" id="5086692">lines</span><span class="op" id="5086697">[</span><span class="num" id="5086698">1</span><span class="op" id="5086699">:</span><span class="op" id="5086700">]</span>&nbsp;<span class="op" id="5086702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5086707">lines</span><span class="op" id="5086712">[</span><span class="num" id="5086713">1</span><span class="op" id="5086714">+</span><span class="ident" id="5086715">i</span><span class="op" id="5086716">]</span>&nbsp;<span class="op" id="5086718">=</span>&nbsp;<span class="string" id="5086720">&#34;&nbsp;&nbsp;&nbsp;&#34;</span>&nbsp;<span class="op" id="5086726">+</span>&nbsp;<span class="ident" id="5086728">line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5086735">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5086738">}</span><br>
<span class="lineno">655</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5086742">stripCommonPrefix</span><span class="op" id="5086759">(</span><span class="ident" id="5086760">lines</span><span class="op" id="5086765">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5086769">//&nbsp;write&nbsp;comment&nbsp;lines,&nbsp;separated&nbsp;by&nbsp;formfeed,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5086817">//&nbsp;without&nbsp;a&nbsp;line&nbsp;break&nbsp;after&nbsp;the&nbsp;last&nbsp;line</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5086862">for</span>&nbsp;<span class="ident" id="5086866">i</span><span class="op" id="5086867">,</span>&nbsp;<span class="ident" id="5086869">line</span>&nbsp;<span class="op" id="5086874">:=</span>&nbsp;<span class="keyword" id="5086877">range</span>&nbsp;<span class="ident" id="5086883">lines</span>&nbsp;<span class="op" id="5086889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5086893">if</span>&nbsp;<span class="ident" id="5086896">i</span>&nbsp;<span class="op" id="5086898">&gt;</span>&nbsp;<span class="num" id="5086900">0</span>&nbsp;<span class="op" id="5086902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5086907">p</span><span class="op" id="5086908">.</span><span class="ident" id="5086909">writeByte</span><span class="op" id="5086918">(</span><span class="string" id="5086919">&#39;\f&#39;</span><span class="op" id="5086923">,</span>&nbsp;<span class="num" id="5086925">1</span><span class="op" id="5086926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5086931">pos</span>&nbsp;<span class="op" id="5086935">=</span>&nbsp;<span class="ident" id="5086937">p</span><span class="op" id="5086938">.</span><span class="ident" id="5086939">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5086945">}</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5086949">if</span>&nbsp;<span class="builtinfunc" id="5086952">len</span><span class="op" id="5086955">(</span><span class="ident" id="5086956">line</span><span class="op" id="5086960">)</span>&nbsp;<span class="op" id="5086962">&gt;</span>&nbsp;<span class="num" id="5086964">0</span>&nbsp;<span class="op" id="5086966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5086971">p</span><span class="op" id="5086972">.</span><span class="ident" id="5086973">writeString</span><span class="op" id="5086984">(</span><span class="ident" id="5086985">pos</span><span class="op" id="5086988">,</span>&nbsp;<span class="ident" id="5086990">trimRight</span><span class="op" id="5086999">(</span><span class="ident" id="5087000">line</span><span class="op" id="5087004">)</span><span class="op" id="5087005">,</span>&nbsp;<span class="builtintype" id="5087007">true</span><span class="op" id="5087011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5087015">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5087018">}</span><br>
<span class="lineno"></span><span class="op" id="5087020">}</span><br>
<span class="lineno">670</span><br>
<span class="lineno"></span><span class="comment" id="5087023">//&nbsp;writeCommentSuffix&nbsp;writes&nbsp;a&nbsp;line&nbsp;break&nbsp;after&nbsp;a&nbsp;comment&nbsp;if&nbsp;indicated</span><br>
<span class="lineno"></span><span class="comment" id="5087094">//&nbsp;and&nbsp;processes&nbsp;any&nbsp;leftover&nbsp;indentation&nbsp;information.&nbsp;If&nbsp;a&nbsp;line&nbsp;break</span><br>
<span class="lineno"></span><span class="comment" id="5087165">//&nbsp;is&nbsp;needed,&nbsp;the&nbsp;kind&nbsp;of&nbsp;break&nbsp;(newline&nbsp;vs&nbsp;formfeed)&nbsp;depends&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5087234">//&nbsp;pending&nbsp;whitespace.&nbsp;The&nbsp;writeCommentSuffix&nbsp;result&nbsp;indicates&nbsp;if&nbsp;a</span><br>
<span class="lineno">675</span><span class="comment" id="5087302">//&nbsp;newline&nbsp;was&nbsp;written&nbsp;or&nbsp;if&nbsp;a&nbsp;formfeed&nbsp;was&nbsp;dropped&nbsp;from&nbsp;the&nbsp;whitespace</span><br>
<span class="lineno"></span><span class="comment" id="5087374">//&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="5087385">//</span><br>
<span class="lineno"></span><span class="keyword" id="5087388">func</span>&nbsp;<span class="op" id="5087393">(</span><span class="ident" id="5087394">p</span>&nbsp;<span class="op" id="5087396">*</span><span class="ident" id="5087397">printer</span><span class="op" id="5087404">)</span>&nbsp;<span class="ident" id="5087406">writeCommentSuffix</span><span class="op" id="5087424">(</span><span class="ident" id="5087425">needsLinebreak</span>&nbsp;<span class="builtintype" id="5087440">bool</span><span class="op" id="5087444">)</span>&nbsp;<span class="op" id="5087446">(</span><span class="ident" id="5087447">wroteNewline</span><span class="op" id="5087459">,</span>&nbsp;<span class="ident" id="5087461">droppedFF</span>&nbsp;<span class="builtintype" id="5087471">bool</span><span class="op" id="5087475">)</span>&nbsp;<span class="op" id="5087477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5087480">for</span>&nbsp;<span class="ident" id="5087484">i</span><span class="op" id="5087485">,</span>&nbsp;<span class="ident" id="5087487">ch</span>&nbsp;<span class="op" id="5087490">:=</span>&nbsp;<span class="keyword" id="5087493">range</span>&nbsp;<span class="ident" id="5087499">p</span><span class="op" id="5087500">.</span><span class="ident" id="5087501">wsbuf</span>&nbsp;<span class="op" id="5087507">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5087511">switch</span>&nbsp;<span class="ident" id="5087518">ch</span>&nbsp;<span class="op" id="5087521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5087525">case</span>&nbsp;<span class="ident" id="5087530">blank</span><span class="op" id="5087535">,</span>&nbsp;<span class="ident" id="5087537">vtab</span><span class="op" id="5087541">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5087546">//&nbsp;ignore&nbsp;trailing&nbsp;whitespace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5087579">p</span><span class="op" id="5087580">.</span><span class="ident" id="5087581">wsbuf</span><span class="op" id="5087586">[</span><span class="ident" id="5087587">i</span><span class="op" id="5087588">]</span>&nbsp;<span class="op" id="5087590">=</span>&nbsp;<span class="ident" id="5087592">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5087601">case</span>&nbsp;<span class="ident" id="5087606">indent</span><span class="op" id="5087612">,</span>&nbsp;<span class="ident" id="5087614">unindent</span><span class="op" id="5087622">:</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5087627">//&nbsp;don&#39;t&nbsp;lose&nbsp;indentation&nbsp;information</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5087667">case</span>&nbsp;<span class="ident" id="5087672">newline</span><span class="op" id="5087679">,</span>&nbsp;<span class="ident" id="5087681">formfeed</span><span class="op" id="5087689">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5087694">//&nbsp;if&nbsp;we&nbsp;need&nbsp;a&nbsp;line&nbsp;break,&nbsp;keep&nbsp;exactly&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5087742">//&nbsp;but&nbsp;remember&nbsp;if&nbsp;we&nbsp;dropped&nbsp;any&nbsp;formfeeds</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5087789">if</span>&nbsp;<span class="ident" id="5087792">needsLinebreak</span>&nbsp;<span class="op" id="5087807">{</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5087813">needsLinebreak</span>&nbsp;<span class="op" id="5087828">=</span>&nbsp;<span class="builtintype" id="5087830">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5087840">wroteNewline</span>&nbsp;<span class="op" id="5087853">=</span>&nbsp;<span class="builtintype" id="5087855">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5087863">}</span>&nbsp;<span class="keyword" id="5087865">else</span>&nbsp;<span class="op" id="5087870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5087876">if</span>&nbsp;<span class="ident" id="5087879">ch</span>&nbsp;<span class="op" id="5087882">==</span>&nbsp;<span class="ident" id="5087885">formfeed</span>&nbsp;<span class="op" id="5087894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5087901">droppedFF</span>&nbsp;<span class="op" id="5087911">=</span>&nbsp;<span class="builtintype" id="5087913">true</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5087922">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5087928">p</span><span class="op" id="5087929">.</span><span class="ident" id="5087930">wsbuf</span><span class="op" id="5087935">[</span><span class="ident" id="5087936">i</span><span class="op" id="5087937">]</span>&nbsp;<span class="op" id="5087939">=</span>&nbsp;<span class="ident" id="5087941">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5087951">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5087955">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5087958">}</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5087961">p</span><span class="op" id="5087962">.</span><span class="ident" id="5087963">writeWhitespace</span><span class="op" id="5087978">(</span><span class="builtinfunc" id="5087979">len</span><span class="op" id="5087982">(</span><span class="ident" id="5087983">p</span><span class="op" id="5087984">.</span><span class="ident" id="5087985">wsbuf</span><span class="op" id="5087990">)</span><span class="op" id="5087991">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5087995">//&nbsp;make&nbsp;sure&nbsp;we&nbsp;have&nbsp;a&nbsp;line&nbsp;break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5088030">if</span>&nbsp;<span class="ident" id="5088033">needsLinebreak</span>&nbsp;<span class="op" id="5088048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5088052">p</span><span class="op" id="5088053">.</span><span class="ident" id="5088054">writeByte</span><span class="op" id="5088063">(</span><span class="string" id="5088064">&#39;\n&#39;</span><span class="op" id="5088068">,</span>&nbsp;<span class="num" id="5088070">1</span><span class="op" id="5088071">)</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5088075">wroteNewline</span>&nbsp;<span class="op" id="5088088">=</span>&nbsp;<span class="builtintype" id="5088090">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5088096">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5088100">return</span><br>
<span class="lineno"></span><span class="op" id="5088107">}</span><br>
<span class="lineno">710</span><br>
<span class="lineno"></span><span class="comment" id="5088110">//&nbsp;intersperseComments&nbsp;consumes&nbsp;all&nbsp;comments&nbsp;that&nbsp;appear&nbsp;before&nbsp;the&nbsp;next&nbsp;token</span><br>
<span class="lineno"></span><span class="comment" id="5088189">//&nbsp;tok&nbsp;and&nbsp;prints&nbsp;it&nbsp;together&nbsp;with&nbsp;the&nbsp;buffered&nbsp;whitespace&nbsp;(i.e.,&nbsp;the&nbsp;whitespace</span><br>
<span class="lineno"></span><span class="comment" id="5088270">//&nbsp;that&nbsp;needs&nbsp;to&nbsp;be&nbsp;written&nbsp;before&nbsp;the&nbsp;next&nbsp;token).&nbsp;A&nbsp;heuristic&nbsp;is&nbsp;used&nbsp;to&nbsp;mix</span><br>
<span class="lineno"></span><span class="comment" id="5088349">//&nbsp;the&nbsp;comments&nbsp;and&nbsp;whitespace.&nbsp;The&nbsp;intersperseComments&nbsp;result&nbsp;indicates&nbsp;if&nbsp;a</span><br>
<span class="lineno">715</span><span class="comment" id="5088427">//&nbsp;newline&nbsp;was&nbsp;written&nbsp;or&nbsp;if&nbsp;a&nbsp;formfeed&nbsp;was&nbsp;dropped&nbsp;from&nbsp;the&nbsp;whitespace&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="5088507">//</span><br>
<span class="lineno"></span><span class="keyword" id="5088510">func</span>&nbsp;<span class="op" id="5088515">(</span><span class="ident" id="5088516">p</span>&nbsp;<span class="op" id="5088518">*</span><span class="ident" id="5088519">printer</span><span class="op" id="5088526">)</span>&nbsp;<span class="ident" id="5088528">intersperseComments</span><span class="op" id="5088547">(</span><span class="ident" id="5088548">next</span>&nbsp;<span class="ident" id="5088553">token</span><span class="op" id="5088558">.</span><span class="ident" id="5088559">Position</span><span class="op" id="5088567">,</span>&nbsp;<span class="ident" id="5088569">tok</span>&nbsp;<span class="ident" id="5088573">token</span><span class="op" id="5088578">.</span><span class="ident" id="5088579">Token</span><span class="op" id="5088584">)</span>&nbsp;<span class="op" id="5088586">(</span><span class="ident" id="5088587">wroteNewline</span><span class="op" id="5088599">,</span>&nbsp;<span class="ident" id="5088601">droppedFF</span>&nbsp;<span class="builtintype" id="5088611">bool</span><span class="op" id="5088615">)</span>&nbsp;<span class="op" id="5088617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5088620">var</span>&nbsp;<span class="ident" id="5088624">last</span>&nbsp;<span class="op" id="5088629">*</span><span class="ident" id="5088630">ast</span><span class="op" id="5088633">.</span><span class="ident" id="5088634">Comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5088643">for</span>&nbsp;<span class="ident" id="5088647">p</span><span class="op" id="5088648">.</span><span class="ident" id="5088649">commentBefore</span><span class="op" id="5088662">(</span><span class="ident" id="5088663">next</span><span class="op" id="5088667">)</span>&nbsp;<span class="op" id="5088669">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5088673">for</span>&nbsp;<span class="ident" id="5088677">_</span><span class="op" id="5088678">,</span>&nbsp;<span class="ident" id="5088680">c</span>&nbsp;<span class="op" id="5088682">:=</span>&nbsp;<span class="keyword" id="5088685">range</span>&nbsp;<span class="ident" id="5088691">p</span><span class="op" id="5088692">.</span><span class="ident" id="5088693">comment</span><span class="op" id="5088700">.</span><span class="ident" id="5088701">List</span>&nbsp;<span class="op" id="5088706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5088711">p</span><span class="op" id="5088712">.</span><span class="ident" id="5088713">writeCommentPrefix</span><span class="op" id="5088731">(</span><span class="ident" id="5088732">p</span><span class="op" id="5088733">.</span><span class="ident" id="5088734">posFor</span><span class="op" id="5088740">(</span><span class="ident" id="5088741">c</span><span class="op" id="5088742">.</span><span class="ident" id="5088743">Pos</span><span class="op" id="5088746">(</span><span class="op" id="5088747">)</span><span class="op" id="5088748">)</span><span class="op" id="5088749">,</span>&nbsp;<span class="ident" id="5088751">next</span><span class="op" id="5088755">,</span>&nbsp;<span class="ident" id="5088757">last</span><span class="op" id="5088761">,</span>&nbsp;<span class="ident" id="5088763">c</span><span class="op" id="5088764">,</span>&nbsp;<span class="ident" id="5088766">tok</span><span class="op" id="5088769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5088774">p</span><span class="op" id="5088775">.</span><span class="ident" id="5088776">writeComment</span><span class="op" id="5088788">(</span><span class="ident" id="5088789">c</span><span class="op" id="5088790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5088795">last</span>&nbsp;<span class="op" id="5088800">=</span>&nbsp;<span class="ident" id="5088802">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5088806">}</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5088810">p</span><span class="op" id="5088811">.</span><span class="ident" id="5088812">nextComment</span><span class="op" id="5088823">(</span><span class="op" id="5088824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5088827">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5088831">if</span>&nbsp;<span class="ident" id="5088834">last</span>&nbsp;<span class="op" id="5088839">!=</span>&nbsp;<span class="builtintype" id="5088842">nil</span>&nbsp;<span class="op" id="5088846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5088850">//&nbsp;if&nbsp;the&nbsp;last&nbsp;comment&nbsp;is&nbsp;a&nbsp;/*-style&nbsp;comment&nbsp;and&nbsp;the&nbsp;next&nbsp;item</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5088915">//&nbsp;follows&nbsp;on&nbsp;the&nbsp;same&nbsp;line&nbsp;but&nbsp;is&nbsp;not&nbsp;a&nbsp;comma,&nbsp;and&nbsp;not&nbsp;a&nbsp;&#34;closing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5088985">//&nbsp;token&nbsp;immediately&nbsp;following&nbsp;its&nbsp;corresponding&nbsp;&#34;opening&#34;&nbsp;token,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5089053">//&nbsp;add&nbsp;an&nbsp;extra&nbsp;blank&nbsp;for&nbsp;separation&nbsp;unless&nbsp;explicitly&nbsp;disabled</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5089119">if</span>&nbsp;<span class="ident" id="5089122">p</span><span class="op" id="5089123">.</span><span class="ident" id="5089124">mode</span><span class="op" id="5089128">&amp;</span><span class="ident" id="5089129">noExtraBlank</span>&nbsp;<span class="op" id="5089142">==</span>&nbsp;<span class="num" id="5089145">0</span>&nbsp;<span class="op" id="5089147">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5089153">last</span><span class="op" id="5089157">.</span><span class="ident" id="5089158">Text</span><span class="op" id="5089162">[</span><span class="num" id="5089163">1</span><span class="op" id="5089164">]</span>&nbsp;<span class="op" id="5089166">==</span>&nbsp;<span class="string" id="5089169">&#39;*&#39;</span>&nbsp;<span class="op" id="5089173">&amp;&amp;</span>&nbsp;<span class="ident" id="5089176">p</span><span class="op" id="5089177">.</span><span class="ident" id="5089178">lineFor</span><span class="op" id="5089185">(</span><span class="ident" id="5089186">last</span><span class="op" id="5089190">.</span><span class="ident" id="5089191">Pos</span><span class="op" id="5089194">(</span><span class="op" id="5089195">)</span><span class="op" id="5089196">)</span>&nbsp;<span class="op" id="5089198">==</span>&nbsp;<span class="ident" id="5089201">next</span><span class="op" id="5089205">.</span><span class="ident" id="5089206">Line</span>&nbsp;<span class="op" id="5089211">&amp;&amp;</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5089217">tok</span>&nbsp;<span class="op" id="5089221">!=</span>&nbsp;<span class="ident" id="5089224">token</span><span class="op" id="5089229">.</span><span class="ident" id="5089230">COMMA</span>&nbsp;<span class="op" id="5089236">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5089242">(</span><span class="ident" id="5089243">tok</span>&nbsp;<span class="op" id="5089247">!=</span>&nbsp;<span class="ident" id="5089250">token</span><span class="op" id="5089255">.</span><span class="ident" id="5089256">RPAREN</span>&nbsp;<span class="op" id="5089263">||</span>&nbsp;<span class="ident" id="5089266">p</span><span class="op" id="5089267">.</span><span class="ident" id="5089268">prevOpen</span>&nbsp;<span class="op" id="5089277">==</span>&nbsp;<span class="ident" id="5089280">token</span><span class="op" id="5089285">.</span><span class="ident" id="5089286">LPAREN</span><span class="op" id="5089292">)</span>&nbsp;<span class="op" id="5089294">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5089300">(</span><span class="ident" id="5089301">tok</span>&nbsp;<span class="op" id="5089305">!=</span>&nbsp;<span class="ident" id="5089308">token</span><span class="op" id="5089313">.</span><span class="ident" id="5089314">RBRACK</span>&nbsp;<span class="op" id="5089321">||</span>&nbsp;<span class="ident" id="5089324">p</span><span class="op" id="5089325">.</span><span class="ident" id="5089326">prevOpen</span>&nbsp;<span class="op" id="5089335">==</span>&nbsp;<span class="ident" id="5089338">token</span><span class="op" id="5089343">.</span><span class="ident" id="5089344">LBRACK</span><span class="op" id="5089350">)</span>&nbsp;<span class="op" id="5089352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5089357">p</span><span class="op" id="5089358">.</span><span class="ident" id="5089359">writeByte</span><span class="op" id="5089368">(</span><span class="string" id="5089369">&#39;&nbsp;&#39;</span><span class="op" id="5089372">,</span>&nbsp;<span class="num" id="5089374">1</span><span class="op" id="5089375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5089379">}</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5089383">//&nbsp;ensure&nbsp;that&nbsp;there&nbsp;is&nbsp;a&nbsp;line&nbsp;break&nbsp;after&nbsp;a&nbsp;//-style&nbsp;comment,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5089448">//&nbsp;before&nbsp;a&nbsp;closing&nbsp;&#39;}&#39;&nbsp;unless&nbsp;explicitly&nbsp;disabled,&nbsp;or&nbsp;at&nbsp;eof</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5089512">needsLinebreak</span>&nbsp;<span class="op" id="5089527">:=</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5089533">last</span><span class="op" id="5089537">.</span><span class="ident" id="5089538">Text</span><span class="op" id="5089542">[</span><span class="num" id="5089543">1</span><span class="op" id="5089544">]</span>&nbsp;<span class="op" id="5089546">==</span>&nbsp;<span class="string" id="5089549">&#39;/&#39;</span>&nbsp;<span class="op" id="5089553">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5089560">tok</span>&nbsp;<span class="op" id="5089564">==</span>&nbsp;<span class="ident" id="5089567">token</span><span class="op" id="5089572">.</span><span class="ident" id="5089573">RBRACE</span>&nbsp;<span class="op" id="5089580">&amp;&amp;</span>&nbsp;<span class="ident" id="5089583">p</span><span class="op" id="5089584">.</span><span class="ident" id="5089585">mode</span><span class="op" id="5089589">&amp;</span><span class="ident" id="5089590">noExtraLinebreak</span>&nbsp;<span class="op" id="5089607">==</span>&nbsp;<span class="num" id="5089610">0</span>&nbsp;<span class="op" id="5089612">||</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5089619">tok</span>&nbsp;<span class="op" id="5089623">==</span>&nbsp;<span class="ident" id="5089626">token</span><span class="op" id="5089631">.</span><span class="ident" id="5089632">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5089638">return</span>&nbsp;<span class="ident" id="5089645">p</span><span class="op" id="5089646">.</span><span class="ident" id="5089647">writeCommentSuffix</span><span class="op" id="5089665">(</span><span class="ident" id="5089666">needsLinebreak</span><span class="op" id="5089680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5089683">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5089687">//&nbsp;no&nbsp;comment&nbsp;was&nbsp;written&nbsp;-&nbsp;we&nbsp;should&nbsp;never&nbsp;reach&nbsp;here&nbsp;since</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5089749">//&nbsp;intersperseComments&nbsp;should&nbsp;not&nbsp;be&nbsp;called&nbsp;in&nbsp;that&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5089807">p</span><span class="op" id="5089808">.</span><span class="ident" id="5089809">internalError</span><span class="op" id="5089822">(</span><span class="string" id="5089823">&#34;intersperseComments&nbsp;called&nbsp;without&nbsp;pending&nbsp;comments&#34;</span><span class="op" id="5089876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5089879">return</span><br>
<span class="lineno"></span><span class="op" id="5089886">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">755</span><span class="comment" id="5089889">//&nbsp;whiteWhitespace&nbsp;writes&nbsp;the&nbsp;first&nbsp;n&nbsp;whitespace&nbsp;entries.</span><br>
<span class="lineno"></span><span class="keyword" id="5089947">func</span>&nbsp;<span class="op" id="5089952">(</span><span class="ident" id="5089953">p</span>&nbsp;<span class="op" id="5089955">*</span><span class="ident" id="5089956">printer</span><span class="op" id="5089963">)</span>&nbsp;<span class="ident" id="5089965">writeWhitespace</span><span class="op" id="5089980">(</span><span class="ident" id="5089981">n</span>&nbsp;<span class="builtintype" id="5089983">int</span><span class="op" id="5089986">)</span>&nbsp;<span class="op" id="5089988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5089991">//&nbsp;write&nbsp;entries</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5090009">for</span>&nbsp;<span class="ident" id="5090013">i</span>&nbsp;<span class="op" id="5090015">:=</span>&nbsp;<span class="num" id="5090018">0</span><span class="op" id="5090019">;</span>&nbsp;<span class="ident" id="5090021">i</span>&nbsp;<span class="op" id="5090023">&lt;</span>&nbsp;<span class="ident" id="5090025">n</span><span class="op" id="5090026">;</span>&nbsp;<span class="ident" id="5090028">i</span><span class="op" id="5090029">++</span>&nbsp;<span class="op" id="5090032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5090036">switch</span>&nbsp;<span class="ident" id="5090043">ch</span>&nbsp;<span class="op" id="5090046">:=</span>&nbsp;<span class="ident" id="5090049">p</span><span class="op" id="5090050">.</span><span class="ident" id="5090051">wsbuf</span><span class="op" id="5090056">[</span><span class="ident" id="5090057">i</span><span class="op" id="5090058">]</span><span class="op" id="5090059">;</span>&nbsp;<span class="ident" id="5090061">ch</span>&nbsp;<span class="op" id="5090064">{</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5090068">case</span>&nbsp;<span class="ident" id="5090073">ignore</span><span class="op" id="5090079">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5090084">//&nbsp;ignore!</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5090097">case</span>&nbsp;<span class="ident" id="5090102">indent</span><span class="op" id="5090108">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5090113">p</span><span class="op" id="5090114">.</span><span class="ident" id="5090115">indent</span><span class="op" id="5090121">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5090126">case</span>&nbsp;<span class="ident" id="5090131">unindent</span><span class="op" id="5090139">:</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5090144">p</span><span class="op" id="5090145">.</span><span class="ident" id="5090146">indent</span><span class="op" id="5090152">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5090158">if</span>&nbsp;<span class="ident" id="5090161">p</span><span class="op" id="5090162">.</span><span class="ident" id="5090163">indent</span>&nbsp;<span class="op" id="5090170">&lt;</span>&nbsp;<span class="num" id="5090172">0</span>&nbsp;<span class="op" id="5090174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5090180">p</span><span class="op" id="5090181">.</span><span class="ident" id="5090182">internalError</span><span class="op" id="5090195">(</span><span class="string" id="5090196">&#34;negative&nbsp;indentation:&#34;</span><span class="op" id="5090219">,</span>&nbsp;<span class="ident" id="5090221">p</span><span class="op" id="5090222">.</span><span class="ident" id="5090223">indent</span><span class="op" id="5090229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5090235">p</span><span class="op" id="5090236">.</span><span class="ident" id="5090237">indent</span>&nbsp;<span class="op" id="5090244">=</span>&nbsp;<span class="num" id="5090246">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5090251">}</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5090255">case</span>&nbsp;<span class="ident" id="5090260">newline</span><span class="op" id="5090267">,</span>&nbsp;<span class="ident" id="5090269">formfeed</span><span class="op" id="5090277">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5090282">//&nbsp;A&nbsp;line&nbsp;break&nbsp;immediately&nbsp;followed&nbsp;by&nbsp;a&nbsp;&#34;correcting&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5090340">//&nbsp;unindent&nbsp;is&nbsp;swapped&nbsp;with&nbsp;the&nbsp;unindent&nbsp;-&nbsp;this&nbsp;permits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5090399">//&nbsp;proper&nbsp;label&nbsp;positioning.&nbsp;If&nbsp;a&nbsp;comment&nbsp;is&nbsp;between</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5090455">//&nbsp;the&nbsp;line&nbsp;break&nbsp;and&nbsp;the&nbsp;label,&nbsp;the&nbsp;unindent&nbsp;is&nbsp;not</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5090511">//&nbsp;part&nbsp;of&nbsp;the&nbsp;comment&nbsp;whitespace&nbsp;prefix&nbsp;and&nbsp;the&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5090571">//&nbsp;will&nbsp;be&nbsp;positioned&nbsp;correctly&nbsp;indented.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5090616">if</span>&nbsp;<span class="ident" id="5090619">i</span><span class="op" id="5090620">+</span><span class="num" id="5090621">1</span>&nbsp;<span class="op" id="5090623">&lt;</span>&nbsp;<span class="ident" id="5090625">n</span>&nbsp;<span class="op" id="5090627">&amp;&amp;</span>&nbsp;<span class="ident" id="5090630">p</span><span class="op" id="5090631">.</span><span class="ident" id="5090632">wsbuf</span><span class="op" id="5090637">[</span><span class="ident" id="5090638">i</span><span class="op" id="5090639">+</span><span class="num" id="5090640">1</span><span class="op" id="5090641">]</span>&nbsp;<span class="op" id="5090643">==</span>&nbsp;<span class="ident" id="5090646">unindent</span>&nbsp;<span class="op" id="5090655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5090661">//&nbsp;Use&nbsp;a&nbsp;formfeed&nbsp;to&nbsp;terminate&nbsp;the&nbsp;current&nbsp;section.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5090717">//&nbsp;Otherwise,&nbsp;a&nbsp;long&nbsp;label&nbsp;name&nbsp;on&nbsp;the&nbsp;next&nbsp;line&nbsp;leading</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5090778">//&nbsp;to&nbsp;a&nbsp;wide&nbsp;column&nbsp;may&nbsp;increase&nbsp;the&nbsp;indentation&nbsp;column</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5090838">//&nbsp;of&nbsp;lines&nbsp;before&nbsp;the&nbsp;label;&nbsp;effectively&nbsp;leading&nbsp;to&nbsp;wrong</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5090901">//&nbsp;indentation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5090921">p</span><span class="op" id="5090922">.</span><span class="ident" id="5090923">wsbuf</span><span class="op" id="5090928">[</span><span class="ident" id="5090929">i</span><span class="op" id="5090930">]</span><span class="op" id="5090931">,</span>&nbsp;<span class="ident" id="5090933">p</span><span class="op" id="5090934">.</span><span class="ident" id="5090935">wsbuf</span><span class="op" id="5090940">[</span><span class="ident" id="5090941">i</span><span class="op" id="5090942">+</span><span class="num" id="5090943">1</span><span class="op" id="5090944">]</span>&nbsp;<span class="op" id="5090946">=</span>&nbsp;<span class="ident" id="5090948">unindent</span><span class="op" id="5090956">,</span>&nbsp;<span class="ident" id="5090958">formfeed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5090971">i</span><span class="op" id="5090972">--</span>&nbsp;<span class="comment" id="5090975">//&nbsp;do&nbsp;it&nbsp;again</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5090994">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5091006">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5091011">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5091025">default</span><span class="op" id="5091032">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5091037">p</span><span class="op" id="5091038">.</span><span class="ident" id="5091039">writeByte</span><span class="op" id="5091048">(</span><span class="builtintype" id="5091049">byte</span><span class="op" id="5091053">(</span><span class="ident" id="5091054">ch</span><span class="op" id="5091056">)</span><span class="op" id="5091057">,</span>&nbsp;<span class="num" id="5091059">1</span><span class="op" id="5091060">)</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5091064">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5091067">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5091071">//&nbsp;shift&nbsp;remaining&nbsp;entries&nbsp;down</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5091104">l</span>&nbsp;<span class="op" id="5091106">:=</span>&nbsp;<span class="builtinfunc" id="5091109">copy</span><span class="op" id="5091113">(</span><span class="ident" id="5091114">p</span><span class="op" id="5091115">.</span><span class="ident" id="5091116">wsbuf</span><span class="op" id="5091121">,</span>&nbsp;<span class="ident" id="5091123">p</span><span class="op" id="5091124">.</span><span class="ident" id="5091125">wsbuf</span><span class="op" id="5091130">[</span><span class="ident" id="5091131">n</span><span class="op" id="5091132">:</span><span class="op" id="5091133">]</span><span class="op" id="5091134">)</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5091137">p</span><span class="op" id="5091138">.</span><span class="ident" id="5091139">wsbuf</span>&nbsp;<span class="op" id="5091145">=</span>&nbsp;<span class="ident" id="5091147">p</span><span class="op" id="5091148">.</span><span class="ident" id="5091149">wsbuf</span><span class="op" id="5091154">[</span><span class="op" id="5091155">:</span><span class="ident" id="5091156">l</span><span class="op" id="5091157">]</span><br>
<span class="lineno"></span><span class="op" id="5091159">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5091162">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5091242">//&nbsp;Printing&nbsp;interface</span><br>
<span class="lineno">800</span><br>
<span class="lineno"></span><span class="comment" id="5091265">//&nbsp;nlines&nbsp;limits&nbsp;n&nbsp;to&nbsp;maxNewlines.</span><br>
<span class="lineno"></span><span class="keyword" id="5091300">func</span>&nbsp;<span class="ident" id="5091305">nlimit</span><span class="op" id="5091311">(</span><span class="ident" id="5091312">n</span>&nbsp;<span class="builtintype" id="5091314">int</span><span class="op" id="5091317">)</span>&nbsp;<span class="builtintype" id="5091319">int</span>&nbsp;<span class="op" id="5091323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5091326">if</span>&nbsp;<span class="ident" id="5091329">n</span>&nbsp;<span class="op" id="5091331">&gt;</span>&nbsp;<span class="ident" id="5091333">maxNewlines</span>&nbsp;<span class="op" id="5091345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5091349">n</span>&nbsp;<span class="op" id="5091351">=</span>&nbsp;<span class="ident" id="5091353">maxNewlines</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5091366">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5091369">return</span>&nbsp;<span class="ident" id="5091376">n</span><br>
<span class="lineno"></span><span class="op" id="5091378">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5091381">func</span>&nbsp;<span class="ident" id="5091386">mayCombine</span><span class="op" id="5091396">(</span><span class="ident" id="5091397">prev</span>&nbsp;<span class="ident" id="5091402">token</span><span class="op" id="5091407">.</span><span class="ident" id="5091408">Token</span><span class="op" id="5091413">,</span>&nbsp;<span class="ident" id="5091415">next</span>&nbsp;<span class="builtintype" id="5091420">byte</span><span class="op" id="5091424">)</span>&nbsp;<span class="op" id="5091426">(</span><span class="ident" id="5091427">b</span>&nbsp;<span class="builtintype" id="5091429">bool</span><span class="op" id="5091433">)</span>&nbsp;<span class="op" id="5091435">{</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5091438">switch</span>&nbsp;<span class="ident" id="5091445">prev</span>&nbsp;<span class="op" id="5091450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5091453">case</span>&nbsp;<span class="ident" id="5091458">token</span><span class="op" id="5091463">.</span><span class="ident" id="5091464">INT</span><span class="op" id="5091467">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5091471">b</span>&nbsp;<span class="op" id="5091473">=</span>&nbsp;<span class="ident" id="5091475">next</span>&nbsp;<span class="op" id="5091480">==</span>&nbsp;<span class="string" id="5091483">&#39;.&#39;</span>&nbsp;<span class="comment" id="5091487">//&nbsp;1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5091494">case</span>&nbsp;<span class="ident" id="5091499">token</span><span class="op" id="5091504">.</span><span class="ident" id="5091505">ADD</span><span class="op" id="5091508">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5091512">b</span>&nbsp;<span class="op" id="5091514">=</span>&nbsp;<span class="ident" id="5091516">next</span>&nbsp;<span class="op" id="5091521">==</span>&nbsp;<span class="string" id="5091524">&#39;+&#39;</span>&nbsp;<span class="comment" id="5091528">//&nbsp;++</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5091535">case</span>&nbsp;<span class="ident" id="5091540">token</span><span class="op" id="5091545">.</span><span class="ident" id="5091546">SUB</span><span class="op" id="5091549">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5091553">b</span>&nbsp;<span class="op" id="5091555">=</span>&nbsp;<span class="ident" id="5091557">next</span>&nbsp;<span class="op" id="5091562">==</span>&nbsp;<span class="string" id="5091565">&#39;-&#39;</span>&nbsp;<span class="comment" id="5091569">//&nbsp;--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5091576">case</span>&nbsp;<span class="ident" id="5091581">token</span><span class="op" id="5091586">.</span><span class="ident" id="5091587">QUO</span><span class="op" id="5091590">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5091594">b</span>&nbsp;<span class="op" id="5091596">=</span>&nbsp;<span class="ident" id="5091598">next</span>&nbsp;<span class="op" id="5091603">==</span>&nbsp;<span class="string" id="5091606">&#39;*&#39;</span>&nbsp;<span class="comment" id="5091610">//&nbsp;/*</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5091617">case</span>&nbsp;<span class="ident" id="5091622">token</span><span class="op" id="5091627">.</span><span class="ident" id="5091628">LSS</span><span class="op" id="5091631">:</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5091635">b</span>&nbsp;<span class="op" id="5091637">=</span>&nbsp;<span class="ident" id="5091639">next</span>&nbsp;<span class="op" id="5091644">==</span>&nbsp;<span class="string" id="5091647">&#39;-&#39;</span>&nbsp;<span class="op" id="5091651">||</span>&nbsp;<span class="ident" id="5091654">next</span>&nbsp;<span class="op" id="5091659">==</span>&nbsp;<span class="string" id="5091662">&#39;&lt;&#39;</span>&nbsp;<span class="comment" id="5091666">//&nbsp;&lt;-&nbsp;or&nbsp;&lt;&lt;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5091679">case</span>&nbsp;<span class="ident" id="5091684">token</span><span class="op" id="5091689">.</span><span class="ident" id="5091690">AND</span><span class="op" id="5091693">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5091697">b</span>&nbsp;<span class="op" id="5091699">=</span>&nbsp;<span class="ident" id="5091701">next</span>&nbsp;<span class="op" id="5091706">==</span>&nbsp;<span class="string" id="5091709">&#39;&amp;&#39;</span>&nbsp;<span class="op" id="5091713">||</span>&nbsp;<span class="ident" id="5091716">next</span>&nbsp;<span class="op" id="5091721">==</span>&nbsp;<span class="string" id="5091724">&#39;^&#39;</span>&nbsp;<span class="comment" id="5091728">//&nbsp;&amp;&amp;&nbsp;or&nbsp;&amp;^</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5091741">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5091744">return</span><br>
<span class="lineno">825</span><span class="op" id="5091751">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5091754">//&nbsp;print&nbsp;prints&nbsp;a&nbsp;list&nbsp;of&nbsp;&#34;items&#34;&nbsp;(roughly&nbsp;corresponding&nbsp;to&nbsp;syntactic</span><br>
<span class="lineno"></span><span class="comment" id="5091824">//&nbsp;tokens,&nbsp;but&nbsp;also&nbsp;including&nbsp;whitespace&nbsp;and&nbsp;formatting&nbsp;information).</span><br>
<span class="lineno"></span><span class="comment" id="5091894">//&nbsp;It&nbsp;is&nbsp;the&nbsp;only&nbsp;print&nbsp;function&nbsp;that&nbsp;should&nbsp;be&nbsp;called&nbsp;directly&nbsp;from</span><br>
<span class="lineno">830</span><span class="comment" id="5091963">//&nbsp;any&nbsp;of&nbsp;the&nbsp;AST&nbsp;printing&nbsp;functions&nbsp;in&nbsp;nodes.go.</span><br>
<span class="lineno"></span><span class="comment" id="5092013">//</span><br>
<span class="lineno"></span><span class="comment" id="5092016">//&nbsp;Whitespace&nbsp;is&nbsp;accumulated&nbsp;until&nbsp;a&nbsp;non-whitespace&nbsp;token&nbsp;appears.&nbsp;Any</span><br>
<span class="lineno"></span><span class="comment" id="5092087">//&nbsp;comments&nbsp;that&nbsp;need&nbsp;to&nbsp;appear&nbsp;before&nbsp;that&nbsp;token&nbsp;are&nbsp;printed&nbsp;first,</span><br>
<span class="lineno"></span><span class="comment" id="5092156">//&nbsp;taking&nbsp;into&nbsp;account&nbsp;the&nbsp;amount&nbsp;and&nbsp;structure&nbsp;of&nbsp;any&nbsp;pending&nbsp;white-</span><br>
<span class="lineno">835</span><span class="comment" id="5092226">//&nbsp;space&nbsp;for&nbsp;best&nbsp;comment&nbsp;placement.&nbsp;Then,&nbsp;any&nbsp;leftover&nbsp;whitespace&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="5092296">//&nbsp;printed,&nbsp;followed&nbsp;by&nbsp;the&nbsp;actual&nbsp;token.</span><br>
<span class="lineno"></span><span class="comment" id="5092338">//</span><br>
<span class="lineno"></span><span class="keyword" id="5092341">func</span>&nbsp;<span class="op" id="5092346">(</span><span class="ident" id="5092347">p</span>&nbsp;<span class="op" id="5092349">*</span><span class="ident" id="5092350">printer</span><span class="op" id="5092357">)</span>&nbsp;<span class="builtinfunc" id="5092359">print</span><span class="op" id="5092364">(</span><span class="ident" id="5092365">args</span>&nbsp;<span class="op" id="5092370">...</span><span class="keyword" id="5092373">interface</span><span class="op" id="5092382">{</span><span class="op" id="5092383">}</span><span class="op" id="5092384">)</span>&nbsp;<span class="op" id="5092386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5092389">for</span>&nbsp;<span class="ident" id="5092393">_</span><span class="op" id="5092394">,</span>&nbsp;<span class="ident" id="5092396">arg</span>&nbsp;<span class="op" id="5092400">:=</span>&nbsp;<span class="keyword" id="5092403">range</span>&nbsp;<span class="ident" id="5092409">args</span>&nbsp;<span class="op" id="5092414">{</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5092418">//&nbsp;information&nbsp;about&nbsp;the&nbsp;current&nbsp;arg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5092457">var</span>&nbsp;<span class="ident" id="5092461">data</span>&nbsp;<span class="builtintype" id="5092466">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5092475">var</span>&nbsp;<span class="ident" id="5092479">isLit</span>&nbsp;<span class="builtintype" id="5092485">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5092492">var</span>&nbsp;<span class="ident" id="5092496">impliedSemi</span>&nbsp;<span class="builtintype" id="5092508">bool</span>&nbsp;<span class="comment" id="5092513">//&nbsp;value&nbsp;for&nbsp;p.impliedSemi&nbsp;after&nbsp;this&nbsp;arg</span><br>
<span class="lineno"></span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5092558">//&nbsp;record&nbsp;previous&nbsp;opening&nbsp;token,&nbsp;if&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5092601">switch</span>&nbsp;<span class="ident" id="5092608">p</span><span class="op" id="5092609">.</span><span class="ident" id="5092610">lastTok</span>&nbsp;<span class="op" id="5092618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5092622">case</span>&nbsp;<span class="ident" id="5092627">token</span><span class="op" id="5092632">.</span><span class="ident" id="5092633">ILLEGAL</span><span class="op" id="5092640">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5092645">//&nbsp;ignore&nbsp;(white&nbsp;space)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5092671">case</span>&nbsp;<span class="ident" id="5092676">token</span><span class="op" id="5092681">.</span><span class="ident" id="5092682">LPAREN</span><span class="op" id="5092688">,</span>&nbsp;<span class="ident" id="5092690">token</span><span class="op" id="5092695">.</span><span class="ident" id="5092696">LBRACK</span><span class="op" id="5092702">:</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5092707">p</span><span class="op" id="5092708">.</span><span class="ident" id="5092709">prevOpen</span>&nbsp;<span class="op" id="5092718">=</span>&nbsp;<span class="ident" id="5092720">p</span><span class="op" id="5092721">.</span><span class="ident" id="5092722">lastTok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5092732">default</span><span class="op" id="5092739">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5092744">//&nbsp;other&nbsp;tokens&nbsp;followed&nbsp;any&nbsp;opening&nbsp;token</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5092790">p</span><span class="op" id="5092791">.</span><span class="ident" id="5092792">prevOpen</span>&nbsp;<span class="op" id="5092801">=</span>&nbsp;<span class="ident" id="5092803">token</span><span class="op" id="5092808">.</span><span class="ident" id="5092809">ILLEGAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5092819">}</span><br>
<span class="lineno">855</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5092824">switch</span>&nbsp;<span class="ident" id="5092831">x</span>&nbsp;<span class="op" id="5092833">:=</span>&nbsp;<span class="ident" id="5092836">arg</span><span class="op" id="5092839">.</span><span class="op" id="5092840">(</span><span class="keyword" id="5092841">type</span><span class="op" id="5092845">)</span>&nbsp;<span class="op" id="5092847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5092851">case</span>&nbsp;<span class="ident" id="5092856">pmode</span><span class="op" id="5092861">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5092866">//&nbsp;toggle&nbsp;printer&nbsp;mode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5092892">p</span><span class="op" id="5092893">.</span><span class="ident" id="5092894">mode</span>&nbsp;<span class="op" id="5092899">^=</span>&nbsp;<span class="ident" id="5092902">x</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5092907">continue</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5092919">case</span>&nbsp;<span class="ident" id="5092924">whiteSpace</span><span class="op" id="5092934">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5092939">if</span>&nbsp;<span class="ident" id="5092942">x</span>&nbsp;<span class="op" id="5092944">==</span>&nbsp;<span class="ident" id="5092947">ignore</span>&nbsp;<span class="op" id="5092954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5092960">//&nbsp;don&#39;t&nbsp;add&nbsp;ignore&#39;s&nbsp;to&nbsp;the&nbsp;buffer;&nbsp;they</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5093006">//&nbsp;may&nbsp;screw&nbsp;up&nbsp;&#34;correcting&#34;&nbsp;unindents&nbsp;(see</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5093054">//&nbsp;LabeledStmt)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5093074">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5093086">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5093091">i</span>&nbsp;<span class="op" id="5093093">:=</span>&nbsp;<span class="builtinfunc" id="5093096">len</span><span class="op" id="5093099">(</span><span class="ident" id="5093100">p</span><span class="op" id="5093101">.</span><span class="ident" id="5093102">wsbuf</span><span class="op" id="5093107">)</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5093112">if</span>&nbsp;<span class="ident" id="5093115">i</span>&nbsp;<span class="op" id="5093117">==</span>&nbsp;<span class="builtinfunc" id="5093120">cap</span><span class="op" id="5093123">(</span><span class="ident" id="5093124">p</span><span class="op" id="5093125">.</span><span class="ident" id="5093126">wsbuf</span><span class="op" id="5093131">)</span>&nbsp;<span class="op" id="5093133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5093139">//&nbsp;Whitespace&nbsp;sequences&nbsp;are&nbsp;very&nbsp;short&nbsp;so&nbsp;this&nbsp;should</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5093197">//&nbsp;never&nbsp;happen.&nbsp;Handle&nbsp;gracefully&nbsp;(but&nbsp;possibly&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5093255">//&nbsp;bad&nbsp;comment&nbsp;placement)&nbsp;if&nbsp;it&nbsp;does&nbsp;happen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5093304">p</span><span class="op" id="5093305">.</span><span class="ident" id="5093306">writeWhitespace</span><span class="op" id="5093321">(</span><span class="ident" id="5093322">i</span><span class="op" id="5093323">)</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5093329">i</span>&nbsp;<span class="op" id="5093331">=</span>&nbsp;<span class="num" id="5093333">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5093338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5093343">p</span><span class="op" id="5093344">.</span><span class="ident" id="5093345">wsbuf</span>&nbsp;<span class="op" id="5093351">=</span>&nbsp;<span class="ident" id="5093353">p</span><span class="op" id="5093354">.</span><span class="ident" id="5093355">wsbuf</span><span class="op" id="5093360">[</span><span class="num" id="5093361">0</span>&nbsp;<span class="op" id="5093363">:</span>&nbsp;<span class="ident" id="5093365">i</span><span class="op" id="5093366">+</span><span class="num" id="5093367">1</span><span class="op" id="5093368">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5093373">p</span><span class="op" id="5093374">.</span><span class="ident" id="5093375">wsbuf</span><span class="op" id="5093380">[</span><span class="ident" id="5093381">i</span><span class="op" id="5093382">]</span>&nbsp;<span class="op" id="5093384">=</span>&nbsp;<span class="ident" id="5093386">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5093391">if</span>&nbsp;<span class="ident" id="5093394">x</span>&nbsp;<span class="op" id="5093396">==</span>&nbsp;<span class="ident" id="5093399">newline</span>&nbsp;<span class="op" id="5093407">||</span>&nbsp;<span class="ident" id="5093410">x</span>&nbsp;<span class="op" id="5093412">==</span>&nbsp;<span class="ident" id="5093415">formfeed</span>&nbsp;<span class="op" id="5093424">{</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5093430">//&nbsp;newlines&nbsp;affect&nbsp;the&nbsp;current&nbsp;state&nbsp;(p.impliedSemi)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5093487">//&nbsp;and&nbsp;not&nbsp;the&nbsp;state&nbsp;after&nbsp;printing&nbsp;arg&nbsp;(impliedSemi)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5093545">//&nbsp;because&nbsp;comments&nbsp;can&nbsp;be&nbsp;interspersed&nbsp;before&nbsp;the&nbsp;arg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5093604">//&nbsp;in&nbsp;this&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5093624">p</span><span class="op" id="5093625">.</span><span class="ident" id="5093626">impliedSemi</span>&nbsp;<span class="op" id="5093638">=</span>&nbsp;<span class="builtintype" id="5093640">false</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5093649">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5093654">p</span><span class="op" id="5093655">.</span><span class="ident" id="5093656">lastTok</span>&nbsp;<span class="op" id="5093664">=</span>&nbsp;<span class="ident" id="5093666">token</span><span class="op" id="5093671">.</span><span class="ident" id="5093672">ILLEGAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5093683">continue</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5093695">case</span>&nbsp;<span class="op" id="5093700">*</span><span class="ident" id="5093701">ast</span><span class="op" id="5093704">.</span><span class="ident" id="5093705">Ident</span><span class="op" id="5093710">:</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5093715">data</span>&nbsp;<span class="op" id="5093720">=</span>&nbsp;<span class="ident" id="5093722">x</span><span class="op" id="5093723">.</span><span class="ident" id="5093724">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5093732">impliedSemi</span>&nbsp;<span class="op" id="5093744">=</span>&nbsp;<span class="builtintype" id="5093746">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5093754">p</span><span class="op" id="5093755">.</span><span class="ident" id="5093756">lastTok</span>&nbsp;<span class="op" id="5093764">=</span>&nbsp;<span class="ident" id="5093766">token</span><span class="op" id="5093771">.</span><span class="ident" id="5093772">IDENT</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5093781">case</span>&nbsp;<span class="op" id="5093786">*</span><span class="ident" id="5093787">ast</span><span class="op" id="5093790">.</span><span class="ident" id="5093791">BasicLit</span><span class="op" id="5093799">:</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5093804">data</span>&nbsp;<span class="op" id="5093809">=</span>&nbsp;<span class="ident" id="5093811">x</span><span class="op" id="5093812">.</span><span class="ident" id="5093813">Value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5093822">isLit</span>&nbsp;<span class="op" id="5093828">=</span>&nbsp;<span class="builtintype" id="5093830">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5093838">impliedSemi</span>&nbsp;<span class="op" id="5093850">=</span>&nbsp;<span class="builtintype" id="5093852">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5093860">p</span><span class="op" id="5093861">.</span><span class="ident" id="5093862">lastTok</span>&nbsp;<span class="op" id="5093870">=</span>&nbsp;<span class="ident" id="5093872">x</span><span class="op" id="5093873">.</span><span class="ident" id="5093874">Kind</span><br>
<span class="lineno"></span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5093882">case</span>&nbsp;<span class="ident" id="5093887">token</span><span class="op" id="5093892">.</span><span class="ident" id="5093893">Token</span><span class="op" id="5093898">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5093903">s</span>&nbsp;<span class="op" id="5093905">:=</span>&nbsp;<span class="ident" id="5093908">x</span><span class="op" id="5093909">.</span><span class="ident" id="5093910">String</span><span class="op" id="5093916">(</span><span class="op" id="5093917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5093922">if</span>&nbsp;<span class="ident" id="5093925">mayCombine</span><span class="op" id="5093935">(</span><span class="ident" id="5093936">p</span><span class="op" id="5093937">.</span><span class="ident" id="5093938">lastTok</span><span class="op" id="5093945">,</span>&nbsp;<span class="ident" id="5093947">s</span><span class="op" id="5093948">[</span><span class="num" id="5093949">0</span><span class="op" id="5093950">]</span><span class="op" id="5093951">)</span>&nbsp;<span class="op" id="5093953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5093959">//&nbsp;the&nbsp;previous&nbsp;and&nbsp;the&nbsp;current&nbsp;token&nbsp;must&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5094009">//&nbsp;separated&nbsp;by&nbsp;a&nbsp;blank&nbsp;otherwise&nbsp;they&nbsp;combine</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5094060">//&nbsp;into&nbsp;a&nbsp;different&nbsp;incorrect&nbsp;token&nbsp;sequence</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5094109">//&nbsp;(except&nbsp;for&nbsp;token.INT&nbsp;followed&nbsp;by&nbsp;a&nbsp;&#39;.&#39;&nbsp;this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5094161">//&nbsp;should&nbsp;never&nbsp;happen&nbsp;because&nbsp;it&nbsp;is&nbsp;taken&nbsp;care</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5094213">//&nbsp;of&nbsp;via&nbsp;binary&nbsp;expression&nbsp;formatting)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5094257">if</span>&nbsp;<span class="builtinfunc" id="5094260">len</span><span class="op" id="5094263">(</span><span class="ident" id="5094264">p</span><span class="op" id="5094265">.</span><span class="ident" id="5094266">wsbuf</span><span class="op" id="5094271">)</span>&nbsp;<span class="op" id="5094273">!=</span>&nbsp;<span class="num" id="5094276">0</span>&nbsp;<span class="op" id="5094278">{</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5094285">p</span><span class="op" id="5094286">.</span><span class="ident" id="5094287">internalError</span><span class="op" id="5094300">(</span><span class="string" id="5094301">&#34;whitespace&nbsp;buffer&nbsp;not&nbsp;empty&#34;</span><span class="op" id="5094330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5094336">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5094342">p</span><span class="op" id="5094343">.</span><span class="ident" id="5094344">wsbuf</span>&nbsp;<span class="op" id="5094350">=</span>&nbsp;<span class="ident" id="5094352">p</span><span class="op" id="5094353">.</span><span class="ident" id="5094354">wsbuf</span><span class="op" id="5094359">[</span><span class="num" id="5094360">0</span><span class="op" id="5094361">:</span><span class="num" id="5094362">1</span><span class="op" id="5094363">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5094369">p</span><span class="op" id="5094370">.</span><span class="ident" id="5094371">wsbuf</span><span class="op" id="5094376">[</span><span class="num" id="5094377">0</span><span class="op" id="5094378">]</span>&nbsp;<span class="op" id="5094380">=</span>&nbsp;<span class="string" id="5094382">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5094389">}</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5094394">data</span>&nbsp;<span class="op" id="5094399">=</span>&nbsp;<span class="ident" id="5094401">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5094406">//&nbsp;some&nbsp;keywords&nbsp;followed&nbsp;by&nbsp;a&nbsp;newline&nbsp;imply&nbsp;a&nbsp;semicolon</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5094466">switch</span>&nbsp;<span class="ident" id="5094473">x</span>&nbsp;<span class="op" id="5094475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5094480">case</span>&nbsp;<span class="ident" id="5094485">token</span><span class="op" id="5094490">.</span><span class="ident" id="5094491">BREAK</span><span class="op" id="5094496">,</span>&nbsp;<span class="ident" id="5094498">token</span><span class="op" id="5094503">.</span><span class="ident" id="5094504">CONTINUE</span><span class="op" id="5094512">,</span>&nbsp;<span class="ident" id="5094514">token</span><span class="op" id="5094519">.</span><span class="ident" id="5094520">FALLTHROUGH</span><span class="op" id="5094531">,</span>&nbsp;<span class="ident" id="5094533">token</span><span class="op" id="5094538">.</span><span class="ident" id="5094539">RETURN</span><span class="op" id="5094545">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5094551">token</span><span class="op" id="5094556">.</span><span class="ident" id="5094557">INC</span><span class="op" id="5094560">,</span>&nbsp;<span class="ident" id="5094562">token</span><span class="op" id="5094567">.</span><span class="ident" id="5094568">DEC</span><span class="op" id="5094571">,</span>&nbsp;<span class="ident" id="5094573">token</span><span class="op" id="5094578">.</span><span class="ident" id="5094579">RPAREN</span><span class="op" id="5094585">,</span>&nbsp;<span class="ident" id="5094587">token</span><span class="op" id="5094592">.</span><span class="ident" id="5094593">RBRACK</span><span class="op" id="5094599">,</span>&nbsp;<span class="ident" id="5094601">token</span><span class="op" id="5094606">.</span><span class="ident" id="5094607">RBRACE</span><span class="op" id="5094613">:</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5094619">impliedSemi</span>&nbsp;<span class="op" id="5094631">=</span>&nbsp;<span class="builtintype" id="5094633">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5094641">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5094646">p</span><span class="op" id="5094647">.</span><span class="ident" id="5094648">lastTok</span>&nbsp;<span class="op" id="5094656">=</span>&nbsp;<span class="ident" id="5094658">x</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5094663">case</span>&nbsp;<span class="ident" id="5094668">token</span><span class="op" id="5094673">.</span><span class="ident" id="5094674">Pos</span><span class="op" id="5094677">:</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5094682">if</span>&nbsp;<span class="ident" id="5094685">x</span><span class="op" id="5094686">.</span><span class="ident" id="5094687">IsValid</span><span class="op" id="5094694">(</span><span class="op" id="5094695">)</span>&nbsp;<span class="op" id="5094697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5094703">p</span><span class="op" id="5094704">.</span><span class="ident" id="5094705">pos</span>&nbsp;<span class="op" id="5094709">=</span>&nbsp;<span class="ident" id="5094711">p</span><span class="op" id="5094712">.</span><span class="ident" id="5094713">posFor</span><span class="op" id="5094719">(</span><span class="ident" id="5094720">x</span><span class="op" id="5094721">)</span>&nbsp;<span class="comment" id="5094723">//&nbsp;accurate&nbsp;position&nbsp;of&nbsp;next&nbsp;item</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5094760">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5094765">continue</span><br>
<span class="lineno"></span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5094777">case</span>&nbsp;<span class="builtintype" id="5094782">string</span><span class="op" id="5094788">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5094793">//&nbsp;incorrect&nbsp;AST&nbsp;-&nbsp;print&nbsp;error&nbsp;message</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5094835">data</span>&nbsp;<span class="op" id="5094840">=</span>&nbsp;<span class="ident" id="5094842">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5094847">isLit</span>&nbsp;<span class="op" id="5094853">=</span>&nbsp;<span class="builtintype" id="5094855">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5094863">impliedSemi</span>&nbsp;<span class="op" id="5094875">=</span>&nbsp;<span class="builtintype" id="5094877">true</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5094885">p</span><span class="op" id="5094886">.</span><span class="ident" id="5094887">lastTok</span>&nbsp;<span class="op" id="5094895">=</span>&nbsp;<span class="ident" id="5094897">token</span><span class="op" id="5094902">.</span><span class="ident" id="5094903">STRING</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5094913">default</span><span class="op" id="5094920">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5094925">fmt</span><span class="op" id="5094928">.</span><span class="ident" id="5094929">Fprintf</span><span class="op" id="5094936">(</span><span class="ident" id="5094937">os</span><span class="op" id="5094939">.</span><span class="ident" id="5094940">Stderr</span><span class="op" id="5094946">,</span>&nbsp;<span class="string" id="5094948">&#34;print:&nbsp;unsupported&nbsp;argument&nbsp;%v&nbsp;(%T)\n&#34;</span><span class="op" id="5094987">,</span>&nbsp;<span class="ident" id="5094989">arg</span><span class="op" id="5094992">,</span>&nbsp;<span class="ident" id="5094994">arg</span><span class="op" id="5094997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5095002">panic</span><span class="op" id="5095007">(</span><span class="string" id="5095008">&#34;go/printer&nbsp;type&#34;</span><span class="op" id="5095025">)</span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5095029">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5095033">//&nbsp;data&nbsp;!=&nbsp;&#34;&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5095050">next</span>&nbsp;<span class="op" id="5095055">:=</span>&nbsp;<span class="ident" id="5095058">p</span><span class="op" id="5095059">.</span><span class="ident" id="5095060">pos</span>&nbsp;<span class="comment" id="5095064">//&nbsp;estimated/accurate&nbsp;position&nbsp;of&nbsp;next&nbsp;item</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5095110">wroteNewline</span><span class="op" id="5095122">,</span>&nbsp;<span class="ident" id="5095124">droppedFF</span>&nbsp;<span class="op" id="5095134">:=</span>&nbsp;<span class="ident" id="5095137">p</span><span class="op" id="5095138">.</span><span class="ident" id="5095139">flush</span><span class="op" id="5095144">(</span><span class="ident" id="5095145">next</span><span class="op" id="5095149">,</span>&nbsp;<span class="ident" id="5095151">p</span><span class="op" id="5095152">.</span><span class="ident" id="5095153">lastTok</span><span class="op" id="5095160">)</span><br>
<span class="lineno">945</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5095165">//&nbsp;intersperse&nbsp;extra&nbsp;newlines&nbsp;if&nbsp;present&nbsp;in&nbsp;the&nbsp;source&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5095226">//&nbsp;if&nbsp;they&nbsp;don&#39;t&nbsp;cause&nbsp;extra&nbsp;semicolons&nbsp;(don&#39;t&nbsp;do&nbsp;this&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5095286">//&nbsp;flush&nbsp;as&nbsp;it&nbsp;will&nbsp;cause&nbsp;extra&nbsp;newlines&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;a&nbsp;file)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5095351">if</span>&nbsp;<span class="op" id="5095354">!</span><span class="ident" id="5095355">p</span><span class="op" id="5095356">.</span><span class="ident" id="5095357">impliedSemi</span>&nbsp;<span class="op" id="5095369">{</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5095374">n</span>&nbsp;<span class="op" id="5095376">:=</span>&nbsp;<span class="ident" id="5095379">nlimit</span><span class="op" id="5095385">(</span><span class="ident" id="5095386">next</span><span class="op" id="5095390">.</span><span class="ident" id="5095391">Line</span>&nbsp;<span class="op" id="5095396">-</span>&nbsp;<span class="ident" id="5095398">p</span><span class="op" id="5095399">.</span><span class="ident" id="5095400">pos</span><span class="op" id="5095403">.</span><span class="ident" id="5095404">Line</span><span class="op" id="5095408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5095413">//&nbsp;don&#39;t&nbsp;exceed&nbsp;maxNewlines&nbsp;if&nbsp;we&nbsp;already&nbsp;wrote&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5095468">if</span>&nbsp;<span class="ident" id="5095471">wroteNewline</span>&nbsp;<span class="op" id="5095484">&amp;&amp;</span>&nbsp;<span class="ident" id="5095487">n</span>&nbsp;<span class="op" id="5095489">==</span>&nbsp;<span class="ident" id="5095492">maxNewlines</span>&nbsp;<span class="op" id="5095504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5095510">n</span>&nbsp;<span class="op" id="5095512">=</span>&nbsp;<span class="ident" id="5095514">maxNewlines</span>&nbsp;<span class="op" id="5095526">-</span>&nbsp;<span class="num" id="5095528">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5095533">}</span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5095538">if</span>&nbsp;<span class="ident" id="5095541">n</span>&nbsp;<span class="op" id="5095543">&gt;</span>&nbsp;<span class="num" id="5095545">0</span>&nbsp;<span class="op" id="5095547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5095553">ch</span>&nbsp;<span class="op" id="5095556">:=</span>&nbsp;<span class="builtintype" id="5095559">byte</span><span class="op" id="5095563">(</span><span class="string" id="5095564">&#39;\n&#39;</span><span class="op" id="5095568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5095574">if</span>&nbsp;<span class="ident" id="5095577">droppedFF</span>&nbsp;<span class="op" id="5095587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5095594">ch</span>&nbsp;<span class="op" id="5095597">=</span>&nbsp;<span class="string" id="5095599">&#39;\f&#39;</span>&nbsp;<span class="comment" id="5095604">//&nbsp;use&nbsp;formfeed&nbsp;since&nbsp;we&nbsp;dropped&nbsp;one&nbsp;before</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5095652">}</span><br>
<span class="lineno">960</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5095658">p</span><span class="op" id="5095659">.</span><span class="ident" id="5095660">writeByte</span><span class="op" id="5095669">(</span><span class="ident" id="5095670">ch</span><span class="op" id="5095672">,</span>&nbsp;<span class="ident" id="5095674">n</span><span class="op" id="5095675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5095681">impliedSemi</span>&nbsp;<span class="op" id="5095693">=</span>&nbsp;<span class="builtintype" id="5095695">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5095704">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5095708">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">965</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5095713">//&nbsp;the&nbsp;next&nbsp;token&nbsp;starts&nbsp;now&nbsp;-&nbsp;record&nbsp;its&nbsp;line&nbsp;number&nbsp;if&nbsp;requested</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5095782">if</span>&nbsp;<span class="ident" id="5095785">p</span><span class="op" id="5095786">.</span><span class="ident" id="5095787">linePtr</span>&nbsp;<span class="op" id="5095795">!=</span>&nbsp;<span class="builtintype" id="5095798">nil</span>&nbsp;<span class="op" id="5095802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5095807">*</span><span class="ident" id="5095808">p</span><span class="op" id="5095809">.</span><span class="ident" id="5095810">linePtr</span>&nbsp;<span class="op" id="5095818">=</span>&nbsp;<span class="ident" id="5095820">p</span><span class="op" id="5095821">.</span><span class="ident" id="5095822">out</span><span class="op" id="5095825">.</span><span class="ident" id="5095826">Line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5095834">p</span><span class="op" id="5095835">.</span><span class="ident" id="5095836">linePtr</span>&nbsp;<span class="op" id="5095844">=</span>&nbsp;<span class="builtintype" id="5095846">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5095852">}</span><br>
<span class="lineno">970</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5095857">p</span><span class="op" id="5095858">.</span><span class="ident" id="5095859">writeString</span><span class="op" id="5095870">(</span><span class="ident" id="5095871">next</span><span class="op" id="5095875">,</span>&nbsp;<span class="ident" id="5095877">data</span><span class="op" id="5095881">,</span>&nbsp;<span class="ident" id="5095883">isLit</span><span class="op" id="5095888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5095892">p</span><span class="op" id="5095893">.</span><span class="ident" id="5095894">impliedSemi</span>&nbsp;<span class="op" id="5095906">=</span>&nbsp;<span class="ident" id="5095908">impliedSemi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5095921">}</span><br>
<span class="lineno"></span><span class="op" id="5095923">}</span><br>
<span class="lineno">975</span><br>
<span class="lineno"></span><span class="comment" id="5095926">//&nbsp;flush&nbsp;prints&nbsp;any&nbsp;pending&nbsp;comments&nbsp;and&nbsp;whitespace&nbsp;occurring&nbsp;textually</span><br>
<span class="lineno"></span><span class="comment" id="5095998">//&nbsp;before&nbsp;the&nbsp;position&nbsp;of&nbsp;the&nbsp;next&nbsp;token&nbsp;tok.&nbsp;The&nbsp;flush&nbsp;result&nbsp;indicates</span><br>
<span class="lineno"></span><span class="comment" id="5096071">//&nbsp;if&nbsp;a&nbsp;newline&nbsp;was&nbsp;written&nbsp;or&nbsp;if&nbsp;a&nbsp;formfeed&nbsp;was&nbsp;dropped&nbsp;from&nbsp;the&nbsp;whitespace</span><br>
<span class="lineno"></span><span class="comment" id="5096148">//&nbsp;buffer.</span><br>
<span class="lineno">980</span><span class="comment" id="5096159">//</span><br>
<span class="lineno"></span><span class="keyword" id="5096162">func</span>&nbsp;<span class="op" id="5096167">(</span><span class="ident" id="5096168">p</span>&nbsp;<span class="op" id="5096170">*</span><span class="ident" id="5096171">printer</span><span class="op" id="5096178">)</span>&nbsp;<span class="ident" id="5096180">flush</span><span class="op" id="5096185">(</span><span class="ident" id="5096186">next</span>&nbsp;<span class="ident" id="5096191">token</span><span class="op" id="5096196">.</span><span class="ident" id="5096197">Position</span><span class="op" id="5096205">,</span>&nbsp;<span class="ident" id="5096207">tok</span>&nbsp;<span class="ident" id="5096211">token</span><span class="op" id="5096216">.</span><span class="ident" id="5096217">Token</span><span class="op" id="5096222">)</span>&nbsp;<span class="op" id="5096224">(</span><span class="ident" id="5096225">wroteNewline</span><span class="op" id="5096237">,</span>&nbsp;<span class="ident" id="5096239">droppedFF</span>&nbsp;<span class="builtintype" id="5096249">bool</span><span class="op" id="5096253">)</span>&nbsp;<span class="op" id="5096255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5096258">if</span>&nbsp;<span class="ident" id="5096261">p</span><span class="op" id="5096262">.</span><span class="ident" id="5096263">commentBefore</span><span class="op" id="5096276">(</span><span class="ident" id="5096277">next</span><span class="op" id="5096281">)</span>&nbsp;<span class="op" id="5096283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5096287">//&nbsp;if&nbsp;there&nbsp;are&nbsp;comments&nbsp;before&nbsp;the&nbsp;next&nbsp;item,&nbsp;intersperse&nbsp;them</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5096353">wroteNewline</span><span class="op" id="5096365">,</span>&nbsp;<span class="ident" id="5096367">droppedFF</span>&nbsp;<span class="op" id="5096377">=</span>&nbsp;<span class="ident" id="5096379">p</span><span class="op" id="5096380">.</span><span class="ident" id="5096381">intersperseComments</span><span class="op" id="5096400">(</span><span class="ident" id="5096401">next</span><span class="op" id="5096405">,</span>&nbsp;<span class="ident" id="5096407">tok</span><span class="op" id="5096410">)</span><br>
<span class="lineno">985</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5096413">}</span>&nbsp;<span class="keyword" id="5096415">else</span>&nbsp;<span class="op" id="5096420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5096424">//&nbsp;otherwise,&nbsp;write&nbsp;any&nbsp;leftover&nbsp;whitespace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5096470">p</span><span class="op" id="5096471">.</span><span class="ident" id="5096472">writeWhitespace</span><span class="op" id="5096487">(</span><span class="builtinfunc" id="5096488">len</span><span class="op" id="5096491">(</span><span class="ident" id="5096492">p</span><span class="op" id="5096493">.</span><span class="ident" id="5096494">wsbuf</span><span class="op" id="5096499">)</span><span class="op" id="5096500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5096503">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5096506">return</span><br>
<span class="lineno">990</span><span class="op" id="5096513">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5096516">//&nbsp;getNode&nbsp;returns&nbsp;the&nbsp;ast.CommentGroup&nbsp;associated&nbsp;with&nbsp;n,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="5096583">func</span>&nbsp;<span class="ident" id="5096588">getDoc</span><span class="op" id="5096594">(</span><span class="ident" id="5096595">n</span>&nbsp;<span class="ident" id="5096597">ast</span><span class="op" id="5096600">.</span><span class="ident" id="5096601">Node</span><span class="op" id="5096605">)</span>&nbsp;<span class="op" id="5096607">*</span><span class="ident" id="5096608">ast</span><span class="op" id="5096611">.</span><span class="ident" id="5096612">CommentGroup</span>&nbsp;<span class="op" id="5096625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5096628">switch</span>&nbsp;<span class="ident" id="5096635">n</span>&nbsp;<span class="op" id="5096637">:=</span>&nbsp;<span class="ident" id="5096640">n</span><span class="op" id="5096641">.</span><span class="op" id="5096642">(</span><span class="keyword" id="5096643">type</span><span class="op" id="5096647">)</span>&nbsp;<span class="op" id="5096649">{</span><br>
<span class="lineno">995</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5096652">case</span>&nbsp;<span class="op" id="5096657">*</span><span class="ident" id="5096658">ast</span><span class="op" id="5096661">.</span><span class="ident" id="5096662">Field</span><span class="op" id="5096667">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5096671">return</span>&nbsp;<span class="ident" id="5096678">n</span><span class="op" id="5096679">.</span><span class="ident" id="5096680">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5096685">case</span>&nbsp;<span class="op" id="5096690">*</span><span class="ident" id="5096691">ast</span><span class="op" id="5096694">.</span><span class="ident" id="5096695">ImportSpec</span><span class="op" id="5096705">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5096709">return</span>&nbsp;<span class="ident" id="5096716">n</span><span class="op" id="5096717">.</span><span class="ident" id="5096718">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5096723">case</span>&nbsp;<span class="op" id="5096728">*</span><span class="ident" id="5096729">ast</span><span class="op" id="5096732">.</span><span class="ident" id="5096733">ValueSpec</span><span class="op" id="5096742">:</span><br>
<span class="lineno">1000</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5096746">return</span>&nbsp;<span class="ident" id="5096753">n</span><span class="op" id="5096754">.</span><span class="ident" id="5096755">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5096760">case</span>&nbsp;<span class="op" id="5096765">*</span><span class="ident" id="5096766">ast</span><span class="op" id="5096769">.</span><span class="ident" id="5096770">TypeSpec</span><span class="op" id="5096778">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5096782">return</span>&nbsp;<span class="ident" id="5096789">n</span><span class="op" id="5096790">.</span><span class="ident" id="5096791">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5096796">case</span>&nbsp;<span class="op" id="5096801">*</span><span class="ident" id="5096802">ast</span><span class="op" id="5096805">.</span><span class="ident" id="5096806">GenDecl</span><span class="op" id="5096813">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5096817">return</span>&nbsp;<span class="ident" id="5096824">n</span><span class="op" id="5096825">.</span><span class="ident" id="5096826">Doc</span><br>
<span class="lineno">1005</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5096831">case</span>&nbsp;<span class="op" id="5096836">*</span><span class="ident" id="5096837">ast</span><span class="op" id="5096840">.</span><span class="ident" id="5096841">FuncDecl</span><span class="op" id="5096849">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5096853">return</span>&nbsp;<span class="ident" id="5096860">n</span><span class="op" id="5096861">.</span><span class="ident" id="5096862">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5096867">case</span>&nbsp;<span class="op" id="5096872">*</span><span class="ident" id="5096873">ast</span><span class="op" id="5096876">.</span><span class="ident" id="5096877">File</span><span class="op" id="5096881">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5096885">return</span>&nbsp;<span class="ident" id="5096892">n</span><span class="op" id="5096893">.</span><span class="ident" id="5096894">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5096899">}</span><br>
<span class="lineno">1010</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5096902">return</span>&nbsp;<span class="builtintype" id="5096909">nil</span><br>
<span class="lineno"></span><span class="op" id="5096913">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5096916">func</span>&nbsp;<span class="op" id="5096921">(</span><span class="ident" id="5096922">p</span>&nbsp;<span class="op" id="5096924">*</span><span class="ident" id="5096925">printer</span><span class="op" id="5096932">)</span>&nbsp;<span class="ident" id="5096934">printNode</span><span class="op" id="5096943">(</span><span class="ident" id="5096944">node</span>&nbsp;<span class="keyword" id="5096949">interface</span><span class="op" id="5096958">{</span><span class="op" id="5096959">}</span><span class="op" id="5096960">)</span>&nbsp;<span class="builtintype" id="5096962">error</span>&nbsp;<span class="op" id="5096968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5096971">//&nbsp;unpack&nbsp;*CommentedNode,&nbsp;if&nbsp;any</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5097005">var</span>&nbsp;<span class="ident" id="5097009">comments</span>&nbsp;<span class="op" id="5097018">[</span><span class="op" id="5097019">]</span><span class="op" id="5097020">*</span><span class="ident" id="5097021">ast</span><span class="op" id="5097024">.</span><span class="ident" id="5097025">CommentGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5097039">if</span>&nbsp;<span class="ident" id="5097042">cnode</span><span class="op" id="5097047">,</span>&nbsp;<span class="ident" id="5097049">ok</span>&nbsp;<span class="op" id="5097052">:=</span>&nbsp;<span class="ident" id="5097055">node</span><span class="op" id="5097059">.</span><span class="op" id="5097060">(</span><span class="op" id="5097061">*</span><span class="ident" id="5097062">CommentedNode</span><span class="op" id="5097075">)</span><span class="op" id="5097076">;</span>&nbsp;<span class="ident" id="5097078">ok</span>&nbsp;<span class="op" id="5097081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5097085">node</span>&nbsp;<span class="op" id="5097090">=</span>&nbsp;<span class="ident" id="5097092">cnode</span><span class="op" id="5097097">.</span><span class="ident" id="5097098">Node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5097105">comments</span>&nbsp;<span class="op" id="5097114">=</span>&nbsp;<span class="ident" id="5097116">cnode</span><span class="op" id="5097121">.</span><span class="ident" id="5097122">Comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5097132">}</span><br>
<span class="lineno">1020</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5097136">if</span>&nbsp;<span class="ident" id="5097139">comments</span>&nbsp;<span class="op" id="5097148">!=</span>&nbsp;<span class="builtintype" id="5097151">nil</span>&nbsp;<span class="op" id="5097155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5097159">//&nbsp;commented&nbsp;node&nbsp;-&nbsp;restrict&nbsp;comment&nbsp;list&nbsp;to&nbsp;relevant&nbsp;range</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5097221">n</span><span class="op" id="5097222">,</span>&nbsp;<span class="ident" id="5097224">ok</span>&nbsp;<span class="op" id="5097227">:=</span>&nbsp;<span class="ident" id="5097230">node</span><span class="op" id="5097234">.</span><span class="op" id="5097235">(</span><span class="ident" id="5097236">ast</span><span class="op" id="5097239">.</span><span class="ident" id="5097240">Node</span><span class="op" id="5097244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5097248">if</span>&nbsp;<span class="op" id="5097251">!</span><span class="ident" id="5097252">ok</span>&nbsp;<span class="op" id="5097255">{</span><br>
<span class="lineno">1025</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5097260">goto</span>&nbsp;<span class="ident" id="5097265">unsupported</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5097279">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5097283">beg</span>&nbsp;<span class="op" id="5097287">:=</span>&nbsp;<span class="ident" id="5097290">n</span><span class="op" id="5097291">.</span><span class="ident" id="5097292">Pos</span><span class="op" id="5097295">(</span><span class="op" id="5097296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5097300">end</span>&nbsp;<span class="op" id="5097304">:=</span>&nbsp;<span class="ident" id="5097307">n</span><span class="op" id="5097308">.</span><span class="ident" id="5097309">End</span><span class="op" id="5097312">(</span><span class="op" id="5097313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5097317">//&nbsp;if&nbsp;the&nbsp;node&nbsp;has&nbsp;associated&nbsp;documentation,</span><br>
<span class="lineno">1030</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5097364">//&nbsp;include&nbsp;that&nbsp;commentgroup&nbsp;in&nbsp;the&nbsp;range</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5097408">//&nbsp;(the&nbsp;comment&nbsp;list&nbsp;is&nbsp;sorted&nbsp;in&nbsp;the&nbsp;order</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5097454">//&nbsp;of&nbsp;the&nbsp;comment&nbsp;appearance&nbsp;in&nbsp;the&nbsp;source&nbsp;code)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5097505">if</span>&nbsp;<span class="ident" id="5097508">doc</span>&nbsp;<span class="op" id="5097512">:=</span>&nbsp;<span class="ident" id="5097515">getDoc</span><span class="op" id="5097521">(</span><span class="ident" id="5097522">n</span><span class="op" id="5097523">)</span><span class="op" id="5097524">;</span>&nbsp;<span class="ident" id="5097526">doc</span>&nbsp;<span class="op" id="5097530">!=</span>&nbsp;<span class="builtintype" id="5097533">nil</span>&nbsp;<span class="op" id="5097537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5097542">beg</span>&nbsp;<span class="op" id="5097546">=</span>&nbsp;<span class="ident" id="5097548">doc</span><span class="op" id="5097551">.</span><span class="ident" id="5097552">Pos</span><span class="op" id="5097555">(</span><span class="op" id="5097556">)</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5097560">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5097564">//&nbsp;token.Pos&nbsp;values&nbsp;are&nbsp;global&nbsp;offsets,&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5097613">//&nbsp;compare&nbsp;them&nbsp;directly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5097640">i</span>&nbsp;<span class="op" id="5097642">:=</span>&nbsp;<span class="num" id="5097645">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5097649">for</span>&nbsp;<span class="ident" id="5097653">i</span>&nbsp;<span class="op" id="5097655">&lt;</span>&nbsp;<span class="builtinfunc" id="5097657">len</span><span class="op" id="5097660">(</span><span class="ident" id="5097661">comments</span><span class="op" id="5097669">)</span>&nbsp;<span class="op" id="5097671">&amp;&amp;</span>&nbsp;<span class="ident" id="5097674">comments</span><span class="op" id="5097682">[</span><span class="ident" id="5097683">i</span><span class="op" id="5097684">]</span><span class="op" id="5097685">.</span><span class="ident" id="5097686">End</span><span class="op" id="5097689">(</span><span class="op" id="5097690">)</span>&nbsp;<span class="op" id="5097692">&lt;</span>&nbsp;<span class="ident" id="5097694">beg</span>&nbsp;<span class="op" id="5097698">{</span><br>
<span class="lineno">1040</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5097703">i</span><span class="op" id="5097704">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5097709">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5097713">j</span>&nbsp;<span class="op" id="5097715">:=</span>&nbsp;<span class="ident" id="5097718">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5097722">for</span>&nbsp;<span class="ident" id="5097726">j</span>&nbsp;<span class="op" id="5097728">&lt;</span>&nbsp;<span class="builtinfunc" id="5097730">len</span><span class="op" id="5097733">(</span><span class="ident" id="5097734">comments</span><span class="op" id="5097742">)</span>&nbsp;<span class="op" id="5097744">&amp;&amp;</span>&nbsp;<span class="ident" id="5097747">comments</span><span class="op" id="5097755">[</span><span class="ident" id="5097756">j</span><span class="op" id="5097757">]</span><span class="op" id="5097758">.</span><span class="ident" id="5097759">Pos</span><span class="op" id="5097762">(</span><span class="op" id="5097763">)</span>&nbsp;<span class="op" id="5097765">&lt;</span>&nbsp;<span class="ident" id="5097767">end</span>&nbsp;<span class="op" id="5097771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5097776">j</span><span class="op" id="5097777">++</span><br>
<span class="lineno">1045</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5097782">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5097786">if</span>&nbsp;<span class="ident" id="5097789">i</span>&nbsp;<span class="op" id="5097791">&lt;</span>&nbsp;<span class="ident" id="5097793">j</span>&nbsp;<span class="op" id="5097795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5097800">p</span><span class="op" id="5097801">.</span><span class="ident" id="5097802">comments</span>&nbsp;<span class="op" id="5097811">=</span>&nbsp;<span class="ident" id="5097813">comments</span><span class="op" id="5097821">[</span><span class="ident" id="5097822">i</span><span class="op" id="5097823">:</span><span class="ident" id="5097824">j</span><span class="op" id="5097825">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5097829">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5097832">}</span>&nbsp;<span class="keyword" id="5097834">else</span>&nbsp;<span class="keyword" id="5097839">if</span>&nbsp;<span class="ident" id="5097842">n</span><span class="op" id="5097843">,</span>&nbsp;<span class="ident" id="5097845">ok</span>&nbsp;<span class="op" id="5097848">:=</span>&nbsp;<span class="ident" id="5097851">node</span><span class="op" id="5097855">.</span><span class="op" id="5097856">(</span><span class="op" id="5097857">*</span><span class="ident" id="5097858">ast</span><span class="op" id="5097861">.</span><span class="ident" id="5097862">File</span><span class="op" id="5097866">)</span><span class="op" id="5097867">;</span>&nbsp;<span class="ident" id="5097869">ok</span>&nbsp;<span class="op" id="5097872">{</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5097876">//&nbsp;use&nbsp;ast.File&nbsp;comments,&nbsp;if&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5097911">p</span><span class="op" id="5097912">.</span><span class="ident" id="5097913">comments</span>&nbsp;<span class="op" id="5097922">=</span>&nbsp;<span class="ident" id="5097924">n</span><span class="op" id="5097925">.</span><span class="ident" id="5097926">Comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5097936">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5097940">//&nbsp;if&nbsp;there&nbsp;are&nbsp;no&nbsp;comments,&nbsp;use&nbsp;node&nbsp;comments</span><br>
<span class="lineno">1055</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5097988">p</span><span class="op" id="5097989">.</span><span class="ident" id="5097990">useNodeComments</span>&nbsp;<span class="op" id="5098006">=</span>&nbsp;<span class="ident" id="5098008">p</span><span class="op" id="5098009">.</span><span class="ident" id="5098010">comments</span>&nbsp;<span class="op" id="5098019">==</span>&nbsp;<span class="builtintype" id="5098022">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5098028">//&nbsp;get&nbsp;comments&nbsp;ready&nbsp;for&nbsp;use</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5098059">p</span><span class="op" id="5098060">.</span><span class="ident" id="5098061">nextComment</span><span class="op" id="5098072">(</span><span class="op" id="5098073">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1060</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5098077">//&nbsp;format&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5098093">switch</span>&nbsp;<span class="ident" id="5098100">n</span>&nbsp;<span class="op" id="5098102">:=</span>&nbsp;<span class="ident" id="5098105">node</span><span class="op" id="5098109">.</span><span class="op" id="5098110">(</span><span class="keyword" id="5098111">type</span><span class="op" id="5098115">)</span>&nbsp;<span class="op" id="5098117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5098120">case</span>&nbsp;<span class="ident" id="5098125">ast</span><span class="op" id="5098128">.</span><span class="ident" id="5098129">Expr</span><span class="op" id="5098133">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5098137">p</span><span class="op" id="5098138">.</span><span class="ident" id="5098139">expr</span><span class="op" id="5098143">(</span><span class="ident" id="5098144">n</span><span class="op" id="5098145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5098148">case</span>&nbsp;<span class="ident" id="5098153">ast</span><span class="op" id="5098156">.</span><span class="ident" id="5098157">Stmt</span><span class="op" id="5098161">:</span><br>
<span class="lineno">1065</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5098165">//&nbsp;A&nbsp;labeled&nbsp;statement&nbsp;will&nbsp;un-indent&nbsp;to&nbsp;position&nbsp;the&nbsp;label.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5098228">//&nbsp;Set&nbsp;p.indent&nbsp;to&nbsp;1&nbsp;so&nbsp;we&nbsp;don&#39;t&nbsp;get&nbsp;indent&nbsp;&#34;underflow&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5098287">if</span>&nbsp;<span class="ident" id="5098290">_</span><span class="op" id="5098291">,</span>&nbsp;<span class="ident" id="5098293">ok</span>&nbsp;<span class="op" id="5098296">:=</span>&nbsp;<span class="ident" id="5098299">n</span><span class="op" id="5098300">.</span><span class="op" id="5098301">(</span><span class="op" id="5098302">*</span><span class="ident" id="5098303">ast</span><span class="op" id="5098306">.</span><span class="ident" id="5098307">LabeledStmt</span><span class="op" id="5098318">)</span><span class="op" id="5098319">;</span>&nbsp;<span class="ident" id="5098321">ok</span>&nbsp;<span class="op" id="5098324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5098329">p</span><span class="op" id="5098330">.</span><span class="ident" id="5098331">indent</span>&nbsp;<span class="op" id="5098338">=</span>&nbsp;<span class="num" id="5098340">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5098344">}</span><br>
<span class="lineno">1070</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5098348">p</span><span class="op" id="5098349">.</span><span class="ident" id="5098350">stmt</span><span class="op" id="5098354">(</span><span class="ident" id="5098355">n</span><span class="op" id="5098356">,</span>&nbsp;<span class="builtintype" id="5098358">false</span><span class="op" id="5098363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5098366">case</span>&nbsp;<span class="ident" id="5098371">ast</span><span class="op" id="5098374">.</span><span class="ident" id="5098375">Decl</span><span class="op" id="5098379">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5098383">p</span><span class="op" id="5098384">.</span><span class="ident" id="5098385">decl</span><span class="op" id="5098389">(</span><span class="ident" id="5098390">n</span><span class="op" id="5098391">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5098394">case</span>&nbsp;<span class="ident" id="5098399">ast</span><span class="op" id="5098402">.</span><span class="ident" id="5098403">Spec</span><span class="op" id="5098407">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5098411">p</span><span class="op" id="5098412">.</span><span class="ident" id="5098413">spec</span><span class="op" id="5098417">(</span><span class="ident" id="5098418">n</span><span class="op" id="5098419">,</span>&nbsp;<span class="num" id="5098421">1</span><span class="op" id="5098422">,</span>&nbsp;<span class="builtintype" id="5098424">false</span><span class="op" id="5098429">)</span><br>
<span class="lineno">1075</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5098432">case</span>&nbsp;<span class="op" id="5098437">[</span><span class="op" id="5098438">]</span><span class="ident" id="5098439">ast</span><span class="op" id="5098442">.</span><span class="ident" id="5098443">Stmt</span><span class="op" id="5098447">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5098451">//&nbsp;A&nbsp;labeled&nbsp;statement&nbsp;will&nbsp;un-indent&nbsp;to&nbsp;position&nbsp;the&nbsp;label.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5098514">//&nbsp;Set&nbsp;p.indent&nbsp;to&nbsp;1&nbsp;so&nbsp;we&nbsp;don&#39;t&nbsp;get&nbsp;indent&nbsp;&#34;underflow&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5098573">for</span>&nbsp;<span class="ident" id="5098577">_</span><span class="op" id="5098578">,</span>&nbsp;<span class="ident" id="5098580">s</span>&nbsp;<span class="op" id="5098582">:=</span>&nbsp;<span class="keyword" id="5098585">range</span>&nbsp;<span class="ident" id="5098591">n</span>&nbsp;<span class="op" id="5098593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5098598">if</span>&nbsp;<span class="ident" id="5098601">_</span><span class="op" id="5098602">,</span>&nbsp;<span class="ident" id="5098604">ok</span>&nbsp;<span class="op" id="5098607">:=</span>&nbsp;<span class="ident" id="5098610">s</span><span class="op" id="5098611">.</span><span class="op" id="5098612">(</span><span class="op" id="5098613">*</span><span class="ident" id="5098614">ast</span><span class="op" id="5098617">.</span><span class="ident" id="5098618">LabeledStmt</span><span class="op" id="5098629">)</span><span class="op" id="5098630">;</span>&nbsp;<span class="ident" id="5098632">ok</span>&nbsp;<span class="op" id="5098635">{</span><br>
<span class="lineno">1080</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5098641">p</span><span class="op" id="5098642">.</span><span class="ident" id="5098643">indent</span>&nbsp;<span class="op" id="5098650">=</span>&nbsp;<span class="num" id="5098652">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5098657">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5098661">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5098665">p</span><span class="op" id="5098666">.</span><span class="ident" id="5098667">stmtList</span><span class="op" id="5098675">(</span><span class="ident" id="5098676">n</span><span class="op" id="5098677">,</span>&nbsp;<span class="num" id="5098679">0</span><span class="op" id="5098680">,</span>&nbsp;<span class="builtintype" id="5098682">false</span><span class="op" id="5098687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5098690">case</span>&nbsp;<span class="op" id="5098695">[</span><span class="op" id="5098696">]</span><span class="ident" id="5098697">ast</span><span class="op" id="5098700">.</span><span class="ident" id="5098701">Decl</span><span class="op" id="5098705">:</span><br>
<span class="lineno">1085</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5098709">p</span><span class="op" id="5098710">.</span><span class="ident" id="5098711">declList</span><span class="op" id="5098719">(</span><span class="ident" id="5098720">n</span><span class="op" id="5098721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5098724">case</span>&nbsp;<span class="op" id="5098729">*</span><span class="ident" id="5098730">ast</span><span class="op" id="5098733">.</span><span class="ident" id="5098734">File</span><span class="op" id="5098738">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5098742">p</span><span class="op" id="5098743">.</span><span class="ident" id="5098744">file</span><span class="op" id="5098748">(</span><span class="ident" id="5098749">n</span><span class="op" id="5098750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5098753">default</span><span class="op" id="5098760">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5098764">goto</span>&nbsp;<span class="ident" id="5098769">unsupported</span><br>
<span class="lineno">1090</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5098782">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5098786">return</span>&nbsp;<span class="builtintype" id="5098793">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="5098798">unsupported</span><span class="op" id="5098809">:</span><br>
<span class="lineno">1095</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5098812">return</span>&nbsp;<span class="ident" id="5098819">fmt</span><span class="op" id="5098822">.</span><span class="ident" id="5098823">Errorf</span><span class="op" id="5098829">(</span><span class="string" id="5098830">&#34;go/printer:&nbsp;unsupported&nbsp;node&nbsp;type&nbsp;%T&#34;</span><span class="op" id="5098868">,</span>&nbsp;<span class="ident" id="5098870">node</span><span class="op" id="5098874">)</span><br>
<span class="lineno"></span><span class="op" id="5098876">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5098879">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5098959">//&nbsp;Trimmer</span><br>
<span class="lineno">1100</span><br>
<span class="lineno"></span><span class="comment" id="5098971">//&nbsp;A&nbsp;trimmer&nbsp;is&nbsp;an&nbsp;io.Writer&nbsp;filter&nbsp;for&nbsp;stripping&nbsp;tabwriter.Escape</span><br>
<span class="lineno"></span><span class="comment" id="5099038">//&nbsp;characters,&nbsp;trailing&nbsp;blanks&nbsp;and&nbsp;tabs,&nbsp;and&nbsp;for&nbsp;converting&nbsp;formfeed</span><br>
<span class="lineno"></span><span class="comment" id="5099107">//&nbsp;and&nbsp;vtab&nbsp;characters&nbsp;into&nbsp;newlines&nbsp;and&nbsp;htabs&nbsp;(in&nbsp;case&nbsp;no&nbsp;tabwriter</span><br>
<span class="lineno"></span><span class="comment" id="5099176">//&nbsp;is&nbsp;used).&nbsp;Text&nbsp;bracketed&nbsp;by&nbsp;tabwriter.Escape&nbsp;characters&nbsp;is&nbsp;passed</span><br>
<span class="lineno">1105</span><span class="comment" id="5099245">//&nbsp;through&nbsp;unchanged.</span><br>
<span class="lineno"></span><span class="comment" id="5099267">//</span><br>
<span class="lineno"></span><span class="keyword" id="5099270">type</span>&nbsp;<span class="ident" id="5099275">trimmer</span>&nbsp;<span class="keyword" id="5099283">struct</span>&nbsp;<span class="op" id="5099290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5099293">output</span>&nbsp;<span class="ident" id="5099300">io</span><span class="op" id="5099302">.</span><span class="ident" id="5099303">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5099311">state</span>&nbsp;&nbsp;<span class="builtintype" id="5099318">int</span><br>
<span class="lineno">1110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5099323">space</span>&nbsp;&nbsp;<span class="op" id="5099330">[</span><span class="op" id="5099331">]</span><span class="builtintype" id="5099332">byte</span><br>
<span class="lineno"></span><span class="op" id="5099337">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5099340">//&nbsp;trimmer&nbsp;is&nbsp;implemented&nbsp;as&nbsp;a&nbsp;state&nbsp;machine.</span><br>
<span class="lineno"></span><span class="comment" id="5099386">//&nbsp;It&nbsp;can&nbsp;be&nbsp;in&nbsp;one&nbsp;of&nbsp;the&nbsp;following&nbsp;states:</span><br>
<span class="lineno">1115</span><span class="keyword" id="5099431">const</span>&nbsp;<span class="op" id="5099437">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5099440">inSpace</span>&nbsp;&nbsp;<span class="op" id="5099449">=</span>&nbsp;<span class="ident" id="5099451">iota</span>&nbsp;<span class="comment" id="5099456">//&nbsp;inside&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5099473">inEscape</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5099489">//&nbsp;inside&nbsp;text&nbsp;bracketed&nbsp;by&nbsp;tabwriter.Escapes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5099536">inText</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5099552">//&nbsp;inside&nbsp;text</span><br>
<span class="lineno"></span><span class="op" id="5099567">)</span><br>
<span class="lineno">1120</span><br>
<span class="lineno"></span><span class="keyword" id="5099570">func</span>&nbsp;<span class="op" id="5099575">(</span><span class="ident" id="5099576">p</span>&nbsp;<span class="op" id="5099578">*</span><span class="ident" id="5099579">trimmer</span><span class="op" id="5099586">)</span>&nbsp;<span class="ident" id="5099588">resetSpace</span><span class="op" id="5099598">(</span><span class="op" id="5099599">)</span>&nbsp;<span class="op" id="5099601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5099604">p</span><span class="op" id="5099605">.</span><span class="ident" id="5099606">state</span>&nbsp;<span class="op" id="5099612">=</span>&nbsp;<span class="ident" id="5099614">inSpace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5099623">p</span><span class="op" id="5099624">.</span><span class="ident" id="5099625">space</span>&nbsp;<span class="op" id="5099631">=</span>&nbsp;<span class="ident" id="5099633">p</span><span class="op" id="5099634">.</span><span class="ident" id="5099635">space</span><span class="op" id="5099640">[</span><span class="num" id="5099641">0</span><span class="op" id="5099642">:</span><span class="num" id="5099643">0</span><span class="op" id="5099644">]</span><br>
<span class="lineno"></span><span class="op" id="5099646">}</span><br>
<span class="lineno">1125</span><br>
<span class="lineno"></span><span class="comment" id="5099649">//&nbsp;Design&nbsp;note:&nbsp;It&nbsp;is&nbsp;tempting&nbsp;to&nbsp;eliminate&nbsp;extra&nbsp;blanks&nbsp;occurring&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="5099719">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;whitespace&nbsp;in&nbsp;this&nbsp;function&nbsp;as&nbsp;it&nbsp;could&nbsp;simplify&nbsp;some</span><br>
<span class="lineno"></span><span class="comment" id="5099789">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;of&nbsp;the&nbsp;blanks&nbsp;logic&nbsp;in&nbsp;the&nbsp;node&nbsp;printing&nbsp;functions.</span><br>
<span class="lineno"></span><span class="comment" id="5099857">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;However,&nbsp;this&nbsp;would&nbsp;mess&nbsp;up&nbsp;any&nbsp;formatting&nbsp;done&nbsp;by</span><br>
<span class="lineno">1130</span><span class="comment" id="5099924">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;tabwriter.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5099956">var</span>&nbsp;<span class="ident" id="5099960">aNewline</span>&nbsp;<span class="op" id="5099969">=</span>&nbsp;<span class="op" id="5099971">[</span><span class="op" id="5099972">]</span><span class="builtintype" id="5099973">byte</span><span class="op" id="5099977">(</span><span class="string" id="5099978">&#34;\n&#34;</span><span class="op" id="5099982">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5099985">func</span>&nbsp;<span class="op" id="5099990">(</span><span class="ident" id="5099991">p</span>&nbsp;<span class="op" id="5099993">*</span><span class="ident" id="5099994">trimmer</span><span class="op" id="5100001">)</span>&nbsp;<span class="ident" id="5100003">Write</span><span class="op" id="5100008">(</span><span class="ident" id="5100009">data</span>&nbsp;<span class="op" id="5100014">[</span><span class="op" id="5100015">]</span><span class="builtintype" id="5100016">byte</span><span class="op" id="5100020">)</span>&nbsp;<span class="op" id="5100022">(</span><span class="ident" id="5100023">n</span>&nbsp;<span class="builtintype" id="5100025">int</span><span class="op" id="5100028">,</span>&nbsp;<span class="ident" id="5100030">err</span>&nbsp;<span class="builtintype" id="5100034">error</span><span class="op" id="5100039">)</span>&nbsp;<span class="op" id="5100041">{</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5100044">//&nbsp;invariants:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5100060">//&nbsp;p.state&nbsp;==&nbsp;inSpace:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5100084">//&nbsp;&nbsp;&nbsp;&nbsp;p.space&nbsp;is&nbsp;unwritten</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5100109">//&nbsp;p.state&nbsp;==&nbsp;inEscape,&nbsp;inText:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5100142">//&nbsp;&nbsp;&nbsp;&nbsp;data[m:n]&nbsp;is&nbsp;unwritten</span><br>
<span class="lineno">1140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5100169">m</span>&nbsp;<span class="op" id="5100171">:=</span>&nbsp;<span class="num" id="5100174">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5100177">var</span>&nbsp;<span class="ident" id="5100181">b</span>&nbsp;<span class="builtintype" id="5100183">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5100189">for</span>&nbsp;<span class="ident" id="5100193">n</span><span class="op" id="5100194">,</span>&nbsp;<span class="ident" id="5100196">b</span>&nbsp;<span class="op" id="5100198">=</span>&nbsp;<span class="keyword" id="5100200">range</span>&nbsp;<span class="ident" id="5100206">data</span>&nbsp;<span class="op" id="5100211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5100215">if</span>&nbsp;<span class="ident" id="5100218">b</span>&nbsp;<span class="op" id="5100220">==</span>&nbsp;<span class="string" id="5100223">&#39;\v&#39;</span>&nbsp;<span class="op" id="5100228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5100233">b</span>&nbsp;<span class="op" id="5100235">=</span>&nbsp;<span class="string" id="5100237">&#39;\t&#39;</span>&nbsp;<span class="comment" id="5100242">//&nbsp;convert&nbsp;to&nbsp;htab</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5100263">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5100267">switch</span>&nbsp;<span class="ident" id="5100274">p</span><span class="op" id="5100275">.</span><span class="ident" id="5100276">state</span>&nbsp;<span class="op" id="5100282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5100286">case</span>&nbsp;<span class="ident" id="5100291">inSpace</span><span class="op" id="5100298">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5100303">switch</span>&nbsp;<span class="ident" id="5100310">b</span>&nbsp;<span class="op" id="5100312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5100317">case</span>&nbsp;<span class="string" id="5100322">&#39;\t&#39;</span><span class="op" id="5100326">,</span>&nbsp;<span class="string" id="5100328">&#39;&nbsp;&#39;</span><span class="op" id="5100331">:</span><br>
<span class="lineno">1150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5100337">p</span><span class="op" id="5100338">.</span><span class="ident" id="5100339">space</span>&nbsp;<span class="op" id="5100345">=</span>&nbsp;<span class="builtinfunc" id="5100347">append</span><span class="op" id="5100353">(</span><span class="ident" id="5100354">p</span><span class="op" id="5100355">.</span><span class="ident" id="5100356">space</span><span class="op" id="5100361">,</span>&nbsp;<span class="ident" id="5100363">b</span><span class="op" id="5100364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5100369">case</span>&nbsp;<span class="string" id="5100374">&#39;\n&#39;</span><span class="op" id="5100378">,</span>&nbsp;<span class="string" id="5100380">&#39;\f&#39;</span><span class="op" id="5100384">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5100390">p</span><span class="op" id="5100391">.</span><span class="ident" id="5100392">resetSpace</span><span class="op" id="5100402">(</span><span class="op" id="5100403">)</span>&nbsp;<span class="comment" id="5100405">//&nbsp;discard&nbsp;trailing&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5100435">_</span><span class="op" id="5100436">,</span>&nbsp;<span class="ident" id="5100438">err</span>&nbsp;<span class="op" id="5100442">=</span>&nbsp;<span class="ident" id="5100444">p</span><span class="op" id="5100445">.</span><span class="ident" id="5100446">output</span><span class="op" id="5100452">.</span><span class="ident" id="5100453">Write</span><span class="op" id="5100458">(</span><span class="ident" id="5100459">aNewline</span><span class="op" id="5100467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5100472">case</span>&nbsp;<span class="ident" id="5100477">tabwriter</span><span class="op" id="5100486">.</span><span class="ident" id="5100487">Escape</span><span class="op" id="5100493">:</span><br>
<span class="lineno">1155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5100499">_</span><span class="op" id="5100500">,</span>&nbsp;<span class="ident" id="5100502">err</span>&nbsp;<span class="op" id="5100506">=</span>&nbsp;<span class="ident" id="5100508">p</span><span class="op" id="5100509">.</span><span class="ident" id="5100510">output</span><span class="op" id="5100516">.</span><span class="ident" id="5100517">Write</span><span class="op" id="5100522">(</span><span class="ident" id="5100523">p</span><span class="op" id="5100524">.</span><span class="ident" id="5100525">space</span><span class="op" id="5100530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5100536">p</span><span class="op" id="5100537">.</span><span class="ident" id="5100538">state</span>&nbsp;<span class="op" id="5100544">=</span>&nbsp;<span class="ident" id="5100546">inEscape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5100559">m</span>&nbsp;<span class="op" id="5100561">=</span>&nbsp;<span class="ident" id="5100563">n</span>&nbsp;<span class="op" id="5100565">+</span>&nbsp;<span class="num" id="5100567">1</span>&nbsp;<span class="comment" id="5100569">//&nbsp;+1:&nbsp;skip&nbsp;tabwriter.Escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5100601">default</span><span class="op" id="5100608">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5100614">_</span><span class="op" id="5100615">,</span>&nbsp;<span class="ident" id="5100617">err</span>&nbsp;<span class="op" id="5100621">=</span>&nbsp;<span class="ident" id="5100623">p</span><span class="op" id="5100624">.</span><span class="ident" id="5100625">output</span><span class="op" id="5100631">.</span><span class="ident" id="5100632">Write</span><span class="op" id="5100637">(</span><span class="ident" id="5100638">p</span><span class="op" id="5100639">.</span><span class="ident" id="5100640">space</span><span class="op" id="5100645">)</span><br>
<span class="lineno">1160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5100651">p</span><span class="op" id="5100652">.</span><span class="ident" id="5100653">state</span>&nbsp;<span class="op" id="5100659">=</span>&nbsp;<span class="ident" id="5100661">inText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5100672">m</span>&nbsp;<span class="op" id="5100674">=</span>&nbsp;<span class="ident" id="5100676">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5100681">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5100685">case</span>&nbsp;<span class="ident" id="5100690">inEscape</span><span class="op" id="5100698">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5100703">if</span>&nbsp;<span class="ident" id="5100706">b</span>&nbsp;<span class="op" id="5100708">==</span>&nbsp;<span class="ident" id="5100711">tabwriter</span><span class="op" id="5100720">.</span><span class="ident" id="5100721">Escape</span>&nbsp;<span class="op" id="5100728">{</span><br>
<span class="lineno">1165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5100734">_</span><span class="op" id="5100735">,</span>&nbsp;<span class="ident" id="5100737">err</span>&nbsp;<span class="op" id="5100741">=</span>&nbsp;<span class="ident" id="5100743">p</span><span class="op" id="5100744">.</span><span class="ident" id="5100745">output</span><span class="op" id="5100751">.</span><span class="ident" id="5100752">Write</span><span class="op" id="5100757">(</span><span class="ident" id="5100758">data</span><span class="op" id="5100762">[</span><span class="ident" id="5100763">m</span><span class="op" id="5100764">:</span><span class="ident" id="5100765">n</span><span class="op" id="5100766">]</span><span class="op" id="5100767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5100773">p</span><span class="op" id="5100774">.</span><span class="ident" id="5100775">resetSpace</span><span class="op" id="5100785">(</span><span class="op" id="5100786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5100791">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5100795">case</span>&nbsp;<span class="ident" id="5100800">inText</span><span class="op" id="5100806">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5100811">switch</span>&nbsp;<span class="ident" id="5100818">b</span>&nbsp;<span class="op" id="5100820">{</span><br>
<span class="lineno">1170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5100825">case</span>&nbsp;<span class="string" id="5100830">&#39;\t&#39;</span><span class="op" id="5100834">,</span>&nbsp;<span class="string" id="5100836">&#39;&nbsp;&#39;</span><span class="op" id="5100839">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5100845">_</span><span class="op" id="5100846">,</span>&nbsp;<span class="ident" id="5100848">err</span>&nbsp;<span class="op" id="5100852">=</span>&nbsp;<span class="ident" id="5100854">p</span><span class="op" id="5100855">.</span><span class="ident" id="5100856">output</span><span class="op" id="5100862">.</span><span class="ident" id="5100863">Write</span><span class="op" id="5100868">(</span><span class="ident" id="5100869">data</span><span class="op" id="5100873">[</span><span class="ident" id="5100874">m</span><span class="op" id="5100875">:</span><span class="ident" id="5100876">n</span><span class="op" id="5100877">]</span><span class="op" id="5100878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5100884">p</span><span class="op" id="5100885">.</span><span class="ident" id="5100886">resetSpace</span><span class="op" id="5100896">(</span><span class="op" id="5100897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5100903">p</span><span class="op" id="5100904">.</span><span class="ident" id="5100905">space</span>&nbsp;<span class="op" id="5100911">=</span>&nbsp;<span class="builtinfunc" id="5100913">append</span><span class="op" id="5100919">(</span><span class="ident" id="5100920">p</span><span class="op" id="5100921">.</span><span class="ident" id="5100922">space</span><span class="op" id="5100927">,</span>&nbsp;<span class="ident" id="5100929">b</span><span class="op" id="5100930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5100935">case</span>&nbsp;<span class="string" id="5100940">&#39;\n&#39;</span><span class="op" id="5100944">,</span>&nbsp;<span class="string" id="5100946">&#39;\f&#39;</span><span class="op" id="5100950">:</span><br>
<span class="lineno">1175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5100956">_</span><span class="op" id="5100957">,</span>&nbsp;<span class="ident" id="5100959">err</span>&nbsp;<span class="op" id="5100963">=</span>&nbsp;<span class="ident" id="5100965">p</span><span class="op" id="5100966">.</span><span class="ident" id="5100967">output</span><span class="op" id="5100973">.</span><span class="ident" id="5100974">Write</span><span class="op" id="5100979">(</span><span class="ident" id="5100980">data</span><span class="op" id="5100984">[</span><span class="ident" id="5100985">m</span><span class="op" id="5100986">:</span><span class="ident" id="5100987">n</span><span class="op" id="5100988">]</span><span class="op" id="5100989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5100995">p</span><span class="op" id="5100996">.</span><span class="ident" id="5100997">resetSpace</span><span class="op" id="5101007">(</span><span class="op" id="5101008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5101014">_</span><span class="op" id="5101015">,</span>&nbsp;<span class="ident" id="5101017">err</span>&nbsp;<span class="op" id="5101021">=</span>&nbsp;<span class="ident" id="5101023">p</span><span class="op" id="5101024">.</span><span class="ident" id="5101025">output</span><span class="op" id="5101031">.</span><span class="ident" id="5101032">Write</span><span class="op" id="5101037">(</span><span class="ident" id="5101038">aNewline</span><span class="op" id="5101046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5101051">case</span>&nbsp;<span class="ident" id="5101056">tabwriter</span><span class="op" id="5101065">.</span><span class="ident" id="5101066">Escape</span><span class="op" id="5101072">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5101078">_</span><span class="op" id="5101079">,</span>&nbsp;<span class="ident" id="5101081">err</span>&nbsp;<span class="op" id="5101085">=</span>&nbsp;<span class="ident" id="5101087">p</span><span class="op" id="5101088">.</span><span class="ident" id="5101089">output</span><span class="op" id="5101095">.</span><span class="ident" id="5101096">Write</span><span class="op" id="5101101">(</span><span class="ident" id="5101102">data</span><span class="op" id="5101106">[</span><span class="ident" id="5101107">m</span><span class="op" id="5101108">:</span><span class="ident" id="5101109">n</span><span class="op" id="5101110">]</span><span class="op" id="5101111">)</span><br>
<span class="lineno">1180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5101117">p</span><span class="op" id="5101118">.</span><span class="ident" id="5101119">state</span>&nbsp;<span class="op" id="5101125">=</span>&nbsp;<span class="ident" id="5101127">inEscape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5101140">m</span>&nbsp;<span class="op" id="5101142">=</span>&nbsp;<span class="ident" id="5101144">n</span>&nbsp;<span class="op" id="5101146">+</span>&nbsp;<span class="num" id="5101148">1</span>&nbsp;<span class="comment" id="5101150">//&nbsp;+1:&nbsp;skip&nbsp;tabwriter.Escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5101182">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5101186">default</span><span class="op" id="5101193">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5101198">panic</span><span class="op" id="5101203">(</span><span class="string" id="5101204">&#34;unreachable&#34;</span><span class="op" id="5101217">)</span><br>
<span class="lineno">1185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5101221">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5101225">if</span>&nbsp;<span class="ident" id="5101228">err</span>&nbsp;<span class="op" id="5101232">!=</span>&nbsp;<span class="builtintype" id="5101235">nil</span>&nbsp;<span class="op" id="5101239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5101244">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5101253">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5101256">}</span><br>
<span class="lineno">1190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5101259">n</span>&nbsp;<span class="op" id="5101261">=</span>&nbsp;<span class="builtinfunc" id="5101263">len</span><span class="op" id="5101266">(</span><span class="ident" id="5101267">data</span><span class="op" id="5101271">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5101275">switch</span>&nbsp;<span class="ident" id="5101282">p</span><span class="op" id="5101283">.</span><span class="ident" id="5101284">state</span>&nbsp;<span class="op" id="5101290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5101293">case</span>&nbsp;<span class="ident" id="5101298">inEscape</span><span class="op" id="5101306">,</span>&nbsp;<span class="ident" id="5101308">inText</span><span class="op" id="5101314">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5101318">_</span><span class="op" id="5101319">,</span>&nbsp;<span class="ident" id="5101321">err</span>&nbsp;<span class="op" id="5101325">=</span>&nbsp;<span class="ident" id="5101327">p</span><span class="op" id="5101328">.</span><span class="ident" id="5101329">output</span><span class="op" id="5101335">.</span><span class="ident" id="5101336">Write</span><span class="op" id="5101341">(</span><span class="ident" id="5101342">data</span><span class="op" id="5101346">[</span><span class="ident" id="5101347">m</span><span class="op" id="5101348">:</span><span class="ident" id="5101349">n</span><span class="op" id="5101350">]</span><span class="op" id="5101351">)</span><br>
<span class="lineno">1195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5101355">p</span><span class="op" id="5101356">.</span><span class="ident" id="5101357">resetSpace</span><span class="op" id="5101367">(</span><span class="op" id="5101368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5101371">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5101375">return</span><br>
<span class="lineno"></span><span class="op" id="5101382">}</span><br>
<span class="lineno">1200</span><br>
<span class="lineno"></span><span class="comment" id="5101385">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5101465">//&nbsp;Public&nbsp;interface</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5101486">//&nbsp;A&nbsp;Mode&nbsp;value&nbsp;is&nbsp;a&nbsp;set&nbsp;of&nbsp;flags&nbsp;(or&nbsp;0).&nbsp;They&nbsp;control&nbsp;printing.</span><br>
<span class="lineno">1205</span><span class="keyword" id="5101551">type</span>&nbsp;<span class="ident" id="5101556">Mode</span>&nbsp;<span class="builtintype" id="5101561">uint</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5101567">const</span>&nbsp;<span class="op" id="5101573">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5101576">RawFormat</span>&nbsp;<span class="ident" id="5101586">Mode</span>&nbsp;<span class="op" id="5101591">=</span>&nbsp;<span class="num" id="5101593">1</span>&nbsp;<span class="op" id="5101595">&lt;&lt;</span>&nbsp;<span class="ident" id="5101598">iota</span>&nbsp;<span class="comment" id="5101603">//&nbsp;do&nbsp;not&nbsp;use&nbsp;a&nbsp;tabwriter;&nbsp;if&nbsp;set,&nbsp;UseSpaces&nbsp;is&nbsp;ignored</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5101660">TabIndent</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5101687">//&nbsp;use&nbsp;tabs&nbsp;for&nbsp;indentation&nbsp;independent&nbsp;of&nbsp;UseSpaces</span><br>
<span class="lineno">1210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5101741">UseSpaces</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5101768">//&nbsp;use&nbsp;spaces&nbsp;instead&nbsp;of&nbsp;tabs&nbsp;for&nbsp;alignment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5101813">SourcePos</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5101840">//&nbsp;emit&nbsp;//line&nbsp;comments&nbsp;to&nbsp;preserve&nbsp;original&nbsp;source&nbsp;positions</span><br>
<span class="lineno"></span><span class="op" id="5101902">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5101905">//&nbsp;A&nbsp;Config&nbsp;node&nbsp;controls&nbsp;the&nbsp;output&nbsp;of&nbsp;Fprint.</span><br>
<span class="lineno">1215</span><span class="keyword" id="5101953">type</span>&nbsp;<span class="ident" id="5101958">Config</span>&nbsp;<span class="keyword" id="5101965">struct</span>&nbsp;<span class="op" id="5101972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5101975">Mode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5101984">Mode</span>&nbsp;<span class="comment" id="5101989">//&nbsp;default:&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5102004">Tabwidth</span>&nbsp;<span class="builtintype" id="5102013">int</span>&nbsp;&nbsp;<span class="comment" id="5102018">//&nbsp;default:&nbsp;8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5102033">Indent</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5102042">int</span>&nbsp;&nbsp;<span class="comment" id="5102047">//&nbsp;default:&nbsp;0&nbsp;(all&nbsp;code&nbsp;is&nbsp;indented&nbsp;at&nbsp;least&nbsp;by&nbsp;this&nbsp;much)</span><br>
<span class="lineno"></span><span class="op" id="5102106">}</span><br>
<span class="lineno">1220</span><br>
<span class="lineno"></span><span class="comment" id="5102109">//&nbsp;fprint&nbsp;implements&nbsp;Fprint&nbsp;and&nbsp;takes&nbsp;a&nbsp;nodesSizes&nbsp;map&nbsp;for&nbsp;setting&nbsp;up&nbsp;the&nbsp;printer&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="5102198">func</span>&nbsp;<span class="op" id="5102203">(</span><span class="ident" id="5102204">cfg</span>&nbsp;<span class="op" id="5102208">*</span><span class="ident" id="5102209">Config</span><span class="op" id="5102215">)</span>&nbsp;<span class="ident" id="5102217">fprint</span><span class="op" id="5102223">(</span><span class="ident" id="5102224">output</span>&nbsp;<span class="ident" id="5102231">io</span><span class="op" id="5102233">.</span><span class="ident" id="5102234">Writer</span><span class="op" id="5102240">,</span>&nbsp;<span class="ident" id="5102242">fset</span>&nbsp;<span class="op" id="5102247">*</span><span class="ident" id="5102248">token</span><span class="op" id="5102253">.</span><span class="ident" id="5102254">FileSet</span><span class="op" id="5102261">,</span>&nbsp;<span class="ident" id="5102263">node</span>&nbsp;<span class="keyword" id="5102268">interface</span><span class="op" id="5102277">{</span><span class="op" id="5102278">}</span><span class="op" id="5102279">,</span>&nbsp;<span class="ident" id="5102281">nodeSizes</span>&nbsp;<span class="keyword" id="5102291">map</span><span class="op" id="5102294">[</span><span class="ident" id="5102295">ast</span><span class="op" id="5102298">.</span><span class="ident" id="5102299">Node</span><span class="op" id="5102303">]</span><span class="builtintype" id="5102304">int</span><span class="op" id="5102307">)</span>&nbsp;<span class="op" id="5102309">(</span><span class="ident" id="5102310">err</span>&nbsp;<span class="builtintype" id="5102314">error</span><span class="op" id="5102319">)</span>&nbsp;<span class="op" id="5102321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5102324">//&nbsp;print&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5102339">var</span>&nbsp;<span class="ident" id="5102343">p</span>&nbsp;<span class="ident" id="5102345">printer</span><br>
<span class="lineno">1225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5102354">p</span><span class="op" id="5102355">.</span><span class="ident" id="5102356">init</span><span class="op" id="5102360">(</span><span class="ident" id="5102361">cfg</span><span class="op" id="5102364">,</span>&nbsp;<span class="ident" id="5102366">fset</span><span class="op" id="5102370">,</span>&nbsp;<span class="ident" id="5102372">nodeSizes</span><span class="op" id="5102381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5102384">if</span>&nbsp;<span class="ident" id="5102387">err</span>&nbsp;<span class="op" id="5102391">=</span>&nbsp;<span class="ident" id="5102393">p</span><span class="op" id="5102394">.</span><span class="ident" id="5102395">printNode</span><span class="op" id="5102404">(</span><span class="ident" id="5102405">node</span><span class="op" id="5102409">)</span><span class="op" id="5102410">;</span>&nbsp;<span class="ident" id="5102412">err</span>&nbsp;<span class="op" id="5102416">!=</span>&nbsp;<span class="builtintype" id="5102419">nil</span>&nbsp;<span class="op" id="5102423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5102427">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5102435">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5102438">//&nbsp;print&nbsp;outstanding&nbsp;comments</span><br>
<span class="lineno">1230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5102469">p</span><span class="op" id="5102470">.</span><span class="ident" id="5102471">impliedSemi</span>&nbsp;<span class="op" id="5102483">=</span>&nbsp;<span class="builtintype" id="5102485">false</span>&nbsp;<span class="comment" id="5102491">//&nbsp;EOF&nbsp;acts&nbsp;like&nbsp;a&nbsp;newline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5102519">p</span><span class="op" id="5102520">.</span><span class="ident" id="5102521">flush</span><span class="op" id="5102526">(</span><span class="ident" id="5102527">token</span><span class="op" id="5102532">.</span><span class="ident" id="5102533">Position</span><span class="op" id="5102541">{</span><span class="ident" id="5102542">Offset</span><span class="op" id="5102548">:</span>&nbsp;<span class="ident" id="5102550">infinity</span><span class="op" id="5102558">,</span>&nbsp;<span class="ident" id="5102560">Line</span><span class="op" id="5102564">:</span>&nbsp;<span class="ident" id="5102566">infinity</span><span class="op" id="5102574">}</span><span class="op" id="5102575">,</span>&nbsp;<span class="ident" id="5102577">token</span><span class="op" id="5102582">.</span><span class="ident" id="5102583">EOF</span><span class="op" id="5102586">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5102590">//&nbsp;redirect&nbsp;output&nbsp;through&nbsp;a&nbsp;trimmer&nbsp;to&nbsp;eliminate&nbsp;trailing&nbsp;whitespace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5102661">//&nbsp;(Input&nbsp;to&nbsp;a&nbsp;tabwriter&nbsp;must&nbsp;be&nbsp;untrimmed&nbsp;since&nbsp;trailing&nbsp;tabs&nbsp;provide</span><br>
<span class="lineno">1235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5102733">//&nbsp;formatting&nbsp;information.&nbsp;The&nbsp;tabwriter&nbsp;could&nbsp;provide&nbsp;trimming</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5102798">//&nbsp;functionality&nbsp;but&nbsp;no&nbsp;tabwriter&nbsp;is&nbsp;used&nbsp;when&nbsp;RawFormat&nbsp;is&nbsp;set.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5102865">output</span>&nbsp;<span class="op" id="5102872">=</span>&nbsp;<span class="op" id="5102874">&amp;</span><span class="ident" id="5102875">trimmer</span><span class="op" id="5102882">{</span><span class="ident" id="5102883">output</span><span class="op" id="5102889">:</span>&nbsp;<span class="ident" id="5102891">output</span><span class="op" id="5102897">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5102901">//&nbsp;redirect&nbsp;output&nbsp;through&nbsp;a&nbsp;tabwriter&nbsp;if&nbsp;necessary</span><br>
<span class="lineno">1240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5102954">if</span>&nbsp;<span class="ident" id="5102957">cfg</span><span class="op" id="5102960">.</span><span class="ident" id="5102961">Mode</span><span class="op" id="5102965">&amp;</span><span class="ident" id="5102966">RawFormat</span>&nbsp;<span class="op" id="5102976">==</span>&nbsp;<span class="num" id="5102979">0</span>&nbsp;<span class="op" id="5102981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5102985">minwidth</span>&nbsp;<span class="op" id="5102994">:=</span>&nbsp;<span class="ident" id="5102997">cfg</span><span class="op" id="5103000">.</span><span class="ident" id="5103001">Tabwidth</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5103013">padchar</span>&nbsp;<span class="op" id="5103021">:=</span>&nbsp;<span class="builtintype" id="5103024">byte</span><span class="op" id="5103028">(</span><span class="string" id="5103029">&#39;\t&#39;</span><span class="op" id="5103033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5103037">if</span>&nbsp;<span class="ident" id="5103040">cfg</span><span class="op" id="5103043">.</span><span class="ident" id="5103044">Mode</span><span class="op" id="5103048">&amp;</span><span class="ident" id="5103049">UseSpaces</span>&nbsp;<span class="op" id="5103059">!=</span>&nbsp;<span class="num" id="5103062">0</span>&nbsp;<span class="op" id="5103064">{</span><br>
<span class="lineno">1245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5103069">padchar</span>&nbsp;<span class="op" id="5103077">=</span>&nbsp;<span class="string" id="5103079">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5103085">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5103090">twmode</span>&nbsp;<span class="op" id="5103097">:=</span>&nbsp;<span class="ident" id="5103100">tabwriter</span><span class="op" id="5103109">.</span><span class="ident" id="5103110">DiscardEmptyColumns</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5103132">if</span>&nbsp;<span class="ident" id="5103135">cfg</span><span class="op" id="5103138">.</span><span class="ident" id="5103139">Mode</span><span class="op" id="5103143">&amp;</span><span class="ident" id="5103144">TabIndent</span>&nbsp;<span class="op" id="5103154">!=</span>&nbsp;<span class="num" id="5103157">0</span>&nbsp;<span class="op" id="5103159">{</span><br>
<span class="lineno">1250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5103164">minwidth</span>&nbsp;<span class="op" id="5103173">=</span>&nbsp;<span class="num" id="5103175">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5103180">twmode</span>&nbsp;<span class="op" id="5103187">|=</span>&nbsp;<span class="ident" id="5103190">tabwriter</span><span class="op" id="5103199">.</span><span class="ident" id="5103200">TabIndent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5103212">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5103217">output</span>&nbsp;<span class="op" id="5103224">=</span>&nbsp;<span class="ident" id="5103226">tabwriter</span><span class="op" id="5103235">.</span><span class="ident" id="5103236">NewWriter</span><span class="op" id="5103245">(</span><span class="ident" id="5103246">output</span><span class="op" id="5103252">,</span>&nbsp;<span class="ident" id="5103254">minwidth</span><span class="op" id="5103262">,</span>&nbsp;<span class="ident" id="5103264">cfg</span><span class="op" id="5103267">.</span><span class="ident" id="5103268">Tabwidth</span><span class="op" id="5103276">,</span>&nbsp;<span class="num" id="5103278">1</span><span class="op" id="5103279">,</span>&nbsp;<span class="ident" id="5103281">padchar</span><span class="op" id="5103288">,</span>&nbsp;<span class="ident" id="5103290">twmode</span><span class="op" id="5103296">)</span><br>
<span class="lineno">1255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5103299">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5103303">//&nbsp;write&nbsp;printer&nbsp;result&nbsp;via&nbsp;tabwriter/trimmer&nbsp;to&nbsp;output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5103360">if</span>&nbsp;<span class="ident" id="5103363">_</span><span class="op" id="5103364">,</span>&nbsp;<span class="ident" id="5103366">err</span>&nbsp;<span class="op" id="5103370">=</span>&nbsp;<span class="ident" id="5103372">output</span><span class="op" id="5103378">.</span><span class="ident" id="5103379">Write</span><span class="op" id="5103384">(</span><span class="ident" id="5103385">p</span><span class="op" id="5103386">.</span><span class="ident" id="5103387">output</span><span class="op" id="5103393">)</span><span class="op" id="5103394">;</span>&nbsp;<span class="ident" id="5103396">err</span>&nbsp;<span class="op" id="5103400">!=</span>&nbsp;<span class="builtintype" id="5103403">nil</span>&nbsp;<span class="op" id="5103407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5103411">return</span><br>
<span class="lineno">1260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5103419">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5103423">//&nbsp;flush&nbsp;tabwriter,&nbsp;if&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5103451">if</span>&nbsp;<span class="ident" id="5103454">tw</span><span class="op" id="5103456">,</span>&nbsp;<span class="ident" id="5103458">_</span>&nbsp;<span class="op" id="5103460">:=</span>&nbsp;<span class="ident" id="5103463">output</span><span class="op" id="5103469">.</span><span class="op" id="5103470">(</span><span class="op" id="5103471">*</span><span class="ident" id="5103472">tabwriter</span><span class="op" id="5103481">.</span><span class="ident" id="5103482">Writer</span><span class="op" id="5103488">)</span><span class="op" id="5103489">;</span>&nbsp;<span class="ident" id="5103491">tw</span>&nbsp;<span class="op" id="5103494">!=</span>&nbsp;<span class="builtintype" id="5103497">nil</span>&nbsp;<span class="op" id="5103501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5103505">err</span>&nbsp;<span class="op" id="5103509">=</span>&nbsp;<span class="ident" id="5103511">tw</span><span class="op" id="5103513">.</span><span class="ident" id="5103514">Flush</span><span class="op" id="5103519">(</span><span class="op" id="5103520">)</span><br>
<span class="lineno">1265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5103523">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5103527">return</span><br>
<span class="lineno"></span><span class="op" id="5103534">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1270</span><span class="comment" id="5103537">//&nbsp;A&nbsp;CommentedNode&nbsp;bundles&nbsp;an&nbsp;AST&nbsp;node&nbsp;and&nbsp;corresponding&nbsp;comments.</span><br>
<span class="lineno"></span><span class="comment" id="5103604">//&nbsp;It&nbsp;may&nbsp;be&nbsp;provided&nbsp;as&nbsp;argument&nbsp;to&nbsp;any&nbsp;of&nbsp;the&nbsp;Fprint&nbsp;functions.</span><br>
<span class="lineno"></span><span class="comment" id="5103670">//</span><br>
<span class="lineno"></span><span class="keyword" id="5103673">type</span>&nbsp;<span class="ident" id="5103678">CommentedNode</span>&nbsp;<span class="keyword" id="5103692">struct</span>&nbsp;<span class="op" id="5103699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5103702">Node</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5103711">interface</span><span class="op" id="5103720">{</span><span class="op" id="5103721">}</span>&nbsp;<span class="comment" id="5103723">//&nbsp;*ast.File,&nbsp;or&nbsp;ast.Expr,&nbsp;ast.Decl,&nbsp;ast.Spec,&nbsp;or&nbsp;ast.Stmt</span><br>
<span class="lineno">1275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5103783">Comments</span>&nbsp;<span class="op" id="5103792">[</span><span class="op" id="5103793">]</span><span class="op" id="5103794">*</span><span class="ident" id="5103795">ast</span><span class="op" id="5103798">.</span><span class="ident" id="5103799">CommentGroup</span><br>
<span class="lineno"></span><span class="op" id="5103812">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5103815">//&nbsp;Fprint&nbsp;&#34;pretty-prints&#34;&nbsp;an&nbsp;AST&nbsp;node&nbsp;to&nbsp;output&nbsp;for&nbsp;a&nbsp;given&nbsp;configuration&nbsp;cfg.</span><br>
<span class="lineno"></span><span class="comment" id="5103894">//&nbsp;Position&nbsp;information&nbsp;is&nbsp;interpreted&nbsp;relative&nbsp;to&nbsp;the&nbsp;file&nbsp;set&nbsp;fset.</span><br>
<span class="lineno">1280</span><span class="comment" id="5103964">//&nbsp;The&nbsp;node&nbsp;type&nbsp;must&nbsp;be&nbsp;*ast.File,&nbsp;*CommentedNode,&nbsp;[]ast.Decl,&nbsp;[]ast.Stmt,</span><br>
<span class="lineno"></span><span class="comment" id="5104040">//&nbsp;or&nbsp;assignment-compatible&nbsp;to&nbsp;ast.Expr,&nbsp;ast.Decl,&nbsp;ast.Spec,&nbsp;or&nbsp;ast.Stmt.</span><br>
<span class="lineno"></span><span class="comment" id="5104114">//</span><br>
<span class="lineno"></span><span class="keyword" id="5104117">func</span>&nbsp;<span class="op" id="5104122">(</span><span class="ident" id="5104123">cfg</span>&nbsp;<span class="op" id="5104127">*</span><span class="ident" id="5104128">Config</span><span class="op" id="5104134">)</span>&nbsp;<span class="ident" id="5104136">Fprint</span><span class="op" id="5104142">(</span><span class="ident" id="5104143">output</span>&nbsp;<span class="ident" id="5104150">io</span><span class="op" id="5104152">.</span><span class="ident" id="5104153">Writer</span><span class="op" id="5104159">,</span>&nbsp;<span class="ident" id="5104161">fset</span>&nbsp;<span class="op" id="5104166">*</span><span class="ident" id="5104167">token</span><span class="op" id="5104172">.</span><span class="ident" id="5104173">FileSet</span><span class="op" id="5104180">,</span>&nbsp;<span class="ident" id="5104182">node</span>&nbsp;<span class="keyword" id="5104187">interface</span><span class="op" id="5104196">{</span><span class="op" id="5104197">}</span><span class="op" id="5104198">)</span>&nbsp;<span class="builtintype" id="5104200">error</span>&nbsp;<span class="op" id="5104206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5104209">return</span>&nbsp;<span class="ident" id="5104216">cfg</span><span class="op" id="5104219">.</span><span class="ident" id="5104220">fprint</span><span class="op" id="5104226">(</span><span class="ident" id="5104227">output</span><span class="op" id="5104233">,</span>&nbsp;<span class="ident" id="5104235">fset</span><span class="op" id="5104239">,</span>&nbsp;<span class="ident" id="5104241">node</span><span class="op" id="5104245">,</span>&nbsp;<span class="builtinfunc" id="5104247">make</span><span class="op" id="5104251">(</span><span class="keyword" id="5104252">map</span><span class="op" id="5104255">[</span><span class="ident" id="5104256">ast</span><span class="op" id="5104259">.</span><span class="ident" id="5104260">Node</span><span class="op" id="5104264">]</span><span class="builtintype" id="5104265">int</span><span class="op" id="5104268">)</span><span class="op" id="5104269">)</span><br>
<span class="lineno">1285</span><span class="op" id="5104271">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5104274">//&nbsp;Fprint&nbsp;&#34;pretty-prints&#34;&nbsp;an&nbsp;AST&nbsp;node&nbsp;to&nbsp;output.</span><br>
<span class="lineno"></span><span class="comment" id="5104323">//&nbsp;It&nbsp;calls&nbsp;Config.Fprint&nbsp;with&nbsp;default&nbsp;settings.</span><br>
<span class="lineno"></span><span class="comment" id="5104372">//</span><br>
<span class="lineno">1290</span><span class="keyword" id="5104375">func</span>&nbsp;<span class="ident" id="5104380">Fprint</span><span class="op" id="5104386">(</span><span class="ident" id="5104387">output</span>&nbsp;<span class="ident" id="5104394">io</span><span class="op" id="5104396">.</span><span class="ident" id="5104397">Writer</span><span class="op" id="5104403">,</span>&nbsp;<span class="ident" id="5104405">fset</span>&nbsp;<span class="op" id="5104410">*</span><span class="ident" id="5104411">token</span><span class="op" id="5104416">.</span><span class="ident" id="5104417">FileSet</span><span class="op" id="5104424">,</span>&nbsp;<span class="ident" id="5104426">node</span>&nbsp;<span class="keyword" id="5104431">interface</span><span class="op" id="5104440">{</span><span class="op" id="5104441">}</span><span class="op" id="5104442">)</span>&nbsp;<span class="builtintype" id="5104444">error</span>&nbsp;<span class="op" id="5104450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5104453">return</span>&nbsp;<span class="op" id="5104460">(</span><span class="op" id="5104461">&amp;</span><span class="ident" id="5104462">Config</span><span class="op" id="5104468">{</span><span class="ident" id="5104469">Tabwidth</span><span class="op" id="5104477">:</span>&nbsp;<span class="num" id="5104479">8</span><span class="op" id="5104480">}</span><span class="op" id="5104481">)</span><span class="op" id="5104482">.</span><span class="ident" id="5104483">Fprint</span><span class="op" id="5104489">(</span><span class="ident" id="5104490">output</span><span class="op" id="5104496">,</span>&nbsp;<span class="ident" id="5104498">fset</span><span class="op" id="5104502">,</span>&nbsp;<span class="ident" id="5104504">node</span><span class="op" id="5104508">)</span><br>
<span class="lineno"></span><span class="op" id="5104510">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
