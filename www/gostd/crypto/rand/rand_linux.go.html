<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/rand</h2>
<ul>
<li><a href="/gostd/crypto/rand/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/rand/rand.go.html">rand.go</a></li>
<li><a href="/gostd/crypto/rand/rand_linux.go.html">rand_linux.go</a></li>
<li><a href="/gostd/crypto/rand/rand_test.go.html">rand_test.go</a></li>
<li><a href="/gostd/crypto/rand/rand_unix.go.html">rand_unix.go</a></li>
<li><a href="/gostd/crypto/rand/util.go.html">util.go</a></li>
<li><a href="/gostd/crypto/rand/util_test.go.html">util_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3853313">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3853369">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3853423">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3853474">package</span>&nbsp;<span class="ident" id="3853482">rand</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3853488">import</span>&nbsp;<span class="op" id="3853495">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3853498">&#34;internal/syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3853518">&#34;sync&#34;</span><br>
<span class="lineno">10</span><span class="op" id="3853525">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3853528">func</span>&nbsp;<span class="ident" id="3853533">init</span><span class="op" id="3853537">(</span><span class="op" id="3853538">)</span>&nbsp;<span class="op" id="3853540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3853543">altGetRandom</span>&nbsp;<span class="op" id="3853556">=</span>&nbsp;<span class="ident" id="3853558">getRandomLinux</span><br>
<span class="lineno"></span><span class="op" id="3853573">}</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="3853576">var</span>&nbsp;<span class="op" id="3853580">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3853583">once</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3853594">sync</span><span class="op" id="3853598">.</span><span class="ident" id="3853599">Once</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3853605">useSyscall</span>&nbsp;<span class="builtintype" id="3853616">bool</span><br>
<span class="lineno"></span><span class="op" id="3853621">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="3853624">func</span>&nbsp;<span class="ident" id="3853629">pickStrategy</span><span class="op" id="3853641">(</span><span class="op" id="3853642">)</span>&nbsp;<span class="op" id="3853644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3853647">//&nbsp;Test&nbsp;whether&nbsp;we&nbsp;should&nbsp;use&nbsp;the&nbsp;system&nbsp;call&nbsp;or&nbsp;/dev/urandom.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3853711">//&nbsp;We&#39;ll&nbsp;fall&nbsp;back&nbsp;to&nbsp;urandom&nbsp;if:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3853746">//&nbsp;-&nbsp;the&nbsp;kernel&nbsp;is&nbsp;too&nbsp;old&nbsp;(before&nbsp;3.17)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3853788">//&nbsp;-&nbsp;the&nbsp;machine&nbsp;has&nbsp;no&nbsp;entropy&nbsp;available&nbsp;(early&nbsp;boot&nbsp;+&nbsp;no&nbsp;hardware</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3853857">//&nbsp;&nbsp;&nbsp;entropy&nbsp;source?)&nbsp;and&nbsp;we&nbsp;want&nbsp;to&nbsp;avoid&nbsp;blocking&nbsp;later.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3853917">var</span>&nbsp;<span class="ident" id="3853921">buf</span>&nbsp;<span class="op" id="3853925">[</span><span class="num" id="3853926">1</span><span class="op" id="3853927">]</span><span class="builtintype" id="3853928">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3853934">n</span><span class="op" id="3853935">,</span>&nbsp;<span class="ident" id="3853937">err</span>&nbsp;<span class="op" id="3853941">:=</span>&nbsp;<span class="ident" id="3853944">syscall</span><span class="op" id="3853951">.</span><span class="ident" id="3853952">GetRandom</span><span class="op" id="3853961">(</span><span class="ident" id="3853962">buf</span><span class="op" id="3853965">[</span><span class="op" id="3853966">:</span><span class="op" id="3853967">]</span><span class="op" id="3853968">,</span>&nbsp;<span class="ident" id="3853970">syscall</span><span class="op" id="3853977">.</span><span class="ident" id="3853978">GRND_NONBLOCK</span><span class="op" id="3853991">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3853994">useSyscall</span>&nbsp;<span class="op" id="3854005">=</span>&nbsp;<span class="ident" id="3854007">n</span>&nbsp;<span class="op" id="3854009">==</span>&nbsp;<span class="num" id="3854012">1</span>&nbsp;<span class="op" id="3854014">&amp;&amp;</span>&nbsp;<span class="ident" id="3854017">err</span>&nbsp;<span class="op" id="3854021">==</span>&nbsp;<span class="ident" id="3854024">nil</span><br>
<span class="lineno">30</span><span class="op" id="3854028">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3854031">func</span>&nbsp;<span class="ident" id="3854036">getRandomLinux</span><span class="op" id="3854050">(</span><span class="ident" id="3854051">p</span>&nbsp;<span class="op" id="3854053">[</span><span class="op" id="3854054">]</span><span class="builtintype" id="3854055">byte</span><span class="op" id="3854059">)</span>&nbsp;<span class="op" id="3854061">(</span><span class="ident" id="3854062">ok</span>&nbsp;<span class="builtintype" id="3854065">bool</span><span class="op" id="3854069">)</span>&nbsp;<span class="op" id="3854071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3854074">once</span><span class="op" id="3854078">.</span><span class="ident" id="3854079">Do</span><span class="op" id="3854081">(</span><span class="ident" id="3854082">pickStrategy</span><span class="op" id="3854094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3854097">if</span>&nbsp;<span class="op" id="3854100">!</span><span class="ident" id="3854101">useSyscall</span>&nbsp;<span class="op" id="3854112">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3854116">return</span>&nbsp;<span class="builtintype" id="3854123">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3854130">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3854133">n</span><span class="op" id="3854134">,</span>&nbsp;<span class="ident" id="3854136">err</span>&nbsp;<span class="op" id="3854140">:=</span>&nbsp;<span class="ident" id="3854143">syscall</span><span class="op" id="3854150">.</span><span class="ident" id="3854151">GetRandom</span><span class="op" id="3854160">(</span><span class="ident" id="3854161">p</span><span class="op" id="3854162">,</span>&nbsp;<span class="num" id="3854164">0</span><span class="op" id="3854165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3854168">return</span>&nbsp;<span class="ident" id="3854175">n</span>&nbsp;<span class="op" id="3854177">==</span>&nbsp;<span class="builtinfunc" id="3854180">len</span><span class="op" id="3854183">(</span><span class="ident" id="3854184">p</span><span class="op" id="3854185">)</span>&nbsp;<span class="op" id="3854187">&amp;&amp;</span>&nbsp;<span class="ident" id="3854190">err</span>&nbsp;<span class="op" id="3854194">==</span>&nbsp;<span class="ident" id="3854197">nil</span><br>
<span class="lineno"></span><span class="op" id="3854201">}</span>
</div>
</body>
</html>
