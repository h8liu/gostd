<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="8509901">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8509956">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8510010">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="8510061">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;a&nbsp;simple&nbsp;printer&nbsp;performance&nbsp;benchmark:</span><br>
<span class="lineno"></span><span class="comment" id="8510125">//&nbsp;go&nbsp;test&nbsp;-bench=BenchmarkPrint</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8510159">package</span>&nbsp;<span class="ident" id="8510167">printer</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="8510176">import</span>&nbsp;<span class="op" id="8510183">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8510186">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8510195">&#34;go/ast&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8510205">&#34;go/parser&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8510218">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8510224">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8510237">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8510244">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8510254">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="8510257">var</span>&nbsp;<span class="ident" id="8510261">testfile</span>&nbsp;<span class="op" id="8510270">*</span><span class="ident" id="8510271"><a href="/go/printer/performance_test.go.html#8510195">ast</a></span><span class="op" id="8510274">.</span><span class="ident" id="8510275">File</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8510281">func</span>&nbsp;<span class="ident" id="8510286">testprint</span><span class="op" id="8510295">(</span><span class="ident" id="8510296">out</span>&nbsp;<span class="ident" id="8510300"><a href="/go/printer/performance_test.go.html#8510218">io</a></span><span class="op" id="8510302">.</span><span class="ident" id="8510303">Writer</span><span class="op" id="8510309">,</span>&nbsp;<span class="ident" id="8510311">file</span>&nbsp;<span class="op" id="8510316">*</span><span class="ident" id="8510317"><a href="/go/printer/performance_test.go.html#8510195">ast</a></span><span class="op" id="8510320">.</span><span class="ident" id="8510321">File</span><span class="op" id="8510325">)</span>&nbsp;<span class="op" id="8510327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8510330">if</span>&nbsp;<span class="ident" id="8510333">err</span>&nbsp;<span class="op" id="8510337">:=</span>&nbsp;<span class="op" id="8510340">(</span><span class="op" id="8510341">&amp;</span><span class="ident" id="8510342"><a href="/go/printer/printer.go.html#5359429">Config</a></span><span class="op" id="8510348">{</span><span class="ident" id="8510349"><a href="/go/printer/printer.go.html#5359131">TabIndent</a></span>&nbsp;<span class="op" id="8510359">|</span>&nbsp;<span class="ident" id="8510361"><a href="/go/printer/printer.go.html#5359212">UseSpaces</a></span><span class="op" id="8510370">,</span>&nbsp;<span class="num" id="8510372">8</span><span class="op" id="8510373">,</span>&nbsp;<span class="num" id="8510375">0</span><span class="op" id="8510376">}</span><span class="op" id="8510377">)</span><span class="op" id="8510378">.</span><span class="ident" id="8510379">Fprint</span><span class="op" id="8510385">(</span><span class="ident" id="8510386"><a href="/go/printer/performance_test.go.html#8510296">out</a></span><span class="op" id="8510389">,</span>&nbsp;<span class="ident" id="8510391"><a href="/go/printer/printer_test.go.html#8511532">fset</a></span><span class="op" id="8510395">,</span>&nbsp;<span class="ident" id="8510397"><a href="/go/printer/performance_test.go.html#8510311">file</a></span><span class="op" id="8510401">)</span><span class="op" id="8510402">;</span>&nbsp;<span class="ident" id="8510404"><a href="/go/printer/performance_test.go.html#8510333">err</a></span>&nbsp;<span class="op" id="8510408">!=</span>&nbsp;<span class="ident" id="8510411">nil</span>&nbsp;<span class="op" id="8510415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8510419"><a href="/go/printer/performance_test.go.html#8510237">log</a></span><span class="op" id="8510422">.</span><span class="ident" id="8510423">Fatalf</span><span class="op" id="8510429">(</span><span class="string" id="8510430">&#34;print&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="8510447">,</span>&nbsp;<span class="ident" id="8510449"><a href="/go/printer/performance_test.go.html#8510333">err</a></span><span class="op" id="8510452">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8510455">}</span><br>
<span class="lineno"></span><span class="op" id="8510457">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8510460">//&nbsp;cannot&nbsp;initialize&nbsp;in&nbsp;init&nbsp;because&nbsp;(printer)&nbsp;Fprint&nbsp;launches&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="keyword" id="8510535">func</span>&nbsp;<span class="ident" id="8510540">initialize</span><span class="op" id="8510550">(</span><span class="op" id="8510551">)</span>&nbsp;<span class="op" id="8510553">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8510556">const</span>&nbsp;<span class="ident" id="8510562">filename</span>&nbsp;<span class="op" id="8510571">=</span>&nbsp;<span class="string" id="8510573">&#34;testdata/parser.go&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8510596">src</span><span class="op" id="8510599">,</span>&nbsp;<span class="ident" id="8510601">err</span>&nbsp;<span class="op" id="8510605">:=</span>&nbsp;<span class="ident" id="8510608"><a href="/go/printer/performance_test.go.html#8510224">ioutil</a></span><span class="op" id="8510614">.</span><span class="ident" id="8510615">ReadFile</span><span class="op" id="8510623">(</span><span class="ident" id="8510624"><a href="/go/printer/performance_test.go.html#8510562">filename</a></span><span class="op" id="8510632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8510635">if</span>&nbsp;<span class="ident" id="8510638"><a href="/go/printer/performance_test.go.html#8510601">err</a></span>&nbsp;<span class="op" id="8510642">!=</span>&nbsp;<span class="ident" id="8510645">nil</span>&nbsp;<span class="op" id="8510649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8510653"><a href="/go/printer/performance_test.go.html#8510237">log</a></span><span class="op" id="8510656">.</span><span class="ident" id="8510657">Fatalf</span><span class="op" id="8510663">(</span><span class="string" id="8510664">&#34;%s&#34;</span><span class="op" id="8510668">,</span>&nbsp;<span class="ident" id="8510670"><a href="/go/printer/performance_test.go.html#8510601">err</a></span><span class="op" id="8510673">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8510676">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8510680">file</span><span class="op" id="8510684">,</span>&nbsp;<span class="ident" id="8510686"><a href="/go/printer/performance_test.go.html#8510601">err</a></span>&nbsp;<span class="op" id="8510690">:=</span>&nbsp;<span class="ident" id="8510693"><a href="/go/printer/performance_test.go.html#8510205">parser</a></span><span class="op" id="8510699">.</span><span class="ident" id="8510700">ParseFile</span><span class="op" id="8510709">(</span><span class="ident" id="8510710"><a href="/go/printer/printer_test.go.html#8511532">fset</a></span><span class="op" id="8510714">,</span>&nbsp;<span class="ident" id="8510716"><a href="/go/printer/performance_test.go.html#8510562">filename</a></span><span class="op" id="8510724">,</span>&nbsp;<span class="ident" id="8510726"><a href="/go/printer/performance_test.go.html#8510596">src</a></span><span class="op" id="8510729">,</span>&nbsp;<span class="ident" id="8510731"><a href="/go/printer/performance_test.go.html#8510205">parser</a></span><span class="op" id="8510737">.</span><span class="ident" id="8510738">ParseComments</span><span class="op" id="8510751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8510754">if</span>&nbsp;<span class="ident" id="8510757"><a href="/go/printer/performance_test.go.html#8510601">err</a></span>&nbsp;<span class="op" id="8510761">!=</span>&nbsp;<span class="ident" id="8510764">nil</span>&nbsp;<span class="op" id="8510768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8510772"><a href="/go/printer/performance_test.go.html#8510237">log</a></span><span class="op" id="8510775">.</span><span class="ident" id="8510776">Fatalf</span><span class="op" id="8510782">(</span><span class="string" id="8510783">&#34;%s&#34;</span><span class="op" id="8510787">,</span>&nbsp;<span class="ident" id="8510789"><a href="/go/printer/performance_test.go.html#8510601">err</a></span><span class="op" id="8510792">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8510795">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8510799">var</span>&nbsp;<span class="ident" id="8510803">buf</span>&nbsp;<span class="ident" id="8510807"><a href="/go/printer/performance_test.go.html#8510186">bytes</a></span><span class="op" id="8510812">.</span><span class="ident" id="8510813">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8510821"><a href="/go/printer/performance_test.go.html#8510286">testprint</a></span><span class="op" id="8510830">(</span><span class="op" id="8510831">&amp;</span><span class="ident" id="8510832"><a href="/go/printer/performance_test.go.html#8510803">buf</a></span><span class="op" id="8510835">,</span>&nbsp;<span class="ident" id="8510837"><a href="/go/printer/performance_test.go.html#8510680">file</a></span><span class="op" id="8510841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8510844">if</span>&nbsp;<span class="op" id="8510847">!</span><span class="ident" id="8510848"><a href="/go/printer/performance_test.go.html#8510186">bytes</a></span><span class="op" id="8510853">.</span><span class="ident" id="8510854">Equal</span><span class="op" id="8510859">(</span><span class="ident" id="8510860"><a href="/go/printer/performance_test.go.html#8510803">buf</a></span><span class="op" id="8510863">.</span><span class="ident" id="8510864">Bytes</span><span class="op" id="8510869">(</span><span class="op" id="8510870">)</span><span class="op" id="8510871">,</span>&nbsp;<span class="ident" id="8510873"><a href="/go/printer/performance_test.go.html#8510596">src</a></span><span class="op" id="8510876">)</span>&nbsp;<span class="op" id="8510878">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8510882"><a href="/go/printer/performance_test.go.html#8510237">log</a></span><span class="op" id="8510885">.</span><span class="ident" id="8510886">Fatalf</span><span class="op" id="8510892">(</span><span class="string" id="8510893">&#34;print&nbsp;error:&nbsp;%s&nbsp;not&nbsp;idempotent&#34;</span><span class="op" id="8510925">,</span>&nbsp;<span class="ident" id="8510927"><a href="/go/printer/performance_test.go.html#8510562">filename</a></span><span class="op" id="8510935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8510938">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8510942"><a href="/go/printer/performance_test.go.html#8510261">testfile</a></span>&nbsp;<span class="op" id="8510951">=</span>&nbsp;<span class="ident" id="8510953"><a href="/go/printer/performance_test.go.html#8510680">file</a></span><br>
<span class="lineno"></span><span class="op" id="8510958">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="8510961">func</span>&nbsp;<span class="ident" id="8510966">BenchmarkPrint</span><span class="op" id="8510980">(</span><span class="ident" id="8510981">b</span>&nbsp;<span class="op" id="8510983">*</span><span class="ident" id="8510984"><a href="/go/printer/performance_test.go.html#8510244">testing</a></span><span class="op" id="8510991">.</span><span class="ident" id="8510992">B</span><span class="op" id="8510993">)</span>&nbsp;<span class="op" id="8510995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8510998">if</span>&nbsp;<span class="ident" id="8511001"><a href="/go/printer/performance_test.go.html#8510261">testfile</a></span>&nbsp;<span class="op" id="8511010">==</span>&nbsp;<span class="ident" id="8511013">nil</span>&nbsp;<span class="op" id="8511017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8511021"><a href="/go/printer/performance_test.go.html#8510540">initialize</a></span><span class="op" id="8511031">(</span><span class="op" id="8511032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8511035">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8511038">for</span>&nbsp;<span class="ident" id="8511042">i</span>&nbsp;<span class="op" id="8511044">:=</span>&nbsp;<span class="num" id="8511047">0</span><span class="op" id="8511048">;</span>&nbsp;<span class="ident" id="8511050"><a href="/go/printer/performance_test.go.html#8511042">i</a></span>&nbsp;<span class="op" id="8511052">&lt;</span>&nbsp;<span class="ident" id="8511054"><a href="/go/printer/performance_test.go.html#8510981">b</a></span><span class="op" id="8511055">.</span><span class="ident" id="8511056">N</span><span class="op" id="8511057">;</span>&nbsp;<span class="ident" id="8511059"><a href="/go/printer/performance_test.go.html#8511042">i</a></span><span class="op" id="8511060">++</span>&nbsp;<span class="op" id="8511063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8511067"><a href="/go/printer/performance_test.go.html#8510286">testprint</a></span><span class="op" id="8511076">(</span><span class="ident" id="8511077"><a href="/go/printer/performance_test.go.html#8510224">ioutil</a></span><span class="op" id="8511083">.</span><span class="ident" id="8511084">Discard</span><span class="op" id="8511091">,</span>&nbsp;<span class="ident" id="8511093"><a href="/go/printer/performance_test.go.html#8510261">testfile</a></span><span class="op" id="8511101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8511104">}</span><br>
<span class="lineno"></span><span class="op" id="8511106">}</span>
</div>
</body>
</html>
