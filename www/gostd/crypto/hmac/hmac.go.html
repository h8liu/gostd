<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/hmac</h2>
<ul>
<li><a href="/gostd/crypto/hmac/hmac.go.html">hmac.go</a></li>
<li><a href="/gostd/crypto/hmac/hmac_test.go.html">hmac_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2323722">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2323777">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2323831">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2323882">/*<br>
<span class="lineno"></span>Package&nbsp;hmac&nbsp;implements&nbsp;the&nbsp;Keyed-Hash&nbsp;Message&nbsp;Authentication&nbsp;Code&nbsp;(HMAC)&nbsp;as<br>
<span class="lineno"></span>defined&nbsp;in&nbsp;U.S.&nbsp;Federal&nbsp;Information&nbsp;Processing&nbsp;Standards&nbsp;Publication&nbsp;198.<br>
<span class="lineno"></span>An&nbsp;HMAC&nbsp;is&nbsp;a&nbsp;cryptographic&nbsp;hash&nbsp;that&nbsp;uses&nbsp;a&nbsp;key&nbsp;to&nbsp;sign&nbsp;a&nbsp;message.<br>
<span class="lineno"></span>The&nbsp;receiver&nbsp;verifies&nbsp;the&nbsp;hash&nbsp;by&nbsp;recomputing&nbsp;it&nbsp;using&nbsp;the&nbsp;same&nbsp;key.<br>
<span class="lineno">10</span><br>
<span class="lineno"></span>Receivers&nbsp;should&nbsp;be&nbsp;careful&nbsp;to&nbsp;use&nbsp;Equal&nbsp;to&nbsp;compare&nbsp;MACs&nbsp;in&nbsp;order&nbsp;to&nbsp;avoid<br>
<span class="lineno"></span>timing&nbsp;side-channels:<br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;CheckMAC&nbsp;returns&nbsp;true&nbsp;if&nbsp;messageMAC&nbsp;is&nbsp;a&nbsp;valid&nbsp;HMAC&nbsp;tag&nbsp;for&nbsp;message.<br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbspfunc&nbsp;CheckMAC(message,&nbsp;messageMAC,&nbsp;key&nbsp;[]byte)&nbsp;bool&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspmac&nbsp;:=&nbsp;hmac.New(sha256.New,&nbsp;key)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspmac.Write(message)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspexpectedMAC&nbsp;:=&nbsp;mac.Sum(nil)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;hmac.Equal(messageMAC,&nbsp;expectedMAC)<br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp}<br>
<span class="lineno"></span>*/</span><br>
<span class="lineno"></span><span class="keyword" id="2324536">package</span>&nbsp;<span class="ident" id="2324544">hmac</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2324550">import</span>&nbsp;<span class="op" id="2324557">(</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2324560">&#34;crypto/subtle&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2324577">&#34;hash&#34;</span><br>
<span class="lineno"></span><span class="op" id="2324584">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2324587">//&nbsp;FIPS&nbsp;198:</span><br>
<span class="lineno">30</span><span class="comment" id="2324600">//&nbsp;http://csrc.nist.gov/publications/fips/fips198/fips-198a.pdf</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2324665">//&nbsp;key&nbsp;is&nbsp;zero&nbsp;padded&nbsp;to&nbsp;the&nbsp;block&nbsp;size&nbsp;of&nbsp;the&nbsp;hash&nbsp;function</span><br>
<span class="lineno"></span><span class="comment" id="2324726">//&nbsp;ipad&nbsp;=&nbsp;0x36&nbsp;byte&nbsp;repeated&nbsp;for&nbsp;key&nbsp;length</span><br>
<span class="lineno"></span><span class="comment" id="2324770">//&nbsp;opad&nbsp;=&nbsp;0x5c&nbsp;byte&nbsp;repeated&nbsp;for&nbsp;key&nbsp;length</span><br>
<span class="lineno">35</span><span class="comment" id="2324814">//&nbsp;hmac&nbsp;=&nbsp;H([key&nbsp;^&nbsp;opad]&nbsp;H([key&nbsp;^&nbsp;ipad]&nbsp;text))</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2324862">type</span>&nbsp;<span class="ident" id="2324867">hmac</span>&nbsp;<span class="keyword" id="2324872">struct</span>&nbsp;<span class="op" id="2324879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2324882">size</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2324895">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2324900">blocksize</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2324913">int</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2324918">key</span><span class="op" id="2324921">,</span>&nbsp;<span class="ident" id="2324923">tmp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2324931">[</span><span class="op" id="2324932">]</span><span class="builtintype" id="2324933">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2324939">outer</span><span class="op" id="2324944">,</span>&nbsp;<span class="ident" id="2324946">inner</span>&nbsp;<span class="ident" id="2324952">hash</span><span class="op" id="2324956">.</span><span class="ident" id="2324957">Hash</span><br>
<span class="lineno"></span><span class="op" id="2324962">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2324965">func</span>&nbsp;<span class="op" id="2324970">(</span><span class="ident" id="2324971">h</span>&nbsp;<span class="op" id="2324973">*</span><span class="ident" id="2324974">hmac</span><span class="op" id="2324978">)</span>&nbsp;<span class="ident" id="2324980">tmpPad</span><span class="op" id="2324986">(</span><span class="ident" id="2324987">xor</span>&nbsp;<span class="builtintype" id="2324991">byte</span><span class="op" id="2324995">)</span>&nbsp;<span class="op" id="2324997">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2325000">for</span>&nbsp;<span class="ident" id="2325004">i</span><span class="op" id="2325005">,</span>&nbsp;<span class="ident" id="2325007">k</span>&nbsp;<span class="op" id="2325009">:=</span>&nbsp;<span class="keyword" id="2325012">range</span>&nbsp;<span class="ident" id="2325018">h</span><span class="op" id="2325019">.</span><span class="ident" id="2325020">key</span>&nbsp;<span class="op" id="2325024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2325028">h</span><span class="op" id="2325029">.</span><span class="ident" id="2325030">tmp</span><span class="op" id="2325033">[</span><span class="ident" id="2325034">i</span><span class="op" id="2325035">]</span>&nbsp;<span class="op" id="2325037">=</span>&nbsp;<span class="ident" id="2325039">xor</span>&nbsp;<span class="op" id="2325043">^</span>&nbsp;<span class="ident" id="2325045">k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2325048">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2325051">for</span>&nbsp;<span class="ident" id="2325055">i</span>&nbsp;<span class="op" id="2325057">:=</span>&nbsp;<span class="builtinfunc" id="2325060">len</span><span class="op" id="2325063">(</span><span class="ident" id="2325064">h</span><span class="op" id="2325065">.</span><span class="ident" id="2325066">key</span><span class="op" id="2325069">)</span><span class="op" id="2325070">;</span>&nbsp;<span class="ident" id="2325072">i</span>&nbsp;<span class="op" id="2325074">&lt;</span>&nbsp;<span class="ident" id="2325076">h</span><span class="op" id="2325077">.</span><span class="ident" id="2325078">blocksize</span><span class="op" id="2325087">;</span>&nbsp;<span class="ident" id="2325089">i</span><span class="op" id="2325090">++</span>&nbsp;<span class="op" id="2325093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2325097">h</span><span class="op" id="2325098">.</span><span class="ident" id="2325099">tmp</span><span class="op" id="2325102">[</span><span class="ident" id="2325103">i</span><span class="op" id="2325104">]</span>&nbsp;<span class="op" id="2325106">=</span>&nbsp;<span class="ident" id="2325108">xor</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2325113">}</span><br>
<span class="lineno"></span><span class="op" id="2325115">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2325118">func</span>&nbsp;<span class="op" id="2325123">(</span><span class="ident" id="2325124">h</span>&nbsp;<span class="op" id="2325126">*</span><span class="ident" id="2325127">hmac</span><span class="op" id="2325131">)</span>&nbsp;<span class="ident" id="2325133">Sum</span><span class="op" id="2325136">(</span><span class="ident" id="2325137">in</span>&nbsp;<span class="op" id="2325140">[</span><span class="op" id="2325141">]</span><span class="builtintype" id="2325142">byte</span><span class="op" id="2325146">)</span>&nbsp;<span class="op" id="2325148">[</span><span class="op" id="2325149">]</span><span class="builtintype" id="2325150">byte</span>&nbsp;<span class="op" id="2325155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2325158">origLen</span>&nbsp;<span class="op" id="2325166">:=</span>&nbsp;<span class="builtinfunc" id="2325169">len</span><span class="op" id="2325172">(</span><span class="ident" id="2325173">in</span><span class="op" id="2325175">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2325178">in</span>&nbsp;<span class="op" id="2325181">=</span>&nbsp;<span class="ident" id="2325183">h</span><span class="op" id="2325184">.</span><span class="ident" id="2325185">inner</span><span class="op" id="2325190">.</span><span class="ident" id="2325191">Sum</span><span class="op" id="2325194">(</span><span class="ident" id="2325195">in</span><span class="op" id="2325197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2325200">h</span><span class="op" id="2325201">.</span><span class="ident" id="2325202">tmpPad</span><span class="op" id="2325208">(</span><span class="num" id="2325209">0x5c</span><span class="op" id="2325213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2325216">copy</span><span class="op" id="2325220">(</span><span class="ident" id="2325221">h</span><span class="op" id="2325222">.</span><span class="ident" id="2325223">tmp</span><span class="op" id="2325226">[</span><span class="ident" id="2325227">h</span><span class="op" id="2325228">.</span><span class="ident" id="2325229">blocksize</span><span class="op" id="2325238">:</span><span class="op" id="2325239">]</span><span class="op" id="2325240">,</span>&nbsp;<span class="ident" id="2325242">in</span><span class="op" id="2325244">[</span><span class="ident" id="2325245">origLen</span><span class="op" id="2325252">:</span><span class="op" id="2325253">]</span><span class="op" id="2325254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2325257">h</span><span class="op" id="2325258">.</span><span class="ident" id="2325259">outer</span><span class="op" id="2325264">.</span><span class="ident" id="2325265">Reset</span><span class="op" id="2325270">(</span><span class="op" id="2325271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2325274">h</span><span class="op" id="2325275">.</span><span class="ident" id="2325276">outer</span><span class="op" id="2325281">.</span><span class="ident" id="2325282">Write</span><span class="op" id="2325287">(</span><span class="ident" id="2325288">h</span><span class="op" id="2325289">.</span><span class="ident" id="2325290">tmp</span><span class="op" id="2325293">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2325296">return</span>&nbsp;<span class="ident" id="2325303">h</span><span class="op" id="2325304">.</span><span class="ident" id="2325305">outer</span><span class="op" id="2325310">.</span><span class="ident" id="2325311">Sum</span><span class="op" id="2325314">(</span><span class="ident" id="2325315">in</span><span class="op" id="2325317">[</span><span class="op" id="2325318">:</span><span class="ident" id="2325319">origLen</span><span class="op" id="2325326">]</span><span class="op" id="2325327">)</span><br>
<span class="lineno"></span><span class="op" id="2325329">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2325332">func</span>&nbsp;<span class="op" id="2325337">(</span><span class="ident" id="2325338">h</span>&nbsp;<span class="op" id="2325340">*</span><span class="ident" id="2325341">hmac</span><span class="op" id="2325345">)</span>&nbsp;<span class="ident" id="2325347">Write</span><span class="op" id="2325352">(</span><span class="ident" id="2325353">p</span>&nbsp;<span class="op" id="2325355">[</span><span class="op" id="2325356">]</span><span class="builtintype" id="2325357">byte</span><span class="op" id="2325361">)</span>&nbsp;<span class="op" id="2325363">(</span><span class="ident" id="2325364">n</span>&nbsp;<span class="builtintype" id="2325366">int</span><span class="op" id="2325369">,</span>&nbsp;<span class="ident" id="2325371">err</span>&nbsp;<span class="builtintype" id="2325375">error</span><span class="op" id="2325380">)</span>&nbsp;<span class="op" id="2325382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2325385">return</span>&nbsp;<span class="ident" id="2325392">h</span><span class="op" id="2325393">.</span><span class="ident" id="2325394">inner</span><span class="op" id="2325399">.</span><span class="ident" id="2325400">Write</span><span class="op" id="2325405">(</span><span class="ident" id="2325406">p</span><span class="op" id="2325407">)</span><br>
<span class="lineno">65</span><span class="op" id="2325409">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2325412">func</span>&nbsp;<span class="op" id="2325417">(</span><span class="ident" id="2325418">h</span>&nbsp;<span class="op" id="2325420">*</span><span class="ident" id="2325421">hmac</span><span class="op" id="2325425">)</span>&nbsp;<span class="ident" id="2325427">Size</span><span class="op" id="2325431">(</span><span class="op" id="2325432">)</span>&nbsp;<span class="builtintype" id="2325434">int</span>&nbsp;<span class="op" id="2325438">{</span>&nbsp;<span class="keyword" id="2325440">return</span>&nbsp;<span class="ident" id="2325447">h</span><span class="op" id="2325448">.</span><span class="ident" id="2325449">size</span>&nbsp;<span class="op" id="2325454">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2325457">func</span>&nbsp;<span class="op" id="2325462">(</span><span class="ident" id="2325463">h</span>&nbsp;<span class="op" id="2325465">*</span><span class="ident" id="2325466">hmac</span><span class="op" id="2325470">)</span>&nbsp;<span class="ident" id="2325472">BlockSize</span><span class="op" id="2325481">(</span><span class="op" id="2325482">)</span>&nbsp;<span class="builtintype" id="2325484">int</span>&nbsp;<span class="op" id="2325488">{</span>&nbsp;<span class="keyword" id="2325490">return</span>&nbsp;<span class="ident" id="2325497">h</span><span class="op" id="2325498">.</span><span class="ident" id="2325499">blocksize</span>&nbsp;<span class="op" id="2325509">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="2325512">func</span>&nbsp;<span class="op" id="2325517">(</span><span class="ident" id="2325518">h</span>&nbsp;<span class="op" id="2325520">*</span><span class="ident" id="2325521">hmac</span><span class="op" id="2325525">)</span>&nbsp;<span class="ident" id="2325527">Reset</span><span class="op" id="2325532">(</span><span class="op" id="2325533">)</span>&nbsp;<span class="op" id="2325535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2325538">h</span><span class="op" id="2325539">.</span><span class="ident" id="2325540">inner</span><span class="op" id="2325545">.</span><span class="ident" id="2325546">Reset</span><span class="op" id="2325551">(</span><span class="op" id="2325552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2325555">h</span><span class="op" id="2325556">.</span><span class="ident" id="2325557">tmpPad</span><span class="op" id="2325563">(</span><span class="num" id="2325564">0x36</span><span class="op" id="2325568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2325571">h</span><span class="op" id="2325572">.</span><span class="ident" id="2325573">inner</span><span class="op" id="2325578">.</span><span class="ident" id="2325579">Write</span><span class="op" id="2325584">(</span><span class="ident" id="2325585">h</span><span class="op" id="2325586">.</span><span class="ident" id="2325587">tmp</span><span class="op" id="2325590">[</span><span class="op" id="2325591">:</span><span class="ident" id="2325592">h</span><span class="op" id="2325593">.</span><span class="ident" id="2325594">blocksize</span><span class="op" id="2325603">]</span><span class="op" id="2325604">)</span><br>
<span class="lineno">75</span><span class="op" id="2325606">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2325609">//&nbsp;New&nbsp;returns&nbsp;a&nbsp;new&nbsp;HMAC&nbsp;hash&nbsp;using&nbsp;the&nbsp;given&nbsp;hash.Hash&nbsp;type&nbsp;and&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="2325680">func</span>&nbsp;<span class="ident" id="2325685">New</span><span class="op" id="2325688">(</span><span class="ident" id="2325689">h</span>&nbsp;<span class="keyword" id="2325691">func</span><span class="op" id="2325695">(</span><span class="op" id="2325696">)</span>&nbsp;<span class="ident" id="2325698">hash</span><span class="op" id="2325702">.</span><span class="ident" id="2325703">Hash</span><span class="op" id="2325707">,</span>&nbsp;<span class="ident" id="2325709">key</span>&nbsp;<span class="op" id="2325713">[</span><span class="op" id="2325714">]</span><span class="builtintype" id="2325715">byte</span><span class="op" id="2325719">)</span>&nbsp;<span class="ident" id="2325721">hash</span><span class="op" id="2325725">.</span><span class="ident" id="2325726">Hash</span>&nbsp;<span class="op" id="2325731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2325734">hm</span>&nbsp;<span class="op" id="2325737">:=</span>&nbsp;<span class="builtinfunc" id="2325740">new</span><span class="op" id="2325743">(</span><span class="ident" id="2325744">hmac</span><span class="op" id="2325748">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2325751">hm</span><span class="op" id="2325753">.</span><span class="ident" id="2325754">outer</span>&nbsp;<span class="op" id="2325760">=</span>&nbsp;<span class="ident" id="2325762">h</span><span class="op" id="2325763">(</span><span class="op" id="2325764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2325767">hm</span><span class="op" id="2325769">.</span><span class="ident" id="2325770">inner</span>&nbsp;<span class="op" id="2325776">=</span>&nbsp;<span class="ident" id="2325778">h</span><span class="op" id="2325779">(</span><span class="op" id="2325780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2325783">hm</span><span class="op" id="2325785">.</span><span class="ident" id="2325786">size</span>&nbsp;<span class="op" id="2325791">=</span>&nbsp;<span class="ident" id="2325793">hm</span><span class="op" id="2325795">.</span><span class="ident" id="2325796">inner</span><span class="op" id="2325801">.</span><span class="ident" id="2325802">Size</span><span class="op" id="2325806">(</span><span class="op" id="2325807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2325810">hm</span><span class="op" id="2325812">.</span><span class="ident" id="2325813">blocksize</span>&nbsp;<span class="op" id="2325823">=</span>&nbsp;<span class="ident" id="2325825">hm</span><span class="op" id="2325827">.</span><span class="ident" id="2325828">inner</span><span class="op" id="2325833">.</span><span class="ident" id="2325834">BlockSize</span><span class="op" id="2325843">(</span><span class="op" id="2325844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2325847">hm</span><span class="op" id="2325849">.</span><span class="ident" id="2325850">tmp</span>&nbsp;<span class="op" id="2325854">=</span>&nbsp;<span class="builtinfunc" id="2325856">make</span><span class="op" id="2325860">(</span><span class="op" id="2325861">[</span><span class="op" id="2325862">]</span><span class="builtintype" id="2325863">byte</span><span class="op" id="2325867">,</span>&nbsp;<span class="ident" id="2325869">hm</span><span class="op" id="2325871">.</span><span class="ident" id="2325872">blocksize</span><span class="op" id="2325881">+</span><span class="ident" id="2325882">hm</span><span class="op" id="2325884">.</span><span class="ident" id="2325885">size</span><span class="op" id="2325889">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2325892">if</span>&nbsp;<span class="builtinfunc" id="2325895">len</span><span class="op" id="2325898">(</span><span class="ident" id="2325899">key</span><span class="op" id="2325902">)</span>&nbsp;<span class="op" id="2325904">&gt;</span>&nbsp;<span class="ident" id="2325906">hm</span><span class="op" id="2325908">.</span><span class="ident" id="2325909">blocksize</span>&nbsp;<span class="op" id="2325919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2325923">//&nbsp;If&nbsp;key&nbsp;is&nbsp;too&nbsp;big,&nbsp;hash&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2325956">hm</span><span class="op" id="2325958">.</span><span class="ident" id="2325959">outer</span><span class="op" id="2325964">.</span><span class="ident" id="2325965">Write</span><span class="op" id="2325970">(</span><span class="ident" id="2325971">key</span><span class="op" id="2325974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2325978">key</span>&nbsp;<span class="op" id="2325982">=</span>&nbsp;<span class="ident" id="2325984">hm</span><span class="op" id="2325986">.</span><span class="ident" id="2325987">outer</span><span class="op" id="2325992">.</span><span class="ident" id="2325993">Sum</span><span class="op" id="2325996">(</span><span class="ident" id="2325997">nil</span><span class="op" id="2326000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2326003">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2326006">hm</span><span class="op" id="2326008">.</span><span class="ident" id="2326009">key</span>&nbsp;<span class="op" id="2326013">=</span>&nbsp;<span class="builtinfunc" id="2326015">make</span><span class="op" id="2326019">(</span><span class="op" id="2326020">[</span><span class="op" id="2326021">]</span><span class="builtintype" id="2326022">byte</span><span class="op" id="2326026">,</span>&nbsp;<span class="builtinfunc" id="2326028">len</span><span class="op" id="2326031">(</span><span class="ident" id="2326032">key</span><span class="op" id="2326035">)</span><span class="op" id="2326036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2326039">copy</span><span class="op" id="2326043">(</span><span class="ident" id="2326044">hm</span><span class="op" id="2326046">.</span><span class="ident" id="2326047">key</span><span class="op" id="2326050">,</span>&nbsp;<span class="ident" id="2326052">key</span><span class="op" id="2326055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2326058">hm</span><span class="op" id="2326060">.</span><span class="ident" id="2326061">Reset</span><span class="op" id="2326066">(</span><span class="op" id="2326067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2326070">return</span>&nbsp;<span class="ident" id="2326077">hm</span><br>
<span class="lineno"></span><span class="op" id="2326080">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="comment" id="2326083">//&nbsp;Equal&nbsp;compares&nbsp;two&nbsp;MACs&nbsp;for&nbsp;equality&nbsp;without&nbsp;leaking&nbsp;timing&nbsp;information.</span><br>
<span class="lineno"></span><span class="keyword" id="2326159">func</span>&nbsp;<span class="ident" id="2326164">Equal</span><span class="op" id="2326169">(</span><span class="ident" id="2326170">mac1</span><span class="op" id="2326174">,</span>&nbsp;<span class="ident" id="2326176">mac2</span>&nbsp;<span class="op" id="2326181">[</span><span class="op" id="2326182">]</span><span class="builtintype" id="2326183">byte</span><span class="op" id="2326187">)</span>&nbsp;<span class="builtintype" id="2326189">bool</span>&nbsp;<span class="op" id="2326194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2326197">//&nbsp;We&nbsp;don&#39;t&nbsp;have&nbsp;to&nbsp;be&nbsp;constant&nbsp;time&nbsp;if&nbsp;the&nbsp;lengths&nbsp;of&nbsp;the&nbsp;MACs&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2326266">//&nbsp;different&nbsp;as&nbsp;that&nbsp;suggests&nbsp;that&nbsp;a&nbsp;completely&nbsp;different&nbsp;hash&nbsp;function</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2326339">//&nbsp;was&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2326353">return</span>&nbsp;<span class="builtinfunc" id="2326360">len</span><span class="op" id="2326363">(</span><span class="ident" id="2326364">mac1</span><span class="op" id="2326368">)</span>&nbsp;<span class="op" id="2326370">==</span>&nbsp;<span class="builtinfunc" id="2326373">len</span><span class="op" id="2326376">(</span><span class="ident" id="2326377">mac2</span><span class="op" id="2326381">)</span>&nbsp;<span class="op" id="2326383">&amp;&amp;</span>&nbsp;<span class="ident" id="2326386">subtle</span><span class="op" id="2326392">.</span><span class="ident" id="2326393">ConstantTimeCompare</span><span class="op" id="2326412">(</span><span class="ident" id="2326413">mac1</span><span class="op" id="2326417">,</span>&nbsp;<span class="ident" id="2326419">mac2</span><span class="op" id="2326423">)</span>&nbsp;<span class="op" id="2326425">==</span>&nbsp;<span class="num" id="2326428">1</span><br>
<span class="lineno"></span><span class="op" id="2326430">}</span>
</div>
</body>
</html>
