<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2102511">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2102566">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2102620">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2102671">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2102736">//&nbsp;Fork,&nbsp;exec,&nbsp;wait,&nbsp;etc.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2102763">package</span>&nbsp;<span class="ident" id="2102771">syscall</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="2102780">import</span>&nbsp;<span class="op" id="2102787">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2102790">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2102801">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2102809">&#34;unsafe&#34;</span><br>
<span class="lineno">15</span><span class="op" id="2102818">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2102821">//&nbsp;Lock&nbsp;synchronizing&nbsp;creation&nbsp;of&nbsp;new&nbsp;file&nbsp;descriptors&nbsp;with&nbsp;fork.</span><br>
<span class="lineno"></span><span class="comment" id="2102887">//</span><br>
<span class="lineno"></span><span class="comment" id="2102890">//&nbsp;We&nbsp;want&nbsp;the&nbsp;child&nbsp;in&nbsp;a&nbsp;fork/exec&nbsp;sequence&nbsp;to&nbsp;inherit&nbsp;only&nbsp;the</span><br>
<span class="lineno">20</span><span class="comment" id="2102955">//&nbsp;file&nbsp;descriptors&nbsp;we&nbsp;intend.&nbsp;&nbsp;To&nbsp;do&nbsp;that,&nbsp;we&nbsp;mark&nbsp;all&nbsp;file</span><br>
<span class="lineno"></span><span class="comment" id="2103016">//&nbsp;descriptors&nbsp;close-on-exec&nbsp;and&nbsp;then,&nbsp;in&nbsp;the&nbsp;child,&nbsp;explicitly</span><br>
<span class="lineno"></span><span class="comment" id="2103080">//&nbsp;unmark&nbsp;the&nbsp;ones&nbsp;we&nbsp;want&nbsp;the&nbsp;exec&#39;ed&nbsp;program&nbsp;to&nbsp;keep.</span><br>
<span class="lineno"></span><span class="comment" id="2103136">//&nbsp;Unix&nbsp;doesn&#39;t&nbsp;make&nbsp;this&nbsp;easy:&nbsp;there&nbsp;is,&nbsp;in&nbsp;general,&nbsp;no&nbsp;way&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="2103200">//&nbsp;allocate&nbsp;a&nbsp;new&nbsp;file&nbsp;descriptor&nbsp;close-on-exec.&nbsp;&nbsp;Instead&nbsp;you</span><br>
<span class="lineno">25</span><span class="comment" id="2103262">//&nbsp;have&nbsp;to&nbsp;allocate&nbsp;the&nbsp;descriptor&nbsp;and&nbsp;then&nbsp;mark&nbsp;it&nbsp;close-on-exec.</span><br>
<span class="lineno"></span><span class="comment" id="2103329">//&nbsp;If&nbsp;a&nbsp;fork&nbsp;happens&nbsp;between&nbsp;those&nbsp;two&nbsp;events,&nbsp;the&nbsp;child&#39;s&nbsp;exec</span><br>
<span class="lineno"></span><span class="comment" id="2103393">//&nbsp;will&nbsp;inherit&nbsp;an&nbsp;unwanted&nbsp;file&nbsp;descriptor.</span><br>
<span class="lineno"></span><span class="comment" id="2103438">//</span><br>
<span class="lineno"></span><span class="comment" id="2103441">//&nbsp;This&nbsp;lock&nbsp;solves&nbsp;that&nbsp;race:&nbsp;the&nbsp;create&nbsp;new&nbsp;fd/mark&nbsp;close-on-exec</span><br>
<span class="lineno">30</span><span class="comment" id="2103509">//&nbsp;operation&nbsp;is&nbsp;done&nbsp;holding&nbsp;ForkLock&nbsp;for&nbsp;reading,&nbsp;and&nbsp;the&nbsp;fork&nbsp;itself</span><br>
<span class="lineno"></span><span class="comment" id="2103580">//&nbsp;is&nbsp;done&nbsp;holding&nbsp;ForkLock&nbsp;for&nbsp;writing.&nbsp;&nbsp;At&nbsp;least,&nbsp;that&#39;s&nbsp;the&nbsp;idea.</span><br>
<span class="lineno"></span><span class="comment" id="2103649">//&nbsp;There&nbsp;are&nbsp;some&nbsp;complications.</span><br>
<span class="lineno"></span><span class="comment" id="2103682">//</span><br>
<span class="lineno"></span><span class="comment" id="2103685">//&nbsp;Some&nbsp;system&nbsp;calls&nbsp;that&nbsp;create&nbsp;new&nbsp;file&nbsp;descriptors&nbsp;can&nbsp;block</span><br>
<span class="lineno">35</span><span class="comment" id="2103749">//&nbsp;for&nbsp;arbitrarily&nbsp;long&nbsp;times:&nbsp;open&nbsp;on&nbsp;a&nbsp;hung&nbsp;NFS&nbsp;server&nbsp;or&nbsp;named</span><br>
<span class="lineno"></span><span class="comment" id="2103815">//&nbsp;pipe,&nbsp;accept&nbsp;on&nbsp;a&nbsp;socket,&nbsp;and&nbsp;so&nbsp;on.&nbsp;&nbsp;We&nbsp;can&#39;t&nbsp;reasonably&nbsp;grab</span><br>
<span class="lineno"></span><span class="comment" id="2103881">//&nbsp;the&nbsp;lock&nbsp;across&nbsp;those&nbsp;operations.</span><br>
<span class="lineno"></span><span class="comment" id="2103918">//</span><br>
<span class="lineno"></span><span class="comment" id="2103921">//&nbsp;It&nbsp;is&nbsp;worse&nbsp;to&nbsp;inherit&nbsp;some&nbsp;file&nbsp;descriptors&nbsp;than&nbsp;others.</span><br>
<span class="lineno">40</span><span class="comment" id="2103982">//&nbsp;If&nbsp;a&nbsp;non-malicious&nbsp;child&nbsp;accidentally&nbsp;inherits&nbsp;an&nbsp;open&nbsp;ordinary&nbsp;file,</span><br>
<span class="lineno"></span><span class="comment" id="2104055">//&nbsp;that&#39;s&nbsp;not&nbsp;a&nbsp;big&nbsp;deal.&nbsp;&nbsp;On&nbsp;the&nbsp;other&nbsp;hand,&nbsp;if&nbsp;a&nbsp;long-lived&nbsp;child</span><br>
<span class="lineno"></span><span class="comment" id="2104123">//&nbsp;accidentally&nbsp;inherits&nbsp;the&nbsp;write&nbsp;end&nbsp;of&nbsp;a&nbsp;pipe,&nbsp;then&nbsp;the&nbsp;reader</span><br>
<span class="lineno"></span><span class="comment" id="2104189">//&nbsp;of&nbsp;that&nbsp;pipe&nbsp;will&nbsp;not&nbsp;see&nbsp;EOF&nbsp;until&nbsp;that&nbsp;child&nbsp;exits,&nbsp;potentially</span><br>
<span class="lineno"></span><span class="comment" id="2104258">//&nbsp;causing&nbsp;the&nbsp;parent&nbsp;program&nbsp;to&nbsp;hang.&nbsp;&nbsp;This&nbsp;is&nbsp;a&nbsp;common&nbsp;problem</span><br>
<span class="lineno">45</span><span class="comment" id="2104323">//&nbsp;in&nbsp;threaded&nbsp;C&nbsp;programs&nbsp;that&nbsp;use&nbsp;popen.</span><br>
<span class="lineno"></span><span class="comment" id="2104365">//</span><br>
<span class="lineno"></span><span class="comment" id="2104368">//&nbsp;Luckily,&nbsp;the&nbsp;file&nbsp;descriptors&nbsp;that&nbsp;are&nbsp;most&nbsp;important&nbsp;not&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="2104432">//&nbsp;inherit&nbsp;are&nbsp;not&nbsp;the&nbsp;ones&nbsp;that&nbsp;can&nbsp;take&nbsp;an&nbsp;arbitrarily&nbsp;long&nbsp;time</span><br>
<span class="lineno"></span><span class="comment" id="2104499">//&nbsp;to&nbsp;create:&nbsp;pipe&nbsp;returns&nbsp;instantly,&nbsp;and&nbsp;the&nbsp;net&nbsp;package&nbsp;uses</span><br>
<span class="lineno">50</span><span class="comment" id="2104562">//&nbsp;non-blocking&nbsp;I/O&nbsp;to&nbsp;accept&nbsp;on&nbsp;a&nbsp;listening&nbsp;socket.</span><br>
<span class="lineno"></span><span class="comment" id="2104615">//&nbsp;The&nbsp;rules&nbsp;for&nbsp;which&nbsp;file&nbsp;descriptor-creating&nbsp;operations&nbsp;use&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2104682">//&nbsp;ForkLock&nbsp;are&nbsp;as&nbsp;follows:</span><br>
<span class="lineno"></span><span class="comment" id="2104710">//</span><br>
<span class="lineno"></span><span class="comment" id="2104713">//&nbsp;1)&nbsp;Pipe.&nbsp;&nbsp;&nbsp;&nbsp;Does&nbsp;not&nbsp;block.&nbsp;&nbsp;Use&nbsp;the&nbsp;ForkLock.</span><br>
<span class="lineno">55</span><span class="comment" id="2104763">//&nbsp;2)&nbsp;Socket.&nbsp;&nbsp;Does&nbsp;not&nbsp;block.&nbsp;&nbsp;Use&nbsp;the&nbsp;ForkLock.</span><br>
<span class="lineno"></span><span class="comment" id="2104813">//&nbsp;3)&nbsp;Accept.&nbsp;&nbsp;If&nbsp;using&nbsp;non-blocking&nbsp;mode,&nbsp;use&nbsp;the&nbsp;ForkLock.</span><br>
<span class="lineno"></span><span class="comment" id="2104874">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Otherwise,&nbsp;live&nbsp;with&nbsp;the&nbsp;race.</span><br>
<span class="lineno"></span><span class="comment" id="2104920">//&nbsp;4)&nbsp;Open.&nbsp;&nbsp;&nbsp;&nbsp;Can&nbsp;block.&nbsp;&nbsp;Use&nbsp;O_CLOEXEC&nbsp;if&nbsp;available&nbsp;(Linux).</span><br>
<span class="lineno"></span><span class="comment" id="2104983">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Otherwise,&nbsp;live&nbsp;with&nbsp;the&nbsp;race.</span><br>
<span class="lineno">60</span><span class="comment" id="2105029">//&nbsp;5)&nbsp;Dup.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Does&nbsp;not&nbsp;block.&nbsp;&nbsp;Use&nbsp;the&nbsp;ForkLock.</span><br>
<span class="lineno"></span><span class="comment" id="2105079">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;On&nbsp;Linux,&nbsp;could&nbsp;use&nbsp;fcntl&nbsp;F_DUPFD_CLOEXEC</span><br>
<span class="lineno"></span><span class="comment" id="2105136">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;instead&nbsp;of&nbsp;the&nbsp;ForkLock,&nbsp;but&nbsp;only&nbsp;for&nbsp;dup(fd,&nbsp;-1).</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2105203">var</span>&nbsp;<span class="ident" id="2105207">ForkLock</span>&nbsp;<span class="ident" id="2105216"><a href="/syscall/exec_unix.go.html#2102801">sync</a></span><span class="op" id="2105220">.</span><span class="ident" id="2105221">RWMutex</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="comment" id="2105230">//&nbsp;StringSlicePtr&nbsp;is&nbsp;deprecated.&nbsp;Use&nbsp;SlicePtrFromStrings&nbsp;instead.</span><br>
<span class="lineno"></span><span class="comment" id="2105296">//&nbsp;If&nbsp;any&nbsp;string&nbsp;contains&nbsp;a&nbsp;NUL&nbsp;byte&nbsp;this&nbsp;function&nbsp;panics&nbsp;instead</span><br>
<span class="lineno"></span><span class="comment" id="2105362">//&nbsp;of&nbsp;returning&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="keyword" id="2105388">func</span>&nbsp;<span class="ident" id="2105393">StringSlicePtr</span><span class="op" id="2105407">(</span><span class="ident" id="2105408">ss</span>&nbsp;<span class="op" id="2105411">[</span><span class="op" id="2105412">]</span><span class="builtintype" id="2105413">string</span><span class="op" id="2105419">)</span>&nbsp;<span class="op" id="2105421">[</span><span class="op" id="2105422">]</span><span class="op" id="2105423">*</span><span class="builtintype" id="2105424">byte</span>&nbsp;<span class="op" id="2105429">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2105432">bb</span>&nbsp;<span class="op" id="2105435">:=</span>&nbsp;<span class="builtinfunc" id="2105438">make</span><span class="op" id="2105442">(</span><span class="op" id="2105443">[</span><span class="op" id="2105444">]</span><span class="op" id="2105445">*</span><span class="builtintype" id="2105446">byte</span><span class="op" id="2105450">,</span>&nbsp;<span class="builtinfunc" id="2105452">len</span><span class="op" id="2105455">(</span><span class="ident" id="2105456"><a href="/syscall/exec_unix.go.html#2105408">ss</a></span><span class="op" id="2105458">)</span><span class="op" id="2105459">+</span><span class="num" id="2105460">1</span><span class="op" id="2105461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2105464">for</span>&nbsp;<span class="ident" id="2105468">i</span>&nbsp;<span class="op" id="2105470">:=</span>&nbsp;<span class="num" id="2105473">0</span><span class="op" id="2105474">;</span>&nbsp;<span class="ident" id="2105476"><a href="/syscall/exec_unix.go.html#2105468">i</a></span>&nbsp;<span class="op" id="2105478">&lt;</span>&nbsp;<span class="builtinfunc" id="2105480">len</span><span class="op" id="2105483">(</span><span class="ident" id="2105484"><a href="/syscall/exec_unix.go.html#2105408">ss</a></span><span class="op" id="2105486">)</span><span class="op" id="2105487">;</span>&nbsp;<span class="ident" id="2105489"><a href="/syscall/exec_unix.go.html#2105468">i</a></span><span class="op" id="2105490">++</span>&nbsp;<span class="op" id="2105493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2105497"><a href="/syscall/exec_unix.go.html#2105432">bb</a></span><span class="op" id="2105499">[</span><span class="ident" id="2105500"><a href="/syscall/exec_unix.go.html#2105468">i</a></span><span class="op" id="2105501">]</span>&nbsp;<span class="op" id="2105503">=</span>&nbsp;<span class="ident" id="2105505"><a href="/syscall/syscall.go.html#2124341">StringBytePtr</a></span><span class="op" id="2105518">(</span><span class="ident" id="2105519"><a href="/syscall/exec_unix.go.html#2105408">ss</a></span><span class="op" id="2105521">[</span><span class="ident" id="2105522"><a href="/syscall/exec_unix.go.html#2105468">i</a></span><span class="op" id="2105523">]</span><span class="op" id="2105524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2105527">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2105530"><a href="/syscall/exec_unix.go.html#2105432">bb</a></span><span class="op" id="2105532">[</span><span class="builtinfunc" id="2105533">len</span><span class="op" id="2105536">(</span><span class="ident" id="2105537"><a href="/syscall/exec_unix.go.html#2105408">ss</a></span><span class="op" id="2105539">)</span><span class="op" id="2105540">]</span>&nbsp;<span class="op" id="2105542">=</span>&nbsp;<span class="ident" id="2105544">nil</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2105549">return</span>&nbsp;<span class="ident" id="2105556"><a href="/syscall/exec_unix.go.html#2105432">bb</a></span><br>
<span class="lineno"></span><span class="op" id="2105559">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2105562">//&nbsp;SlicePtrFromStrings&nbsp;converts&nbsp;a&nbsp;slice&nbsp;of&nbsp;strings&nbsp;to&nbsp;a&nbsp;slice&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="2105627">//&nbsp;pointers&nbsp;to&nbsp;NUL-terminated&nbsp;byte&nbsp;slices.&nbsp;If&nbsp;any&nbsp;string&nbsp;contains</span><br>
<span class="lineno">80</span><span class="comment" id="2105693">//&nbsp;a&nbsp;NUL&nbsp;byte,&nbsp;it&nbsp;returns&nbsp;(nil,&nbsp;EINVAL).</span><br>
<span class="lineno"></span><span class="keyword" id="2105734">func</span>&nbsp;<span class="ident" id="2105739">SlicePtrFromStrings</span><span class="op" id="2105758">(</span><span class="ident" id="2105759">ss</span>&nbsp;<span class="op" id="2105762">[</span><span class="op" id="2105763">]</span><span class="builtintype" id="2105764">string</span><span class="op" id="2105770">)</span>&nbsp;<span class="op" id="2105772">(</span><span class="op" id="2105773">[</span><span class="op" id="2105774">]</span><span class="op" id="2105775">*</span><span class="builtintype" id="2105776">byte</span><span class="op" id="2105780">,</span>&nbsp;<span class="builtintype" id="2105782">error</span><span class="op" id="2105787">)</span>&nbsp;<span class="op" id="2105789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2105792">var</span>&nbsp;<span class="ident" id="2105796">err</span>&nbsp;<span class="builtintype" id="2105800">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2105807">bb</span>&nbsp;<span class="op" id="2105810">:=</span>&nbsp;<span class="builtinfunc" id="2105813">make</span><span class="op" id="2105817">(</span><span class="op" id="2105818">[</span><span class="op" id="2105819">]</span><span class="op" id="2105820">*</span><span class="builtintype" id="2105821">byte</span><span class="op" id="2105825">,</span>&nbsp;<span class="builtinfunc" id="2105827">len</span><span class="op" id="2105830">(</span><span class="ident" id="2105831"><a href="/syscall/exec_unix.go.html#2105759">ss</a></span><span class="op" id="2105833">)</span><span class="op" id="2105834">+</span><span class="num" id="2105835">1</span><span class="op" id="2105836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2105839">for</span>&nbsp;<span class="ident" id="2105843">i</span>&nbsp;<span class="op" id="2105845">:=</span>&nbsp;<span class="num" id="2105848">0</span><span class="op" id="2105849">;</span>&nbsp;<span class="ident" id="2105851"><a href="/syscall/exec_unix.go.html#2105843">i</a></span>&nbsp;<span class="op" id="2105853">&lt;</span>&nbsp;<span class="builtinfunc" id="2105855">len</span><span class="op" id="2105858">(</span><span class="ident" id="2105859"><a href="/syscall/exec_unix.go.html#2105759">ss</a></span><span class="op" id="2105861">)</span><span class="op" id="2105862">;</span>&nbsp;<span class="ident" id="2105864"><a href="/syscall/exec_unix.go.html#2105843">i</a></span><span class="op" id="2105865">++</span>&nbsp;<span class="op" id="2105868">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2105872"><a href="/syscall/exec_unix.go.html#2105807">bb</a></span><span class="op" id="2105874">[</span><span class="ident" id="2105875"><a href="/syscall/exec_unix.go.html#2105843">i</a></span><span class="op" id="2105876">]</span><span class="op" id="2105877">,</span>&nbsp;<span class="ident" id="2105879"><a href="/syscall/exec_unix.go.html#2105796">err</a></span>&nbsp;<span class="op" id="2105883">=</span>&nbsp;<span class="ident" id="2105885"><a href="/syscall/syscall.go.html#2124585">BytePtrFromString</a></span><span class="op" id="2105902">(</span><span class="ident" id="2105903"><a href="/syscall/exec_unix.go.html#2105759">ss</a></span><span class="op" id="2105905">[</span><span class="ident" id="2105906"><a href="/syscall/exec_unix.go.html#2105843">i</a></span><span class="op" id="2105907">]</span><span class="op" id="2105908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2105912">if</span>&nbsp;<span class="ident" id="2105915"><a href="/syscall/exec_unix.go.html#2105796">err</a></span>&nbsp;<span class="op" id="2105919">!=</span>&nbsp;<span class="ident" id="2105922">nil</span>&nbsp;<span class="op" id="2105926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2105931">return</span>&nbsp;<span class="ident" id="2105938">nil</span><span class="op" id="2105941">,</span>&nbsp;<span class="ident" id="2105943"><a href="/syscall/exec_unix.go.html#2105796">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2105949">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2105952">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2105955"><a href="/syscall/exec_unix.go.html#2105807">bb</a></span><span class="op" id="2105957">[</span><span class="builtinfunc" id="2105958">len</span><span class="op" id="2105961">(</span><span class="ident" id="2105962"><a href="/syscall/exec_unix.go.html#2105759">ss</a></span><span class="op" id="2105964">)</span><span class="op" id="2105965">]</span>&nbsp;<span class="op" id="2105967">=</span>&nbsp;<span class="ident" id="2105969">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2105974">return</span>&nbsp;<span class="ident" id="2105981"><a href="/syscall/exec_unix.go.html#2105807">bb</a></span><span class="op" id="2105983">,</span>&nbsp;<span class="ident" id="2105985">nil</span><br>
<span class="lineno"></span><span class="op" id="2105989">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2105992">func</span>&nbsp;<span class="ident" id="2105997">CloseOnExec</span><span class="op" id="2106008">(</span><span class="ident" id="2106009">fd</span>&nbsp;<span class="builtintype" id="2106012">int</span><span class="op" id="2106015">)</span>&nbsp;<span class="op" id="2106017">{</span>&nbsp;<span class="ident" id="2106019"><a href="/syscall/zsyscall_linux_amd64.go.html#2234545">fcntl</a></span><span class="op" id="2106024">(</span><span class="ident" id="2106025"><a href="/syscall/exec_unix.go.html#2106009">fd</a></span><span class="op" id="2106027">,</span>&nbsp;<span class="ident" id="2106029"><a href="/syscall/zerrors_linux_amd64.go.html#2175213">F_SETFD</a></span><span class="op" id="2106036">,</span>&nbsp;<span class="ident" id="2106038"><a href="/syscall/zerrors_linux_amd64.go.html#2174482">FD_CLOEXEC</a></span><span class="op" id="2106048">)</span>&nbsp;<span class="op" id="2106050">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="keyword" id="2106053">func</span>&nbsp;<span class="ident" id="2106058">SetNonblock</span><span class="op" id="2106069">(</span><span class="ident" id="2106070">fd</span>&nbsp;<span class="builtintype" id="2106073">int</span><span class="op" id="2106076">,</span>&nbsp;<span class="ident" id="2106078">nonblocking</span>&nbsp;<span class="builtintype" id="2106090">bool</span><span class="op" id="2106094">)</span>&nbsp;<span class="op" id="2106096">(</span><span class="ident" id="2106097">err</span>&nbsp;<span class="builtintype" id="2106101">error</span><span class="op" id="2106106">)</span>&nbsp;<span class="op" id="2106108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2106111">flag</span><span class="op" id="2106115">,</span>&nbsp;<span class="ident" id="2106117"><a href="/syscall/exec_unix.go.html#2106097">err</a></span>&nbsp;<span class="op" id="2106121">:=</span>&nbsp;<span class="ident" id="2106124"><a href="/syscall/zsyscall_linux_amd64.go.html#2234545">fcntl</a></span><span class="op" id="2106129">(</span><span class="ident" id="2106130"><a href="/syscall/exec_unix.go.html#2106070">fd</a></span><span class="op" id="2106132">,</span>&nbsp;<span class="ident" id="2106134"><a href="/syscall/zerrors_linux_amd64.go.html#2174726">F_GETFL</a></span><span class="op" id="2106141">,</span>&nbsp;<span class="num" id="2106143">0</span><span class="op" id="2106144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2106147">if</span>&nbsp;<span class="ident" id="2106150"><a href="/syscall/exec_unix.go.html#2106097">err</a></span>&nbsp;<span class="op" id="2106154">!=</span>&nbsp;<span class="ident" id="2106157">nil</span>&nbsp;<span class="op" id="2106161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2106165">return</span>&nbsp;<span class="ident" id="2106172"><a href="/syscall/exec_unix.go.html#2106097">err</a></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2106177">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2106180">if</span>&nbsp;<span class="ident" id="2106183"><a href="/syscall/exec_unix.go.html#2106078">nonblocking</a></span>&nbsp;<span class="op" id="2106195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2106199"><a href="/syscall/exec_unix.go.html#2106111">flag</a></span>&nbsp;<span class="op" id="2106204">|=</span>&nbsp;<span class="ident" id="2106207"><a href="/syscall/zerrors_linux_amd64.go.html#2190833">O_NONBLOCK</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2106219">}</span>&nbsp;<span class="keyword" id="2106221">else</span>&nbsp;<span class="op" id="2106226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2106230"><a href="/syscall/exec_unix.go.html#2106111">flag</a></span>&nbsp;<span class="op" id="2106235">&amp;=</span>&nbsp;<span class="op" id="2106238">^</span><span class="ident" id="2106239"><a href="/syscall/zerrors_linux_amd64.go.html#2190833">O_NONBLOCK</a></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2106251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2106254">_</span><span class="op" id="2106255">,</span>&nbsp;<span class="ident" id="2106257"><a href="/syscall/exec_unix.go.html#2106097">err</a></span>&nbsp;<span class="op" id="2106261">=</span>&nbsp;<span class="ident" id="2106263"><a href="/syscall/zsyscall_linux_amd64.go.html#2234545">fcntl</a></span><span class="op" id="2106268">(</span><span class="ident" id="2106269"><a href="/syscall/exec_unix.go.html#2106070">fd</a></span><span class="op" id="2106271">,</span>&nbsp;<span class="ident" id="2106273"><a href="/syscall/zerrors_linux_amd64.go.html#2175253">F_SETFL</a></span><span class="op" id="2106280">,</span>&nbsp;<span class="ident" id="2106282"><a href="/syscall/exec_unix.go.html#2106111">flag</a></span><span class="op" id="2106286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2106289">return</span>&nbsp;<span class="ident" id="2106296"><a href="/syscall/exec_unix.go.html#2106097">err</a></span><br>
<span class="lineno"></span><span class="op" id="2106300">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="2106303">//&nbsp;Credential&nbsp;holds&nbsp;user&nbsp;and&nbsp;group&nbsp;identities&nbsp;to&nbsp;be&nbsp;assumed</span><br>
<span class="lineno"></span><span class="comment" id="2106363">//&nbsp;by&nbsp;a&nbsp;child&nbsp;process&nbsp;started&nbsp;by&nbsp;StartProcess.</span><br>
<span class="lineno"></span><span class="keyword" id="2106410">type</span>&nbsp;<span class="ident" id="2106415">Credential</span>&nbsp;<span class="keyword" id="2106426">struct</span>&nbsp;<span class="op" id="2106433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2106436">Uid</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2106443">uint32</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="2106452">//&nbsp;User&nbsp;ID.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2106465">Gid</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2106472">uint32</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="2106481">//&nbsp;Group&nbsp;ID.</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2106495">Groups</span>&nbsp;<span class="op" id="2106502">[</span><span class="op" id="2106503">]</span><span class="builtintype" id="2106504">uint32</span>&nbsp;<span class="comment" id="2106511">//&nbsp;Supplementary&nbsp;group&nbsp;IDs.</span><br>
<span class="lineno"></span><span class="op" id="2106539">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2106542">//&nbsp;ProcAttr&nbsp;holds&nbsp;attributes&nbsp;that&nbsp;will&nbsp;be&nbsp;applied&nbsp;to&nbsp;a&nbsp;new&nbsp;process&nbsp;started</span><br>
<span class="lineno"></span><span class="comment" id="2106617">//&nbsp;by&nbsp;StartProcess.</span><br>
<span class="lineno">120</span><span class="keyword" id="2106637">type</span>&nbsp;<span class="ident" id="2106642">ProcAttr</span>&nbsp;<span class="keyword" id="2106651">struct</span>&nbsp;<span class="op" id="2106658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2106661">Dir</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2106667">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2106677">//&nbsp;Current&nbsp;working&nbsp;directory.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2106708">Env</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2106714">[</span><span class="op" id="2106715">]</span><span class="builtintype" id="2106716">string</span>&nbsp;&nbsp;<span class="comment" id="2106724">//&nbsp;Environment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2106741">Files</span>&nbsp;<span class="op" id="2106747">[</span><span class="op" id="2106748">]</span><span class="builtintype" id="2106749">uintptr</span>&nbsp;<span class="comment" id="2106757">//&nbsp;File&nbsp;descriptors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2106779">Sys</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2106785">*</span><span class="ident" id="2106786"><a href="/syscall/exec_linux.go.html#2093371">SysProcAttr</a></span><br>
<span class="lineno">125</span><span class="op" id="2106798">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2106801">var</span>&nbsp;<span class="ident" id="2106805">zeroProcAttr</span>&nbsp;<span class="ident" id="2106818"><a href="/syscall/exec_unix.go.html#2106642">ProcAttr</a></span><br>
<span class="lineno"></span><span class="keyword" id="2106827">var</span>&nbsp;<span class="ident" id="2106831">zeroSysProcAttr</span>&nbsp;<span class="ident" id="2106847"><a href="/syscall/exec_linux.go.html#2093371">SysProcAttr</a></span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="2106860">func</span>&nbsp;<span class="ident" id="2106865">forkExec</span><span class="op" id="2106873">(</span><span class="ident" id="2106874">argv0</span>&nbsp;<span class="builtintype" id="2106880">string</span><span class="op" id="2106886">,</span>&nbsp;<span class="ident" id="2106888">argv</span>&nbsp;<span class="op" id="2106893">[</span><span class="op" id="2106894">]</span><span class="builtintype" id="2106895">string</span><span class="op" id="2106901">,</span>&nbsp;<span class="ident" id="2106903">attr</span>&nbsp;<span class="op" id="2106908">*</span><span class="ident" id="2106909"><a href="/syscall/exec_unix.go.html#2106642">ProcAttr</a></span><span class="op" id="2106917">)</span>&nbsp;<span class="op" id="2106919">(</span><span class="ident" id="2106920">pid</span>&nbsp;<span class="builtintype" id="2106924">int</span><span class="op" id="2106927">,</span>&nbsp;<span class="ident" id="2106929">err</span>&nbsp;<span class="builtintype" id="2106933">error</span><span class="op" id="2106938">)</span>&nbsp;<span class="op" id="2106940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2106943">var</span>&nbsp;<span class="ident" id="2106947">p</span>&nbsp;<span class="op" id="2106949">[</span><span class="num" id="2106950">2</span><span class="op" id="2106951">]</span><span class="builtintype" id="2106952">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2106957">var</span>&nbsp;<span class="ident" id="2106961">n</span>&nbsp;<span class="builtintype" id="2106963">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2106968">var</span>&nbsp;<span class="ident" id="2106972">err1</span>&nbsp;<span class="ident" id="2106977"><a href="/syscall/syscall_unix.go.html#2159119">Errno</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2106984">var</span>&nbsp;<span class="ident" id="2106988">wstatus</span>&nbsp;<span class="ident" id="2106996"><a href="/syscall/syscall_linux.go.html#2129030">WaitStatus</a></span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2107009">if</span>&nbsp;<span class="ident" id="2107012"><a href="/syscall/exec_unix.go.html#2106903">attr</a></span>&nbsp;<span class="op" id="2107017">==</span>&nbsp;<span class="ident" id="2107020">nil</span>&nbsp;<span class="op" id="2107024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2107028"><a href="/syscall/exec_unix.go.html#2106903">attr</a></span>&nbsp;<span class="op" id="2107033">=</span>&nbsp;<span class="op" id="2107035">&amp;</span><span class="ident" id="2107036"><a href="/syscall/exec_unix.go.html#2106805">zeroProcAttr</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2107050">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2107053">sys</span>&nbsp;<span class="op" id="2107057">:=</span>&nbsp;<span class="ident" id="2107060"><a href="/syscall/exec_unix.go.html#2106903">attr</a></span><span class="op" id="2107064">.</span><span class="ident" id="2107065">Sys</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2107070">if</span>&nbsp;<span class="ident" id="2107073"><a href="/syscall/exec_unix.go.html#2107053">sys</a></span>&nbsp;<span class="op" id="2107077">==</span>&nbsp;<span class="ident" id="2107080">nil</span>&nbsp;<span class="op" id="2107084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2107088"><a href="/syscall/exec_unix.go.html#2107053">sys</a></span>&nbsp;<span class="op" id="2107092">=</span>&nbsp;<span class="op" id="2107094">&amp;</span><span class="ident" id="2107095"><a href="/syscall/exec_unix.go.html#2106831">zeroSysProcAttr</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2107112">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2107116"><a href="/syscall/exec_unix.go.html#2106947">p</a></span><span class="op" id="2107117">[</span><span class="num" id="2107118">0</span><span class="op" id="2107119">]</span>&nbsp;<span class="op" id="2107121">=</span>&nbsp;<span class="op" id="2107123">-</span><span class="num" id="2107124">1</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2107127"><a href="/syscall/exec_unix.go.html#2106947">p</a></span><span class="op" id="2107128">[</span><span class="num" id="2107129">1</span><span class="op" id="2107130">]</span>&nbsp;<span class="op" id="2107132">=</span>&nbsp;<span class="op" id="2107134">-</span><span class="num" id="2107135">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2107139">//&nbsp;Convert&nbsp;args&nbsp;to&nbsp;C&nbsp;form.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2107167">argv0p</span><span class="op" id="2107173">,</span>&nbsp;<span class="ident" id="2107175"><a href="/syscall/exec_unix.go.html#2106929">err</a></span>&nbsp;<span class="op" id="2107179">:=</span>&nbsp;<span class="ident" id="2107182"><a href="/syscall/syscall.go.html#2124585">BytePtrFromString</a></span><span class="op" id="2107199">(</span><span class="ident" id="2107200"><a href="/syscall/exec_unix.go.html#2106874">argv0</a></span><span class="op" id="2107205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2107208">if</span>&nbsp;<span class="ident" id="2107211"><a href="/syscall/exec_unix.go.html#2106929">err</a></span>&nbsp;<span class="op" id="2107215">!=</span>&nbsp;<span class="ident" id="2107218">nil</span>&nbsp;<span class="op" id="2107222">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2107226">return</span>&nbsp;<span class="num" id="2107233">0</span><span class="op" id="2107234">,</span>&nbsp;<span class="ident" id="2107236"><a href="/syscall/exec_unix.go.html#2106929">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2107241">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2107244">argvp</span><span class="op" id="2107249">,</span>&nbsp;<span class="ident" id="2107251"><a href="/syscall/exec_unix.go.html#2106929">err</a></span>&nbsp;<span class="op" id="2107255">:=</span>&nbsp;<span class="ident" id="2107258"><a href="/syscall/exec_unix.go.html#2105739">SlicePtrFromStrings</a></span><span class="op" id="2107277">(</span><span class="ident" id="2107278"><a href="/syscall/exec_unix.go.html#2106888">argv</a></span><span class="op" id="2107282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2107285">if</span>&nbsp;<span class="ident" id="2107288"><a href="/syscall/exec_unix.go.html#2106929">err</a></span>&nbsp;<span class="op" id="2107292">!=</span>&nbsp;<span class="ident" id="2107295">nil</span>&nbsp;<span class="op" id="2107299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2107303">return</span>&nbsp;<span class="num" id="2107310">0</span><span class="op" id="2107311">,</span>&nbsp;<span class="ident" id="2107313"><a href="/syscall/exec_unix.go.html#2106929">err</a></span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2107318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2107321">envvp</span><span class="op" id="2107326">,</span>&nbsp;<span class="ident" id="2107328"><a href="/syscall/exec_unix.go.html#2106929">err</a></span>&nbsp;<span class="op" id="2107332">:=</span>&nbsp;<span class="ident" id="2107335"><a href="/syscall/exec_unix.go.html#2105739">SlicePtrFromStrings</a></span><span class="op" id="2107354">(</span><span class="ident" id="2107355"><a href="/syscall/exec_unix.go.html#2106903">attr</a></span><span class="op" id="2107359">.</span><span class="ident" id="2107360">Env</span><span class="op" id="2107363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2107366">if</span>&nbsp;<span class="ident" id="2107369"><a href="/syscall/exec_unix.go.html#2106929">err</a></span>&nbsp;<span class="op" id="2107373">!=</span>&nbsp;<span class="ident" id="2107376">nil</span>&nbsp;<span class="op" id="2107380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2107384">return</span>&nbsp;<span class="num" id="2107391">0</span><span class="op" id="2107392">,</span>&nbsp;<span class="ident" id="2107394"><a href="/syscall/exec_unix.go.html#2106929">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2107399">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2107403">if</span>&nbsp;<span class="op" id="2107406">(</span><span class="ident" id="2107407"><a href="/syscall/exec_unix.go.html#2102790">runtime</a></span><span class="op" id="2107414">.</span><span class="ident" id="2107415">GOOS</span>&nbsp;<span class="op" id="2107420">==</span>&nbsp;<span class="string" id="2107423">&#34;freebsd&#34;</span>&nbsp;<span class="op" id="2107433">||</span>&nbsp;<span class="ident" id="2107436"><a href="/syscall/exec_unix.go.html#2102790">runtime</a></span><span class="op" id="2107443">.</span><span class="ident" id="2107444">GOOS</span>&nbsp;<span class="op" id="2107449">==</span>&nbsp;<span class="string" id="2107452">&#34;dragonfly&#34;</span><span class="op" id="2107463">)</span>&nbsp;<span class="op" id="2107465">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2107468">len</span><span class="op" id="2107471">(</span><span class="ident" id="2107472"><a href="/syscall/exec_unix.go.html#2106888">argv</a></span><span class="op" id="2107476">[</span><span class="num" id="2107477">0</span><span class="op" id="2107478">]</span><span class="op" id="2107479">)</span>&nbsp;<span class="op" id="2107481">&gt;</span>&nbsp;<span class="builtinfunc" id="2107483">len</span><span class="op" id="2107486">(</span><span class="ident" id="2107487"><a href="/syscall/exec_unix.go.html#2106874">argv0</a></span><span class="op" id="2107492">)</span>&nbsp;<span class="op" id="2107494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2107498"><a href="/syscall/exec_unix.go.html#2107244">argvp</a></span><span class="op" id="2107503">[</span><span class="num" id="2107504">0</span><span class="op" id="2107505">]</span>&nbsp;<span class="op" id="2107507">=</span>&nbsp;<span class="ident" id="2107509"><a href="/syscall/exec_unix.go.html#2107167">argv0p</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2107517">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2107521">var</span>&nbsp;<span class="ident" id="2107525">chroot</span>&nbsp;<span class="op" id="2107532">*</span><span class="builtintype" id="2107533">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2107539">if</span>&nbsp;<span class="ident" id="2107542"><a href="/syscall/exec_unix.go.html#2107053">sys</a></span><span class="op" id="2107545">.</span><span class="ident" id="2107546">Chroot</span>&nbsp;<span class="op" id="2107553">!=</span>&nbsp;<span class="string" id="2107556">&#34;&#34;</span>&nbsp;<span class="op" id="2107559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2107563"><a href="/syscall/exec_unix.go.html#2107525">chroot</a></span><span class="op" id="2107569">,</span>&nbsp;<span class="ident" id="2107571"><a href="/syscall/exec_unix.go.html#2106929">err</a></span>&nbsp;<span class="op" id="2107575">=</span>&nbsp;<span class="ident" id="2107577"><a href="/syscall/syscall.go.html#2124585">BytePtrFromString</a></span><span class="op" id="2107594">(</span><span class="ident" id="2107595"><a href="/syscall/exec_unix.go.html#2107053">sys</a></span><span class="op" id="2107598">.</span><span class="ident" id="2107599">Chroot</span><span class="op" id="2107605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2107609">if</span>&nbsp;<span class="ident" id="2107612"><a href="/syscall/exec_unix.go.html#2106929">err</a></span>&nbsp;<span class="op" id="2107616">!=</span>&nbsp;<span class="ident" id="2107619">nil</span>&nbsp;<span class="op" id="2107623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2107628">return</span>&nbsp;<span class="num" id="2107635">0</span><span class="op" id="2107636">,</span>&nbsp;<span class="ident" id="2107638"><a href="/syscall/exec_unix.go.html#2106929">err</a></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2107644">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2107647">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2107650">var</span>&nbsp;<span class="ident" id="2107654">dir</span>&nbsp;<span class="op" id="2107658">*</span><span class="builtintype" id="2107659">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2107665">if</span>&nbsp;<span class="ident" id="2107668"><a href="/syscall/exec_unix.go.html#2106903">attr</a></span><span class="op" id="2107672">.</span><span class="ident" id="2107673">Dir</span>&nbsp;<span class="op" id="2107677">!=</span>&nbsp;<span class="string" id="2107680">&#34;&#34;</span>&nbsp;<span class="op" id="2107683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2107687"><a href="/syscall/exec_unix.go.html#2107654">dir</a></span><span class="op" id="2107690">,</span>&nbsp;<span class="ident" id="2107692"><a href="/syscall/exec_unix.go.html#2106929">err</a></span>&nbsp;<span class="op" id="2107696">=</span>&nbsp;<span class="ident" id="2107698"><a href="/syscall/syscall.go.html#2124585">BytePtrFromString</a></span><span class="op" id="2107715">(</span><span class="ident" id="2107716"><a href="/syscall/exec_unix.go.html#2106903">attr</a></span><span class="op" id="2107720">.</span><span class="ident" id="2107721">Dir</span><span class="op" id="2107724">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2107728">if</span>&nbsp;<span class="ident" id="2107731"><a href="/syscall/exec_unix.go.html#2106929">err</a></span>&nbsp;<span class="op" id="2107735">!=</span>&nbsp;<span class="ident" id="2107738">nil</span>&nbsp;<span class="op" id="2107742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2107747">return</span>&nbsp;<span class="num" id="2107754">0</span><span class="op" id="2107755">,</span>&nbsp;<span class="ident" id="2107757"><a href="/syscall/exec_unix.go.html#2106929">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2107763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2107766">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2107770">//&nbsp;Acquire&nbsp;the&nbsp;fork&nbsp;lock&nbsp;so&nbsp;that&nbsp;no&nbsp;other&nbsp;threads</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2107821">//&nbsp;create&nbsp;new&nbsp;fds&nbsp;that&nbsp;are&nbsp;not&nbsp;yet&nbsp;close-on-exec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2107871">//&nbsp;before&nbsp;we&nbsp;fork.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2107891"><a href="/syscall/exec_unix.go.html#2105207">ForkLock</a></span><span class="op" id="2107899">.</span><span class="ident" id="2107900">Lock</span><span class="op" id="2107904">(</span><span class="op" id="2107905">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2107909">//&nbsp;Allocate&nbsp;child&nbsp;status&nbsp;pipe&nbsp;close&nbsp;on&nbsp;exec.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2107955">if</span>&nbsp;<span class="ident" id="2107958"><a href="/syscall/exec_unix.go.html#2106929">err</a></span>&nbsp;<span class="op" id="2107962">=</span>&nbsp;<span class="ident" id="2107964"><a href="/syscall/exec_linux.go.html#2101018">forkExecPipe</a></span><span class="op" id="2107976">(</span><span class="ident" id="2107977"><a href="/syscall/exec_unix.go.html#2106947">p</a></span><span class="op" id="2107978">[</span><span class="op" id="2107979">:</span><span class="op" id="2107980">]</span><span class="op" id="2107981">)</span><span class="op" id="2107982">;</span>&nbsp;<span class="ident" id="2107984"><a href="/syscall/exec_unix.go.html#2106929">err</a></span>&nbsp;<span class="op" id="2107988">!=</span>&nbsp;<span class="ident" id="2107991">nil</span>&nbsp;<span class="op" id="2107995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2107999">goto</span>&nbsp;<span class="builtintype" id="2108004">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2108011">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2108015">//&nbsp;Kick&nbsp;off&nbsp;child.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2108035"><a href="/syscall/exec_unix.go.html#2106920">pid</a></span><span class="op" id="2108038">,</span>&nbsp;<span class="ident" id="2108040"><a href="/syscall/exec_unix.go.html#2106972">err1</a></span>&nbsp;<span class="op" id="2108045">=</span>&nbsp;<span class="ident" id="2108047"><a href="/syscall/exec_linux.go.html#2094838">forkAndExecInChild</a></span><span class="op" id="2108065">(</span><span class="ident" id="2108066"><a href="/syscall/exec_unix.go.html#2107167">argv0p</a></span><span class="op" id="2108072">,</span>&nbsp;<span class="ident" id="2108074"><a href="/syscall/exec_unix.go.html#2107244">argvp</a></span><span class="op" id="2108079">,</span>&nbsp;<span class="ident" id="2108081"><a href="/syscall/exec_unix.go.html#2107321">envvp</a></span><span class="op" id="2108086">,</span>&nbsp;<span class="ident" id="2108088"><a href="/syscall/exec_unix.go.html#2107525">chroot</a></span><span class="op" id="2108094">,</span>&nbsp;<span class="ident" id="2108096"><a href="/syscall/exec_unix.go.html#2107654">dir</a></span><span class="op" id="2108099">,</span>&nbsp;<span class="ident" id="2108101"><a href="/syscall/exec_unix.go.html#2106903">attr</a></span><span class="op" id="2108105">,</span>&nbsp;<span class="ident" id="2108107"><a href="/syscall/exec_unix.go.html#2107053">sys</a></span><span class="op" id="2108110">,</span>&nbsp;<span class="ident" id="2108112"><a href="/syscall/exec_unix.go.html#2106947">p</a></span><span class="op" id="2108113">[</span><span class="num" id="2108114">1</span><span class="op" id="2108115">]</span><span class="op" id="2108116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2108119">if</span>&nbsp;<span class="ident" id="2108122"><a href="/syscall/exec_unix.go.html#2106972">err1</a></span>&nbsp;<span class="op" id="2108127">!=</span>&nbsp;<span class="num" id="2108130">0</span>&nbsp;<span class="op" id="2108132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2108136"><a href="/syscall/exec_unix.go.html#2106929">err</a></span>&nbsp;<span class="op" id="2108140">=</span>&nbsp;<span class="ident" id="2108142"><a href="/syscall/syscall_unix.go.html#2159119">Errno</a></span><span class="op" id="2108147">(</span><span class="ident" id="2108148"><a href="/syscall/exec_unix.go.html#2106972">err1</a></span><span class="op" id="2108152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2108156">goto</span>&nbsp;<span class="builtintype" id="2108161">error</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2108168">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2108171"><a href="/syscall/exec_unix.go.html#2105207">ForkLock</a></span><span class="op" id="2108179">.</span><span class="ident" id="2108180">Unlock</span><span class="op" id="2108186">(</span><span class="op" id="2108187">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2108191">//&nbsp;Read&nbsp;child&nbsp;error&nbsp;status&nbsp;from&nbsp;pipe.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2108230"><a href="/syscall/zsyscall_linux_amd64.go.html#2230053">Close</a></span><span class="op" id="2108235">(</span><span class="ident" id="2108236"><a href="/syscall/exec_unix.go.html#2106947">p</a></span><span class="op" id="2108237">[</span><span class="num" id="2108238">1</span><span class="op" id="2108239">]</span><span class="op" id="2108240">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2108243"><a href="/syscall/exec_unix.go.html#2106961">n</a></span><span class="op" id="2108244">,</span>&nbsp;<span class="ident" id="2108246"><a href="/syscall/exec_unix.go.html#2106929">err</a></span>&nbsp;<span class="op" id="2108250">=</span>&nbsp;<span class="ident" id="2108252"><a href="/syscall/zsyscall_linux_amd64.go.html#2252556">readlen</a></span><span class="op" id="2108259">(</span><span class="ident" id="2108260"><a href="/syscall/exec_unix.go.html#2106947">p</a></span><span class="op" id="2108261">[</span><span class="num" id="2108262">0</span><span class="op" id="2108263">]</span><span class="op" id="2108264">,</span>&nbsp;<span class="op" id="2108266">(</span><span class="op" id="2108267">*</span><span class="builtintype" id="2108268">byte</span><span class="op" id="2108272">)</span><span class="op" id="2108273">(</span><span class="ident" id="2108274"><a href="/syscall/exec_unix.go.html#2102809">unsafe</a></span><span class="op" id="2108280">.</span><span class="ident" id="2108281">Pointer</span><span class="op" id="2108288">(</span><span class="op" id="2108289">&amp;</span><span class="ident" id="2108290"><a href="/syscall/exec_unix.go.html#2106972">err1</a></span><span class="op" id="2108294">)</span><span class="op" id="2108295">)</span><span class="op" id="2108296">,</span>&nbsp;<span class="builtintype" id="2108298">int</span><span class="op" id="2108301">(</span><span class="ident" id="2108302"><a href="/syscall/exec_unix.go.html#2102809">unsafe</a></span><span class="op" id="2108308">.</span><span class="ident" id="2108309">Sizeof</span><span class="op" id="2108315">(</span><span class="ident" id="2108316"><a href="/syscall/exec_unix.go.html#2106972">err1</a></span><span class="op" id="2108320">)</span><span class="op" id="2108321">)</span><span class="op" id="2108322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2108325"><a href="/syscall/zsyscall_linux_amd64.go.html#2230053">Close</a></span><span class="op" id="2108330">(</span><span class="ident" id="2108331"><a href="/syscall/exec_unix.go.html#2106947">p</a></span><span class="op" id="2108332">[</span><span class="num" id="2108333">0</span><span class="op" id="2108334">]</span><span class="op" id="2108335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2108338">if</span>&nbsp;<span class="ident" id="2108341"><a href="/syscall/exec_unix.go.html#2106929">err</a></span>&nbsp;<span class="op" id="2108345">!=</span>&nbsp;<span class="ident" id="2108348">nil</span>&nbsp;<span class="op" id="2108352">||</span>&nbsp;<span class="ident" id="2108355"><a href="/syscall/exec_unix.go.html#2106961">n</a></span>&nbsp;<span class="op" id="2108357">!=</span>&nbsp;<span class="num" id="2108360">0</span>&nbsp;<span class="op" id="2108362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2108366">if</span>&nbsp;<span class="ident" id="2108369"><a href="/syscall/exec_unix.go.html#2106961">n</a></span>&nbsp;<span class="op" id="2108371">==</span>&nbsp;<span class="builtintype" id="2108374">int</span><span class="op" id="2108377">(</span><span class="ident" id="2108378"><a href="/syscall/exec_unix.go.html#2102809">unsafe</a></span><span class="op" id="2108384">.</span><span class="ident" id="2108385">Sizeof</span><span class="op" id="2108391">(</span><span class="ident" id="2108392"><a href="/syscall/exec_unix.go.html#2106972">err1</a></span><span class="op" id="2108396">)</span><span class="op" id="2108397">)</span>&nbsp;<span class="op" id="2108399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2108404"><a href="/syscall/exec_unix.go.html#2106929">err</a></span>&nbsp;<span class="op" id="2108408">=</span>&nbsp;<span class="ident" id="2108410"><a href="/syscall/syscall_unix.go.html#2159119">Errno</a></span><span class="op" id="2108415">(</span><span class="ident" id="2108416"><a href="/syscall/exec_unix.go.html#2106972">err1</a></span><span class="op" id="2108420">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2108424">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2108428">if</span>&nbsp;<span class="ident" id="2108431"><a href="/syscall/exec_unix.go.html#2106929">err</a></span>&nbsp;<span class="op" id="2108435">==</span>&nbsp;<span class="ident" id="2108438">nil</span>&nbsp;<span class="op" id="2108442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2108447"><a href="/syscall/exec_unix.go.html#2106929">err</a></span>&nbsp;<span class="op" id="2108451">=</span>&nbsp;<span class="ident" id="2108453"><a href="/syscall/zerrors_linux_amd64.go.html#2216698">EPIPE</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2108461">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2108466">//&nbsp;Child&nbsp;failed;&nbsp;wait&nbsp;for&nbsp;it&nbsp;to&nbsp;exit,&nbsp;to&nbsp;make&nbsp;sure</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2108519">//&nbsp;the&nbsp;zombies&nbsp;don&#39;t&nbsp;accumulate.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2108554">_</span><span class="op" id="2108555">,</span>&nbsp;<span class="ident" id="2108557">err1</span>&nbsp;<span class="op" id="2108562">:=</span>&nbsp;<span class="ident" id="2108565"><a href="/syscall/syscall_linux.go.html#2130433">Wait4</a></span><span class="op" id="2108570">(</span><span class="ident" id="2108571"><a href="/syscall/exec_unix.go.html#2106920">pid</a></span><span class="op" id="2108574">,</span>&nbsp;<span class="op" id="2108576">&amp;</span><span class="ident" id="2108577"><a href="/syscall/exec_unix.go.html#2106988">wstatus</a></span><span class="op" id="2108584">,</span>&nbsp;<span class="num" id="2108586">0</span><span class="op" id="2108587">,</span>&nbsp;<span class="ident" id="2108589">nil</span><span class="op" id="2108592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2108596">for</span>&nbsp;<span class="ident" id="2108600"><a href="/syscall/exec_unix.go.html#2108557">err1</a></span>&nbsp;<span class="op" id="2108605">==</span>&nbsp;<span class="ident" id="2108608"><a href="/syscall/zerrors_linux_amd64.go.html#2214629">EINTR</a></span>&nbsp;<span class="op" id="2108614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2108619">_</span><span class="op" id="2108620">,</span>&nbsp;<span class="ident" id="2108622"><a href="/syscall/exec_unix.go.html#2108557">err1</a></span>&nbsp;<span class="op" id="2108627">=</span>&nbsp;<span class="ident" id="2108629"><a href="/syscall/syscall_linux.go.html#2130433">Wait4</a></span><span class="op" id="2108634">(</span><span class="ident" id="2108635"><a href="/syscall/exec_unix.go.html#2106920">pid</a></span><span class="op" id="2108638">,</span>&nbsp;<span class="op" id="2108640">&amp;</span><span class="ident" id="2108641"><a href="/syscall/exec_unix.go.html#2106988">wstatus</a></span><span class="op" id="2108648">,</span>&nbsp;<span class="num" id="2108650">0</span><span class="op" id="2108651">,</span>&nbsp;<span class="ident" id="2108653">nil</span><span class="op" id="2108656">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2108660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2108664">return</span>&nbsp;<span class="num" id="2108671">0</span><span class="op" id="2108672">,</span>&nbsp;<span class="ident" id="2108674"><a href="/syscall/exec_unix.go.html#2106929">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2108679">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2108683">//&nbsp;Read&nbsp;got&nbsp;EOF,&nbsp;so&nbsp;pipe&nbsp;closed&nbsp;on&nbsp;exec,&nbsp;so&nbsp;exec&nbsp;succeeded.</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2108744">return</span>&nbsp;<span class="ident" id="2108751"><a href="/syscall/exec_unix.go.html#2106920">pid</a></span><span class="op" id="2108754">,</span>&nbsp;<span class="ident" id="2108756">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="builtintype" id="2108761">error</span><span class="op" id="2108766">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2108769">if</span>&nbsp;<span class="ident" id="2108772"><a href="/syscall/exec_unix.go.html#2106947">p</a></span><span class="op" id="2108773">[</span><span class="num" id="2108774">0</span><span class="op" id="2108775">]</span>&nbsp;<span class="op" id="2108777">&gt;=</span>&nbsp;<span class="num" id="2108780">0</span>&nbsp;<span class="op" id="2108782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2108786"><a href="/syscall/zsyscall_linux_amd64.go.html#2230053">Close</a></span><span class="op" id="2108791">(</span><span class="ident" id="2108792"><a href="/syscall/exec_unix.go.html#2106947">p</a></span><span class="op" id="2108793">[</span><span class="num" id="2108794">0</span><span class="op" id="2108795">]</span><span class="op" id="2108796">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2108800"><a href="/syscall/zsyscall_linux_amd64.go.html#2230053">Close</a></span><span class="op" id="2108805">(</span><span class="ident" id="2108806"><a href="/syscall/exec_unix.go.html#2106947">p</a></span><span class="op" id="2108807">[</span><span class="num" id="2108808">1</span><span class="op" id="2108809">]</span><span class="op" id="2108810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2108813">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2108816"><a href="/syscall/exec_unix.go.html#2105207">ForkLock</a></span><span class="op" id="2108824">.</span><span class="ident" id="2108825">Unlock</span><span class="op" id="2108831">(</span><span class="op" id="2108832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2108835">return</span>&nbsp;<span class="num" id="2108842">0</span><span class="op" id="2108843">,</span>&nbsp;<span class="ident" id="2108845"><a href="/syscall/exec_unix.go.html#2106929">err</a></span><br>
<span class="lineno"></span><span class="op" id="2108849">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="2108852">//&nbsp;Combination&nbsp;of&nbsp;fork&nbsp;and&nbsp;exec,&nbsp;careful&nbsp;to&nbsp;be&nbsp;thread&nbsp;safe.</span><br>
<span class="lineno"></span><span class="keyword" id="2108912">func</span>&nbsp;<span class="ident" id="2108917">ForkExec</span><span class="op" id="2108925">(</span><span class="ident" id="2108926">argv0</span>&nbsp;<span class="builtintype" id="2108932">string</span><span class="op" id="2108938">,</span>&nbsp;<span class="ident" id="2108940">argv</span>&nbsp;<span class="op" id="2108945">[</span><span class="op" id="2108946">]</span><span class="builtintype" id="2108947">string</span><span class="op" id="2108953">,</span>&nbsp;<span class="ident" id="2108955">attr</span>&nbsp;<span class="op" id="2108960">*</span><span class="ident" id="2108961"><a href="/syscall/exec_unix.go.html#2106642">ProcAttr</a></span><span class="op" id="2108969">)</span>&nbsp;<span class="op" id="2108971">(</span><span class="ident" id="2108972">pid</span>&nbsp;<span class="builtintype" id="2108976">int</span><span class="op" id="2108979">,</span>&nbsp;<span class="ident" id="2108981">err</span>&nbsp;<span class="builtintype" id="2108985">error</span><span class="op" id="2108990">)</span>&nbsp;<span class="op" id="2108992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2108995">return</span>&nbsp;<span class="ident" id="2109002"><a href="/syscall/exec_unix.go.html#2106865">forkExec</a></span><span class="op" id="2109010">(</span><span class="ident" id="2109011"><a href="/syscall/exec_unix.go.html#2108926">argv0</a></span><span class="op" id="2109016">,</span>&nbsp;<span class="ident" id="2109018"><a href="/syscall/exec_unix.go.html#2108940">argv</a></span><span class="op" id="2109022">,</span>&nbsp;<span class="ident" id="2109024"><a href="/syscall/exec_unix.go.html#2108955">attr</a></span><span class="op" id="2109028">)</span><br>
<span class="lineno"></span><span class="op" id="2109030">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span><span class="comment" id="2109033">//&nbsp;StartProcess&nbsp;wraps&nbsp;ForkExec&nbsp;for&nbsp;package&nbsp;os.</span><br>
<span class="lineno"></span><span class="keyword" id="2109080">func</span>&nbsp;<span class="ident" id="2109085">StartProcess</span><span class="op" id="2109097">(</span><span class="ident" id="2109098">argv0</span>&nbsp;<span class="builtintype" id="2109104">string</span><span class="op" id="2109110">,</span>&nbsp;<span class="ident" id="2109112">argv</span>&nbsp;<span class="op" id="2109117">[</span><span class="op" id="2109118">]</span><span class="builtintype" id="2109119">string</span><span class="op" id="2109125">,</span>&nbsp;<span class="ident" id="2109127">attr</span>&nbsp;<span class="op" id="2109132">*</span><span class="ident" id="2109133"><a href="/syscall/exec_unix.go.html#2106642">ProcAttr</a></span><span class="op" id="2109141">)</span>&nbsp;<span class="op" id="2109143">(</span><span class="ident" id="2109144">pid</span>&nbsp;<span class="builtintype" id="2109148">int</span><span class="op" id="2109151">,</span>&nbsp;<span class="ident" id="2109153">handle</span>&nbsp;<span class="builtintype" id="2109160">uintptr</span><span class="op" id="2109167">,</span>&nbsp;<span class="ident" id="2109169">err</span>&nbsp;<span class="builtintype" id="2109173">error</span><span class="op" id="2109178">)</span>&nbsp;<span class="op" id="2109180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2109183"><a href="/syscall/exec_unix.go.html#2109144">pid</a></span><span class="op" id="2109186">,</span>&nbsp;<span class="ident" id="2109188"><a href="/syscall/exec_unix.go.html#2109169">err</a></span>&nbsp;<span class="op" id="2109192">=</span>&nbsp;<span class="ident" id="2109194"><a href="/syscall/exec_unix.go.html#2106865">forkExec</a></span><span class="op" id="2109202">(</span><span class="ident" id="2109203"><a href="/syscall/exec_unix.go.html#2109098">argv0</a></span><span class="op" id="2109208">,</span>&nbsp;<span class="ident" id="2109210"><a href="/syscall/exec_unix.go.html#2109112">argv</a></span><span class="op" id="2109214">,</span>&nbsp;<span class="ident" id="2109216"><a href="/syscall/exec_unix.go.html#2109127">attr</a></span><span class="op" id="2109220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2109223">return</span>&nbsp;<span class="ident" id="2109230"><a href="/syscall/exec_unix.go.html#2109144">pid</a></span><span class="op" id="2109233">,</span>&nbsp;<span class="num" id="2109235">0</span><span class="op" id="2109236">,</span>&nbsp;<span class="ident" id="2109238"><a href="/syscall/exec_unix.go.html#2109169">err</a></span><br>
<span class="lineno">240</span><span class="op" id="2109242">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2109245">//&nbsp;Ordinary&nbsp;exec.</span><br>
<span class="lineno"></span><span class="keyword" id="2109263">func</span>&nbsp;<span class="ident" id="2109268">Exec</span><span class="op" id="2109272">(</span><span class="ident" id="2109273">argv0</span>&nbsp;<span class="builtintype" id="2109279">string</span><span class="op" id="2109285">,</span>&nbsp;<span class="ident" id="2109287">argv</span>&nbsp;<span class="op" id="2109292">[</span><span class="op" id="2109293">]</span><span class="builtintype" id="2109294">string</span><span class="op" id="2109300">,</span>&nbsp;<span class="ident" id="2109302">envv</span>&nbsp;<span class="op" id="2109307">[</span><span class="op" id="2109308">]</span><span class="builtintype" id="2109309">string</span><span class="op" id="2109315">)</span>&nbsp;<span class="op" id="2109317">(</span><span class="ident" id="2109318">err</span>&nbsp;<span class="builtintype" id="2109322">error</span><span class="op" id="2109327">)</span>&nbsp;<span class="op" id="2109329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2109332">argv0p</span><span class="op" id="2109338">,</span>&nbsp;<span class="ident" id="2109340"><a href="/syscall/exec_unix.go.html#2109318">err</a></span>&nbsp;<span class="op" id="2109344">:=</span>&nbsp;<span class="ident" id="2109347"><a href="/syscall/syscall.go.html#2124585">BytePtrFromString</a></span><span class="op" id="2109364">(</span><span class="ident" id="2109365"><a href="/syscall/exec_unix.go.html#2109273">argv0</a></span><span class="op" id="2109370">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2109373">if</span>&nbsp;<span class="ident" id="2109376"><a href="/syscall/exec_unix.go.html#2109318">err</a></span>&nbsp;<span class="op" id="2109380">!=</span>&nbsp;<span class="ident" id="2109383">nil</span>&nbsp;<span class="op" id="2109387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2109391">return</span>&nbsp;<span class="ident" id="2109398"><a href="/syscall/exec_unix.go.html#2109318">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2109403">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2109406">argvp</span><span class="op" id="2109411">,</span>&nbsp;<span class="ident" id="2109413"><a href="/syscall/exec_unix.go.html#2109318">err</a></span>&nbsp;<span class="op" id="2109417">:=</span>&nbsp;<span class="ident" id="2109420"><a href="/syscall/exec_unix.go.html#2105739">SlicePtrFromStrings</a></span><span class="op" id="2109439">(</span><span class="ident" id="2109440"><a href="/syscall/exec_unix.go.html#2109287">argv</a></span><span class="op" id="2109444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2109447">if</span>&nbsp;<span class="ident" id="2109450"><a href="/syscall/exec_unix.go.html#2109318">err</a></span>&nbsp;<span class="op" id="2109454">!=</span>&nbsp;<span class="ident" id="2109457">nil</span>&nbsp;<span class="op" id="2109461">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2109465">return</span>&nbsp;<span class="ident" id="2109472"><a href="/syscall/exec_unix.go.html#2109318">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2109477">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2109480">envvp</span><span class="op" id="2109485">,</span>&nbsp;<span class="ident" id="2109487"><a href="/syscall/exec_unix.go.html#2109318">err</a></span>&nbsp;<span class="op" id="2109491">:=</span>&nbsp;<span class="ident" id="2109494"><a href="/syscall/exec_unix.go.html#2105739">SlicePtrFromStrings</a></span><span class="op" id="2109513">(</span><span class="ident" id="2109514"><a href="/syscall/exec_unix.go.html#2109302">envv</a></span><span class="op" id="2109518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2109521">if</span>&nbsp;<span class="ident" id="2109524"><a href="/syscall/exec_unix.go.html#2109318">err</a></span>&nbsp;<span class="op" id="2109528">!=</span>&nbsp;<span class="ident" id="2109531">nil</span>&nbsp;<span class="op" id="2109535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2109539">return</span>&nbsp;<span class="ident" id="2109546"><a href="/syscall/exec_unix.go.html#2109318">err</a></span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2109551">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2109554">_</span><span class="op" id="2109555">,</span>&nbsp;<span class="ident" id="2109557">_</span><span class="op" id="2109558">,</span>&nbsp;<span class="ident" id="2109560">err1</span>&nbsp;<span class="op" id="2109565">:=</span>&nbsp;<span class="ident" id="2109568"><a href="/syscall/syscall_unix.go.html#2157337">RawSyscall</a></span><span class="op" id="2109578">(</span><span class="ident" id="2109579"><a href="/syscall/zsysnum_linux_amd64.go.html#2271249">SYS_EXECVE</a></span><span class="op" id="2109589">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="2109593">uintptr</span><span class="op" id="2109600">(</span><span class="ident" id="2109601"><a href="/syscall/exec_unix.go.html#2102809">unsafe</a></span><span class="op" id="2109607">.</span><span class="ident" id="2109608">Pointer</span><span class="op" id="2109615">(</span><span class="ident" id="2109616"><a href="/syscall/exec_unix.go.html#2109332">argv0p</a></span><span class="op" id="2109622">)</span><span class="op" id="2109623">)</span><span class="op" id="2109624">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="2109628">uintptr</span><span class="op" id="2109635">(</span><span class="ident" id="2109636"><a href="/syscall/exec_unix.go.html#2102809">unsafe</a></span><span class="op" id="2109642">.</span><span class="ident" id="2109643">Pointer</span><span class="op" id="2109650">(</span><span class="op" id="2109651">&amp;</span><span class="ident" id="2109652"><a href="/syscall/exec_unix.go.html#2109406">argvp</a></span><span class="op" id="2109657">[</span><span class="num" id="2109658">0</span><span class="op" id="2109659">]</span><span class="op" id="2109660">)</span><span class="op" id="2109661">)</span><span class="op" id="2109662">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="2109666">uintptr</span><span class="op" id="2109673">(</span><span class="ident" id="2109674"><a href="/syscall/exec_unix.go.html#2102809">unsafe</a></span><span class="op" id="2109680">.</span><span class="ident" id="2109681">Pointer</span><span class="op" id="2109688">(</span><span class="op" id="2109689">&amp;</span><span class="ident" id="2109690"><a href="/syscall/exec_unix.go.html#2109480">envvp</a></span><span class="op" id="2109695">[</span><span class="num" id="2109696">0</span><span class="op" id="2109697">]</span><span class="op" id="2109698">)</span><span class="op" id="2109699">)</span><span class="op" id="2109700">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2109703">return</span>&nbsp;<span class="ident" id="2109710"><a href="/syscall/syscall_unix.go.html#2159119">Errno</a></span><span class="op" id="2109715">(</span><span class="ident" id="2109716"><a href="/syscall/exec_unix.go.html#2109560">err1</a></span><span class="op" id="2109720">)</span><br>
<span class="lineno"></span><span class="op" id="2109722">}</span>
</div>
</body>
</html>
