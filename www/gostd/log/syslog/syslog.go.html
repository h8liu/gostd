<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>log/syslog</h2>
<ul>
<li><a href="/gostd/log/syslog/syslog.go.html">syslog.go</a></li>
<li><a href="/gostd/log/syslog/syslog_test.go.html">syslog_test.go</a></li>
<li><a href="/gostd/log/syslog/syslog_unix.go.html">syslog_unix.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6168453">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6168508">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6168562">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6168613">//&nbsp;+build&nbsp;!windows,!nacl,!plan9</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6168646">//&nbsp;Package&nbsp;syslog&nbsp;provides&nbsp;a&nbsp;simple&nbsp;interface&nbsp;to&nbsp;the&nbsp;system&nbsp;log</span><br>
<span class="lineno"></span><span class="comment" id="6168710">//&nbsp;service.&nbsp;It&nbsp;can&nbsp;send&nbsp;messages&nbsp;to&nbsp;the&nbsp;syslog&nbsp;daemon&nbsp;using&nbsp;UNIX</span><br>
<span class="lineno"></span><span class="comment" id="6168775">//&nbsp;domain&nbsp;sockets,&nbsp;UDP&nbsp;or&nbsp;TCP.</span><br>
<span class="lineno">10</span><span class="comment" id="6168806">//</span><br>
<span class="lineno"></span><span class="comment" id="6168809">//&nbsp;Only&nbsp;one&nbsp;call&nbsp;to&nbsp;Dial&nbsp;is&nbsp;necessary.&nbsp;On&nbsp;write&nbsp;failures,</span><br>
<span class="lineno"></span><span class="comment" id="6168867">//&nbsp;the&nbsp;syslog&nbsp;client&nbsp;will&nbsp;attempt&nbsp;to&nbsp;reconnect&nbsp;to&nbsp;the&nbsp;server</span><br>
<span class="lineno"></span><span class="comment" id="6168928">//&nbsp;and&nbsp;write&nbsp;again.</span><br>
<span class="lineno"></span><span class="keyword" id="6168948">package</span>&nbsp;<span class="ident" id="6168956">syslog</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="6168964">import</span>&nbsp;<span class="op" id="6168971">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6168974">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6168984">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6168991">&#34;log&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6168998">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6169005">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6169011">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6169022">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6169030">&#34;time&#34;</span><br>
<span class="lineno">25</span><span class="op" id="6169037">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6169040">//&nbsp;The&nbsp;Priority&nbsp;is&nbsp;a&nbsp;combination&nbsp;of&nbsp;the&nbsp;syslog&nbsp;facility&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="6169100">//&nbsp;severity.&nbsp;For&nbsp;example,&nbsp;LOG_ALERT&nbsp;|&nbsp;LOG_FTP&nbsp;sends&nbsp;an&nbsp;alert&nbsp;severity</span><br>
<span class="lineno"></span><span class="comment" id="6169170">//&nbsp;message&nbsp;from&nbsp;the&nbsp;FTP&nbsp;facility.&nbsp;The&nbsp;default&nbsp;severity&nbsp;is&nbsp;LOG_EMERG;</span><br>
<span class="lineno">30</span><span class="comment" id="6169239">//&nbsp;the&nbsp;default&nbsp;facility&nbsp;is&nbsp;LOG_KERN.</span><br>
<span class="lineno"></span><span class="keyword" id="6169276">type</span>&nbsp;<span class="ident" id="6169281">Priority</span>&nbsp;<span class="builtintype" id="6169290">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6169295">const</span>&nbsp;<span class="ident" id="6169301">severityMask</span>&nbsp;<span class="op" id="6169314">=</span>&nbsp;<span class="num" id="6169316">0x07</span><br>
<span class="lineno"></span><span class="keyword" id="6169321">const</span>&nbsp;<span class="ident" id="6169327">facilityMask</span>&nbsp;<span class="op" id="6169340">=</span>&nbsp;<span class="num" id="6169342">0xf8</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="6169348">const</span>&nbsp;<span class="op" id="6169354">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6169357">//&nbsp;Severity.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6169372">//&nbsp;From&nbsp;/usr/include/sys/syslog.h.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6169408">//&nbsp;These&nbsp;are&nbsp;the&nbsp;same&nbsp;on&nbsp;Linux,&nbsp;BSD,&nbsp;and&nbsp;OS&nbsp;X.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6169456">LOG_EMERG</span>&nbsp;<span class="ident" id="6169466">Priority</span>&nbsp;<span class="op" id="6169475">=</span>&nbsp;<span class="ident" id="6169477">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6169483">LOG_ALERT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6169494">LOG_CRIT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6169504">LOG_ERR</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6169513">LOG_WARNING</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6169526">LOG_NOTICE</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6169538">LOG_INFO</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6169548">LOG_DEBUG</span><br>
<span class="lineno"></span><span class="op" id="6169558">)</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="6169561">const</span>&nbsp;<span class="op" id="6169567">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6169570">//&nbsp;Facility.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6169585">//&nbsp;From&nbsp;/usr/include/sys/syslog.h.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6169621">//&nbsp;These&nbsp;are&nbsp;the&nbsp;same&nbsp;up&nbsp;to&nbsp;LOG_FTP&nbsp;on&nbsp;Linux,&nbsp;BSD,&nbsp;and&nbsp;OS&nbsp;X.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6169683">LOG_KERN</span>&nbsp;<span class="ident" id="6169692">Priority</span>&nbsp;<span class="op" id="6169701">=</span>&nbsp;<span class="ident" id="6169703">iota</span>&nbsp;<span class="op" id="6169708">&lt;&lt;</span>&nbsp;<span class="num" id="6169711">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6169714">LOG_USER</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6169724">LOG_MAIL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6169734">LOG_DAEMON</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6169746">LOG_AUTH</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6169756">LOG_SYSLOG</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6169768">LOG_LPR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6169777">LOG_NEWS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6169787">LOG_UUCP</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6169797">LOG_CRON</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6169807">LOG_AUTHPRIV</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6169821">LOG_FTP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6169830">_</span>&nbsp;<span class="comment" id="6169832">//&nbsp;unused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6169843">_</span>&nbsp;<span class="comment" id="6169845">//&nbsp;unused</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6169856">_</span>&nbsp;<span class="comment" id="6169858">//&nbsp;unused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6169869">_</span>&nbsp;<span class="comment" id="6169871">//&nbsp;unused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6169882">LOG_LOCAL0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6169894">LOG_LOCAL1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6169906">LOG_LOCAL2</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6169918">LOG_LOCAL3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6169930">LOG_LOCAL4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6169942">LOG_LOCAL5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6169954">LOG_LOCAL6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6169966">LOG_LOCAL7</span><br>
<span class="lineno">80</span><span class="op" id="6169977">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6169980">//&nbsp;A&nbsp;Writer&nbsp;is&nbsp;a&nbsp;connection&nbsp;to&nbsp;a&nbsp;syslog&nbsp;server.</span><br>
<span class="lineno"></span><span class="keyword" id="6170028">type</span>&nbsp;<span class="ident" id="6170033">Writer</span>&nbsp;<span class="keyword" id="6170040">struct</span>&nbsp;<span class="op" id="6170047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6170050">priority</span>&nbsp;<span class="ident" id="6170059">Priority</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6170069">tag</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6170078">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6170086">hostname</span>&nbsp;<span class="builtintype" id="6170095">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6170103">network</span>&nbsp;&nbsp;<span class="builtintype" id="6170112">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6170120">raddr</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6170129">string</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6170138">mu</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6170143">sync</span><span class="op" id="6170147">.</span><span class="ident" id="6170148">Mutex</span>&nbsp;<span class="comment" id="6170154">//&nbsp;guards&nbsp;conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6170170">conn</span>&nbsp;<span class="ident" id="6170175">serverConn</span><br>
<span class="lineno"></span><span class="op" id="6170186">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6170189">//&nbsp;This&nbsp;interface&nbsp;and&nbsp;the&nbsp;separate&nbsp;syslog_unix.go&nbsp;file&nbsp;exist&nbsp;for</span><br>
<span class="lineno">95</span><span class="comment" id="6170254">//&nbsp;Solaris&nbsp;support&nbsp;as&nbsp;implemented&nbsp;by&nbsp;gccgo.&nbsp;&nbsp;On&nbsp;Solaris&nbsp;you&nbsp;can&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="6170322">//&nbsp;simply&nbsp;open&nbsp;a&nbsp;TCP&nbsp;connection&nbsp;to&nbsp;the&nbsp;syslog&nbsp;daemon.&nbsp;&nbsp;The&nbsp;gccgo</span><br>
<span class="lineno"></span><span class="comment" id="6170387">//&nbsp;sources&nbsp;have&nbsp;a&nbsp;syslog_solaris.go&nbsp;file&nbsp;that&nbsp;implements&nbsp;unixSyslog&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="6170458">//&nbsp;return&nbsp;a&nbsp;type&nbsp;that&nbsp;satisfies&nbsp;this&nbsp;interface&nbsp;and&nbsp;simply&nbsp;calls&nbsp;the&nbsp;C</span><br>
<span class="lineno"></span><span class="comment" id="6170528">//&nbsp;library&nbsp;syslog&nbsp;function.</span><br>
<span class="lineno">100</span><span class="keyword" id="6170556">type</span>&nbsp;<span class="ident" id="6170561">serverConn</span>&nbsp;<span class="keyword" id="6170572">interface</span>&nbsp;<span class="op" id="6170582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6170585">writeString</span><span class="op" id="6170596">(</span><span class="ident" id="6170597">p</span>&nbsp;<span class="ident" id="6170599">Priority</span><span class="op" id="6170607">,</span>&nbsp;<span class="ident" id="6170609">hostname</span><span class="op" id="6170617">,</span>&nbsp;<span class="ident" id="6170619">tag</span><span class="op" id="6170622">,</span>&nbsp;<span class="ident" id="6170624">s</span><span class="op" id="6170625">,</span>&nbsp;<span class="ident" id="6170627">nl</span>&nbsp;<span class="builtintype" id="6170630">string</span><span class="op" id="6170636">)</span>&nbsp;<span class="builtintype" id="6170638">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6170645">close</span><span class="op" id="6170650">(</span><span class="op" id="6170651">)</span>&nbsp;<span class="builtintype" id="6170653">error</span><br>
<span class="lineno"></span><span class="op" id="6170659">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="keyword" id="6170662">type</span>&nbsp;<span class="ident" id="6170667">netConn</span>&nbsp;<span class="keyword" id="6170675">struct</span>&nbsp;<span class="op" id="6170682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6170685">local</span>&nbsp;<span class="builtintype" id="6170691">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6170697">conn</span>&nbsp;&nbsp;<span class="ident" id="6170703">net</span><span class="op" id="6170706">.</span><span class="ident" id="6170707">Conn</span><br>
<span class="lineno"></span><span class="op" id="6170712">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="6170715">//&nbsp;New&nbsp;establishes&nbsp;a&nbsp;new&nbsp;connection&nbsp;to&nbsp;the&nbsp;system&nbsp;log&nbsp;daemon.&nbsp;&nbsp;Each</span><br>
<span class="lineno"></span><span class="comment" id="6170783">//&nbsp;write&nbsp;to&nbsp;the&nbsp;returned&nbsp;writer&nbsp;sends&nbsp;a&nbsp;log&nbsp;message&nbsp;with&nbsp;the&nbsp;given</span><br>
<span class="lineno"></span><span class="comment" id="6170850">//&nbsp;priority&nbsp;and&nbsp;prefix.</span><br>
<span class="lineno"></span><span class="keyword" id="6170874">func</span>&nbsp;<span class="ident" id="6170879">New</span><span class="op" id="6170882">(</span><span class="ident" id="6170883">priority</span>&nbsp;<span class="ident" id="6170892">Priority</span><span class="op" id="6170900">,</span>&nbsp;<span class="ident" id="6170902">tag</span>&nbsp;<span class="builtintype" id="6170906">string</span><span class="op" id="6170912">)</span>&nbsp;<span class="op" id="6170914">(</span><span class="ident" id="6170915">w</span>&nbsp;<span class="op" id="6170917">*</span><span class="ident" id="6170918">Writer</span><span class="op" id="6170924">,</span>&nbsp;<span class="ident" id="6170926">err</span>&nbsp;<span class="builtintype" id="6170930">error</span><span class="op" id="6170935">)</span>&nbsp;<span class="op" id="6170937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6170940">return</span>&nbsp;<span class="ident" id="6170947">Dial</span><span class="op" id="6170951">(</span><span class="string" id="6170952">&#34;&#34;</span><span class="op" id="6170954">,</span>&nbsp;<span class="string" id="6170956">&#34;&#34;</span><span class="op" id="6170958">,</span>&nbsp;<span class="ident" id="6170960">priority</span><span class="op" id="6170968">,</span>&nbsp;<span class="ident" id="6170970">tag</span><span class="op" id="6170973">)</span><br>
<span class="lineno">115</span><span class="op" id="6170975">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6170978">//&nbsp;Dial&nbsp;establishes&nbsp;a&nbsp;connection&nbsp;to&nbsp;a&nbsp;log&nbsp;daemon&nbsp;by&nbsp;connecting&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="6171044">//&nbsp;address&nbsp;raddr&nbsp;on&nbsp;the&nbsp;specified&nbsp;network.&nbsp;&nbsp;Each&nbsp;write&nbsp;to&nbsp;the&nbsp;returned</span><br>
<span class="lineno"></span><span class="comment" id="6171115">//&nbsp;writer&nbsp;sends&nbsp;a&nbsp;log&nbsp;message&nbsp;with&nbsp;the&nbsp;given&nbsp;facility,&nbsp;severity&nbsp;and</span><br>
<span class="lineno">120</span><span class="comment" id="6171183">//&nbsp;tag.</span><br>
<span class="lineno"></span><span class="comment" id="6171191">//&nbsp;If&nbsp;network&nbsp;is&nbsp;empty,&nbsp;Dial&nbsp;will&nbsp;connect&nbsp;to&nbsp;the&nbsp;local&nbsp;syslog&nbsp;server.</span><br>
<span class="lineno"></span><span class="keyword" id="6171261">func</span>&nbsp;<span class="ident" id="6171266">Dial</span><span class="op" id="6171270">(</span><span class="ident" id="6171271">network</span><span class="op" id="6171278">,</span>&nbsp;<span class="ident" id="6171280">raddr</span>&nbsp;<span class="builtintype" id="6171286">string</span><span class="op" id="6171292">,</span>&nbsp;<span class="ident" id="6171294">priority</span>&nbsp;<span class="ident" id="6171303">Priority</span><span class="op" id="6171311">,</span>&nbsp;<span class="ident" id="6171313">tag</span>&nbsp;<span class="builtintype" id="6171317">string</span><span class="op" id="6171323">)</span>&nbsp;<span class="op" id="6171325">(</span><span class="op" id="6171326">*</span><span class="ident" id="6171327">Writer</span><span class="op" id="6171333">,</span>&nbsp;<span class="builtintype" id="6171335">error</span><span class="op" id="6171340">)</span>&nbsp;<span class="op" id="6171342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6171345">if</span>&nbsp;<span class="ident" id="6171348">priority</span>&nbsp;<span class="op" id="6171357">&lt;</span>&nbsp;<span class="num" id="6171359">0</span>&nbsp;<span class="op" id="6171361">||</span>&nbsp;<span class="ident" id="6171364">priority</span>&nbsp;<span class="op" id="6171373">&gt;</span>&nbsp;<span class="ident" id="6171375">LOG_LOCAL7</span><span class="op" id="6171385">|</span><span class="ident" id="6171386">LOG_DEBUG</span>&nbsp;<span class="op" id="6171396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6171400">return</span>&nbsp;<span class="ident" id="6171407">nil</span><span class="op" id="6171410">,</span>&nbsp;<span class="ident" id="6171412">errors</span><span class="op" id="6171418">.</span><span class="ident" id="6171419">New</span><span class="op" id="6171422">(</span><span class="string" id="6171423">&#34;log/syslog:&nbsp;invalid&nbsp;priority&#34;</span><span class="op" id="6171453">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6171456">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6171460">if</span>&nbsp;<span class="ident" id="6171463">tag</span>&nbsp;<span class="op" id="6171467">==</span>&nbsp;<span class="string" id="6171470">&#34;&#34;</span>&nbsp;<span class="op" id="6171473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6171477">tag</span>&nbsp;<span class="op" id="6171481">=</span>&nbsp;<span class="ident" id="6171483">os</span><span class="op" id="6171485">.</span><span class="ident" id="6171486">Args</span><span class="op" id="6171490">[</span><span class="num" id="6171491">0</span><span class="op" id="6171492">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6171495">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6171498">hostname</span><span class="op" id="6171506">,</span>&nbsp;<span class="ident" id="6171508">_</span>&nbsp;<span class="op" id="6171510">:=</span>&nbsp;<span class="ident" id="6171513">os</span><span class="op" id="6171515">.</span><span class="ident" id="6171516">Hostname</span><span class="op" id="6171524">(</span><span class="op" id="6171525">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6171529">w</span>&nbsp;<span class="op" id="6171531">:=</span>&nbsp;<span class="op" id="6171534">&amp;</span><span class="ident" id="6171535">Writer</span><span class="op" id="6171541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6171545">priority</span><span class="op" id="6171553">:</span>&nbsp;<span class="ident" id="6171555">priority</span><span class="op" id="6171563">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6171567">tag</span><span class="op" id="6171570">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6171577">tag</span><span class="op" id="6171580">,</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6171584">hostname</span><span class="op" id="6171592">:</span>&nbsp;<span class="ident" id="6171594">hostname</span><span class="op" id="6171602">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6171606">network</span><span class="op" id="6171613">:</span>&nbsp;&nbsp;<span class="ident" id="6171616">network</span><span class="op" id="6171623">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6171627">raddr</span><span class="op" id="6171632">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6171637">raddr</span><span class="op" id="6171642">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6171645">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6171649">w</span><span class="op" id="6171650">.</span><span class="ident" id="6171651">mu</span><span class="op" id="6171653">.</span><span class="ident" id="6171654">Lock</span><span class="op" id="6171658">(</span><span class="op" id="6171659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6171662">defer</span>&nbsp;<span class="ident" id="6171668">w</span><span class="op" id="6171669">.</span><span class="ident" id="6171670">mu</span><span class="op" id="6171672">.</span><span class="ident" id="6171673">Unlock</span><span class="op" id="6171679">(</span><span class="op" id="6171680">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6171684">err</span>&nbsp;<span class="op" id="6171688">:=</span>&nbsp;<span class="ident" id="6171691">w</span><span class="op" id="6171692">.</span><span class="ident" id="6171693">connect</span><span class="op" id="6171700">(</span><span class="op" id="6171701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6171704">if</span>&nbsp;<span class="ident" id="6171707">err</span>&nbsp;<span class="op" id="6171711">!=</span>&nbsp;<span class="ident" id="6171714">nil</span>&nbsp;<span class="op" id="6171718">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6171722">return</span>&nbsp;<span class="ident" id="6171729">nil</span><span class="op" id="6171732">,</span>&nbsp;<span class="ident" id="6171734">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6171739">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6171742">return</span>&nbsp;<span class="ident" id="6171749">w</span><span class="op" id="6171750">,</span>&nbsp;<span class="ident" id="6171752">err</span><br>
<span class="lineno"></span><span class="op" id="6171756">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span><span class="comment" id="6171759">//&nbsp;connect&nbsp;makes&nbsp;a&nbsp;connection&nbsp;to&nbsp;the&nbsp;syslog&nbsp;server.</span><br>
<span class="lineno"></span><span class="comment" id="6171811">//&nbsp;It&nbsp;must&nbsp;be&nbsp;called&nbsp;with&nbsp;w.mu&nbsp;held.</span><br>
<span class="lineno"></span><span class="keyword" id="6171848">func</span>&nbsp;<span class="op" id="6171853">(</span><span class="ident" id="6171854">w</span>&nbsp;<span class="op" id="6171856">*</span><span class="ident" id="6171857">Writer</span><span class="op" id="6171863">)</span>&nbsp;<span class="ident" id="6171865">connect</span><span class="op" id="6171872">(</span><span class="op" id="6171873">)</span>&nbsp;<span class="op" id="6171875">(</span><span class="ident" id="6171876">err</span>&nbsp;<span class="builtintype" id="6171880">error</span><span class="op" id="6171885">)</span>&nbsp;<span class="op" id="6171887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6171890">if</span>&nbsp;<span class="ident" id="6171893">w</span><span class="op" id="6171894">.</span><span class="ident" id="6171895">conn</span>&nbsp;<span class="op" id="6171900">!=</span>&nbsp;<span class="ident" id="6171903">nil</span>&nbsp;<span class="op" id="6171907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6171911">//&nbsp;ignore&nbsp;err&nbsp;from&nbsp;close,&nbsp;it&nbsp;makes&nbsp;sense&nbsp;to&nbsp;continue&nbsp;anyway</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6171973">w</span><span class="op" id="6171974">.</span><span class="ident" id="6171975">conn</span><span class="op" id="6171979">.</span><span class="builtinfunc" id="6171980">close</span><span class="op" id="6171985">(</span><span class="op" id="6171986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6171990">w</span><span class="op" id="6171991">.</span><span class="ident" id="6171992">conn</span>&nbsp;<span class="op" id="6171997">=</span>&nbsp;<span class="ident" id="6171999">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6172004">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6172008">if</span>&nbsp;<span class="ident" id="6172011">w</span><span class="op" id="6172012">.</span><span class="ident" id="6172013">network</span>&nbsp;<span class="op" id="6172021">==</span>&nbsp;<span class="string" id="6172024">&#34;&#34;</span>&nbsp;<span class="op" id="6172027">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6172031">w</span><span class="op" id="6172032">.</span><span class="ident" id="6172033">conn</span><span class="op" id="6172037">,</span>&nbsp;<span class="ident" id="6172039">err</span>&nbsp;<span class="op" id="6172043">=</span>&nbsp;<span class="ident" id="6172045">unixSyslog</span><span class="op" id="6172055">(</span><span class="op" id="6172056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6172060">if</span>&nbsp;<span class="ident" id="6172063">w</span><span class="op" id="6172064">.</span><span class="ident" id="6172065">hostname</span>&nbsp;<span class="op" id="6172074">==</span>&nbsp;<span class="string" id="6172077">&#34;&#34;</span>&nbsp;<span class="op" id="6172080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6172085">w</span><span class="op" id="6172086">.</span><span class="ident" id="6172087">hostname</span>&nbsp;<span class="op" id="6172096">=</span>&nbsp;<span class="string" id="6172098">&#34;localhost&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6172112">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6172115">}</span>&nbsp;<span class="keyword" id="6172117">else</span>&nbsp;<span class="op" id="6172122">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6172126">var</span>&nbsp;<span class="ident" id="6172130">c</span>&nbsp;<span class="ident" id="6172132">net</span><span class="op" id="6172135">.</span><span class="ident" id="6172136">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6172143">c</span><span class="op" id="6172144">,</span>&nbsp;<span class="ident" id="6172146">err</span>&nbsp;<span class="op" id="6172150">=</span>&nbsp;<span class="ident" id="6172152">net</span><span class="op" id="6172155">.</span><span class="ident" id="6172156">Dial</span><span class="op" id="6172160">(</span><span class="ident" id="6172161">w</span><span class="op" id="6172162">.</span><span class="ident" id="6172163">network</span><span class="op" id="6172170">,</span>&nbsp;<span class="ident" id="6172172">w</span><span class="op" id="6172173">.</span><span class="ident" id="6172174">raddr</span><span class="op" id="6172179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6172183">if</span>&nbsp;<span class="ident" id="6172186">err</span>&nbsp;<span class="op" id="6172190">==</span>&nbsp;<span class="ident" id="6172193">nil</span>&nbsp;<span class="op" id="6172197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6172202">w</span><span class="op" id="6172203">.</span><span class="ident" id="6172204">conn</span>&nbsp;<span class="op" id="6172209">=</span>&nbsp;<span class="op" id="6172211">&amp;</span><span class="ident" id="6172212">netConn</span><span class="op" id="6172219">{</span><span class="ident" id="6172220">conn</span><span class="op" id="6172224">:</span>&nbsp;<span class="ident" id="6172226">c</span><span class="op" id="6172227">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6172232">if</span>&nbsp;<span class="ident" id="6172235">w</span><span class="op" id="6172236">.</span><span class="ident" id="6172237">hostname</span>&nbsp;<span class="op" id="6172246">==</span>&nbsp;<span class="string" id="6172249">&#34;&#34;</span>&nbsp;<span class="op" id="6172252">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6172258">w</span><span class="op" id="6172259">.</span><span class="ident" id="6172260">hostname</span>&nbsp;<span class="op" id="6172269">=</span>&nbsp;<span class="ident" id="6172271">c</span><span class="op" id="6172272">.</span><span class="ident" id="6172273">LocalAddr</span><span class="op" id="6172282">(</span><span class="op" id="6172283">)</span><span class="op" id="6172284">.</span><span class="ident" id="6172285">String</span><span class="op" id="6172291">(</span><span class="op" id="6172292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6172297">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6172301">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6172304">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6172307">return</span><br>
<span class="lineno">175</span><span class="op" id="6172314">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6172317">//&nbsp;Write&nbsp;sends&nbsp;a&nbsp;log&nbsp;message&nbsp;to&nbsp;the&nbsp;syslog&nbsp;daemon.</span><br>
<span class="lineno"></span><span class="keyword" id="6172368">func</span>&nbsp;<span class="op" id="6172373">(</span><span class="ident" id="6172374">w</span>&nbsp;<span class="op" id="6172376">*</span><span class="ident" id="6172377">Writer</span><span class="op" id="6172383">)</span>&nbsp;<span class="ident" id="6172385">Write</span><span class="op" id="6172390">(</span><span class="ident" id="6172391">b</span>&nbsp;<span class="op" id="6172393">[</span><span class="op" id="6172394">]</span><span class="builtintype" id="6172395">byte</span><span class="op" id="6172399">)</span>&nbsp;<span class="op" id="6172401">(</span><span class="builtintype" id="6172402">int</span><span class="op" id="6172405">,</span>&nbsp;<span class="builtintype" id="6172407">error</span><span class="op" id="6172412">)</span>&nbsp;<span class="op" id="6172414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6172417">return</span>&nbsp;<span class="ident" id="6172424">w</span><span class="op" id="6172425">.</span><span class="ident" id="6172426">writeAndRetry</span><span class="op" id="6172439">(</span><span class="ident" id="6172440">w</span><span class="op" id="6172441">.</span><span class="ident" id="6172442">priority</span><span class="op" id="6172450">,</span>&nbsp;<span class="builtintype" id="6172452">string</span><span class="op" id="6172458">(</span><span class="ident" id="6172459">b</span><span class="op" id="6172460">)</span><span class="op" id="6172461">)</span><br>
<span class="lineno">180</span><span class="op" id="6172463">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6172466">//&nbsp;Close&nbsp;closes&nbsp;a&nbsp;connection&nbsp;to&nbsp;the&nbsp;syslog&nbsp;daemon.</span><br>
<span class="lineno"></span><span class="keyword" id="6172517">func</span>&nbsp;<span class="op" id="6172522">(</span><span class="ident" id="6172523">w</span>&nbsp;<span class="op" id="6172525">*</span><span class="ident" id="6172526">Writer</span><span class="op" id="6172532">)</span>&nbsp;<span class="ident" id="6172534">Close</span><span class="op" id="6172539">(</span><span class="op" id="6172540">)</span>&nbsp;<span class="builtintype" id="6172542">error</span>&nbsp;<span class="op" id="6172548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6172551">w</span><span class="op" id="6172552">.</span><span class="ident" id="6172553">mu</span><span class="op" id="6172555">.</span><span class="ident" id="6172556">Lock</span><span class="op" id="6172560">(</span><span class="op" id="6172561">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6172564">defer</span>&nbsp;<span class="ident" id="6172570">w</span><span class="op" id="6172571">.</span><span class="ident" id="6172572">mu</span><span class="op" id="6172574">.</span><span class="ident" id="6172575">Unlock</span><span class="op" id="6172581">(</span><span class="op" id="6172582">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6172586">if</span>&nbsp;<span class="ident" id="6172589">w</span><span class="op" id="6172590">.</span><span class="ident" id="6172591">conn</span>&nbsp;<span class="op" id="6172596">!=</span>&nbsp;<span class="ident" id="6172599">nil</span>&nbsp;<span class="op" id="6172603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6172607">err</span>&nbsp;<span class="op" id="6172611">:=</span>&nbsp;<span class="ident" id="6172614">w</span><span class="op" id="6172615">.</span><span class="ident" id="6172616">conn</span><span class="op" id="6172620">.</span><span class="builtinfunc" id="6172621">close</span><span class="op" id="6172626">(</span><span class="op" id="6172627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6172631">w</span><span class="op" id="6172632">.</span><span class="ident" id="6172633">conn</span>&nbsp;<span class="op" id="6172638">=</span>&nbsp;<span class="ident" id="6172640">nil</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6172646">return</span>&nbsp;<span class="ident" id="6172653">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6172658">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6172661">return</span>&nbsp;<span class="ident" id="6172668">nil</span><br>
<span class="lineno"></span><span class="op" id="6172672">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span><span class="comment" id="6172675">//&nbsp;Emerg&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_EMERG,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno"></span><span class="comment" id="6172746">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="6172764">func</span>&nbsp;<span class="op" id="6172769">(</span><span class="ident" id="6172770">w</span>&nbsp;<span class="op" id="6172772">*</span><span class="ident" id="6172773">Writer</span><span class="op" id="6172779">)</span>&nbsp;<span class="ident" id="6172781">Emerg</span><span class="op" id="6172786">(</span><span class="ident" id="6172787">m</span>&nbsp;<span class="builtintype" id="6172789">string</span><span class="op" id="6172795">)</span>&nbsp;<span class="op" id="6172797">(</span><span class="ident" id="6172798">err</span>&nbsp;<span class="builtintype" id="6172802">error</span><span class="op" id="6172807">)</span>&nbsp;<span class="op" id="6172809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6172812">_</span><span class="op" id="6172813">,</span>&nbsp;<span class="ident" id="6172815">err</span>&nbsp;<span class="op" id="6172819">=</span>&nbsp;<span class="ident" id="6172821">w</span><span class="op" id="6172822">.</span><span class="ident" id="6172823">writeAndRetry</span><span class="op" id="6172836">(</span><span class="ident" id="6172837">LOG_EMERG</span><span class="op" id="6172846">,</span>&nbsp;<span class="ident" id="6172848">m</span><span class="op" id="6172849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6172852">return</span>&nbsp;<span class="ident" id="6172859">err</span><br>
<span class="lineno">200</span><span class="op" id="6172863">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6172866">//&nbsp;Alert&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_ALERT,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno"></span><span class="comment" id="6172937">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="6172955">func</span>&nbsp;<span class="op" id="6172960">(</span><span class="ident" id="6172961">w</span>&nbsp;<span class="op" id="6172963">*</span><span class="ident" id="6172964">Writer</span><span class="op" id="6172970">)</span>&nbsp;<span class="ident" id="6172972">Alert</span><span class="op" id="6172977">(</span><span class="ident" id="6172978">m</span>&nbsp;<span class="builtintype" id="6172980">string</span><span class="op" id="6172986">)</span>&nbsp;<span class="op" id="6172988">(</span><span class="ident" id="6172989">err</span>&nbsp;<span class="builtintype" id="6172993">error</span><span class="op" id="6172998">)</span>&nbsp;<span class="op" id="6173000">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6173003">_</span><span class="op" id="6173004">,</span>&nbsp;<span class="ident" id="6173006">err</span>&nbsp;<span class="op" id="6173010">=</span>&nbsp;<span class="ident" id="6173012">w</span><span class="op" id="6173013">.</span><span class="ident" id="6173014">writeAndRetry</span><span class="op" id="6173027">(</span><span class="ident" id="6173028">LOG_ALERT</span><span class="op" id="6173037">,</span>&nbsp;<span class="ident" id="6173039">m</span><span class="op" id="6173040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6173043">return</span>&nbsp;<span class="ident" id="6173050">err</span><br>
<span class="lineno"></span><span class="op" id="6173054">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6173057">//&nbsp;Crit&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_CRIT,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno">210</span><span class="comment" id="6173126">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="6173144">func</span>&nbsp;<span class="op" id="6173149">(</span><span class="ident" id="6173150">w</span>&nbsp;<span class="op" id="6173152">*</span><span class="ident" id="6173153">Writer</span><span class="op" id="6173159">)</span>&nbsp;<span class="ident" id="6173161">Crit</span><span class="op" id="6173165">(</span><span class="ident" id="6173166">m</span>&nbsp;<span class="builtintype" id="6173168">string</span><span class="op" id="6173174">)</span>&nbsp;<span class="op" id="6173176">(</span><span class="ident" id="6173177">err</span>&nbsp;<span class="builtintype" id="6173181">error</span><span class="op" id="6173186">)</span>&nbsp;<span class="op" id="6173188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6173191">_</span><span class="op" id="6173192">,</span>&nbsp;<span class="ident" id="6173194">err</span>&nbsp;<span class="op" id="6173198">=</span>&nbsp;<span class="ident" id="6173200">w</span><span class="op" id="6173201">.</span><span class="ident" id="6173202">writeAndRetry</span><span class="op" id="6173215">(</span><span class="ident" id="6173216">LOG_CRIT</span><span class="op" id="6173224">,</span>&nbsp;<span class="ident" id="6173226">m</span><span class="op" id="6173227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6173230">return</span>&nbsp;<span class="ident" id="6173237">err</span><br>
<span class="lineno"></span><span class="op" id="6173241">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span><span class="comment" id="6173244">//&nbsp;Err&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_ERR,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno"></span><span class="comment" id="6173311">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="6173329">func</span>&nbsp;<span class="op" id="6173334">(</span><span class="ident" id="6173335">w</span>&nbsp;<span class="op" id="6173337">*</span><span class="ident" id="6173338">Writer</span><span class="op" id="6173344">)</span>&nbsp;<span class="ident" id="6173346">Err</span><span class="op" id="6173349">(</span><span class="ident" id="6173350">m</span>&nbsp;<span class="builtintype" id="6173352">string</span><span class="op" id="6173358">)</span>&nbsp;<span class="op" id="6173360">(</span><span class="ident" id="6173361">err</span>&nbsp;<span class="builtintype" id="6173365">error</span><span class="op" id="6173370">)</span>&nbsp;<span class="op" id="6173372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6173375">_</span><span class="op" id="6173376">,</span>&nbsp;<span class="ident" id="6173378">err</span>&nbsp;<span class="op" id="6173382">=</span>&nbsp;<span class="ident" id="6173384">w</span><span class="op" id="6173385">.</span><span class="ident" id="6173386">writeAndRetry</span><span class="op" id="6173399">(</span><span class="ident" id="6173400">LOG_ERR</span><span class="op" id="6173407">,</span>&nbsp;<span class="ident" id="6173409">m</span><span class="op" id="6173410">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6173413">return</span>&nbsp;<span class="ident" id="6173420">err</span><br>
<span class="lineno"></span><span class="op" id="6173424">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6173427">//&nbsp;Warning&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_WARNING,&nbsp;ignoring&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6173493">//&nbsp;severity&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno">225</span><span class="keyword" id="6173520">func</span>&nbsp;<span class="op" id="6173525">(</span><span class="ident" id="6173526">w</span>&nbsp;<span class="op" id="6173528">*</span><span class="ident" id="6173529">Writer</span><span class="op" id="6173535">)</span>&nbsp;<span class="ident" id="6173537">Warning</span><span class="op" id="6173544">(</span><span class="ident" id="6173545">m</span>&nbsp;<span class="builtintype" id="6173547">string</span><span class="op" id="6173553">)</span>&nbsp;<span class="op" id="6173555">(</span><span class="ident" id="6173556">err</span>&nbsp;<span class="builtintype" id="6173560">error</span><span class="op" id="6173565">)</span>&nbsp;<span class="op" id="6173567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6173570">_</span><span class="op" id="6173571">,</span>&nbsp;<span class="ident" id="6173573">err</span>&nbsp;<span class="op" id="6173577">=</span>&nbsp;<span class="ident" id="6173579">w</span><span class="op" id="6173580">.</span><span class="ident" id="6173581">writeAndRetry</span><span class="op" id="6173594">(</span><span class="ident" id="6173595">LOG_WARNING</span><span class="op" id="6173606">,</span>&nbsp;<span class="ident" id="6173608">m</span><span class="op" id="6173609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6173612">return</span>&nbsp;<span class="ident" id="6173619">err</span><br>
<span class="lineno"></span><span class="op" id="6173623">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="comment" id="6173626">//&nbsp;Notice&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_NOTICE,&nbsp;ignoring&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6173690">//&nbsp;severity&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="6173717">func</span>&nbsp;<span class="op" id="6173722">(</span><span class="ident" id="6173723">w</span>&nbsp;<span class="op" id="6173725">*</span><span class="ident" id="6173726">Writer</span><span class="op" id="6173732">)</span>&nbsp;<span class="ident" id="6173734">Notice</span><span class="op" id="6173740">(</span><span class="ident" id="6173741">m</span>&nbsp;<span class="builtintype" id="6173743">string</span><span class="op" id="6173749">)</span>&nbsp;<span class="op" id="6173751">(</span><span class="ident" id="6173752">err</span>&nbsp;<span class="builtintype" id="6173756">error</span><span class="op" id="6173761">)</span>&nbsp;<span class="op" id="6173763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6173766">_</span><span class="op" id="6173767">,</span>&nbsp;<span class="ident" id="6173769">err</span>&nbsp;<span class="op" id="6173773">=</span>&nbsp;<span class="ident" id="6173775">w</span><span class="op" id="6173776">.</span><span class="ident" id="6173777">writeAndRetry</span><span class="op" id="6173790">(</span><span class="ident" id="6173791">LOG_NOTICE</span><span class="op" id="6173801">,</span>&nbsp;<span class="ident" id="6173803">m</span><span class="op" id="6173804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6173807">return</span>&nbsp;<span class="ident" id="6173814">err</span><br>
<span class="lineno">235</span><span class="op" id="6173818">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6173821">//&nbsp;Info&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_INFO,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno"></span><span class="comment" id="6173890">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="6173908">func</span>&nbsp;<span class="op" id="6173913">(</span><span class="ident" id="6173914">w</span>&nbsp;<span class="op" id="6173916">*</span><span class="ident" id="6173917">Writer</span><span class="op" id="6173923">)</span>&nbsp;<span class="ident" id="6173925">Info</span><span class="op" id="6173929">(</span><span class="ident" id="6173930">m</span>&nbsp;<span class="builtintype" id="6173932">string</span><span class="op" id="6173938">)</span>&nbsp;<span class="op" id="6173940">(</span><span class="ident" id="6173941">err</span>&nbsp;<span class="builtintype" id="6173945">error</span><span class="op" id="6173950">)</span>&nbsp;<span class="op" id="6173952">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6173955">_</span><span class="op" id="6173956">,</span>&nbsp;<span class="ident" id="6173958">err</span>&nbsp;<span class="op" id="6173962">=</span>&nbsp;<span class="ident" id="6173964">w</span><span class="op" id="6173965">.</span><span class="ident" id="6173966">writeAndRetry</span><span class="op" id="6173979">(</span><span class="ident" id="6173980">LOG_INFO</span><span class="op" id="6173988">,</span>&nbsp;<span class="ident" id="6173990">m</span><span class="op" id="6173991">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6173994">return</span>&nbsp;<span class="ident" id="6174001">err</span><br>
<span class="lineno"></span><span class="op" id="6174005">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6174008">//&nbsp;Debug&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_DEBUG,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno">245</span><span class="comment" id="6174079">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="6174097">func</span>&nbsp;<span class="op" id="6174102">(</span><span class="ident" id="6174103">w</span>&nbsp;<span class="op" id="6174105">*</span><span class="ident" id="6174106">Writer</span><span class="op" id="6174112">)</span>&nbsp;<span class="ident" id="6174114">Debug</span><span class="op" id="6174119">(</span><span class="ident" id="6174120">m</span>&nbsp;<span class="builtintype" id="6174122">string</span><span class="op" id="6174128">)</span>&nbsp;<span class="op" id="6174130">(</span><span class="ident" id="6174131">err</span>&nbsp;<span class="builtintype" id="6174135">error</span><span class="op" id="6174140">)</span>&nbsp;<span class="op" id="6174142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6174145">_</span><span class="op" id="6174146">,</span>&nbsp;<span class="ident" id="6174148">err</span>&nbsp;<span class="op" id="6174152">=</span>&nbsp;<span class="ident" id="6174154">w</span><span class="op" id="6174155">.</span><span class="ident" id="6174156">writeAndRetry</span><span class="op" id="6174169">(</span><span class="ident" id="6174170">LOG_DEBUG</span><span class="op" id="6174179">,</span>&nbsp;<span class="ident" id="6174181">m</span><span class="op" id="6174182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6174185">return</span>&nbsp;<span class="ident" id="6174192">err</span><br>
<span class="lineno"></span><span class="op" id="6174196">}</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span><span class="keyword" id="6174199">func</span>&nbsp;<span class="op" id="6174204">(</span><span class="ident" id="6174205">w</span>&nbsp;<span class="op" id="6174207">*</span><span class="ident" id="6174208">Writer</span><span class="op" id="6174214">)</span>&nbsp;<span class="ident" id="6174216">writeAndRetry</span><span class="op" id="6174229">(</span><span class="ident" id="6174230">p</span>&nbsp;<span class="ident" id="6174232">Priority</span><span class="op" id="6174240">,</span>&nbsp;<span class="ident" id="6174242">s</span>&nbsp;<span class="builtintype" id="6174244">string</span><span class="op" id="6174250">)</span>&nbsp;<span class="op" id="6174252">(</span><span class="builtintype" id="6174253">int</span><span class="op" id="6174256">,</span>&nbsp;<span class="builtintype" id="6174258">error</span><span class="op" id="6174263">)</span>&nbsp;<span class="op" id="6174265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6174268">pr</span>&nbsp;<span class="op" id="6174271">:=</span>&nbsp;<span class="op" id="6174274">(</span><span class="ident" id="6174275">w</span><span class="op" id="6174276">.</span><span class="ident" id="6174277">priority</span>&nbsp;<span class="op" id="6174286">&amp;</span>&nbsp;<span class="ident" id="6174288">facilityMask</span><span class="op" id="6174300">)</span>&nbsp;<span class="op" id="6174302">|</span>&nbsp;<span class="op" id="6174304">(</span><span class="ident" id="6174305">p</span>&nbsp;<span class="op" id="6174307">&amp;</span>&nbsp;<span class="ident" id="6174309">severityMask</span><span class="op" id="6174321">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6174325">w</span><span class="op" id="6174326">.</span><span class="ident" id="6174327">mu</span><span class="op" id="6174329">.</span><span class="ident" id="6174330">Lock</span><span class="op" id="6174334">(</span><span class="op" id="6174335">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6174338">defer</span>&nbsp;<span class="ident" id="6174344">w</span><span class="op" id="6174345">.</span><span class="ident" id="6174346">mu</span><span class="op" id="6174348">.</span><span class="ident" id="6174349">Unlock</span><span class="op" id="6174355">(</span><span class="op" id="6174356">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6174360">if</span>&nbsp;<span class="ident" id="6174363">w</span><span class="op" id="6174364">.</span><span class="ident" id="6174365">conn</span>&nbsp;<span class="op" id="6174370">!=</span>&nbsp;<span class="ident" id="6174373">nil</span>&nbsp;<span class="op" id="6174377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6174381">if</span>&nbsp;<span class="ident" id="6174384">n</span><span class="op" id="6174385">,</span>&nbsp;<span class="ident" id="6174387">err</span>&nbsp;<span class="op" id="6174391">:=</span>&nbsp;<span class="ident" id="6174394">w</span><span class="op" id="6174395">.</span><span class="ident" id="6174396">write</span><span class="op" id="6174401">(</span><span class="ident" id="6174402">pr</span><span class="op" id="6174404">,</span>&nbsp;<span class="ident" id="6174406">s</span><span class="op" id="6174407">)</span><span class="op" id="6174408">;</span>&nbsp;<span class="ident" id="6174410">err</span>&nbsp;<span class="op" id="6174414">==</span>&nbsp;<span class="ident" id="6174417">nil</span>&nbsp;<span class="op" id="6174421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6174426">return</span>&nbsp;<span class="ident" id="6174433">n</span><span class="op" id="6174434">,</span>&nbsp;<span class="ident" id="6174436">err</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6174442">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6174445">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6174448">if</span>&nbsp;<span class="ident" id="6174451">err</span>&nbsp;<span class="op" id="6174455">:=</span>&nbsp;<span class="ident" id="6174458">w</span><span class="op" id="6174459">.</span><span class="ident" id="6174460">connect</span><span class="op" id="6174467">(</span><span class="op" id="6174468">)</span><span class="op" id="6174469">;</span>&nbsp;<span class="ident" id="6174471">err</span>&nbsp;<span class="op" id="6174475">!=</span>&nbsp;<span class="ident" id="6174478">nil</span>&nbsp;<span class="op" id="6174482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6174486">return</span>&nbsp;<span class="num" id="6174493">0</span><span class="op" id="6174494">,</span>&nbsp;<span class="ident" id="6174496">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6174501">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6174504">return</span>&nbsp;<span class="ident" id="6174511">w</span><span class="op" id="6174512">.</span><span class="ident" id="6174513">write</span><span class="op" id="6174518">(</span><span class="ident" id="6174519">pr</span><span class="op" id="6174521">,</span>&nbsp;<span class="ident" id="6174523">s</span><span class="op" id="6174524">)</span><br>
<span class="lineno"></span><span class="op" id="6174526">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6174529">//&nbsp;write&nbsp;generates&nbsp;and&nbsp;writes&nbsp;a&nbsp;syslog&nbsp;formatted&nbsp;string.&nbsp;The</span><br>
<span class="lineno"></span><span class="comment" id="6174590">//&nbsp;format&nbsp;is&nbsp;as&nbsp;follows:&nbsp;&lt;PRI&gt;TIMESTAMP&nbsp;HOSTNAME&nbsp;TAG[PID]:&nbsp;MSG</span><br>
<span class="lineno">270</span><span class="keyword" id="6174653">func</span>&nbsp;<span class="op" id="6174658">(</span><span class="ident" id="6174659">w</span>&nbsp;<span class="op" id="6174661">*</span><span class="ident" id="6174662">Writer</span><span class="op" id="6174668">)</span>&nbsp;<span class="ident" id="6174670">write</span><span class="op" id="6174675">(</span><span class="ident" id="6174676">p</span>&nbsp;<span class="ident" id="6174678">Priority</span><span class="op" id="6174686">,</span>&nbsp;<span class="ident" id="6174688">msg</span>&nbsp;<span class="builtintype" id="6174692">string</span><span class="op" id="6174698">)</span>&nbsp;<span class="op" id="6174700">(</span><span class="builtintype" id="6174701">int</span><span class="op" id="6174704">,</span>&nbsp;<span class="builtintype" id="6174706">error</span><span class="op" id="6174711">)</span>&nbsp;<span class="op" id="6174713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6174716">//&nbsp;ensure&nbsp;it&nbsp;ends&nbsp;in&nbsp;a&nbsp;\n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6174743">nl</span>&nbsp;<span class="op" id="6174746">:=</span>&nbsp;<span class="string" id="6174749">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6174753">if</span>&nbsp;<span class="op" id="6174756">!</span><span class="ident" id="6174757">strings</span><span class="op" id="6174764">.</span><span class="ident" id="6174765">HasSuffix</span><span class="op" id="6174774">(</span><span class="ident" id="6174775">msg</span><span class="op" id="6174778">,</span>&nbsp;<span class="string" id="6174780">&#34;\n&#34;</span><span class="op" id="6174784">)</span>&nbsp;<span class="op" id="6174786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6174790">nl</span>&nbsp;<span class="op" id="6174793">=</span>&nbsp;<span class="string" id="6174795">&#34;\n&#34;</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6174801">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6174805">err</span>&nbsp;<span class="op" id="6174809">:=</span>&nbsp;<span class="ident" id="6174812">w</span><span class="op" id="6174813">.</span><span class="ident" id="6174814">conn</span><span class="op" id="6174818">.</span><span class="ident" id="6174819">writeString</span><span class="op" id="6174830">(</span><span class="ident" id="6174831">p</span><span class="op" id="6174832">,</span>&nbsp;<span class="ident" id="6174834">w</span><span class="op" id="6174835">.</span><span class="ident" id="6174836">hostname</span><span class="op" id="6174844">,</span>&nbsp;<span class="ident" id="6174846">w</span><span class="op" id="6174847">.</span><span class="ident" id="6174848">tag</span><span class="op" id="6174851">,</span>&nbsp;<span class="ident" id="6174853">msg</span><span class="op" id="6174856">,</span>&nbsp;<span class="ident" id="6174858">nl</span><span class="op" id="6174860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6174863">if</span>&nbsp;<span class="ident" id="6174866">err</span>&nbsp;<span class="op" id="6174870">!=</span>&nbsp;<span class="ident" id="6174873">nil</span>&nbsp;<span class="op" id="6174877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6174881">return</span>&nbsp;<span class="num" id="6174888">0</span><span class="op" id="6174889">,</span>&nbsp;<span class="ident" id="6174891">err</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6174896">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6174899">//&nbsp;Note:&nbsp;return&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;input,&nbsp;not&nbsp;the&nbsp;number&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6174959">//&nbsp;bytes&nbsp;printed&nbsp;by&nbsp;Fprintf,&nbsp;because&nbsp;this&nbsp;must&nbsp;behave&nbsp;like</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6175019">//&nbsp;an&nbsp;io.Writer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6175037">return</span>&nbsp;<span class="builtinfunc" id="6175044">len</span><span class="op" id="6175047">(</span><span class="ident" id="6175048">msg</span><span class="op" id="6175051">)</span><span class="op" id="6175052">,</span>&nbsp;<span class="ident" id="6175054">nil</span><br>
<span class="lineno">285</span><span class="op" id="6175058">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6175061">func</span>&nbsp;<span class="op" id="6175066">(</span><span class="ident" id="6175067">n</span>&nbsp;<span class="op" id="6175069">*</span><span class="ident" id="6175070">netConn</span><span class="op" id="6175077">)</span>&nbsp;<span class="ident" id="6175079">writeString</span><span class="op" id="6175090">(</span><span class="ident" id="6175091">p</span>&nbsp;<span class="ident" id="6175093">Priority</span><span class="op" id="6175101">,</span>&nbsp;<span class="ident" id="6175103">hostname</span><span class="op" id="6175111">,</span>&nbsp;<span class="ident" id="6175113">tag</span><span class="op" id="6175116">,</span>&nbsp;<span class="ident" id="6175118">msg</span><span class="op" id="6175121">,</span>&nbsp;<span class="ident" id="6175123">nl</span>&nbsp;<span class="builtintype" id="6175126">string</span><span class="op" id="6175132">)</span>&nbsp;<span class="builtintype" id="6175134">error</span>&nbsp;<span class="op" id="6175140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6175143">if</span>&nbsp;<span class="ident" id="6175146">n</span><span class="op" id="6175147">.</span><span class="ident" id="6175148">local</span>&nbsp;<span class="op" id="6175154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6175158">//&nbsp;Compared&nbsp;to&nbsp;the&nbsp;network&nbsp;form&nbsp;below,&nbsp;the&nbsp;changes&nbsp;are:</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6175216">//&nbsp;&nbsp;&nbsp;&nbsp1.&nbsp;Use&nbsp;time.Stamp&nbsp;instead&nbsp;of&nbsp;time.RFC3339.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6175264">//&nbsp;&nbsp;&nbsp;&nbsp2.&nbsp;Drop&nbsp;the&nbsp;hostname&nbsp;field&nbsp;from&nbsp;the&nbsp;Fprintf.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6175314">timestamp</span>&nbsp;<span class="op" id="6175324">:=</span>&nbsp;<span class="ident" id="6175327">time</span><span class="op" id="6175331">.</span><span class="ident" id="6175332">Now</span><span class="op" id="6175335">(</span><span class="op" id="6175336">)</span><span class="op" id="6175337">.</span><span class="ident" id="6175338">Format</span><span class="op" id="6175344">(</span><span class="ident" id="6175345">time</span><span class="op" id="6175349">.</span><span class="ident" id="6175350">Stamp</span><span class="op" id="6175355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6175359">_</span><span class="op" id="6175360">,</span>&nbsp;<span class="ident" id="6175362">err</span>&nbsp;<span class="op" id="6175366">:=</span>&nbsp;<span class="ident" id="6175369">fmt</span><span class="op" id="6175372">.</span><span class="ident" id="6175373">Fprintf</span><span class="op" id="6175380">(</span><span class="ident" id="6175381">n</span><span class="op" id="6175382">.</span><span class="ident" id="6175383">conn</span><span class="op" id="6175387">,</span>&nbsp;<span class="string" id="6175389">&#34;&lt;%d&gt;%s&nbsp;%s[%d]:&nbsp;%s%s&#34;</span><span class="op" id="6175410">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6175415">p</span><span class="op" id="6175416">,</span>&nbsp;<span class="ident" id="6175418">timestamp</span><span class="op" id="6175427">,</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6175432">tag</span><span class="op" id="6175435">,</span>&nbsp;<span class="ident" id="6175437">os</span><span class="op" id="6175439">.</span><span class="ident" id="6175440">Getpid</span><span class="op" id="6175446">(</span><span class="op" id="6175447">)</span><span class="op" id="6175448">,</span>&nbsp;<span class="ident" id="6175450">msg</span><span class="op" id="6175453">,</span>&nbsp;<span class="ident" id="6175455">nl</span><span class="op" id="6175457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6175461">return</span>&nbsp;<span class="ident" id="6175468">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6175473">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6175476">timestamp</span>&nbsp;<span class="op" id="6175486">:=</span>&nbsp;<span class="ident" id="6175489">time</span><span class="op" id="6175493">.</span><span class="ident" id="6175494">Now</span><span class="op" id="6175497">(</span><span class="op" id="6175498">)</span><span class="op" id="6175499">.</span><span class="ident" id="6175500">Format</span><span class="op" id="6175506">(</span><span class="ident" id="6175507">time</span><span class="op" id="6175511">.</span><span class="ident" id="6175512">RFC3339</span><span class="op" id="6175519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6175522">_</span><span class="op" id="6175523">,</span>&nbsp;<span class="ident" id="6175525">err</span>&nbsp;<span class="op" id="6175529">:=</span>&nbsp;<span class="ident" id="6175532">fmt</span><span class="op" id="6175535">.</span><span class="ident" id="6175536">Fprintf</span><span class="op" id="6175543">(</span><span class="ident" id="6175544">n</span><span class="op" id="6175545">.</span><span class="ident" id="6175546">conn</span><span class="op" id="6175550">,</span>&nbsp;<span class="string" id="6175552">&#34;&lt;%d&gt;%s&nbsp;%s&nbsp;%s[%d]:&nbsp;%s%s&#34;</span><span class="op" id="6175576">,</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6175580">p</span><span class="op" id="6175581">,</span>&nbsp;<span class="ident" id="6175583">timestamp</span><span class="op" id="6175592">,</span>&nbsp;<span class="ident" id="6175594">hostname</span><span class="op" id="6175602">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6175606">tag</span><span class="op" id="6175609">,</span>&nbsp;<span class="ident" id="6175611">os</span><span class="op" id="6175613">.</span><span class="ident" id="6175614">Getpid</span><span class="op" id="6175620">(</span><span class="op" id="6175621">)</span><span class="op" id="6175622">,</span>&nbsp;<span class="ident" id="6175624">msg</span><span class="op" id="6175627">,</span>&nbsp;<span class="ident" id="6175629">nl</span><span class="op" id="6175631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6175634">return</span>&nbsp;<span class="ident" id="6175641">err</span><br>
<span class="lineno"></span><span class="op" id="6175645">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span><span class="keyword" id="6175648">func</span>&nbsp;<span class="op" id="6175653">(</span><span class="ident" id="6175654">n</span>&nbsp;<span class="op" id="6175656">*</span><span class="ident" id="6175657">netConn</span><span class="op" id="6175664">)</span>&nbsp;<span class="builtinfunc" id="6175666">close</span><span class="op" id="6175671">(</span><span class="op" id="6175672">)</span>&nbsp;<span class="builtintype" id="6175674">error</span>&nbsp;<span class="op" id="6175680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6175683">return</span>&nbsp;<span class="ident" id="6175690">n</span><span class="op" id="6175691">.</span><span class="ident" id="6175692">conn</span><span class="op" id="6175696">.</span><span class="ident" id="6175697">Close</span><span class="op" id="6175702">(</span><span class="op" id="6175703">)</span><br>
<span class="lineno"></span><span class="op" id="6175705">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6175708">//&nbsp;NewLogger&nbsp;creates&nbsp;a&nbsp;log.Logger&nbsp;whose&nbsp;output&nbsp;is&nbsp;written&nbsp;to</span><br>
<span class="lineno">310</span><span class="comment" id="6175769">//&nbsp;the&nbsp;system&nbsp;log&nbsp;service&nbsp;with&nbsp;the&nbsp;specified&nbsp;priority.&nbsp;The&nbsp;logFlag</span><br>
<span class="lineno"></span><span class="comment" id="6175836">//&nbsp;argument&nbsp;is&nbsp;the&nbsp;flag&nbsp;set&nbsp;passed&nbsp;through&nbsp;to&nbsp;log.New&nbsp;to&nbsp;create</span><br>
<span class="lineno"></span><span class="comment" id="6175900">//&nbsp;the&nbsp;Logger.</span><br>
<span class="lineno"></span><span class="keyword" id="6175915">func</span>&nbsp;<span class="ident" id="6175920">NewLogger</span><span class="op" id="6175929">(</span><span class="ident" id="6175930">p</span>&nbsp;<span class="ident" id="6175932">Priority</span><span class="op" id="6175940">,</span>&nbsp;<span class="ident" id="6175942">logFlag</span>&nbsp;<span class="builtintype" id="6175950">int</span><span class="op" id="6175953">)</span>&nbsp;<span class="op" id="6175955">(</span><span class="op" id="6175956">*</span><span class="ident" id="6175957">log</span><span class="op" id="6175960">.</span><span class="ident" id="6175961">Logger</span><span class="op" id="6175967">,</span>&nbsp;<span class="builtintype" id="6175969">error</span><span class="op" id="6175974">)</span>&nbsp;<span class="op" id="6175976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6175979">s</span><span class="op" id="6175980">,</span>&nbsp;<span class="ident" id="6175982">err</span>&nbsp;<span class="op" id="6175986">:=</span>&nbsp;<span class="ident" id="6175989">New</span><span class="op" id="6175992">(</span><span class="ident" id="6175993">p</span><span class="op" id="6175994">,</span>&nbsp;<span class="string" id="6175996">&#34;&#34;</span><span class="op" id="6175998">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6176001">if</span>&nbsp;<span class="ident" id="6176004">err</span>&nbsp;<span class="op" id="6176008">!=</span>&nbsp;<span class="ident" id="6176011">nil</span>&nbsp;<span class="op" id="6176015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6176019">return</span>&nbsp;<span class="ident" id="6176026">nil</span><span class="op" id="6176029">,</span>&nbsp;<span class="ident" id="6176031">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6176036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6176039">return</span>&nbsp;<span class="ident" id="6176046">log</span><span class="op" id="6176049">.</span><span class="ident" id="6176050">New</span><span class="op" id="6176053">(</span><span class="ident" id="6176054">s</span><span class="op" id="6176055">,</span>&nbsp;<span class="string" id="6176057">&#34;&#34;</span><span class="op" id="6176059">,</span>&nbsp;<span class="ident" id="6176061">logFlag</span><span class="op" id="6176068">)</span><span class="op" id="6176069">,</span>&nbsp;<span class="ident" id="6176071">nil</span><br>
<span class="lineno"></span><span class="op" id="6176075">}</span>
</div>
</body>
</html>
