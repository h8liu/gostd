<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>html/template</h2>
<ul>
<li><a href="/gostd/html/template/attr.go.html">attr.go</a></li>
<li><a href="/gostd/html/template/clone_test.go.html">clone_test.go</a></li>
<li><a href="/gostd/html/template/content.go.html">content.go</a></li>
<li><a href="/gostd/html/template/content_test.go.html">content_test.go</a></li>
<li><a href="/gostd/html/template/context.go.html">context.go</a></li>
<li><a href="/gostd/html/template/css.go.html">css.go</a></li>
<li><a href="/gostd/html/template/css_test.go.html">css_test.go</a></li>
<li><a href="/gostd/html/template/doc.go.html">doc.go</a></li>
<li><a href="/gostd/html/template/error.go.html">error.go</a></li>
<li><a href="/gostd/html/template/escape.go.html">escape.go</a></li>
<li><a href="/gostd/html/template/escape_test.go.html">escape_test.go</a></li>
<li><a href="/gostd/html/template/html.go.html">html.go</a></li>
<li><a href="/gostd/html/template/html_test.go.html">html_test.go</a></li>
<li><a href="/gostd/html/template/js.go.html" class="current">js.go</a></li>
<li><a href="/gostd/html/template/js_test.go.html">js_test.go</a></li>
<li><a href="/gostd/html/template/template.go.html">template.go</a></li>
<li><a href="/gostd/html/template/transition.go.html">transition.go</a></li>
<li><a href="/gostd/html/template/url.go.html">url.go</a></li>
<li><a href="/gostd/html/template/url_test.go.html">url_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4358024">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4358079">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4358133">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4358184">package</span>&nbsp;<span class="ident" id="4358192">template</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4358202">import</span>&nbsp;<span class="op" id="4358209">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4358212">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4358221">&#34;encoding/json&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4358238">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4358245">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4358256">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4358267">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="4358282">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="4358285">//&nbsp;nextJSCtx&nbsp;returns&nbsp;the&nbsp;context&nbsp;that&nbsp;determines&nbsp;whether&nbsp;a&nbsp;slash&nbsp;after&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4358360">//&nbsp;given&nbsp;run&nbsp;of&nbsp;tokens&nbsp;starts&nbsp;a&nbsp;regular&nbsp;expression&nbsp;instead&nbsp;of&nbsp;a&nbsp;division</span><br>
<span class="lineno"></span><span class="comment" id="4358433">//&nbsp;operator:&nbsp;/&nbsp;or&nbsp;/=.</span><br>
<span class="lineno"></span><span class="comment" id="4358455">//</span><br>
<span class="lineno">20</span><span class="comment" id="4358458">//&nbsp;This&nbsp;assumes&nbsp;that&nbsp;the&nbsp;token&nbsp;run&nbsp;does&nbsp;not&nbsp;include&nbsp;any&nbsp;string&nbsp;tokens,&nbsp;comment</span><br>
<span class="lineno"></span><span class="comment" id="4358537">//&nbsp;tokens,&nbsp;regular&nbsp;expression&nbsp;literal&nbsp;tokens,&nbsp;or&nbsp;division&nbsp;operators.</span><br>
<span class="lineno"></span><span class="comment" id="4358606">//</span><br>
<span class="lineno"></span><span class="comment" id="4358609">//&nbsp;This&nbsp;fails&nbsp;on&nbsp;some&nbsp;valid&nbsp;but&nbsp;nonsensical&nbsp;JavaScript&nbsp;programs&nbsp;like</span><br>
<span class="lineno"></span><span class="comment" id="4358678">//&nbsp;&#34;x&nbsp;=&nbsp;++/foo/i&#34;&nbsp;which&nbsp;is&nbsp;quite&nbsp;different&nbsp;than&nbsp;&#34;x++/foo/i&#34;,&nbsp;but&nbsp;is&nbsp;not&nbsp;known&nbsp;to</span><br>
<span class="lineno">25</span><span class="comment" id="4358759">//&nbsp;fail&nbsp;on&nbsp;any&nbsp;known&nbsp;useful&nbsp;programs.&nbsp;It&nbsp;is&nbsp;based&nbsp;on&nbsp;the&nbsp;draft</span><br>
<span class="lineno"></span><span class="comment" id="4358822">//&nbsp;JavaScript&nbsp;2.0&nbsp;lexical&nbsp;grammar&nbsp;and&nbsp;requires&nbsp;one&nbsp;token&nbsp;of&nbsp;lookbehind:</span><br>
<span class="lineno"></span><span class="comment" id="4358894">//&nbsp;http://www.mozilla.org/js/language/js20-2000-07/rationale/syntax.html</span><br>
<span class="lineno"></span><span class="keyword" id="4358967">func</span>&nbsp;<span class="ident" id="4358972">nextJSCtx</span><span class="op" id="4358981">(</span><span class="ident" id="4358982">s</span>&nbsp;<span class="op" id="4358984">[</span><span class="op" id="4358985">]</span><span class="builtintype" id="4358986">byte</span><span class="op" id="4358990">,</span>&nbsp;<span class="ident" id="4358992">preceding</span>&nbsp;<span class="ident" id="4359002">jsCtx</span><span class="op" id="4359007">)</span>&nbsp;<span class="ident" id="4359009">jsCtx</span>&nbsp;<span class="op" id="4359015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4359018">s</span>&nbsp;<span class="op" id="4359020">=</span>&nbsp;<span class="ident" id="4359022">bytes</span><span class="op" id="4359027">.</span><span class="ident" id="4359028">TrimRight</span><span class="op" id="4359037">(</span><span class="ident" id="4359038">s</span><span class="op" id="4359039">,</span>&nbsp;<span class="string" id="4359041">&#34;\t\n\f\r&nbsp;\u2028\u2029&#34;</span><span class="op" id="4359064">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4359067">if</span>&nbsp;<span class="builtinfunc" id="4359070">len</span><span class="op" id="4359073">(</span><span class="ident" id="4359074">s</span><span class="op" id="4359075">)</span>&nbsp;<span class="op" id="4359077">==</span>&nbsp;<span class="num" id="4359080">0</span>&nbsp;<span class="op" id="4359082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4359086">return</span>&nbsp;<span class="ident" id="4359093">preceding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4359104">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4359108">//&nbsp;All&nbsp;cases&nbsp;below&nbsp;are&nbsp;in&nbsp;the&nbsp;single-byte&nbsp;UTF-8&nbsp;group.</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4359164">switch</span>&nbsp;<span class="ident" id="4359171">c</span><span class="op" id="4359172">,</span>&nbsp;<span class="ident" id="4359174">n</span>&nbsp;<span class="op" id="4359176">:=</span>&nbsp;<span class="ident" id="4359179">s</span><span class="op" id="4359180">[</span><span class="builtinfunc" id="4359181">len</span><span class="op" id="4359184">(</span><span class="ident" id="4359185">s</span><span class="op" id="4359186">)</span><span class="op" id="4359187">-</span><span class="num" id="4359188">1</span><span class="op" id="4359189">]</span><span class="op" id="4359190">,</span>&nbsp;<span class="builtinfunc" id="4359192">len</span><span class="op" id="4359195">(</span><span class="ident" id="4359196">s</span><span class="op" id="4359197">)</span><span class="op" id="4359198">;</span>&nbsp;<span class="ident" id="4359200">c</span>&nbsp;<span class="op" id="4359202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4359205">case</span>&nbsp;<span class="string" id="4359210">&#39;+&#39;</span><span class="op" id="4359213">,</span>&nbsp;<span class="string" id="4359215">&#39;-&#39;</span><span class="op" id="4359218">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4359222">//&nbsp;++&nbsp;and&nbsp;--&nbsp;are&nbsp;not&nbsp;regexp&nbsp;preceders,&nbsp;but&nbsp;+&nbsp;and&nbsp;-&nbsp;are&nbsp;whether</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4359287">//&nbsp;they&nbsp;are&nbsp;used&nbsp;as&nbsp;infix&nbsp;or&nbsp;prefix&nbsp;operators.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4359336">start</span>&nbsp;<span class="op" id="4359342">:=</span>&nbsp;<span class="ident" id="4359345">n</span>&nbsp;<span class="op" id="4359347">-</span>&nbsp;<span class="num" id="4359349">1</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4359353">//&nbsp;Count&nbsp;the&nbsp;number&nbsp;of&nbsp;adjacent&nbsp;dashes&nbsp;or&nbsp;pluses.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4359405">for</span>&nbsp;<span class="ident" id="4359409">start</span>&nbsp;<span class="op" id="4359415">&gt;</span>&nbsp;<span class="num" id="4359417">0</span>&nbsp;<span class="op" id="4359419">&amp;&amp;</span>&nbsp;<span class="ident" id="4359422">s</span><span class="op" id="4359423">[</span><span class="ident" id="4359424">start</span><span class="op" id="4359429">-</span><span class="num" id="4359430">1</span><span class="op" id="4359431">]</span>&nbsp;<span class="op" id="4359433">==</span>&nbsp;<span class="ident" id="4359436">c</span>&nbsp;<span class="op" id="4359438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4359443">start</span><span class="op" id="4359448">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4359453">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4359457">if</span>&nbsp;<span class="op" id="4359460">(</span><span class="ident" id="4359461">n</span><span class="op" id="4359462">-</span><span class="ident" id="4359463">start</span><span class="op" id="4359468">)</span><span class="op" id="4359469">&amp;</span><span class="num" id="4359470">1</span>&nbsp;<span class="op" id="4359472">==</span>&nbsp;<span class="num" id="4359475">1</span>&nbsp;<span class="op" id="4359477">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4359482">//&nbsp;Reached&nbsp;for&nbsp;trailing&nbsp;minus&nbsp;signs&nbsp;since&nbsp;&#34;---&#34;&nbsp;is&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4359540">//&nbsp;same&nbsp;as&nbsp;&#34;--&nbsp;-&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4359562">return</span>&nbsp;<span class="ident" id="4359569">jsCtxRegexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4359583">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4359587">return</span>&nbsp;<span class="ident" id="4359594">jsCtxDivOp</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4359606">case</span>&nbsp;<span class="string" id="4359611">&#39;.&#39;</span><span class="op" id="4359614">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4359618">//&nbsp;Handle&nbsp;&#34;42.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4359636">if</span>&nbsp;<span class="ident" id="4359639">n</span>&nbsp;<span class="op" id="4359641">!=</span>&nbsp;<span class="num" id="4359644">1</span>&nbsp;<span class="op" id="4359646">&amp;&amp;</span>&nbsp;<span class="string" id="4359649">&#39;0&#39;</span>&nbsp;<span class="op" id="4359653">&lt;=</span>&nbsp;<span class="ident" id="4359656">s</span><span class="op" id="4359657">[</span><span class="ident" id="4359658">n</span><span class="op" id="4359659">-</span><span class="num" id="4359660">2</span><span class="op" id="4359661">]</span>&nbsp;<span class="op" id="4359663">&amp;&amp;</span>&nbsp;<span class="ident" id="4359666">s</span><span class="op" id="4359667">[</span><span class="ident" id="4359668">n</span><span class="op" id="4359669">-</span><span class="num" id="4359670">2</span><span class="op" id="4359671">]</span>&nbsp;<span class="op" id="4359673">&lt;=</span>&nbsp;<span class="string" id="4359676">&#39;9&#39;</span>&nbsp;<span class="op" id="4359680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4359685">return</span>&nbsp;<span class="ident" id="4359692">jsCtxDivOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4359705">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4359709">return</span>&nbsp;<span class="ident" id="4359716">jsCtxRegexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4359729">//&nbsp;Suffixes&nbsp;for&nbsp;all&nbsp;punctuators&nbsp;from&nbsp;section&nbsp;7.7&nbsp;of&nbsp;the&nbsp;language&nbsp;spec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4359800">//&nbsp;that&nbsp;only&nbsp;end&nbsp;binary&nbsp;operators&nbsp;not&nbsp;handled&nbsp;above.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4359854">case</span>&nbsp;<span class="string" id="4359859">&#39;,&#39;</span><span class="op" id="4359862">,</span>&nbsp;<span class="string" id="4359864">&#39;&lt;&#39;</span><span class="op" id="4359867">,</span>&nbsp;<span class="string" id="4359869">&#39;&gt;&#39;</span><span class="op" id="4359872">,</span>&nbsp;<span class="string" id="4359874">&#39;=&#39;</span><span class="op" id="4359877">,</span>&nbsp;<span class="string" id="4359879">&#39;*&#39;</span><span class="op" id="4359882">,</span>&nbsp;<span class="string" id="4359884">&#39;%&#39;</span><span class="op" id="4359887">,</span>&nbsp;<span class="string" id="4359889">&#39;&amp;&#39;</span><span class="op" id="4359892">,</span>&nbsp;<span class="string" id="4359894">&#39;|&#39;</span><span class="op" id="4359897">,</span>&nbsp;<span class="string" id="4359899">&#39;^&#39;</span><span class="op" id="4359902">,</span>&nbsp;<span class="string" id="4359904">&#39;?&#39;</span><span class="op" id="4359907">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4359911">return</span>&nbsp;<span class="ident" id="4359918">jsCtxRegexp</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4359931">//&nbsp;Suffixes&nbsp;for&nbsp;all&nbsp;punctuators&nbsp;from&nbsp;section&nbsp;7.7&nbsp;of&nbsp;the&nbsp;language&nbsp;spec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4360002">//&nbsp;that&nbsp;are&nbsp;prefix&nbsp;operators&nbsp;not&nbsp;handled&nbsp;above.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4360051">case</span>&nbsp;<span class="string" id="4360056">&#39;!&#39;</span><span class="op" id="4360059">,</span>&nbsp;<span class="string" id="4360061">&#39;~&#39;</span><span class="op" id="4360064">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4360068">return</span>&nbsp;<span class="ident" id="4360075">jsCtxRegexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4360088">//&nbsp;Matches&nbsp;all&nbsp;the&nbsp;punctuators&nbsp;from&nbsp;section&nbsp;7.7&nbsp;of&nbsp;the&nbsp;language&nbsp;spec</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4360158">//&nbsp;that&nbsp;are&nbsp;open&nbsp;brackets&nbsp;not&nbsp;handled&nbsp;above.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4360204">case</span>&nbsp;<span class="string" id="4360209">&#39;(&#39;</span><span class="op" id="4360212">,</span>&nbsp;<span class="string" id="4360214">&#39;[&#39;</span><span class="op" id="4360217">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4360221">return</span>&nbsp;<span class="ident" id="4360228">jsCtxRegexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4360241">//&nbsp;Matches&nbsp;all&nbsp;the&nbsp;punctuators&nbsp;from&nbsp;section&nbsp;7.7&nbsp;of&nbsp;the&nbsp;language&nbsp;spec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4360311">//&nbsp;that&nbsp;precede&nbsp;expression&nbsp;starts.</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4360347">case</span>&nbsp;<span class="string" id="4360352">&#39;:&#39;</span><span class="op" id="4360355">,</span>&nbsp;<span class="string" id="4360357">&#39;;&#39;</span><span class="op" id="4360360">,</span>&nbsp;<span class="string" id="4360362">&#39;{&#39;</span><span class="op" id="4360365">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4360369">return</span>&nbsp;<span class="ident" id="4360376">jsCtxRegexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4360389">//&nbsp;CAVEAT:&nbsp;the&nbsp;close&nbsp;punctuators&nbsp;(&#39;}&#39;,&nbsp;&#39;]&#39;,&nbsp;&#39;)&#39;)&nbsp;precede&nbsp;div&nbsp;ops&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4360459">//&nbsp;are&nbsp;handled&nbsp;in&nbsp;the&nbsp;default&nbsp;except&nbsp;for&nbsp;&#39;}&#39;&nbsp;which&nbsp;can&nbsp;precede&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4360525">//&nbsp;division&nbsp;op&nbsp;as&nbsp;in</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4360547">//&nbsp;&nbsp;&nbsp;&nbsp;({&nbsp;valueOf:&nbsp;function&nbsp;()&nbsp;{&nbsp;return&nbsp;42&nbsp;}&nbsp;}&nbsp;/&nbsp;2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4360598">//&nbsp;which&nbsp;is&nbsp;valid,&nbsp;but,&nbsp;in&nbsp;practice,&nbsp;developers&nbsp;don&#39;t&nbsp;divide&nbsp;object</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4360667">//&nbsp;literals,&nbsp;so&nbsp;our&nbsp;heuristic&nbsp;works&nbsp;well&nbsp;for&nbsp;code&nbsp;like</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4360723">//&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;()&nbsp;{&nbsp;...&nbsp;}&nbsp;&nbsp;/foo/.test(x)&nbsp;&amp;&amp;&nbsp;sideEffect();</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4360782">//&nbsp;The&nbsp;&#39;)&#39;&nbsp;punctuator&nbsp;can&nbsp;precede&nbsp;a&nbsp;regular&nbsp;expression&nbsp;as&nbsp;in</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4360844">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(b)&nbsp;/foo/.test(x)&nbsp;&amp;&amp;&nbsp;...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4360880">//&nbsp;but&nbsp;this&nbsp;is&nbsp;much&nbsp;less&nbsp;likely&nbsp;than</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4360918">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(a&nbsp;+&nbsp;b)&nbsp;/&nbsp;c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4360938">case</span>&nbsp;<span class="string" id="4360943">&#39;}&#39;</span><span class="op" id="4360946">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4360950">return</span>&nbsp;<span class="ident" id="4360957">jsCtxRegexp</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4360970">default</span><span class="op" id="4360977">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4360981">//&nbsp;Look&nbsp;for&nbsp;an&nbsp;IdentifierName&nbsp;and&nbsp;see&nbsp;if&nbsp;it&nbsp;is&nbsp;a&nbsp;keyword&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4361045">//&nbsp;can&nbsp;precede&nbsp;a&nbsp;regular&nbsp;expression.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4361084">j</span>&nbsp;<span class="op" id="4361086">:=</span>&nbsp;<span class="ident" id="4361089">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4361093">for</span>&nbsp;<span class="ident" id="4361097">j</span>&nbsp;<span class="op" id="4361099">&gt;</span>&nbsp;<span class="num" id="4361101">0</span>&nbsp;<span class="op" id="4361103">&amp;&amp;</span>&nbsp;<span class="ident" id="4361106">isJSIdentPart</span><span class="op" id="4361119">(</span><span class="builtintype" id="4361120">rune</span><span class="op" id="4361124">(</span><span class="ident" id="4361125">s</span><span class="op" id="4361126">[</span><span class="ident" id="4361127">j</span><span class="op" id="4361128">-</span><span class="num" id="4361129">1</span><span class="op" id="4361130">]</span><span class="op" id="4361131">)</span><span class="op" id="4361132">)</span>&nbsp;<span class="op" id="4361134">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4361139">j</span><span class="op" id="4361140">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4361145">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4361149">if</span>&nbsp;<span class="ident" id="4361152">regexpPrecederKeywords</span><span class="op" id="4361174">[</span><span class="builtintype" id="4361175">string</span><span class="op" id="4361181">(</span><span class="ident" id="4361182">s</span><span class="op" id="4361183">[</span><span class="ident" id="4361184">j</span><span class="op" id="4361185">:</span><span class="op" id="4361186">]</span><span class="op" id="4361187">)</span><span class="op" id="4361188">]</span>&nbsp;<span class="op" id="4361190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4361195">return</span>&nbsp;<span class="ident" id="4361202">jsCtxRegexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4361216">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4361219">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4361222">//&nbsp;Otherwise&nbsp;is&nbsp;a&nbsp;punctuator&nbsp;not&nbsp;listed&nbsp;above,&nbsp;or</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4361273">//&nbsp;a&nbsp;string&nbsp;which&nbsp;precedes&nbsp;a&nbsp;div&nbsp;op,&nbsp;or&nbsp;an&nbsp;identifier</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4361328">//&nbsp;which&nbsp;precedes&nbsp;a&nbsp;div&nbsp;op.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4361357">return</span>&nbsp;<span class="ident" id="4361364">jsCtxDivOp</span><br>
<span class="lineno">100</span><span class="op" id="4361375">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4361378">//&nbsp;regexpPrecederKeywords&nbsp;is&nbsp;a&nbsp;set&nbsp;of&nbsp;reserved&nbsp;JS&nbsp;keywords&nbsp;that&nbsp;can&nbsp;precede&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4361456">//&nbsp;regular&nbsp;expression&nbsp;in&nbsp;JS&nbsp;source.</span><br>
<span class="lineno"></span><span class="keyword" id="4361492">var</span>&nbsp;<span class="ident" id="4361496">regexpPrecederKeywords</span>&nbsp;<span class="op" id="4361519">=</span>&nbsp;<span class="keyword" id="4361521">map</span><span class="op" id="4361524">[</span><span class="builtintype" id="4361525">string</span><span class="op" id="4361531">]</span><span class="builtintype" id="4361532">bool</span><span class="op" id="4361536">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4361539">&#34;break&#34;</span><span class="op" id="4361546">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4361553">true</span><span class="op" id="4361557">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4361560">&#34;case&#34;</span><span class="op" id="4361566">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4361574">true</span><span class="op" id="4361578">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4361581">&#34;continue&#34;</span><span class="op" id="4361591">:</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4361595">true</span><span class="op" id="4361599">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4361602">&#34;delete&#34;</span><span class="op" id="4361610">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4361616">true</span><span class="op" id="4361620">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4361623">&#34;do&#34;</span><span class="op" id="4361627">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4361637">true</span><span class="op" id="4361641">,</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4361644">&#34;else&#34;</span><span class="op" id="4361650">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4361658">true</span><span class="op" id="4361662">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4361665">&#34;finally&#34;</span><span class="op" id="4361674">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4361679">true</span><span class="op" id="4361683">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4361686">&#34;in&#34;</span><span class="op" id="4361690">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4361700">true</span><span class="op" id="4361704">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4361707">&#34;instanceof&#34;</span><span class="op" id="4361719">:</span>&nbsp;<span class="builtintype" id="4361721">true</span><span class="op" id="4361725">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4361728">&#34;return&#34;</span><span class="op" id="4361736">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4361742">true</span><span class="op" id="4361746">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4361749">&#34;throw&#34;</span><span class="op" id="4361756">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4361763">true</span><span class="op" id="4361767">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4361770">&#34;try&#34;</span><span class="op" id="4361775">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4361784">true</span><span class="op" id="4361788">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4361791">&#34;typeof&#34;</span><span class="op" id="4361799">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4361805">true</span><span class="op" id="4361809">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4361812">&#34;void&#34;</span><span class="op" id="4361818">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4361826">true</span><span class="op" id="4361830">,</span><br>
<span class="lineno"></span><span class="op" id="4361832">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="keyword" id="4361835">var</span>&nbsp;<span class="ident" id="4361839">jsonMarshalType</span>&nbsp;<span class="op" id="4361855">=</span>&nbsp;<span class="ident" id="4361857">reflect</span><span class="op" id="4361864">.</span><span class="ident" id="4361865">TypeOf</span><span class="op" id="4361871">(</span><span class="op" id="4361872">(</span><span class="op" id="4361873">*</span><span class="ident" id="4361874">json</span><span class="op" id="4361878">.</span><span class="ident" id="4361879">Marshaler</span><span class="op" id="4361888">)</span><span class="op" id="4361889">(</span><span class="builtintype" id="4361890">nil</span><span class="op" id="4361893">)</span><span class="op" id="4361894">)</span><span class="op" id="4361895">.</span><span class="ident" id="4361896">Elem</span><span class="op" id="4361900">(</span><span class="op" id="4361901">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4361904">//&nbsp;indirectToJSONMarshaler&nbsp;returns&nbsp;the&nbsp;value,&nbsp;after&nbsp;dereferencing&nbsp;as&nbsp;many&nbsp;times</span><br>
<span class="lineno"></span><span class="comment" id="4361984">//&nbsp;as&nbsp;necessary&nbsp;to&nbsp;reach&nbsp;the&nbsp;base&nbsp;type&nbsp;(or&nbsp;nil)&nbsp;or&nbsp;an&nbsp;implementation&nbsp;of&nbsp;json.Marshal.</span><br>
<span class="lineno">125</span><span class="keyword" id="4362070">func</span>&nbsp;<span class="ident" id="4362075">indirectToJSONMarshaler</span><span class="op" id="4362098">(</span><span class="ident" id="4362099">a</span>&nbsp;<span class="keyword" id="4362101">interface</span><span class="op" id="4362110">{</span><span class="op" id="4362111">}</span><span class="op" id="4362112">)</span>&nbsp;<span class="keyword" id="4362114">interface</span><span class="op" id="4362123">{</span><span class="op" id="4362124">}</span>&nbsp;<span class="op" id="4362126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4362129">v</span>&nbsp;<span class="op" id="4362131">:=</span>&nbsp;<span class="ident" id="4362134">reflect</span><span class="op" id="4362141">.</span><span class="ident" id="4362142">ValueOf</span><span class="op" id="4362149">(</span><span class="ident" id="4362150">a</span><span class="op" id="4362151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4362154">for</span>&nbsp;<span class="op" id="4362158">!</span><span class="ident" id="4362159">v</span><span class="op" id="4362160">.</span><span class="ident" id="4362161">Type</span><span class="op" id="4362165">(</span><span class="op" id="4362166">)</span><span class="op" id="4362167">.</span><span class="ident" id="4362168">Implements</span><span class="op" id="4362178">(</span><span class="ident" id="4362179">jsonMarshalType</span><span class="op" id="4362194">)</span>&nbsp;<span class="op" id="4362196">&amp;&amp;</span>&nbsp;<span class="ident" id="4362199">v</span><span class="op" id="4362200">.</span><span class="ident" id="4362201">Kind</span><span class="op" id="4362205">(</span><span class="op" id="4362206">)</span>&nbsp;<span class="op" id="4362208">==</span>&nbsp;<span class="ident" id="4362211">reflect</span><span class="op" id="4362218">.</span><span class="ident" id="4362219">Ptr</span>&nbsp;<span class="op" id="4362223">&amp;&amp;</span>&nbsp;<span class="op" id="4362226">!</span><span class="ident" id="4362227">v</span><span class="op" id="4362228">.</span><span class="ident" id="4362229">IsNil</span><span class="op" id="4362234">(</span><span class="op" id="4362235">)</span>&nbsp;<span class="op" id="4362237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4362241">v</span>&nbsp;<span class="op" id="4362243">=</span>&nbsp;<span class="ident" id="4362245">v</span><span class="op" id="4362246">.</span><span class="ident" id="4362247">Elem</span><span class="op" id="4362251">(</span><span class="op" id="4362252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4362255">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4362258">return</span>&nbsp;<span class="ident" id="4362265">v</span><span class="op" id="4362266">.</span><span class="ident" id="4362267">Interface</span><span class="op" id="4362276">(</span><span class="op" id="4362277">)</span><br>
<span class="lineno"></span><span class="op" id="4362279">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4362282">//&nbsp;jsValEscaper&nbsp;escapes&nbsp;its&nbsp;inputs&nbsp;to&nbsp;a&nbsp;JS&nbsp;Expression&nbsp;(section&nbsp;11.14)&nbsp;that&nbsp;has</span><br>
<span class="lineno"></span><span class="comment" id="4362361">//&nbsp;neither&nbsp;side-effects&nbsp;nor&nbsp;free&nbsp;variables&nbsp;outside&nbsp;(NaN,&nbsp;Infinity).</span><br>
<span class="lineno">135</span><span class="keyword" id="4362429">func</span>&nbsp;<span class="ident" id="4362434">jsValEscaper</span><span class="op" id="4362446">(</span><span class="ident" id="4362447">args</span>&nbsp;<span class="op" id="4362452">...</span><span class="keyword" id="4362455">interface</span><span class="op" id="4362464">{</span><span class="op" id="4362465">}</span><span class="op" id="4362466">)</span>&nbsp;<span class="builtintype" id="4362468">string</span>&nbsp;<span class="op" id="4362475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4362478">var</span>&nbsp;<span class="ident" id="4362482">a</span>&nbsp;<span class="keyword" id="4362484">interface</span><span class="op" id="4362493">{</span><span class="op" id="4362494">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4362497">if</span>&nbsp;<span class="builtinfunc" id="4362500">len</span><span class="op" id="4362503">(</span><span class="ident" id="4362504">args</span><span class="op" id="4362508">)</span>&nbsp;<span class="op" id="4362510">==</span>&nbsp;<span class="num" id="4362513">1</span>&nbsp;<span class="op" id="4362515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4362519">a</span>&nbsp;<span class="op" id="4362521">=</span>&nbsp;<span class="ident" id="4362523">indirectToJSONMarshaler</span><span class="op" id="4362546">(</span><span class="ident" id="4362547">args</span><span class="op" id="4362551">[</span><span class="num" id="4362552">0</span><span class="op" id="4362553">]</span><span class="op" id="4362554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4362558">switch</span>&nbsp;<span class="ident" id="4362565">t</span>&nbsp;<span class="op" id="4362567">:=</span>&nbsp;<span class="ident" id="4362570">a</span><span class="op" id="4362571">.</span><span class="op" id="4362572">(</span><span class="keyword" id="4362573">type</span><span class="op" id="4362577">)</span>&nbsp;<span class="op" id="4362579">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4362583">case</span>&nbsp;<span class="ident" id="4362588">JS</span><span class="op" id="4362590">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4362595">return</span>&nbsp;<span class="builtintype" id="4362602">string</span><span class="op" id="4362608">(</span><span class="ident" id="4362609">t</span><span class="op" id="4362610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4362614">case</span>&nbsp;<span class="ident" id="4362619">JSStr</span><span class="op" id="4362624">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4362629">//&nbsp;TODO:&nbsp;normalize&nbsp;quotes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4362659">return</span>&nbsp;<span class="string" id="4362666">`&#34;`</span>&nbsp;<span class="op" id="4362670">+</span>&nbsp;<span class="builtintype" id="4362672">string</span><span class="op" id="4362678">(</span><span class="ident" id="4362679">t</span><span class="op" id="4362680">)</span>&nbsp;<span class="op" id="4362682">+</span>&nbsp;<span class="string" id="4362684">`&#34;`</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4362690">case</span>&nbsp;<span class="ident" id="4362695">json</span><span class="op" id="4362699">.</span><span class="ident" id="4362700">Marshaler</span><span class="op" id="4362709">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4362714">//&nbsp;Do&nbsp;not&nbsp;treat&nbsp;as&nbsp;a&nbsp;Stringer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4362747">case</span>&nbsp;<span class="ident" id="4362752">fmt</span><span class="op" id="4362755">.</span><span class="ident" id="4362756">Stringer</span><span class="op" id="4362764">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4362769">a</span>&nbsp;<span class="op" id="4362771">=</span>&nbsp;<span class="ident" id="4362773">t</span><span class="op" id="4362774">.</span><span class="ident" id="4362775">String</span><span class="op" id="4362781">(</span><span class="op" id="4362782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4362786">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4362789">}</span>&nbsp;<span class="keyword" id="4362791">else</span>&nbsp;<span class="op" id="4362796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4362800">for</span>&nbsp;<span class="ident" id="4362804">i</span><span class="op" id="4362805">,</span>&nbsp;<span class="ident" id="4362807">arg</span>&nbsp;<span class="op" id="4362811">:=</span>&nbsp;<span class="keyword" id="4362814">range</span>&nbsp;<span class="ident" id="4362820">args</span>&nbsp;<span class="op" id="4362825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4362830">args</span><span class="op" id="4362834">[</span><span class="ident" id="4362835">i</span><span class="op" id="4362836">]</span>&nbsp;<span class="op" id="4362838">=</span>&nbsp;<span class="ident" id="4362840">indirectToJSONMarshaler</span><span class="op" id="4362863">(</span><span class="ident" id="4362864">arg</span><span class="op" id="4362867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4362871">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4362875">a</span>&nbsp;<span class="op" id="4362877">=</span>&nbsp;<span class="ident" id="4362879">fmt</span><span class="op" id="4362882">.</span><span class="ident" id="4362883">Sprint</span><span class="op" id="4362889">(</span><span class="ident" id="4362890">args</span><span class="op" id="4362894">...</span><span class="op" id="4362897">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4362900">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4362903">//&nbsp;TODO:&nbsp;detect&nbsp;cycles&nbsp;before&nbsp;calling&nbsp;Marshal&nbsp;which&nbsp;loops&nbsp;infinitely&nbsp;on</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4362976">//&nbsp;cyclic&nbsp;data.&nbsp;This&nbsp;may&nbsp;be&nbsp;an&nbsp;unacceptable&nbsp;DoS&nbsp;risk.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4363032">b</span><span class="op" id="4363033">,</span>&nbsp;<span class="ident" id="4363035">err</span>&nbsp;<span class="op" id="4363039">:=</span>&nbsp;<span class="ident" id="4363042">json</span><span class="op" id="4363046">.</span><span class="ident" id="4363047">Marshal</span><span class="op" id="4363054">(</span><span class="ident" id="4363055">a</span><span class="op" id="4363056">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4363059">if</span>&nbsp;<span class="ident" id="4363062">err</span>&nbsp;<span class="op" id="4363066">!=</span>&nbsp;<span class="builtintype" id="4363069">nil</span>&nbsp;<span class="op" id="4363073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4363077">//&nbsp;Put&nbsp;a&nbsp;space&nbsp;before&nbsp;comment&nbsp;so&nbsp;that&nbsp;if&nbsp;it&nbsp;is&nbsp;flush&nbsp;against</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4363140">//&nbsp;a&nbsp;division&nbsp;operator&nbsp;it&nbsp;is&nbsp;not&nbsp;turned&nbsp;into&nbsp;a&nbsp;line&nbsp;comment:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4363203">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x/{{y}}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4363220">//&nbsp;turning&nbsp;into</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4363238">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x//*&nbsp;error&nbsp;marshalling&nbsp;y:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4363273">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;second&nbsp;line&nbsp;of&nbsp;error&nbsp;message&nbsp;*/null</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4363323">return</span>&nbsp;<span class="ident" id="4363330">fmt</span><span class="op" id="4363333">.</span><span class="ident" id="4363334">Sprintf</span><span class="op" id="4363341">(</span><span class="string" id="4363342">&#34;&nbsp;/*&nbsp;%s&nbsp;*/null&nbsp;&#34;</span><span class="op" id="4363358">,</span>&nbsp;<span class="ident" id="4363360">strings</span><span class="op" id="4363367">.</span><span class="ident" id="4363368">Replace</span><span class="op" id="4363375">(</span><span class="ident" id="4363376">err</span><span class="op" id="4363379">.</span><span class="ident" id="4363380">Error</span><span class="op" id="4363385">(</span><span class="op" id="4363386">)</span><span class="op" id="4363387">,</span>&nbsp;<span class="string" id="4363389">&#34;*/&#34;</span><span class="op" id="4363393">,</span>&nbsp;<span class="string" id="4363395">&#34;*&nbsp;/&#34;</span><span class="op" id="4363400">,</span>&nbsp;<span class="op" id="4363402">-</span><span class="num" id="4363403">1</span><span class="op" id="4363404">)</span><span class="op" id="4363405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4363408">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4363412">//&nbsp;TODO:&nbsp;maybe&nbsp;post-process&nbsp;output&nbsp;to&nbsp;prevent&nbsp;it&nbsp;from&nbsp;containing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4363478">//&nbsp;&#34;&lt;!--&#34;,&nbsp;&#34;--&gt;&#34;,&nbsp;&#34;&lt;![CDATA[&#34;,&nbsp;&#34;]]&gt;&#34;,&nbsp;or&nbsp;&#34;&lt;/script&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4363531">//&nbsp;in&nbsp;case&nbsp;custom&nbsp;marshallers&nbsp;produce&nbsp;output&nbsp;containing&nbsp;those.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4363596">//&nbsp;TODO:&nbsp;Maybe&nbsp;abbreviate&nbsp;\u00ab&nbsp;to&nbsp;\xab&nbsp;to&nbsp;produce&nbsp;more&nbsp;compact&nbsp;output.</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4363670">if</span>&nbsp;<span class="builtinfunc" id="4363673">len</span><span class="op" id="4363676">(</span><span class="ident" id="4363677">b</span><span class="op" id="4363678">)</span>&nbsp;<span class="op" id="4363680">==</span>&nbsp;<span class="num" id="4363683">0</span>&nbsp;<span class="op" id="4363685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4363689">//&nbsp;In,&nbsp;`x=y/{{.}}*z`&nbsp;a&nbsp;json.Marshaler&nbsp;that&nbsp;produces&nbsp;&#34;&#34;&nbsp;should</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4363753">//&nbsp;not&nbsp;cause&nbsp;the&nbsp;output&nbsp;`x=y/*z`.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4363789">return</span>&nbsp;<span class="string" id="4363796">&#34;&nbsp;null&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4363806">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4363809">first</span><span class="op" id="4363814">,</span>&nbsp;<span class="ident" id="4363816">_</span>&nbsp;<span class="op" id="4363818">:=</span>&nbsp;<span class="ident" id="4363821">utf8</span><span class="op" id="4363825">.</span><span class="ident" id="4363826">DecodeRune</span><span class="op" id="4363836">(</span><span class="ident" id="4363837">b</span><span class="op" id="4363838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4363841">last</span><span class="op" id="4363845">,</span>&nbsp;<span class="ident" id="4363847">_</span>&nbsp;<span class="op" id="4363849">:=</span>&nbsp;<span class="ident" id="4363852">utf8</span><span class="op" id="4363856">.</span><span class="ident" id="4363857">DecodeLastRune</span><span class="op" id="4363871">(</span><span class="ident" id="4363872">b</span><span class="op" id="4363873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4363876">var</span>&nbsp;<span class="ident" id="4363880">buf</span>&nbsp;<span class="ident" id="4363884">bytes</span><span class="op" id="4363889">.</span><span class="ident" id="4363890">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4363898">//&nbsp;Prevent&nbsp;IdentifierNames&nbsp;and&nbsp;NumericLiterals&nbsp;from&nbsp;running&nbsp;into</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4363964">//&nbsp;keywords:&nbsp;in,&nbsp;instanceof,&nbsp;typeof,&nbsp;void</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4364007">pad</span>&nbsp;<span class="op" id="4364011">:=</span>&nbsp;<span class="ident" id="4364014">isJSIdentPart</span><span class="op" id="4364027">(</span><span class="ident" id="4364028">first</span><span class="op" id="4364033">)</span>&nbsp;<span class="op" id="4364035">||</span>&nbsp;<span class="ident" id="4364038">isJSIdentPart</span><span class="op" id="4364051">(</span><span class="ident" id="4364052">last</span><span class="op" id="4364056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4364059">if</span>&nbsp;<span class="ident" id="4364062">pad</span>&nbsp;<span class="op" id="4364066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4364070">buf</span><span class="op" id="4364073">.</span><span class="ident" id="4364074">WriteByte</span><span class="op" id="4364083">(</span><span class="string" id="4364084">&#39;&nbsp;&#39;</span><span class="op" id="4364087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4364090">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4364093">written</span>&nbsp;<span class="op" id="4364101">:=</span>&nbsp;<span class="num" id="4364104">0</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4364107">//&nbsp;Make&nbsp;sure&nbsp;that&nbsp;json.Marshal&nbsp;escapes&nbsp;codepoints&nbsp;U+2028&nbsp;&amp;&nbsp;U+2029</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4364174">//&nbsp;so&nbsp;it&nbsp;falls&nbsp;within&nbsp;the&nbsp;subset&nbsp;of&nbsp;JSON&nbsp;which&nbsp;is&nbsp;valid&nbsp;JS.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4364235">for</span>&nbsp;<span class="ident" id="4364239">i</span>&nbsp;<span class="op" id="4364241">:=</span>&nbsp;<span class="num" id="4364244">0</span><span class="op" id="4364245">;</span>&nbsp;<span class="ident" id="4364247">i</span>&nbsp;<span class="op" id="4364249">&lt;</span>&nbsp;<span class="builtinfunc" id="4364251">len</span><span class="op" id="4364254">(</span><span class="ident" id="4364255">b</span><span class="op" id="4364256">)</span><span class="op" id="4364257">;</span>&nbsp;<span class="op" id="4364259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4364263">rune</span><span class="op" id="4364267">,</span>&nbsp;<span class="ident" id="4364269">n</span>&nbsp;<span class="op" id="4364271">:=</span>&nbsp;<span class="ident" id="4364274">utf8</span><span class="op" id="4364278">.</span><span class="ident" id="4364279">DecodeRune</span><span class="op" id="4364289">(</span><span class="ident" id="4364290">b</span><span class="op" id="4364291">[</span><span class="ident" id="4364292">i</span><span class="op" id="4364293">:</span><span class="op" id="4364294">]</span><span class="op" id="4364295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4364299">repl</span>&nbsp;<span class="op" id="4364304">:=</span>&nbsp;<span class="string" id="4364307">&#34;&#34;</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4364312">if</span>&nbsp;<span class="builtintype" id="4364315">rune</span>&nbsp;<span class="op" id="4364320">==</span>&nbsp;<span class="num" id="4364323">0x2028</span>&nbsp;<span class="op" id="4364330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4364335">repl</span>&nbsp;<span class="op" id="4364340">=</span>&nbsp;<span class="string" id="4364342">`\u2028`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4364353">}</span>&nbsp;<span class="keyword" id="4364355">else</span>&nbsp;<span class="keyword" id="4364360">if</span>&nbsp;<span class="builtintype" id="4364363">rune</span>&nbsp;<span class="op" id="4364368">==</span>&nbsp;<span class="num" id="4364371">0x2029</span>&nbsp;<span class="op" id="4364378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4364383">repl</span>&nbsp;<span class="op" id="4364388">=</span>&nbsp;<span class="string" id="4364390">`\u2029`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4364401">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4364405">if</span>&nbsp;<span class="ident" id="4364408">repl</span>&nbsp;<span class="op" id="4364413">!=</span>&nbsp;<span class="string" id="4364416">&#34;&#34;</span>&nbsp;<span class="op" id="4364419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4364424">buf</span><span class="op" id="4364427">.</span><span class="ident" id="4364428">Write</span><span class="op" id="4364433">(</span><span class="ident" id="4364434">b</span><span class="op" id="4364435">[</span><span class="ident" id="4364436">written</span><span class="op" id="4364443">:</span><span class="ident" id="4364444">i</span><span class="op" id="4364445">]</span><span class="op" id="4364446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4364451">buf</span><span class="op" id="4364454">.</span><span class="ident" id="4364455">WriteString</span><span class="op" id="4364466">(</span><span class="ident" id="4364467">repl</span><span class="op" id="4364471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4364476">written</span>&nbsp;<span class="op" id="4364484">=</span>&nbsp;<span class="ident" id="4364486">i</span>&nbsp;<span class="op" id="4364488">+</span>&nbsp;<span class="ident" id="4364490">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4364494">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4364498">i</span>&nbsp;<span class="op" id="4364500">+=</span>&nbsp;<span class="ident" id="4364503">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4364506">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4364509">if</span>&nbsp;<span class="ident" id="4364512">buf</span><span class="op" id="4364515">.</span><span class="ident" id="4364516">Len</span><span class="op" id="4364519">(</span><span class="op" id="4364520">)</span>&nbsp;<span class="op" id="4364522">!=</span>&nbsp;<span class="num" id="4364525">0</span>&nbsp;<span class="op" id="4364527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4364531">buf</span><span class="op" id="4364534">.</span><span class="ident" id="4364535">Write</span><span class="op" id="4364540">(</span><span class="ident" id="4364541">b</span><span class="op" id="4364542">[</span><span class="ident" id="4364543">written</span><span class="op" id="4364550">:</span><span class="op" id="4364551">]</span><span class="op" id="4364552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4364556">if</span>&nbsp;<span class="ident" id="4364559">pad</span>&nbsp;<span class="op" id="4364563">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4364568">buf</span><span class="op" id="4364571">.</span><span class="ident" id="4364572">WriteByte</span><span class="op" id="4364581">(</span><span class="string" id="4364582">&#39;&nbsp;&#39;</span><span class="op" id="4364585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4364589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4364593">b</span>&nbsp;<span class="op" id="4364595">=</span>&nbsp;<span class="ident" id="4364597">buf</span><span class="op" id="4364600">.</span><span class="ident" id="4364601">Bytes</span><span class="op" id="4364606">(</span><span class="op" id="4364607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4364610">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4364613">return</span>&nbsp;<span class="builtintype" id="4364620">string</span><span class="op" id="4364626">(</span><span class="ident" id="4364627">b</span><span class="op" id="4364628">)</span><br>
<span class="lineno">215</span><span class="op" id="4364630">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4364633">//&nbsp;jsStrEscaper&nbsp;produces&nbsp;a&nbsp;string&nbsp;that&nbsp;can&nbsp;be&nbsp;included&nbsp;between&nbsp;quotes&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="4364706">//&nbsp;JavaScript&nbsp;source,&nbsp;in&nbsp;JavaScript&nbsp;embedded&nbsp;in&nbsp;an&nbsp;HTML5&nbsp;&lt;script&gt;&nbsp;element,</span><br>
<span class="lineno"></span><span class="comment" id="4364781">//&nbsp;or&nbsp;in&nbsp;an&nbsp;HTML5&nbsp;event&nbsp;handler&nbsp;attribute&nbsp;such&nbsp;as&nbsp;onclick.</span><br>
<span class="lineno">220</span><span class="keyword" id="4364840">func</span>&nbsp;<span class="ident" id="4364845">jsStrEscaper</span><span class="op" id="4364857">(</span><span class="ident" id="4364858">args</span>&nbsp;<span class="op" id="4364863">...</span><span class="keyword" id="4364866">interface</span><span class="op" id="4364875">{</span><span class="op" id="4364876">}</span><span class="op" id="4364877">)</span>&nbsp;<span class="builtintype" id="4364879">string</span>&nbsp;<span class="op" id="4364886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4364889">s</span><span class="op" id="4364890">,</span>&nbsp;<span class="ident" id="4364892">t</span>&nbsp;<span class="op" id="4364894">:=</span>&nbsp;<span class="ident" id="4364897">stringify</span><span class="op" id="4364906">(</span><span class="ident" id="4364907">args</span><span class="op" id="4364911">...</span><span class="op" id="4364914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4364917">if</span>&nbsp;<span class="ident" id="4364920">t</span>&nbsp;<span class="op" id="4364922">==</span>&nbsp;<span class="ident" id="4364925">contentTypeJSStr</span>&nbsp;<span class="op" id="4364942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4364946">return</span>&nbsp;<span class="ident" id="4364953">replace</span><span class="op" id="4364960">(</span><span class="ident" id="4364961">s</span><span class="op" id="4364962">,</span>&nbsp;<span class="ident" id="4364964">jsStrNormReplacementTable</span><span class="op" id="4364989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4364992">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4364995">return</span>&nbsp;<span class="ident" id="4365002">replace</span><span class="op" id="4365009">(</span><span class="ident" id="4365010">s</span><span class="op" id="4365011">,</span>&nbsp;<span class="ident" id="4365013">jsStrReplacementTable</span><span class="op" id="4365034">)</span><br>
<span class="lineno"></span><span class="op" id="4365036">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4365039">//&nbsp;jsRegexpEscaper&nbsp;behaves&nbsp;like&nbsp;jsStrEscaper&nbsp;but&nbsp;escapes&nbsp;regular&nbsp;expression</span><br>
<span class="lineno"></span><span class="comment" id="4365115">//&nbsp;specials&nbsp;so&nbsp;the&nbsp;result&nbsp;is&nbsp;treated&nbsp;literally&nbsp;when&nbsp;included&nbsp;in&nbsp;a&nbsp;regular</span><br>
<span class="lineno">230</span><span class="comment" id="4365189">//&nbsp;expression&nbsp;literal.&nbsp;/foo{{.X}}bar/&nbsp;matches&nbsp;the&nbsp;string&nbsp;&#34;foo&#34;&nbsp;followed&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="4365264">//&nbsp;the&nbsp;literal&nbsp;text&nbsp;of&nbsp;{{.X}}&nbsp;followed&nbsp;by&nbsp;the&nbsp;string&nbsp;&#34;bar&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="4365324">func</span>&nbsp;<span class="ident" id="4365329">jsRegexpEscaper</span><span class="op" id="4365344">(</span><span class="ident" id="4365345">args</span>&nbsp;<span class="op" id="4365350">...</span><span class="keyword" id="4365353">interface</span><span class="op" id="4365362">{</span><span class="op" id="4365363">}</span><span class="op" id="4365364">)</span>&nbsp;<span class="builtintype" id="4365366">string</span>&nbsp;<span class="op" id="4365373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4365376">s</span><span class="op" id="4365377">,</span>&nbsp;<span class="ident" id="4365379">_</span>&nbsp;<span class="op" id="4365381">:=</span>&nbsp;<span class="ident" id="4365384">stringify</span><span class="op" id="4365393">(</span><span class="ident" id="4365394">args</span><span class="op" id="4365398">...</span><span class="op" id="4365401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4365404">s</span>&nbsp;<span class="op" id="4365406">=</span>&nbsp;<span class="ident" id="4365408">replace</span><span class="op" id="4365415">(</span><span class="ident" id="4365416">s</span><span class="op" id="4365417">,</span>&nbsp;<span class="ident" id="4365419">jsRegexpReplacementTable</span><span class="op" id="4365443">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4365446">if</span>&nbsp;<span class="ident" id="4365449">s</span>&nbsp;<span class="op" id="4365451">==</span>&nbsp;<span class="string" id="4365454">&#34;&#34;</span>&nbsp;<span class="op" id="4365457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4365461">//&nbsp;/{{.X}}/&nbsp;should&nbsp;not&nbsp;produce&nbsp;a&nbsp;line&nbsp;comment&nbsp;when&nbsp;.X&nbsp;==&nbsp;&#34;&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4365524">return</span>&nbsp;<span class="string" id="4365531">&#34;(?:)&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4365539">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4365542">return</span>&nbsp;<span class="ident" id="4365549">s</span><br>
<span class="lineno">240</span><span class="op" id="4365551">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4365554">//&nbsp;replace&nbsp;replaces&nbsp;each&nbsp;rune&nbsp;r&nbsp;of&nbsp;s&nbsp;with&nbsp;replacementTable[r],&nbsp;provided&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="4365631">//&nbsp;r&nbsp;&lt;&nbsp;len(replacementTable).&nbsp;If&nbsp;replacementTable[r]&nbsp;is&nbsp;the&nbsp;empty&nbsp;string&nbsp;then</span><br>
<span class="lineno"></span><span class="comment" id="4365709">//&nbsp;no&nbsp;replacement&nbsp;is&nbsp;made.</span><br>
<span class="lineno">245</span><span class="comment" id="4365736">//&nbsp;It&nbsp;also&nbsp;replaces&nbsp;runes&nbsp;U+2028&nbsp;and&nbsp;U+2029&nbsp;with&nbsp;the&nbsp;raw&nbsp;strings&nbsp;`\u2028`&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4365814">//&nbsp;`\u2029`.</span><br>
<span class="lineno"></span><span class="keyword" id="4365827">func</span>&nbsp;<span class="ident" id="4365832">replace</span><span class="op" id="4365839">(</span><span class="ident" id="4365840">s</span>&nbsp;<span class="builtintype" id="4365842">string</span><span class="op" id="4365848">,</span>&nbsp;<span class="ident" id="4365850">replacementTable</span>&nbsp;<span class="op" id="4365867">[</span><span class="op" id="4365868">]</span><span class="builtintype" id="4365869">string</span><span class="op" id="4365875">)</span>&nbsp;<span class="builtintype" id="4365877">string</span>&nbsp;<span class="op" id="4365884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4365887">var</span>&nbsp;<span class="ident" id="4365891">b</span>&nbsp;<span class="ident" id="4365893">bytes</span><span class="op" id="4365898">.</span><span class="ident" id="4365899">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4365907">written</span>&nbsp;<span class="op" id="4365915">:=</span>&nbsp;<span class="num" id="4365918">0</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4365921">for</span>&nbsp;<span class="ident" id="4365925">i</span><span class="op" id="4365926">,</span>&nbsp;<span class="ident" id="4365928">r</span>&nbsp;<span class="op" id="4365930">:=</span>&nbsp;<span class="keyword" id="4365933">range</span>&nbsp;<span class="ident" id="4365939">s</span>&nbsp;<span class="op" id="4365941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4365945">var</span>&nbsp;<span class="ident" id="4365949">repl</span>&nbsp;<span class="builtintype" id="4365954">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4365963">switch</span>&nbsp;<span class="op" id="4365970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4365974">case</span>&nbsp;<span class="builtintype" id="4365979">int</span><span class="op" id="4365982">(</span><span class="ident" id="4365983">r</span><span class="op" id="4365984">)</span>&nbsp;<span class="op" id="4365986">&lt;</span>&nbsp;<span class="builtinfunc" id="4365988">len</span><span class="op" id="4365991">(</span><span class="ident" id="4365992">replacementTable</span><span class="op" id="4366008">)</span>&nbsp;<span class="op" id="4366010">&amp;&amp;</span>&nbsp;<span class="ident" id="4366013">replacementTable</span><span class="op" id="4366029">[</span><span class="ident" id="4366030">r</span><span class="op" id="4366031">]</span>&nbsp;<span class="op" id="4366033">!=</span>&nbsp;<span class="string" id="4366036">&#34;&#34;</span><span class="op" id="4366038">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4366043">repl</span>&nbsp;<span class="op" id="4366048">=</span>&nbsp;<span class="ident" id="4366050">replacementTable</span><span class="op" id="4366066">[</span><span class="ident" id="4366067">r</span><span class="op" id="4366068">]</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4366072">case</span>&nbsp;<span class="ident" id="4366077">r</span>&nbsp;<span class="op" id="4366079">==</span>&nbsp;<span class="string" id="4366082">&#39;\u2028&#39;</span><span class="op" id="4366090">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4366095">repl</span>&nbsp;<span class="op" id="4366100">=</span>&nbsp;<span class="string" id="4366102">`\u2028`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4366113">case</span>&nbsp;<span class="ident" id="4366118">r</span>&nbsp;<span class="op" id="4366120">==</span>&nbsp;<span class="string" id="4366123">&#39;\u2029&#39;</span><span class="op" id="4366131">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4366136">repl</span>&nbsp;<span class="op" id="4366141">=</span>&nbsp;<span class="string" id="4366143">`\u2029`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4366154">default</span><span class="op" id="4366161">:</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4366166">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4366177">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4366181">b</span><span class="op" id="4366182">.</span><span class="ident" id="4366183">WriteString</span><span class="op" id="4366194">(</span><span class="ident" id="4366195">s</span><span class="op" id="4366196">[</span><span class="ident" id="4366197">written</span><span class="op" id="4366204">:</span><span class="ident" id="4366205">i</span><span class="op" id="4366206">]</span><span class="op" id="4366207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4366211">b</span><span class="op" id="4366212">.</span><span class="ident" id="4366213">WriteString</span><span class="op" id="4366224">(</span><span class="ident" id="4366225">repl</span><span class="op" id="4366229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4366233">written</span>&nbsp;<span class="op" id="4366241">=</span>&nbsp;<span class="ident" id="4366243">i</span>&nbsp;<span class="op" id="4366245">+</span>&nbsp;<span class="ident" id="4366247">utf8</span><span class="op" id="4366251">.</span><span class="ident" id="4366252">RuneLen</span><span class="op" id="4366259">(</span><span class="ident" id="4366260">r</span><span class="op" id="4366261">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4366264">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4366267">if</span>&nbsp;<span class="ident" id="4366270">written</span>&nbsp;<span class="op" id="4366278">==</span>&nbsp;<span class="num" id="4366281">0</span>&nbsp;<span class="op" id="4366283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4366287">return</span>&nbsp;<span class="ident" id="4366294">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4366297">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4366300">b</span><span class="op" id="4366301">.</span><span class="ident" id="4366302">WriteString</span><span class="op" id="4366313">(</span><span class="ident" id="4366314">s</span><span class="op" id="4366315">[</span><span class="ident" id="4366316">written</span><span class="op" id="4366323">:</span><span class="op" id="4366324">]</span><span class="op" id="4366325">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4366328">return</span>&nbsp;<span class="ident" id="4366335">b</span><span class="op" id="4366336">.</span><span class="ident" id="4366337">String</span><span class="op" id="4366343">(</span><span class="op" id="4366344">)</span><br>
<span class="lineno"></span><span class="op" id="4366346">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4366349">var</span>&nbsp;<span class="ident" id="4366353">jsStrReplacementTable</span>&nbsp;<span class="op" id="4366375">=</span>&nbsp;<span class="op" id="4366377">[</span><span class="op" id="4366378">]</span><span class="builtintype" id="4366379">string</span><span class="op" id="4366385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4366388">0</span><span class="op" id="4366389">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4366394">`\0`</span><span class="op" id="4366398">,</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4366401">&#39;\t&#39;</span><span class="op" id="4366405">:</span>&nbsp;<span class="string" id="4366407">`\t`</span><span class="op" id="4366411">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4366414">&#39;\n&#39;</span><span class="op" id="4366418">:</span>&nbsp;<span class="string" id="4366420">`\n`</span><span class="op" id="4366424">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4366427">&#39;\v&#39;</span><span class="op" id="4366431">:</span>&nbsp;<span class="string" id="4366433">`\x0b`</span><span class="op" id="4366439">,</span>&nbsp;<span class="comment" id="4366441">//&nbsp;&#34;\v&#34;&nbsp;==&nbsp;&#34;v&#34;&nbsp;on&nbsp;IE&nbsp;6.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4366466">&#39;\f&#39;</span><span class="op" id="4366470">:</span>&nbsp;<span class="string" id="4366472">`\f`</span><span class="op" id="4366476">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4366479">&#39;\r&#39;</span><span class="op" id="4366483">:</span>&nbsp;<span class="string" id="4366485">`\r`</span><span class="op" id="4366489">,</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4366492">//&nbsp;Encode&nbsp;HTML&nbsp;specials&nbsp;as&nbsp;hex&nbsp;so&nbsp;the&nbsp;output&nbsp;can&nbsp;be&nbsp;embedded</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4366554">//&nbsp;in&nbsp;HTML&nbsp;attributes&nbsp;without&nbsp;further&nbsp;encoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4366603">&#39;&#34;&#39;</span><span class="op" id="4366606">:</span>&nbsp;&nbsp;<span class="string" id="4366609">`\x22`</span><span class="op" id="4366615">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4366618">&#39;&amp;&#39;</span><span class="op" id="4366621">:</span>&nbsp;&nbsp;<span class="string" id="4366624">`\x26`</span><span class="op" id="4366630">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4366633">&#39;\&#39;&#39;</span><span class="op" id="4366637">:</span>&nbsp;<span class="string" id="4366639">`\x27`</span><span class="op" id="4366645">,</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4366648">&#39;+&#39;</span><span class="op" id="4366651">:</span>&nbsp;&nbsp;<span class="string" id="4366654">`\x2b`</span><span class="op" id="4366660">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4366663">&#39;/&#39;</span><span class="op" id="4366666">:</span>&nbsp;&nbsp;<span class="string" id="4366669">`\/`</span><span class="op" id="4366673">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4366676">&#39;&lt;&#39;</span><span class="op" id="4366679">:</span>&nbsp;&nbsp;<span class="string" id="4366682">`\x3c`</span><span class="op" id="4366688">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4366691">&#39;&gt;&#39;</span><span class="op" id="4366694">:</span>&nbsp;&nbsp;<span class="string" id="4366697">`\x3e`</span><span class="op" id="4366703">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4366706">&#39;\\&#39;</span><span class="op" id="4366710">:</span>&nbsp;<span class="string" id="4366712">`\\`</span><span class="op" id="4366716">,</span><br>
<span class="lineno">290</span><span class="op" id="4366718">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4366721">//&nbsp;jsStrNormReplacementTable&nbsp;is&nbsp;like&nbsp;jsStrReplacementTable&nbsp;but&nbsp;does&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="4366793">//&nbsp;overencode&nbsp;existing&nbsp;escapes&nbsp;since&nbsp;this&nbsp;table&nbsp;has&nbsp;no&nbsp;entry&nbsp;for&nbsp;`\`.</span><br>
<span class="lineno"></span><span class="keyword" id="4366863">var</span>&nbsp;<span class="ident" id="4366867">jsStrNormReplacementTable</span>&nbsp;<span class="op" id="4366893">=</span>&nbsp;<span class="op" id="4366895">[</span><span class="op" id="4366896">]</span><span class="builtintype" id="4366897">string</span><span class="op" id="4366903">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4366906">0</span><span class="op" id="4366907">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4366912">`\0`</span><span class="op" id="4366916">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4366919">&#39;\t&#39;</span><span class="op" id="4366923">:</span>&nbsp;<span class="string" id="4366925">`\t`</span><span class="op" id="4366929">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4366932">&#39;\n&#39;</span><span class="op" id="4366936">:</span>&nbsp;<span class="string" id="4366938">`\n`</span><span class="op" id="4366942">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4366945">&#39;\v&#39;</span><span class="op" id="4366949">:</span>&nbsp;<span class="string" id="4366951">`\x0b`</span><span class="op" id="4366957">,</span>&nbsp;<span class="comment" id="4366959">//&nbsp;&#34;\v&#34;&nbsp;==&nbsp;&#34;v&#34;&nbsp;on&nbsp;IE&nbsp;6.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4366984">&#39;\f&#39;</span><span class="op" id="4366988">:</span>&nbsp;<span class="string" id="4366990">`\f`</span><span class="op" id="4366994">,</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4366997">&#39;\r&#39;</span><span class="op" id="4367001">:</span>&nbsp;<span class="string" id="4367003">`\r`</span><span class="op" id="4367007">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4367010">//&nbsp;Encode&nbsp;HTML&nbsp;specials&nbsp;as&nbsp;hex&nbsp;so&nbsp;the&nbsp;output&nbsp;can&nbsp;be&nbsp;embedded</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4367072">//&nbsp;in&nbsp;HTML&nbsp;attributes&nbsp;without&nbsp;further&nbsp;encoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4367121">&#39;&#34;&#39;</span><span class="op" id="4367124">:</span>&nbsp;&nbsp;<span class="string" id="4367127">`\x22`</span><span class="op" id="4367133">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4367136">&#39;&amp;&#39;</span><span class="op" id="4367139">:</span>&nbsp;&nbsp;<span class="string" id="4367142">`\x26`</span><span class="op" id="4367148">,</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4367151">&#39;\&#39;&#39;</span><span class="op" id="4367155">:</span>&nbsp;<span class="string" id="4367157">`\x27`</span><span class="op" id="4367163">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4367166">&#39;+&#39;</span><span class="op" id="4367169">:</span>&nbsp;&nbsp;<span class="string" id="4367172">`\x2b`</span><span class="op" id="4367178">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4367181">&#39;/&#39;</span><span class="op" id="4367184">:</span>&nbsp;&nbsp;<span class="string" id="4367187">`\/`</span><span class="op" id="4367191">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4367194">&#39;&lt;&#39;</span><span class="op" id="4367197">:</span>&nbsp;&nbsp;<span class="string" id="4367200">`\x3c`</span><span class="op" id="4367206">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4367209">&#39;&gt;&#39;</span><span class="op" id="4367212">:</span>&nbsp;&nbsp;<span class="string" id="4367215">`\x3e`</span><span class="op" id="4367221">,</span><br>
<span class="lineno">310</span><span class="op" id="4367223">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4367226">var</span>&nbsp;<span class="ident" id="4367230">jsRegexpReplacementTable</span>&nbsp;<span class="op" id="4367255">=</span>&nbsp;<span class="op" id="4367257">[</span><span class="op" id="4367258">]</span><span class="builtintype" id="4367259">string</span><span class="op" id="4367265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4367268">0</span><span class="op" id="4367269">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4367274">`\0`</span><span class="op" id="4367278">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4367281">&#39;\t&#39;</span><span class="op" id="4367285">:</span>&nbsp;<span class="string" id="4367287">`\t`</span><span class="op" id="4367291">,</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4367294">&#39;\n&#39;</span><span class="op" id="4367298">:</span>&nbsp;<span class="string" id="4367300">`\n`</span><span class="op" id="4367304">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4367307">&#39;\v&#39;</span><span class="op" id="4367311">:</span>&nbsp;<span class="string" id="4367313">`\x0b`</span><span class="op" id="4367319">,</span>&nbsp;<span class="comment" id="4367321">//&nbsp;&#34;\v&#34;&nbsp;==&nbsp;&#34;v&#34;&nbsp;on&nbsp;IE&nbsp;6.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4367346">&#39;\f&#39;</span><span class="op" id="4367350">:</span>&nbsp;<span class="string" id="4367352">`\f`</span><span class="op" id="4367356">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4367359">&#39;\r&#39;</span><span class="op" id="4367363">:</span>&nbsp;<span class="string" id="4367365">`\r`</span><span class="op" id="4367369">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4367372">//&nbsp;Encode&nbsp;HTML&nbsp;specials&nbsp;as&nbsp;hex&nbsp;so&nbsp;the&nbsp;output&nbsp;can&nbsp;be&nbsp;embedded</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4367434">//&nbsp;in&nbsp;HTML&nbsp;attributes&nbsp;without&nbsp;further&nbsp;encoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4367483">&#39;&#34;&#39;</span><span class="op" id="4367486">:</span>&nbsp;&nbsp;<span class="string" id="4367489">`\x22`</span><span class="op" id="4367495">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4367498">&#39;$&#39;</span><span class="op" id="4367501">:</span>&nbsp;&nbsp;<span class="string" id="4367504">`\$`</span><span class="op" id="4367508">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4367511">&#39;&amp;&#39;</span><span class="op" id="4367514">:</span>&nbsp;&nbsp;<span class="string" id="4367517">`\x26`</span><span class="op" id="4367523">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4367526">&#39;\&#39;&#39;</span><span class="op" id="4367530">:</span>&nbsp;<span class="string" id="4367532">`\x27`</span><span class="op" id="4367538">,</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4367541">&#39;(&#39;</span><span class="op" id="4367544">:</span>&nbsp;&nbsp;<span class="string" id="4367547">`\(`</span><span class="op" id="4367551">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4367554">&#39;)&#39;</span><span class="op" id="4367557">:</span>&nbsp;&nbsp;<span class="string" id="4367560">`\)`</span><span class="op" id="4367564">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4367567">&#39;*&#39;</span><span class="op" id="4367570">:</span>&nbsp;&nbsp;<span class="string" id="4367573">`\*`</span><span class="op" id="4367577">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4367580">&#39;+&#39;</span><span class="op" id="4367583">:</span>&nbsp;&nbsp;<span class="string" id="4367586">`\x2b`</span><span class="op" id="4367592">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4367595">&#39;-&#39;</span><span class="op" id="4367598">:</span>&nbsp;&nbsp;<span class="string" id="4367601">`\-`</span><span class="op" id="4367605">,</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4367608">&#39;.&#39;</span><span class="op" id="4367611">:</span>&nbsp;&nbsp;<span class="string" id="4367614">`\.`</span><span class="op" id="4367618">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4367621">&#39;/&#39;</span><span class="op" id="4367624">:</span>&nbsp;&nbsp;<span class="string" id="4367627">`\/`</span><span class="op" id="4367631">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4367634">&#39;&lt;&#39;</span><span class="op" id="4367637">:</span>&nbsp;&nbsp;<span class="string" id="4367640">`\x3c`</span><span class="op" id="4367646">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4367649">&#39;&gt;&#39;</span><span class="op" id="4367652">:</span>&nbsp;&nbsp;<span class="string" id="4367655">`\x3e`</span><span class="op" id="4367661">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4367664">&#39;?&#39;</span><span class="op" id="4367667">:</span>&nbsp;&nbsp;<span class="string" id="4367670">`\?`</span><span class="op" id="4367674">,</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4367677">&#39;[&#39;</span><span class="op" id="4367680">:</span>&nbsp;&nbsp;<span class="string" id="4367683">`\[`</span><span class="op" id="4367687">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4367690">&#39;\\&#39;</span><span class="op" id="4367694">:</span>&nbsp;<span class="string" id="4367696">`\\`</span><span class="op" id="4367700">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4367703">&#39;]&#39;</span><span class="op" id="4367706">:</span>&nbsp;&nbsp;<span class="string" id="4367709">`\]`</span><span class="op" id="4367713">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4367716">&#39;^&#39;</span><span class="op" id="4367719">:</span>&nbsp;&nbsp;<span class="string" id="4367722">`\^`</span><span class="op" id="4367726">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4367729">&#39;{&#39;</span><span class="op" id="4367732">:</span>&nbsp;&nbsp;<span class="string" id="4367735">`\{`</span><span class="op" id="4367739">,</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4367742">&#39;|&#39;</span><span class="op" id="4367745">:</span>&nbsp;&nbsp;<span class="string" id="4367748">`\|`</span><span class="op" id="4367752">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4367755">&#39;}&#39;</span><span class="op" id="4367758">:</span>&nbsp;&nbsp;<span class="string" id="4367761">`\}`</span><span class="op" id="4367765">,</span><br>
<span class="lineno"></span><span class="op" id="4367767">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4367770">//&nbsp;isJSIdentPart&nbsp;reports&nbsp;whether&nbsp;the&nbsp;given&nbsp;rune&nbsp;is&nbsp;a&nbsp;JS&nbsp;identifier&nbsp;part.</span><br>
<span class="lineno">345</span><span class="comment" id="4367843">//&nbsp;It&nbsp;does&nbsp;not&nbsp;handle&nbsp;all&nbsp;the&nbsp;non-Latin&nbsp;letters,&nbsp;joiners,&nbsp;and&nbsp;combining&nbsp;marks,</span><br>
<span class="lineno"></span><span class="comment" id="4367922">//&nbsp;but&nbsp;it&nbsp;does&nbsp;handle&nbsp;every&nbsp;codepoint&nbsp;that&nbsp;can&nbsp;occur&nbsp;in&nbsp;a&nbsp;numeric&nbsp;literal&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="4367999">//&nbsp;a&nbsp;keyword.</span><br>
<span class="lineno"></span><span class="keyword" id="4368013">func</span>&nbsp;<span class="ident" id="4368018">isJSIdentPart</span><span class="op" id="4368031">(</span><span class="ident" id="4368032">r</span>&nbsp;<span class="builtintype" id="4368034">rune</span><span class="op" id="4368038">)</span>&nbsp;<span class="builtintype" id="4368040">bool</span>&nbsp;<span class="op" id="4368045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4368048">switch</span>&nbsp;<span class="op" id="4368055">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4368058">case</span>&nbsp;<span class="ident" id="4368063">r</span>&nbsp;<span class="op" id="4368065">==</span>&nbsp;<span class="string" id="4368068">&#39;$&#39;</span><span class="op" id="4368071">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4368075">return</span>&nbsp;<span class="builtintype" id="4368082">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4368088">case</span>&nbsp;<span class="string" id="4368093">&#39;0&#39;</span>&nbsp;<span class="op" id="4368097">&lt;=</span>&nbsp;<span class="ident" id="4368100">r</span>&nbsp;<span class="op" id="4368102">&amp;&amp;</span>&nbsp;<span class="ident" id="4368105">r</span>&nbsp;<span class="op" id="4368107">&lt;=</span>&nbsp;<span class="string" id="4368110">&#39;9&#39;</span><span class="op" id="4368113">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4368117">return</span>&nbsp;<span class="builtintype" id="4368124">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4368130">case</span>&nbsp;<span class="string" id="4368135">&#39;A&#39;</span>&nbsp;<span class="op" id="4368139">&lt;=</span>&nbsp;<span class="ident" id="4368142">r</span>&nbsp;<span class="op" id="4368144">&amp;&amp;</span>&nbsp;<span class="ident" id="4368147">r</span>&nbsp;<span class="op" id="4368149">&lt;=</span>&nbsp;<span class="string" id="4368152">&#39;Z&#39;</span><span class="op" id="4368155">:</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4368159">return</span>&nbsp;<span class="builtintype" id="4368166">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4368172">case</span>&nbsp;<span class="ident" id="4368177">r</span>&nbsp;<span class="op" id="4368179">==</span>&nbsp;<span class="string" id="4368182">&#39;_&#39;</span><span class="op" id="4368185">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4368189">return</span>&nbsp;<span class="builtintype" id="4368196">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4368202">case</span>&nbsp;<span class="string" id="4368207">&#39;a&#39;</span>&nbsp;<span class="op" id="4368211">&lt;=</span>&nbsp;<span class="ident" id="4368214">r</span>&nbsp;<span class="op" id="4368216">&amp;&amp;</span>&nbsp;<span class="ident" id="4368219">r</span>&nbsp;<span class="op" id="4368221">&lt;=</span>&nbsp;<span class="string" id="4368224">&#39;z&#39;</span><span class="op" id="4368227">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4368231">return</span>&nbsp;<span class="builtintype" id="4368238">true</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4368244">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4368247">return</span>&nbsp;<span class="builtintype" id="4368254">false</span><br>
<span class="lineno"></span><span class="op" id="4368260">}</span>
</div>
</body>
</html>
