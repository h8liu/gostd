<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3105114">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3105170">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3105224">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3105275">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris&nbsp;windows</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3105353">package</span>&nbsp;<span class="ident" id="3105361">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3105366">import</span>&nbsp;<span class="op" id="3105373">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3105376">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3105382">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3105393">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3105400">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="3105403">//&nbsp;A&nbsp;sockaddr&nbsp;represents&nbsp;a&nbsp;TCP,&nbsp;UDP,&nbsp;IP&nbsp;or&nbsp;Unix&nbsp;network&nbsp;endpoint</span><br>
<span class="lineno"></span><span class="comment" id="3105468">//&nbsp;address&nbsp;that&nbsp;can&nbsp;be&nbsp;converted&nbsp;into&nbsp;a&nbsp;syscall.Sockaddr.</span><br>
<span class="lineno"></span><span class="keyword" id="3105526">type</span>&nbsp;<span class="ident" id="3105531">sockaddr</span>&nbsp;<span class="keyword" id="3105540">interface</span>&nbsp;<span class="op" id="3105550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3105553">Addr</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3105560">netaddr</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3105570">//&nbsp;family&nbsp;returns&nbsp;the&nbsp;platform-dependent&nbsp;address&nbsp;family</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3105627">//&nbsp;identifier.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3105643">family</span><span class="op" id="3105649">(</span><span class="op" id="3105650">)</span>&nbsp;<span class="builtintype" id="3105652">int</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3105658">//&nbsp;isWildcard&nbsp;reports&nbsp;whether&nbsp;the&nbsp;address&nbsp;is&nbsp;a&nbsp;wildcard</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3105715">//&nbsp;address.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3105728">isWildcard</span><span class="op" id="3105738">(</span><span class="op" id="3105739">)</span>&nbsp;<span class="builtintype" id="3105741">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3105748">//&nbsp;sockaddr&nbsp;returns&nbsp;the&nbsp;address&nbsp;converted&nbsp;into&nbsp;a&nbsp;syscall</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3105806">//&nbsp;sockaddr&nbsp;type&nbsp;that&nbsp;implements&nbsp;syscall.Sockaddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3105857">//&nbsp;interface.&nbsp;It&nbsp;returns&nbsp;a&nbsp;nil&nbsp;interface&nbsp;when&nbsp;the&nbsp;address&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3105919">//&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3105928">sockaddr</span><span class="op" id="3105936">(</span><span class="ident" id="3105937">family</span>&nbsp;<span class="builtintype" id="3105944">int</span><span class="op" id="3105947">)</span>&nbsp;<span class="op" id="3105949">(</span><span class="ident" id="3105950">syscall</span><span class="op" id="3105957">.</span><span class="ident" id="3105958">Sockaddr</span><span class="op" id="3105966">,</span>&nbsp;<span class="builtintype" id="3105968">error</span><span class="op" id="3105973">)</span><br>
<span class="lineno">35</span><span class="op" id="3105975">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3105978">//&nbsp;socket&nbsp;returns&nbsp;a&nbsp;network&nbsp;file&nbsp;descriptor&nbsp;that&nbsp;is&nbsp;ready&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="3106040">//&nbsp;asynchronous&nbsp;I/O&nbsp;using&nbsp;the&nbsp;network&nbsp;poller.</span><br>
<span class="lineno"></span><span class="keyword" id="3106086">func</span>&nbsp;<span class="ident" id="3106091">socket</span><span class="op" id="3106097">(</span><span class="ident" id="3106098">net</span>&nbsp;<span class="builtintype" id="3106102">string</span><span class="op" id="3106108">,</span>&nbsp;<span class="ident" id="3106110">family</span><span class="op" id="3106116">,</span>&nbsp;<span class="ident" id="3106118">sotype</span><span class="op" id="3106124">,</span>&nbsp;<span class="ident" id="3106126">proto</span>&nbsp;<span class="builtintype" id="3106132">int</span><span class="op" id="3106135">,</span>&nbsp;<span class="ident" id="3106137">ipv6only</span>&nbsp;<span class="builtintype" id="3106146">bool</span><span class="op" id="3106150">,</span>&nbsp;<span class="ident" id="3106152">laddr</span><span class="op" id="3106157">,</span>&nbsp;<span class="ident" id="3106159">raddr</span>&nbsp;<span class="ident" id="3106165">sockaddr</span><span class="op" id="3106173">,</span>&nbsp;<span class="ident" id="3106175">deadline</span>&nbsp;<span class="ident" id="3106184">time</span><span class="op" id="3106188">.</span><span class="ident" id="3106189">Time</span><span class="op" id="3106193">)</span>&nbsp;<span class="op" id="3106195">(</span><span class="ident" id="3106196">fd</span>&nbsp;<span class="op" id="3106199">*</span><span class="ident" id="3106200">netFD</span><span class="op" id="3106205">,</span>&nbsp;<span class="ident" id="3106207">err</span>&nbsp;<span class="builtintype" id="3106211">error</span><span class="op" id="3106216">)</span>&nbsp;<span class="op" id="3106218">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3106221">s</span><span class="op" id="3106222">,</span>&nbsp;<span class="ident" id="3106224">err</span>&nbsp;<span class="op" id="3106228">:=</span>&nbsp;<span class="ident" id="3106231">sysSocket</span><span class="op" id="3106240">(</span><span class="ident" id="3106241">family</span><span class="op" id="3106247">,</span>&nbsp;<span class="ident" id="3106249">sotype</span><span class="op" id="3106255">,</span>&nbsp;<span class="ident" id="3106257">proto</span><span class="op" id="3106262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3106265">if</span>&nbsp;<span class="ident" id="3106268">err</span>&nbsp;<span class="op" id="3106272">!=</span>&nbsp;<span class="ident" id="3106275">nil</span>&nbsp;<span class="op" id="3106279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3106283">return</span>&nbsp;<span class="ident" id="3106290">nil</span><span class="op" id="3106293">,</span>&nbsp;<span class="ident" id="3106295">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3106300">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3106303">if</span>&nbsp;<span class="ident" id="3106306">err</span>&nbsp;<span class="op" id="3106310">=</span>&nbsp;<span class="ident" id="3106312">setDefaultSockopts</span><span class="op" id="3106330">(</span><span class="ident" id="3106331">s</span><span class="op" id="3106332">,</span>&nbsp;<span class="ident" id="3106334">family</span><span class="op" id="3106340">,</span>&nbsp;<span class="ident" id="3106342">sotype</span><span class="op" id="3106348">,</span>&nbsp;<span class="ident" id="3106350">ipv6only</span><span class="op" id="3106358">)</span><span class="op" id="3106359">;</span>&nbsp;<span class="ident" id="3106361">err</span>&nbsp;<span class="op" id="3106365">!=</span>&nbsp;<span class="ident" id="3106368">nil</span>&nbsp;<span class="op" id="3106372">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3106376">closesocket</span><span class="op" id="3106387">(</span><span class="ident" id="3106388">s</span><span class="op" id="3106389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3106393">return</span>&nbsp;<span class="ident" id="3106400">nil</span><span class="op" id="3106403">,</span>&nbsp;<span class="ident" id="3106405">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3106410">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3106413">if</span>&nbsp;<span class="ident" id="3106416">fd</span><span class="op" id="3106418">,</span>&nbsp;<span class="ident" id="3106420">err</span>&nbsp;<span class="op" id="3106424">=</span>&nbsp;<span class="ident" id="3106426">newFD</span><span class="op" id="3106431">(</span><span class="ident" id="3106432">s</span><span class="op" id="3106433">,</span>&nbsp;<span class="ident" id="3106435">family</span><span class="op" id="3106441">,</span>&nbsp;<span class="ident" id="3106443">sotype</span><span class="op" id="3106449">,</span>&nbsp;<span class="ident" id="3106451">net</span><span class="op" id="3106454">)</span><span class="op" id="3106455">;</span>&nbsp;<span class="ident" id="3106457">err</span>&nbsp;<span class="op" id="3106461">!=</span>&nbsp;<span class="ident" id="3106464">nil</span>&nbsp;<span class="op" id="3106468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3106472">closesocket</span><span class="op" id="3106483">(</span><span class="ident" id="3106484">s</span><span class="op" id="3106485">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3106489">return</span>&nbsp;<span class="ident" id="3106496">nil</span><span class="op" id="3106499">,</span>&nbsp;<span class="ident" id="3106501">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3106506">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3106510">//&nbsp;This&nbsp;function&nbsp;makes&nbsp;a&nbsp;network&nbsp;file&nbsp;descriptor&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3106568">//&nbsp;following&nbsp;applications:</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3106596">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3106600">//&nbsp;-&nbsp;An&nbsp;endpoint&nbsp;holder&nbsp;that&nbsp;opens&nbsp;a&nbsp;passive&nbsp;stream</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3106653">//&nbsp;&nbsp;&nbsp;connenction,&nbsp;known&nbsp;as&nbsp;a&nbsp;stream&nbsp;listener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3106699">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3106703">//&nbsp;-&nbsp;An&nbsp;endpoint&nbsp;holder&nbsp;that&nbsp;opens&nbsp;a&nbsp;destination-unspecific</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3106764">//&nbsp;&nbsp;&nbsp;datagram&nbsp;connection,&nbsp;known&nbsp;as&nbsp;a&nbsp;datagram&nbsp;listener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3106820">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3106824">//&nbsp;-&nbsp;An&nbsp;endpoint&nbsp;holder&nbsp;that&nbsp;opens&nbsp;an&nbsp;active&nbsp;stream&nbsp;or&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3106882">//&nbsp;&nbsp;&nbsp;destination-specific&nbsp;datagram&nbsp;connection,&nbsp;known&nbsp;as&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3106941">//&nbsp;&nbsp;&nbsp;dialer</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3106954">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3106958">//&nbsp;-&nbsp;An&nbsp;endpoint&nbsp;holder&nbsp;that&nbsp;opens&nbsp;the&nbsp;other&nbsp;connection,&nbsp;such</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3107021">//&nbsp;&nbsp;&nbsp;as&nbsp;talking&nbsp;to&nbsp;the&nbsp;protocol&nbsp;stack&nbsp;inside&nbsp;the&nbsp;kernel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3107078">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3107082">//&nbsp;For&nbsp;stream&nbsp;and&nbsp;datagram&nbsp;listeners,&nbsp;they&nbsp;will&nbsp;only&nbsp;require</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3107144">//&nbsp;named&nbsp;sockets,&nbsp;so&nbsp;we&nbsp;can&nbsp;assume&nbsp;that&nbsp;it&#39;s&nbsp;just&nbsp;a&nbsp;request</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3107205">//&nbsp;from&nbsp;stream&nbsp;or&nbsp;datagram&nbsp;listeners&nbsp;when&nbsp;laddr&nbsp;is&nbsp;not&nbsp;nil&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3107269">//&nbsp;raddr&nbsp;is&nbsp;nil.&nbsp;Otherwise&nbsp;we&nbsp;assume&nbsp;it&#39;s&nbsp;just&nbsp;for&nbsp;dialers&nbsp;or</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3107332">//&nbsp;the&nbsp;other&nbsp;connection&nbsp;holders.</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3107367">if</span>&nbsp;<span class="ident" id="3107370">laddr</span>&nbsp;<span class="op" id="3107376">!=</span>&nbsp;<span class="ident" id="3107379">nil</span>&nbsp;<span class="op" id="3107383">&amp;&amp;</span>&nbsp;<span class="ident" id="3107386">raddr</span>&nbsp;<span class="op" id="3107392">==</span>&nbsp;<span class="ident" id="3107395">nil</span>&nbsp;<span class="op" id="3107399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3107403">switch</span>&nbsp;<span class="ident" id="3107410">sotype</span>&nbsp;<span class="op" id="3107417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3107421">case</span>&nbsp;<span class="ident" id="3107426">syscall</span><span class="op" id="3107433">.</span><span class="ident" id="3107434">SOCK_STREAM</span><span class="op" id="3107445">,</span>&nbsp;<span class="ident" id="3107447">syscall</span><span class="op" id="3107454">.</span><span class="ident" id="3107455">SOCK_SEQPACKET</span><span class="op" id="3107469">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3107474">if</span>&nbsp;<span class="ident" id="3107477">err</span>&nbsp;<span class="op" id="3107481">:=</span>&nbsp;<span class="ident" id="3107484">fd</span><span class="op" id="3107486">.</span><span class="ident" id="3107487">listenStream</span><span class="op" id="3107499">(</span><span class="ident" id="3107500">laddr</span><span class="op" id="3107505">,</span>&nbsp;<span class="ident" id="3107507">listenerBacklog</span><span class="op" id="3107522">)</span><span class="op" id="3107523">;</span>&nbsp;<span class="ident" id="3107525">err</span>&nbsp;<span class="op" id="3107529">!=</span>&nbsp;<span class="ident" id="3107532">nil</span>&nbsp;<span class="op" id="3107536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3107542">fd</span><span class="op" id="3107544">.</span><span class="ident" id="3107545">Close</span><span class="op" id="3107550">(</span><span class="op" id="3107551">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3107557">return</span>&nbsp;<span class="ident" id="3107564">nil</span><span class="op" id="3107567">,</span>&nbsp;<span class="ident" id="3107569">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3107576">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3107581">return</span>&nbsp;<span class="ident" id="3107588">fd</span><span class="op" id="3107590">,</span>&nbsp;<span class="ident" id="3107592">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3107598">case</span>&nbsp;<span class="ident" id="3107603">syscall</span><span class="op" id="3107610">.</span><span class="ident" id="3107611">SOCK_DGRAM</span><span class="op" id="3107621">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3107626">if</span>&nbsp;<span class="ident" id="3107629">err</span>&nbsp;<span class="op" id="3107633">:=</span>&nbsp;<span class="ident" id="3107636">fd</span><span class="op" id="3107638">.</span><span class="ident" id="3107639">listenDatagram</span><span class="op" id="3107653">(</span><span class="ident" id="3107654">laddr</span><span class="op" id="3107659">)</span><span class="op" id="3107660">;</span>&nbsp;<span class="ident" id="3107662">err</span>&nbsp;<span class="op" id="3107666">!=</span>&nbsp;<span class="ident" id="3107669">nil</span>&nbsp;<span class="op" id="3107673">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3107679">fd</span><span class="op" id="3107681">.</span><span class="ident" id="3107682">Close</span><span class="op" id="3107687">(</span><span class="op" id="3107688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3107694">return</span>&nbsp;<span class="ident" id="3107701">nil</span><span class="op" id="3107704">,</span>&nbsp;<span class="ident" id="3107706">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3107713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3107718">return</span>&nbsp;<span class="ident" id="3107725">fd</span><span class="op" id="3107727">,</span>&nbsp;<span class="ident" id="3107729">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3107735">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3107738">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3107741">if</span>&nbsp;<span class="ident" id="3107744">err</span>&nbsp;<span class="op" id="3107748">:=</span>&nbsp;<span class="ident" id="3107751">fd</span><span class="op" id="3107753">.</span><span class="ident" id="3107754">dial</span><span class="op" id="3107758">(</span><span class="ident" id="3107759">laddr</span><span class="op" id="3107764">,</span>&nbsp;<span class="ident" id="3107766">raddr</span><span class="op" id="3107771">,</span>&nbsp;<span class="ident" id="3107773">deadline</span><span class="op" id="3107781">)</span><span class="op" id="3107782">;</span>&nbsp;<span class="ident" id="3107784">err</span>&nbsp;<span class="op" id="3107788">!=</span>&nbsp;<span class="ident" id="3107791">nil</span>&nbsp;<span class="op" id="3107795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3107799">fd</span><span class="op" id="3107801">.</span><span class="ident" id="3107802">Close</span><span class="op" id="3107807">(</span><span class="op" id="3107808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3107812">return</span>&nbsp;<span class="ident" id="3107819">nil</span><span class="op" id="3107822">,</span>&nbsp;<span class="ident" id="3107824">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3107829">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3107832">return</span>&nbsp;<span class="ident" id="3107839">fd</span><span class="op" id="3107841">,</span>&nbsp;<span class="ident" id="3107843">nil</span><br>
<span class="lineno"></span><span class="op" id="3107847">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3107850">func</span>&nbsp;<span class="op" id="3107855">(</span><span class="ident" id="3107856">fd</span>&nbsp;<span class="op" id="3107859">*</span><span class="ident" id="3107860">netFD</span><span class="op" id="3107865">)</span>&nbsp;<span class="ident" id="3107867">addrFunc</span><span class="op" id="3107875">(</span><span class="op" id="3107876">)</span>&nbsp;<span class="keyword" id="3107878">func</span><span class="op" id="3107882">(</span><span class="ident" id="3107883">syscall</span><span class="op" id="3107890">.</span><span class="ident" id="3107891">Sockaddr</span><span class="op" id="3107899">)</span>&nbsp;<span class="ident" id="3107901">Addr</span>&nbsp;<span class="op" id="3107906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3107909">switch</span>&nbsp;<span class="ident" id="3107916">fd</span><span class="op" id="3107918">.</span><span class="ident" id="3107919">family</span>&nbsp;<span class="op" id="3107926">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3107929">case</span>&nbsp;<span class="ident" id="3107934">syscall</span><span class="op" id="3107941">.</span><span class="ident" id="3107942">AF_INET</span><span class="op" id="3107949">,</span>&nbsp;<span class="ident" id="3107951">syscall</span><span class="op" id="3107958">.</span><span class="ident" id="3107959">AF_INET6</span><span class="op" id="3107967">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3107971">switch</span>&nbsp;<span class="ident" id="3107978">fd</span><span class="op" id="3107980">.</span><span class="ident" id="3107981">sotype</span>&nbsp;<span class="op" id="3107988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3107992">case</span>&nbsp;<span class="ident" id="3107997">syscall</span><span class="op" id="3108004">.</span><span class="ident" id="3108005">SOCK_STREAM</span><span class="op" id="3108016">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3108021">return</span>&nbsp;<span class="ident" id="3108028">sockaddrToTCP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3108044">case</span>&nbsp;<span class="ident" id="3108049">syscall</span><span class="op" id="3108056">.</span><span class="ident" id="3108057">SOCK_DGRAM</span><span class="op" id="3108067">:</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3108072">return</span>&nbsp;<span class="ident" id="3108079">sockaddrToUDP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3108095">case</span>&nbsp;<span class="ident" id="3108100">syscall</span><span class="op" id="3108107">.</span><span class="ident" id="3108108">SOCK_RAW</span><span class="op" id="3108116">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3108121">return</span>&nbsp;<span class="ident" id="3108128">sockaddrToIP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3108143">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3108146">case</span>&nbsp;<span class="ident" id="3108151">syscall</span><span class="op" id="3108158">.</span><span class="ident" id="3108159">AF_UNIX</span><span class="op" id="3108166">:</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3108170">switch</span>&nbsp;<span class="ident" id="3108177">fd</span><span class="op" id="3108179">.</span><span class="ident" id="3108180">sotype</span>&nbsp;<span class="op" id="3108187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3108191">case</span>&nbsp;<span class="ident" id="3108196">syscall</span><span class="op" id="3108203">.</span><span class="ident" id="3108204">SOCK_STREAM</span><span class="op" id="3108215">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3108220">return</span>&nbsp;<span class="ident" id="3108227">sockaddrToUnix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3108244">case</span>&nbsp;<span class="ident" id="3108249">syscall</span><span class="op" id="3108256">.</span><span class="ident" id="3108257">SOCK_DGRAM</span><span class="op" id="3108267">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3108272">return</span>&nbsp;<span class="ident" id="3108279">sockaddrToUnixgram</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3108300">case</span>&nbsp;<span class="ident" id="3108305">syscall</span><span class="op" id="3108312">.</span><span class="ident" id="3108313">SOCK_SEQPACKET</span><span class="op" id="3108327">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3108332">return</span>&nbsp;<span class="ident" id="3108339">sockaddrToUnixpacket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3108362">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3108365">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3108368">return</span>&nbsp;<span class="keyword" id="3108375">func</span><span class="op" id="3108379">(</span><span class="ident" id="3108380">syscall</span><span class="op" id="3108387">.</span><span class="ident" id="3108388">Sockaddr</span><span class="op" id="3108396">)</span>&nbsp;<span class="ident" id="3108398">Addr</span>&nbsp;<span class="op" id="3108403">{</span>&nbsp;<span class="keyword" id="3108405">return</span>&nbsp;<span class="ident" id="3108412">nil</span>&nbsp;<span class="op" id="3108416">}</span><br>
<span class="lineno">120</span><span class="op" id="3108418">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3108421">func</span>&nbsp;<span class="op" id="3108426">(</span><span class="ident" id="3108427">fd</span>&nbsp;<span class="op" id="3108430">*</span><span class="ident" id="3108431">netFD</span><span class="op" id="3108436">)</span>&nbsp;<span class="ident" id="3108438">dial</span><span class="op" id="3108442">(</span><span class="ident" id="3108443">laddr</span><span class="op" id="3108448">,</span>&nbsp;<span class="ident" id="3108450">raddr</span>&nbsp;<span class="ident" id="3108456">sockaddr</span><span class="op" id="3108464">,</span>&nbsp;<span class="ident" id="3108466">deadline</span>&nbsp;<span class="ident" id="3108475">time</span><span class="op" id="3108479">.</span><span class="ident" id="3108480">Time</span><span class="op" id="3108484">)</span>&nbsp;<span class="builtintype" id="3108486">error</span>&nbsp;<span class="op" id="3108492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3108495">var</span>&nbsp;<span class="ident" id="3108499">err</span>&nbsp;<span class="builtintype" id="3108503">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3108510">var</span>&nbsp;<span class="ident" id="3108514">lsa</span>&nbsp;<span class="ident" id="3108518">syscall</span><span class="op" id="3108525">.</span><span class="ident" id="3108526">Sockaddr</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3108536">if</span>&nbsp;<span class="ident" id="3108539">laddr</span>&nbsp;<span class="op" id="3108545">!=</span>&nbsp;<span class="ident" id="3108548">nil</span>&nbsp;<span class="op" id="3108552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3108556">if</span>&nbsp;<span class="ident" id="3108559">lsa</span><span class="op" id="3108562">,</span>&nbsp;<span class="ident" id="3108564">err</span>&nbsp;<span class="op" id="3108568">=</span>&nbsp;<span class="ident" id="3108570">laddr</span><span class="op" id="3108575">.</span><span class="ident" id="3108576">sockaddr</span><span class="op" id="3108584">(</span><span class="ident" id="3108585">fd</span><span class="op" id="3108587">.</span><span class="ident" id="3108588">family</span><span class="op" id="3108594">)</span><span class="op" id="3108595">;</span>&nbsp;<span class="ident" id="3108597">err</span>&nbsp;<span class="op" id="3108601">!=</span>&nbsp;<span class="ident" id="3108604">nil</span>&nbsp;<span class="op" id="3108608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3108613">return</span>&nbsp;<span class="ident" id="3108620">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3108626">}</span>&nbsp;<span class="keyword" id="3108628">else</span>&nbsp;<span class="keyword" id="3108633">if</span>&nbsp;<span class="ident" id="3108636">lsa</span>&nbsp;<span class="op" id="3108640">!=</span>&nbsp;<span class="ident" id="3108643">nil</span>&nbsp;<span class="op" id="3108647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3108652">if</span>&nbsp;<span class="ident" id="3108655">err</span>&nbsp;<span class="op" id="3108659">:=</span>&nbsp;<span class="ident" id="3108662">syscall</span><span class="op" id="3108669">.</span><span class="ident" id="3108670">Bind</span><span class="op" id="3108674">(</span><span class="ident" id="3108675">fd</span><span class="op" id="3108677">.</span><span class="ident" id="3108678">sysfd</span><span class="op" id="3108683">,</span>&nbsp;<span class="ident" id="3108685">lsa</span><span class="op" id="3108688">)</span><span class="op" id="3108689">;</span>&nbsp;<span class="ident" id="3108691">err</span>&nbsp;<span class="op" id="3108695">!=</span>&nbsp;<span class="ident" id="3108698">nil</span>&nbsp;<span class="op" id="3108702">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3108708">return</span>&nbsp;<span class="ident" id="3108715">os</span><span class="op" id="3108717">.</span><span class="ident" id="3108718">NewSyscallError</span><span class="op" id="3108733">(</span><span class="string" id="3108734">&#34;bind&#34;</span><span class="op" id="3108740">,</span>&nbsp;<span class="ident" id="3108742">err</span><span class="op" id="3108745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3108750">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3108754">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3108757">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3108760">var</span>&nbsp;<span class="ident" id="3108764">rsa</span>&nbsp;<span class="ident" id="3108768">syscall</span><span class="op" id="3108775">.</span><span class="ident" id="3108776">Sockaddr</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3108786">if</span>&nbsp;<span class="ident" id="3108789">raddr</span>&nbsp;<span class="op" id="3108795">!=</span>&nbsp;<span class="ident" id="3108798">nil</span>&nbsp;<span class="op" id="3108802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3108806">if</span>&nbsp;<span class="ident" id="3108809">rsa</span><span class="op" id="3108812">,</span>&nbsp;<span class="ident" id="3108814">err</span>&nbsp;<span class="op" id="3108818">=</span>&nbsp;<span class="ident" id="3108820">raddr</span><span class="op" id="3108825">.</span><span class="ident" id="3108826">sockaddr</span><span class="op" id="3108834">(</span><span class="ident" id="3108835">fd</span><span class="op" id="3108837">.</span><span class="ident" id="3108838">family</span><span class="op" id="3108844">)</span><span class="op" id="3108845">;</span>&nbsp;<span class="ident" id="3108847">err</span>&nbsp;<span class="op" id="3108851">!=</span>&nbsp;<span class="ident" id="3108854">nil</span>&nbsp;<span class="op" id="3108858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3108863">return</span>&nbsp;<span class="ident" id="3108870">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3108876">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3108880">if</span>&nbsp;<span class="ident" id="3108883">err</span>&nbsp;<span class="op" id="3108887">:=</span>&nbsp;<span class="ident" id="3108890">fd</span><span class="op" id="3108892">.</span><span class="ident" id="3108893">connect</span><span class="op" id="3108900">(</span><span class="ident" id="3108901">lsa</span><span class="op" id="3108904">,</span>&nbsp;<span class="ident" id="3108906">rsa</span><span class="op" id="3108909">,</span>&nbsp;<span class="ident" id="3108911">deadline</span><span class="op" id="3108919">)</span><span class="op" id="3108920">;</span>&nbsp;<span class="ident" id="3108922">err</span>&nbsp;<span class="op" id="3108926">!=</span>&nbsp;<span class="ident" id="3108929">nil</span>&nbsp;<span class="op" id="3108933">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3108938">return</span>&nbsp;<span class="ident" id="3108945">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3108951">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3108955">fd</span><span class="op" id="3108957">.</span><span class="ident" id="3108958">isConnected</span>&nbsp;<span class="op" id="3108970">=</span>&nbsp;<span class="builtintype" id="3108972">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3108978">}</span>&nbsp;<span class="keyword" id="3108980">else</span>&nbsp;<span class="op" id="3108985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3108989">if</span>&nbsp;<span class="ident" id="3108992">err</span>&nbsp;<span class="op" id="3108996">:=</span>&nbsp;<span class="ident" id="3108999">fd</span><span class="op" id="3109001">.</span><span class="ident" id="3109002">init</span><span class="op" id="3109006">(</span><span class="op" id="3109007">)</span><span class="op" id="3109008">;</span>&nbsp;<span class="ident" id="3109010">err</span>&nbsp;<span class="op" id="3109014">!=</span>&nbsp;<span class="ident" id="3109017">nil</span>&nbsp;<span class="op" id="3109021">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3109026">return</span>&nbsp;<span class="ident" id="3109033">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3109039">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3109042">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3109045">lsa</span><span class="op" id="3109048">,</span>&nbsp;<span class="ident" id="3109050">_</span>&nbsp;<span class="op" id="3109052">=</span>&nbsp;<span class="ident" id="3109054">syscall</span><span class="op" id="3109061">.</span><span class="ident" id="3109062">Getsockname</span><span class="op" id="3109073">(</span><span class="ident" id="3109074">fd</span><span class="op" id="3109076">.</span><span class="ident" id="3109077">sysfd</span><span class="op" id="3109082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3109085">if</span>&nbsp;<span class="ident" id="3109088">rsa</span><span class="op" id="3109091">,</span>&nbsp;<span class="ident" id="3109093">_</span>&nbsp;<span class="op" id="3109095">=</span>&nbsp;<span class="ident" id="3109097">syscall</span><span class="op" id="3109104">.</span><span class="ident" id="3109105">Getpeername</span><span class="op" id="3109116">(</span><span class="ident" id="3109117">fd</span><span class="op" id="3109119">.</span><span class="ident" id="3109120">sysfd</span><span class="op" id="3109125">)</span><span class="op" id="3109126">;</span>&nbsp;<span class="ident" id="3109128">rsa</span>&nbsp;<span class="op" id="3109132">!=</span>&nbsp;<span class="ident" id="3109135">nil</span>&nbsp;<span class="op" id="3109139">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3109143">fd</span><span class="op" id="3109145">.</span><span class="ident" id="3109146">setAddr</span><span class="op" id="3109153">(</span><span class="ident" id="3109154">fd</span><span class="op" id="3109156">.</span><span class="ident" id="3109157">addrFunc</span><span class="op" id="3109165">(</span><span class="op" id="3109166">)</span><span class="op" id="3109167">(</span><span class="ident" id="3109168">lsa</span><span class="op" id="3109171">)</span><span class="op" id="3109172">,</span>&nbsp;<span class="ident" id="3109174">fd</span><span class="op" id="3109176">.</span><span class="ident" id="3109177">addrFunc</span><span class="op" id="3109185">(</span><span class="op" id="3109186">)</span><span class="op" id="3109187">(</span><span class="ident" id="3109188">rsa</span><span class="op" id="3109191">)</span><span class="op" id="3109192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3109195">}</span>&nbsp;<span class="keyword" id="3109197">else</span>&nbsp;<span class="op" id="3109202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3109206">fd</span><span class="op" id="3109208">.</span><span class="ident" id="3109209">setAddr</span><span class="op" id="3109216">(</span><span class="ident" id="3109217">fd</span><span class="op" id="3109219">.</span><span class="ident" id="3109220">addrFunc</span><span class="op" id="3109228">(</span><span class="op" id="3109229">)</span><span class="op" id="3109230">(</span><span class="ident" id="3109231">lsa</span><span class="op" id="3109234">)</span><span class="op" id="3109235">,</span>&nbsp;<span class="ident" id="3109237">raddr</span><span class="op" id="3109242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3109245">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3109248">return</span>&nbsp;<span class="ident" id="3109255">nil</span><br>
<span class="lineno">155</span><span class="op" id="3109259">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3109262">func</span>&nbsp;<span class="op" id="3109267">(</span><span class="ident" id="3109268">fd</span>&nbsp;<span class="op" id="3109271">*</span><span class="ident" id="3109272">netFD</span><span class="op" id="3109277">)</span>&nbsp;<span class="ident" id="3109279">listenStream</span><span class="op" id="3109291">(</span><span class="ident" id="3109292">laddr</span>&nbsp;<span class="ident" id="3109298">sockaddr</span><span class="op" id="3109306">,</span>&nbsp;<span class="ident" id="3109308">backlog</span>&nbsp;<span class="builtintype" id="3109316">int</span><span class="op" id="3109319">)</span>&nbsp;<span class="builtintype" id="3109321">error</span>&nbsp;<span class="op" id="3109327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3109330">if</span>&nbsp;<span class="ident" id="3109333">err</span>&nbsp;<span class="op" id="3109337">:=</span>&nbsp;<span class="ident" id="3109340">setDefaultListenerSockopts</span><span class="op" id="3109366">(</span><span class="ident" id="3109367">fd</span><span class="op" id="3109369">.</span><span class="ident" id="3109370">sysfd</span><span class="op" id="3109375">)</span><span class="op" id="3109376">;</span>&nbsp;<span class="ident" id="3109378">err</span>&nbsp;<span class="op" id="3109382">!=</span>&nbsp;<span class="ident" id="3109385">nil</span>&nbsp;<span class="op" id="3109389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3109393">return</span>&nbsp;<span class="ident" id="3109400">err</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3109405">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3109408">if</span>&nbsp;<span class="ident" id="3109411">lsa</span><span class="op" id="3109414">,</span>&nbsp;<span class="ident" id="3109416">err</span>&nbsp;<span class="op" id="3109420">:=</span>&nbsp;<span class="ident" id="3109423">laddr</span><span class="op" id="3109428">.</span><span class="ident" id="3109429">sockaddr</span><span class="op" id="3109437">(</span><span class="ident" id="3109438">fd</span><span class="op" id="3109440">.</span><span class="ident" id="3109441">family</span><span class="op" id="3109447">)</span><span class="op" id="3109448">;</span>&nbsp;<span class="ident" id="3109450">err</span>&nbsp;<span class="op" id="3109454">!=</span>&nbsp;<span class="ident" id="3109457">nil</span>&nbsp;<span class="op" id="3109461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3109465">return</span>&nbsp;<span class="ident" id="3109472">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3109477">}</span>&nbsp;<span class="keyword" id="3109479">else</span>&nbsp;<span class="keyword" id="3109484">if</span>&nbsp;<span class="ident" id="3109487">lsa</span>&nbsp;<span class="op" id="3109491">!=</span>&nbsp;<span class="ident" id="3109494">nil</span>&nbsp;<span class="op" id="3109498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3109502">if</span>&nbsp;<span class="ident" id="3109505">err</span>&nbsp;<span class="op" id="3109509">:=</span>&nbsp;<span class="ident" id="3109512">syscall</span><span class="op" id="3109519">.</span><span class="ident" id="3109520">Bind</span><span class="op" id="3109524">(</span><span class="ident" id="3109525">fd</span><span class="op" id="3109527">.</span><span class="ident" id="3109528">sysfd</span><span class="op" id="3109533">,</span>&nbsp;<span class="ident" id="3109535">lsa</span><span class="op" id="3109538">)</span><span class="op" id="3109539">;</span>&nbsp;<span class="ident" id="3109541">err</span>&nbsp;<span class="op" id="3109545">!=</span>&nbsp;<span class="ident" id="3109548">nil</span>&nbsp;<span class="op" id="3109552">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3109557">return</span>&nbsp;<span class="ident" id="3109564">os</span><span class="op" id="3109566">.</span><span class="ident" id="3109567">NewSyscallError</span><span class="op" id="3109582">(</span><span class="string" id="3109583">&#34;bind&#34;</span><span class="op" id="3109589">,</span>&nbsp;<span class="ident" id="3109591">err</span><span class="op" id="3109594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3109598">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3109601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3109604">if</span>&nbsp;<span class="ident" id="3109607">err</span>&nbsp;<span class="op" id="3109611">:=</span>&nbsp;<span class="ident" id="3109614">syscall</span><span class="op" id="3109621">.</span><span class="ident" id="3109622">Listen</span><span class="op" id="3109628">(</span><span class="ident" id="3109629">fd</span><span class="op" id="3109631">.</span><span class="ident" id="3109632">sysfd</span><span class="op" id="3109637">,</span>&nbsp;<span class="ident" id="3109639">backlog</span><span class="op" id="3109646">)</span><span class="op" id="3109647">;</span>&nbsp;<span class="ident" id="3109649">err</span>&nbsp;<span class="op" id="3109653">!=</span>&nbsp;<span class="ident" id="3109656">nil</span>&nbsp;<span class="op" id="3109660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3109664">return</span>&nbsp;<span class="ident" id="3109671">os</span><span class="op" id="3109673">.</span><span class="ident" id="3109674">NewSyscallError</span><span class="op" id="3109689">(</span><span class="string" id="3109690">&#34;listen&#34;</span><span class="op" id="3109698">,</span>&nbsp;<span class="ident" id="3109700">err</span><span class="op" id="3109703">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3109706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3109709">if</span>&nbsp;<span class="ident" id="3109712">err</span>&nbsp;<span class="op" id="3109716">:=</span>&nbsp;<span class="ident" id="3109719">fd</span><span class="op" id="3109721">.</span><span class="ident" id="3109722">init</span><span class="op" id="3109726">(</span><span class="op" id="3109727">)</span><span class="op" id="3109728">;</span>&nbsp;<span class="ident" id="3109730">err</span>&nbsp;<span class="op" id="3109734">!=</span>&nbsp;<span class="ident" id="3109737">nil</span>&nbsp;<span class="op" id="3109741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3109745">return</span>&nbsp;<span class="ident" id="3109752">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3109757">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3109760">lsa</span><span class="op" id="3109763">,</span>&nbsp;<span class="ident" id="3109765">_</span>&nbsp;<span class="op" id="3109767">:=</span>&nbsp;<span class="ident" id="3109770">syscall</span><span class="op" id="3109777">.</span><span class="ident" id="3109778">Getsockname</span><span class="op" id="3109789">(</span><span class="ident" id="3109790">fd</span><span class="op" id="3109792">.</span><span class="ident" id="3109793">sysfd</span><span class="op" id="3109798">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3109801">fd</span><span class="op" id="3109803">.</span><span class="ident" id="3109804">setAddr</span><span class="op" id="3109811">(</span><span class="ident" id="3109812">fd</span><span class="op" id="3109814">.</span><span class="ident" id="3109815">addrFunc</span><span class="op" id="3109823">(</span><span class="op" id="3109824">)</span><span class="op" id="3109825">(</span><span class="ident" id="3109826">lsa</span><span class="op" id="3109829">)</span><span class="op" id="3109830">,</span>&nbsp;<span class="ident" id="3109832">nil</span><span class="op" id="3109835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3109838">return</span>&nbsp;<span class="ident" id="3109845">nil</span><br>
<span class="lineno"></span><span class="op" id="3109849">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3109852">func</span>&nbsp;<span class="op" id="3109857">(</span><span class="ident" id="3109858">fd</span>&nbsp;<span class="op" id="3109861">*</span><span class="ident" id="3109862">netFD</span><span class="op" id="3109867">)</span>&nbsp;<span class="ident" id="3109869">listenDatagram</span><span class="op" id="3109883">(</span><span class="ident" id="3109884">laddr</span>&nbsp;<span class="ident" id="3109890">sockaddr</span><span class="op" id="3109898">)</span>&nbsp;<span class="builtintype" id="3109900">error</span>&nbsp;<span class="op" id="3109906">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3109909">switch</span>&nbsp;<span class="ident" id="3109916">addr</span>&nbsp;<span class="op" id="3109921">:=</span>&nbsp;<span class="ident" id="3109924">laddr</span><span class="op" id="3109929">.</span><span class="op" id="3109930">(</span><span class="keyword" id="3109931">type</span><span class="op" id="3109935">)</span>&nbsp;<span class="op" id="3109937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3109940">case</span>&nbsp;<span class="op" id="3109945">*</span><span class="ident" id="3109946">UDPAddr</span><span class="op" id="3109953">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3109957">//&nbsp;We&nbsp;provide&nbsp;a&nbsp;socket&nbsp;that&nbsp;listens&nbsp;to&nbsp;a&nbsp;wildcard</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3110009">//&nbsp;address&nbsp;with&nbsp;reusable&nbsp;UDP&nbsp;port&nbsp;when&nbsp;the&nbsp;given&nbsp;laddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3110066">//&nbsp;is&nbsp;an&nbsp;appropriate&nbsp;UDP&nbsp;multicast&nbsp;address&nbsp;prefix.</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3110119">//&nbsp;This&nbsp;makes&nbsp;it&nbsp;possible&nbsp;for&nbsp;a&nbsp;single&nbsp;UDP&nbsp;listener&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3110176">//&nbsp;join&nbsp;multiple&nbsp;different&nbsp;group&nbsp;addresses,&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3110226">//&nbsp;multiple&nbsp;UDP&nbsp;listeners&nbsp;that&nbsp;listen&nbsp;on&nbsp;the&nbsp;same&nbsp;UDP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3110282">//&nbsp;port&nbsp;to&nbsp;join&nbsp;the&nbsp;same&nbsp;group&nbsp;address.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3110324">if</span>&nbsp;<span class="ident" id="3110327">addr</span><span class="op" id="3110331">.</span><span class="ident" id="3110332">IP</span>&nbsp;<span class="op" id="3110335">!=</span>&nbsp;<span class="ident" id="3110338">nil</span>&nbsp;<span class="op" id="3110342">&amp;&amp;</span>&nbsp;<span class="ident" id="3110345">addr</span><span class="op" id="3110349">.</span><span class="ident" id="3110350">IP</span><span class="op" id="3110352">.</span><span class="ident" id="3110353">IsMulticast</span><span class="op" id="3110364">(</span><span class="op" id="3110365">)</span>&nbsp;<span class="op" id="3110367">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3110372">if</span>&nbsp;<span class="ident" id="3110375">err</span>&nbsp;<span class="op" id="3110379">:=</span>&nbsp;<span class="ident" id="3110382">setDefaultMulticastSockopts</span><span class="op" id="3110409">(</span><span class="ident" id="3110410">fd</span><span class="op" id="3110412">.</span><span class="ident" id="3110413">sysfd</span><span class="op" id="3110418">)</span><span class="op" id="3110419">;</span>&nbsp;<span class="ident" id="3110421">err</span>&nbsp;<span class="op" id="3110425">!=</span>&nbsp;<span class="ident" id="3110428">nil</span>&nbsp;<span class="op" id="3110432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3110438">return</span>&nbsp;<span class="ident" id="3110445">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3110452">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3110457">addr</span>&nbsp;<span class="op" id="3110462">:=</span>&nbsp;<span class="op" id="3110465">*</span><span class="ident" id="3110466">addr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3110474">switch</span>&nbsp;<span class="ident" id="3110481">fd</span><span class="op" id="3110483">.</span><span class="ident" id="3110484">family</span>&nbsp;<span class="op" id="3110491">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3110496">case</span>&nbsp;<span class="ident" id="3110501">syscall</span><span class="op" id="3110508">.</span><span class="ident" id="3110509">AF_INET</span><span class="op" id="3110516">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3110522">addr</span><span class="op" id="3110526">.</span><span class="ident" id="3110527">IP</span>&nbsp;<span class="op" id="3110530">=</span>&nbsp;<span class="ident" id="3110532">IPv4zero</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3110544">case</span>&nbsp;<span class="ident" id="3110549">syscall</span><span class="op" id="3110556">.</span><span class="ident" id="3110557">AF_INET6</span><span class="op" id="3110565">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3110571">addr</span><span class="op" id="3110575">.</span><span class="ident" id="3110576">IP</span>&nbsp;<span class="op" id="3110579">=</span>&nbsp;<span class="ident" id="3110581">IPv6unspecified</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3110600">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3110605">laddr</span>&nbsp;<span class="op" id="3110611">=</span>&nbsp;<span class="op" id="3110613">&amp;</span><span class="ident" id="3110614">addr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3110621">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3110624">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3110627">if</span>&nbsp;<span class="ident" id="3110630">lsa</span><span class="op" id="3110633">,</span>&nbsp;<span class="ident" id="3110635">err</span>&nbsp;<span class="op" id="3110639">:=</span>&nbsp;<span class="ident" id="3110642">laddr</span><span class="op" id="3110647">.</span><span class="ident" id="3110648">sockaddr</span><span class="op" id="3110656">(</span><span class="ident" id="3110657">fd</span><span class="op" id="3110659">.</span><span class="ident" id="3110660">family</span><span class="op" id="3110666">)</span><span class="op" id="3110667">;</span>&nbsp;<span class="ident" id="3110669">err</span>&nbsp;<span class="op" id="3110673">!=</span>&nbsp;<span class="ident" id="3110676">nil</span>&nbsp;<span class="op" id="3110680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3110684">return</span>&nbsp;<span class="ident" id="3110691">err</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3110696">}</span>&nbsp;<span class="keyword" id="3110698">else</span>&nbsp;<span class="keyword" id="3110703">if</span>&nbsp;<span class="ident" id="3110706">lsa</span>&nbsp;<span class="op" id="3110710">!=</span>&nbsp;<span class="ident" id="3110713">nil</span>&nbsp;<span class="op" id="3110717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3110721">if</span>&nbsp;<span class="ident" id="3110724">err</span>&nbsp;<span class="op" id="3110728">:=</span>&nbsp;<span class="ident" id="3110731">syscall</span><span class="op" id="3110738">.</span><span class="ident" id="3110739">Bind</span><span class="op" id="3110743">(</span><span class="ident" id="3110744">fd</span><span class="op" id="3110746">.</span><span class="ident" id="3110747">sysfd</span><span class="op" id="3110752">,</span>&nbsp;<span class="ident" id="3110754">lsa</span><span class="op" id="3110757">)</span><span class="op" id="3110758">;</span>&nbsp;<span class="ident" id="3110760">err</span>&nbsp;<span class="op" id="3110764">!=</span>&nbsp;<span class="ident" id="3110767">nil</span>&nbsp;<span class="op" id="3110771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3110776">return</span>&nbsp;<span class="ident" id="3110783">os</span><span class="op" id="3110785">.</span><span class="ident" id="3110786">NewSyscallError</span><span class="op" id="3110801">(</span><span class="string" id="3110802">&#34;bind&#34;</span><span class="op" id="3110808">,</span>&nbsp;<span class="ident" id="3110810">err</span><span class="op" id="3110813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3110817">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3110820">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3110823">if</span>&nbsp;<span class="ident" id="3110826">err</span>&nbsp;<span class="op" id="3110830">:=</span>&nbsp;<span class="ident" id="3110833">fd</span><span class="op" id="3110835">.</span><span class="ident" id="3110836">init</span><span class="op" id="3110840">(</span><span class="op" id="3110841">)</span><span class="op" id="3110842">;</span>&nbsp;<span class="ident" id="3110844">err</span>&nbsp;<span class="op" id="3110848">!=</span>&nbsp;<span class="ident" id="3110851">nil</span>&nbsp;<span class="op" id="3110855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3110859">return</span>&nbsp;<span class="ident" id="3110866">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3110871">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3110874">lsa</span><span class="op" id="3110877">,</span>&nbsp;<span class="ident" id="3110879">_</span>&nbsp;<span class="op" id="3110881">:=</span>&nbsp;<span class="ident" id="3110884">syscall</span><span class="op" id="3110891">.</span><span class="ident" id="3110892">Getsockname</span><span class="op" id="3110903">(</span><span class="ident" id="3110904">fd</span><span class="op" id="3110906">.</span><span class="ident" id="3110907">sysfd</span><span class="op" id="3110912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3110915">fd</span><span class="op" id="3110917">.</span><span class="ident" id="3110918">setAddr</span><span class="op" id="3110925">(</span><span class="ident" id="3110926">fd</span><span class="op" id="3110928">.</span><span class="ident" id="3110929">addrFunc</span><span class="op" id="3110937">(</span><span class="op" id="3110938">)</span><span class="op" id="3110939">(</span><span class="ident" id="3110940">lsa</span><span class="op" id="3110943">)</span><span class="op" id="3110944">,</span>&nbsp;<span class="ident" id="3110946">nil</span><span class="op" id="3110949">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3110952">return</span>&nbsp;<span class="ident" id="3110959">nil</span><br>
<span class="lineno"></span><span class="op" id="3110963">}</span>
</div>
</body>
</html>
