<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/gif</h2>
<ul>
<li><a href="/gostd/image/gif/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/gif/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/gif/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/gif/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7179437">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7179492">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7179546">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7179597">package</span>&nbsp;<span class="ident" id="7179605">gif</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7179610">import</span>&nbsp;<span class="op" id="7179617">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7179620">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7179629">&#34;image&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7179638">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7179653">_</span>&nbsp;<span class="string" id="7179655">&#34;image/png&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7179668">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7179681">&#34;math/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7179694">&#34;os&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7179700">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7179710">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7179713">func</span>&nbsp;<span class="ident" id="7179718">readImg</span><span class="op" id="7179725">(</span><span class="ident" id="7179726">filename</span>&nbsp;<span class="builtintype" id="7179735">string</span><span class="op" id="7179741">)</span>&nbsp;<span class="op" id="7179743">(</span><span class="ident" id="7179744">image</span><span class="op" id="7179749">.</span><span class="ident" id="7179750">Image</span><span class="op" id="7179755">,</span>&nbsp;<span class="builtintype" id="7179757">error</span><span class="op" id="7179762">)</span>&nbsp;<span class="op" id="7179764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7179767">f</span><span class="op" id="7179768">,</span>&nbsp;<span class="ident" id="7179770">err</span>&nbsp;<span class="op" id="7179774">:=</span>&nbsp;<span class="ident" id="7179777">os</span><span class="op" id="7179779">.</span><span class="ident" id="7179780">Open</span><span class="op" id="7179784">(</span><span class="ident" id="7179785">filename</span><span class="op" id="7179793">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7179796">if</span>&nbsp;<span class="ident" id="7179799">err</span>&nbsp;<span class="op" id="7179803">!=</span>&nbsp;<span class="ident" id="7179806">nil</span>&nbsp;<span class="op" id="7179810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7179814">return</span>&nbsp;<span class="ident" id="7179821">nil</span><span class="op" id="7179824">,</span>&nbsp;<span class="ident" id="7179826">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7179831">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7179834">defer</span>&nbsp;<span class="ident" id="7179840">f</span><span class="op" id="7179841">.</span><span class="ident" id="7179842">Close</span><span class="op" id="7179847">(</span><span class="op" id="7179848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7179851">m</span><span class="op" id="7179852">,</span>&nbsp;<span class="ident" id="7179854">_</span><span class="op" id="7179855">,</span>&nbsp;<span class="ident" id="7179857">err</span>&nbsp;<span class="op" id="7179861">:=</span>&nbsp;<span class="ident" id="7179864">image</span><span class="op" id="7179869">.</span><span class="ident" id="7179870">Decode</span><span class="op" id="7179876">(</span><span class="ident" id="7179877">f</span><span class="op" id="7179878">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7179881">return</span>&nbsp;<span class="ident" id="7179888">m</span><span class="op" id="7179889">,</span>&nbsp;<span class="ident" id="7179891">err</span><br>
<span class="lineno"></span><span class="op" id="7179895">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7179898">func</span>&nbsp;<span class="ident" id="7179903">readGIF</span><span class="op" id="7179910">(</span><span class="ident" id="7179911">filename</span>&nbsp;<span class="builtintype" id="7179920">string</span><span class="op" id="7179926">)</span>&nbsp;<span class="op" id="7179928">(</span><span class="op" id="7179929">*</span><span class="ident" id="7179930">GIF</span><span class="op" id="7179933">,</span>&nbsp;<span class="builtintype" id="7179935">error</span><span class="op" id="7179940">)</span>&nbsp;<span class="op" id="7179942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7179945">f</span><span class="op" id="7179946">,</span>&nbsp;<span class="ident" id="7179948">err</span>&nbsp;<span class="op" id="7179952">:=</span>&nbsp;<span class="ident" id="7179955">os</span><span class="op" id="7179957">.</span><span class="ident" id="7179958">Open</span><span class="op" id="7179962">(</span><span class="ident" id="7179963">filename</span><span class="op" id="7179971">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7179974">if</span>&nbsp;<span class="ident" id="7179977">err</span>&nbsp;<span class="op" id="7179981">!=</span>&nbsp;<span class="ident" id="7179984">nil</span>&nbsp;<span class="op" id="7179988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7179992">return</span>&nbsp;<span class="ident" id="7179999">nil</span><span class="op" id="7180002">,</span>&nbsp;<span class="ident" id="7180004">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7180009">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7180012">defer</span>&nbsp;<span class="ident" id="7180018">f</span><span class="op" id="7180019">.</span><span class="ident" id="7180020">Close</span><span class="op" id="7180025">(</span><span class="op" id="7180026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7180029">return</span>&nbsp;<span class="ident" id="7180036">DecodeAll</span><span class="op" id="7180045">(</span><span class="ident" id="7180046">f</span><span class="op" id="7180047">)</span><br>
<span class="lineno">35</span><span class="op" id="7180049">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7180052">func</span>&nbsp;<span class="ident" id="7180057">delta</span><span class="op" id="7180062">(</span><span class="ident" id="7180063">u0</span><span class="op" id="7180065">,</span>&nbsp;<span class="ident" id="7180067">u1</span>&nbsp;<span class="builtintype" id="7180070">uint32</span><span class="op" id="7180076">)</span>&nbsp;<span class="ident" id="7180078">int64</span>&nbsp;<span class="op" id="7180084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7180087">d</span>&nbsp;<span class="op" id="7180089">:=</span>&nbsp;<span class="ident" id="7180092">int64</span><span class="op" id="7180097">(</span><span class="ident" id="7180098">u0</span><span class="op" id="7180100">)</span>&nbsp;<span class="op" id="7180102">-</span>&nbsp;<span class="ident" id="7180104">int64</span><span class="op" id="7180109">(</span><span class="ident" id="7180110">u1</span><span class="op" id="7180112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7180115">if</span>&nbsp;<span class="ident" id="7180118">d</span>&nbsp;<span class="op" id="7180120">&lt;</span>&nbsp;<span class="num" id="7180122">0</span>&nbsp;<span class="op" id="7180124">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7180128">return</span>&nbsp;<span class="op" id="7180135">-</span><span class="ident" id="7180136">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7180139">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7180142">return</span>&nbsp;<span class="ident" id="7180149">d</span><br>
<span class="lineno"></span><span class="op" id="7180151">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="7180154">//&nbsp;averageDelta&nbsp;returns&nbsp;the&nbsp;average&nbsp;delta&nbsp;in&nbsp;RGB&nbsp;space.&nbsp;The&nbsp;two&nbsp;images&nbsp;must</span><br>
<span class="lineno"></span><span class="comment" id="7180230">//&nbsp;have&nbsp;the&nbsp;same&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="7180255">func</span>&nbsp;<span class="ident" id="7180260">averageDelta</span><span class="op" id="7180272">(</span><span class="ident" id="7180273">m0</span><span class="op" id="7180275">,</span>&nbsp;<span class="ident" id="7180277">m1</span>&nbsp;<span class="ident" id="7180280">image</span><span class="op" id="7180285">.</span><span class="ident" id="7180286">Image</span><span class="op" id="7180291">)</span>&nbsp;<span class="ident" id="7180293">int64</span>&nbsp;<span class="op" id="7180299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7180302">b</span>&nbsp;<span class="op" id="7180304">:=</span>&nbsp;<span class="ident" id="7180307">m0</span><span class="op" id="7180309">.</span><span class="ident" id="7180310">Bounds</span><span class="op" id="7180316">(</span><span class="op" id="7180317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7180320">var</span>&nbsp;<span class="ident" id="7180324">sum</span><span class="op" id="7180327">,</span>&nbsp;<span class="ident" id="7180329">n</span>&nbsp;<span class="ident" id="7180331">int64</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7180338">for</span>&nbsp;<span class="ident" id="7180342">y</span>&nbsp;<span class="op" id="7180344">:=</span>&nbsp;<span class="ident" id="7180347">b</span><span class="op" id="7180348">.</span><span class="ident" id="7180349">Min</span><span class="op" id="7180352">.</span><span class="ident" id="7180353">Y</span><span class="op" id="7180354">;</span>&nbsp;<span class="ident" id="7180356">y</span>&nbsp;<span class="op" id="7180358">&lt;</span>&nbsp;<span class="ident" id="7180360">b</span><span class="op" id="7180361">.</span><span class="ident" id="7180362">Max</span><span class="op" id="7180365">.</span><span class="ident" id="7180366">Y</span><span class="op" id="7180367">;</span>&nbsp;<span class="ident" id="7180369">y</span><span class="op" id="7180370">++</span>&nbsp;<span class="op" id="7180373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7180377">for</span>&nbsp;<span class="ident" id="7180381">x</span>&nbsp;<span class="op" id="7180383">:=</span>&nbsp;<span class="ident" id="7180386">b</span><span class="op" id="7180387">.</span><span class="ident" id="7180388">Min</span><span class="op" id="7180391">.</span><span class="ident" id="7180392">X</span><span class="op" id="7180393">;</span>&nbsp;<span class="ident" id="7180395">x</span>&nbsp;<span class="op" id="7180397">&lt;</span>&nbsp;<span class="ident" id="7180399">b</span><span class="op" id="7180400">.</span><span class="ident" id="7180401">Max</span><span class="op" id="7180404">.</span><span class="ident" id="7180405">X</span><span class="op" id="7180406">;</span>&nbsp;<span class="ident" id="7180408">x</span><span class="op" id="7180409">++</span>&nbsp;<span class="op" id="7180412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7180417">c0</span>&nbsp;<span class="op" id="7180420">:=</span>&nbsp;<span class="ident" id="7180423">m0</span><span class="op" id="7180425">.</span><span class="ident" id="7180426">At</span><span class="op" id="7180428">(</span><span class="ident" id="7180429">x</span><span class="op" id="7180430">,</span>&nbsp;<span class="ident" id="7180432">y</span><span class="op" id="7180433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7180438">c1</span>&nbsp;<span class="op" id="7180441">:=</span>&nbsp;<span class="ident" id="7180444">m1</span><span class="op" id="7180446">.</span><span class="ident" id="7180447">At</span><span class="op" id="7180449">(</span><span class="ident" id="7180450">x</span><span class="op" id="7180451">,</span>&nbsp;<span class="ident" id="7180453">y</span><span class="op" id="7180454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7180459">r0</span><span class="op" id="7180461">,</span>&nbsp;<span class="ident" id="7180463">g0</span><span class="op" id="7180465">,</span>&nbsp;<span class="ident" id="7180467">b0</span><span class="op" id="7180469">,</span>&nbsp;<span class="ident" id="7180471">_</span>&nbsp;<span class="op" id="7180473">:=</span>&nbsp;<span class="ident" id="7180476">c0</span><span class="op" id="7180478">.</span><span class="ident" id="7180479">RGBA</span><span class="op" id="7180483">(</span><span class="op" id="7180484">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7180489">r1</span><span class="op" id="7180491">,</span>&nbsp;<span class="ident" id="7180493">g1</span><span class="op" id="7180495">,</span>&nbsp;<span class="ident" id="7180497">b1</span><span class="op" id="7180499">,</span>&nbsp;<span class="ident" id="7180501">_</span>&nbsp;<span class="op" id="7180503">:=</span>&nbsp;<span class="ident" id="7180506">c1</span><span class="op" id="7180508">.</span><span class="ident" id="7180509">RGBA</span><span class="op" id="7180513">(</span><span class="op" id="7180514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7180519">sum</span>&nbsp;<span class="op" id="7180523">+=</span>&nbsp;<span class="ident" id="7180526">delta</span><span class="op" id="7180531">(</span><span class="ident" id="7180532">r0</span><span class="op" id="7180534">,</span>&nbsp;<span class="ident" id="7180536">r1</span><span class="op" id="7180538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7180543">sum</span>&nbsp;<span class="op" id="7180547">+=</span>&nbsp;<span class="ident" id="7180550">delta</span><span class="op" id="7180555">(</span><span class="ident" id="7180556">g0</span><span class="op" id="7180558">,</span>&nbsp;<span class="ident" id="7180560">g1</span><span class="op" id="7180562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7180567">sum</span>&nbsp;<span class="op" id="7180571">+=</span>&nbsp;<span class="ident" id="7180574">delta</span><span class="op" id="7180579">(</span><span class="ident" id="7180580">b0</span><span class="op" id="7180582">,</span>&nbsp;<span class="ident" id="7180584">b1</span><span class="op" id="7180586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7180591">n</span>&nbsp;<span class="op" id="7180593">+=</span>&nbsp;<span class="num" id="7180596">3</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7180600">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7180603">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7180606">return</span>&nbsp;<span class="ident" id="7180613">sum</span>&nbsp;<span class="op" id="7180617">/</span>&nbsp;<span class="ident" id="7180619">n</span><br>
<span class="lineno"></span><span class="op" id="7180621">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="keyword" id="7180624">var</span>&nbsp;<span class="ident" id="7180628">testCase</span>&nbsp;<span class="op" id="7180637">=</span>&nbsp;<span class="op" id="7180639">[</span><span class="op" id="7180640">]</span><span class="keyword" id="7180641">struct</span>&nbsp;<span class="op" id="7180648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7180651">filename</span>&nbsp;&nbsp;<span class="builtintype" id="7180661">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7180669">tolerance</span>&nbsp;<span class="ident" id="7180679">int64</span><br>
<span class="lineno"></span><span class="op" id="7180685">}</span><span class="op" id="7180686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7180689">{</span><span class="string" id="7180690">&#34;../testdata/video-001.png&#34;</span><span class="op" id="7180717">,</span>&nbsp;<span class="num" id="7180719">1</span>&nbsp;<span class="op" id="7180721">&lt;&lt;</span>&nbsp;<span class="num" id="7180724">12</span><span class="op" id="7180726">}</span><span class="op" id="7180727">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7180730">{</span><span class="string" id="7180731">&#34;../testdata/video-001.gif&#34;</span><span class="op" id="7180758">,</span>&nbsp;<span class="num" id="7180760">0</span><span class="op" id="7180761">}</span><span class="op" id="7180762">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7180765">{</span><span class="string" id="7180766">&#34;../testdata/video-001.interlaced.gif&#34;</span><span class="op" id="7180804">,</span>&nbsp;<span class="num" id="7180806">0</span><span class="op" id="7180807">}</span><span class="op" id="7180808">,</span><br>
<span class="lineno"></span><span class="op" id="7180810">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7180813">func</span>&nbsp;<span class="ident" id="7180818">TestWriter</span><span class="op" id="7180828">(</span><span class="ident" id="7180829">t</span>&nbsp;<span class="op" id="7180831">*</span><span class="ident" id="7180832">testing</span><span class="op" id="7180839">.</span><span class="ident" id="7180840">T</span><span class="op" id="7180841">)</span>&nbsp;<span class="op" id="7180843">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7180846">for</span>&nbsp;<span class="ident" id="7180850">_</span><span class="op" id="7180851">,</span>&nbsp;<span class="ident" id="7180853">tc</span>&nbsp;<span class="op" id="7180856">:=</span>&nbsp;<span class="keyword" id="7180859">range</span>&nbsp;<span class="ident" id="7180865">testCase</span>&nbsp;<span class="op" id="7180874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7180878">m0</span><span class="op" id="7180880">,</span>&nbsp;<span class="ident" id="7180882">err</span>&nbsp;<span class="op" id="7180886">:=</span>&nbsp;<span class="ident" id="7180889">readImg</span><span class="op" id="7180896">(</span><span class="ident" id="7180897">tc</span><span class="op" id="7180899">.</span><span class="ident" id="7180900">filename</span><span class="op" id="7180908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7180912">if</span>&nbsp;<span class="ident" id="7180915">err</span>&nbsp;<span class="op" id="7180919">!=</span>&nbsp;<span class="ident" id="7180922">nil</span>&nbsp;<span class="op" id="7180926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7180931">t</span><span class="op" id="7180932">.</span><span class="ident" id="7180933">Error</span><span class="op" id="7180938">(</span><span class="ident" id="7180939">tc</span><span class="op" id="7180941">.</span><span class="ident" id="7180942">filename</span><span class="op" id="7180950">,</span>&nbsp;<span class="ident" id="7180952">err</span><span class="op" id="7180955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7180960">continue</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7180971">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7180975">var</span>&nbsp;<span class="ident" id="7180979">buf</span>&nbsp;<span class="ident" id="7180983">bytes</span><span class="op" id="7180988">.</span><span class="ident" id="7180989">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7180998">err</span>&nbsp;<span class="op" id="7181002">=</span>&nbsp;<span class="ident" id="7181004">Encode</span><span class="op" id="7181010">(</span><span class="op" id="7181011">&amp;</span><span class="ident" id="7181012">buf</span><span class="op" id="7181015">,</span>&nbsp;<span class="ident" id="7181017">m0</span><span class="op" id="7181019">,</span>&nbsp;<span class="ident" id="7181021">nil</span><span class="op" id="7181024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7181028">if</span>&nbsp;<span class="ident" id="7181031">err</span>&nbsp;<span class="op" id="7181035">!=</span>&nbsp;<span class="ident" id="7181038">nil</span>&nbsp;<span class="op" id="7181042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7181047">t</span><span class="op" id="7181048">.</span><span class="ident" id="7181049">Error</span><span class="op" id="7181054">(</span><span class="ident" id="7181055">tc</span><span class="op" id="7181057">.</span><span class="ident" id="7181058">filename</span><span class="op" id="7181066">,</span>&nbsp;<span class="ident" id="7181068">err</span><span class="op" id="7181071">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7181076">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7181087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7181091">m1</span><span class="op" id="7181093">,</span>&nbsp;<span class="ident" id="7181095">err</span>&nbsp;<span class="op" id="7181099">:=</span>&nbsp;<span class="ident" id="7181102">Decode</span><span class="op" id="7181108">(</span><span class="op" id="7181109">&amp;</span><span class="ident" id="7181110">buf</span><span class="op" id="7181113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7181117">if</span>&nbsp;<span class="ident" id="7181120">err</span>&nbsp;<span class="op" id="7181124">!=</span>&nbsp;<span class="ident" id="7181127">nil</span>&nbsp;<span class="op" id="7181131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7181136">t</span><span class="op" id="7181137">.</span><span class="ident" id="7181138">Error</span><span class="op" id="7181143">(</span><span class="ident" id="7181144">tc</span><span class="op" id="7181146">.</span><span class="ident" id="7181147">filename</span><span class="op" id="7181155">,</span>&nbsp;<span class="ident" id="7181157">err</span><span class="op" id="7181160">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7181165">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7181176">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7181180">if</span>&nbsp;<span class="ident" id="7181183">m0</span><span class="op" id="7181185">.</span><span class="ident" id="7181186">Bounds</span><span class="op" id="7181192">(</span><span class="op" id="7181193">)</span>&nbsp;<span class="op" id="7181195">!=</span>&nbsp;<span class="ident" id="7181198">m1</span><span class="op" id="7181200">.</span><span class="ident" id="7181201">Bounds</span><span class="op" id="7181207">(</span><span class="op" id="7181208">)</span>&nbsp;<span class="op" id="7181210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7181215">t</span><span class="op" id="7181216">.</span><span class="ident" id="7181217">Errorf</span><span class="op" id="7181223">(</span><span class="string" id="7181224">&#34;%s,&nbsp;bounds&nbsp;differ:&nbsp;%v&nbsp;and&nbsp;%v&#34;</span><span class="op" id="7181254">,</span>&nbsp;<span class="ident" id="7181256">tc</span><span class="op" id="7181258">.</span><span class="ident" id="7181259">filename</span><span class="op" id="7181267">,</span>&nbsp;<span class="ident" id="7181269">m0</span><span class="op" id="7181271">.</span><span class="ident" id="7181272">Bounds</span><span class="op" id="7181278">(</span><span class="op" id="7181279">)</span><span class="op" id="7181280">,</span>&nbsp;<span class="ident" id="7181282">m1</span><span class="op" id="7181284">.</span><span class="ident" id="7181285">Bounds</span><span class="op" id="7181291">(</span><span class="op" id="7181292">)</span><span class="op" id="7181293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7181298">continue</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7181309">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7181313">//&nbsp;Compare&nbsp;the&nbsp;average&nbsp;delta&nbsp;to&nbsp;the&nbsp;tolerance&nbsp;level.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7181368">avgDelta</span>&nbsp;<span class="op" id="7181377">:=</span>&nbsp;<span class="ident" id="7181380">averageDelta</span><span class="op" id="7181392">(</span><span class="ident" id="7181393">m0</span><span class="op" id="7181395">,</span>&nbsp;<span class="ident" id="7181397">m1</span><span class="op" id="7181399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7181403">if</span>&nbsp;<span class="ident" id="7181406">avgDelta</span>&nbsp;<span class="op" id="7181415">&gt;</span>&nbsp;<span class="ident" id="7181417">tc</span><span class="op" id="7181419">.</span><span class="ident" id="7181420">tolerance</span>&nbsp;<span class="op" id="7181430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7181435">t</span><span class="op" id="7181436">.</span><span class="ident" id="7181437">Errorf</span><span class="op" id="7181443">(</span><span class="string" id="7181444">&#34;%s:&nbsp;average&nbsp;delta&nbsp;is&nbsp;too&nbsp;high.&nbsp;expected:&nbsp;%d,&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7181497">,</span>&nbsp;<span class="ident" id="7181499">tc</span><span class="op" id="7181501">.</span><span class="ident" id="7181502">filename</span><span class="op" id="7181510">,</span>&nbsp;<span class="ident" id="7181512">tc</span><span class="op" id="7181514">.</span><span class="ident" id="7181515">tolerance</span><span class="op" id="7181524">,</span>&nbsp;<span class="ident" id="7181526">avgDelta</span><span class="op" id="7181534">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7181539">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7181550">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7181553">}</span><br>
<span class="lineno"></span><span class="op" id="7181555">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="keyword" id="7181558">func</span>&nbsp;<span class="ident" id="7181563">TestSubImage</span><span class="op" id="7181575">(</span><span class="ident" id="7181576">t</span>&nbsp;<span class="op" id="7181578">*</span><span class="ident" id="7181579">testing</span><span class="op" id="7181586">.</span><span class="ident" id="7181587">T</span><span class="op" id="7181588">)</span>&nbsp;<span class="op" id="7181590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7181593">m0</span><span class="op" id="7181595">,</span>&nbsp;<span class="ident" id="7181597">err</span>&nbsp;<span class="op" id="7181601">:=</span>&nbsp;<span class="ident" id="7181604">readImg</span><span class="op" id="7181611">(</span><span class="string" id="7181612">&#34;../testdata/video-001.gif&#34;</span><span class="op" id="7181639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7181642">if</span>&nbsp;<span class="ident" id="7181645">err</span>&nbsp;<span class="op" id="7181649">!=</span>&nbsp;<span class="ident" id="7181652">nil</span>&nbsp;<span class="op" id="7181656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7181660">t</span><span class="op" id="7181661">.</span><span class="ident" id="7181662">Fatalf</span><span class="op" id="7181668">(</span><span class="string" id="7181669">&#34;readImg:&nbsp;%v&#34;</span><span class="op" id="7181682">,</span>&nbsp;<span class="ident" id="7181684">err</span><span class="op" id="7181687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7181690">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7181693">m0</span>&nbsp;<span class="op" id="7181696">=</span>&nbsp;<span class="ident" id="7181698">m0</span><span class="op" id="7181700">.</span><span class="op" id="7181701">(</span><span class="op" id="7181702">*</span><span class="ident" id="7181703">image</span><span class="op" id="7181708">.</span><span class="ident" id="7181709">Paletted</span><span class="op" id="7181717">)</span><span class="op" id="7181718">.</span><span class="ident" id="7181719">SubImage</span><span class="op" id="7181727">(</span><span class="ident" id="7181728">image</span><span class="op" id="7181733">.</span><span class="ident" id="7181734">Rect</span><span class="op" id="7181738">(</span><span class="num" id="7181739">0</span><span class="op" id="7181740">,</span>&nbsp;<span class="num" id="7181742">0</span><span class="op" id="7181743">,</span>&nbsp;<span class="num" id="7181745">50</span><span class="op" id="7181747">,</span>&nbsp;<span class="num" id="7181749">30</span><span class="op" id="7181751">)</span><span class="op" id="7181752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7181755">var</span>&nbsp;<span class="ident" id="7181759">buf</span>&nbsp;<span class="ident" id="7181763">bytes</span><span class="op" id="7181768">.</span><span class="ident" id="7181769">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7181777">err</span>&nbsp;<span class="op" id="7181781">=</span>&nbsp;<span class="ident" id="7181783">Encode</span><span class="op" id="7181789">(</span><span class="op" id="7181790">&amp;</span><span class="ident" id="7181791">buf</span><span class="op" id="7181794">,</span>&nbsp;<span class="ident" id="7181796">m0</span><span class="op" id="7181798">,</span>&nbsp;<span class="ident" id="7181800">nil</span><span class="op" id="7181803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7181806">if</span>&nbsp;<span class="ident" id="7181809">err</span>&nbsp;<span class="op" id="7181813">!=</span>&nbsp;<span class="ident" id="7181816">nil</span>&nbsp;<span class="op" id="7181820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7181824">t</span><span class="op" id="7181825">.</span><span class="ident" id="7181826">Fatalf</span><span class="op" id="7181832">(</span><span class="string" id="7181833">&#34;Encode:&nbsp;%v&#34;</span><span class="op" id="7181845">,</span>&nbsp;<span class="ident" id="7181847">err</span><span class="op" id="7181850">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7181853">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7181856">m1</span><span class="op" id="7181858">,</span>&nbsp;<span class="ident" id="7181860">err</span>&nbsp;<span class="op" id="7181864">:=</span>&nbsp;<span class="ident" id="7181867">Decode</span><span class="op" id="7181873">(</span><span class="op" id="7181874">&amp;</span><span class="ident" id="7181875">buf</span><span class="op" id="7181878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7181881">if</span>&nbsp;<span class="ident" id="7181884">err</span>&nbsp;<span class="op" id="7181888">!=</span>&nbsp;<span class="ident" id="7181891">nil</span>&nbsp;<span class="op" id="7181895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7181899">t</span><span class="op" id="7181900">.</span><span class="ident" id="7181901">Fatalf</span><span class="op" id="7181907">(</span><span class="string" id="7181908">&#34;Decode:&nbsp;%v&#34;</span><span class="op" id="7181920">,</span>&nbsp;<span class="ident" id="7181922">err</span><span class="op" id="7181925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7181928">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7181931">if</span>&nbsp;<span class="ident" id="7181934">m0</span><span class="op" id="7181936">.</span><span class="ident" id="7181937">Bounds</span><span class="op" id="7181943">(</span><span class="op" id="7181944">)</span>&nbsp;<span class="op" id="7181946">!=</span>&nbsp;<span class="ident" id="7181949">m1</span><span class="op" id="7181951">.</span><span class="ident" id="7181952">Bounds</span><span class="op" id="7181958">(</span><span class="op" id="7181959">)</span>&nbsp;<span class="op" id="7181961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7181965">t</span><span class="op" id="7181966">.</span><span class="ident" id="7181967">Fatalf</span><span class="op" id="7181973">(</span><span class="string" id="7181974">&#34;bounds&nbsp;differ:&nbsp;%v&nbsp;and&nbsp;%v&#34;</span><span class="op" id="7182000">,</span>&nbsp;<span class="ident" id="7182002">m0</span><span class="op" id="7182004">.</span><span class="ident" id="7182005">Bounds</span><span class="op" id="7182011">(</span><span class="op" id="7182012">)</span><span class="op" id="7182013">,</span>&nbsp;<span class="ident" id="7182015">m1</span><span class="op" id="7182017">.</span><span class="ident" id="7182018">Bounds</span><span class="op" id="7182024">(</span><span class="op" id="7182025">)</span><span class="op" id="7182026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7182029">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7182032">if</span>&nbsp;<span class="ident" id="7182035">averageDelta</span><span class="op" id="7182047">(</span><span class="ident" id="7182048">m0</span><span class="op" id="7182050">,</span>&nbsp;<span class="ident" id="7182052">m1</span><span class="op" id="7182054">)</span>&nbsp;<span class="op" id="7182056">!=</span>&nbsp;<span class="num" id="7182059">0</span>&nbsp;<span class="op" id="7182061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7182065">t</span><span class="op" id="7182066">.</span><span class="ident" id="7182067">Fatalf</span><span class="op" id="7182073">(</span><span class="string" id="7182074">&#34;images&nbsp;differ&#34;</span><span class="op" id="7182089">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7182092">}</span><br>
<span class="lineno"></span><span class="op" id="7182094">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7182097">var</span>&nbsp;<span class="ident" id="7182101">frames</span>&nbsp;<span class="op" id="7182108">=</span>&nbsp;<span class="op" id="7182110">[</span><span class="op" id="7182111">]</span><span class="builtintype" id="7182112">string</span><span class="op" id="7182118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7182121">&#34;../testdata/video-001.gif&#34;</span><span class="op" id="7182148">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7182151">&#34;../testdata/video-005.gray.gif&#34;</span><span class="op" id="7182183">,</span><br>
<span class="lineno"></span><span class="op" id="7182185">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7182188">func</span>&nbsp;<span class="ident" id="7182193">TestEncodeAll</span><span class="op" id="7182206">(</span><span class="ident" id="7182207">t</span>&nbsp;<span class="op" id="7182209">*</span><span class="ident" id="7182210">testing</span><span class="op" id="7182217">.</span><span class="ident" id="7182218">T</span><span class="op" id="7182219">)</span>&nbsp;<span class="op" id="7182221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7182224">g0</span>&nbsp;<span class="op" id="7182227">:=</span>&nbsp;<span class="op" id="7182230">&amp;</span><span class="ident" id="7182231">GIF</span><span class="op" id="7182234">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7182238">Image</span><span class="op" id="7182243">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7182249">make</span><span class="op" id="7182253">(</span><span class="op" id="7182254">[</span><span class="op" id="7182255">]</span><span class="op" id="7182256">*</span><span class="ident" id="7182257">image</span><span class="op" id="7182262">.</span><span class="ident" id="7182263">Paletted</span><span class="op" id="7182271">,</span>&nbsp;<span class="builtinfunc" id="7182273">len</span><span class="op" id="7182276">(</span><span class="ident" id="7182277">frames</span><span class="op" id="7182283">)</span><span class="op" id="7182284">)</span><span class="op" id="7182285">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7182289">Delay</span><span class="op" id="7182294">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7182300">make</span><span class="op" id="7182304">(</span><span class="op" id="7182305">[</span><span class="op" id="7182306">]</span><span class="builtintype" id="7182307">int</span><span class="op" id="7182310">,</span>&nbsp;<span class="builtinfunc" id="7182312">len</span><span class="op" id="7182315">(</span><span class="ident" id="7182316">frames</span><span class="op" id="7182322">)</span><span class="op" id="7182323">)</span><span class="op" id="7182324">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7182328">LoopCount</span><span class="op" id="7182337">:</span>&nbsp;<span class="num" id="7182339">5</span><span class="op" id="7182340">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7182343">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7182346">for</span>&nbsp;<span class="ident" id="7182350">i</span><span class="op" id="7182351">,</span>&nbsp;<span class="ident" id="7182353">f</span>&nbsp;<span class="op" id="7182355">:=</span>&nbsp;<span class="keyword" id="7182358">range</span>&nbsp;<span class="ident" id="7182364">frames</span>&nbsp;<span class="op" id="7182371">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7182375">m</span><span class="op" id="7182376">,</span>&nbsp;<span class="ident" id="7182378">err</span>&nbsp;<span class="op" id="7182382">:=</span>&nbsp;<span class="ident" id="7182385">readGIF</span><span class="op" id="7182392">(</span><span class="ident" id="7182393">f</span><span class="op" id="7182394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7182398">if</span>&nbsp;<span class="ident" id="7182401">err</span>&nbsp;<span class="op" id="7182405">!=</span>&nbsp;<span class="ident" id="7182408">nil</span>&nbsp;<span class="op" id="7182412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7182417">t</span><span class="op" id="7182418">.</span><span class="ident" id="7182419">Fatal</span><span class="op" id="7182424">(</span><span class="ident" id="7182425">f</span><span class="op" id="7182426">,</span>&nbsp;<span class="ident" id="7182428">err</span><span class="op" id="7182431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7182435">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7182439">g0</span><span class="op" id="7182441">.</span><span class="ident" id="7182442">Image</span><span class="op" id="7182447">[</span><span class="ident" id="7182448">i</span><span class="op" id="7182449">]</span>&nbsp;<span class="op" id="7182451">=</span>&nbsp;<span class="ident" id="7182453">m</span><span class="op" id="7182454">.</span><span class="ident" id="7182455">Image</span><span class="op" id="7182460">[</span><span class="num" id="7182461">0</span><span class="op" id="7182462">]</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7182465">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7182468">var</span>&nbsp;<span class="ident" id="7182472">buf</span>&nbsp;<span class="ident" id="7182476">bytes</span><span class="op" id="7182481">.</span><span class="ident" id="7182482">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7182490">if</span>&nbsp;<span class="ident" id="7182493">err</span>&nbsp;<span class="op" id="7182497">:=</span>&nbsp;<span class="ident" id="7182500">EncodeAll</span><span class="op" id="7182509">(</span><span class="op" id="7182510">&amp;</span><span class="ident" id="7182511">buf</span><span class="op" id="7182514">,</span>&nbsp;<span class="ident" id="7182516">g0</span><span class="op" id="7182518">)</span><span class="op" id="7182519">;</span>&nbsp;<span class="ident" id="7182521">err</span>&nbsp;<span class="op" id="7182525">!=</span>&nbsp;<span class="ident" id="7182528">nil</span>&nbsp;<span class="op" id="7182532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7182536">t</span><span class="op" id="7182537">.</span><span class="ident" id="7182538">Fatal</span><span class="op" id="7182543">(</span><span class="string" id="7182544">&#34;EncodeAll:&#34;</span><span class="op" id="7182556">,</span>&nbsp;<span class="ident" id="7182558">err</span><span class="op" id="7182561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7182564">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7182567">g1</span><span class="op" id="7182569">,</span>&nbsp;<span class="ident" id="7182571">err</span>&nbsp;<span class="op" id="7182575">:=</span>&nbsp;<span class="ident" id="7182578">DecodeAll</span><span class="op" id="7182587">(</span><span class="op" id="7182588">&amp;</span><span class="ident" id="7182589">buf</span><span class="op" id="7182592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7182595">if</span>&nbsp;<span class="ident" id="7182598">err</span>&nbsp;<span class="op" id="7182602">!=</span>&nbsp;<span class="ident" id="7182605">nil</span>&nbsp;<span class="op" id="7182609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7182613">t</span><span class="op" id="7182614">.</span><span class="ident" id="7182615">Fatal</span><span class="op" id="7182620">(</span><span class="string" id="7182621">&#34;DecodeAll:&#34;</span><span class="op" id="7182633">,</span>&nbsp;<span class="ident" id="7182635">err</span><span class="op" id="7182638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7182641">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7182644">if</span>&nbsp;<span class="ident" id="7182647">g0</span><span class="op" id="7182649">.</span><span class="ident" id="7182650">LoopCount</span>&nbsp;<span class="op" id="7182660">!=</span>&nbsp;<span class="ident" id="7182663">g1</span><span class="op" id="7182665">.</span><span class="ident" id="7182666">LoopCount</span>&nbsp;<span class="op" id="7182676">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7182680">t</span><span class="op" id="7182681">.</span><span class="ident" id="7182682">Errorf</span><span class="op" id="7182688">(</span><span class="string" id="7182689">&#34;loop&nbsp;counts&nbsp;differ:&nbsp;%d&nbsp;and&nbsp;%d&#34;</span><span class="op" id="7182720">,</span>&nbsp;<span class="ident" id="7182722">g0</span><span class="op" id="7182724">.</span><span class="ident" id="7182725">LoopCount</span><span class="op" id="7182734">,</span>&nbsp;<span class="ident" id="7182736">g1</span><span class="op" id="7182738">.</span><span class="ident" id="7182739">LoopCount</span><span class="op" id="7182748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7182751">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7182754">for</span>&nbsp;<span class="ident" id="7182758">i</span>&nbsp;<span class="op" id="7182760">:=</span>&nbsp;<span class="keyword" id="7182763">range</span>&nbsp;<span class="ident" id="7182769">g0</span><span class="op" id="7182771">.</span><span class="ident" id="7182772">Image</span>&nbsp;<span class="op" id="7182778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7182782">m0</span><span class="op" id="7182784">,</span>&nbsp;<span class="ident" id="7182786">m1</span>&nbsp;<span class="op" id="7182789">:=</span>&nbsp;<span class="ident" id="7182792">g0</span><span class="op" id="7182794">.</span><span class="ident" id="7182795">Image</span><span class="op" id="7182800">[</span><span class="ident" id="7182801">i</span><span class="op" id="7182802">]</span><span class="op" id="7182803">,</span>&nbsp;<span class="ident" id="7182805">g1</span><span class="op" id="7182807">.</span><span class="ident" id="7182808">Image</span><span class="op" id="7182813">[</span><span class="ident" id="7182814">i</span><span class="op" id="7182815">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7182819">if</span>&nbsp;<span class="ident" id="7182822">m0</span><span class="op" id="7182824">.</span><span class="ident" id="7182825">Bounds</span><span class="op" id="7182831">(</span><span class="op" id="7182832">)</span>&nbsp;<span class="op" id="7182834">!=</span>&nbsp;<span class="ident" id="7182837">m1</span><span class="op" id="7182839">.</span><span class="ident" id="7182840">Bounds</span><span class="op" id="7182846">(</span><span class="op" id="7182847">)</span>&nbsp;<span class="op" id="7182849">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7182854">t</span><span class="op" id="7182855">.</span><span class="ident" id="7182856">Errorf</span><span class="op" id="7182862">(</span><span class="string" id="7182863">&#34;%s,&nbsp;bounds&nbsp;differ:&nbsp;%v&nbsp;and&nbsp;%v&#34;</span><span class="op" id="7182893">,</span>&nbsp;<span class="ident" id="7182895">frames</span><span class="op" id="7182901">[</span><span class="ident" id="7182902">i</span><span class="op" id="7182903">]</span><span class="op" id="7182904">,</span>&nbsp;<span class="ident" id="7182906">m0</span><span class="op" id="7182908">.</span><span class="ident" id="7182909">Bounds</span><span class="op" id="7182915">(</span><span class="op" id="7182916">)</span><span class="op" id="7182917">,</span>&nbsp;<span class="ident" id="7182919">m1</span><span class="op" id="7182921">.</span><span class="ident" id="7182922">Bounds</span><span class="op" id="7182928">(</span><span class="op" id="7182929">)</span><span class="op" id="7182930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7182934">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7182938">d0</span><span class="op" id="7182940">,</span>&nbsp;<span class="ident" id="7182942">d1</span>&nbsp;<span class="op" id="7182945">:=</span>&nbsp;<span class="ident" id="7182948">g0</span><span class="op" id="7182950">.</span><span class="ident" id="7182951">Delay</span><span class="op" id="7182956">[</span><span class="ident" id="7182957">i</span><span class="op" id="7182958">]</span><span class="op" id="7182959">,</span>&nbsp;<span class="ident" id="7182961">g1</span><span class="op" id="7182963">.</span><span class="ident" id="7182964">Delay</span><span class="op" id="7182969">[</span><span class="ident" id="7182970">i</span><span class="op" id="7182971">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7182975">if</span>&nbsp;<span class="ident" id="7182978">d0</span>&nbsp;<span class="op" id="7182981">!=</span>&nbsp;<span class="ident" id="7182984">d1</span>&nbsp;<span class="op" id="7182987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7182992">t</span><span class="op" id="7182993">.</span><span class="ident" id="7182994">Errorf</span><span class="op" id="7183000">(</span><span class="string" id="7183001">&#34;%s:&nbsp;delay&nbsp;values&nbsp;differ:&nbsp;%d&nbsp;and&nbsp;%d&#34;</span><span class="op" id="7183037">,</span>&nbsp;<span class="ident" id="7183039">frames</span><span class="op" id="7183045">[</span><span class="ident" id="7183046">i</span><span class="op" id="7183047">]</span><span class="op" id="7183048">,</span>&nbsp;<span class="ident" id="7183050">d0</span><span class="op" id="7183052">,</span>&nbsp;<span class="ident" id="7183054">d1</span><span class="op" id="7183056">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7183060">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7183063">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7183067">g1</span><span class="op" id="7183069">.</span><span class="ident" id="7183070">Delay</span>&nbsp;<span class="op" id="7183076">=</span>&nbsp;<span class="builtinfunc" id="7183078">make</span><span class="op" id="7183082">(</span><span class="op" id="7183083">[</span><span class="op" id="7183084">]</span><span class="builtintype" id="7183085">int</span><span class="op" id="7183088">,</span>&nbsp;<span class="num" id="7183090">1</span><span class="op" id="7183091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7183094">if</span>&nbsp;<span class="ident" id="7183097">err</span>&nbsp;<span class="op" id="7183101">:=</span>&nbsp;<span class="ident" id="7183104">EncodeAll</span><span class="op" id="7183113">(</span><span class="ident" id="7183114">ioutil</span><span class="op" id="7183120">.</span><span class="ident" id="7183121">Discard</span><span class="op" id="7183128">,</span>&nbsp;<span class="ident" id="7183130">g1</span><span class="op" id="7183132">)</span><span class="op" id="7183133">;</span>&nbsp;<span class="ident" id="7183135">err</span>&nbsp;<span class="op" id="7183139">==</span>&nbsp;<span class="ident" id="7183142">nil</span>&nbsp;<span class="op" id="7183146">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7183150">t</span><span class="op" id="7183151">.</span><span class="ident" id="7183152">Error</span><span class="op" id="7183157">(</span><span class="string" id="7183158">&#34;expected&nbsp;error&nbsp;from&nbsp;mismatched&nbsp;delay&nbsp;and&nbsp;image&nbsp;slice&nbsp;lengths&#34;</span><span class="op" id="7183220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7183223">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7183226">if</span>&nbsp;<span class="ident" id="7183229">err</span>&nbsp;<span class="op" id="7183233">:=</span>&nbsp;<span class="ident" id="7183236">EncodeAll</span><span class="op" id="7183245">(</span><span class="ident" id="7183246">ioutil</span><span class="op" id="7183252">.</span><span class="ident" id="7183253">Discard</span><span class="op" id="7183260">,</span>&nbsp;<span class="op" id="7183262">&amp;</span><span class="ident" id="7183263">GIF</span><span class="op" id="7183266">{</span><span class="op" id="7183267">}</span><span class="op" id="7183268">)</span><span class="op" id="7183269">;</span>&nbsp;<span class="ident" id="7183271">err</span>&nbsp;<span class="op" id="7183275">==</span>&nbsp;<span class="ident" id="7183278">nil</span>&nbsp;<span class="op" id="7183282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7183286">t</span><span class="op" id="7183287">.</span><span class="ident" id="7183288">Error</span><span class="op" id="7183293">(</span><span class="string" id="7183294">&#34;expected&nbsp;error&nbsp;from&nbsp;providing&nbsp;empty&nbsp;gif&#34;</span><span class="op" id="7183335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7183338">}</span><br>
<span class="lineno">175</span><span class="op" id="7183340">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7183343">func</span>&nbsp;<span class="ident" id="7183348">BenchmarkEncode</span><span class="op" id="7183363">(</span><span class="ident" id="7183364">b</span>&nbsp;<span class="op" id="7183366">*</span><span class="ident" id="7183367">testing</span><span class="op" id="7183374">.</span><span class="ident" id="7183375">B</span><span class="op" id="7183376">)</span>&nbsp;<span class="op" id="7183378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7183381">b</span><span class="op" id="7183382">.</span><span class="ident" id="7183383">StopTimer</span><span class="op" id="7183392">(</span><span class="op" id="7183393">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7183397">bo</span>&nbsp;<span class="op" id="7183400">:=</span>&nbsp;<span class="ident" id="7183403">image</span><span class="op" id="7183408">.</span><span class="ident" id="7183409">Rect</span><span class="op" id="7183413">(</span><span class="num" id="7183414">0</span><span class="op" id="7183415">,</span>&nbsp;<span class="num" id="7183417">0</span><span class="op" id="7183418">,</span>&nbsp;<span class="num" id="7183420">640</span><span class="op" id="7183423">,</span>&nbsp;<span class="num" id="7183425">480</span><span class="op" id="7183428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7183431">rnd</span>&nbsp;<span class="op" id="7183435">:=</span>&nbsp;<span class="ident" id="7183438">rand</span><span class="op" id="7183442">.</span><span class="ident" id="7183443">New</span><span class="op" id="7183446">(</span><span class="ident" id="7183447">rand</span><span class="op" id="7183451">.</span><span class="ident" id="7183452">NewSource</span><span class="op" id="7183461">(</span><span class="num" id="7183462">123</span><span class="op" id="7183465">)</span><span class="op" id="7183466">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7183470">//&nbsp;Restrict&nbsp;to&nbsp;a&nbsp;256-color&nbsp;paletted&nbsp;image&nbsp;to&nbsp;avoid&nbsp;quantization&nbsp;path.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7183541">palette</span>&nbsp;<span class="op" id="7183549">:=</span>&nbsp;<span class="builtinfunc" id="7183552">make</span><span class="op" id="7183556">(</span><span class="ident" id="7183557">color</span><span class="op" id="7183562">.</span><span class="ident" id="7183563">Palette</span><span class="op" id="7183570">,</span>&nbsp;<span class="num" id="7183572">256</span><span class="op" id="7183575">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7183578">for</span>&nbsp;<span class="ident" id="7183582">i</span>&nbsp;<span class="op" id="7183584">:=</span>&nbsp;<span class="keyword" id="7183587">range</span>&nbsp;<span class="ident" id="7183593">palette</span>&nbsp;<span class="op" id="7183601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7183605">palette</span><span class="op" id="7183612">[</span><span class="ident" id="7183613">i</span><span class="op" id="7183614">]</span>&nbsp;<span class="op" id="7183616">=</span>&nbsp;<span class="ident" id="7183618">color</span><span class="op" id="7183623">.</span><span class="ident" id="7183624">RGBA</span><span class="op" id="7183628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7183633">uint8</span><span class="op" id="7183638">(</span><span class="ident" id="7183639">rnd</span><span class="op" id="7183642">.</span><span class="ident" id="7183643">Intn</span><span class="op" id="7183647">(</span><span class="num" id="7183648">256</span><span class="op" id="7183651">)</span><span class="op" id="7183652">)</span><span class="op" id="7183653">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7183658">uint8</span><span class="op" id="7183663">(</span><span class="ident" id="7183664">rnd</span><span class="op" id="7183667">.</span><span class="ident" id="7183668">Intn</span><span class="op" id="7183672">(</span><span class="num" id="7183673">256</span><span class="op" id="7183676">)</span><span class="op" id="7183677">)</span><span class="op" id="7183678">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7183683">uint8</span><span class="op" id="7183688">(</span><span class="ident" id="7183689">rnd</span><span class="op" id="7183692">.</span><span class="ident" id="7183693">Intn</span><span class="op" id="7183697">(</span><span class="num" id="7183698">256</span><span class="op" id="7183701">)</span><span class="op" id="7183702">)</span><span class="op" id="7183703">,</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7183708">255</span><span class="op" id="7183711">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7183715">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7183718">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7183721">img</span>&nbsp;<span class="op" id="7183725">:=</span>&nbsp;<span class="ident" id="7183728">image</span><span class="op" id="7183733">.</span><span class="ident" id="7183734">NewPaletted</span><span class="op" id="7183745">(</span><span class="ident" id="7183746">image</span><span class="op" id="7183751">.</span><span class="ident" id="7183752">Rect</span><span class="op" id="7183756">(</span><span class="num" id="7183757">0</span><span class="op" id="7183758">,</span>&nbsp;<span class="num" id="7183760">0</span><span class="op" id="7183761">,</span>&nbsp;<span class="num" id="7183763">640</span><span class="op" id="7183766">,</span>&nbsp;<span class="num" id="7183768">480</span><span class="op" id="7183771">)</span><span class="op" id="7183772">,</span>&nbsp;<span class="ident" id="7183774">palette</span><span class="op" id="7183781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7183784">for</span>&nbsp;<span class="ident" id="7183788">y</span>&nbsp;<span class="op" id="7183790">:=</span>&nbsp;<span class="ident" id="7183793">bo</span><span class="op" id="7183795">.</span><span class="ident" id="7183796">Min</span><span class="op" id="7183799">.</span><span class="ident" id="7183800">Y</span><span class="op" id="7183801">;</span>&nbsp;<span class="ident" id="7183803">y</span>&nbsp;<span class="op" id="7183805">&lt;</span>&nbsp;<span class="ident" id="7183807">bo</span><span class="op" id="7183809">.</span><span class="ident" id="7183810">Max</span><span class="op" id="7183813">.</span><span class="ident" id="7183814">Y</span><span class="op" id="7183815">;</span>&nbsp;<span class="ident" id="7183817">y</span><span class="op" id="7183818">++</span>&nbsp;<span class="op" id="7183821">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7183825">for</span>&nbsp;<span class="ident" id="7183829">x</span>&nbsp;<span class="op" id="7183831">:=</span>&nbsp;<span class="ident" id="7183834">bo</span><span class="op" id="7183836">.</span><span class="ident" id="7183837">Min</span><span class="op" id="7183840">.</span><span class="ident" id="7183841">X</span><span class="op" id="7183842">;</span>&nbsp;<span class="ident" id="7183844">x</span>&nbsp;<span class="op" id="7183846">&lt;</span>&nbsp;<span class="ident" id="7183848">bo</span><span class="op" id="7183850">.</span><span class="ident" id="7183851">Max</span><span class="op" id="7183854">.</span><span class="ident" id="7183855">X</span><span class="op" id="7183856">;</span>&nbsp;<span class="ident" id="7183858">x</span><span class="op" id="7183859">++</span>&nbsp;<span class="op" id="7183862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7183867">img</span><span class="op" id="7183870">.</span><span class="ident" id="7183871">Set</span><span class="op" id="7183874">(</span><span class="ident" id="7183875">x</span><span class="op" id="7183876">,</span>&nbsp;<span class="ident" id="7183878">y</span><span class="op" id="7183879">,</span>&nbsp;<span class="ident" id="7183881">palette</span><span class="op" id="7183888">[</span><span class="ident" id="7183889">rnd</span><span class="op" id="7183892">.</span><span class="ident" id="7183893">Intn</span><span class="op" id="7183897">(</span><span class="num" id="7183898">256</span><span class="op" id="7183901">)</span><span class="op" id="7183902">]</span><span class="op" id="7183903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7183907">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7183910">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7183914">b</span><span class="op" id="7183915">.</span><span class="ident" id="7183916">SetBytes</span><span class="op" id="7183924">(</span><span class="num" id="7183925">640</span>&nbsp;<span class="op" id="7183929">*</span>&nbsp;<span class="num" id="7183931">480</span>&nbsp;<span class="op" id="7183935">*</span>&nbsp;<span class="num" id="7183937">4</span><span class="op" id="7183938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7183941">b</span><span class="op" id="7183942">.</span><span class="ident" id="7183943">StartTimer</span><span class="op" id="7183953">(</span><span class="op" id="7183954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7183957">for</span>&nbsp;<span class="ident" id="7183961">i</span>&nbsp;<span class="op" id="7183963">:=</span>&nbsp;<span class="num" id="7183966">0</span><span class="op" id="7183967">;</span>&nbsp;<span class="ident" id="7183969">i</span>&nbsp;<span class="op" id="7183971">&lt;</span>&nbsp;<span class="ident" id="7183973">b</span><span class="op" id="7183974">.</span><span class="ident" id="7183975">N</span><span class="op" id="7183976">;</span>&nbsp;<span class="ident" id="7183978">i</span><span class="op" id="7183979">++</span>&nbsp;<span class="op" id="7183982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7183986">Encode</span><span class="op" id="7183992">(</span><span class="ident" id="7183993">ioutil</span><span class="op" id="7183999">.</span><span class="ident" id="7184000">Discard</span><span class="op" id="7184007">,</span>&nbsp;<span class="ident" id="7184009">img</span><span class="op" id="7184012">,</span>&nbsp;<span class="ident" id="7184014">nil</span><span class="op" id="7184017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7184020">}</span><br>
<span class="lineno">205</span><span class="op" id="7184022">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7184025">func</span>&nbsp;<span class="ident" id="7184030">BenchmarkQuantizedEncode</span><span class="op" id="7184054">(</span><span class="ident" id="7184055">b</span>&nbsp;<span class="op" id="7184057">*</span><span class="ident" id="7184058">testing</span><span class="op" id="7184065">.</span><span class="ident" id="7184066">B</span><span class="op" id="7184067">)</span>&nbsp;<span class="op" id="7184069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7184072">b</span><span class="op" id="7184073">.</span><span class="ident" id="7184074">StopTimer</span><span class="op" id="7184083">(</span><span class="op" id="7184084">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7184087">img</span>&nbsp;<span class="op" id="7184091">:=</span>&nbsp;<span class="ident" id="7184094">image</span><span class="op" id="7184099">.</span><span class="ident" id="7184100">NewRGBA</span><span class="op" id="7184107">(</span><span class="ident" id="7184108">image</span><span class="op" id="7184113">.</span><span class="ident" id="7184114">Rect</span><span class="op" id="7184118">(</span><span class="num" id="7184119">0</span><span class="op" id="7184120">,</span>&nbsp;<span class="num" id="7184122">0</span><span class="op" id="7184123">,</span>&nbsp;<span class="num" id="7184125">640</span><span class="op" id="7184128">,</span>&nbsp;<span class="num" id="7184130">480</span><span class="op" id="7184133">)</span><span class="op" id="7184134">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7184137">bo</span>&nbsp;<span class="op" id="7184140">:=</span>&nbsp;<span class="ident" id="7184143">img</span><span class="op" id="7184146">.</span><span class="ident" id="7184147">Bounds</span><span class="op" id="7184153">(</span><span class="op" id="7184154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7184157">rnd</span>&nbsp;<span class="op" id="7184161">:=</span>&nbsp;<span class="ident" id="7184164">rand</span><span class="op" id="7184168">.</span><span class="ident" id="7184169">New</span><span class="op" id="7184172">(</span><span class="ident" id="7184173">rand</span><span class="op" id="7184177">.</span><span class="ident" id="7184178">NewSource</span><span class="op" id="7184187">(</span><span class="num" id="7184188">123</span><span class="op" id="7184191">)</span><span class="op" id="7184192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7184195">for</span>&nbsp;<span class="ident" id="7184199">y</span>&nbsp;<span class="op" id="7184201">:=</span>&nbsp;<span class="ident" id="7184204">bo</span><span class="op" id="7184206">.</span><span class="ident" id="7184207">Min</span><span class="op" id="7184210">.</span><span class="ident" id="7184211">Y</span><span class="op" id="7184212">;</span>&nbsp;<span class="ident" id="7184214">y</span>&nbsp;<span class="op" id="7184216">&lt;</span>&nbsp;<span class="ident" id="7184218">bo</span><span class="op" id="7184220">.</span><span class="ident" id="7184221">Max</span><span class="op" id="7184224">.</span><span class="ident" id="7184225">Y</span><span class="op" id="7184226">;</span>&nbsp;<span class="ident" id="7184228">y</span><span class="op" id="7184229">++</span>&nbsp;<span class="op" id="7184232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7184236">for</span>&nbsp;<span class="ident" id="7184240">x</span>&nbsp;<span class="op" id="7184242">:=</span>&nbsp;<span class="ident" id="7184245">bo</span><span class="op" id="7184247">.</span><span class="ident" id="7184248">Min</span><span class="op" id="7184251">.</span><span class="ident" id="7184252">X</span><span class="op" id="7184253">;</span>&nbsp;<span class="ident" id="7184255">x</span>&nbsp;<span class="op" id="7184257">&lt;</span>&nbsp;<span class="ident" id="7184259">bo</span><span class="op" id="7184261">.</span><span class="ident" id="7184262">Max</span><span class="op" id="7184265">.</span><span class="ident" id="7184266">X</span><span class="op" id="7184267">;</span>&nbsp;<span class="ident" id="7184269">x</span><span class="op" id="7184270">++</span>&nbsp;<span class="op" id="7184273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7184278">img</span><span class="op" id="7184281">.</span><span class="ident" id="7184282">SetRGBA</span><span class="op" id="7184289">(</span><span class="ident" id="7184290">x</span><span class="op" id="7184291">,</span>&nbsp;<span class="ident" id="7184293">y</span><span class="op" id="7184294">,</span>&nbsp;<span class="ident" id="7184296">color</span><span class="op" id="7184301">.</span><span class="ident" id="7184302">RGBA</span><span class="op" id="7184306">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7184312">uint8</span><span class="op" id="7184317">(</span><span class="ident" id="7184318">rnd</span><span class="op" id="7184321">.</span><span class="ident" id="7184322">Intn</span><span class="op" id="7184326">(</span><span class="num" id="7184327">256</span><span class="op" id="7184330">)</span><span class="op" id="7184331">)</span><span class="op" id="7184332">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7184338">uint8</span><span class="op" id="7184343">(</span><span class="ident" id="7184344">rnd</span><span class="op" id="7184347">.</span><span class="ident" id="7184348">Intn</span><span class="op" id="7184352">(</span><span class="num" id="7184353">256</span><span class="op" id="7184356">)</span><span class="op" id="7184357">)</span><span class="op" id="7184358">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7184364">uint8</span><span class="op" id="7184369">(</span><span class="ident" id="7184370">rnd</span><span class="op" id="7184373">.</span><span class="ident" id="7184374">Intn</span><span class="op" id="7184378">(</span><span class="num" id="7184379">256</span><span class="op" id="7184382">)</span><span class="op" id="7184383">)</span><span class="op" id="7184384">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7184390">255</span><span class="op" id="7184393">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7184398">}</span><span class="op" id="7184399">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7184403">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7184406">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7184409">b</span><span class="op" id="7184410">.</span><span class="ident" id="7184411">SetBytes</span><span class="op" id="7184419">(</span><span class="num" id="7184420">640</span>&nbsp;<span class="op" id="7184424">*</span>&nbsp;<span class="num" id="7184426">480</span>&nbsp;<span class="op" id="7184430">*</span>&nbsp;<span class="num" id="7184432">4</span><span class="op" id="7184433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7184436">b</span><span class="op" id="7184437">.</span><span class="ident" id="7184438">StartTimer</span><span class="op" id="7184448">(</span><span class="op" id="7184449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7184452">for</span>&nbsp;<span class="ident" id="7184456">i</span>&nbsp;<span class="op" id="7184458">:=</span>&nbsp;<span class="num" id="7184461">0</span><span class="op" id="7184462">;</span>&nbsp;<span class="ident" id="7184464">i</span>&nbsp;<span class="op" id="7184466">&lt;</span>&nbsp;<span class="ident" id="7184468">b</span><span class="op" id="7184469">.</span><span class="ident" id="7184470">N</span><span class="op" id="7184471">;</span>&nbsp;<span class="ident" id="7184473">i</span><span class="op" id="7184474">++</span>&nbsp;<span class="op" id="7184477">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7184481">Encode</span><span class="op" id="7184487">(</span><span class="ident" id="7184488">ioutil</span><span class="op" id="7184494">.</span><span class="ident" id="7184495">Discard</span><span class="op" id="7184502">,</span>&nbsp;<span class="ident" id="7184504">img</span><span class="op" id="7184507">,</span>&nbsp;<span class="ident" id="7184509">nil</span><span class="op" id="7184512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7184515">}</span><br>
<span class="lineno"></span><span class="op" id="7184517">}</span>
</div>
</body>
</html>
