<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/cookiejar</h2>
<ul>
<li><a href="/gostd/net/http/cookiejar/jar.go.html" class="current">jar.go</a></li>
<li><a href="/gostd/net/http/cookiejar/jar_test.go.html">jar_test.go</a></li>
<li><a href="/gostd/net/http/cookiejar/punycode.go.html">punycode.go</a></li>
<li><a href="/gostd/net/http/cookiejar/punycode_test.go.html">punycode_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6270986">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6271041">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6271095">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6271146">//&nbsp;Package&nbsp;cookiejar&nbsp;implements&nbsp;an&nbsp;in-memory&nbsp;RFC&nbsp;6265-compliant&nbsp;http.CookieJar.</span><br>
<span class="lineno"></span><span class="keyword" id="6271226">package</span>&nbsp;<span class="ident" id="6271234">cookiejar</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6271245">import</span>&nbsp;<span class="op" id="6271252">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6271255">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6271265">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6271272">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6271279">&#34;net/http&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6271291">&#34;net/url&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6271302">&#34;sort&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6271310">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6271321">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6271329">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6271336">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="6271339">//&nbsp;PublicSuffixList&nbsp;provides&nbsp;the&nbsp;public&nbsp;suffix&nbsp;of&nbsp;a&nbsp;domain.&nbsp;For&nbsp;example:</span><br>
<span class="lineno"></span><span class="comment" id="6271412">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;public&nbsp;suffix&nbsp;of&nbsp;&#34;example.com&#34;&nbsp;is&nbsp;&#34;com&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="6271467">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;public&nbsp;suffix&nbsp;of&nbsp;&#34;foo1.foo2.foo3.co.uk&#34;&nbsp;is&nbsp;&#34;co.uk&#34;,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="6271537">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;public&nbsp;suffix&nbsp;of&nbsp;&#34;bar.pvt.k12.ma.us&#34;&nbsp;is&nbsp;&#34;pvt.k12.ma.us&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="6271608">//</span><br>
<span class="lineno">25</span><span class="comment" id="6271611">//&nbsp;Implementations&nbsp;of&nbsp;PublicSuffixList&nbsp;must&nbsp;be&nbsp;safe&nbsp;for&nbsp;concurrent&nbsp;use&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="6271685">//&nbsp;multiple&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="comment" id="6271709">//</span><br>
<span class="lineno"></span><span class="comment" id="6271712">//&nbsp;An&nbsp;implementation&nbsp;that&nbsp;always&nbsp;returns&nbsp;&#34;&#34;&nbsp;is&nbsp;valid&nbsp;and&nbsp;may&nbsp;be&nbsp;useful&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="6271787">//&nbsp;testing&nbsp;but&nbsp;it&nbsp;is&nbsp;not&nbsp;secure:&nbsp;it&nbsp;means&nbsp;that&nbsp;the&nbsp;HTTP&nbsp;server&nbsp;for&nbsp;foo.com&nbsp;can</span><br>
<span class="lineno">30</span><span class="comment" id="6271866">//&nbsp;set&nbsp;a&nbsp;cookie&nbsp;for&nbsp;bar.com.</span><br>
<span class="lineno"></span><span class="comment" id="6271895">//</span><br>
<span class="lineno"></span><span class="comment" id="6271898">//&nbsp;A&nbsp;public&nbsp;suffix&nbsp;list&nbsp;implementation&nbsp;is&nbsp;in&nbsp;the&nbsp;package</span><br>
<span class="lineno"></span><span class="comment" id="6271955">//&nbsp;golang.org/x/net/publicsuffix.</span><br>
<span class="lineno"></span><span class="keyword" id="6271989">type</span>&nbsp;<span class="ident" id="6271994">PublicSuffixList</span>&nbsp;<span class="keyword" id="6272011">interface</span>&nbsp;<span class="op" id="6272021">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6272024">//&nbsp;PublicSuffix&nbsp;returns&nbsp;the&nbsp;public&nbsp;suffix&nbsp;of&nbsp;domain.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6272078">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6272082">//&nbsp;TODO:&nbsp;specify&nbsp;which&nbsp;of&nbsp;the&nbsp;caller&nbsp;and&nbsp;callee&nbsp;is&nbsp;responsible&nbsp;for&nbsp;IP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6272153">//&nbsp;addresses,&nbsp;for&nbsp;leading&nbsp;and&nbsp;trailing&nbsp;dots,&nbsp;for&nbsp;case&nbsp;sensitivity,&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6272225">//&nbsp;for&nbsp;IDN/Punycode.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6272247">PublicSuffix</span><span class="op" id="6272259">(</span><span class="ident" id="6272260">domain</span>&nbsp;<span class="builtintype" id="6272267">string</span><span class="op" id="6272273">)</span>&nbsp;<span class="builtintype" id="6272275">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6272284">//&nbsp;String&nbsp;returns&nbsp;a&nbsp;description&nbsp;of&nbsp;the&nbsp;source&nbsp;of&nbsp;this&nbsp;public&nbsp;suffix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6272353">//&nbsp;list.&nbsp;The&nbsp;description&nbsp;will&nbsp;typically&nbsp;contain&nbsp;something&nbsp;like&nbsp;a&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6272424">//&nbsp;stamp&nbsp;or&nbsp;version&nbsp;number.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6272453">String</span><span class="op" id="6272459">(</span><span class="op" id="6272460">)</span>&nbsp;<span class="builtintype" id="6272462">string</span><br>
<span class="lineno"></span><span class="op" id="6272469">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6272472">//&nbsp;Options&nbsp;are&nbsp;the&nbsp;options&nbsp;for&nbsp;creating&nbsp;a&nbsp;new&nbsp;Jar.</span><br>
<span class="lineno"></span><span class="keyword" id="6272523">type</span>&nbsp;<span class="ident" id="6272528">Options</span>&nbsp;<span class="keyword" id="6272536">struct</span>&nbsp;<span class="op" id="6272543">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6272546">//&nbsp;PublicSuffixList&nbsp;is&nbsp;the&nbsp;public&nbsp;suffix&nbsp;list&nbsp;that&nbsp;determines&nbsp;whether</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6272617">//&nbsp;an&nbsp;HTTP&nbsp;server&nbsp;can&nbsp;set&nbsp;a&nbsp;cookie&nbsp;for&nbsp;a&nbsp;domain.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6272667">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6272671">//&nbsp;A&nbsp;nil&nbsp;value&nbsp;is&nbsp;valid&nbsp;and&nbsp;may&nbsp;be&nbsp;useful&nbsp;for&nbsp;testing&nbsp;but&nbsp;it&nbsp;is&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6272740">//&nbsp;secure:&nbsp;it&nbsp;means&nbsp;that&nbsp;the&nbsp;HTTP&nbsp;server&nbsp;for&nbsp;foo.co.uk&nbsp;can&nbsp;set&nbsp;a&nbsp;cookie</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6272813">//&nbsp;for&nbsp;bar.co.uk.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6272832">PublicSuffixList</span>&nbsp;<span class="ident" id="6272849">PublicSuffixList</span><br>
<span class="lineno"></span><span class="op" id="6272866">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6272869">//&nbsp;Jar&nbsp;implements&nbsp;the&nbsp;http.CookieJar&nbsp;interface&nbsp;from&nbsp;the&nbsp;net/http&nbsp;package.</span><br>
<span class="lineno">60</span><span class="keyword" id="6272943">type</span>&nbsp;<span class="ident" id="6272948">Jar</span>&nbsp;<span class="keyword" id="6272952">struct</span>&nbsp;<span class="op" id="6272959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6272962">psList</span>&nbsp;<span class="ident" id="6272969">PublicSuffixList</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6272988">//&nbsp;mu&nbsp;locks&nbsp;the&nbsp;remaining&nbsp;fields.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6273023">mu</span>&nbsp;<span class="ident" id="6273026">sync</span><span class="op" id="6273030">.</span><span class="ident" id="6273031">Mutex</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6273039">//&nbsp;entries&nbsp;is&nbsp;a&nbsp;set&nbsp;of&nbsp;entries,&nbsp;keyed&nbsp;by&nbsp;their&nbsp;eTLD+1&nbsp;and&nbsp;subkeyed&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6273110">//&nbsp;their&nbsp;name/domain/path.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6273138">entries</span>&nbsp;<span class="keyword" id="6273146">map</span><span class="op" id="6273149">[</span><span class="builtintype" id="6273150">string</span><span class="op" id="6273156">]</span><span class="keyword" id="6273157">map</span><span class="op" id="6273160">[</span><span class="builtintype" id="6273161">string</span><span class="op" id="6273167">]</span><span class="ident" id="6273168">entry</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6273176">//&nbsp;nextSeqNum&nbsp;is&nbsp;the&nbsp;next&nbsp;sequence&nbsp;number&nbsp;assigned&nbsp;to&nbsp;a&nbsp;new&nbsp;cookie</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6273244">//&nbsp;created&nbsp;SetCookies.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6273268">nextSeqNum</span>&nbsp;<span class="ident" id="6273279">uint64</span><br>
<span class="lineno"></span><span class="op" id="6273286">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="comment" id="6273289">//&nbsp;New&nbsp;returns&nbsp;a&nbsp;new&nbsp;cookie&nbsp;jar.&nbsp;A&nbsp;nil&nbsp;*Options&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;a&nbsp;zero</span><br>
<span class="lineno"></span><span class="comment" id="6273361">//&nbsp;Options.</span><br>
<span class="lineno"></span><span class="keyword" id="6273373">func</span>&nbsp;<span class="ident" id="6273378">New</span><span class="op" id="6273381">(</span><span class="ident" id="6273382">o</span>&nbsp;<span class="op" id="6273384">*</span><span class="ident" id="6273385">Options</span><span class="op" id="6273392">)</span>&nbsp;<span class="op" id="6273394">(</span><span class="op" id="6273395">*</span><span class="ident" id="6273396">Jar</span><span class="op" id="6273399">,</span>&nbsp;<span class="builtintype" id="6273401">error</span><span class="op" id="6273406">)</span>&nbsp;<span class="op" id="6273408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6273411">jar</span>&nbsp;<span class="op" id="6273415">:=</span>&nbsp;<span class="op" id="6273418">&amp;</span><span class="ident" id="6273419">Jar</span><span class="op" id="6273422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6273426">entries</span><span class="op" id="6273433">:</span>&nbsp;<span class="builtinfunc" id="6273435">make</span><span class="op" id="6273439">(</span><span class="keyword" id="6273440">map</span><span class="op" id="6273443">[</span><span class="builtintype" id="6273444">string</span><span class="op" id="6273450">]</span><span class="keyword" id="6273451">map</span><span class="op" id="6273454">[</span><span class="builtintype" id="6273455">string</span><span class="op" id="6273461">]</span><span class="ident" id="6273462">entry</span><span class="op" id="6273467">)</span><span class="op" id="6273468">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6273471">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6273474">if</span>&nbsp;<span class="ident" id="6273477">o</span>&nbsp;<span class="op" id="6273479">!=</span>&nbsp;<span class="builtintype" id="6273482">nil</span>&nbsp;<span class="op" id="6273486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6273490">jar</span><span class="op" id="6273493">.</span><span class="ident" id="6273494">psList</span>&nbsp;<span class="op" id="6273501">=</span>&nbsp;<span class="ident" id="6273503">o</span><span class="op" id="6273504">.</span><span class="ident" id="6273505">PublicSuffixList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6273523">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6273526">return</span>&nbsp;<span class="ident" id="6273533">jar</span><span class="op" id="6273536">,</span>&nbsp;<span class="builtintype" id="6273538">nil</span><br>
<span class="lineno">85</span><span class="op" id="6273542">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6273545">//&nbsp;entry&nbsp;is&nbsp;the&nbsp;internal&nbsp;representation&nbsp;of&nbsp;a&nbsp;cookie.</span><br>
<span class="lineno"></span><span class="comment" id="6273598">//</span><br>
<span class="lineno"></span><span class="comment" id="6273601">//&nbsp;This&nbsp;struct&nbsp;type&nbsp;is&nbsp;not&nbsp;used&nbsp;outside&nbsp;of&nbsp;this&nbsp;package&nbsp;per&nbsp;se,&nbsp;but&nbsp;the&nbsp;exported</span><br>
<span class="lineno">90</span><span class="comment" id="6273682">//&nbsp;fields&nbsp;are&nbsp;those&nbsp;of&nbsp;RFC&nbsp;6265.</span><br>
<span class="lineno"></span><span class="keyword" id="6273715">type</span>&nbsp;<span class="ident" id="6273720">entry</span>&nbsp;<span class="keyword" id="6273726">struct</span>&nbsp;<span class="op" id="6273733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6273736">Name</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6273747">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6273755">Value</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6273766">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6273774">Domain</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6273785">string</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6273793">Path</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6273804">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6273812">Secure</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6273823">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6273829">HttpOnly</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6273840">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6273846">Persistent</span>&nbsp;<span class="builtintype" id="6273857">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6273863">HostOnly</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6273874">bool</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6273880">Expires</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6273891">time</span><span class="op" id="6273895">.</span><span class="ident" id="6273896">Time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6273902">Creation</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6273913">time</span><span class="op" id="6273917">.</span><span class="ident" id="6273918">Time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6273924">LastAccess</span>&nbsp;<span class="ident" id="6273935">time</span><span class="op" id="6273939">.</span><span class="ident" id="6273940">Time</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6273947">//&nbsp;seqNum&nbsp;is&nbsp;a&nbsp;sequence&nbsp;number&nbsp;so&nbsp;that&nbsp;Cookies&nbsp;returns&nbsp;cookies&nbsp;in&nbsp;a</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6274016">//&nbsp;deterministic&nbsp;order,&nbsp;even&nbsp;for&nbsp;cookies&nbsp;that&nbsp;have&nbsp;equal&nbsp;Path&nbsp;length&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6274090">//&nbsp;equal&nbsp;Creation&nbsp;time.&nbsp;This&nbsp;simplifies&nbsp;testing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6274140">seqNum</span>&nbsp;<span class="ident" id="6274147">uint64</span><br>
<span class="lineno"></span><span class="op" id="6274154">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="6274157">//&nbsp;Id&nbsp;returns&nbsp;the&nbsp;domain;path;name&nbsp;triple&nbsp;of&nbsp;e&nbsp;as&nbsp;an&nbsp;id.</span><br>
<span class="lineno"></span><span class="keyword" id="6274214">func</span>&nbsp;<span class="op" id="6274219">(</span><span class="ident" id="6274220">e</span>&nbsp;<span class="op" id="6274222">*</span><span class="ident" id="6274223">entry</span><span class="op" id="6274228">)</span>&nbsp;<span class="ident" id="6274230">id</span><span class="op" id="6274232">(</span><span class="op" id="6274233">)</span>&nbsp;<span class="builtintype" id="6274235">string</span>&nbsp;<span class="op" id="6274242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6274245">return</span>&nbsp;<span class="ident" id="6274252">fmt</span><span class="op" id="6274255">.</span><span class="ident" id="6274256">Sprintf</span><span class="op" id="6274263">(</span><span class="string" id="6274264">&#34;%s;%s;%s&#34;</span><span class="op" id="6274274">,</span>&nbsp;<span class="ident" id="6274276">e</span><span class="op" id="6274277">.</span><span class="ident" id="6274278">Domain</span><span class="op" id="6274284">,</span>&nbsp;<span class="ident" id="6274286">e</span><span class="op" id="6274287">.</span><span class="ident" id="6274288">Path</span><span class="op" id="6274292">,</span>&nbsp;<span class="ident" id="6274294">e</span><span class="op" id="6274295">.</span><span class="ident" id="6274296">Name</span><span class="op" id="6274300">)</span><br>
<span class="lineno"></span><span class="op" id="6274302">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="comment" id="6274305">//&nbsp;shouldSend&nbsp;determines&nbsp;whether&nbsp;e&#39;s&nbsp;cookie&nbsp;qualifies&nbsp;to&nbsp;be&nbsp;included&nbsp;in&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="6274379">//&nbsp;request&nbsp;to&nbsp;host/path.&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;check&nbsp;if&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6274454">//&nbsp;cookie&nbsp;is&nbsp;expired.</span><br>
<span class="lineno"></span><span class="keyword" id="6274476">func</span>&nbsp;<span class="op" id="6274481">(</span><span class="ident" id="6274482">e</span>&nbsp;<span class="op" id="6274484">*</span><span class="ident" id="6274485">entry</span><span class="op" id="6274490">)</span>&nbsp;<span class="ident" id="6274492">shouldSend</span><span class="op" id="6274502">(</span><span class="ident" id="6274503">https</span>&nbsp;<span class="builtintype" id="6274509">bool</span><span class="op" id="6274513">,</span>&nbsp;<span class="ident" id="6274515">host</span><span class="op" id="6274519">,</span>&nbsp;<span class="ident" id="6274521">path</span>&nbsp;<span class="builtintype" id="6274526">string</span><span class="op" id="6274532">)</span>&nbsp;<span class="builtintype" id="6274534">bool</span>&nbsp;<span class="op" id="6274539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6274542">return</span>&nbsp;<span class="ident" id="6274549">e</span><span class="op" id="6274550">.</span><span class="ident" id="6274551">domainMatch</span><span class="op" id="6274562">(</span><span class="ident" id="6274563">host</span><span class="op" id="6274567">)</span>&nbsp;<span class="op" id="6274569">&amp;&amp;</span>&nbsp;<span class="ident" id="6274572">e</span><span class="op" id="6274573">.</span><span class="ident" id="6274574">pathMatch</span><span class="op" id="6274583">(</span><span class="ident" id="6274584">path</span><span class="op" id="6274588">)</span>&nbsp;<span class="op" id="6274590">&amp;&amp;</span>&nbsp;<span class="op" id="6274593">(</span><span class="ident" id="6274594">https</span>&nbsp;<span class="op" id="6274600">||</span>&nbsp;<span class="op" id="6274603">!</span><span class="ident" id="6274604">e</span><span class="op" id="6274605">.</span><span class="ident" id="6274606">Secure</span><span class="op" id="6274612">)</span><br>
<span class="lineno">120</span><span class="op" id="6274614">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6274617">//&nbsp;domainMatch&nbsp;implements&nbsp;&#34;domain-match&#34;&nbsp;of&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.1.3.</span><br>
<span class="lineno"></span><span class="keyword" id="6274685">func</span>&nbsp;<span class="op" id="6274690">(</span><span class="ident" id="6274691">e</span>&nbsp;<span class="op" id="6274693">*</span><span class="ident" id="6274694">entry</span><span class="op" id="6274699">)</span>&nbsp;<span class="ident" id="6274701">domainMatch</span><span class="op" id="6274712">(</span><span class="ident" id="6274713">host</span>&nbsp;<span class="builtintype" id="6274718">string</span><span class="op" id="6274724">)</span>&nbsp;<span class="builtintype" id="6274726">bool</span>&nbsp;<span class="op" id="6274731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6274734">if</span>&nbsp;<span class="ident" id="6274737">e</span><span class="op" id="6274738">.</span><span class="ident" id="6274739">Domain</span>&nbsp;<span class="op" id="6274746">==</span>&nbsp;<span class="ident" id="6274749">host</span>&nbsp;<span class="op" id="6274754">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6274758">return</span>&nbsp;<span class="builtintype" id="6274765">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6274771">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6274774">return</span>&nbsp;<span class="op" id="6274781">!</span><span class="ident" id="6274782">e</span><span class="op" id="6274783">.</span><span class="ident" id="6274784">HostOnly</span>&nbsp;<span class="op" id="6274793">&amp;&amp;</span>&nbsp;<span class="ident" id="6274796">hasDotSuffix</span><span class="op" id="6274808">(</span><span class="ident" id="6274809">host</span><span class="op" id="6274813">,</span>&nbsp;<span class="ident" id="6274815">e</span><span class="op" id="6274816">.</span><span class="ident" id="6274817">Domain</span><span class="op" id="6274823">)</span><br>
<span class="lineno"></span><span class="op" id="6274825">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="6274828">//&nbsp;pathMatch&nbsp;implements&nbsp;&#34;path-match&#34;&nbsp;according&nbsp;to&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.1.4.</span><br>
<span class="lineno"></span><span class="keyword" id="6274902">func</span>&nbsp;<span class="op" id="6274907">(</span><span class="ident" id="6274908">e</span>&nbsp;<span class="op" id="6274910">*</span><span class="ident" id="6274911">entry</span><span class="op" id="6274916">)</span>&nbsp;<span class="ident" id="6274918">pathMatch</span><span class="op" id="6274927">(</span><span class="ident" id="6274928">requestPath</span>&nbsp;<span class="builtintype" id="6274940">string</span><span class="op" id="6274946">)</span>&nbsp;<span class="builtintype" id="6274948">bool</span>&nbsp;<span class="op" id="6274953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6274956">if</span>&nbsp;<span class="ident" id="6274959">requestPath</span>&nbsp;<span class="op" id="6274971">==</span>&nbsp;<span class="ident" id="6274974">e</span><span class="op" id="6274975">.</span><span class="ident" id="6274976">Path</span>&nbsp;<span class="op" id="6274981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6274985">return</span>&nbsp;<span class="builtintype" id="6274992">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6274998">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6275001">if</span>&nbsp;<span class="ident" id="6275004">strings</span><span class="op" id="6275011">.</span><span class="ident" id="6275012">HasPrefix</span><span class="op" id="6275021">(</span><span class="ident" id="6275022">requestPath</span><span class="op" id="6275033">,</span>&nbsp;<span class="ident" id="6275035">e</span><span class="op" id="6275036">.</span><span class="ident" id="6275037">Path</span><span class="op" id="6275041">)</span>&nbsp;<span class="op" id="6275043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6275047">if</span>&nbsp;<span class="ident" id="6275050">e</span><span class="op" id="6275051">.</span><span class="ident" id="6275052">Path</span><span class="op" id="6275056">[</span><span class="builtinfunc" id="6275057">len</span><span class="op" id="6275060">(</span><span class="ident" id="6275061">e</span><span class="op" id="6275062">.</span><span class="ident" id="6275063">Path</span><span class="op" id="6275067">)</span><span class="op" id="6275068">-</span><span class="num" id="6275069">1</span><span class="op" id="6275070">]</span>&nbsp;<span class="op" id="6275072">==</span>&nbsp;<span class="string" id="6275075">&#39;/&#39;</span>&nbsp;<span class="op" id="6275079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6275084">return</span>&nbsp;<span class="builtintype" id="6275091">true</span>&nbsp;<span class="comment" id="6275096">//&nbsp;The&nbsp;&#34;/any/&#34;&nbsp;matches&nbsp;&#34;/any/path&#34;&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6275139">}</span>&nbsp;<span class="keyword" id="6275141">else</span>&nbsp;<span class="keyword" id="6275146">if</span>&nbsp;<span class="ident" id="6275149">requestPath</span><span class="op" id="6275160">[</span><span class="builtinfunc" id="6275161">len</span><span class="op" id="6275164">(</span><span class="ident" id="6275165">e</span><span class="op" id="6275166">.</span><span class="ident" id="6275167">Path</span><span class="op" id="6275171">)</span><span class="op" id="6275172">]</span>&nbsp;<span class="op" id="6275174">==</span>&nbsp;<span class="string" id="6275177">&#39;/&#39;</span>&nbsp;<span class="op" id="6275181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6275186">return</span>&nbsp;<span class="builtintype" id="6275193">true</span>&nbsp;<span class="comment" id="6275198">//&nbsp;The&nbsp;&#34;/any&#34;&nbsp;matches&nbsp;&#34;/any/path&#34;&nbsp;case.</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6275240">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6275243">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6275246">return</span>&nbsp;<span class="builtintype" id="6275253">false</span><br>
<span class="lineno"></span><span class="op" id="6275259">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="comment" id="6275262">//&nbsp;hasDotSuffix&nbsp;reports&nbsp;whether&nbsp;s&nbsp;ends&nbsp;in&nbsp;&#34;.&#34;+suffix.</span><br>
<span class="lineno"></span><span class="keyword" id="6275316">func</span>&nbsp;<span class="ident" id="6275321">hasDotSuffix</span><span class="op" id="6275333">(</span><span class="ident" id="6275334">s</span><span class="op" id="6275335">,</span>&nbsp;<span class="ident" id="6275337">suffix</span>&nbsp;<span class="builtintype" id="6275344">string</span><span class="op" id="6275350">)</span>&nbsp;<span class="builtintype" id="6275352">bool</span>&nbsp;<span class="op" id="6275357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6275360">return</span>&nbsp;<span class="builtinfunc" id="6275367">len</span><span class="op" id="6275370">(</span><span class="ident" id="6275371">s</span><span class="op" id="6275372">)</span>&nbsp;<span class="op" id="6275374">&gt;</span>&nbsp;<span class="builtinfunc" id="6275376">len</span><span class="op" id="6275379">(</span><span class="ident" id="6275380">suffix</span><span class="op" id="6275386">)</span>&nbsp;<span class="op" id="6275388">&amp;&amp;</span>&nbsp;<span class="ident" id="6275391">s</span><span class="op" id="6275392">[</span><span class="builtinfunc" id="6275393">len</span><span class="op" id="6275396">(</span><span class="ident" id="6275397">s</span><span class="op" id="6275398">)</span><span class="op" id="6275399">-</span><span class="builtinfunc" id="6275400">len</span><span class="op" id="6275403">(</span><span class="ident" id="6275404">suffix</span><span class="op" id="6275410">)</span><span class="op" id="6275411">-</span><span class="num" id="6275412">1</span><span class="op" id="6275413">]</span>&nbsp;<span class="op" id="6275415">==</span>&nbsp;<span class="string" id="6275418">&#39;.&#39;</span>&nbsp;<span class="op" id="6275422">&amp;&amp;</span>&nbsp;<span class="ident" id="6275425">s</span><span class="op" id="6275426">[</span><span class="builtinfunc" id="6275427">len</span><span class="op" id="6275430">(</span><span class="ident" id="6275431">s</span><span class="op" id="6275432">)</span><span class="op" id="6275433">-</span><span class="builtinfunc" id="6275434">len</span><span class="op" id="6275437">(</span><span class="ident" id="6275438">suffix</span><span class="op" id="6275444">)</span><span class="op" id="6275445">:</span><span class="op" id="6275446">]</span>&nbsp;<span class="op" id="6275448">==</span>&nbsp;<span class="ident" id="6275451">suffix</span><br>
<span class="lineno"></span><span class="op" id="6275458">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span><span class="comment" id="6275461">//&nbsp;byPathLength&nbsp;is&nbsp;a&nbsp;[]entry&nbsp;sort.Interface&nbsp;that&nbsp;sorts&nbsp;according&nbsp;to&nbsp;RFC&nbsp;6265</span><br>
<span class="lineno"></span><span class="comment" id="6275538">//&nbsp;section&nbsp;5.4&nbsp;point&nbsp;2:&nbsp;by&nbsp;longest&nbsp;path&nbsp;and&nbsp;then&nbsp;by&nbsp;earliest&nbsp;creation&nbsp;time.</span><br>
<span class="lineno"></span><span class="keyword" id="6275614">type</span>&nbsp;<span class="ident" id="6275619">byPathLength</span>&nbsp;<span class="op" id="6275632">[</span><span class="op" id="6275633">]</span><span class="ident" id="6275634">entry</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6275641">func</span>&nbsp;<span class="op" id="6275646">(</span><span class="ident" id="6275647">s</span>&nbsp;<span class="ident" id="6275649">byPathLength</span><span class="op" id="6275661">)</span>&nbsp;<span class="ident" id="6275663">Len</span><span class="op" id="6275666">(</span><span class="op" id="6275667">)</span>&nbsp;<span class="builtintype" id="6275669">int</span>&nbsp;<span class="op" id="6275673">{</span>&nbsp;<span class="keyword" id="6275675">return</span>&nbsp;<span class="builtinfunc" id="6275682">len</span><span class="op" id="6275685">(</span><span class="ident" id="6275686">s</span><span class="op" id="6275687">)</span>&nbsp;<span class="op" id="6275689">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="keyword" id="6275692">func</span>&nbsp;<span class="op" id="6275697">(</span><span class="ident" id="6275698">s</span>&nbsp;<span class="ident" id="6275700">byPathLength</span><span class="op" id="6275712">)</span>&nbsp;<span class="ident" id="6275714">Less</span><span class="op" id="6275718">(</span><span class="ident" id="6275719">i</span><span class="op" id="6275720">,</span>&nbsp;<span class="ident" id="6275722">j</span>&nbsp;<span class="builtintype" id="6275724">int</span><span class="op" id="6275727">)</span>&nbsp;<span class="builtintype" id="6275729">bool</span>&nbsp;<span class="op" id="6275734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6275737">if</span>&nbsp;<span class="builtinfunc" id="6275740">len</span><span class="op" id="6275743">(</span><span class="ident" id="6275744">s</span><span class="op" id="6275745">[</span><span class="ident" id="6275746">i</span><span class="op" id="6275747">]</span><span class="op" id="6275748">.</span><span class="ident" id="6275749">Path</span><span class="op" id="6275753">)</span>&nbsp;<span class="op" id="6275755">!=</span>&nbsp;<span class="builtinfunc" id="6275758">len</span><span class="op" id="6275761">(</span><span class="ident" id="6275762">s</span><span class="op" id="6275763">[</span><span class="ident" id="6275764">j</span><span class="op" id="6275765">]</span><span class="op" id="6275766">.</span><span class="ident" id="6275767">Path</span><span class="op" id="6275771">)</span>&nbsp;<span class="op" id="6275773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6275777">return</span>&nbsp;<span class="builtinfunc" id="6275784">len</span><span class="op" id="6275787">(</span><span class="ident" id="6275788">s</span><span class="op" id="6275789">[</span><span class="ident" id="6275790">i</span><span class="op" id="6275791">]</span><span class="op" id="6275792">.</span><span class="ident" id="6275793">Path</span><span class="op" id="6275797">)</span>&nbsp;<span class="op" id="6275799">&gt;</span>&nbsp;<span class="builtinfunc" id="6275801">len</span><span class="op" id="6275804">(</span><span class="ident" id="6275805">s</span><span class="op" id="6275806">[</span><span class="ident" id="6275807">j</span><span class="op" id="6275808">]</span><span class="op" id="6275809">.</span><span class="ident" id="6275810">Path</span><span class="op" id="6275814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6275817">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6275820">if</span>&nbsp;<span class="op" id="6275823">!</span><span class="ident" id="6275824">s</span><span class="op" id="6275825">[</span><span class="ident" id="6275826">i</span><span class="op" id="6275827">]</span><span class="op" id="6275828">.</span><span class="ident" id="6275829">Creation</span><span class="op" id="6275837">.</span><span class="ident" id="6275838">Equal</span><span class="op" id="6275843">(</span><span class="ident" id="6275844">s</span><span class="op" id="6275845">[</span><span class="ident" id="6275846">j</span><span class="op" id="6275847">]</span><span class="op" id="6275848">.</span><span class="ident" id="6275849">Creation</span><span class="op" id="6275857">)</span>&nbsp;<span class="op" id="6275859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6275863">return</span>&nbsp;<span class="ident" id="6275870">s</span><span class="op" id="6275871">[</span><span class="ident" id="6275872">i</span><span class="op" id="6275873">]</span><span class="op" id="6275874">.</span><span class="ident" id="6275875">Creation</span><span class="op" id="6275883">.</span><span class="ident" id="6275884">Before</span><span class="op" id="6275890">(</span><span class="ident" id="6275891">s</span><span class="op" id="6275892">[</span><span class="ident" id="6275893">j</span><span class="op" id="6275894">]</span><span class="op" id="6275895">.</span><span class="ident" id="6275896">Creation</span><span class="op" id="6275904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6275907">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6275910">return</span>&nbsp;<span class="ident" id="6275917">s</span><span class="op" id="6275918">[</span><span class="ident" id="6275919">i</span><span class="op" id="6275920">]</span><span class="op" id="6275921">.</span><span class="ident" id="6275922">seqNum</span>&nbsp;<span class="op" id="6275929">&lt;</span>&nbsp;<span class="ident" id="6275931">s</span><span class="op" id="6275932">[</span><span class="ident" id="6275933">j</span><span class="op" id="6275934">]</span><span class="op" id="6275935">.</span><span class="ident" id="6275936">seqNum</span><br>
<span class="lineno"></span><span class="op" id="6275943">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="keyword" id="6275946">func</span>&nbsp;<span class="op" id="6275951">(</span><span class="ident" id="6275952">s</span>&nbsp;<span class="ident" id="6275954">byPathLength</span><span class="op" id="6275966">)</span>&nbsp;<span class="ident" id="6275968">Swap</span><span class="op" id="6275972">(</span><span class="ident" id="6275973">i</span><span class="op" id="6275974">,</span>&nbsp;<span class="ident" id="6275976">j</span>&nbsp;<span class="builtintype" id="6275978">int</span><span class="op" id="6275981">)</span>&nbsp;<span class="op" id="6275983">{</span>&nbsp;<span class="ident" id="6275985">s</span><span class="op" id="6275986">[</span><span class="ident" id="6275987">i</span><span class="op" id="6275988">]</span><span class="op" id="6275989">,</span>&nbsp;<span class="ident" id="6275991">s</span><span class="op" id="6275992">[</span><span class="ident" id="6275993">j</span><span class="op" id="6275994">]</span>&nbsp;<span class="op" id="6275996">=</span>&nbsp;<span class="ident" id="6275998">s</span><span class="op" id="6275999">[</span><span class="ident" id="6276000">j</span><span class="op" id="6276001">]</span><span class="op" id="6276002">,</span>&nbsp;<span class="ident" id="6276004">s</span><span class="op" id="6276005">[</span><span class="ident" id="6276006">i</span><span class="op" id="6276007">]</span>&nbsp;<span class="op" id="6276009">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6276012">//&nbsp;Cookies&nbsp;implements&nbsp;the&nbsp;Cookies&nbsp;method&nbsp;of&nbsp;the&nbsp;http.CookieJar&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment" id="6276086">//</span><br>
<span class="lineno">170</span><span class="comment" id="6276089">//&nbsp;It&nbsp;returns&nbsp;an&nbsp;empty&nbsp;slice&nbsp;if&nbsp;the&nbsp;URL&#39;s&nbsp;scheme&nbsp;is&nbsp;not&nbsp;HTTP&nbsp;or&nbsp;HTTPS.</span><br>
<span class="lineno"></span><span class="keyword" id="6276160">func</span>&nbsp;<span class="op" id="6276165">(</span><span class="ident" id="6276166">j</span>&nbsp;<span class="op" id="6276168">*</span><span class="ident" id="6276169">Jar</span><span class="op" id="6276172">)</span>&nbsp;<span class="ident" id="6276174">Cookies</span><span class="op" id="6276181">(</span><span class="ident" id="6276182">u</span>&nbsp;<span class="op" id="6276184">*</span><span class="ident" id="6276185">url</span><span class="op" id="6276188">.</span><span class="ident" id="6276189">URL</span><span class="op" id="6276192">)</span>&nbsp;<span class="op" id="6276194">(</span><span class="ident" id="6276195">cookies</span>&nbsp;<span class="op" id="6276203">[</span><span class="op" id="6276204">]</span><span class="op" id="6276205">*</span><span class="ident" id="6276206">http</span><span class="op" id="6276210">.</span><span class="ident" id="6276211">Cookie</span><span class="op" id="6276217">)</span>&nbsp;<span class="op" id="6276219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6276222">return</span>&nbsp;<span class="ident" id="6276229">j</span><span class="op" id="6276230">.</span><span class="ident" id="6276231">cookies</span><span class="op" id="6276238">(</span><span class="ident" id="6276239">u</span><span class="op" id="6276240">,</span>&nbsp;<span class="ident" id="6276242">time</span><span class="op" id="6276246">.</span><span class="ident" id="6276247">Now</span><span class="op" id="6276250">(</span><span class="op" id="6276251">)</span><span class="op" id="6276252">)</span><br>
<span class="lineno"></span><span class="op" id="6276254">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="comment" id="6276257">//&nbsp;cookies&nbsp;is&nbsp;like&nbsp;Cookies&nbsp;but&nbsp;takes&nbsp;the&nbsp;current&nbsp;time&nbsp;as&nbsp;a&nbsp;parameter.</span><br>
<span class="lineno"></span><span class="keyword" id="6276327">func</span>&nbsp;<span class="op" id="6276332">(</span><span class="ident" id="6276333">j</span>&nbsp;<span class="op" id="6276335">*</span><span class="ident" id="6276336">Jar</span><span class="op" id="6276339">)</span>&nbsp;<span class="ident" id="6276341">cookies</span><span class="op" id="6276348">(</span><span class="ident" id="6276349">u</span>&nbsp;<span class="op" id="6276351">*</span><span class="ident" id="6276352">url</span><span class="op" id="6276355">.</span><span class="ident" id="6276356">URL</span><span class="op" id="6276359">,</span>&nbsp;<span class="ident" id="6276361">now</span>&nbsp;<span class="ident" id="6276365">time</span><span class="op" id="6276369">.</span><span class="ident" id="6276370">Time</span><span class="op" id="6276374">)</span>&nbsp;<span class="op" id="6276376">(</span><span class="ident" id="6276377">cookies</span>&nbsp;<span class="op" id="6276385">[</span><span class="op" id="6276386">]</span><span class="op" id="6276387">*</span><span class="ident" id="6276388">http</span><span class="op" id="6276392">.</span><span class="ident" id="6276393">Cookie</span><span class="op" id="6276399">)</span>&nbsp;<span class="op" id="6276401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6276404">if</span>&nbsp;<span class="ident" id="6276407">u</span><span class="op" id="6276408">.</span><span class="ident" id="6276409">Scheme</span>&nbsp;<span class="op" id="6276416">!=</span>&nbsp;<span class="string" id="6276419">&#34;http&#34;</span>&nbsp;<span class="op" id="6276426">&amp;&amp;</span>&nbsp;<span class="ident" id="6276429">u</span><span class="op" id="6276430">.</span><span class="ident" id="6276431">Scheme</span>&nbsp;<span class="op" id="6276438">!=</span>&nbsp;<span class="string" id="6276441">&#34;https&#34;</span>&nbsp;<span class="op" id="6276449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6276453">return</span>&nbsp;<span class="ident" id="6276460">cookies</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6276469">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6276472">host</span><span class="op" id="6276476">,</span>&nbsp;<span class="ident" id="6276478">err</span>&nbsp;<span class="op" id="6276482">:=</span>&nbsp;<span class="ident" id="6276485">canonicalHost</span><span class="op" id="6276498">(</span><span class="ident" id="6276499">u</span><span class="op" id="6276500">.</span><span class="ident" id="6276501">Host</span><span class="op" id="6276505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6276508">if</span>&nbsp;<span class="ident" id="6276511">err</span>&nbsp;<span class="op" id="6276515">!=</span>&nbsp;<span class="builtintype" id="6276518">nil</span>&nbsp;<span class="op" id="6276522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6276526">return</span>&nbsp;<span class="ident" id="6276533">cookies</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6276542">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6276545">key</span>&nbsp;<span class="op" id="6276549">:=</span>&nbsp;<span class="ident" id="6276552">jarKey</span><span class="op" id="6276558">(</span><span class="ident" id="6276559">host</span><span class="op" id="6276563">,</span>&nbsp;<span class="ident" id="6276565">j</span><span class="op" id="6276566">.</span><span class="ident" id="6276567">psList</span><span class="op" id="6276573">)</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6276577">j</span><span class="op" id="6276578">.</span><span class="ident" id="6276579">mu</span><span class="op" id="6276581">.</span><span class="ident" id="6276582">Lock</span><span class="op" id="6276586">(</span><span class="op" id="6276587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6276590">defer</span>&nbsp;<span class="ident" id="6276596">j</span><span class="op" id="6276597">.</span><span class="ident" id="6276598">mu</span><span class="op" id="6276600">.</span><span class="ident" id="6276601">Unlock</span><span class="op" id="6276607">(</span><span class="op" id="6276608">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6276612">submap</span>&nbsp;<span class="op" id="6276619">:=</span>&nbsp;<span class="ident" id="6276622">j</span><span class="op" id="6276623">.</span><span class="ident" id="6276624">entries</span><span class="op" id="6276631">[</span><span class="ident" id="6276632">key</span><span class="op" id="6276635">]</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6276638">if</span>&nbsp;<span class="ident" id="6276641">submap</span>&nbsp;<span class="op" id="6276648">==</span>&nbsp;<span class="builtintype" id="6276651">nil</span>&nbsp;<span class="op" id="6276655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6276659">return</span>&nbsp;<span class="ident" id="6276666">cookies</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6276675">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6276679">https</span>&nbsp;<span class="op" id="6276685">:=</span>&nbsp;<span class="ident" id="6276688">u</span><span class="op" id="6276689">.</span><span class="ident" id="6276690">Scheme</span>&nbsp;<span class="op" id="6276697">==</span>&nbsp;<span class="string" id="6276700">&#34;https&#34;</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6276709">path</span>&nbsp;<span class="op" id="6276714">:=</span>&nbsp;<span class="ident" id="6276717">u</span><span class="op" id="6276718">.</span><span class="ident" id="6276719">Path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6276725">if</span>&nbsp;<span class="ident" id="6276728">path</span>&nbsp;<span class="op" id="6276733">==</span>&nbsp;<span class="string" id="6276736">&#34;&#34;</span>&nbsp;<span class="op" id="6276739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6276743">path</span>&nbsp;<span class="op" id="6276748">=</span>&nbsp;<span class="string" id="6276750">&#34;/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6276755">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6276759">modified</span>&nbsp;<span class="op" id="6276768">:=</span>&nbsp;<span class="builtintype" id="6276771">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6276778">var</span>&nbsp;<span class="ident" id="6276782">selected</span>&nbsp;<span class="op" id="6276791">[</span><span class="op" id="6276792">]</span><span class="ident" id="6276793">entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6276800">for</span>&nbsp;<span class="ident" id="6276804">id</span><span class="op" id="6276806">,</span>&nbsp;<span class="ident" id="6276808">e</span>&nbsp;<span class="op" id="6276810">:=</span>&nbsp;<span class="keyword" id="6276813">range</span>&nbsp;<span class="ident" id="6276819">submap</span>&nbsp;<span class="op" id="6276826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6276830">if</span>&nbsp;<span class="ident" id="6276833">e</span><span class="op" id="6276834">.</span><span class="ident" id="6276835">Persistent</span>&nbsp;<span class="op" id="6276846">&amp;&amp;</span>&nbsp;<span class="op" id="6276849">!</span><span class="ident" id="6276850">e</span><span class="op" id="6276851">.</span><span class="ident" id="6276852">Expires</span><span class="op" id="6276859">.</span><span class="ident" id="6276860">After</span><span class="op" id="6276865">(</span><span class="ident" id="6276866">now</span><span class="op" id="6276869">)</span>&nbsp;<span class="op" id="6276871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6276876">delete</span><span class="op" id="6276882">(</span><span class="ident" id="6276883">submap</span><span class="op" id="6276889">,</span>&nbsp;<span class="ident" id="6276891">id</span><span class="op" id="6276893">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6276898">modified</span>&nbsp;<span class="op" id="6276907">=</span>&nbsp;<span class="builtintype" id="6276909">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6276917">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6276928">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6276932">if</span>&nbsp;<span class="op" id="6276935">!</span><span class="ident" id="6276936">e</span><span class="op" id="6276937">.</span><span class="ident" id="6276938">shouldSend</span><span class="op" id="6276948">(</span><span class="ident" id="6276949">https</span><span class="op" id="6276954">,</span>&nbsp;<span class="ident" id="6276956">host</span><span class="op" id="6276960">,</span>&nbsp;<span class="ident" id="6276962">path</span><span class="op" id="6276966">)</span>&nbsp;<span class="op" id="6276968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6276973">continue</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6276984">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6276988">e</span><span class="op" id="6276989">.</span><span class="ident" id="6276990">LastAccess</span>&nbsp;<span class="op" id="6277001">=</span>&nbsp;<span class="ident" id="6277003">now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6277009">submap</span><span class="op" id="6277015">[</span><span class="ident" id="6277016">id</span><span class="op" id="6277018">]</span>&nbsp;<span class="op" id="6277020">=</span>&nbsp;<span class="ident" id="6277022">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6277026">selected</span>&nbsp;<span class="op" id="6277035">=</span>&nbsp;<span class="builtinfunc" id="6277037">append</span><span class="op" id="6277043">(</span><span class="ident" id="6277044">selected</span><span class="op" id="6277052">,</span>&nbsp;<span class="ident" id="6277054">e</span><span class="op" id="6277055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6277059">modified</span>&nbsp;<span class="op" id="6277068">=</span>&nbsp;<span class="builtintype" id="6277070">true</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6277076">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6277079">if</span>&nbsp;<span class="ident" id="6277082">modified</span>&nbsp;<span class="op" id="6277091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6277095">if</span>&nbsp;<span class="builtinfunc" id="6277098">len</span><span class="op" id="6277101">(</span><span class="ident" id="6277102">submap</span><span class="op" id="6277108">)</span>&nbsp;<span class="op" id="6277110">==</span>&nbsp;<span class="num" id="6277113">0</span>&nbsp;<span class="op" id="6277115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6277120">delete</span><span class="op" id="6277126">(</span><span class="ident" id="6277127">j</span><span class="op" id="6277128">.</span><span class="ident" id="6277129">entries</span><span class="op" id="6277136">,</span>&nbsp;<span class="ident" id="6277138">key</span><span class="op" id="6277141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6277145">}</span>&nbsp;<span class="keyword" id="6277147">else</span>&nbsp;<span class="op" id="6277152">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6277157">j</span><span class="op" id="6277158">.</span><span class="ident" id="6277159">entries</span><span class="op" id="6277166">[</span><span class="ident" id="6277167">key</span><span class="op" id="6277170">]</span>&nbsp;<span class="op" id="6277172">=</span>&nbsp;<span class="ident" id="6277174">submap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6277183">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6277186">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6277190">sort</span><span class="op" id="6277194">.</span><span class="ident" id="6277195">Sort</span><span class="op" id="6277199">(</span><span class="ident" id="6277200">byPathLength</span><span class="op" id="6277212">(</span><span class="ident" id="6277213">selected</span><span class="op" id="6277221">)</span><span class="op" id="6277222">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6277225">for</span>&nbsp;<span class="ident" id="6277229">_</span><span class="op" id="6277230">,</span>&nbsp;<span class="ident" id="6277232">e</span>&nbsp;<span class="op" id="6277234">:=</span>&nbsp;<span class="keyword" id="6277237">range</span>&nbsp;<span class="ident" id="6277243">selected</span>&nbsp;<span class="op" id="6277252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6277256">cookies</span>&nbsp;<span class="op" id="6277264">=</span>&nbsp;<span class="builtinfunc" id="6277266">append</span><span class="op" id="6277272">(</span><span class="ident" id="6277273">cookies</span><span class="op" id="6277280">,</span>&nbsp;<span class="op" id="6277282">&amp;</span><span class="ident" id="6277283">http</span><span class="op" id="6277287">.</span><span class="ident" id="6277288">Cookie</span><span class="op" id="6277294">{</span><span class="ident" id="6277295">Name</span><span class="op" id="6277299">:</span>&nbsp;<span class="ident" id="6277301">e</span><span class="op" id="6277302">.</span><span class="ident" id="6277303">Name</span><span class="op" id="6277307">,</span>&nbsp;<span class="ident" id="6277309">Value</span><span class="op" id="6277314">:</span>&nbsp;<span class="ident" id="6277316">e</span><span class="op" id="6277317">.</span><span class="ident" id="6277318">Value</span><span class="op" id="6277323">}</span><span class="op" id="6277324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6277327">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6277331">return</span>&nbsp;<span class="ident" id="6277338">cookies</span><br>
<span class="lineno">230</span><span class="op" id="6277346">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6277349">//&nbsp;SetCookies&nbsp;implements&nbsp;the&nbsp;SetCookies&nbsp;method&nbsp;of&nbsp;the&nbsp;http.CookieJar&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment" id="6277429">//</span><br>
<span class="lineno"></span><span class="comment" id="6277432">//&nbsp;It&nbsp;does&nbsp;nothing&nbsp;if&nbsp;the&nbsp;URL&#39;s&nbsp;scheme&nbsp;is&nbsp;not&nbsp;HTTP&nbsp;or&nbsp;HTTPS.</span><br>
<span class="lineno">235</span><span class="keyword" id="6277493">func</span>&nbsp;<span class="op" id="6277498">(</span><span class="ident" id="6277499">j</span>&nbsp;<span class="op" id="6277501">*</span><span class="ident" id="6277502">Jar</span><span class="op" id="6277505">)</span>&nbsp;<span class="ident" id="6277507">SetCookies</span><span class="op" id="6277517">(</span><span class="ident" id="6277518">u</span>&nbsp;<span class="op" id="6277520">*</span><span class="ident" id="6277521">url</span><span class="op" id="6277524">.</span><span class="ident" id="6277525">URL</span><span class="op" id="6277528">,</span>&nbsp;<span class="ident" id="6277530">cookies</span>&nbsp;<span class="op" id="6277538">[</span><span class="op" id="6277539">]</span><span class="op" id="6277540">*</span><span class="ident" id="6277541">http</span><span class="op" id="6277545">.</span><span class="ident" id="6277546">Cookie</span><span class="op" id="6277552">)</span>&nbsp;<span class="op" id="6277554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6277557">j</span><span class="op" id="6277558">.</span><span class="ident" id="6277559">setCookies</span><span class="op" id="6277569">(</span><span class="ident" id="6277570">u</span><span class="op" id="6277571">,</span>&nbsp;<span class="ident" id="6277573">cookies</span><span class="op" id="6277580">,</span>&nbsp;<span class="ident" id="6277582">time</span><span class="op" id="6277586">.</span><span class="ident" id="6277587">Now</span><span class="op" id="6277590">(</span><span class="op" id="6277591">)</span><span class="op" id="6277592">)</span><br>
<span class="lineno"></span><span class="op" id="6277594">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6277597">//&nbsp;setCookies&nbsp;is&nbsp;like&nbsp;SetCookies&nbsp;but&nbsp;takes&nbsp;the&nbsp;current&nbsp;time&nbsp;as&nbsp;parameter.</span><br>
<span class="lineno">240</span><span class="keyword" id="6277671">func</span>&nbsp;<span class="op" id="6277676">(</span><span class="ident" id="6277677">j</span>&nbsp;<span class="op" id="6277679">*</span><span class="ident" id="6277680">Jar</span><span class="op" id="6277683">)</span>&nbsp;<span class="ident" id="6277685">setCookies</span><span class="op" id="6277695">(</span><span class="ident" id="6277696">u</span>&nbsp;<span class="op" id="6277698">*</span><span class="ident" id="6277699">url</span><span class="op" id="6277702">.</span><span class="ident" id="6277703">URL</span><span class="op" id="6277706">,</span>&nbsp;<span class="ident" id="6277708">cookies</span>&nbsp;<span class="op" id="6277716">[</span><span class="op" id="6277717">]</span><span class="op" id="6277718">*</span><span class="ident" id="6277719">http</span><span class="op" id="6277723">.</span><span class="ident" id="6277724">Cookie</span><span class="op" id="6277730">,</span>&nbsp;<span class="ident" id="6277732">now</span>&nbsp;<span class="ident" id="6277736">time</span><span class="op" id="6277740">.</span><span class="ident" id="6277741">Time</span><span class="op" id="6277745">)</span>&nbsp;<span class="op" id="6277747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6277750">if</span>&nbsp;<span class="builtinfunc" id="6277753">len</span><span class="op" id="6277756">(</span><span class="ident" id="6277757">cookies</span><span class="op" id="6277764">)</span>&nbsp;<span class="op" id="6277766">==</span>&nbsp;<span class="num" id="6277769">0</span>&nbsp;<span class="op" id="6277771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6277775">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6277783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6277786">if</span>&nbsp;<span class="ident" id="6277789">u</span><span class="op" id="6277790">.</span><span class="ident" id="6277791">Scheme</span>&nbsp;<span class="op" id="6277798">!=</span>&nbsp;<span class="string" id="6277801">&#34;http&#34;</span>&nbsp;<span class="op" id="6277808">&amp;&amp;</span>&nbsp;<span class="ident" id="6277811">u</span><span class="op" id="6277812">.</span><span class="ident" id="6277813">Scheme</span>&nbsp;<span class="op" id="6277820">!=</span>&nbsp;<span class="string" id="6277823">&#34;https&#34;</span>&nbsp;<span class="op" id="6277831">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6277835">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6277843">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6277846">host</span><span class="op" id="6277850">,</span>&nbsp;<span class="ident" id="6277852">err</span>&nbsp;<span class="op" id="6277856">:=</span>&nbsp;<span class="ident" id="6277859">canonicalHost</span><span class="op" id="6277872">(</span><span class="ident" id="6277873">u</span><span class="op" id="6277874">.</span><span class="ident" id="6277875">Host</span><span class="op" id="6277879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6277882">if</span>&nbsp;<span class="ident" id="6277885">err</span>&nbsp;<span class="op" id="6277889">!=</span>&nbsp;<span class="builtintype" id="6277892">nil</span>&nbsp;<span class="op" id="6277896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6277900">return</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6277908">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6277911">key</span>&nbsp;<span class="op" id="6277915">:=</span>&nbsp;<span class="ident" id="6277918">jarKey</span><span class="op" id="6277924">(</span><span class="ident" id="6277925">host</span><span class="op" id="6277929">,</span>&nbsp;<span class="ident" id="6277931">j</span><span class="op" id="6277932">.</span><span class="ident" id="6277933">psList</span><span class="op" id="6277939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6277942">defPath</span>&nbsp;<span class="op" id="6277950">:=</span>&nbsp;<span class="ident" id="6277953">defaultPath</span><span class="op" id="6277964">(</span><span class="ident" id="6277965">u</span><span class="op" id="6277966">.</span><span class="ident" id="6277967">Path</span><span class="op" id="6277971">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6277975">j</span><span class="op" id="6277976">.</span><span class="ident" id="6277977">mu</span><span class="op" id="6277979">.</span><span class="ident" id="6277980">Lock</span><span class="op" id="6277984">(</span><span class="op" id="6277985">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6277988">defer</span>&nbsp;<span class="ident" id="6277994">j</span><span class="op" id="6277995">.</span><span class="ident" id="6277996">mu</span><span class="op" id="6277998">.</span><span class="ident" id="6277999">Unlock</span><span class="op" id="6278005">(</span><span class="op" id="6278006">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6278010">submap</span>&nbsp;<span class="op" id="6278017">:=</span>&nbsp;<span class="ident" id="6278020">j</span><span class="op" id="6278021">.</span><span class="ident" id="6278022">entries</span><span class="op" id="6278029">[</span><span class="ident" id="6278030">key</span><span class="op" id="6278033">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6278037">modified</span>&nbsp;<span class="op" id="6278046">:=</span>&nbsp;<span class="builtintype" id="6278049">false</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6278056">for</span>&nbsp;<span class="ident" id="6278060">_</span><span class="op" id="6278061">,</span>&nbsp;<span class="ident" id="6278063">cookie</span>&nbsp;<span class="op" id="6278070">:=</span>&nbsp;<span class="keyword" id="6278073">range</span>&nbsp;<span class="ident" id="6278079">cookies</span>&nbsp;<span class="op" id="6278087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6278091">e</span><span class="op" id="6278092">,</span>&nbsp;<span class="ident" id="6278094">remove</span><span class="op" id="6278100">,</span>&nbsp;<span class="ident" id="6278102">err</span>&nbsp;<span class="op" id="6278106">:=</span>&nbsp;<span class="ident" id="6278109">j</span><span class="op" id="6278110">.</span><span class="ident" id="6278111">newEntry</span><span class="op" id="6278119">(</span><span class="ident" id="6278120">cookie</span><span class="op" id="6278126">,</span>&nbsp;<span class="ident" id="6278128">now</span><span class="op" id="6278131">,</span>&nbsp;<span class="ident" id="6278133">defPath</span><span class="op" id="6278140">,</span>&nbsp;<span class="ident" id="6278142">host</span><span class="op" id="6278146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6278150">if</span>&nbsp;<span class="ident" id="6278153">err</span>&nbsp;<span class="op" id="6278157">!=</span>&nbsp;<span class="builtintype" id="6278160">nil</span>&nbsp;<span class="op" id="6278164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6278169">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6278180">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6278184">id</span>&nbsp;<span class="op" id="6278187">:=</span>&nbsp;<span class="ident" id="6278190">e</span><span class="op" id="6278191">.</span><span class="ident" id="6278192">id</span><span class="op" id="6278194">(</span><span class="op" id="6278195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6278199">if</span>&nbsp;<span class="ident" id="6278202">remove</span>&nbsp;<span class="op" id="6278209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6278214">if</span>&nbsp;<span class="ident" id="6278217">submap</span>&nbsp;<span class="op" id="6278224">!=</span>&nbsp;<span class="builtintype" id="6278227">nil</span>&nbsp;<span class="op" id="6278231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6278237">if</span>&nbsp;<span class="ident" id="6278240">_</span><span class="op" id="6278241">,</span>&nbsp;<span class="ident" id="6278243">ok</span>&nbsp;<span class="op" id="6278246">:=</span>&nbsp;<span class="ident" id="6278249">submap</span><span class="op" id="6278255">[</span><span class="ident" id="6278256">id</span><span class="op" id="6278258">]</span><span class="op" id="6278259">;</span>&nbsp;<span class="ident" id="6278261">ok</span>&nbsp;<span class="op" id="6278264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6278271">delete</span><span class="op" id="6278277">(</span><span class="ident" id="6278278">submap</span><span class="op" id="6278284">,</span>&nbsp;<span class="ident" id="6278286">id</span><span class="op" id="6278288">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6278295">modified</span>&nbsp;<span class="op" id="6278304">=</span>&nbsp;<span class="builtintype" id="6278306">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6278315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6278320">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6278325">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6278336">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6278340">if</span>&nbsp;<span class="ident" id="6278343">submap</span>&nbsp;<span class="op" id="6278350">==</span>&nbsp;<span class="builtintype" id="6278353">nil</span>&nbsp;<span class="op" id="6278357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6278362">submap</span>&nbsp;<span class="op" id="6278369">=</span>&nbsp;<span class="builtinfunc" id="6278371">make</span><span class="op" id="6278375">(</span><span class="keyword" id="6278376">map</span><span class="op" id="6278379">[</span><span class="builtintype" id="6278380">string</span><span class="op" id="6278386">]</span><span class="ident" id="6278387">entry</span><span class="op" id="6278392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6278396">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6278401">if</span>&nbsp;<span class="ident" id="6278404">old</span><span class="op" id="6278407">,</span>&nbsp;<span class="ident" id="6278409">ok</span>&nbsp;<span class="op" id="6278412">:=</span>&nbsp;<span class="ident" id="6278415">submap</span><span class="op" id="6278421">[</span><span class="ident" id="6278422">id</span><span class="op" id="6278424">]</span><span class="op" id="6278425">;</span>&nbsp;<span class="ident" id="6278427">ok</span>&nbsp;<span class="op" id="6278430">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6278435">e</span><span class="op" id="6278436">.</span><span class="ident" id="6278437">Creation</span>&nbsp;<span class="op" id="6278446">=</span>&nbsp;<span class="ident" id="6278448">old</span><span class="op" id="6278451">.</span><span class="ident" id="6278452">Creation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6278464">e</span><span class="op" id="6278465">.</span><span class="ident" id="6278466">seqNum</span>&nbsp;<span class="op" id="6278473">=</span>&nbsp;<span class="ident" id="6278475">old</span><span class="op" id="6278478">.</span><span class="ident" id="6278479">seqNum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6278488">}</span>&nbsp;<span class="keyword" id="6278490">else</span>&nbsp;<span class="op" id="6278495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6278500">e</span><span class="op" id="6278501">.</span><span class="ident" id="6278502">Creation</span>&nbsp;<span class="op" id="6278511">=</span>&nbsp;<span class="ident" id="6278513">now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6278520">e</span><span class="op" id="6278521">.</span><span class="ident" id="6278522">seqNum</span>&nbsp;<span class="op" id="6278529">=</span>&nbsp;<span class="ident" id="6278531">j</span><span class="op" id="6278532">.</span><span class="ident" id="6278533">nextSeqNum</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6278547">j</span><span class="op" id="6278548">.</span><span class="ident" id="6278549">nextSeqNum</span><span class="op" id="6278559">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6278564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6278568">e</span><span class="op" id="6278569">.</span><span class="ident" id="6278570">LastAccess</span>&nbsp;<span class="op" id="6278581">=</span>&nbsp;<span class="ident" id="6278583">now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6278589">submap</span><span class="op" id="6278595">[</span><span class="ident" id="6278596">id</span><span class="op" id="6278598">]</span>&nbsp;<span class="op" id="6278600">=</span>&nbsp;<span class="ident" id="6278602">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6278606">modified</span>&nbsp;<span class="op" id="6278615">=</span>&nbsp;<span class="builtintype" id="6278617">true</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6278623">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6278627">if</span>&nbsp;<span class="ident" id="6278630">modified</span>&nbsp;<span class="op" id="6278639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6278643">if</span>&nbsp;<span class="builtinfunc" id="6278646">len</span><span class="op" id="6278649">(</span><span class="ident" id="6278650">submap</span><span class="op" id="6278656">)</span>&nbsp;<span class="op" id="6278658">==</span>&nbsp;<span class="num" id="6278661">0</span>&nbsp;<span class="op" id="6278663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6278668">delete</span><span class="op" id="6278674">(</span><span class="ident" id="6278675">j</span><span class="op" id="6278676">.</span><span class="ident" id="6278677">entries</span><span class="op" id="6278684">,</span>&nbsp;<span class="ident" id="6278686">key</span><span class="op" id="6278689">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6278693">}</span>&nbsp;<span class="keyword" id="6278695">else</span>&nbsp;<span class="op" id="6278700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6278705">j</span><span class="op" id="6278706">.</span><span class="ident" id="6278707">entries</span><span class="op" id="6278714">[</span><span class="ident" id="6278715">key</span><span class="op" id="6278718">]</span>&nbsp;<span class="op" id="6278720">=</span>&nbsp;<span class="ident" id="6278722">submap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6278731">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6278734">}</span><br>
<span class="lineno"></span><span class="op" id="6278736">}</span><br>
<span class="lineno">300</span><br>
<span class="lineno"></span><span class="comment" id="6278739">//&nbsp;canonicalHost&nbsp;strips&nbsp;port&nbsp;from&nbsp;host&nbsp;if&nbsp;present&nbsp;and&nbsp;returns&nbsp;the&nbsp;canonicalized</span><br>
<span class="lineno"></span><span class="comment" id="6278819">//&nbsp;host&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="6278833">func</span>&nbsp;<span class="ident" id="6278838">canonicalHost</span><span class="op" id="6278851">(</span><span class="ident" id="6278852">host</span>&nbsp;<span class="builtintype" id="6278857">string</span><span class="op" id="6278863">)</span>&nbsp;<span class="op" id="6278865">(</span><span class="builtintype" id="6278866">string</span><span class="op" id="6278872">,</span>&nbsp;<span class="builtintype" id="6278874">error</span><span class="op" id="6278879">)</span>&nbsp;<span class="op" id="6278881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6278884">var</span>&nbsp;<span class="ident" id="6278888">err</span>&nbsp;<span class="builtintype" id="6278892">error</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6278899">host</span>&nbsp;<span class="op" id="6278904">=</span>&nbsp;<span class="ident" id="6278906">strings</span><span class="op" id="6278913">.</span><span class="ident" id="6278914">ToLower</span><span class="op" id="6278921">(</span><span class="ident" id="6278922">host</span><span class="op" id="6278926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6278929">if</span>&nbsp;<span class="ident" id="6278932">hasPort</span><span class="op" id="6278939">(</span><span class="ident" id="6278940">host</span><span class="op" id="6278944">)</span>&nbsp;<span class="op" id="6278946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6278950">host</span><span class="op" id="6278954">,</span>&nbsp;<span class="ident" id="6278956">_</span><span class="op" id="6278957">,</span>&nbsp;<span class="ident" id="6278959">err</span>&nbsp;<span class="op" id="6278963">=</span>&nbsp;<span class="ident" id="6278965">net</span><span class="op" id="6278968">.</span><span class="ident" id="6278969">SplitHostPort</span><span class="op" id="6278982">(</span><span class="ident" id="6278983">host</span><span class="op" id="6278987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6278991">if</span>&nbsp;<span class="ident" id="6278994">err</span>&nbsp;<span class="op" id="6278998">!=</span>&nbsp;<span class="builtintype" id="6279001">nil</span>&nbsp;<span class="op" id="6279005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6279010">return</span>&nbsp;<span class="string" id="6279017">&#34;&#34;</span><span class="op" id="6279019">,</span>&nbsp;<span class="ident" id="6279021">err</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6279027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6279030">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6279033">if</span>&nbsp;<span class="ident" id="6279036">strings</span><span class="op" id="6279043">.</span><span class="ident" id="6279044">HasSuffix</span><span class="op" id="6279053">(</span><span class="ident" id="6279054">host</span><span class="op" id="6279058">,</span>&nbsp;<span class="string" id="6279060">&#34;.&#34;</span><span class="op" id="6279063">)</span>&nbsp;<span class="op" id="6279065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6279069">//&nbsp;Strip&nbsp;trailing&nbsp;dot&nbsp;from&nbsp;fully&nbsp;qualified&nbsp;domain&nbsp;names.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6279128">host</span>&nbsp;<span class="op" id="6279133">=</span>&nbsp;<span class="ident" id="6279135">host</span><span class="op" id="6279139">[</span><span class="op" id="6279140">:</span><span class="builtinfunc" id="6279141">len</span><span class="op" id="6279144">(</span><span class="ident" id="6279145">host</span><span class="op" id="6279149">)</span><span class="op" id="6279150">-</span><span class="num" id="6279151">1</span><span class="op" id="6279152">]</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6279155">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6279158">return</span>&nbsp;<span class="ident" id="6279165">toASCII</span><span class="op" id="6279172">(</span><span class="ident" id="6279173">host</span><span class="op" id="6279177">)</span><br>
<span class="lineno"></span><span class="op" id="6279179">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6279182">//&nbsp;hasPort&nbsp;reports&nbsp;whether&nbsp;host&nbsp;contains&nbsp;a&nbsp;port&nbsp;number.&nbsp;host&nbsp;may&nbsp;be&nbsp;a&nbsp;host</span><br>
<span class="lineno">320</span><span class="comment" id="6279257">//&nbsp;name,&nbsp;an&nbsp;IPv4&nbsp;or&nbsp;an&nbsp;IPv6&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="6279294">func</span>&nbsp;<span class="ident" id="6279299">hasPort</span><span class="op" id="6279306">(</span><span class="ident" id="6279307">host</span>&nbsp;<span class="builtintype" id="6279312">string</span><span class="op" id="6279318">)</span>&nbsp;<span class="builtintype" id="6279320">bool</span>&nbsp;<span class="op" id="6279325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6279328">colons</span>&nbsp;<span class="op" id="6279335">:=</span>&nbsp;<span class="ident" id="6279338">strings</span><span class="op" id="6279345">.</span><span class="ident" id="6279346">Count</span><span class="op" id="6279351">(</span><span class="ident" id="6279352">host</span><span class="op" id="6279356">,</span>&nbsp;<span class="string" id="6279358">&#34;:&#34;</span><span class="op" id="6279361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6279364">if</span>&nbsp;<span class="ident" id="6279367">colons</span>&nbsp;<span class="op" id="6279374">==</span>&nbsp;<span class="num" id="6279377">0</span>&nbsp;<span class="op" id="6279379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6279383">return</span>&nbsp;<span class="builtintype" id="6279390">false</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6279397">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6279400">if</span>&nbsp;<span class="ident" id="6279403">colons</span>&nbsp;<span class="op" id="6279410">==</span>&nbsp;<span class="num" id="6279413">1</span>&nbsp;<span class="op" id="6279415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6279419">return</span>&nbsp;<span class="builtintype" id="6279426">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6279432">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6279435">return</span>&nbsp;<span class="ident" id="6279442">host</span><span class="op" id="6279446">[</span><span class="num" id="6279447">0</span><span class="op" id="6279448">]</span>&nbsp;<span class="op" id="6279450">==</span>&nbsp;<span class="string" id="6279453">&#39;[&#39;</span>&nbsp;<span class="op" id="6279457">&amp;&amp;</span>&nbsp;<span class="ident" id="6279460">strings</span><span class="op" id="6279467">.</span><span class="ident" id="6279468">Contains</span><span class="op" id="6279476">(</span><span class="ident" id="6279477">host</span><span class="op" id="6279481">,</span>&nbsp;<span class="string" id="6279483">&#34;]:&#34;</span><span class="op" id="6279487">)</span><br>
<span class="lineno">330</span><span class="op" id="6279489">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6279492">//&nbsp;jarKey&nbsp;returns&nbsp;the&nbsp;key&nbsp;to&nbsp;use&nbsp;for&nbsp;a&nbsp;jar.</span><br>
<span class="lineno"></span><span class="keyword" id="6279536">func</span>&nbsp;<span class="ident" id="6279541">jarKey</span><span class="op" id="6279547">(</span><span class="ident" id="6279548">host</span>&nbsp;<span class="builtintype" id="6279553">string</span><span class="op" id="6279559">,</span>&nbsp;<span class="ident" id="6279561">psl</span>&nbsp;<span class="ident" id="6279565">PublicSuffixList</span><span class="op" id="6279581">)</span>&nbsp;<span class="builtintype" id="6279583">string</span>&nbsp;<span class="op" id="6279590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6279593">if</span>&nbsp;<span class="ident" id="6279596">isIP</span><span class="op" id="6279600">(</span><span class="ident" id="6279601">host</span><span class="op" id="6279605">)</span>&nbsp;<span class="op" id="6279607">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6279611">return</span>&nbsp;<span class="ident" id="6279618">host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6279624">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6279628">var</span>&nbsp;<span class="ident" id="6279632">i</span>&nbsp;<span class="builtintype" id="6279634">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6279639">if</span>&nbsp;<span class="ident" id="6279642">psl</span>&nbsp;<span class="op" id="6279646">==</span>&nbsp;<span class="builtintype" id="6279649">nil</span>&nbsp;<span class="op" id="6279653">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6279657">i</span>&nbsp;<span class="op" id="6279659">=</span>&nbsp;<span class="ident" id="6279661">strings</span><span class="op" id="6279668">.</span><span class="ident" id="6279669">LastIndex</span><span class="op" id="6279678">(</span><span class="ident" id="6279679">host</span><span class="op" id="6279683">,</span>&nbsp;<span class="string" id="6279685">&#34;.&#34;</span><span class="op" id="6279688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6279692">if</span>&nbsp;<span class="ident" id="6279695">i</span>&nbsp;<span class="op" id="6279697">==</span>&nbsp;<span class="op" id="6279700">-</span><span class="num" id="6279701">1</span>&nbsp;<span class="op" id="6279703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6279708">return</span>&nbsp;<span class="ident" id="6279715">host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6279722">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6279725">}</span>&nbsp;<span class="keyword" id="6279727">else</span>&nbsp;<span class="op" id="6279732">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6279736">suffix</span>&nbsp;<span class="op" id="6279743">:=</span>&nbsp;<span class="ident" id="6279746">psl</span><span class="op" id="6279749">.</span><span class="ident" id="6279750">PublicSuffix</span><span class="op" id="6279762">(</span><span class="ident" id="6279763">host</span><span class="op" id="6279767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6279771">if</span>&nbsp;<span class="ident" id="6279774">suffix</span>&nbsp;<span class="op" id="6279781">==</span>&nbsp;<span class="ident" id="6279784">host</span>&nbsp;<span class="op" id="6279789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6279794">return</span>&nbsp;<span class="ident" id="6279801">host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6279808">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6279812">i</span>&nbsp;<span class="op" id="6279814">=</span>&nbsp;<span class="builtinfunc" id="6279816">len</span><span class="op" id="6279819">(</span><span class="ident" id="6279820">host</span><span class="op" id="6279824">)</span>&nbsp;<span class="op" id="6279826">-</span>&nbsp;<span class="builtinfunc" id="6279828">len</span><span class="op" id="6279831">(</span><span class="ident" id="6279832">suffix</span><span class="op" id="6279838">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6279842">if</span>&nbsp;<span class="ident" id="6279845">i</span>&nbsp;<span class="op" id="6279847">&lt;=</span>&nbsp;<span class="num" id="6279850">0</span>&nbsp;<span class="op" id="6279852">||</span>&nbsp;<span class="ident" id="6279855">host</span><span class="op" id="6279859">[</span><span class="ident" id="6279860">i</span><span class="op" id="6279861">-</span><span class="num" id="6279862">1</span><span class="op" id="6279863">]</span>&nbsp;<span class="op" id="6279865">!=</span>&nbsp;<span class="string" id="6279868">&#39;.&#39;</span>&nbsp;<span class="op" id="6279872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6279877">//&nbsp;The&nbsp;provided&nbsp;public&nbsp;suffix&nbsp;list&nbsp;psl&nbsp;is&nbsp;broken.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6279930">//&nbsp;Storing&nbsp;cookies&nbsp;under&nbsp;host&nbsp;is&nbsp;a&nbsp;safe&nbsp;stopgap.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6279982">return</span>&nbsp;<span class="ident" id="6279989">host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6279996">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6279999">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6280002">prevDot</span>&nbsp;<span class="op" id="6280010">:=</span>&nbsp;<span class="ident" id="6280013">strings</span><span class="op" id="6280020">.</span><span class="ident" id="6280021">LastIndex</span><span class="op" id="6280030">(</span><span class="ident" id="6280031">host</span><span class="op" id="6280035">[</span><span class="op" id="6280036">:</span><span class="ident" id="6280037">i</span><span class="op" id="6280038">-</span><span class="num" id="6280039">1</span><span class="op" id="6280040">]</span><span class="op" id="6280041">,</span>&nbsp;<span class="string" id="6280043">&#34;.&#34;</span><span class="op" id="6280046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6280049">return</span>&nbsp;<span class="ident" id="6280056">host</span><span class="op" id="6280060">[</span><span class="ident" id="6280061">prevDot</span><span class="op" id="6280068">+</span><span class="num" id="6280069">1</span><span class="op" id="6280070">:</span><span class="op" id="6280071">]</span><br>
<span class="lineno"></span><span class="op" id="6280073">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">360</span><span class="comment" id="6280076">//&nbsp;isIP&nbsp;reports&nbsp;whether&nbsp;host&nbsp;is&nbsp;an&nbsp;IP&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="6280123">func</span>&nbsp;<span class="ident" id="6280128">isIP</span><span class="op" id="6280132">(</span><span class="ident" id="6280133">host</span>&nbsp;<span class="builtintype" id="6280138">string</span><span class="op" id="6280144">)</span>&nbsp;<span class="builtintype" id="6280146">bool</span>&nbsp;<span class="op" id="6280151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6280154">return</span>&nbsp;<span class="ident" id="6280161">net</span><span class="op" id="6280164">.</span><span class="ident" id="6280165">ParseIP</span><span class="op" id="6280172">(</span><span class="ident" id="6280173">host</span><span class="op" id="6280177">)</span>&nbsp;<span class="op" id="6280179">!=</span>&nbsp;<span class="builtintype" id="6280182">nil</span><br>
<span class="lineno"></span><span class="op" id="6280186">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="comment" id="6280189">//&nbsp;defaultPath&nbsp;returns&nbsp;the&nbsp;directory&nbsp;part&nbsp;of&nbsp;an&nbsp;URL&#39;s&nbsp;path&nbsp;according&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="6280261">//&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.1.4.</span><br>
<span class="lineno"></span><span class="keyword" id="6280288">func</span>&nbsp;<span class="ident" id="6280293">defaultPath</span><span class="op" id="6280304">(</span><span class="ident" id="6280305">path</span>&nbsp;<span class="builtintype" id="6280310">string</span><span class="op" id="6280316">)</span>&nbsp;<span class="builtintype" id="6280318">string</span>&nbsp;<span class="op" id="6280325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6280328">if</span>&nbsp;<span class="builtinfunc" id="6280331">len</span><span class="op" id="6280334">(</span><span class="ident" id="6280335">path</span><span class="op" id="6280339">)</span>&nbsp;<span class="op" id="6280341">==</span>&nbsp;<span class="num" id="6280344">0</span>&nbsp;<span class="op" id="6280346">||</span>&nbsp;<span class="ident" id="6280349">path</span><span class="op" id="6280353">[</span><span class="num" id="6280354">0</span><span class="op" id="6280355">]</span>&nbsp;<span class="op" id="6280357">!=</span>&nbsp;<span class="string" id="6280360">&#39;/&#39;</span>&nbsp;<span class="op" id="6280364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6280368">return</span>&nbsp;<span class="string" id="6280375">&#34;/&#34;</span>&nbsp;<span class="comment" id="6280379">//&nbsp;Path&nbsp;is&nbsp;empty&nbsp;or&nbsp;malformed.</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6280411">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6280415">i</span>&nbsp;<span class="op" id="6280417">:=</span>&nbsp;<span class="ident" id="6280420">strings</span><span class="op" id="6280427">.</span><span class="ident" id="6280428">LastIndex</span><span class="op" id="6280437">(</span><span class="ident" id="6280438">path</span><span class="op" id="6280442">,</span>&nbsp;<span class="string" id="6280444">&#34;/&#34;</span><span class="op" id="6280447">)</span>&nbsp;<span class="comment" id="6280449">//&nbsp;Path&nbsp;starts&nbsp;with&nbsp;&#34;/&#34;,&nbsp;so&nbsp;i&nbsp;!=&nbsp;-1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6280487">if</span>&nbsp;<span class="ident" id="6280490">i</span>&nbsp;<span class="op" id="6280492">==</span>&nbsp;<span class="num" id="6280495">0</span>&nbsp;<span class="op" id="6280497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6280501">return</span>&nbsp;<span class="string" id="6280508">&#34;/&#34;</span>&nbsp;<span class="comment" id="6280512">//&nbsp;Path&nbsp;has&nbsp;the&nbsp;form&nbsp;&#34;/abc&#34;.</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6280542">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6280545">return</span>&nbsp;<span class="ident" id="6280552">path</span><span class="op" id="6280556">[</span><span class="op" id="6280557">:</span><span class="ident" id="6280558">i</span><span class="op" id="6280559">]</span>&nbsp;<span class="comment" id="6280561">//&nbsp;Path&nbsp;is&nbsp;either&nbsp;of&nbsp;form&nbsp;&#34;/abc/xyz&#34;&nbsp;or&nbsp;&#34;/abc/xyz/&#34;.</span><br>
<span class="lineno"></span><span class="op" id="6280614">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6280617">//&nbsp;newEntry&nbsp;creates&nbsp;an&nbsp;entry&nbsp;from&nbsp;a&nbsp;http.Cookie&nbsp;c.&nbsp;now&nbsp;is&nbsp;the&nbsp;current&nbsp;time&nbsp;and</span><br>
<span class="lineno">380</span><span class="comment" id="6280696">//&nbsp;is&nbsp;compared&nbsp;to&nbsp;c.Expires&nbsp;to&nbsp;determine&nbsp;deletion&nbsp;of&nbsp;c.&nbsp;defPath&nbsp;and&nbsp;host&nbsp;are&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6280777">//&nbsp;default-path&nbsp;and&nbsp;the&nbsp;canonical&nbsp;host&nbsp;name&nbsp;of&nbsp;the&nbsp;URL&nbsp;c&nbsp;was&nbsp;received&nbsp;from.</span><br>
<span class="lineno"></span><span class="comment" id="6280853">//</span><br>
<span class="lineno"></span><span class="comment" id="6280856">//&nbsp;remove&nbsp;records&nbsp;whether&nbsp;the&nbsp;jar&nbsp;should&nbsp;delete&nbsp;this&nbsp;cookie,&nbsp;as&nbsp;it&nbsp;has&nbsp;already</span><br>
<span class="lineno"></span><span class="comment" id="6280935">//&nbsp;expired&nbsp;with&nbsp;respect&nbsp;to&nbsp;now.&nbsp;In&nbsp;this&nbsp;case,&nbsp;e&nbsp;may&nbsp;be&nbsp;incomplete,&nbsp;but&nbsp;it&nbsp;will</span><br>
<span class="lineno">385</span><span class="comment" id="6281014">//&nbsp;be&nbsp;valid&nbsp;to&nbsp;call&nbsp;e.id&nbsp;(which&nbsp;depends&nbsp;on&nbsp;e&#39;s&nbsp;Name,&nbsp;Domain&nbsp;and&nbsp;Path).</span><br>
<span class="lineno"></span><span class="comment" id="6281085">//</span><br>
<span class="lineno"></span><span class="comment" id="6281088">//&nbsp;A&nbsp;malformed&nbsp;c.Domain&nbsp;will&nbsp;result&nbsp;in&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="keyword" id="6281137">func</span>&nbsp;<span class="op" id="6281142">(</span><span class="ident" id="6281143">j</span>&nbsp;<span class="op" id="6281145">*</span><span class="ident" id="6281146">Jar</span><span class="op" id="6281149">)</span>&nbsp;<span class="ident" id="6281151">newEntry</span><span class="op" id="6281159">(</span><span class="ident" id="6281160">c</span>&nbsp;<span class="op" id="6281162">*</span><span class="ident" id="6281163">http</span><span class="op" id="6281167">.</span><span class="ident" id="6281168">Cookie</span><span class="op" id="6281174">,</span>&nbsp;<span class="ident" id="6281176">now</span>&nbsp;<span class="ident" id="6281180">time</span><span class="op" id="6281184">.</span><span class="ident" id="6281185">Time</span><span class="op" id="6281189">,</span>&nbsp;<span class="ident" id="6281191">defPath</span><span class="op" id="6281198">,</span>&nbsp;<span class="ident" id="6281200">host</span>&nbsp;<span class="builtintype" id="6281205">string</span><span class="op" id="6281211">)</span>&nbsp;<span class="op" id="6281213">(</span><span class="ident" id="6281214">e</span>&nbsp;<span class="ident" id="6281216">entry</span><span class="op" id="6281221">,</span>&nbsp;<span class="ident" id="6281223">remove</span>&nbsp;<span class="builtintype" id="6281230">bool</span><span class="op" id="6281234">,</span>&nbsp;<span class="ident" id="6281236">err</span>&nbsp;<span class="builtintype" id="6281240">error</span><span class="op" id="6281245">)</span>&nbsp;<span class="op" id="6281247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6281250">e</span><span class="op" id="6281251">.</span><span class="ident" id="6281252">Name</span>&nbsp;<span class="op" id="6281257">=</span>&nbsp;<span class="ident" id="6281259">c</span><span class="op" id="6281260">.</span><span class="ident" id="6281261">Name</span><br>
<span class="lineno">390</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6281268">if</span>&nbsp;<span class="ident" id="6281271">c</span><span class="op" id="6281272">.</span><span class="ident" id="6281273">Path</span>&nbsp;<span class="op" id="6281278">==</span>&nbsp;<span class="string" id="6281281">&#34;&#34;</span>&nbsp;<span class="op" id="6281284">||</span>&nbsp;<span class="ident" id="6281287">c</span><span class="op" id="6281288">.</span><span class="ident" id="6281289">Path</span><span class="op" id="6281293">[</span><span class="num" id="6281294">0</span><span class="op" id="6281295">]</span>&nbsp;<span class="op" id="6281297">!=</span>&nbsp;<span class="string" id="6281300">&#39;/&#39;</span>&nbsp;<span class="op" id="6281304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6281308">e</span><span class="op" id="6281309">.</span><span class="ident" id="6281310">Path</span>&nbsp;<span class="op" id="6281315">=</span>&nbsp;<span class="ident" id="6281317">defPath</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6281326">}</span>&nbsp;<span class="keyword" id="6281328">else</span>&nbsp;<span class="op" id="6281333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6281337">e</span><span class="op" id="6281338">.</span><span class="ident" id="6281339">Path</span>&nbsp;<span class="op" id="6281344">=</span>&nbsp;<span class="ident" id="6281346">c</span><span class="op" id="6281347">.</span><span class="ident" id="6281348">Path</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6281354">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6281358">e</span><span class="op" id="6281359">.</span><span class="ident" id="6281360">Domain</span><span class="op" id="6281366">,</span>&nbsp;<span class="ident" id="6281368">e</span><span class="op" id="6281369">.</span><span class="ident" id="6281370">HostOnly</span><span class="op" id="6281378">,</span>&nbsp;<span class="ident" id="6281380">err</span>&nbsp;<span class="op" id="6281384">=</span>&nbsp;<span class="ident" id="6281386">j</span><span class="op" id="6281387">.</span><span class="ident" id="6281388">domainAndType</span><span class="op" id="6281401">(</span><span class="ident" id="6281402">host</span><span class="op" id="6281406">,</span>&nbsp;<span class="ident" id="6281408">c</span><span class="op" id="6281409">.</span><span class="ident" id="6281410">Domain</span><span class="op" id="6281416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6281419">if</span>&nbsp;<span class="ident" id="6281422">err</span>&nbsp;<span class="op" id="6281426">!=</span>&nbsp;<span class="builtintype" id="6281429">nil</span>&nbsp;<span class="op" id="6281433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6281437">return</span>&nbsp;<span class="ident" id="6281444">e</span><span class="op" id="6281445">,</span>&nbsp;<span class="builtintype" id="6281447">false</span><span class="op" id="6281452">,</span>&nbsp;<span class="ident" id="6281454">err</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6281459">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6281463">//&nbsp;MaxAge&nbsp;takes&nbsp;precedence&nbsp;over&nbsp;Expires.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6281505">if</span>&nbsp;<span class="ident" id="6281508">c</span><span class="op" id="6281509">.</span><span class="ident" id="6281510">MaxAge</span>&nbsp;<span class="op" id="6281517">&lt;</span>&nbsp;<span class="num" id="6281519">0</span>&nbsp;<span class="op" id="6281521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6281525">return</span>&nbsp;<span class="ident" id="6281532">e</span><span class="op" id="6281533">,</span>&nbsp;<span class="builtintype" id="6281535">true</span><span class="op" id="6281539">,</span>&nbsp;<span class="builtintype" id="6281541">nil</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6281546">}</span>&nbsp;<span class="keyword" id="6281548">else</span>&nbsp;<span class="keyword" id="6281553">if</span>&nbsp;<span class="ident" id="6281556">c</span><span class="op" id="6281557">.</span><span class="ident" id="6281558">MaxAge</span>&nbsp;<span class="op" id="6281565">&gt;</span>&nbsp;<span class="num" id="6281567">0</span>&nbsp;<span class="op" id="6281569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6281573">e</span><span class="op" id="6281574">.</span><span class="ident" id="6281575">Expires</span>&nbsp;<span class="op" id="6281583">=</span>&nbsp;<span class="ident" id="6281585">now</span><span class="op" id="6281588">.</span><span class="ident" id="6281589">Add</span><span class="op" id="6281592">(</span><span class="ident" id="6281593">time</span><span class="op" id="6281597">.</span><span class="ident" id="6281598">Duration</span><span class="op" id="6281606">(</span><span class="ident" id="6281607">c</span><span class="op" id="6281608">.</span><span class="ident" id="6281609">MaxAge</span><span class="op" id="6281615">)</span>&nbsp;<span class="op" id="6281617">*</span>&nbsp;<span class="ident" id="6281619">time</span><span class="op" id="6281623">.</span><span class="ident" id="6281624">Second</span><span class="op" id="6281630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6281634">e</span><span class="op" id="6281635">.</span><span class="ident" id="6281636">Persistent</span>&nbsp;<span class="op" id="6281647">=</span>&nbsp;<span class="builtintype" id="6281649">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6281655">}</span>&nbsp;<span class="keyword" id="6281657">else</span>&nbsp;<span class="op" id="6281662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6281666">if</span>&nbsp;<span class="ident" id="6281669">c</span><span class="op" id="6281670">.</span><span class="ident" id="6281671">Expires</span><span class="op" id="6281678">.</span><span class="ident" id="6281679">IsZero</span><span class="op" id="6281685">(</span><span class="op" id="6281686">)</span>&nbsp;<span class="op" id="6281688">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6281693">e</span><span class="op" id="6281694">.</span><span class="ident" id="6281695">Expires</span>&nbsp;<span class="op" id="6281703">=</span>&nbsp;<span class="ident" id="6281705">endOfTime</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6281718">e</span><span class="op" id="6281719">.</span><span class="ident" id="6281720">Persistent</span>&nbsp;<span class="op" id="6281731">=</span>&nbsp;<span class="builtintype" id="6281733">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6281741">}</span>&nbsp;<span class="keyword" id="6281743">else</span>&nbsp;<span class="op" id="6281748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6281753">if</span>&nbsp;<span class="op" id="6281756">!</span><span class="ident" id="6281757">c</span><span class="op" id="6281758">.</span><span class="ident" id="6281759">Expires</span><span class="op" id="6281766">.</span><span class="ident" id="6281767">After</span><span class="op" id="6281772">(</span><span class="ident" id="6281773">now</span><span class="op" id="6281776">)</span>&nbsp;<span class="op" id="6281778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6281784">return</span>&nbsp;<span class="ident" id="6281791">e</span><span class="op" id="6281792">,</span>&nbsp;<span class="builtintype" id="6281794">true</span><span class="op" id="6281798">,</span>&nbsp;<span class="builtintype" id="6281800">nil</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6281807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6281812">e</span><span class="op" id="6281813">.</span><span class="ident" id="6281814">Expires</span>&nbsp;<span class="op" id="6281822">=</span>&nbsp;<span class="ident" id="6281824">c</span><span class="op" id="6281825">.</span><span class="ident" id="6281826">Expires</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6281837">e</span><span class="op" id="6281838">.</span><span class="ident" id="6281839">Persistent</span>&nbsp;<span class="op" id="6281850">=</span>&nbsp;<span class="builtintype" id="6281852">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6281859">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6281862">}</span><br>
<span class="lineno">420</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6281866">e</span><span class="op" id="6281867">.</span><span class="ident" id="6281868">Value</span>&nbsp;<span class="op" id="6281874">=</span>&nbsp;<span class="ident" id="6281876">c</span><span class="op" id="6281877">.</span><span class="ident" id="6281878">Value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6281885">e</span><span class="op" id="6281886">.</span><span class="ident" id="6281887">Secure</span>&nbsp;<span class="op" id="6281894">=</span>&nbsp;<span class="ident" id="6281896">c</span><span class="op" id="6281897">.</span><span class="ident" id="6281898">Secure</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6281906">e</span><span class="op" id="6281907">.</span><span class="ident" id="6281908">HttpOnly</span>&nbsp;<span class="op" id="6281917">=</span>&nbsp;<span class="ident" id="6281919">c</span><span class="op" id="6281920">.</span><span class="ident" id="6281921">HttpOnly</span><br>
<span class="lineno"></span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6281932">return</span>&nbsp;<span class="ident" id="6281939">e</span><span class="op" id="6281940">,</span>&nbsp;<span class="builtintype" id="6281942">false</span><span class="op" id="6281947">,</span>&nbsp;<span class="builtintype" id="6281949">nil</span><br>
<span class="lineno"></span><span class="op" id="6281953">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6281956">var</span>&nbsp;<span class="op" id="6281960">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6281963">errIllegalDomain</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6281982">=</span>&nbsp;<span class="ident" id="6281984">errors</span><span class="op" id="6281990">.</span><span class="ident" id="6281991">New</span><span class="op" id="6281994">(</span><span class="string" id="6281995">&#34;cookiejar:&nbsp;illegal&nbsp;cookie&nbsp;domain&nbsp;attribute&#34;</span><span class="op" id="6282039">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6282042">errMalformedDomain</span>&nbsp;<span class="op" id="6282061">=</span>&nbsp;<span class="ident" id="6282063">errors</span><span class="op" id="6282069">.</span><span class="ident" id="6282070">New</span><span class="op" id="6282073">(</span><span class="string" id="6282074">&#34;cookiejar:&nbsp;malformed&nbsp;cookie&nbsp;domain&nbsp;attribute&#34;</span><span class="op" id="6282120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6282123">errNoHostname</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6282142">=</span>&nbsp;<span class="ident" id="6282144">errors</span><span class="op" id="6282150">.</span><span class="ident" id="6282151">New</span><span class="op" id="6282154">(</span><span class="string" id="6282155">&#34;cookiejar:&nbsp;no&nbsp;host&nbsp;name&nbsp;available&nbsp;(IP&nbsp;only)&#34;</span><span class="op" id="6282200">)</span><br>
<span class="lineno"></span><span class="op" id="6282202">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6282205">//&nbsp;endOfTime&nbsp;is&nbsp;the&nbsp;time&nbsp;when&nbsp;session&nbsp;(non-persistent)&nbsp;cookies&nbsp;expire.</span><br>
<span class="lineno">435</span><span class="comment" id="6282276">//&nbsp;This&nbsp;instant&nbsp;is&nbsp;representable&nbsp;in&nbsp;most&nbsp;date/time&nbsp;formats&nbsp;(not&nbsp;just</span><br>
<span class="lineno"></span><span class="comment" id="6282345">//&nbsp;Go&#39;s&nbsp;time.Time)&nbsp;and&nbsp;should&nbsp;be&nbsp;far&nbsp;enough&nbsp;in&nbsp;the&nbsp;future.</span><br>
<span class="lineno"></span><span class="keyword" id="6282404">var</span>&nbsp;<span class="ident" id="6282408">endOfTime</span>&nbsp;<span class="op" id="6282418">=</span>&nbsp;<span class="ident" id="6282420">time</span><span class="op" id="6282424">.</span><span class="ident" id="6282425">Date</span><span class="op" id="6282429">(</span><span class="num" id="6282430">9999</span><span class="op" id="6282434">,</span>&nbsp;<span class="num" id="6282436">12</span><span class="op" id="6282438">,</span>&nbsp;<span class="num" id="6282440">31</span><span class="op" id="6282442">,</span>&nbsp;<span class="num" id="6282444">23</span><span class="op" id="6282446">,</span>&nbsp;<span class="num" id="6282448">59</span><span class="op" id="6282450">,</span>&nbsp;<span class="num" id="6282452">59</span><span class="op" id="6282454">,</span>&nbsp;<span class="num" id="6282456">0</span><span class="op" id="6282457">,</span>&nbsp;<span class="ident" id="6282459">time</span><span class="op" id="6282463">.</span><span class="ident" id="6282464">UTC</span><span class="op" id="6282467">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6282470">//&nbsp;domainAndType&nbsp;determines&nbsp;the&nbsp;cookie&#39;s&nbsp;domain&nbsp;and&nbsp;hostOnly&nbsp;attribute.</span><br>
<span class="lineno">440</span><span class="keyword" id="6282542">func</span>&nbsp;<span class="op" id="6282547">(</span><span class="ident" id="6282548">j</span>&nbsp;<span class="op" id="6282550">*</span><span class="ident" id="6282551">Jar</span><span class="op" id="6282554">)</span>&nbsp;<span class="ident" id="6282556">domainAndType</span><span class="op" id="6282569">(</span><span class="ident" id="6282570">host</span><span class="op" id="6282574">,</span>&nbsp;<span class="ident" id="6282576">domain</span>&nbsp;<span class="builtintype" id="6282583">string</span><span class="op" id="6282589">)</span>&nbsp;<span class="op" id="6282591">(</span><span class="builtintype" id="6282592">string</span><span class="op" id="6282598">,</span>&nbsp;<span class="builtintype" id="6282600">bool</span><span class="op" id="6282604">,</span>&nbsp;<span class="builtintype" id="6282606">error</span><span class="op" id="6282611">)</span>&nbsp;<span class="op" id="6282613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6282616">if</span>&nbsp;<span class="ident" id="6282619">domain</span>&nbsp;<span class="op" id="6282626">==</span>&nbsp;<span class="string" id="6282629">&#34;&#34;</span>&nbsp;<span class="op" id="6282632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6282636">//&nbsp;No&nbsp;domain&nbsp;attribute&nbsp;in&nbsp;the&nbsp;SetCookie&nbsp;header&nbsp;indicates&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6282697">//&nbsp;host&nbsp;cookie.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6282715">return</span>&nbsp;<span class="ident" id="6282722">host</span><span class="op" id="6282726">,</span>&nbsp;<span class="builtintype" id="6282728">true</span><span class="op" id="6282732">,</span>&nbsp;<span class="builtintype" id="6282734">nil</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6282739">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6282743">if</span>&nbsp;<span class="ident" id="6282746">isIP</span><span class="op" id="6282750">(</span><span class="ident" id="6282751">host</span><span class="op" id="6282755">)</span>&nbsp;<span class="op" id="6282757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6282761">//&nbsp;According&nbsp;to&nbsp;RFC&nbsp;6265&nbsp;domain-matching&nbsp;includes&nbsp;not&nbsp;being</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6282823">//&nbsp;an&nbsp;IP&nbsp;address.</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6282843">//&nbsp;TODO:&nbsp;This&nbsp;might&nbsp;be&nbsp;relaxed&nbsp;as&nbsp;in&nbsp;common&nbsp;browsers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6282899">return</span>&nbsp;<span class="string" id="6282906">&#34;&#34;</span><span class="op" id="6282908">,</span>&nbsp;<span class="builtintype" id="6282910">false</span><span class="op" id="6282915">,</span>&nbsp;<span class="ident" id="6282917">errNoHostname</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6282932">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6282936">//&nbsp;From&nbsp;here&nbsp;on:&nbsp;If&nbsp;the&nbsp;cookie&nbsp;is&nbsp;valid,&nbsp;it&nbsp;is&nbsp;a&nbsp;domain&nbsp;cookie&nbsp;(with</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6283006">//&nbsp;the&nbsp;one&nbsp;exception&nbsp;of&nbsp;a&nbsp;public&nbsp;suffix&nbsp;below).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6283055">//&nbsp;See&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.2.3.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6283087">if</span>&nbsp;<span class="ident" id="6283090">domain</span><span class="op" id="6283096">[</span><span class="num" id="6283097">0</span><span class="op" id="6283098">]</span>&nbsp;<span class="op" id="6283100">==</span>&nbsp;<span class="string" id="6283103">&#39;.&#39;</span>&nbsp;<span class="op" id="6283107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6283111">domain</span>&nbsp;<span class="op" id="6283118">=</span>&nbsp;<span class="ident" id="6283120">domain</span><span class="op" id="6283126">[</span><span class="num" id="6283127">1</span><span class="op" id="6283128">:</span><span class="op" id="6283129">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6283132">}</span><br>
<span class="lineno">460</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6283136">if</span>&nbsp;<span class="builtinfunc" id="6283139">len</span><span class="op" id="6283142">(</span><span class="ident" id="6283143">domain</span><span class="op" id="6283149">)</span>&nbsp;<span class="op" id="6283151">==</span>&nbsp;<span class="num" id="6283154">0</span>&nbsp;<span class="op" id="6283156">||</span>&nbsp;<span class="ident" id="6283159">domain</span><span class="op" id="6283165">[</span><span class="num" id="6283166">0</span><span class="op" id="6283167">]</span>&nbsp;<span class="op" id="6283169">==</span>&nbsp;<span class="string" id="6283172">&#39;.&#39;</span>&nbsp;<span class="op" id="6283176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6283180">//&nbsp;Received&nbsp;either&nbsp;&#34;Domain=.&#34;&nbsp;or&nbsp;&#34;Domain=..some.thing&#34;,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6283238">//&nbsp;both&nbsp;are&nbsp;illegal.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6283261">return</span>&nbsp;<span class="string" id="6283268">&#34;&#34;</span><span class="op" id="6283270">,</span>&nbsp;<span class="builtintype" id="6283272">false</span><span class="op" id="6283277">,</span>&nbsp;<span class="ident" id="6283279">errMalformedDomain</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6283299">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6283302">domain</span>&nbsp;<span class="op" id="6283309">=</span>&nbsp;<span class="ident" id="6283311">strings</span><span class="op" id="6283318">.</span><span class="ident" id="6283319">ToLower</span><span class="op" id="6283326">(</span><span class="ident" id="6283327">domain</span><span class="op" id="6283333">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6283337">if</span>&nbsp;<span class="ident" id="6283340">domain</span><span class="op" id="6283346">[</span><span class="builtinfunc" id="6283347">len</span><span class="op" id="6283350">(</span><span class="ident" id="6283351">domain</span><span class="op" id="6283357">)</span><span class="op" id="6283358">-</span><span class="num" id="6283359">1</span><span class="op" id="6283360">]</span>&nbsp;<span class="op" id="6283362">==</span>&nbsp;<span class="string" id="6283365">&#39;.&#39;</span>&nbsp;<span class="op" id="6283369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6283373">//&nbsp;We&nbsp;received&nbsp;stuff&nbsp;like&nbsp;&#34;Domain=www.example.com.&#34;.</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6283428">//&nbsp;Browsers&nbsp;do&nbsp;handle&nbsp;such&nbsp;stuff&nbsp;(actually&nbsp;differently)&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6283490">//&nbsp;RFC&nbsp;6265&nbsp;seems&nbsp;to&nbsp;be&nbsp;clear&nbsp;here&nbsp;(e.g.&nbsp;section&nbsp;4.1.2.3)&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6283553">//&nbsp;requiring&nbsp;a&nbsp;reject.&nbsp;&nbsp;4.1.2.3&nbsp;is&nbsp;not&nbsp;normative,&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6283609">//&nbsp;&#34;Domain&nbsp;Matching&#34;&nbsp;(5.1.3)&nbsp;and&nbsp;&#34;Canonicalized&nbsp;Host&nbsp;Names&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6283671">//&nbsp;(5.1.2)&nbsp;are.</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6283689">return</span>&nbsp;<span class="string" id="6283696">&#34;&#34;</span><span class="op" id="6283698">,</span>&nbsp;<span class="builtintype" id="6283700">false</span><span class="op" id="6283705">,</span>&nbsp;<span class="ident" id="6283707">errMalformedDomain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6283727">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6283731">//&nbsp;See&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.3&nbsp;#5.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6283764">if</span>&nbsp;<span class="ident" id="6283767">j</span><span class="op" id="6283768">.</span><span class="ident" id="6283769">psList</span>&nbsp;<span class="op" id="6283776">!=</span>&nbsp;<span class="builtintype" id="6283779">nil</span>&nbsp;<span class="op" id="6283783">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6283787">if</span>&nbsp;<span class="ident" id="6283790">ps</span>&nbsp;<span class="op" id="6283793">:=</span>&nbsp;<span class="ident" id="6283796">j</span><span class="op" id="6283797">.</span><span class="ident" id="6283798">psList</span><span class="op" id="6283804">.</span><span class="ident" id="6283805">PublicSuffix</span><span class="op" id="6283817">(</span><span class="ident" id="6283818">domain</span><span class="op" id="6283824">)</span><span class="op" id="6283825">;</span>&nbsp;<span class="ident" id="6283827">ps</span>&nbsp;<span class="op" id="6283830">!=</span>&nbsp;<span class="string" id="6283833">&#34;&#34;</span>&nbsp;<span class="op" id="6283836">&amp;&amp;</span>&nbsp;<span class="op" id="6283839">!</span><span class="ident" id="6283840">hasDotSuffix</span><span class="op" id="6283852">(</span><span class="ident" id="6283853">domain</span><span class="op" id="6283859">,</span>&nbsp;<span class="ident" id="6283861">ps</span><span class="op" id="6283863">)</span>&nbsp;<span class="op" id="6283865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6283870">if</span>&nbsp;<span class="ident" id="6283873">host</span>&nbsp;<span class="op" id="6283878">==</span>&nbsp;<span class="ident" id="6283881">domain</span>&nbsp;<span class="op" id="6283888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6283894">//&nbsp;This&nbsp;is&nbsp;the&nbsp;one&nbsp;exception&nbsp;in&nbsp;which&nbsp;a&nbsp;cookie</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6283945">//&nbsp;with&nbsp;a&nbsp;domain&nbsp;attribute&nbsp;is&nbsp;a&nbsp;host&nbsp;cookie.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6283994">return</span>&nbsp;<span class="ident" id="6284001">host</span><span class="op" id="6284005">,</span>&nbsp;<span class="builtintype" id="6284007">true</span><span class="op" id="6284011">,</span>&nbsp;<span class="builtintype" id="6284013">nil</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6284020">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6284025">return</span>&nbsp;<span class="string" id="6284032">&#34;&#34;</span><span class="op" id="6284034">,</span>&nbsp;<span class="builtintype" id="6284036">false</span><span class="op" id="6284041">,</span>&nbsp;<span class="ident" id="6284043">errIllegalDomain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6284062">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6284065">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6284069">//&nbsp;The&nbsp;domain&nbsp;must&nbsp;domain-match&nbsp;host:&nbsp;www.mycompany.com&nbsp;cannot</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6284133">//&nbsp;set&nbsp;cookies&nbsp;for&nbsp;.ourcompetitors.com.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6284174">if</span>&nbsp;<span class="ident" id="6284177">host</span>&nbsp;<span class="op" id="6284182">!=</span>&nbsp;<span class="ident" id="6284185">domain</span>&nbsp;<span class="op" id="6284192">&amp;&amp;</span>&nbsp;<span class="op" id="6284195">!</span><span class="ident" id="6284196">hasDotSuffix</span><span class="op" id="6284208">(</span><span class="ident" id="6284209">host</span><span class="op" id="6284213">,</span>&nbsp;<span class="ident" id="6284215">domain</span><span class="op" id="6284221">)</span>&nbsp;<span class="op" id="6284223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6284227">return</span>&nbsp;<span class="string" id="6284234">&#34;&#34;</span><span class="op" id="6284236">,</span>&nbsp;<span class="builtintype" id="6284238">false</span><span class="op" id="6284243">,</span>&nbsp;<span class="ident" id="6284245">errIllegalDomain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6284263">}</span><br>
<span class="lineno">495</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6284267">return</span>&nbsp;<span class="ident" id="6284274">domain</span><span class="op" id="6284280">,</span>&nbsp;<span class="builtintype" id="6284282">false</span><span class="op" id="6284287">,</span>&nbsp;<span class="builtintype" id="6284289">nil</span><br>
<span class="lineno"></span><span class="op" id="6284293">}</span>
</div>
</body>
</html>
