<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>html/template</h2>
<ul>
<li><a href="/gostd/html/template/attr.go.html">attr.go</a></li>
<li><a href="/gostd/html/template/clone_test.go.html">clone_test.go</a></li>
<li><a href="/gostd/html/template/content.go.html">content.go</a></li>
<li><a href="/gostd/html/template/content_test.go.html">content_test.go</a></li>
<li><a href="/gostd/html/template/context.go.html">context.go</a></li>
<li><a href="/gostd/html/template/css.go.html">css.go</a></li>
<li><a href="/gostd/html/template/css_test.go.html">css_test.go</a></li>
<li><a href="/gostd/html/template/doc.go.html">doc.go</a></li>
<li><a href="/gostd/html/template/error.go.html">error.go</a></li>
<li><a href="/gostd/html/template/escape.go.html">escape.go</a></li>
<li><a href="/gostd/html/template/escape_test.go.html">escape_test.go</a></li>
<li><a href="/gostd/html/template/html.go.html" class="current">html.go</a></li>
<li><a href="/gostd/html/template/html_test.go.html">html_test.go</a></li>
<li><a href="/gostd/html/template/js.go.html">js.go</a></li>
<li><a href="/gostd/html/template/js_test.go.html">js_test.go</a></li>
<li><a href="/gostd/html/template/template.go.html">template.go</a></li>
<li><a href="/gostd/html/template/transition.go.html">transition.go</a></li>
<li><a href="/gostd/html/template/url.go.html">url.go</a></li>
<li><a href="/gostd/html/template/url_test.go.html">url_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5171727">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5171782">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5171836">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5171887">package</span>&nbsp;<span class="ident" id="5171895">template</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5171905">import</span>&nbsp;<span class="op" id="5171912">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5171915">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5171924">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5171931">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5171942">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="5171957">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5171960">//&nbsp;htmlNospaceEscaper&nbsp;escapes&nbsp;for&nbsp;inclusion&nbsp;in&nbsp;unquoted&nbsp;attribute&nbsp;values.</span><br>
<span class="lineno">15</span><span class="keyword" id="5172034">func</span>&nbsp;<span class="ident" id="5172039">htmlNospaceEscaper</span><span class="op" id="5172057">(</span><span class="ident" id="5172058">args</span>&nbsp;<span class="op" id="5172063">...</span><span class="keyword" id="5172066">interface</span><span class="op" id="5172075">{</span><span class="op" id="5172076">}</span><span class="op" id="5172077">)</span>&nbsp;<span class="builtintype" id="5172079">string</span>&nbsp;<span class="op" id="5172086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5172089">s</span><span class="op" id="5172090">,</span>&nbsp;<span class="ident" id="5172092">t</span>&nbsp;<span class="op" id="5172094">:=</span>&nbsp;<span class="ident" id="5172097">stringify</span><span class="op" id="5172106">(</span><span class="ident" id="5172107">args</span><span class="op" id="5172111">...</span><span class="op" id="5172114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5172117">if</span>&nbsp;<span class="ident" id="5172120">t</span>&nbsp;<span class="op" id="5172122">==</span>&nbsp;<span class="ident" id="5172125">contentTypeHTML</span>&nbsp;<span class="op" id="5172141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5172145">return</span>&nbsp;<span class="ident" id="5172152">htmlReplacer</span><span class="op" id="5172164">(</span><span class="ident" id="5172165">stripTags</span><span class="op" id="5172174">(</span><span class="ident" id="5172175">s</span><span class="op" id="5172176">)</span><span class="op" id="5172177">,</span>&nbsp;<span class="ident" id="5172179">htmlNospaceNormReplacementTable</span><span class="op" id="5172210">,</span>&nbsp;<span class="builtintype" id="5172212">false</span><span class="op" id="5172217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5172220">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5172223">return</span>&nbsp;<span class="ident" id="5172230">htmlReplacer</span><span class="op" id="5172242">(</span><span class="ident" id="5172243">s</span><span class="op" id="5172244">,</span>&nbsp;<span class="ident" id="5172246">htmlNospaceReplacementTable</span><span class="op" id="5172273">,</span>&nbsp;<span class="builtintype" id="5172275">false</span><span class="op" id="5172280">)</span><br>
<span class="lineno"></span><span class="op" id="5172282">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5172285">//&nbsp;attrEscaper&nbsp;escapes&nbsp;for&nbsp;inclusion&nbsp;in&nbsp;quoted&nbsp;attribute&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="5172350">func</span>&nbsp;<span class="ident" id="5172355">attrEscaper</span><span class="op" id="5172366">(</span><span class="ident" id="5172367">args</span>&nbsp;<span class="op" id="5172372">...</span><span class="keyword" id="5172375">interface</span><span class="op" id="5172384">{</span><span class="op" id="5172385">}</span><span class="op" id="5172386">)</span>&nbsp;<span class="builtintype" id="5172388">string</span>&nbsp;<span class="op" id="5172395">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5172398">s</span><span class="op" id="5172399">,</span>&nbsp;<span class="ident" id="5172401">t</span>&nbsp;<span class="op" id="5172403">:=</span>&nbsp;<span class="ident" id="5172406">stringify</span><span class="op" id="5172415">(</span><span class="ident" id="5172416">args</span><span class="op" id="5172420">...</span><span class="op" id="5172423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5172426">if</span>&nbsp;<span class="ident" id="5172429">t</span>&nbsp;<span class="op" id="5172431">==</span>&nbsp;<span class="ident" id="5172434">contentTypeHTML</span>&nbsp;<span class="op" id="5172450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5172454">return</span>&nbsp;<span class="ident" id="5172461">htmlReplacer</span><span class="op" id="5172473">(</span><span class="ident" id="5172474">stripTags</span><span class="op" id="5172483">(</span><span class="ident" id="5172484">s</span><span class="op" id="5172485">)</span><span class="op" id="5172486">,</span>&nbsp;<span class="ident" id="5172488">htmlNormReplacementTable</span><span class="op" id="5172512">,</span>&nbsp;<span class="builtintype" id="5172514">true</span><span class="op" id="5172518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5172521">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5172524">return</span>&nbsp;<span class="ident" id="5172531">htmlReplacer</span><span class="op" id="5172543">(</span><span class="ident" id="5172544">s</span><span class="op" id="5172545">,</span>&nbsp;<span class="ident" id="5172547">htmlReplacementTable</span><span class="op" id="5172567">,</span>&nbsp;<span class="builtintype" id="5172569">true</span><span class="op" id="5172573">)</span><br>
<span class="lineno">30</span><span class="op" id="5172575">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5172578">//&nbsp;rcdataEscaper&nbsp;escapes&nbsp;for&nbsp;inclusion&nbsp;in&nbsp;an&nbsp;RCDATA&nbsp;element&nbsp;body.</span><br>
<span class="lineno"></span><span class="keyword" id="5172644">func</span>&nbsp;<span class="ident" id="5172649">rcdataEscaper</span><span class="op" id="5172662">(</span><span class="ident" id="5172663">args</span>&nbsp;<span class="op" id="5172668">...</span><span class="keyword" id="5172671">interface</span><span class="op" id="5172680">{</span><span class="op" id="5172681">}</span><span class="op" id="5172682">)</span>&nbsp;<span class="builtintype" id="5172684">string</span>&nbsp;<span class="op" id="5172691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5172694">s</span><span class="op" id="5172695">,</span>&nbsp;<span class="ident" id="5172697">t</span>&nbsp;<span class="op" id="5172699">:=</span>&nbsp;<span class="ident" id="5172702">stringify</span><span class="op" id="5172711">(</span><span class="ident" id="5172712">args</span><span class="op" id="5172716">...</span><span class="op" id="5172719">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5172722">if</span>&nbsp;<span class="ident" id="5172725">t</span>&nbsp;<span class="op" id="5172727">==</span>&nbsp;<span class="ident" id="5172730">contentTypeHTML</span>&nbsp;<span class="op" id="5172746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5172750">return</span>&nbsp;<span class="ident" id="5172757">htmlReplacer</span><span class="op" id="5172769">(</span><span class="ident" id="5172770">s</span><span class="op" id="5172771">,</span>&nbsp;<span class="ident" id="5172773">htmlNormReplacementTable</span><span class="op" id="5172797">,</span>&nbsp;<span class="builtintype" id="5172799">true</span><span class="op" id="5172803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5172806">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5172809">return</span>&nbsp;<span class="ident" id="5172816">htmlReplacer</span><span class="op" id="5172828">(</span><span class="ident" id="5172829">s</span><span class="op" id="5172830">,</span>&nbsp;<span class="ident" id="5172832">htmlReplacementTable</span><span class="op" id="5172852">,</span>&nbsp;<span class="builtintype" id="5172854">true</span><span class="op" id="5172858">)</span><br>
<span class="lineno"></span><span class="op" id="5172860">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="comment" id="5172863">//&nbsp;htmlEscaper&nbsp;escapes&nbsp;for&nbsp;inclusion&nbsp;in&nbsp;HTML&nbsp;text.</span><br>
<span class="lineno"></span><span class="keyword" id="5172914">func</span>&nbsp;<span class="ident" id="5172919">htmlEscaper</span><span class="op" id="5172930">(</span><span class="ident" id="5172931">args</span>&nbsp;<span class="op" id="5172936">...</span><span class="keyword" id="5172939">interface</span><span class="op" id="5172948">{</span><span class="op" id="5172949">}</span><span class="op" id="5172950">)</span>&nbsp;<span class="builtintype" id="5172952">string</span>&nbsp;<span class="op" id="5172959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5172962">s</span><span class="op" id="5172963">,</span>&nbsp;<span class="ident" id="5172965">t</span>&nbsp;<span class="op" id="5172967">:=</span>&nbsp;<span class="ident" id="5172970">stringify</span><span class="op" id="5172979">(</span><span class="ident" id="5172980">args</span><span class="op" id="5172984">...</span><span class="op" id="5172987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5172990">if</span>&nbsp;<span class="ident" id="5172993">t</span>&nbsp;<span class="op" id="5172995">==</span>&nbsp;<span class="ident" id="5172998">contentTypeHTML</span>&nbsp;<span class="op" id="5173014">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5173018">return</span>&nbsp;<span class="ident" id="5173025">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5173028">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5173031">return</span>&nbsp;<span class="ident" id="5173038">htmlReplacer</span><span class="op" id="5173050">(</span><span class="ident" id="5173051">s</span><span class="op" id="5173052">,</span>&nbsp;<span class="ident" id="5173054">htmlReplacementTable</span><span class="op" id="5173074">,</span>&nbsp;<span class="builtintype" id="5173076">true</span><span class="op" id="5173080">)</span><br>
<span class="lineno"></span><span class="op" id="5173082">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="5173085">//&nbsp;htmlReplacementTable&nbsp;contains&nbsp;the&nbsp;runes&nbsp;that&nbsp;need&nbsp;to&nbsp;be&nbsp;escaped</span><br>
<span class="lineno"></span><span class="comment" id="5173152">//&nbsp;inside&nbsp;a&nbsp;quoted&nbsp;attribute&nbsp;value&nbsp;or&nbsp;in&nbsp;a&nbsp;text&nbsp;node.</span><br>
<span class="lineno"></span><span class="keyword" id="5173206">var</span>&nbsp;<span class="ident" id="5173210">htmlReplacementTable</span>&nbsp;<span class="op" id="5173231">=</span>&nbsp;<span class="op" id="5173233">[</span><span class="op" id="5173234">]</span><span class="builtintype" id="5173235">string</span><span class="op" id="5173241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5173244">//&nbsp;http://www.w3.org/TR/html5/syntax.html#attribute-value-(unquoted)-state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5173320">//&nbsp;U+0000&nbsp;NULL&nbsp;Parse&nbsp;error.&nbsp;Append&nbsp;a&nbsp;U+FFFD&nbsp;REPLACEMENT</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5173377">//&nbsp;CHARACTER&nbsp;character&nbsp;to&nbsp;the&nbsp;current&nbsp;attribute&#39;s&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5173435">//&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5173441">//&nbsp;and&nbsp;similarly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5173459">//&nbsp;http://www.w3.org/TR/html5/syntax.html#before-attribute-value-state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5173531">0</span><span class="op" id="5173532">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5173537">&#34;\uFFFD&#34;</span><span class="op" id="5173545">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5173548">&#39;&#34;&#39;</span><span class="op" id="5173551">:</span>&nbsp;&nbsp;<span class="string" id="5173554">&#34;&amp;#34;&#34;</span><span class="op" id="5173561">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5173564">&#39;&amp;&#39;</span><span class="op" id="5173567">:</span>&nbsp;&nbsp;<span class="string" id="5173570">&#34;&amp;amp;&#34;</span><span class="op" id="5173577">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5173580">&#39;\&#39;&#39;</span><span class="op" id="5173584">:</span>&nbsp;<span class="string" id="5173586">&#34;&amp;#39;&#34;</span><span class="op" id="5173593">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5173596">&#39;+&#39;</span><span class="op" id="5173599">:</span>&nbsp;&nbsp;<span class="string" id="5173602">&#34;&amp;#43;&#34;</span><span class="op" id="5173609">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5173612">&#39;&lt;&#39;</span><span class="op" id="5173615">:</span>&nbsp;&nbsp;<span class="string" id="5173618">&#34;&amp;lt;&#34;</span><span class="op" id="5173624">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5173627">&#39;&gt;&#39;</span><span class="op" id="5173630">:</span>&nbsp;&nbsp;<span class="string" id="5173633">&#34;&amp;gt;&#34;</span><span class="op" id="5173639">,</span><br>
<span class="lineno"></span><span class="op" id="5173641">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5173644">//&nbsp;htmlNormReplacementTable&nbsp;is&nbsp;like&nbsp;htmlReplacementTable&nbsp;but&nbsp;without&nbsp;&#39;&amp;&#39;&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5173720">//&nbsp;avoid&nbsp;over-encoding&nbsp;existing&nbsp;entities.</span><br>
<span class="lineno">70</span><span class="keyword" id="5173762">var</span>&nbsp;<span class="ident" id="5173766">htmlNormReplacementTable</span>&nbsp;<span class="op" id="5173791">=</span>&nbsp;<span class="op" id="5173793">[</span><span class="op" id="5173794">]</span><span class="builtintype" id="5173795">string</span><span class="op" id="5173801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5173804">0</span><span class="op" id="5173805">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5173810">&#34;\uFFFD&#34;</span><span class="op" id="5173818">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5173821">&#39;&#34;&#39;</span><span class="op" id="5173824">:</span>&nbsp;&nbsp;<span class="string" id="5173827">&#34;&amp;#34;&#34;</span><span class="op" id="5173834">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5173837">&#39;\&#39;&#39;</span><span class="op" id="5173841">:</span>&nbsp;<span class="string" id="5173843">&#34;&amp;#39;&#34;</span><span class="op" id="5173850">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5173853">&#39;+&#39;</span><span class="op" id="5173856">:</span>&nbsp;&nbsp;<span class="string" id="5173859">&#34;&amp;#43;&#34;</span><span class="op" id="5173866">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5173869">&#39;&lt;&#39;</span><span class="op" id="5173872">:</span>&nbsp;&nbsp;<span class="string" id="5173875">&#34;&amp;lt;&#34;</span><span class="op" id="5173881">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5173884">&#39;&gt;&#39;</span><span class="op" id="5173887">:</span>&nbsp;&nbsp;<span class="string" id="5173890">&#34;&amp;gt;&#34;</span><span class="op" id="5173896">,</span><br>
<span class="lineno"></span><span class="op" id="5173898">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5173901">//&nbsp;htmlNospaceReplacementTable&nbsp;contains&nbsp;the&nbsp;runes&nbsp;that&nbsp;need&nbsp;to&nbsp;be&nbsp;escaped</span><br>
<span class="lineno">80</span><span class="comment" id="5173975">//&nbsp;inside&nbsp;an&nbsp;unquoted&nbsp;attribute&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="5174014">//&nbsp;The&nbsp;set&nbsp;of&nbsp;runes&nbsp;escaped&nbsp;is&nbsp;the&nbsp;union&nbsp;of&nbsp;the&nbsp;HTML&nbsp;specials&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5174080">//&nbsp;those&nbsp;determined&nbsp;by&nbsp;running&nbsp;the&nbsp;JS&nbsp;below&nbsp;in&nbsp;browsers:</span><br>
<span class="lineno"></span><span class="comment" id="5174137">//&nbsp;&lt;div&nbsp;id=d&gt;&lt;/div&gt;</span><br>
<span class="lineno"></span><span class="comment" id="5174157">//&nbsp;&lt;script&gt;(function&nbsp;()&nbsp;{</span><br>
<span class="lineno">85</span><span class="comment" id="5174183">//&nbsp;var&nbsp;a&nbsp;=&nbsp;[],&nbsp;d&nbsp;=&nbsp;document.getElementById(&#34;d&#34;),&nbsp;i,&nbsp;c,&nbsp;s;</span><br>
<span class="lineno"></span><span class="comment" id="5174241">//&nbsp;for&nbsp;(i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;0x10000;&nbsp;++i)&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="5174276">//&nbsp;&nbsp;&nbsp;c&nbsp;=&nbsp;String.fromCharCode(i);</span><br>
<span class="lineno"></span><span class="comment" id="5174309">//&nbsp;&nbsp;&nbsp;d.innerHTML&nbsp;=&nbsp;&#34;&lt;span&nbsp;title=&#34;&nbsp;+&nbsp;c&nbsp;+&nbsp;&#34;lt&#34;&nbsp;+&nbsp;c&nbsp;+&nbsp;&#34;&gt;&lt;/span&gt;&#34;</span><br>
<span class="lineno"></span><span class="comment" id="5174371">//&nbsp;&nbsp;&nbsp;s&nbsp;=&nbsp;d.getElementsByTagName(&#34;SPAN&#34;)[0];</span><br>
<span class="lineno">90</span><span class="comment" id="5174415">//&nbsp;&nbsp;&nbsp;if&nbsp;(!s&nbsp;||&nbsp;s.title&nbsp;!==&nbsp;c&nbsp;+&nbsp;&#34;lt&#34;&nbsp;+&nbsp;c)&nbsp;{&nbsp;a.push(i.toString(16));&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="5174484">//&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="5174489">//&nbsp;document.write(a.join(&#34;,&nbsp;&#34;));</span><br>
<span class="lineno"></span><span class="comment" id="5174522">//&nbsp;})()&lt;/script&gt;</span><br>
<span class="lineno"></span><span class="keyword" id="5174539">var</span>&nbsp;<span class="ident" id="5174543">htmlNospaceReplacementTable</span>&nbsp;<span class="op" id="5174571">=</span>&nbsp;<span class="op" id="5174573">[</span><span class="op" id="5174574">]</span><span class="builtintype" id="5174575">string</span><span class="op" id="5174581">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5174584">0</span><span class="op" id="5174585">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5174590">&#34;&amp;#xfffd;&#34;</span><span class="op" id="5174600">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5174603">&#39;\t&#39;</span><span class="op" id="5174607">:</span>&nbsp;<span class="string" id="5174609">&#34;&amp;#9;&#34;</span><span class="op" id="5174615">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5174618">&#39;\n&#39;</span><span class="op" id="5174622">:</span>&nbsp;<span class="string" id="5174624">&#34;&amp;#10;&#34;</span><span class="op" id="5174631">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5174634">&#39;\v&#39;</span><span class="op" id="5174638">:</span>&nbsp;<span class="string" id="5174640">&#34;&amp;#11;&#34;</span><span class="op" id="5174647">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5174650">&#39;\f&#39;</span><span class="op" id="5174654">:</span>&nbsp;<span class="string" id="5174656">&#34;&amp;#12;&#34;</span><span class="op" id="5174663">,</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5174666">&#39;\r&#39;</span><span class="op" id="5174670">:</span>&nbsp;<span class="string" id="5174672">&#34;&amp;#13;&#34;</span><span class="op" id="5174679">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5174682">&#39;&nbsp;&#39;</span><span class="op" id="5174685">:</span>&nbsp;&nbsp;<span class="string" id="5174688">&#34;&amp;#32;&#34;</span><span class="op" id="5174695">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5174698">&#39;&#34;&#39;</span><span class="op" id="5174701">:</span>&nbsp;&nbsp;<span class="string" id="5174704">&#34;&amp;#34;&#34;</span><span class="op" id="5174711">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5174714">&#39;&amp;&#39;</span><span class="op" id="5174717">:</span>&nbsp;&nbsp;<span class="string" id="5174720">&#34;&amp;amp;&#34;</span><span class="op" id="5174727">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5174730">&#39;\&#39;&#39;</span><span class="op" id="5174734">:</span>&nbsp;<span class="string" id="5174736">&#34;&amp;#39;&#34;</span><span class="op" id="5174743">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5174746">&#39;+&#39;</span><span class="op" id="5174749">:</span>&nbsp;&nbsp;<span class="string" id="5174752">&#34;&amp;#43;&#34;</span><span class="op" id="5174759">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5174762">&#39;&lt;&#39;</span><span class="op" id="5174765">:</span>&nbsp;&nbsp;<span class="string" id="5174768">&#34;&amp;lt;&#34;</span><span class="op" id="5174774">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5174777">&#39;=&#39;</span><span class="op" id="5174780">:</span>&nbsp;&nbsp;<span class="string" id="5174783">&#34;&amp;#61;&#34;</span><span class="op" id="5174790">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5174793">&#39;&gt;&#39;</span><span class="op" id="5174796">:</span>&nbsp;&nbsp;<span class="string" id="5174799">&#34;&amp;gt;&#34;</span><span class="op" id="5174805">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5174808">//&nbsp;A&nbsp;parse&nbsp;error&nbsp;in&nbsp;the&nbsp;attribute&nbsp;value&nbsp;(unquoted)&nbsp;and</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5174864">//&nbsp;before&nbsp;attribute&nbsp;value&nbsp;states.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5174899">//&nbsp;Treated&nbsp;as&nbsp;a&nbsp;quoting&nbsp;character&nbsp;by&nbsp;IE.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5174941">&#39;`&#39;</span><span class="op" id="5174944">:</span>&nbsp;<span class="string" id="5174946">&#34;&amp;#96;&#34;</span><span class="op" id="5174953">,</span><br>
<span class="lineno"></span><span class="op" id="5174955">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="comment" id="5174958">//&nbsp;htmlNospaceNormReplacementTable&nbsp;is&nbsp;like&nbsp;htmlNospaceReplacementTable&nbsp;but</span><br>
<span class="lineno"></span><span class="comment" id="5175033">//&nbsp;without&nbsp;&#39;&amp;&#39;&nbsp;to&nbsp;avoid&nbsp;over-encoding&nbsp;existing&nbsp;entities.</span><br>
<span class="lineno"></span><span class="keyword" id="5175090">var</span>&nbsp;<span class="ident" id="5175094">htmlNospaceNormReplacementTable</span>&nbsp;<span class="op" id="5175126">=</span>&nbsp;<span class="op" id="5175128">[</span><span class="op" id="5175129">]</span><span class="builtintype" id="5175130">string</span><span class="op" id="5175136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5175139">0</span><span class="op" id="5175140">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5175145">&#34;&amp;#xfffd;&#34;</span><span class="op" id="5175155">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5175158">&#39;\t&#39;</span><span class="op" id="5175162">:</span>&nbsp;<span class="string" id="5175164">&#34;&amp;#9;&#34;</span><span class="op" id="5175170">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5175173">&#39;\n&#39;</span><span class="op" id="5175177">:</span>&nbsp;<span class="string" id="5175179">&#34;&amp;#10;&#34;</span><span class="op" id="5175186">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5175189">&#39;\v&#39;</span><span class="op" id="5175193">:</span>&nbsp;<span class="string" id="5175195">&#34;&amp;#11;&#34;</span><span class="op" id="5175202">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5175205">&#39;\f&#39;</span><span class="op" id="5175209">:</span>&nbsp;<span class="string" id="5175211">&#34;&amp;#12;&#34;</span><span class="op" id="5175218">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5175221">&#39;\r&#39;</span><span class="op" id="5175225">:</span>&nbsp;<span class="string" id="5175227">&#34;&amp;#13;&#34;</span><span class="op" id="5175234">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5175237">&#39;&nbsp;&#39;</span><span class="op" id="5175240">:</span>&nbsp;&nbsp;<span class="string" id="5175243">&#34;&amp;#32;&#34;</span><span class="op" id="5175250">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5175253">&#39;&#34;&#39;</span><span class="op" id="5175256">:</span>&nbsp;&nbsp;<span class="string" id="5175259">&#34;&amp;#34;&#34;</span><span class="op" id="5175266">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5175269">&#39;\&#39;&#39;</span><span class="op" id="5175273">:</span>&nbsp;<span class="string" id="5175275">&#34;&amp;#39;&#34;</span><span class="op" id="5175282">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5175285">&#39;+&#39;</span><span class="op" id="5175288">:</span>&nbsp;&nbsp;<span class="string" id="5175291">&#34;&amp;#43;&#34;</span><span class="op" id="5175298">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5175301">&#39;&lt;&#39;</span><span class="op" id="5175304">:</span>&nbsp;&nbsp;<span class="string" id="5175307">&#34;&amp;lt;&#34;</span><span class="op" id="5175313">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5175316">&#39;=&#39;</span><span class="op" id="5175319">:</span>&nbsp;&nbsp;<span class="string" id="5175322">&#34;&amp;#61;&#34;</span><span class="op" id="5175329">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5175332">&#39;&gt;&#39;</span><span class="op" id="5175335">:</span>&nbsp;&nbsp;<span class="string" id="5175338">&#34;&amp;gt;&#34;</span><span class="op" id="5175344">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5175347">//&nbsp;A&nbsp;parse&nbsp;error&nbsp;in&nbsp;the&nbsp;attribute&nbsp;value&nbsp;(unquoted)&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5175403">//&nbsp;before&nbsp;attribute&nbsp;value&nbsp;states.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5175438">//&nbsp;Treated&nbsp;as&nbsp;a&nbsp;quoting&nbsp;character&nbsp;by&nbsp;IE.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5175480">&#39;`&#39;</span><span class="op" id="5175483">:</span>&nbsp;<span class="string" id="5175485">&#34;&amp;#96;&#34;</span><span class="op" id="5175492">,</span><br>
<span class="lineno">135</span><span class="op" id="5175494">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5175497">//&nbsp;htmlReplacer&nbsp;returns&nbsp;s&nbsp;with&nbsp;runes&nbsp;replaced&nbsp;according&nbsp;to&nbsp;replacementTable</span><br>
<span class="lineno"></span><span class="comment" id="5175573">//&nbsp;and&nbsp;when&nbsp;badRunes&nbsp;is&nbsp;true,&nbsp;certain&nbsp;bad&nbsp;runes&nbsp;are&nbsp;allowed&nbsp;through&nbsp;unescaped.</span><br>
<span class="lineno"></span><span class="keyword" id="5175652">func</span>&nbsp;<span class="ident" id="5175657">htmlReplacer</span><span class="op" id="5175669">(</span><span class="ident" id="5175670">s</span>&nbsp;<span class="builtintype" id="5175672">string</span><span class="op" id="5175678">,</span>&nbsp;<span class="ident" id="5175680">replacementTable</span>&nbsp;<span class="op" id="5175697">[</span><span class="op" id="5175698">]</span><span class="builtintype" id="5175699">string</span><span class="op" id="5175705">,</span>&nbsp;<span class="ident" id="5175707">badRunes</span>&nbsp;<span class="builtintype" id="5175716">bool</span><span class="op" id="5175720">)</span>&nbsp;<span class="builtintype" id="5175722">string</span>&nbsp;<span class="op" id="5175729">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5175732">written</span><span class="op" id="5175739">,</span>&nbsp;<span class="ident" id="5175741">b</span>&nbsp;<span class="op" id="5175743">:=</span>&nbsp;<span class="num" id="5175746">0</span><span class="op" id="5175747">,</span>&nbsp;<span class="builtinfunc" id="5175749">new</span><span class="op" id="5175752">(</span><span class="ident" id="5175753">bytes</span><span class="op" id="5175758">.</span><span class="ident" id="5175759">Buffer</span><span class="op" id="5175765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5175768">for</span>&nbsp;<span class="ident" id="5175772">i</span><span class="op" id="5175773">,</span>&nbsp;<span class="ident" id="5175775">r</span>&nbsp;<span class="op" id="5175777">:=</span>&nbsp;<span class="keyword" id="5175780">range</span>&nbsp;<span class="ident" id="5175786">s</span>&nbsp;<span class="op" id="5175788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5175792">if</span>&nbsp;<span class="builtintype" id="5175795">int</span><span class="op" id="5175798">(</span><span class="ident" id="5175799">r</span><span class="op" id="5175800">)</span>&nbsp;<span class="op" id="5175802">&lt;</span>&nbsp;<span class="builtinfunc" id="5175804">len</span><span class="op" id="5175807">(</span><span class="ident" id="5175808">replacementTable</span><span class="op" id="5175824">)</span>&nbsp;<span class="op" id="5175826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5175831">if</span>&nbsp;<span class="ident" id="5175834">repl</span>&nbsp;<span class="op" id="5175839">:=</span>&nbsp;<span class="ident" id="5175842">replacementTable</span><span class="op" id="5175858">[</span><span class="ident" id="5175859">r</span><span class="op" id="5175860">]</span><span class="op" id="5175861">;</span>&nbsp;<span class="builtinfunc" id="5175863">len</span><span class="op" id="5175866">(</span><span class="ident" id="5175867">repl</span><span class="op" id="5175871">)</span>&nbsp;<span class="op" id="5175873">!=</span>&nbsp;<span class="num" id="5175876">0</span>&nbsp;<span class="op" id="5175878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5175884">b</span><span class="op" id="5175885">.</span><span class="ident" id="5175886">WriteString</span><span class="op" id="5175897">(</span><span class="ident" id="5175898">s</span><span class="op" id="5175899">[</span><span class="ident" id="5175900">written</span><span class="op" id="5175907">:</span><span class="ident" id="5175908">i</span><span class="op" id="5175909">]</span><span class="op" id="5175910">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5175916">b</span><span class="op" id="5175917">.</span><span class="ident" id="5175918">WriteString</span><span class="op" id="5175929">(</span><span class="ident" id="5175930">repl</span><span class="op" id="5175934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5175940">//&nbsp;Valid&nbsp;as&nbsp;long&nbsp;as&nbsp;replacementTable&nbsp;doesn&#39;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5175989">//&nbsp;include&nbsp;anything&nbsp;above&nbsp;0x7f.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5176025">written</span>&nbsp;<span class="op" id="5176033">=</span>&nbsp;<span class="ident" id="5176035">i</span>&nbsp;<span class="op" id="5176037">+</span>&nbsp;<span class="ident" id="5176039">utf8</span><span class="op" id="5176043">.</span><span class="ident" id="5176044">RuneLen</span><span class="op" id="5176051">(</span><span class="ident" id="5176052">r</span><span class="op" id="5176053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5176058">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5176062">}</span>&nbsp;<span class="keyword" id="5176064">else</span>&nbsp;<span class="keyword" id="5176069">if</span>&nbsp;<span class="ident" id="5176072">badRunes</span>&nbsp;<span class="op" id="5176081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5176086">//&nbsp;No-op.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5176099">//&nbsp;IE&nbsp;does&nbsp;not&nbsp;allow&nbsp;these&nbsp;ranges&nbsp;in&nbsp;unquoted&nbsp;attrs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5176154">}</span>&nbsp;<span class="keyword" id="5176156">else</span>&nbsp;<span class="keyword" id="5176161">if</span>&nbsp;<span class="num" id="5176164">0xfdd0</span>&nbsp;<span class="op" id="5176171">&lt;=</span>&nbsp;<span class="ident" id="5176174">r</span>&nbsp;<span class="op" id="5176176">&amp;&amp;</span>&nbsp;<span class="ident" id="5176179">r</span>&nbsp;<span class="op" id="5176181">&lt;=</span>&nbsp;<span class="num" id="5176184">0xfdef</span>&nbsp;<span class="op" id="5176191">||</span>&nbsp;<span class="num" id="5176194">0xfff0</span>&nbsp;<span class="op" id="5176201">&lt;=</span>&nbsp;<span class="ident" id="5176204">r</span>&nbsp;<span class="op" id="5176206">&amp;&amp;</span>&nbsp;<span class="ident" id="5176209">r</span>&nbsp;<span class="op" id="5176211">&lt;=</span>&nbsp;<span class="num" id="5176214">0xffff</span>&nbsp;<span class="op" id="5176221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5176226">fmt</span><span class="op" id="5176229">.</span><span class="ident" id="5176230">Fprintf</span><span class="op" id="5176237">(</span><span class="ident" id="5176238">b</span><span class="op" id="5176239">,</span>&nbsp;<span class="string" id="5176241">&#34;%s&amp;#x%x;&#34;</span><span class="op" id="5176251">,</span>&nbsp;<span class="ident" id="5176253">s</span><span class="op" id="5176254">[</span><span class="ident" id="5176255">written</span><span class="op" id="5176262">:</span><span class="ident" id="5176263">i</span><span class="op" id="5176264">]</span><span class="op" id="5176265">,</span>&nbsp;<span class="ident" id="5176267">r</span><span class="op" id="5176268">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5176273">written</span>&nbsp;<span class="op" id="5176281">=</span>&nbsp;<span class="ident" id="5176283">i</span>&nbsp;<span class="op" id="5176285">+</span>&nbsp;<span class="ident" id="5176287">utf8</span><span class="op" id="5176291">.</span><span class="ident" id="5176292">RuneLen</span><span class="op" id="5176299">(</span><span class="ident" id="5176300">r</span><span class="op" id="5176301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5176305">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5176308">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5176311">if</span>&nbsp;<span class="ident" id="5176314">written</span>&nbsp;<span class="op" id="5176322">==</span>&nbsp;<span class="num" id="5176325">0</span>&nbsp;<span class="op" id="5176327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5176331">return</span>&nbsp;<span class="ident" id="5176338">s</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5176341">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5176344">b</span><span class="op" id="5176345">.</span><span class="ident" id="5176346">WriteString</span><span class="op" id="5176357">(</span><span class="ident" id="5176358">s</span><span class="op" id="5176359">[</span><span class="ident" id="5176360">written</span><span class="op" id="5176367">:</span><span class="op" id="5176368">]</span><span class="op" id="5176369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5176372">return</span>&nbsp;<span class="ident" id="5176379">b</span><span class="op" id="5176380">.</span><span class="ident" id="5176381">String</span><span class="op" id="5176387">(</span><span class="op" id="5176388">)</span><br>
<span class="lineno"></span><span class="op" id="5176390">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="comment" id="5176393">//&nbsp;stripTags&nbsp;takes&nbsp;a&nbsp;snippet&nbsp;of&nbsp;HTML&nbsp;and&nbsp;returns&nbsp;only&nbsp;the&nbsp;text&nbsp;content.</span><br>
<span class="lineno"></span><span class="comment" id="5176465">//&nbsp;For&nbsp;example,&nbsp;`&lt;b&gt;&amp;iexcl;Hi!&lt;/b&gt;&nbsp;&lt;script&gt;...&lt;/script&gt;`&nbsp;-&gt;&nbsp;`&amp;iexcl;Hi!&nbsp;`.</span><br>
<span class="lineno"></span><span class="keyword" id="5176540">func</span>&nbsp;<span class="ident" id="5176545">stripTags</span><span class="op" id="5176554">(</span><span class="ident" id="5176555">html</span>&nbsp;<span class="builtintype" id="5176560">string</span><span class="op" id="5176566">)</span>&nbsp;<span class="builtintype" id="5176568">string</span>&nbsp;<span class="op" id="5176575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5176578">var</span>&nbsp;<span class="ident" id="5176582">b</span>&nbsp;<span class="ident" id="5176584">bytes</span><span class="op" id="5176589">.</span><span class="ident" id="5176590">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5176598">s</span><span class="op" id="5176599">,</span>&nbsp;<span class="ident" id="5176601">c</span><span class="op" id="5176602">,</span>&nbsp;<span class="ident" id="5176604">i</span><span class="op" id="5176605">,</span>&nbsp;<span class="ident" id="5176607">allText</span>&nbsp;<span class="op" id="5176615">:=</span>&nbsp;<span class="op" id="5176618">[</span><span class="op" id="5176619">]</span><span class="builtintype" id="5176620">byte</span><span class="op" id="5176624">(</span><span class="ident" id="5176625">html</span><span class="op" id="5176629">)</span><span class="op" id="5176630">,</span>&nbsp;<span class="ident" id="5176632">context</span><span class="op" id="5176639">{</span><span class="op" id="5176640">}</span><span class="op" id="5176641">,</span>&nbsp;<span class="num" id="5176643">0</span><span class="op" id="5176644">,</span>&nbsp;<span class="builtintype" id="5176646">true</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5176652">//&nbsp;Using&nbsp;the&nbsp;transition&nbsp;funcs&nbsp;helps&nbsp;us&nbsp;avoid&nbsp;mangling</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5176707">//&nbsp;`&lt;div&nbsp;title=&#34;1&gt;2&#34;&gt;`&nbsp;or&nbsp;`I&nbsp;&lt;3&nbsp;Ponies!`.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5176750">for</span>&nbsp;<span class="ident" id="5176754">i</span>&nbsp;<span class="op" id="5176756">!=</span>&nbsp;<span class="builtinfunc" id="5176759">len</span><span class="op" id="5176762">(</span><span class="ident" id="5176763">s</span><span class="op" id="5176764">)</span>&nbsp;<span class="op" id="5176766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5176770">if</span>&nbsp;<span class="ident" id="5176773">c</span><span class="op" id="5176774">.</span><span class="ident" id="5176775">delim</span>&nbsp;<span class="op" id="5176781">==</span>&nbsp;<span class="ident" id="5176784">delimNone</span>&nbsp;<span class="op" id="5176794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5176799">st</span>&nbsp;<span class="op" id="5176802">:=</span>&nbsp;<span class="ident" id="5176805">c</span><span class="op" id="5176806">.</span><span class="ident" id="5176807">state</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5176816">//&nbsp;Use&nbsp;RCDATA&nbsp;instead&nbsp;of&nbsp;parsing&nbsp;into&nbsp;JS&nbsp;or&nbsp;CSS&nbsp;styles.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5176875">if</span>&nbsp;<span class="ident" id="5176878">c</span><span class="op" id="5176879">.</span><span class="ident" id="5176880">element</span>&nbsp;<span class="op" id="5176888">!=</span>&nbsp;<span class="ident" id="5176891">elementNone</span>&nbsp;<span class="op" id="5176903">&amp;&amp;</span>&nbsp;<span class="op" id="5176906">!</span><span class="ident" id="5176907">isInTag</span><span class="op" id="5176914">(</span><span class="ident" id="5176915">st</span><span class="op" id="5176917">)</span>&nbsp;<span class="op" id="5176919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5176925">st</span>&nbsp;<span class="op" id="5176928">=</span>&nbsp;<span class="ident" id="5176930">stateRCDATA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5176945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5176950">d</span><span class="op" id="5176951">,</span>&nbsp;<span class="ident" id="5176953">nread</span>&nbsp;<span class="op" id="5176959">:=</span>&nbsp;<span class="ident" id="5176962">transitionFunc</span><span class="op" id="5176976">[</span><span class="ident" id="5176977">st</span><span class="op" id="5176979">]</span><span class="op" id="5176980">(</span><span class="ident" id="5176981">c</span><span class="op" id="5176982">,</span>&nbsp;<span class="ident" id="5176984">s</span><span class="op" id="5176985">[</span><span class="ident" id="5176986">i</span><span class="op" id="5176987">:</span><span class="op" id="5176988">]</span><span class="op" id="5176989">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5176994">i1</span>&nbsp;<span class="op" id="5176997">:=</span>&nbsp;<span class="ident" id="5177000">i</span>&nbsp;<span class="op" id="5177002">+</span>&nbsp;<span class="ident" id="5177004">nread</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5177013">if</span>&nbsp;<span class="ident" id="5177016">c</span><span class="op" id="5177017">.</span><span class="ident" id="5177018">state</span>&nbsp;<span class="op" id="5177024">==</span>&nbsp;<span class="ident" id="5177027">stateText</span>&nbsp;<span class="op" id="5177037">||</span>&nbsp;<span class="ident" id="5177040">c</span><span class="op" id="5177041">.</span><span class="ident" id="5177042">state</span>&nbsp;<span class="op" id="5177048">==</span>&nbsp;<span class="ident" id="5177051">stateRCDATA</span>&nbsp;<span class="op" id="5177063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5177069">//&nbsp;Emit&nbsp;text&nbsp;up&nbsp;to&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;tag&nbsp;or&nbsp;comment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5177125">j</span>&nbsp;<span class="op" id="5177127">:=</span>&nbsp;<span class="ident" id="5177130">i1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5177137">if</span>&nbsp;<span class="ident" id="5177140">d</span><span class="op" id="5177141">.</span><span class="ident" id="5177142">state</span>&nbsp;<span class="op" id="5177148">!=</span>&nbsp;<span class="ident" id="5177151">c</span><span class="op" id="5177152">.</span><span class="ident" id="5177153">state</span>&nbsp;<span class="op" id="5177159">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5177166">for</span>&nbsp;<span class="ident" id="5177170">j1</span>&nbsp;<span class="op" id="5177173">:=</span>&nbsp;<span class="ident" id="5177176">j</span>&nbsp;<span class="op" id="5177178">-</span>&nbsp;<span class="num" id="5177180">1</span><span class="op" id="5177181">;</span>&nbsp;<span class="ident" id="5177183">j1</span>&nbsp;<span class="op" id="5177186">&gt;=</span>&nbsp;<span class="ident" id="5177189">i</span><span class="op" id="5177190">;</span>&nbsp;<span class="ident" id="5177192">j1</span><span class="op" id="5177194">--</span>&nbsp;<span class="op" id="5177197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5177205">if</span>&nbsp;<span class="ident" id="5177208">s</span><span class="op" id="5177209">[</span><span class="ident" id="5177210">j1</span><span class="op" id="5177212">]</span>&nbsp;<span class="op" id="5177214">==</span>&nbsp;<span class="string" id="5177217">&#39;&lt;&#39;</span>&nbsp;<span class="op" id="5177221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5177230">j</span>&nbsp;<span class="op" id="5177232">=</span>&nbsp;<span class="ident" id="5177234">j1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5177244">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5177256">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5177263">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5177269">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5177275">b</span><span class="op" id="5177276">.</span><span class="ident" id="5177277">Write</span><span class="op" id="5177282">(</span><span class="ident" id="5177283">s</span><span class="op" id="5177284">[</span><span class="ident" id="5177285">i</span><span class="op" id="5177286">:</span><span class="ident" id="5177287">j</span><span class="op" id="5177288">]</span><span class="op" id="5177289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5177294">}</span>&nbsp;<span class="keyword" id="5177296">else</span>&nbsp;<span class="op" id="5177301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5177307">allText</span>&nbsp;<span class="op" id="5177315">=</span>&nbsp;<span class="builtintype" id="5177317">false</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5177326">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5177331">c</span><span class="op" id="5177332">,</span>&nbsp;<span class="ident" id="5177334">i</span>&nbsp;<span class="op" id="5177336">=</span>&nbsp;<span class="ident" id="5177338">d</span><span class="op" id="5177339">,</span>&nbsp;<span class="ident" id="5177341">i1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5177347">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5177358">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5177362">i1</span>&nbsp;<span class="op" id="5177365">:=</span>&nbsp;<span class="ident" id="5177368">i</span>&nbsp;<span class="op" id="5177370">+</span>&nbsp;<span class="ident" id="5177372">bytes</span><span class="op" id="5177377">.</span><span class="ident" id="5177378">IndexAny</span><span class="op" id="5177386">(</span><span class="ident" id="5177387">s</span><span class="op" id="5177388">[</span><span class="ident" id="5177389">i</span><span class="op" id="5177390">:</span><span class="op" id="5177391">]</span><span class="op" id="5177392">,</span>&nbsp;<span class="ident" id="5177394">delimEnds</span><span class="op" id="5177403">[</span><span class="ident" id="5177404">c</span><span class="op" id="5177405">.</span><span class="ident" id="5177406">delim</span><span class="op" id="5177411">]</span><span class="op" id="5177412">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5177416">if</span>&nbsp;<span class="ident" id="5177419">i1</span>&nbsp;<span class="op" id="5177422">&lt;</span>&nbsp;<span class="ident" id="5177424">i</span>&nbsp;<span class="op" id="5177426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5177431">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5177439">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5177443">if</span>&nbsp;<span class="ident" id="5177446">c</span><span class="op" id="5177447">.</span><span class="ident" id="5177448">delim</span>&nbsp;<span class="op" id="5177454">!=</span>&nbsp;<span class="ident" id="5177457">delimSpaceOrTagEnd</span>&nbsp;<span class="op" id="5177476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5177481">//&nbsp;Consume&nbsp;any&nbsp;quote.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5177506">i1</span><span class="op" id="5177508">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5177513">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5177517">c</span><span class="op" id="5177518">,</span>&nbsp;<span class="ident" id="5177520">i</span>&nbsp;<span class="op" id="5177522">=</span>&nbsp;<span class="ident" id="5177524">context</span><span class="op" id="5177531">{</span><span class="ident" id="5177532">state</span><span class="op" id="5177537">:</span>&nbsp;<span class="ident" id="5177539">stateTag</span><span class="op" id="5177547">,</span>&nbsp;<span class="ident" id="5177549">element</span><span class="op" id="5177556">:</span>&nbsp;<span class="ident" id="5177558">c</span><span class="op" id="5177559">.</span><span class="ident" id="5177560">element</span><span class="op" id="5177567">}</span><span class="op" id="5177568">,</span>&nbsp;<span class="ident" id="5177570">i1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5177574">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5177577">if</span>&nbsp;<span class="ident" id="5177580">allText</span>&nbsp;<span class="op" id="5177588">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5177592">return</span>&nbsp;<span class="ident" id="5177599">html</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5177605">}</span>&nbsp;<span class="keyword" id="5177607">else</span>&nbsp;<span class="keyword" id="5177612">if</span>&nbsp;<span class="ident" id="5177615">c</span><span class="op" id="5177616">.</span><span class="ident" id="5177617">state</span>&nbsp;<span class="op" id="5177623">==</span>&nbsp;<span class="ident" id="5177626">stateText</span>&nbsp;<span class="op" id="5177636">||</span>&nbsp;<span class="ident" id="5177639">c</span><span class="op" id="5177640">.</span><span class="ident" id="5177641">state</span>&nbsp;<span class="op" id="5177647">==</span>&nbsp;<span class="ident" id="5177650">stateRCDATA</span>&nbsp;<span class="op" id="5177662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5177666">b</span><span class="op" id="5177667">.</span><span class="ident" id="5177668">Write</span><span class="op" id="5177673">(</span><span class="ident" id="5177674">s</span><span class="op" id="5177675">[</span><span class="ident" id="5177676">i</span><span class="op" id="5177677">:</span><span class="op" id="5177678">]</span><span class="op" id="5177679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5177682">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5177685">return</span>&nbsp;<span class="ident" id="5177692">b</span><span class="op" id="5177693">.</span><span class="ident" id="5177694">String</span><span class="op" id="5177700">(</span><span class="op" id="5177701">)</span><br>
<span class="lineno">215</span><span class="op" id="5177703">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5177706">//&nbsp;htmlNameFilter&nbsp;accepts&nbsp;valid&nbsp;parts&nbsp;of&nbsp;an&nbsp;HTML&nbsp;attribute&nbsp;or&nbsp;tag&nbsp;name&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="5177780">//&nbsp;a&nbsp;known-safe&nbsp;HTML&nbsp;attribute.</span><br>
<span class="lineno"></span><span class="keyword" id="5177812">func</span>&nbsp;<span class="ident" id="5177817">htmlNameFilter</span><span class="op" id="5177831">(</span><span class="ident" id="5177832">args</span>&nbsp;<span class="op" id="5177837">...</span><span class="keyword" id="5177840">interface</span><span class="op" id="5177849">{</span><span class="op" id="5177850">}</span><span class="op" id="5177851">)</span>&nbsp;<span class="builtintype" id="5177853">string</span>&nbsp;<span class="op" id="5177860">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5177863">s</span><span class="op" id="5177864">,</span>&nbsp;<span class="ident" id="5177866">t</span>&nbsp;<span class="op" id="5177868">:=</span>&nbsp;<span class="ident" id="5177871">stringify</span><span class="op" id="5177880">(</span><span class="ident" id="5177881">args</span><span class="op" id="5177885">...</span><span class="op" id="5177888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5177891">if</span>&nbsp;<span class="ident" id="5177894">t</span>&nbsp;<span class="op" id="5177896">==</span>&nbsp;<span class="ident" id="5177899">contentTypeHTMLAttr</span>&nbsp;<span class="op" id="5177919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5177923">return</span>&nbsp;<span class="ident" id="5177930">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5177933">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5177936">if</span>&nbsp;<span class="builtinfunc" id="5177939">len</span><span class="op" id="5177942">(</span><span class="ident" id="5177943">s</span><span class="op" id="5177944">)</span>&nbsp;<span class="op" id="5177946">==</span>&nbsp;<span class="num" id="5177949">0</span>&nbsp;<span class="op" id="5177951">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5177955">//&nbsp;Avoid&nbsp;violation&nbsp;of&nbsp;structure&nbsp;preservation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5178003">//&nbsp;&lt;input&nbsp;checked&nbsp;{{.K}}={{.V}}&gt;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5178039">//&nbsp;Without&nbsp;this,&nbsp;if&nbsp;.K&nbsp;is&nbsp;empty&nbsp;then&nbsp;.V&nbsp;is&nbsp;the&nbsp;value&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5178097">//&nbsp;checked,&nbsp;but&nbsp;otherwise&nbsp;.V&nbsp;is&nbsp;the&nbsp;value&nbsp;of&nbsp;the&nbsp;attribute</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5178158">//&nbsp;named&nbsp;.K.</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5178173">return</span>&nbsp;<span class="ident" id="5178180">filterFailsafe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5178196">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5178199">s</span>&nbsp;<span class="op" id="5178201">=</span>&nbsp;<span class="ident" id="5178203">strings</span><span class="op" id="5178210">.</span><span class="ident" id="5178211">ToLower</span><span class="op" id="5178218">(</span><span class="ident" id="5178219">s</span><span class="op" id="5178220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5178223">if</span>&nbsp;<span class="ident" id="5178226">t</span>&nbsp;<span class="op" id="5178228">:=</span>&nbsp;<span class="ident" id="5178231">attrType</span><span class="op" id="5178239">(</span><span class="ident" id="5178240">s</span><span class="op" id="5178241">)</span><span class="op" id="5178242">;</span>&nbsp;<span class="ident" id="5178244">t</span>&nbsp;<span class="op" id="5178246">!=</span>&nbsp;<span class="ident" id="5178249">contentTypePlain</span>&nbsp;<span class="op" id="5178266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5178270">//&nbsp;TODO:&nbsp;Split&nbsp;attr&nbsp;and&nbsp;element&nbsp;name&nbsp;part&nbsp;filters&nbsp;so&nbsp;we&nbsp;can&nbsp;whitelist</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5178342">//&nbsp;attributes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5178359">return</span>&nbsp;<span class="ident" id="5178366">filterFailsafe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5178382">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5178385">for</span>&nbsp;<span class="ident" id="5178389">_</span><span class="op" id="5178390">,</span>&nbsp;<span class="ident" id="5178392">r</span>&nbsp;<span class="op" id="5178394">:=</span>&nbsp;<span class="keyword" id="5178397">range</span>&nbsp;<span class="ident" id="5178403">s</span>&nbsp;<span class="op" id="5178405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5178409">switch</span>&nbsp;<span class="op" id="5178416">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5178420">case</span>&nbsp;<span class="string" id="5178425">&#39;0&#39;</span>&nbsp;<span class="op" id="5178429">&lt;=</span>&nbsp;<span class="ident" id="5178432">r</span>&nbsp;<span class="op" id="5178434">&amp;&amp;</span>&nbsp;<span class="ident" id="5178437">r</span>&nbsp;<span class="op" id="5178439">&lt;=</span>&nbsp;<span class="string" id="5178442">&#39;9&#39;</span><span class="op" id="5178445">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5178449">case</span>&nbsp;<span class="string" id="5178454">&#39;a&#39;</span>&nbsp;<span class="op" id="5178458">&lt;=</span>&nbsp;<span class="ident" id="5178461">r</span>&nbsp;<span class="op" id="5178463">&amp;&amp;</span>&nbsp;<span class="ident" id="5178466">r</span>&nbsp;<span class="op" id="5178468">&lt;=</span>&nbsp;<span class="string" id="5178471">&#39;z&#39;</span><span class="op" id="5178474">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5178478">default</span><span class="op" id="5178485">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5178490">return</span>&nbsp;<span class="ident" id="5178497">filterFailsafe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5178514">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5178517">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5178520">return</span>&nbsp;<span class="ident" id="5178527">s</span><br>
<span class="lineno"></span><span class="op" id="5178529">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5178532">//&nbsp;commentEscaper&nbsp;returns&nbsp;the&nbsp;empty&nbsp;string&nbsp;regardless&nbsp;of&nbsp;input.</span><br>
<span class="lineno">250</span><span class="comment" id="5178596">//&nbsp;Comment&nbsp;content&nbsp;does&nbsp;not&nbsp;correspond&nbsp;to&nbsp;any&nbsp;parsed&nbsp;structure&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="5178662">//&nbsp;human-readable&nbsp;content,&nbsp;so&nbsp;the&nbsp;simplest&nbsp;and&nbsp;most&nbsp;secure&nbsp;policy&nbsp;is&nbsp;to&nbsp;drop</span><br>
<span class="lineno"></span><span class="comment" id="5178739">//&nbsp;content&nbsp;interpolated&nbsp;into&nbsp;comments.</span><br>
<span class="lineno"></span><span class="comment" id="5178778">//&nbsp;This&nbsp;approach&nbsp;is&nbsp;equally&nbsp;valid&nbsp;whether&nbsp;or&nbsp;not&nbsp;static&nbsp;comment&nbsp;content&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="5178853">//&nbsp;removed&nbsp;from&nbsp;the&nbsp;template.</span><br>
<span class="lineno">255</span><span class="keyword" id="5178883">func</span>&nbsp;<span class="ident" id="5178888">commentEscaper</span><span class="op" id="5178902">(</span><span class="ident" id="5178903">args</span>&nbsp;<span class="op" id="5178908">...</span><span class="keyword" id="5178911">interface</span><span class="op" id="5178920">{</span><span class="op" id="5178921">}</span><span class="op" id="5178922">)</span>&nbsp;<span class="builtintype" id="5178924">string</span>&nbsp;<span class="op" id="5178931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5178934">return</span>&nbsp;<span class="string" id="5178941">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="5178944">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
