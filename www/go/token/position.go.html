<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5171645">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5171700">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5171754">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5171805">package</span>&nbsp;<span class="ident" id="5171813">token</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5171820">import</span>&nbsp;<span class="op" id="5171827">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5171830">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5171837">&#34;sort&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5171845">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="5171852">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5171855">//&nbsp;-----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5171936">//&nbsp;Positions</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="5171950">//&nbsp;Position&nbsp;describes&nbsp;an&nbsp;arbitrary&nbsp;source&nbsp;position</span><br>
<span class="lineno"></span><span class="comment" id="5172001">//&nbsp;including&nbsp;the&nbsp;file,&nbsp;line,&nbsp;and&nbsp;column&nbsp;location.</span><br>
<span class="lineno"></span><span class="comment" id="5172051">//&nbsp;A&nbsp;Position&nbsp;is&nbsp;valid&nbsp;if&nbsp;the&nbsp;line&nbsp;number&nbsp;is&nbsp;&gt;&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="5172101">//</span><br>
<span class="lineno">20</span><span class="keyword" id="5172104">type</span>&nbsp;<span class="ident" id="5172109">Position</span>&nbsp;<span class="keyword" id="5172118">struct</span>&nbsp;<span class="op" id="5172125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5172128">Filename</span>&nbsp;<span class="builtintype" id="5172137">string</span>&nbsp;<span class="comment" id="5172144">//&nbsp;filename,&nbsp;if&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5172165">Offset</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5172174">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5172181">//&nbsp;offset,&nbsp;starting&nbsp;at&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5172207">Line</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5172216">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5172223">//&nbsp;line&nbsp;number,&nbsp;starting&nbsp;at&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5172254">Column</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5172263">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5172270">//&nbsp;column&nbsp;number,&nbsp;starting&nbsp;at&nbsp;1&nbsp;(character&nbsp;count)</span><br>
<span class="lineno">25</span><span class="op" id="5172320">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5172323">//&nbsp;IsValid&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;position&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="keyword" id="5172373">func</span>&nbsp;<span class="op" id="5172378">(</span><span class="ident" id="5172379">pos</span>&nbsp;<span class="op" id="5172383">*</span><span class="ident" id="5172384"><a href="/go/token/position.go.html#5172109">Position</a></span><span class="op" id="5172392">)</span>&nbsp;<span class="ident" id="5172394">IsValid</span><span class="op" id="5172401">(</span><span class="op" id="5172402">)</span>&nbsp;<span class="builtintype" id="5172404">bool</span>&nbsp;<span class="op" id="5172409">{</span>&nbsp;<span class="keyword" id="5172411">return</span>&nbsp;<span class="ident" id="5172418"><a href="/go/token/position.go.html#5172379">pos</a></span><span class="op" id="5172421">.</span><span class="ident" id="5172422">Line</span>&nbsp;<span class="op" id="5172427">&gt;</span>&nbsp;<span class="num" id="5172429">0</span>&nbsp;<span class="op" id="5172431">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="5172434">//&nbsp;String&nbsp;returns&nbsp;a&nbsp;string&nbsp;in&nbsp;one&nbsp;of&nbsp;several&nbsp;forms:</span><br>
<span class="lineno"></span><span class="comment" id="5172486">//</span><br>
<span class="lineno"></span><span class="comment" id="5172489">//&nbsp;&nbsp;&nbsp;&nbspfile:line:column&nbsp;&nbsp;&nbsp;&nbsp;valid&nbsp;position&nbsp;with&nbsp;file&nbsp;name</span><br>
<span class="lineno"></span><span class="comment" id="5172542">//&nbsp;&nbsp;&nbsp;&nbspline:column&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;valid&nbsp;position&nbsp;without&nbsp;file&nbsp;name</span><br>
<span class="lineno"></span><span class="comment" id="5172598">//&nbsp;&nbsp;&nbsp;&nbspfile&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;invalid&nbsp;position&nbsp;with&nbsp;file&nbsp;name</span><br>
<span class="lineno">35</span><span class="comment" id="5172653">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;invalid&nbsp;position&nbsp;without&nbsp;file&nbsp;name</span><br>
<span class="lineno"></span><span class="comment" id="5172711">//</span><br>
<span class="lineno"></span><span class="keyword" id="5172714">func</span>&nbsp;<span class="op" id="5172719">(</span><span class="ident" id="5172720">pos</span>&nbsp;<span class="ident" id="5172724"><a href="/go/token/position.go.html#5172109">Position</a></span><span class="op" id="5172732">)</span>&nbsp;<span class="ident" id="5172734">String</span><span class="op" id="5172740">(</span><span class="op" id="5172741">)</span>&nbsp;<span class="builtintype" id="5172743">string</span>&nbsp;<span class="op" id="5172750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5172753">s</span>&nbsp;<span class="op" id="5172755">:=</span>&nbsp;<span class="ident" id="5172758"><a href="/go/token/position.go.html#5172720">pos</a></span><span class="op" id="5172761">.</span><span class="ident" id="5172762">Filename</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5172772">if</span>&nbsp;<span class="ident" id="5172775"><a href="/go/token/position.go.html#5172720">pos</a></span><span class="op" id="5172778">.</span><span class="ident" id="5172779">IsValid</span><span class="op" id="5172786">(</span><span class="op" id="5172787">)</span>&nbsp;<span class="op" id="5172789">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5172793">if</span>&nbsp;<span class="ident" id="5172796"><a href="/go/token/position.go.html#5172753">s</a></span>&nbsp;<span class="op" id="5172798">!=</span>&nbsp;<span class="string" id="5172801">&#34;&#34;</span>&nbsp;<span class="op" id="5172804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5172809"><a href="/go/token/position.go.html#5172753">s</a></span>&nbsp;<span class="op" id="5172811">+=</span>&nbsp;<span class="string" id="5172814">&#34;:&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5172820">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5172824"><a href="/go/token/position.go.html#5172753">s</a></span>&nbsp;<span class="op" id="5172826">+=</span>&nbsp;<span class="ident" id="5172829"><a href="/go/token/position.go.html#5171830">fmt</a></span><span class="op" id="5172832">.</span><span class="ident" id="5172833">Sprintf</span><span class="op" id="5172840">(</span><span class="string" id="5172841">&#34;%d:%d&#34;</span><span class="op" id="5172848">,</span>&nbsp;<span class="ident" id="5172850"><a href="/go/token/position.go.html#5172720">pos</a></span><span class="op" id="5172853">.</span><span class="ident" id="5172854">Line</span><span class="op" id="5172858">,</span>&nbsp;<span class="ident" id="5172860"><a href="/go/token/position.go.html#5172720">pos</a></span><span class="op" id="5172863">.</span><span class="ident" id="5172864">Column</span><span class="op" id="5172870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5172873">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5172876">if</span>&nbsp;<span class="ident" id="5172879"><a href="/go/token/position.go.html#5172753">s</a></span>&nbsp;<span class="op" id="5172881">==</span>&nbsp;<span class="string" id="5172884">&#34;&#34;</span>&nbsp;<span class="op" id="5172887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5172891"><a href="/go/token/position.go.html#5172753">s</a></span>&nbsp;<span class="op" id="5172893">=</span>&nbsp;<span class="string" id="5172895">&#34;-&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5172900">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5172903">return</span>&nbsp;<span class="ident" id="5172910"><a href="/go/token/position.go.html#5172753">s</a></span><br>
<span class="lineno"></span><span class="op" id="5172912">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="comment" id="5172915">//&nbsp;Pos&nbsp;is&nbsp;a&nbsp;compact&nbsp;encoding&nbsp;of&nbsp;a&nbsp;source&nbsp;position&nbsp;within&nbsp;a&nbsp;file&nbsp;set.</span><br>
<span class="lineno"></span><span class="comment" id="5172984">//&nbsp;It&nbsp;can&nbsp;be&nbsp;converted&nbsp;into&nbsp;a&nbsp;Position&nbsp;for&nbsp;a&nbsp;more&nbsp;convenient,&nbsp;but&nbsp;much</span><br>
<span class="lineno"></span><span class="comment" id="5173055">//&nbsp;larger,&nbsp;representation.</span><br>
<span class="lineno"></span><span class="comment" id="5173082">//</span><br>
<span class="lineno">55</span><span class="comment" id="5173085">//&nbsp;The&nbsp;Pos&nbsp;value&nbsp;for&nbsp;a&nbsp;given&nbsp;file&nbsp;is&nbsp;a&nbsp;number&nbsp;in&nbsp;the&nbsp;range&nbsp;[base,&nbsp;base+size],</span><br>
<span class="lineno"></span><span class="comment" id="5173163">//&nbsp;where&nbsp;base&nbsp;and&nbsp;size&nbsp;are&nbsp;specified&nbsp;when&nbsp;adding&nbsp;the&nbsp;file&nbsp;to&nbsp;the&nbsp;file&nbsp;set&nbsp;via</span><br>
<span class="lineno"></span><span class="comment" id="5173241">//&nbsp;AddFile.</span><br>
<span class="lineno"></span><span class="comment" id="5173253">//</span><br>
<span class="lineno"></span><span class="comment" id="5173256">//&nbsp;To&nbsp;create&nbsp;the&nbsp;Pos&nbsp;value&nbsp;for&nbsp;a&nbsp;specific&nbsp;source&nbsp;offset,&nbsp;first&nbsp;add</span><br>
<span class="lineno">60</span><span class="comment" id="5173323">//&nbsp;the&nbsp;respective&nbsp;file&nbsp;to&nbsp;the&nbsp;current&nbsp;file&nbsp;set&nbsp;(via&nbsp;FileSet.AddFile)</span><br>
<span class="lineno"></span><span class="comment" id="5173392">//&nbsp;and&nbsp;then&nbsp;call&nbsp;File.Pos(offset)&nbsp;for&nbsp;that&nbsp;file.&nbsp;Given&nbsp;a&nbsp;Pos&nbsp;value&nbsp;p</span><br>
<span class="lineno"></span><span class="comment" id="5173461">//&nbsp;for&nbsp;a&nbsp;specific&nbsp;file&nbsp;set&nbsp;fset,&nbsp;the&nbsp;corresponding&nbsp;Position&nbsp;value&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="5173530">//&nbsp;obtained&nbsp;by&nbsp;calling&nbsp;fset.Position(p).</span><br>
<span class="lineno"></span><span class="comment" id="5173571">//</span><br>
<span class="lineno">65</span><span class="comment" id="5173574">//&nbsp;Pos&nbsp;values&nbsp;can&nbsp;be&nbsp;compared&nbsp;directly&nbsp;with&nbsp;the&nbsp;usual&nbsp;comparison&nbsp;operators:</span><br>
<span class="lineno"></span><span class="comment" id="5173650">//&nbsp;If&nbsp;two&nbsp;Pos&nbsp;values&nbsp;p&nbsp;and&nbsp;q&nbsp;are&nbsp;in&nbsp;the&nbsp;same&nbsp;file,&nbsp;comparing&nbsp;p&nbsp;and&nbsp;q&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="5173722">//&nbsp;equivalent&nbsp;to&nbsp;comparing&nbsp;the&nbsp;respective&nbsp;source&nbsp;file&nbsp;offsets.&nbsp;If&nbsp;p&nbsp;and&nbsp;q</span><br>
<span class="lineno"></span><span class="comment" id="5173796">//&nbsp;are&nbsp;in&nbsp;different&nbsp;files,&nbsp;p&nbsp;&lt;&nbsp;q&nbsp;is&nbsp;true&nbsp;if&nbsp;the&nbsp;file&nbsp;implied&nbsp;by&nbsp;p&nbsp;was&nbsp;added</span><br>
<span class="lineno"></span><span class="comment" id="5173872">//&nbsp;to&nbsp;the&nbsp;respective&nbsp;file&nbsp;set&nbsp;before&nbsp;the&nbsp;file&nbsp;implied&nbsp;by&nbsp;q.</span><br>
<span class="lineno">70</span><span class="comment" id="5173932">//</span><br>
<span class="lineno"></span><span class="keyword" id="5173935">type</span>&nbsp;<span class="ident" id="5173940">Pos</span>&nbsp;<span class="builtintype" id="5173944">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5173949">//&nbsp;The&nbsp;zero&nbsp;value&nbsp;for&nbsp;Pos&nbsp;is&nbsp;NoPos;&nbsp;there&nbsp;is&nbsp;no&nbsp;file&nbsp;and&nbsp;line&nbsp;information</span><br>
<span class="lineno"></span><span class="comment" id="5174023">//&nbsp;associated&nbsp;with&nbsp;it,&nbsp;and&nbsp;NoPos().IsValid()&nbsp;is&nbsp;false.&nbsp;NoPos&nbsp;is&nbsp;always</span><br>
<span class="lineno">75</span><span class="comment" id="5174094">//&nbsp;smaller&nbsp;than&nbsp;any&nbsp;other&nbsp;Pos&nbsp;value.&nbsp;The&nbsp;corresponding&nbsp;Position&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="5174164">//&nbsp;for&nbsp;NoPos&nbsp;is&nbsp;the&nbsp;zero&nbsp;value&nbsp;for&nbsp;Position.</span><br>
<span class="lineno"></span><span class="comment" id="5174209">//</span><br>
<span class="lineno"></span><span class="keyword" id="5174212">const</span>&nbsp;<span class="ident" id="5174218">NoPos</span>&nbsp;<span class="ident" id="5174224"><a href="/go/token/position.go.html#5173940">Pos</a></span>&nbsp;<span class="op" id="5174228">=</span>&nbsp;<span class="num" id="5174230">0</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="5174233">//&nbsp;IsValid&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;position&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="keyword" id="5174283">func</span>&nbsp;<span class="op" id="5174288">(</span><span class="ident" id="5174289">p</span>&nbsp;<span class="ident" id="5174291"><a href="/go/token/position.go.html#5173940">Pos</a></span><span class="op" id="5174294">)</span>&nbsp;<span class="ident" id="5174296">IsValid</span><span class="op" id="5174303">(</span><span class="op" id="5174304">)</span>&nbsp;<span class="builtintype" id="5174306">bool</span>&nbsp;<span class="op" id="5174311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5174314">return</span>&nbsp;<span class="ident" id="5174321"><a href="/go/token/position.go.html#5174289">p</a></span>&nbsp;<span class="op" id="5174323">!=</span>&nbsp;<span class="ident" id="5174326"><a href="/go/token/position.go.html#5174218">NoPos</a></span><br>
<span class="lineno"></span><span class="op" id="5174332">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="comment" id="5174335">//&nbsp;-----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5174416">//&nbsp;File</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5174425">//&nbsp;A&nbsp;File&nbsp;is&nbsp;a&nbsp;handle&nbsp;for&nbsp;a&nbsp;file&nbsp;belonging&nbsp;to&nbsp;a&nbsp;FileSet.</span><br>
<span class="lineno"></span><span class="comment" id="5174482">//&nbsp;A&nbsp;File&nbsp;has&nbsp;a&nbsp;name,&nbsp;size,&nbsp;and&nbsp;line&nbsp;offset&nbsp;table.</span><br>
<span class="lineno">90</span><span class="comment" id="5174533">//</span><br>
<span class="lineno"></span><span class="keyword" id="5174536">type</span>&nbsp;<span class="ident" id="5174541">File</span>&nbsp;<span class="keyword" id="5174546">struct</span>&nbsp;<span class="op" id="5174553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5174556">set</span>&nbsp;&nbsp;<span class="op" id="5174561">*</span><span class="ident" id="5174562"><a href="/go/token/position.go.html#5181511">FileSet</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5174571">name</span>&nbsp;<span class="builtintype" id="5174576">string</span>&nbsp;<span class="comment" id="5174583">//&nbsp;file&nbsp;name&nbsp;as&nbsp;provided&nbsp;to&nbsp;AddFile</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5174620">base</span>&nbsp;<span class="builtintype" id="5174625">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5174632">//&nbsp;Pos&nbsp;value&nbsp;range&nbsp;for&nbsp;this&nbsp;file&nbsp;is&nbsp;[base...base+size]</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5174688">size</span>&nbsp;<span class="builtintype" id="5174693">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5174700">//&nbsp;file&nbsp;size&nbsp;as&nbsp;provided&nbsp;to&nbsp;AddFile</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5174738">//&nbsp;lines&nbsp;and&nbsp;infos&nbsp;are&nbsp;protected&nbsp;by&nbsp;set.mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5174785">lines</span>&nbsp;<span class="op" id="5174791">[</span><span class="op" id="5174792">]</span><span class="builtintype" id="5174793">int</span>&nbsp;<span class="comment" id="5174797">//&nbsp;lines&nbsp;contains&nbsp;the&nbsp;offset&nbsp;of&nbsp;the&nbsp;first&nbsp;character&nbsp;for&nbsp;each&nbsp;line&nbsp;(the&nbsp;first&nbsp;entry&nbsp;is&nbsp;always&nbsp;0)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5174894">infos</span>&nbsp;<span class="op" id="5174900">[</span><span class="op" id="5174901">]</span><span class="ident" id="5174902"><a href="/go/token/position.go.html#5178057">lineInfo</a></span><br>
<span class="lineno">100</span><span class="op" id="5174911">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5174914">//&nbsp;Name&nbsp;returns&nbsp;the&nbsp;file&nbsp;name&nbsp;of&nbsp;file&nbsp;f&nbsp;as&nbsp;registered&nbsp;with&nbsp;AddFile.</span><br>
<span class="lineno"></span><span class="keyword" id="5174982">func</span>&nbsp;<span class="op" id="5174987">(</span><span class="ident" id="5174988">f</span>&nbsp;<span class="op" id="5174990">*</span><span class="ident" id="5174991"><a href="/go/token/position.go.html#5174541">File</a></span><span class="op" id="5174995">)</span>&nbsp;<span class="ident" id="5174997">Name</span><span class="op" id="5175001">(</span><span class="op" id="5175002">)</span>&nbsp;<span class="builtintype" id="5175004">string</span>&nbsp;<span class="op" id="5175011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5175014">return</span>&nbsp;<span class="ident" id="5175021"><a href="/go/token/position.go.html#5174988">f</a></span><span class="op" id="5175022">.</span><span class="ident" id="5175023">name</span><br>
<span class="lineno">105</span><span class="op" id="5175028">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5175031">//&nbsp;Base&nbsp;returns&nbsp;the&nbsp;base&nbsp;offset&nbsp;of&nbsp;file&nbsp;f&nbsp;as&nbsp;registered&nbsp;with&nbsp;AddFile.</span><br>
<span class="lineno"></span><span class="keyword" id="5175101">func</span>&nbsp;<span class="op" id="5175106">(</span><span class="ident" id="5175107">f</span>&nbsp;<span class="op" id="5175109">*</span><span class="ident" id="5175110"><a href="/go/token/position.go.html#5174541">File</a></span><span class="op" id="5175114">)</span>&nbsp;<span class="ident" id="5175116">Base</span><span class="op" id="5175120">(</span><span class="op" id="5175121">)</span>&nbsp;<span class="builtintype" id="5175123">int</span>&nbsp;<span class="op" id="5175127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5175130">return</span>&nbsp;<span class="ident" id="5175137"><a href="/go/token/position.go.html#5175107">f</a></span><span class="op" id="5175138">.</span><span class="ident" id="5175139">base</span><br>
<span class="lineno">110</span><span class="op" id="5175144">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5175147">//&nbsp;Size&nbsp;returns&nbsp;the&nbsp;size&nbsp;of&nbsp;file&nbsp;f&nbsp;as&nbsp;registered&nbsp;with&nbsp;AddFile.</span><br>
<span class="lineno"></span><span class="keyword" id="5175210">func</span>&nbsp;<span class="op" id="5175215">(</span><span class="ident" id="5175216">f</span>&nbsp;<span class="op" id="5175218">*</span><span class="ident" id="5175219"><a href="/go/token/position.go.html#5174541">File</a></span><span class="op" id="5175223">)</span>&nbsp;<span class="ident" id="5175225">Size</span><span class="op" id="5175229">(</span><span class="op" id="5175230">)</span>&nbsp;<span class="builtintype" id="5175232">int</span>&nbsp;<span class="op" id="5175236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5175239">return</span>&nbsp;<span class="ident" id="5175246"><a href="/go/token/position.go.html#5175216">f</a></span><span class="op" id="5175247">.</span><span class="ident" id="5175248">size</span><br>
<span class="lineno">115</span><span class="op" id="5175253">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5175256">//&nbsp;LineCount&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;lines&nbsp;in&nbsp;file&nbsp;f.</span><br>
<span class="lineno"></span><span class="keyword" id="5175308">func</span>&nbsp;<span class="op" id="5175313">(</span><span class="ident" id="5175314">f</span>&nbsp;<span class="op" id="5175316">*</span><span class="ident" id="5175317"><a href="/go/token/position.go.html#5174541">File</a></span><span class="op" id="5175321">)</span>&nbsp;<span class="ident" id="5175323">LineCount</span><span class="op" id="5175332">(</span><span class="op" id="5175333">)</span>&nbsp;<span class="builtintype" id="5175335">int</span>&nbsp;<span class="op" id="5175339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5175342"><a href="/go/token/position.go.html#5175314">f</a></span><span class="op" id="5175343">.</span><span class="ident" id="5175344">set</span><span class="op" id="5175347">.</span><span class="ident" id="5175348">mutex</span><span class="op" id="5175353">.</span><span class="ident" id="5175354">RLock</span><span class="op" id="5175359">(</span><span class="op" id="5175360">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5175363">n</span>&nbsp;<span class="op" id="5175365">:=</span>&nbsp;<span class="builtinfunc" id="5175368">len</span><span class="op" id="5175371">(</span><span class="ident" id="5175372"><a href="/go/token/position.go.html#5175314">f</a></span><span class="op" id="5175373">.</span><span class="ident" id="5175374">lines</span><span class="op" id="5175379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5175382"><a href="/go/token/position.go.html#5175314">f</a></span><span class="op" id="5175383">.</span><span class="ident" id="5175384">set</span><span class="op" id="5175387">.</span><span class="ident" id="5175388">mutex</span><span class="op" id="5175393">.</span><span class="ident" id="5175394">RUnlock</span><span class="op" id="5175401">(</span><span class="op" id="5175402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5175405">return</span>&nbsp;<span class="ident" id="5175412"><a href="/go/token/position.go.html#5175363">n</a></span><br>
<span class="lineno"></span><span class="op" id="5175414">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment" id="5175417">//&nbsp;AddLine&nbsp;adds&nbsp;the&nbsp;line&nbsp;offset&nbsp;for&nbsp;a&nbsp;new&nbsp;line.</span><br>
<span class="lineno"></span><span class="comment" id="5175465">//&nbsp;The&nbsp;line&nbsp;offset&nbsp;must&nbsp;be&nbsp;larger&nbsp;than&nbsp;the&nbsp;offset&nbsp;for&nbsp;the&nbsp;previous&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="5175537">//&nbsp;and&nbsp;smaller&nbsp;than&nbsp;the&nbsp;file&nbsp;size;&nbsp;otherwise&nbsp;the&nbsp;line&nbsp;offset&nbsp;is&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="5175610">//</span><br>
<span class="lineno"></span><span class="keyword" id="5175613">func</span>&nbsp;<span class="op" id="5175618">(</span><span class="ident" id="5175619">f</span>&nbsp;<span class="op" id="5175621">*</span><span class="ident" id="5175622"><a href="/go/token/position.go.html#5174541">File</a></span><span class="op" id="5175626">)</span>&nbsp;<span class="ident" id="5175628">AddLine</span><span class="op" id="5175635">(</span><span class="ident" id="5175636">offset</span>&nbsp;<span class="builtintype" id="5175643">int</span><span class="op" id="5175646">)</span>&nbsp;<span class="op" id="5175648">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5175651"><a href="/go/token/position.go.html#5175619">f</a></span><span class="op" id="5175652">.</span><span class="ident" id="5175653">set</span><span class="op" id="5175656">.</span><span class="ident" id="5175657">mutex</span><span class="op" id="5175662">.</span><span class="ident" id="5175663">Lock</span><span class="op" id="5175667">(</span><span class="op" id="5175668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5175671">if</span>&nbsp;<span class="ident" id="5175674">i</span>&nbsp;<span class="op" id="5175676">:=</span>&nbsp;<span class="builtinfunc" id="5175679">len</span><span class="op" id="5175682">(</span><span class="ident" id="5175683"><a href="/go/token/position.go.html#5175619">f</a></span><span class="op" id="5175684">.</span><span class="ident" id="5175685">lines</span><span class="op" id="5175690">)</span><span class="op" id="5175691">;</span>&nbsp;<span class="op" id="5175693">(</span><span class="ident" id="5175694"><a href="/go/token/position.go.html#5175674">i</a></span>&nbsp;<span class="op" id="5175696">==</span>&nbsp;<span class="num" id="5175699">0</span>&nbsp;<span class="op" id="5175701">||</span>&nbsp;<span class="ident" id="5175704"><a href="/go/token/position.go.html#5175619">f</a></span><span class="op" id="5175705">.</span><span class="ident" id="5175706">lines</span><span class="op" id="5175711">[</span><span class="ident" id="5175712"><a href="/go/token/position.go.html#5175674">i</a></span><span class="op" id="5175713">-</span><span class="num" id="5175714">1</span><span class="op" id="5175715">]</span>&nbsp;<span class="op" id="5175717">&lt;</span>&nbsp;<span class="ident" id="5175719"><a href="/go/token/position.go.html#5175636">offset</a></span><span class="op" id="5175725">)</span>&nbsp;<span class="op" id="5175727">&amp;&amp;</span>&nbsp;<span class="ident" id="5175730"><a href="/go/token/position.go.html#5175636">offset</a></span>&nbsp;<span class="op" id="5175737">&lt;</span>&nbsp;<span class="ident" id="5175739"><a href="/go/token/position.go.html#5175619">f</a></span><span class="op" id="5175740">.</span><span class="ident" id="5175741">size</span>&nbsp;<span class="op" id="5175746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5175750"><a href="/go/token/position.go.html#5175619">f</a></span><span class="op" id="5175751">.</span><span class="ident" id="5175752">lines</span>&nbsp;<span class="op" id="5175758">=</span>&nbsp;<span class="builtinfunc" id="5175760">append</span><span class="op" id="5175766">(</span><span class="ident" id="5175767"><a href="/go/token/position.go.html#5175619">f</a></span><span class="op" id="5175768">.</span><span class="ident" id="5175769">lines</span><span class="op" id="5175774">,</span>&nbsp;<span class="ident" id="5175776"><a href="/go/token/position.go.html#5175636">offset</a></span><span class="op" id="5175782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5175785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5175788"><a href="/go/token/position.go.html#5175619">f</a></span><span class="op" id="5175789">.</span><span class="ident" id="5175790">set</span><span class="op" id="5175793">.</span><span class="ident" id="5175794">mutex</span><span class="op" id="5175799">.</span><span class="ident" id="5175800">Unlock</span><span class="op" id="5175806">(</span><span class="op" id="5175807">)</span><br>
<span class="lineno">135</span><span class="op" id="5175809">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5175812">//&nbsp;MergeLine&nbsp;merges&nbsp;a&nbsp;line&nbsp;with&nbsp;the&nbsp;following&nbsp;line.&nbsp;It&nbsp;is&nbsp;akin&nbsp;to&nbsp;replacing</span><br>
<span class="lineno"></span><span class="comment" id="5175888">//&nbsp;the&nbsp;newline&nbsp;character&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;line&nbsp;with&nbsp;a&nbsp;space&nbsp;(to&nbsp;not&nbsp;change&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5175968">//&nbsp;remaining&nbsp;offsets).&nbsp;To&nbsp;obtain&nbsp;the&nbsp;line&nbsp;number,&nbsp;consult&nbsp;e.g.&nbsp;Position.Line.</span><br>
<span class="lineno">140</span><span class="comment" id="5176046">//&nbsp;MergeLine&nbsp;will&nbsp;panic&nbsp;if&nbsp;given&nbsp;an&nbsp;invalid&nbsp;line&nbsp;number.</span><br>
<span class="lineno"></span><span class="comment" id="5176103">//</span><br>
<span class="lineno"></span><span class="keyword" id="5176106">func</span>&nbsp;<span class="op" id="5176111">(</span><span class="ident" id="5176112">f</span>&nbsp;<span class="op" id="5176114">*</span><span class="ident" id="5176115"><a href="/go/token/position.go.html#5174541">File</a></span><span class="op" id="5176119">)</span>&nbsp;<span class="ident" id="5176121">MergeLine</span><span class="op" id="5176130">(</span><span class="ident" id="5176131">line</span>&nbsp;<span class="builtintype" id="5176136">int</span><span class="op" id="5176139">)</span>&nbsp;<span class="op" id="5176141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5176144">if</span>&nbsp;<span class="ident" id="5176147"><a href="/go/token/position.go.html#5176131">line</a></span>&nbsp;<span class="op" id="5176152">&lt;=</span>&nbsp;<span class="num" id="5176155">0</span>&nbsp;<span class="op" id="5176157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5176161">panic</span><span class="op" id="5176166">(</span><span class="string" id="5176167">&#34;illegal&nbsp;line&nbsp;number&nbsp;(line&nbsp;numbering&nbsp;starts&nbsp;at&nbsp;1)&#34;</span><span class="op" id="5176217">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5176220">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5176223"><a href="/go/token/position.go.html#5176112">f</a></span><span class="op" id="5176224">.</span><span class="ident" id="5176225">set</span><span class="op" id="5176228">.</span><span class="ident" id="5176229">mutex</span><span class="op" id="5176234">.</span><span class="ident" id="5176235">Lock</span><span class="op" id="5176239">(</span><span class="op" id="5176240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5176243">defer</span>&nbsp;<span class="ident" id="5176249"><a href="/go/token/position.go.html#5176112">f</a></span><span class="op" id="5176250">.</span><span class="ident" id="5176251">set</span><span class="op" id="5176254">.</span><span class="ident" id="5176255">mutex</span><span class="op" id="5176260">.</span><span class="ident" id="5176261">Unlock</span><span class="op" id="5176267">(</span><span class="op" id="5176268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5176271">if</span>&nbsp;<span class="ident" id="5176274"><a href="/go/token/position.go.html#5176131">line</a></span>&nbsp;<span class="op" id="5176279">&gt;=</span>&nbsp;<span class="builtinfunc" id="5176282">len</span><span class="op" id="5176285">(</span><span class="ident" id="5176286"><a href="/go/token/position.go.html#5176112">f</a></span><span class="op" id="5176287">.</span><span class="ident" id="5176288">lines</span><span class="op" id="5176293">)</span>&nbsp;<span class="op" id="5176295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5176299">panic</span><span class="op" id="5176304">(</span><span class="string" id="5176305">&#34;illegal&nbsp;line&nbsp;number&#34;</span><span class="op" id="5176326">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5176329">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5176332">//&nbsp;To&nbsp;merge&nbsp;the&nbsp;line&nbsp;numbered&nbsp;&lt;line&gt;&nbsp;with&nbsp;the&nbsp;line&nbsp;numbered&nbsp;&lt;line+1&gt;,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5176403">//&nbsp;we&nbsp;need&nbsp;to&nbsp;remove&nbsp;the&nbsp;entry&nbsp;in&nbsp;lines&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5176470">//&nbsp;numbered&nbsp;&lt;line+1&gt;.&nbsp;The&nbsp;entry&nbsp;in&nbsp;lines&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5176538">//&nbsp;numbered&nbsp;&lt;line+1&gt;&nbsp;is&nbsp;located&nbsp;at&nbsp;index&nbsp;&lt;line&gt;,&nbsp;since&nbsp;indices&nbsp;in&nbsp;lines</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5176611">//&nbsp;are&nbsp;0-based&nbsp;and&nbsp;line&nbsp;numbers&nbsp;are&nbsp;1-based.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5176657">copy</span><span class="op" id="5176661">(</span><span class="ident" id="5176662"><a href="/go/token/position.go.html#5176112">f</a></span><span class="op" id="5176663">.</span><span class="ident" id="5176664">lines</span><span class="op" id="5176669">[</span><span class="ident" id="5176670"><a href="/go/token/position.go.html#5176131">line</a></span><span class="op" id="5176674">:</span><span class="op" id="5176675">]</span><span class="op" id="5176676">,</span>&nbsp;<span class="ident" id="5176678"><a href="/go/token/position.go.html#5176112">f</a></span><span class="op" id="5176679">.</span><span class="ident" id="5176680">lines</span><span class="op" id="5176685">[</span><span class="ident" id="5176686"><a href="/go/token/position.go.html#5176131">line</a></span><span class="op" id="5176690">+</span><span class="num" id="5176691">1</span><span class="op" id="5176692">:</span><span class="op" id="5176693">]</span><span class="op" id="5176694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5176697"><a href="/go/token/position.go.html#5176112">f</a></span><span class="op" id="5176698">.</span><span class="ident" id="5176699">lines</span>&nbsp;<span class="op" id="5176705">=</span>&nbsp;<span class="ident" id="5176707"><a href="/go/token/position.go.html#5176112">f</a></span><span class="op" id="5176708">.</span><span class="ident" id="5176709">lines</span><span class="op" id="5176714">[</span><span class="op" id="5176715">:</span><span class="builtinfunc" id="5176716">len</span><span class="op" id="5176719">(</span><span class="ident" id="5176720"><a href="/go/token/position.go.html#5176112">f</a></span><span class="op" id="5176721">.</span><span class="ident" id="5176722">lines</span><span class="op" id="5176727">)</span><span class="op" id="5176728">-</span><span class="num" id="5176729">1</span><span class="op" id="5176730">]</span><br>
<span class="lineno"></span><span class="op" id="5176732">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="5176735">//&nbsp;SetLines&nbsp;sets&nbsp;the&nbsp;line&nbsp;offsets&nbsp;for&nbsp;a&nbsp;file&nbsp;and&nbsp;returns&nbsp;true&nbsp;if&nbsp;successful.</span><br>
<span class="lineno"></span><span class="comment" id="5176812">//&nbsp;The&nbsp;line&nbsp;offsets&nbsp;are&nbsp;the&nbsp;offsets&nbsp;of&nbsp;the&nbsp;first&nbsp;character&nbsp;of&nbsp;each&nbsp;line;</span><br>
<span class="lineno"></span><span class="comment" id="5176885">//&nbsp;for&nbsp;instance&nbsp;for&nbsp;the&nbsp;content&nbsp;&#34;ab\nc\n&#34;&nbsp;the&nbsp;line&nbsp;offsets&nbsp;are&nbsp;{0,&nbsp;3}.</span><br>
<span class="lineno"></span><span class="comment" id="5176956">//&nbsp;An&nbsp;empty&nbsp;file&nbsp;has&nbsp;an&nbsp;empty&nbsp;line&nbsp;offset&nbsp;table.</span><br>
<span class="lineno"></span><span class="comment" id="5177005">//&nbsp;Each&nbsp;line&nbsp;offset&nbsp;must&nbsp;be&nbsp;larger&nbsp;than&nbsp;the&nbsp;offset&nbsp;for&nbsp;the&nbsp;previous&nbsp;line</span><br>
<span class="lineno">165</span><span class="comment" id="5177078">//&nbsp;and&nbsp;smaller&nbsp;than&nbsp;the&nbsp;file&nbsp;size;&nbsp;otherwise&nbsp;SetLines&nbsp;fails&nbsp;and&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="5177150">//&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="5177160">//</span><br>
<span class="lineno"></span><span class="keyword" id="5177163">func</span>&nbsp;<span class="op" id="5177168">(</span><span class="ident" id="5177169">f</span>&nbsp;<span class="op" id="5177171">*</span><span class="ident" id="5177172"><a href="/go/token/position.go.html#5174541">File</a></span><span class="op" id="5177176">)</span>&nbsp;<span class="ident" id="5177178">SetLines</span><span class="op" id="5177186">(</span><span class="ident" id="5177187">lines</span>&nbsp;<span class="op" id="5177193">[</span><span class="op" id="5177194">]</span><span class="builtintype" id="5177195">int</span><span class="op" id="5177198">)</span>&nbsp;<span class="builtintype" id="5177200">bool</span>&nbsp;<span class="op" id="5177205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5177208">//&nbsp;verify&nbsp;validity&nbsp;of&nbsp;lines&nbsp;table</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5177243">size</span>&nbsp;<span class="op" id="5177248">:=</span>&nbsp;<span class="ident" id="5177251"><a href="/go/token/position.go.html#5177169">f</a></span><span class="op" id="5177252">.</span><span class="ident" id="5177253">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5177259">for</span>&nbsp;<span class="ident" id="5177263">i</span><span class="op" id="5177264">,</span>&nbsp;<span class="ident" id="5177266">offset</span>&nbsp;<span class="op" id="5177273">:=</span>&nbsp;<span class="keyword" id="5177276">range</span>&nbsp;<span class="ident" id="5177282"><a href="/go/token/position.go.html#5177187">lines</a></span>&nbsp;<span class="op" id="5177288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5177292">if</span>&nbsp;<span class="ident" id="5177295"><a href="/go/token/position.go.html#5177263">i</a></span>&nbsp;<span class="op" id="5177297">&gt;</span>&nbsp;<span class="num" id="5177299">0</span>&nbsp;<span class="op" id="5177301">&amp;&amp;</span>&nbsp;<span class="ident" id="5177304"><a href="/go/token/position.go.html#5177266">offset</a></span>&nbsp;<span class="op" id="5177311">&lt;=</span>&nbsp;<span class="ident" id="5177314"><a href="/go/token/position.go.html#5177187">lines</a></span><span class="op" id="5177319">[</span><span class="ident" id="5177320"><a href="/go/token/position.go.html#5177263">i</a></span><span class="op" id="5177321">-</span><span class="num" id="5177322">1</span><span class="op" id="5177323">]</span>&nbsp;<span class="op" id="5177325">||</span>&nbsp;<span class="ident" id="5177328"><a href="/go/token/position.go.html#5177243">size</a></span>&nbsp;<span class="op" id="5177333">&lt;=</span>&nbsp;<span class="ident" id="5177336"><a href="/go/token/position.go.html#5177266">offset</a></span>&nbsp;<span class="op" id="5177343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5177348">return</span>&nbsp;<span class="builtintype" id="5177355">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5177363">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5177366">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5177370">//&nbsp;set&nbsp;lines&nbsp;table</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5177390"><a href="/go/token/position.go.html#5177169">f</a></span><span class="op" id="5177391">.</span><span class="ident" id="5177392">set</span><span class="op" id="5177395">.</span><span class="ident" id="5177396">mutex</span><span class="op" id="5177401">.</span><span class="ident" id="5177402">Lock</span><span class="op" id="5177406">(</span><span class="op" id="5177407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5177410"><a href="/go/token/position.go.html#5177169">f</a></span><span class="op" id="5177411">.</span><span class="ident" id="5177412">lines</span>&nbsp;<span class="op" id="5177418">=</span>&nbsp;<span class="ident" id="5177420"><a href="/go/token/position.go.html#5177187">lines</a></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5177427"><a href="/go/token/position.go.html#5177169">f</a></span><span class="op" id="5177428">.</span><span class="ident" id="5177429">set</span><span class="op" id="5177432">.</span><span class="ident" id="5177433">mutex</span><span class="op" id="5177438">.</span><span class="ident" id="5177439">Unlock</span><span class="op" id="5177445">(</span><span class="op" id="5177446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5177449">return</span>&nbsp;<span class="builtintype" id="5177456">true</span><br>
<span class="lineno"></span><span class="op" id="5177461">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5177464">//&nbsp;SetLinesForContent&nbsp;sets&nbsp;the&nbsp;line&nbsp;offsets&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;content.</span><br>
<span class="lineno">185</span><span class="comment" id="5177536">//&nbsp;It&nbsp;ignores&nbsp;position-altering&nbsp;//line&nbsp;comments.</span><br>
<span class="lineno"></span><span class="keyword" id="5177585">func</span>&nbsp;<span class="op" id="5177590">(</span><span class="ident" id="5177591">f</span>&nbsp;<span class="op" id="5177593">*</span><span class="ident" id="5177594"><a href="/go/token/position.go.html#5174541">File</a></span><span class="op" id="5177598">)</span>&nbsp;<span class="ident" id="5177600">SetLinesForContent</span><span class="op" id="5177618">(</span><span class="ident" id="5177619">content</span>&nbsp;<span class="op" id="5177627">[</span><span class="op" id="5177628">]</span><span class="builtintype" id="5177629">byte</span><span class="op" id="5177633">)</span>&nbsp;<span class="op" id="5177635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5177638">var</span>&nbsp;<span class="ident" id="5177642">lines</span>&nbsp;<span class="op" id="5177648">[</span><span class="op" id="5177649">]</span><span class="builtintype" id="5177650">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5177655">line</span>&nbsp;<span class="op" id="5177660">:=</span>&nbsp;<span class="num" id="5177663">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5177666">for</span>&nbsp;<span class="ident" id="5177670">offset</span><span class="op" id="5177676">,</span>&nbsp;<span class="ident" id="5177678">b</span>&nbsp;<span class="op" id="5177680">:=</span>&nbsp;<span class="keyword" id="5177683">range</span>&nbsp;<span class="ident" id="5177689"><a href="/go/token/position.go.html#5177619">content</a></span>&nbsp;<span class="op" id="5177697">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5177701">if</span>&nbsp;<span class="ident" id="5177704"><a href="/go/token/position.go.html#5177655">line</a></span>&nbsp;<span class="op" id="5177709">&gt;=</span>&nbsp;<span class="num" id="5177712">0</span>&nbsp;<span class="op" id="5177714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5177719"><a href="/go/token/position.go.html#5177642">lines</a></span>&nbsp;<span class="op" id="5177725">=</span>&nbsp;<span class="builtinfunc" id="5177727">append</span><span class="op" id="5177733">(</span><span class="ident" id="5177734"><a href="/go/token/position.go.html#5177642">lines</a></span><span class="op" id="5177739">,</span>&nbsp;<span class="ident" id="5177741"><a href="/go/token/position.go.html#5177655">line</a></span><span class="op" id="5177745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5177749">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5177753"><a href="/go/token/position.go.html#5177655">line</a></span>&nbsp;<span class="op" id="5177758">=</span>&nbsp;<span class="op" id="5177760">-</span><span class="num" id="5177761">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5177765">if</span>&nbsp;<span class="ident" id="5177768"><a href="/go/token/position.go.html#5177678">b</a></span>&nbsp;<span class="op" id="5177770">==</span>&nbsp;<span class="string" id="5177773">&#39;\n&#39;</span>&nbsp;<span class="op" id="5177778">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5177783"><a href="/go/token/position.go.html#5177655">line</a></span>&nbsp;<span class="op" id="5177788">=</span>&nbsp;<span class="ident" id="5177790"><a href="/go/token/position.go.html#5177670">offset</a></span>&nbsp;<span class="op" id="5177797">+</span>&nbsp;<span class="num" id="5177799">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5177803">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5177806">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5177810">//&nbsp;set&nbsp;lines&nbsp;table</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5177830"><a href="/go/token/position.go.html#5177591">f</a></span><span class="op" id="5177831">.</span><span class="ident" id="5177832">set</span><span class="op" id="5177835">.</span><span class="ident" id="5177836">mutex</span><span class="op" id="5177841">.</span><span class="ident" id="5177842">Lock</span><span class="op" id="5177846">(</span><span class="op" id="5177847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5177850"><a href="/go/token/position.go.html#5177591">f</a></span><span class="op" id="5177851">.</span><span class="ident" id="5177852">lines</span>&nbsp;<span class="op" id="5177858">=</span>&nbsp;<span class="ident" id="5177860"><a href="/go/token/position.go.html#5177642">lines</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5177867"><a href="/go/token/position.go.html#5177591">f</a></span><span class="op" id="5177868">.</span><span class="ident" id="5177869">set</span><span class="op" id="5177872">.</span><span class="ident" id="5177873">mutex</span><span class="op" id="5177878">.</span><span class="ident" id="5177879">Unlock</span><span class="op" id="5177885">(</span><span class="op" id="5177886">)</span><br>
<span class="lineno"></span><span class="op" id="5177888">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="comment" id="5177891">//&nbsp;A&nbsp;lineInfo&nbsp;object&nbsp;describes&nbsp;alternative&nbsp;file&nbsp;and&nbsp;line&nbsp;number</span><br>
<span class="lineno"></span><span class="comment" id="5177955">//&nbsp;information&nbsp;(such&nbsp;as&nbsp;provided&nbsp;via&nbsp;a&nbsp;//line&nbsp;comment&nbsp;in&nbsp;a&nbsp;.go</span><br>
<span class="lineno"></span><span class="comment" id="5178018">//&nbsp;file)&nbsp;for&nbsp;a&nbsp;given&nbsp;file&nbsp;offset.</span><br>
<span class="lineno"></span><span class="keyword" id="5178052">type</span>&nbsp;<span class="ident" id="5178057">lineInfo</span>&nbsp;<span class="keyword" id="5178066">struct</span>&nbsp;<span class="op" id="5178073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5178076">//&nbsp;fields&nbsp;are&nbsp;exported&nbsp;to&nbsp;make&nbsp;them&nbsp;accessible&nbsp;to&nbsp;gob</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5178131">Offset</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5178140">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5178145">Filename</span>&nbsp;<span class="builtintype" id="5178154">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5178162">Line</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5178171">int</span><br>
<span class="lineno"></span><span class="op" id="5178175">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="comment" id="5178178">//&nbsp;AddLineInfo&nbsp;adds&nbsp;alternative&nbsp;file&nbsp;and&nbsp;line&nbsp;number&nbsp;information&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="5178247">//&nbsp;a&nbsp;given&nbsp;file&nbsp;offset.&nbsp;The&nbsp;offset&nbsp;must&nbsp;be&nbsp;larger&nbsp;than&nbsp;the&nbsp;offset&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="5178317">//&nbsp;the&nbsp;previously&nbsp;added&nbsp;alternative&nbsp;line&nbsp;info&nbsp;and&nbsp;smaller&nbsp;than&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5178384">//&nbsp;file&nbsp;size;&nbsp;otherwise&nbsp;the&nbsp;information&nbsp;is&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="5178436">//</span><br>
<span class="lineno">220</span><span class="comment" id="5178439">//&nbsp;AddLineInfo&nbsp;is&nbsp;typically&nbsp;used&nbsp;to&nbsp;register&nbsp;alternative&nbsp;position</span><br>
<span class="lineno"></span><span class="comment" id="5178505">//&nbsp;information&nbsp;for&nbsp;//line&nbsp;filename:line&nbsp;comments&nbsp;in&nbsp;source&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="5178571">//</span><br>
<span class="lineno"></span><span class="keyword" id="5178574">func</span>&nbsp;<span class="op" id="5178579">(</span><span class="ident" id="5178580">f</span>&nbsp;<span class="op" id="5178582">*</span><span class="ident" id="5178583"><a href="/go/token/position.go.html#5174541">File</a></span><span class="op" id="5178587">)</span>&nbsp;<span class="ident" id="5178589">AddLineInfo</span><span class="op" id="5178600">(</span><span class="ident" id="5178601">offset</span>&nbsp;<span class="builtintype" id="5178608">int</span><span class="op" id="5178611">,</span>&nbsp;<span class="ident" id="5178613">filename</span>&nbsp;<span class="builtintype" id="5178622">string</span><span class="op" id="5178628">,</span>&nbsp;<span class="ident" id="5178630">line</span>&nbsp;<span class="builtintype" id="5178635">int</span><span class="op" id="5178638">)</span>&nbsp;<span class="op" id="5178640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5178643"><a href="/go/token/position.go.html#5178580">f</a></span><span class="op" id="5178644">.</span><span class="ident" id="5178645">set</span><span class="op" id="5178648">.</span><span class="ident" id="5178649">mutex</span><span class="op" id="5178654">.</span><span class="ident" id="5178655">Lock</span><span class="op" id="5178659">(</span><span class="op" id="5178660">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5178663">if</span>&nbsp;<span class="ident" id="5178666">i</span>&nbsp;<span class="op" id="5178668">:=</span>&nbsp;<span class="builtinfunc" id="5178671">len</span><span class="op" id="5178674">(</span><span class="ident" id="5178675"><a href="/go/token/position.go.html#5178580">f</a></span><span class="op" id="5178676">.</span><span class="ident" id="5178677">infos</span><span class="op" id="5178682">)</span><span class="op" id="5178683">;</span>&nbsp;<span class="ident" id="5178685"><a href="/go/token/position.go.html#5178666">i</a></span>&nbsp;<span class="op" id="5178687">==</span>&nbsp;<span class="num" id="5178690">0</span>&nbsp;<span class="op" id="5178692">||</span>&nbsp;<span class="ident" id="5178695"><a href="/go/token/position.go.html#5178580">f</a></span><span class="op" id="5178696">.</span><span class="ident" id="5178697">infos</span><span class="op" id="5178702">[</span><span class="ident" id="5178703"><a href="/go/token/position.go.html#5178666">i</a></span><span class="op" id="5178704">-</span><span class="num" id="5178705">1</span><span class="op" id="5178706">]</span><span class="op" id="5178707">.</span><span class="ident" id="5178708">Offset</span>&nbsp;<span class="op" id="5178715">&lt;</span>&nbsp;<span class="ident" id="5178717"><a href="/go/token/position.go.html#5178601">offset</a></span>&nbsp;<span class="op" id="5178724">&amp;&amp;</span>&nbsp;<span class="ident" id="5178727"><a href="/go/token/position.go.html#5178601">offset</a></span>&nbsp;<span class="op" id="5178734">&lt;</span>&nbsp;<span class="ident" id="5178736"><a href="/go/token/position.go.html#5178580">f</a></span><span class="op" id="5178737">.</span><span class="ident" id="5178738">size</span>&nbsp;<span class="op" id="5178743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5178747"><a href="/go/token/position.go.html#5178580">f</a></span><span class="op" id="5178748">.</span><span class="ident" id="5178749">infos</span>&nbsp;<span class="op" id="5178755">=</span>&nbsp;<span class="builtinfunc" id="5178757">append</span><span class="op" id="5178763">(</span><span class="ident" id="5178764"><a href="/go/token/position.go.html#5178580">f</a></span><span class="op" id="5178765">.</span><span class="ident" id="5178766">infos</span><span class="op" id="5178771">,</span>&nbsp;<span class="ident" id="5178773"><a href="/go/token/position.go.html#5178057">lineInfo</a></span><span class="op" id="5178781">{</span><span class="ident" id="5178782"><a href="/go/token/position.go.html#5178601">offset</a></span><span class="op" id="5178788">,</span>&nbsp;<span class="ident" id="5178790"><a href="/go/token/position.go.html#5178613">filename</a></span><span class="op" id="5178798">,</span>&nbsp;<span class="ident" id="5178800"><a href="/go/token/position.go.html#5178630">line</a></span><span class="op" id="5178804">}</span><span class="op" id="5178805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5178808">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5178811"><a href="/go/token/position.go.html#5178580">f</a></span><span class="op" id="5178812">.</span><span class="ident" id="5178813">set</span><span class="op" id="5178816">.</span><span class="ident" id="5178817">mutex</span><span class="op" id="5178822">.</span><span class="ident" id="5178823">Unlock</span><span class="op" id="5178829">(</span><span class="op" id="5178830">)</span><br>
<span class="lineno"></span><span class="op" id="5178832">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="5178835">//&nbsp;Pos&nbsp;returns&nbsp;the&nbsp;Pos&nbsp;value&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;offset;</span><br>
<span class="lineno"></span><span class="comment" id="5178891">//&nbsp;the&nbsp;offset&nbsp;must&nbsp;be&nbsp;&lt;=&nbsp;f.Size().</span><br>
<span class="lineno"></span><span class="comment" id="5178926">//&nbsp;f.Pos(f.Offset(p))&nbsp;==&nbsp;p.</span><br>
<span class="lineno"></span><span class="comment" id="5178954">//</span><br>
<span class="lineno">235</span><span class="keyword" id="5178957">func</span>&nbsp;<span class="op" id="5178962">(</span><span class="ident" id="5178963">f</span>&nbsp;<span class="op" id="5178965">*</span><span class="ident" id="5178966"><a href="/go/token/position.go.html#5174541">File</a></span><span class="op" id="5178970">)</span>&nbsp;<span class="ident" id="5178972">Pos</span><span class="op" id="5178975">(</span><span class="ident" id="5178976">offset</span>&nbsp;<span class="builtintype" id="5178983">int</span><span class="op" id="5178986">)</span>&nbsp;<span class="ident" id="5178988"><a href="/go/token/position.go.html#5173940">Pos</a></span>&nbsp;<span class="op" id="5178992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5178995">if</span>&nbsp;<span class="ident" id="5178998"><a href="/go/token/position.go.html#5178976">offset</a></span>&nbsp;<span class="op" id="5179005">&gt;</span>&nbsp;<span class="ident" id="5179007"><a href="/go/token/position.go.html#5178963">f</a></span><span class="op" id="5179008">.</span><span class="ident" id="5179009">size</span>&nbsp;<span class="op" id="5179014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5179018">panic</span><span class="op" id="5179023">(</span><span class="string" id="5179024">&#34;illegal&nbsp;file&nbsp;offset&#34;</span><span class="op" id="5179045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5179048">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5179051">return</span>&nbsp;<span class="ident" id="5179058"><a href="/go/token/position.go.html#5173940">Pos</a></span><span class="op" id="5179061">(</span><span class="ident" id="5179062"><a href="/go/token/position.go.html#5178963">f</a></span><span class="op" id="5179063">.</span><span class="ident" id="5179064">base</span>&nbsp;<span class="op" id="5179069">+</span>&nbsp;<span class="ident" id="5179071"><a href="/go/token/position.go.html#5178976">offset</a></span><span class="op" id="5179077">)</span><br>
<span class="lineno">240</span><span class="op" id="5179079">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5179082">//&nbsp;Offset&nbsp;returns&nbsp;the&nbsp;offset&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;position&nbsp;p;</span><br>
<span class="lineno"></span><span class="comment" id="5179142">//&nbsp;p&nbsp;must&nbsp;be&nbsp;a&nbsp;valid&nbsp;Pos&nbsp;value&nbsp;in&nbsp;that&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="5179187">//&nbsp;f.Offset(f.Pos(offset))&nbsp;==&nbsp;offset.</span><br>
<span class="lineno">245</span><span class="comment" id="5179225">//</span><br>
<span class="lineno"></span><span class="keyword" id="5179228">func</span>&nbsp;<span class="op" id="5179233">(</span><span class="ident" id="5179234">f</span>&nbsp;<span class="op" id="5179236">*</span><span class="ident" id="5179237"><a href="/go/token/position.go.html#5174541">File</a></span><span class="op" id="5179241">)</span>&nbsp;<span class="ident" id="5179243">Offset</span><span class="op" id="5179249">(</span><span class="ident" id="5179250">p</span>&nbsp;<span class="ident" id="5179252"><a href="/go/token/position.go.html#5173940">Pos</a></span><span class="op" id="5179255">)</span>&nbsp;<span class="builtintype" id="5179257">int</span>&nbsp;<span class="op" id="5179261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5179264">if</span>&nbsp;<span class="builtintype" id="5179267">int</span><span class="op" id="5179270">(</span><span class="ident" id="5179271"><a href="/go/token/position.go.html#5179250">p</a></span><span class="op" id="5179272">)</span>&nbsp;<span class="op" id="5179274">&lt;</span>&nbsp;<span class="ident" id="5179276"><a href="/go/token/position.go.html#5179234">f</a></span><span class="op" id="5179277">.</span><span class="ident" id="5179278">base</span>&nbsp;<span class="op" id="5179283">||</span>&nbsp;<span class="builtintype" id="5179286">int</span><span class="op" id="5179289">(</span><span class="ident" id="5179290"><a href="/go/token/position.go.html#5179250">p</a></span><span class="op" id="5179291">)</span>&nbsp;<span class="op" id="5179293">&gt;</span>&nbsp;<span class="ident" id="5179295"><a href="/go/token/position.go.html#5179234">f</a></span><span class="op" id="5179296">.</span><span class="ident" id="5179297">base</span><span class="op" id="5179301">+</span><span class="ident" id="5179302"><a href="/go/token/position.go.html#5179234">f</a></span><span class="op" id="5179303">.</span><span class="ident" id="5179304">size</span>&nbsp;<span class="op" id="5179309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5179313">panic</span><span class="op" id="5179318">(</span><span class="string" id="5179319">&#34;illegal&nbsp;Pos&nbsp;value&#34;</span><span class="op" id="5179338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5179341">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5179344">return</span>&nbsp;<span class="builtintype" id="5179351">int</span><span class="op" id="5179354">(</span><span class="ident" id="5179355"><a href="/go/token/position.go.html#5179250">p</a></span><span class="op" id="5179356">)</span>&nbsp;<span class="op" id="5179358">-</span>&nbsp;<span class="ident" id="5179360"><a href="/go/token/position.go.html#5179234">f</a></span><span class="op" id="5179361">.</span><span class="ident" id="5179362">base</span><br>
<span class="lineno"></span><span class="op" id="5179367">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5179370">//&nbsp;Line&nbsp;returns&nbsp;the&nbsp;line&nbsp;number&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;position&nbsp;p;</span><br>
<span class="lineno"></span><span class="comment" id="5179433">//&nbsp;p&nbsp;must&nbsp;be&nbsp;a&nbsp;Pos&nbsp;value&nbsp;in&nbsp;that&nbsp;file&nbsp;or&nbsp;NoPos.</span><br>
<span class="lineno">255</span><span class="comment" id="5179481">//</span><br>
<span class="lineno"></span><span class="keyword" id="5179484">func</span>&nbsp;<span class="op" id="5179489">(</span><span class="ident" id="5179490">f</span>&nbsp;<span class="op" id="5179492">*</span><span class="ident" id="5179493"><a href="/go/token/position.go.html#5174541">File</a></span><span class="op" id="5179497">)</span>&nbsp;<span class="ident" id="5179499">Line</span><span class="op" id="5179503">(</span><span class="ident" id="5179504">p</span>&nbsp;<span class="ident" id="5179506"><a href="/go/token/position.go.html#5173940">Pos</a></span><span class="op" id="5179509">)</span>&nbsp;<span class="builtintype" id="5179511">int</span>&nbsp;<span class="op" id="5179515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5179518">return</span>&nbsp;<span class="ident" id="5179525"><a href="/go/token/position.go.html#5179490">f</a></span><span class="op" id="5179526">.</span><span class="ident" id="5179527">Position</span><span class="op" id="5179535">(</span><span class="ident" id="5179536"><a href="/go/token/position.go.html#5179504">p</a></span><span class="op" id="5179537">)</span><span class="op" id="5179538">.</span><span class="ident" id="5179539">Line</span><br>
<span class="lineno"></span><span class="op" id="5179544">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="keyword" id="5179547">func</span>&nbsp;<span class="ident" id="5179552">searchLineInfos</span><span class="op" id="5179567">(</span><span class="ident" id="5179568">a</span>&nbsp;<span class="op" id="5179570">[</span><span class="op" id="5179571">]</span><span class="ident" id="5179572"><a href="/go/token/position.go.html#5178057">lineInfo</a></span><span class="op" id="5179580">,</span>&nbsp;<span class="ident" id="5179582">x</span>&nbsp;<span class="builtintype" id="5179584">int</span><span class="op" id="5179587">)</span>&nbsp;<span class="builtintype" id="5179589">int</span>&nbsp;<span class="op" id="5179593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5179596">return</span>&nbsp;<span class="ident" id="5179603"><a href="/go/token/position.go.html#5171837">sort</a></span><span class="op" id="5179607">.</span><span class="ident" id="5179608">Search</span><span class="op" id="5179614">(</span><span class="builtinfunc" id="5179615">len</span><span class="op" id="5179618">(</span><span class="ident" id="5179619"><a href="/go/token/position.go.html#5179568">a</a></span><span class="op" id="5179620">)</span><span class="op" id="5179621">,</span>&nbsp;<span class="keyword" id="5179623">func</span><span class="op" id="5179627">(</span><span class="ident" id="5179628">i</span>&nbsp;<span class="builtintype" id="5179630">int</span><span class="op" id="5179633">)</span>&nbsp;<span class="builtintype" id="5179635">bool</span>&nbsp;<span class="op" id="5179640">{</span>&nbsp;<span class="keyword" id="5179642">return</span>&nbsp;<span class="ident" id="5179649"><a href="/go/token/position.go.html#5179568">a</a></span><span class="op" id="5179650">[</span><span class="ident" id="5179651"><a href="/go/token/position.go.html#5179628">i</a></span><span class="op" id="5179652">]</span><span class="op" id="5179653">.</span><span class="ident" id="5179654">Offset</span>&nbsp;<span class="op" id="5179661">&gt;</span>&nbsp;<span class="ident" id="5179663"><a href="/go/token/position.go.html#5179582">x</a></span>&nbsp;<span class="op" id="5179665">}</span><span class="op" id="5179666">)</span>&nbsp;<span class="op" id="5179668">-</span>&nbsp;<span class="num" id="5179670">1</span><br>
<span class="lineno"></span><span class="op" id="5179672">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5179675">//&nbsp;unpack&nbsp;returns&nbsp;the&nbsp;filename&nbsp;and&nbsp;line&nbsp;and&nbsp;column&nbsp;number&nbsp;for&nbsp;a&nbsp;file&nbsp;offset.</span><br>
<span class="lineno">265</span><span class="comment" id="5179752">//&nbsp;If&nbsp;adjusted&nbsp;is&nbsp;set,&nbsp;unpack&nbsp;will&nbsp;return&nbsp;the&nbsp;filename&nbsp;and&nbsp;line&nbsp;information</span><br>
<span class="lineno"></span><span class="comment" id="5179828">//&nbsp;possibly&nbsp;adjusted&nbsp;by&nbsp;//line&nbsp;comments;&nbsp;otherwise&nbsp;those&nbsp;comments&nbsp;are&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="5179907">//</span><br>
<span class="lineno"></span><span class="keyword" id="5179910">func</span>&nbsp;<span class="op" id="5179915">(</span><span class="ident" id="5179916">f</span>&nbsp;<span class="op" id="5179918">*</span><span class="ident" id="5179919"><a href="/go/token/position.go.html#5174541">File</a></span><span class="op" id="5179923">)</span>&nbsp;<span class="ident" id="5179925">unpack</span><span class="op" id="5179931">(</span><span class="ident" id="5179932">offset</span>&nbsp;<span class="builtintype" id="5179939">int</span><span class="op" id="5179942">,</span>&nbsp;<span class="ident" id="5179944">adjusted</span>&nbsp;<span class="builtintype" id="5179953">bool</span><span class="op" id="5179957">)</span>&nbsp;<span class="op" id="5179959">(</span><span class="ident" id="5179960">filename</span>&nbsp;<span class="builtintype" id="5179969">string</span><span class="op" id="5179975">,</span>&nbsp;<span class="ident" id="5179977">line</span><span class="op" id="5179981">,</span>&nbsp;<span class="ident" id="5179983">column</span>&nbsp;<span class="builtintype" id="5179990">int</span><span class="op" id="5179993">)</span>&nbsp;<span class="op" id="5179995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5179998"><a href="/go/token/position.go.html#5179960">filename</a></span>&nbsp;<span class="op" id="5180007">=</span>&nbsp;<span class="ident" id="5180009"><a href="/go/token/position.go.html#5179916">f</a></span><span class="op" id="5180010">.</span><span class="ident" id="5180011">name</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5180017">if</span>&nbsp;<span class="ident" id="5180020">i</span>&nbsp;<span class="op" id="5180022">:=</span>&nbsp;<span class="ident" id="5180025"><a href="/go/token/position.go.html#5185390">searchInts</a></span><span class="op" id="5180035">(</span><span class="ident" id="5180036"><a href="/go/token/position.go.html#5179916">f</a></span><span class="op" id="5180037">.</span><span class="ident" id="5180038">lines</span><span class="op" id="5180043">,</span>&nbsp;<span class="ident" id="5180045"><a href="/go/token/position.go.html#5179932">offset</a></span><span class="op" id="5180051">)</span><span class="op" id="5180052">;</span>&nbsp;<span class="ident" id="5180054"><a href="/go/token/position.go.html#5180020">i</a></span>&nbsp;<span class="op" id="5180056">&gt;=</span>&nbsp;<span class="num" id="5180059">0</span>&nbsp;<span class="op" id="5180061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5180065"><a href="/go/token/position.go.html#5179977">line</a></span><span class="op" id="5180069">,</span>&nbsp;<span class="ident" id="5180071"><a href="/go/token/position.go.html#5179983">column</a></span>&nbsp;<span class="op" id="5180078">=</span>&nbsp;<span class="ident" id="5180080"><a href="/go/token/position.go.html#5180020">i</a></span><span class="op" id="5180081">+</span><span class="num" id="5180082">1</span><span class="op" id="5180083">,</span>&nbsp;<span class="ident" id="5180085"><a href="/go/token/position.go.html#5179932">offset</a></span><span class="op" id="5180091">-</span><span class="ident" id="5180092"><a href="/go/token/position.go.html#5179916">f</a></span><span class="op" id="5180093">.</span><span class="ident" id="5180094">lines</span><span class="op" id="5180099">[</span><span class="ident" id="5180100"><a href="/go/token/position.go.html#5180020">i</a></span><span class="op" id="5180101">]</span><span class="op" id="5180102">+</span><span class="num" id="5180103">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5180106">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5180109">if</span>&nbsp;<span class="ident" id="5180112"><a href="/go/token/position.go.html#5179944">adjusted</a></span>&nbsp;<span class="op" id="5180121">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5180124">len</span><span class="op" id="5180127">(</span><span class="ident" id="5180128"><a href="/go/token/position.go.html#5179916">f</a></span><span class="op" id="5180129">.</span><span class="ident" id="5180130">infos</span><span class="op" id="5180135">)</span>&nbsp;<span class="op" id="5180137">&gt;</span>&nbsp;<span class="num" id="5180139">0</span>&nbsp;<span class="op" id="5180141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5180145">//&nbsp;almost&nbsp;no&nbsp;files&nbsp;have&nbsp;extra&nbsp;line&nbsp;infos</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5180188">if</span>&nbsp;<span class="ident" id="5180191">i</span>&nbsp;<span class="op" id="5180193">:=</span>&nbsp;<span class="ident" id="5180196"><a href="/go/token/position.go.html#5179552">searchLineInfos</a></span><span class="op" id="5180211">(</span><span class="ident" id="5180212"><a href="/go/token/position.go.html#5179916">f</a></span><span class="op" id="5180213">.</span><span class="ident" id="5180214">infos</span><span class="op" id="5180219">,</span>&nbsp;<span class="ident" id="5180221"><a href="/go/token/position.go.html#5179932">offset</a></span><span class="op" id="5180227">)</span><span class="op" id="5180228">;</span>&nbsp;<span class="ident" id="5180230"><a href="/go/token/position.go.html#5180191">i</a></span>&nbsp;<span class="op" id="5180232">&gt;=</span>&nbsp;<span class="num" id="5180235">0</span>&nbsp;<span class="op" id="5180237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5180242">alt</span>&nbsp;<span class="op" id="5180246">:=</span>&nbsp;<span class="op" id="5180249">&amp;</span><span class="ident" id="5180250"><a href="/go/token/position.go.html#5179916">f</a></span><span class="op" id="5180251">.</span><span class="ident" id="5180252">infos</span><span class="op" id="5180257">[</span><span class="ident" id="5180258"><a href="/go/token/position.go.html#5180191">i</a></span><span class="op" id="5180259">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5180264"><a href="/go/token/position.go.html#5179960">filename</a></span>&nbsp;<span class="op" id="5180273">=</span>&nbsp;<span class="ident" id="5180275"><a href="/go/token/position.go.html#5180242">alt</a></span><span class="op" id="5180278">.</span><span class="ident" id="5180279">Filename</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5180291">if</span>&nbsp;<span class="ident" id="5180294">i</span>&nbsp;<span class="op" id="5180296">:=</span>&nbsp;<span class="ident" id="5180299"><a href="/go/token/position.go.html#5185390">searchInts</a></span><span class="op" id="5180309">(</span><span class="ident" id="5180310"><a href="/go/token/position.go.html#5179916">f</a></span><span class="op" id="5180311">.</span><span class="ident" id="5180312">lines</span><span class="op" id="5180317">,</span>&nbsp;<span class="ident" id="5180319"><a href="/go/token/position.go.html#5180242">alt</a></span><span class="op" id="5180322">.</span><span class="ident" id="5180323">Offset</span><span class="op" id="5180329">)</span><span class="op" id="5180330">;</span>&nbsp;<span class="ident" id="5180332"><a href="/go/token/position.go.html#5180294">i</a></span>&nbsp;<span class="op" id="5180334">&gt;=</span>&nbsp;<span class="num" id="5180337">0</span>&nbsp;<span class="op" id="5180339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5180345"><a href="/go/token/position.go.html#5179977">line</a></span>&nbsp;<span class="op" id="5180350">+=</span>&nbsp;<span class="ident" id="5180353"><a href="/go/token/position.go.html#5180242">alt</a></span><span class="op" id="5180356">.</span><span class="ident" id="5180357">Line</span>&nbsp;<span class="op" id="5180362">-</span>&nbsp;<span class="ident" id="5180364"><a href="/go/token/position.go.html#5180294">i</a></span>&nbsp;<span class="op" id="5180366">-</span>&nbsp;<span class="num" id="5180368">1</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5180373">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5180377">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5180380">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5180383">return</span><br>
<span class="lineno"></span><span class="op" id="5180390">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span><span class="keyword" id="5180393">func</span>&nbsp;<span class="op" id="5180398">(</span><span class="ident" id="5180399">f</span>&nbsp;<span class="op" id="5180401">*</span><span class="ident" id="5180402"><a href="/go/token/position.go.html#5174541">File</a></span><span class="op" id="5180406">)</span>&nbsp;<span class="ident" id="5180408">position</span><span class="op" id="5180416">(</span><span class="ident" id="5180417">p</span>&nbsp;<span class="ident" id="5180419"><a href="/go/token/position.go.html#5173940">Pos</a></span><span class="op" id="5180422">,</span>&nbsp;<span class="ident" id="5180424">adjusted</span>&nbsp;<span class="builtintype" id="5180433">bool</span><span class="op" id="5180437">)</span>&nbsp;<span class="op" id="5180439">(</span><span class="ident" id="5180440">pos</span>&nbsp;<span class="ident" id="5180444"><a href="/go/token/position.go.html#5172109">Position</a></span><span class="op" id="5180452">)</span>&nbsp;<span class="op" id="5180454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5180457">offset</span>&nbsp;<span class="op" id="5180464">:=</span>&nbsp;<span class="builtintype" id="5180467">int</span><span class="op" id="5180470">(</span><span class="ident" id="5180471"><a href="/go/token/position.go.html#5180417">p</a></span><span class="op" id="5180472">)</span>&nbsp;<span class="op" id="5180474">-</span>&nbsp;<span class="ident" id="5180476"><a href="/go/token/position.go.html#5180399">f</a></span><span class="op" id="5180477">.</span><span class="ident" id="5180478">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5180484"><a href="/go/token/position.go.html#5180440">pos</a></span><span class="op" id="5180487">.</span><span class="ident" id="5180488">Offset</span>&nbsp;<span class="op" id="5180495">=</span>&nbsp;<span class="ident" id="5180497"><a href="/go/token/position.go.html#5180457">offset</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5180505"><a href="/go/token/position.go.html#5180440">pos</a></span><span class="op" id="5180508">.</span><span class="ident" id="5180509">Filename</span><span class="op" id="5180517">,</span>&nbsp;<span class="ident" id="5180519"><a href="/go/token/position.go.html#5180440">pos</a></span><span class="op" id="5180522">.</span><span class="ident" id="5180523">Line</span><span class="op" id="5180527">,</span>&nbsp;<span class="ident" id="5180529"><a href="/go/token/position.go.html#5180440">pos</a></span><span class="op" id="5180532">.</span><span class="ident" id="5180533">Column</span>&nbsp;<span class="op" id="5180540">=</span>&nbsp;<span class="ident" id="5180542"><a href="/go/token/position.go.html#5180399">f</a></span><span class="op" id="5180543">.</span><span class="ident" id="5180544">unpack</span><span class="op" id="5180550">(</span><span class="ident" id="5180551"><a href="/go/token/position.go.html#5180457">offset</a></span><span class="op" id="5180557">,</span>&nbsp;<span class="ident" id="5180559"><a href="/go/token/position.go.html#5180424">adjusted</a></span><span class="op" id="5180567">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5180570">return</span><br>
<span class="lineno"></span><span class="op" id="5180577">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5180580">//&nbsp;PositionFor&nbsp;returns&nbsp;the&nbsp;Position&nbsp;value&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;position&nbsp;p.</span><br>
<span class="lineno"></span><span class="comment" id="5180653">//&nbsp;If&nbsp;adjusted&nbsp;is&nbsp;set,&nbsp;the&nbsp;position&nbsp;may&nbsp;be&nbsp;adjusted&nbsp;by&nbsp;position-altering</span><br>
<span class="lineno">295</span><span class="comment" id="5180726">//&nbsp;//line&nbsp;comments;&nbsp;otherwise&nbsp;those&nbsp;comments&nbsp;are&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="5180784">//&nbsp;p&nbsp;must&nbsp;be&nbsp;a&nbsp;Pos&nbsp;value&nbsp;in&nbsp;f&nbsp;or&nbsp;NoPos.</span><br>
<span class="lineno"></span><span class="comment" id="5180824">//</span><br>
<span class="lineno"></span><span class="keyword" id="5180827">func</span>&nbsp;<span class="op" id="5180832">(</span><span class="ident" id="5180833">f</span>&nbsp;<span class="op" id="5180835">*</span><span class="ident" id="5180836"><a href="/go/token/position.go.html#5174541">File</a></span><span class="op" id="5180840">)</span>&nbsp;<span class="ident" id="5180842">PositionFor</span><span class="op" id="5180853">(</span><span class="ident" id="5180854">p</span>&nbsp;<span class="ident" id="5180856"><a href="/go/token/position.go.html#5173940">Pos</a></span><span class="op" id="5180859">,</span>&nbsp;<span class="ident" id="5180861">adjusted</span>&nbsp;<span class="builtintype" id="5180870">bool</span><span class="op" id="5180874">)</span>&nbsp;<span class="op" id="5180876">(</span><span class="ident" id="5180877">pos</span>&nbsp;<span class="ident" id="5180881"><a href="/go/token/position.go.html#5172109">Position</a></span><span class="op" id="5180889">)</span>&nbsp;<span class="op" id="5180891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5180894">if</span>&nbsp;<span class="ident" id="5180897"><a href="/go/token/position.go.html#5180854">p</a></span>&nbsp;<span class="op" id="5180899">!=</span>&nbsp;<span class="ident" id="5180902"><a href="/go/token/position.go.html#5174218">NoPos</a></span>&nbsp;<span class="op" id="5180908">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5180912">if</span>&nbsp;<span class="builtintype" id="5180915">int</span><span class="op" id="5180918">(</span><span class="ident" id="5180919"><a href="/go/token/position.go.html#5180854">p</a></span><span class="op" id="5180920">)</span>&nbsp;<span class="op" id="5180922">&lt;</span>&nbsp;<span class="ident" id="5180924"><a href="/go/token/position.go.html#5180833">f</a></span><span class="op" id="5180925">.</span><span class="ident" id="5180926">base</span>&nbsp;<span class="op" id="5180931">||</span>&nbsp;<span class="builtintype" id="5180934">int</span><span class="op" id="5180937">(</span><span class="ident" id="5180938"><a href="/go/token/position.go.html#5180854">p</a></span><span class="op" id="5180939">)</span>&nbsp;<span class="op" id="5180941">&gt;</span>&nbsp;<span class="ident" id="5180943"><a href="/go/token/position.go.html#5180833">f</a></span><span class="op" id="5180944">.</span><span class="ident" id="5180945">base</span><span class="op" id="5180949">+</span><span class="ident" id="5180950"><a href="/go/token/position.go.html#5180833">f</a></span><span class="op" id="5180951">.</span><span class="ident" id="5180952">size</span>&nbsp;<span class="op" id="5180957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5180962">panic</span><span class="op" id="5180967">(</span><span class="string" id="5180968">&#34;illegal&nbsp;Pos&nbsp;value&#34;</span><span class="op" id="5180987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5180991">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5180995"><a href="/go/token/position.go.html#5180877">pos</a></span>&nbsp;<span class="op" id="5180999">=</span>&nbsp;<span class="ident" id="5181001"><a href="/go/token/position.go.html#5180833">f</a></span><span class="op" id="5181002">.</span><span class="ident" id="5181003">position</span><span class="op" id="5181011">(</span><span class="ident" id="5181012"><a href="/go/token/position.go.html#5180854">p</a></span><span class="op" id="5181013">,</span>&nbsp;<span class="ident" id="5181015"><a href="/go/token/position.go.html#5180861">adjusted</a></span><span class="op" id="5181023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5181026">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5181029">return</span><br>
<span class="lineno"></span><span class="op" id="5181036">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5181039">//&nbsp;Position&nbsp;returns&nbsp;the&nbsp;Position&nbsp;value&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;position&nbsp;p.</span><br>
<span class="lineno"></span><span class="comment" id="5181109">//&nbsp;Calling&nbsp;f.Position(p)&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;calling&nbsp;f.PositionFor(p,&nbsp;true).</span><br>
<span class="lineno">310</span><span class="comment" id="5181183">//</span><br>
<span class="lineno"></span><span class="keyword" id="5181186">func</span>&nbsp;<span class="op" id="5181191">(</span><span class="ident" id="5181192">f</span>&nbsp;<span class="op" id="5181194">*</span><span class="ident" id="5181195"><a href="/go/token/position.go.html#5174541">File</a></span><span class="op" id="5181199">)</span>&nbsp;<span class="ident" id="5181201">Position</span><span class="op" id="5181209">(</span><span class="ident" id="5181210">p</span>&nbsp;<span class="ident" id="5181212"><a href="/go/token/position.go.html#5173940">Pos</a></span><span class="op" id="5181215">)</span>&nbsp;<span class="op" id="5181217">(</span><span class="ident" id="5181218">pos</span>&nbsp;<span class="ident" id="5181222"><a href="/go/token/position.go.html#5172109">Position</a></span><span class="op" id="5181230">)</span>&nbsp;<span class="op" id="5181232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5181235">return</span>&nbsp;<span class="ident" id="5181242"><a href="/go/token/position.go.html#5181192">f</a></span><span class="op" id="5181243">.</span><span class="ident" id="5181244">PositionFor</span><span class="op" id="5181255">(</span><span class="ident" id="5181256"><a href="/go/token/position.go.html#5181210">p</a></span><span class="op" id="5181257">,</span>&nbsp;<span class="builtintype" id="5181259">true</span><span class="op" id="5181263">)</span><br>
<span class="lineno"></span><span class="op" id="5181265">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span><span class="comment" id="5181268">//&nbsp;-----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5181349">//&nbsp;FileSet</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5181361">//&nbsp;A&nbsp;FileSet&nbsp;represents&nbsp;a&nbsp;set&nbsp;of&nbsp;source&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="5181408">//&nbsp;Methods&nbsp;of&nbsp;file&nbsp;sets&nbsp;are&nbsp;synchronized;&nbsp;multiple&nbsp;goroutines</span><br>
<span class="lineno">320</span><span class="comment" id="5181470">//&nbsp;may&nbsp;invoke&nbsp;them&nbsp;concurrently.</span><br>
<span class="lineno"></span><span class="comment" id="5181503">//</span><br>
<span class="lineno"></span><span class="keyword" id="5181506">type</span>&nbsp;<span class="ident" id="5181511">FileSet</span>&nbsp;<span class="keyword" id="5181519">struct</span>&nbsp;<span class="op" id="5181526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5181529">mutex</span>&nbsp;<span class="ident" id="5181535"><a href="/go/token/position.go.html#5171845">sync</a></span><span class="op" id="5181539">.</span><span class="ident" id="5181540">RWMutex</span>&nbsp;<span class="comment" id="5181548">//&nbsp;protects&nbsp;the&nbsp;file&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5181574">base</span>&nbsp;&nbsp;<span class="builtintype" id="5181580">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5181593">//&nbsp;base&nbsp;offset&nbsp;for&nbsp;the&nbsp;next&nbsp;file</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5181627">files</span>&nbsp;<span class="op" id="5181633">[</span><span class="op" id="5181634">]</span><span class="op" id="5181635">*</span><span class="ident" id="5181636"><a href="/go/token/position.go.html#5174541">File</a></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5181646">//&nbsp;list&nbsp;of&nbsp;files&nbsp;in&nbsp;the&nbsp;order&nbsp;added&nbsp;to&nbsp;the&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5181694">last</span>&nbsp;&nbsp;<span class="op" id="5181700">*</span><span class="ident" id="5181701"><a href="/go/token/position.go.html#5174541">File</a></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5181713">//&nbsp;cache&nbsp;of&nbsp;last&nbsp;file&nbsp;looked&nbsp;up</span><br>
<span class="lineno"></span><span class="op" id="5181745">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5181748">//&nbsp;NewFileSet&nbsp;creates&nbsp;a&nbsp;new&nbsp;file&nbsp;set.</span><br>
<span class="lineno">330</span><span class="keyword" id="5181786">func</span>&nbsp;<span class="ident" id="5181791">NewFileSet</span><span class="op" id="5181801">(</span><span class="op" id="5181802">)</span>&nbsp;<span class="op" id="5181804">*</span><span class="ident" id="5181805"><a href="/go/token/position.go.html#5181511">FileSet</a></span>&nbsp;<span class="op" id="5181813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5181816">return</span>&nbsp;<span class="op" id="5181823">&amp;</span><span class="ident" id="5181824"><a href="/go/token/position.go.html#5181511">FileSet</a></span><span class="op" id="5181831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5181835">base</span><span class="op" id="5181839">:</span>&nbsp;<span class="num" id="5181841">1</span><span class="op" id="5181842">,</span>&nbsp;<span class="comment" id="5181844">//&nbsp;0&nbsp;==&nbsp;NoPos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5181859">}</span><br>
<span class="lineno"></span><span class="op" id="5181861">}</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span><span class="comment" id="5181864">//&nbsp;Base&nbsp;returns&nbsp;the&nbsp;minimum&nbsp;base&nbsp;offset&nbsp;that&nbsp;must&nbsp;be&nbsp;provided&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5181929">//&nbsp;AddFile&nbsp;when&nbsp;adding&nbsp;the&nbsp;next&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="5181967">//</span><br>
<span class="lineno"></span><span class="keyword" id="5181970">func</span>&nbsp;<span class="op" id="5181975">(</span><span class="ident" id="5181976">s</span>&nbsp;<span class="op" id="5181978">*</span><span class="ident" id="5181979"><a href="/go/token/position.go.html#5181511">FileSet</a></span><span class="op" id="5181986">)</span>&nbsp;<span class="ident" id="5181988">Base</span><span class="op" id="5181992">(</span><span class="op" id="5181993">)</span>&nbsp;<span class="builtintype" id="5181995">int</span>&nbsp;<span class="op" id="5181999">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5182002"><a href="/go/token/position.go.html#5181976">s</a></span><span class="op" id="5182003">.</span><span class="ident" id="5182004">mutex</span><span class="op" id="5182009">.</span><span class="ident" id="5182010">RLock</span><span class="op" id="5182015">(</span><span class="op" id="5182016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5182019">b</span>&nbsp;<span class="op" id="5182021">:=</span>&nbsp;<span class="ident" id="5182024"><a href="/go/token/position.go.html#5181976">s</a></span><span class="op" id="5182025">.</span><span class="ident" id="5182026">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5182032"><a href="/go/token/position.go.html#5181976">s</a></span><span class="op" id="5182033">.</span><span class="ident" id="5182034">mutex</span><span class="op" id="5182039">.</span><span class="ident" id="5182040">RUnlock</span><span class="op" id="5182047">(</span><span class="op" id="5182048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5182051">return</span>&nbsp;<span class="ident" id="5182058"><a href="/go/token/position.go.html#5182019">b</a></span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span><span class="op" id="5182061">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5182064">//&nbsp;AddFile&nbsp;adds&nbsp;a&nbsp;new&nbsp;file&nbsp;with&nbsp;a&nbsp;given&nbsp;filename,&nbsp;base&nbsp;offset,&nbsp;and&nbsp;file&nbsp;size</span><br>
<span class="lineno"></span><span class="comment" id="5182141">//&nbsp;to&nbsp;the&nbsp;file&nbsp;set&nbsp;s&nbsp;and&nbsp;returns&nbsp;the&nbsp;file.&nbsp;Multiple&nbsp;files&nbsp;may&nbsp;have&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span><span class="comment" id="5182217">//&nbsp;name.&nbsp;The&nbsp;base&nbsp;offset&nbsp;must&nbsp;not&nbsp;be&nbsp;smaller&nbsp;than&nbsp;the&nbsp;FileSet&#39;s&nbsp;Base(),&nbsp;and</span><br>
<span class="lineno">350</span><span class="comment" id="5182293">//&nbsp;size&nbsp;must&nbsp;not&nbsp;be&nbsp;negative.&nbsp;As&nbsp;a&nbsp;special&nbsp;case,&nbsp;if&nbsp;a&nbsp;negative&nbsp;base&nbsp;is&nbsp;provided,</span><br>
<span class="lineno"></span><span class="comment" id="5182374">//&nbsp;the&nbsp;current&nbsp;value&nbsp;of&nbsp;the&nbsp;FileSet&#39;s&nbsp;Base()&nbsp;is&nbsp;used&nbsp;instead.</span><br>
<span class="lineno"></span><span class="comment" id="5182436">//</span><br>
<span class="lineno"></span><span class="comment" id="5182439">//&nbsp;Adding&nbsp;the&nbsp;file&nbsp;will&nbsp;set&nbsp;the&nbsp;file&nbsp;set&#39;s&nbsp;Base()&nbsp;value&nbsp;to&nbsp;base&nbsp;+&nbsp;size&nbsp;+&nbsp;1</span><br>
<span class="lineno"></span><span class="comment" id="5182514">//&nbsp;as&nbsp;the&nbsp;minimum&nbsp;base&nbsp;value&nbsp;for&nbsp;the&nbsp;next&nbsp;file.&nbsp;The&nbsp;following&nbsp;relationship</span><br>
<span class="lineno">355</span><span class="comment" id="5182589">//&nbsp;exists&nbsp;between&nbsp;a&nbsp;Pos&nbsp;value&nbsp;p&nbsp;for&nbsp;a&nbsp;given&nbsp;file&nbsp;offset&nbsp;offs:</span><br>
<span class="lineno"></span><span class="comment" id="5182651">//</span><br>
<span class="lineno"></span><span class="comment" id="5182654">//&nbsp;&nbsp;&nbsp;&nbspint(p)&nbsp;=&nbsp;base&nbsp;+&nbsp;offs</span><br>
<span class="lineno"></span><span class="comment" id="5182678">//</span><br>
<span class="lineno"></span><span class="comment" id="5182681">//&nbsp;with&nbsp;offs&nbsp;in&nbsp;the&nbsp;range&nbsp;[0,&nbsp;size]&nbsp;and&nbsp;thus&nbsp;p&nbsp;in&nbsp;the&nbsp;range&nbsp;[base,&nbsp;base+size].</span><br>
<span class="lineno">360</span><span class="comment" id="5182760">//&nbsp;For&nbsp;convenience,&nbsp;File.Pos&nbsp;may&nbsp;be&nbsp;used&nbsp;to&nbsp;create&nbsp;file-specific&nbsp;position</span><br>
<span class="lineno"></span><span class="comment" id="5182834">//&nbsp;values&nbsp;from&nbsp;a&nbsp;file&nbsp;offset.</span><br>
<span class="lineno"></span><span class="comment" id="5182864">//</span><br>
<span class="lineno"></span><span class="keyword" id="5182867">func</span>&nbsp;<span class="op" id="5182872">(</span><span class="ident" id="5182873">s</span>&nbsp;<span class="op" id="5182875">*</span><span class="ident" id="5182876"><a href="/go/token/position.go.html#5181511">FileSet</a></span><span class="op" id="5182883">)</span>&nbsp;<span class="ident" id="5182885">AddFile</span><span class="op" id="5182892">(</span><span class="ident" id="5182893">filename</span>&nbsp;<span class="builtintype" id="5182902">string</span><span class="op" id="5182908">,</span>&nbsp;<span class="ident" id="5182910">base</span><span class="op" id="5182914">,</span>&nbsp;<span class="ident" id="5182916">size</span>&nbsp;<span class="builtintype" id="5182921">int</span><span class="op" id="5182924">)</span>&nbsp;<span class="op" id="5182926">*</span><span class="ident" id="5182927"><a href="/go/token/position.go.html#5174541">File</a></span>&nbsp;<span class="op" id="5182932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5182935"><a href="/go/token/position.go.html#5182873">s</a></span><span class="op" id="5182936">.</span><span class="ident" id="5182937">mutex</span><span class="op" id="5182942">.</span><span class="ident" id="5182943">Lock</span><span class="op" id="5182947">(</span><span class="op" id="5182948">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5182951">defer</span>&nbsp;<span class="ident" id="5182957"><a href="/go/token/position.go.html#5182873">s</a></span><span class="op" id="5182958">.</span><span class="ident" id="5182959">mutex</span><span class="op" id="5182964">.</span><span class="ident" id="5182965">Unlock</span><span class="op" id="5182971">(</span><span class="op" id="5182972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5182975">if</span>&nbsp;<span class="ident" id="5182978"><a href="/go/token/position.go.html#5182910">base</a></span>&nbsp;<span class="op" id="5182983">&lt;</span>&nbsp;<span class="num" id="5182985">0</span>&nbsp;<span class="op" id="5182987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5182991"><a href="/go/token/position.go.html#5182910">base</a></span>&nbsp;<span class="op" id="5182996">=</span>&nbsp;<span class="ident" id="5182998"><a href="/go/token/position.go.html#5182873">s</a></span><span class="op" id="5182999">.</span><span class="ident" id="5183000">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5183006">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5183009">if</span>&nbsp;<span class="ident" id="5183012"><a href="/go/token/position.go.html#5182910">base</a></span>&nbsp;<span class="op" id="5183017">&lt;</span>&nbsp;<span class="ident" id="5183019"><a href="/go/token/position.go.html#5182873">s</a></span><span class="op" id="5183020">.</span><span class="ident" id="5183021">base</span>&nbsp;<span class="op" id="5183026">||</span>&nbsp;<span class="ident" id="5183029"><a href="/go/token/position.go.html#5182916">size</a></span>&nbsp;<span class="op" id="5183034">&lt;</span>&nbsp;<span class="num" id="5183036">0</span>&nbsp;<span class="op" id="5183038">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5183042">panic</span><span class="op" id="5183047">(</span><span class="string" id="5183048">&#34;illegal&nbsp;base&nbsp;or&nbsp;size&#34;</span><span class="op" id="5183070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5183073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5183076">//&nbsp;base&nbsp;&gt;=&nbsp;s.base&nbsp;&amp;&amp;&nbsp;size&nbsp;&gt;=&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5183108">f</span>&nbsp;<span class="op" id="5183110">:=</span>&nbsp;<span class="op" id="5183113">&amp;</span><span class="ident" id="5183114"><a href="/go/token/position.go.html#5174541">File</a></span><span class="op" id="5183118">{</span><span class="ident" id="5183119"><a href="/go/token/position.go.html#5182873">s</a></span><span class="op" id="5183120">,</span>&nbsp;<span class="ident" id="5183122"><a href="/go/token/position.go.html#5182893">filename</a></span><span class="op" id="5183130">,</span>&nbsp;<span class="ident" id="5183132"><a href="/go/token/position.go.html#5182910">base</a></span><span class="op" id="5183136">,</span>&nbsp;<span class="ident" id="5183138"><a href="/go/token/position.go.html#5182916">size</a></span><span class="op" id="5183142">,</span>&nbsp;<span class="op" id="5183144">[</span><span class="op" id="5183145">]</span><span class="builtintype" id="5183146">int</span><span class="op" id="5183149">{</span><span class="num" id="5183150">0</span><span class="op" id="5183151">}</span><span class="op" id="5183152">,</span>&nbsp;<span class="ident" id="5183154">nil</span><span class="op" id="5183157">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5183160"><a href="/go/token/position.go.html#5182910">base</a></span>&nbsp;<span class="op" id="5183165">+=</span>&nbsp;<span class="ident" id="5183168"><a href="/go/token/position.go.html#5182916">size</a></span>&nbsp;<span class="op" id="5183173">+</span>&nbsp;<span class="num" id="5183175">1</span>&nbsp;<span class="comment" id="5183177">//&nbsp;+1&nbsp;because&nbsp;EOF&nbsp;also&nbsp;has&nbsp;a&nbsp;position</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5183216">if</span>&nbsp;<span class="ident" id="5183219"><a href="/go/token/position.go.html#5182910">base</a></span>&nbsp;<span class="op" id="5183224">&lt;</span>&nbsp;<span class="num" id="5183226">0</span>&nbsp;<span class="op" id="5183228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5183232">panic</span><span class="op" id="5183237">(</span><span class="string" id="5183238">&#34;token.Pos&nbsp;offset&nbsp;overflow&nbsp;(&gt;&nbsp;2G&nbsp;of&nbsp;source&nbsp;code&nbsp;in&nbsp;file&nbsp;set)&#34;</span><span class="op" id="5183299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5183302">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5183305">//&nbsp;add&nbsp;the&nbsp;file&nbsp;to&nbsp;the&nbsp;file&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5183338"><a href="/go/token/position.go.html#5182873">s</a></span><span class="op" id="5183339">.</span><span class="ident" id="5183340">base</span>&nbsp;<span class="op" id="5183345">=</span>&nbsp;<span class="ident" id="5183347"><a href="/go/token/position.go.html#5182910">base</a></span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5183353"><a href="/go/token/position.go.html#5182873">s</a></span><span class="op" id="5183354">.</span><span class="ident" id="5183355">files</span>&nbsp;<span class="op" id="5183361">=</span>&nbsp;<span class="builtinfunc" id="5183363">append</span><span class="op" id="5183369">(</span><span class="ident" id="5183370"><a href="/go/token/position.go.html#5182873">s</a></span><span class="op" id="5183371">.</span><span class="ident" id="5183372">files</span><span class="op" id="5183377">,</span>&nbsp;<span class="ident" id="5183379"><a href="/go/token/position.go.html#5183108">f</a></span><span class="op" id="5183380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5183383"><a href="/go/token/position.go.html#5182873">s</a></span><span class="op" id="5183384">.</span><span class="ident" id="5183385">last</span>&nbsp;<span class="op" id="5183390">=</span>&nbsp;<span class="ident" id="5183392"><a href="/go/token/position.go.html#5183108">f</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5183395">return</span>&nbsp;<span class="ident" id="5183402"><a href="/go/token/position.go.html#5183108">f</a></span><br>
<span class="lineno"></span><span class="op" id="5183404">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="comment" id="5183407">//&nbsp;Iterate&nbsp;calls&nbsp;f&nbsp;for&nbsp;the&nbsp;files&nbsp;in&nbsp;the&nbsp;file&nbsp;set&nbsp;in&nbsp;the&nbsp;order&nbsp;they&nbsp;were&nbsp;added</span><br>
<span class="lineno"></span><span class="comment" id="5183485">//&nbsp;until&nbsp;f&nbsp;returns&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="5183511">//</span><br>
<span class="lineno"></span><span class="keyword" id="5183514">func</span>&nbsp;<span class="op" id="5183519">(</span><span class="ident" id="5183520">s</span>&nbsp;<span class="op" id="5183522">*</span><span class="ident" id="5183523"><a href="/go/token/position.go.html#5181511">FileSet</a></span><span class="op" id="5183530">)</span>&nbsp;<span class="ident" id="5183532">Iterate</span><span class="op" id="5183539">(</span><span class="ident" id="5183540">f</span>&nbsp;<span class="keyword" id="5183542">func</span><span class="op" id="5183546">(</span><span class="op" id="5183547">*</span><span class="ident" id="5183548"><a href="/go/token/position.go.html#5174541">File</a></span><span class="op" id="5183552">)</span>&nbsp;<span class="builtintype" id="5183554">bool</span><span class="op" id="5183558">)</span>&nbsp;<span class="op" id="5183560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5183563">for</span>&nbsp;<span class="ident" id="5183567">i</span>&nbsp;<span class="op" id="5183569">:=</span>&nbsp;<span class="num" id="5183572">0</span><span class="op" id="5183573">;</span>&nbsp;<span class="op" id="5183575">;</span>&nbsp;<span class="ident" id="5183577"><a href="/go/token/position.go.html#5183567">i</a></span><span class="op" id="5183578">++</span>&nbsp;<span class="op" id="5183581">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5183585">var</span>&nbsp;<span class="ident" id="5183589">file</span>&nbsp;<span class="op" id="5183594">*</span><span class="ident" id="5183595"><a href="/go/token/position.go.html#5174541">File</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5183602"><a href="/go/token/position.go.html#5183520">s</a></span><span class="op" id="5183603">.</span><span class="ident" id="5183604">mutex</span><span class="op" id="5183609">.</span><span class="ident" id="5183610">RLock</span><span class="op" id="5183615">(</span><span class="op" id="5183616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5183620">if</span>&nbsp;<span class="ident" id="5183623"><a href="/go/token/position.go.html#5183567">i</a></span>&nbsp;<span class="op" id="5183625">&lt;</span>&nbsp;<span class="builtinfunc" id="5183627">len</span><span class="op" id="5183630">(</span><span class="ident" id="5183631"><a href="/go/token/position.go.html#5183520">s</a></span><span class="op" id="5183632">.</span><span class="ident" id="5183633">files</span><span class="op" id="5183638">)</span>&nbsp;<span class="op" id="5183640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5183645"><a href="/go/token/position.go.html#5183589">file</a></span>&nbsp;<span class="op" id="5183650">=</span>&nbsp;<span class="ident" id="5183652"><a href="/go/token/position.go.html#5183520">s</a></span><span class="op" id="5183653">.</span><span class="ident" id="5183654">files</span><span class="op" id="5183659">[</span><span class="ident" id="5183660"><a href="/go/token/position.go.html#5183567">i</a></span><span class="op" id="5183661">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5183665">}</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5183669"><a href="/go/token/position.go.html#5183520">s</a></span><span class="op" id="5183670">.</span><span class="ident" id="5183671">mutex</span><span class="op" id="5183676">.</span><span class="ident" id="5183677">RUnlock</span><span class="op" id="5183684">(</span><span class="op" id="5183685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5183689">if</span>&nbsp;<span class="ident" id="5183692"><a href="/go/token/position.go.html#5183589">file</a></span>&nbsp;<span class="op" id="5183697">==</span>&nbsp;<span class="ident" id="5183700">nil</span>&nbsp;<span class="op" id="5183704">||</span>&nbsp;<span class="op" id="5183707">!</span><span class="ident" id="5183708"><a href="/go/token/position.go.html#5183540">f</a></span><span class="op" id="5183709">(</span><span class="ident" id="5183710"><a href="/go/token/position.go.html#5183589">file</a></span><span class="op" id="5183714">)</span>&nbsp;<span class="op" id="5183716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5183721">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5183729">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5183732">}</span><br>
<span class="lineno">400</span><span class="op" id="5183734">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5183737">func</span>&nbsp;<span class="ident" id="5183742">searchFiles</span><span class="op" id="5183753">(</span><span class="ident" id="5183754">a</span>&nbsp;<span class="op" id="5183756">[</span><span class="op" id="5183757">]</span><span class="op" id="5183758">*</span><span class="ident" id="5183759"><a href="/go/token/position.go.html#5174541">File</a></span><span class="op" id="5183763">,</span>&nbsp;<span class="ident" id="5183765">x</span>&nbsp;<span class="builtintype" id="5183767">int</span><span class="op" id="5183770">)</span>&nbsp;<span class="builtintype" id="5183772">int</span>&nbsp;<span class="op" id="5183776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5183779">return</span>&nbsp;<span class="ident" id="5183786"><a href="/go/token/position.go.html#5171837">sort</a></span><span class="op" id="5183790">.</span><span class="ident" id="5183791">Search</span><span class="op" id="5183797">(</span><span class="builtinfunc" id="5183798">len</span><span class="op" id="5183801">(</span><span class="ident" id="5183802"><a href="/go/token/position.go.html#5183754">a</a></span><span class="op" id="5183803">)</span><span class="op" id="5183804">,</span>&nbsp;<span class="keyword" id="5183806">func</span><span class="op" id="5183810">(</span><span class="ident" id="5183811">i</span>&nbsp;<span class="builtintype" id="5183813">int</span><span class="op" id="5183816">)</span>&nbsp;<span class="builtintype" id="5183818">bool</span>&nbsp;<span class="op" id="5183823">{</span>&nbsp;<span class="keyword" id="5183825">return</span>&nbsp;<span class="ident" id="5183832"><a href="/go/token/position.go.html#5183754">a</a></span><span class="op" id="5183833">[</span><span class="ident" id="5183834"><a href="/go/token/position.go.html#5183811">i</a></span><span class="op" id="5183835">]</span><span class="op" id="5183836">.</span><span class="ident" id="5183837">base</span>&nbsp;<span class="op" id="5183842">&gt;</span>&nbsp;<span class="ident" id="5183844"><a href="/go/token/position.go.html#5183765">x</a></span>&nbsp;<span class="op" id="5183846">}</span><span class="op" id="5183847">)</span>&nbsp;<span class="op" id="5183849">-</span>&nbsp;<span class="num" id="5183851">1</span><br>
<span class="lineno"></span><span class="op" id="5183853">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="keyword" id="5183856">func</span>&nbsp;<span class="op" id="5183861">(</span><span class="ident" id="5183862">s</span>&nbsp;<span class="op" id="5183864">*</span><span class="ident" id="5183865"><a href="/go/token/position.go.html#5181511">FileSet</a></span><span class="op" id="5183872">)</span>&nbsp;<span class="ident" id="5183874">file</span><span class="op" id="5183878">(</span><span class="ident" id="5183879">p</span>&nbsp;<span class="ident" id="5183881"><a href="/go/token/position.go.html#5173940">Pos</a></span><span class="op" id="5183884">)</span>&nbsp;<span class="op" id="5183886">*</span><span class="ident" id="5183887"><a href="/go/token/position.go.html#5174541">File</a></span>&nbsp;<span class="op" id="5183892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5183895"><a href="/go/token/position.go.html#5183862">s</a></span><span class="op" id="5183896">.</span><span class="ident" id="5183897">mutex</span><span class="op" id="5183902">.</span><span class="ident" id="5183903">RLock</span><span class="op" id="5183908">(</span><span class="op" id="5183909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5183912">//&nbsp;common&nbsp;case:&nbsp;p&nbsp;is&nbsp;in&nbsp;last&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5183947">if</span>&nbsp;<span class="ident" id="5183950">f</span>&nbsp;<span class="op" id="5183952">:=</span>&nbsp;<span class="ident" id="5183955"><a href="/go/token/position.go.html#5183862">s</a></span><span class="op" id="5183956">.</span><span class="ident" id="5183957">last</span><span class="op" id="5183961">;</span>&nbsp;<span class="ident" id="5183963"><a href="/go/token/position.go.html#5183950">f</a></span>&nbsp;<span class="op" id="5183965">!=</span>&nbsp;<span class="ident" id="5183968">nil</span>&nbsp;<span class="op" id="5183972">&amp;&amp;</span>&nbsp;<span class="ident" id="5183975"><a href="/go/token/position.go.html#5183950">f</a></span><span class="op" id="5183976">.</span><span class="ident" id="5183977">base</span>&nbsp;<span class="op" id="5183982">&lt;=</span>&nbsp;<span class="builtintype" id="5183985">int</span><span class="op" id="5183988">(</span><span class="ident" id="5183989"><a href="/go/token/position.go.html#5183879">p</a></span><span class="op" id="5183990">)</span>&nbsp;<span class="op" id="5183992">&amp;&amp;</span>&nbsp;<span class="builtintype" id="5183995">int</span><span class="op" id="5183998">(</span><span class="ident" id="5183999"><a href="/go/token/position.go.html#5183879">p</a></span><span class="op" id="5184000">)</span>&nbsp;<span class="op" id="5184002">&lt;=</span>&nbsp;<span class="ident" id="5184005"><a href="/go/token/position.go.html#5183950">f</a></span><span class="op" id="5184006">.</span><span class="ident" id="5184007">base</span><span class="op" id="5184011">+</span><span class="ident" id="5184012"><a href="/go/token/position.go.html#5183950">f</a></span><span class="op" id="5184013">.</span><span class="ident" id="5184014">size</span>&nbsp;<span class="op" id="5184019">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5184023"><a href="/go/token/position.go.html#5183862">s</a></span><span class="op" id="5184024">.</span><span class="ident" id="5184025">mutex</span><span class="op" id="5184030">.</span><span class="ident" id="5184031">RUnlock</span><span class="op" id="5184038">(</span><span class="op" id="5184039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5184043">return</span>&nbsp;<span class="ident" id="5184050"><a href="/go/token/position.go.html#5183950">f</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5184053">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5184056">//&nbsp;p&nbsp;is&nbsp;not&nbsp;in&nbsp;last&nbsp;file&nbsp;-&nbsp;search&nbsp;all&nbsp;files</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5184101">if</span>&nbsp;<span class="ident" id="5184104">i</span>&nbsp;<span class="op" id="5184106">:=</span>&nbsp;<span class="ident" id="5184109"><a href="/go/token/position.go.html#5183742">searchFiles</a></span><span class="op" id="5184120">(</span><span class="ident" id="5184121"><a href="/go/token/position.go.html#5183862">s</a></span><span class="op" id="5184122">.</span><span class="ident" id="5184123">files</span><span class="op" id="5184128">,</span>&nbsp;<span class="builtintype" id="5184130">int</span><span class="op" id="5184133">(</span><span class="ident" id="5184134"><a href="/go/token/position.go.html#5183879">p</a></span><span class="op" id="5184135">)</span><span class="op" id="5184136">)</span><span class="op" id="5184137">;</span>&nbsp;<span class="ident" id="5184139"><a href="/go/token/position.go.html#5184104">i</a></span>&nbsp;<span class="op" id="5184141">&gt;=</span>&nbsp;<span class="num" id="5184144">0</span>&nbsp;<span class="op" id="5184146">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5184150">f</span>&nbsp;<span class="op" id="5184152">:=</span>&nbsp;<span class="ident" id="5184155"><a href="/go/token/position.go.html#5183862">s</a></span><span class="op" id="5184156">.</span><span class="ident" id="5184157">files</span><span class="op" id="5184162">[</span><span class="ident" id="5184163"><a href="/go/token/position.go.html#5184104">i</a></span><span class="op" id="5184164">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5184168">//&nbsp;f.base&nbsp;&lt;=&nbsp;int(p)&nbsp;by&nbsp;definition&nbsp;of&nbsp;searchFiles</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5184219">if</span>&nbsp;<span class="builtintype" id="5184222">int</span><span class="op" id="5184225">(</span><span class="ident" id="5184226"><a href="/go/token/position.go.html#5183879">p</a></span><span class="op" id="5184227">)</span>&nbsp;<span class="op" id="5184229">&lt;=</span>&nbsp;<span class="ident" id="5184232"><a href="/go/token/position.go.html#5184150">f</a></span><span class="op" id="5184233">.</span><span class="ident" id="5184234">base</span><span class="op" id="5184238">+</span><span class="ident" id="5184239"><a href="/go/token/position.go.html#5184150">f</a></span><span class="op" id="5184240">.</span><span class="ident" id="5184241">size</span>&nbsp;<span class="op" id="5184246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5184251"><a href="/go/token/position.go.html#5183862">s</a></span><span class="op" id="5184252">.</span><span class="ident" id="5184253">mutex</span><span class="op" id="5184258">.</span><span class="ident" id="5184259">RUnlock</span><span class="op" id="5184266">(</span><span class="op" id="5184267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5184272"><a href="/go/token/position.go.html#5183862">s</a></span><span class="op" id="5184273">.</span><span class="ident" id="5184274">mutex</span><span class="op" id="5184279">.</span><span class="ident" id="5184280">Lock</span><span class="op" id="5184284">(</span><span class="op" id="5184285">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5184290"><a href="/go/token/position.go.html#5183862">s</a></span><span class="op" id="5184291">.</span><span class="ident" id="5184292">last</span>&nbsp;<span class="op" id="5184297">=</span>&nbsp;<span class="ident" id="5184299"><a href="/go/token/position.go.html#5184150">f</a></span>&nbsp;<span class="comment" id="5184301">//&nbsp;race&nbsp;is&nbsp;ok&nbsp;-&nbsp;s.last&nbsp;is&nbsp;only&nbsp;a&nbsp;cache</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5184343"><a href="/go/token/position.go.html#5183862">s</a></span><span class="op" id="5184344">.</span><span class="ident" id="5184345">mutex</span><span class="op" id="5184350">.</span><span class="ident" id="5184351">Unlock</span><span class="op" id="5184357">(</span><span class="op" id="5184358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5184363">return</span>&nbsp;<span class="ident" id="5184370"><a href="/go/token/position.go.html#5184150">f</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5184374">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5184377">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5184380"><a href="/go/token/position.go.html#5183862">s</a></span><span class="op" id="5184381">.</span><span class="ident" id="5184382">mutex</span><span class="op" id="5184387">.</span><span class="ident" id="5184388">RUnlock</span><span class="op" id="5184395">(</span><span class="op" id="5184396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5184399">return</span>&nbsp;<span class="ident" id="5184406">nil</span><br>
<span class="lineno"></span><span class="op" id="5184410">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5184413">//&nbsp;File&nbsp;returns&nbsp;the&nbsp;file&nbsp;that&nbsp;contains&nbsp;the&nbsp;position&nbsp;p.</span><br>
<span class="lineno">430</span><span class="comment" id="5184468">//&nbsp;If&nbsp;no&nbsp;such&nbsp;file&nbsp;is&nbsp;found&nbsp;(for&nbsp;instance&nbsp;for&nbsp;p&nbsp;==&nbsp;NoPos),</span><br>
<span class="lineno"></span><span class="comment" id="5184527">//&nbsp;the&nbsp;result&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="comment" id="5184549">//</span><br>
<span class="lineno"></span><span class="keyword" id="5184552">func</span>&nbsp;<span class="op" id="5184557">(</span><span class="ident" id="5184558">s</span>&nbsp;<span class="op" id="5184560">*</span><span class="ident" id="5184561"><a href="/go/token/position.go.html#5181511">FileSet</a></span><span class="op" id="5184568">)</span>&nbsp;<span class="ident" id="5184570">File</span><span class="op" id="5184574">(</span><span class="ident" id="5184575">p</span>&nbsp;<span class="ident" id="5184577"><a href="/go/token/position.go.html#5173940">Pos</a></span><span class="op" id="5184580">)</span>&nbsp;<span class="op" id="5184582">(</span><span class="ident" id="5184583">f</span>&nbsp;<span class="op" id="5184585">*</span><span class="ident" id="5184586"><a href="/go/token/position.go.html#5174541">File</a></span><span class="op" id="5184590">)</span>&nbsp;<span class="op" id="5184592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5184595">if</span>&nbsp;<span class="ident" id="5184598"><a href="/go/token/position.go.html#5184575">p</a></span>&nbsp;<span class="op" id="5184600">!=</span>&nbsp;<span class="ident" id="5184603"><a href="/go/token/position.go.html#5174218">NoPos</a></span>&nbsp;<span class="op" id="5184609">{</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5184613"><a href="/go/token/position.go.html#5184583">f</a></span>&nbsp;<span class="op" id="5184615">=</span>&nbsp;<span class="ident" id="5184617"><a href="/go/token/position.go.html#5184558">s</a></span><span class="op" id="5184618">.</span><span class="ident" id="5184619">file</span><span class="op" id="5184623">(</span><span class="ident" id="5184624"><a href="/go/token/position.go.html#5184575">p</a></span><span class="op" id="5184625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5184628">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5184631">return</span><br>
<span class="lineno"></span><span class="op" id="5184638">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">440</span><span class="comment" id="5184641">//&nbsp;PositionFor&nbsp;converts&nbsp;a&nbsp;Pos&nbsp;p&nbsp;in&nbsp;the&nbsp;fileset&nbsp;into&nbsp;a&nbsp;Position&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="5184711">//&nbsp;If&nbsp;adjusted&nbsp;is&nbsp;set,&nbsp;the&nbsp;position&nbsp;may&nbsp;be&nbsp;adjusted&nbsp;by&nbsp;position-altering</span><br>
<span class="lineno"></span><span class="comment" id="5184784">//&nbsp;//line&nbsp;comments;&nbsp;otherwise&nbsp;those&nbsp;comments&nbsp;are&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="5184842">//&nbsp;p&nbsp;must&nbsp;be&nbsp;a&nbsp;Pos&nbsp;value&nbsp;in&nbsp;s&nbsp;or&nbsp;NoPos.</span><br>
<span class="lineno"></span><span class="comment" id="5184882">//</span><br>
<span class="lineno">445</span><span class="keyword" id="5184885">func</span>&nbsp;<span class="op" id="5184890">(</span><span class="ident" id="5184891">s</span>&nbsp;<span class="op" id="5184893">*</span><span class="ident" id="5184894"><a href="/go/token/position.go.html#5181511">FileSet</a></span><span class="op" id="5184901">)</span>&nbsp;<span class="ident" id="5184903">PositionFor</span><span class="op" id="5184914">(</span><span class="ident" id="5184915">p</span>&nbsp;<span class="ident" id="5184917"><a href="/go/token/position.go.html#5173940">Pos</a></span><span class="op" id="5184920">,</span>&nbsp;<span class="ident" id="5184922">adjusted</span>&nbsp;<span class="builtintype" id="5184931">bool</span><span class="op" id="5184935">)</span>&nbsp;<span class="op" id="5184937">(</span><span class="ident" id="5184938">pos</span>&nbsp;<span class="ident" id="5184942"><a href="/go/token/position.go.html#5172109">Position</a></span><span class="op" id="5184950">)</span>&nbsp;<span class="op" id="5184952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5184955">if</span>&nbsp;<span class="ident" id="5184958"><a href="/go/token/position.go.html#5184915">p</a></span>&nbsp;<span class="op" id="5184960">!=</span>&nbsp;<span class="ident" id="5184963"><a href="/go/token/position.go.html#5174218">NoPos</a></span>&nbsp;<span class="op" id="5184969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5184973">if</span>&nbsp;<span class="ident" id="5184976">f</span>&nbsp;<span class="op" id="5184978">:=</span>&nbsp;<span class="ident" id="5184981"><a href="/go/token/position.go.html#5184891">s</a></span><span class="op" id="5184982">.</span><span class="ident" id="5184983">file</span><span class="op" id="5184987">(</span><span class="ident" id="5184988"><a href="/go/token/position.go.html#5184915">p</a></span><span class="op" id="5184989">)</span><span class="op" id="5184990">;</span>&nbsp;<span class="ident" id="5184992"><a href="/go/token/position.go.html#5184976">f</a></span>&nbsp;<span class="op" id="5184994">!=</span>&nbsp;<span class="ident" id="5184997">nil</span>&nbsp;<span class="op" id="5185001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5185006"><a href="/go/token/position.go.html#5184938">pos</a></span>&nbsp;<span class="op" id="5185010">=</span>&nbsp;<span class="ident" id="5185012"><a href="/go/token/position.go.html#5184976">f</a></span><span class="op" id="5185013">.</span><span class="ident" id="5185014">position</span><span class="op" id="5185022">(</span><span class="ident" id="5185023"><a href="/go/token/position.go.html#5184915">p</a></span><span class="op" id="5185024">,</span>&nbsp;<span class="ident" id="5185026"><a href="/go/token/position.go.html#5184922">adjusted</a></span><span class="op" id="5185034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5185038">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5185041">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5185044">return</span><br>
<span class="lineno"></span><span class="op" id="5185051">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5185054">//&nbsp;Position&nbsp;converts&nbsp;a&nbsp;Pos&nbsp;p&nbsp;in&nbsp;the&nbsp;fileset&nbsp;into&nbsp;a&nbsp;Position&nbsp;value.</span><br>
<span class="lineno">455</span><span class="comment" id="5185121">//&nbsp;Calling&nbsp;s.Position(p)&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;calling&nbsp;s.PositionFor(p,&nbsp;true).</span><br>
<span class="lineno"></span><span class="comment" id="5185195">//</span><br>
<span class="lineno"></span><span class="keyword" id="5185198">func</span>&nbsp;<span class="op" id="5185203">(</span><span class="ident" id="5185204">s</span>&nbsp;<span class="op" id="5185206">*</span><span class="ident" id="5185207"><a href="/go/token/position.go.html#5181511">FileSet</a></span><span class="op" id="5185214">)</span>&nbsp;<span class="ident" id="5185216">Position</span><span class="op" id="5185224">(</span><span class="ident" id="5185225">p</span>&nbsp;<span class="ident" id="5185227"><a href="/go/token/position.go.html#5173940">Pos</a></span><span class="op" id="5185230">)</span>&nbsp;<span class="op" id="5185232">(</span><span class="ident" id="5185233">pos</span>&nbsp;<span class="ident" id="5185237"><a href="/go/token/position.go.html#5172109">Position</a></span><span class="op" id="5185245">)</span>&nbsp;<span class="op" id="5185247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5185250">return</span>&nbsp;<span class="ident" id="5185257"><a href="/go/token/position.go.html#5185204">s</a></span><span class="op" id="5185258">.</span><span class="ident" id="5185259">PositionFor</span><span class="op" id="5185270">(</span><span class="ident" id="5185271"><a href="/go/token/position.go.html#5185225">p</a></span><span class="op" id="5185272">,</span>&nbsp;<span class="builtintype" id="5185274">true</span><span class="op" id="5185278">)</span><br>
<span class="lineno"></span><span class="op" id="5185280">}</span><br>
<span class="lineno">460</span><br>
<span class="lineno"></span><span class="comment" id="5185283">//&nbsp;-----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5185364">//&nbsp;Helper&nbsp;functions</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5185385">func</span>&nbsp;<span class="ident" id="5185390">searchInts</span><span class="op" id="5185400">(</span><span class="ident" id="5185401">a</span>&nbsp;<span class="op" id="5185403">[</span><span class="op" id="5185404">]</span><span class="builtintype" id="5185405">int</span><span class="op" id="5185408">,</span>&nbsp;<span class="ident" id="5185410">x</span>&nbsp;<span class="builtintype" id="5185412">int</span><span class="op" id="5185415">)</span>&nbsp;<span class="builtintype" id="5185417">int</span>&nbsp;<span class="op" id="5185421">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5185424">//&nbsp;This&nbsp;function&nbsp;body&nbsp;is&nbsp;a&nbsp;manually&nbsp;inlined&nbsp;version&nbsp;of:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5185481">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5185485">//&nbsp;&nbsp;&nbsp;return&nbsp;sort.Search(len(a),&nbsp;func(i&nbsp;int)&nbsp;bool&nbsp;{&nbsp;return&nbsp;a[i]&nbsp;&gt;&nbsp;x&nbsp;})&nbsp;-&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5185560">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5185564">//&nbsp;With&nbsp;better&nbsp;compiler&nbsp;optimizations,&nbsp;this&nbsp;may&nbsp;not&nbsp;be&nbsp;needed&nbsp;in&nbsp;the</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5185634">//&nbsp;future,&nbsp;but&nbsp;at&nbsp;the&nbsp;moment&nbsp;this&nbsp;change&nbsp;improves&nbsp;the&nbsp;go/printer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5185700">//&nbsp;benchmark&nbsp;performance&nbsp;by&nbsp;~30%.&nbsp;This&nbsp;has&nbsp;a&nbsp;direct&nbsp;impact&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5185767">//&nbsp;speed&nbsp;of&nbsp;gofmt&nbsp;and&nbsp;thus&nbsp;seems&nbsp;worthwhile&nbsp;(2011-04-29).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5185826">//&nbsp;TODO(gri):&nbsp;Remove&nbsp;this&nbsp;when&nbsp;compilers&nbsp;have&nbsp;caught&nbsp;up.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5185884">i</span><span class="op" id="5185885">,</span>&nbsp;<span class="ident" id="5185887">j</span>&nbsp;<span class="op" id="5185889">:=</span>&nbsp;<span class="num" id="5185892">0</span><span class="op" id="5185893">,</span>&nbsp;<span class="builtinfunc" id="5185895">len</span><span class="op" id="5185898">(</span><span class="ident" id="5185899"><a href="/go/token/position.go.html#5185401">a</a></span><span class="op" id="5185900">)</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5185903">for</span>&nbsp;<span class="ident" id="5185907"><a href="/go/token/position.go.html#5185884">i</a></span>&nbsp;<span class="op" id="5185909">&lt;</span>&nbsp;<span class="ident" id="5185911"><a href="/go/token/position.go.html#5185887">j</a></span>&nbsp;<span class="op" id="5185913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5185917">h</span>&nbsp;<span class="op" id="5185919">:=</span>&nbsp;<span class="ident" id="5185922"><a href="/go/token/position.go.html#5185884">i</a></span>&nbsp;<span class="op" id="5185924">+</span>&nbsp;<span class="op" id="5185926">(</span><span class="ident" id="5185927"><a href="/go/token/position.go.html#5185887">j</a></span><span class="op" id="5185928">-</span><span class="ident" id="5185929"><a href="/go/token/position.go.html#5185884">i</a></span><span class="op" id="5185930">)</span><span class="op" id="5185931">/</span><span class="num" id="5185932">2</span>&nbsp;<span class="comment" id="5185934">//&nbsp;avoid&nbsp;overflow&nbsp;when&nbsp;computing&nbsp;h</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5185971">//&nbsp;i&nbsp;≤&nbsp;h&nbsp;&lt;&nbsp;j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5185988">if</span>&nbsp;<span class="ident" id="5185991"><a href="/go/token/position.go.html#5185401">a</a></span><span class="op" id="5185992">[</span><span class="ident" id="5185993"><a href="/go/token/position.go.html#5185917">h</a></span><span class="op" id="5185994">]</span>&nbsp;<span class="op" id="5185996">&lt;=</span>&nbsp;<span class="ident" id="5185999"><a href="/go/token/position.go.html#5185410">x</a></span>&nbsp;<span class="op" id="5186001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5186006"><a href="/go/token/position.go.html#5185884">i</a></span>&nbsp;<span class="op" id="5186008">=</span>&nbsp;<span class="ident" id="5186010"><a href="/go/token/position.go.html#5185917">h</a></span>&nbsp;<span class="op" id="5186012">+</span>&nbsp;<span class="num" id="5186014">1</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5186018">}</span>&nbsp;<span class="keyword" id="5186020">else</span>&nbsp;<span class="op" id="5186025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5186030"><a href="/go/token/position.go.html#5185887">j</a></span>&nbsp;<span class="op" id="5186032">=</span>&nbsp;<span class="ident" id="5186034"><a href="/go/token/position.go.html#5185917">h</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5186038">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5186041">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5186044">return</span>&nbsp;<span class="ident" id="5186051"><a href="/go/token/position.go.html#5185884">i</a></span>&nbsp;<span class="op" id="5186053">-</span>&nbsp;<span class="num" id="5186055">1</span><br>
<span class="lineno">485</span><span class="op" id="5186057">}</span>
</div>
</body>
</html>
