<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6684047">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6684102">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6684156">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6684207">package</span>&nbsp;<span class="ident" id="6684215">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6684220">import</span>&nbsp;<span class="op" id="6684227">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6684230">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6684239">&#34;crypto/ecdsa&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6684255">&#34;crypto/elliptic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6684274">&#34;crypto/rsa&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6684288">&#34;encoding/hex&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6684304">&#34;encoding/pem&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6684320">&#34;errors&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6684330">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6684337">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6684343">&#34;math/big&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6684355">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6684362">&#34;os&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6684368">&#34;os/exec&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6684379">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6684396">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6684407">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6684418">&#34;time&#34;</span><br>
<span class="lineno">25</span><span class="op" id="6684425">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6684428">//&nbsp;zeroSource&nbsp;is&nbsp;an&nbsp;io.Reader&nbsp;that&nbsp;returns&nbsp;an&nbsp;unlimited&nbsp;number&nbsp;of&nbsp;zero&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="6684506">type</span>&nbsp;<span class="ident" id="6684511">zeroSource</span>&nbsp;<span class="keyword" id="6684522">struct</span><span class="op" id="6684528">{</span><span class="op" id="6684529">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="6684532">func</span>&nbsp;<span class="op" id="6684537">(</span><span class="ident" id="6684538">zeroSource</span><span class="op" id="6684548">)</span>&nbsp;<span class="ident" id="6684550">Read</span><span class="op" id="6684554">(</span><span class="ident" id="6684555">b</span>&nbsp;<span class="op" id="6684557">[</span><span class="op" id="6684558">]</span><span class="builtintype" id="6684559">byte</span><span class="op" id="6684563">)</span>&nbsp;<span class="op" id="6684565">(</span><span class="ident" id="6684566">n</span>&nbsp;<span class="builtintype" id="6684568">int</span><span class="op" id="6684571">,</span>&nbsp;<span class="ident" id="6684573">err</span>&nbsp;<span class="builtintype" id="6684577">error</span><span class="op" id="6684582">)</span>&nbsp;<span class="op" id="6684584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6684587">for</span>&nbsp;<span class="ident" id="6684591">i</span>&nbsp;<span class="op" id="6684593">:=</span>&nbsp;<span class="keyword" id="6684596">range</span>&nbsp;<span class="ident" id="6684602">b</span>&nbsp;<span class="op" id="6684604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6684608">b</span><span class="op" id="6684609">[</span><span class="ident" id="6684610">i</span><span class="op" id="6684611">]</span>&nbsp;<span class="op" id="6684613">=</span>&nbsp;<span class="num" id="6684615">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6684618">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6684622">return</span>&nbsp;<span class="builtinfunc" id="6684629">len</span><span class="op" id="6684632">(</span><span class="ident" id="6684633">b</span><span class="op" id="6684634">)</span><span class="op" id="6684635">,</span>&nbsp;<span class="ident" id="6684637">nil</span><br>
<span class="lineno"></span><span class="op" id="6684641">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6684644">var</span>&nbsp;<span class="ident" id="6684648">testConfig</span>&nbsp;<span class="op" id="6684659">*</span><span class="ident" id="6684660">Config</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="6684668">func</span>&nbsp;<span class="ident" id="6684673">init</span><span class="op" id="6684677">(</span><span class="op" id="6684678">)</span>&nbsp;<span class="op" id="6684680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6684683">testConfig</span>&nbsp;<span class="op" id="6684694">=</span>&nbsp;<span class="op" id="6684696">&amp;</span><span class="ident" id="6684697">Config</span><span class="op" id="6684703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6684707">Time</span><span class="op" id="6684711">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6684727">func</span><span class="op" id="6684731">(</span><span class="op" id="6684732">)</span>&nbsp;<span class="ident" id="6684734">time</span><span class="op" id="6684738">.</span><span class="ident" id="6684739">Time</span>&nbsp;<span class="op" id="6684744">{</span>&nbsp;<span class="keyword" id="6684746">return</span>&nbsp;<span class="ident" id="6684753">time</span><span class="op" id="6684757">.</span><span class="ident" id="6684758">Unix</span><span class="op" id="6684762">(</span><span class="num" id="6684763">0</span><span class="op" id="6684764">,</span>&nbsp;<span class="num" id="6684766">0</span><span class="op" id="6684767">)</span>&nbsp;<span class="op" id="6684769">}</span><span class="op" id="6684770">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6684774">Rand</span><span class="op" id="6684778">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6684794">zeroSource</span><span class="op" id="6684804">{</span><span class="op" id="6684805">}</span><span class="op" id="6684806">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6684810">Certificates</span><span class="op" id="6684822">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6684830">make</span><span class="op" id="6684834">(</span><span class="op" id="6684835">[</span><span class="op" id="6684836">]</span><span class="ident" id="6684837">Certificate</span><span class="op" id="6684848">,</span>&nbsp;<span class="num" id="6684850">2</span><span class="op" id="6684851">)</span><span class="op" id="6684852">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6684856">InsecureSkipVerify</span><span class="op" id="6684874">:</span>&nbsp;<span class="builtintype" id="6684876">true</span><span class="op" id="6684880">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6684884">MinVersion</span><span class="op" id="6684894">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6684904">VersionSSL30</span><span class="op" id="6684916">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6684920">MaxVersion</span><span class="op" id="6684930">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6684940">VersionTLS12</span><span class="op" id="6684952">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6684955">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6684958">testConfig</span><span class="op" id="6684968">.</span><span class="ident" id="6684969">Certificates</span><span class="op" id="6684981">[</span><span class="num" id="6684982">0</span><span class="op" id="6684983">]</span><span class="op" id="6684984">.</span><span class="ident" id="6684985">Certificate</span>&nbsp;<span class="op" id="6684997">=</span>&nbsp;<span class="op" id="6684999">[</span><span class="op" id="6685000">]</span><span class="op" id="6685001">[</span><span class="op" id="6685002">]</span><span class="builtintype" id="6685003">byte</span><span class="op" id="6685007">{</span><span class="ident" id="6685008">testRSACertificate</span><span class="op" id="6685026">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6685029">testConfig</span><span class="op" id="6685039">.</span><span class="ident" id="6685040">Certificates</span><span class="op" id="6685052">[</span><span class="num" id="6685053">0</span><span class="op" id="6685054">]</span><span class="op" id="6685055">.</span><span class="ident" id="6685056">PrivateKey</span>&nbsp;<span class="op" id="6685067">=</span>&nbsp;<span class="ident" id="6685069">testRSAPrivateKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6685088">testConfig</span><span class="op" id="6685098">.</span><span class="ident" id="6685099">Certificates</span><span class="op" id="6685111">[</span><span class="num" id="6685112">1</span><span class="op" id="6685113">]</span><span class="op" id="6685114">.</span><span class="ident" id="6685115">Certificate</span>&nbsp;<span class="op" id="6685127">=</span>&nbsp;<span class="op" id="6685129">[</span><span class="op" id="6685130">]</span><span class="op" id="6685131">[</span><span class="op" id="6685132">]</span><span class="builtintype" id="6685133">byte</span><span class="op" id="6685137">{</span><span class="ident" id="6685138">testSNICertificate</span><span class="op" id="6685156">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6685159">testConfig</span><span class="op" id="6685169">.</span><span class="ident" id="6685170">Certificates</span><span class="op" id="6685182">[</span><span class="num" id="6685183">1</span><span class="op" id="6685184">]</span><span class="op" id="6685185">.</span><span class="ident" id="6685186">PrivateKey</span>&nbsp;<span class="op" id="6685197">=</span>&nbsp;<span class="ident" id="6685199">testRSAPrivateKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6685218">testConfig</span><span class="op" id="6685228">.</span><span class="ident" id="6685229">BuildNameToCertificate</span><span class="op" id="6685251">(</span><span class="op" id="6685252">)</span><br>
<span class="lineno"></span><span class="op" id="6685254">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="keyword" id="6685257">func</span>&nbsp;<span class="ident" id="6685262">testClientHelloFailure</span><span class="op" id="6685284">(</span><span class="ident" id="6685285">t</span>&nbsp;<span class="op" id="6685287">*</span><span class="ident" id="6685288">testing</span><span class="op" id="6685295">.</span><span class="ident" id="6685296">T</span><span class="op" id="6685297">,</span>&nbsp;<span class="ident" id="6685299">m</span>&nbsp;<span class="ident" id="6685301">handshakeMessage</span><span class="op" id="6685317">,</span>&nbsp;<span class="ident" id="6685319">expectedSubStr</span>&nbsp;<span class="builtintype" id="6685334">string</span><span class="op" id="6685340">)</span>&nbsp;<span class="op" id="6685342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6685345">//&nbsp;Create&nbsp;in-memory&nbsp;network&nbsp;connection,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6685386">//&nbsp;send&nbsp;message&nbsp;to&nbsp;server.&nbsp;&nbsp;Should&nbsp;return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6685429">//&nbsp;expected&nbsp;error.</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6685449">c</span><span class="op" id="6685450">,</span>&nbsp;<span class="ident" id="6685452">s</span>&nbsp;<span class="op" id="6685454">:=</span>&nbsp;<span class="ident" id="6685457">net</span><span class="op" id="6685460">.</span><span class="ident" id="6685461">Pipe</span><span class="op" id="6685465">(</span><span class="op" id="6685466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6685469">go</span>&nbsp;<span class="keyword" id="6685472">func</span><span class="op" id="6685476">(</span><span class="op" id="6685477">)</span>&nbsp;<span class="op" id="6685479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6685483">cli</span>&nbsp;<span class="op" id="6685487">:=</span>&nbsp;<span class="ident" id="6685490">Client</span><span class="op" id="6685496">(</span><span class="ident" id="6685497">c</span><span class="op" id="6685498">,</span>&nbsp;<span class="ident" id="6685500">testConfig</span><span class="op" id="6685510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6685514">if</span>&nbsp;<span class="ident" id="6685517">ch</span><span class="op" id="6685519">,</span>&nbsp;<span class="ident" id="6685521">ok</span>&nbsp;<span class="op" id="6685524">:=</span>&nbsp;<span class="ident" id="6685527">m</span><span class="op" id="6685528">.</span><span class="op" id="6685529">(</span><span class="op" id="6685530">*</span><span class="ident" id="6685531">clientHelloMsg</span><span class="op" id="6685545">)</span><span class="op" id="6685546">;</span>&nbsp;<span class="ident" id="6685548">ok</span>&nbsp;<span class="op" id="6685551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6685556">cli</span><span class="op" id="6685559">.</span><span class="ident" id="6685560">vers</span>&nbsp;<span class="op" id="6685565">=</span>&nbsp;<span class="ident" id="6685567">ch</span><span class="op" id="6685569">.</span><span class="ident" id="6685570">vers</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6685577">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6685581">cli</span><span class="op" id="6685584">.</span><span class="ident" id="6685585">writeRecord</span><span class="op" id="6685596">(</span><span class="ident" id="6685597">recordTypeHandshake</span><span class="op" id="6685616">,</span>&nbsp;<span class="ident" id="6685618">m</span><span class="op" id="6685619">.</span><span class="ident" id="6685620">marshal</span><span class="op" id="6685627">(</span><span class="op" id="6685628">)</span><span class="op" id="6685629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6685633">c</span><span class="op" id="6685634">.</span><span class="ident" id="6685635">Close</span><span class="op" id="6685640">(</span><span class="op" id="6685641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6685644">}</span><span class="op" id="6685645">(</span><span class="op" id="6685646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6685649">err</span>&nbsp;<span class="op" id="6685653">:=</span>&nbsp;<span class="ident" id="6685656">Server</span><span class="op" id="6685662">(</span><span class="ident" id="6685663">s</span><span class="op" id="6685664">,</span>&nbsp;<span class="ident" id="6685666">testConfig</span><span class="op" id="6685676">)</span><span class="op" id="6685677">.</span><span class="ident" id="6685678">Handshake</span><span class="op" id="6685687">(</span><span class="op" id="6685688">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6685691">s</span><span class="op" id="6685692">.</span><span class="ident" id="6685693">Close</span><span class="op" id="6685698">(</span><span class="op" id="6685699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6685702">if</span>&nbsp;<span class="ident" id="6685705">err</span>&nbsp;<span class="op" id="6685709">==</span>&nbsp;<span class="ident" id="6685712">nil</span>&nbsp;<span class="op" id="6685716">||</span>&nbsp;<span class="op" id="6685719">!</span><span class="ident" id="6685720">strings</span><span class="op" id="6685727">.</span><span class="ident" id="6685728">Contains</span><span class="op" id="6685736">(</span><span class="ident" id="6685737">err</span><span class="op" id="6685740">.</span><span class="ident" id="6685741">Error</span><span class="op" id="6685746">(</span><span class="op" id="6685747">)</span><span class="op" id="6685748">,</span>&nbsp;<span class="ident" id="6685750">expectedSubStr</span><span class="op" id="6685764">)</span>&nbsp;<span class="op" id="6685766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6685770">t</span><span class="op" id="6685771">.</span><span class="ident" id="6685772">Errorf</span><span class="op" id="6685778">(</span><span class="string" id="6685779">&#34;Got&nbsp;error:&nbsp;%s;&nbsp;expected&nbsp;to&nbsp;match&nbsp;substring&nbsp;&#39;%s&#39;&#34;</span><span class="op" id="6685828">,</span>&nbsp;<span class="ident" id="6685830">err</span><span class="op" id="6685833">,</span>&nbsp;<span class="ident" id="6685835">expectedSubStr</span><span class="op" id="6685849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6685852">}</span><br>
<span class="lineno"></span><span class="op" id="6685854">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="keyword" id="6685857">func</span>&nbsp;<span class="ident" id="6685862">TestSimpleError</span><span class="op" id="6685877">(</span><span class="ident" id="6685878">t</span>&nbsp;<span class="op" id="6685880">*</span><span class="ident" id="6685881">testing</span><span class="op" id="6685888">.</span><span class="ident" id="6685889">T</span><span class="op" id="6685890">)</span>&nbsp;<span class="op" id="6685892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6685895">testClientHelloFailure</span><span class="op" id="6685917">(</span><span class="ident" id="6685918">t</span><span class="op" id="6685919">,</span>&nbsp;<span class="op" id="6685921">&amp;</span><span class="ident" id="6685922">serverHelloDoneMsg</span><span class="op" id="6685940">{</span><span class="op" id="6685941">}</span><span class="op" id="6685942">,</span>&nbsp;<span class="string" id="6685944">&#34;unexpected&nbsp;handshake&nbsp;message&#34;</span><span class="op" id="6685974">)</span><br>
<span class="lineno"></span><span class="op" id="6685976">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="6685979">var</span>&nbsp;<span class="ident" id="6685983">badProtocolVersions</span>&nbsp;<span class="op" id="6686003">=</span>&nbsp;<span class="op" id="6686005">[</span><span class="op" id="6686006">]</span><span class="builtintype" id="6686007">uint16</span><span class="op" id="6686013">{</span><span class="num" id="6686014">0x0000</span><span class="op" id="6686020">,</span>&nbsp;<span class="num" id="6686022">0x0005</span><span class="op" id="6686028">,</span>&nbsp;<span class="num" id="6686030">0x0100</span><span class="op" id="6686036">,</span>&nbsp;<span class="num" id="6686038">0x0105</span><span class="op" id="6686044">,</span>&nbsp;<span class="num" id="6686046">0x0200</span><span class="op" id="6686052">,</span>&nbsp;<span class="num" id="6686054">0x0205</span><span class="op" id="6686060">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6686063">func</span>&nbsp;<span class="ident" id="6686068">TestRejectBadProtocolVersion</span><span class="op" id="6686096">(</span><span class="ident" id="6686097">t</span>&nbsp;<span class="op" id="6686099">*</span><span class="ident" id="6686100">testing</span><span class="op" id="6686107">.</span><span class="ident" id="6686108">T</span><span class="op" id="6686109">)</span>&nbsp;<span class="op" id="6686111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6686114">for</span>&nbsp;<span class="ident" id="6686118">_</span><span class="op" id="6686119">,</span>&nbsp;<span class="ident" id="6686121">v</span>&nbsp;<span class="op" id="6686123">:=</span>&nbsp;<span class="keyword" id="6686126">range</span>&nbsp;<span class="ident" id="6686132">badProtocolVersions</span>&nbsp;<span class="op" id="6686152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6686156">testClientHelloFailure</span><span class="op" id="6686178">(</span><span class="ident" id="6686179">t</span><span class="op" id="6686180">,</span>&nbsp;<span class="op" id="6686182">&amp;</span><span class="ident" id="6686183">clientHelloMsg</span><span class="op" id="6686197">{</span><span class="ident" id="6686198">vers</span><span class="op" id="6686202">:</span>&nbsp;<span class="ident" id="6686204">v</span><span class="op" id="6686205">}</span><span class="op" id="6686206">,</span>&nbsp;<span class="string" id="6686208">&#34;unsupported,&nbsp;maximum&nbsp;protocol&nbsp;version&#34;</span><span class="op" id="6686247">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6686250">}</span><br>
<span class="lineno"></span><span class="op" id="6686252">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6686255">func</span>&nbsp;<span class="ident" id="6686260">TestNoSuiteOverlap</span><span class="op" id="6686278">(</span><span class="ident" id="6686279">t</span>&nbsp;<span class="op" id="6686281">*</span><span class="ident" id="6686282">testing</span><span class="op" id="6686289">.</span><span class="ident" id="6686290">T</span><span class="op" id="6686291">)</span>&nbsp;<span class="op" id="6686293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6686296">clientHello</span>&nbsp;<span class="op" id="6686308">:=</span>&nbsp;<span class="op" id="6686311">&amp;</span><span class="ident" id="6686312">clientHelloMsg</span><span class="op" id="6686326">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6686330">vers</span><span class="op" id="6686334">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6686350">0x0301</span><span class="op" id="6686356">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6686360">cipherSuites</span><span class="op" id="6686372">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6686380">[</span><span class="op" id="6686381">]</span><span class="builtintype" id="6686382">uint16</span><span class="op" id="6686388">{</span><span class="num" id="6686389">0xff00</span><span class="op" id="6686395">}</span><span class="op" id="6686396">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6686400">compressionMethods</span><span class="op" id="6686418">:</span>&nbsp;<span class="op" id="6686420">[</span><span class="op" id="6686421">]</span><span class="builtintype" id="6686422">uint8</span><span class="op" id="6686427">{</span><span class="num" id="6686428">0</span><span class="op" id="6686429">}</span><span class="op" id="6686430">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6686433">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6686436">testClientHelloFailure</span><span class="op" id="6686458">(</span><span class="ident" id="6686459">t</span><span class="op" id="6686460">,</span>&nbsp;<span class="ident" id="6686462">clientHello</span><span class="op" id="6686473">,</span>&nbsp;<span class="string" id="6686475">&#34;no&nbsp;cipher&nbsp;suite&nbsp;supported&nbsp;by&nbsp;both&nbsp;client&nbsp;and&nbsp;server&#34;</span><span class="op" id="6686528">)</span><br>
<span class="lineno">95</span><span class="op" id="6686530">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6686533">func</span>&nbsp;<span class="ident" id="6686538">TestNoCompressionOverlap</span><span class="op" id="6686562">(</span><span class="ident" id="6686563">t</span>&nbsp;<span class="op" id="6686565">*</span><span class="ident" id="6686566">testing</span><span class="op" id="6686573">.</span><span class="ident" id="6686574">T</span><span class="op" id="6686575">)</span>&nbsp;<span class="op" id="6686577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6686580">clientHello</span>&nbsp;<span class="op" id="6686592">:=</span>&nbsp;<span class="op" id="6686595">&amp;</span><span class="ident" id="6686596">clientHelloMsg</span><span class="op" id="6686610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6686614">vers</span><span class="op" id="6686618">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6686634">0x0301</span><span class="op" id="6686640">,</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6686644">cipherSuites</span><span class="op" id="6686656">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6686664">[</span><span class="op" id="6686665">]</span><span class="builtintype" id="6686666">uint16</span><span class="op" id="6686672">{</span><span class="ident" id="6686673">TLS_RSA_WITH_RC4_128_SHA</span><span class="op" id="6686697">}</span><span class="op" id="6686698">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6686702">compressionMethods</span><span class="op" id="6686720">:</span>&nbsp;<span class="op" id="6686722">[</span><span class="op" id="6686723">]</span><span class="builtintype" id="6686724">uint8</span><span class="op" id="6686729">{</span><span class="num" id="6686730">0xff</span><span class="op" id="6686734">}</span><span class="op" id="6686735">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6686738">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6686741">testClientHelloFailure</span><span class="op" id="6686763">(</span><span class="ident" id="6686764">t</span><span class="op" id="6686765">,</span>&nbsp;<span class="ident" id="6686767">clientHello</span><span class="op" id="6686778">,</span>&nbsp;<span class="string" id="6686780">&#34;client&nbsp;does&nbsp;not&nbsp;support&nbsp;uncompressed&nbsp;connections&#34;</span><span class="op" id="6686830">)</span><br>
<span class="lineno"></span><span class="op" id="6686832">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="6686835">func</span>&nbsp;<span class="ident" id="6686840">TestTLS12OnlyCipherSuites</span><span class="op" id="6686865">(</span><span class="ident" id="6686866">t</span>&nbsp;<span class="op" id="6686868">*</span><span class="ident" id="6686869">testing</span><span class="op" id="6686876">.</span><span class="ident" id="6686877">T</span><span class="op" id="6686878">)</span>&nbsp;<span class="op" id="6686880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6686883">//&nbsp;Test&nbsp;that&nbsp;a&nbsp;Server&nbsp;doesn&#39;t&nbsp;select&nbsp;a&nbsp;TLS&nbsp;1.2-only&nbsp;cipher&nbsp;suite&nbsp;when</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6686954">//&nbsp;the&nbsp;client&nbsp;negotiates&nbsp;TLS&nbsp;1.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6686989">var</span>&nbsp;<span class="ident" id="6686993">zeros</span>&nbsp;<span class="op" id="6686999">[</span><span class="num" id="6687000">32</span><span class="op" id="6687002">]</span><span class="builtintype" id="6687003">byte</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6687010">clientHello</span>&nbsp;<span class="op" id="6687022">:=</span>&nbsp;<span class="op" id="6687025">&amp;</span><span class="ident" id="6687026">clientHelloMsg</span><span class="op" id="6687040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6687044">vers</span><span class="op" id="6687048">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6687052">VersionTLS11</span><span class="op" id="6687064">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6687068">random</span><span class="op" id="6687074">:</span>&nbsp;<span class="ident" id="6687076">zeros</span><span class="op" id="6687081">[</span><span class="op" id="6687082">:</span><span class="op" id="6687083">]</span><span class="op" id="6687084">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6687088">cipherSuites</span><span class="op" id="6687100">:</span>&nbsp;<span class="op" id="6687102">[</span><span class="op" id="6687103">]</span><span class="builtintype" id="6687104">uint16</span><span class="op" id="6687110">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6687115">//&nbsp;The&nbsp;Server,&nbsp;by&nbsp;default,&nbsp;will&nbsp;use&nbsp;the&nbsp;client&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6687167">//&nbsp;preference&nbsp;order.&nbsp;So&nbsp;the&nbsp;GCM&nbsp;cipher&nbsp;suite</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6687215">//&nbsp;will&nbsp;be&nbsp;selected&nbsp;unless&nbsp;it&#39;s&nbsp;excluded&nbsp;because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6687267">//&nbsp;of&nbsp;the&nbsp;version&nbsp;in&nbsp;this&nbsp;ClientHello.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6687309">TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256</span><span class="op" id="6687346">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6687351">TLS_RSA_WITH_RC4_128_SHA</span><span class="op" id="6687375">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6687379">}</span><span class="op" id="6687380">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6687384">compressionMethods</span><span class="op" id="6687402">:</span>&nbsp;<span class="op" id="6687404">[</span><span class="op" id="6687405">]</span><span class="builtintype" id="6687406">uint8</span><span class="op" id="6687411">{</span><span class="ident" id="6687412">compressionNone</span><span class="op" id="6687427">}</span><span class="op" id="6687428">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6687432">supportedCurves</span><span class="op" id="6687447">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6687452">[</span><span class="op" id="6687453">]</span><span class="ident" id="6687454">CurveID</span><span class="op" id="6687461">{</span><span class="ident" id="6687462">CurveP256</span><span class="op" id="6687471">,</span>&nbsp;<span class="ident" id="6687473">CurveP384</span><span class="op" id="6687482">,</span>&nbsp;<span class="ident" id="6687484">CurveP521</span><span class="op" id="6687493">}</span><span class="op" id="6687494">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6687498">supportedPoints</span><span class="op" id="6687513">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6687518">[</span><span class="op" id="6687519">]</span><span class="builtintype" id="6687520">uint8</span><span class="op" id="6687525">{</span><span class="ident" id="6687526">pointFormatUncompressed</span><span class="op" id="6687549">}</span><span class="op" id="6687550">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6687553">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6687557">c</span><span class="op" id="6687558">,</span>&nbsp;<span class="ident" id="6687560">s</span>&nbsp;<span class="op" id="6687562">:=</span>&nbsp;<span class="ident" id="6687565">net</span><span class="op" id="6687568">.</span><span class="ident" id="6687569">Pipe</span><span class="op" id="6687573">(</span><span class="op" id="6687574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6687577">var</span>&nbsp;<span class="ident" id="6687581">reply</span>&nbsp;<span class="keyword" id="6687587">interface</span><span class="op" id="6687596">{</span><span class="op" id="6687597">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6687600">var</span>&nbsp;<span class="ident" id="6687604">clientErr</span>&nbsp;<span class="builtintype" id="6687614">error</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6687621">go</span>&nbsp;<span class="keyword" id="6687624">func</span><span class="op" id="6687628">(</span><span class="op" id="6687629">)</span>&nbsp;<span class="op" id="6687631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6687635">cli</span>&nbsp;<span class="op" id="6687639">:=</span>&nbsp;<span class="ident" id="6687642">Client</span><span class="op" id="6687648">(</span><span class="ident" id="6687649">c</span><span class="op" id="6687650">,</span>&nbsp;<span class="ident" id="6687652">testConfig</span><span class="op" id="6687662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6687666">cli</span><span class="op" id="6687669">.</span><span class="ident" id="6687670">vers</span>&nbsp;<span class="op" id="6687675">=</span>&nbsp;<span class="ident" id="6687677">clientHello</span><span class="op" id="6687688">.</span><span class="ident" id="6687689">vers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6687696">cli</span><span class="op" id="6687699">.</span><span class="ident" id="6687700">writeRecord</span><span class="op" id="6687711">(</span><span class="ident" id="6687712">recordTypeHandshake</span><span class="op" id="6687731">,</span>&nbsp;<span class="ident" id="6687733">clientHello</span><span class="op" id="6687744">.</span><span class="ident" id="6687745">marshal</span><span class="op" id="6687752">(</span><span class="op" id="6687753">)</span><span class="op" id="6687754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6687758">reply</span><span class="op" id="6687763">,</span>&nbsp;<span class="ident" id="6687765">clientErr</span>&nbsp;<span class="op" id="6687775">=</span>&nbsp;<span class="ident" id="6687777">cli</span><span class="op" id="6687780">.</span><span class="ident" id="6687781">readHandshake</span><span class="op" id="6687794">(</span><span class="op" id="6687795">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6687799">c</span><span class="op" id="6687800">.</span><span class="ident" id="6687801">Close</span><span class="op" id="6687806">(</span><span class="op" id="6687807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6687810">}</span><span class="op" id="6687811">(</span><span class="op" id="6687812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6687815">config</span>&nbsp;<span class="op" id="6687822">:=</span>&nbsp;<span class="op" id="6687825">*</span><span class="ident" id="6687826">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6687838">config</span><span class="op" id="6687844">.</span><span class="ident" id="6687845">CipherSuites</span>&nbsp;<span class="op" id="6687858">=</span>&nbsp;<span class="ident" id="6687860">clientHello</span><span class="op" id="6687871">.</span><span class="ident" id="6687872">cipherSuites</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6687886">Server</span><span class="op" id="6687892">(</span><span class="ident" id="6687893">s</span><span class="op" id="6687894">,</span>&nbsp;<span class="op" id="6687896">&amp;</span><span class="ident" id="6687897">config</span><span class="op" id="6687903">)</span><span class="op" id="6687904">.</span><span class="ident" id="6687905">Handshake</span><span class="op" id="6687914">(</span><span class="op" id="6687915">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6687918">s</span><span class="op" id="6687919">.</span><span class="ident" id="6687920">Close</span><span class="op" id="6687925">(</span><span class="op" id="6687926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6687929">if</span>&nbsp;<span class="ident" id="6687932">clientErr</span>&nbsp;<span class="op" id="6687942">!=</span>&nbsp;<span class="ident" id="6687945">nil</span>&nbsp;<span class="op" id="6687949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6687953">t</span><span class="op" id="6687954">.</span><span class="ident" id="6687955">Fatal</span><span class="op" id="6687960">(</span><span class="ident" id="6687961">clientErr</span><span class="op" id="6687970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6687973">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6687976">serverHello</span><span class="op" id="6687987">,</span>&nbsp;<span class="ident" id="6687989">ok</span>&nbsp;<span class="op" id="6687992">:=</span>&nbsp;<span class="ident" id="6687995">reply</span><span class="op" id="6688000">.</span><span class="op" id="6688001">(</span><span class="op" id="6688002">*</span><span class="ident" id="6688003">serverHelloMsg</span><span class="op" id="6688017">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6688020">if</span>&nbsp;<span class="op" id="6688023">!</span><span class="ident" id="6688024">ok</span>&nbsp;<span class="op" id="6688027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6688031">t</span><span class="op" id="6688032">.</span><span class="ident" id="6688033">Fatalf</span><span class="op" id="6688039">(</span><span class="string" id="6688040">&#34;didn&#39;t&nbsp;get&nbsp;ServerHello&nbsp;message&nbsp;in&nbsp;reply.&nbsp;Got&nbsp;%v\n&#34;</span><span class="op" id="6688091">,</span>&nbsp;<span class="ident" id="6688093">reply</span><span class="op" id="6688098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6688101">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6688104">if</span>&nbsp;<span class="ident" id="6688107">s</span>&nbsp;<span class="op" id="6688109">:=</span>&nbsp;<span class="ident" id="6688112">serverHello</span><span class="op" id="6688123">.</span><span class="ident" id="6688124">cipherSuite</span><span class="op" id="6688135">;</span>&nbsp;<span class="ident" id="6688137">s</span>&nbsp;<span class="op" id="6688139">!=</span>&nbsp;<span class="ident" id="6688142">TLS_RSA_WITH_RC4_128_SHA</span>&nbsp;<span class="op" id="6688167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6688171">t</span><span class="op" id="6688172">.</span><span class="ident" id="6688173">Fatalf</span><span class="op" id="6688179">(</span><span class="string" id="6688180">&#34;bad&nbsp;cipher&nbsp;suite&nbsp;from&nbsp;server:&nbsp;%x&#34;</span><span class="op" id="6688214">,</span>&nbsp;<span class="ident" id="6688216">s</span><span class="op" id="6688217">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6688220">}</span><br>
<span class="lineno"></span><span class="op" id="6688222">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6688225">func</span>&nbsp;<span class="ident" id="6688230">TestAlertForwarding</span><span class="op" id="6688249">(</span><span class="ident" id="6688250">t</span>&nbsp;<span class="op" id="6688252">*</span><span class="ident" id="6688253">testing</span><span class="op" id="6688260">.</span><span class="ident" id="6688261">T</span><span class="op" id="6688262">)</span>&nbsp;<span class="op" id="6688264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6688267">c</span><span class="op" id="6688268">,</span>&nbsp;<span class="ident" id="6688270">s</span>&nbsp;<span class="op" id="6688272">:=</span>&nbsp;<span class="ident" id="6688275">net</span><span class="op" id="6688278">.</span><span class="ident" id="6688279">Pipe</span><span class="op" id="6688283">(</span><span class="op" id="6688284">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6688287">go</span>&nbsp;<span class="keyword" id="6688290">func</span><span class="op" id="6688294">(</span><span class="op" id="6688295">)</span>&nbsp;<span class="op" id="6688297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6688301">Client</span><span class="op" id="6688307">(</span><span class="ident" id="6688308">c</span><span class="op" id="6688309">,</span>&nbsp;<span class="ident" id="6688311">testConfig</span><span class="op" id="6688321">)</span><span class="op" id="6688322">.</span><span class="ident" id="6688323">sendAlert</span><span class="op" id="6688332">(</span><span class="ident" id="6688333">alertUnknownCA</span><span class="op" id="6688347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6688351">c</span><span class="op" id="6688352">.</span><span class="ident" id="6688353">Close</span><span class="op" id="6688358">(</span><span class="op" id="6688359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6688362">}</span><span class="op" id="6688363">(</span><span class="op" id="6688364">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6688368">err</span>&nbsp;<span class="op" id="6688372">:=</span>&nbsp;<span class="ident" id="6688375">Server</span><span class="op" id="6688381">(</span><span class="ident" id="6688382">s</span><span class="op" id="6688383">,</span>&nbsp;<span class="ident" id="6688385">testConfig</span><span class="op" id="6688395">)</span><span class="op" id="6688396">.</span><span class="ident" id="6688397">Handshake</span><span class="op" id="6688406">(</span><span class="op" id="6688407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6688410">s</span><span class="op" id="6688411">.</span><span class="ident" id="6688412">Close</span><span class="op" id="6688417">(</span><span class="op" id="6688418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6688421">if</span>&nbsp;<span class="ident" id="6688424">e</span><span class="op" id="6688425">,</span>&nbsp;<span class="ident" id="6688427">ok</span>&nbsp;<span class="op" id="6688430">:=</span>&nbsp;<span class="ident" id="6688433">err</span><span class="op" id="6688436">.</span><span class="op" id="6688437">(</span><span class="op" id="6688438">*</span><span class="ident" id="6688439">net</span><span class="op" id="6688442">.</span><span class="ident" id="6688443">OpError</span><span class="op" id="6688450">)</span><span class="op" id="6688451">;</span>&nbsp;<span class="op" id="6688453">!</span><span class="ident" id="6688454">ok</span>&nbsp;<span class="op" id="6688457">||</span>&nbsp;<span class="ident" id="6688460">e</span><span class="op" id="6688461">.</span><span class="ident" id="6688462">Err</span>&nbsp;<span class="op" id="6688466">!=</span>&nbsp;<span class="builtintype" id="6688469">error</span><span class="op" id="6688474">(</span><span class="ident" id="6688475">alertUnknownCA</span><span class="op" id="6688489">)</span>&nbsp;<span class="op" id="6688491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6688495">t</span><span class="op" id="6688496">.</span><span class="ident" id="6688497">Errorf</span><span class="op" id="6688503">(</span><span class="string" id="6688504">&#34;Got&nbsp;error:&nbsp;%s;&nbsp;expected:&nbsp;%s&#34;</span><span class="op" id="6688533">,</span>&nbsp;<span class="ident" id="6688535">err</span><span class="op" id="6688538">,</span>&nbsp;<span class="builtintype" id="6688540">error</span><span class="op" id="6688545">(</span><span class="ident" id="6688546">alertUnknownCA</span><span class="op" id="6688560">)</span><span class="op" id="6688561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6688564">}</span><br>
<span class="lineno">165</span><span class="op" id="6688566">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6688569">func</span>&nbsp;<span class="ident" id="6688574">TestClose</span><span class="op" id="6688583">(</span><span class="ident" id="6688584">t</span>&nbsp;<span class="op" id="6688586">*</span><span class="ident" id="6688587">testing</span><span class="op" id="6688594">.</span><span class="ident" id="6688595">T</span><span class="op" id="6688596">)</span>&nbsp;<span class="op" id="6688598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6688601">c</span><span class="op" id="6688602">,</span>&nbsp;<span class="ident" id="6688604">s</span>&nbsp;<span class="op" id="6688606">:=</span>&nbsp;<span class="ident" id="6688609">net</span><span class="op" id="6688612">.</span><span class="ident" id="6688613">Pipe</span><span class="op" id="6688617">(</span><span class="op" id="6688618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6688621">go</span>&nbsp;<span class="ident" id="6688624">c</span><span class="op" id="6688625">.</span><span class="ident" id="6688626">Close</span><span class="op" id="6688631">(</span><span class="op" id="6688632">)</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6688636">err</span>&nbsp;<span class="op" id="6688640">:=</span>&nbsp;<span class="ident" id="6688643">Server</span><span class="op" id="6688649">(</span><span class="ident" id="6688650">s</span><span class="op" id="6688651">,</span>&nbsp;<span class="ident" id="6688653">testConfig</span><span class="op" id="6688663">)</span><span class="op" id="6688664">.</span><span class="ident" id="6688665">Handshake</span><span class="op" id="6688674">(</span><span class="op" id="6688675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6688678">s</span><span class="op" id="6688679">.</span><span class="ident" id="6688680">Close</span><span class="op" id="6688685">(</span><span class="op" id="6688686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6688689">if</span>&nbsp;<span class="ident" id="6688692">err</span>&nbsp;<span class="op" id="6688696">!=</span>&nbsp;<span class="ident" id="6688699">io</span><span class="op" id="6688701">.</span><span class="ident" id="6688702">EOF</span>&nbsp;<span class="op" id="6688706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6688710">t</span><span class="op" id="6688711">.</span><span class="ident" id="6688712">Errorf</span><span class="op" id="6688718">(</span><span class="string" id="6688719">&#34;Got&nbsp;error:&nbsp;%s;&nbsp;expected:&nbsp;%s&#34;</span><span class="op" id="6688748">,</span>&nbsp;<span class="ident" id="6688750">err</span><span class="op" id="6688753">,</span>&nbsp;<span class="ident" id="6688755">io</span><span class="op" id="6688757">.</span><span class="ident" id="6688758">EOF</span><span class="op" id="6688761">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6688764">}</span><br>
<span class="lineno"></span><span class="op" id="6688766">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6688769">func</span>&nbsp;<span class="ident" id="6688774">testHandshake</span><span class="op" id="6688787">(</span><span class="ident" id="6688788">clientConfig</span><span class="op" id="6688800">,</span>&nbsp;<span class="ident" id="6688802">serverConfig</span>&nbsp;<span class="op" id="6688815">*</span><span class="ident" id="6688816">Config</span><span class="op" id="6688822">)</span>&nbsp;<span class="op" id="6688824">(</span><span class="ident" id="6688825">state</span>&nbsp;<span class="ident" id="6688831">ConnectionState</span><span class="op" id="6688846">,</span>&nbsp;<span class="ident" id="6688848">err</span>&nbsp;<span class="builtintype" id="6688852">error</span><span class="op" id="6688857">)</span>&nbsp;<span class="op" id="6688859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6688862">c</span><span class="op" id="6688863">,</span>&nbsp;<span class="ident" id="6688865">s</span>&nbsp;<span class="op" id="6688867">:=</span>&nbsp;<span class="ident" id="6688870">net</span><span class="op" id="6688873">.</span><span class="ident" id="6688874">Pipe</span><span class="op" id="6688878">(</span><span class="op" id="6688879">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6688882">done</span>&nbsp;<span class="op" id="6688887">:=</span>&nbsp;<span class="builtinfunc" id="6688890">make</span><span class="op" id="6688894">(</span><span class="keyword" id="6688895">chan</span>&nbsp;<span class="builtintype" id="6688900">bool</span><span class="op" id="6688904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6688907">go</span>&nbsp;<span class="keyword" id="6688910">func</span><span class="op" id="6688914">(</span><span class="op" id="6688915">)</span>&nbsp;<span class="op" id="6688917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6688921">cli</span>&nbsp;<span class="op" id="6688925">:=</span>&nbsp;<span class="ident" id="6688928">Client</span><span class="op" id="6688934">(</span><span class="ident" id="6688935">c</span><span class="op" id="6688936">,</span>&nbsp;<span class="ident" id="6688938">clientConfig</span><span class="op" id="6688950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6688954">cli</span><span class="op" id="6688957">.</span><span class="ident" id="6688958">Handshake</span><span class="op" id="6688967">(</span><span class="op" id="6688968">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6688972">c</span><span class="op" id="6688973">.</span><span class="ident" id="6688974">Close</span><span class="op" id="6688979">(</span><span class="op" id="6688980">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6688984">done</span>&nbsp;<span class="op" id="6688989">&lt;-</span>&nbsp;<span class="builtintype" id="6688992">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6688998">}</span><span class="op" id="6688999">(</span><span class="op" id="6689000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6689003">server</span>&nbsp;<span class="op" id="6689010">:=</span>&nbsp;<span class="ident" id="6689013">Server</span><span class="op" id="6689019">(</span><span class="ident" id="6689020">s</span><span class="op" id="6689021">,</span>&nbsp;<span class="ident" id="6689023">serverConfig</span><span class="op" id="6689035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6689038">err</span>&nbsp;<span class="op" id="6689042">=</span>&nbsp;<span class="ident" id="6689044">server</span><span class="op" id="6689050">.</span><span class="ident" id="6689051">Handshake</span><span class="op" id="6689060">(</span><span class="op" id="6689061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6689064">if</span>&nbsp;<span class="ident" id="6689067">err</span>&nbsp;<span class="op" id="6689071">==</span>&nbsp;<span class="ident" id="6689074">nil</span>&nbsp;<span class="op" id="6689078">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6689082">state</span>&nbsp;<span class="op" id="6689088">=</span>&nbsp;<span class="ident" id="6689090">server</span><span class="op" id="6689096">.</span><span class="ident" id="6689097">ConnectionState</span><span class="op" id="6689112">(</span><span class="op" id="6689113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6689116">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6689119">s</span><span class="op" id="6689120">.</span><span class="ident" id="6689121">Close</span><span class="op" id="6689126">(</span><span class="op" id="6689127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6689130">&lt;-</span><span class="ident" id="6689132">done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6689138">return</span><br>
<span class="lineno">195</span><span class="op" id="6689145">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6689148">func</span>&nbsp;<span class="ident" id="6689153">TestVersion</span><span class="op" id="6689164">(</span><span class="ident" id="6689165">t</span>&nbsp;<span class="op" id="6689167">*</span><span class="ident" id="6689168">testing</span><span class="op" id="6689175">.</span><span class="ident" id="6689176">T</span><span class="op" id="6689177">)</span>&nbsp;<span class="op" id="6689179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6689182">serverConfig</span>&nbsp;<span class="op" id="6689195">:=</span>&nbsp;<span class="op" id="6689198">&amp;</span><span class="ident" id="6689199">Config</span><span class="op" id="6689205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6689209">Certificates</span><span class="op" id="6689221">:</span>&nbsp;<span class="ident" id="6689223">testConfig</span><span class="op" id="6689233">.</span><span class="ident" id="6689234">Certificates</span><span class="op" id="6689246">,</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6689250">MaxVersion</span><span class="op" id="6689260">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6689264">VersionTLS11</span><span class="op" id="6689276">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6689279">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6689282">clientConfig</span>&nbsp;<span class="op" id="6689295">:=</span>&nbsp;<span class="op" id="6689298">&amp;</span><span class="ident" id="6689299">Config</span><span class="op" id="6689305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6689309">InsecureSkipVerify</span><span class="op" id="6689327">:</span>&nbsp;<span class="builtintype" id="6689329">true</span><span class="op" id="6689333">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6689336">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6689339">state</span><span class="op" id="6689344">,</span>&nbsp;<span class="ident" id="6689346">err</span>&nbsp;<span class="op" id="6689350">:=</span>&nbsp;<span class="ident" id="6689353">testHandshake</span><span class="op" id="6689366">(</span><span class="ident" id="6689367">clientConfig</span><span class="op" id="6689379">,</span>&nbsp;<span class="ident" id="6689381">serverConfig</span><span class="op" id="6689393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6689396">if</span>&nbsp;<span class="ident" id="6689399">err</span>&nbsp;<span class="op" id="6689403">!=</span>&nbsp;<span class="ident" id="6689406">nil</span>&nbsp;<span class="op" id="6689410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6689414">t</span><span class="op" id="6689415">.</span><span class="ident" id="6689416">Fatalf</span><span class="op" id="6689422">(</span><span class="string" id="6689423">&#34;handshake&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="6689445">,</span>&nbsp;<span class="ident" id="6689447">err</span><span class="op" id="6689450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6689453">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6689456">if</span>&nbsp;<span class="ident" id="6689459">state</span><span class="op" id="6689464">.</span><span class="ident" id="6689465">Version</span>&nbsp;<span class="op" id="6689473">!=</span>&nbsp;<span class="ident" id="6689476">VersionTLS11</span>&nbsp;<span class="op" id="6689489">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6689493">t</span><span class="op" id="6689494">.</span><span class="ident" id="6689495">Fatalf</span><span class="op" id="6689501">(</span><span class="string" id="6689502">&#34;Incorrect&nbsp;version&nbsp;%x,&nbsp;should&nbsp;be&nbsp;%x&#34;</span><span class="op" id="6689538">,</span>&nbsp;<span class="ident" id="6689540">state</span><span class="op" id="6689545">.</span><span class="ident" id="6689546">Version</span><span class="op" id="6689553">,</span>&nbsp;<span class="ident" id="6689555">VersionTLS11</span><span class="op" id="6689567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6689570">}</span><br>
<span class="lineno"></span><span class="op" id="6689572">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6689575">func</span>&nbsp;<span class="ident" id="6689580">TestCipherSuitePreference</span><span class="op" id="6689605">(</span><span class="ident" id="6689606">t</span>&nbsp;<span class="op" id="6689608">*</span><span class="ident" id="6689609">testing</span><span class="op" id="6689616">.</span><span class="ident" id="6689617">T</span><span class="op" id="6689618">)</span>&nbsp;<span class="op" id="6689620">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6689623">serverConfig</span>&nbsp;<span class="op" id="6689636">:=</span>&nbsp;<span class="op" id="6689639">&amp;</span><span class="ident" id="6689640">Config</span><span class="op" id="6689646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6689650">CipherSuites</span><span class="op" id="6689662">:</span>&nbsp;<span class="op" id="6689664">[</span><span class="op" id="6689665">]</span><span class="builtintype" id="6689666">uint16</span><span class="op" id="6689672">{</span><span class="ident" id="6689673">TLS_RSA_WITH_RC4_128_SHA</span><span class="op" id="6689697">,</span>&nbsp;<span class="ident" id="6689699">TLS_RSA_WITH_AES_128_CBC_SHA</span><span class="op" id="6689727">,</span>&nbsp;<span class="ident" id="6689729">TLS_ECDHE_RSA_WITH_RC4_128_SHA</span><span class="op" id="6689759">}</span><span class="op" id="6689760">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6689764">Certificates</span><span class="op" id="6689776">:</span>&nbsp;<span class="ident" id="6689778">testConfig</span><span class="op" id="6689788">.</span><span class="ident" id="6689789">Certificates</span><span class="op" id="6689801">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6689805">MaxVersion</span><span class="op" id="6689815">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6689819">VersionTLS11</span><span class="op" id="6689831">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6689834">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6689837">clientConfig</span>&nbsp;<span class="op" id="6689850">:=</span>&nbsp;<span class="op" id="6689853">&amp;</span><span class="ident" id="6689854">Config</span><span class="op" id="6689860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6689864">CipherSuites</span><span class="op" id="6689876">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6689884">[</span><span class="op" id="6689885">]</span><span class="builtintype" id="6689886">uint16</span><span class="op" id="6689892">{</span><span class="ident" id="6689893">TLS_RSA_WITH_AES_128_CBC_SHA</span><span class="op" id="6689921">,</span>&nbsp;<span class="ident" id="6689923">TLS_RSA_WITH_RC4_128_SHA</span><span class="op" id="6689947">}</span><span class="op" id="6689948">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6689952">InsecureSkipVerify</span><span class="op" id="6689970">:</span>&nbsp;<span class="builtintype" id="6689972">true</span><span class="op" id="6689976">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6689979">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6689982">state</span><span class="op" id="6689987">,</span>&nbsp;<span class="ident" id="6689989">err</span>&nbsp;<span class="op" id="6689993">:=</span>&nbsp;<span class="ident" id="6689996">testHandshake</span><span class="op" id="6690009">(</span><span class="ident" id="6690010">clientConfig</span><span class="op" id="6690022">,</span>&nbsp;<span class="ident" id="6690024">serverConfig</span><span class="op" id="6690036">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6690039">if</span>&nbsp;<span class="ident" id="6690042">err</span>&nbsp;<span class="op" id="6690046">!=</span>&nbsp;<span class="ident" id="6690049">nil</span>&nbsp;<span class="op" id="6690053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6690057">t</span><span class="op" id="6690058">.</span><span class="ident" id="6690059">Fatalf</span><span class="op" id="6690065">(</span><span class="string" id="6690066">&#34;handshake&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="6690088">,</span>&nbsp;<span class="ident" id="6690090">err</span><span class="op" id="6690093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6690096">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6690099">if</span>&nbsp;<span class="ident" id="6690102">state</span><span class="op" id="6690107">.</span><span class="ident" id="6690108">CipherSuite</span>&nbsp;<span class="op" id="6690120">!=</span>&nbsp;<span class="ident" id="6690123">TLS_RSA_WITH_AES_128_CBC_SHA</span>&nbsp;<span class="op" id="6690152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6690156">//&nbsp;By&nbsp;default&nbsp;the&nbsp;server&nbsp;should&nbsp;use&nbsp;the&nbsp;client&#39;s&nbsp;preference.</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6690219">t</span><span class="op" id="6690220">.</span><span class="ident" id="6690221">Fatalf</span><span class="op" id="6690227">(</span><span class="string" id="6690228">&#34;Client&#39;s&nbsp;preference&nbsp;was&nbsp;not&nbsp;used,&nbsp;got&nbsp;%x&#34;</span><span class="op" id="6690270">,</span>&nbsp;<span class="ident" id="6690272">state</span><span class="op" id="6690277">.</span><span class="ident" id="6690278">CipherSuite</span><span class="op" id="6690289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6690292">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6690296">serverConfig</span><span class="op" id="6690308">.</span><span class="ident" id="6690309">PreferServerCipherSuites</span>&nbsp;<span class="op" id="6690334">=</span>&nbsp;<span class="builtintype" id="6690336">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6690342">state</span><span class="op" id="6690347">,</span>&nbsp;<span class="ident" id="6690349">err</span>&nbsp;<span class="op" id="6690353">=</span>&nbsp;<span class="ident" id="6690355">testHandshake</span><span class="op" id="6690368">(</span><span class="ident" id="6690369">clientConfig</span><span class="op" id="6690381">,</span>&nbsp;<span class="ident" id="6690383">serverConfig</span><span class="op" id="6690395">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6690398">if</span>&nbsp;<span class="ident" id="6690401">err</span>&nbsp;<span class="op" id="6690405">!=</span>&nbsp;<span class="ident" id="6690408">nil</span>&nbsp;<span class="op" id="6690412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6690416">t</span><span class="op" id="6690417">.</span><span class="ident" id="6690418">Fatalf</span><span class="op" id="6690424">(</span><span class="string" id="6690425">&#34;handshake&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="6690447">,</span>&nbsp;<span class="ident" id="6690449">err</span><span class="op" id="6690452">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6690455">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6690458">if</span>&nbsp;<span class="ident" id="6690461">state</span><span class="op" id="6690466">.</span><span class="ident" id="6690467">CipherSuite</span>&nbsp;<span class="op" id="6690479">!=</span>&nbsp;<span class="ident" id="6690482">TLS_RSA_WITH_RC4_128_SHA</span>&nbsp;<span class="op" id="6690507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6690511">t</span><span class="op" id="6690512">.</span><span class="ident" id="6690513">Fatalf</span><span class="op" id="6690519">(</span><span class="string" id="6690520">&#34;Server&#39;s&nbsp;preference&nbsp;was&nbsp;not&nbsp;used,&nbsp;got&nbsp;%x&#34;</span><span class="op" id="6690562">,</span>&nbsp;<span class="ident" id="6690564">state</span><span class="op" id="6690569">.</span><span class="ident" id="6690570">CipherSuite</span><span class="op" id="6690581">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6690584">}</span><br>
<span class="lineno"></span><span class="op" id="6690586">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6690589">//&nbsp;Note:&nbsp;see&nbsp;comment&nbsp;in&nbsp;handshake_test.go&nbsp;for&nbsp;details&nbsp;of&nbsp;how&nbsp;the&nbsp;reference</span><br>
<span class="lineno"></span><span class="comment" id="6690664">//&nbsp;tests&nbsp;work.</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="comment" id="6690680">//&nbsp;serverTest&nbsp;represents&nbsp;a&nbsp;test&nbsp;of&nbsp;the&nbsp;TLS&nbsp;server&nbsp;handshake&nbsp;against&nbsp;a&nbsp;reference</span><br>
<span class="lineno"></span><span class="comment" id="6690760">//&nbsp;implementation.</span><br>
<span class="lineno"></span><span class="keyword" id="6690779">type</span>&nbsp;<span class="ident" id="6690784">serverTest</span>&nbsp;<span class="keyword" id="6690795">struct</span>&nbsp;<span class="op" id="6690802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6690805">//&nbsp;name&nbsp;is&nbsp;a&nbsp;freeform&nbsp;string&nbsp;identifying&nbsp;the&nbsp;test&nbsp;and&nbsp;the&nbsp;file&nbsp;in&nbsp;which</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6690878">//&nbsp;the&nbsp;expected&nbsp;results&nbsp;will&nbsp;be&nbsp;stored.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6690919">name</span>&nbsp;<span class="builtintype" id="6690924">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6690932">//&nbsp;command,&nbsp;if&nbsp;not&nbsp;empty,&nbsp;contains&nbsp;a&nbsp;series&nbsp;of&nbsp;arguments&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6690998">//&nbsp;command&nbsp;to&nbsp;run&nbsp;for&nbsp;the&nbsp;reference&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6691043">command</span>&nbsp;<span class="op" id="6691051">[</span><span class="op" id="6691052">]</span><span class="builtintype" id="6691053">string</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6691061">//&nbsp;expectedPeerCerts&nbsp;contains&nbsp;a&nbsp;list&nbsp;of&nbsp;PEM&nbsp;blocks&nbsp;of&nbsp;expected</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6691125">//&nbsp;certificates&nbsp;from&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6691159">expectedPeerCerts</span>&nbsp;<span class="op" id="6691177">[</span><span class="op" id="6691178">]</span><span class="builtintype" id="6691179">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6691187">//&nbsp;config,&nbsp;if&nbsp;not&nbsp;nil,&nbsp;contains&nbsp;a&nbsp;custom&nbsp;Config&nbsp;to&nbsp;use&nbsp;for&nbsp;this&nbsp;test.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6691258">config</span>&nbsp;<span class="op" id="6691265">*</span><span class="ident" id="6691266">Config</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6691274">//&nbsp;expectAlert,&nbsp;if&nbsp;true,&nbsp;indicates&nbsp;that&nbsp;a&nbsp;fatal&nbsp;alert&nbsp;should&nbsp;be&nbsp;returned</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6691348">//&nbsp;when&nbsp;handshaking&nbsp;with&nbsp;the&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6691386">expectAlert</span>&nbsp;<span class="builtintype" id="6691398">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6691404">//&nbsp;expectHandshakeErrorIncluding,&nbsp;when&nbsp;not&nbsp;empty,&nbsp;contains&nbsp;a&nbsp;string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6691473">//&nbsp;that&nbsp;must&nbsp;be&nbsp;a&nbsp;substring&nbsp;of&nbsp;the&nbsp;error&nbsp;resulting&nbsp;from&nbsp;the&nbsp;handshake.</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6691545">expectHandshakeErrorIncluding</span>&nbsp;<span class="builtintype" id="6691575">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6691583">//&nbsp;validate,&nbsp;if&nbsp;not&nbsp;nil,&nbsp;is&nbsp;a&nbsp;function&nbsp;that&nbsp;will&nbsp;be&nbsp;called&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6691652">//&nbsp;ConnectionState&nbsp;of&nbsp;the&nbsp;resulting&nbsp;connection.&nbsp;It&nbsp;returns&nbsp;false&nbsp;if&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6691725">//&nbsp;ConnectionState&nbsp;is&nbsp;unacceptable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6691762">validate</span>&nbsp;<span class="keyword" id="6691771">func</span><span class="op" id="6691775">(</span><span class="ident" id="6691776">ConnectionState</span><span class="op" id="6691791">)</span>&nbsp;<span class="builtintype" id="6691793">error</span><br>
<span class="lineno">270</span><span class="op" id="6691799">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6691802">var</span>&nbsp;<span class="ident" id="6691806">defaultClientCommand</span>&nbsp;<span class="op" id="6691827">=</span>&nbsp;<span class="op" id="6691829">[</span><span class="op" id="6691830">]</span><span class="builtintype" id="6691831">string</span><span class="op" id="6691837">{</span><span class="string" id="6691838">&#34;openssl&#34;</span><span class="op" id="6691847">,</span>&nbsp;<span class="string" id="6691849">&#34;s_client&#34;</span><span class="op" id="6691859">,</span>&nbsp;<span class="string" id="6691861">&#34;-no_ticket&#34;</span><span class="op" id="6691873">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6691876">//&nbsp;connFromCommand&nbsp;starts&nbsp;opens&nbsp;a&nbsp;listening&nbsp;socket&nbsp;and&nbsp;starts&nbsp;the&nbsp;reference</span><br>
<span class="lineno">275</span><span class="comment" id="6691952">//&nbsp;client&nbsp;to&nbsp;connect&nbsp;to&nbsp;it.&nbsp;It&nbsp;returns&nbsp;a&nbsp;recordingConn&nbsp;that&nbsp;wraps&nbsp;the&nbsp;resulting</span><br>
<span class="lineno"></span><span class="comment" id="6692032">//&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="6692047">func</span>&nbsp;<span class="op" id="6692052">(</span><span class="ident" id="6692053">test</span>&nbsp;<span class="op" id="6692058">*</span><span class="ident" id="6692059">serverTest</span><span class="op" id="6692069">)</span>&nbsp;<span class="ident" id="6692071">connFromCommand</span><span class="op" id="6692086">(</span><span class="op" id="6692087">)</span>&nbsp;<span class="op" id="6692089">(</span><span class="ident" id="6692090">conn</span>&nbsp;<span class="op" id="6692095">*</span><span class="ident" id="6692096">recordingConn</span><span class="op" id="6692109">,</span>&nbsp;<span class="ident" id="6692111">child</span>&nbsp;<span class="op" id="6692117">*</span><span class="ident" id="6692118">exec</span><span class="op" id="6692122">.</span><span class="ident" id="6692123">Cmd</span><span class="op" id="6692126">,</span>&nbsp;<span class="ident" id="6692128">err</span>&nbsp;<span class="builtintype" id="6692132">error</span><span class="op" id="6692137">)</span>&nbsp;<span class="op" id="6692139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6692142">l</span><span class="op" id="6692143">,</span>&nbsp;<span class="ident" id="6692145">err</span>&nbsp;<span class="op" id="6692149">:=</span>&nbsp;<span class="ident" id="6692152">net</span><span class="op" id="6692155">.</span><span class="ident" id="6692156">ListenTCP</span><span class="op" id="6692165">(</span><span class="string" id="6692166">&#34;tcp&#34;</span><span class="op" id="6692171">,</span>&nbsp;<span class="op" id="6692173">&amp;</span><span class="ident" id="6692174">net</span><span class="op" id="6692177">.</span><span class="ident" id="6692178">TCPAddr</span><span class="op" id="6692185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6692189">IP</span><span class="op" id="6692191">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6692195">net</span><span class="op" id="6692198">.</span><span class="ident" id="6692199">IPv4</span><span class="op" id="6692203">(</span><span class="num" id="6692204">127</span><span class="op" id="6692207">,</span>&nbsp;<span class="num" id="6692209">0</span><span class="op" id="6692210">,</span>&nbsp;<span class="num" id="6692212">0</span><span class="op" id="6692213">,</span>&nbsp;<span class="num" id="6692215">1</span><span class="op" id="6692216">)</span><span class="op" id="6692217">,</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6692221">Port</span><span class="op" id="6692225">:</span>&nbsp;<span class="num" id="6692227">0</span><span class="op" id="6692228">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6692231">}</span><span class="op" id="6692232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6692235">if</span>&nbsp;<span class="ident" id="6692238">err</span>&nbsp;<span class="op" id="6692242">!=</span>&nbsp;<span class="ident" id="6692245">nil</span>&nbsp;<span class="op" id="6692249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6692253">return</span>&nbsp;<span class="ident" id="6692260">nil</span><span class="op" id="6692263">,</span>&nbsp;<span class="ident" id="6692265">nil</span><span class="op" id="6692268">,</span>&nbsp;<span class="ident" id="6692270">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6692275">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6692278">defer</span>&nbsp;<span class="ident" id="6692284">l</span><span class="op" id="6692285">.</span><span class="ident" id="6692286">Close</span><span class="op" id="6692291">(</span><span class="op" id="6692292">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6692296">port</span>&nbsp;<span class="op" id="6692301">:=</span>&nbsp;<span class="ident" id="6692304">l</span><span class="op" id="6692305">.</span><span class="ident" id="6692306">Addr</span><span class="op" id="6692310">(</span><span class="op" id="6692311">)</span><span class="op" id="6692312">.</span><span class="op" id="6692313">(</span><span class="op" id="6692314">*</span><span class="ident" id="6692315">net</span><span class="op" id="6692318">.</span><span class="ident" id="6692319">TCPAddr</span><span class="op" id="6692326">)</span><span class="op" id="6692327">.</span><span class="ident" id="6692328">Port</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6692335">var</span>&nbsp;<span class="ident" id="6692339">command</span>&nbsp;<span class="op" id="6692347">[</span><span class="op" id="6692348">]</span><span class="builtintype" id="6692349">string</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6692357">command</span>&nbsp;<span class="op" id="6692365">=</span>&nbsp;<span class="builtinfunc" id="6692367">append</span><span class="op" id="6692373">(</span><span class="ident" id="6692374">command</span><span class="op" id="6692381">,</span>&nbsp;<span class="ident" id="6692383">test</span><span class="op" id="6692387">.</span><span class="ident" id="6692388">command</span><span class="op" id="6692395">...</span><span class="op" id="6692398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6692401">if</span>&nbsp;<span class="builtinfunc" id="6692404">len</span><span class="op" id="6692407">(</span><span class="ident" id="6692408">command</span><span class="op" id="6692415">)</span>&nbsp;<span class="op" id="6692417">==</span>&nbsp;<span class="num" id="6692420">0</span>&nbsp;<span class="op" id="6692422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6692426">command</span>&nbsp;<span class="op" id="6692434">=</span>&nbsp;<span class="ident" id="6692436">defaultClientCommand</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6692458">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6692461">command</span>&nbsp;<span class="op" id="6692469">=</span>&nbsp;<span class="builtinfunc" id="6692471">append</span><span class="op" id="6692477">(</span><span class="ident" id="6692478">command</span><span class="op" id="6692485">,</span>&nbsp;<span class="string" id="6692487">&#34;-connect&#34;</span><span class="op" id="6692497">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6692500">command</span>&nbsp;<span class="op" id="6692508">=</span>&nbsp;<span class="builtinfunc" id="6692510">append</span><span class="op" id="6692516">(</span><span class="ident" id="6692517">command</span><span class="op" id="6692524">,</span>&nbsp;<span class="ident" id="6692526">fmt</span><span class="op" id="6692529">.</span><span class="ident" id="6692530">Sprintf</span><span class="op" id="6692537">(</span><span class="string" id="6692538">&#34;127.0.0.1:%d&#34;</span><span class="op" id="6692552">,</span>&nbsp;<span class="ident" id="6692554">port</span><span class="op" id="6692558">)</span><span class="op" id="6692559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6692562">cmd</span>&nbsp;<span class="op" id="6692566">:=</span>&nbsp;<span class="ident" id="6692569">exec</span><span class="op" id="6692573">.</span><span class="ident" id="6692574">Command</span><span class="op" id="6692581">(</span><span class="ident" id="6692582">command</span><span class="op" id="6692589">[</span><span class="num" id="6692590">0</span><span class="op" id="6692591">]</span><span class="op" id="6692592">,</span>&nbsp;<span class="ident" id="6692594">command</span><span class="op" id="6692601">[</span><span class="num" id="6692602">1</span><span class="op" id="6692603">:</span><span class="op" id="6692604">]</span><span class="op" id="6692605">...</span><span class="op" id="6692608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6692611">cmd</span><span class="op" id="6692614">.</span><span class="ident" id="6692615">Stdin</span>&nbsp;<span class="op" id="6692621">=</span>&nbsp;<span class="ident" id="6692623">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6692628">var</span>&nbsp;<span class="ident" id="6692632">output</span>&nbsp;<span class="ident" id="6692639">bytes</span><span class="op" id="6692644">.</span><span class="ident" id="6692645">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6692653">cmd</span><span class="op" id="6692656">.</span><span class="ident" id="6692657">Stdout</span>&nbsp;<span class="op" id="6692664">=</span>&nbsp;<span class="op" id="6692666">&amp;</span><span class="ident" id="6692667">output</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6692675">cmd</span><span class="op" id="6692678">.</span><span class="ident" id="6692679">Stderr</span>&nbsp;<span class="op" id="6692686">=</span>&nbsp;<span class="op" id="6692688">&amp;</span><span class="ident" id="6692689">output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6692697">if</span>&nbsp;<span class="ident" id="6692700">err</span>&nbsp;<span class="op" id="6692704">:=</span>&nbsp;<span class="ident" id="6692707">cmd</span><span class="op" id="6692710">.</span><span class="ident" id="6692711">Start</span><span class="op" id="6692716">(</span><span class="op" id="6692717">)</span><span class="op" id="6692718">;</span>&nbsp;<span class="ident" id="6692720">err</span>&nbsp;<span class="op" id="6692724">!=</span>&nbsp;<span class="ident" id="6692727">nil</span>&nbsp;<span class="op" id="6692731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6692735">return</span>&nbsp;<span class="ident" id="6692742">nil</span><span class="op" id="6692745">,</span>&nbsp;<span class="ident" id="6692747">nil</span><span class="op" id="6692750">,</span>&nbsp;<span class="ident" id="6692752">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6692757">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6692761">connChan</span>&nbsp;<span class="op" id="6692770">:=</span>&nbsp;<span class="builtinfunc" id="6692773">make</span><span class="op" id="6692777">(</span><span class="keyword" id="6692778">chan</span>&nbsp;<span class="keyword" id="6692783">interface</span><span class="op" id="6692792">{</span><span class="op" id="6692793">}</span><span class="op" id="6692794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6692797">go</span>&nbsp;<span class="keyword" id="6692800">func</span><span class="op" id="6692804">(</span><span class="op" id="6692805">)</span>&nbsp;<span class="op" id="6692807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6692811">tcpConn</span><span class="op" id="6692818">,</span>&nbsp;<span class="ident" id="6692820">err</span>&nbsp;<span class="op" id="6692824">:=</span>&nbsp;<span class="ident" id="6692827">l</span><span class="op" id="6692828">.</span><span class="ident" id="6692829">Accept</span><span class="op" id="6692835">(</span><span class="op" id="6692836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6692840">if</span>&nbsp;<span class="ident" id="6692843">err</span>&nbsp;<span class="op" id="6692847">!=</span>&nbsp;<span class="ident" id="6692850">nil</span>&nbsp;<span class="op" id="6692854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6692859">connChan</span>&nbsp;<span class="op" id="6692868">&lt;-</span>&nbsp;<span class="ident" id="6692871">err</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6692877">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6692881">connChan</span>&nbsp;<span class="op" id="6692890">&lt;-</span>&nbsp;<span class="ident" id="6692893">tcpConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6692902">}</span><span class="op" id="6692903">(</span><span class="op" id="6692904">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6692908">var</span>&nbsp;<span class="ident" id="6692912">tcpConn</span>&nbsp;<span class="ident" id="6692920">net</span><span class="op" id="6692923">.</span><span class="ident" id="6692924">Conn</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6692930">select</span>&nbsp;<span class="op" id="6692937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6692940">case</span>&nbsp;<span class="ident" id="6692945">connOrError</span>&nbsp;<span class="op" id="6692957">:=</span>&nbsp;<span class="op" id="6692960">&lt;-</span><span class="ident" id="6692962">connChan</span><span class="op" id="6692970">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6692974">if</span>&nbsp;<span class="ident" id="6692977">err</span><span class="op" id="6692980">,</span>&nbsp;<span class="ident" id="6692982">ok</span>&nbsp;<span class="op" id="6692985">:=</span>&nbsp;<span class="ident" id="6692988">connOrError</span><span class="op" id="6692999">.</span><span class="op" id="6693000">(</span><span class="builtintype" id="6693001">error</span><span class="op" id="6693006">)</span><span class="op" id="6693007">;</span>&nbsp;<span class="ident" id="6693009">ok</span>&nbsp;<span class="op" id="6693012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6693017">return</span>&nbsp;<span class="ident" id="6693024">nil</span><span class="op" id="6693027">,</span>&nbsp;<span class="ident" id="6693029">nil</span><span class="op" id="6693032">,</span>&nbsp;<span class="ident" id="6693034">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6693040">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6693044">tcpConn</span>&nbsp;<span class="op" id="6693052">=</span>&nbsp;<span class="ident" id="6693054">connOrError</span><span class="op" id="6693065">.</span><span class="op" id="6693066">(</span><span class="ident" id="6693067">net</span><span class="op" id="6693070">.</span><span class="ident" id="6693071">Conn</span><span class="op" id="6693075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6693078">case</span>&nbsp;<span class="op" id="6693083">&lt;-</span><span class="ident" id="6693085">time</span><span class="op" id="6693089">.</span><span class="ident" id="6693090">After</span><span class="op" id="6693095">(</span><span class="num" id="6693096">2</span>&nbsp;<span class="op" id="6693098">*</span>&nbsp;<span class="ident" id="6693100">time</span><span class="op" id="6693104">.</span><span class="ident" id="6693105">Second</span><span class="op" id="6693111">)</span><span class="op" id="6693112">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6693116">output</span><span class="op" id="6693122">.</span><span class="ident" id="6693123">WriteTo</span><span class="op" id="6693130">(</span><span class="ident" id="6693131">os</span><span class="op" id="6693133">.</span><span class="ident" id="6693134">Stdout</span><span class="op" id="6693140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6693144">return</span>&nbsp;<span class="ident" id="6693151">nil</span><span class="op" id="6693154">,</span>&nbsp;<span class="ident" id="6693156">nil</span><span class="op" id="6693159">,</span>&nbsp;<span class="ident" id="6693161">errors</span><span class="op" id="6693167">.</span><span class="ident" id="6693168">New</span><span class="op" id="6693171">(</span><span class="string" id="6693172">&#34;timed&nbsp;out&nbsp;waiting&nbsp;for&nbsp;connection&nbsp;from&nbsp;child&nbsp;process&#34;</span><span class="op" id="6693225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6693228">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6693232">record</span>&nbsp;<span class="op" id="6693239">:=</span>&nbsp;<span class="op" id="6693242">&amp;</span><span class="ident" id="6693243">recordingConn</span><span class="op" id="6693256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6693260">Conn</span><span class="op" id="6693264">:</span>&nbsp;<span class="ident" id="6693266">tcpConn</span><span class="op" id="6693273">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6693276">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6693280">return</span>&nbsp;<span class="ident" id="6693287">record</span><span class="op" id="6693293">,</span>&nbsp;<span class="ident" id="6693295">cmd</span><span class="op" id="6693298">,</span>&nbsp;<span class="ident" id="6693300">nil</span><br>
<span class="lineno"></span><span class="op" id="6693304">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6693307">func</span>&nbsp;<span class="op" id="6693312">(</span><span class="ident" id="6693313">test</span>&nbsp;<span class="op" id="6693318">*</span><span class="ident" id="6693319">serverTest</span><span class="op" id="6693329">)</span>&nbsp;<span class="ident" id="6693331">dataPath</span><span class="op" id="6693339">(</span><span class="op" id="6693340">)</span>&nbsp;<span class="builtintype" id="6693342">string</span>&nbsp;<span class="op" id="6693349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6693352">return</span>&nbsp;<span class="ident" id="6693359">filepath</span><span class="op" id="6693367">.</span><span class="ident" id="6693368">Join</span><span class="op" id="6693372">(</span><span class="string" id="6693373">&#34;testdata&#34;</span><span class="op" id="6693383">,</span>&nbsp;<span class="string" id="6693385">&#34;Server-&#34;</span><span class="op" id="6693394">+</span><span class="ident" id="6693395">test</span><span class="op" id="6693399">.</span><span class="ident" id="6693400">name</span><span class="op" id="6693404">)</span><br>
<span class="lineno">335</span><span class="op" id="6693406">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6693409">func</span>&nbsp;<span class="op" id="6693414">(</span><span class="ident" id="6693415">test</span>&nbsp;<span class="op" id="6693420">*</span><span class="ident" id="6693421">serverTest</span><span class="op" id="6693431">)</span>&nbsp;<span class="ident" id="6693433">loadData</span><span class="op" id="6693441">(</span><span class="op" id="6693442">)</span>&nbsp;<span class="op" id="6693444">(</span><span class="ident" id="6693445">flows</span>&nbsp;<span class="op" id="6693451">[</span><span class="op" id="6693452">]</span><span class="op" id="6693453">[</span><span class="op" id="6693454">]</span><span class="builtintype" id="6693455">byte</span><span class="op" id="6693459">,</span>&nbsp;<span class="ident" id="6693461">err</span>&nbsp;<span class="builtintype" id="6693465">error</span><span class="op" id="6693470">)</span>&nbsp;<span class="op" id="6693472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6693475">in</span><span class="op" id="6693477">,</span>&nbsp;<span class="ident" id="6693479">err</span>&nbsp;<span class="op" id="6693483">:=</span>&nbsp;<span class="ident" id="6693486">os</span><span class="op" id="6693488">.</span><span class="ident" id="6693489">Open</span><span class="op" id="6693493">(</span><span class="ident" id="6693494">test</span><span class="op" id="6693498">.</span><span class="ident" id="6693499">dataPath</span><span class="op" id="6693507">(</span><span class="op" id="6693508">)</span><span class="op" id="6693509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6693512">if</span>&nbsp;<span class="ident" id="6693515">err</span>&nbsp;<span class="op" id="6693519">!=</span>&nbsp;<span class="ident" id="6693522">nil</span>&nbsp;<span class="op" id="6693526">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6693530">return</span>&nbsp;<span class="ident" id="6693537">nil</span><span class="op" id="6693540">,</span>&nbsp;<span class="ident" id="6693542">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6693547">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6693550">defer</span>&nbsp;<span class="ident" id="6693556">in</span><span class="op" id="6693558">.</span><span class="ident" id="6693559">Close</span><span class="op" id="6693564">(</span><span class="op" id="6693565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6693568">return</span>&nbsp;<span class="ident" id="6693575">parseTestData</span><span class="op" id="6693588">(</span><span class="ident" id="6693589">in</span><span class="op" id="6693591">)</span><br>
<span class="lineno"></span><span class="op" id="6693593">}</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span><span class="keyword" id="6693596">func</span>&nbsp;<span class="op" id="6693601">(</span><span class="ident" id="6693602">test</span>&nbsp;<span class="op" id="6693607">*</span><span class="ident" id="6693608">serverTest</span><span class="op" id="6693618">)</span>&nbsp;<span class="ident" id="6693620">run</span><span class="op" id="6693623">(</span><span class="ident" id="6693624">t</span>&nbsp;<span class="op" id="6693626">*</span><span class="ident" id="6693627">testing</span><span class="op" id="6693634">.</span><span class="ident" id="6693635">T</span><span class="op" id="6693636">,</span>&nbsp;<span class="ident" id="6693638">write</span>&nbsp;<span class="builtintype" id="6693644">bool</span><span class="op" id="6693648">)</span>&nbsp;<span class="op" id="6693650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6693653">var</span>&nbsp;<span class="ident" id="6693657">clientConn</span><span class="op" id="6693667">,</span>&nbsp;<span class="ident" id="6693669">serverConn</span>&nbsp;<span class="ident" id="6693680">net</span><span class="op" id="6693683">.</span><span class="ident" id="6693684">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6693690">var</span>&nbsp;<span class="ident" id="6693694">recordingConn</span>&nbsp;<span class="op" id="6693708">*</span><span class="ident" id="6693709">recordingConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6693724">var</span>&nbsp;<span class="ident" id="6693728">childProcess</span>&nbsp;<span class="op" id="6693741">*</span><span class="ident" id="6693742">exec</span><span class="op" id="6693746">.</span><span class="ident" id="6693747">Cmd</span><br>
<span class="lineno">350</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6693753">if</span>&nbsp;<span class="ident" id="6693756">write</span>&nbsp;<span class="op" id="6693762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6693766">var</span>&nbsp;<span class="ident" id="6693770">err</span>&nbsp;<span class="builtintype" id="6693774">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6693782">recordingConn</span><span class="op" id="6693795">,</span>&nbsp;<span class="ident" id="6693797">childProcess</span><span class="op" id="6693809">,</span>&nbsp;<span class="ident" id="6693811">err</span>&nbsp;<span class="op" id="6693815">=</span>&nbsp;<span class="ident" id="6693817">test</span><span class="op" id="6693821">.</span><span class="ident" id="6693822">connFromCommand</span><span class="op" id="6693837">(</span><span class="op" id="6693838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6693842">if</span>&nbsp;<span class="ident" id="6693845">err</span>&nbsp;<span class="op" id="6693849">!=</span>&nbsp;<span class="ident" id="6693852">nil</span>&nbsp;<span class="op" id="6693856">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6693861">t</span><span class="op" id="6693862">.</span><span class="ident" id="6693863">Fatalf</span><span class="op" id="6693869">(</span><span class="string" id="6693870">&#34;Failed&nbsp;to&nbsp;start&nbsp;subcommand:&nbsp;%s&#34;</span><span class="op" id="6693902">,</span>&nbsp;<span class="ident" id="6693904">err</span><span class="op" id="6693907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6693911">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6693915">serverConn</span>&nbsp;<span class="op" id="6693926">=</span>&nbsp;<span class="ident" id="6693928">recordingConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6693943">}</span>&nbsp;<span class="keyword" id="6693945">else</span>&nbsp;<span class="op" id="6693950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6693954">clientConn</span><span class="op" id="6693964">,</span>&nbsp;<span class="ident" id="6693966">serverConn</span>&nbsp;<span class="op" id="6693977">=</span>&nbsp;<span class="ident" id="6693979">net</span><span class="op" id="6693982">.</span><span class="ident" id="6693983">Pipe</span><span class="op" id="6693987">(</span><span class="op" id="6693988">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6693991">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6693994">config</span>&nbsp;<span class="op" id="6694001">:=</span>&nbsp;<span class="ident" id="6694004">test</span><span class="op" id="6694008">.</span><span class="ident" id="6694009">config</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6694017">if</span>&nbsp;<span class="ident" id="6694020">config</span>&nbsp;<span class="op" id="6694027">==</span>&nbsp;<span class="ident" id="6694030">nil</span>&nbsp;<span class="op" id="6694034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6694038">config</span>&nbsp;<span class="op" id="6694045">=</span>&nbsp;<span class="ident" id="6694047">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6694059">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6694062">server</span>&nbsp;<span class="op" id="6694069">:=</span>&nbsp;<span class="ident" id="6694072">Server</span><span class="op" id="6694078">(</span><span class="ident" id="6694079">serverConn</span><span class="op" id="6694089">,</span>&nbsp;<span class="ident" id="6694091">config</span><span class="op" id="6694097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6694100">connStateChan</span>&nbsp;<span class="op" id="6694114">:=</span>&nbsp;<span class="builtinfunc" id="6694117">make</span><span class="op" id="6694121">(</span><span class="keyword" id="6694122">chan</span>&nbsp;<span class="ident" id="6694127">ConnectionState</span><span class="op" id="6694142">,</span>&nbsp;<span class="num" id="6694144">1</span><span class="op" id="6694145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6694148">go</span>&nbsp;<span class="keyword" id="6694151">func</span><span class="op" id="6694155">(</span><span class="op" id="6694156">)</span>&nbsp;<span class="op" id="6694158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6694162">var</span>&nbsp;<span class="ident" id="6694166">err</span>&nbsp;<span class="builtintype" id="6694170">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6694178">if</span>&nbsp;<span class="ident" id="6694181">_</span><span class="op" id="6694182">,</span>&nbsp;<span class="ident" id="6694184">err</span>&nbsp;<span class="op" id="6694188">=</span>&nbsp;<span class="ident" id="6694190">server</span><span class="op" id="6694196">.</span><span class="ident" id="6694197">Write</span><span class="op" id="6694202">(</span><span class="op" id="6694203">[</span><span class="op" id="6694204">]</span><span class="builtintype" id="6694205">byte</span><span class="op" id="6694209">(</span><span class="string" id="6694210">&#34;hello,&nbsp;world\n&#34;</span><span class="op" id="6694226">)</span><span class="op" id="6694227">)</span><span class="op" id="6694228">;</span>&nbsp;<span class="ident" id="6694230">err</span>&nbsp;<span class="op" id="6694234">!=</span>&nbsp;<span class="ident" id="6694237">nil</span>&nbsp;<span class="op" id="6694241">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6694246">t</span><span class="op" id="6694247">.</span><span class="ident" id="6694248">Logf</span><span class="op" id="6694252">(</span><span class="string" id="6694253">&#34;Error&nbsp;from&nbsp;Server.Write:&nbsp;%s&#34;</span><span class="op" id="6694282">,</span>&nbsp;<span class="ident" id="6694284">err</span><span class="op" id="6694287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6694291">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6694295">if</span>&nbsp;<span class="builtinfunc" id="6694298">len</span><span class="op" id="6694301">(</span><span class="ident" id="6694302">test</span><span class="op" id="6694306">.</span><span class="ident" id="6694307">expectHandshakeErrorIncluding</span><span class="op" id="6694336">)</span>&nbsp;<span class="op" id="6694338">&gt;</span>&nbsp;<span class="num" id="6694340">0</span>&nbsp;<span class="op" id="6694342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6694347">if</span>&nbsp;<span class="ident" id="6694350">err</span>&nbsp;<span class="op" id="6694354">==</span>&nbsp;<span class="ident" id="6694357">nil</span>&nbsp;<span class="op" id="6694361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6694367">t</span><span class="op" id="6694368">.</span><span class="ident" id="6694369">Errorf</span><span class="op" id="6694375">(</span><span class="string" id="6694376">&#34;Error&nbsp;expected,&nbsp;but&nbsp;no&nbsp;error&nbsp;returned&#34;</span><span class="op" id="6694415">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6694420">}</span>&nbsp;<span class="keyword" id="6694422">else</span>&nbsp;<span class="keyword" id="6694427">if</span>&nbsp;<span class="ident" id="6694430">s</span>&nbsp;<span class="op" id="6694432">:=</span>&nbsp;<span class="ident" id="6694435">err</span><span class="op" id="6694438">.</span><span class="ident" id="6694439">Error</span><span class="op" id="6694444">(</span><span class="op" id="6694445">)</span><span class="op" id="6694446">;</span>&nbsp;<span class="op" id="6694448">!</span><span class="ident" id="6694449">strings</span><span class="op" id="6694456">.</span><span class="ident" id="6694457">Contains</span><span class="op" id="6694465">(</span><span class="ident" id="6694466">s</span><span class="op" id="6694467">,</span>&nbsp;<span class="ident" id="6694469">test</span><span class="op" id="6694473">.</span><span class="ident" id="6694474">expectHandshakeErrorIncluding</span><span class="op" id="6694503">)</span>&nbsp;<span class="op" id="6694505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6694511">t</span><span class="op" id="6694512">.</span><span class="ident" id="6694513">Errorf</span><span class="op" id="6694519">(</span><span class="string" id="6694520">&#34;Error&nbsp;expected&nbsp;containing&nbsp;&#39;%s&#39;&nbsp;but&nbsp;got&nbsp;&#39;%s&#39;&#34;</span><span class="op" id="6694565">,</span>&nbsp;<span class="ident" id="6694567">test</span><span class="op" id="6694571">.</span><span class="ident" id="6694572">expectHandshakeErrorIncluding</span><span class="op" id="6694601">,</span>&nbsp;<span class="ident" id="6694603">s</span><span class="op" id="6694604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6694609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6694613">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6694617">server</span><span class="op" id="6694623">.</span><span class="ident" id="6694624">Close</span><span class="op" id="6694629">(</span><span class="op" id="6694630">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6694634">serverConn</span><span class="op" id="6694644">.</span><span class="ident" id="6694645">Close</span><span class="op" id="6694650">(</span><span class="op" id="6694651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6694655">connStateChan</span>&nbsp;<span class="op" id="6694669">&lt;-</span>&nbsp;<span class="ident" id="6694672">server</span><span class="op" id="6694678">.</span><span class="ident" id="6694679">ConnectionState</span><span class="op" id="6694694">(</span><span class="op" id="6694695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6694698">}</span><span class="op" id="6694699">(</span><span class="op" id="6694700">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6694704">if</span>&nbsp;<span class="op" id="6694707">!</span><span class="ident" id="6694708">write</span>&nbsp;<span class="op" id="6694714">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6694718">flows</span><span class="op" id="6694723">,</span>&nbsp;<span class="ident" id="6694725">err</span>&nbsp;<span class="op" id="6694729">:=</span>&nbsp;<span class="ident" id="6694732">test</span><span class="op" id="6694736">.</span><span class="ident" id="6694737">loadData</span><span class="op" id="6694745">(</span><span class="op" id="6694746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6694750">if</span>&nbsp;<span class="ident" id="6694753">err</span>&nbsp;<span class="op" id="6694757">!=</span>&nbsp;<span class="ident" id="6694760">nil</span>&nbsp;<span class="op" id="6694764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6694769">if</span>&nbsp;<span class="op" id="6694772">!</span><span class="ident" id="6694773">test</span><span class="op" id="6694777">.</span><span class="ident" id="6694778">expectAlert</span>&nbsp;<span class="op" id="6694790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6694796">t</span><span class="op" id="6694797">.</span><span class="ident" id="6694798">Fatalf</span><span class="op" id="6694804">(</span><span class="string" id="6694805">&#34;%s:&nbsp;failed&nbsp;to&nbsp;load&nbsp;data&nbsp;from&nbsp;%s&#34;</span><span class="op" id="6694838">,</span>&nbsp;<span class="ident" id="6694840">test</span><span class="op" id="6694844">.</span><span class="ident" id="6694845">name</span><span class="op" id="6694849">,</span>&nbsp;<span class="ident" id="6694851">test</span><span class="op" id="6694855">.</span><span class="ident" id="6694856">dataPath</span><span class="op" id="6694864">(</span><span class="op" id="6694865">)</span><span class="op" id="6694866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6694871">}</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6694875">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6694879">for</span>&nbsp;<span class="ident" id="6694883">i</span><span class="op" id="6694884">,</span>&nbsp;<span class="ident" id="6694886">b</span>&nbsp;<span class="op" id="6694888">:=</span>&nbsp;<span class="keyword" id="6694891">range</span>&nbsp;<span class="ident" id="6694897">flows</span>&nbsp;<span class="op" id="6694903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6694908">if</span>&nbsp;<span class="ident" id="6694911">i</span><span class="op" id="6694912">%</span><span class="num" id="6694913">2</span>&nbsp;<span class="op" id="6694915">==</span>&nbsp;<span class="num" id="6694918">0</span>&nbsp;<span class="op" id="6694920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6694926">clientConn</span><span class="op" id="6694936">.</span><span class="ident" id="6694937">Write</span><span class="op" id="6694942">(</span><span class="ident" id="6694943">b</span><span class="op" id="6694944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6694950">continue</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6694962">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6694967">bb</span>&nbsp;<span class="op" id="6694970">:=</span>&nbsp;<span class="builtinfunc" id="6694973">make</span><span class="op" id="6694977">(</span><span class="op" id="6694978">[</span><span class="op" id="6694979">]</span><span class="builtintype" id="6694980">byte</span><span class="op" id="6694984">,</span>&nbsp;<span class="builtinfunc" id="6694986">len</span><span class="op" id="6694989">(</span><span class="ident" id="6694990">b</span><span class="op" id="6694991">)</span><span class="op" id="6694992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6694997">n</span><span class="op" id="6694998">,</span>&nbsp;<span class="ident" id="6695000">err</span>&nbsp;<span class="op" id="6695004">:=</span>&nbsp;<span class="ident" id="6695007">io</span><span class="op" id="6695009">.</span><span class="ident" id="6695010">ReadFull</span><span class="op" id="6695018">(</span><span class="ident" id="6695019">clientConn</span><span class="op" id="6695029">,</span>&nbsp;<span class="ident" id="6695031">bb</span><span class="op" id="6695033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6695038">if</span>&nbsp;<span class="ident" id="6695041">test</span><span class="op" id="6695045">.</span><span class="ident" id="6695046">expectAlert</span>&nbsp;<span class="op" id="6695058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6695064">if</span>&nbsp;<span class="ident" id="6695067">err</span>&nbsp;<span class="op" id="6695071">==</span>&nbsp;<span class="ident" id="6695074">nil</span>&nbsp;<span class="op" id="6695078">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6695085">t</span><span class="op" id="6695086">.</span><span class="ident" id="6695087">Fatal</span><span class="op" id="6695092">(</span><span class="string" id="6695093">&#34;Expected&nbsp;read&nbsp;failure&nbsp;but&nbsp;read&nbsp;succeeded&#34;</span><span class="op" id="6695135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6695141">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6695146">}</span>&nbsp;<span class="keyword" id="6695148">else</span>&nbsp;<span class="op" id="6695153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6695159">if</span>&nbsp;<span class="ident" id="6695162">err</span>&nbsp;<span class="op" id="6695166">!=</span>&nbsp;<span class="ident" id="6695169">nil</span>&nbsp;<span class="op" id="6695173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6695180">t</span><span class="op" id="6695181">.</span><span class="ident" id="6695182">Fatalf</span><span class="op" id="6695188">(</span><span class="string" id="6695189">&#34;%s&nbsp;#%d:&nbsp;%s\nRead&nbsp;%d,&nbsp;wanted&nbsp;%d,&nbsp;got&nbsp;%x,&nbsp;wanted&nbsp;%x\n&#34;</span><span class="op" id="6695242">,</span>&nbsp;<span class="ident" id="6695244">test</span><span class="op" id="6695248">.</span><span class="ident" id="6695249">name</span><span class="op" id="6695253">,</span>&nbsp;<span class="ident" id="6695255">i</span><span class="op" id="6695256">+</span><span class="num" id="6695257">1</span><span class="op" id="6695258">,</span>&nbsp;<span class="ident" id="6695260">err</span><span class="op" id="6695263">,</span>&nbsp;<span class="ident" id="6695265">n</span><span class="op" id="6695266">,</span>&nbsp;<span class="builtinfunc" id="6695268">len</span><span class="op" id="6695271">(</span><span class="ident" id="6695272">bb</span><span class="op" id="6695274">)</span><span class="op" id="6695275">,</span>&nbsp;<span class="ident" id="6695277">bb</span><span class="op" id="6695279">[</span><span class="op" id="6695280">:</span><span class="ident" id="6695281">n</span><span class="op" id="6695282">]</span><span class="op" id="6695283">,</span>&nbsp;<span class="ident" id="6695285">b</span><span class="op" id="6695286">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6695292">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6695298">if</span>&nbsp;<span class="op" id="6695301">!</span><span class="ident" id="6695302">bytes</span><span class="op" id="6695307">.</span><span class="ident" id="6695308">Equal</span><span class="op" id="6695313">(</span><span class="ident" id="6695314">b</span><span class="op" id="6695315">,</span>&nbsp;<span class="ident" id="6695317">bb</span><span class="op" id="6695319">)</span>&nbsp;<span class="op" id="6695321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6695328">t</span><span class="op" id="6695329">.</span><span class="ident" id="6695330">Fatalf</span><span class="op" id="6695336">(</span><span class="string" id="6695337">&#34;%s&nbsp;#%d:&nbsp;mismatch&nbsp;on&nbsp;read:&nbsp;got:%x&nbsp;want:%x&#34;</span><span class="op" id="6695379">,</span>&nbsp;<span class="ident" id="6695381">test</span><span class="op" id="6695385">.</span><span class="ident" id="6695386">name</span><span class="op" id="6695390">,</span>&nbsp;<span class="ident" id="6695392">i</span><span class="op" id="6695393">+</span><span class="num" id="6695394">1</span><span class="op" id="6695395">,</span>&nbsp;<span class="ident" id="6695397">bb</span><span class="op" id="6695399">,</span>&nbsp;<span class="ident" id="6695401">b</span><span class="op" id="6695402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6695408">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6695413">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6695417">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6695421">clientConn</span><span class="op" id="6695431">.</span><span class="ident" id="6695432">Close</span><span class="op" id="6695437">(</span><span class="op" id="6695438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6695441">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6695445">connState</span>&nbsp;<span class="op" id="6695455">:=</span>&nbsp;<span class="op" id="6695458">&lt;-</span><span class="ident" id="6695460">connStateChan</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6695475">peerCerts</span>&nbsp;<span class="op" id="6695485">:=</span>&nbsp;<span class="ident" id="6695488">connState</span><span class="op" id="6695497">.</span><span class="ident" id="6695498">PeerCertificates</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6695516">if</span>&nbsp;<span class="builtinfunc" id="6695519">len</span><span class="op" id="6695522">(</span><span class="ident" id="6695523">peerCerts</span><span class="op" id="6695532">)</span>&nbsp;<span class="op" id="6695534">==</span>&nbsp;<span class="builtinfunc" id="6695537">len</span><span class="op" id="6695540">(</span><span class="ident" id="6695541">test</span><span class="op" id="6695545">.</span><span class="ident" id="6695546">expectedPeerCerts</span><span class="op" id="6695563">)</span>&nbsp;<span class="op" id="6695565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6695569">for</span>&nbsp;<span class="ident" id="6695573">i</span><span class="op" id="6695574">,</span>&nbsp;<span class="ident" id="6695576">peerCert</span>&nbsp;<span class="op" id="6695585">:=</span>&nbsp;<span class="keyword" id="6695588">range</span>&nbsp;<span class="ident" id="6695594">peerCerts</span>&nbsp;<span class="op" id="6695604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6695609">block</span><span class="op" id="6695614">,</span>&nbsp;<span class="ident" id="6695616">_</span>&nbsp;<span class="op" id="6695618">:=</span>&nbsp;<span class="ident" id="6695621">pem</span><span class="op" id="6695624">.</span><span class="ident" id="6695625">Decode</span><span class="op" id="6695631">(</span><span class="op" id="6695632">[</span><span class="op" id="6695633">]</span><span class="builtintype" id="6695634">byte</span><span class="op" id="6695638">(</span><span class="ident" id="6695639">test</span><span class="op" id="6695643">.</span><span class="ident" id="6695644">expectedPeerCerts</span><span class="op" id="6695661">[</span><span class="ident" id="6695662">i</span><span class="op" id="6695663">]</span><span class="op" id="6695664">)</span><span class="op" id="6695665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6695670">if</span>&nbsp;<span class="op" id="6695673">!</span><span class="ident" id="6695674">bytes</span><span class="op" id="6695679">.</span><span class="ident" id="6695680">Equal</span><span class="op" id="6695685">(</span><span class="ident" id="6695686">block</span><span class="op" id="6695691">.</span><span class="ident" id="6695692">Bytes</span><span class="op" id="6695697">,</span>&nbsp;<span class="ident" id="6695699">peerCert</span><span class="op" id="6695707">.</span><span class="ident" id="6695708">Raw</span><span class="op" id="6695711">)</span>&nbsp;<span class="op" id="6695713">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6695719">t</span><span class="op" id="6695720">.</span><span class="ident" id="6695721">Fatalf</span><span class="op" id="6695727">(</span><span class="string" id="6695728">&#34;%s:&nbsp;mismatch&nbsp;on&nbsp;peer&nbsp;cert&nbsp;%d&#34;</span><span class="op" id="6695758">,</span>&nbsp;<span class="ident" id="6695760">test</span><span class="op" id="6695764">.</span><span class="ident" id="6695765">name</span><span class="op" id="6695769">,</span>&nbsp;<span class="ident" id="6695771">i</span><span class="op" id="6695772">+</span><span class="num" id="6695773">1</span><span class="op" id="6695774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6695779">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6695783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6695786">}</span>&nbsp;<span class="keyword" id="6695788">else</span>&nbsp;<span class="op" id="6695793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6695797">t</span><span class="op" id="6695798">.</span><span class="ident" id="6695799">Fatalf</span><span class="op" id="6695805">(</span><span class="string" id="6695806">&#34;%s:&nbsp;mismatch&nbsp;on&nbsp;peer&nbsp;list&nbsp;length:&nbsp;%d&nbsp;(wanted)&nbsp;!=&nbsp;%d&nbsp;(got)&#34;</span><span class="op" id="6695865">,</span>&nbsp;<span class="ident" id="6695867">test</span><span class="op" id="6695871">.</span><span class="ident" id="6695872">name</span><span class="op" id="6695876">,</span>&nbsp;<span class="builtinfunc" id="6695878">len</span><span class="op" id="6695881">(</span><span class="ident" id="6695882">test</span><span class="op" id="6695886">.</span><span class="ident" id="6695887">expectedPeerCerts</span><span class="op" id="6695904">)</span><span class="op" id="6695905">,</span>&nbsp;<span class="builtinfunc" id="6695907">len</span><span class="op" id="6695910">(</span><span class="ident" id="6695911">peerCerts</span><span class="op" id="6695920">)</span><span class="op" id="6695921">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6695924">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6695928">if</span>&nbsp;<span class="ident" id="6695931">test</span><span class="op" id="6695935">.</span><span class="ident" id="6695936">validate</span>&nbsp;<span class="op" id="6695945">!=</span>&nbsp;<span class="ident" id="6695948">nil</span>&nbsp;<span class="op" id="6695952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6695956">if</span>&nbsp;<span class="ident" id="6695959">err</span>&nbsp;<span class="op" id="6695963">:=</span>&nbsp;<span class="ident" id="6695966">test</span><span class="op" id="6695970">.</span><span class="ident" id="6695971">validate</span><span class="op" id="6695979">(</span><span class="ident" id="6695980">connState</span><span class="op" id="6695989">)</span><span class="op" id="6695990">;</span>&nbsp;<span class="ident" id="6695992">err</span>&nbsp;<span class="op" id="6695996">!=</span>&nbsp;<span class="ident" id="6695999">nil</span>&nbsp;<span class="op" id="6696003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6696008">t</span><span class="op" id="6696009">.</span><span class="ident" id="6696010">Fatalf</span><span class="op" id="6696016">(</span><span class="string" id="6696017">&#34;validate&nbsp;callback&nbsp;returned&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="6696055">,</span>&nbsp;<span class="ident" id="6696057">err</span><span class="op" id="6696060">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6696064">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6696067">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6696071">if</span>&nbsp;<span class="ident" id="6696074">write</span>&nbsp;<span class="op" id="6696080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6696084">path</span>&nbsp;<span class="op" id="6696089">:=</span>&nbsp;<span class="ident" id="6696092">test</span><span class="op" id="6696096">.</span><span class="ident" id="6696097">dataPath</span><span class="op" id="6696105">(</span><span class="op" id="6696106">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6696110">out</span><span class="op" id="6696113">,</span>&nbsp;<span class="ident" id="6696115">err</span>&nbsp;<span class="op" id="6696119">:=</span>&nbsp;<span class="ident" id="6696122">os</span><span class="op" id="6696124">.</span><span class="ident" id="6696125">OpenFile</span><span class="op" id="6696133">(</span><span class="ident" id="6696134">path</span><span class="op" id="6696138">,</span>&nbsp;<span class="ident" id="6696140">os</span><span class="op" id="6696142">.</span><span class="ident" id="6696143">O_WRONLY</span><span class="op" id="6696151">|</span><span class="ident" id="6696152">os</span><span class="op" id="6696154">.</span><span class="ident" id="6696155">O_CREATE</span><span class="op" id="6696163">|</span><span class="ident" id="6696164">os</span><span class="op" id="6696166">.</span><span class="ident" id="6696167">O_TRUNC</span><span class="op" id="6696174">,</span>&nbsp;<span class="num" id="6696176">0644</span><span class="op" id="6696180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6696184">if</span>&nbsp;<span class="ident" id="6696187">err</span>&nbsp;<span class="op" id="6696191">!=</span>&nbsp;<span class="ident" id="6696194">nil</span>&nbsp;<span class="op" id="6696198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6696203">t</span><span class="op" id="6696204">.</span><span class="ident" id="6696205">Fatalf</span><span class="op" id="6696211">(</span><span class="string" id="6696212">&#34;Failed&nbsp;to&nbsp;create&nbsp;output&nbsp;file:&nbsp;%s&#34;</span><span class="op" id="6696246">,</span>&nbsp;<span class="ident" id="6696248">err</span><span class="op" id="6696251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6696255">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6696259">defer</span>&nbsp;<span class="ident" id="6696265">out</span><span class="op" id="6696268">.</span><span class="ident" id="6696269">Close</span><span class="op" id="6696274">(</span><span class="op" id="6696275">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6696279">recordingConn</span><span class="op" id="6696292">.</span><span class="ident" id="6696293">Close</span><span class="op" id="6696298">(</span><span class="op" id="6696299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6696303">if</span>&nbsp;<span class="builtinfunc" id="6696306">len</span><span class="op" id="6696309">(</span><span class="ident" id="6696310">recordingConn</span><span class="op" id="6696323">.</span><span class="ident" id="6696324">flows</span><span class="op" id="6696329">)</span>&nbsp;<span class="op" id="6696331">&lt;</span>&nbsp;<span class="num" id="6696333">3</span>&nbsp;<span class="op" id="6696335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6696340">childProcess</span><span class="op" id="6696352">.</span><span class="ident" id="6696353">Stdout</span><span class="op" id="6696359">.</span><span class="op" id="6696360">(</span><span class="op" id="6696361">*</span><span class="ident" id="6696362">bytes</span><span class="op" id="6696367">.</span><span class="ident" id="6696368">Buffer</span><span class="op" id="6696374">)</span><span class="op" id="6696375">.</span><span class="ident" id="6696376">WriteTo</span><span class="op" id="6696383">(</span><span class="ident" id="6696384">os</span><span class="op" id="6696386">.</span><span class="ident" id="6696387">Stdout</span><span class="op" id="6696393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6696398">if</span>&nbsp;<span class="builtinfunc" id="6696401">len</span><span class="op" id="6696404">(</span><span class="ident" id="6696405">test</span><span class="op" id="6696409">.</span><span class="ident" id="6696410">expectHandshakeErrorIncluding</span><span class="op" id="6696439">)</span>&nbsp;<span class="op" id="6696441">==</span>&nbsp;<span class="num" id="6696444">0</span>&nbsp;<span class="op" id="6696446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6696452">t</span><span class="op" id="6696453">.</span><span class="ident" id="6696454">Fatalf</span><span class="op" id="6696460">(</span><span class="string" id="6696461">&#34;Handshake&nbsp;failed&#34;</span><span class="op" id="6696479">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6696484">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6696488">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6696492">recordingConn</span><span class="op" id="6696505">.</span><span class="ident" id="6696506">WriteTo</span><span class="op" id="6696513">(</span><span class="ident" id="6696514">out</span><span class="op" id="6696517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6696521">fmt</span><span class="op" id="6696524">.</span><span class="ident" id="6696525">Printf</span><span class="op" id="6696531">(</span><span class="string" id="6696532">&#34;Wrote&nbsp;%s\n&#34;</span><span class="op" id="6696544">,</span>&nbsp;<span class="ident" id="6696546">path</span><span class="op" id="6696550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6696554">childProcess</span><span class="op" id="6696566">.</span><span class="ident" id="6696567">Wait</span><span class="op" id="6696571">(</span><span class="op" id="6696572">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6696575">}</span><br>
<span class="lineno"></span><span class="op" id="6696577">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6696580">func</span>&nbsp;<span class="ident" id="6696585">runServerTestForVersion</span><span class="op" id="6696608">(</span><span class="ident" id="6696609">t</span>&nbsp;<span class="op" id="6696611">*</span><span class="ident" id="6696612">testing</span><span class="op" id="6696619">.</span><span class="ident" id="6696620">T</span><span class="op" id="6696621">,</span>&nbsp;<span class="ident" id="6696623">template</span>&nbsp;<span class="op" id="6696632">*</span><span class="ident" id="6696633">serverTest</span><span class="op" id="6696643">,</span>&nbsp;<span class="ident" id="6696645">prefix</span><span class="op" id="6696651">,</span>&nbsp;<span class="ident" id="6696653">option</span>&nbsp;<span class="builtintype" id="6696660">string</span><span class="op" id="6696666">)</span>&nbsp;<span class="op" id="6696668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6696671">test</span>&nbsp;<span class="op" id="6696676">:=</span>&nbsp;<span class="op" id="6696679">*</span><span class="ident" id="6696680">template</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6696690">test</span><span class="op" id="6696694">.</span><span class="ident" id="6696695">name</span>&nbsp;<span class="op" id="6696700">=</span>&nbsp;<span class="ident" id="6696702">prefix</span>&nbsp;<span class="op" id="6696709">+</span>&nbsp;<span class="ident" id="6696711">test</span><span class="op" id="6696715">.</span><span class="ident" id="6696716">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6696722">if</span>&nbsp;<span class="builtinfunc" id="6696725">len</span><span class="op" id="6696728">(</span><span class="ident" id="6696729">test</span><span class="op" id="6696733">.</span><span class="ident" id="6696734">command</span><span class="op" id="6696741">)</span>&nbsp;<span class="op" id="6696743">==</span>&nbsp;<span class="num" id="6696746">0</span>&nbsp;<span class="op" id="6696748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6696752">test</span><span class="op" id="6696756">.</span><span class="ident" id="6696757">command</span>&nbsp;<span class="op" id="6696765">=</span>&nbsp;<span class="ident" id="6696767">defaultClientCommand</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6696789">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6696792">test</span><span class="op" id="6696796">.</span><span class="ident" id="6696797">command</span>&nbsp;<span class="op" id="6696805">=</span>&nbsp;<span class="builtinfunc" id="6696807">append</span><span class="op" id="6696813">(</span><span class="op" id="6696814">[</span><span class="op" id="6696815">]</span><span class="builtintype" id="6696816">string</span><span class="op" id="6696822">(</span><span class="ident" id="6696823">nil</span><span class="op" id="6696826">)</span><span class="op" id="6696827">,</span>&nbsp;<span class="ident" id="6696829">test</span><span class="op" id="6696833">.</span><span class="ident" id="6696834">command</span><span class="op" id="6696841">...</span><span class="op" id="6696844">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6696847">test</span><span class="op" id="6696851">.</span><span class="ident" id="6696852">command</span>&nbsp;<span class="op" id="6696860">=</span>&nbsp;<span class="builtinfunc" id="6696862">append</span><span class="op" id="6696868">(</span><span class="ident" id="6696869">test</span><span class="op" id="6696873">.</span><span class="ident" id="6696874">command</span><span class="op" id="6696881">,</span>&nbsp;<span class="ident" id="6696883">option</span><span class="op" id="6696889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6696892">test</span><span class="op" id="6696896">.</span><span class="ident" id="6696897">run</span><span class="op" id="6696900">(</span><span class="ident" id="6696901">t</span><span class="op" id="6696902">,</span>&nbsp;<span class="op" id="6696904">*</span><span class="ident" id="6696905">update</span><span class="op" id="6696911">)</span><br>
<span class="lineno"></span><span class="op" id="6696913">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6696916">func</span>&nbsp;<span class="ident" id="6696921">runServerTestSSLv3</span><span class="op" id="6696939">(</span><span class="ident" id="6696940">t</span>&nbsp;<span class="op" id="6696942">*</span><span class="ident" id="6696943">testing</span><span class="op" id="6696950">.</span><span class="ident" id="6696951">T</span><span class="op" id="6696952">,</span>&nbsp;<span class="ident" id="6696954">template</span>&nbsp;<span class="op" id="6696963">*</span><span class="ident" id="6696964">serverTest</span><span class="op" id="6696974">)</span>&nbsp;<span class="op" id="6696976">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6696979">runServerTestForVersion</span><span class="op" id="6697002">(</span><span class="ident" id="6697003">t</span><span class="op" id="6697004">,</span>&nbsp;<span class="ident" id="6697006">template</span><span class="op" id="6697014">,</span>&nbsp;<span class="string" id="6697016">&#34;SSLv3-&#34;</span><span class="op" id="6697024">,</span>&nbsp;<span class="string" id="6697026">&#34;-ssl3&#34;</span><span class="op" id="6697033">)</span><br>
<span class="lineno"></span><span class="op" id="6697035">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6697038">func</span>&nbsp;<span class="ident" id="6697043">runServerTestTLS10</span><span class="op" id="6697061">(</span><span class="ident" id="6697062">t</span>&nbsp;<span class="op" id="6697064">*</span><span class="ident" id="6697065">testing</span><span class="op" id="6697072">.</span><span class="ident" id="6697073">T</span><span class="op" id="6697074">,</span>&nbsp;<span class="ident" id="6697076">template</span>&nbsp;<span class="op" id="6697085">*</span><span class="ident" id="6697086">serverTest</span><span class="op" id="6697096">)</span>&nbsp;<span class="op" id="6697098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6697101">runServerTestForVersion</span><span class="op" id="6697124">(</span><span class="ident" id="6697125">t</span><span class="op" id="6697126">,</span>&nbsp;<span class="ident" id="6697128">template</span><span class="op" id="6697136">,</span>&nbsp;<span class="string" id="6697138">&#34;TLSv10-&#34;</span><span class="op" id="6697147">,</span>&nbsp;<span class="string" id="6697149">&#34;-tls1&#34;</span><span class="op" id="6697156">)</span><br>
<span class="lineno">470</span><span class="op" id="6697158">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6697161">func</span>&nbsp;<span class="ident" id="6697166">runServerTestTLS11</span><span class="op" id="6697184">(</span><span class="ident" id="6697185">t</span>&nbsp;<span class="op" id="6697187">*</span><span class="ident" id="6697188">testing</span><span class="op" id="6697195">.</span><span class="ident" id="6697196">T</span><span class="op" id="6697197">,</span>&nbsp;<span class="ident" id="6697199">template</span>&nbsp;<span class="op" id="6697208">*</span><span class="ident" id="6697209">serverTest</span><span class="op" id="6697219">)</span>&nbsp;<span class="op" id="6697221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6697224">runServerTestForVersion</span><span class="op" id="6697247">(</span><span class="ident" id="6697248">t</span><span class="op" id="6697249">,</span>&nbsp;<span class="ident" id="6697251">template</span><span class="op" id="6697259">,</span>&nbsp;<span class="string" id="6697261">&#34;TLSv11-&#34;</span><span class="op" id="6697270">,</span>&nbsp;<span class="string" id="6697272">&#34;-tls1_1&#34;</span><span class="op" id="6697281">)</span><br>
<span class="lineno"></span><span class="op" id="6697283">}</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span><span class="keyword" id="6697286">func</span>&nbsp;<span class="ident" id="6697291">runServerTestTLS12</span><span class="op" id="6697309">(</span><span class="ident" id="6697310">t</span>&nbsp;<span class="op" id="6697312">*</span><span class="ident" id="6697313">testing</span><span class="op" id="6697320">.</span><span class="ident" id="6697321">T</span><span class="op" id="6697322">,</span>&nbsp;<span class="ident" id="6697324">template</span>&nbsp;<span class="op" id="6697333">*</span><span class="ident" id="6697334">serverTest</span><span class="op" id="6697344">)</span>&nbsp;<span class="op" id="6697346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6697349">runServerTestForVersion</span><span class="op" id="6697372">(</span><span class="ident" id="6697373">t</span><span class="op" id="6697374">,</span>&nbsp;<span class="ident" id="6697376">template</span><span class="op" id="6697384">,</span>&nbsp;<span class="string" id="6697386">&#34;TLSv12-&#34;</span><span class="op" id="6697395">,</span>&nbsp;<span class="string" id="6697397">&#34;-tls1_2&#34;</span><span class="op" id="6697406">)</span><br>
<span class="lineno"></span><span class="op" id="6697408">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">480</span><span class="keyword" id="6697411">func</span>&nbsp;<span class="ident" id="6697416">TestHandshakeServerRSARC4</span><span class="op" id="6697441">(</span><span class="ident" id="6697442">t</span>&nbsp;<span class="op" id="6697444">*</span><span class="ident" id="6697445">testing</span><span class="op" id="6697452">.</span><span class="ident" id="6697453">T</span><span class="op" id="6697454">)</span>&nbsp;<span class="op" id="6697456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6697459">test</span>&nbsp;<span class="op" id="6697464">:=</span>&nbsp;<span class="op" id="6697467">&amp;</span><span class="ident" id="6697468">serverTest</span><span class="op" id="6697478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6697482">name</span><span class="op" id="6697486">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6697491">&#34;RSA-RC4&#34;</span><span class="op" id="6697500">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6697504">command</span><span class="op" id="6697511">:</span>&nbsp;<span class="op" id="6697513">[</span><span class="op" id="6697514">]</span><span class="builtintype" id="6697515">string</span><span class="op" id="6697521">{</span><span class="string" id="6697522">&#34;openssl&#34;</span><span class="op" id="6697531">,</span>&nbsp;<span class="string" id="6697533">&#34;s_client&#34;</span><span class="op" id="6697543">,</span>&nbsp;<span class="string" id="6697545">&#34;-no_ticket&#34;</span><span class="op" id="6697557">,</span>&nbsp;<span class="string" id="6697559">&#34;-cipher&#34;</span><span class="op" id="6697568">,</span>&nbsp;<span class="string" id="6697570">&#34;RC4-SHA&#34;</span><span class="op" id="6697579">}</span><span class="op" id="6697580">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6697583">}</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6697586">runServerTestSSLv3</span><span class="op" id="6697604">(</span><span class="ident" id="6697605">t</span><span class="op" id="6697606">,</span>&nbsp;<span class="ident" id="6697608">test</span><span class="op" id="6697612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6697615">runServerTestTLS10</span><span class="op" id="6697633">(</span><span class="ident" id="6697634">t</span><span class="op" id="6697635">,</span>&nbsp;<span class="ident" id="6697637">test</span><span class="op" id="6697641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6697644">runServerTestTLS11</span><span class="op" id="6697662">(</span><span class="ident" id="6697663">t</span><span class="op" id="6697664">,</span>&nbsp;<span class="ident" id="6697666">test</span><span class="op" id="6697670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6697673">runServerTestTLS12</span><span class="op" id="6697691">(</span><span class="ident" id="6697692">t</span><span class="op" id="6697693">,</span>&nbsp;<span class="ident" id="6697695">test</span><span class="op" id="6697699">)</span><br>
<span class="lineno"></span><span class="op" id="6697701">}</span><br>
<span class="lineno">490</span><br>
<span class="lineno"></span><span class="keyword" id="6697704">func</span>&nbsp;<span class="ident" id="6697709">TestHandshakeServerRSA3DES</span><span class="op" id="6697735">(</span><span class="ident" id="6697736">t</span>&nbsp;<span class="op" id="6697738">*</span><span class="ident" id="6697739">testing</span><span class="op" id="6697746">.</span><span class="ident" id="6697747">T</span><span class="op" id="6697748">)</span>&nbsp;<span class="op" id="6697750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6697753">test</span>&nbsp;<span class="op" id="6697758">:=</span>&nbsp;<span class="op" id="6697761">&amp;</span><span class="ident" id="6697762">serverTest</span><span class="op" id="6697772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6697776">name</span><span class="op" id="6697780">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6697785">&#34;RSA-3DES&#34;</span><span class="op" id="6697795">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6697799">command</span><span class="op" id="6697806">:</span>&nbsp;<span class="op" id="6697808">[</span><span class="op" id="6697809">]</span><span class="builtintype" id="6697810">string</span><span class="op" id="6697816">{</span><span class="string" id="6697817">&#34;openssl&#34;</span><span class="op" id="6697826">,</span>&nbsp;<span class="string" id="6697828">&#34;s_client&#34;</span><span class="op" id="6697838">,</span>&nbsp;<span class="string" id="6697840">&#34;-no_ticket&#34;</span><span class="op" id="6697852">,</span>&nbsp;<span class="string" id="6697854">&#34;-cipher&#34;</span><span class="op" id="6697863">,</span>&nbsp;<span class="string" id="6697865">&#34;DES-CBC3-SHA&#34;</span><span class="op" id="6697879">}</span><span class="op" id="6697880">,</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6697883">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6697886">runServerTestSSLv3</span><span class="op" id="6697904">(</span><span class="ident" id="6697905">t</span><span class="op" id="6697906">,</span>&nbsp;<span class="ident" id="6697908">test</span><span class="op" id="6697912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6697915">runServerTestTLS10</span><span class="op" id="6697933">(</span><span class="ident" id="6697934">t</span><span class="op" id="6697935">,</span>&nbsp;<span class="ident" id="6697937">test</span><span class="op" id="6697941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6697944">runServerTestTLS12</span><span class="op" id="6697962">(</span><span class="ident" id="6697963">t</span><span class="op" id="6697964">,</span>&nbsp;<span class="ident" id="6697966">test</span><span class="op" id="6697970">)</span><br>
<span class="lineno"></span><span class="op" id="6697972">}</span><br>
<span class="lineno">500</span><br>
<span class="lineno"></span><span class="keyword" id="6697975">func</span>&nbsp;<span class="ident" id="6697980">TestHandshakeServerRSAAES</span><span class="op" id="6698005">(</span><span class="ident" id="6698006">t</span>&nbsp;<span class="op" id="6698008">*</span><span class="ident" id="6698009">testing</span><span class="op" id="6698016">.</span><span class="ident" id="6698017">T</span><span class="op" id="6698018">)</span>&nbsp;<span class="op" id="6698020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6698023">test</span>&nbsp;<span class="op" id="6698028">:=</span>&nbsp;<span class="op" id="6698031">&amp;</span><span class="ident" id="6698032">serverTest</span><span class="op" id="6698042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6698046">name</span><span class="op" id="6698050">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6698055">&#34;RSA-AES&#34;</span><span class="op" id="6698064">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6698068">command</span><span class="op" id="6698075">:</span>&nbsp;<span class="op" id="6698077">[</span><span class="op" id="6698078">]</span><span class="builtintype" id="6698079">string</span><span class="op" id="6698085">{</span><span class="string" id="6698086">&#34;openssl&#34;</span><span class="op" id="6698095">,</span>&nbsp;<span class="string" id="6698097">&#34;s_client&#34;</span><span class="op" id="6698107">,</span>&nbsp;<span class="string" id="6698109">&#34;-no_ticket&#34;</span><span class="op" id="6698121">,</span>&nbsp;<span class="string" id="6698123">&#34;-cipher&#34;</span><span class="op" id="6698132">,</span>&nbsp;<span class="string" id="6698134">&#34;AES128-SHA&#34;</span><span class="op" id="6698146">}</span><span class="op" id="6698147">,</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6698150">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6698153">runServerTestSSLv3</span><span class="op" id="6698171">(</span><span class="ident" id="6698172">t</span><span class="op" id="6698173">,</span>&nbsp;<span class="ident" id="6698175">test</span><span class="op" id="6698179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6698182">runServerTestTLS10</span><span class="op" id="6698200">(</span><span class="ident" id="6698201">t</span><span class="op" id="6698202">,</span>&nbsp;<span class="ident" id="6698204">test</span><span class="op" id="6698208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6698211">runServerTestTLS12</span><span class="op" id="6698229">(</span><span class="ident" id="6698230">t</span><span class="op" id="6698231">,</span>&nbsp;<span class="ident" id="6698233">test</span><span class="op" id="6698237">)</span><br>
<span class="lineno"></span><span class="op" id="6698239">}</span><br>
<span class="lineno">510</span><br>
<span class="lineno"></span><span class="keyword" id="6698242">func</span>&nbsp;<span class="ident" id="6698247">TestHandshakeServerAESGCM</span><span class="op" id="6698272">(</span><span class="ident" id="6698273">t</span>&nbsp;<span class="op" id="6698275">*</span><span class="ident" id="6698276">testing</span><span class="op" id="6698283">.</span><span class="ident" id="6698284">T</span><span class="op" id="6698285">)</span>&nbsp;<span class="op" id="6698287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6698290">test</span>&nbsp;<span class="op" id="6698295">:=</span>&nbsp;<span class="op" id="6698298">&amp;</span><span class="ident" id="6698299">serverTest</span><span class="op" id="6698309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6698313">name</span><span class="op" id="6698317">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6698322">&#34;RSA-AES-GCM&#34;</span><span class="op" id="6698335">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6698339">command</span><span class="op" id="6698346">:</span>&nbsp;<span class="op" id="6698348">[</span><span class="op" id="6698349">]</span><span class="builtintype" id="6698350">string</span><span class="op" id="6698356">{</span><span class="string" id="6698357">&#34;openssl&#34;</span><span class="op" id="6698366">,</span>&nbsp;<span class="string" id="6698368">&#34;s_client&#34;</span><span class="op" id="6698378">,</span>&nbsp;<span class="string" id="6698380">&#34;-no_ticket&#34;</span><span class="op" id="6698392">,</span>&nbsp;<span class="string" id="6698394">&#34;-cipher&#34;</span><span class="op" id="6698403">,</span>&nbsp;<span class="string" id="6698405">&#34;ECDHE-RSA-AES128-GCM-SHA256&#34;</span><span class="op" id="6698434">}</span><span class="op" id="6698435">,</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6698438">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6698441">runServerTestTLS12</span><span class="op" id="6698459">(</span><span class="ident" id="6698460">t</span><span class="op" id="6698461">,</span>&nbsp;<span class="ident" id="6698463">test</span><span class="op" id="6698467">)</span><br>
<span class="lineno"></span><span class="op" id="6698469">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6698472">func</span>&nbsp;<span class="ident" id="6698477">TestHandshakeServerECDHEECDSAAES</span><span class="op" id="6698509">(</span><span class="ident" id="6698510">t</span>&nbsp;<span class="op" id="6698512">*</span><span class="ident" id="6698513">testing</span><span class="op" id="6698520">.</span><span class="ident" id="6698521">T</span><span class="op" id="6698522">)</span>&nbsp;<span class="op" id="6698524">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6698527">config</span>&nbsp;<span class="op" id="6698534">:=</span>&nbsp;<span class="op" id="6698537">*</span><span class="ident" id="6698538">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6698550">config</span><span class="op" id="6698556">.</span><span class="ident" id="6698557">Certificates</span>&nbsp;<span class="op" id="6698570">=</span>&nbsp;<span class="builtinfunc" id="6698572">make</span><span class="op" id="6698576">(</span><span class="op" id="6698577">[</span><span class="op" id="6698578">]</span><span class="ident" id="6698579">Certificate</span><span class="op" id="6698590">,</span>&nbsp;<span class="num" id="6698592">1</span><span class="op" id="6698593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6698596">config</span><span class="op" id="6698602">.</span><span class="ident" id="6698603">Certificates</span><span class="op" id="6698615">[</span><span class="num" id="6698616">0</span><span class="op" id="6698617">]</span><span class="op" id="6698618">.</span><span class="ident" id="6698619">Certificate</span>&nbsp;<span class="op" id="6698631">=</span>&nbsp;<span class="op" id="6698633">[</span><span class="op" id="6698634">]</span><span class="op" id="6698635">[</span><span class="op" id="6698636">]</span><span class="builtintype" id="6698637">byte</span><span class="op" id="6698641">{</span><span class="ident" id="6698642">testECDSACertificate</span><span class="op" id="6698662">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6698665">config</span><span class="op" id="6698671">.</span><span class="ident" id="6698672">Certificates</span><span class="op" id="6698684">[</span><span class="num" id="6698685">0</span><span class="op" id="6698686">]</span><span class="op" id="6698687">.</span><span class="ident" id="6698688">PrivateKey</span>&nbsp;<span class="op" id="6698699">=</span>&nbsp;<span class="ident" id="6698701">testECDSAPrivateKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6698722">config</span><span class="op" id="6698728">.</span><span class="ident" id="6698729">BuildNameToCertificate</span><span class="op" id="6698751">(</span><span class="op" id="6698752">)</span><br>
<span class="lineno">525</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6698756">test</span>&nbsp;<span class="op" id="6698761">:=</span>&nbsp;<span class="op" id="6698764">&amp;</span><span class="ident" id="6698765">serverTest</span><span class="op" id="6698775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6698779">name</span><span class="op" id="6698783">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6698788">&#34;ECDHE-ECDSA-AES&#34;</span><span class="op" id="6698805">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6698809">command</span><span class="op" id="6698816">:</span>&nbsp;<span class="op" id="6698818">[</span><span class="op" id="6698819">]</span><span class="builtintype" id="6698820">string</span><span class="op" id="6698826">{</span><span class="string" id="6698827">&#34;openssl&#34;</span><span class="op" id="6698836">,</span>&nbsp;<span class="string" id="6698838">&#34;s_client&#34;</span><span class="op" id="6698848">,</span>&nbsp;<span class="string" id="6698850">&#34;-no_ticket&#34;</span><span class="op" id="6698862">,</span>&nbsp;<span class="string" id="6698864">&#34;-cipher&#34;</span><span class="op" id="6698873">,</span>&nbsp;<span class="string" id="6698875">&#34;ECDHE-ECDSA-AES256-SHA&#34;</span><span class="op" id="6698899">}</span><span class="op" id="6698900">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6698904">config</span><span class="op" id="6698910">:</span>&nbsp;&nbsp;<span class="op" id="6698913">&amp;</span><span class="ident" id="6698914">config</span><span class="op" id="6698920">,</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6698923">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6698926">runServerTestTLS10</span><span class="op" id="6698944">(</span><span class="ident" id="6698945">t</span><span class="op" id="6698946">,</span>&nbsp;<span class="ident" id="6698948">test</span><span class="op" id="6698952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6698955">runServerTestTLS12</span><span class="op" id="6698973">(</span><span class="ident" id="6698974">t</span><span class="op" id="6698975">,</span>&nbsp;<span class="ident" id="6698977">test</span><span class="op" id="6698981">)</span><br>
<span class="lineno"></span><span class="op" id="6698983">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span><span class="keyword" id="6698986">func</span>&nbsp;<span class="ident" id="6698991">TestHandshakeServerALPN</span><span class="op" id="6699014">(</span><span class="ident" id="6699015">t</span>&nbsp;<span class="op" id="6699017">*</span><span class="ident" id="6699018">testing</span><span class="op" id="6699025">.</span><span class="ident" id="6699026">T</span><span class="op" id="6699027">)</span>&nbsp;<span class="op" id="6699029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6699032">config</span>&nbsp;<span class="op" id="6699039">:=</span>&nbsp;<span class="op" id="6699042">*</span><span class="ident" id="6699043">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6699055">config</span><span class="op" id="6699061">.</span><span class="ident" id="6699062">NextProtos</span>&nbsp;<span class="op" id="6699073">=</span>&nbsp;<span class="op" id="6699075">[</span><span class="op" id="6699076">]</span><span class="builtintype" id="6699077">string</span><span class="op" id="6699083">{</span><span class="string" id="6699084">&#34;proto1&#34;</span><span class="op" id="6699092">,</span>&nbsp;<span class="string" id="6699094">&#34;proto2&#34;</span><span class="op" id="6699102">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6699106">test</span>&nbsp;<span class="op" id="6699111">:=</span>&nbsp;<span class="op" id="6699114">&amp;</span><span class="ident" id="6699115">serverTest</span><span class="op" id="6699125">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6699129">name</span><span class="op" id="6699133">:</span>&nbsp;<span class="string" id="6699135">&#34;ALPN&#34;</span><span class="op" id="6699141">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6699145">//&nbsp;Note&nbsp;that&nbsp;this&nbsp;needs&nbsp;OpenSSL&nbsp;1.0.2&nbsp;because&nbsp;that&nbsp;is&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6699211">//&nbsp;version&nbsp;that&nbsp;supports&nbsp;the&nbsp;-alpn&nbsp;flag.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6699254">command</span><span class="op" id="6699261">:</span>&nbsp;<span class="op" id="6699263">[</span><span class="op" id="6699264">]</span><span class="builtintype" id="6699265">string</span><span class="op" id="6699271">{</span><span class="string" id="6699272">&#34;openssl&#34;</span><span class="op" id="6699281">,</span>&nbsp;<span class="string" id="6699283">&#34;s_client&#34;</span><span class="op" id="6699293">,</span>&nbsp;<span class="string" id="6699295">&#34;-alpn&#34;</span><span class="op" id="6699302">,</span>&nbsp;<span class="string" id="6699304">&#34;proto2,proto1&#34;</span><span class="op" id="6699319">}</span><span class="op" id="6699320">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6699324">config</span><span class="op" id="6699330">:</span>&nbsp;&nbsp;<span class="op" id="6699333">&amp;</span><span class="ident" id="6699334">config</span><span class="op" id="6699340">,</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6699344">validate</span><span class="op" id="6699352">:</span>&nbsp;<span class="keyword" id="6699354">func</span><span class="op" id="6699358">(</span><span class="ident" id="6699359">state</span>&nbsp;<span class="ident" id="6699365">ConnectionState</span><span class="op" id="6699380">)</span>&nbsp;<span class="builtintype" id="6699382">error</span>&nbsp;<span class="op" id="6699388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6699393">//&nbsp;The&nbsp;server&#39;s&nbsp;preferences&nbsp;should&nbsp;override&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6699452">if</span>&nbsp;<span class="ident" id="6699455">state</span><span class="op" id="6699460">.</span><span class="ident" id="6699461">NegotiatedProtocol</span>&nbsp;<span class="op" id="6699480">!=</span>&nbsp;<span class="string" id="6699483">&#34;proto1&#34;</span>&nbsp;<span class="op" id="6699492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6699498">return</span>&nbsp;<span class="ident" id="6699505">fmt</span><span class="op" id="6699508">.</span><span class="ident" id="6699509">Errorf</span><span class="op" id="6699515">(</span><span class="string" id="6699516">&#34;Got&nbsp;protocol&nbsp;%q,&nbsp;wanted&nbsp;proto1&#34;</span><span class="op" id="6699548">,</span>&nbsp;<span class="ident" id="6699550">state</span><span class="op" id="6699555">.</span><span class="ident" id="6699556">NegotiatedProtocol</span><span class="op" id="6699574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6699579">}</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6699584">return</span>&nbsp;<span class="ident" id="6699591">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6699597">}</span><span class="op" id="6699598">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6699601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6699604">runServerTestTLS12</span><span class="op" id="6699622">(</span><span class="ident" id="6699623">t</span><span class="op" id="6699624">,</span>&nbsp;<span class="ident" id="6699626">test</span><span class="op" id="6699630">)</span><br>
<span class="lineno"></span><span class="op" id="6699632">}</span><br>
<span class="lineno">555</span><br>
<span class="lineno"></span><span class="keyword" id="6699635">func</span>&nbsp;<span class="ident" id="6699640">TestHandshakeServerALPNNoMatch</span><span class="op" id="6699670">(</span><span class="ident" id="6699671">t</span>&nbsp;<span class="op" id="6699673">*</span><span class="ident" id="6699674">testing</span><span class="op" id="6699681">.</span><span class="ident" id="6699682">T</span><span class="op" id="6699683">)</span>&nbsp;<span class="op" id="6699685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6699688">config</span>&nbsp;<span class="op" id="6699695">:=</span>&nbsp;<span class="op" id="6699698">*</span><span class="ident" id="6699699">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6699711">config</span><span class="op" id="6699717">.</span><span class="ident" id="6699718">NextProtos</span>&nbsp;<span class="op" id="6699729">=</span>&nbsp;<span class="op" id="6699731">[</span><span class="op" id="6699732">]</span><span class="builtintype" id="6699733">string</span><span class="op" id="6699739">{</span><span class="string" id="6699740">&#34;proto3&#34;</span><span class="op" id="6699748">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6699752">test</span>&nbsp;<span class="op" id="6699757">:=</span>&nbsp;<span class="op" id="6699760">&amp;</span><span class="ident" id="6699761">serverTest</span><span class="op" id="6699771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6699775">name</span><span class="op" id="6699779">:</span>&nbsp;<span class="string" id="6699781">&#34;ALPN-NoMatch&#34;</span><span class="op" id="6699795">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6699799">//&nbsp;Note&nbsp;that&nbsp;this&nbsp;needs&nbsp;OpenSSL&nbsp;1.0.2&nbsp;because&nbsp;that&nbsp;is&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6699865">//&nbsp;version&nbsp;that&nbsp;supports&nbsp;the&nbsp;-alpn&nbsp;flag.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6699908">command</span><span class="op" id="6699915">:</span>&nbsp;<span class="op" id="6699917">[</span><span class="op" id="6699918">]</span><span class="builtintype" id="6699919">string</span><span class="op" id="6699925">{</span><span class="string" id="6699926">&#34;openssl&#34;</span><span class="op" id="6699935">,</span>&nbsp;<span class="string" id="6699937">&#34;s_client&#34;</span><span class="op" id="6699947">,</span>&nbsp;<span class="string" id="6699949">&#34;-alpn&#34;</span><span class="op" id="6699956">,</span>&nbsp;<span class="string" id="6699958">&#34;proto2,proto1&#34;</span><span class="op" id="6699973">}</span><span class="op" id="6699974">,</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6699978">config</span><span class="op" id="6699984">:</span>&nbsp;&nbsp;<span class="op" id="6699987">&amp;</span><span class="ident" id="6699988">config</span><span class="op" id="6699994">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6699998">validate</span><span class="op" id="6700006">:</span>&nbsp;<span class="keyword" id="6700008">func</span><span class="op" id="6700012">(</span><span class="ident" id="6700013">state</span>&nbsp;<span class="ident" id="6700019">ConnectionState</span><span class="op" id="6700034">)</span>&nbsp;<span class="builtintype" id="6700036">error</span>&nbsp;<span class="op" id="6700042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6700047">//&nbsp;Rather&nbsp;than&nbsp;reject&nbsp;the&nbsp;connection,&nbsp;Go&nbsp;doesn&#39;t&nbsp;select</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6700106">//&nbsp;a&nbsp;protocol&nbsp;when&nbsp;there&nbsp;is&nbsp;no&nbsp;overlap.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6700149">if</span>&nbsp;<span class="ident" id="6700152">state</span><span class="op" id="6700157">.</span><span class="ident" id="6700158">NegotiatedProtocol</span>&nbsp;<span class="op" id="6700177">!=</span>&nbsp;<span class="string" id="6700180">&#34;&#34;</span>&nbsp;<span class="op" id="6700183">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6700189">return</span>&nbsp;<span class="ident" id="6700196">fmt</span><span class="op" id="6700199">.</span><span class="ident" id="6700200">Errorf</span><span class="op" id="6700206">(</span><span class="string" id="6700207">&#34;Got&nbsp;protocol&nbsp;%q,&nbsp;wanted&nbsp;&#39;&#39;&#34;</span><span class="op" id="6700235">,</span>&nbsp;<span class="ident" id="6700237">state</span><span class="op" id="6700242">.</span><span class="ident" id="6700243">NegotiatedProtocol</span><span class="op" id="6700261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6700266">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6700271">return</span>&nbsp;<span class="ident" id="6700278">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6700284">}</span><span class="op" id="6700285">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6700288">}</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6700291">runServerTestTLS12</span><span class="op" id="6700309">(</span><span class="ident" id="6700310">t</span><span class="op" id="6700311">,</span>&nbsp;<span class="ident" id="6700313">test</span><span class="op" id="6700317">)</span><br>
<span class="lineno"></span><span class="op" id="6700319">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6700322">//&nbsp;TestHandshakeServerSNI&nbsp;involves&nbsp;a&nbsp;client&nbsp;sending&nbsp;an&nbsp;SNI&nbsp;extension&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="6700394">//&nbsp;&#34;snitest.com&#34;,&nbsp;which&nbsp;happens&nbsp;to&nbsp;match&nbsp;the&nbsp;CN&nbsp;of&nbsp;testSNICertificate.&nbsp;The&nbsp;test</span><br>
<span class="lineno">580</span><span class="comment" id="6700474">//&nbsp;verifies&nbsp;that&nbsp;the&nbsp;server&nbsp;correctly&nbsp;selects&nbsp;that&nbsp;certificate.</span><br>
<span class="lineno"></span><span class="keyword" id="6700538">func</span>&nbsp;<span class="ident" id="6700543">TestHandshakeServerSNI</span><span class="op" id="6700565">(</span><span class="ident" id="6700566">t</span>&nbsp;<span class="op" id="6700568">*</span><span class="ident" id="6700569">testing</span><span class="op" id="6700576">.</span><span class="ident" id="6700577">T</span><span class="op" id="6700578">)</span>&nbsp;<span class="op" id="6700580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6700583">test</span>&nbsp;<span class="op" id="6700588">:=</span>&nbsp;<span class="op" id="6700591">&amp;</span><span class="ident" id="6700592">serverTest</span><span class="op" id="6700602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6700606">name</span><span class="op" id="6700610">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6700615">&#34;SNI&#34;</span><span class="op" id="6700620">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6700624">command</span><span class="op" id="6700631">:</span>&nbsp;<span class="op" id="6700633">[</span><span class="op" id="6700634">]</span><span class="builtintype" id="6700635">string</span><span class="op" id="6700641">{</span><span class="string" id="6700642">&#34;openssl&#34;</span><span class="op" id="6700651">,</span>&nbsp;<span class="string" id="6700653">&#34;s_client&#34;</span><span class="op" id="6700663">,</span>&nbsp;<span class="string" id="6700665">&#34;-no_ticket&#34;</span><span class="op" id="6700677">,</span>&nbsp;<span class="string" id="6700679">&#34;-cipher&#34;</span><span class="op" id="6700688">,</span>&nbsp;<span class="string" id="6700690">&#34;AES128-SHA&#34;</span><span class="op" id="6700702">,</span>&nbsp;<span class="string" id="6700704">&#34;-servername&#34;</span><span class="op" id="6700717">,</span>&nbsp;<span class="string" id="6700719">&#34;snitest.com&#34;</span><span class="op" id="6700732">}</span><span class="op" id="6700733">,</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6700736">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6700739">runServerTestTLS12</span><span class="op" id="6700757">(</span><span class="ident" id="6700758">t</span><span class="op" id="6700759">,</span>&nbsp;<span class="ident" id="6700761">test</span><span class="op" id="6700765">)</span><br>
<span class="lineno"></span><span class="op" id="6700767">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6700770">//&nbsp;TestHandshakeServerSNICertForName&nbsp;is&nbsp;similar&nbsp;to&nbsp;TestHandshakeServerSNI,&nbsp;but</span><br>
<span class="lineno">590</span><span class="comment" id="6700849">//&nbsp;tests&nbsp;the&nbsp;dynamic&nbsp;GetCertificate&nbsp;method</span><br>
<span class="lineno"></span><span class="keyword" id="6700892">func</span>&nbsp;<span class="ident" id="6700897">TestHandshakeServerSNIGetCertificate</span><span class="op" id="6700933">(</span><span class="ident" id="6700934">t</span>&nbsp;<span class="op" id="6700936">*</span><span class="ident" id="6700937">testing</span><span class="op" id="6700944">.</span><span class="ident" id="6700945">T</span><span class="op" id="6700946">)</span>&nbsp;<span class="op" id="6700948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6700951">config</span>&nbsp;<span class="op" id="6700958">:=</span>&nbsp;<span class="op" id="6700961">*</span><span class="ident" id="6700962">testConfig</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6700975">//&nbsp;Replace&nbsp;the&nbsp;NameToCertificate&nbsp;map&nbsp;with&nbsp;a&nbsp;GetCertificate&nbsp;function</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6701044">nameToCert</span>&nbsp;<span class="op" id="6701055">:=</span>&nbsp;<span class="ident" id="6701058">config</span><span class="op" id="6701064">.</span><span class="ident" id="6701065">NameToCertificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6701084">config</span><span class="op" id="6701090">.</span><span class="ident" id="6701091">NameToCertificate</span>&nbsp;<span class="op" id="6701109">=</span>&nbsp;<span class="ident" id="6701111">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6701116">config</span><span class="op" id="6701122">.</span><span class="ident" id="6701123">GetCertificate</span>&nbsp;<span class="op" id="6701138">=</span>&nbsp;<span class="keyword" id="6701140">func</span><span class="op" id="6701144">(</span><span class="ident" id="6701145">clientHello</span>&nbsp;<span class="op" id="6701157">*</span><span class="ident" id="6701158">ClientHelloInfo</span><span class="op" id="6701173">)</span>&nbsp;<span class="op" id="6701175">(</span><span class="op" id="6701176">*</span><span class="ident" id="6701177">Certificate</span><span class="op" id="6701188">,</span>&nbsp;<span class="builtintype" id="6701190">error</span><span class="op" id="6701195">)</span>&nbsp;<span class="op" id="6701197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6701201">cert</span><span class="op" id="6701205">,</span>&nbsp;<span class="ident" id="6701207">_</span>&nbsp;<span class="op" id="6701209">:=</span>&nbsp;<span class="ident" id="6701212">nameToCert</span><span class="op" id="6701222">[</span><span class="ident" id="6701223">clientHello</span><span class="op" id="6701234">.</span><span class="ident" id="6701235">ServerName</span><span class="op" id="6701245">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6701249">return</span>&nbsp;<span class="ident" id="6701256">cert</span><span class="op" id="6701260">,</span>&nbsp;<span class="ident" id="6701262">nil</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6701267">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6701270">test</span>&nbsp;<span class="op" id="6701275">:=</span>&nbsp;<span class="op" id="6701278">&amp;</span><span class="ident" id="6701279">serverTest</span><span class="op" id="6701289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6701293">name</span><span class="op" id="6701297">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6701302">&#34;SNI&#34;</span><span class="op" id="6701307">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6701311">command</span><span class="op" id="6701318">:</span>&nbsp;<span class="op" id="6701320">[</span><span class="op" id="6701321">]</span><span class="builtintype" id="6701322">string</span><span class="op" id="6701328">{</span><span class="string" id="6701329">&#34;openssl&#34;</span><span class="op" id="6701338">,</span>&nbsp;<span class="string" id="6701340">&#34;s_client&#34;</span><span class="op" id="6701350">,</span>&nbsp;<span class="string" id="6701352">&#34;-no_ticket&#34;</span><span class="op" id="6701364">,</span>&nbsp;<span class="string" id="6701366">&#34;-cipher&#34;</span><span class="op" id="6701375">,</span>&nbsp;<span class="string" id="6701377">&#34;AES128-SHA&#34;</span><span class="op" id="6701389">,</span>&nbsp;<span class="string" id="6701391">&#34;-servername&#34;</span><span class="op" id="6701404">,</span>&nbsp;<span class="string" id="6701406">&#34;snitest.com&#34;</span><span class="op" id="6701419">}</span><span class="op" id="6701420">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6701424">config</span><span class="op" id="6701430">:</span>&nbsp;&nbsp;<span class="op" id="6701433">&amp;</span><span class="ident" id="6701434">config</span><span class="op" id="6701440">,</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6701443">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6701446">runServerTestTLS12</span><span class="op" id="6701464">(</span><span class="ident" id="6701465">t</span><span class="op" id="6701466">,</span>&nbsp;<span class="ident" id="6701468">test</span><span class="op" id="6701472">)</span><br>
<span class="lineno"></span><span class="op" id="6701474">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6701477">//&nbsp;TestHandshakeServerSNICertForNameNotFound&nbsp;is&nbsp;similar&nbsp;to</span><br>
<span class="lineno">610</span><span class="comment" id="6701536">//&nbsp;TestHandshakeServerSNICertForName,&nbsp;but&nbsp;tests&nbsp;to&nbsp;make&nbsp;sure&nbsp;that&nbsp;when&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6701611">//&nbsp;GetCertificate&nbsp;method&nbsp;doesn&#39;t&nbsp;return&nbsp;a&nbsp;cert,&nbsp;we&nbsp;fall&nbsp;back&nbsp;to&nbsp;what&#39;s&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="6701685">//&nbsp;the&nbsp;NameToCertificate&nbsp;map.</span><br>
<span class="lineno"></span><span class="keyword" id="6701715">func</span>&nbsp;<span class="ident" id="6701720">TestHandshakeServerSNIGetCertificateNotFound</span><span class="op" id="6701764">(</span><span class="ident" id="6701765">t</span>&nbsp;<span class="op" id="6701767">*</span><span class="ident" id="6701768">testing</span><span class="op" id="6701775">.</span><span class="ident" id="6701776">T</span><span class="op" id="6701777">)</span>&nbsp;<span class="op" id="6701779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6701782">config</span>&nbsp;<span class="op" id="6701789">:=</span>&nbsp;<span class="op" id="6701792">*</span><span class="ident" id="6701793">testConfig</span><br>
<span class="lineno">615</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6701806">config</span><span class="op" id="6701812">.</span><span class="ident" id="6701813">GetCertificate</span>&nbsp;<span class="op" id="6701828">=</span>&nbsp;<span class="keyword" id="6701830">func</span><span class="op" id="6701834">(</span><span class="ident" id="6701835">clientHello</span>&nbsp;<span class="op" id="6701847">*</span><span class="ident" id="6701848">ClientHelloInfo</span><span class="op" id="6701863">)</span>&nbsp;<span class="op" id="6701865">(</span><span class="op" id="6701866">*</span><span class="ident" id="6701867">Certificate</span><span class="op" id="6701878">,</span>&nbsp;<span class="builtintype" id="6701880">error</span><span class="op" id="6701885">)</span>&nbsp;<span class="op" id="6701887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6701891">return</span>&nbsp;<span class="ident" id="6701898">nil</span><span class="op" id="6701901">,</span>&nbsp;<span class="ident" id="6701903">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6701908">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6701911">test</span>&nbsp;<span class="op" id="6701916">:=</span>&nbsp;<span class="op" id="6701919">&amp;</span><span class="ident" id="6701920">serverTest</span><span class="op" id="6701930">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6701934">name</span><span class="op" id="6701938">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6701943">&#34;SNI&#34;</span><span class="op" id="6701948">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6701952">command</span><span class="op" id="6701959">:</span>&nbsp;<span class="op" id="6701961">[</span><span class="op" id="6701962">]</span><span class="builtintype" id="6701963">string</span><span class="op" id="6701969">{</span><span class="string" id="6701970">&#34;openssl&#34;</span><span class="op" id="6701979">,</span>&nbsp;<span class="string" id="6701981">&#34;s_client&#34;</span><span class="op" id="6701991">,</span>&nbsp;<span class="string" id="6701993">&#34;-no_ticket&#34;</span><span class="op" id="6702005">,</span>&nbsp;<span class="string" id="6702007">&#34;-cipher&#34;</span><span class="op" id="6702016">,</span>&nbsp;<span class="string" id="6702018">&#34;AES128-SHA&#34;</span><span class="op" id="6702030">,</span>&nbsp;<span class="string" id="6702032">&#34;-servername&#34;</span><span class="op" id="6702045">,</span>&nbsp;<span class="string" id="6702047">&#34;snitest.com&#34;</span><span class="op" id="6702060">}</span><span class="op" id="6702061">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6702065">config</span><span class="op" id="6702071">:</span>&nbsp;&nbsp;<span class="op" id="6702074">&amp;</span><span class="ident" id="6702075">config</span><span class="op" id="6702081">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6702084">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6702087">runServerTestTLS12</span><span class="op" id="6702105">(</span><span class="ident" id="6702106">t</span><span class="op" id="6702107">,</span>&nbsp;<span class="ident" id="6702109">test</span><span class="op" id="6702113">)</span><br>
<span class="lineno">625</span><span class="op" id="6702115">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6702118">//&nbsp;TestHandshakeServerSNICertForNameError&nbsp;tests&nbsp;to&nbsp;make&nbsp;sure&nbsp;that&nbsp;errors&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="6702194">//&nbsp;GetCertificate&nbsp;result&nbsp;in&nbsp;a&nbsp;tls&nbsp;alert.</span><br>
<span class="lineno"></span><span class="keyword" id="6702235">func</span>&nbsp;<span class="ident" id="6702240">TestHandshakeServerSNIGetCertificateError</span><span class="op" id="6702281">(</span><span class="ident" id="6702282">t</span>&nbsp;<span class="op" id="6702284">*</span><span class="ident" id="6702285">testing</span><span class="op" id="6702292">.</span><span class="ident" id="6702293">T</span><span class="op" id="6702294">)</span>&nbsp;<span class="op" id="6702296">{</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6702299">config</span>&nbsp;<span class="op" id="6702306">:=</span>&nbsp;<span class="op" id="6702309">*</span><span class="ident" id="6702310">testConfig</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6702323">config</span><span class="op" id="6702329">.</span><span class="ident" id="6702330">GetCertificate</span>&nbsp;<span class="op" id="6702345">=</span>&nbsp;<span class="keyword" id="6702347">func</span><span class="op" id="6702351">(</span><span class="ident" id="6702352">clientHello</span>&nbsp;<span class="op" id="6702364">*</span><span class="ident" id="6702365">ClientHelloInfo</span><span class="op" id="6702380">)</span>&nbsp;<span class="op" id="6702382">(</span><span class="op" id="6702383">*</span><span class="ident" id="6702384">Certificate</span><span class="op" id="6702395">,</span>&nbsp;<span class="builtintype" id="6702397">error</span><span class="op" id="6702402">)</span>&nbsp;<span class="op" id="6702404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6702408">return</span>&nbsp;<span class="ident" id="6702415">nil</span><span class="op" id="6702418">,</span>&nbsp;<span class="ident" id="6702420">fmt</span><span class="op" id="6702423">.</span><span class="ident" id="6702424">Errorf</span><span class="op" id="6702430">(</span><span class="string" id="6702431">&#34;Test&nbsp;error&nbsp;in&nbsp;GetCertificate&#34;</span><span class="op" id="6702461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6702464">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6702467">test</span>&nbsp;<span class="op" id="6702472">:=</span>&nbsp;<span class="op" id="6702475">&amp;</span><span class="ident" id="6702476">serverTest</span><span class="op" id="6702486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6702490">name</span><span class="op" id="6702494">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6702503">&#34;SNI&#34;</span><span class="op" id="6702508">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6702512">command</span><span class="op" id="6702519">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6702525">[</span><span class="op" id="6702526">]</span><span class="builtintype" id="6702527">string</span><span class="op" id="6702533">{</span><span class="string" id="6702534">&#34;openssl&#34;</span><span class="op" id="6702543">,</span>&nbsp;<span class="string" id="6702545">&#34;s_client&#34;</span><span class="op" id="6702555">,</span>&nbsp;<span class="string" id="6702557">&#34;-no_ticket&#34;</span><span class="op" id="6702569">,</span>&nbsp;<span class="string" id="6702571">&#34;-cipher&#34;</span><span class="op" id="6702580">,</span>&nbsp;<span class="string" id="6702582">&#34;AES128-SHA&#34;</span><span class="op" id="6702594">,</span>&nbsp;<span class="string" id="6702596">&#34;-servername&#34;</span><span class="op" id="6702609">,</span>&nbsp;<span class="string" id="6702611">&#34;snitest.com&#34;</span><span class="op" id="6702624">}</span><span class="op" id="6702625">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6702629">config</span><span class="op" id="6702635">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6702642">&amp;</span><span class="ident" id="6702643">config</span><span class="op" id="6702649">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6702653">expectAlert</span><span class="op" id="6702664">:</span>&nbsp;<span class="builtintype" id="6702666">true</span><span class="op" id="6702670">,</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6702673">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6702676">runServerTestTLS12</span><span class="op" id="6702694">(</span><span class="ident" id="6702695">t</span><span class="op" id="6702696">,</span>&nbsp;<span class="ident" id="6702698">test</span><span class="op" id="6702702">)</span><br>
<span class="lineno"></span><span class="op" id="6702704">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6702707">//&nbsp;TestCipherSuiteCertPreferance&nbsp;ensures&nbsp;that&nbsp;we&nbsp;select&nbsp;an&nbsp;RSA&nbsp;ciphersuite&nbsp;with</span><br>
<span class="lineno">645</span><span class="comment" id="6702787">//&nbsp;an&nbsp;RSA&nbsp;certificate&nbsp;and&nbsp;an&nbsp;ECDSA&nbsp;ciphersuite&nbsp;with&nbsp;an&nbsp;ECDSA&nbsp;certificate.</span><br>
<span class="lineno"></span><span class="keyword" id="6702861">func</span>&nbsp;<span class="ident" id="6702866">TestCipherSuiteCertPreferenceECDSA</span><span class="op" id="6702900">(</span><span class="ident" id="6702901">t</span>&nbsp;<span class="op" id="6702903">*</span><span class="ident" id="6702904">testing</span><span class="op" id="6702911">.</span><span class="ident" id="6702912">T</span><span class="op" id="6702913">)</span>&nbsp;<span class="op" id="6702915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6702918">config</span>&nbsp;<span class="op" id="6702925">:=</span>&nbsp;<span class="op" id="6702928">*</span><span class="ident" id="6702929">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6702941">config</span><span class="op" id="6702947">.</span><span class="ident" id="6702948">CipherSuites</span>&nbsp;<span class="op" id="6702961">=</span>&nbsp;<span class="op" id="6702963">[</span><span class="op" id="6702964">]</span><span class="builtintype" id="6702965">uint16</span><span class="op" id="6702971">{</span><span class="ident" id="6702972">TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA</span><span class="op" id="6703008">,</span>&nbsp;<span class="ident" id="6703010">TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA</span><span class="op" id="6703044">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6703047">config</span><span class="op" id="6703053">.</span><span class="ident" id="6703054">PreferServerCipherSuites</span>&nbsp;<span class="op" id="6703079">=</span>&nbsp;<span class="builtintype" id="6703081">true</span><br>
<span class="lineno">650</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6703088">test</span>&nbsp;<span class="op" id="6703093">:=</span>&nbsp;<span class="op" id="6703096">&amp;</span><span class="ident" id="6703097">serverTest</span><span class="op" id="6703107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6703111">name</span><span class="op" id="6703115">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="6703119">&#34;CipherSuiteCertPreferenceRSA&#34;</span><span class="op" id="6703149">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6703153">config</span><span class="op" id="6703159">:</span>&nbsp;<span class="op" id="6703161">&amp;</span><span class="ident" id="6703162">config</span><span class="op" id="6703168">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6703171">}</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6703174">runServerTestTLS12</span><span class="op" id="6703192">(</span><span class="ident" id="6703193">t</span><span class="op" id="6703194">,</span>&nbsp;<span class="ident" id="6703196">test</span><span class="op" id="6703200">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6703204">config</span>&nbsp;<span class="op" id="6703211">=</span>&nbsp;<span class="op" id="6703213">*</span><span class="ident" id="6703214">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6703226">config</span><span class="op" id="6703232">.</span><span class="ident" id="6703233">CipherSuites</span>&nbsp;<span class="op" id="6703246">=</span>&nbsp;<span class="op" id="6703248">[</span><span class="op" id="6703249">]</span><span class="builtintype" id="6703250">uint16</span><span class="op" id="6703256">{</span><span class="ident" id="6703257">TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA</span><span class="op" id="6703291">,</span>&nbsp;<span class="ident" id="6703293">TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA</span><span class="op" id="6703329">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6703332">config</span><span class="op" id="6703338">.</span><span class="ident" id="6703339">Certificates</span>&nbsp;<span class="op" id="6703352">=</span>&nbsp;<span class="op" id="6703354">[</span><span class="op" id="6703355">]</span><span class="ident" id="6703356">Certificate</span><span class="op" id="6703367">{</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6703371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6703376">Certificate</span><span class="op" id="6703387">:</span>&nbsp;<span class="op" id="6703389">[</span><span class="op" id="6703390">]</span><span class="op" id="6703391">[</span><span class="op" id="6703392">]</span><span class="builtintype" id="6703393">byte</span><span class="op" id="6703397">{</span><span class="ident" id="6703398">testECDSACertificate</span><span class="op" id="6703418">}</span><span class="op" id="6703419">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6703424">PrivateKey</span><span class="op" id="6703434">:</span>&nbsp;&nbsp;<span class="ident" id="6703437">testECDSAPrivateKey</span><span class="op" id="6703456">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6703460">}</span><span class="op" id="6703461">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6703464">}</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6703467">config</span><span class="op" id="6703473">.</span><span class="ident" id="6703474">BuildNameToCertificate</span><span class="op" id="6703496">(</span><span class="op" id="6703497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6703500">config</span><span class="op" id="6703506">.</span><span class="ident" id="6703507">PreferServerCipherSuites</span>&nbsp;<span class="op" id="6703532">=</span>&nbsp;<span class="builtintype" id="6703534">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6703541">test</span>&nbsp;<span class="op" id="6703546">=</span>&nbsp;<span class="op" id="6703548">&amp;</span><span class="ident" id="6703549">serverTest</span><span class="op" id="6703559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6703563">name</span><span class="op" id="6703567">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="6703571">&#34;CipherSuiteCertPreferenceECDSA&#34;</span><span class="op" id="6703603">,</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6703607">config</span><span class="op" id="6703613">:</span>&nbsp;<span class="op" id="6703615">&amp;</span><span class="ident" id="6703616">config</span><span class="op" id="6703622">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6703625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6703628">runServerTestTLS12</span><span class="op" id="6703646">(</span><span class="ident" id="6703647">t</span><span class="op" id="6703648">,</span>&nbsp;<span class="ident" id="6703650">test</span><span class="op" id="6703654">)</span><br>
<span class="lineno"></span><span class="op" id="6703656">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">675</span><span class="keyword" id="6703659">func</span>&nbsp;<span class="ident" id="6703664">TestResumption</span><span class="op" id="6703678">(</span><span class="ident" id="6703679">t</span>&nbsp;<span class="op" id="6703681">*</span><span class="ident" id="6703682">testing</span><span class="op" id="6703689">.</span><span class="ident" id="6703690">T</span><span class="op" id="6703691">)</span>&nbsp;<span class="op" id="6703693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6703696">sessionFilePath</span>&nbsp;<span class="op" id="6703712">:=</span>&nbsp;<span class="ident" id="6703715">tempFile</span><span class="op" id="6703723">(</span><span class="string" id="6703724">&#34;&#34;</span><span class="op" id="6703726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6703729">defer</span>&nbsp;<span class="ident" id="6703735">os</span><span class="op" id="6703737">.</span><span class="ident" id="6703738">Remove</span><span class="op" id="6703744">(</span><span class="ident" id="6703745">sessionFilePath</span><span class="op" id="6703760">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6703764">test</span>&nbsp;<span class="op" id="6703769">:=</span>&nbsp;<span class="op" id="6703772">&amp;</span><span class="ident" id="6703773">serverTest</span><span class="op" id="6703783">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6703787">name</span><span class="op" id="6703791">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6703796">&#34;IssueTicket&#34;</span><span class="op" id="6703809">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6703813">command</span><span class="op" id="6703820">:</span>&nbsp;<span class="op" id="6703822">[</span><span class="op" id="6703823">]</span><span class="builtintype" id="6703824">string</span><span class="op" id="6703830">{</span><span class="string" id="6703831">&#34;openssl&#34;</span><span class="op" id="6703840">,</span>&nbsp;<span class="string" id="6703842">&#34;s_client&#34;</span><span class="op" id="6703852">,</span>&nbsp;<span class="string" id="6703854">&#34;-cipher&#34;</span><span class="op" id="6703863">,</span>&nbsp;<span class="string" id="6703865">&#34;RC4-SHA&#34;</span><span class="op" id="6703874">,</span>&nbsp;<span class="string" id="6703876">&#34;-sess_out&#34;</span><span class="op" id="6703887">,</span>&nbsp;<span class="ident" id="6703889">sessionFilePath</span><span class="op" id="6703904">}</span><span class="op" id="6703905">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6703908">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6703911">runServerTestTLS12</span><span class="op" id="6703929">(</span><span class="ident" id="6703930">t</span><span class="op" id="6703931">,</span>&nbsp;<span class="ident" id="6703933">test</span><span class="op" id="6703937">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6703941">test</span>&nbsp;<span class="op" id="6703946">=</span>&nbsp;<span class="op" id="6703948">&amp;</span><span class="ident" id="6703949">serverTest</span><span class="op" id="6703959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6703963">name</span><span class="op" id="6703967">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6703972">&#34;Resume&#34;</span><span class="op" id="6703980">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6703984">command</span><span class="op" id="6703991">:</span>&nbsp;<span class="op" id="6703993">[</span><span class="op" id="6703994">]</span><span class="builtintype" id="6703995">string</span><span class="op" id="6704001">{</span><span class="string" id="6704002">&#34;openssl&#34;</span><span class="op" id="6704011">,</span>&nbsp;<span class="string" id="6704013">&#34;s_client&#34;</span><span class="op" id="6704023">,</span>&nbsp;<span class="string" id="6704025">&#34;-cipher&#34;</span><span class="op" id="6704034">,</span>&nbsp;<span class="string" id="6704036">&#34;RC4-SHA&#34;</span><span class="op" id="6704045">,</span>&nbsp;<span class="string" id="6704047">&#34;-sess_in&#34;</span><span class="op" id="6704057">,</span>&nbsp;<span class="ident" id="6704059">sessionFilePath</span><span class="op" id="6704074">}</span><span class="op" id="6704075">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6704078">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6704081">runServerTestTLS12</span><span class="op" id="6704099">(</span><span class="ident" id="6704100">t</span><span class="op" id="6704101">,</span>&nbsp;<span class="ident" id="6704103">test</span><span class="op" id="6704107">)</span><br>
<span class="lineno">690</span><span class="op" id="6704109">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6704112">func</span>&nbsp;<span class="ident" id="6704117">TestResumptionDisabled</span><span class="op" id="6704139">(</span><span class="ident" id="6704140">t</span>&nbsp;<span class="op" id="6704142">*</span><span class="ident" id="6704143">testing</span><span class="op" id="6704150">.</span><span class="ident" id="6704151">T</span><span class="op" id="6704152">)</span>&nbsp;<span class="op" id="6704154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6704157">sessionFilePath</span>&nbsp;<span class="op" id="6704173">:=</span>&nbsp;<span class="ident" id="6704176">tempFile</span><span class="op" id="6704184">(</span><span class="string" id="6704185">&#34;&#34;</span><span class="op" id="6704187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6704190">defer</span>&nbsp;<span class="ident" id="6704196">os</span><span class="op" id="6704198">.</span><span class="ident" id="6704199">Remove</span><span class="op" id="6704205">(</span><span class="ident" id="6704206">sessionFilePath</span><span class="op" id="6704221">)</span><br>
<span class="lineno">695</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6704225">config</span>&nbsp;<span class="op" id="6704232">:=</span>&nbsp;<span class="op" id="6704235">*</span><span class="ident" id="6704236">testConfig</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6704249">test</span>&nbsp;<span class="op" id="6704254">:=</span>&nbsp;<span class="op" id="6704257">&amp;</span><span class="ident" id="6704258">serverTest</span><span class="op" id="6704268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6704272">name</span><span class="op" id="6704276">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6704281">&#34;IssueTicketPreDisable&#34;</span><span class="op" id="6704304">,</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6704308">command</span><span class="op" id="6704315">:</span>&nbsp;<span class="op" id="6704317">[</span><span class="op" id="6704318">]</span><span class="builtintype" id="6704319">string</span><span class="op" id="6704325">{</span><span class="string" id="6704326">&#34;openssl&#34;</span><span class="op" id="6704335">,</span>&nbsp;<span class="string" id="6704337">&#34;s_client&#34;</span><span class="op" id="6704347">,</span>&nbsp;<span class="string" id="6704349">&#34;-cipher&#34;</span><span class="op" id="6704358">,</span>&nbsp;<span class="string" id="6704360">&#34;RC4-SHA&#34;</span><span class="op" id="6704369">,</span>&nbsp;<span class="string" id="6704371">&#34;-sess_out&#34;</span><span class="op" id="6704382">,</span>&nbsp;<span class="ident" id="6704384">sessionFilePath</span><span class="op" id="6704399">}</span><span class="op" id="6704400">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6704404">config</span><span class="op" id="6704410">:</span>&nbsp;&nbsp;<span class="op" id="6704413">&amp;</span><span class="ident" id="6704414">config</span><span class="op" id="6704420">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6704423">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6704426">runServerTestTLS12</span><span class="op" id="6704444">(</span><span class="ident" id="6704445">t</span><span class="op" id="6704446">,</span>&nbsp;<span class="ident" id="6704448">test</span><span class="op" id="6704452">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6704456">config</span><span class="op" id="6704462">.</span><span class="ident" id="6704463">SessionTicketsDisabled</span>&nbsp;<span class="op" id="6704486">=</span>&nbsp;<span class="builtintype" id="6704488">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6704495">test</span>&nbsp;<span class="op" id="6704500">=</span>&nbsp;<span class="op" id="6704502">&amp;</span><span class="ident" id="6704503">serverTest</span><span class="op" id="6704513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6704517">name</span><span class="op" id="6704521">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6704526">&#34;ResumeDisabled&#34;</span><span class="op" id="6704542">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6704546">command</span><span class="op" id="6704553">:</span>&nbsp;<span class="op" id="6704555">[</span><span class="op" id="6704556">]</span><span class="builtintype" id="6704557">string</span><span class="op" id="6704563">{</span><span class="string" id="6704564">&#34;openssl&#34;</span><span class="op" id="6704573">,</span>&nbsp;<span class="string" id="6704575">&#34;s_client&#34;</span><span class="op" id="6704585">,</span>&nbsp;<span class="string" id="6704587">&#34;-cipher&#34;</span><span class="op" id="6704596">,</span>&nbsp;<span class="string" id="6704598">&#34;RC4-SHA&#34;</span><span class="op" id="6704607">,</span>&nbsp;<span class="string" id="6704609">&#34;-sess_in&#34;</span><span class="op" id="6704619">,</span>&nbsp;<span class="ident" id="6704621">sessionFilePath</span><span class="op" id="6704636">}</span><span class="op" id="6704637">,</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6704641">config</span><span class="op" id="6704647">:</span>&nbsp;&nbsp;<span class="op" id="6704650">&amp;</span><span class="ident" id="6704651">config</span><span class="op" id="6704657">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6704660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6704663">runServerTestTLS12</span><span class="op" id="6704681">(</span><span class="ident" id="6704682">t</span><span class="op" id="6704683">,</span>&nbsp;<span class="ident" id="6704685">test</span><span class="op" id="6704689">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6704693">//&nbsp;One&nbsp;needs&nbsp;to&nbsp;manually&nbsp;confirm&nbsp;that&nbsp;the&nbsp;handshake&nbsp;in&nbsp;the&nbsp;golden&nbsp;data</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6704765">//&nbsp;file&nbsp;for&nbsp;ResumeDisabled&nbsp;does&nbsp;not&nbsp;include&nbsp;a&nbsp;resumption&nbsp;handshake.</span><br>
<span class="lineno"></span><span class="op" id="6704833">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6704836">func</span>&nbsp;<span class="ident" id="6704841">TestFallbackSCSV</span><span class="op" id="6704857">(</span><span class="ident" id="6704858">t</span>&nbsp;<span class="op" id="6704860">*</span><span class="ident" id="6704861">testing</span><span class="op" id="6704868">.</span><span class="ident" id="6704869">T</span><span class="op" id="6704870">)</span>&nbsp;<span class="op" id="6704872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6704875">test</span>&nbsp;<span class="op" id="6704880">:=</span>&nbsp;<span class="op" id="6704883">&amp;</span><span class="ident" id="6704884">serverTest</span><span class="op" id="6704894">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6704898">name</span><span class="op" id="6704902">:</span>&nbsp;<span class="string" id="6704904">&#34;FallbackSCSV&#34;</span><span class="op" id="6704918">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6704922">//&nbsp;OpenSSL&nbsp;1.0.1j&nbsp;is&nbsp;needed&nbsp;for&nbsp;the&nbsp;-fallback_scsv&nbsp;option.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6704983">command</span><span class="op" id="6704990">:</span>&nbsp;<span class="op" id="6704992">[</span><span class="op" id="6704993">]</span><span class="builtintype" id="6704994">string</span><span class="op" id="6705000">{</span><span class="string" id="6705001">&#34;openssl&#34;</span><span class="op" id="6705010">,</span>&nbsp;<span class="string" id="6705012">&#34;s_client&#34;</span><span class="op" id="6705022">,</span>&nbsp;<span class="string" id="6705024">&#34;-fallback_scsv&#34;</span><span class="op" id="6705040">}</span><span class="op" id="6705041">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6705045">expectHandshakeErrorIncluding</span><span class="op" id="6705074">:</span>&nbsp;<span class="string" id="6705076">&#34;inppropriate&nbsp;protocol&nbsp;fallback&#34;</span><span class="op" id="6705108">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6705111">}</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6705114">runServerTestTLS11</span><span class="op" id="6705132">(</span><span class="ident" id="6705133">t</span><span class="op" id="6705134">,</span>&nbsp;<span class="ident" id="6705136">test</span><span class="op" id="6705140">)</span><br>
<span class="lineno"></span><span class="op" id="6705142">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6705145">//&nbsp;cert.pem&nbsp;and&nbsp;key.pem&nbsp;were&nbsp;generated&nbsp;with&nbsp;generate_cert.go</span><br>
<span class="lineno"></span><span class="comment" id="6705206">//&nbsp;Thus,&nbsp;they&nbsp;have&nbsp;no&nbsp;ExtKeyUsage&nbsp;fields&nbsp;and&nbsp;trigger&nbsp;an&nbsp;error</span><br>
<span class="lineno">730</span><span class="comment" id="6705268">//&nbsp;when&nbsp;verification&nbsp;is&nbsp;turned&nbsp;on.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6705304">const</span>&nbsp;<span class="ident" id="6705310">clientCertificatePEM</span>&nbsp;<span class="op" id="6705331">=</span>&nbsp;<span class="string" id="6705333">`<br>
<span class="lineno"></span>-----BEGIN&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>MIIB7TCCAVigAwIBAgIBADALBgkqhkiG9w0BAQUwJjEQMA4GA1UEChMHQWNtZSBD<br>
<span class="lineno">735</span>bzESMBAGA1UEAxMJMTI3LjAuMC4xMB4XDTExMTIwODA3NTUxMloXDTEyMTIwNzA4<br>
<span class="lineno"></span>MDAxMlowJjEQMA4GA1UEChMHQWNtZSBDbzESMBAGA1UEAxMJMTI3LjAuMC4xMIGc<br>
<span class="lineno"></span>MAsGCSqGSIb3DQEBAQOBjAAwgYgCgYBO0Hsx44Jk2VnAwoekXh6LczPHY1PfZpIG<br>
<span class="lineno"></span>hPZk1Y/kNqcdK+izIDZFI7Xjla7t4PUgnI2V339aEu+H5Fto5OkOdOwEin/ekyfE<br>
<span class="lineno"></span>ARl6vfLcPRSr0FTKIQzQTW6HLlzF0rtNS0/Otiz3fojsfNcCkXSmHgwa2uNKWi7e<br>
<span class="lineno">740</span>E5xMQIhZkwIDAQABozIwMDAOBgNVHQ8BAf8EBAMCAKAwDQYDVR0OBAYEBAECAwQw<br>
<span class="lineno"></span>DwYDVR0jBAgwBoAEAQIDBDALBgkqhkiG9w0BAQUDgYEANh+zegx1yW43RmEr1b3A<br>
<span class="lineno"></span>p0vMRpqBWHyFeSnIyMZn3TJWRSt1tukkqVCavh9a+hoV2cxVlXIWg7nCto/9iIw4<br>
<span class="lineno"></span>hB2rXZIxE0/9gzvGnfERYraL7KtnvshksBFQRlgXa5kc0x38BvEO5ZaoDPl4ILdE<br>
<span class="lineno"></span>GFGNEH5PlGffo05wc46QkYU=<br>
<span class="lineno">745</span>-----END&nbsp;CERTIFICATE-----`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6706066">const</span>&nbsp;<span class="ident" id="6706072">clientKeyPEM</span>&nbsp;<span class="op" id="6706085">=</span>&nbsp;<span class="string" id="6706087">`<br>
<span class="lineno"></span>-----BEGIN&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno"></span>MIICWgIBAAKBgE7QezHjgmTZWcDCh6ReHotzM8djU99mkgaE9mTVj+Q2px0r6LMg<br>
<span class="lineno">750</span>NkUjteOVru3g9SCcjZXff1oS74fkW2jk6Q507ASKf96TJ8QBGXq98tw9FKvQVMoh<br>
<span class="lineno"></span>DNBNbocuXMXSu01LT862LPd+iOx81wKRdKYeDBra40paLt4TnExAiFmTAgMBAAEC<br>
<span class="lineno"></span>gYBxvXd8yNteFTns8A/2yomEMC4yeosJJSpp1CsN3BJ7g8/qTnrVPxBy+RU+qr63<br>
<span class="lineno"></span>t2WquaOu/cr5P8iEsa6lk20tf8pjKLNXeX0b1RTzK8rJLbS7nGzP3tvOhL096VtQ<br>
<span class="lineno"></span>dAo4ROEaro0TzYpHmpciSvxVIeEIAAdFDObDJPKqcJAxyQJBAJizfYgK8Gzx9fsx<br>
<span class="lineno">755</span>hxp+VteCbVPg2euASH5Yv3K5LukRdKoSzHE2grUVQgN/LafC0eZibRanxHegYSr7<br>
<span class="lineno"></span>7qaswKUCQQCEIWor/X4XTMdVj3Oj+vpiw75y/S9gh682+myZL+d/02IEkwnB098P<br>
<span class="lineno"></span>RkKVpenBHyrGg0oeN5La7URILWKj7CPXAkBKo6F+d+phNjwIFoN1Xb/RA32w/D1I<br>
<span class="lineno"></span>saG9sF+UEhRt9AxUfW/U/tIQ9V0ZHHcSg1XaCM5Nvp934brdKdvTOKnJAkBD5h/3<br>
<span class="lineno"></span>Rybatlvg/fzBEaJFyq09zhngkxlZOUtBVTqzl17RVvY2orgH02U4HbCHy4phxOn7<br>
<span class="lineno">760</span>qTdQRYlHRftgnWK1AkANibn9PRYJ7mJyJ9Dyj2QeNcSkSTzrt0tPvUMf4+meJymN<br>
<span class="lineno"></span>1Ntu5+S1DLLzfxlaljWG6ylW6DNxujCyuXIV2rvA<br>
<span class="lineno"></span>-----END&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6706974">const</span>&nbsp;<span class="ident" id="6706980">clientECDSACertificatePEM</span>&nbsp;<span class="op" id="6707006">=</span>&nbsp;<span class="string" id="6707008">`<br>
<span class="lineno">765</span>-----BEGIN&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>MIIB/DCCAV4CCQCaMIRsJjXZFzAJBgcqhkjOPQQBMEUxCzAJBgNVBAYTAkFVMRMw<br>
<span class="lineno"></span>EQYDVQQIEwpTb21lLVN0YXRlMSEwHwYDVQQKExhJbnRlcm5ldCBXaWRnaXRzIFB0<br>
<span class="lineno"></span>eSBMdGQwHhcNMTIxMTE0MTMyNTUzWhcNMjIxMTEyMTMyNTUzWjBBMQswCQYDVQQG<br>
<span class="lineno"></span>EwJBVTEMMAoGA1UECBMDTlNXMRAwDgYDVQQHEwdQeXJtb250MRIwEAYDVQQDEwlK<br>
<span class="lineno">770</span>b2VsIFNpbmcwgZswEAYHKoZIzj0CAQYFK4EEACMDgYYABACVjJF1FMBexFe01MNv<br>
<span class="lineno"></span>ja5oHt1vzobhfm6ySD6B5U7ixohLZNz1MLvT/2XMW/TdtWo+PtAd3kfDdq0Z9kUs<br>
<span class="lineno"></span>jLzYHQFMH3CQRnZIi4+DzEpcj0B22uCJ7B0rxE4wdihBsmKo+1vx+U56jb0JuK7q<br>
<span class="lineno"></span>ixgnTy5w/hOWusPTQBbNZU6sER7m8TAJBgcqhkjOPQQBA4GMADCBiAJCAOAUxGBg<br>
<span class="lineno"></span>C3JosDJdYUoCdFzCgbkWqD8pyDbHgf9stlvZcPE4O1BIKJTLCRpS8V3ujfK58PDa<br>
<span class="lineno">775</span>2RU6+b0DeoeiIzXsAkIBo9SKeDUcSpoj0gq+KxAxnZxfvuiRs9oa9V2jI/Umi0Vw<br>
<span class="lineno"></span>jWVim34BmT0Y9hCaOGGbLlfk+syxis7iI6CH8OFnUes=<br>
<span class="lineno"></span>-----END&nbsp;CERTIFICATE-----`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6707761">const</span>&nbsp;<span class="ident" id="6707767">clientECDSAKeyPEM</span>&nbsp;<span class="op" id="6707785">=</span>&nbsp;<span class="string" id="6707787">`<br>
<span class="lineno">780</span>-----BEGIN&nbsp;EC&nbsp;PARAMETERS-----<br>
<span class="lineno"></span>BgUrgQQAIw==<br>
<span class="lineno"></span>-----END&nbsp;EC&nbsp;PARAMETERS-----<br>
<span class="lineno"></span>-----BEGIN&nbsp;EC&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno"></span>MIHcAgEBBEIBkJN9X4IqZIguiEVKMqeBUP5xtRsEv4HJEtOpOGLELwO53SD78Ew8<br>
<span class="lineno">785</span>k+wLWoqizS3NpQyMtrU8JFdWfj+C57UNkOugBwYFK4EEACOhgYkDgYYABACVjJF1<br>
<span class="lineno"></span>FMBexFe01MNvja5oHt1vzobhfm6ySD6B5U7ixohLZNz1MLvT/2XMW/TdtWo+PtAd<br>
<span class="lineno"></span>3kfDdq0Z9kUsjLzYHQFMH3CQRnZIi4+DzEpcj0B22uCJ7B0rxE4wdihBsmKo+1vx<br>
<span class="lineno"></span>+U56jb0JuK7qixgnTy5w/hOWusPTQBbNZU6sER7m8Q==<br>
<span class="lineno"></span>-----END&nbsp;EC&nbsp;PRIVATE&nbsp;KEY-----`</span><br>
<span class="lineno">790</span><br>
<span class="lineno"></span><span class="keyword" id="6708227">func</span>&nbsp;<span class="ident" id="6708232">TestClientAuth</span><span class="op" id="6708246">(</span><span class="ident" id="6708247">t</span>&nbsp;<span class="op" id="6708249">*</span><span class="ident" id="6708250">testing</span><span class="op" id="6708257">.</span><span class="ident" id="6708258">T</span><span class="op" id="6708259">)</span>&nbsp;<span class="op" id="6708261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6708264">var</span>&nbsp;<span class="ident" id="6708268">certPath</span><span class="op" id="6708276">,</span>&nbsp;<span class="ident" id="6708278">keyPath</span><span class="op" id="6708285">,</span>&nbsp;<span class="ident" id="6708287">ecdsaCertPath</span><span class="op" id="6708300">,</span>&nbsp;<span class="ident" id="6708302">ecdsaKeyPath</span>&nbsp;<span class="builtintype" id="6708315">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6708324">if</span>&nbsp;<span class="op" id="6708327">*</span><span class="ident" id="6708328">update</span>&nbsp;<span class="op" id="6708335">{</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6708339">certPath</span>&nbsp;<span class="op" id="6708348">=</span>&nbsp;<span class="ident" id="6708350">tempFile</span><span class="op" id="6708358">(</span><span class="ident" id="6708359">clientCertificatePEM</span><span class="op" id="6708379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6708383">defer</span>&nbsp;<span class="ident" id="6708389">os</span><span class="op" id="6708391">.</span><span class="ident" id="6708392">Remove</span><span class="op" id="6708398">(</span><span class="ident" id="6708399">certPath</span><span class="op" id="6708407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6708411">keyPath</span>&nbsp;<span class="op" id="6708419">=</span>&nbsp;<span class="ident" id="6708421">tempFile</span><span class="op" id="6708429">(</span><span class="ident" id="6708430">clientKeyPEM</span><span class="op" id="6708442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6708446">defer</span>&nbsp;<span class="ident" id="6708452">os</span><span class="op" id="6708454">.</span><span class="ident" id="6708455">Remove</span><span class="op" id="6708461">(</span><span class="ident" id="6708462">keyPath</span><span class="op" id="6708469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6708473">ecdsaCertPath</span>&nbsp;<span class="op" id="6708487">=</span>&nbsp;<span class="ident" id="6708489">tempFile</span><span class="op" id="6708497">(</span><span class="ident" id="6708498">clientECDSACertificatePEM</span><span class="op" id="6708523">)</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6708527">defer</span>&nbsp;<span class="ident" id="6708533">os</span><span class="op" id="6708535">.</span><span class="ident" id="6708536">Remove</span><span class="op" id="6708542">(</span><span class="ident" id="6708543">ecdsaCertPath</span><span class="op" id="6708556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6708560">ecdsaKeyPath</span>&nbsp;<span class="op" id="6708573">=</span>&nbsp;<span class="ident" id="6708575">tempFile</span><span class="op" id="6708583">(</span><span class="ident" id="6708584">clientECDSAKeyPEM</span><span class="op" id="6708601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6708605">defer</span>&nbsp;<span class="ident" id="6708611">os</span><span class="op" id="6708613">.</span><span class="ident" id="6708614">Remove</span><span class="op" id="6708620">(</span><span class="ident" id="6708621">ecdsaKeyPath</span><span class="op" id="6708633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6708636">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6708640">config</span>&nbsp;<span class="op" id="6708647">:=</span>&nbsp;<span class="op" id="6708650">*</span><span class="ident" id="6708651">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6708663">config</span><span class="op" id="6708669">.</span><span class="ident" id="6708670">ClientAuth</span>&nbsp;<span class="op" id="6708681">=</span>&nbsp;<span class="ident" id="6708683">RequestClientCert</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6708703">test</span>&nbsp;<span class="op" id="6708708">:=</span>&nbsp;<span class="op" id="6708711">&amp;</span><span class="ident" id="6708712">serverTest</span><span class="op" id="6708722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6708726">name</span><span class="op" id="6708730">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6708735">&#34;ClientAuthRequestedNotGiven&#34;</span><span class="op" id="6708764">,</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6708768">command</span><span class="op" id="6708775">:</span>&nbsp;<span class="op" id="6708777">[</span><span class="op" id="6708778">]</span><span class="builtintype" id="6708779">string</span><span class="op" id="6708785">{</span><span class="string" id="6708786">&#34;openssl&#34;</span><span class="op" id="6708795">,</span>&nbsp;<span class="string" id="6708797">&#34;s_client&#34;</span><span class="op" id="6708807">,</span>&nbsp;<span class="string" id="6708809">&#34;-no_ticket&#34;</span><span class="op" id="6708821">,</span>&nbsp;<span class="string" id="6708823">&#34;-cipher&#34;</span><span class="op" id="6708832">,</span>&nbsp;<span class="string" id="6708834">&#34;RC4-SHA&#34;</span><span class="op" id="6708843">}</span><span class="op" id="6708844">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6708848">config</span><span class="op" id="6708854">:</span>&nbsp;&nbsp;<span class="op" id="6708857">&amp;</span><span class="ident" id="6708858">config</span><span class="op" id="6708864">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6708867">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6708870">runServerTestTLS12</span><span class="op" id="6708888">(</span><span class="ident" id="6708889">t</span><span class="op" id="6708890">,</span>&nbsp;<span class="ident" id="6708892">test</span><span class="op" id="6708896">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6708900">test</span>&nbsp;<span class="op" id="6708905">=</span>&nbsp;<span class="op" id="6708907">&amp;</span><span class="ident" id="6708908">serverTest</span><span class="op" id="6708918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6708922">name</span><span class="op" id="6708926">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6708941">&#34;ClientAuthRequestedAndGiven&#34;</span><span class="op" id="6708970">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6708974">command</span><span class="op" id="6708981">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6708993">[</span><span class="op" id="6708994">]</span><span class="builtintype" id="6708995">string</span><span class="op" id="6709001">{</span><span class="string" id="6709002">&#34;openssl&#34;</span><span class="op" id="6709011">,</span>&nbsp;<span class="string" id="6709013">&#34;s_client&#34;</span><span class="op" id="6709023">,</span>&nbsp;<span class="string" id="6709025">&#34;-no_ticket&#34;</span><span class="op" id="6709037">,</span>&nbsp;<span class="string" id="6709039">&#34;-cipher&#34;</span><span class="op" id="6709048">,</span>&nbsp;<span class="string" id="6709050">&#34;RC4-SHA&#34;</span><span class="op" id="6709059">,</span>&nbsp;<span class="string" id="6709061">&#34;-cert&#34;</span><span class="op" id="6709068">,</span>&nbsp;<span class="ident" id="6709070">certPath</span><span class="op" id="6709078">,</span>&nbsp;<span class="string" id="6709080">&#34;-key&#34;</span><span class="op" id="6709086">,</span>&nbsp;<span class="ident" id="6709088">keyPath</span><span class="op" id="6709095">}</span><span class="op" id="6709096">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6709100">config</span><span class="op" id="6709106">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6709119">&amp;</span><span class="ident" id="6709120">config</span><span class="op" id="6709126">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6709130">expectedPeerCerts</span><span class="op" id="6709147">:</span>&nbsp;<span class="op" id="6709149">[</span><span class="op" id="6709150">]</span><span class="builtintype" id="6709151">string</span><span class="op" id="6709157">{</span><span class="ident" id="6709158">clientCertificatePEM</span><span class="op" id="6709178">}</span><span class="op" id="6709179">,</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6709182">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6709185">runServerTestTLS12</span><span class="op" id="6709203">(</span><span class="ident" id="6709204">t</span><span class="op" id="6709205">,</span>&nbsp;<span class="ident" id="6709207">test</span><span class="op" id="6709211">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6709215">test</span>&nbsp;<span class="op" id="6709220">=</span>&nbsp;<span class="op" id="6709222">&amp;</span><span class="ident" id="6709223">serverTest</span><span class="op" id="6709233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6709237">name</span><span class="op" id="6709241">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6709256">&#34;ClientAuthRequestedAndECDSAGiven&#34;</span><span class="op" id="6709290">,</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6709294">command</span><span class="op" id="6709301">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6709313">[</span><span class="op" id="6709314">]</span><span class="builtintype" id="6709315">string</span><span class="op" id="6709321">{</span><span class="string" id="6709322">&#34;openssl&#34;</span><span class="op" id="6709331">,</span>&nbsp;<span class="string" id="6709333">&#34;s_client&#34;</span><span class="op" id="6709343">,</span>&nbsp;<span class="string" id="6709345">&#34;-no_ticket&#34;</span><span class="op" id="6709357">,</span>&nbsp;<span class="string" id="6709359">&#34;-cipher&#34;</span><span class="op" id="6709368">,</span>&nbsp;<span class="string" id="6709370">&#34;RC4-SHA&#34;</span><span class="op" id="6709379">,</span>&nbsp;<span class="string" id="6709381">&#34;-cert&#34;</span><span class="op" id="6709388">,</span>&nbsp;<span class="ident" id="6709390">ecdsaCertPath</span><span class="op" id="6709403">,</span>&nbsp;<span class="string" id="6709405">&#34;-key&#34;</span><span class="op" id="6709411">,</span>&nbsp;<span class="ident" id="6709413">ecdsaKeyPath</span><span class="op" id="6709425">}</span><span class="op" id="6709426">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6709430">config</span><span class="op" id="6709436">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6709449">&amp;</span><span class="ident" id="6709450">config</span><span class="op" id="6709456">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6709460">expectedPeerCerts</span><span class="op" id="6709477">:</span>&nbsp;<span class="op" id="6709479">[</span><span class="op" id="6709480">]</span><span class="builtintype" id="6709481">string</span><span class="op" id="6709487">{</span><span class="ident" id="6709488">clientECDSACertificatePEM</span><span class="op" id="6709513">}</span><span class="op" id="6709514">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6709517">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6709520">runServerTestTLS12</span><span class="op" id="6709538">(</span><span class="ident" id="6709539">t</span><span class="op" id="6709540">,</span>&nbsp;<span class="ident" id="6709542">test</span><span class="op" id="6709546">)</span><br>
<span class="lineno">830</span><span class="op" id="6709548">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6709551">func</span>&nbsp;<span class="ident" id="6709556">bigFromString</span><span class="op" id="6709569">(</span><span class="ident" id="6709570">s</span>&nbsp;<span class="builtintype" id="6709572">string</span><span class="op" id="6709578">)</span>&nbsp;<span class="op" id="6709580">*</span><span class="ident" id="6709581">big</span><span class="op" id="6709584">.</span><span class="ident" id="6709585">Int</span>&nbsp;<span class="op" id="6709589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6709592">ret</span>&nbsp;<span class="op" id="6709596">:=</span>&nbsp;<span class="builtinfunc" id="6709599">new</span><span class="op" id="6709602">(</span><span class="ident" id="6709603">big</span><span class="op" id="6709606">.</span><span class="ident" id="6709607">Int</span><span class="op" id="6709610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6709613">ret</span><span class="op" id="6709616">.</span><span class="ident" id="6709617">SetString</span><span class="op" id="6709626">(</span><span class="ident" id="6709627">s</span><span class="op" id="6709628">,</span>&nbsp;<span class="num" id="6709630">10</span><span class="op" id="6709632">)</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6709635">return</span>&nbsp;<span class="ident" id="6709642">ret</span><br>
<span class="lineno"></span><span class="op" id="6709646">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6709649">func</span>&nbsp;<span class="ident" id="6709654">fromHex</span><span class="op" id="6709661">(</span><span class="ident" id="6709662">s</span>&nbsp;<span class="builtintype" id="6709664">string</span><span class="op" id="6709670">)</span>&nbsp;<span class="op" id="6709672">[</span><span class="op" id="6709673">]</span><span class="builtintype" id="6709674">byte</span>&nbsp;<span class="op" id="6709679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6709682">b</span><span class="op" id="6709683">,</span>&nbsp;<span class="ident" id="6709685">_</span>&nbsp;<span class="op" id="6709687">:=</span>&nbsp;<span class="ident" id="6709690">hex</span><span class="op" id="6709693">.</span><span class="ident" id="6709694">DecodeString</span><span class="op" id="6709706">(</span><span class="ident" id="6709707">s</span><span class="op" id="6709708">)</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6709711">return</span>&nbsp;<span class="ident" id="6709718">b</span><br>
<span class="lineno"></span><span class="op" id="6709720">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6709723">var</span>&nbsp;<span class="ident" id="6709727">testRSACertificate</span>&nbsp;<span class="op" id="6709746">=</span>&nbsp;<span class="ident" id="6709748">fromHex</span><span class="op" id="6709755">(</span><span class="string" id="6709756">&#34;308202b030820219a00302010202090085b0bba48a7fb8ca300d06092a864886f70d01010505003045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c7464301e170d3130303432343039303933385a170d3131303432343039303933385a3045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c746430819f300d06092a864886f70d010101050003818d0030818902818100bb79d6f517b5e5bf4610d0dc69bee62b07435ad0032d8a7a4385b71452e7a5654c2c78b8238cb5b482e5de1f953b7e62a52ca533d6fe125c7a56fcf506bffa587b263fb5cd04d3d0c921964ac7f4549f5abfef427100fe1899077f7e887d7df10439c4a22edb51c97ce3c04c3b326601cfafb11db8719a1ddbdb896baeda2d790203010001a381a73081a4301d0603551d0e04160414b1ade2855acfcb28db69ce2369ded3268e18883930750603551d23046e306c8014b1ade2855acfcb28db69ce2369ded3268e188839a149a4473045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c746482090085b0bba48a7fb8ca300c0603551d13040530030101ff300d06092a864886f70d010105050003818100086c4524c76bb159ab0c52ccf2b014d7879d7a6475b55a9566e4c52b8eae12661feb4f38b36e60d392fdf74108b52513b1187a24fb301dbaed98b917ece7d73159db95d31d78ea50565cd5825a2d5a5f33c4b6d8c97590968c0f5298b5cd981f89205ff2a01ca31b9694dda9fd57e970e8266d71999b266e3850296c90a7bdd9&#34;</span><span class="op" id="6711142">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">845</span><span class="keyword" id="6711145">var</span>&nbsp;<span class="ident" id="6711149">testECDSACertificate</span>&nbsp;<span class="op" id="6711170">=</span>&nbsp;<span class="ident" id="6711172">fromHex</span><span class="op" id="6711179">(</span><span class="string" id="6711180">&#34;3082020030820162020900b8bf2d47a0d2ebf4300906072a8648ce3d04013045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c7464301e170d3132313132323135303633325a170d3232313132303135303633325a3045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c746430819b301006072a8648ce3d020106052b81040023038186000400c4a1edbe98f90b4873367ec316561122f23d53c33b4d213dcd6b75e6f6b0dc9adf26c1bcb287f072327cb3642f1c90bcea6823107efee325c0483a69e0286dd33700ef0462dd0da09c706283d881d36431aa9e9731bd96b068c09b23de76643f1a5c7fe9120e5858b65f70dd9bd8ead5d7f5d5ccb9b69f30665b669a20e227e5bffe3b300906072a8648ce3d040103818c0030818802420188a24febe245c5487d1bacf5ed989dae4770c05e1bb62fbdf1b64db76140d311a2ceee0b7e927eff769dc33b7ea53fcefa10e259ec472d7cacda4e970e15a06fd00242014dfcbe67139c2d050ebd3fa38c25c13313830d9406bbd4377af6ec7ac9862eddd711697f857c56defb31782be4c7780daecbbe9e4e3624317b6a0f399512078f2a&#34;</span><span class="op" id="6712214">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6712217">var</span>&nbsp;<span class="ident" id="6712221">testSNICertificate</span>&nbsp;<span class="op" id="6712240">=</span>&nbsp;<span class="ident" id="6712242">fromHex</span><span class="op" id="6712249">(</span><span class="string" id="6712250">&#34;308201f23082015da003020102020100300b06092a864886f70d01010530283110300e060355040a130741636d6520436f311430120603550403130b736e69746573742e636f6d301e170d3132303431313137343033355a170d3133303431313137343533355a30283110300e060355040a130741636d6520436f311430120603550403130b736e69746573742e636f6d30819d300b06092a864886f70d01010103818d0030818902818100bb79d6f517b5e5bf4610d0dc69bee62b07435ad0032d8a7a4385b71452e7a5654c2c78b8238cb5b482e5de1f953b7e62a52ca533d6fe125c7a56fcf506bffa587b263fb5cd04d3d0c921964ac7f4549f5abfef427100fe1899077f7e887d7df10439c4a22edb51c97ce3c04c3b326601cfafb11db8719a1ddbdb896baeda2d790203010001a3323030300e0603551d0f0101ff0404030200a0300d0603551d0e0406040401020304300f0603551d2304083006800401020304300b06092a864886f70d0101050381810089c6455f1c1f5ef8eb1ab174ee2439059f5c4259bb1a8d86cdb1d056f56a717da40e95ab90f59e8deaf627c157995094db0802266eb34fc6842dea8a4b68d9c1389103ab84fb9e1f85d9b5d23ff2312c8670fbb540148245a4ebafe264d90c8a4cf4f85b0fac12ac2fc4a3154bad52462868af96c62c6525d652b6e31845bdcc&#34;</span><span class="op" id="6713256">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6713259">var</span>&nbsp;<span class="ident" id="6713263">testRSAPrivateKey</span>&nbsp;<span class="op" id="6713281">=</span>&nbsp;<span class="op" id="6713283">&amp;</span><span class="ident" id="6713284">rsa</span><span class="op" id="6713287">.</span><span class="ident" id="6713288">PrivateKey</span><span class="op" id="6713298">{</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6713301">PublicKey</span><span class="op" id="6713310">:</span>&nbsp;<span class="ident" id="6713312">rsa</span><span class="op" id="6713315">.</span><span class="ident" id="6713316">PublicKey</span><span class="op" id="6713325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6713329">N</span><span class="op" id="6713330">:</span>&nbsp;<span class="ident" id="6713332">bigFromString</span><span class="op" id="6713345">(</span><span class="string" id="6713346">&#34;131650079503776001033793877885499001334664249354723305978524647182322416328664556247316495448366990052837680518067798333412266673813370895702118944398081598789828837447552603077848001020611640547221687072142537202428102790818451901395596882588063427854225330436740647715202971973145151161964464812406232198521&#34;</span><span class="op" id="6713657">)</span><span class="op" id="6713658">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6713662">E</span><span class="op" id="6713663">:</span>&nbsp;<span class="num" id="6713665">65537</span><span class="op" id="6713670">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6713673">}</span><span class="op" id="6713674">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6713677">D</span><span class="op" id="6713678">:</span>&nbsp;<span class="ident" id="6713680">bigFromString</span><span class="op" id="6713693">(</span><span class="string" id="6713694">&#34;29354450337804273969007277378287027274721892607543397931919078829901848876371746653677097639302788129485893852488285045793268732234230875671682624082413996177431586734171663258657462237320300610850244186316880055243099640544518318093544057213190320837094958164973959123058337475052510833916491060913053867729&#34;</span><span class="op" id="6714004">)</span><span class="op" id="6714005">,</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6714008">Primes</span><span class="op" id="6714014">:</span>&nbsp;<span class="op" id="6714016">[</span><span class="op" id="6714017">]</span><span class="op" id="6714018">*</span><span class="ident" id="6714019">big</span><span class="op" id="6714022">.</span><span class="ident" id="6714023">Int</span><span class="op" id="6714026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6714030">bigFromString</span><span class="op" id="6714043">(</span><span class="string" id="6714044">&#34;11969277782311800166562047708379380720136961987713178380670422671426759650127150688426177829077494755200794297055316163155755835813760102405344560929062149&#34;</span><span class="op" id="6714201">)</span><span class="op" id="6714202">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6714206">bigFromString</span><span class="op" id="6714219">(</span><span class="string" id="6714220">&#34;10998999429884441391899182616418192492905073053684657075974935218461686523870125521822756579792315215543092255516093840728890783887287417039645833477273829&#34;</span><span class="op" id="6714377">)</span><span class="op" id="6714378">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6714381">}</span><span class="op" id="6714382">,</span><br>
<span class="lineno"></span><span class="op" id="6714384">}</span><br>
<span class="lineno">860</span><br>
<span class="lineno"></span><span class="keyword" id="6714387">var</span>&nbsp;<span class="ident" id="6714391">testECDSAPrivateKey</span>&nbsp;<span class="op" id="6714411">=</span>&nbsp;<span class="op" id="6714413">&amp;</span><span class="ident" id="6714414">ecdsa</span><span class="op" id="6714419">.</span><span class="ident" id="6714420">PrivateKey</span><span class="op" id="6714430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6714433">PublicKey</span><span class="op" id="6714442">:</span>&nbsp;<span class="ident" id="6714444">ecdsa</span><span class="op" id="6714449">.</span><span class="ident" id="6714450">PublicKey</span><span class="op" id="6714459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6714463">Curve</span><span class="op" id="6714468">:</span>&nbsp;<span class="ident" id="6714470">elliptic</span><span class="op" id="6714478">.</span><span class="ident" id="6714479">P521</span><span class="op" id="6714483">(</span><span class="op" id="6714484">)</span><span class="op" id="6714485">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6714489">X</span><span class="op" id="6714490">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6714496">bigFromString</span><span class="op" id="6714509">(</span><span class="string" id="6714510">&#34;2636411247892461147287360222306590634450676461695221912739908880441342231985950069527906976759812296359387337367668045707086543273113073382714101597903639351&#34;</span><span class="op" id="6714669">)</span><span class="op" id="6714670">,</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6714674">Y</span><span class="op" id="6714675">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6714681">bigFromString</span><span class="op" id="6714694">(</span><span class="string" id="6714695">&#34;3204695818431246682253994090650952614555094516658732116404513121125038617915183037601737180082382202488628239201196033284060130040574800684774115478859677243&#34;</span><span class="op" id="6714854">)</span><span class="op" id="6714855">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6714858">}</span><span class="op" id="6714859">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6714862">D</span><span class="op" id="6714863">:</span>&nbsp;<span class="ident" id="6714865">bigFromString</span><span class="op" id="6714878">(</span><span class="string" id="6714879">&#34;5477294338614160138026852784385529180817726002953041720191098180813046231640184669647735805135001309477695746518160084669446643325196003346204701381388769751&#34;</span><span class="op" id="6715038">)</span><span class="op" id="6715039">,</span><br>
<span class="lineno"></span><span class="op" id="6715041">}</span>
</div>
</body>
</html>
