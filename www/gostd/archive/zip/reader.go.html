<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/zip</h2>
<ul>
<li><a href="/gostd/archive/zip/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/zip/reader.go.html" class="current">reader.go</a></li>
<li><a href="/gostd/archive/zip/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/zip/register.go.html">register.go</a></li>
<li><a href="/gostd/archive/zip/struct.go.html">struct.go</a></li>
<li><a href="/gostd/archive/zip/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/zip/writer_test.go.html">writer_test.go</a></li>
<li><a href="/gostd/archive/zip/zip_test.go.html">zip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6284677">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6284732">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6284786">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6284837">package</span>&nbsp;<span class="ident" id="6284845">zip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6284850">import</span>&nbsp;<span class="op" id="6284857">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6284860">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6284869">&#34;encoding/binary&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6284888">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6284898">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6284906">&#34;hash/crc32&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6284920">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6284926">&#34;os&#34;</span><br>
<span class="lineno">15</span><span class="op" id="6284931">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6284934">var</span>&nbsp;<span class="op" id="6284938">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6284941">ErrFormat</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6284954">=</span>&nbsp;<span class="ident" id="6284956">errors</span><span class="op" id="6284962">.</span><span class="ident" id="6284963">New</span><span class="op" id="6284966">(</span><span class="string" id="6284967">&#34;zip:&nbsp;not&nbsp;a&nbsp;valid&nbsp;zip&nbsp;file&#34;</span><span class="op" id="6284994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6284997">ErrAlgorithm</span>&nbsp;<span class="op" id="6285010">=</span>&nbsp;<span class="ident" id="6285012">errors</span><span class="op" id="6285018">.</span><span class="ident" id="6285019">New</span><span class="op" id="6285022">(</span><span class="string" id="6285023">&#34;zip:&nbsp;unsupported&nbsp;compression&nbsp;algorithm&#34;</span><span class="op" id="6285063">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6285066">ErrChecksum</span>&nbsp;&nbsp;<span class="op" id="6285079">=</span>&nbsp;<span class="ident" id="6285081">errors</span><span class="op" id="6285087">.</span><span class="ident" id="6285088">New</span><span class="op" id="6285091">(</span><span class="string" id="6285092">&#34;zip:&nbsp;checksum&nbsp;error&#34;</span><span class="op" id="6285113">)</span><br>
<span class="lineno"></span><span class="op" id="6285115">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6285118">type</span>&nbsp;<span class="ident" id="6285123">Reader</span>&nbsp;<span class="keyword" id="6285130">struct</span>&nbsp;<span class="op" id="6285137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6285140">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6285148">io</span><span class="op" id="6285150">.</span><span class="ident" id="6285151">ReaderAt</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6285161">File</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6285169">[</span><span class="op" id="6285170">]</span><span class="op" id="6285171">*</span><span class="ident" id="6285172">File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6285178">Comment</span>&nbsp;<span class="builtintype" id="6285186">string</span><br>
<span class="lineno"></span><span class="op" id="6285193">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6285196">type</span>&nbsp;<span class="ident" id="6285201">ReadCloser</span>&nbsp;<span class="keyword" id="6285212">struct</span>&nbsp;<span class="op" id="6285219">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6285222">f</span>&nbsp;<span class="op" id="6285224">*</span><span class="ident" id="6285225">os</span><span class="op" id="6285227">.</span><span class="ident" id="6285228">File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6285234">Reader</span><br>
<span class="lineno"></span><span class="op" id="6285241">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6285244">type</span>&nbsp;<span class="ident" id="6285249">File</span>&nbsp;<span class="keyword" id="6285254">struct</span>&nbsp;<span class="op" id="6285261">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6285264">FileHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6285276">zipr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6285289">io</span><span class="op" id="6285291">.</span><span class="ident" id="6285292">ReaderAt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6285302">zipsize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6285315">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6285322">headerOffset</span>&nbsp;<span class="ident" id="6285335">int64</span><br>
<span class="lineno"></span><span class="op" id="6285341">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="6285344">func</span>&nbsp;<span class="op" id="6285349">(</span><span class="ident" id="6285350">f</span>&nbsp;<span class="op" id="6285352">*</span><span class="ident" id="6285353">File</span><span class="op" id="6285357">)</span>&nbsp;<span class="ident" id="6285359">hasDataDescriptor</span><span class="op" id="6285376">(</span><span class="op" id="6285377">)</span>&nbsp;<span class="builtintype" id="6285379">bool</span>&nbsp;<span class="op" id="6285384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6285387">return</span>&nbsp;<span class="ident" id="6285394">f</span><span class="op" id="6285395">.</span><span class="ident" id="6285396">Flags</span><span class="op" id="6285401">&amp;</span><span class="num" id="6285402">0x8</span>&nbsp;<span class="op" id="6285406">!=</span>&nbsp;<span class="num" id="6285409">0</span><br>
<span class="lineno"></span><span class="op" id="6285411">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="6285414">//&nbsp;OpenReader&nbsp;will&nbsp;open&nbsp;the&nbsp;Zip&nbsp;file&nbsp;specified&nbsp;by&nbsp;name&nbsp;and&nbsp;return&nbsp;a&nbsp;ReadCloser.</span><br>
<span class="lineno"></span><span class="keyword" id="6285494">func</span>&nbsp;<span class="ident" id="6285499">OpenReader</span><span class="op" id="6285509">(</span><span class="ident" id="6285510">name</span>&nbsp;<span class="builtintype" id="6285515">string</span><span class="op" id="6285521">)</span>&nbsp;<span class="op" id="6285523">(</span><span class="op" id="6285524">*</span><span class="ident" id="6285525">ReadCloser</span><span class="op" id="6285535">,</span>&nbsp;<span class="builtintype" id="6285537">error</span><span class="op" id="6285542">)</span>&nbsp;<span class="op" id="6285544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6285547">f</span><span class="op" id="6285548">,</span>&nbsp;<span class="ident" id="6285550">err</span>&nbsp;<span class="op" id="6285554">:=</span>&nbsp;<span class="ident" id="6285557">os</span><span class="op" id="6285559">.</span><span class="ident" id="6285560">Open</span><span class="op" id="6285564">(</span><span class="ident" id="6285565">name</span><span class="op" id="6285569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6285572">if</span>&nbsp;<span class="ident" id="6285575">err</span>&nbsp;<span class="op" id="6285579">!=</span>&nbsp;<span class="ident" id="6285582">nil</span>&nbsp;<span class="op" id="6285586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6285590">return</span>&nbsp;<span class="ident" id="6285597">nil</span><span class="op" id="6285600">,</span>&nbsp;<span class="ident" id="6285602">err</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6285607">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6285610">fi</span><span class="op" id="6285612">,</span>&nbsp;<span class="ident" id="6285614">err</span>&nbsp;<span class="op" id="6285618">:=</span>&nbsp;<span class="ident" id="6285621">f</span><span class="op" id="6285622">.</span><span class="ident" id="6285623">Stat</span><span class="op" id="6285627">(</span><span class="op" id="6285628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6285631">if</span>&nbsp;<span class="ident" id="6285634">err</span>&nbsp;<span class="op" id="6285638">!=</span>&nbsp;<span class="ident" id="6285641">nil</span>&nbsp;<span class="op" id="6285645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6285649">f</span><span class="op" id="6285650">.</span><span class="ident" id="6285651">Close</span><span class="op" id="6285656">(</span><span class="op" id="6285657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6285661">return</span>&nbsp;<span class="ident" id="6285668">nil</span><span class="op" id="6285671">,</span>&nbsp;<span class="ident" id="6285673">err</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6285678">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6285681">r</span>&nbsp;<span class="op" id="6285683">:=</span>&nbsp;<span class="builtinfunc" id="6285686">new</span><span class="op" id="6285689">(</span><span class="ident" id="6285690">ReadCloser</span><span class="op" id="6285700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6285703">if</span>&nbsp;<span class="ident" id="6285706">err</span>&nbsp;<span class="op" id="6285710">:=</span>&nbsp;<span class="ident" id="6285713">r</span><span class="op" id="6285714">.</span><span class="ident" id="6285715">init</span><span class="op" id="6285719">(</span><span class="ident" id="6285720">f</span><span class="op" id="6285721">,</span>&nbsp;<span class="ident" id="6285723">fi</span><span class="op" id="6285725">.</span><span class="ident" id="6285726">Size</span><span class="op" id="6285730">(</span><span class="op" id="6285731">)</span><span class="op" id="6285732">)</span><span class="op" id="6285733">;</span>&nbsp;<span class="ident" id="6285735">err</span>&nbsp;<span class="op" id="6285739">!=</span>&nbsp;<span class="ident" id="6285742">nil</span>&nbsp;<span class="op" id="6285746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6285750">f</span><span class="op" id="6285751">.</span><span class="ident" id="6285752">Close</span><span class="op" id="6285757">(</span><span class="op" id="6285758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6285762">return</span>&nbsp;<span class="ident" id="6285769">nil</span><span class="op" id="6285772">,</span>&nbsp;<span class="ident" id="6285774">err</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6285779">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6285782">r</span><span class="op" id="6285783">.</span><span class="ident" id="6285784">f</span>&nbsp;<span class="op" id="6285786">=</span>&nbsp;<span class="ident" id="6285788">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6285791">return</span>&nbsp;<span class="ident" id="6285798">r</span><span class="op" id="6285799">,</span>&nbsp;<span class="ident" id="6285801">nil</span><br>
<span class="lineno"></span><span class="op" id="6285805">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="6285808">//&nbsp;NewReader&nbsp;returns&nbsp;a&nbsp;new&nbsp;Reader&nbsp;reading&nbsp;from&nbsp;r,&nbsp;which&nbsp;is&nbsp;assumed&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="6285878">//&nbsp;have&nbsp;the&nbsp;given&nbsp;size&nbsp;in&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="6285911">func</span>&nbsp;<span class="ident" id="6285916">NewReader</span><span class="op" id="6285925">(</span><span class="ident" id="6285926">r</span>&nbsp;<span class="ident" id="6285928">io</span><span class="op" id="6285930">.</span><span class="ident" id="6285931">ReaderAt</span><span class="op" id="6285939">,</span>&nbsp;<span class="ident" id="6285941">size</span>&nbsp;<span class="ident" id="6285946">int64</span><span class="op" id="6285951">)</span>&nbsp;<span class="op" id="6285953">(</span><span class="op" id="6285954">*</span><span class="ident" id="6285955">Reader</span><span class="op" id="6285961">,</span>&nbsp;<span class="builtintype" id="6285963">error</span><span class="op" id="6285968">)</span>&nbsp;<span class="op" id="6285970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6285973">zr</span>&nbsp;<span class="op" id="6285976">:=</span>&nbsp;<span class="builtinfunc" id="6285979">new</span><span class="op" id="6285982">(</span><span class="ident" id="6285983">Reader</span><span class="op" id="6285989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6285992">if</span>&nbsp;<span class="ident" id="6285995">err</span>&nbsp;<span class="op" id="6285999">:=</span>&nbsp;<span class="ident" id="6286002">zr</span><span class="op" id="6286004">.</span><span class="ident" id="6286005">init</span><span class="op" id="6286009">(</span><span class="ident" id="6286010">r</span><span class="op" id="6286011">,</span>&nbsp;<span class="ident" id="6286013">size</span><span class="op" id="6286017">)</span><span class="op" id="6286018">;</span>&nbsp;<span class="ident" id="6286020">err</span>&nbsp;<span class="op" id="6286024">!=</span>&nbsp;<span class="ident" id="6286027">nil</span>&nbsp;<span class="op" id="6286031">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6286035">return</span>&nbsp;<span class="ident" id="6286042">nil</span><span class="op" id="6286045">,</span>&nbsp;<span class="ident" id="6286047">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6286052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6286055">return</span>&nbsp;<span class="ident" id="6286062">zr</span><span class="op" id="6286064">,</span>&nbsp;<span class="ident" id="6286066">nil</span><br>
<span class="lineno"></span><span class="op" id="6286070">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="6286073">func</span>&nbsp;<span class="op" id="6286078">(</span><span class="ident" id="6286079">z</span>&nbsp;<span class="op" id="6286081">*</span><span class="ident" id="6286082">Reader</span><span class="op" id="6286088">)</span>&nbsp;<span class="ident" id="6286090">init</span><span class="op" id="6286094">(</span><span class="ident" id="6286095">r</span>&nbsp;<span class="ident" id="6286097">io</span><span class="op" id="6286099">.</span><span class="ident" id="6286100">ReaderAt</span><span class="op" id="6286108">,</span>&nbsp;<span class="ident" id="6286110">size</span>&nbsp;<span class="ident" id="6286115">int64</span><span class="op" id="6286120">)</span>&nbsp;<span class="builtintype" id="6286122">error</span>&nbsp;<span class="op" id="6286128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6286131">end</span><span class="op" id="6286134">,</span>&nbsp;<span class="ident" id="6286136">err</span>&nbsp;<span class="op" id="6286140">:=</span>&nbsp;<span class="ident" id="6286143">readDirectoryEnd</span><span class="op" id="6286159">(</span><span class="ident" id="6286160">r</span><span class="op" id="6286161">,</span>&nbsp;<span class="ident" id="6286163">size</span><span class="op" id="6286167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6286170">if</span>&nbsp;<span class="ident" id="6286173">err</span>&nbsp;<span class="op" id="6286177">!=</span>&nbsp;<span class="ident" id="6286180">nil</span>&nbsp;<span class="op" id="6286184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6286188">return</span>&nbsp;<span class="ident" id="6286195">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6286200">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6286203">z</span><span class="op" id="6286204">.</span><span class="ident" id="6286205">r</span>&nbsp;<span class="op" id="6286207">=</span>&nbsp;<span class="ident" id="6286209">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6286212">z</span><span class="op" id="6286213">.</span><span class="ident" id="6286214">File</span>&nbsp;<span class="op" id="6286219">=</span>&nbsp;<span class="builtinfunc" id="6286221">make</span><span class="op" id="6286225">(</span><span class="op" id="6286226">[</span><span class="op" id="6286227">]</span><span class="op" id="6286228">*</span><span class="ident" id="6286229">File</span><span class="op" id="6286233">,</span>&nbsp;<span class="num" id="6286235">0</span><span class="op" id="6286236">,</span>&nbsp;<span class="ident" id="6286238">end</span><span class="op" id="6286241">.</span><span class="ident" id="6286242">directoryRecords</span><span class="op" id="6286258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6286261">z</span><span class="op" id="6286262">.</span><span class="ident" id="6286263">Comment</span>&nbsp;<span class="op" id="6286271">=</span>&nbsp;<span class="ident" id="6286273">end</span><span class="op" id="6286276">.</span><span class="ident" id="6286277">comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6286286">rs</span>&nbsp;<span class="op" id="6286289">:=</span>&nbsp;<span class="ident" id="6286292">io</span><span class="op" id="6286294">.</span><span class="ident" id="6286295">NewSectionReader</span><span class="op" id="6286311">(</span><span class="ident" id="6286312">r</span><span class="op" id="6286313">,</span>&nbsp;<span class="num" id="6286315">0</span><span class="op" id="6286316">,</span>&nbsp;<span class="ident" id="6286318">size</span><span class="op" id="6286322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6286325">if</span>&nbsp;<span class="ident" id="6286328">_</span><span class="op" id="6286329">,</span>&nbsp;<span class="ident" id="6286331">err</span>&nbsp;<span class="op" id="6286335">=</span>&nbsp;<span class="ident" id="6286337">rs</span><span class="op" id="6286339">.</span><span class="ident" id="6286340">Seek</span><span class="op" id="6286344">(</span><span class="ident" id="6286345">int64</span><span class="op" id="6286350">(</span><span class="ident" id="6286351">end</span><span class="op" id="6286354">.</span><span class="ident" id="6286355">directoryOffset</span><span class="op" id="6286370">)</span><span class="op" id="6286371">,</span>&nbsp;<span class="ident" id="6286373">os</span><span class="op" id="6286375">.</span><span class="ident" id="6286376">SEEK_SET</span><span class="op" id="6286384">)</span><span class="op" id="6286385">;</span>&nbsp;<span class="ident" id="6286387">err</span>&nbsp;<span class="op" id="6286391">!=</span>&nbsp;<span class="ident" id="6286394">nil</span>&nbsp;<span class="op" id="6286398">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6286402">return</span>&nbsp;<span class="ident" id="6286409">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6286414">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6286417">buf</span>&nbsp;<span class="op" id="6286421">:=</span>&nbsp;<span class="ident" id="6286424">bufio</span><span class="op" id="6286429">.</span><span class="ident" id="6286430">NewReader</span><span class="op" id="6286439">(</span><span class="ident" id="6286440">rs</span><span class="op" id="6286442">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6286446">//&nbsp;The&nbsp;count&nbsp;of&nbsp;files&nbsp;inside&nbsp;a&nbsp;zip&nbsp;is&nbsp;truncated&nbsp;to&nbsp;fit&nbsp;in&nbsp;a&nbsp;uint16.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6286515">//&nbsp;Gloss&nbsp;over&nbsp;this&nbsp;by&nbsp;reading&nbsp;headers&nbsp;until&nbsp;we&nbsp;encounter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6286573">//&nbsp;a&nbsp;bad&nbsp;one,&nbsp;and&nbsp;then&nbsp;only&nbsp;report&nbsp;a&nbsp;ErrFormat&nbsp;or&nbsp;UnexpectedEOF&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6286641">//&nbsp;the&nbsp;file&nbsp;count&nbsp;modulo&nbsp;65536&nbsp;is&nbsp;incorrect.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6286687">for</span>&nbsp;<span class="op" id="6286691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6286695">f</span>&nbsp;<span class="op" id="6286697">:=</span>&nbsp;<span class="op" id="6286700">&amp;</span><span class="ident" id="6286701">File</span><span class="op" id="6286705">{</span><span class="ident" id="6286706">zipr</span><span class="op" id="6286710">:</span>&nbsp;<span class="ident" id="6286712">r</span><span class="op" id="6286713">,</span>&nbsp;<span class="ident" id="6286715">zipsize</span><span class="op" id="6286722">:</span>&nbsp;<span class="ident" id="6286724">size</span><span class="op" id="6286728">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6286732">err</span>&nbsp;<span class="op" id="6286736">=</span>&nbsp;<span class="ident" id="6286738">readDirectoryHeader</span><span class="op" id="6286757">(</span><span class="ident" id="6286758">f</span><span class="op" id="6286759">,</span>&nbsp;<span class="ident" id="6286761">buf</span><span class="op" id="6286764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6286768">if</span>&nbsp;<span class="ident" id="6286771">err</span>&nbsp;<span class="op" id="6286775">==</span>&nbsp;<span class="ident" id="6286778">ErrFormat</span>&nbsp;<span class="op" id="6286788">||</span>&nbsp;<span class="ident" id="6286791">err</span>&nbsp;<span class="op" id="6286795">==</span>&nbsp;<span class="ident" id="6286798">io</span><span class="op" id="6286800">.</span><span class="ident" id="6286801">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="6286818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6286823">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6286831">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6286835">if</span>&nbsp;<span class="ident" id="6286838">err</span>&nbsp;<span class="op" id="6286842">!=</span>&nbsp;<span class="ident" id="6286845">nil</span>&nbsp;<span class="op" id="6286849">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6286854">return</span>&nbsp;<span class="ident" id="6286861">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6286867">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6286871">z</span><span class="op" id="6286872">.</span><span class="ident" id="6286873">File</span>&nbsp;<span class="op" id="6286878">=</span>&nbsp;<span class="builtinfunc" id="6286880">append</span><span class="op" id="6286886">(</span><span class="ident" id="6286887">z</span><span class="op" id="6286888">.</span><span class="ident" id="6286889">File</span><span class="op" id="6286893">,</span>&nbsp;<span class="ident" id="6286895">f</span><span class="op" id="6286896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6286899">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6286902">if</span>&nbsp;<span class="builtintype" id="6286905">uint16</span><span class="op" id="6286911">(</span><span class="builtinfunc" id="6286912">len</span><span class="op" id="6286915">(</span><span class="ident" id="6286916">z</span><span class="op" id="6286917">.</span><span class="ident" id="6286918">File</span><span class="op" id="6286922">)</span><span class="op" id="6286923">)</span>&nbsp;<span class="op" id="6286925">!=</span>&nbsp;<span class="builtintype" id="6286928">uint16</span><span class="op" id="6286934">(</span><span class="ident" id="6286935">end</span><span class="op" id="6286938">.</span><span class="ident" id="6286939">directoryRecords</span><span class="op" id="6286955">)</span>&nbsp;<span class="op" id="6286957">{</span>&nbsp;<span class="comment" id="6286959">//&nbsp;only&nbsp;compare&nbsp;16&nbsp;bits&nbsp;here</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6286990">//&nbsp;Return&nbsp;the&nbsp;readDirectoryHeader&nbsp;error&nbsp;if&nbsp;we&nbsp;read</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6287043">//&nbsp;the&nbsp;wrong&nbsp;number&nbsp;of&nbsp;directory&nbsp;entries.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6287087">return</span>&nbsp;<span class="ident" id="6287094">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6287099">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6287102">return</span>&nbsp;<span class="ident" id="6287109">nil</span><br>
<span class="lineno">110</span><span class="op" id="6287113">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6287116">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;Zip&nbsp;file,&nbsp;rendering&nbsp;it&nbsp;unusable&nbsp;for&nbsp;I/O.</span><br>
<span class="lineno"></span><span class="keyword" id="6287177">func</span>&nbsp;<span class="op" id="6287182">(</span><span class="ident" id="6287183">rc</span>&nbsp;<span class="op" id="6287186">*</span><span class="ident" id="6287187">ReadCloser</span><span class="op" id="6287197">)</span>&nbsp;<span class="ident" id="6287199">Close</span><span class="op" id="6287204">(</span><span class="op" id="6287205">)</span>&nbsp;<span class="builtintype" id="6287207">error</span>&nbsp;<span class="op" id="6287213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6287216">return</span>&nbsp;<span class="ident" id="6287223">rc</span><span class="op" id="6287225">.</span><span class="ident" id="6287226">f</span><span class="op" id="6287227">.</span><span class="ident" id="6287228">Close</span><span class="op" id="6287233">(</span><span class="op" id="6287234">)</span><br>
<span class="lineno">115</span><span class="op" id="6287236">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6287239">//&nbsp;DataOffset&nbsp;returns&nbsp;the&nbsp;offset&nbsp;of&nbsp;the&nbsp;file&#39;s&nbsp;possibly-compressed</span><br>
<span class="lineno"></span><span class="comment" id="6287306">//&nbsp;data,&nbsp;relative&nbsp;to&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;zip&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="6287358">//</span><br>
<span class="lineno">120</span><span class="comment" id="6287361">//&nbsp;Most&nbsp;callers&nbsp;should&nbsp;instead&nbsp;use&nbsp;Open,&nbsp;which&nbsp;transparently</span><br>
<span class="lineno"></span><span class="comment" id="6287422">//&nbsp;decompresses&nbsp;data&nbsp;and&nbsp;verifies&nbsp;checksums.</span><br>
<span class="lineno"></span><span class="keyword" id="6287467">func</span>&nbsp;<span class="op" id="6287472">(</span><span class="ident" id="6287473">f</span>&nbsp;<span class="op" id="6287475">*</span><span class="ident" id="6287476">File</span><span class="op" id="6287480">)</span>&nbsp;<span class="ident" id="6287482">DataOffset</span><span class="op" id="6287492">(</span><span class="op" id="6287493">)</span>&nbsp;<span class="op" id="6287495">(</span><span class="ident" id="6287496">offset</span>&nbsp;<span class="ident" id="6287503">int64</span><span class="op" id="6287508">,</span>&nbsp;<span class="ident" id="6287510">err</span>&nbsp;<span class="builtintype" id="6287514">error</span><span class="op" id="6287519">)</span>&nbsp;<span class="op" id="6287521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6287524">bodyOffset</span><span class="op" id="6287534">,</span>&nbsp;<span class="ident" id="6287536">err</span>&nbsp;<span class="op" id="6287540">:=</span>&nbsp;<span class="ident" id="6287543">f</span><span class="op" id="6287544">.</span><span class="ident" id="6287545">findBodyOffset</span><span class="op" id="6287559">(</span><span class="op" id="6287560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6287563">if</span>&nbsp;<span class="ident" id="6287566">err</span>&nbsp;<span class="op" id="6287570">!=</span>&nbsp;<span class="ident" id="6287573">nil</span>&nbsp;<span class="op" id="6287577">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6287581">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6287589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6287592">return</span>&nbsp;<span class="ident" id="6287599">f</span><span class="op" id="6287600">.</span><span class="ident" id="6287601">headerOffset</span>&nbsp;<span class="op" id="6287614">+</span>&nbsp;<span class="ident" id="6287616">bodyOffset</span><span class="op" id="6287626">,</span>&nbsp;<span class="ident" id="6287628">nil</span><br>
<span class="lineno"></span><span class="op" id="6287632">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="6287635">//&nbsp;Open&nbsp;returns&nbsp;a&nbsp;ReadCloser&nbsp;that&nbsp;provides&nbsp;access&nbsp;to&nbsp;the&nbsp;File&#39;s&nbsp;contents.</span><br>
<span class="lineno"></span><span class="comment" id="6287709">//&nbsp;Multiple&nbsp;files&nbsp;may&nbsp;be&nbsp;read&nbsp;concurrently.</span><br>
<span class="lineno"></span><span class="keyword" id="6287753">func</span>&nbsp;<span class="op" id="6287758">(</span><span class="ident" id="6287759">f</span>&nbsp;<span class="op" id="6287761">*</span><span class="ident" id="6287762">File</span><span class="op" id="6287766">)</span>&nbsp;<span class="ident" id="6287768">Open</span><span class="op" id="6287772">(</span><span class="op" id="6287773">)</span>&nbsp;<span class="op" id="6287775">(</span><span class="ident" id="6287776">rc</span>&nbsp;<span class="ident" id="6287779">io</span><span class="op" id="6287781">.</span><span class="ident" id="6287782">ReadCloser</span><span class="op" id="6287792">,</span>&nbsp;<span class="ident" id="6287794">err</span>&nbsp;<span class="builtintype" id="6287798">error</span><span class="op" id="6287803">)</span>&nbsp;<span class="op" id="6287805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6287808">bodyOffset</span><span class="op" id="6287818">,</span>&nbsp;<span class="ident" id="6287820">err</span>&nbsp;<span class="op" id="6287824">:=</span>&nbsp;<span class="ident" id="6287827">f</span><span class="op" id="6287828">.</span><span class="ident" id="6287829">findBodyOffset</span><span class="op" id="6287843">(</span><span class="op" id="6287844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6287847">if</span>&nbsp;<span class="ident" id="6287850">err</span>&nbsp;<span class="op" id="6287854">!=</span>&nbsp;<span class="ident" id="6287857">nil</span>&nbsp;<span class="op" id="6287861">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6287865">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6287873">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6287876">size</span>&nbsp;<span class="op" id="6287881">:=</span>&nbsp;<span class="ident" id="6287884">int64</span><span class="op" id="6287889">(</span><span class="ident" id="6287890">f</span><span class="op" id="6287891">.</span><span class="ident" id="6287892">CompressedSize64</span><span class="op" id="6287908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6287911">r</span>&nbsp;<span class="op" id="6287913">:=</span>&nbsp;<span class="ident" id="6287916">io</span><span class="op" id="6287918">.</span><span class="ident" id="6287919">NewSectionReader</span><span class="op" id="6287935">(</span><span class="ident" id="6287936">f</span><span class="op" id="6287937">.</span><span class="ident" id="6287938">zipr</span><span class="op" id="6287942">,</span>&nbsp;<span class="ident" id="6287944">f</span><span class="op" id="6287945">.</span><span class="ident" id="6287946">headerOffset</span><span class="op" id="6287958">+</span><span class="ident" id="6287959">bodyOffset</span><span class="op" id="6287969">,</span>&nbsp;<span class="ident" id="6287971">size</span><span class="op" id="6287975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6287978">dcomp</span>&nbsp;<span class="op" id="6287984">:=</span>&nbsp;<span class="ident" id="6287987">decompressor</span><span class="op" id="6287999">(</span><span class="ident" id="6288000">f</span><span class="op" id="6288001">.</span><span class="ident" id="6288002">Method</span><span class="op" id="6288008">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6288011">if</span>&nbsp;<span class="ident" id="6288014">dcomp</span>&nbsp;<span class="op" id="6288020">==</span>&nbsp;<span class="ident" id="6288023">nil</span>&nbsp;<span class="op" id="6288027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6288031">err</span>&nbsp;<span class="op" id="6288035">=</span>&nbsp;<span class="ident" id="6288037">ErrAlgorithm</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6288052">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6288060">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6288063">rc</span>&nbsp;<span class="op" id="6288066">=</span>&nbsp;<span class="ident" id="6288068">dcomp</span><span class="op" id="6288073">(</span><span class="ident" id="6288074">r</span><span class="op" id="6288075">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6288078">var</span>&nbsp;<span class="ident" id="6288082">desr</span>&nbsp;<span class="ident" id="6288087">io</span><span class="op" id="6288089">.</span><span class="ident" id="6288090">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6288098">if</span>&nbsp;<span class="ident" id="6288101">f</span><span class="op" id="6288102">.</span><span class="ident" id="6288103">hasDataDescriptor</span><span class="op" id="6288120">(</span><span class="op" id="6288121">)</span>&nbsp;<span class="op" id="6288123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6288127">desr</span>&nbsp;<span class="op" id="6288132">=</span>&nbsp;<span class="ident" id="6288134">io</span><span class="op" id="6288136">.</span><span class="ident" id="6288137">NewSectionReader</span><span class="op" id="6288153">(</span><span class="ident" id="6288154">f</span><span class="op" id="6288155">.</span><span class="ident" id="6288156">zipr</span><span class="op" id="6288160">,</span>&nbsp;<span class="ident" id="6288162">f</span><span class="op" id="6288163">.</span><span class="ident" id="6288164">headerOffset</span><span class="op" id="6288176">+</span><span class="ident" id="6288177">bodyOffset</span><span class="op" id="6288187">+</span><span class="ident" id="6288188">size</span><span class="op" id="6288192">,</span>&nbsp;<span class="ident" id="6288194">dataDescriptorLen</span><span class="op" id="6288211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6288214">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6288217">rc</span>&nbsp;<span class="op" id="6288220">=</span>&nbsp;<span class="op" id="6288222">&amp;</span><span class="ident" id="6288223">checksumReader</span><span class="op" id="6288237">{</span><span class="ident" id="6288238">rc</span><span class="op" id="6288240">,</span>&nbsp;<span class="ident" id="6288242">crc32</span><span class="op" id="6288247">.</span><span class="ident" id="6288248">NewIEEE</span><span class="op" id="6288255">(</span><span class="op" id="6288256">)</span><span class="op" id="6288257">,</span>&nbsp;<span class="ident" id="6288259">f</span><span class="op" id="6288260">,</span>&nbsp;<span class="ident" id="6288262">desr</span><span class="op" id="6288266">,</span>&nbsp;<span class="ident" id="6288268">nil</span><span class="op" id="6288271">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6288274">return</span><br>
<span class="lineno"></span><span class="op" id="6288281">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6288284">type</span>&nbsp;<span class="ident" id="6288289">checksumReader</span>&nbsp;<span class="keyword" id="6288304">struct</span>&nbsp;<span class="op" id="6288311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6288314">rc</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6288319">io</span><span class="op" id="6288321">.</span><span class="ident" id="6288322">ReadCloser</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6288334">hash</span>&nbsp;<span class="ident" id="6288339">hash</span><span class="op" id="6288343">.</span><span class="ident" id="6288344">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6288352">f</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6288357">*</span><span class="ident" id="6288358">File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6288364">desr</span>&nbsp;<span class="ident" id="6288369">io</span><span class="op" id="6288371">.</span><span class="ident" id="6288372">Reader</span>&nbsp;<span class="comment" id="6288379">//&nbsp;if&nbsp;non-nil,&nbsp;where&nbsp;to&nbsp;read&nbsp;the&nbsp;data&nbsp;descriptor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6288429">err</span>&nbsp;&nbsp;<span class="builtintype" id="6288434">error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6288444">//&nbsp;sticky&nbsp;error</span><br>
<span class="lineno"></span><span class="op" id="6288460">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span><span class="keyword" id="6288463">func</span>&nbsp;<span class="op" id="6288468">(</span><span class="ident" id="6288469">r</span>&nbsp;<span class="op" id="6288471">*</span><span class="ident" id="6288472">checksumReader</span><span class="op" id="6288486">)</span>&nbsp;<span class="ident" id="6288488">Read</span><span class="op" id="6288492">(</span><span class="ident" id="6288493">b</span>&nbsp;<span class="op" id="6288495">[</span><span class="op" id="6288496">]</span><span class="builtintype" id="6288497">byte</span><span class="op" id="6288501">)</span>&nbsp;<span class="op" id="6288503">(</span><span class="ident" id="6288504">n</span>&nbsp;<span class="builtintype" id="6288506">int</span><span class="op" id="6288509">,</span>&nbsp;<span class="ident" id="6288511">err</span>&nbsp;<span class="builtintype" id="6288515">error</span><span class="op" id="6288520">)</span>&nbsp;<span class="op" id="6288522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6288525">if</span>&nbsp;<span class="ident" id="6288528">r</span><span class="op" id="6288529">.</span><span class="ident" id="6288530">err</span>&nbsp;<span class="op" id="6288534">!=</span>&nbsp;<span class="ident" id="6288537">nil</span>&nbsp;<span class="op" id="6288541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6288545">return</span>&nbsp;<span class="num" id="6288552">0</span><span class="op" id="6288553">,</span>&nbsp;<span class="ident" id="6288555">r</span><span class="op" id="6288556">.</span><span class="ident" id="6288557">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6288562">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6288565">n</span><span class="op" id="6288566">,</span>&nbsp;<span class="ident" id="6288568">err</span>&nbsp;<span class="op" id="6288572">=</span>&nbsp;<span class="ident" id="6288574">r</span><span class="op" id="6288575">.</span><span class="ident" id="6288576">rc</span><span class="op" id="6288578">.</span><span class="ident" id="6288579">Read</span><span class="op" id="6288583">(</span><span class="ident" id="6288584">b</span><span class="op" id="6288585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6288588">r</span><span class="op" id="6288589">.</span><span class="ident" id="6288590">hash</span><span class="op" id="6288594">.</span><span class="ident" id="6288595">Write</span><span class="op" id="6288600">(</span><span class="ident" id="6288601">b</span><span class="op" id="6288602">[</span><span class="op" id="6288603">:</span><span class="ident" id="6288604">n</span><span class="op" id="6288605">]</span><span class="op" id="6288606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6288609">if</span>&nbsp;<span class="ident" id="6288612">err</span>&nbsp;<span class="op" id="6288616">==</span>&nbsp;<span class="ident" id="6288619">nil</span>&nbsp;<span class="op" id="6288623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6288627">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6288635">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6288638">if</span>&nbsp;<span class="ident" id="6288641">err</span>&nbsp;<span class="op" id="6288645">==</span>&nbsp;<span class="ident" id="6288648">io</span><span class="op" id="6288650">.</span><span class="ident" id="6288651">EOF</span>&nbsp;<span class="op" id="6288655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6288659">if</span>&nbsp;<span class="ident" id="6288662">r</span><span class="op" id="6288663">.</span><span class="ident" id="6288664">desr</span>&nbsp;<span class="op" id="6288669">!=</span>&nbsp;<span class="ident" id="6288672">nil</span>&nbsp;<span class="op" id="6288676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6288681">if</span>&nbsp;<span class="ident" id="6288684">err1</span>&nbsp;<span class="op" id="6288689">:=</span>&nbsp;<span class="ident" id="6288692">readDataDescriptor</span><span class="op" id="6288710">(</span><span class="ident" id="6288711">r</span><span class="op" id="6288712">.</span><span class="ident" id="6288713">desr</span><span class="op" id="6288717">,</span>&nbsp;<span class="ident" id="6288719">r</span><span class="op" id="6288720">.</span><span class="ident" id="6288721">f</span><span class="op" id="6288722">)</span><span class="op" id="6288723">;</span>&nbsp;<span class="ident" id="6288725">err1</span>&nbsp;<span class="op" id="6288730">!=</span>&nbsp;<span class="ident" id="6288733">nil</span>&nbsp;<span class="op" id="6288737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6288743">err</span>&nbsp;<span class="op" id="6288747">=</span>&nbsp;<span class="ident" id="6288749">err1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6288757">}</span>&nbsp;<span class="keyword" id="6288759">else</span>&nbsp;<span class="keyword" id="6288764">if</span>&nbsp;<span class="ident" id="6288767">r</span><span class="op" id="6288768">.</span><span class="ident" id="6288769">hash</span><span class="op" id="6288773">.</span><span class="ident" id="6288774">Sum32</span><span class="op" id="6288779">(</span><span class="op" id="6288780">)</span>&nbsp;<span class="op" id="6288782">!=</span>&nbsp;<span class="ident" id="6288785">r</span><span class="op" id="6288786">.</span><span class="ident" id="6288787">f</span><span class="op" id="6288788">.</span><span class="ident" id="6288789">CRC32</span>&nbsp;<span class="op" id="6288795">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6288801">err</span>&nbsp;<span class="op" id="6288805">=</span>&nbsp;<span class="ident" id="6288807">ErrChecksum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6288822">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6288826">}</span>&nbsp;<span class="keyword" id="6288828">else</span>&nbsp;<span class="op" id="6288833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6288838">//&nbsp;If&nbsp;there&#39;s&nbsp;not&nbsp;a&nbsp;data&nbsp;descriptor,&nbsp;we&nbsp;still&nbsp;compare</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6288895">//&nbsp;the&nbsp;CRC32&nbsp;of&nbsp;what&nbsp;we&#39;ve&nbsp;read&nbsp;against&nbsp;the&nbsp;file&nbsp;header</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6288954">//&nbsp;or&nbsp;TOC&#39;s&nbsp;CRC32,&nbsp;if&nbsp;it&nbsp;seems&nbsp;like&nbsp;it&nbsp;was&nbsp;set.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6289005">if</span>&nbsp;<span class="ident" id="6289008">r</span><span class="op" id="6289009">.</span><span class="ident" id="6289010">f</span><span class="op" id="6289011">.</span><span class="ident" id="6289012">CRC32</span>&nbsp;<span class="op" id="6289018">!=</span>&nbsp;<span class="num" id="6289021">0</span>&nbsp;<span class="op" id="6289023">&amp;&amp;</span>&nbsp;<span class="ident" id="6289026">r</span><span class="op" id="6289027">.</span><span class="ident" id="6289028">hash</span><span class="op" id="6289032">.</span><span class="ident" id="6289033">Sum32</span><span class="op" id="6289038">(</span><span class="op" id="6289039">)</span>&nbsp;<span class="op" id="6289041">!=</span>&nbsp;<span class="ident" id="6289044">r</span><span class="op" id="6289045">.</span><span class="ident" id="6289046">f</span><span class="op" id="6289047">.</span><span class="ident" id="6289048">CRC32</span>&nbsp;<span class="op" id="6289054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6289060">err</span>&nbsp;<span class="op" id="6289064">=</span>&nbsp;<span class="ident" id="6289066">ErrChecksum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6289081">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6289085">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6289088">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6289091">r</span><span class="op" id="6289092">.</span><span class="ident" id="6289093">err</span>&nbsp;<span class="op" id="6289097">=</span>&nbsp;<span class="ident" id="6289099">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6289104">return</span><br>
<span class="lineno"></span><span class="op" id="6289111">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="keyword" id="6289114">func</span>&nbsp;<span class="op" id="6289119">(</span><span class="ident" id="6289120">r</span>&nbsp;<span class="op" id="6289122">*</span><span class="ident" id="6289123">checksumReader</span><span class="op" id="6289137">)</span>&nbsp;<span class="ident" id="6289139">Close</span><span class="op" id="6289144">(</span><span class="op" id="6289145">)</span>&nbsp;<span class="builtintype" id="6289147">error</span>&nbsp;<span class="op" id="6289153">{</span>&nbsp;<span class="keyword" id="6289155">return</span>&nbsp;<span class="ident" id="6289162">r</span><span class="op" id="6289163">.</span><span class="ident" id="6289164">rc</span><span class="op" id="6289166">.</span><span class="ident" id="6289167">Close</span><span class="op" id="6289172">(</span><span class="op" id="6289173">)</span>&nbsp;<span class="op" id="6289175">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6289178">//&nbsp;findBodyOffset&nbsp;does&nbsp;the&nbsp;minimum&nbsp;work&nbsp;to&nbsp;verify&nbsp;the&nbsp;file&nbsp;has&nbsp;a&nbsp;header</span><br>
<span class="lineno"></span><span class="comment" id="6289250">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;file&nbsp;body&nbsp;offset.</span><br>
<span class="lineno"></span><span class="keyword" id="6289287">func</span>&nbsp;<span class="op" id="6289292">(</span><span class="ident" id="6289293">f</span>&nbsp;<span class="op" id="6289295">*</span><span class="ident" id="6289296">File</span><span class="op" id="6289300">)</span>&nbsp;<span class="ident" id="6289302">findBodyOffset</span><span class="op" id="6289316">(</span><span class="op" id="6289317">)</span>&nbsp;<span class="op" id="6289319">(</span><span class="ident" id="6289320">int64</span><span class="op" id="6289325">,</span>&nbsp;<span class="builtintype" id="6289327">error</span><span class="op" id="6289332">)</span>&nbsp;<span class="op" id="6289334">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6289337">var</span>&nbsp;<span class="ident" id="6289341">buf</span>&nbsp;<span class="op" id="6289345">[</span><span class="ident" id="6289346">fileHeaderLen</span><span class="op" id="6289359">]</span><span class="builtintype" id="6289360">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6289366">if</span>&nbsp;<span class="ident" id="6289369">_</span><span class="op" id="6289370">,</span>&nbsp;<span class="ident" id="6289372">err</span>&nbsp;<span class="op" id="6289376">:=</span>&nbsp;<span class="ident" id="6289379">f</span><span class="op" id="6289380">.</span><span class="ident" id="6289381">zipr</span><span class="op" id="6289385">.</span><span class="ident" id="6289386">ReadAt</span><span class="op" id="6289392">(</span><span class="ident" id="6289393">buf</span><span class="op" id="6289396">[</span><span class="op" id="6289397">:</span><span class="op" id="6289398">]</span><span class="op" id="6289399">,</span>&nbsp;<span class="ident" id="6289401">f</span><span class="op" id="6289402">.</span><span class="ident" id="6289403">headerOffset</span><span class="op" id="6289415">)</span><span class="op" id="6289416">;</span>&nbsp;<span class="ident" id="6289418">err</span>&nbsp;<span class="op" id="6289422">!=</span>&nbsp;<span class="ident" id="6289425">nil</span>&nbsp;<span class="op" id="6289429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6289433">return</span>&nbsp;<span class="num" id="6289440">0</span><span class="op" id="6289441">,</span>&nbsp;<span class="ident" id="6289443">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6289448">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6289451">b</span>&nbsp;<span class="op" id="6289453">:=</span>&nbsp;<span class="ident" id="6289456">readBuf</span><span class="op" id="6289463">(</span><span class="ident" id="6289464">buf</span><span class="op" id="6289467">[</span><span class="op" id="6289468">:</span><span class="op" id="6289469">]</span><span class="op" id="6289470">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6289473">if</span>&nbsp;<span class="ident" id="6289476">sig</span>&nbsp;<span class="op" id="6289480">:=</span>&nbsp;<span class="ident" id="6289483">b</span><span class="op" id="6289484">.</span><span class="builtintype" id="6289485">uint32</span><span class="op" id="6289491">(</span><span class="op" id="6289492">)</span><span class="op" id="6289493">;</span>&nbsp;<span class="ident" id="6289495">sig</span>&nbsp;<span class="op" id="6289499">!=</span>&nbsp;<span class="ident" id="6289502">fileHeaderSignature</span>&nbsp;<span class="op" id="6289522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6289526">return</span>&nbsp;<span class="num" id="6289533">0</span><span class="op" id="6289534">,</span>&nbsp;<span class="ident" id="6289536">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6289547">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6289550">b</span>&nbsp;<span class="op" id="6289552">=</span>&nbsp;<span class="ident" id="6289554">b</span><span class="op" id="6289555">[</span><span class="num" id="6289556">22</span><span class="op" id="6289558">:</span><span class="op" id="6289559">]</span>&nbsp;<span class="comment" id="6289561">//&nbsp;skip&nbsp;over&nbsp;most&nbsp;of&nbsp;the&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6289594">filenameLen</span>&nbsp;<span class="op" id="6289606">:=</span>&nbsp;<span class="builtintype" id="6289609">int</span><span class="op" id="6289612">(</span><span class="ident" id="6289613">b</span><span class="op" id="6289614">.</span><span class="builtintype" id="6289615">uint16</span><span class="op" id="6289621">(</span><span class="op" id="6289622">)</span><span class="op" id="6289623">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6289626">extraLen</span>&nbsp;<span class="op" id="6289635">:=</span>&nbsp;<span class="builtintype" id="6289638">int</span><span class="op" id="6289641">(</span><span class="ident" id="6289642">b</span><span class="op" id="6289643">.</span><span class="builtintype" id="6289644">uint16</span><span class="op" id="6289650">(</span><span class="op" id="6289651">)</span><span class="op" id="6289652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6289655">return</span>&nbsp;<span class="ident" id="6289662">int64</span><span class="op" id="6289667">(</span><span class="ident" id="6289668">fileHeaderLen</span>&nbsp;<span class="op" id="6289682">+</span>&nbsp;<span class="ident" id="6289684">filenameLen</span>&nbsp;<span class="op" id="6289696">+</span>&nbsp;<span class="ident" id="6289698">extraLen</span><span class="op" id="6289706">)</span><span class="op" id="6289707">,</span>&nbsp;<span class="ident" id="6289709">nil</span><br>
<span class="lineno"></span><span class="op" id="6289713">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6289716">//&nbsp;readDirectoryHeader&nbsp;attempts&nbsp;to&nbsp;read&nbsp;a&nbsp;directory&nbsp;header&nbsp;from&nbsp;r.</span><br>
<span class="lineno">210</span><span class="comment" id="6289783">//&nbsp;It&nbsp;returns&nbsp;io.ErrUnexpectedEOF&nbsp;if&nbsp;it&nbsp;cannot&nbsp;read&nbsp;a&nbsp;complete&nbsp;header,</span><br>
<span class="lineno"></span><span class="comment" id="6289854">//&nbsp;and&nbsp;ErrFormat&nbsp;if&nbsp;it&nbsp;doesn&#39;t&nbsp;find&nbsp;a&nbsp;valid&nbsp;header&nbsp;signature.</span><br>
<span class="lineno"></span><span class="keyword" id="6289916">func</span>&nbsp;<span class="ident" id="6289921">readDirectoryHeader</span><span class="op" id="6289940">(</span><span class="ident" id="6289941">f</span>&nbsp;<span class="op" id="6289943">*</span><span class="ident" id="6289944">File</span><span class="op" id="6289948">,</span>&nbsp;<span class="ident" id="6289950">r</span>&nbsp;<span class="ident" id="6289952">io</span><span class="op" id="6289954">.</span><span class="ident" id="6289955">Reader</span><span class="op" id="6289961">)</span>&nbsp;<span class="builtintype" id="6289963">error</span>&nbsp;<span class="op" id="6289969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6289972">var</span>&nbsp;<span class="ident" id="6289976">buf</span>&nbsp;<span class="op" id="6289980">[</span><span class="ident" id="6289981">directoryHeaderLen</span><span class="op" id="6289999">]</span><span class="builtintype" id="6290000">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6290006">if</span>&nbsp;<span class="ident" id="6290009">_</span><span class="op" id="6290010">,</span>&nbsp;<span class="ident" id="6290012">err</span>&nbsp;<span class="op" id="6290016">:=</span>&nbsp;<span class="ident" id="6290019">io</span><span class="op" id="6290021">.</span><span class="ident" id="6290022">ReadFull</span><span class="op" id="6290030">(</span><span class="ident" id="6290031">r</span><span class="op" id="6290032">,</span>&nbsp;<span class="ident" id="6290034">buf</span><span class="op" id="6290037">[</span><span class="op" id="6290038">:</span><span class="op" id="6290039">]</span><span class="op" id="6290040">)</span><span class="op" id="6290041">;</span>&nbsp;<span class="ident" id="6290043">err</span>&nbsp;<span class="op" id="6290047">!=</span>&nbsp;<span class="ident" id="6290050">nil</span>&nbsp;<span class="op" id="6290054">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6290058">return</span>&nbsp;<span class="ident" id="6290065">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6290070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6290073">b</span>&nbsp;<span class="op" id="6290075">:=</span>&nbsp;<span class="ident" id="6290078">readBuf</span><span class="op" id="6290085">(</span><span class="ident" id="6290086">buf</span><span class="op" id="6290089">[</span><span class="op" id="6290090">:</span><span class="op" id="6290091">]</span><span class="op" id="6290092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6290095">if</span>&nbsp;<span class="ident" id="6290098">sig</span>&nbsp;<span class="op" id="6290102">:=</span>&nbsp;<span class="ident" id="6290105">b</span><span class="op" id="6290106">.</span><span class="builtintype" id="6290107">uint32</span><span class="op" id="6290113">(</span><span class="op" id="6290114">)</span><span class="op" id="6290115">;</span>&nbsp;<span class="ident" id="6290117">sig</span>&nbsp;<span class="op" id="6290121">!=</span>&nbsp;<span class="ident" id="6290124">directoryHeaderSignature</span>&nbsp;<span class="op" id="6290149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6290153">return</span>&nbsp;<span class="ident" id="6290160">ErrFormat</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6290171">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6290174">f</span><span class="op" id="6290175">.</span><span class="ident" id="6290176">CreatorVersion</span>&nbsp;<span class="op" id="6290191">=</span>&nbsp;<span class="ident" id="6290193">b</span><span class="op" id="6290194">.</span><span class="builtintype" id="6290195">uint16</span><span class="op" id="6290201">(</span><span class="op" id="6290202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6290205">f</span><span class="op" id="6290206">.</span><span class="ident" id="6290207">ReaderVersion</span>&nbsp;<span class="op" id="6290221">=</span>&nbsp;<span class="ident" id="6290223">b</span><span class="op" id="6290224">.</span><span class="builtintype" id="6290225">uint16</span><span class="op" id="6290231">(</span><span class="op" id="6290232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6290235">f</span><span class="op" id="6290236">.</span><span class="ident" id="6290237">Flags</span>&nbsp;<span class="op" id="6290243">=</span>&nbsp;<span class="ident" id="6290245">b</span><span class="op" id="6290246">.</span><span class="builtintype" id="6290247">uint16</span><span class="op" id="6290253">(</span><span class="op" id="6290254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6290257">f</span><span class="op" id="6290258">.</span><span class="ident" id="6290259">Method</span>&nbsp;<span class="op" id="6290266">=</span>&nbsp;<span class="ident" id="6290268">b</span><span class="op" id="6290269">.</span><span class="builtintype" id="6290270">uint16</span><span class="op" id="6290276">(</span><span class="op" id="6290277">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6290280">f</span><span class="op" id="6290281">.</span><span class="ident" id="6290282">ModifiedTime</span>&nbsp;<span class="op" id="6290295">=</span>&nbsp;<span class="ident" id="6290297">b</span><span class="op" id="6290298">.</span><span class="builtintype" id="6290299">uint16</span><span class="op" id="6290305">(</span><span class="op" id="6290306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6290309">f</span><span class="op" id="6290310">.</span><span class="ident" id="6290311">ModifiedDate</span>&nbsp;<span class="op" id="6290324">=</span>&nbsp;<span class="ident" id="6290326">b</span><span class="op" id="6290327">.</span><span class="builtintype" id="6290328">uint16</span><span class="op" id="6290334">(</span><span class="op" id="6290335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6290338">f</span><span class="op" id="6290339">.</span><span class="ident" id="6290340">CRC32</span>&nbsp;<span class="op" id="6290346">=</span>&nbsp;<span class="ident" id="6290348">b</span><span class="op" id="6290349">.</span><span class="builtintype" id="6290350">uint32</span><span class="op" id="6290356">(</span><span class="op" id="6290357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6290360">f</span><span class="op" id="6290361">.</span><span class="ident" id="6290362">CompressedSize</span>&nbsp;<span class="op" id="6290377">=</span>&nbsp;<span class="ident" id="6290379">b</span><span class="op" id="6290380">.</span><span class="builtintype" id="6290381">uint32</span><span class="op" id="6290387">(</span><span class="op" id="6290388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6290391">f</span><span class="op" id="6290392">.</span><span class="ident" id="6290393">UncompressedSize</span>&nbsp;<span class="op" id="6290410">=</span>&nbsp;<span class="ident" id="6290412">b</span><span class="op" id="6290413">.</span><span class="builtintype" id="6290414">uint32</span><span class="op" id="6290420">(</span><span class="op" id="6290421">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6290424">f</span><span class="op" id="6290425">.</span><span class="ident" id="6290426">CompressedSize64</span>&nbsp;<span class="op" id="6290443">=</span>&nbsp;<span class="ident" id="6290445">uint64</span><span class="op" id="6290451">(</span><span class="ident" id="6290452">f</span><span class="op" id="6290453">.</span><span class="ident" id="6290454">CompressedSize</span><span class="op" id="6290468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6290471">f</span><span class="op" id="6290472">.</span><span class="ident" id="6290473">UncompressedSize64</span>&nbsp;<span class="op" id="6290492">=</span>&nbsp;<span class="ident" id="6290494">uint64</span><span class="op" id="6290500">(</span><span class="ident" id="6290501">f</span><span class="op" id="6290502">.</span><span class="ident" id="6290503">UncompressedSize</span><span class="op" id="6290519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6290522">filenameLen</span>&nbsp;<span class="op" id="6290534">:=</span>&nbsp;<span class="builtintype" id="6290537">int</span><span class="op" id="6290540">(</span><span class="ident" id="6290541">b</span><span class="op" id="6290542">.</span><span class="builtintype" id="6290543">uint16</span><span class="op" id="6290549">(</span><span class="op" id="6290550">)</span><span class="op" id="6290551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6290554">extraLen</span>&nbsp;<span class="op" id="6290563">:=</span>&nbsp;<span class="builtintype" id="6290566">int</span><span class="op" id="6290569">(</span><span class="ident" id="6290570">b</span><span class="op" id="6290571">.</span><span class="builtintype" id="6290572">uint16</span><span class="op" id="6290578">(</span><span class="op" id="6290579">)</span><span class="op" id="6290580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6290583">commentLen</span>&nbsp;<span class="op" id="6290594">:=</span>&nbsp;<span class="builtintype" id="6290597">int</span><span class="op" id="6290600">(</span><span class="ident" id="6290601">b</span><span class="op" id="6290602">.</span><span class="builtintype" id="6290603">uint16</span><span class="op" id="6290609">(</span><span class="op" id="6290610">)</span><span class="op" id="6290611">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6290614">b</span>&nbsp;<span class="op" id="6290616">=</span>&nbsp;<span class="ident" id="6290618">b</span><span class="op" id="6290619">[</span><span class="num" id="6290620">4</span><span class="op" id="6290621">:</span><span class="op" id="6290622">]</span>&nbsp;<span class="comment" id="6290624">//&nbsp;skipped&nbsp;start&nbsp;disk&nbsp;number&nbsp;and&nbsp;internal&nbsp;attributes&nbsp;(2x&nbsp;uint16)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6290690">f</span><span class="op" id="6290691">.</span><span class="ident" id="6290692">ExternalAttrs</span>&nbsp;<span class="op" id="6290706">=</span>&nbsp;<span class="ident" id="6290708">b</span><span class="op" id="6290709">.</span><span class="builtintype" id="6290710">uint32</span><span class="op" id="6290716">(</span><span class="op" id="6290717">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6290720">f</span><span class="op" id="6290721">.</span><span class="ident" id="6290722">headerOffset</span>&nbsp;<span class="op" id="6290735">=</span>&nbsp;<span class="ident" id="6290737">int64</span><span class="op" id="6290742">(</span><span class="ident" id="6290743">b</span><span class="op" id="6290744">.</span><span class="builtintype" id="6290745">uint32</span><span class="op" id="6290751">(</span><span class="op" id="6290752">)</span><span class="op" id="6290753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6290756">d</span>&nbsp;<span class="op" id="6290758">:=</span>&nbsp;<span class="builtinfunc" id="6290761">make</span><span class="op" id="6290765">(</span><span class="op" id="6290766">[</span><span class="op" id="6290767">]</span><span class="builtintype" id="6290768">byte</span><span class="op" id="6290772">,</span>&nbsp;<span class="ident" id="6290774">filenameLen</span><span class="op" id="6290785">+</span><span class="ident" id="6290786">extraLen</span><span class="op" id="6290794">+</span><span class="ident" id="6290795">commentLen</span><span class="op" id="6290805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6290808">if</span>&nbsp;<span class="ident" id="6290811">_</span><span class="op" id="6290812">,</span>&nbsp;<span class="ident" id="6290814">err</span>&nbsp;<span class="op" id="6290818">:=</span>&nbsp;<span class="ident" id="6290821">io</span><span class="op" id="6290823">.</span><span class="ident" id="6290824">ReadFull</span><span class="op" id="6290832">(</span><span class="ident" id="6290833">r</span><span class="op" id="6290834">,</span>&nbsp;<span class="ident" id="6290836">d</span><span class="op" id="6290837">)</span><span class="op" id="6290838">;</span>&nbsp;<span class="ident" id="6290840">err</span>&nbsp;<span class="op" id="6290844">!=</span>&nbsp;<span class="ident" id="6290847">nil</span>&nbsp;<span class="op" id="6290851">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6290855">return</span>&nbsp;<span class="ident" id="6290862">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6290867">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6290870">f</span><span class="op" id="6290871">.</span><span class="ident" id="6290872">Name</span>&nbsp;<span class="op" id="6290877">=</span>&nbsp;<span class="builtintype" id="6290879">string</span><span class="op" id="6290885">(</span><span class="ident" id="6290886">d</span><span class="op" id="6290887">[</span><span class="op" id="6290888">:</span><span class="ident" id="6290889">filenameLen</span><span class="op" id="6290900">]</span><span class="op" id="6290901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6290904">f</span><span class="op" id="6290905">.</span><span class="ident" id="6290906">Extra</span>&nbsp;<span class="op" id="6290912">=</span>&nbsp;<span class="ident" id="6290914">d</span><span class="op" id="6290915">[</span><span class="ident" id="6290916">filenameLen</span>&nbsp;<span class="op" id="6290928">:</span>&nbsp;<span class="ident" id="6290930">filenameLen</span><span class="op" id="6290941">+</span><span class="ident" id="6290942">extraLen</span><span class="op" id="6290950">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6290953">f</span><span class="op" id="6290954">.</span><span class="ident" id="6290955">Comment</span>&nbsp;<span class="op" id="6290963">=</span>&nbsp;<span class="builtintype" id="6290965">string</span><span class="op" id="6290971">(</span><span class="ident" id="6290972">d</span><span class="op" id="6290973">[</span><span class="ident" id="6290974">filenameLen</span><span class="op" id="6290985">+</span><span class="ident" id="6290986">extraLen</span><span class="op" id="6290994">:</span><span class="op" id="6290995">]</span><span class="op" id="6290996">)</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6291000">if</span>&nbsp;<span class="builtinfunc" id="6291003">len</span><span class="op" id="6291006">(</span><span class="ident" id="6291007">f</span><span class="op" id="6291008">.</span><span class="ident" id="6291009">Extra</span><span class="op" id="6291014">)</span>&nbsp;<span class="op" id="6291016">&gt;</span>&nbsp;<span class="num" id="6291018">0</span>&nbsp;<span class="op" id="6291020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6291024">b</span>&nbsp;<span class="op" id="6291026">:=</span>&nbsp;<span class="ident" id="6291029">readBuf</span><span class="op" id="6291036">(</span><span class="ident" id="6291037">f</span><span class="op" id="6291038">.</span><span class="ident" id="6291039">Extra</span><span class="op" id="6291044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6291048">for</span>&nbsp;<span class="builtinfunc" id="6291052">len</span><span class="op" id="6291055">(</span><span class="ident" id="6291056">b</span><span class="op" id="6291057">)</span>&nbsp;<span class="op" id="6291059">&gt;=</span>&nbsp;<span class="num" id="6291062">4</span>&nbsp;<span class="op" id="6291064">{</span>&nbsp;<span class="comment" id="6291066">//&nbsp;need&nbsp;at&nbsp;least&nbsp;tag&nbsp;and&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6291099">tag</span>&nbsp;<span class="op" id="6291103">:=</span>&nbsp;<span class="ident" id="6291106">b</span><span class="op" id="6291107">.</span><span class="builtintype" id="6291108">uint16</span><span class="op" id="6291114">(</span><span class="op" id="6291115">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6291120">size</span>&nbsp;<span class="op" id="6291125">:=</span>&nbsp;<span class="ident" id="6291128">b</span><span class="op" id="6291129">.</span><span class="builtintype" id="6291130">uint16</span><span class="op" id="6291136">(</span><span class="op" id="6291137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6291142">if</span>&nbsp;<span class="builtintype" id="6291145">int</span><span class="op" id="6291148">(</span><span class="ident" id="6291149">size</span><span class="op" id="6291153">)</span>&nbsp;<span class="op" id="6291155">&gt;</span>&nbsp;<span class="builtinfunc" id="6291157">len</span><span class="op" id="6291160">(</span><span class="ident" id="6291161">b</span><span class="op" id="6291162">)</span>&nbsp;<span class="op" id="6291164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6291170">return</span>&nbsp;<span class="ident" id="6291177">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6291190">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6291195">if</span>&nbsp;<span class="ident" id="6291198">tag</span>&nbsp;<span class="op" id="6291202">==</span>&nbsp;<span class="ident" id="6291205">zip64ExtraId</span>&nbsp;<span class="op" id="6291218">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6291224">//&nbsp;update&nbsp;directory&nbsp;values&nbsp;from&nbsp;the&nbsp;zip64&nbsp;extra&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6291282">eb</span>&nbsp;<span class="op" id="6291285">:=</span>&nbsp;<span class="ident" id="6291288">readBuf</span><span class="op" id="6291295">(</span><span class="ident" id="6291296">b</span><span class="op" id="6291297">[</span><span class="op" id="6291298">:</span><span class="ident" id="6291299">size</span><span class="op" id="6291303">]</span><span class="op" id="6291304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6291310">if</span>&nbsp;<span class="builtinfunc" id="6291313">len</span><span class="op" id="6291316">(</span><span class="ident" id="6291317">eb</span><span class="op" id="6291319">)</span>&nbsp;<span class="op" id="6291321">&gt;=</span>&nbsp;<span class="num" id="6291324">8</span>&nbsp;<span class="op" id="6291326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6291333">f</span><span class="op" id="6291334">.</span><span class="ident" id="6291335">UncompressedSize64</span>&nbsp;<span class="op" id="6291354">=</span>&nbsp;<span class="ident" id="6291356">eb</span><span class="op" id="6291358">.</span><span class="ident" id="6291359">uint64</span><span class="op" id="6291365">(</span><span class="op" id="6291366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6291372">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6291378">if</span>&nbsp;<span class="builtinfunc" id="6291381">len</span><span class="op" id="6291384">(</span><span class="ident" id="6291385">eb</span><span class="op" id="6291387">)</span>&nbsp;<span class="op" id="6291389">&gt;=</span>&nbsp;<span class="num" id="6291392">8</span>&nbsp;<span class="op" id="6291394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6291401">f</span><span class="op" id="6291402">.</span><span class="ident" id="6291403">CompressedSize64</span>&nbsp;<span class="op" id="6291420">=</span>&nbsp;<span class="ident" id="6291422">eb</span><span class="op" id="6291424">.</span><span class="ident" id="6291425">uint64</span><span class="op" id="6291431">(</span><span class="op" id="6291432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6291438">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6291444">if</span>&nbsp;<span class="builtinfunc" id="6291447">len</span><span class="op" id="6291450">(</span><span class="ident" id="6291451">eb</span><span class="op" id="6291453">)</span>&nbsp;<span class="op" id="6291455">&gt;=</span>&nbsp;<span class="num" id="6291458">8</span>&nbsp;<span class="op" id="6291460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6291467">f</span><span class="op" id="6291468">.</span><span class="ident" id="6291469">headerOffset</span>&nbsp;<span class="op" id="6291482">=</span>&nbsp;<span class="ident" id="6291484">int64</span><span class="op" id="6291489">(</span><span class="ident" id="6291490">eb</span><span class="op" id="6291492">.</span><span class="ident" id="6291493">uint64</span><span class="op" id="6291499">(</span><span class="op" id="6291500">)</span><span class="op" id="6291501">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6291507">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6291512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6291517">b</span>&nbsp;<span class="op" id="6291519">=</span>&nbsp;<span class="ident" id="6291521">b</span><span class="op" id="6291522">[</span><span class="ident" id="6291523">size</span><span class="op" id="6291527">:</span><span class="op" id="6291528">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6291532">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6291536">//&nbsp;Should&nbsp;have&nbsp;consumed&nbsp;the&nbsp;whole&nbsp;header.</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6291580">//&nbsp;But&nbsp;popular&nbsp;zip&nbsp;&amp;&nbsp;JAR&nbsp;creation&nbsp;tools&nbsp;are&nbsp;broken&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6291637">//&nbsp;may&nbsp;pad&nbsp;extra&nbsp;zeros&nbsp;at&nbsp;the&nbsp;end,&nbsp;so&nbsp;accept&nbsp;those</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6291690">//&nbsp;too.&nbsp;See&nbsp;golang.org/issue/8186.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6291727">for</span>&nbsp;<span class="ident" id="6291731">_</span><span class="op" id="6291732">,</span>&nbsp;<span class="ident" id="6291734">v</span>&nbsp;<span class="op" id="6291736">:=</span>&nbsp;<span class="keyword" id="6291739">range</span>&nbsp;<span class="ident" id="6291745">b</span>&nbsp;<span class="op" id="6291747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6291752">if</span>&nbsp;<span class="ident" id="6291755">v</span>&nbsp;<span class="op" id="6291757">!=</span>&nbsp;<span class="num" id="6291760">0</span>&nbsp;<span class="op" id="6291762">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6291768">return</span>&nbsp;<span class="ident" id="6291775">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6291788">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6291792">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6291795">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6291798">return</span>&nbsp;<span class="ident" id="6291805">nil</span><br>
<span class="lineno">280</span><span class="op" id="6291809">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6291812">func</span>&nbsp;<span class="ident" id="6291817">readDataDescriptor</span><span class="op" id="6291835">(</span><span class="ident" id="6291836">r</span>&nbsp;<span class="ident" id="6291838">io</span><span class="op" id="6291840">.</span><span class="ident" id="6291841">Reader</span><span class="op" id="6291847">,</span>&nbsp;<span class="ident" id="6291849">f</span>&nbsp;<span class="op" id="6291851">*</span><span class="ident" id="6291852">File</span><span class="op" id="6291856">)</span>&nbsp;<span class="builtintype" id="6291858">error</span>&nbsp;<span class="op" id="6291864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6291867">var</span>&nbsp;<span class="ident" id="6291871">buf</span>&nbsp;<span class="op" id="6291875">[</span><span class="ident" id="6291876">dataDescriptorLen</span><span class="op" id="6291893">]</span><span class="builtintype" id="6291894">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6291901">//&nbsp;The&nbsp;spec&nbsp;says:&nbsp;&#34;Although&nbsp;not&nbsp;originally&nbsp;assigned&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6291956">//&nbsp;signature,&nbsp;the&nbsp;value&nbsp;0x08074b50&nbsp;has&nbsp;commonly&nbsp;been&nbsp;adopted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6292018">//&nbsp;as&nbsp;a&nbsp;signature&nbsp;value&nbsp;for&nbsp;the&nbsp;data&nbsp;descriptor&nbsp;record.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6292075">//&nbsp;Implementers&nbsp;should&nbsp;be&nbsp;aware&nbsp;that&nbsp;ZIP&nbsp;files&nbsp;may&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6292130">//&nbsp;encountered&nbsp;with&nbsp;or&nbsp;without&nbsp;this&nbsp;signature&nbsp;marking&nbsp;data</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6292190">//&nbsp;descriptors&nbsp;and&nbsp;should&nbsp;account&nbsp;for&nbsp;either&nbsp;case&nbsp;when&nbsp;reading</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6292254">//&nbsp;ZIP&nbsp;files&nbsp;to&nbsp;ensure&nbsp;compatibility.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6292294">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6292298">//&nbsp;dataDescriptorLen&nbsp;includes&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;signature&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6292359">//&nbsp;first&nbsp;read&nbsp;just&nbsp;those&nbsp;4&nbsp;bytes&nbsp;to&nbsp;see&nbsp;if&nbsp;it&nbsp;exists.</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6292414">if</span>&nbsp;<span class="ident" id="6292417">_</span><span class="op" id="6292418">,</span>&nbsp;<span class="ident" id="6292420">err</span>&nbsp;<span class="op" id="6292424">:=</span>&nbsp;<span class="ident" id="6292427">io</span><span class="op" id="6292429">.</span><span class="ident" id="6292430">ReadFull</span><span class="op" id="6292438">(</span><span class="ident" id="6292439">r</span><span class="op" id="6292440">,</span>&nbsp;<span class="ident" id="6292442">buf</span><span class="op" id="6292445">[</span><span class="op" id="6292446">:</span><span class="num" id="6292447">4</span><span class="op" id="6292448">]</span><span class="op" id="6292449">)</span><span class="op" id="6292450">;</span>&nbsp;<span class="ident" id="6292452">err</span>&nbsp;<span class="op" id="6292456">!=</span>&nbsp;<span class="ident" id="6292459">nil</span>&nbsp;<span class="op" id="6292463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6292467">return</span>&nbsp;<span class="ident" id="6292474">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6292479">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6292482">off</span>&nbsp;<span class="op" id="6292486">:=</span>&nbsp;<span class="num" id="6292489">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6292492">maybeSig</span>&nbsp;<span class="op" id="6292501">:=</span>&nbsp;<span class="ident" id="6292504">readBuf</span><span class="op" id="6292511">(</span><span class="ident" id="6292512">buf</span><span class="op" id="6292515">[</span><span class="op" id="6292516">:</span><span class="num" id="6292517">4</span><span class="op" id="6292518">]</span><span class="op" id="6292519">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6292522">if</span>&nbsp;<span class="ident" id="6292525">maybeSig</span><span class="op" id="6292533">.</span><span class="builtintype" id="6292534">uint32</span><span class="op" id="6292540">(</span><span class="op" id="6292541">)</span>&nbsp;<span class="op" id="6292543">!=</span>&nbsp;<span class="ident" id="6292546">dataDescriptorSignature</span>&nbsp;<span class="op" id="6292570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6292574">//&nbsp;No&nbsp;data&nbsp;descriptor&nbsp;signature.&nbsp;Keep&nbsp;these&nbsp;four</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6292625">//&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6292637">off</span>&nbsp;<span class="op" id="6292641">+=</span>&nbsp;<span class="num" id="6292644">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6292647">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6292650">if</span>&nbsp;<span class="ident" id="6292653">_</span><span class="op" id="6292654">,</span>&nbsp;<span class="ident" id="6292656">err</span>&nbsp;<span class="op" id="6292660">:=</span>&nbsp;<span class="ident" id="6292663">io</span><span class="op" id="6292665">.</span><span class="ident" id="6292666">ReadFull</span><span class="op" id="6292674">(</span><span class="ident" id="6292675">r</span><span class="op" id="6292676">,</span>&nbsp;<span class="ident" id="6292678">buf</span><span class="op" id="6292681">[</span><span class="ident" id="6292682">off</span><span class="op" id="6292685">:</span><span class="num" id="6292686">12</span><span class="op" id="6292688">]</span><span class="op" id="6292689">)</span><span class="op" id="6292690">;</span>&nbsp;<span class="ident" id="6292692">err</span>&nbsp;<span class="op" id="6292696">!=</span>&nbsp;<span class="ident" id="6292699">nil</span>&nbsp;<span class="op" id="6292703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6292707">return</span>&nbsp;<span class="ident" id="6292714">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6292719">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6292722">b</span>&nbsp;<span class="op" id="6292724">:=</span>&nbsp;<span class="ident" id="6292727">readBuf</span><span class="op" id="6292734">(</span><span class="ident" id="6292735">buf</span><span class="op" id="6292738">[</span><span class="op" id="6292739">:</span><span class="num" id="6292740">12</span><span class="op" id="6292742">]</span><span class="op" id="6292743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6292746">if</span>&nbsp;<span class="ident" id="6292749">b</span><span class="op" id="6292750">.</span><span class="builtintype" id="6292751">uint32</span><span class="op" id="6292757">(</span><span class="op" id="6292758">)</span>&nbsp;<span class="op" id="6292760">!=</span>&nbsp;<span class="ident" id="6292763">f</span><span class="op" id="6292764">.</span><span class="ident" id="6292765">CRC32</span>&nbsp;<span class="op" id="6292771">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6292775">return</span>&nbsp;<span class="ident" id="6292782">ErrChecksum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6292795">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6292799">//&nbsp;The&nbsp;two&nbsp;sizes&nbsp;that&nbsp;follow&nbsp;here&nbsp;can&nbsp;be&nbsp;either&nbsp;32&nbsp;bits&nbsp;or&nbsp;64&nbsp;bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6292867">//&nbsp;but&nbsp;the&nbsp;spec&nbsp;is&nbsp;not&nbsp;very&nbsp;clear&nbsp;on&nbsp;this&nbsp;and&nbsp;different</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6292924">//&nbsp;interpretations&nbsp;has&nbsp;been&nbsp;made&nbsp;causing&nbsp;incompatibilities.&nbsp;We</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6292988">//&nbsp;already&nbsp;have&nbsp;the&nbsp;sizes&nbsp;from&nbsp;the&nbsp;central&nbsp;directory&nbsp;so&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6293052">//&nbsp;just&nbsp;ignore&nbsp;these.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6293076">return</span>&nbsp;<span class="ident" id="6293083">nil</span><br>
<span class="lineno">320</span><span class="op" id="6293087">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6293090">func</span>&nbsp;<span class="ident" id="6293095">readDirectoryEnd</span><span class="op" id="6293111">(</span><span class="ident" id="6293112">r</span>&nbsp;<span class="ident" id="6293114">io</span><span class="op" id="6293116">.</span><span class="ident" id="6293117">ReaderAt</span><span class="op" id="6293125">,</span>&nbsp;<span class="ident" id="6293127">size</span>&nbsp;<span class="ident" id="6293132">int64</span><span class="op" id="6293137">)</span>&nbsp;<span class="op" id="6293139">(</span><span class="ident" id="6293140">dir</span>&nbsp;<span class="op" id="6293144">*</span><span class="ident" id="6293145">directoryEnd</span><span class="op" id="6293157">,</span>&nbsp;<span class="ident" id="6293159">err</span>&nbsp;<span class="builtintype" id="6293163">error</span><span class="op" id="6293168">)</span>&nbsp;<span class="op" id="6293170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6293173">//&nbsp;look&nbsp;for&nbsp;directoryEndSignature&nbsp;in&nbsp;the&nbsp;last&nbsp;1k,&nbsp;then&nbsp;in&nbsp;the&nbsp;last&nbsp;65k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6293245">var</span>&nbsp;<span class="ident" id="6293249">buf</span>&nbsp;<span class="op" id="6293253">[</span><span class="op" id="6293254">]</span><span class="builtintype" id="6293255">byte</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6293261">var</span>&nbsp;<span class="ident" id="6293265">directoryEndOffset</span>&nbsp;<span class="ident" id="6293284">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6293291">for</span>&nbsp;<span class="ident" id="6293295">i</span><span class="op" id="6293296">,</span>&nbsp;<span class="ident" id="6293298">bLen</span>&nbsp;<span class="op" id="6293303">:=</span>&nbsp;<span class="keyword" id="6293306">range</span>&nbsp;<span class="op" id="6293312">[</span><span class="op" id="6293313">]</span><span class="ident" id="6293314">int64</span><span class="op" id="6293319">{</span><span class="num" id="6293320">1024</span><span class="op" id="6293324">,</span>&nbsp;<span class="num" id="6293326">65</span>&nbsp;<span class="op" id="6293329">*</span>&nbsp;<span class="num" id="6293331">1024</span><span class="op" id="6293335">}</span>&nbsp;<span class="op" id="6293337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6293341">if</span>&nbsp;<span class="ident" id="6293344">bLen</span>&nbsp;<span class="op" id="6293349">&gt;</span>&nbsp;<span class="ident" id="6293351">size</span>&nbsp;<span class="op" id="6293356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6293361">bLen</span>&nbsp;<span class="op" id="6293366">=</span>&nbsp;<span class="ident" id="6293368">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6293375">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6293379">buf</span>&nbsp;<span class="op" id="6293383">=</span>&nbsp;<span class="builtinfunc" id="6293385">make</span><span class="op" id="6293389">(</span><span class="op" id="6293390">[</span><span class="op" id="6293391">]</span><span class="builtintype" id="6293392">byte</span><span class="op" id="6293396">,</span>&nbsp;<span class="builtintype" id="6293398">int</span><span class="op" id="6293401">(</span><span class="ident" id="6293402">bLen</span><span class="op" id="6293406">)</span><span class="op" id="6293407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6293411">if</span>&nbsp;<span class="ident" id="6293414">_</span><span class="op" id="6293415">,</span>&nbsp;<span class="ident" id="6293417">err</span>&nbsp;<span class="op" id="6293421">:=</span>&nbsp;<span class="ident" id="6293424">r</span><span class="op" id="6293425">.</span><span class="ident" id="6293426">ReadAt</span><span class="op" id="6293432">(</span><span class="ident" id="6293433">buf</span><span class="op" id="6293436">,</span>&nbsp;<span class="ident" id="6293438">size</span><span class="op" id="6293442">-</span><span class="ident" id="6293443">bLen</span><span class="op" id="6293447">)</span><span class="op" id="6293448">;</span>&nbsp;<span class="ident" id="6293450">err</span>&nbsp;<span class="op" id="6293454">!=</span>&nbsp;<span class="ident" id="6293457">nil</span>&nbsp;<span class="op" id="6293461">&amp;&amp;</span>&nbsp;<span class="ident" id="6293464">err</span>&nbsp;<span class="op" id="6293468">!=</span>&nbsp;<span class="ident" id="6293471">io</span><span class="op" id="6293473">.</span><span class="ident" id="6293474">EOF</span>&nbsp;<span class="op" id="6293478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6293483">return</span>&nbsp;<span class="ident" id="6293490">nil</span><span class="op" id="6293493">,</span>&nbsp;<span class="ident" id="6293495">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6293501">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6293505">if</span>&nbsp;<span class="ident" id="6293508">p</span>&nbsp;<span class="op" id="6293510">:=</span>&nbsp;<span class="ident" id="6293513">findSignatureInBlock</span><span class="op" id="6293533">(</span><span class="ident" id="6293534">buf</span><span class="op" id="6293537">)</span><span class="op" id="6293538">;</span>&nbsp;<span class="ident" id="6293540">p</span>&nbsp;<span class="op" id="6293542">&gt;=</span>&nbsp;<span class="num" id="6293545">0</span>&nbsp;<span class="op" id="6293547">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6293552">buf</span>&nbsp;<span class="op" id="6293556">=</span>&nbsp;<span class="ident" id="6293558">buf</span><span class="op" id="6293561">[</span><span class="ident" id="6293562">p</span><span class="op" id="6293563">:</span><span class="op" id="6293564">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6293569">directoryEndOffset</span>&nbsp;<span class="op" id="6293588">=</span>&nbsp;<span class="ident" id="6293590">size</span>&nbsp;<span class="op" id="6293595">-</span>&nbsp;<span class="ident" id="6293597">bLen</span>&nbsp;<span class="op" id="6293602">+</span>&nbsp;<span class="ident" id="6293604">int64</span><span class="op" id="6293609">(</span><span class="ident" id="6293610">p</span><span class="op" id="6293611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6293616">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6293624">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6293628">if</span>&nbsp;<span class="ident" id="6293631">i</span>&nbsp;<span class="op" id="6293633">==</span>&nbsp;<span class="num" id="6293636">1</span>&nbsp;<span class="op" id="6293638">||</span>&nbsp;<span class="ident" id="6293641">bLen</span>&nbsp;<span class="op" id="6293646">==</span>&nbsp;<span class="ident" id="6293649">size</span>&nbsp;<span class="op" id="6293654">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6293659">return</span>&nbsp;<span class="ident" id="6293666">nil</span><span class="op" id="6293669">,</span>&nbsp;<span class="ident" id="6293671">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6293683">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6293686">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6293690">//&nbsp;read&nbsp;header&nbsp;into&nbsp;struct</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6293718">b</span>&nbsp;<span class="op" id="6293720">:=</span>&nbsp;<span class="ident" id="6293723">readBuf</span><span class="op" id="6293730">(</span><span class="ident" id="6293731">buf</span><span class="op" id="6293734">[</span><span class="num" id="6293735">4</span><span class="op" id="6293736">:</span><span class="op" id="6293737">]</span><span class="op" id="6293738">)</span>&nbsp;<span class="comment" id="6293740">//&nbsp;skip&nbsp;signature</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6293759">d</span>&nbsp;<span class="op" id="6293761">:=</span>&nbsp;<span class="op" id="6293764">&amp;</span><span class="ident" id="6293765">directoryEnd</span><span class="op" id="6293777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6293781">diskNbr</span><span class="op" id="6293788">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6293801">uint32</span><span class="op" id="6293807">(</span><span class="ident" id="6293808">b</span><span class="op" id="6293809">.</span><span class="builtintype" id="6293810">uint16</span><span class="op" id="6293816">(</span><span class="op" id="6293817">)</span><span class="op" id="6293818">)</span><span class="op" id="6293819">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6293823">dirDiskNbr</span><span class="op" id="6293833">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6293843">uint32</span><span class="op" id="6293849">(</span><span class="ident" id="6293850">b</span><span class="op" id="6293851">.</span><span class="builtintype" id="6293852">uint16</span><span class="op" id="6293858">(</span><span class="op" id="6293859">)</span><span class="op" id="6293860">)</span><span class="op" id="6293861">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6293865">dirRecordsThisDisk</span><span class="op" id="6293883">:</span>&nbsp;<span class="ident" id="6293885">uint64</span><span class="op" id="6293891">(</span><span class="ident" id="6293892">b</span><span class="op" id="6293893">.</span><span class="builtintype" id="6293894">uint16</span><span class="op" id="6293900">(</span><span class="op" id="6293901">)</span><span class="op" id="6293902">)</span><span class="op" id="6293903">,</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6293907">directoryRecords</span><span class="op" id="6293923">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6293927">uint64</span><span class="op" id="6293933">(</span><span class="ident" id="6293934">b</span><span class="op" id="6293935">.</span><span class="builtintype" id="6293936">uint16</span><span class="op" id="6293942">(</span><span class="op" id="6293943">)</span><span class="op" id="6293944">)</span><span class="op" id="6293945">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6293949">directorySize</span><span class="op" id="6293962">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6293969">uint64</span><span class="op" id="6293975">(</span><span class="ident" id="6293976">b</span><span class="op" id="6293977">.</span><span class="builtintype" id="6293978">uint32</span><span class="op" id="6293984">(</span><span class="op" id="6293985">)</span><span class="op" id="6293986">)</span><span class="op" id="6293987">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6293991">directoryOffset</span><span class="op" id="6294006">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6294011">uint64</span><span class="op" id="6294017">(</span><span class="ident" id="6294018">b</span><span class="op" id="6294019">.</span><span class="builtintype" id="6294020">uint32</span><span class="op" id="6294026">(</span><span class="op" id="6294027">)</span><span class="op" id="6294028">)</span><span class="op" id="6294029">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6294033">commentLen</span><span class="op" id="6294043">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6294053">b</span><span class="op" id="6294054">.</span><span class="builtintype" id="6294055">uint16</span><span class="op" id="6294061">(</span><span class="op" id="6294062">)</span><span class="op" id="6294063">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6294066">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6294069">l</span>&nbsp;<span class="op" id="6294071">:=</span>&nbsp;<span class="builtintype" id="6294074">int</span><span class="op" id="6294077">(</span><span class="ident" id="6294078">d</span><span class="op" id="6294079">.</span><span class="ident" id="6294080">commentLen</span><span class="op" id="6294090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6294093">if</span>&nbsp;<span class="ident" id="6294096">l</span>&nbsp;<span class="op" id="6294098">&gt;</span>&nbsp;<span class="builtinfunc" id="6294100">len</span><span class="op" id="6294103">(</span><span class="ident" id="6294104">b</span><span class="op" id="6294105">)</span>&nbsp;<span class="op" id="6294107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6294111">return</span>&nbsp;<span class="ident" id="6294118">nil</span><span class="op" id="6294121">,</span>&nbsp;<span class="ident" id="6294123">errors</span><span class="op" id="6294129">.</span><span class="ident" id="6294130">New</span><span class="op" id="6294133">(</span><span class="string" id="6294134">&#34;zip:&nbsp;invalid&nbsp;comment&nbsp;length&#34;</span><span class="op" id="6294163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6294166">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6294169">d</span><span class="op" id="6294170">.</span><span class="ident" id="6294171">comment</span>&nbsp;<span class="op" id="6294179">=</span>&nbsp;<span class="builtintype" id="6294181">string</span><span class="op" id="6294187">(</span><span class="ident" id="6294188">b</span><span class="op" id="6294189">[</span><span class="op" id="6294190">:</span><span class="ident" id="6294191">l</span><span class="op" id="6294192">]</span><span class="op" id="6294193">)</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6294197">p</span><span class="op" id="6294198">,</span>&nbsp;<span class="ident" id="6294200">err</span>&nbsp;<span class="op" id="6294204">:=</span>&nbsp;<span class="ident" id="6294207">findDirectory64End</span><span class="op" id="6294225">(</span><span class="ident" id="6294226">r</span><span class="op" id="6294227">,</span>&nbsp;<span class="ident" id="6294229">directoryEndOffset</span><span class="op" id="6294247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6294250">if</span>&nbsp;<span class="ident" id="6294253">err</span>&nbsp;<span class="op" id="6294257">==</span>&nbsp;<span class="ident" id="6294260">nil</span>&nbsp;<span class="op" id="6294264">&amp;&amp;</span>&nbsp;<span class="ident" id="6294267">p</span>&nbsp;<span class="op" id="6294269">&gt;=</span>&nbsp;<span class="num" id="6294272">0</span>&nbsp;<span class="op" id="6294274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6294278">err</span>&nbsp;<span class="op" id="6294282">=</span>&nbsp;<span class="ident" id="6294284">readDirectory64End</span><span class="op" id="6294302">(</span><span class="ident" id="6294303">r</span><span class="op" id="6294304">,</span>&nbsp;<span class="ident" id="6294306">p</span><span class="op" id="6294307">,</span>&nbsp;<span class="ident" id="6294309">d</span><span class="op" id="6294310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6294313">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6294316">if</span>&nbsp;<span class="ident" id="6294319">err</span>&nbsp;<span class="op" id="6294323">!=</span>&nbsp;<span class="ident" id="6294326">nil</span>&nbsp;<span class="op" id="6294330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6294334">return</span>&nbsp;<span class="ident" id="6294341">nil</span><span class="op" id="6294344">,</span>&nbsp;<span class="ident" id="6294346">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6294351">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6294355">//&nbsp;Make&nbsp;sure&nbsp;directoryOffset&nbsp;points&nbsp;to&nbsp;somewhere&nbsp;in&nbsp;our&nbsp;file.</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6294418">if</span>&nbsp;<span class="ident" id="6294421">o</span>&nbsp;<span class="op" id="6294423">:=</span>&nbsp;<span class="ident" id="6294426">int64</span><span class="op" id="6294431">(</span><span class="ident" id="6294432">d</span><span class="op" id="6294433">.</span><span class="ident" id="6294434">directoryOffset</span><span class="op" id="6294449">)</span><span class="op" id="6294450">;</span>&nbsp;<span class="ident" id="6294452">o</span>&nbsp;<span class="op" id="6294454">&lt;</span>&nbsp;<span class="num" id="6294456">0</span>&nbsp;<span class="op" id="6294458">||</span>&nbsp;<span class="ident" id="6294461">o</span>&nbsp;<span class="op" id="6294463">&gt;=</span>&nbsp;<span class="ident" id="6294466">size</span>&nbsp;<span class="op" id="6294471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6294475">return</span>&nbsp;<span class="ident" id="6294482">nil</span><span class="op" id="6294485">,</span>&nbsp;<span class="ident" id="6294487">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6294498">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6294501">return</span>&nbsp;<span class="ident" id="6294508">d</span><span class="op" id="6294509">,</span>&nbsp;<span class="ident" id="6294511">nil</span><br>
<span class="lineno"></span><span class="op" id="6294515">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span><span class="comment" id="6294518">//&nbsp;findDirectory64End&nbsp;tries&nbsp;to&nbsp;read&nbsp;the&nbsp;zip64&nbsp;locator&nbsp;just&nbsp;before&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6294588">//&nbsp;directory&nbsp;end&nbsp;and&nbsp;returns&nbsp;the&nbsp;offset&nbsp;of&nbsp;the&nbsp;zip64&nbsp;directory&nbsp;end&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="6294658">//&nbsp;found.</span><br>
<span class="lineno"></span><span class="keyword" id="6294668">func</span>&nbsp;<span class="ident" id="6294673">findDirectory64End</span><span class="op" id="6294691">(</span><span class="ident" id="6294692">r</span>&nbsp;<span class="ident" id="6294694">io</span><span class="op" id="6294696">.</span><span class="ident" id="6294697">ReaderAt</span><span class="op" id="6294705">,</span>&nbsp;<span class="ident" id="6294707">directoryEndOffset</span>&nbsp;<span class="ident" id="6294726">int64</span><span class="op" id="6294731">)</span>&nbsp;<span class="op" id="6294733">(</span><span class="ident" id="6294734">int64</span><span class="op" id="6294739">,</span>&nbsp;<span class="builtintype" id="6294741">error</span><span class="op" id="6294746">)</span>&nbsp;<span class="op" id="6294748">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6294751">locOffset</span>&nbsp;<span class="op" id="6294761">:=</span>&nbsp;<span class="ident" id="6294764">directoryEndOffset</span>&nbsp;<span class="op" id="6294783">-</span>&nbsp;<span class="ident" id="6294785">directory64LocLen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6294804">if</span>&nbsp;<span class="ident" id="6294807">locOffset</span>&nbsp;<span class="op" id="6294817">&lt;</span>&nbsp;<span class="num" id="6294819">0</span>&nbsp;<span class="op" id="6294821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6294825">return</span>&nbsp;<span class="op" id="6294832">-</span><span class="num" id="6294833">1</span><span class="op" id="6294834">,</span>&nbsp;<span class="ident" id="6294836">nil</span>&nbsp;<span class="comment" id="6294840">//&nbsp;no&nbsp;need&nbsp;to&nbsp;look&nbsp;for&nbsp;a&nbsp;header&nbsp;outside&nbsp;the&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6294890">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6294893">buf</span>&nbsp;<span class="op" id="6294897">:=</span>&nbsp;<span class="builtinfunc" id="6294900">make</span><span class="op" id="6294904">(</span><span class="op" id="6294905">[</span><span class="op" id="6294906">]</span><span class="builtintype" id="6294907">byte</span><span class="op" id="6294911">,</span>&nbsp;<span class="ident" id="6294913">directory64LocLen</span><span class="op" id="6294930">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6294933">if</span>&nbsp;<span class="ident" id="6294936">_</span><span class="op" id="6294937">,</span>&nbsp;<span class="ident" id="6294939">err</span>&nbsp;<span class="op" id="6294943">:=</span>&nbsp;<span class="ident" id="6294946">r</span><span class="op" id="6294947">.</span><span class="ident" id="6294948">ReadAt</span><span class="op" id="6294954">(</span><span class="ident" id="6294955">buf</span><span class="op" id="6294958">,</span>&nbsp;<span class="ident" id="6294960">locOffset</span><span class="op" id="6294969">)</span><span class="op" id="6294970">;</span>&nbsp;<span class="ident" id="6294972">err</span>&nbsp;<span class="op" id="6294976">!=</span>&nbsp;<span class="ident" id="6294979">nil</span>&nbsp;<span class="op" id="6294983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6294987">return</span>&nbsp;<span class="op" id="6294994">-</span><span class="num" id="6294995">1</span><span class="op" id="6294996">,</span>&nbsp;<span class="ident" id="6294998">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6295003">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6295006">b</span>&nbsp;<span class="op" id="6295008">:=</span>&nbsp;<span class="ident" id="6295011">readBuf</span><span class="op" id="6295018">(</span><span class="ident" id="6295019">buf</span><span class="op" id="6295022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6295025">if</span>&nbsp;<span class="ident" id="6295028">sig</span>&nbsp;<span class="op" id="6295032">:=</span>&nbsp;<span class="ident" id="6295035">b</span><span class="op" id="6295036">.</span><span class="builtintype" id="6295037">uint32</span><span class="op" id="6295043">(</span><span class="op" id="6295044">)</span><span class="op" id="6295045">;</span>&nbsp;<span class="ident" id="6295047">sig</span>&nbsp;<span class="op" id="6295051">!=</span>&nbsp;<span class="ident" id="6295054">directory64LocSignature</span>&nbsp;<span class="op" id="6295078">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6295082">return</span>&nbsp;<span class="op" id="6295089">-</span><span class="num" id="6295090">1</span><span class="op" id="6295091">,</span>&nbsp;<span class="ident" id="6295093">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6295098">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6295101">b</span>&nbsp;<span class="op" id="6295103">=</span>&nbsp;<span class="ident" id="6295105">b</span><span class="op" id="6295106">[</span><span class="num" id="6295107">4</span><span class="op" id="6295108">:</span><span class="op" id="6295109">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6295117">//&nbsp;skip&nbsp;number&nbsp;of&nbsp;the&nbsp;disk&nbsp;with&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6295198">p</span>&nbsp;<span class="op" id="6295200">:=</span>&nbsp;<span class="ident" id="6295203">b</span><span class="op" id="6295204">.</span><span class="ident" id="6295205">uint64</span><span class="op" id="6295211">(</span><span class="op" id="6295212">)</span>&nbsp;<span class="comment" id="6295214">//&nbsp;relative&nbsp;offset&nbsp;of&nbsp;the&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6295279">return</span>&nbsp;<span class="ident" id="6295286">int64</span><span class="op" id="6295291">(</span><span class="ident" id="6295292">p</span><span class="op" id="6295293">)</span><span class="op" id="6295294">,</span>&nbsp;<span class="ident" id="6295296">nil</span><br>
<span class="lineno">395</span><span class="op" id="6295300">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6295303">//&nbsp;readDirectory64End&nbsp;reads&nbsp;the&nbsp;zip64&nbsp;directory&nbsp;end&nbsp;and&nbsp;updates&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6295371">//&nbsp;directory&nbsp;end&nbsp;with&nbsp;the&nbsp;zip64&nbsp;directory&nbsp;end&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="6295425">func</span>&nbsp;<span class="ident" id="6295430">readDirectory64End</span><span class="op" id="6295448">(</span><span class="ident" id="6295449">r</span>&nbsp;<span class="ident" id="6295451">io</span><span class="op" id="6295453">.</span><span class="ident" id="6295454">ReaderAt</span><span class="op" id="6295462">,</span>&nbsp;<span class="ident" id="6295464">offset</span>&nbsp;<span class="ident" id="6295471">int64</span><span class="op" id="6295476">,</span>&nbsp;<span class="ident" id="6295478">d</span>&nbsp;<span class="op" id="6295480">*</span><span class="ident" id="6295481">directoryEnd</span><span class="op" id="6295493">)</span>&nbsp;<span class="op" id="6295495">(</span><span class="ident" id="6295496">err</span>&nbsp;<span class="builtintype" id="6295500">error</span><span class="op" id="6295505">)</span>&nbsp;<span class="op" id="6295507">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6295510">buf</span>&nbsp;<span class="op" id="6295514">:=</span>&nbsp;<span class="builtinfunc" id="6295517">make</span><span class="op" id="6295521">(</span><span class="op" id="6295522">[</span><span class="op" id="6295523">]</span><span class="builtintype" id="6295524">byte</span><span class="op" id="6295528">,</span>&nbsp;<span class="ident" id="6295530">directory64EndLen</span><span class="op" id="6295547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6295550">if</span>&nbsp;<span class="ident" id="6295553">_</span><span class="op" id="6295554">,</span>&nbsp;<span class="ident" id="6295556">err</span>&nbsp;<span class="op" id="6295560">:=</span>&nbsp;<span class="ident" id="6295563">r</span><span class="op" id="6295564">.</span><span class="ident" id="6295565">ReadAt</span><span class="op" id="6295571">(</span><span class="ident" id="6295572">buf</span><span class="op" id="6295575">,</span>&nbsp;<span class="ident" id="6295577">offset</span><span class="op" id="6295583">)</span><span class="op" id="6295584">;</span>&nbsp;<span class="ident" id="6295586">err</span>&nbsp;<span class="op" id="6295590">!=</span>&nbsp;<span class="ident" id="6295593">nil</span>&nbsp;<span class="op" id="6295597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6295601">return</span>&nbsp;<span class="ident" id="6295608">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6295613">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6295617">b</span>&nbsp;<span class="op" id="6295619">:=</span>&nbsp;<span class="ident" id="6295622">readBuf</span><span class="op" id="6295629">(</span><span class="ident" id="6295630">buf</span><span class="op" id="6295633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6295636">if</span>&nbsp;<span class="ident" id="6295639">sig</span>&nbsp;<span class="op" id="6295643">:=</span>&nbsp;<span class="ident" id="6295646">b</span><span class="op" id="6295647">.</span><span class="builtintype" id="6295648">uint32</span><span class="op" id="6295654">(</span><span class="op" id="6295655">)</span><span class="op" id="6295656">;</span>&nbsp;<span class="ident" id="6295658">sig</span>&nbsp;<span class="op" id="6295662">!=</span>&nbsp;<span class="ident" id="6295665">directory64EndSignature</span>&nbsp;<span class="op" id="6295689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6295693">return</span>&nbsp;<span class="ident" id="6295700">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6295711">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6295715">b</span>&nbsp;<span class="op" id="6295717">=</span>&nbsp;<span class="ident" id="6295719">b</span><span class="op" id="6295720">[</span><span class="num" id="6295721">12</span><span class="op" id="6295723">:</span><span class="op" id="6295724">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6295749">//&nbsp;skip&nbsp;dir&nbsp;size,&nbsp;version&nbsp;and&nbsp;version&nbsp;needed&nbsp;(uint64&nbsp;+&nbsp;2x&nbsp;uint16)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6295816">d</span><span class="op" id="6295817">.</span><span class="ident" id="6295818">diskNbr</span>&nbsp;<span class="op" id="6295826">=</span>&nbsp;<span class="ident" id="6295828">b</span><span class="op" id="6295829">.</span><span class="builtintype" id="6295830">uint32</span><span class="op" id="6295836">(</span><span class="op" id="6295837">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6295850">//&nbsp;number&nbsp;of&nbsp;this&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6295874">d</span><span class="op" id="6295875">.</span><span class="ident" id="6295876">dirDiskNbr</span>&nbsp;<span class="op" id="6295887">=</span>&nbsp;<span class="ident" id="6295889">b</span><span class="op" id="6295890">.</span><span class="builtintype" id="6295891">uint32</span><span class="op" id="6295897">(</span><span class="op" id="6295898">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6295908">//&nbsp;number&nbsp;of&nbsp;the&nbsp;disk&nbsp;with&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6295971">d</span><span class="op" id="6295972">.</span><span class="ident" id="6295973">dirRecordsThisDisk</span>&nbsp;<span class="op" id="6295992">=</span>&nbsp;<span class="ident" id="6295994">b</span><span class="op" id="6295995">.</span><span class="ident" id="6295996">uint64</span><span class="op" id="6296002">(</span><span class="op" id="6296003">)</span>&nbsp;<span class="comment" id="6296005">//&nbsp;total&nbsp;number&nbsp;of&nbsp;entries&nbsp;in&nbsp;the&nbsp;central&nbsp;directory&nbsp;on&nbsp;this&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6296071">d</span><span class="op" id="6296072">.</span><span class="ident" id="6296073">directoryRecords</span>&nbsp;<span class="op" id="6296090">=</span>&nbsp;<span class="ident" id="6296092">b</span><span class="op" id="6296093">.</span><span class="ident" id="6296094">uint64</span><span class="op" id="6296100">(</span><span class="op" id="6296101">)</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="6296105">//&nbsp;total&nbsp;number&nbsp;of&nbsp;entries&nbsp;in&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6296158">d</span><span class="op" id="6296159">.</span><span class="ident" id="6296160">directorySize</span>&nbsp;<span class="op" id="6296174">=</span>&nbsp;<span class="ident" id="6296176">b</span><span class="op" id="6296177">.</span><span class="ident" id="6296178">uint64</span><span class="op" id="6296184">(</span><span class="op" id="6296185">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6296192">//&nbsp;size&nbsp;of&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6296226">d</span><span class="op" id="6296227">.</span><span class="ident" id="6296228">directoryOffset</span>&nbsp;<span class="op" id="6296244">=</span>&nbsp;<span class="ident" id="6296246">b</span><span class="op" id="6296247">.</span><span class="ident" id="6296248">uint64</span><span class="op" id="6296254">(</span><span class="op" id="6296255">)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6296260">//&nbsp;offset&nbsp;of&nbsp;start&nbsp;of&nbsp;central&nbsp;directory&nbsp;with&nbsp;respect&nbsp;to&nbsp;the&nbsp;starting&nbsp;disk&nbsp;number</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6296343">return</span>&nbsp;<span class="ident" id="6296350">nil</span><br>
<span class="lineno"></span><span class="op" id="6296354">}</span><br>
<span class="lineno">420</span><br>
<span class="lineno"></span><span class="keyword" id="6296357">func</span>&nbsp;<span class="ident" id="6296362">findSignatureInBlock</span><span class="op" id="6296382">(</span><span class="ident" id="6296383">b</span>&nbsp;<span class="op" id="6296385">[</span><span class="op" id="6296386">]</span><span class="builtintype" id="6296387">byte</span><span class="op" id="6296391">)</span>&nbsp;<span class="builtintype" id="6296393">int</span>&nbsp;<span class="op" id="6296397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6296400">for</span>&nbsp;<span class="ident" id="6296404">i</span>&nbsp;<span class="op" id="6296406">:=</span>&nbsp;<span class="builtinfunc" id="6296409">len</span><span class="op" id="6296412">(</span><span class="ident" id="6296413">b</span><span class="op" id="6296414">)</span>&nbsp;<span class="op" id="6296416">-</span>&nbsp;<span class="ident" id="6296418">directoryEndLen</span><span class="op" id="6296433">;</span>&nbsp;<span class="ident" id="6296435">i</span>&nbsp;<span class="op" id="6296437">&gt;=</span>&nbsp;<span class="num" id="6296440">0</span><span class="op" id="6296441">;</span>&nbsp;<span class="ident" id="6296443">i</span><span class="op" id="6296444">--</span>&nbsp;<span class="op" id="6296447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6296451">//&nbsp;defined&nbsp;from&nbsp;directoryEndSignature&nbsp;in&nbsp;struct.go</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6296504">if</span>&nbsp;<span class="ident" id="6296507">b</span><span class="op" id="6296508">[</span><span class="ident" id="6296509">i</span><span class="op" id="6296510">]</span>&nbsp;<span class="op" id="6296512">==</span>&nbsp;<span class="string" id="6296515">&#39;P&#39;</span>&nbsp;<span class="op" id="6296519">&amp;&amp;</span>&nbsp;<span class="ident" id="6296522">b</span><span class="op" id="6296523">[</span><span class="ident" id="6296524">i</span><span class="op" id="6296525">+</span><span class="num" id="6296526">1</span><span class="op" id="6296527">]</span>&nbsp;<span class="op" id="6296529">==</span>&nbsp;<span class="string" id="6296532">&#39;K&#39;</span>&nbsp;<span class="op" id="6296536">&amp;&amp;</span>&nbsp;<span class="ident" id="6296539">b</span><span class="op" id="6296540">[</span><span class="ident" id="6296541">i</span><span class="op" id="6296542">+</span><span class="num" id="6296543">2</span><span class="op" id="6296544">]</span>&nbsp;<span class="op" id="6296546">==</span>&nbsp;<span class="num" id="6296549">0x05</span>&nbsp;<span class="op" id="6296554">&amp;&amp;</span>&nbsp;<span class="ident" id="6296557">b</span><span class="op" id="6296558">[</span><span class="ident" id="6296559">i</span><span class="op" id="6296560">+</span><span class="num" id="6296561">3</span><span class="op" id="6296562">]</span>&nbsp;<span class="op" id="6296564">==</span>&nbsp;<span class="num" id="6296567">0x06</span>&nbsp;<span class="op" id="6296572">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6296577">//&nbsp;n&nbsp;is&nbsp;length&nbsp;of&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6296606">n</span>&nbsp;<span class="op" id="6296608">:=</span>&nbsp;<span class="builtintype" id="6296611">int</span><span class="op" id="6296614">(</span><span class="ident" id="6296615">b</span><span class="op" id="6296616">[</span><span class="ident" id="6296617">i</span><span class="op" id="6296618">+</span><span class="ident" id="6296619">directoryEndLen</span><span class="op" id="6296634">-</span><span class="num" id="6296635">2</span><span class="op" id="6296636">]</span><span class="op" id="6296637">)</span>&nbsp;<span class="op" id="6296639">|</span>&nbsp;<span class="builtintype" id="6296641">int</span><span class="op" id="6296644">(</span><span class="ident" id="6296645">b</span><span class="op" id="6296646">[</span><span class="ident" id="6296647">i</span><span class="op" id="6296648">+</span><span class="ident" id="6296649">directoryEndLen</span><span class="op" id="6296664">-</span><span class="num" id="6296665">1</span><span class="op" id="6296666">]</span><span class="op" id="6296667">)</span><span class="op" id="6296668">&lt;&lt;</span><span class="num" id="6296670">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6296675">if</span>&nbsp;<span class="ident" id="6296678">n</span><span class="op" id="6296679">+</span><span class="ident" id="6296680">directoryEndLen</span><span class="op" id="6296695">+</span><span class="ident" id="6296696">i</span>&nbsp;<span class="op" id="6296698">&lt;=</span>&nbsp;<span class="builtinfunc" id="6296701">len</span><span class="op" id="6296704">(</span><span class="ident" id="6296705">b</span><span class="op" id="6296706">)</span>&nbsp;<span class="op" id="6296708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6296714">return</span>&nbsp;<span class="ident" id="6296721">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6296726">}</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6296730">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6296733">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6296736">return</span>&nbsp;<span class="op" id="6296743">-</span><span class="num" id="6296744">1</span><br>
<span class="lineno"></span><span class="op" id="6296746">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span><span class="keyword" id="6296749">type</span>&nbsp;<span class="ident" id="6296754">readBuf</span>&nbsp;<span class="op" id="6296762">[</span><span class="op" id="6296763">]</span><span class="builtintype" id="6296764">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6296770">func</span>&nbsp;<span class="op" id="6296775">(</span><span class="ident" id="6296776">b</span>&nbsp;<span class="op" id="6296778">*</span><span class="ident" id="6296779">readBuf</span><span class="op" id="6296786">)</span>&nbsp;<span class="builtintype" id="6296788">uint16</span><span class="op" id="6296794">(</span><span class="op" id="6296795">)</span>&nbsp;<span class="builtintype" id="6296797">uint16</span>&nbsp;<span class="op" id="6296804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6296807">v</span>&nbsp;<span class="op" id="6296809">:=</span>&nbsp;<span class="ident" id="6296812">binary</span><span class="op" id="6296818">.</span><span class="ident" id="6296819">LittleEndian</span><span class="op" id="6296831">.</span><span class="ident" id="6296832">Uint16</span><span class="op" id="6296838">(</span><span class="op" id="6296839">*</span><span class="ident" id="6296840">b</span><span class="op" id="6296841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6296844">*</span><span class="ident" id="6296845">b</span>&nbsp;<span class="op" id="6296847">=</span>&nbsp;<span class="op" id="6296849">(</span><span class="op" id="6296850">*</span><span class="ident" id="6296851">b</span><span class="op" id="6296852">)</span><span class="op" id="6296853">[</span><span class="num" id="6296854">2</span><span class="op" id="6296855">:</span><span class="op" id="6296856">]</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6296859">return</span>&nbsp;<span class="ident" id="6296866">v</span><br>
<span class="lineno"></span><span class="op" id="6296868">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6296871">func</span>&nbsp;<span class="op" id="6296876">(</span><span class="ident" id="6296877">b</span>&nbsp;<span class="op" id="6296879">*</span><span class="ident" id="6296880">readBuf</span><span class="op" id="6296887">)</span>&nbsp;<span class="builtintype" id="6296889">uint32</span><span class="op" id="6296895">(</span><span class="op" id="6296896">)</span>&nbsp;<span class="builtintype" id="6296898">uint32</span>&nbsp;<span class="op" id="6296905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6296908">v</span>&nbsp;<span class="op" id="6296910">:=</span>&nbsp;<span class="ident" id="6296913">binary</span><span class="op" id="6296919">.</span><span class="ident" id="6296920">LittleEndian</span><span class="op" id="6296932">.</span><span class="ident" id="6296933">Uint32</span><span class="op" id="6296939">(</span><span class="op" id="6296940">*</span><span class="ident" id="6296941">b</span><span class="op" id="6296942">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6296945">*</span><span class="ident" id="6296946">b</span>&nbsp;<span class="op" id="6296948">=</span>&nbsp;<span class="op" id="6296950">(</span><span class="op" id="6296951">*</span><span class="ident" id="6296952">b</span><span class="op" id="6296953">)</span><span class="op" id="6296954">[</span><span class="num" id="6296955">4</span><span class="op" id="6296956">:</span><span class="op" id="6296957">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6296960">return</span>&nbsp;<span class="ident" id="6296967">v</span><br>
<span class="lineno"></span><span class="op" id="6296969">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6296972">func</span>&nbsp;<span class="op" id="6296977">(</span><span class="ident" id="6296978">b</span>&nbsp;<span class="op" id="6296980">*</span><span class="ident" id="6296981">readBuf</span><span class="op" id="6296988">)</span>&nbsp;<span class="ident" id="6296990">uint64</span><span class="op" id="6296996">(</span><span class="op" id="6296997">)</span>&nbsp;<span class="ident" id="6296999">uint64</span>&nbsp;<span class="op" id="6297006">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297009">v</span>&nbsp;<span class="op" id="6297011">:=</span>&nbsp;<span class="ident" id="6297014">binary</span><span class="op" id="6297020">.</span><span class="ident" id="6297021">LittleEndian</span><span class="op" id="6297033">.</span><span class="ident" id="6297034">Uint64</span><span class="op" id="6297040">(</span><span class="op" id="6297041">*</span><span class="ident" id="6297042">b</span><span class="op" id="6297043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6297046">*</span><span class="ident" id="6297047">b</span>&nbsp;<span class="op" id="6297049">=</span>&nbsp;<span class="op" id="6297051">(</span><span class="op" id="6297052">*</span><span class="ident" id="6297053">b</span><span class="op" id="6297054">)</span><span class="op" id="6297055">[</span><span class="num" id="6297056">8</span><span class="op" id="6297057">:</span><span class="op" id="6297058">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6297061">return</span>&nbsp;<span class="ident" id="6297068">v</span><br>
<span class="lineno"></span><span class="op" id="6297070">}</span>
</div>
</body>
</html>
