<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/httptest</h2>
<ul>
<li><a href="/gostd/net/http/httptest/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/http/httptest/recorder.go.html">recorder.go</a></li>
<li><a href="/gostd/net/http/httptest/recorder_test.go.html">recorder_test.go</a></li>
<li><a href="/gostd/net/http/httptest/server.go.html">server.go</a></li>
<li><a href="/gostd/net/http/httptest/server_test.go.html">server_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5460347">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5460402">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5460456">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5460507">//&nbsp;Package&nbsp;httptest&nbsp;provides&nbsp;utilities&nbsp;for&nbsp;HTTP&nbsp;testing.</span><br>
<span class="lineno"></span><span class="keyword" id="5460564">package</span>&nbsp;<span class="ident" id="5460572">httptest</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5460582">import</span>&nbsp;<span class="op" id="5460589">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5460592">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5460601">&#34;net/http&#34;</span><br>
<span class="lineno"></span><span class="op" id="5460612">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5460615">//&nbsp;ResponseRecorder&nbsp;is&nbsp;an&nbsp;implementation&nbsp;of&nbsp;http.ResponseWriter&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="5460684">//&nbsp;records&nbsp;its&nbsp;mutations&nbsp;for&nbsp;later&nbsp;inspection&nbsp;in&nbsp;tests.</span><br>
<span class="lineno">15</span><span class="keyword" id="5460740">type</span>&nbsp;<span class="ident" id="5460745">ResponseRecorder</span>&nbsp;<span class="keyword" id="5460762">struct</span>&nbsp;<span class="op" id="5460769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5460772">Code</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5460782">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5460796">//&nbsp;the&nbsp;HTTP&nbsp;response&nbsp;code&nbsp;from&nbsp;WriteHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5460840">HeaderMap</span>&nbsp;<span class="ident" id="5460850">http</span><span class="op" id="5460854">.</span><span class="ident" id="5460855">Header</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5460864">//&nbsp;the&nbsp;HTTP&nbsp;response&nbsp;headers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5460894">Body</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5460904">*</span><span class="ident" id="5460905">bytes</span><span class="op" id="5460910">.</span><span class="ident" id="5460911">Buffer</span>&nbsp;<span class="comment" id="5460918">//&nbsp;if&nbsp;non-nil,&nbsp;the&nbsp;bytes.Buffer&nbsp;to&nbsp;append&nbsp;written&nbsp;data&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5460977">Flushed</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5460987">bool</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5460994">wroteHeader</span>&nbsp;<span class="builtintype" id="5461006">bool</span><br>
<span class="lineno"></span><span class="op" id="5461011">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5461014">//&nbsp;NewRecorder&nbsp;returns&nbsp;an&nbsp;initialized&nbsp;ResponseRecorder.</span><br>
<span class="lineno">25</span><span class="keyword" id="5461070">func</span>&nbsp;<span class="ident" id="5461075">NewRecorder</span><span class="op" id="5461086">(</span><span class="op" id="5461087">)</span>&nbsp;<span class="op" id="5461089">*</span><span class="ident" id="5461090">ResponseRecorder</span>&nbsp;<span class="op" id="5461107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5461110">return</span>&nbsp;<span class="op" id="5461117">&amp;</span><span class="ident" id="5461118">ResponseRecorder</span><span class="op" id="5461134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5461138">HeaderMap</span><span class="op" id="5461147">:</span>&nbsp;<span class="builtinfunc" id="5461149">make</span><span class="op" id="5461153">(</span><span class="ident" id="5461154">http</span><span class="op" id="5461158">.</span><span class="ident" id="5461159">Header</span><span class="op" id="5461165">)</span><span class="op" id="5461166">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5461170">Body</span><span class="op" id="5461174">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5461181">new</span><span class="op" id="5461184">(</span><span class="ident" id="5461185">bytes</span><span class="op" id="5461190">.</span><span class="ident" id="5461191">Buffer</span><span class="op" id="5461197">)</span><span class="op" id="5461198">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5461202">Code</span><span class="op" id="5461206">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5461213">200</span><span class="op" id="5461216">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5461219">}</span><br>
<span class="lineno"></span><span class="op" id="5461221">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5461224">//&nbsp;DefaultRemoteAddr&nbsp;is&nbsp;the&nbsp;default&nbsp;remote&nbsp;address&nbsp;to&nbsp;return&nbsp;in&nbsp;RemoteAddr&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="5461302">//&nbsp;an&nbsp;explicit&nbsp;DefaultRemoteAddr&nbsp;isn&#39;t&nbsp;set&nbsp;on&nbsp;ResponseRecorder.</span><br>
<span class="lineno">35</span><span class="keyword" id="5461366">const</span>&nbsp;<span class="ident" id="5461372">DefaultRemoteAddr</span>&nbsp;<span class="op" id="5461390">=</span>&nbsp;<span class="string" id="5461392">&#34;1.2.3.4&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5461403">//&nbsp;Header&nbsp;returns&nbsp;the&nbsp;response&nbsp;headers.</span><br>
<span class="lineno"></span><span class="keyword" id="5461443">func</span>&nbsp;<span class="op" id="5461448">(</span><span class="ident" id="5461449">rw</span>&nbsp;<span class="op" id="5461452">*</span><span class="ident" id="5461453">ResponseRecorder</span><span class="op" id="5461469">)</span>&nbsp;<span class="ident" id="5461471">Header</span><span class="op" id="5461477">(</span><span class="op" id="5461478">)</span>&nbsp;<span class="ident" id="5461480">http</span><span class="op" id="5461484">.</span><span class="ident" id="5461485">Header</span>&nbsp;<span class="op" id="5461492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5461495">m</span>&nbsp;<span class="op" id="5461497">:=</span>&nbsp;<span class="ident" id="5461500">rw</span><span class="op" id="5461502">.</span><span class="ident" id="5461503">HeaderMap</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5461514">if</span>&nbsp;<span class="ident" id="5461517">m</span>&nbsp;<span class="op" id="5461519">==</span>&nbsp;<span class="ident" id="5461522">nil</span>&nbsp;<span class="op" id="5461526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5461530">m</span>&nbsp;<span class="op" id="5461532">=</span>&nbsp;<span class="builtinfunc" id="5461534">make</span><span class="op" id="5461538">(</span><span class="ident" id="5461539">http</span><span class="op" id="5461543">.</span><span class="ident" id="5461544">Header</span><span class="op" id="5461550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5461554">rw</span><span class="op" id="5461556">.</span><span class="ident" id="5461557">HeaderMap</span>&nbsp;<span class="op" id="5461567">=</span>&nbsp;<span class="ident" id="5461569">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5461572">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5461575">return</span>&nbsp;<span class="ident" id="5461582">m</span><br>
<span class="lineno">45</span><span class="op" id="5461584">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5461587">//&nbsp;Write&nbsp;always&nbsp;succeeds&nbsp;and&nbsp;writes&nbsp;to&nbsp;rw.Body,&nbsp;if&nbsp;not&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="5461647">func</span>&nbsp;<span class="op" id="5461652">(</span><span class="ident" id="5461653">rw</span>&nbsp;<span class="op" id="5461656">*</span><span class="ident" id="5461657">ResponseRecorder</span><span class="op" id="5461673">)</span>&nbsp;<span class="ident" id="5461675">Write</span><span class="op" id="5461680">(</span><span class="ident" id="5461681">buf</span>&nbsp;<span class="op" id="5461685">[</span><span class="op" id="5461686">]</span><span class="builtintype" id="5461687">byte</span><span class="op" id="5461691">)</span>&nbsp;<span class="op" id="5461693">(</span><span class="builtintype" id="5461694">int</span><span class="op" id="5461697">,</span>&nbsp;<span class="builtintype" id="5461699">error</span><span class="op" id="5461704">)</span>&nbsp;<span class="op" id="5461706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5461709">if</span>&nbsp;<span class="op" id="5461712">!</span><span class="ident" id="5461713">rw</span><span class="op" id="5461715">.</span><span class="ident" id="5461716">wroteHeader</span>&nbsp;<span class="op" id="5461728">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5461732">rw</span><span class="op" id="5461734">.</span><span class="ident" id="5461735">WriteHeader</span><span class="op" id="5461746">(</span><span class="num" id="5461747">200</span><span class="op" id="5461750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5461753">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5461756">if</span>&nbsp;<span class="ident" id="5461759">rw</span><span class="op" id="5461761">.</span><span class="ident" id="5461762">Body</span>&nbsp;<span class="op" id="5461767">!=</span>&nbsp;<span class="ident" id="5461770">nil</span>&nbsp;<span class="op" id="5461774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5461778">rw</span><span class="op" id="5461780">.</span><span class="ident" id="5461781">Body</span><span class="op" id="5461785">.</span><span class="ident" id="5461786">Write</span><span class="op" id="5461791">(</span><span class="ident" id="5461792">buf</span><span class="op" id="5461795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5461798">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5461801">return</span>&nbsp;<span class="builtinfunc" id="5461808">len</span><span class="op" id="5461811">(</span><span class="ident" id="5461812">buf</span><span class="op" id="5461815">)</span><span class="op" id="5461816">,</span>&nbsp;<span class="ident" id="5461818">nil</span><br>
<span class="lineno"></span><span class="op" id="5461822">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5461825">//&nbsp;WriteHeader&nbsp;sets&nbsp;rw.Code.</span><br>
<span class="lineno"></span><span class="keyword" id="5461854">func</span>&nbsp;<span class="op" id="5461859">(</span><span class="ident" id="5461860">rw</span>&nbsp;<span class="op" id="5461863">*</span><span class="ident" id="5461864">ResponseRecorder</span><span class="op" id="5461880">)</span>&nbsp;<span class="ident" id="5461882">WriteHeader</span><span class="op" id="5461893">(</span><span class="ident" id="5461894">code</span>&nbsp;<span class="builtintype" id="5461899">int</span><span class="op" id="5461902">)</span>&nbsp;<span class="op" id="5461904">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5461907">if</span>&nbsp;<span class="op" id="5461910">!</span><span class="ident" id="5461911">rw</span><span class="op" id="5461913">.</span><span class="ident" id="5461914">wroteHeader</span>&nbsp;<span class="op" id="5461926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5461930">rw</span><span class="op" id="5461932">.</span><span class="ident" id="5461933">Code</span>&nbsp;<span class="op" id="5461938">=</span>&nbsp;<span class="ident" id="5461940">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5461946">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5461949">rw</span><span class="op" id="5461951">.</span><span class="ident" id="5461952">wroteHeader</span>&nbsp;<span class="op" id="5461964">=</span>&nbsp;<span class="builtintype" id="5461966">true</span><br>
<span class="lineno"></span><span class="op" id="5461971">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="comment" id="5461974">//&nbsp;Flush&nbsp;sets&nbsp;rw.Flushed&nbsp;to&nbsp;true.</span><br>
<span class="lineno"></span><span class="keyword" id="5462008">func</span>&nbsp;<span class="op" id="5462013">(</span><span class="ident" id="5462014">rw</span>&nbsp;<span class="op" id="5462017">*</span><span class="ident" id="5462018">ResponseRecorder</span><span class="op" id="5462034">)</span>&nbsp;<span class="ident" id="5462036">Flush</span><span class="op" id="5462041">(</span><span class="op" id="5462042">)</span>&nbsp;<span class="op" id="5462044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5462047">if</span>&nbsp;<span class="op" id="5462050">!</span><span class="ident" id="5462051">rw</span><span class="op" id="5462053">.</span><span class="ident" id="5462054">wroteHeader</span>&nbsp;<span class="op" id="5462066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5462070">rw</span><span class="op" id="5462072">.</span><span class="ident" id="5462073">WriteHeader</span><span class="op" id="5462084">(</span><span class="num" id="5462085">200</span><span class="op" id="5462088">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5462091">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5462094">rw</span><span class="op" id="5462096">.</span><span class="ident" id="5462097">Flushed</span>&nbsp;<span class="op" id="5462105">=</span>&nbsp;<span class="builtintype" id="5462107">true</span><br>
<span class="lineno"></span><span class="op" id="5462112">}</span>
</div>
</body>
</html>
