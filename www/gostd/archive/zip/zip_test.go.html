<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/zip</h2>
<ul>
<li><a href="/gostd/archive/zip/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/zip/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/zip/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/zip/register.go.html">register.go</a></li>
<li><a href="/gostd/archive/zip/struct.go.html">struct.go</a></li>
<li><a href="/gostd/archive/zip/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/zip/writer_test.go.html">writer_test.go</a></li>
<li><a href="/gostd/archive/zip/zip_test.go.html" class="current">zip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6458984">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6459039">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6459093">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6459144">//&nbsp;Tests&nbsp;that&nbsp;involve&nbsp;both&nbsp;reading&nbsp;and&nbsp;writing.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6459193">package</span>&nbsp;<span class="ident" id="6459201">zip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6459206">import</span>&nbsp;<span class="op" id="6459213">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6459216">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6459225">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6459232">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6459240">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6459246">&#34;io/ioutil&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6459259">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6459267">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6459278">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6459289">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6459296">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="6459299">func</span>&nbsp;<span class="ident" id="6459304">TestOver65kFiles</span><span class="op" id="6459320">(</span><span class="ident" id="6459321">t</span>&nbsp;<span class="op" id="6459323">*</span><span class="ident" id="6459324">testing</span><span class="op" id="6459331">.</span><span class="ident" id="6459332">T</span><span class="op" id="6459333">)</span>&nbsp;<span class="op" id="6459335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6459338">buf</span>&nbsp;<span class="op" id="6459342">:=</span>&nbsp;<span class="builtinfunc" id="6459345">new</span><span class="op" id="6459348">(</span><span class="ident" id="6459349">bytes</span><span class="op" id="6459354">.</span><span class="ident" id="6459355">Buffer</span><span class="op" id="6459361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6459364">w</span>&nbsp;<span class="op" id="6459366">:=</span>&nbsp;<span class="ident" id="6459369">NewWriter</span><span class="op" id="6459378">(</span><span class="ident" id="6459379">buf</span><span class="op" id="6459382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6459385">const</span>&nbsp;<span class="ident" id="6459391">nFiles</span>&nbsp;<span class="op" id="6459398">=</span>&nbsp;<span class="op" id="6459400">(</span><span class="num" id="6459401">1</span>&nbsp;<span class="op" id="6459403">&lt;&lt;</span>&nbsp;<span class="num" id="6459406">16</span><span class="op" id="6459408">)</span>&nbsp;<span class="op" id="6459410">+</span>&nbsp;<span class="num" id="6459412">42</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6459416">for</span>&nbsp;<span class="ident" id="6459420">i</span>&nbsp;<span class="op" id="6459422">:=</span>&nbsp;<span class="num" id="6459425">0</span><span class="op" id="6459426">;</span>&nbsp;<span class="ident" id="6459428">i</span>&nbsp;<span class="op" id="6459430">&lt;</span>&nbsp;<span class="ident" id="6459432">nFiles</span><span class="op" id="6459438">;</span>&nbsp;<span class="ident" id="6459440">i</span><span class="op" id="6459441">++</span>&nbsp;<span class="op" id="6459444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6459448">_</span><span class="op" id="6459449">,</span>&nbsp;<span class="ident" id="6459451">err</span>&nbsp;<span class="op" id="6459455">:=</span>&nbsp;<span class="ident" id="6459458">w</span><span class="op" id="6459459">.</span><span class="ident" id="6459460">CreateHeader</span><span class="op" id="6459472">(</span><span class="op" id="6459473">&amp;</span><span class="ident" id="6459474">FileHeader</span><span class="op" id="6459484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6459489">Name</span><span class="op" id="6459493">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6459497">fmt</span><span class="op" id="6459500">.</span><span class="ident" id="6459501">Sprintf</span><span class="op" id="6459508">(</span><span class="string" id="6459509">&#34;%d.dat&#34;</span><span class="op" id="6459517">,</span>&nbsp;<span class="ident" id="6459519">i</span><span class="op" id="6459520">)</span><span class="op" id="6459521">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6459526">Method</span><span class="op" id="6459532">:</span>&nbsp;<span class="ident" id="6459534">Store</span><span class="op" id="6459539">,</span>&nbsp;<span class="comment" id="6459541">//&nbsp;avoid&nbsp;Issue&nbsp;6136&nbsp;and&nbsp;Issue&nbsp;6138</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6459578">}</span><span class="op" id="6459579">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6459583">if</span>&nbsp;<span class="ident" id="6459586">err</span>&nbsp;<span class="op" id="6459590">!=</span>&nbsp;<span class="builtintype" id="6459593">nil</span>&nbsp;<span class="op" id="6459597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6459602">t</span><span class="op" id="6459603">.</span><span class="ident" id="6459604">Fatalf</span><span class="op" id="6459610">(</span><span class="string" id="6459611">&#34;creating&nbsp;file&nbsp;%d:&nbsp;%v&#34;</span><span class="op" id="6459633">,</span>&nbsp;<span class="ident" id="6459635">i</span><span class="op" id="6459636">,</span>&nbsp;<span class="ident" id="6459638">err</span><span class="op" id="6459641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6459645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6459648">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6459651">if</span>&nbsp;<span class="ident" id="6459654">err</span>&nbsp;<span class="op" id="6459658">:=</span>&nbsp;<span class="ident" id="6459661">w</span><span class="op" id="6459662">.</span><span class="ident" id="6459663">Close</span><span class="op" id="6459668">(</span><span class="op" id="6459669">)</span><span class="op" id="6459670">;</span>&nbsp;<span class="ident" id="6459672">err</span>&nbsp;<span class="op" id="6459676">!=</span>&nbsp;<span class="builtintype" id="6459679">nil</span>&nbsp;<span class="op" id="6459683">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6459687">t</span><span class="op" id="6459688">.</span><span class="ident" id="6459689">Fatalf</span><span class="op" id="6459695">(</span><span class="string" id="6459696">&#34;Writer.Close:&nbsp;%v&#34;</span><span class="op" id="6459714">,</span>&nbsp;<span class="ident" id="6459716">err</span><span class="op" id="6459719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6459722">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6459725">s</span>&nbsp;<span class="op" id="6459727">:=</span>&nbsp;<span class="ident" id="6459730">buf</span><span class="op" id="6459733">.</span><span class="ident" id="6459734">String</span><span class="op" id="6459740">(</span><span class="op" id="6459741">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6459744">zr</span><span class="op" id="6459746">,</span>&nbsp;<span class="ident" id="6459748">err</span>&nbsp;<span class="op" id="6459752">:=</span>&nbsp;<span class="ident" id="6459755">NewReader</span><span class="op" id="6459764">(</span><span class="ident" id="6459765">strings</span><span class="op" id="6459772">.</span><span class="ident" id="6459773">NewReader</span><span class="op" id="6459782">(</span><span class="ident" id="6459783">s</span><span class="op" id="6459784">)</span><span class="op" id="6459785">,</span>&nbsp;<span class="ident" id="6459787">int64</span><span class="op" id="6459792">(</span><span class="builtinfunc" id="6459793">len</span><span class="op" id="6459796">(</span><span class="ident" id="6459797">s</span><span class="op" id="6459798">)</span><span class="op" id="6459799">)</span><span class="op" id="6459800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6459803">if</span>&nbsp;<span class="ident" id="6459806">err</span>&nbsp;<span class="op" id="6459810">!=</span>&nbsp;<span class="builtintype" id="6459813">nil</span>&nbsp;<span class="op" id="6459817">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6459821">t</span><span class="op" id="6459822">.</span><span class="ident" id="6459823">Fatalf</span><span class="op" id="6459829">(</span><span class="string" id="6459830">&#34;NewReader:&nbsp;%v&#34;</span><span class="op" id="6459845">,</span>&nbsp;<span class="ident" id="6459847">err</span><span class="op" id="6459850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6459853">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6459856">if</span>&nbsp;<span class="ident" id="6459859">got</span>&nbsp;<span class="op" id="6459863">:=</span>&nbsp;<span class="builtinfunc" id="6459866">len</span><span class="op" id="6459869">(</span><span class="ident" id="6459870">zr</span><span class="op" id="6459872">.</span><span class="ident" id="6459873">File</span><span class="op" id="6459877">)</span><span class="op" id="6459878">;</span>&nbsp;<span class="ident" id="6459880">got</span>&nbsp;<span class="op" id="6459884">!=</span>&nbsp;<span class="ident" id="6459887">nFiles</span>&nbsp;<span class="op" id="6459894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6459898">t</span><span class="op" id="6459899">.</span><span class="ident" id="6459900">Fatalf</span><span class="op" id="6459906">(</span><span class="string" id="6459907">&#34;File&nbsp;contains&nbsp;%d&nbsp;files,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="6459940">,</span>&nbsp;<span class="ident" id="6459942">got</span><span class="op" id="6459945">,</span>&nbsp;<span class="ident" id="6459947">nFiles</span><span class="op" id="6459953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6459956">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6459959">for</span>&nbsp;<span class="ident" id="6459963">i</span>&nbsp;<span class="op" id="6459965">:=</span>&nbsp;<span class="num" id="6459968">0</span><span class="op" id="6459969">;</span>&nbsp;<span class="ident" id="6459971">i</span>&nbsp;<span class="op" id="6459973">&lt;</span>&nbsp;<span class="ident" id="6459975">nFiles</span><span class="op" id="6459981">;</span>&nbsp;<span class="ident" id="6459983">i</span><span class="op" id="6459984">++</span>&nbsp;<span class="op" id="6459987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6459991">want</span>&nbsp;<span class="op" id="6459996">:=</span>&nbsp;<span class="ident" id="6459999">fmt</span><span class="op" id="6460002">.</span><span class="ident" id="6460003">Sprintf</span><span class="op" id="6460010">(</span><span class="string" id="6460011">&#34;%d.dat&#34;</span><span class="op" id="6460019">,</span>&nbsp;<span class="ident" id="6460021">i</span><span class="op" id="6460022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6460026">if</span>&nbsp;<span class="ident" id="6460029">zr</span><span class="op" id="6460031">.</span><span class="ident" id="6460032">File</span><span class="op" id="6460036">[</span><span class="ident" id="6460037">i</span><span class="op" id="6460038">]</span><span class="op" id="6460039">.</span><span class="ident" id="6460040">Name</span>&nbsp;<span class="op" id="6460045">!=</span>&nbsp;<span class="ident" id="6460048">want</span>&nbsp;<span class="op" id="6460053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6460058">t</span><span class="op" id="6460059">.</span><span class="ident" id="6460060">Fatalf</span><span class="op" id="6460066">(</span><span class="string" id="6460067">&#34;File(%d)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6460091">,</span>&nbsp;<span class="ident" id="6460093">i</span><span class="op" id="6460094">,</span>&nbsp;<span class="ident" id="6460096">zr</span><span class="op" id="6460098">.</span><span class="ident" id="6460099">File</span><span class="op" id="6460103">[</span><span class="ident" id="6460104">i</span><span class="op" id="6460105">]</span><span class="op" id="6460106">.</span><span class="ident" id="6460107">Name</span><span class="op" id="6460111">,</span>&nbsp;<span class="ident" id="6460113">want</span><span class="op" id="6460117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6460121">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6460124">}</span><br>
<span class="lineno"></span><span class="op" id="6460126">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6460129">func</span>&nbsp;<span class="ident" id="6460134">TestModTime</span><span class="op" id="6460145">(</span><span class="ident" id="6460146">t</span>&nbsp;<span class="op" id="6460148">*</span><span class="ident" id="6460149">testing</span><span class="op" id="6460156">.</span><span class="ident" id="6460157">T</span><span class="op" id="6460158">)</span>&nbsp;<span class="op" id="6460160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6460163">var</span>&nbsp;<span class="ident" id="6460167">testTime</span>&nbsp;<span class="op" id="6460176">=</span>&nbsp;<span class="ident" id="6460178">time</span><span class="op" id="6460182">.</span><span class="ident" id="6460183">Date</span><span class="op" id="6460187">(</span><span class="num" id="6460188">2009</span><span class="op" id="6460192">,</span>&nbsp;<span class="ident" id="6460194">time</span><span class="op" id="6460198">.</span><span class="ident" id="6460199">November</span><span class="op" id="6460207">,</span>&nbsp;<span class="num" id="6460209">10</span><span class="op" id="6460211">,</span>&nbsp;<span class="num" id="6460213">23</span><span class="op" id="6460215">,</span>&nbsp;<span class="num" id="6460217">45</span><span class="op" id="6460219">,</span>&nbsp;<span class="num" id="6460221">58</span><span class="op" id="6460223">,</span>&nbsp;<span class="num" id="6460225">0</span><span class="op" id="6460226">,</span>&nbsp;<span class="ident" id="6460228">time</span><span class="op" id="6460232">.</span><span class="ident" id="6460233">UTC</span><span class="op" id="6460236">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6460239">fh</span>&nbsp;<span class="op" id="6460242">:=</span>&nbsp;<span class="builtinfunc" id="6460245">new</span><span class="op" id="6460248">(</span><span class="ident" id="6460249">FileHeader</span><span class="op" id="6460259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6460262">fh</span><span class="op" id="6460264">.</span><span class="ident" id="6460265">SetModTime</span><span class="op" id="6460275">(</span><span class="ident" id="6460276">testTime</span><span class="op" id="6460284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6460287">outTime</span>&nbsp;<span class="op" id="6460295">:=</span>&nbsp;<span class="ident" id="6460298">fh</span><span class="op" id="6460300">.</span><span class="ident" id="6460301">ModTime</span><span class="op" id="6460308">(</span><span class="op" id="6460309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6460312">if</span>&nbsp;<span class="op" id="6460315">!</span><span class="ident" id="6460316">outTime</span><span class="op" id="6460323">.</span><span class="ident" id="6460324">Equal</span><span class="op" id="6460329">(</span><span class="ident" id="6460330">testTime</span><span class="op" id="6460338">)</span>&nbsp;<span class="op" id="6460340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6460344">t</span><span class="op" id="6460345">.</span><span class="ident" id="6460346">Errorf</span><span class="op" id="6460352">(</span><span class="string" id="6460353">&#34;times&nbsp;don&#39;t&nbsp;match:&nbsp;got&nbsp;%s,&nbsp;want&nbsp;%s&#34;</span><span class="op" id="6460389">,</span>&nbsp;<span class="ident" id="6460391">outTime</span><span class="op" id="6460398">,</span>&nbsp;<span class="ident" id="6460400">testTime</span><span class="op" id="6460408">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6460411">}</span><br>
<span class="lineno"></span><span class="op" id="6460413">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6460416">func</span>&nbsp;<span class="ident" id="6460421">testHeaderRoundTrip</span><span class="op" id="6460440">(</span><span class="ident" id="6460441">fh</span>&nbsp;<span class="op" id="6460444">*</span><span class="ident" id="6460445">FileHeader</span><span class="op" id="6460455">,</span>&nbsp;<span class="ident" id="6460457">wantUncompressedSize</span>&nbsp;<span class="builtintype" id="6460478">uint32</span><span class="op" id="6460484">,</span>&nbsp;<span class="ident" id="6460486">wantUncompressedSize64</span>&nbsp;<span class="ident" id="6460509">uint64</span><span class="op" id="6460515">,</span>&nbsp;<span class="ident" id="6460517">t</span>&nbsp;<span class="op" id="6460519">*</span><span class="ident" id="6460520">testing</span><span class="op" id="6460527">.</span><span class="ident" id="6460528">T</span><span class="op" id="6460529">)</span>&nbsp;<span class="op" id="6460531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6460534">fi</span>&nbsp;<span class="op" id="6460537">:=</span>&nbsp;<span class="ident" id="6460540">fh</span><span class="op" id="6460542">.</span><span class="ident" id="6460543">FileInfo</span><span class="op" id="6460551">(</span><span class="op" id="6460552">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6460555">fh2</span><span class="op" id="6460558">,</span>&nbsp;<span class="ident" id="6460560">err</span>&nbsp;<span class="op" id="6460564">:=</span>&nbsp;<span class="ident" id="6460567">FileInfoHeader</span><span class="op" id="6460581">(</span><span class="ident" id="6460582">fi</span><span class="op" id="6460584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6460587">if</span>&nbsp;<span class="ident" id="6460590">err</span>&nbsp;<span class="op" id="6460594">!=</span>&nbsp;<span class="builtintype" id="6460597">nil</span>&nbsp;<span class="op" id="6460601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6460605">t</span><span class="op" id="6460606">.</span><span class="ident" id="6460607">Fatal</span><span class="op" id="6460612">(</span><span class="ident" id="6460613">err</span><span class="op" id="6460616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6460619">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6460622">if</span>&nbsp;<span class="ident" id="6460625">got</span><span class="op" id="6460628">,</span>&nbsp;<span class="ident" id="6460630">want</span>&nbsp;<span class="op" id="6460635">:=</span>&nbsp;<span class="ident" id="6460638">fh2</span><span class="op" id="6460641">.</span><span class="ident" id="6460642">Name</span><span class="op" id="6460646">,</span>&nbsp;<span class="ident" id="6460648">fh</span><span class="op" id="6460650">.</span><span class="ident" id="6460651">Name</span><span class="op" id="6460655">;</span>&nbsp;<span class="ident" id="6460657">got</span>&nbsp;<span class="op" id="6460661">!=</span>&nbsp;<span class="ident" id="6460664">want</span>&nbsp;<span class="op" id="6460669">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6460673">t</span><span class="op" id="6460674">.</span><span class="ident" id="6460675">Errorf</span><span class="op" id="6460681">(</span><span class="string" id="6460682">&#34;Name:&nbsp;got&nbsp;%s,&nbsp;want&nbsp;%s\n&#34;</span><span class="op" id="6460707">,</span>&nbsp;<span class="ident" id="6460709">got</span><span class="op" id="6460712">,</span>&nbsp;<span class="ident" id="6460714">want</span><span class="op" id="6460718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6460721">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6460724">if</span>&nbsp;<span class="ident" id="6460727">got</span><span class="op" id="6460730">,</span>&nbsp;<span class="ident" id="6460732">want</span>&nbsp;<span class="op" id="6460737">:=</span>&nbsp;<span class="ident" id="6460740">fh2</span><span class="op" id="6460743">.</span><span class="ident" id="6460744">UncompressedSize</span><span class="op" id="6460760">,</span>&nbsp;<span class="ident" id="6460762">wantUncompressedSize</span><span class="op" id="6460782">;</span>&nbsp;<span class="ident" id="6460784">got</span>&nbsp;<span class="op" id="6460788">!=</span>&nbsp;<span class="ident" id="6460791">want</span>&nbsp;<span class="op" id="6460796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6460800">t</span><span class="op" id="6460801">.</span><span class="ident" id="6460802">Errorf</span><span class="op" id="6460808">(</span><span class="string" id="6460809">&#34;UncompressedSize:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d\n&#34;</span><span class="op" id="6460846">,</span>&nbsp;<span class="ident" id="6460848">got</span><span class="op" id="6460851">,</span>&nbsp;<span class="ident" id="6460853">want</span><span class="op" id="6460857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6460860">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6460863">if</span>&nbsp;<span class="ident" id="6460866">got</span><span class="op" id="6460869">,</span>&nbsp;<span class="ident" id="6460871">want</span>&nbsp;<span class="op" id="6460876">:=</span>&nbsp;<span class="ident" id="6460879">fh2</span><span class="op" id="6460882">.</span><span class="ident" id="6460883">UncompressedSize64</span><span class="op" id="6460901">,</span>&nbsp;<span class="ident" id="6460903">wantUncompressedSize64</span><span class="op" id="6460925">;</span>&nbsp;<span class="ident" id="6460927">got</span>&nbsp;<span class="op" id="6460931">!=</span>&nbsp;<span class="ident" id="6460934">want</span>&nbsp;<span class="op" id="6460939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6460943">t</span><span class="op" id="6460944">.</span><span class="ident" id="6460945">Errorf</span><span class="op" id="6460951">(</span><span class="string" id="6460952">&#34;UncompressedSize64:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d\n&#34;</span><span class="op" id="6460991">,</span>&nbsp;<span class="ident" id="6460993">got</span><span class="op" id="6460996">,</span>&nbsp;<span class="ident" id="6460998">want</span><span class="op" id="6461002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6461005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6461008">if</span>&nbsp;<span class="ident" id="6461011">got</span><span class="op" id="6461014">,</span>&nbsp;<span class="ident" id="6461016">want</span>&nbsp;<span class="op" id="6461021">:=</span>&nbsp;<span class="ident" id="6461024">fh2</span><span class="op" id="6461027">.</span><span class="ident" id="6461028">ModifiedTime</span><span class="op" id="6461040">,</span>&nbsp;<span class="ident" id="6461042">fh</span><span class="op" id="6461044">.</span><span class="ident" id="6461045">ModifiedTime</span><span class="op" id="6461057">;</span>&nbsp;<span class="ident" id="6461059">got</span>&nbsp;<span class="op" id="6461063">!=</span>&nbsp;<span class="ident" id="6461066">want</span>&nbsp;<span class="op" id="6461071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6461075">t</span><span class="op" id="6461076">.</span><span class="ident" id="6461077">Errorf</span><span class="op" id="6461083">(</span><span class="string" id="6461084">&#34;ModifiedTime:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d\n&#34;</span><span class="op" id="6461117">,</span>&nbsp;<span class="ident" id="6461119">got</span><span class="op" id="6461122">,</span>&nbsp;<span class="ident" id="6461124">want</span><span class="op" id="6461128">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6461131">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6461134">if</span>&nbsp;<span class="ident" id="6461137">got</span><span class="op" id="6461140">,</span>&nbsp;<span class="ident" id="6461142">want</span>&nbsp;<span class="op" id="6461147">:=</span>&nbsp;<span class="ident" id="6461150">fh2</span><span class="op" id="6461153">.</span><span class="ident" id="6461154">ModifiedDate</span><span class="op" id="6461166">,</span>&nbsp;<span class="ident" id="6461168">fh</span><span class="op" id="6461170">.</span><span class="ident" id="6461171">ModifiedDate</span><span class="op" id="6461183">;</span>&nbsp;<span class="ident" id="6461185">got</span>&nbsp;<span class="op" id="6461189">!=</span>&nbsp;<span class="ident" id="6461192">want</span>&nbsp;<span class="op" id="6461197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6461201">t</span><span class="op" id="6461202">.</span><span class="ident" id="6461203">Errorf</span><span class="op" id="6461209">(</span><span class="string" id="6461210">&#34;ModifiedDate:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d\n&#34;</span><span class="op" id="6461243">,</span>&nbsp;<span class="ident" id="6461245">got</span><span class="op" id="6461248">,</span>&nbsp;<span class="ident" id="6461250">want</span><span class="op" id="6461254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6461257">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6461261">if</span>&nbsp;<span class="ident" id="6461264">sysfh</span><span class="op" id="6461269">,</span>&nbsp;<span class="ident" id="6461271">ok</span>&nbsp;<span class="op" id="6461274">:=</span>&nbsp;<span class="ident" id="6461277">fi</span><span class="op" id="6461279">.</span><span class="ident" id="6461280">Sys</span><span class="op" id="6461283">(</span><span class="op" id="6461284">)</span><span class="op" id="6461285">.</span><span class="op" id="6461286">(</span><span class="op" id="6461287">*</span><span class="ident" id="6461288">FileHeader</span><span class="op" id="6461298">)</span><span class="op" id="6461299">;</span>&nbsp;<span class="op" id="6461301">!</span><span class="ident" id="6461302">ok</span>&nbsp;<span class="op" id="6461305">&amp;&amp;</span>&nbsp;<span class="ident" id="6461308">sysfh</span>&nbsp;<span class="op" id="6461314">!=</span>&nbsp;<span class="ident" id="6461317">fh</span>&nbsp;<span class="op" id="6461320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6461324">t</span><span class="op" id="6461325">.</span><span class="ident" id="6461326">Errorf</span><span class="op" id="6461332">(</span><span class="string" id="6461333">&#34;Sys&nbsp;didn&#39;t&nbsp;return&nbsp;original&nbsp;*FileHeader&#34;</span><span class="op" id="6461373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6461376">}</span><br>
<span class="lineno"></span><span class="op" id="6461378">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="6461381">func</span>&nbsp;<span class="ident" id="6461386">TestFileHeaderRoundTrip</span><span class="op" id="6461409">(</span><span class="ident" id="6461410">t</span>&nbsp;<span class="op" id="6461412">*</span><span class="ident" id="6461413">testing</span><span class="op" id="6461420">.</span><span class="ident" id="6461421">T</span><span class="op" id="6461422">)</span>&nbsp;<span class="op" id="6461424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6461427">fh</span>&nbsp;<span class="op" id="6461430">:=</span>&nbsp;<span class="op" id="6461433">&amp;</span><span class="ident" id="6461434">FileHeader</span><span class="op" id="6461444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6461448">Name</span><span class="op" id="6461452">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6461466">&#34;foo.txt&#34;</span><span class="op" id="6461475">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6461479">UncompressedSize</span><span class="op" id="6461495">:</span>&nbsp;<span class="num" id="6461497">987654321</span><span class="op" id="6461506">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6461510">ModifiedTime</span><span class="op" id="6461522">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6461528">1234</span><span class="op" id="6461532">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6461536">ModifiedDate</span><span class="op" id="6461548">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6461554">5678</span><span class="op" id="6461558">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6461561">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6461564">testHeaderRoundTrip</span><span class="op" id="6461583">(</span><span class="ident" id="6461584">fh</span><span class="op" id="6461586">,</span>&nbsp;<span class="ident" id="6461588">fh</span><span class="op" id="6461590">.</span><span class="ident" id="6461591">UncompressedSize</span><span class="op" id="6461607">,</span>&nbsp;<span class="ident" id="6461609">uint64</span><span class="op" id="6461615">(</span><span class="ident" id="6461616">fh</span><span class="op" id="6461618">.</span><span class="ident" id="6461619">UncompressedSize</span><span class="op" id="6461635">)</span><span class="op" id="6461636">,</span>&nbsp;<span class="ident" id="6461638">t</span><span class="op" id="6461639">)</span><br>
<span class="lineno"></span><span class="op" id="6461641">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="keyword" id="6461644">func</span>&nbsp;<span class="ident" id="6461649">TestFileHeaderRoundTrip64</span><span class="op" id="6461674">(</span><span class="ident" id="6461675">t</span>&nbsp;<span class="op" id="6461677">*</span><span class="ident" id="6461678">testing</span><span class="op" id="6461685">.</span><span class="ident" id="6461686">T</span><span class="op" id="6461687">)</span>&nbsp;<span class="op" id="6461689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6461692">fh</span>&nbsp;<span class="op" id="6461695">:=</span>&nbsp;<span class="op" id="6461698">&amp;</span><span class="ident" id="6461699">FileHeader</span><span class="op" id="6461709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6461713">Name</span><span class="op" id="6461717">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6461733">&#34;foo.txt&#34;</span><span class="op" id="6461742">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6461746">UncompressedSize64</span><span class="op" id="6461764">:</span>&nbsp;<span class="num" id="6461766">9876543210</span><span class="op" id="6461776">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6461780">ModifiedTime</span><span class="op" id="6461792">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6461800">1234</span><span class="op" id="6461804">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6461808">ModifiedDate</span><span class="op" id="6461820">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6461828">5678</span><span class="op" id="6461832">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6461835">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6461838">testHeaderRoundTrip</span><span class="op" id="6461857">(</span><span class="ident" id="6461858">fh</span><span class="op" id="6461860">,</span>&nbsp;<span class="ident" id="6461862">uint32max</span><span class="op" id="6461871">,</span>&nbsp;<span class="ident" id="6461873">fh</span><span class="op" id="6461875">.</span><span class="ident" id="6461876">UncompressedSize64</span><span class="op" id="6461894">,</span>&nbsp;<span class="ident" id="6461896">t</span><span class="op" id="6461897">)</span><br>
<span class="lineno"></span><span class="op" id="6461899">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="keyword" id="6461902">type</span>&nbsp;<span class="ident" id="6461907">repeatedByte</span>&nbsp;<span class="keyword" id="6461920">struct</span>&nbsp;<span class="op" id="6461927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6461930">off</span>&nbsp;<span class="ident" id="6461934">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6461941">b</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6461945">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6461951">n</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6461955">int64</span><br>
<span class="lineno"></span><span class="op" id="6461961">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="6461964">//&nbsp;rleBuffer&nbsp;is&nbsp;a&nbsp;run-length-encoded&nbsp;byte&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="6462014">//&nbsp;It&#39;s&nbsp;an&nbsp;io.Writer&nbsp;(like&nbsp;a&nbsp;bytes.Buffer)&nbsp;and&nbsp;also&nbsp;an&nbsp;io.ReaderAt,</span><br>
<span class="lineno"></span><span class="comment" id="6462082">//&nbsp;allowing&nbsp;random-access&nbsp;reads.</span><br>
<span class="lineno"></span><span class="keyword" id="6462115">type</span>&nbsp;<span class="ident" id="6462120">rleBuffer</span>&nbsp;<span class="keyword" id="6462130">struct</span>&nbsp;<span class="op" id="6462137">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6462140">buf</span>&nbsp;<span class="op" id="6462144">[</span><span class="op" id="6462145">]</span><span class="ident" id="6462146">repeatedByte</span><br>
<span class="lineno"></span><span class="op" id="6462159">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6462162">func</span>&nbsp;<span class="op" id="6462167">(</span><span class="ident" id="6462168">r</span>&nbsp;<span class="op" id="6462170">*</span><span class="ident" id="6462171">rleBuffer</span><span class="op" id="6462180">)</span>&nbsp;<span class="ident" id="6462182">Size</span><span class="op" id="6462186">(</span><span class="op" id="6462187">)</span>&nbsp;<span class="ident" id="6462189">int64</span>&nbsp;<span class="op" id="6462195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6462198">if</span>&nbsp;<span class="builtinfunc" id="6462201">len</span><span class="op" id="6462204">(</span><span class="ident" id="6462205">r</span><span class="op" id="6462206">.</span><span class="ident" id="6462207">buf</span><span class="op" id="6462210">)</span>&nbsp;<span class="op" id="6462212">==</span>&nbsp;<span class="num" id="6462215">0</span>&nbsp;<span class="op" id="6462217">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6462221">return</span>&nbsp;<span class="num" id="6462228">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6462231">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6462234">last</span>&nbsp;<span class="op" id="6462239">:=</span>&nbsp;<span class="op" id="6462242">&amp;</span><span class="ident" id="6462243">r</span><span class="op" id="6462244">.</span><span class="ident" id="6462245">buf</span><span class="op" id="6462248">[</span><span class="builtinfunc" id="6462249">len</span><span class="op" id="6462252">(</span><span class="ident" id="6462253">r</span><span class="op" id="6462254">.</span><span class="ident" id="6462255">buf</span><span class="op" id="6462258">)</span><span class="op" id="6462259">-</span><span class="num" id="6462260">1</span><span class="op" id="6462261">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6462264">return</span>&nbsp;<span class="ident" id="6462271">last</span><span class="op" id="6462275">.</span><span class="ident" id="6462276">off</span>&nbsp;<span class="op" id="6462280">+</span>&nbsp;<span class="ident" id="6462282">last</span><span class="op" id="6462286">.</span><span class="ident" id="6462287">n</span><br>
<span class="lineno"></span><span class="op" id="6462289">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="keyword" id="6462292">func</span>&nbsp;<span class="op" id="6462297">(</span><span class="ident" id="6462298">r</span>&nbsp;<span class="op" id="6462300">*</span><span class="ident" id="6462301">rleBuffer</span><span class="op" id="6462310">)</span>&nbsp;<span class="ident" id="6462312">Write</span><span class="op" id="6462317">(</span><span class="ident" id="6462318">p</span>&nbsp;<span class="op" id="6462320">[</span><span class="op" id="6462321">]</span><span class="builtintype" id="6462322">byte</span><span class="op" id="6462326">)</span>&nbsp;<span class="op" id="6462328">(</span><span class="ident" id="6462329">n</span>&nbsp;<span class="builtintype" id="6462331">int</span><span class="op" id="6462334">,</span>&nbsp;<span class="ident" id="6462336">err</span>&nbsp;<span class="builtintype" id="6462340">error</span><span class="op" id="6462345">)</span>&nbsp;<span class="op" id="6462347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6462350">var</span>&nbsp;<span class="ident" id="6462354">rp</span>&nbsp;<span class="op" id="6462357">*</span><span class="ident" id="6462358">repeatedByte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6462372">if</span>&nbsp;<span class="builtinfunc" id="6462375">len</span><span class="op" id="6462378">(</span><span class="ident" id="6462379">r</span><span class="op" id="6462380">.</span><span class="ident" id="6462381">buf</span><span class="op" id="6462384">)</span>&nbsp;<span class="op" id="6462386">&gt;</span>&nbsp;<span class="num" id="6462388">0</span>&nbsp;<span class="op" id="6462390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6462394">rp</span>&nbsp;<span class="op" id="6462397">=</span>&nbsp;<span class="op" id="6462399">&amp;</span><span class="ident" id="6462400">r</span><span class="op" id="6462401">.</span><span class="ident" id="6462402">buf</span><span class="op" id="6462405">[</span><span class="builtinfunc" id="6462406">len</span><span class="op" id="6462409">(</span><span class="ident" id="6462410">r</span><span class="op" id="6462411">.</span><span class="ident" id="6462412">buf</span><span class="op" id="6462415">)</span><span class="op" id="6462416">-</span><span class="num" id="6462417">1</span><span class="op" id="6462418">]</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6462422">//&nbsp;Fast&nbsp;path,&nbsp;if&nbsp;p&nbsp;is&nbsp;entirely&nbsp;the&nbsp;same&nbsp;byte&nbsp;repeated.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6462479">if</span>&nbsp;<span class="ident" id="6462482">lastByte</span>&nbsp;<span class="op" id="6462491">:=</span>&nbsp;<span class="ident" id="6462494">rp</span><span class="op" id="6462496">.</span><span class="ident" id="6462497">b</span><span class="op" id="6462498">;</span>&nbsp;<span class="builtinfunc" id="6462500">len</span><span class="op" id="6462503">(</span><span class="ident" id="6462504">p</span><span class="op" id="6462505">)</span>&nbsp;<span class="op" id="6462507">&gt;</span>&nbsp;<span class="num" id="6462509">0</span>&nbsp;<span class="op" id="6462511">&amp;&amp;</span>&nbsp;<span class="ident" id="6462514">p</span><span class="op" id="6462515">[</span><span class="num" id="6462516">0</span><span class="op" id="6462517">]</span>&nbsp;<span class="op" id="6462519">==</span>&nbsp;<span class="ident" id="6462522">lastByte</span>&nbsp;<span class="op" id="6462531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6462536">all</span>&nbsp;<span class="op" id="6462540">:=</span>&nbsp;<span class="builtintype" id="6462543">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6462551">for</span>&nbsp;<span class="ident" id="6462555">_</span><span class="op" id="6462556">,</span>&nbsp;<span class="ident" id="6462558">b</span>&nbsp;<span class="op" id="6462560">:=</span>&nbsp;<span class="keyword" id="6462563">range</span>&nbsp;<span class="ident" id="6462569">p</span>&nbsp;<span class="op" id="6462571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6462577">if</span>&nbsp;<span class="ident" id="6462580">b</span>&nbsp;<span class="op" id="6462582">!=</span>&nbsp;<span class="ident" id="6462585">lastByte</span>&nbsp;<span class="op" id="6462594">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6462601">all</span>&nbsp;<span class="op" id="6462605">=</span>&nbsp;<span class="builtintype" id="6462607">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6462618">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6462628">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6462633">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6462638">if</span>&nbsp;<span class="ident" id="6462641">all</span>&nbsp;<span class="op" id="6462645">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6462651">rp</span><span class="op" id="6462653">.</span><span class="ident" id="6462654">n</span>&nbsp;<span class="op" id="6462656">+=</span>&nbsp;<span class="ident" id="6462659">int64</span><span class="op" id="6462664">(</span><span class="builtinfunc" id="6462665">len</span><span class="op" id="6462668">(</span><span class="ident" id="6462669">p</span><span class="op" id="6462670">)</span><span class="op" id="6462671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6462677">return</span>&nbsp;<span class="builtinfunc" id="6462684">len</span><span class="op" id="6462687">(</span><span class="ident" id="6462688">p</span><span class="op" id="6462689">)</span><span class="op" id="6462690">,</span>&nbsp;<span class="builtintype" id="6462692">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6462699">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6462703">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6462706">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6462710">for</span>&nbsp;<span class="ident" id="6462714">_</span><span class="op" id="6462715">,</span>&nbsp;<span class="ident" id="6462717">b</span>&nbsp;<span class="op" id="6462719">:=</span>&nbsp;<span class="keyword" id="6462722">range</span>&nbsp;<span class="ident" id="6462728">p</span>&nbsp;<span class="op" id="6462730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6462734">if</span>&nbsp;<span class="ident" id="6462737">rp</span>&nbsp;<span class="op" id="6462740">==</span>&nbsp;<span class="builtintype" id="6462743">nil</span>&nbsp;<span class="op" id="6462747">||</span>&nbsp;<span class="ident" id="6462750">rp</span><span class="op" id="6462752">.</span><span class="ident" id="6462753">b</span>&nbsp;<span class="op" id="6462755">!=</span>&nbsp;<span class="ident" id="6462758">b</span>&nbsp;<span class="op" id="6462760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6462765">r</span><span class="op" id="6462766">.</span><span class="ident" id="6462767">buf</span>&nbsp;<span class="op" id="6462771">=</span>&nbsp;<span class="builtinfunc" id="6462773">append</span><span class="op" id="6462779">(</span><span class="ident" id="6462780">r</span><span class="op" id="6462781">.</span><span class="ident" id="6462782">buf</span><span class="op" id="6462785">,</span>&nbsp;<span class="ident" id="6462787">repeatedByte</span><span class="op" id="6462799">{</span><span class="ident" id="6462800">r</span><span class="op" id="6462801">.</span><span class="ident" id="6462802">Size</span><span class="op" id="6462806">(</span><span class="op" id="6462807">)</span><span class="op" id="6462808">,</span>&nbsp;<span class="ident" id="6462810">b</span><span class="op" id="6462811">,</span>&nbsp;<span class="num" id="6462813">1</span><span class="op" id="6462814">}</span><span class="op" id="6462815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6462820">rp</span>&nbsp;<span class="op" id="6462823">=</span>&nbsp;<span class="op" id="6462825">&amp;</span><span class="ident" id="6462826">r</span><span class="op" id="6462827">.</span><span class="ident" id="6462828">buf</span><span class="op" id="6462831">[</span><span class="builtinfunc" id="6462832">len</span><span class="op" id="6462835">(</span><span class="ident" id="6462836">r</span><span class="op" id="6462837">.</span><span class="ident" id="6462838">buf</span><span class="op" id="6462841">)</span><span class="op" id="6462842">-</span><span class="num" id="6462843">1</span><span class="op" id="6462844">]</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6462848">}</span>&nbsp;<span class="keyword" id="6462850">else</span>&nbsp;<span class="op" id="6462855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6462860">rp</span><span class="op" id="6462862">.</span><span class="ident" id="6462863">n</span><span class="op" id="6462864">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6462869">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6462872">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6462875">return</span>&nbsp;<span class="builtinfunc" id="6462882">len</span><span class="op" id="6462885">(</span><span class="ident" id="6462886">p</span><span class="op" id="6462887">)</span><span class="op" id="6462888">,</span>&nbsp;<span class="builtintype" id="6462890">nil</span><br>
<span class="lineno">160</span><span class="op" id="6462894">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6462897">func</span>&nbsp;<span class="op" id="6462902">(</span><span class="ident" id="6462903">r</span>&nbsp;<span class="op" id="6462905">*</span><span class="ident" id="6462906">rleBuffer</span><span class="op" id="6462915">)</span>&nbsp;<span class="ident" id="6462917">ReadAt</span><span class="op" id="6462923">(</span><span class="ident" id="6462924">p</span>&nbsp;<span class="op" id="6462926">[</span><span class="op" id="6462927">]</span><span class="builtintype" id="6462928">byte</span><span class="op" id="6462932">,</span>&nbsp;<span class="ident" id="6462934">off</span>&nbsp;<span class="ident" id="6462938">int64</span><span class="op" id="6462943">)</span>&nbsp;<span class="op" id="6462945">(</span><span class="ident" id="6462946">n</span>&nbsp;<span class="builtintype" id="6462948">int</span><span class="op" id="6462951">,</span>&nbsp;<span class="ident" id="6462953">err</span>&nbsp;<span class="builtintype" id="6462957">error</span><span class="op" id="6462962">)</span>&nbsp;<span class="op" id="6462964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6462967">if</span>&nbsp;<span class="builtinfunc" id="6462970">len</span><span class="op" id="6462973">(</span><span class="ident" id="6462974">p</span><span class="op" id="6462975">)</span>&nbsp;<span class="op" id="6462977">==</span>&nbsp;<span class="num" id="6462980">0</span>&nbsp;<span class="op" id="6462982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6462986">return</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6462994">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6462997">skipParts</span>&nbsp;<span class="op" id="6463007">:=</span>&nbsp;<span class="ident" id="6463010">sort</span><span class="op" id="6463014">.</span><span class="ident" id="6463015">Search</span><span class="op" id="6463021">(</span><span class="builtinfunc" id="6463022">len</span><span class="op" id="6463025">(</span><span class="ident" id="6463026">r</span><span class="op" id="6463027">.</span><span class="ident" id="6463028">buf</span><span class="op" id="6463031">)</span><span class="op" id="6463032">,</span>&nbsp;<span class="keyword" id="6463034">func</span><span class="op" id="6463038">(</span><span class="ident" id="6463039">i</span>&nbsp;<span class="builtintype" id="6463041">int</span><span class="op" id="6463044">)</span>&nbsp;<span class="builtintype" id="6463046">bool</span>&nbsp;<span class="op" id="6463051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6463055">part</span>&nbsp;<span class="op" id="6463060">:=</span>&nbsp;<span class="op" id="6463063">&amp;</span><span class="ident" id="6463064">r</span><span class="op" id="6463065">.</span><span class="ident" id="6463066">buf</span><span class="op" id="6463069">[</span><span class="ident" id="6463070">i</span><span class="op" id="6463071">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6463075">return</span>&nbsp;<span class="ident" id="6463082">part</span><span class="op" id="6463086">.</span><span class="ident" id="6463087">off</span><span class="op" id="6463090">+</span><span class="ident" id="6463091">part</span><span class="op" id="6463095">.</span><span class="ident" id="6463096">n</span>&nbsp;<span class="op" id="6463098">&gt;</span>&nbsp;<span class="ident" id="6463100">off</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6463105">}</span><span class="op" id="6463106">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6463109">parts</span>&nbsp;<span class="op" id="6463115">:=</span>&nbsp;<span class="ident" id="6463118">r</span><span class="op" id="6463119">.</span><span class="ident" id="6463120">buf</span><span class="op" id="6463123">[</span><span class="ident" id="6463124">skipParts</span><span class="op" id="6463133">:</span><span class="op" id="6463134">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6463137">if</span>&nbsp;<span class="builtinfunc" id="6463140">len</span><span class="op" id="6463143">(</span><span class="ident" id="6463144">parts</span><span class="op" id="6463149">)</span>&nbsp;<span class="op" id="6463151">&gt;</span>&nbsp;<span class="num" id="6463153">0</span>&nbsp;<span class="op" id="6463155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6463159">skipBytes</span>&nbsp;<span class="op" id="6463169">:=</span>&nbsp;<span class="ident" id="6463172">off</span>&nbsp;<span class="op" id="6463176">-</span>&nbsp;<span class="ident" id="6463178">parts</span><span class="op" id="6463183">[</span><span class="num" id="6463184">0</span><span class="op" id="6463185">]</span><span class="op" id="6463186">.</span><span class="ident" id="6463187">off</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6463193">for</span>&nbsp;<span class="builtinfunc" id="6463197">len</span><span class="op" id="6463200">(</span><span class="ident" id="6463201">parts</span><span class="op" id="6463206">)</span>&nbsp;<span class="op" id="6463208">&gt;</span>&nbsp;<span class="num" id="6463210">0</span>&nbsp;<span class="op" id="6463212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6463217">part</span>&nbsp;<span class="op" id="6463222">:=</span>&nbsp;<span class="ident" id="6463225">parts</span><span class="op" id="6463230">[</span><span class="num" id="6463231">0</span><span class="op" id="6463232">]</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6463237">for</span>&nbsp;<span class="ident" id="6463241">i</span>&nbsp;<span class="op" id="6463243">:=</span>&nbsp;<span class="ident" id="6463246">skipBytes</span><span class="op" id="6463255">;</span>&nbsp;<span class="ident" id="6463257">i</span>&nbsp;<span class="op" id="6463259">&lt;</span>&nbsp;<span class="ident" id="6463261">part</span><span class="op" id="6463265">.</span><span class="ident" id="6463266">n</span><span class="op" id="6463267">;</span>&nbsp;<span class="ident" id="6463269">i</span><span class="op" id="6463270">++</span>&nbsp;<span class="op" id="6463273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6463279">if</span>&nbsp;<span class="ident" id="6463282">n</span>&nbsp;<span class="op" id="6463284">==</span>&nbsp;<span class="builtinfunc" id="6463287">len</span><span class="op" id="6463290">(</span><span class="ident" id="6463291">p</span><span class="op" id="6463292">)</span>&nbsp;<span class="op" id="6463294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6463301">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6463312">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6463318">p</span><span class="op" id="6463319">[</span><span class="ident" id="6463320">n</span><span class="op" id="6463321">]</span>&nbsp;<span class="op" id="6463323">=</span>&nbsp;<span class="ident" id="6463325">part</span><span class="op" id="6463329">.</span><span class="ident" id="6463330">b</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6463336">n</span><span class="op" id="6463337">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6463343">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6463348">parts</span>&nbsp;<span class="op" id="6463354">=</span>&nbsp;<span class="ident" id="6463356">parts</span><span class="op" id="6463361">[</span><span class="num" id="6463362">1</span><span class="op" id="6463363">:</span><span class="op" id="6463364">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6463369">skipBytes</span>&nbsp;<span class="op" id="6463379">=</span>&nbsp;<span class="num" id="6463381">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6463385">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6463388">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6463391">if</span>&nbsp;<span class="ident" id="6463394">n</span>&nbsp;<span class="op" id="6463396">!=</span>&nbsp;<span class="builtinfunc" id="6463399">len</span><span class="op" id="6463402">(</span><span class="ident" id="6463403">p</span><span class="op" id="6463404">)</span>&nbsp;<span class="op" id="6463406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6463410">err</span>&nbsp;<span class="op" id="6463414">=</span>&nbsp;<span class="ident" id="6463416">io</span><span class="op" id="6463418">.</span><span class="ident" id="6463419">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6463437">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6463440">return</span><br>
<span class="lineno">190</span><span class="op" id="6463447">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6463450">//&nbsp;Just&nbsp;testing&nbsp;the&nbsp;rleBuffer&nbsp;used&nbsp;in&nbsp;the&nbsp;Zip64&nbsp;test&nbsp;above.&nbsp;Not&nbsp;used&nbsp;by&nbsp;the&nbsp;zip&nbsp;code.</span><br>
<span class="lineno"></span><span class="keyword" id="6463536">func</span>&nbsp;<span class="ident" id="6463541">TestRLEBuffer</span><span class="op" id="6463554">(</span><span class="ident" id="6463555">t</span>&nbsp;<span class="op" id="6463557">*</span><span class="ident" id="6463558">testing</span><span class="op" id="6463565">.</span><span class="ident" id="6463566">T</span><span class="op" id="6463567">)</span>&nbsp;<span class="op" id="6463569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6463572">b</span>&nbsp;<span class="op" id="6463574">:=</span>&nbsp;<span class="builtinfunc" id="6463577">new</span><span class="op" id="6463580">(</span><span class="ident" id="6463581">rleBuffer</span><span class="op" id="6463590">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6463593">var</span>&nbsp;<span class="ident" id="6463597">all</span>&nbsp;<span class="op" id="6463601">[</span><span class="op" id="6463602">]</span><span class="builtintype" id="6463603">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6463609">writes</span>&nbsp;<span class="op" id="6463616">:=</span>&nbsp;<span class="op" id="6463619">[</span><span class="op" id="6463620">]</span><span class="builtintype" id="6463621">string</span><span class="op" id="6463627">{</span><span class="string" id="6463628">&#34;abcdeee&#34;</span><span class="op" id="6463637">,</span>&nbsp;<span class="string" id="6463639">&#34;eeeeeee&#34;</span><span class="op" id="6463648">,</span>&nbsp;<span class="string" id="6463650">&#34;eeeefghaaiii&#34;</span><span class="op" id="6463664">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6463667">for</span>&nbsp;<span class="ident" id="6463671">_</span><span class="op" id="6463672">,</span>&nbsp;<span class="ident" id="6463674">w</span>&nbsp;<span class="op" id="6463676">:=</span>&nbsp;<span class="keyword" id="6463679">range</span>&nbsp;<span class="ident" id="6463685">writes</span>&nbsp;<span class="op" id="6463692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6463696">b</span><span class="op" id="6463697">.</span><span class="ident" id="6463698">Write</span><span class="op" id="6463703">(</span><span class="op" id="6463704">[</span><span class="op" id="6463705">]</span><span class="builtintype" id="6463706">byte</span><span class="op" id="6463710">(</span><span class="ident" id="6463711">w</span><span class="op" id="6463712">)</span><span class="op" id="6463713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6463717">all</span>&nbsp;<span class="op" id="6463721">=</span>&nbsp;<span class="builtinfunc" id="6463723">append</span><span class="op" id="6463729">(</span><span class="ident" id="6463730">all</span><span class="op" id="6463733">,</span>&nbsp;<span class="ident" id="6463735">w</span><span class="op" id="6463736">...</span><span class="op" id="6463739">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6463742">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6463745">if</span>&nbsp;<span class="builtinfunc" id="6463748">len</span><span class="op" id="6463751">(</span><span class="ident" id="6463752">b</span><span class="op" id="6463753">.</span><span class="ident" id="6463754">buf</span><span class="op" id="6463757">)</span>&nbsp;<span class="op" id="6463759">!=</span>&nbsp;<span class="num" id="6463762">10</span>&nbsp;<span class="op" id="6463765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6463769">t</span><span class="op" id="6463770">.</span><span class="ident" id="6463771">Fatalf</span><span class="op" id="6463777">(</span><span class="string" id="6463778">&#34;len(b.buf)&nbsp;=&nbsp;%d;&nbsp;want&nbsp;10&#34;</span><span class="op" id="6463804">,</span>&nbsp;<span class="builtinfunc" id="6463806">len</span><span class="op" id="6463809">(</span><span class="ident" id="6463810">b</span><span class="op" id="6463811">.</span><span class="ident" id="6463812">buf</span><span class="op" id="6463815">)</span><span class="op" id="6463816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6463819">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6463823">for</span>&nbsp;<span class="ident" id="6463827">i</span>&nbsp;<span class="op" id="6463829">:=</span>&nbsp;<span class="num" id="6463832">0</span><span class="op" id="6463833">;</span>&nbsp;<span class="ident" id="6463835">i</span>&nbsp;<span class="op" id="6463837">&lt;</span>&nbsp;<span class="builtinfunc" id="6463839">len</span><span class="op" id="6463842">(</span><span class="ident" id="6463843">all</span><span class="op" id="6463846">)</span><span class="op" id="6463847">;</span>&nbsp;<span class="ident" id="6463849">i</span><span class="op" id="6463850">++</span>&nbsp;<span class="op" id="6463853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6463857">for</span>&nbsp;<span class="ident" id="6463861">j</span>&nbsp;<span class="op" id="6463863">:=</span>&nbsp;<span class="num" id="6463866">0</span><span class="op" id="6463867">;</span>&nbsp;<span class="ident" id="6463869">j</span>&nbsp;<span class="op" id="6463871">&lt;</span>&nbsp;<span class="builtinfunc" id="6463873">len</span><span class="op" id="6463876">(</span><span class="ident" id="6463877">all</span><span class="op" id="6463880">)</span><span class="op" id="6463881">-</span><span class="ident" id="6463882">i</span><span class="op" id="6463883">;</span>&nbsp;<span class="ident" id="6463885">j</span><span class="op" id="6463886">++</span>&nbsp;<span class="op" id="6463889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6463894">buf</span>&nbsp;<span class="op" id="6463898">:=</span>&nbsp;<span class="builtinfunc" id="6463901">make</span><span class="op" id="6463905">(</span><span class="op" id="6463906">[</span><span class="op" id="6463907">]</span><span class="builtintype" id="6463908">byte</span><span class="op" id="6463912">,</span>&nbsp;<span class="ident" id="6463914">j</span><span class="op" id="6463915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6463920">n</span><span class="op" id="6463921">,</span>&nbsp;<span class="ident" id="6463923">err</span>&nbsp;<span class="op" id="6463927">:=</span>&nbsp;<span class="ident" id="6463930">b</span><span class="op" id="6463931">.</span><span class="ident" id="6463932">ReadAt</span><span class="op" id="6463938">(</span><span class="ident" id="6463939">buf</span><span class="op" id="6463942">,</span>&nbsp;<span class="ident" id="6463944">int64</span><span class="op" id="6463949">(</span><span class="ident" id="6463950">i</span><span class="op" id="6463951">)</span><span class="op" id="6463952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6463957">if</span>&nbsp;<span class="ident" id="6463960">err</span>&nbsp;<span class="op" id="6463964">!=</span>&nbsp;<span class="builtintype" id="6463967">nil</span>&nbsp;<span class="op" id="6463971">||</span>&nbsp;<span class="ident" id="6463974">n</span>&nbsp;<span class="op" id="6463976">!=</span>&nbsp;<span class="builtinfunc" id="6463979">len</span><span class="op" id="6463982">(</span><span class="ident" id="6463983">buf</span><span class="op" id="6463986">)</span>&nbsp;<span class="op" id="6463988">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6463994">t</span><span class="op" id="6463995">.</span><span class="ident" id="6463996">Errorf</span><span class="op" id="6464002">(</span><span class="string" id="6464003">&#34;ReadAt(%d,&nbsp;%d)&nbsp;=&nbsp;%d,&nbsp;%v;&nbsp;want&nbsp;%d,&nbsp;nil&#34;</span><span class="op" id="6464042">,</span>&nbsp;<span class="ident" id="6464044">i</span><span class="op" id="6464045">,</span>&nbsp;<span class="ident" id="6464047">j</span><span class="op" id="6464048">,</span>&nbsp;<span class="ident" id="6464050">n</span><span class="op" id="6464051">,</span>&nbsp;<span class="ident" id="6464053">err</span><span class="op" id="6464056">,</span>&nbsp;<span class="builtinfunc" id="6464058">len</span><span class="op" id="6464061">(</span><span class="ident" id="6464062">buf</span><span class="op" id="6464065">)</span><span class="op" id="6464066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6464071">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6464076">if</span>&nbsp;<span class="op" id="6464079">!</span><span class="ident" id="6464080">bytes</span><span class="op" id="6464085">.</span><span class="ident" id="6464086">Equal</span><span class="op" id="6464091">(</span><span class="ident" id="6464092">buf</span><span class="op" id="6464095">,</span>&nbsp;<span class="ident" id="6464097">all</span><span class="op" id="6464100">[</span><span class="ident" id="6464101">i</span><span class="op" id="6464102">:</span><span class="ident" id="6464103">i</span><span class="op" id="6464104">+</span><span class="ident" id="6464105">j</span><span class="op" id="6464106">]</span><span class="op" id="6464107">)</span>&nbsp;<span class="op" id="6464109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6464115">t</span><span class="op" id="6464116">.</span><span class="ident" id="6464117">Errorf</span><span class="op" id="6464123">(</span><span class="string" id="6464124">&#34;ReadAt(%d,&nbsp;%d)&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6464154">,</span>&nbsp;<span class="ident" id="6464156">i</span><span class="op" id="6464157">,</span>&nbsp;<span class="ident" id="6464159">j</span><span class="op" id="6464160">,</span>&nbsp;<span class="ident" id="6464162">buf</span><span class="op" id="6464165">,</span>&nbsp;<span class="ident" id="6464167">all</span><span class="op" id="6464170">[</span><span class="ident" id="6464171">i</span><span class="op" id="6464172">:</span><span class="ident" id="6464173">i</span><span class="op" id="6464174">+</span><span class="ident" id="6464175">j</span><span class="op" id="6464176">]</span><span class="op" id="6464177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6464182">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6464186">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6464189">}</span><br>
<span class="lineno"></span><span class="op" id="6464191">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6464194">//&nbsp;fakeHash32&nbsp;is&nbsp;a&nbsp;dummy&nbsp;Hash32&nbsp;that&nbsp;always&nbsp;returns&nbsp;0.</span><br>
<span class="lineno">220</span><span class="keyword" id="6464249">type</span>&nbsp;<span class="ident" id="6464254">fakeHash32</span>&nbsp;<span class="keyword" id="6464265">struct</span>&nbsp;<span class="op" id="6464272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6464275">hash</span><span class="op" id="6464279">.</span><span class="ident" id="6464280">Hash32</span><br>
<span class="lineno"></span><span class="op" id="6464287">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6464290">func</span>&nbsp;<span class="op" id="6464295">(</span><span class="ident" id="6464296">fakeHash32</span><span class="op" id="6464306">)</span>&nbsp;<span class="ident" id="6464308">Write</span><span class="op" id="6464313">(</span><span class="ident" id="6464314">p</span>&nbsp;<span class="op" id="6464316">[</span><span class="op" id="6464317">]</span><span class="builtintype" id="6464318">byte</span><span class="op" id="6464322">)</span>&nbsp;<span class="op" id="6464324">(</span><span class="builtintype" id="6464325">int</span><span class="op" id="6464328">,</span>&nbsp;<span class="builtintype" id="6464330">error</span><span class="op" id="6464335">)</span>&nbsp;<span class="op" id="6464337">{</span>&nbsp;<span class="keyword" id="6464339">return</span>&nbsp;<span class="builtinfunc" id="6464346">len</span><span class="op" id="6464349">(</span><span class="ident" id="6464350">p</span><span class="op" id="6464351">)</span><span class="op" id="6464352">,</span>&nbsp;<span class="builtintype" id="6464354">nil</span>&nbsp;<span class="op" id="6464358">}</span><br>
<span class="lineno">225</span><span class="keyword" id="6464360">func</span>&nbsp;<span class="op" id="6464365">(</span><span class="ident" id="6464366">fakeHash32</span><span class="op" id="6464376">)</span>&nbsp;<span class="ident" id="6464378">Sum32</span><span class="op" id="6464383">(</span><span class="op" id="6464384">)</span>&nbsp;<span class="builtintype" id="6464386">uint32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6464407">{</span>&nbsp;<span class="keyword" id="6464409">return</span>&nbsp;<span class="num" id="6464416">0</span>&nbsp;<span class="op" id="6464418">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6464421">func</span>&nbsp;<span class="ident" id="6464426">TestZip64</span><span class="op" id="6464435">(</span><span class="ident" id="6464436">t</span>&nbsp;<span class="op" id="6464438">*</span><span class="ident" id="6464439">testing</span><span class="op" id="6464446">.</span><span class="ident" id="6464447">T</span><span class="op" id="6464448">)</span>&nbsp;<span class="op" id="6464450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6464453">if</span>&nbsp;<span class="ident" id="6464456">testing</span><span class="op" id="6464463">.</span><span class="ident" id="6464464">Short</span><span class="op" id="6464469">(</span><span class="op" id="6464470">)</span>&nbsp;<span class="op" id="6464472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6464476">t</span><span class="op" id="6464477">.</span><span class="ident" id="6464478">Skip</span><span class="op" id="6464482">(</span><span class="string" id="6464483">&#34;slow&nbsp;test;&nbsp;skipping&#34;</span><span class="op" id="6464504">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6464507">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6464510">const</span>&nbsp;<span class="ident" id="6464516">size</span>&nbsp;<span class="op" id="6464521">=</span>&nbsp;<span class="num" id="6464523">1</span>&nbsp;<span class="op" id="6464525">&lt;&lt;</span>&nbsp;<span class="num" id="6464528">32</span>&nbsp;<span class="comment" id="6464531">//&nbsp;before&nbsp;the&nbsp;&#34;END\n&#34;&nbsp;part</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6464559">testZip64</span><span class="op" id="6464568">(</span><span class="ident" id="6464569">t</span><span class="op" id="6464570">,</span>&nbsp;<span class="ident" id="6464572">size</span><span class="op" id="6464576">)</span><br>
<span class="lineno"></span><span class="op" id="6464578">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="keyword" id="6464581">func</span>&nbsp;<span class="ident" id="6464586">testZip64</span><span class="op" id="6464595">(</span><span class="ident" id="6464596">t</span>&nbsp;<span class="ident" id="6464598">testing</span><span class="op" id="6464605">.</span><span class="ident" id="6464606">TB</span><span class="op" id="6464608">,</span>&nbsp;<span class="ident" id="6464610">size</span>&nbsp;<span class="ident" id="6464615">int64</span><span class="op" id="6464620">)</span>&nbsp;<span class="op" id="6464622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6464625">const</span>&nbsp;<span class="ident" id="6464631">chunkSize</span>&nbsp;<span class="op" id="6464641">=</span>&nbsp;<span class="num" id="6464643">1024</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6464649">chunks</span>&nbsp;<span class="op" id="6464656">:=</span>&nbsp;<span class="builtintype" id="6464659">int</span><span class="op" id="6464662">(</span><span class="ident" id="6464663">size</span>&nbsp;<span class="op" id="6464668">/</span>&nbsp;<span class="ident" id="6464670">chunkSize</span><span class="op" id="6464679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6464682">//&nbsp;write&nbsp;2^32&nbsp;bytes&nbsp;plus&nbsp;&#34;END\n&#34;&nbsp;to&nbsp;a&nbsp;zip&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6464730">buf</span>&nbsp;<span class="op" id="6464734">:=</span>&nbsp;<span class="builtinfunc" id="6464737">new</span><span class="op" id="6464740">(</span><span class="ident" id="6464741">rleBuffer</span><span class="op" id="6464750">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6464753">w</span>&nbsp;<span class="op" id="6464755">:=</span>&nbsp;<span class="ident" id="6464758">NewWriter</span><span class="op" id="6464767">(</span><span class="ident" id="6464768">buf</span><span class="op" id="6464771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6464774">f</span><span class="op" id="6464775">,</span>&nbsp;<span class="ident" id="6464777">err</span>&nbsp;<span class="op" id="6464781">:=</span>&nbsp;<span class="ident" id="6464784">w</span><span class="op" id="6464785">.</span><span class="ident" id="6464786">CreateHeader</span><span class="op" id="6464798">(</span><span class="op" id="6464799">&amp;</span><span class="ident" id="6464800">FileHeader</span><span class="op" id="6464810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6464814">Name</span><span class="op" id="6464818">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="6464822">&#34;huge.txt&#34;</span><span class="op" id="6464832">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6464836">Method</span><span class="op" id="6464842">:</span>&nbsp;<span class="ident" id="6464844">Store</span><span class="op" id="6464849">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6464852">}</span><span class="op" id="6464853">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6464856">if</span>&nbsp;<span class="ident" id="6464859">err</span>&nbsp;<span class="op" id="6464863">!=</span>&nbsp;<span class="builtintype" id="6464866">nil</span>&nbsp;<span class="op" id="6464870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6464874">t</span><span class="op" id="6464875">.</span><span class="ident" id="6464876">Fatal</span><span class="op" id="6464881">(</span><span class="ident" id="6464882">err</span><span class="op" id="6464885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6464888">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6464891">f</span><span class="op" id="6464892">.</span><span class="op" id="6464893">(</span><span class="op" id="6464894">*</span><span class="ident" id="6464895">fileWriter</span><span class="op" id="6464905">)</span><span class="op" id="6464906">.</span><span class="ident" id="6464907">crc32</span>&nbsp;<span class="op" id="6464913">=</span>&nbsp;<span class="ident" id="6464915">fakeHash32</span><span class="op" id="6464925">{</span><span class="op" id="6464926">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6464929">chunk</span>&nbsp;<span class="op" id="6464935">:=</span>&nbsp;<span class="builtinfunc" id="6464938">make</span><span class="op" id="6464942">(</span><span class="op" id="6464943">[</span><span class="op" id="6464944">]</span><span class="builtintype" id="6464945">byte</span><span class="op" id="6464949">,</span>&nbsp;<span class="ident" id="6464951">chunkSize</span><span class="op" id="6464960">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6464963">for</span>&nbsp;<span class="ident" id="6464967">i</span>&nbsp;<span class="op" id="6464969">:=</span>&nbsp;<span class="keyword" id="6464972">range</span>&nbsp;<span class="ident" id="6464978">chunk</span>&nbsp;<span class="op" id="6464984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6464988">chunk</span><span class="op" id="6464993">[</span><span class="ident" id="6464994">i</span><span class="op" id="6464995">]</span>&nbsp;<span class="op" id="6464997">=</span>&nbsp;<span class="string" id="6464999">&#39;.&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6465004">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6465007">for</span>&nbsp;<span class="ident" id="6465011">i</span>&nbsp;<span class="op" id="6465013">:=</span>&nbsp;<span class="num" id="6465016">0</span><span class="op" id="6465017">;</span>&nbsp;<span class="ident" id="6465019">i</span>&nbsp;<span class="op" id="6465021">&lt;</span>&nbsp;<span class="ident" id="6465023">chunks</span><span class="op" id="6465029">;</span>&nbsp;<span class="ident" id="6465031">i</span><span class="op" id="6465032">++</span>&nbsp;<span class="op" id="6465035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6465039">_</span><span class="op" id="6465040">,</span>&nbsp;<span class="ident" id="6465042">err</span>&nbsp;<span class="op" id="6465046">:=</span>&nbsp;<span class="ident" id="6465049">f</span><span class="op" id="6465050">.</span><span class="ident" id="6465051">Write</span><span class="op" id="6465056">(</span><span class="ident" id="6465057">chunk</span><span class="op" id="6465062">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6465066">if</span>&nbsp;<span class="ident" id="6465069">err</span>&nbsp;<span class="op" id="6465073">!=</span>&nbsp;<span class="builtintype" id="6465076">nil</span>&nbsp;<span class="op" id="6465080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6465085">t</span><span class="op" id="6465086">.</span><span class="ident" id="6465087">Fatal</span><span class="op" id="6465092">(</span><span class="string" id="6465093">&#34;write&nbsp;chunk:&#34;</span><span class="op" id="6465107">,</span>&nbsp;<span class="ident" id="6465109">err</span><span class="op" id="6465112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6465116">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6465119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6465122">end</span>&nbsp;<span class="op" id="6465126">:=</span>&nbsp;<span class="op" id="6465129">[</span><span class="op" id="6465130">]</span><span class="builtintype" id="6465131">byte</span><span class="op" id="6465135">(</span><span class="string" id="6465136">&#34;END\n&#34;</span><span class="op" id="6465143">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6465146">_</span><span class="op" id="6465147">,</span>&nbsp;<span class="ident" id="6465149">err</span>&nbsp;<span class="op" id="6465153">=</span>&nbsp;<span class="ident" id="6465155">f</span><span class="op" id="6465156">.</span><span class="ident" id="6465157">Write</span><span class="op" id="6465162">(</span><span class="ident" id="6465163">end</span><span class="op" id="6465166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6465169">if</span>&nbsp;<span class="ident" id="6465172">err</span>&nbsp;<span class="op" id="6465176">!=</span>&nbsp;<span class="builtintype" id="6465179">nil</span>&nbsp;<span class="op" id="6465183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6465187">t</span><span class="op" id="6465188">.</span><span class="ident" id="6465189">Fatal</span><span class="op" id="6465194">(</span><span class="string" id="6465195">&#34;write&nbsp;end:&#34;</span><span class="op" id="6465207">,</span>&nbsp;<span class="ident" id="6465209">err</span><span class="op" id="6465212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6465215">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6465218">if</span>&nbsp;<span class="ident" id="6465221">err</span>&nbsp;<span class="op" id="6465225">:=</span>&nbsp;<span class="ident" id="6465228">w</span><span class="op" id="6465229">.</span><span class="ident" id="6465230">Close</span><span class="op" id="6465235">(</span><span class="op" id="6465236">)</span><span class="op" id="6465237">;</span>&nbsp;<span class="ident" id="6465239">err</span>&nbsp;<span class="op" id="6465243">!=</span>&nbsp;<span class="builtintype" id="6465246">nil</span>&nbsp;<span class="op" id="6465250">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6465254">t</span><span class="op" id="6465255">.</span><span class="ident" id="6465256">Fatal</span><span class="op" id="6465261">(</span><span class="ident" id="6465262">err</span><span class="op" id="6465265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6465268">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6465272">//&nbsp;read&nbsp;back&nbsp;zip&nbsp;file&nbsp;and&nbsp;check&nbsp;that&nbsp;we&nbsp;get&nbsp;to&nbsp;the&nbsp;end&nbsp;of&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6465334">r</span><span class="op" id="6465335">,</span>&nbsp;<span class="ident" id="6465337">err</span>&nbsp;<span class="op" id="6465341">:=</span>&nbsp;<span class="ident" id="6465344">NewReader</span><span class="op" id="6465353">(</span><span class="ident" id="6465354">buf</span><span class="op" id="6465357">,</span>&nbsp;<span class="ident" id="6465359">int64</span><span class="op" id="6465364">(</span><span class="ident" id="6465365">buf</span><span class="op" id="6465368">.</span><span class="ident" id="6465369">Size</span><span class="op" id="6465373">(</span><span class="op" id="6465374">)</span><span class="op" id="6465375">)</span><span class="op" id="6465376">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6465379">if</span>&nbsp;<span class="ident" id="6465382">err</span>&nbsp;<span class="op" id="6465386">!=</span>&nbsp;<span class="builtintype" id="6465389">nil</span>&nbsp;<span class="op" id="6465393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6465397">t</span><span class="op" id="6465398">.</span><span class="ident" id="6465399">Fatal</span><span class="op" id="6465404">(</span><span class="string" id="6465405">&#34;reader:&#34;</span><span class="op" id="6465414">,</span>&nbsp;<span class="ident" id="6465416">err</span><span class="op" id="6465419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6465422">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6465425">f0</span>&nbsp;<span class="op" id="6465428">:=</span>&nbsp;<span class="ident" id="6465431">r</span><span class="op" id="6465432">.</span><span class="ident" id="6465433">File</span><span class="op" id="6465437">[</span><span class="num" id="6465438">0</span><span class="op" id="6465439">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6465442">rc</span><span class="op" id="6465444">,</span>&nbsp;<span class="ident" id="6465446">err</span>&nbsp;<span class="op" id="6465450">:=</span>&nbsp;<span class="ident" id="6465453">f0</span><span class="op" id="6465455">.</span><span class="ident" id="6465456">Open</span><span class="op" id="6465460">(</span><span class="op" id="6465461">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6465464">if</span>&nbsp;<span class="ident" id="6465467">err</span>&nbsp;<span class="op" id="6465471">!=</span>&nbsp;<span class="builtintype" id="6465474">nil</span>&nbsp;<span class="op" id="6465478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6465482">t</span><span class="op" id="6465483">.</span><span class="ident" id="6465484">Fatal</span><span class="op" id="6465489">(</span><span class="string" id="6465490">&#34;opening:&#34;</span><span class="op" id="6465500">,</span>&nbsp;<span class="ident" id="6465502">err</span><span class="op" id="6465505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6465508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6465511">rc</span><span class="op" id="6465513">.</span><span class="op" id="6465514">(</span><span class="op" id="6465515">*</span><span class="ident" id="6465516">checksumReader</span><span class="op" id="6465530">)</span><span class="op" id="6465531">.</span><span class="ident" id="6465532">hash</span>&nbsp;<span class="op" id="6465537">=</span>&nbsp;<span class="ident" id="6465539">fakeHash32</span><span class="op" id="6465549">{</span><span class="op" id="6465550">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6465553">for</span>&nbsp;<span class="ident" id="6465557">i</span>&nbsp;<span class="op" id="6465559">:=</span>&nbsp;<span class="num" id="6465562">0</span><span class="op" id="6465563">;</span>&nbsp;<span class="ident" id="6465565">i</span>&nbsp;<span class="op" id="6465567">&lt;</span>&nbsp;<span class="ident" id="6465569">chunks</span><span class="op" id="6465575">;</span>&nbsp;<span class="ident" id="6465577">i</span><span class="op" id="6465578">++</span>&nbsp;<span class="op" id="6465581">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6465585">_</span><span class="op" id="6465586">,</span>&nbsp;<span class="ident" id="6465588">err</span>&nbsp;<span class="op" id="6465592">:=</span>&nbsp;<span class="ident" id="6465595">io</span><span class="op" id="6465597">.</span><span class="ident" id="6465598">ReadFull</span><span class="op" id="6465606">(</span><span class="ident" id="6465607">rc</span><span class="op" id="6465609">,</span>&nbsp;<span class="ident" id="6465611">chunk</span><span class="op" id="6465616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6465620">if</span>&nbsp;<span class="ident" id="6465623">err</span>&nbsp;<span class="op" id="6465627">!=</span>&nbsp;<span class="builtintype" id="6465630">nil</span>&nbsp;<span class="op" id="6465634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6465639">t</span><span class="op" id="6465640">.</span><span class="ident" id="6465641">Fatal</span><span class="op" id="6465646">(</span><span class="string" id="6465647">&#34;read:&#34;</span><span class="op" id="6465654">,</span>&nbsp;<span class="ident" id="6465656">err</span><span class="op" id="6465659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6465663">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6465666">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6465669">gotEnd</span><span class="op" id="6465675">,</span>&nbsp;<span class="ident" id="6465677">err</span>&nbsp;<span class="op" id="6465681">:=</span>&nbsp;<span class="ident" id="6465684">ioutil</span><span class="op" id="6465690">.</span><span class="ident" id="6465691">ReadAll</span><span class="op" id="6465698">(</span><span class="ident" id="6465699">rc</span><span class="op" id="6465701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6465704">if</span>&nbsp;<span class="ident" id="6465707">err</span>&nbsp;<span class="op" id="6465711">!=</span>&nbsp;<span class="builtintype" id="6465714">nil</span>&nbsp;<span class="op" id="6465718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6465722">t</span><span class="op" id="6465723">.</span><span class="ident" id="6465724">Fatal</span><span class="op" id="6465729">(</span><span class="string" id="6465730">&#34;read&nbsp;end:&#34;</span><span class="op" id="6465741">,</span>&nbsp;<span class="ident" id="6465743">err</span><span class="op" id="6465746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6465749">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6465752">if</span>&nbsp;<span class="op" id="6465755">!</span><span class="ident" id="6465756">bytes</span><span class="op" id="6465761">.</span><span class="ident" id="6465762">Equal</span><span class="op" id="6465767">(</span><span class="ident" id="6465768">gotEnd</span><span class="op" id="6465774">,</span>&nbsp;<span class="ident" id="6465776">end</span><span class="op" id="6465779">)</span>&nbsp;<span class="op" id="6465781">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6465785">t</span><span class="op" id="6465786">.</span><span class="ident" id="6465787">Errorf</span><span class="op" id="6465793">(</span><span class="string" id="6465794">&#34;End&nbsp;of&nbsp;zip64&nbsp;archive&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6465828">,</span>&nbsp;<span class="ident" id="6465830">gotEnd</span><span class="op" id="6465836">,</span>&nbsp;<span class="ident" id="6465838">end</span><span class="op" id="6465841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6465844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6465847">err</span>&nbsp;<span class="op" id="6465851">=</span>&nbsp;<span class="ident" id="6465853">rc</span><span class="op" id="6465855">.</span><span class="ident" id="6465856">Close</span><span class="op" id="6465861">(</span><span class="op" id="6465862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6465865">if</span>&nbsp;<span class="ident" id="6465868">err</span>&nbsp;<span class="op" id="6465872">!=</span>&nbsp;<span class="builtintype" id="6465875">nil</span>&nbsp;<span class="op" id="6465879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6465883">t</span><span class="op" id="6465884">.</span><span class="ident" id="6465885">Fatal</span><span class="op" id="6465890">(</span><span class="string" id="6465891">&#34;closing:&#34;</span><span class="op" id="6465901">,</span>&nbsp;<span class="ident" id="6465903">err</span><span class="op" id="6465906">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6465909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6465912">if</span>&nbsp;<span class="ident" id="6465915">size</span>&nbsp;<span class="op" id="6465920">==</span>&nbsp;<span class="num" id="6465923">1</span><span class="op" id="6465924">&lt;&lt;</span><span class="num" id="6465926">32</span>&nbsp;<span class="op" id="6465929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6465933">if</span>&nbsp;<span class="ident" id="6465936">got</span><span class="op" id="6465939">,</span>&nbsp;<span class="ident" id="6465941">want</span>&nbsp;<span class="op" id="6465946">:=</span>&nbsp;<span class="ident" id="6465949">f0</span><span class="op" id="6465951">.</span><span class="ident" id="6465952">UncompressedSize</span><span class="op" id="6465968">,</span>&nbsp;<span class="builtintype" id="6465970">uint32</span><span class="op" id="6465976">(</span><span class="ident" id="6465977">uint32max</span><span class="op" id="6465986">)</span><span class="op" id="6465987">;</span>&nbsp;<span class="ident" id="6465989">got</span>&nbsp;<span class="op" id="6465993">!=</span>&nbsp;<span class="ident" id="6465996">want</span>&nbsp;<span class="op" id="6466001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6466006">t</span><span class="op" id="6466007">.</span><span class="ident" id="6466008">Errorf</span><span class="op" id="6466014">(</span><span class="string" id="6466015">&#34;UncompressedSize&nbsp;%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="6466045">,</span>&nbsp;<span class="ident" id="6466047">got</span><span class="op" id="6466050">,</span>&nbsp;<span class="ident" id="6466052">want</span><span class="op" id="6466056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6466060">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6466063">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6466067">if</span>&nbsp;<span class="ident" id="6466070">got</span><span class="op" id="6466073">,</span>&nbsp;<span class="ident" id="6466075">want</span>&nbsp;<span class="op" id="6466080">:=</span>&nbsp;<span class="ident" id="6466083">f0</span><span class="op" id="6466085">.</span><span class="ident" id="6466086">UncompressedSize64</span><span class="op" id="6466104">,</span>&nbsp;<span class="ident" id="6466106">uint64</span><span class="op" id="6466112">(</span><span class="ident" id="6466113">size</span><span class="op" id="6466117">)</span><span class="op" id="6466118">+</span><span class="ident" id="6466119">uint64</span><span class="op" id="6466125">(</span><span class="builtinfunc" id="6466126">len</span><span class="op" id="6466129">(</span><span class="ident" id="6466130">end</span><span class="op" id="6466133">)</span><span class="op" id="6466134">)</span><span class="op" id="6466135">;</span>&nbsp;<span class="ident" id="6466137">got</span>&nbsp;<span class="op" id="6466141">!=</span>&nbsp;<span class="ident" id="6466144">want</span>&nbsp;<span class="op" id="6466149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6466153">t</span><span class="op" id="6466154">.</span><span class="ident" id="6466155">Errorf</span><span class="op" id="6466161">(</span><span class="string" id="6466162">&#34;UncompressedSize64&nbsp;%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="6466194">,</span>&nbsp;<span class="ident" id="6466196">got</span><span class="op" id="6466199">,</span>&nbsp;<span class="ident" id="6466201">want</span><span class="op" id="6466205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6466208">}</span><br>
<span class="lineno">305</span><span class="op" id="6466210">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6466213">func</span>&nbsp;<span class="ident" id="6466218">testInvalidHeader</span><span class="op" id="6466235">(</span><span class="ident" id="6466236">h</span>&nbsp;<span class="op" id="6466238">*</span><span class="ident" id="6466239">FileHeader</span><span class="op" id="6466249">,</span>&nbsp;<span class="ident" id="6466251">t</span>&nbsp;<span class="op" id="6466253">*</span><span class="ident" id="6466254">testing</span><span class="op" id="6466261">.</span><span class="ident" id="6466262">T</span><span class="op" id="6466263">)</span>&nbsp;<span class="op" id="6466265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6466268">var</span>&nbsp;<span class="ident" id="6466272">buf</span>&nbsp;<span class="ident" id="6466276">bytes</span><span class="op" id="6466281">.</span><span class="ident" id="6466282">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6466290">z</span>&nbsp;<span class="op" id="6466292">:=</span>&nbsp;<span class="ident" id="6466295">NewWriter</span><span class="op" id="6466304">(</span><span class="op" id="6466305">&amp;</span><span class="ident" id="6466306">buf</span><span class="op" id="6466309">)</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6466313">f</span><span class="op" id="6466314">,</span>&nbsp;<span class="ident" id="6466316">err</span>&nbsp;<span class="op" id="6466320">:=</span>&nbsp;<span class="ident" id="6466323">z</span><span class="op" id="6466324">.</span><span class="ident" id="6466325">CreateHeader</span><span class="op" id="6466337">(</span><span class="ident" id="6466338">h</span><span class="op" id="6466339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6466342">if</span>&nbsp;<span class="ident" id="6466345">err</span>&nbsp;<span class="op" id="6466349">!=</span>&nbsp;<span class="builtintype" id="6466352">nil</span>&nbsp;<span class="op" id="6466356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6466360">t</span><span class="op" id="6466361">.</span><span class="ident" id="6466362">Fatalf</span><span class="op" id="6466368">(</span><span class="string" id="6466369">&#34;error&nbsp;creating&nbsp;header:&nbsp;%v&#34;</span><span class="op" id="6466396">,</span>&nbsp;<span class="ident" id="6466398">err</span><span class="op" id="6466401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6466404">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6466407">if</span>&nbsp;<span class="ident" id="6466410">_</span><span class="op" id="6466411">,</span>&nbsp;<span class="ident" id="6466413">err</span>&nbsp;<span class="op" id="6466417">:=</span>&nbsp;<span class="ident" id="6466420">f</span><span class="op" id="6466421">.</span><span class="ident" id="6466422">Write</span><span class="op" id="6466427">(</span><span class="op" id="6466428">[</span><span class="op" id="6466429">]</span><span class="builtintype" id="6466430">byte</span><span class="op" id="6466434">(</span><span class="string" id="6466435">&#34;hi&#34;</span><span class="op" id="6466439">)</span><span class="op" id="6466440">)</span><span class="op" id="6466441">;</span>&nbsp;<span class="ident" id="6466443">err</span>&nbsp;<span class="op" id="6466447">!=</span>&nbsp;<span class="builtintype" id="6466450">nil</span>&nbsp;<span class="op" id="6466454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6466458">t</span><span class="op" id="6466459">.</span><span class="ident" id="6466460">Fatalf</span><span class="op" id="6466466">(</span><span class="string" id="6466467">&#34;error&nbsp;writing&nbsp;content:&nbsp;%v&#34;</span><span class="op" id="6466494">,</span>&nbsp;<span class="ident" id="6466496">err</span><span class="op" id="6466499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6466502">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6466505">if</span>&nbsp;<span class="ident" id="6466508">err</span>&nbsp;<span class="op" id="6466512">:=</span>&nbsp;<span class="ident" id="6466515">z</span><span class="op" id="6466516">.</span><span class="ident" id="6466517">Close</span><span class="op" id="6466522">(</span><span class="op" id="6466523">)</span><span class="op" id="6466524">;</span>&nbsp;<span class="ident" id="6466526">err</span>&nbsp;<span class="op" id="6466530">!=</span>&nbsp;<span class="builtintype" id="6466533">nil</span>&nbsp;<span class="op" id="6466537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6466541">t</span><span class="op" id="6466542">.</span><span class="ident" id="6466543">Fatalf</span><span class="op" id="6466549">(</span><span class="string" id="6466550">&#34;error&nbsp;closing&nbsp;zip&nbsp;writer:&nbsp;%v&#34;</span><span class="op" id="6466580">,</span>&nbsp;<span class="ident" id="6466582">err</span><span class="op" id="6466585">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6466588">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6466592">b</span>&nbsp;<span class="op" id="6466594">:=</span>&nbsp;<span class="ident" id="6466597">buf</span><span class="op" id="6466600">.</span><span class="ident" id="6466601">Bytes</span><span class="op" id="6466606">(</span><span class="op" id="6466607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6466610">if</span>&nbsp;<span class="ident" id="6466613">_</span><span class="op" id="6466614">,</span>&nbsp;<span class="ident" id="6466616">err</span>&nbsp;<span class="op" id="6466620">=</span>&nbsp;<span class="ident" id="6466622">NewReader</span><span class="op" id="6466631">(</span><span class="ident" id="6466632">bytes</span><span class="op" id="6466637">.</span><span class="ident" id="6466638">NewReader</span><span class="op" id="6466647">(</span><span class="ident" id="6466648">b</span><span class="op" id="6466649">)</span><span class="op" id="6466650">,</span>&nbsp;<span class="ident" id="6466652">int64</span><span class="op" id="6466657">(</span><span class="builtinfunc" id="6466658">len</span><span class="op" id="6466661">(</span><span class="ident" id="6466662">b</span><span class="op" id="6466663">)</span><span class="op" id="6466664">)</span><span class="op" id="6466665">)</span><span class="op" id="6466666">;</span>&nbsp;<span class="ident" id="6466668">err</span>&nbsp;<span class="op" id="6466672">!=</span>&nbsp;<span class="ident" id="6466675">ErrFormat</span>&nbsp;<span class="op" id="6466685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6466689">t</span><span class="op" id="6466690">.</span><span class="ident" id="6466691">Fatalf</span><span class="op" id="6466697">(</span><span class="string" id="6466698">&#34;got&nbsp;%v,&nbsp;expected&nbsp;ErrFormat&#34;</span><span class="op" id="6466726">,</span>&nbsp;<span class="ident" id="6466728">err</span><span class="op" id="6466731">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6466734">}</span><br>
<span class="lineno"></span><span class="op" id="6466736">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6466739">func</span>&nbsp;<span class="ident" id="6466744">testValidHeader</span><span class="op" id="6466759">(</span><span class="ident" id="6466760">h</span>&nbsp;<span class="op" id="6466762">*</span><span class="ident" id="6466763">FileHeader</span><span class="op" id="6466773">,</span>&nbsp;<span class="ident" id="6466775">t</span>&nbsp;<span class="op" id="6466777">*</span><span class="ident" id="6466778">testing</span><span class="op" id="6466785">.</span><span class="ident" id="6466786">T</span><span class="op" id="6466787">)</span>&nbsp;<span class="op" id="6466789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6466792">var</span>&nbsp;<span class="ident" id="6466796">buf</span>&nbsp;<span class="ident" id="6466800">bytes</span><span class="op" id="6466805">.</span><span class="ident" id="6466806">Buffer</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6466814">z</span>&nbsp;<span class="op" id="6466816">:=</span>&nbsp;<span class="ident" id="6466819">NewWriter</span><span class="op" id="6466828">(</span><span class="op" id="6466829">&amp;</span><span class="ident" id="6466830">buf</span><span class="op" id="6466833">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6466837">f</span><span class="op" id="6466838">,</span>&nbsp;<span class="ident" id="6466840">err</span>&nbsp;<span class="op" id="6466844">:=</span>&nbsp;<span class="ident" id="6466847">z</span><span class="op" id="6466848">.</span><span class="ident" id="6466849">CreateHeader</span><span class="op" id="6466861">(</span><span class="ident" id="6466862">h</span><span class="op" id="6466863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6466866">if</span>&nbsp;<span class="ident" id="6466869">err</span>&nbsp;<span class="op" id="6466873">!=</span>&nbsp;<span class="builtintype" id="6466876">nil</span>&nbsp;<span class="op" id="6466880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6466884">t</span><span class="op" id="6466885">.</span><span class="ident" id="6466886">Fatalf</span><span class="op" id="6466892">(</span><span class="string" id="6466893">&#34;error&nbsp;creating&nbsp;header:&nbsp;%v&#34;</span><span class="op" id="6466920">,</span>&nbsp;<span class="ident" id="6466922">err</span><span class="op" id="6466925">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6466928">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6466931">if</span>&nbsp;<span class="ident" id="6466934">_</span><span class="op" id="6466935">,</span>&nbsp;<span class="ident" id="6466937">err</span>&nbsp;<span class="op" id="6466941">:=</span>&nbsp;<span class="ident" id="6466944">f</span><span class="op" id="6466945">.</span><span class="ident" id="6466946">Write</span><span class="op" id="6466951">(</span><span class="op" id="6466952">[</span><span class="op" id="6466953">]</span><span class="builtintype" id="6466954">byte</span><span class="op" id="6466958">(</span><span class="string" id="6466959">&#34;hi&#34;</span><span class="op" id="6466963">)</span><span class="op" id="6466964">)</span><span class="op" id="6466965">;</span>&nbsp;<span class="ident" id="6466967">err</span>&nbsp;<span class="op" id="6466971">!=</span>&nbsp;<span class="builtintype" id="6466974">nil</span>&nbsp;<span class="op" id="6466978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6466982">t</span><span class="op" id="6466983">.</span><span class="ident" id="6466984">Fatalf</span><span class="op" id="6466990">(</span><span class="string" id="6466991">&#34;error&nbsp;writing&nbsp;content:&nbsp;%v&#34;</span><span class="op" id="6467018">,</span>&nbsp;<span class="ident" id="6467020">err</span><span class="op" id="6467023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6467026">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6467029">if</span>&nbsp;<span class="ident" id="6467032">err</span>&nbsp;<span class="op" id="6467036">:=</span>&nbsp;<span class="ident" id="6467039">z</span><span class="op" id="6467040">.</span><span class="ident" id="6467041">Close</span><span class="op" id="6467046">(</span><span class="op" id="6467047">)</span><span class="op" id="6467048">;</span>&nbsp;<span class="ident" id="6467050">err</span>&nbsp;<span class="op" id="6467054">!=</span>&nbsp;<span class="builtintype" id="6467057">nil</span>&nbsp;<span class="op" id="6467061">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6467065">t</span><span class="op" id="6467066">.</span><span class="ident" id="6467067">Fatalf</span><span class="op" id="6467073">(</span><span class="string" id="6467074">&#34;error&nbsp;closing&nbsp;zip&nbsp;writer:&nbsp;%v&#34;</span><span class="op" id="6467104">,</span>&nbsp;<span class="ident" id="6467106">err</span><span class="op" id="6467109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6467112">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6467116">b</span>&nbsp;<span class="op" id="6467118">:=</span>&nbsp;<span class="ident" id="6467121">buf</span><span class="op" id="6467124">.</span><span class="ident" id="6467125">Bytes</span><span class="op" id="6467130">(</span><span class="op" id="6467131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6467134">if</span>&nbsp;<span class="ident" id="6467137">_</span><span class="op" id="6467138">,</span>&nbsp;<span class="ident" id="6467140">err</span>&nbsp;<span class="op" id="6467144">=</span>&nbsp;<span class="ident" id="6467146">NewReader</span><span class="op" id="6467155">(</span><span class="ident" id="6467156">bytes</span><span class="op" id="6467161">.</span><span class="ident" id="6467162">NewReader</span><span class="op" id="6467171">(</span><span class="ident" id="6467172">b</span><span class="op" id="6467173">)</span><span class="op" id="6467174">,</span>&nbsp;<span class="ident" id="6467176">int64</span><span class="op" id="6467181">(</span><span class="builtinfunc" id="6467182">len</span><span class="op" id="6467185">(</span><span class="ident" id="6467186">b</span><span class="op" id="6467187">)</span><span class="op" id="6467188">)</span><span class="op" id="6467189">)</span><span class="op" id="6467190">;</span>&nbsp;<span class="ident" id="6467192">err</span>&nbsp;<span class="op" id="6467196">!=</span>&nbsp;<span class="builtintype" id="6467199">nil</span>&nbsp;<span class="op" id="6467203">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6467207">t</span><span class="op" id="6467208">.</span><span class="ident" id="6467209">Fatalf</span><span class="op" id="6467215">(</span><span class="string" id="6467216">&#34;got&nbsp;%v,&nbsp;expected&nbsp;nil&#34;</span><span class="op" id="6467238">,</span>&nbsp;<span class="ident" id="6467240">err</span><span class="op" id="6467243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6467246">}</span><br>
<span class="lineno"></span><span class="op" id="6467248">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6467251">//&nbsp;Issue&nbsp;4302.</span><br>
<span class="lineno">350</span><span class="keyword" id="6467266">func</span>&nbsp;<span class="ident" id="6467271">TestHeaderInvalidTagAndSize</span><span class="op" id="6467298">(</span><span class="ident" id="6467299">t</span>&nbsp;<span class="op" id="6467301">*</span><span class="ident" id="6467302">testing</span><span class="op" id="6467309">.</span><span class="ident" id="6467310">T</span><span class="op" id="6467311">)</span>&nbsp;<span class="op" id="6467313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6467316">const</span>&nbsp;<span class="ident" id="6467322">timeFormat</span>&nbsp;<span class="op" id="6467333">=</span>&nbsp;<span class="string" id="6467335">&#34;20060102T150405.000.txt&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6467363">ts</span>&nbsp;<span class="op" id="6467366">:=</span>&nbsp;<span class="ident" id="6467369">time</span><span class="op" id="6467373">.</span><span class="ident" id="6467374">Now</span><span class="op" id="6467377">(</span><span class="op" id="6467378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6467381">filename</span>&nbsp;<span class="op" id="6467390">:=</span>&nbsp;<span class="ident" id="6467393">ts</span><span class="op" id="6467395">.</span><span class="ident" id="6467396">Format</span><span class="op" id="6467402">(</span><span class="ident" id="6467403">timeFormat</span><span class="op" id="6467413">)</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6467417">h</span>&nbsp;<span class="op" id="6467419">:=</span>&nbsp;<span class="ident" id="6467422">FileHeader</span><span class="op" id="6467432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6467436">Name</span><span class="op" id="6467440">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6467444">filename</span><span class="op" id="6467452">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6467456">Method</span><span class="op" id="6467462">:</span>&nbsp;<span class="ident" id="6467464">Deflate</span><span class="op" id="6467471">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6467475">Extra</span><span class="op" id="6467480">:</span>&nbsp;&nbsp;<span class="op" id="6467483">[</span><span class="op" id="6467484">]</span><span class="builtintype" id="6467485">byte</span><span class="op" id="6467489">(</span><span class="ident" id="6467490">ts</span><span class="op" id="6467492">.</span><span class="ident" id="6467493">Format</span><span class="op" id="6467499">(</span><span class="ident" id="6467500">time</span><span class="op" id="6467504">.</span><span class="ident" id="6467505">RFC3339Nano</span><span class="op" id="6467516">)</span><span class="op" id="6467517">)</span><span class="op" id="6467518">,</span>&nbsp;<span class="comment" id="6467520">//&nbsp;missing&nbsp;tag&nbsp;and&nbsp;len</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6467544">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6467547">h</span><span class="op" id="6467548">.</span><span class="ident" id="6467549">SetModTime</span><span class="op" id="6467559">(</span><span class="ident" id="6467560">ts</span><span class="op" id="6467562">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6467566">testInvalidHeader</span><span class="op" id="6467583">(</span><span class="op" id="6467584">&amp;</span><span class="ident" id="6467585">h</span><span class="op" id="6467586">,</span>&nbsp;<span class="ident" id="6467588">t</span><span class="op" id="6467589">)</span><br>
<span class="lineno"></span><span class="op" id="6467591">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="keyword" id="6467594">func</span>&nbsp;<span class="ident" id="6467599">TestHeaderTooShort</span><span class="op" id="6467617">(</span><span class="ident" id="6467618">t</span>&nbsp;<span class="op" id="6467620">*</span><span class="ident" id="6467621">testing</span><span class="op" id="6467628">.</span><span class="ident" id="6467629">T</span><span class="op" id="6467630">)</span>&nbsp;<span class="op" id="6467632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6467635">h</span>&nbsp;<span class="op" id="6467637">:=</span>&nbsp;<span class="ident" id="6467640">FileHeader</span><span class="op" id="6467650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6467654">Name</span><span class="op" id="6467658">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="6467662">&#34;foo.txt&#34;</span><span class="op" id="6467671">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6467675">Method</span><span class="op" id="6467681">:</span>&nbsp;<span class="ident" id="6467683">Deflate</span><span class="op" id="6467690">,</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6467694">Extra</span><span class="op" id="6467699">:</span>&nbsp;&nbsp;<span class="op" id="6467702">[</span><span class="op" id="6467703">]</span><span class="builtintype" id="6467704">byte</span><span class="op" id="6467708">{</span><span class="ident" id="6467709">zip64ExtraId</span><span class="op" id="6467721">}</span><span class="op" id="6467722">,</span>&nbsp;<span class="comment" id="6467724">//&nbsp;missing&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6467741">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6467744">testInvalidHeader</span><span class="op" id="6467761">(</span><span class="op" id="6467762">&amp;</span><span class="ident" id="6467763">h</span><span class="op" id="6467764">,</span>&nbsp;<span class="ident" id="6467766">t</span><span class="op" id="6467767">)</span><br>
<span class="lineno"></span><span class="op" id="6467769">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">375</span><span class="comment" id="6467772">//&nbsp;Issue&nbsp;4393.&nbsp;It&nbsp;is&nbsp;valid&nbsp;to&nbsp;have&nbsp;an&nbsp;extra&nbsp;data&nbsp;header</span><br>
<span class="lineno"></span><span class="comment" id="6467828">//&nbsp;which&nbsp;contains&nbsp;no&nbsp;body.</span><br>
<span class="lineno"></span><span class="keyword" id="6467855">func</span>&nbsp;<span class="ident" id="6467860">TestZeroLengthHeader</span><span class="op" id="6467880">(</span><span class="ident" id="6467881">t</span>&nbsp;<span class="op" id="6467883">*</span><span class="ident" id="6467884">testing</span><span class="op" id="6467891">.</span><span class="ident" id="6467892">T</span><span class="op" id="6467893">)</span>&nbsp;<span class="op" id="6467895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6467898">h</span>&nbsp;<span class="op" id="6467900">:=</span>&nbsp;<span class="ident" id="6467903">FileHeader</span><span class="op" id="6467913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6467917">Name</span><span class="op" id="6467921">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="6467925">&#34;extadata.txt&#34;</span><span class="op" id="6467939">,</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6467943">Method</span><span class="op" id="6467949">:</span>&nbsp;<span class="ident" id="6467951">Deflate</span><span class="op" id="6467958">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6467962">Extra</span><span class="op" id="6467967">:</span>&nbsp;<span class="op" id="6467969">[</span><span class="op" id="6467970">]</span><span class="builtintype" id="6467971">byte</span><span class="op" id="6467975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6467980">85</span><span class="op" id="6467982">,</span>&nbsp;<span class="num" id="6467984">84</span><span class="op" id="6467986">,</span>&nbsp;<span class="num" id="6467988">5</span><span class="op" id="6467989">,</span>&nbsp;<span class="num" id="6467991">0</span><span class="op" id="6467992">,</span>&nbsp;<span class="num" id="6467994">3</span><span class="op" id="6467995">,</span>&nbsp;<span class="num" id="6467997">154</span><span class="op" id="6468000">,</span>&nbsp;<span class="num" id="6468002">144</span><span class="op" id="6468005">,</span>&nbsp;<span class="num" id="6468007">195</span><span class="op" id="6468010">,</span>&nbsp;<span class="num" id="6468012">77</span><span class="op" id="6468014">,</span>&nbsp;<span class="comment" id="6468016">//&nbsp;tag&nbsp;21589&nbsp;size&nbsp;5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6468039">85</span><span class="op" id="6468041">,</span>&nbsp;<span class="num" id="6468043">120</span><span class="op" id="6468046">,</span>&nbsp;<span class="num" id="6468048">0</span><span class="op" id="6468049">,</span>&nbsp;<span class="num" id="6468051">0</span><span class="op" id="6468052">,</span>&nbsp;<span class="comment" id="6468054">//&nbsp;tag&nbsp;30805&nbsp;size&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6468076">}</span><span class="op" id="6468077">,</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6468080">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6468083">testValidHeader</span><span class="op" id="6468098">(</span><span class="op" id="6468099">&amp;</span><span class="ident" id="6468100">h</span><span class="op" id="6468101">,</span>&nbsp;<span class="ident" id="6468103">t</span><span class="op" id="6468104">)</span><br>
<span class="lineno"></span><span class="op" id="6468106">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6468109">//&nbsp;Just&nbsp;benchmarking&nbsp;how&nbsp;fast&nbsp;the&nbsp;Zip64&nbsp;test&nbsp;above&nbsp;is.&nbsp;Not&nbsp;related&nbsp;to</span><br>
<span class="lineno">390</span><span class="comment" id="6468179">//&nbsp;our&nbsp;zip&nbsp;performance,&nbsp;since&nbsp;the&nbsp;test&nbsp;above&nbsp;disabled&nbsp;CRC32&nbsp;and&nbsp;flate.</span><br>
<span class="lineno"></span><span class="keyword" id="6468250">func</span>&nbsp;<span class="ident" id="6468255">BenchmarkZip64Test</span><span class="op" id="6468273">(</span><span class="ident" id="6468274">b</span>&nbsp;<span class="op" id="6468276">*</span><span class="ident" id="6468277">testing</span><span class="op" id="6468284">.</span><span class="ident" id="6468285">B</span><span class="op" id="6468286">)</span>&nbsp;<span class="op" id="6468288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6468291">for</span>&nbsp;<span class="ident" id="6468295">i</span>&nbsp;<span class="op" id="6468297">:=</span>&nbsp;<span class="num" id="6468300">0</span><span class="op" id="6468301">;</span>&nbsp;<span class="ident" id="6468303">i</span>&nbsp;<span class="op" id="6468305">&lt;</span>&nbsp;<span class="ident" id="6468307">b</span><span class="op" id="6468308">.</span><span class="ident" id="6468309">N</span><span class="op" id="6468310">;</span>&nbsp;<span class="ident" id="6468312">i</span><span class="op" id="6468313">++</span>&nbsp;<span class="op" id="6468316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6468320">testZip64</span><span class="op" id="6468329">(</span><span class="ident" id="6468330">b</span><span class="op" id="6468331">,</span>&nbsp;<span class="num" id="6468333">1</span><span class="op" id="6468334">&lt;&lt;</span><span class="num" id="6468336">26</span><span class="op" id="6468338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6468341">}</span><br>
<span class="lineno">395</span><span class="op" id="6468343">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
