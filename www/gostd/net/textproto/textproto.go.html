<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/textproto</h2>
<ul>
<li><a href="/gostd/net/textproto/header.go.html">header.go</a></li>
<li><a href="/gostd/net/textproto/pipeline.go.html">pipeline.go</a></li>
<li><a href="/gostd/net/textproto/reader.go.html">reader.go</a></li>
<li><a href="/gostd/net/textproto/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/net/textproto/textproto.go.html" class="current">textproto.go</a></li>
<li><a href="/gostd/net/textproto/writer.go.html">writer.go</a></li>
<li><a href="/gostd/net/textproto/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4306846">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4306902">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4306956">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4307007">//&nbsp;Package&nbsp;textproto&nbsp;implements&nbsp;generic&nbsp;support&nbsp;for&nbsp;text-based&nbsp;request/response</span><br>
<span class="lineno"></span><span class="comment" id="4307087">//&nbsp;protocols&nbsp;in&nbsp;the&nbsp;style&nbsp;of&nbsp;HTTP,&nbsp;NNTP,&nbsp;and&nbsp;SMTP.</span><br>
<span class="lineno"></span><span class="comment" id="4307138">//</span><br>
<span class="lineno"></span><span class="comment" id="4307141">//&nbsp;The&nbsp;package&nbsp;provides:</span><br>
<span class="lineno"></span><span class="comment" id="4307166">//</span><br>
<span class="lineno">10</span><span class="comment" id="4307169">//&nbsp;Error,&nbsp;which&nbsp;represents&nbsp;a&nbsp;numeric&nbsp;error&nbsp;response&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="4307226">//&nbsp;a&nbsp;server.</span><br>
<span class="lineno"></span><span class="comment" id="4307239">//</span><br>
<span class="lineno"></span><span class="comment" id="4307242">//&nbsp;Pipeline,&nbsp;to&nbsp;manage&nbsp;pipelined&nbsp;requests&nbsp;and&nbsp;responses</span><br>
<span class="lineno"></span><span class="comment" id="4307298">//&nbsp;in&nbsp;a&nbsp;client.</span><br>
<span class="lineno">15</span><span class="comment" id="4307314">//</span><br>
<span class="lineno"></span><span class="comment" id="4307317">//&nbsp;Reader,&nbsp;to&nbsp;read&nbsp;numeric&nbsp;response&nbsp;code&nbsp;lines,</span><br>
<span class="lineno"></span><span class="comment" id="4307365">//&nbsp;key:&nbsp;value&nbsp;headers,&nbsp;lines&nbsp;wrapped&nbsp;with&nbsp;leading&nbsp;spaces</span><br>
<span class="lineno"></span><span class="comment" id="4307422">//&nbsp;on&nbsp;continuation&nbsp;lines,&nbsp;and&nbsp;whole&nbsp;text&nbsp;blocks&nbsp;ending</span><br>
<span class="lineno"></span><span class="comment" id="4307477">//&nbsp;with&nbsp;a&nbsp;dot&nbsp;on&nbsp;a&nbsp;line&nbsp;by&nbsp;itself.</span><br>
<span class="lineno">20</span><span class="comment" id="4307512">//</span><br>
<span class="lineno"></span><span class="comment" id="4307515">//&nbsp;Writer,&nbsp;to&nbsp;write&nbsp;dot-encoded&nbsp;text&nbsp;blocks.</span><br>
<span class="lineno"></span><span class="comment" id="4307560">//</span><br>
<span class="lineno"></span><span class="comment" id="4307563">//&nbsp;Conn,&nbsp;a&nbsp;convenient&nbsp;packaging&nbsp;of&nbsp;Reader,&nbsp;Writer,&nbsp;and&nbsp;Pipeline&nbsp;for&nbsp;use</span><br>
<span class="lineno"></span><span class="comment" id="4307635">//&nbsp;with&nbsp;a&nbsp;single&nbsp;network&nbsp;connection.</span><br>
<span class="lineno">25</span><span class="comment" id="4307672">//</span><br>
<span class="lineno"></span><span class="keyword" id="4307675">package</span>&nbsp;<span class="ident" id="4307683">textproto</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4307694">import</span>&nbsp;<span class="op" id="4307701">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4307704">&#34;bufio&#34;</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4307713">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4307720">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4307726">&#34;net&#34;</span><br>
<span class="lineno"></span><span class="op" id="4307732">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="4307735">//&nbsp;An&nbsp;Error&nbsp;represents&nbsp;a&nbsp;numeric&nbsp;error&nbsp;response&nbsp;from&nbsp;a&nbsp;server.</span><br>
<span class="lineno"></span><span class="keyword" id="4307798">type</span>&nbsp;<span class="ident" id="4307803">Error</span>&nbsp;<span class="keyword" id="4307809">struct</span>&nbsp;<span class="op" id="4307816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4307819">Code</span>&nbsp;<span class="builtintype" id="4307824">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4307829">Msg</span>&nbsp;&nbsp;<span class="builtintype" id="4307834">string</span><br>
<span class="lineno"></span><span class="op" id="4307841">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="4307844">func</span>&nbsp;<span class="op" id="4307849">(</span><span class="ident" id="4307850">e</span>&nbsp;<span class="op" id="4307852">*</span><span class="ident" id="4307853">Error</span><span class="op" id="4307858">)</span>&nbsp;<span class="ident" id="4307860">Error</span><span class="op" id="4307865">(</span><span class="op" id="4307866">)</span>&nbsp;<span class="builtintype" id="4307868">string</span>&nbsp;<span class="op" id="4307875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4307878">return</span>&nbsp;<span class="ident" id="4307885">fmt</span><span class="op" id="4307888">.</span><span class="ident" id="4307889">Sprintf</span><span class="op" id="4307896">(</span><span class="string" id="4307897">&#34;%03d&nbsp;%s&#34;</span><span class="op" id="4307906">,</span>&nbsp;<span class="ident" id="4307908">e</span><span class="op" id="4307909">.</span><span class="ident" id="4307910">Code</span><span class="op" id="4307914">,</span>&nbsp;<span class="ident" id="4307916">e</span><span class="op" id="4307917">.</span><span class="ident" id="4307918">Msg</span><span class="op" id="4307921">)</span><br>
<span class="lineno"></span><span class="op" id="4307923">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="4307926">//&nbsp;A&nbsp;ProtocolError&nbsp;describes&nbsp;a&nbsp;protocol&nbsp;violation&nbsp;such</span><br>
<span class="lineno"></span><span class="comment" id="4307981">//&nbsp;as&nbsp;an&nbsp;invalid&nbsp;response&nbsp;or&nbsp;a&nbsp;hung-up&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="4308032">type</span>&nbsp;<span class="ident" id="4308037">ProtocolError</span>&nbsp;<span class="builtintype" id="4308051">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4308059">func</span>&nbsp;<span class="op" id="4308064">(</span><span class="ident" id="4308065">p</span>&nbsp;<span class="ident" id="4308067">ProtocolError</span><span class="op" id="4308080">)</span>&nbsp;<span class="ident" id="4308082">Error</span><span class="op" id="4308087">(</span><span class="op" id="4308088">)</span>&nbsp;<span class="builtintype" id="4308090">string</span>&nbsp;<span class="op" id="4308097">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4308100">return</span>&nbsp;<span class="builtintype" id="4308107">string</span><span class="op" id="4308113">(</span><span class="ident" id="4308114">p</span><span class="op" id="4308115">)</span><br>
<span class="lineno"></span><span class="op" id="4308117">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4308120">//&nbsp;A&nbsp;Conn&nbsp;represents&nbsp;a&nbsp;textual&nbsp;network&nbsp;protocol&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="4308180">//&nbsp;It&nbsp;consists&nbsp;of&nbsp;a&nbsp;Reader&nbsp;and&nbsp;Writer&nbsp;to&nbsp;manage&nbsp;I/O</span><br>
<span class="lineno">55</span><span class="comment" id="4308232">//&nbsp;and&nbsp;a&nbsp;Pipeline&nbsp;to&nbsp;sequence&nbsp;concurrent&nbsp;requests&nbsp;on&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="4308301">//&nbsp;These&nbsp;embedded&nbsp;types&nbsp;carry&nbsp;methods&nbsp;with&nbsp;them;</span><br>
<span class="lineno"></span><span class="comment" id="4308350">//&nbsp;see&nbsp;the&nbsp;documentation&nbsp;of&nbsp;those&nbsp;types&nbsp;for&nbsp;details.</span><br>
<span class="lineno"></span><span class="keyword" id="4308403">type</span>&nbsp;<span class="ident" id="4308408">Conn</span>&nbsp;<span class="keyword" id="4308413">struct</span>&nbsp;<span class="op" id="4308420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4308423">Reader</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4308431">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4308439">Pipeline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4308449">conn</span>&nbsp;<span class="ident" id="4308454">io</span><span class="op" id="4308456">.</span><span class="ident" id="4308457">ReadWriteCloser</span><br>
<span class="lineno"></span><span class="op" id="4308473">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="4308476">//&nbsp;NewConn&nbsp;returns&nbsp;a&nbsp;new&nbsp;Conn&nbsp;using&nbsp;conn&nbsp;for&nbsp;I/O.</span><br>
<span class="lineno"></span><span class="keyword" id="4308526">func</span>&nbsp;<span class="ident" id="4308531">NewConn</span><span class="op" id="4308538">(</span><span class="ident" id="4308539">conn</span>&nbsp;<span class="ident" id="4308544">io</span><span class="op" id="4308546">.</span><span class="ident" id="4308547">ReadWriteCloser</span><span class="op" id="4308562">)</span>&nbsp;<span class="op" id="4308564">*</span><span class="ident" id="4308565">Conn</span>&nbsp;<span class="op" id="4308570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4308573">return</span>&nbsp;<span class="op" id="4308580">&amp;</span><span class="ident" id="4308581">Conn</span><span class="op" id="4308585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4308589">Reader</span><span class="op" id="4308595">:</span>&nbsp;<span class="ident" id="4308597">Reader</span><span class="op" id="4308603">{</span><span class="ident" id="4308604">R</span><span class="op" id="4308605">:</span>&nbsp;<span class="ident" id="4308607">bufio</span><span class="op" id="4308612">.</span><span class="ident" id="4308613">NewReader</span><span class="op" id="4308622">(</span><span class="ident" id="4308623">conn</span><span class="op" id="4308627">)</span><span class="op" id="4308628">}</span><span class="op" id="4308629">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4308633">Writer</span><span class="op" id="4308639">:</span>&nbsp;<span class="ident" id="4308641">Writer</span><span class="op" id="4308647">{</span><span class="ident" id="4308648">W</span><span class="op" id="4308649">:</span>&nbsp;<span class="ident" id="4308651">bufio</span><span class="op" id="4308656">.</span><span class="ident" id="4308657">NewWriter</span><span class="op" id="4308666">(</span><span class="ident" id="4308667">conn</span><span class="op" id="4308671">)</span><span class="op" id="4308672">}</span><span class="op" id="4308673">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4308677">conn</span><span class="op" id="4308681">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4308685">conn</span><span class="op" id="4308689">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4308692">}</span><br>
<span class="lineno"></span><span class="op" id="4308694">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4308697">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;connection.</span><br>
<span class="lineno">75</span><span class="keyword" id="4308729">func</span>&nbsp;<span class="op" id="4308734">(</span><span class="ident" id="4308735">c</span>&nbsp;<span class="op" id="4308737">*</span><span class="ident" id="4308738">Conn</span><span class="op" id="4308742">)</span>&nbsp;<span class="ident" id="4308744">Close</span><span class="op" id="4308749">(</span><span class="op" id="4308750">)</span>&nbsp;<span class="builtintype" id="4308752">error</span>&nbsp;<span class="op" id="4308758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4308761">return</span>&nbsp;<span class="ident" id="4308768">c</span><span class="op" id="4308769">.</span><span class="ident" id="4308770">conn</span><span class="op" id="4308774">.</span><span class="ident" id="4308775">Close</span><span class="op" id="4308780">(</span><span class="op" id="4308781">)</span><br>
<span class="lineno"></span><span class="op" id="4308783">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4308786">//&nbsp;Dial&nbsp;connects&nbsp;to&nbsp;the&nbsp;given&nbsp;address&nbsp;on&nbsp;the&nbsp;given&nbsp;network&nbsp;using&nbsp;net.Dial</span><br>
<span class="lineno">80</span><span class="comment" id="4308860">//&nbsp;and&nbsp;then&nbsp;returns&nbsp;a&nbsp;new&nbsp;Conn&nbsp;for&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="4308911">func</span>&nbsp;<span class="ident" id="4308916">Dial</span><span class="op" id="4308920">(</span><span class="ident" id="4308921">network</span><span class="op" id="4308928">,</span>&nbsp;<span class="ident" id="4308930">addr</span>&nbsp;<span class="builtintype" id="4308935">string</span><span class="op" id="4308941">)</span>&nbsp;<span class="op" id="4308943">(</span><span class="op" id="4308944">*</span><span class="ident" id="4308945">Conn</span><span class="op" id="4308949">,</span>&nbsp;<span class="builtintype" id="4308951">error</span><span class="op" id="4308956">)</span>&nbsp;<span class="op" id="4308958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4308961">c</span><span class="op" id="4308962">,</span>&nbsp;<span class="ident" id="4308964">err</span>&nbsp;<span class="op" id="4308968">:=</span>&nbsp;<span class="ident" id="4308971">net</span><span class="op" id="4308974">.</span><span class="ident" id="4308975">Dial</span><span class="op" id="4308979">(</span><span class="ident" id="4308980">network</span><span class="op" id="4308987">,</span>&nbsp;<span class="ident" id="4308989">addr</span><span class="op" id="4308993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4308996">if</span>&nbsp;<span class="ident" id="4308999">err</span>&nbsp;<span class="op" id="4309003">!=</span>&nbsp;<span class="ident" id="4309006">nil</span>&nbsp;<span class="op" id="4309010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4309014">return</span>&nbsp;<span class="ident" id="4309021">nil</span><span class="op" id="4309024">,</span>&nbsp;<span class="ident" id="4309026">err</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4309031">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4309034">return</span>&nbsp;<span class="ident" id="4309041">NewConn</span><span class="op" id="4309048">(</span><span class="ident" id="4309049">c</span><span class="op" id="4309050">)</span><span class="op" id="4309051">,</span>&nbsp;<span class="ident" id="4309053">nil</span><br>
<span class="lineno"></span><span class="op" id="4309057">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4309060">//&nbsp;Cmd&nbsp;is&nbsp;a&nbsp;convenience&nbsp;method&nbsp;that&nbsp;sends&nbsp;a&nbsp;command&nbsp;after</span><br>
<span class="lineno">90</span><span class="comment" id="4309118">//&nbsp;waiting&nbsp;its&nbsp;turn&nbsp;in&nbsp;the&nbsp;pipeline.&nbsp;&nbsp;The&nbsp;command&nbsp;text&nbsp;is&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4309180">//&nbsp;result&nbsp;of&nbsp;formatting&nbsp;format&nbsp;with&nbsp;args&nbsp;and&nbsp;appending&nbsp;\r\n.</span><br>
<span class="lineno"></span><span class="comment" id="4309241">//&nbsp;Cmd&nbsp;returns&nbsp;the&nbsp;id&nbsp;of&nbsp;the&nbsp;command,&nbsp;for&nbsp;use&nbsp;with&nbsp;StartResponse&nbsp;and&nbsp;EndResponse.</span><br>
<span class="lineno"></span><span class="comment" id="4309323">//</span><br>
<span class="lineno"></span><span class="comment" id="4309326">//&nbsp;For&nbsp;example,&nbsp;a&nbsp;client&nbsp;might&nbsp;run&nbsp;a&nbsp;HELP&nbsp;command&nbsp;that&nbsp;returns&nbsp;a&nbsp;dot-body</span><br>
<span class="lineno">95</span><span class="comment" id="4309400">//&nbsp;by&nbsp;using:</span><br>
<span class="lineno"></span><span class="comment" id="4309413">//</span><br>
<span class="lineno"></span><span class="comment" id="4309416">//&nbsp;&nbsp;&nbsp;&nbspid,&nbsp;err&nbsp;:=&nbsp;c.Cmd(&#34;HELP&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="4309444">//&nbsp;&nbsp;&nbsp;&nbspif&nbsp;err&nbsp;!=&nbsp;nil&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="4309463">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;nil,&nbsp;err</span><br>
<span class="lineno">100</span><span class="comment" id="4309483">//&nbsp;&nbsp;&nbsp;&nbsp}</span><br>
<span class="lineno"></span><span class="comment" id="4309488">//</span><br>
<span class="lineno"></span><span class="comment" id="4309491">//&nbsp;&nbsp;&nbsp;&nbspc.StartResponse(id)</span><br>
<span class="lineno"></span><span class="comment" id="4309514">//&nbsp;&nbsp;&nbsp;&nbspdefer&nbsp;c.EndResponse(id)</span><br>
<span class="lineno"></span><span class="comment" id="4309541">//</span><br>
<span class="lineno">105</span><span class="comment" id="4309544">//&nbsp;&nbsp;&nbsp;&nbspif&nbsp;_,&nbsp;_,&nbsp;err&nbsp;=&nbsp;c.ReadCodeLine(110);&nbsp;err&nbsp;!=&nbsp;nil&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="4309596">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;nil,&nbsp;err</span><br>
<span class="lineno"></span><span class="comment" id="4309616">//&nbsp;&nbsp;&nbsp;&nbsp}</span><br>
<span class="lineno"></span><span class="comment" id="4309621">//&nbsp;&nbsp;&nbsp;&nbsptext,&nbsp;err&nbsp;:=&nbsp;c.ReadDotBytes()</span><br>
<span class="lineno"></span><span class="comment" id="4309654">//&nbsp;&nbsp;&nbsp;&nbspif&nbsp;err&nbsp;!=&nbsp;nil&nbsp;{</span><br>
<span class="lineno">110</span><span class="comment" id="4309673">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;nil,&nbsp;err</span><br>
<span class="lineno"></span><span class="comment" id="4309693">//&nbsp;&nbsp;&nbsp;&nbsp}</span><br>
<span class="lineno"></span><span class="comment" id="4309698">//&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;c.ReadCodeLine(250)</span><br>
<span class="lineno"></span><span class="comment" id="4309728">//</span><br>
<span class="lineno"></span><span class="keyword" id="4309731">func</span>&nbsp;<span class="op" id="4309736">(</span><span class="ident" id="4309737">c</span>&nbsp;<span class="op" id="4309739">*</span><span class="ident" id="4309740">Conn</span><span class="op" id="4309744">)</span>&nbsp;<span class="ident" id="4309746">Cmd</span><span class="op" id="4309749">(</span><span class="ident" id="4309750">format</span>&nbsp;<span class="builtintype" id="4309757">string</span><span class="op" id="4309763">,</span>&nbsp;<span class="ident" id="4309765">args</span>&nbsp;<span class="op" id="4309770">...</span><span class="keyword" id="4309773">interface</span><span class="op" id="4309782">{</span><span class="op" id="4309783">}</span><span class="op" id="4309784">)</span>&nbsp;<span class="op" id="4309786">(</span><span class="ident" id="4309787">id</span>&nbsp;<span class="builtintype" id="4309790">uint</span><span class="op" id="4309794">,</span>&nbsp;<span class="ident" id="4309796">err</span>&nbsp;<span class="builtintype" id="4309800">error</span><span class="op" id="4309805">)</span>&nbsp;<span class="op" id="4309807">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4309810">id</span>&nbsp;<span class="op" id="4309813">=</span>&nbsp;<span class="ident" id="4309815">c</span><span class="op" id="4309816">.</span><span class="ident" id="4309817">Next</span><span class="op" id="4309821">(</span><span class="op" id="4309822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4309825">c</span><span class="op" id="4309826">.</span><span class="ident" id="4309827">StartRequest</span><span class="op" id="4309839">(</span><span class="ident" id="4309840">id</span><span class="op" id="4309842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4309845">err</span>&nbsp;<span class="op" id="4309849">=</span>&nbsp;<span class="ident" id="4309851">c</span><span class="op" id="4309852">.</span><span class="ident" id="4309853">PrintfLine</span><span class="op" id="4309863">(</span><span class="ident" id="4309864">format</span><span class="op" id="4309870">,</span>&nbsp;<span class="ident" id="4309872">args</span><span class="op" id="4309876">...</span><span class="op" id="4309879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4309882">c</span><span class="op" id="4309883">.</span><span class="ident" id="4309884">EndRequest</span><span class="op" id="4309894">(</span><span class="ident" id="4309895">id</span><span class="op" id="4309897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4309900">if</span>&nbsp;<span class="ident" id="4309903">err</span>&nbsp;<span class="op" id="4309907">!=</span>&nbsp;<span class="ident" id="4309910">nil</span>&nbsp;<span class="op" id="4309914">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4309918">return</span>&nbsp;<span class="num" id="4309925">0</span><span class="op" id="4309926">,</span>&nbsp;<span class="ident" id="4309928">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4309933">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4309936">return</span>&nbsp;<span class="ident" id="4309943">id</span><span class="op" id="4309945">,</span>&nbsp;<span class="ident" id="4309947">nil</span><br>
<span class="lineno"></span><span class="op" id="4309951">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment" id="4309954">//&nbsp;TrimString&nbsp;returns&nbsp;s&nbsp;without&nbsp;leading&nbsp;and&nbsp;trailing&nbsp;ASCII&nbsp;space.</span><br>
<span class="lineno"></span><span class="keyword" id="4310020">func</span>&nbsp;<span class="ident" id="4310025">TrimString</span><span class="op" id="4310035">(</span><span class="ident" id="4310036">s</span>&nbsp;<span class="builtintype" id="4310038">string</span><span class="op" id="4310044">)</span>&nbsp;<span class="builtintype" id="4310046">string</span>&nbsp;<span class="op" id="4310053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4310056">for</span>&nbsp;<span class="builtinfunc" id="4310060">len</span><span class="op" id="4310063">(</span><span class="ident" id="4310064">s</span><span class="op" id="4310065">)</span>&nbsp;<span class="op" id="4310067">&gt;</span>&nbsp;<span class="num" id="4310069">0</span>&nbsp;<span class="op" id="4310071">&amp;&amp;</span>&nbsp;<span class="ident" id="4310074">isASCIISpace</span><span class="op" id="4310086">(</span><span class="ident" id="4310087">s</span><span class="op" id="4310088">[</span><span class="num" id="4310089">0</span><span class="op" id="4310090">]</span><span class="op" id="4310091">)</span>&nbsp;<span class="op" id="4310093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4310097">s</span>&nbsp;<span class="op" id="4310099">=</span>&nbsp;<span class="ident" id="4310101">s</span><span class="op" id="4310102">[</span><span class="num" id="4310103">1</span><span class="op" id="4310104">:</span><span class="op" id="4310105">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4310108">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4310111">for</span>&nbsp;<span class="builtinfunc" id="4310115">len</span><span class="op" id="4310118">(</span><span class="ident" id="4310119">s</span><span class="op" id="4310120">)</span>&nbsp;<span class="op" id="4310122">&gt;</span>&nbsp;<span class="num" id="4310124">0</span>&nbsp;<span class="op" id="4310126">&amp;&amp;</span>&nbsp;<span class="ident" id="4310129">isASCIISpace</span><span class="op" id="4310141">(</span><span class="ident" id="4310142">s</span><span class="op" id="4310143">[</span><span class="builtinfunc" id="4310144">len</span><span class="op" id="4310147">(</span><span class="ident" id="4310148">s</span><span class="op" id="4310149">)</span><span class="op" id="4310150">-</span><span class="num" id="4310151">1</span><span class="op" id="4310152">]</span><span class="op" id="4310153">)</span>&nbsp;<span class="op" id="4310155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4310159">s</span>&nbsp;<span class="op" id="4310161">=</span>&nbsp;<span class="ident" id="4310163">s</span><span class="op" id="4310164">[</span><span class="op" id="4310165">:</span><span class="builtinfunc" id="4310166">len</span><span class="op" id="4310169">(</span><span class="ident" id="4310170">s</span><span class="op" id="4310171">)</span><span class="op" id="4310172">-</span><span class="num" id="4310173">1</span><span class="op" id="4310174">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4310177">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4310180">return</span>&nbsp;<span class="ident" id="4310187">s</span><br>
<span class="lineno"></span><span class="op" id="4310189">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span><span class="comment" id="4310192">//&nbsp;TrimBytes&nbsp;returns&nbsp;b&nbsp;without&nbsp;leading&nbsp;and&nbsp;trailing&nbsp;ASCII&nbsp;space.</span><br>
<span class="lineno"></span><span class="keyword" id="4310257">func</span>&nbsp;<span class="ident" id="4310262">TrimBytes</span><span class="op" id="4310271">(</span><span class="ident" id="4310272">b</span>&nbsp;<span class="op" id="4310274">[</span><span class="op" id="4310275">]</span><span class="builtintype" id="4310276">byte</span><span class="op" id="4310280">)</span>&nbsp;<span class="op" id="4310282">[</span><span class="op" id="4310283">]</span><span class="builtintype" id="4310284">byte</span>&nbsp;<span class="op" id="4310289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4310292">for</span>&nbsp;<span class="builtinfunc" id="4310296">len</span><span class="op" id="4310299">(</span><span class="ident" id="4310300">b</span><span class="op" id="4310301">)</span>&nbsp;<span class="op" id="4310303">&gt;</span>&nbsp;<span class="num" id="4310305">0</span>&nbsp;<span class="op" id="4310307">&amp;&amp;</span>&nbsp;<span class="ident" id="4310310">isASCIISpace</span><span class="op" id="4310322">(</span><span class="ident" id="4310323">b</span><span class="op" id="4310324">[</span><span class="num" id="4310325">0</span><span class="op" id="4310326">]</span><span class="op" id="4310327">)</span>&nbsp;<span class="op" id="4310329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4310333">b</span>&nbsp;<span class="op" id="4310335">=</span>&nbsp;<span class="ident" id="4310337">b</span><span class="op" id="4310338">[</span><span class="num" id="4310339">1</span><span class="op" id="4310340">:</span><span class="op" id="4310341">]</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4310344">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4310347">for</span>&nbsp;<span class="builtinfunc" id="4310351">len</span><span class="op" id="4310354">(</span><span class="ident" id="4310355">b</span><span class="op" id="4310356">)</span>&nbsp;<span class="op" id="4310358">&gt;</span>&nbsp;<span class="num" id="4310360">0</span>&nbsp;<span class="op" id="4310362">&amp;&amp;</span>&nbsp;<span class="ident" id="4310365">isASCIISpace</span><span class="op" id="4310377">(</span><span class="ident" id="4310378">b</span><span class="op" id="4310379">[</span><span class="builtinfunc" id="4310380">len</span><span class="op" id="4310383">(</span><span class="ident" id="4310384">b</span><span class="op" id="4310385">)</span><span class="op" id="4310386">-</span><span class="num" id="4310387">1</span><span class="op" id="4310388">]</span><span class="op" id="4310389">)</span>&nbsp;<span class="op" id="4310391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4310395">b</span>&nbsp;<span class="op" id="4310397">=</span>&nbsp;<span class="ident" id="4310399">b</span><span class="op" id="4310400">[</span><span class="op" id="4310401">:</span><span class="builtinfunc" id="4310402">len</span><span class="op" id="4310405">(</span><span class="ident" id="4310406">b</span><span class="op" id="4310407">)</span><span class="op" id="4310408">-</span><span class="num" id="4310409">1</span><span class="op" id="4310410">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4310413">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4310416">return</span>&nbsp;<span class="ident" id="4310423">b</span><br>
<span class="lineno">145</span><span class="op" id="4310425">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4310428">func</span>&nbsp;<span class="ident" id="4310433">isASCIISpace</span><span class="op" id="4310445">(</span><span class="ident" id="4310446">b</span>&nbsp;<span class="builtintype" id="4310448">byte</span><span class="op" id="4310452">)</span>&nbsp;<span class="builtintype" id="4310454">bool</span>&nbsp;<span class="op" id="4310459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4310462">return</span>&nbsp;<span class="ident" id="4310469">b</span>&nbsp;<span class="op" id="4310471">==</span>&nbsp;<span class="string" id="4310474">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="4310478">||</span>&nbsp;<span class="ident" id="4310481">b</span>&nbsp;<span class="op" id="4310483">==</span>&nbsp;<span class="string" id="4310486">&#39;\t&#39;</span>&nbsp;<span class="op" id="4310491">||</span>&nbsp;<span class="ident" id="4310494">b</span>&nbsp;<span class="op" id="4310496">==</span>&nbsp;<span class="string" id="4310499">&#39;\n&#39;</span>&nbsp;<span class="op" id="4310504">||</span>&nbsp;<span class="ident" id="4310507">b</span>&nbsp;<span class="op" id="4310509">==</span>&nbsp;<span class="string" id="4310512">&#39;\r&#39;</span><br>
<span class="lineno"></span><span class="op" id="4310517">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span><span class="keyword" id="4310520">func</span>&nbsp;<span class="ident" id="4310525">isASCIILetter</span><span class="op" id="4310538">(</span><span class="ident" id="4310539">b</span>&nbsp;<span class="builtintype" id="4310541">byte</span><span class="op" id="4310545">)</span>&nbsp;<span class="builtintype" id="4310547">bool</span>&nbsp;<span class="op" id="4310552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4310555">b</span>&nbsp;<span class="op" id="4310557">|=</span>&nbsp;<span class="num" id="4310560">0x20</span>&nbsp;<span class="comment" id="4310565">//&nbsp;make&nbsp;lower&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4310585">return</span>&nbsp;<span class="string" id="4310592">&#39;a&#39;</span>&nbsp;<span class="op" id="4310596">&lt;=</span>&nbsp;<span class="ident" id="4310599">b</span>&nbsp;<span class="op" id="4310601">&amp;&amp;</span>&nbsp;<span class="ident" id="4310604">b</span>&nbsp;<span class="op" id="4310606">&lt;=</span>&nbsp;<span class="string" id="4310609">&#39;z&#39;</span><br>
<span class="lineno"></span><span class="op" id="4310613">}</span>
</div>
</body>
</html>
