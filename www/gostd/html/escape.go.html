<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>html</h2>
<ul>
<li><a href="/gostd/html/entity.go.html">entity.go</a></li>
<li><a href="/gostd/html/entity_test.go.html">entity_test.go</a></li>
<li><a href="/gostd/html/escape.go.html" class="current">escape.go</a></li>
<li><a href="/gostd/html/escape_test.go.html">escape_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5222201">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5222256">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5222310">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5222361">//&nbsp;Package&nbsp;html&nbsp;provides&nbsp;functions&nbsp;for&nbsp;escaping&nbsp;and&nbsp;unescaping&nbsp;HTML&nbsp;text.</span><br>
<span class="lineno"></span><span class="keyword" id="5222435">package</span>&nbsp;<span class="ident" id="5222443">html</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5222449">import</span>&nbsp;<span class="op" id="5222456">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5222459">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5222468">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5222479">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="5222494">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5222497">type</span>&nbsp;<span class="ident" id="5222502">writer</span>&nbsp;<span class="keyword" id="5222509">interface</span>&nbsp;<span class="op" id="5222519">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5222522">WriteString</span><span class="op" id="5222533">(</span><span class="builtintype" id="5222534">string</span><span class="op" id="5222540">)</span>&nbsp;<span class="op" id="5222542">(</span><span class="builtintype" id="5222543">int</span><span class="op" id="5222546">,</span>&nbsp;<span class="builtintype" id="5222548">error</span><span class="op" id="5222553">)</span><br>
<span class="lineno"></span><span class="op" id="5222555">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5222558">//&nbsp;These&nbsp;replacements&nbsp;permit&nbsp;compatibility&nbsp;with&nbsp;old&nbsp;numeric&nbsp;entities&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="5222632">//&nbsp;assumed&nbsp;Windows-1252&nbsp;encoding.</span><br>
<span class="lineno">20</span><span class="comment" id="5222666">//&nbsp;http://www.whatwg.org/specs/web-apps/current-work/multipage/tokenization.html#consume-a-character-reference</span><br>
<span class="lineno"></span><span class="keyword" id="5222777">var</span>&nbsp;<span class="ident" id="5222781">replacementTable</span>&nbsp;<span class="op" id="5222798">=</span>&nbsp;<span class="op" id="5222800">[</span><span class="op" id="5222801">...</span><span class="op" id="5222804">]</span><span class="builtintype" id="5222805">rune</span><span class="op" id="5222809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5222812">&#39;\u20AC&#39;</span><span class="op" id="5222820">,</span>&nbsp;<span class="comment" id="5222822">//&nbsp;First&nbsp;entry&nbsp;is&nbsp;what&nbsp;0x80&nbsp;should&nbsp;be&nbsp;replaced&nbsp;with.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5222876">&#39;\u0081&#39;</span><span class="op" id="5222884">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5222887">&#39;\u201A&#39;</span><span class="op" id="5222895">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5222898">&#39;\u0192&#39;</span><span class="op" id="5222906">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5222909">&#39;\u201E&#39;</span><span class="op" id="5222917">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5222920">&#39;\u2026&#39;</span><span class="op" id="5222928">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5222931">&#39;\u2020&#39;</span><span class="op" id="5222939">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5222942">&#39;\u2021&#39;</span><span class="op" id="5222950">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5222953">&#39;\u02C6&#39;</span><span class="op" id="5222961">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5222964">&#39;\u2030&#39;</span><span class="op" id="5222972">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5222975">&#39;\u0160&#39;</span><span class="op" id="5222983">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5222986">&#39;\u2039&#39;</span><span class="op" id="5222994">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5222997">&#39;\u0152&#39;</span><span class="op" id="5223005">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5223008">&#39;\u008D&#39;</span><span class="op" id="5223016">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5223019">&#39;\u017D&#39;</span><span class="op" id="5223027">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5223030">&#39;\u008F&#39;</span><span class="op" id="5223038">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5223041">&#39;\u0090&#39;</span><span class="op" id="5223049">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5223052">&#39;\u2018&#39;</span><span class="op" id="5223060">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5223063">&#39;\u2019&#39;</span><span class="op" id="5223071">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5223074">&#39;\u201C&#39;</span><span class="op" id="5223082">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5223085">&#39;\u201D&#39;</span><span class="op" id="5223093">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5223096">&#39;\u2022&#39;</span><span class="op" id="5223104">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5223107">&#39;\u2013&#39;</span><span class="op" id="5223115">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5223118">&#39;\u2014&#39;</span><span class="op" id="5223126">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5223129">&#39;\u02DC&#39;</span><span class="op" id="5223137">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5223140">&#39;\u2122&#39;</span><span class="op" id="5223148">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5223151">&#39;\u0161&#39;</span><span class="op" id="5223159">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5223162">&#39;\u203A&#39;</span><span class="op" id="5223170">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5223173">&#39;\u0153&#39;</span><span class="op" id="5223181">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5223184">&#39;\u009D&#39;</span><span class="op" id="5223192">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5223195">&#39;\u017E&#39;</span><span class="op" id="5223203">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5223206">&#39;\u0178&#39;</span><span class="op" id="5223214">,</span>&nbsp;<span class="comment" id="5223216">//&nbsp;Last&nbsp;entry&nbsp;is&nbsp;0x9F.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5223240">//&nbsp;0x00-&gt;&#39;\uFFFD&#39;&nbsp;is&nbsp;handled&nbsp;programmatically.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5223288">//&nbsp;0x0D-&gt;&#39;\u000D&#39;&nbsp;is&nbsp;a&nbsp;no-op.</span><br>
<span class="lineno"></span><span class="op" id="5223318">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5223321">//&nbsp;unescapeEntity&nbsp;reads&nbsp;an&nbsp;entity&nbsp;like&nbsp;&#34;&amp;lt;&#34;&nbsp;from&nbsp;b[src:]&nbsp;and&nbsp;writes&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5223395">//&nbsp;corresponding&nbsp;&#34;&lt;&#34;&nbsp;to&nbsp;b[dst:],&nbsp;returning&nbsp;the&nbsp;incremented&nbsp;dst&nbsp;and&nbsp;src&nbsp;cursors.</span><br>
<span class="lineno">60</span><span class="comment" id="5223475">//&nbsp;Precondition:&nbsp;b[src]&nbsp;==&nbsp;&#39;&amp;&#39;&nbsp;&amp;&amp;&nbsp;dst&nbsp;&lt;=&nbsp;src.</span><br>
<span class="lineno"></span><span class="comment" id="5223521">//&nbsp;attribute&nbsp;should&nbsp;be&nbsp;true&nbsp;if&nbsp;parsing&nbsp;an&nbsp;attribute&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="5223580">func</span>&nbsp;<span class="ident" id="5223585">unescapeEntity</span><span class="op" id="5223599">(</span><span class="ident" id="5223600">b</span>&nbsp;<span class="op" id="5223602">[</span><span class="op" id="5223603">]</span><span class="builtintype" id="5223604">byte</span><span class="op" id="5223608">,</span>&nbsp;<span class="ident" id="5223610">dst</span><span class="op" id="5223613">,</span>&nbsp;<span class="ident" id="5223615">src</span>&nbsp;<span class="builtintype" id="5223619">int</span><span class="op" id="5223622">,</span>&nbsp;<span class="ident" id="5223624">attribute</span>&nbsp;<span class="builtintype" id="5223634">bool</span><span class="op" id="5223638">)</span>&nbsp;<span class="op" id="5223640">(</span><span class="ident" id="5223641">dst1</span><span class="op" id="5223645">,</span>&nbsp;<span class="ident" id="5223647">src1</span>&nbsp;<span class="builtintype" id="5223652">int</span><span class="op" id="5223655">)</span>&nbsp;<span class="op" id="5223657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5223660">//&nbsp;http://www.whatwg.org/specs/web-apps/current-work/multipage/tokenization.html#consume-a-character-reference</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5223773">//&nbsp;i&nbsp;starts&nbsp;at&nbsp;1&nbsp;because&nbsp;we&nbsp;already&nbsp;know&nbsp;that&nbsp;s[0]&nbsp;==&nbsp;&#39;&amp;&#39;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5223833">i</span><span class="op" id="5223834">,</span>&nbsp;<span class="ident" id="5223836">s</span>&nbsp;<span class="op" id="5223838">:=</span>&nbsp;<span class="num" id="5223841">1</span><span class="op" id="5223842">,</span>&nbsp;<span class="ident" id="5223844">b</span><span class="op" id="5223845">[</span><span class="ident" id="5223846">src</span><span class="op" id="5223849">:</span><span class="op" id="5223850">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5223854">if</span>&nbsp;<span class="builtinfunc" id="5223857">len</span><span class="op" id="5223860">(</span><span class="ident" id="5223861">s</span><span class="op" id="5223862">)</span>&nbsp;<span class="op" id="5223864">&lt;=</span>&nbsp;<span class="num" id="5223867">1</span>&nbsp;<span class="op" id="5223869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5223873">b</span><span class="op" id="5223874">[</span><span class="ident" id="5223875">dst</span><span class="op" id="5223878">]</span>&nbsp;<span class="op" id="5223880">=</span>&nbsp;<span class="ident" id="5223882">b</span><span class="op" id="5223883">[</span><span class="ident" id="5223884">src</span><span class="op" id="5223887">]</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5223891">return</span>&nbsp;<span class="ident" id="5223898">dst</span>&nbsp;<span class="op" id="5223902">+</span>&nbsp;<span class="num" id="5223904">1</span><span class="op" id="5223905">,</span>&nbsp;<span class="ident" id="5223907">src</span>&nbsp;<span class="op" id="5223911">+</span>&nbsp;<span class="num" id="5223913">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5223916">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5223920">if</span>&nbsp;<span class="ident" id="5223923">s</span><span class="op" id="5223924">[</span><span class="ident" id="5223925">i</span><span class="op" id="5223926">]</span>&nbsp;<span class="op" id="5223928">==</span>&nbsp;<span class="string" id="5223931">&#39;#&#39;</span>&nbsp;<span class="op" id="5223935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5223939">if</span>&nbsp;<span class="builtinfunc" id="5223942">len</span><span class="op" id="5223945">(</span><span class="ident" id="5223946">s</span><span class="op" id="5223947">)</span>&nbsp;<span class="op" id="5223949">&lt;=</span>&nbsp;<span class="num" id="5223952">3</span>&nbsp;<span class="op" id="5223954">{</span>&nbsp;<span class="comment" id="5223956">//&nbsp;We&nbsp;need&nbsp;to&nbsp;have&nbsp;at&nbsp;least&nbsp;&#34;&amp;#.&#34;.</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5223994">b</span><span class="op" id="5223995">[</span><span class="ident" id="5223996">dst</span><span class="op" id="5223999">]</span>&nbsp;<span class="op" id="5224001">=</span>&nbsp;<span class="ident" id="5224003">b</span><span class="op" id="5224004">[</span><span class="ident" id="5224005">src</span><span class="op" id="5224008">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5224013">return</span>&nbsp;<span class="ident" id="5224020">dst</span>&nbsp;<span class="op" id="5224024">+</span>&nbsp;<span class="num" id="5224026">1</span><span class="op" id="5224027">,</span>&nbsp;<span class="ident" id="5224029">src</span>&nbsp;<span class="op" id="5224033">+</span>&nbsp;<span class="num" id="5224035">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5224039">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5224043">i</span><span class="op" id="5224044">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5224049">c</span>&nbsp;<span class="op" id="5224051">:=</span>&nbsp;<span class="ident" id="5224054">s</span><span class="op" id="5224055">[</span><span class="ident" id="5224056">i</span><span class="op" id="5224057">]</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5224061">hex</span>&nbsp;<span class="op" id="5224065">:=</span>&nbsp;<span class="builtintype" id="5224068">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5224076">if</span>&nbsp;<span class="ident" id="5224079">c</span>&nbsp;<span class="op" id="5224081">==</span>&nbsp;<span class="string" id="5224084">&#39;x&#39;</span>&nbsp;<span class="op" id="5224088">||</span>&nbsp;<span class="ident" id="5224091">c</span>&nbsp;<span class="op" id="5224093">==</span>&nbsp;<span class="string" id="5224096">&#39;X&#39;</span>&nbsp;<span class="op" id="5224100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5224105">hex</span>&nbsp;<span class="op" id="5224109">=</span>&nbsp;<span class="builtintype" id="5224111">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5224119">i</span><span class="op" id="5224120">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5224125">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5224130">x</span>&nbsp;<span class="op" id="5224132">:=</span>&nbsp;<span class="string" id="5224135">&#39;\x00&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5224144">for</span>&nbsp;<span class="ident" id="5224148">i</span>&nbsp;<span class="op" id="5224150">&lt;</span>&nbsp;<span class="builtinfunc" id="5224152">len</span><span class="op" id="5224155">(</span><span class="ident" id="5224156">s</span><span class="op" id="5224157">)</span>&nbsp;<span class="op" id="5224159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5224164">c</span>&nbsp;<span class="op" id="5224166">=</span>&nbsp;<span class="ident" id="5224168">s</span><span class="op" id="5224169">[</span><span class="ident" id="5224170">i</span><span class="op" id="5224171">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5224176">i</span><span class="op" id="5224177">++</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5224183">if</span>&nbsp;<span class="ident" id="5224186">hex</span>&nbsp;<span class="op" id="5224190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5224196">if</span>&nbsp;<span class="string" id="5224199">&#39;0&#39;</span>&nbsp;<span class="op" id="5224203">&lt;=</span>&nbsp;<span class="ident" id="5224206">c</span>&nbsp;<span class="op" id="5224208">&amp;&amp;</span>&nbsp;<span class="ident" id="5224211">c</span>&nbsp;<span class="op" id="5224213">&lt;=</span>&nbsp;<span class="string" id="5224216">&#39;9&#39;</span>&nbsp;<span class="op" id="5224220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5224227">x</span>&nbsp;<span class="op" id="5224229">=</span>&nbsp;<span class="num" id="5224231">16</span><span class="op" id="5224233">*</span><span class="ident" id="5224234">x</span>&nbsp;<span class="op" id="5224236">+</span>&nbsp;<span class="builtintype" id="5224238">rune</span><span class="op" id="5224242">(</span><span class="ident" id="5224243">c</span><span class="op" id="5224244">)</span>&nbsp;<span class="op" id="5224246">-</span>&nbsp;<span class="string" id="5224248">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5224257">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5224270">}</span>&nbsp;<span class="keyword" id="5224272">else</span>&nbsp;<span class="keyword" id="5224277">if</span>&nbsp;<span class="string" id="5224280">&#39;a&#39;</span>&nbsp;<span class="op" id="5224284">&lt;=</span>&nbsp;<span class="ident" id="5224287">c</span>&nbsp;<span class="op" id="5224289">&amp;&amp;</span>&nbsp;<span class="ident" id="5224292">c</span>&nbsp;<span class="op" id="5224294">&lt;=</span>&nbsp;<span class="string" id="5224297">&#39;f&#39;</span>&nbsp;<span class="op" id="5224301">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5224308">x</span>&nbsp;<span class="op" id="5224310">=</span>&nbsp;<span class="num" id="5224312">16</span><span class="op" id="5224314">*</span><span class="ident" id="5224315">x</span>&nbsp;<span class="op" id="5224317">+</span>&nbsp;<span class="builtintype" id="5224319">rune</span><span class="op" id="5224323">(</span><span class="ident" id="5224324">c</span><span class="op" id="5224325">)</span>&nbsp;<span class="op" id="5224327">-</span>&nbsp;<span class="string" id="5224329">&#39;a&#39;</span>&nbsp;<span class="op" id="5224333">+</span>&nbsp;<span class="num" id="5224335">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5224343">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5224356">}</span>&nbsp;<span class="keyword" id="5224358">else</span>&nbsp;<span class="keyword" id="5224363">if</span>&nbsp;<span class="string" id="5224366">&#39;A&#39;</span>&nbsp;<span class="op" id="5224370">&lt;=</span>&nbsp;<span class="ident" id="5224373">c</span>&nbsp;<span class="op" id="5224375">&amp;&amp;</span>&nbsp;<span class="ident" id="5224378">c</span>&nbsp;<span class="op" id="5224380">&lt;=</span>&nbsp;<span class="string" id="5224383">&#39;F&#39;</span>&nbsp;<span class="op" id="5224387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5224394">x</span>&nbsp;<span class="op" id="5224396">=</span>&nbsp;<span class="num" id="5224398">16</span><span class="op" id="5224400">*</span><span class="ident" id="5224401">x</span>&nbsp;<span class="op" id="5224403">+</span>&nbsp;<span class="builtintype" id="5224405">rune</span><span class="op" id="5224409">(</span><span class="ident" id="5224410">c</span><span class="op" id="5224411">)</span>&nbsp;<span class="op" id="5224413">-</span>&nbsp;<span class="string" id="5224415">&#39;A&#39;</span>&nbsp;<span class="op" id="5224419">+</span>&nbsp;<span class="num" id="5224421">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5224429">continue</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5224442">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5224447">}</span>&nbsp;<span class="keyword" id="5224449">else</span>&nbsp;<span class="keyword" id="5224454">if</span>&nbsp;<span class="string" id="5224457">&#39;0&#39;</span>&nbsp;<span class="op" id="5224461">&lt;=</span>&nbsp;<span class="ident" id="5224464">c</span>&nbsp;<span class="op" id="5224466">&amp;&amp;</span>&nbsp;<span class="ident" id="5224469">c</span>&nbsp;<span class="op" id="5224471">&lt;=</span>&nbsp;<span class="string" id="5224474">&#39;9&#39;</span>&nbsp;<span class="op" id="5224478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5224484">x</span>&nbsp;<span class="op" id="5224486">=</span>&nbsp;<span class="num" id="5224488">10</span><span class="op" id="5224490">*</span><span class="ident" id="5224491">x</span>&nbsp;<span class="op" id="5224493">+</span>&nbsp;<span class="builtintype" id="5224495">rune</span><span class="op" id="5224499">(</span><span class="ident" id="5224500">c</span><span class="op" id="5224501">)</span>&nbsp;<span class="op" id="5224503">-</span>&nbsp;<span class="string" id="5224505">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5224513">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5224525">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5224530">if</span>&nbsp;<span class="ident" id="5224533">c</span>&nbsp;<span class="op" id="5224535">!=</span>&nbsp;<span class="string" id="5224538">&#39;;&#39;</span>&nbsp;<span class="op" id="5224542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5224548">i</span><span class="op" id="5224549">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5224555">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5224560">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5224568">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5224573">if</span>&nbsp;<span class="ident" id="5224576">i</span>&nbsp;<span class="op" id="5224578">&lt;=</span>&nbsp;<span class="num" id="5224581">3</span>&nbsp;<span class="op" id="5224583">{</span>&nbsp;<span class="comment" id="5224585">//&nbsp;No&nbsp;characters&nbsp;matched.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5224614">b</span><span class="op" id="5224615">[</span><span class="ident" id="5224616">dst</span><span class="op" id="5224619">]</span>&nbsp;<span class="op" id="5224621">=</span>&nbsp;<span class="ident" id="5224623">b</span><span class="op" id="5224624">[</span><span class="ident" id="5224625">src</span><span class="op" id="5224628">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5224633">return</span>&nbsp;<span class="ident" id="5224640">dst</span>&nbsp;<span class="op" id="5224644">+</span>&nbsp;<span class="num" id="5224646">1</span><span class="op" id="5224647">,</span>&nbsp;<span class="ident" id="5224649">src</span>&nbsp;<span class="op" id="5224653">+</span>&nbsp;<span class="num" id="5224655">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5224659">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5224664">if</span>&nbsp;<span class="num" id="5224667">0x80</span>&nbsp;<span class="op" id="5224672">&lt;=</span>&nbsp;<span class="ident" id="5224675">x</span>&nbsp;<span class="op" id="5224677">&amp;&amp;</span>&nbsp;<span class="ident" id="5224680">x</span>&nbsp;<span class="op" id="5224682">&lt;=</span>&nbsp;<span class="num" id="5224685">0x9F</span>&nbsp;<span class="op" id="5224690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5224695">//&nbsp;Replace&nbsp;characters&nbsp;from&nbsp;Windows-1252&nbsp;with&nbsp;UTF-8&nbsp;equivalents.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5224762">x</span>&nbsp;<span class="op" id="5224764">=</span>&nbsp;<span class="ident" id="5224766">replacementTable</span><span class="op" id="5224782">[</span><span class="ident" id="5224783">x</span><span class="op" id="5224784">-</span><span class="num" id="5224785">0x80</span><span class="op" id="5224789">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5224793">}</span>&nbsp;<span class="keyword" id="5224795">else</span>&nbsp;<span class="keyword" id="5224800">if</span>&nbsp;<span class="ident" id="5224803">x</span>&nbsp;<span class="op" id="5224805">==</span>&nbsp;<span class="num" id="5224808">0</span>&nbsp;<span class="op" id="5224810">||</span>&nbsp;<span class="op" id="5224813">(</span><span class="num" id="5224814">0xD800</span>&nbsp;<span class="op" id="5224821">&lt;=</span>&nbsp;<span class="ident" id="5224824">x</span>&nbsp;<span class="op" id="5224826">&amp;&amp;</span>&nbsp;<span class="ident" id="5224829">x</span>&nbsp;<span class="op" id="5224831">&lt;=</span>&nbsp;<span class="num" id="5224834">0xDFFF</span><span class="op" id="5224840">)</span>&nbsp;<span class="op" id="5224842">||</span>&nbsp;<span class="ident" id="5224845">x</span>&nbsp;<span class="op" id="5224847">&gt;</span>&nbsp;<span class="num" id="5224849">0x10FFFF</span>&nbsp;<span class="op" id="5224858">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5224863">//&nbsp;Replace&nbsp;invalid&nbsp;characters&nbsp;with&nbsp;the&nbsp;replacement&nbsp;character.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5224928">x</span>&nbsp;<span class="op" id="5224930">=</span>&nbsp;<span class="string" id="5224932">&#39;\uFFFD&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5224943">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5224948">return</span>&nbsp;<span class="ident" id="5224955">dst</span>&nbsp;<span class="op" id="5224959">+</span>&nbsp;<span class="ident" id="5224961">utf8</span><span class="op" id="5224965">.</span><span class="ident" id="5224966">EncodeRune</span><span class="op" id="5224976">(</span><span class="ident" id="5224977">b</span><span class="op" id="5224978">[</span><span class="ident" id="5224979">dst</span><span class="op" id="5224982">:</span><span class="op" id="5224983">]</span><span class="op" id="5224984">,</span>&nbsp;<span class="ident" id="5224986">x</span><span class="op" id="5224987">)</span><span class="op" id="5224988">,</span>&nbsp;<span class="ident" id="5224990">src</span>&nbsp;<span class="op" id="5224994">+</span>&nbsp;<span class="ident" id="5224996">i</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5224999">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5225003">//&nbsp;Consume&nbsp;the&nbsp;maximum&nbsp;number&nbsp;of&nbsp;characters&nbsp;possible,&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5225067">//&nbsp;consumed&nbsp;characters&nbsp;matching&nbsp;one&nbsp;of&nbsp;the&nbsp;named&nbsp;references.</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5225130">for</span>&nbsp;<span class="ident" id="5225134">i</span>&nbsp;<span class="op" id="5225136">&lt;</span>&nbsp;<span class="builtinfunc" id="5225138">len</span><span class="op" id="5225141">(</span><span class="ident" id="5225142">s</span><span class="op" id="5225143">)</span>&nbsp;<span class="op" id="5225145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5225149">c</span>&nbsp;<span class="op" id="5225151">:=</span>&nbsp;<span class="ident" id="5225154">s</span><span class="op" id="5225155">[</span><span class="ident" id="5225156">i</span><span class="op" id="5225157">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5225161">i</span><span class="op" id="5225162">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5225167">//&nbsp;Lower-cased&nbsp;characters&nbsp;are&nbsp;more&nbsp;common&nbsp;in&nbsp;entities,&nbsp;so&nbsp;we&nbsp;check&nbsp;for&nbsp;them&nbsp;first.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5225252">if</span>&nbsp;<span class="string" id="5225255">&#39;a&#39;</span>&nbsp;<span class="op" id="5225259">&lt;=</span>&nbsp;<span class="ident" id="5225262">c</span>&nbsp;<span class="op" id="5225264">&amp;&amp;</span>&nbsp;<span class="ident" id="5225267">c</span>&nbsp;<span class="op" id="5225269">&lt;=</span>&nbsp;<span class="string" id="5225272">&#39;z&#39;</span>&nbsp;<span class="op" id="5225276">||</span>&nbsp;<span class="string" id="5225279">&#39;A&#39;</span>&nbsp;<span class="op" id="5225283">&lt;=</span>&nbsp;<span class="ident" id="5225286">c</span>&nbsp;<span class="op" id="5225288">&amp;&amp;</span>&nbsp;<span class="ident" id="5225291">c</span>&nbsp;<span class="op" id="5225293">&lt;=</span>&nbsp;<span class="string" id="5225296">&#39;Z&#39;</span>&nbsp;<span class="op" id="5225300">||</span>&nbsp;<span class="string" id="5225303">&#39;0&#39;</span>&nbsp;<span class="op" id="5225307">&lt;=</span>&nbsp;<span class="ident" id="5225310">c</span>&nbsp;<span class="op" id="5225312">&amp;&amp;</span>&nbsp;<span class="ident" id="5225315">c</span>&nbsp;<span class="op" id="5225317">&lt;=</span>&nbsp;<span class="string" id="5225320">&#39;9&#39;</span>&nbsp;<span class="op" id="5225324">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5225329">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5225340">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5225344">if</span>&nbsp;<span class="ident" id="5225347">c</span>&nbsp;<span class="op" id="5225349">!=</span>&nbsp;<span class="string" id="5225352">&#39;;&#39;</span>&nbsp;<span class="op" id="5225356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5225361">i</span><span class="op" id="5225362">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5225367">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5225371">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5225378">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5225382">entityName</span>&nbsp;<span class="op" id="5225393">:=</span>&nbsp;<span class="builtintype" id="5225396">string</span><span class="op" id="5225402">(</span><span class="ident" id="5225403">s</span><span class="op" id="5225404">[</span><span class="num" id="5225405">1</span><span class="op" id="5225406">:</span><span class="ident" id="5225407">i</span><span class="op" id="5225408">]</span><span class="op" id="5225409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5225412">if</span>&nbsp;<span class="ident" id="5225415">entityName</span>&nbsp;<span class="op" id="5225426">==</span>&nbsp;<span class="string" id="5225429">&#34;&#34;</span>&nbsp;<span class="op" id="5225432">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5225436">//&nbsp;No-op.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5225447">}</span>&nbsp;<span class="keyword" id="5225449">else</span>&nbsp;<span class="keyword" id="5225454">if</span>&nbsp;<span class="ident" id="5225457">attribute</span>&nbsp;<span class="op" id="5225467">&amp;&amp;</span>&nbsp;<span class="ident" id="5225470">entityName</span><span class="op" id="5225480">[</span><span class="builtinfunc" id="5225481">len</span><span class="op" id="5225484">(</span><span class="ident" id="5225485">entityName</span><span class="op" id="5225495">)</span><span class="op" id="5225496">-</span><span class="num" id="5225497">1</span><span class="op" id="5225498">]</span>&nbsp;<span class="op" id="5225500">!=</span>&nbsp;<span class="string" id="5225503">&#39;;&#39;</span>&nbsp;<span class="op" id="5225507">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5225510">len</span><span class="op" id="5225513">(</span><span class="ident" id="5225514">s</span><span class="op" id="5225515">)</span>&nbsp;<span class="op" id="5225517">&gt;</span>&nbsp;<span class="ident" id="5225519">i</span>&nbsp;<span class="op" id="5225521">&amp;&amp;</span>&nbsp;<span class="ident" id="5225524">s</span><span class="op" id="5225525">[</span><span class="ident" id="5225526">i</span><span class="op" id="5225527">]</span>&nbsp;<span class="op" id="5225529">==</span>&nbsp;<span class="string" id="5225532">&#39;=&#39;</span>&nbsp;<span class="op" id="5225536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5225540">//&nbsp;No-op.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5225551">}</span>&nbsp;<span class="keyword" id="5225553">else</span>&nbsp;<span class="keyword" id="5225558">if</span>&nbsp;<span class="ident" id="5225561">x</span>&nbsp;<span class="op" id="5225563">:=</span>&nbsp;<span class="ident" id="5225566">entity</span><span class="op" id="5225572">[</span><span class="ident" id="5225573">entityName</span><span class="op" id="5225583">]</span><span class="op" id="5225584">;</span>&nbsp;<span class="ident" id="5225586">x</span>&nbsp;<span class="op" id="5225588">!=</span>&nbsp;<span class="num" id="5225591">0</span>&nbsp;<span class="op" id="5225593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5225597">return</span>&nbsp;<span class="ident" id="5225604">dst</span>&nbsp;<span class="op" id="5225608">+</span>&nbsp;<span class="ident" id="5225610">utf8</span><span class="op" id="5225614">.</span><span class="ident" id="5225615">EncodeRune</span><span class="op" id="5225625">(</span><span class="ident" id="5225626">b</span><span class="op" id="5225627">[</span><span class="ident" id="5225628">dst</span><span class="op" id="5225631">:</span><span class="op" id="5225632">]</span><span class="op" id="5225633">,</span>&nbsp;<span class="ident" id="5225635">x</span><span class="op" id="5225636">)</span><span class="op" id="5225637">,</span>&nbsp;<span class="ident" id="5225639">src</span>&nbsp;<span class="op" id="5225643">+</span>&nbsp;<span class="ident" id="5225645">i</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5225648">}</span>&nbsp;<span class="keyword" id="5225650">else</span>&nbsp;<span class="keyword" id="5225655">if</span>&nbsp;<span class="ident" id="5225658">x</span>&nbsp;<span class="op" id="5225660">:=</span>&nbsp;<span class="ident" id="5225663">entity2</span><span class="op" id="5225670">[</span><span class="ident" id="5225671">entityName</span><span class="op" id="5225681">]</span><span class="op" id="5225682">;</span>&nbsp;<span class="ident" id="5225684">x</span><span class="op" id="5225685">[</span><span class="num" id="5225686">0</span><span class="op" id="5225687">]</span>&nbsp;<span class="op" id="5225689">!=</span>&nbsp;<span class="num" id="5225692">0</span>&nbsp;<span class="op" id="5225694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5225698">dst1</span>&nbsp;<span class="op" id="5225703">:=</span>&nbsp;<span class="ident" id="5225706">dst</span>&nbsp;<span class="op" id="5225710">+</span>&nbsp;<span class="ident" id="5225712">utf8</span><span class="op" id="5225716">.</span><span class="ident" id="5225717">EncodeRune</span><span class="op" id="5225727">(</span><span class="ident" id="5225728">b</span><span class="op" id="5225729">[</span><span class="ident" id="5225730">dst</span><span class="op" id="5225733">:</span><span class="op" id="5225734">]</span><span class="op" id="5225735">,</span>&nbsp;<span class="ident" id="5225737">x</span><span class="op" id="5225738">[</span><span class="num" id="5225739">0</span><span class="op" id="5225740">]</span><span class="op" id="5225741">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5225745">return</span>&nbsp;<span class="ident" id="5225752">dst1</span>&nbsp;<span class="op" id="5225757">+</span>&nbsp;<span class="ident" id="5225759">utf8</span><span class="op" id="5225763">.</span><span class="ident" id="5225764">EncodeRune</span><span class="op" id="5225774">(</span><span class="ident" id="5225775">b</span><span class="op" id="5225776">[</span><span class="ident" id="5225777">dst1</span><span class="op" id="5225781">:</span><span class="op" id="5225782">]</span><span class="op" id="5225783">,</span>&nbsp;<span class="ident" id="5225785">x</span><span class="op" id="5225786">[</span><span class="num" id="5225787">1</span><span class="op" id="5225788">]</span><span class="op" id="5225789">)</span><span class="op" id="5225790">,</span>&nbsp;<span class="ident" id="5225792">src</span>&nbsp;<span class="op" id="5225796">+</span>&nbsp;<span class="ident" id="5225798">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5225801">}</span>&nbsp;<span class="keyword" id="5225803">else</span>&nbsp;<span class="keyword" id="5225808">if</span>&nbsp;<span class="op" id="5225811">!</span><span class="ident" id="5225812">attribute</span>&nbsp;<span class="op" id="5225822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5225826">maxLen</span>&nbsp;<span class="op" id="5225833">:=</span>&nbsp;<span class="builtinfunc" id="5225836">len</span><span class="op" id="5225839">(</span><span class="ident" id="5225840">entityName</span><span class="op" id="5225850">)</span>&nbsp;<span class="op" id="5225852">-</span>&nbsp;<span class="num" id="5225854">1</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5225858">if</span>&nbsp;<span class="ident" id="5225861">maxLen</span>&nbsp;<span class="op" id="5225868">&gt;</span>&nbsp;<span class="ident" id="5225870">longestEntityWithoutSemicolon</span>&nbsp;<span class="op" id="5225900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5225905">maxLen</span>&nbsp;<span class="op" id="5225912">=</span>&nbsp;<span class="ident" id="5225914">longestEntityWithoutSemicolon</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5225946">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5225950">for</span>&nbsp;<span class="ident" id="5225954">j</span>&nbsp;<span class="op" id="5225956">:=</span>&nbsp;<span class="ident" id="5225959">maxLen</span><span class="op" id="5225965">;</span>&nbsp;<span class="ident" id="5225967">j</span>&nbsp;<span class="op" id="5225969">&gt;</span>&nbsp;<span class="num" id="5225971">1</span><span class="op" id="5225972">;</span>&nbsp;<span class="ident" id="5225974">j</span><span class="op" id="5225975">--</span>&nbsp;<span class="op" id="5225978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5225983">if</span>&nbsp;<span class="ident" id="5225986">x</span>&nbsp;<span class="op" id="5225988">:=</span>&nbsp;<span class="ident" id="5225991">entity</span><span class="op" id="5225997">[</span><span class="ident" id="5225998">entityName</span><span class="op" id="5226008">[</span><span class="op" id="5226009">:</span><span class="ident" id="5226010">j</span><span class="op" id="5226011">]</span><span class="op" id="5226012">]</span><span class="op" id="5226013">;</span>&nbsp;<span class="ident" id="5226015">x</span>&nbsp;<span class="op" id="5226017">!=</span>&nbsp;<span class="num" id="5226020">0</span>&nbsp;<span class="op" id="5226022">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5226028">return</span>&nbsp;<span class="ident" id="5226035">dst</span>&nbsp;<span class="op" id="5226039">+</span>&nbsp;<span class="ident" id="5226041">utf8</span><span class="op" id="5226045">.</span><span class="ident" id="5226046">EncodeRune</span><span class="op" id="5226056">(</span><span class="ident" id="5226057">b</span><span class="op" id="5226058">[</span><span class="ident" id="5226059">dst</span><span class="op" id="5226062">:</span><span class="op" id="5226063">]</span><span class="op" id="5226064">,</span>&nbsp;<span class="ident" id="5226066">x</span><span class="op" id="5226067">)</span><span class="op" id="5226068">,</span>&nbsp;<span class="ident" id="5226070">src</span>&nbsp;<span class="op" id="5226074">+</span>&nbsp;<span class="ident" id="5226076">j</span>&nbsp;<span class="op" id="5226078">+</span>&nbsp;<span class="num" id="5226080">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5226085">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5226089">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5226092">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5226096">dst1</span><span class="op" id="5226100">,</span>&nbsp;<span class="ident" id="5226102">src1</span>&nbsp;<span class="op" id="5226107">=</span>&nbsp;<span class="ident" id="5226109">dst</span><span class="op" id="5226112">+</span><span class="ident" id="5226113">i</span><span class="op" id="5226114">,</span>&nbsp;<span class="ident" id="5226116">src</span><span class="op" id="5226119">+</span><span class="ident" id="5226120">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5226123">copy</span><span class="op" id="5226127">(</span><span class="ident" id="5226128">b</span><span class="op" id="5226129">[</span><span class="ident" id="5226130">dst</span><span class="op" id="5226133">:</span><span class="ident" id="5226134">dst1</span><span class="op" id="5226138">]</span><span class="op" id="5226139">,</span>&nbsp;<span class="ident" id="5226141">b</span><span class="op" id="5226142">[</span><span class="ident" id="5226143">src</span><span class="op" id="5226146">:</span><span class="ident" id="5226147">src1</span><span class="op" id="5226151">]</span><span class="op" id="5226152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5226155">return</span>&nbsp;<span class="ident" id="5226162">dst1</span><span class="op" id="5226166">,</span>&nbsp;<span class="ident" id="5226168">src1</span><br>
<span class="lineno"></span><span class="op" id="5226173">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="comment" id="5226176">//&nbsp;unescape&nbsp;unescapes&nbsp;b&#39;s&nbsp;entities&nbsp;in-place,&nbsp;so&nbsp;that&nbsp;&#34;a&amp;lt;b&#34;&nbsp;becomes&nbsp;&#34;a&lt;b&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="5226253">func</span>&nbsp;<span class="ident" id="5226258">unescape</span><span class="op" id="5226266">(</span><span class="ident" id="5226267">b</span>&nbsp;<span class="op" id="5226269">[</span><span class="op" id="5226270">]</span><span class="builtintype" id="5226271">byte</span><span class="op" id="5226275">)</span>&nbsp;<span class="op" id="5226277">[</span><span class="op" id="5226278">]</span><span class="builtintype" id="5226279">byte</span>&nbsp;<span class="op" id="5226284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5226287">for</span>&nbsp;<span class="ident" id="5226291">i</span><span class="op" id="5226292">,</span>&nbsp;<span class="ident" id="5226294">c</span>&nbsp;<span class="op" id="5226296">:=</span>&nbsp;<span class="keyword" id="5226299">range</span>&nbsp;<span class="ident" id="5226305">b</span>&nbsp;<span class="op" id="5226307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5226311">if</span>&nbsp;<span class="ident" id="5226314">c</span>&nbsp;<span class="op" id="5226316">==</span>&nbsp;<span class="string" id="5226319">&#39;&amp;&#39;</span>&nbsp;<span class="op" id="5226323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5226328">dst</span><span class="op" id="5226331">,</span>&nbsp;<span class="ident" id="5226333">src</span>&nbsp;<span class="op" id="5226337">:=</span>&nbsp;<span class="ident" id="5226340">unescapeEntity</span><span class="op" id="5226354">(</span><span class="ident" id="5226355">b</span><span class="op" id="5226356">,</span>&nbsp;<span class="ident" id="5226358">i</span><span class="op" id="5226359">,</span>&nbsp;<span class="ident" id="5226361">i</span><span class="op" id="5226362">,</span>&nbsp;<span class="builtintype" id="5226364">false</span><span class="op" id="5226369">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5226374">for</span>&nbsp;<span class="ident" id="5226378">src</span>&nbsp;<span class="op" id="5226382">&lt;</span>&nbsp;<span class="builtinfunc" id="5226384">len</span><span class="op" id="5226387">(</span><span class="ident" id="5226388">b</span><span class="op" id="5226389">)</span>&nbsp;<span class="op" id="5226391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5226397">c</span>&nbsp;<span class="op" id="5226399">:=</span>&nbsp;<span class="ident" id="5226402">b</span><span class="op" id="5226403">[</span><span class="ident" id="5226404">src</span><span class="op" id="5226407">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5226413">if</span>&nbsp;<span class="ident" id="5226416">c</span>&nbsp;<span class="op" id="5226418">==</span>&nbsp;<span class="string" id="5226421">&#39;&amp;&#39;</span>&nbsp;<span class="op" id="5226425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5226432">dst</span><span class="op" id="5226435">,</span>&nbsp;<span class="ident" id="5226437">src</span>&nbsp;<span class="op" id="5226441">=</span>&nbsp;<span class="ident" id="5226443">unescapeEntity</span><span class="op" id="5226457">(</span><span class="ident" id="5226458">b</span><span class="op" id="5226459">,</span>&nbsp;<span class="ident" id="5226461">dst</span><span class="op" id="5226464">,</span>&nbsp;<span class="ident" id="5226466">src</span><span class="op" id="5226469">,</span>&nbsp;<span class="builtintype" id="5226471">false</span><span class="op" id="5226476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5226482">}</span>&nbsp;<span class="keyword" id="5226484">else</span>&nbsp;<span class="op" id="5226489">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5226496">b</span><span class="op" id="5226497">[</span><span class="ident" id="5226498">dst</span><span class="op" id="5226501">]</span>&nbsp;<span class="op" id="5226503">=</span>&nbsp;<span class="ident" id="5226505">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5226512">dst</span><span class="op" id="5226515">,</span>&nbsp;<span class="ident" id="5226517">src</span>&nbsp;<span class="op" id="5226521">=</span>&nbsp;<span class="ident" id="5226523">dst</span><span class="op" id="5226526">+</span><span class="num" id="5226527">1</span><span class="op" id="5226528">,</span>&nbsp;<span class="ident" id="5226530">src</span><span class="op" id="5226533">+</span><span class="num" id="5226534">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5226540">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5226545">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5226550">return</span>&nbsp;<span class="ident" id="5226557">b</span><span class="op" id="5226558">[</span><span class="num" id="5226559">0</span><span class="op" id="5226560">:</span><span class="ident" id="5226561">dst</span><span class="op" id="5226564">]</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5226568">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5226571">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5226574">return</span>&nbsp;<span class="ident" id="5226581">b</span><br>
<span class="lineno"></span><span class="op" id="5226583">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="keyword" id="5226586">const</span>&nbsp;<span class="ident" id="5226592">escapedChars</span>&nbsp;<span class="op" id="5226605">=</span>&nbsp;<span class="string" id="5226607">`&amp;&#39;&lt;&gt;&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5226616">func</span>&nbsp;<span class="ident" id="5226621">escape</span><span class="op" id="5226627">(</span><span class="ident" id="5226628">w</span>&nbsp;<span class="ident" id="5226630">writer</span><span class="op" id="5226636">,</span>&nbsp;<span class="ident" id="5226638">s</span>&nbsp;<span class="builtintype" id="5226640">string</span><span class="op" id="5226646">)</span>&nbsp;<span class="builtintype" id="5226648">error</span>&nbsp;<span class="op" id="5226654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5226657">i</span>&nbsp;<span class="op" id="5226659">:=</span>&nbsp;<span class="ident" id="5226662">strings</span><span class="op" id="5226669">.</span><span class="ident" id="5226670">IndexAny</span><span class="op" id="5226678">(</span><span class="ident" id="5226679">s</span><span class="op" id="5226680">,</span>&nbsp;<span class="ident" id="5226682">escapedChars</span><span class="op" id="5226694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5226697">for</span>&nbsp;<span class="ident" id="5226701">i</span>&nbsp;<span class="op" id="5226703">!=</span>&nbsp;<span class="op" id="5226706">-</span><span class="num" id="5226707">1</span>&nbsp;<span class="op" id="5226709">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5226713">if</span>&nbsp;<span class="ident" id="5226716">_</span><span class="op" id="5226717">,</span>&nbsp;<span class="ident" id="5226719">err</span>&nbsp;<span class="op" id="5226723">:=</span>&nbsp;<span class="ident" id="5226726">w</span><span class="op" id="5226727">.</span><span class="ident" id="5226728">WriteString</span><span class="op" id="5226739">(</span><span class="ident" id="5226740">s</span><span class="op" id="5226741">[</span><span class="op" id="5226742">:</span><span class="ident" id="5226743">i</span><span class="op" id="5226744">]</span><span class="op" id="5226745">)</span><span class="op" id="5226746">;</span>&nbsp;<span class="ident" id="5226748">err</span>&nbsp;<span class="op" id="5226752">!=</span>&nbsp;<span class="ident" id="5226755">nil</span>&nbsp;<span class="op" id="5226759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5226764">return</span>&nbsp;<span class="ident" id="5226771">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5226777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5226781">var</span>&nbsp;<span class="ident" id="5226785">esc</span>&nbsp;<span class="builtintype" id="5226789">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5226798">switch</span>&nbsp;<span class="ident" id="5226805">s</span><span class="op" id="5226806">[</span><span class="ident" id="5226807">i</span><span class="op" id="5226808">]</span>&nbsp;<span class="op" id="5226810">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5226814">case</span>&nbsp;<span class="string" id="5226819">&#39;&amp;&#39;</span><span class="op" id="5226822">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5226827">esc</span>&nbsp;<span class="op" id="5226831">=</span>&nbsp;<span class="string" id="5226833">&#34;&amp;amp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5226843">case</span>&nbsp;<span class="string" id="5226848">&#39;\&#39;&#39;</span><span class="op" id="5226852">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5226857">//&nbsp;&#34;&amp;#39;&#34;&nbsp;is&nbsp;shorter&nbsp;than&nbsp;&#34;&amp;apos;&#34;&nbsp;and&nbsp;apos&nbsp;was&nbsp;not&nbsp;in&nbsp;HTML&nbsp;until&nbsp;HTML5.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5226934">esc</span>&nbsp;<span class="op" id="5226938">=</span>&nbsp;<span class="string" id="5226940">&#34;&amp;#39;&#34;</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5226950">case</span>&nbsp;<span class="string" id="5226955">&#39;&lt;&#39;</span><span class="op" id="5226958">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5226963">esc</span>&nbsp;<span class="op" id="5226967">=</span>&nbsp;<span class="string" id="5226969">&#34;&amp;lt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5226978">case</span>&nbsp;<span class="string" id="5226983">&#39;&gt;&#39;</span><span class="op" id="5226986">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5226991">esc</span>&nbsp;<span class="op" id="5226995">=</span>&nbsp;<span class="string" id="5226997">&#34;&amp;gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5227006">case</span>&nbsp;<span class="string" id="5227011">&#39;&#34;&#39;</span><span class="op" id="5227014">:</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5227019">//&nbsp;&#34;&amp;#34;&#34;&nbsp;is&nbsp;shorter&nbsp;than&nbsp;&#34;&amp;quot;&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5227059">esc</span>&nbsp;<span class="op" id="5227063">=</span>&nbsp;<span class="string" id="5227065">&#34;&amp;#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5227075">default</span><span class="op" id="5227082">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5227087">panic</span><span class="op" id="5227092">(</span><span class="string" id="5227093">&#34;unrecognized&nbsp;escape&nbsp;character&#34;</span><span class="op" id="5227124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5227128">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5227132">s</span>&nbsp;<span class="op" id="5227134">=</span>&nbsp;<span class="ident" id="5227136">s</span><span class="op" id="5227137">[</span><span class="ident" id="5227138">i</span><span class="op" id="5227139">+</span><span class="num" id="5227140">1</span><span class="op" id="5227141">:</span><span class="op" id="5227142">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5227146">if</span>&nbsp;<span class="ident" id="5227149">_</span><span class="op" id="5227150">,</span>&nbsp;<span class="ident" id="5227152">err</span>&nbsp;<span class="op" id="5227156">:=</span>&nbsp;<span class="ident" id="5227159">w</span><span class="op" id="5227160">.</span><span class="ident" id="5227161">WriteString</span><span class="op" id="5227172">(</span><span class="ident" id="5227173">esc</span><span class="op" id="5227176">)</span><span class="op" id="5227177">;</span>&nbsp;<span class="ident" id="5227179">err</span>&nbsp;<span class="op" id="5227183">!=</span>&nbsp;<span class="ident" id="5227186">nil</span>&nbsp;<span class="op" id="5227190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5227195">return</span>&nbsp;<span class="ident" id="5227202">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5227208">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5227212">i</span>&nbsp;<span class="op" id="5227214">=</span>&nbsp;<span class="ident" id="5227216">strings</span><span class="op" id="5227223">.</span><span class="ident" id="5227224">IndexAny</span><span class="op" id="5227232">(</span><span class="ident" id="5227233">s</span><span class="op" id="5227234">,</span>&nbsp;<span class="ident" id="5227236">escapedChars</span><span class="op" id="5227248">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5227251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5227254">_</span><span class="op" id="5227255">,</span>&nbsp;<span class="ident" id="5227257">err</span>&nbsp;<span class="op" id="5227261">:=</span>&nbsp;<span class="ident" id="5227264">w</span><span class="op" id="5227265">.</span><span class="ident" id="5227266">WriteString</span><span class="op" id="5227277">(</span><span class="ident" id="5227278">s</span><span class="op" id="5227279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5227282">return</span>&nbsp;<span class="ident" id="5227289">err</span><br>
<span class="lineno"></span><span class="op" id="5227293">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span><span class="comment" id="5227296">//&nbsp;EscapeString&nbsp;escapes&nbsp;special&nbsp;characters&nbsp;like&nbsp;&#34;&lt;&#34;&nbsp;to&nbsp;become&nbsp;&#34;&amp;lt;&#34;.&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="5227369">//&nbsp;escapes&nbsp;only&nbsp;five&nbsp;such&nbsp;characters:&nbsp;&lt;,&nbsp;&gt;,&nbsp;&amp;,&nbsp;&#39;&nbsp;and&nbsp;&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="5227425">//&nbsp;UnescapeString(EscapeString(s))&nbsp;==&nbsp;s&nbsp;always&nbsp;holds,&nbsp;but&nbsp;the&nbsp;converse&nbsp;isn&#39;t</span><br>
<span class="lineno"></span><span class="comment" id="5227502">//&nbsp;always&nbsp;true.</span><br>
<span class="lineno"></span><span class="keyword" id="5227518">func</span>&nbsp;<span class="ident" id="5227523">EscapeString</span><span class="op" id="5227535">(</span><span class="ident" id="5227536">s</span>&nbsp;<span class="builtintype" id="5227538">string</span><span class="op" id="5227544">)</span>&nbsp;<span class="builtintype" id="5227546">string</span>&nbsp;<span class="op" id="5227553">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5227556">if</span>&nbsp;<span class="ident" id="5227559">strings</span><span class="op" id="5227566">.</span><span class="ident" id="5227567">IndexAny</span><span class="op" id="5227575">(</span><span class="ident" id="5227576">s</span><span class="op" id="5227577">,</span>&nbsp;<span class="ident" id="5227579">escapedChars</span><span class="op" id="5227591">)</span>&nbsp;<span class="op" id="5227593">==</span>&nbsp;<span class="op" id="5227596">-</span><span class="num" id="5227597">1</span>&nbsp;<span class="op" id="5227599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5227603">return</span>&nbsp;<span class="ident" id="5227610">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5227613">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5227616">var</span>&nbsp;<span class="ident" id="5227620">buf</span>&nbsp;<span class="ident" id="5227624">bytes</span><span class="op" id="5227629">.</span><span class="ident" id="5227630">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5227638">escape</span><span class="op" id="5227644">(</span><span class="op" id="5227645">&amp;</span><span class="ident" id="5227646">buf</span><span class="op" id="5227649">,</span>&nbsp;<span class="ident" id="5227651">s</span><span class="op" id="5227652">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5227655">return</span>&nbsp;<span class="ident" id="5227662">buf</span><span class="op" id="5227665">.</span><span class="ident" id="5227666">String</span><span class="op" id="5227672">(</span><span class="op" id="5227673">)</span><br>
<span class="lineno"></span><span class="op" id="5227675">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5227678">//&nbsp;UnescapeString&nbsp;unescapes&nbsp;entities&nbsp;like&nbsp;&#34;&amp;lt;&#34;&nbsp;to&nbsp;become&nbsp;&#34;&lt;&#34;.&nbsp;It&nbsp;unescapes&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5227757">//&nbsp;larger&nbsp;range&nbsp;of&nbsp;entities&nbsp;than&nbsp;EscapeString&nbsp;escapes.&nbsp;For&nbsp;example,&nbsp;&#34;&amp;aacute;&#34;</span><br>
<span class="lineno">240</span><span class="comment" id="5227836">//&nbsp;unescapes&nbsp;to&nbsp;&#34;á&#34;,&nbsp;as&nbsp;does&nbsp;&#34;&amp;#225;&#34;&nbsp;and&nbsp;&#34;&amp;xE1;&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="5227888">//&nbsp;UnescapeString(EscapeString(s))&nbsp;==&nbsp;s&nbsp;always&nbsp;holds,&nbsp;but&nbsp;the&nbsp;converse&nbsp;isn&#39;t</span><br>
<span class="lineno"></span><span class="comment" id="5227965">//&nbsp;always&nbsp;true.</span><br>
<span class="lineno"></span><span class="keyword" id="5227981">func</span>&nbsp;<span class="ident" id="5227986">UnescapeString</span><span class="op" id="5228000">(</span><span class="ident" id="5228001">s</span>&nbsp;<span class="builtintype" id="5228003">string</span><span class="op" id="5228009">)</span>&nbsp;<span class="builtintype" id="5228011">string</span>&nbsp;<span class="op" id="5228018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5228021">for</span>&nbsp;<span class="ident" id="5228025">_</span><span class="op" id="5228026">,</span>&nbsp;<span class="ident" id="5228028">c</span>&nbsp;<span class="op" id="5228030">:=</span>&nbsp;<span class="keyword" id="5228033">range</span>&nbsp;<span class="ident" id="5228039">s</span>&nbsp;<span class="op" id="5228041">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5228045">if</span>&nbsp;<span class="ident" id="5228048">c</span>&nbsp;<span class="op" id="5228050">==</span>&nbsp;<span class="string" id="5228053">&#39;&amp;&#39;</span>&nbsp;<span class="op" id="5228057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5228062">return</span>&nbsp;<span class="builtintype" id="5228069">string</span><span class="op" id="5228075">(</span><span class="ident" id="5228076">unescape</span><span class="op" id="5228084">(</span><span class="op" id="5228085">[</span><span class="op" id="5228086">]</span><span class="builtintype" id="5228087">byte</span><span class="op" id="5228091">(</span><span class="ident" id="5228092">s</span><span class="op" id="5228093">)</span><span class="op" id="5228094">)</span><span class="op" id="5228095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5228099">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5228102">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5228105">return</span>&nbsp;<span class="ident" id="5228112">s</span><br>
<span class="lineno">250</span><span class="op" id="5228114">}</span>
</div>
</body>
</html>
