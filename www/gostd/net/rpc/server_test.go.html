<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/rpc</h2>
<ul>
<li><a href="/gostd/net/rpc/client.go.html">client.go</a></li>
<li><a href="/gostd/net/rpc/client_test.go.html">client_test.go</a></li>
<li><a href="/gostd/net/rpc/debug.go.html">debug.go</a></li>
<li><a href="/gostd/net/rpc/server.go.html">server.go</a></li>
<li><a href="/gostd/net/rpc/server_test.go.html" class="current">server_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6617232">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6617287">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6617341">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6617392">package</span>&nbsp;<span class="ident" id="6617400">rpc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6617405">import</span>&nbsp;<span class="op" id="6617412">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6617415">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6617425">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6617432">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6617438">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6617445">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6617452">&#34;net/http/httptest&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6617473">&#34;runtime&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6617484">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6617495">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6617503">&#34;sync/atomic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6617518">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6617529">&#34;time&#34;</span><br>
<span class="lineno">20</span><span class="op" id="6617536">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6617539">var</span>&nbsp;<span class="op" id="6617543">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6617546">newServer</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6617572">*</span><span class="ident" id="6617573">Server</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6617581">serverAddr</span><span class="op" id="6617591">,</span>&nbsp;<span class="ident" id="6617593">newServerAddr</span>&nbsp;<span class="builtintype" id="6617607">string</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6617615">httpServerAddr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6617641">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6617649">once</span><span class="op" id="6617653">,</span>&nbsp;<span class="ident" id="6617655">newOnce</span><span class="op" id="6617662">,</span>&nbsp;<span class="ident" id="6617664">httpOnce</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6617675">sync</span><span class="op" id="6617679">.</span><span class="ident" id="6617680">Once</span><br>
<span class="lineno"></span><span class="op" id="6617685">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6617688">const</span>&nbsp;<span class="op" id="6617694">(</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6617697">newHttpPath</span>&nbsp;<span class="op" id="6617709">=</span>&nbsp;<span class="string" id="6617711">&#34;/foo&#34;</span><br>
<span class="lineno"></span><span class="op" id="6617718">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6617721">type</span>&nbsp;<span class="ident" id="6617726">Args</span>&nbsp;<span class="keyword" id="6617731">struct</span>&nbsp;<span class="op" id="6617738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6617741">A</span><span class="op" id="6617742">,</span>&nbsp;<span class="ident" id="6617744">B</span>&nbsp;<span class="builtintype" id="6617746">int</span><br>
<span class="lineno">35</span><span class="op" id="6617750">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6617753">type</span>&nbsp;<span class="ident" id="6617758">Reply</span>&nbsp;<span class="keyword" id="6617764">struct</span>&nbsp;<span class="op" id="6617771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6617774">C</span>&nbsp;<span class="builtintype" id="6617776">int</span><br>
<span class="lineno"></span><span class="op" id="6617780">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="6617783">type</span>&nbsp;<span class="ident" id="6617788">Arith</span>&nbsp;<span class="builtintype" id="6617794">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6617799">//&nbsp;Some&nbsp;of&nbsp;Arith&#39;s&nbsp;methods&nbsp;have&nbsp;value&nbsp;args,&nbsp;some&nbsp;have&nbsp;pointer&nbsp;args.&nbsp;That&#39;s&nbsp;deliberate.</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="6617887">func</span>&nbsp;<span class="op" id="6617892">(</span><span class="ident" id="6617893">t</span>&nbsp;<span class="op" id="6617895">*</span><span class="ident" id="6617896">Arith</span><span class="op" id="6617901">)</span>&nbsp;<span class="ident" id="6617903">Add</span><span class="op" id="6617906">(</span><span class="ident" id="6617907">args</span>&nbsp;<span class="ident" id="6617912">Args</span><span class="op" id="6617916">,</span>&nbsp;<span class="ident" id="6617918">reply</span>&nbsp;<span class="op" id="6617924">*</span><span class="ident" id="6617925">Reply</span><span class="op" id="6617930">)</span>&nbsp;<span class="builtintype" id="6617932">error</span>&nbsp;<span class="op" id="6617938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6617941">reply</span><span class="op" id="6617946">.</span><span class="ident" id="6617947">C</span>&nbsp;<span class="op" id="6617949">=</span>&nbsp;<span class="ident" id="6617951">args</span><span class="op" id="6617955">.</span><span class="ident" id="6617956">A</span>&nbsp;<span class="op" id="6617958">+</span>&nbsp;<span class="ident" id="6617960">args</span><span class="op" id="6617964">.</span><span class="ident" id="6617965">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6617968">return</span>&nbsp;<span class="builtintype" id="6617975">nil</span><br>
<span class="lineno"></span><span class="op" id="6617979">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="keyword" id="6617982">func</span>&nbsp;<span class="op" id="6617987">(</span><span class="ident" id="6617988">t</span>&nbsp;<span class="op" id="6617990">*</span><span class="ident" id="6617991">Arith</span><span class="op" id="6617996">)</span>&nbsp;<span class="ident" id="6617998">Mul</span><span class="op" id="6618001">(</span><span class="ident" id="6618002">args</span>&nbsp;<span class="op" id="6618007">*</span><span class="ident" id="6618008">Args</span><span class="op" id="6618012">,</span>&nbsp;<span class="ident" id="6618014">reply</span>&nbsp;<span class="op" id="6618020">*</span><span class="ident" id="6618021">Reply</span><span class="op" id="6618026">)</span>&nbsp;<span class="builtintype" id="6618028">error</span>&nbsp;<span class="op" id="6618034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6618037">reply</span><span class="op" id="6618042">.</span><span class="ident" id="6618043">C</span>&nbsp;<span class="op" id="6618045">=</span>&nbsp;<span class="ident" id="6618047">args</span><span class="op" id="6618051">.</span><span class="ident" id="6618052">A</span>&nbsp;<span class="op" id="6618054">*</span>&nbsp;<span class="ident" id="6618056">args</span><span class="op" id="6618060">.</span><span class="ident" id="6618061">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6618064">return</span>&nbsp;<span class="builtintype" id="6618071">nil</span><br>
<span class="lineno"></span><span class="op" id="6618075">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="6618078">func</span>&nbsp;<span class="op" id="6618083">(</span><span class="ident" id="6618084">t</span>&nbsp;<span class="op" id="6618086">*</span><span class="ident" id="6618087">Arith</span><span class="op" id="6618092">)</span>&nbsp;<span class="ident" id="6618094">Div</span><span class="op" id="6618097">(</span><span class="ident" id="6618098">args</span>&nbsp;<span class="ident" id="6618103">Args</span><span class="op" id="6618107">,</span>&nbsp;<span class="ident" id="6618109">reply</span>&nbsp;<span class="op" id="6618115">*</span><span class="ident" id="6618116">Reply</span><span class="op" id="6618121">)</span>&nbsp;<span class="builtintype" id="6618123">error</span>&nbsp;<span class="op" id="6618129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6618132">if</span>&nbsp;<span class="ident" id="6618135">args</span><span class="op" id="6618139">.</span><span class="ident" id="6618140">B</span>&nbsp;<span class="op" id="6618142">==</span>&nbsp;<span class="num" id="6618145">0</span>&nbsp;<span class="op" id="6618147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6618151">return</span>&nbsp;<span class="ident" id="6618158">errors</span><span class="op" id="6618164">.</span><span class="ident" id="6618165">New</span><span class="op" id="6618168">(</span><span class="string" id="6618169">&#34;divide&nbsp;by&nbsp;zero&#34;</span><span class="op" id="6618185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6618188">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6618191">reply</span><span class="op" id="6618196">.</span><span class="ident" id="6618197">C</span>&nbsp;<span class="op" id="6618199">=</span>&nbsp;<span class="ident" id="6618201">args</span><span class="op" id="6618205">.</span><span class="ident" id="6618206">A</span>&nbsp;<span class="op" id="6618208">/</span>&nbsp;<span class="ident" id="6618210">args</span><span class="op" id="6618214">.</span><span class="ident" id="6618215">B</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6618218">return</span>&nbsp;<span class="builtintype" id="6618225">nil</span><br>
<span class="lineno"></span><span class="op" id="6618229">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6618232">func</span>&nbsp;<span class="op" id="6618237">(</span><span class="ident" id="6618238">t</span>&nbsp;<span class="op" id="6618240">*</span><span class="ident" id="6618241">Arith</span><span class="op" id="6618246">)</span>&nbsp;<span class="ident" id="6618248">String</span><span class="op" id="6618254">(</span><span class="ident" id="6618255">args</span>&nbsp;<span class="op" id="6618260">*</span><span class="ident" id="6618261">Args</span><span class="op" id="6618265">,</span>&nbsp;<span class="ident" id="6618267">reply</span>&nbsp;<span class="op" id="6618273">*</span><span class="builtintype" id="6618274">string</span><span class="op" id="6618280">)</span>&nbsp;<span class="builtintype" id="6618282">error</span>&nbsp;<span class="op" id="6618288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6618291">*</span><span class="ident" id="6618292">reply</span>&nbsp;<span class="op" id="6618298">=</span>&nbsp;<span class="ident" id="6618300">fmt</span><span class="op" id="6618303">.</span><span class="ident" id="6618304">Sprintf</span><span class="op" id="6618311">(</span><span class="string" id="6618312">&#34;%d+%d=%d&#34;</span><span class="op" id="6618322">,</span>&nbsp;<span class="ident" id="6618324">args</span><span class="op" id="6618328">.</span><span class="ident" id="6618329">A</span><span class="op" id="6618330">,</span>&nbsp;<span class="ident" id="6618332">args</span><span class="op" id="6618336">.</span><span class="ident" id="6618337">B</span><span class="op" id="6618338">,</span>&nbsp;<span class="ident" id="6618340">args</span><span class="op" id="6618344">.</span><span class="ident" id="6618345">A</span><span class="op" id="6618346">+</span><span class="ident" id="6618347">args</span><span class="op" id="6618351">.</span><span class="ident" id="6618352">B</span><span class="op" id="6618353">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6618356">return</span>&nbsp;<span class="builtintype" id="6618363">nil</span><br>
<span class="lineno"></span><span class="op" id="6618367">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6618370">func</span>&nbsp;<span class="op" id="6618375">(</span><span class="ident" id="6618376">t</span>&nbsp;<span class="op" id="6618378">*</span><span class="ident" id="6618379">Arith</span><span class="op" id="6618384">)</span>&nbsp;<span class="ident" id="6618386">Scan</span><span class="op" id="6618390">(</span><span class="ident" id="6618391">args</span>&nbsp;<span class="builtintype" id="6618396">string</span><span class="op" id="6618402">,</span>&nbsp;<span class="ident" id="6618404">reply</span>&nbsp;<span class="op" id="6618410">*</span><span class="ident" id="6618411">Reply</span><span class="op" id="6618416">)</span>&nbsp;<span class="op" id="6618418">(</span><span class="ident" id="6618419">err</span>&nbsp;<span class="builtintype" id="6618423">error</span><span class="op" id="6618428">)</span>&nbsp;<span class="op" id="6618430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6618433">_</span><span class="op" id="6618434">,</span>&nbsp;<span class="ident" id="6618436">err</span>&nbsp;<span class="op" id="6618440">=</span>&nbsp;<span class="ident" id="6618442">fmt</span><span class="op" id="6618445">.</span><span class="ident" id="6618446">Sscan</span><span class="op" id="6618451">(</span><span class="ident" id="6618452">args</span><span class="op" id="6618456">,</span>&nbsp;<span class="op" id="6618458">&amp;</span><span class="ident" id="6618459">reply</span><span class="op" id="6618464">.</span><span class="ident" id="6618465">C</span><span class="op" id="6618466">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6618469">return</span><br>
<span class="lineno"></span><span class="op" id="6618476">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6618479">func</span>&nbsp;<span class="op" id="6618484">(</span><span class="ident" id="6618485">t</span>&nbsp;<span class="op" id="6618487">*</span><span class="ident" id="6618488">Arith</span><span class="op" id="6618493">)</span>&nbsp;<span class="ident" id="6618495">Error</span><span class="op" id="6618500">(</span><span class="ident" id="6618501">args</span>&nbsp;<span class="op" id="6618506">*</span><span class="ident" id="6618507">Args</span><span class="op" id="6618511">,</span>&nbsp;<span class="ident" id="6618513">reply</span>&nbsp;<span class="op" id="6618519">*</span><span class="ident" id="6618520">Reply</span><span class="op" id="6618525">)</span>&nbsp;<span class="builtintype" id="6618527">error</span>&nbsp;<span class="op" id="6618533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6618536">panic</span><span class="op" id="6618541">(</span><span class="string" id="6618542">&#34;ERROR&#34;</span><span class="op" id="6618549">)</span><br>
<span class="lineno">75</span><span class="op" id="6618551">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6618554">func</span>&nbsp;<span class="ident" id="6618559">listenTCP</span><span class="op" id="6618568">(</span><span class="op" id="6618569">)</span>&nbsp;<span class="op" id="6618571">(</span><span class="ident" id="6618572">net</span><span class="op" id="6618575">.</span><span class="ident" id="6618576">Listener</span><span class="op" id="6618584">,</span>&nbsp;<span class="builtintype" id="6618586">string</span><span class="op" id="6618592">)</span>&nbsp;<span class="op" id="6618594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6618597">l</span><span class="op" id="6618598">,</span>&nbsp;<span class="ident" id="6618600">e</span>&nbsp;<span class="op" id="6618602">:=</span>&nbsp;<span class="ident" id="6618605">net</span><span class="op" id="6618608">.</span><span class="ident" id="6618609">Listen</span><span class="op" id="6618615">(</span><span class="string" id="6618616">&#34;tcp&#34;</span><span class="op" id="6618621">,</span>&nbsp;<span class="string" id="6618623">&#34;127.0.0.1:0&#34;</span><span class="op" id="6618636">)</span>&nbsp;<span class="comment" id="6618638">//&nbsp;any&nbsp;available&nbsp;address</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6618664">if</span>&nbsp;<span class="ident" id="6618667">e</span>&nbsp;<span class="op" id="6618669">!=</span>&nbsp;<span class="builtintype" id="6618672">nil</span>&nbsp;<span class="op" id="6618676">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6618680">log</span><span class="op" id="6618683">.</span><span class="ident" id="6618684">Fatalf</span><span class="op" id="6618690">(</span><span class="string" id="6618691">&#34;net.Listen&nbsp;tcp&nbsp;:0:&nbsp;%v&#34;</span><span class="op" id="6618714">,</span>&nbsp;<span class="ident" id="6618716">e</span><span class="op" id="6618717">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6618720">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6618723">return</span>&nbsp;<span class="ident" id="6618730">l</span><span class="op" id="6618731">,</span>&nbsp;<span class="ident" id="6618733">l</span><span class="op" id="6618734">.</span><span class="ident" id="6618735">Addr</span><span class="op" id="6618739">(</span><span class="op" id="6618740">)</span><span class="op" id="6618741">.</span><span class="ident" id="6618742">String</span><span class="op" id="6618748">(</span><span class="op" id="6618749">)</span><br>
<span class="lineno"></span><span class="op" id="6618751">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="keyword" id="6618754">func</span>&nbsp;<span class="ident" id="6618759">startServer</span><span class="op" id="6618770">(</span><span class="op" id="6618771">)</span>&nbsp;<span class="op" id="6618773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6618776">Register</span><span class="op" id="6618784">(</span><span class="builtinfunc" id="6618785">new</span><span class="op" id="6618788">(</span><span class="ident" id="6618789">Arith</span><span class="op" id="6618794">)</span><span class="op" id="6618795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6618798">RegisterName</span><span class="op" id="6618810">(</span><span class="string" id="6618811">&#34;net.rpc.Arith&#34;</span><span class="op" id="6618826">,</span>&nbsp;<span class="builtinfunc" id="6618828">new</span><span class="op" id="6618831">(</span><span class="ident" id="6618832">Arith</span><span class="op" id="6618837">)</span><span class="op" id="6618838">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6618842">var</span>&nbsp;<span class="ident" id="6618846">l</span>&nbsp;<span class="ident" id="6618848">net</span><span class="op" id="6618851">.</span><span class="ident" id="6618852">Listener</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6618862">l</span><span class="op" id="6618863">,</span>&nbsp;<span class="ident" id="6618865">serverAddr</span>&nbsp;<span class="op" id="6618876">=</span>&nbsp;<span class="ident" id="6618878">listenTCP</span><span class="op" id="6618887">(</span><span class="op" id="6618888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6618891">log</span><span class="op" id="6618894">.</span><span class="ident" id="6618895">Println</span><span class="op" id="6618902">(</span><span class="string" id="6618903">&#34;Test&nbsp;RPC&nbsp;server&nbsp;listening&nbsp;on&#34;</span><span class="op" id="6618933">,</span>&nbsp;<span class="ident" id="6618935">serverAddr</span><span class="op" id="6618945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6618948">go</span>&nbsp;<span class="ident" id="6618951">Accept</span><span class="op" id="6618957">(</span><span class="ident" id="6618958">l</span><span class="op" id="6618959">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6618963">HandleHTTP</span><span class="op" id="6618973">(</span><span class="op" id="6618974">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6618977">httpOnce</span><span class="op" id="6618985">.</span><span class="ident" id="6618986">Do</span><span class="op" id="6618988">(</span><span class="ident" id="6618989">startHttpServer</span><span class="op" id="6619004">)</span><br>
<span class="lineno"></span><span class="op" id="6619006">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6619009">func</span>&nbsp;<span class="ident" id="6619014">startNewServer</span><span class="op" id="6619028">(</span><span class="op" id="6619029">)</span>&nbsp;<span class="op" id="6619031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6619034">newServer</span>&nbsp;<span class="op" id="6619044">=</span>&nbsp;<span class="ident" id="6619046">NewServer</span><span class="op" id="6619055">(</span><span class="op" id="6619056">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6619059">newServer</span><span class="op" id="6619068">.</span><span class="ident" id="6619069">Register</span><span class="op" id="6619077">(</span><span class="builtinfunc" id="6619078">new</span><span class="op" id="6619081">(</span><span class="ident" id="6619082">Arith</span><span class="op" id="6619087">)</span><span class="op" id="6619088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6619091">newServer</span><span class="op" id="6619100">.</span><span class="ident" id="6619101">RegisterName</span><span class="op" id="6619113">(</span><span class="string" id="6619114">&#34;net.rpc.Arith&#34;</span><span class="op" id="6619129">,</span>&nbsp;<span class="builtinfunc" id="6619131">new</span><span class="op" id="6619134">(</span><span class="ident" id="6619135">Arith</span><span class="op" id="6619140">)</span><span class="op" id="6619141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6619144">newServer</span><span class="op" id="6619153">.</span><span class="ident" id="6619154">RegisterName</span><span class="op" id="6619166">(</span><span class="string" id="6619167">&#34;newServer.Arith&#34;</span><span class="op" id="6619184">,</span>&nbsp;<span class="builtinfunc" id="6619186">new</span><span class="op" id="6619189">(</span><span class="ident" id="6619190">Arith</span><span class="op" id="6619195">)</span><span class="op" id="6619196">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6619200">var</span>&nbsp;<span class="ident" id="6619204">l</span>&nbsp;<span class="ident" id="6619206">net</span><span class="op" id="6619209">.</span><span class="ident" id="6619210">Listener</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6619220">l</span><span class="op" id="6619221">,</span>&nbsp;<span class="ident" id="6619223">newServerAddr</span>&nbsp;<span class="op" id="6619237">=</span>&nbsp;<span class="ident" id="6619239">listenTCP</span><span class="op" id="6619248">(</span><span class="op" id="6619249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6619252">log</span><span class="op" id="6619255">.</span><span class="ident" id="6619256">Println</span><span class="op" id="6619263">(</span><span class="string" id="6619264">&#34;NewServer&nbsp;test&nbsp;RPC&nbsp;server&nbsp;listening&nbsp;on&#34;</span><span class="op" id="6619304">,</span>&nbsp;<span class="ident" id="6619306">newServerAddr</span><span class="op" id="6619319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6619322">go</span>&nbsp;<span class="ident" id="6619325">newServer</span><span class="op" id="6619334">.</span><span class="ident" id="6619335">Accept</span><span class="op" id="6619341">(</span><span class="ident" id="6619342">l</span><span class="op" id="6619343">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6619347">newServer</span><span class="op" id="6619356">.</span><span class="ident" id="6619357">HandleHTTP</span><span class="op" id="6619367">(</span><span class="ident" id="6619368">newHttpPath</span><span class="op" id="6619379">,</span>&nbsp;<span class="string" id="6619381">&#34;/bar&#34;</span><span class="op" id="6619387">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6619390">httpOnce</span><span class="op" id="6619398">.</span><span class="ident" id="6619399">Do</span><span class="op" id="6619401">(</span><span class="ident" id="6619402">startHttpServer</span><span class="op" id="6619417">)</span><br>
<span class="lineno"></span><span class="op" id="6619419">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6619422">func</span>&nbsp;<span class="ident" id="6619427">startHttpServer</span><span class="op" id="6619442">(</span><span class="op" id="6619443">)</span>&nbsp;<span class="op" id="6619445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6619448">server</span>&nbsp;<span class="op" id="6619455">:=</span>&nbsp;<span class="ident" id="6619458">httptest</span><span class="op" id="6619466">.</span><span class="ident" id="6619467">NewServer</span><span class="op" id="6619476">(</span><span class="builtintype" id="6619477">nil</span><span class="op" id="6619480">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6619483">httpServerAddr</span>&nbsp;<span class="op" id="6619498">=</span>&nbsp;<span class="ident" id="6619500">server</span><span class="op" id="6619506">.</span><span class="ident" id="6619507">Listener</span><span class="op" id="6619515">.</span><span class="ident" id="6619516">Addr</span><span class="op" id="6619520">(</span><span class="op" id="6619521">)</span><span class="op" id="6619522">.</span><span class="ident" id="6619523">String</span><span class="op" id="6619529">(</span><span class="op" id="6619530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6619533">log</span><span class="op" id="6619536">.</span><span class="ident" id="6619537">Println</span><span class="op" id="6619544">(</span><span class="string" id="6619545">&#34;Test&nbsp;HTTP&nbsp;RPC&nbsp;server&nbsp;listening&nbsp;on&#34;</span><span class="op" id="6619580">,</span>&nbsp;<span class="ident" id="6619582">httpServerAddr</span><span class="op" id="6619596">)</span><br>
<span class="lineno"></span><span class="op" id="6619598">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6619601">func</span>&nbsp;<span class="ident" id="6619606">TestRPC</span><span class="op" id="6619613">(</span><span class="ident" id="6619614">t</span>&nbsp;<span class="op" id="6619616">*</span><span class="ident" id="6619617">testing</span><span class="op" id="6619624">.</span><span class="ident" id="6619625">T</span><span class="op" id="6619626">)</span>&nbsp;<span class="op" id="6619628">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6619631">once</span><span class="op" id="6619635">.</span><span class="ident" id="6619636">Do</span><span class="op" id="6619638">(</span><span class="ident" id="6619639">startServer</span><span class="op" id="6619650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6619653">testRPC</span><span class="op" id="6619660">(</span><span class="ident" id="6619661">t</span><span class="op" id="6619662">,</span>&nbsp;<span class="ident" id="6619664">serverAddr</span><span class="op" id="6619674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6619677">newOnce</span><span class="op" id="6619684">.</span><span class="ident" id="6619685">Do</span><span class="op" id="6619687">(</span><span class="ident" id="6619688">startNewServer</span><span class="op" id="6619702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6619705">testRPC</span><span class="op" id="6619712">(</span><span class="ident" id="6619713">t</span><span class="op" id="6619714">,</span>&nbsp;<span class="ident" id="6619716">newServerAddr</span><span class="op" id="6619729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6619732">testNewServerRPC</span><span class="op" id="6619748">(</span><span class="ident" id="6619749">t</span><span class="op" id="6619750">,</span>&nbsp;<span class="ident" id="6619752">newServerAddr</span><span class="op" id="6619765">)</span><br>
<span class="lineno">125</span><span class="op" id="6619767">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6619770">func</span>&nbsp;<span class="ident" id="6619775">testRPC</span><span class="op" id="6619782">(</span><span class="ident" id="6619783">t</span>&nbsp;<span class="op" id="6619785">*</span><span class="ident" id="6619786">testing</span><span class="op" id="6619793">.</span><span class="ident" id="6619794">T</span><span class="op" id="6619795">,</span>&nbsp;<span class="ident" id="6619797">addr</span>&nbsp;<span class="builtintype" id="6619802">string</span><span class="op" id="6619808">)</span>&nbsp;<span class="op" id="6619810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6619813">client</span><span class="op" id="6619819">,</span>&nbsp;<span class="ident" id="6619821">err</span>&nbsp;<span class="op" id="6619825">:=</span>&nbsp;<span class="ident" id="6619828">Dial</span><span class="op" id="6619832">(</span><span class="string" id="6619833">&#34;tcp&#34;</span><span class="op" id="6619838">,</span>&nbsp;<span class="ident" id="6619840">addr</span><span class="op" id="6619844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6619847">if</span>&nbsp;<span class="ident" id="6619850">err</span>&nbsp;<span class="op" id="6619854">!=</span>&nbsp;<span class="builtintype" id="6619857">nil</span>&nbsp;<span class="op" id="6619861">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6619865">t</span><span class="op" id="6619866">.</span><span class="ident" id="6619867">Fatal</span><span class="op" id="6619872">(</span><span class="string" id="6619873">&#34;dialing&#34;</span><span class="op" id="6619882">,</span>&nbsp;<span class="ident" id="6619884">err</span><span class="op" id="6619887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6619890">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6619893">defer</span>&nbsp;<span class="ident" id="6619899">client</span><span class="op" id="6619905">.</span><span class="ident" id="6619906">Close</span><span class="op" id="6619911">(</span><span class="op" id="6619912">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6619916">//&nbsp;Synchronous&nbsp;calls</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6619938">args</span>&nbsp;<span class="op" id="6619943">:=</span>&nbsp;<span class="op" id="6619946">&amp;</span><span class="ident" id="6619947">Args</span><span class="op" id="6619951">{</span><span class="num" id="6619952">7</span><span class="op" id="6619953">,</span>&nbsp;<span class="num" id="6619955">8</span><span class="op" id="6619956">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6619959">reply</span>&nbsp;<span class="op" id="6619965">:=</span>&nbsp;<span class="builtinfunc" id="6619968">new</span><span class="op" id="6619971">(</span><span class="ident" id="6619972">Reply</span><span class="op" id="6619977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6619980">err</span>&nbsp;<span class="op" id="6619984">=</span>&nbsp;<span class="ident" id="6619986">client</span><span class="op" id="6619992">.</span><span class="ident" id="6619993">Call</span><span class="op" id="6619997">(</span><span class="string" id="6619998">&#34;Arith.Add&#34;</span><span class="op" id="6620009">,</span>&nbsp;<span class="ident" id="6620011">args</span><span class="op" id="6620015">,</span>&nbsp;<span class="ident" id="6620017">reply</span><span class="op" id="6620022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6620025">if</span>&nbsp;<span class="ident" id="6620028">err</span>&nbsp;<span class="op" id="6620032">!=</span>&nbsp;<span class="builtintype" id="6620035">nil</span>&nbsp;<span class="op" id="6620039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6620043">t</span><span class="op" id="6620044">.</span><span class="ident" id="6620045">Errorf</span><span class="op" id="6620051">(</span><span class="string" id="6620052">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6620094">,</span>&nbsp;<span class="ident" id="6620096">err</span><span class="op" id="6620099">.</span><span class="ident" id="6620100">Error</span><span class="op" id="6620105">(</span><span class="op" id="6620106">)</span><span class="op" id="6620107">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6620110">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6620113">if</span>&nbsp;<span class="ident" id="6620116">reply</span><span class="op" id="6620121">.</span><span class="ident" id="6620122">C</span>&nbsp;<span class="op" id="6620124">!=</span>&nbsp;<span class="ident" id="6620127">args</span><span class="op" id="6620131">.</span><span class="ident" id="6620132">A</span><span class="op" id="6620133">+</span><span class="ident" id="6620134">args</span><span class="op" id="6620138">.</span><span class="ident" id="6620139">B</span>&nbsp;<span class="op" id="6620141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6620145">t</span><span class="op" id="6620146">.</span><span class="ident" id="6620147">Errorf</span><span class="op" id="6620153">(</span><span class="string" id="6620154">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6620179">,</span>&nbsp;<span class="ident" id="6620181">reply</span><span class="op" id="6620186">.</span><span class="ident" id="6620187">C</span><span class="op" id="6620188">,</span>&nbsp;<span class="ident" id="6620190">args</span><span class="op" id="6620194">.</span><span class="ident" id="6620195">A</span><span class="op" id="6620196">+</span><span class="ident" id="6620197">args</span><span class="op" id="6620201">.</span><span class="ident" id="6620202">B</span><span class="op" id="6620203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6620206">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6620210">//&nbsp;Nonexistent&nbsp;method</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6620233">args</span>&nbsp;<span class="op" id="6620238">=</span>&nbsp;<span class="op" id="6620240">&amp;</span><span class="ident" id="6620241">Args</span><span class="op" id="6620245">{</span><span class="num" id="6620246">7</span><span class="op" id="6620247">,</span>&nbsp;<span class="num" id="6620249">0</span><span class="op" id="6620250">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6620253">reply</span>&nbsp;<span class="op" id="6620259">=</span>&nbsp;<span class="builtinfunc" id="6620261">new</span><span class="op" id="6620264">(</span><span class="ident" id="6620265">Reply</span><span class="op" id="6620270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6620273">err</span>&nbsp;<span class="op" id="6620277">=</span>&nbsp;<span class="ident" id="6620279">client</span><span class="op" id="6620285">.</span><span class="ident" id="6620286">Call</span><span class="op" id="6620290">(</span><span class="string" id="6620291">&#34;Arith.BadOperation&#34;</span><span class="op" id="6620311">,</span>&nbsp;<span class="ident" id="6620313">args</span><span class="op" id="6620317">,</span>&nbsp;<span class="ident" id="6620319">reply</span><span class="op" id="6620324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6620327">//&nbsp;expect&nbsp;an&nbsp;error</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6620347">if</span>&nbsp;<span class="ident" id="6620350">err</span>&nbsp;<span class="op" id="6620354">==</span>&nbsp;<span class="builtintype" id="6620357">nil</span>&nbsp;<span class="op" id="6620361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6620365">t</span><span class="op" id="6620366">.</span><span class="ident" id="6620367">Error</span><span class="op" id="6620372">(</span><span class="string" id="6620373">&#34;BadOperation:&nbsp;expected&nbsp;error&#34;</span><span class="op" id="6620403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6620406">}</span>&nbsp;<span class="keyword" id="6620408">else</span>&nbsp;<span class="keyword" id="6620413">if</span>&nbsp;<span class="op" id="6620416">!</span><span class="ident" id="6620417">strings</span><span class="op" id="6620424">.</span><span class="ident" id="6620425">HasPrefix</span><span class="op" id="6620434">(</span><span class="ident" id="6620435">err</span><span class="op" id="6620438">.</span><span class="ident" id="6620439">Error</span><span class="op" id="6620444">(</span><span class="op" id="6620445">)</span><span class="op" id="6620446">,</span>&nbsp;<span class="string" id="6620448">&#34;rpc:&nbsp;can&#39;t&nbsp;find&nbsp;method&nbsp;&#34;</span><span class="op" id="6620473">)</span>&nbsp;<span class="op" id="6620475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6620479">t</span><span class="op" id="6620480">.</span><span class="ident" id="6620481">Errorf</span><span class="op" id="6620487">(</span><span class="string" id="6620488">&#34;BadOperation:&nbsp;expected&nbsp;can&#39;t&nbsp;find&nbsp;method&nbsp;error;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="6620544">,</span>&nbsp;<span class="ident" id="6620546">err</span><span class="op" id="6620549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6620552">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6620556">//&nbsp;Unknown&nbsp;service</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6620576">args</span>&nbsp;<span class="op" id="6620581">=</span>&nbsp;<span class="op" id="6620583">&amp;</span><span class="ident" id="6620584">Args</span><span class="op" id="6620588">{</span><span class="num" id="6620589">7</span><span class="op" id="6620590">,</span>&nbsp;<span class="num" id="6620592">8</span><span class="op" id="6620593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6620596">reply</span>&nbsp;<span class="op" id="6620602">=</span>&nbsp;<span class="builtinfunc" id="6620604">new</span><span class="op" id="6620607">(</span><span class="ident" id="6620608">Reply</span><span class="op" id="6620613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6620616">err</span>&nbsp;<span class="op" id="6620620">=</span>&nbsp;<span class="ident" id="6620622">client</span><span class="op" id="6620628">.</span><span class="ident" id="6620629">Call</span><span class="op" id="6620633">(</span><span class="string" id="6620634">&#34;Arith.Unknown&#34;</span><span class="op" id="6620649">,</span>&nbsp;<span class="ident" id="6620651">args</span><span class="op" id="6620655">,</span>&nbsp;<span class="ident" id="6620657">reply</span><span class="op" id="6620662">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6620665">if</span>&nbsp;<span class="ident" id="6620668">err</span>&nbsp;<span class="op" id="6620672">==</span>&nbsp;<span class="builtintype" id="6620675">nil</span>&nbsp;<span class="op" id="6620679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6620683">t</span><span class="op" id="6620684">.</span><span class="ident" id="6620685">Error</span><span class="op" id="6620690">(</span><span class="string" id="6620691">&#34;expected&nbsp;error&nbsp;calling&nbsp;unknown&nbsp;service&#34;</span><span class="op" id="6620731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6620734">}</span>&nbsp;<span class="keyword" id="6620736">else</span>&nbsp;<span class="keyword" id="6620741">if</span>&nbsp;<span class="ident" id="6620744">strings</span><span class="op" id="6620751">.</span><span class="ident" id="6620752">Index</span><span class="op" id="6620757">(</span><span class="ident" id="6620758">err</span><span class="op" id="6620761">.</span><span class="ident" id="6620762">Error</span><span class="op" id="6620767">(</span><span class="op" id="6620768">)</span><span class="op" id="6620769">,</span>&nbsp;<span class="string" id="6620771">&#34;method&#34;</span><span class="op" id="6620779">)</span>&nbsp;<span class="op" id="6620781">&lt;</span>&nbsp;<span class="num" id="6620783">0</span>&nbsp;<span class="op" id="6620785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6620789">t</span><span class="op" id="6620790">.</span><span class="ident" id="6620791">Error</span><span class="op" id="6620796">(</span><span class="string" id="6620797">&#34;expected&nbsp;error&nbsp;about&nbsp;method;&nbsp;got&#34;</span><span class="op" id="6620831">,</span>&nbsp;<span class="ident" id="6620833">err</span><span class="op" id="6620836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6620839">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6620843">//&nbsp;Out&nbsp;of&nbsp;order.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6620861">args</span>&nbsp;<span class="op" id="6620866">=</span>&nbsp;<span class="op" id="6620868">&amp;</span><span class="ident" id="6620869">Args</span><span class="op" id="6620873">{</span><span class="num" id="6620874">7</span><span class="op" id="6620875">,</span>&nbsp;<span class="num" id="6620877">8</span><span class="op" id="6620878">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6620881">mulReply</span>&nbsp;<span class="op" id="6620890">:=</span>&nbsp;<span class="builtinfunc" id="6620893">new</span><span class="op" id="6620896">(</span><span class="ident" id="6620897">Reply</span><span class="op" id="6620902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6620905">mulCall</span>&nbsp;<span class="op" id="6620913">:=</span>&nbsp;<span class="ident" id="6620916">client</span><span class="op" id="6620922">.</span><span class="ident" id="6620923">Go</span><span class="op" id="6620925">(</span><span class="string" id="6620926">&#34;Arith.Mul&#34;</span><span class="op" id="6620937">,</span>&nbsp;<span class="ident" id="6620939">args</span><span class="op" id="6620943">,</span>&nbsp;<span class="ident" id="6620945">mulReply</span><span class="op" id="6620953">,</span>&nbsp;<span class="builtintype" id="6620955">nil</span><span class="op" id="6620958">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6620961">addReply</span>&nbsp;<span class="op" id="6620970">:=</span>&nbsp;<span class="builtinfunc" id="6620973">new</span><span class="op" id="6620976">(</span><span class="ident" id="6620977">Reply</span><span class="op" id="6620982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6620985">addCall</span>&nbsp;<span class="op" id="6620993">:=</span>&nbsp;<span class="ident" id="6620996">client</span><span class="op" id="6621002">.</span><span class="ident" id="6621003">Go</span><span class="op" id="6621005">(</span><span class="string" id="6621006">&#34;Arith.Add&#34;</span><span class="op" id="6621017">,</span>&nbsp;<span class="ident" id="6621019">args</span><span class="op" id="6621023">,</span>&nbsp;<span class="ident" id="6621025">addReply</span><span class="op" id="6621033">,</span>&nbsp;<span class="builtintype" id="6621035">nil</span><span class="op" id="6621038">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6621042">addCall</span>&nbsp;<span class="op" id="6621050">=</span>&nbsp;<span class="op" id="6621052">&lt;-</span><span class="ident" id="6621054">addCall</span><span class="op" id="6621061">.</span><span class="ident" id="6621062">Done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6621068">if</span>&nbsp;<span class="ident" id="6621071">addCall</span><span class="op" id="6621078">.</span><span class="ident" id="6621079">Error</span>&nbsp;<span class="op" id="6621085">!=</span>&nbsp;<span class="builtintype" id="6621088">nil</span>&nbsp;<span class="op" id="6621092">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6621096">t</span><span class="op" id="6621097">.</span><span class="ident" id="6621098">Errorf</span><span class="op" id="6621104">(</span><span class="string" id="6621105">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6621147">,</span>&nbsp;<span class="ident" id="6621149">addCall</span><span class="op" id="6621156">.</span><span class="ident" id="6621157">Error</span><span class="op" id="6621162">.</span><span class="ident" id="6621163">Error</span><span class="op" id="6621168">(</span><span class="op" id="6621169">)</span><span class="op" id="6621170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6621173">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6621176">if</span>&nbsp;<span class="ident" id="6621179">addReply</span><span class="op" id="6621187">.</span><span class="ident" id="6621188">C</span>&nbsp;<span class="op" id="6621190">!=</span>&nbsp;<span class="ident" id="6621193">args</span><span class="op" id="6621197">.</span><span class="ident" id="6621198">A</span><span class="op" id="6621199">+</span><span class="ident" id="6621200">args</span><span class="op" id="6621204">.</span><span class="ident" id="6621205">B</span>&nbsp;<span class="op" id="6621207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6621211">t</span><span class="op" id="6621212">.</span><span class="ident" id="6621213">Errorf</span><span class="op" id="6621219">(</span><span class="string" id="6621220">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6621245">,</span>&nbsp;<span class="ident" id="6621247">addReply</span><span class="op" id="6621255">.</span><span class="ident" id="6621256">C</span><span class="op" id="6621257">,</span>&nbsp;<span class="ident" id="6621259">args</span><span class="op" id="6621263">.</span><span class="ident" id="6621264">A</span><span class="op" id="6621265">+</span><span class="ident" id="6621266">args</span><span class="op" id="6621270">.</span><span class="ident" id="6621271">B</span><span class="op" id="6621272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6621275">}</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6621279">mulCall</span>&nbsp;<span class="op" id="6621287">=</span>&nbsp;<span class="op" id="6621289">&lt;-</span><span class="ident" id="6621291">mulCall</span><span class="op" id="6621298">.</span><span class="ident" id="6621299">Done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6621305">if</span>&nbsp;<span class="ident" id="6621308">mulCall</span><span class="op" id="6621315">.</span><span class="ident" id="6621316">Error</span>&nbsp;<span class="op" id="6621322">!=</span>&nbsp;<span class="builtintype" id="6621325">nil</span>&nbsp;<span class="op" id="6621329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6621333">t</span><span class="op" id="6621334">.</span><span class="ident" id="6621335">Errorf</span><span class="op" id="6621341">(</span><span class="string" id="6621342">&#34;Mul:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6621384">,</span>&nbsp;<span class="ident" id="6621386">mulCall</span><span class="op" id="6621393">.</span><span class="ident" id="6621394">Error</span><span class="op" id="6621399">.</span><span class="ident" id="6621400">Error</span><span class="op" id="6621405">(</span><span class="op" id="6621406">)</span><span class="op" id="6621407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6621410">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6621413">if</span>&nbsp;<span class="ident" id="6621416">mulReply</span><span class="op" id="6621424">.</span><span class="ident" id="6621425">C</span>&nbsp;<span class="op" id="6621427">!=</span>&nbsp;<span class="ident" id="6621430">args</span><span class="op" id="6621434">.</span><span class="ident" id="6621435">A</span><span class="op" id="6621436">*</span><span class="ident" id="6621437">args</span><span class="op" id="6621441">.</span><span class="ident" id="6621442">B</span>&nbsp;<span class="op" id="6621444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6621448">t</span><span class="op" id="6621449">.</span><span class="ident" id="6621450">Errorf</span><span class="op" id="6621456">(</span><span class="string" id="6621457">&#34;Mul:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6621482">,</span>&nbsp;<span class="ident" id="6621484">mulReply</span><span class="op" id="6621492">.</span><span class="ident" id="6621493">C</span><span class="op" id="6621494">,</span>&nbsp;<span class="ident" id="6621496">args</span><span class="op" id="6621500">.</span><span class="ident" id="6621501">A</span><span class="op" id="6621502">*</span><span class="ident" id="6621503">args</span><span class="op" id="6621507">.</span><span class="ident" id="6621508">B</span><span class="op" id="6621509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6621512">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6621516">//&nbsp;Error&nbsp;test</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6621531">args</span>&nbsp;<span class="op" id="6621536">=</span>&nbsp;<span class="op" id="6621538">&amp;</span><span class="ident" id="6621539">Args</span><span class="op" id="6621543">{</span><span class="num" id="6621544">7</span><span class="op" id="6621545">,</span>&nbsp;<span class="num" id="6621547">0</span><span class="op" id="6621548">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6621551">reply</span>&nbsp;<span class="op" id="6621557">=</span>&nbsp;<span class="builtinfunc" id="6621559">new</span><span class="op" id="6621562">(</span><span class="ident" id="6621563">Reply</span><span class="op" id="6621568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6621571">err</span>&nbsp;<span class="op" id="6621575">=</span>&nbsp;<span class="ident" id="6621577">client</span><span class="op" id="6621583">.</span><span class="ident" id="6621584">Call</span><span class="op" id="6621588">(</span><span class="string" id="6621589">&#34;Arith.Div&#34;</span><span class="op" id="6621600">,</span>&nbsp;<span class="ident" id="6621602">args</span><span class="op" id="6621606">,</span>&nbsp;<span class="ident" id="6621608">reply</span><span class="op" id="6621613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6621616">//&nbsp;expect&nbsp;an&nbsp;error:&nbsp;zero&nbsp;divide</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6621649">if</span>&nbsp;<span class="ident" id="6621652">err</span>&nbsp;<span class="op" id="6621656">==</span>&nbsp;<span class="builtintype" id="6621659">nil</span>&nbsp;<span class="op" id="6621663">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6621667">t</span><span class="op" id="6621668">.</span><span class="ident" id="6621669">Error</span><span class="op" id="6621674">(</span><span class="string" id="6621675">&#34;Div:&nbsp;expected&nbsp;error&#34;</span><span class="op" id="6621696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6621699">}</span>&nbsp;<span class="keyword" id="6621701">else</span>&nbsp;<span class="keyword" id="6621706">if</span>&nbsp;<span class="ident" id="6621709">err</span><span class="op" id="6621712">.</span><span class="ident" id="6621713">Error</span><span class="op" id="6621718">(</span><span class="op" id="6621719">)</span>&nbsp;<span class="op" id="6621721">!=</span>&nbsp;<span class="string" id="6621724">&#34;divide&nbsp;by&nbsp;zero&#34;</span>&nbsp;<span class="op" id="6621741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6621745">t</span><span class="op" id="6621746">.</span><span class="ident" id="6621747">Error</span><span class="op" id="6621752">(</span><span class="string" id="6621753">&#34;Div:&nbsp;expected&nbsp;divide&nbsp;by&nbsp;zero&nbsp;error;&nbsp;got&#34;</span><span class="op" id="6621794">,</span>&nbsp;<span class="ident" id="6621796">err</span><span class="op" id="6621799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6621802">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6621806">//&nbsp;Bad&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6621820">reply</span>&nbsp;<span class="op" id="6621826">=</span>&nbsp;<span class="builtinfunc" id="6621828">new</span><span class="op" id="6621831">(</span><span class="ident" id="6621832">Reply</span><span class="op" id="6621837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6621840">err</span>&nbsp;<span class="op" id="6621844">=</span>&nbsp;<span class="ident" id="6621846">client</span><span class="op" id="6621852">.</span><span class="ident" id="6621853">Call</span><span class="op" id="6621857">(</span><span class="string" id="6621858">&#34;Arith.Add&#34;</span><span class="op" id="6621869">,</span>&nbsp;<span class="ident" id="6621871">reply</span><span class="op" id="6621876">,</span>&nbsp;<span class="ident" id="6621878">reply</span><span class="op" id="6621883">)</span>&nbsp;<span class="comment" id="6621885">//&nbsp;args,&nbsp;reply&nbsp;would&nbsp;be&nbsp;the&nbsp;correct&nbsp;thing&nbsp;to&nbsp;use</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6621935">if</span>&nbsp;<span class="ident" id="6621938">err</span>&nbsp;<span class="op" id="6621942">==</span>&nbsp;<span class="builtintype" id="6621945">nil</span>&nbsp;<span class="op" id="6621949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6621953">t</span><span class="op" id="6621954">.</span><span class="ident" id="6621955">Error</span><span class="op" id="6621960">(</span><span class="string" id="6621961">&#34;expected&nbsp;error&nbsp;calling&nbsp;Arith.Add&nbsp;with&nbsp;wrong&nbsp;arg&nbsp;type&#34;</span><span class="op" id="6622015">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6622018">}</span>&nbsp;<span class="keyword" id="6622020">else</span>&nbsp;<span class="keyword" id="6622025">if</span>&nbsp;<span class="ident" id="6622028">strings</span><span class="op" id="6622035">.</span><span class="ident" id="6622036">Index</span><span class="op" id="6622041">(</span><span class="ident" id="6622042">err</span><span class="op" id="6622045">.</span><span class="ident" id="6622046">Error</span><span class="op" id="6622051">(</span><span class="op" id="6622052">)</span><span class="op" id="6622053">,</span>&nbsp;<span class="string" id="6622055">&#34;type&#34;</span><span class="op" id="6622061">)</span>&nbsp;<span class="op" id="6622063">&lt;</span>&nbsp;<span class="num" id="6622065">0</span>&nbsp;<span class="op" id="6622067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6622071">t</span><span class="op" id="6622072">.</span><span class="ident" id="6622073">Error</span><span class="op" id="6622078">(</span><span class="string" id="6622079">&#34;expected&nbsp;error&nbsp;about&nbsp;type;&nbsp;got&#34;</span><span class="op" id="6622111">,</span>&nbsp;<span class="ident" id="6622113">err</span><span class="op" id="6622116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6622119">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6622123">//&nbsp;Non-struct&nbsp;argument</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6622147">const</span>&nbsp;<span class="ident" id="6622153">Val</span>&nbsp;<span class="op" id="6622157">=</span>&nbsp;<span class="num" id="6622159">12345</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6622166">str</span>&nbsp;<span class="op" id="6622170">:=</span>&nbsp;<span class="ident" id="6622173">fmt</span><span class="op" id="6622176">.</span><span class="ident" id="6622177">Sprint</span><span class="op" id="6622183">(</span><span class="ident" id="6622184">Val</span><span class="op" id="6622187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6622190">reply</span>&nbsp;<span class="op" id="6622196">=</span>&nbsp;<span class="builtinfunc" id="6622198">new</span><span class="op" id="6622201">(</span><span class="ident" id="6622202">Reply</span><span class="op" id="6622207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6622210">err</span>&nbsp;<span class="op" id="6622214">=</span>&nbsp;<span class="ident" id="6622216">client</span><span class="op" id="6622222">.</span><span class="ident" id="6622223">Call</span><span class="op" id="6622227">(</span><span class="string" id="6622228">&#34;Arith.Scan&#34;</span><span class="op" id="6622240">,</span>&nbsp;<span class="op" id="6622242">&amp;</span><span class="ident" id="6622243">str</span><span class="op" id="6622246">,</span>&nbsp;<span class="ident" id="6622248">reply</span><span class="op" id="6622253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6622256">if</span>&nbsp;<span class="ident" id="6622259">err</span>&nbsp;<span class="op" id="6622263">!=</span>&nbsp;<span class="builtintype" id="6622266">nil</span>&nbsp;<span class="op" id="6622270">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6622274">t</span><span class="op" id="6622275">.</span><span class="ident" id="6622276">Errorf</span><span class="op" id="6622282">(</span><span class="string" id="6622283">&#34;Scan:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6622326">,</span>&nbsp;<span class="ident" id="6622328">err</span><span class="op" id="6622331">.</span><span class="ident" id="6622332">Error</span><span class="op" id="6622337">(</span><span class="op" id="6622338">)</span><span class="op" id="6622339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6622342">}</span>&nbsp;<span class="keyword" id="6622344">else</span>&nbsp;<span class="keyword" id="6622349">if</span>&nbsp;<span class="ident" id="6622352">reply</span><span class="op" id="6622357">.</span><span class="ident" id="6622358">C</span>&nbsp;<span class="op" id="6622360">!=</span>&nbsp;<span class="ident" id="6622363">Val</span>&nbsp;<span class="op" id="6622367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6622371">t</span><span class="op" id="6622372">.</span><span class="ident" id="6622373">Errorf</span><span class="op" id="6622379">(</span><span class="string" id="6622380">&#34;Scan:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6622406">,</span>&nbsp;<span class="ident" id="6622408">Val</span><span class="op" id="6622411">,</span>&nbsp;<span class="ident" id="6622413">reply</span><span class="op" id="6622418">.</span><span class="ident" id="6622419">C</span><span class="op" id="6622420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6622423">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6622427">//&nbsp;Non-struct&nbsp;reply</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6622448">args</span>&nbsp;<span class="op" id="6622453">=</span>&nbsp;<span class="op" id="6622455">&amp;</span><span class="ident" id="6622456">Args</span><span class="op" id="6622460">{</span><span class="num" id="6622461">27</span><span class="op" id="6622463">,</span>&nbsp;<span class="num" id="6622465">35</span><span class="op" id="6622467">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6622470">str</span>&nbsp;<span class="op" id="6622474">=</span>&nbsp;<span class="string" id="6622476">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6622480">err</span>&nbsp;<span class="op" id="6622484">=</span>&nbsp;<span class="ident" id="6622486">client</span><span class="op" id="6622492">.</span><span class="ident" id="6622493">Call</span><span class="op" id="6622497">(</span><span class="string" id="6622498">&#34;Arith.String&#34;</span><span class="op" id="6622512">,</span>&nbsp;<span class="ident" id="6622514">args</span><span class="op" id="6622518">,</span>&nbsp;<span class="op" id="6622520">&amp;</span><span class="ident" id="6622521">str</span><span class="op" id="6622524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6622527">if</span>&nbsp;<span class="ident" id="6622530">err</span>&nbsp;<span class="op" id="6622534">!=</span>&nbsp;<span class="builtintype" id="6622537">nil</span>&nbsp;<span class="op" id="6622541">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6622545">t</span><span class="op" id="6622546">.</span><span class="ident" id="6622547">Errorf</span><span class="op" id="6622553">(</span><span class="string" id="6622554">&#34;String:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6622599">,</span>&nbsp;<span class="ident" id="6622601">err</span><span class="op" id="6622604">.</span><span class="ident" id="6622605">Error</span><span class="op" id="6622610">(</span><span class="op" id="6622611">)</span><span class="op" id="6622612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6622615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6622618">expect</span>&nbsp;<span class="op" id="6622625">:=</span>&nbsp;<span class="ident" id="6622628">fmt</span><span class="op" id="6622631">.</span><span class="ident" id="6622632">Sprintf</span><span class="op" id="6622639">(</span><span class="string" id="6622640">&#34;%d+%d=%d&#34;</span><span class="op" id="6622650">,</span>&nbsp;<span class="ident" id="6622652">args</span><span class="op" id="6622656">.</span><span class="ident" id="6622657">A</span><span class="op" id="6622658">,</span>&nbsp;<span class="ident" id="6622660">args</span><span class="op" id="6622664">.</span><span class="ident" id="6622665">B</span><span class="op" id="6622666">,</span>&nbsp;<span class="ident" id="6622668">args</span><span class="op" id="6622672">.</span><span class="ident" id="6622673">A</span><span class="op" id="6622674">+</span><span class="ident" id="6622675">args</span><span class="op" id="6622679">.</span><span class="ident" id="6622680">B</span><span class="op" id="6622681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6622684">if</span>&nbsp;<span class="ident" id="6622687">str</span>&nbsp;<span class="op" id="6622691">!=</span>&nbsp;<span class="ident" id="6622694">expect</span>&nbsp;<span class="op" id="6622701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6622705">t</span><span class="op" id="6622706">.</span><span class="ident" id="6622707">Errorf</span><span class="op" id="6622713">(</span><span class="string" id="6622714">&#34;String:&nbsp;expected&nbsp;%s&nbsp;got&nbsp;%s&#34;</span><span class="op" id="6622742">,</span>&nbsp;<span class="ident" id="6622744">expect</span><span class="op" id="6622750">,</span>&nbsp;<span class="ident" id="6622752">str</span><span class="op" id="6622755">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6622758">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6622762">args</span>&nbsp;<span class="op" id="6622767">=</span>&nbsp;<span class="op" id="6622769">&amp;</span><span class="ident" id="6622770">Args</span><span class="op" id="6622774">{</span><span class="num" id="6622775">7</span><span class="op" id="6622776">,</span>&nbsp;<span class="num" id="6622778">8</span><span class="op" id="6622779">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6622782">reply</span>&nbsp;<span class="op" id="6622788">=</span>&nbsp;<span class="builtinfunc" id="6622790">new</span><span class="op" id="6622793">(</span><span class="ident" id="6622794">Reply</span><span class="op" id="6622799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6622802">err</span>&nbsp;<span class="op" id="6622806">=</span>&nbsp;<span class="ident" id="6622808">client</span><span class="op" id="6622814">.</span><span class="ident" id="6622815">Call</span><span class="op" id="6622819">(</span><span class="string" id="6622820">&#34;Arith.Mul&#34;</span><span class="op" id="6622831">,</span>&nbsp;<span class="ident" id="6622833">args</span><span class="op" id="6622837">,</span>&nbsp;<span class="ident" id="6622839">reply</span><span class="op" id="6622844">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6622847">if</span>&nbsp;<span class="ident" id="6622850">err</span>&nbsp;<span class="op" id="6622854">!=</span>&nbsp;<span class="builtintype" id="6622857">nil</span>&nbsp;<span class="op" id="6622861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6622865">t</span><span class="op" id="6622866">.</span><span class="ident" id="6622867">Errorf</span><span class="op" id="6622873">(</span><span class="string" id="6622874">&#34;Mul:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6622916">,</span>&nbsp;<span class="ident" id="6622918">err</span><span class="op" id="6622921">.</span><span class="ident" id="6622922">Error</span><span class="op" id="6622927">(</span><span class="op" id="6622928">)</span><span class="op" id="6622929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6622932">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6622935">if</span>&nbsp;<span class="ident" id="6622938">reply</span><span class="op" id="6622943">.</span><span class="ident" id="6622944">C</span>&nbsp;<span class="op" id="6622946">!=</span>&nbsp;<span class="ident" id="6622949">args</span><span class="op" id="6622953">.</span><span class="ident" id="6622954">A</span><span class="op" id="6622955">*</span><span class="ident" id="6622956">args</span><span class="op" id="6622960">.</span><span class="ident" id="6622961">B</span>&nbsp;<span class="op" id="6622963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6622967">t</span><span class="op" id="6622968">.</span><span class="ident" id="6622969">Errorf</span><span class="op" id="6622975">(</span><span class="string" id="6622976">&#34;Mul:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6623001">,</span>&nbsp;<span class="ident" id="6623003">reply</span><span class="op" id="6623008">.</span><span class="ident" id="6623009">C</span><span class="op" id="6623010">,</span>&nbsp;<span class="ident" id="6623012">args</span><span class="op" id="6623016">.</span><span class="ident" id="6623017">A</span><span class="op" id="6623018">*</span><span class="ident" id="6623019">args</span><span class="op" id="6623023">.</span><span class="ident" id="6623024">B</span><span class="op" id="6623025">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6623028">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6623032">//&nbsp;ServiceName&nbsp;contain&nbsp;&#34;.&#34;&nbsp;character</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6623070">args</span>&nbsp;<span class="op" id="6623075">=</span>&nbsp;<span class="op" id="6623077">&amp;</span><span class="ident" id="6623078">Args</span><span class="op" id="6623082">{</span><span class="num" id="6623083">7</span><span class="op" id="6623084">,</span>&nbsp;<span class="num" id="6623086">8</span><span class="op" id="6623087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6623090">reply</span>&nbsp;<span class="op" id="6623096">=</span>&nbsp;<span class="builtinfunc" id="6623098">new</span><span class="op" id="6623101">(</span><span class="ident" id="6623102">Reply</span><span class="op" id="6623107">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6623110">err</span>&nbsp;<span class="op" id="6623114">=</span>&nbsp;<span class="ident" id="6623116">client</span><span class="op" id="6623122">.</span><span class="ident" id="6623123">Call</span><span class="op" id="6623127">(</span><span class="string" id="6623128">&#34;net.rpc.Arith.Add&#34;</span><span class="op" id="6623147">,</span>&nbsp;<span class="ident" id="6623149">args</span><span class="op" id="6623153">,</span>&nbsp;<span class="ident" id="6623155">reply</span><span class="op" id="6623160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6623163">if</span>&nbsp;<span class="ident" id="6623166">err</span>&nbsp;<span class="op" id="6623170">!=</span>&nbsp;<span class="builtintype" id="6623173">nil</span>&nbsp;<span class="op" id="6623177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6623181">t</span><span class="op" id="6623182">.</span><span class="ident" id="6623183">Errorf</span><span class="op" id="6623189">(</span><span class="string" id="6623190">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6623232">,</span>&nbsp;<span class="ident" id="6623234">err</span><span class="op" id="6623237">.</span><span class="ident" id="6623238">Error</span><span class="op" id="6623243">(</span><span class="op" id="6623244">)</span><span class="op" id="6623245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6623248">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6623251">if</span>&nbsp;<span class="ident" id="6623254">reply</span><span class="op" id="6623259">.</span><span class="ident" id="6623260">C</span>&nbsp;<span class="op" id="6623262">!=</span>&nbsp;<span class="ident" id="6623265">args</span><span class="op" id="6623269">.</span><span class="ident" id="6623270">A</span><span class="op" id="6623271">+</span><span class="ident" id="6623272">args</span><span class="op" id="6623276">.</span><span class="ident" id="6623277">B</span>&nbsp;<span class="op" id="6623279">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6623283">t</span><span class="op" id="6623284">.</span><span class="ident" id="6623285">Errorf</span><span class="op" id="6623291">(</span><span class="string" id="6623292">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6623317">,</span>&nbsp;<span class="ident" id="6623319">reply</span><span class="op" id="6623324">.</span><span class="ident" id="6623325">C</span><span class="op" id="6623326">,</span>&nbsp;<span class="ident" id="6623328">args</span><span class="op" id="6623332">.</span><span class="ident" id="6623333">A</span><span class="op" id="6623334">+</span><span class="ident" id="6623335">args</span><span class="op" id="6623339">.</span><span class="ident" id="6623340">B</span><span class="op" id="6623341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6623344">}</span><br>
<span class="lineno"></span><span class="op" id="6623346">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6623349">func</span>&nbsp;<span class="ident" id="6623354">testNewServerRPC</span><span class="op" id="6623370">(</span><span class="ident" id="6623371">t</span>&nbsp;<span class="op" id="6623373">*</span><span class="ident" id="6623374">testing</span><span class="op" id="6623381">.</span><span class="ident" id="6623382">T</span><span class="op" id="6623383">,</span>&nbsp;<span class="ident" id="6623385">addr</span>&nbsp;<span class="builtintype" id="6623390">string</span><span class="op" id="6623396">)</span>&nbsp;<span class="op" id="6623398">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6623401">client</span><span class="op" id="6623407">,</span>&nbsp;<span class="ident" id="6623409">err</span>&nbsp;<span class="op" id="6623413">:=</span>&nbsp;<span class="ident" id="6623416">Dial</span><span class="op" id="6623420">(</span><span class="string" id="6623421">&#34;tcp&#34;</span><span class="op" id="6623426">,</span>&nbsp;<span class="ident" id="6623428">addr</span><span class="op" id="6623432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6623435">if</span>&nbsp;<span class="ident" id="6623438">err</span>&nbsp;<span class="op" id="6623442">!=</span>&nbsp;<span class="builtintype" id="6623445">nil</span>&nbsp;<span class="op" id="6623449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6623453">t</span><span class="op" id="6623454">.</span><span class="ident" id="6623455">Fatal</span><span class="op" id="6623460">(</span><span class="string" id="6623461">&#34;dialing&#34;</span><span class="op" id="6623470">,</span>&nbsp;<span class="ident" id="6623472">err</span><span class="op" id="6623475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6623478">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6623481">defer</span>&nbsp;<span class="ident" id="6623487">client</span><span class="op" id="6623493">.</span><span class="ident" id="6623494">Close</span><span class="op" id="6623499">(</span><span class="op" id="6623500">)</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6623504">//&nbsp;Synchronous&nbsp;calls</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6623526">args</span>&nbsp;<span class="op" id="6623531">:=</span>&nbsp;<span class="op" id="6623534">&amp;</span><span class="ident" id="6623535">Args</span><span class="op" id="6623539">{</span><span class="num" id="6623540">7</span><span class="op" id="6623541">,</span>&nbsp;<span class="num" id="6623543">8</span><span class="op" id="6623544">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6623547">reply</span>&nbsp;<span class="op" id="6623553">:=</span>&nbsp;<span class="builtinfunc" id="6623556">new</span><span class="op" id="6623559">(</span><span class="ident" id="6623560">Reply</span><span class="op" id="6623565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6623568">err</span>&nbsp;<span class="op" id="6623572">=</span>&nbsp;<span class="ident" id="6623574">client</span><span class="op" id="6623580">.</span><span class="ident" id="6623581">Call</span><span class="op" id="6623585">(</span><span class="string" id="6623586">&#34;newServer.Arith.Add&#34;</span><span class="op" id="6623607">,</span>&nbsp;<span class="ident" id="6623609">args</span><span class="op" id="6623613">,</span>&nbsp;<span class="ident" id="6623615">reply</span><span class="op" id="6623620">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6623623">if</span>&nbsp;<span class="ident" id="6623626">err</span>&nbsp;<span class="op" id="6623630">!=</span>&nbsp;<span class="builtintype" id="6623633">nil</span>&nbsp;<span class="op" id="6623637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6623641">t</span><span class="op" id="6623642">.</span><span class="ident" id="6623643">Errorf</span><span class="op" id="6623649">(</span><span class="string" id="6623650">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6623692">,</span>&nbsp;<span class="ident" id="6623694">err</span><span class="op" id="6623697">.</span><span class="ident" id="6623698">Error</span><span class="op" id="6623703">(</span><span class="op" id="6623704">)</span><span class="op" id="6623705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6623708">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6623711">if</span>&nbsp;<span class="ident" id="6623714">reply</span><span class="op" id="6623719">.</span><span class="ident" id="6623720">C</span>&nbsp;<span class="op" id="6623722">!=</span>&nbsp;<span class="ident" id="6623725">args</span><span class="op" id="6623729">.</span><span class="ident" id="6623730">A</span><span class="op" id="6623731">+</span><span class="ident" id="6623732">args</span><span class="op" id="6623736">.</span><span class="ident" id="6623737">B</span>&nbsp;<span class="op" id="6623739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6623743">t</span><span class="op" id="6623744">.</span><span class="ident" id="6623745">Errorf</span><span class="op" id="6623751">(</span><span class="string" id="6623752">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6623777">,</span>&nbsp;<span class="ident" id="6623779">reply</span><span class="op" id="6623784">.</span><span class="ident" id="6623785">C</span><span class="op" id="6623786">,</span>&nbsp;<span class="ident" id="6623788">args</span><span class="op" id="6623792">.</span><span class="ident" id="6623793">A</span><span class="op" id="6623794">+</span><span class="ident" id="6623795">args</span><span class="op" id="6623799">.</span><span class="ident" id="6623800">B</span><span class="op" id="6623801">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6623804">}</span><br>
<span class="lineno"></span><span class="op" id="6623806">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6623809">func</span>&nbsp;<span class="ident" id="6623814">TestHTTP</span><span class="op" id="6623822">(</span><span class="ident" id="6623823">t</span>&nbsp;<span class="op" id="6623825">*</span><span class="ident" id="6623826">testing</span><span class="op" id="6623833">.</span><span class="ident" id="6623834">T</span><span class="op" id="6623835">)</span>&nbsp;<span class="op" id="6623837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6623840">once</span><span class="op" id="6623844">.</span><span class="ident" id="6623845">Do</span><span class="op" id="6623847">(</span><span class="ident" id="6623848">startServer</span><span class="op" id="6623859">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6623862">testHTTPRPC</span><span class="op" id="6623873">(</span><span class="ident" id="6623874">t</span><span class="op" id="6623875">,</span>&nbsp;<span class="string" id="6623877">&#34;&#34;</span><span class="op" id="6623879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6623882">newOnce</span><span class="op" id="6623889">.</span><span class="ident" id="6623890">Do</span><span class="op" id="6623892">(</span><span class="ident" id="6623893">startNewServer</span><span class="op" id="6623907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6623910">testHTTPRPC</span><span class="op" id="6623921">(</span><span class="ident" id="6623922">t</span><span class="op" id="6623923">,</span>&nbsp;<span class="ident" id="6623925">newHttpPath</span><span class="op" id="6623936">)</span><br>
<span class="lineno"></span><span class="op" id="6623938">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span><span class="keyword" id="6623941">func</span>&nbsp;<span class="ident" id="6623946">testHTTPRPC</span><span class="op" id="6623957">(</span><span class="ident" id="6623958">t</span>&nbsp;<span class="op" id="6623960">*</span><span class="ident" id="6623961">testing</span><span class="op" id="6623968">.</span><span class="ident" id="6623969">T</span><span class="op" id="6623970">,</span>&nbsp;<span class="ident" id="6623972">path</span>&nbsp;<span class="builtintype" id="6623977">string</span><span class="op" id="6623983">)</span>&nbsp;<span class="op" id="6623985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6623988">var</span>&nbsp;<span class="ident" id="6623992">client</span>&nbsp;<span class="op" id="6623999">*</span><span class="ident" id="6624000">Client</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6624008">var</span>&nbsp;<span class="ident" id="6624012">err</span>&nbsp;<span class="builtintype" id="6624016">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6624023">if</span>&nbsp;<span class="ident" id="6624026">path</span>&nbsp;<span class="op" id="6624031">==</span>&nbsp;<span class="string" id="6624034">&#34;&#34;</span>&nbsp;<span class="op" id="6624037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6624041">client</span><span class="op" id="6624047">,</span>&nbsp;<span class="ident" id="6624049">err</span>&nbsp;<span class="op" id="6624053">=</span>&nbsp;<span class="ident" id="6624055">DialHTTP</span><span class="op" id="6624063">(</span><span class="string" id="6624064">&#34;tcp&#34;</span><span class="op" id="6624069">,</span>&nbsp;<span class="ident" id="6624071">httpServerAddr</span><span class="op" id="6624085">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6624088">}</span>&nbsp;<span class="keyword" id="6624090">else</span>&nbsp;<span class="op" id="6624095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6624099">client</span><span class="op" id="6624105">,</span>&nbsp;<span class="ident" id="6624107">err</span>&nbsp;<span class="op" id="6624111">=</span>&nbsp;<span class="ident" id="6624113">DialHTTPPath</span><span class="op" id="6624125">(</span><span class="string" id="6624126">&#34;tcp&#34;</span><span class="op" id="6624131">,</span>&nbsp;<span class="ident" id="6624133">httpServerAddr</span><span class="op" id="6624147">,</span>&nbsp;<span class="ident" id="6624149">path</span><span class="op" id="6624153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6624156">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6624159">if</span>&nbsp;<span class="ident" id="6624162">err</span>&nbsp;<span class="op" id="6624166">!=</span>&nbsp;<span class="builtintype" id="6624169">nil</span>&nbsp;<span class="op" id="6624173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6624177">t</span><span class="op" id="6624178">.</span><span class="ident" id="6624179">Fatal</span><span class="op" id="6624184">(</span><span class="string" id="6624185">&#34;dialing&#34;</span><span class="op" id="6624194">,</span>&nbsp;<span class="ident" id="6624196">err</span><span class="op" id="6624199">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6624202">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6624205">defer</span>&nbsp;<span class="ident" id="6624211">client</span><span class="op" id="6624217">.</span><span class="ident" id="6624218">Close</span><span class="op" id="6624223">(</span><span class="op" id="6624224">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6624228">//&nbsp;Synchronous&nbsp;calls</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6624250">args</span>&nbsp;<span class="op" id="6624255">:=</span>&nbsp;<span class="op" id="6624258">&amp;</span><span class="ident" id="6624259">Args</span><span class="op" id="6624263">{</span><span class="num" id="6624264">7</span><span class="op" id="6624265">,</span>&nbsp;<span class="num" id="6624267">8</span><span class="op" id="6624268">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6624271">reply</span>&nbsp;<span class="op" id="6624277">:=</span>&nbsp;<span class="builtinfunc" id="6624280">new</span><span class="op" id="6624283">(</span><span class="ident" id="6624284">Reply</span><span class="op" id="6624289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6624292">err</span>&nbsp;<span class="op" id="6624296">=</span>&nbsp;<span class="ident" id="6624298">client</span><span class="op" id="6624304">.</span><span class="ident" id="6624305">Call</span><span class="op" id="6624309">(</span><span class="string" id="6624310">&#34;Arith.Add&#34;</span><span class="op" id="6624321">,</span>&nbsp;<span class="ident" id="6624323">args</span><span class="op" id="6624327">,</span>&nbsp;<span class="ident" id="6624329">reply</span><span class="op" id="6624334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6624337">if</span>&nbsp;<span class="ident" id="6624340">err</span>&nbsp;<span class="op" id="6624344">!=</span>&nbsp;<span class="builtintype" id="6624347">nil</span>&nbsp;<span class="op" id="6624351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6624355">t</span><span class="op" id="6624356">.</span><span class="ident" id="6624357">Errorf</span><span class="op" id="6624363">(</span><span class="string" id="6624364">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6624406">,</span>&nbsp;<span class="ident" id="6624408">err</span><span class="op" id="6624411">.</span><span class="ident" id="6624412">Error</span><span class="op" id="6624417">(</span><span class="op" id="6624418">)</span><span class="op" id="6624419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6624422">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6624425">if</span>&nbsp;<span class="ident" id="6624428">reply</span><span class="op" id="6624433">.</span><span class="ident" id="6624434">C</span>&nbsp;<span class="op" id="6624436">!=</span>&nbsp;<span class="ident" id="6624439">args</span><span class="op" id="6624443">.</span><span class="ident" id="6624444">A</span><span class="op" id="6624445">+</span><span class="ident" id="6624446">args</span><span class="op" id="6624450">.</span><span class="ident" id="6624451">B</span>&nbsp;<span class="op" id="6624453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6624457">t</span><span class="op" id="6624458">.</span><span class="ident" id="6624459">Errorf</span><span class="op" id="6624465">(</span><span class="string" id="6624466">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6624491">,</span>&nbsp;<span class="ident" id="6624493">reply</span><span class="op" id="6624498">.</span><span class="ident" id="6624499">C</span><span class="op" id="6624500">,</span>&nbsp;<span class="ident" id="6624502">args</span><span class="op" id="6624506">.</span><span class="ident" id="6624507">A</span><span class="op" id="6624508">+</span><span class="ident" id="6624509">args</span><span class="op" id="6624513">.</span><span class="ident" id="6624514">B</span><span class="op" id="6624515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6624518">}</span><br>
<span class="lineno"></span><span class="op" id="6624520">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span><span class="comment" id="6624523">//&nbsp;CodecEmulator&nbsp;provides&nbsp;a&nbsp;client-like&nbsp;api&nbsp;and&nbsp;a&nbsp;ServerCodec&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment" id="6624596">//&nbsp;Can&nbsp;be&nbsp;used&nbsp;to&nbsp;test&nbsp;ServeRequest.</span><br>
<span class="lineno"></span><span class="keyword" id="6624633">type</span>&nbsp;<span class="ident" id="6624638">CodecEmulator</span>&nbsp;<span class="keyword" id="6624652">struct</span>&nbsp;<span class="op" id="6624659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6624662">server</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6624676">*</span><span class="ident" id="6624677">Server</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6624685">serviceMethod</span>&nbsp;<span class="builtintype" id="6624699">string</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6624707">args</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6624721">*</span><span class="ident" id="6624722">Args</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6624728">reply</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6624742">*</span><span class="ident" id="6624743">Reply</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6624750">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6624764">error</span><br>
<span class="lineno"></span><span class="op" id="6624770">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span><span class="keyword" id="6624773">func</span>&nbsp;<span class="op" id="6624778">(</span><span class="ident" id="6624779">codec</span>&nbsp;<span class="op" id="6624785">*</span><span class="ident" id="6624786">CodecEmulator</span><span class="op" id="6624799">)</span>&nbsp;<span class="ident" id="6624801">Call</span><span class="op" id="6624805">(</span><span class="ident" id="6624806">serviceMethod</span>&nbsp;<span class="builtintype" id="6624820">string</span><span class="op" id="6624826">,</span>&nbsp;<span class="ident" id="6624828">args</span>&nbsp;<span class="op" id="6624833">*</span><span class="ident" id="6624834">Args</span><span class="op" id="6624838">,</span>&nbsp;<span class="ident" id="6624840">reply</span>&nbsp;<span class="op" id="6624846">*</span><span class="ident" id="6624847">Reply</span><span class="op" id="6624852">)</span>&nbsp;<span class="builtintype" id="6624854">error</span>&nbsp;<span class="op" id="6624860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6624863">codec</span><span class="op" id="6624868">.</span><span class="ident" id="6624869">serviceMethod</span>&nbsp;<span class="op" id="6624883">=</span>&nbsp;<span class="ident" id="6624885">serviceMethod</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6624900">codec</span><span class="op" id="6624905">.</span><span class="ident" id="6624906">args</span>&nbsp;<span class="op" id="6624911">=</span>&nbsp;<span class="ident" id="6624913">args</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6624919">codec</span><span class="op" id="6624924">.</span><span class="ident" id="6624925">reply</span>&nbsp;<span class="op" id="6624931">=</span>&nbsp;<span class="ident" id="6624933">reply</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6624940">codec</span><span class="op" id="6624945">.</span><span class="ident" id="6624946">err</span>&nbsp;<span class="op" id="6624950">=</span>&nbsp;<span class="builtintype" id="6624952">nil</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6624957">var</span>&nbsp;<span class="ident" id="6624961">serverError</span>&nbsp;<span class="builtintype" id="6624973">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6624980">if</span>&nbsp;<span class="ident" id="6624983">codec</span><span class="op" id="6624988">.</span><span class="ident" id="6624989">server</span>&nbsp;<span class="op" id="6624996">==</span>&nbsp;<span class="builtintype" id="6624999">nil</span>&nbsp;<span class="op" id="6625003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6625007">serverError</span>&nbsp;<span class="op" id="6625019">=</span>&nbsp;<span class="ident" id="6625021">ServeRequest</span><span class="op" id="6625033">(</span><span class="ident" id="6625034">codec</span><span class="op" id="6625039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6625042">}</span>&nbsp;<span class="keyword" id="6625044">else</span>&nbsp;<span class="op" id="6625049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6625053">serverError</span>&nbsp;<span class="op" id="6625065">=</span>&nbsp;<span class="ident" id="6625067">codec</span><span class="op" id="6625072">.</span><span class="ident" id="6625073">server</span><span class="op" id="6625079">.</span><span class="ident" id="6625080">ServeRequest</span><span class="op" id="6625092">(</span><span class="ident" id="6625093">codec</span><span class="op" id="6625098">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6625101">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6625104">if</span>&nbsp;<span class="ident" id="6625107">codec</span><span class="op" id="6625112">.</span><span class="ident" id="6625113">err</span>&nbsp;<span class="op" id="6625117">==</span>&nbsp;<span class="builtintype" id="6625120">nil</span>&nbsp;<span class="op" id="6625124">&amp;&amp;</span>&nbsp;<span class="ident" id="6625127">serverError</span>&nbsp;<span class="op" id="6625139">!=</span>&nbsp;<span class="builtintype" id="6625142">nil</span>&nbsp;<span class="op" id="6625146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6625150">codec</span><span class="op" id="6625155">.</span><span class="ident" id="6625156">err</span>&nbsp;<span class="op" id="6625160">=</span>&nbsp;<span class="ident" id="6625162">serverError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6625175">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6625178">return</span>&nbsp;<span class="ident" id="6625185">codec</span><span class="op" id="6625190">.</span><span class="ident" id="6625191">err</span><br>
<span class="lineno">330</span><span class="op" id="6625195">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6625198">func</span>&nbsp;<span class="op" id="6625203">(</span><span class="ident" id="6625204">codec</span>&nbsp;<span class="op" id="6625210">*</span><span class="ident" id="6625211">CodecEmulator</span><span class="op" id="6625224">)</span>&nbsp;<span class="ident" id="6625226">ReadRequestHeader</span><span class="op" id="6625243">(</span><span class="ident" id="6625244">req</span>&nbsp;<span class="op" id="6625248">*</span><span class="ident" id="6625249">Request</span><span class="op" id="6625256">)</span>&nbsp;<span class="builtintype" id="6625258">error</span>&nbsp;<span class="op" id="6625264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6625267">req</span><span class="op" id="6625270">.</span><span class="ident" id="6625271">ServiceMethod</span>&nbsp;<span class="op" id="6625285">=</span>&nbsp;<span class="ident" id="6625287">codec</span><span class="op" id="6625292">.</span><span class="ident" id="6625293">serviceMethod</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6625308">req</span><span class="op" id="6625311">.</span><span class="ident" id="6625312">Seq</span>&nbsp;<span class="op" id="6625316">=</span>&nbsp;<span class="num" id="6625318">0</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6625321">return</span>&nbsp;<span class="builtintype" id="6625328">nil</span><br>
<span class="lineno"></span><span class="op" id="6625332">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6625335">func</span>&nbsp;<span class="op" id="6625340">(</span><span class="ident" id="6625341">codec</span>&nbsp;<span class="op" id="6625347">*</span><span class="ident" id="6625348">CodecEmulator</span><span class="op" id="6625361">)</span>&nbsp;<span class="ident" id="6625363">ReadRequestBody</span><span class="op" id="6625378">(</span><span class="ident" id="6625379">argv</span>&nbsp;<span class="keyword" id="6625384">interface</span><span class="op" id="6625393">{</span><span class="op" id="6625394">}</span><span class="op" id="6625395">)</span>&nbsp;<span class="builtintype" id="6625397">error</span>&nbsp;<span class="op" id="6625403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6625406">if</span>&nbsp;<span class="ident" id="6625409">codec</span><span class="op" id="6625414">.</span><span class="ident" id="6625415">args</span>&nbsp;<span class="op" id="6625420">==</span>&nbsp;<span class="builtintype" id="6625423">nil</span>&nbsp;<span class="op" id="6625427">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6625431">return</span>&nbsp;<span class="ident" id="6625438">io</span><span class="op" id="6625440">.</span><span class="ident" id="6625441">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6625459">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6625462">*</span><span class="op" id="6625463">(</span><span class="ident" id="6625464">argv</span><span class="op" id="6625468">.</span><span class="op" id="6625469">(</span><span class="op" id="6625470">*</span><span class="ident" id="6625471">Args</span><span class="op" id="6625475">)</span><span class="op" id="6625476">)</span>&nbsp;<span class="op" id="6625478">=</span>&nbsp;<span class="op" id="6625480">*</span><span class="ident" id="6625481">codec</span><span class="op" id="6625486">.</span><span class="ident" id="6625487">args</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6625493">return</span>&nbsp;<span class="builtintype" id="6625500">nil</span><br>
<span class="lineno"></span><span class="op" id="6625504">}</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span><span class="keyword" id="6625507">func</span>&nbsp;<span class="op" id="6625512">(</span><span class="ident" id="6625513">codec</span>&nbsp;<span class="op" id="6625519">*</span><span class="ident" id="6625520">CodecEmulator</span><span class="op" id="6625533">)</span>&nbsp;<span class="ident" id="6625535">WriteResponse</span><span class="op" id="6625548">(</span><span class="ident" id="6625549">resp</span>&nbsp;<span class="op" id="6625554">*</span><span class="ident" id="6625555">Response</span><span class="op" id="6625563">,</span>&nbsp;<span class="ident" id="6625565">reply</span>&nbsp;<span class="keyword" id="6625571">interface</span><span class="op" id="6625580">{</span><span class="op" id="6625581">}</span><span class="op" id="6625582">)</span>&nbsp;<span class="builtintype" id="6625584">error</span>&nbsp;<span class="op" id="6625590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6625593">if</span>&nbsp;<span class="ident" id="6625596">resp</span><span class="op" id="6625600">.</span><span class="ident" id="6625601">Error</span>&nbsp;<span class="op" id="6625607">!=</span>&nbsp;<span class="string" id="6625610">&#34;&#34;</span>&nbsp;<span class="op" id="6625613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6625617">codec</span><span class="op" id="6625622">.</span><span class="ident" id="6625623">err</span>&nbsp;<span class="op" id="6625627">=</span>&nbsp;<span class="ident" id="6625629">errors</span><span class="op" id="6625635">.</span><span class="ident" id="6625636">New</span><span class="op" id="6625639">(</span><span class="ident" id="6625640">resp</span><span class="op" id="6625644">.</span><span class="ident" id="6625645">Error</span><span class="op" id="6625650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6625653">}</span>&nbsp;<span class="keyword" id="6625655">else</span>&nbsp;<span class="op" id="6625660">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6625664">*</span><span class="ident" id="6625665">codec</span><span class="op" id="6625670">.</span><span class="ident" id="6625671">reply</span>&nbsp;<span class="op" id="6625677">=</span>&nbsp;<span class="op" id="6625679">*</span><span class="op" id="6625680">(</span><span class="ident" id="6625681">reply</span><span class="op" id="6625686">.</span><span class="op" id="6625687">(</span><span class="op" id="6625688">*</span><span class="ident" id="6625689">Reply</span><span class="op" id="6625694">)</span><span class="op" id="6625695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6625698">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6625701">return</span>&nbsp;<span class="builtintype" id="6625708">nil</span><br>
<span class="lineno"></span><span class="op" id="6625712">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="keyword" id="6625715">func</span>&nbsp;<span class="op" id="6625720">(</span><span class="ident" id="6625721">codec</span>&nbsp;<span class="op" id="6625727">*</span><span class="ident" id="6625728">CodecEmulator</span><span class="op" id="6625741">)</span>&nbsp;<span class="ident" id="6625743">Close</span><span class="op" id="6625748">(</span><span class="op" id="6625749">)</span>&nbsp;<span class="builtintype" id="6625751">error</span>&nbsp;<span class="op" id="6625757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6625760">return</span>&nbsp;<span class="builtintype" id="6625767">nil</span><br>
<span class="lineno"></span><span class="op" id="6625771">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6625774">func</span>&nbsp;<span class="ident" id="6625779">TestServeRequest</span><span class="op" id="6625795">(</span><span class="ident" id="6625796">t</span>&nbsp;<span class="op" id="6625798">*</span><span class="ident" id="6625799">testing</span><span class="op" id="6625806">.</span><span class="ident" id="6625807">T</span><span class="op" id="6625808">)</span>&nbsp;<span class="op" id="6625810">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6625813">once</span><span class="op" id="6625817">.</span><span class="ident" id="6625818">Do</span><span class="op" id="6625820">(</span><span class="ident" id="6625821">startServer</span><span class="op" id="6625832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6625835">testServeRequest</span><span class="op" id="6625851">(</span><span class="ident" id="6625852">t</span><span class="op" id="6625853">,</span>&nbsp;<span class="builtintype" id="6625855">nil</span><span class="op" id="6625858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6625861">newOnce</span><span class="op" id="6625868">.</span><span class="ident" id="6625869">Do</span><span class="op" id="6625871">(</span><span class="ident" id="6625872">startNewServer</span><span class="op" id="6625886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6625889">testServeRequest</span><span class="op" id="6625905">(</span><span class="ident" id="6625906">t</span><span class="op" id="6625907">,</span>&nbsp;<span class="ident" id="6625909">newServer</span><span class="op" id="6625918">)</span><br>
<span class="lineno"></span><span class="op" id="6625920">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="keyword" id="6625923">func</span>&nbsp;<span class="ident" id="6625928">testServeRequest</span><span class="op" id="6625944">(</span><span class="ident" id="6625945">t</span>&nbsp;<span class="op" id="6625947">*</span><span class="ident" id="6625948">testing</span><span class="op" id="6625955">.</span><span class="ident" id="6625956">T</span><span class="op" id="6625957">,</span>&nbsp;<span class="ident" id="6625959">server</span>&nbsp;<span class="op" id="6625966">*</span><span class="ident" id="6625967">Server</span><span class="op" id="6625973">)</span>&nbsp;<span class="op" id="6625975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6625978">client</span>&nbsp;<span class="op" id="6625985">:=</span>&nbsp;<span class="ident" id="6625988">CodecEmulator</span><span class="op" id="6626001">{</span><span class="ident" id="6626002">server</span><span class="op" id="6626008">:</span>&nbsp;<span class="ident" id="6626010">server</span><span class="op" id="6626016">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6626019">defer</span>&nbsp;<span class="ident" id="6626025">client</span><span class="op" id="6626031">.</span><span class="ident" id="6626032">Close</span><span class="op" id="6626037">(</span><span class="op" id="6626038">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6626042">args</span>&nbsp;<span class="op" id="6626047">:=</span>&nbsp;<span class="op" id="6626050">&amp;</span><span class="ident" id="6626051">Args</span><span class="op" id="6626055">{</span><span class="num" id="6626056">7</span><span class="op" id="6626057">,</span>&nbsp;<span class="num" id="6626059">8</span><span class="op" id="6626060">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6626063">reply</span>&nbsp;<span class="op" id="6626069">:=</span>&nbsp;<span class="builtinfunc" id="6626072">new</span><span class="op" id="6626075">(</span><span class="ident" id="6626076">Reply</span><span class="op" id="6626081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6626084">err</span>&nbsp;<span class="op" id="6626088">:=</span>&nbsp;<span class="ident" id="6626091">client</span><span class="op" id="6626097">.</span><span class="ident" id="6626098">Call</span><span class="op" id="6626102">(</span><span class="string" id="6626103">&#34;Arith.Add&#34;</span><span class="op" id="6626114">,</span>&nbsp;<span class="ident" id="6626116">args</span><span class="op" id="6626120">,</span>&nbsp;<span class="ident" id="6626122">reply</span><span class="op" id="6626127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6626130">if</span>&nbsp;<span class="ident" id="6626133">err</span>&nbsp;<span class="op" id="6626137">!=</span>&nbsp;<span class="builtintype" id="6626140">nil</span>&nbsp;<span class="op" id="6626144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6626148">t</span><span class="op" id="6626149">.</span><span class="ident" id="6626150">Errorf</span><span class="op" id="6626156">(</span><span class="string" id="6626157">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6626199">,</span>&nbsp;<span class="ident" id="6626201">err</span><span class="op" id="6626204">.</span><span class="ident" id="6626205">Error</span><span class="op" id="6626210">(</span><span class="op" id="6626211">)</span><span class="op" id="6626212">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6626215">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6626218">if</span>&nbsp;<span class="ident" id="6626221">reply</span><span class="op" id="6626226">.</span><span class="ident" id="6626227">C</span>&nbsp;<span class="op" id="6626229">!=</span>&nbsp;<span class="ident" id="6626232">args</span><span class="op" id="6626236">.</span><span class="ident" id="6626237">A</span><span class="op" id="6626238">+</span><span class="ident" id="6626239">args</span><span class="op" id="6626243">.</span><span class="ident" id="6626244">B</span>&nbsp;<span class="op" id="6626246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6626250">t</span><span class="op" id="6626251">.</span><span class="ident" id="6626252">Errorf</span><span class="op" id="6626258">(</span><span class="string" id="6626259">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6626284">,</span>&nbsp;<span class="ident" id="6626286">reply</span><span class="op" id="6626291">.</span><span class="ident" id="6626292">C</span><span class="op" id="6626293">,</span>&nbsp;<span class="ident" id="6626295">args</span><span class="op" id="6626299">.</span><span class="ident" id="6626300">A</span><span class="op" id="6626301">+</span><span class="ident" id="6626302">args</span><span class="op" id="6626306">.</span><span class="ident" id="6626307">B</span><span class="op" id="6626308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6626311">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6626315">err</span>&nbsp;<span class="op" id="6626319">=</span>&nbsp;<span class="ident" id="6626321">client</span><span class="op" id="6626327">.</span><span class="ident" id="6626328">Call</span><span class="op" id="6626332">(</span><span class="string" id="6626333">&#34;Arith.Add&#34;</span><span class="op" id="6626344">,</span>&nbsp;<span class="builtintype" id="6626346">nil</span><span class="op" id="6626349">,</span>&nbsp;<span class="ident" id="6626351">reply</span><span class="op" id="6626356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6626359">if</span>&nbsp;<span class="ident" id="6626362">err</span>&nbsp;<span class="op" id="6626366">==</span>&nbsp;<span class="builtintype" id="6626369">nil</span>&nbsp;<span class="op" id="6626373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6626377">t</span><span class="op" id="6626378">.</span><span class="ident" id="6626379">Errorf</span><span class="op" id="6626385">(</span><span class="string" id="6626386">&#34;expected&nbsp;error&nbsp;calling&nbsp;Arith.Add&nbsp;with&nbsp;nil&nbsp;arg&#34;</span><span class="op" id="6626433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6626436">}</span><br>
<span class="lineno"></span><span class="op" id="6626438">}</span><br>
<span class="lineno">385</span><br>
<span class="lineno"></span><span class="keyword" id="6626441">type</span>&nbsp;<span class="ident" id="6626446">ReplyNotPointer</span>&nbsp;<span class="builtintype" id="6626462">int</span><br>
<span class="lineno"></span><span class="keyword" id="6626466">type</span>&nbsp;<span class="ident" id="6626471">ArgNotPublic</span>&nbsp;<span class="builtintype" id="6626484">int</span><br>
<span class="lineno"></span><span class="keyword" id="6626488">type</span>&nbsp;<span class="ident" id="6626493">ReplyNotPublic</span>&nbsp;<span class="builtintype" id="6626508">int</span><br>
<span class="lineno"></span><span class="keyword" id="6626512">type</span>&nbsp;<span class="ident" id="6626517">NeedsPtrType</span>&nbsp;<span class="builtintype" id="6626530">int</span><br>
<span class="lineno">390</span><span class="keyword" id="6626534">type</span>&nbsp;<span class="ident" id="6626539">local</span>&nbsp;<span class="keyword" id="6626545">struct</span><span class="op" id="6626551">{</span><span class="op" id="6626552">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6626555">func</span>&nbsp;<span class="op" id="6626560">(</span><span class="ident" id="6626561">t</span>&nbsp;<span class="op" id="6626563">*</span><span class="ident" id="6626564">ReplyNotPointer</span><span class="op" id="6626579">)</span>&nbsp;<span class="ident" id="6626581">ReplyNotPointer</span><span class="op" id="6626596">(</span><span class="ident" id="6626597">args</span>&nbsp;<span class="op" id="6626602">*</span><span class="ident" id="6626603">Args</span><span class="op" id="6626607">,</span>&nbsp;<span class="ident" id="6626609">reply</span>&nbsp;<span class="ident" id="6626615">Reply</span><span class="op" id="6626620">)</span>&nbsp;<span class="builtintype" id="6626622">error</span>&nbsp;<span class="op" id="6626628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6626631">return</span>&nbsp;<span class="builtintype" id="6626638">nil</span><br>
<span class="lineno"></span><span class="op" id="6626642">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span><span class="keyword" id="6626645">func</span>&nbsp;<span class="op" id="6626650">(</span><span class="ident" id="6626651">t</span>&nbsp;<span class="op" id="6626653">*</span><span class="ident" id="6626654">ArgNotPublic</span><span class="op" id="6626666">)</span>&nbsp;<span class="ident" id="6626668">ArgNotPublic</span><span class="op" id="6626680">(</span><span class="ident" id="6626681">args</span>&nbsp;<span class="op" id="6626686">*</span><span class="ident" id="6626687">local</span><span class="op" id="6626692">,</span>&nbsp;<span class="ident" id="6626694">reply</span>&nbsp;<span class="op" id="6626700">*</span><span class="ident" id="6626701">Reply</span><span class="op" id="6626706">)</span>&nbsp;<span class="builtintype" id="6626708">error</span>&nbsp;<span class="op" id="6626714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6626717">return</span>&nbsp;<span class="builtintype" id="6626724">nil</span><br>
<span class="lineno"></span><span class="op" id="6626728">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span><span class="keyword" id="6626731">func</span>&nbsp;<span class="op" id="6626736">(</span><span class="ident" id="6626737">t</span>&nbsp;<span class="op" id="6626739">*</span><span class="ident" id="6626740">ReplyNotPublic</span><span class="op" id="6626754">)</span>&nbsp;<span class="ident" id="6626756">ReplyNotPublic</span><span class="op" id="6626770">(</span><span class="ident" id="6626771">args</span>&nbsp;<span class="op" id="6626776">*</span><span class="ident" id="6626777">Args</span><span class="op" id="6626781">,</span>&nbsp;<span class="ident" id="6626783">reply</span>&nbsp;<span class="op" id="6626789">*</span><span class="ident" id="6626790">local</span><span class="op" id="6626795">)</span>&nbsp;<span class="builtintype" id="6626797">error</span>&nbsp;<span class="op" id="6626803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6626806">return</span>&nbsp;<span class="builtintype" id="6626813">nil</span><br>
<span class="lineno"></span><span class="op" id="6626817">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6626820">func</span>&nbsp;<span class="op" id="6626825">(</span><span class="ident" id="6626826">t</span>&nbsp;<span class="op" id="6626828">*</span><span class="ident" id="6626829">NeedsPtrType</span><span class="op" id="6626841">)</span>&nbsp;<span class="ident" id="6626843">NeedsPtrType</span><span class="op" id="6626855">(</span><span class="ident" id="6626856">args</span>&nbsp;<span class="op" id="6626861">*</span><span class="ident" id="6626862">Args</span><span class="op" id="6626866">,</span>&nbsp;<span class="ident" id="6626868">reply</span>&nbsp;<span class="op" id="6626874">*</span><span class="ident" id="6626875">Reply</span><span class="op" id="6626880">)</span>&nbsp;<span class="builtintype" id="6626882">error</span>&nbsp;<span class="op" id="6626888">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6626891">return</span>&nbsp;<span class="builtintype" id="6626898">nil</span><br>
<span class="lineno"></span><span class="op" id="6626902">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6626905">//&nbsp;Check&nbsp;that&nbsp;registration&nbsp;handles&nbsp;lots&nbsp;of&nbsp;bad&nbsp;methods&nbsp;and&nbsp;a&nbsp;type&nbsp;with&nbsp;no&nbsp;suitable&nbsp;methods.</span><br>
<span class="lineno"></span><span class="keyword" id="6626997">func</span>&nbsp;<span class="ident" id="6627002">TestRegistrationError</span><span class="op" id="6627023">(</span><span class="ident" id="6627024">t</span>&nbsp;<span class="op" id="6627026">*</span><span class="ident" id="6627027">testing</span><span class="op" id="6627034">.</span><span class="ident" id="6627035">T</span><span class="op" id="6627036">)</span>&nbsp;<span class="op" id="6627038">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6627041">err</span>&nbsp;<span class="op" id="6627045">:=</span>&nbsp;<span class="ident" id="6627048">Register</span><span class="op" id="6627056">(</span><span class="builtinfunc" id="6627057">new</span><span class="op" id="6627060">(</span><span class="ident" id="6627061">ReplyNotPointer</span><span class="op" id="6627076">)</span><span class="op" id="6627077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6627080">if</span>&nbsp;<span class="ident" id="6627083">err</span>&nbsp;<span class="op" id="6627087">==</span>&nbsp;<span class="builtintype" id="6627090">nil</span>&nbsp;<span class="op" id="6627094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6627098">t</span><span class="op" id="6627099">.</span><span class="ident" id="6627100">Error</span><span class="op" id="6627105">(</span><span class="string" id="6627106">&#34;expected&nbsp;error&nbsp;registering&nbsp;ReplyNotPointer&#34;</span><span class="op" id="6627150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6627153">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6627156">err</span>&nbsp;<span class="op" id="6627160">=</span>&nbsp;<span class="ident" id="6627162">Register</span><span class="op" id="6627170">(</span><span class="builtinfunc" id="6627171">new</span><span class="op" id="6627174">(</span><span class="ident" id="6627175">ArgNotPublic</span><span class="op" id="6627187">)</span><span class="op" id="6627188">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6627191">if</span>&nbsp;<span class="ident" id="6627194">err</span>&nbsp;<span class="op" id="6627198">==</span>&nbsp;<span class="builtintype" id="6627201">nil</span>&nbsp;<span class="op" id="6627205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6627209">t</span><span class="op" id="6627210">.</span><span class="ident" id="6627211">Error</span><span class="op" id="6627216">(</span><span class="string" id="6627217">&#34;expected&nbsp;error&nbsp;registering&nbsp;ArgNotPublic&#34;</span><span class="op" id="6627258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6627261">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6627264">err</span>&nbsp;<span class="op" id="6627268">=</span>&nbsp;<span class="ident" id="6627270">Register</span><span class="op" id="6627278">(</span><span class="builtinfunc" id="6627279">new</span><span class="op" id="6627282">(</span><span class="ident" id="6627283">ReplyNotPublic</span><span class="op" id="6627297">)</span><span class="op" id="6627298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6627301">if</span>&nbsp;<span class="ident" id="6627304">err</span>&nbsp;<span class="op" id="6627308">==</span>&nbsp;<span class="builtintype" id="6627311">nil</span>&nbsp;<span class="op" id="6627315">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6627319">t</span><span class="op" id="6627320">.</span><span class="ident" id="6627321">Error</span><span class="op" id="6627326">(</span><span class="string" id="6627327">&#34;expected&nbsp;error&nbsp;registering&nbsp;ReplyNotPublic&#34;</span><span class="op" id="6627370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6627373">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6627376">err</span>&nbsp;<span class="op" id="6627380">=</span>&nbsp;<span class="ident" id="6627382">Register</span><span class="op" id="6627390">(</span><span class="ident" id="6627391">NeedsPtrType</span><span class="op" id="6627403">(</span><span class="num" id="6627404">0</span><span class="op" id="6627405">)</span><span class="op" id="6627406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6627409">if</span>&nbsp;<span class="ident" id="6627412">err</span>&nbsp;<span class="op" id="6627416">==</span>&nbsp;<span class="builtintype" id="6627419">nil</span>&nbsp;<span class="op" id="6627423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6627427">t</span><span class="op" id="6627428">.</span><span class="ident" id="6627429">Error</span><span class="op" id="6627434">(</span><span class="string" id="6627435">&#34;expected&nbsp;error&nbsp;registering&nbsp;NeedsPtrType&#34;</span><span class="op" id="6627476">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6627479">}</span>&nbsp;<span class="keyword" id="6627481">else</span>&nbsp;<span class="keyword" id="6627486">if</span>&nbsp;<span class="op" id="6627489">!</span><span class="ident" id="6627490">strings</span><span class="op" id="6627497">.</span><span class="ident" id="6627498">Contains</span><span class="op" id="6627506">(</span><span class="ident" id="6627507">err</span><span class="op" id="6627510">.</span><span class="ident" id="6627511">Error</span><span class="op" id="6627516">(</span><span class="op" id="6627517">)</span><span class="op" id="6627518">,</span>&nbsp;<span class="string" id="6627520">&#34;pointer&#34;</span><span class="op" id="6627529">)</span>&nbsp;<span class="op" id="6627531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6627535">t</span><span class="op" id="6627536">.</span><span class="ident" id="6627537">Error</span><span class="op" id="6627542">(</span><span class="string" id="6627543">&#34;expected&nbsp;hint&nbsp;when&nbsp;registering&nbsp;NeedsPtrType&#34;</span><span class="op" id="6627588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6627591">}</span><br>
<span class="lineno"></span><span class="op" id="6627593">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span><span class="keyword" id="6627596">type</span>&nbsp;<span class="ident" id="6627601">WriteFailCodec</span>&nbsp;<span class="builtintype" id="6627616">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6627621">func</span>&nbsp;<span class="op" id="6627626">(</span><span class="ident" id="6627627">WriteFailCodec</span><span class="op" id="6627641">)</span>&nbsp;<span class="ident" id="6627643">WriteRequest</span><span class="op" id="6627655">(</span><span class="op" id="6627656">*</span><span class="ident" id="6627657">Request</span><span class="op" id="6627664">,</span>&nbsp;<span class="keyword" id="6627666">interface</span><span class="op" id="6627675">{</span><span class="op" id="6627676">}</span><span class="op" id="6627677">)</span>&nbsp;<span class="builtintype" id="6627679">error</span>&nbsp;<span class="op" id="6627685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6627688">//&nbsp;the&nbsp;panic&nbsp;caused&nbsp;by&nbsp;this&nbsp;error&nbsp;used&nbsp;to&nbsp;not&nbsp;unlock&nbsp;a&nbsp;lock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6627750">return</span>&nbsp;<span class="ident" id="6627757">errors</span><span class="op" id="6627763">.</span><span class="ident" id="6627764">New</span><span class="op" id="6627767">(</span><span class="string" id="6627768">&#34;fail&#34;</span><span class="op" id="6627774">)</span><br>
<span class="lineno">435</span><span class="op" id="6627776">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6627779">func</span>&nbsp;<span class="op" id="6627784">(</span><span class="ident" id="6627785">WriteFailCodec</span><span class="op" id="6627799">)</span>&nbsp;<span class="ident" id="6627801">ReadResponseHeader</span><span class="op" id="6627819">(</span><span class="op" id="6627820">*</span><span class="ident" id="6627821">Response</span><span class="op" id="6627829">)</span>&nbsp;<span class="builtintype" id="6627831">error</span>&nbsp;<span class="op" id="6627837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6627840">select</span>&nbsp;<span class="op" id="6627847">{</span><span class="op" id="6627848">}</span><br>
<span class="lineno"></span><span class="op" id="6627850">}</span><br>
<span class="lineno">440</span><br>
<span class="lineno"></span><span class="keyword" id="6627853">func</span>&nbsp;<span class="op" id="6627858">(</span><span class="ident" id="6627859">WriteFailCodec</span><span class="op" id="6627873">)</span>&nbsp;<span class="ident" id="6627875">ReadResponseBody</span><span class="op" id="6627891">(</span><span class="keyword" id="6627892">interface</span><span class="op" id="6627901">{</span><span class="op" id="6627902">}</span><span class="op" id="6627903">)</span>&nbsp;<span class="builtintype" id="6627905">error</span>&nbsp;<span class="op" id="6627911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6627914">select</span>&nbsp;<span class="op" id="6627921">{</span><span class="op" id="6627922">}</span><br>
<span class="lineno"></span><span class="op" id="6627924">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">445</span><span class="keyword" id="6627927">func</span>&nbsp;<span class="op" id="6627932">(</span><span class="ident" id="6627933">WriteFailCodec</span><span class="op" id="6627947">)</span>&nbsp;<span class="ident" id="6627949">Close</span><span class="op" id="6627954">(</span><span class="op" id="6627955">)</span>&nbsp;<span class="builtintype" id="6627957">error</span>&nbsp;<span class="op" id="6627963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6627966">return</span>&nbsp;<span class="builtintype" id="6627973">nil</span><br>
<span class="lineno"></span><span class="op" id="6627977">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6627980">func</span>&nbsp;<span class="ident" id="6627985">TestSendDeadlock</span><span class="op" id="6628001">(</span><span class="ident" id="6628002">t</span>&nbsp;<span class="op" id="6628004">*</span><span class="ident" id="6628005">testing</span><span class="op" id="6628012">.</span><span class="ident" id="6628013">T</span><span class="op" id="6628014">)</span>&nbsp;<span class="op" id="6628016">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6628019">client</span>&nbsp;<span class="op" id="6628026">:=</span>&nbsp;<span class="ident" id="6628029">NewClientWithCodec</span><span class="op" id="6628047">(</span><span class="ident" id="6628048">WriteFailCodec</span><span class="op" id="6628062">(</span><span class="num" id="6628063">0</span><span class="op" id="6628064">)</span><span class="op" id="6628065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6628068">defer</span>&nbsp;<span class="ident" id="6628074">client</span><span class="op" id="6628080">.</span><span class="ident" id="6628081">Close</span><span class="op" id="6628086">(</span><span class="op" id="6628087">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6628091">done</span>&nbsp;<span class="op" id="6628096">:=</span>&nbsp;<span class="builtinfunc" id="6628099">make</span><span class="op" id="6628103">(</span><span class="keyword" id="6628104">chan</span>&nbsp;<span class="builtintype" id="6628109">bool</span><span class="op" id="6628113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6628116">go</span>&nbsp;<span class="keyword" id="6628119">func</span><span class="op" id="6628123">(</span><span class="op" id="6628124">)</span>&nbsp;<span class="op" id="6628126">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6628130">testSendDeadlock</span><span class="op" id="6628146">(</span><span class="ident" id="6628147">client</span><span class="op" id="6628153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6628157">testSendDeadlock</span><span class="op" id="6628173">(</span><span class="ident" id="6628174">client</span><span class="op" id="6628180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6628184">done</span>&nbsp;<span class="op" id="6628189">&lt;-</span>&nbsp;<span class="builtintype" id="6628192">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6628198">}</span><span class="op" id="6628199">(</span><span class="op" id="6628200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6628203">select</span>&nbsp;<span class="op" id="6628210">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6628213">case</span>&nbsp;<span class="op" id="6628218">&lt;-</span><span class="ident" id="6628220">done</span><span class="op" id="6628224">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6628228">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6628236">case</span>&nbsp;<span class="op" id="6628241">&lt;-</span><span class="ident" id="6628243">time</span><span class="op" id="6628247">.</span><span class="ident" id="6628248">After</span><span class="op" id="6628253">(</span><span class="num" id="6628254">5</span>&nbsp;<span class="op" id="6628256">*</span>&nbsp;<span class="ident" id="6628258">time</span><span class="op" id="6628262">.</span><span class="ident" id="6628263">Second</span><span class="op" id="6628269">)</span><span class="op" id="6628270">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6628274">t</span><span class="op" id="6628275">.</span><span class="ident" id="6628276">Fatal</span><span class="op" id="6628281">(</span><span class="string" id="6628282">&#34;deadlock&#34;</span><span class="op" id="6628292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6628295">}</span><br>
<span class="lineno">465</span><span class="op" id="6628297">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6628300">func</span>&nbsp;<span class="ident" id="6628305">testSendDeadlock</span><span class="op" id="6628321">(</span><span class="ident" id="6628322">client</span>&nbsp;<span class="op" id="6628329">*</span><span class="ident" id="6628330">Client</span><span class="op" id="6628336">)</span>&nbsp;<span class="op" id="6628338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6628341">defer</span>&nbsp;<span class="keyword" id="6628347">func</span><span class="op" id="6628351">(</span><span class="op" id="6628352">)</span>&nbsp;<span class="op" id="6628354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6628358">recover</span><span class="op" id="6628365">(</span><span class="op" id="6628366">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6628369">}</span><span class="op" id="6628370">(</span><span class="op" id="6628371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6628374">args</span>&nbsp;<span class="op" id="6628379">:=</span>&nbsp;<span class="op" id="6628382">&amp;</span><span class="ident" id="6628383">Args</span><span class="op" id="6628387">{</span><span class="num" id="6628388">7</span><span class="op" id="6628389">,</span>&nbsp;<span class="num" id="6628391">8</span><span class="op" id="6628392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6628395">reply</span>&nbsp;<span class="op" id="6628401">:=</span>&nbsp;<span class="builtinfunc" id="6628404">new</span><span class="op" id="6628407">(</span><span class="ident" id="6628408">Reply</span><span class="op" id="6628413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6628416">client</span><span class="op" id="6628422">.</span><span class="ident" id="6628423">Call</span><span class="op" id="6628427">(</span><span class="string" id="6628428">&#34;Arith.Add&#34;</span><span class="op" id="6628439">,</span>&nbsp;<span class="ident" id="6628441">args</span><span class="op" id="6628445">,</span>&nbsp;<span class="ident" id="6628447">reply</span><span class="op" id="6628452">)</span><br>
<span class="lineno"></span><span class="op" id="6628454">}</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span><span class="keyword" id="6628457">func</span>&nbsp;<span class="ident" id="6628462">dialDirect</span><span class="op" id="6628472">(</span><span class="op" id="6628473">)</span>&nbsp;<span class="op" id="6628475">(</span><span class="op" id="6628476">*</span><span class="ident" id="6628477">Client</span><span class="op" id="6628483">,</span>&nbsp;<span class="builtintype" id="6628485">error</span><span class="op" id="6628490">)</span>&nbsp;<span class="op" id="6628492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6628495">return</span>&nbsp;<span class="ident" id="6628502">Dial</span><span class="op" id="6628506">(</span><span class="string" id="6628507">&#34;tcp&#34;</span><span class="op" id="6628512">,</span>&nbsp;<span class="ident" id="6628514">serverAddr</span><span class="op" id="6628524">)</span><br>
<span class="lineno"></span><span class="op" id="6628526">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">480</span><span class="keyword" id="6628529">func</span>&nbsp;<span class="ident" id="6628534">dialHTTP</span><span class="op" id="6628542">(</span><span class="op" id="6628543">)</span>&nbsp;<span class="op" id="6628545">(</span><span class="op" id="6628546">*</span><span class="ident" id="6628547">Client</span><span class="op" id="6628553">,</span>&nbsp;<span class="builtintype" id="6628555">error</span><span class="op" id="6628560">)</span>&nbsp;<span class="op" id="6628562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6628565">return</span>&nbsp;<span class="ident" id="6628572">DialHTTP</span><span class="op" id="6628580">(</span><span class="string" id="6628581">&#34;tcp&#34;</span><span class="op" id="6628586">,</span>&nbsp;<span class="ident" id="6628588">httpServerAddr</span><span class="op" id="6628602">)</span><br>
<span class="lineno"></span><span class="op" id="6628604">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6628607">func</span>&nbsp;<span class="ident" id="6628612">countMallocs</span><span class="op" id="6628624">(</span><span class="ident" id="6628625">dial</span>&nbsp;<span class="keyword" id="6628630">func</span><span class="op" id="6628634">(</span><span class="op" id="6628635">)</span>&nbsp;<span class="op" id="6628637">(</span><span class="op" id="6628638">*</span><span class="ident" id="6628639">Client</span><span class="op" id="6628645">,</span>&nbsp;<span class="builtintype" id="6628647">error</span><span class="op" id="6628652">)</span><span class="op" id="6628653">,</span>&nbsp;<span class="ident" id="6628655">t</span>&nbsp;<span class="op" id="6628657">*</span><span class="ident" id="6628658">testing</span><span class="op" id="6628665">.</span><span class="ident" id="6628666">T</span><span class="op" id="6628667">)</span>&nbsp;<span class="builtintype" id="6628669">float64</span>&nbsp;<span class="op" id="6628677">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6628680">once</span><span class="op" id="6628684">.</span><span class="ident" id="6628685">Do</span><span class="op" id="6628687">(</span><span class="ident" id="6628688">startServer</span><span class="op" id="6628699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6628702">client</span><span class="op" id="6628708">,</span>&nbsp;<span class="ident" id="6628710">err</span>&nbsp;<span class="op" id="6628714">:=</span>&nbsp;<span class="ident" id="6628717">dial</span><span class="op" id="6628721">(</span><span class="op" id="6628722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6628725">if</span>&nbsp;<span class="ident" id="6628728">err</span>&nbsp;<span class="op" id="6628732">!=</span>&nbsp;<span class="builtintype" id="6628735">nil</span>&nbsp;<span class="op" id="6628739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6628743">t</span><span class="op" id="6628744">.</span><span class="ident" id="6628745">Fatal</span><span class="op" id="6628750">(</span><span class="string" id="6628751">&#34;error&nbsp;dialing&#34;</span><span class="op" id="6628766">,</span>&nbsp;<span class="ident" id="6628768">err</span><span class="op" id="6628771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6628774">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6628777">defer</span>&nbsp;<span class="ident" id="6628783">client</span><span class="op" id="6628789">.</span><span class="ident" id="6628790">Close</span><span class="op" id="6628795">(</span><span class="op" id="6628796">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6628800">args</span>&nbsp;<span class="op" id="6628805">:=</span>&nbsp;<span class="op" id="6628808">&amp;</span><span class="ident" id="6628809">Args</span><span class="op" id="6628813">{</span><span class="num" id="6628814">7</span><span class="op" id="6628815">,</span>&nbsp;<span class="num" id="6628817">8</span><span class="op" id="6628818">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6628821">reply</span>&nbsp;<span class="op" id="6628827">:=</span>&nbsp;<span class="builtinfunc" id="6628830">new</span><span class="op" id="6628833">(</span><span class="ident" id="6628834">Reply</span><span class="op" id="6628839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6628842">return</span>&nbsp;<span class="ident" id="6628849">testing</span><span class="op" id="6628856">.</span><span class="ident" id="6628857">AllocsPerRun</span><span class="op" id="6628869">(</span><span class="num" id="6628870">100</span><span class="op" id="6628873">,</span>&nbsp;<span class="keyword" id="6628875">func</span><span class="op" id="6628879">(</span><span class="op" id="6628880">)</span>&nbsp;<span class="op" id="6628882">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6628886">err</span>&nbsp;<span class="op" id="6628890">:=</span>&nbsp;<span class="ident" id="6628893">client</span><span class="op" id="6628899">.</span><span class="ident" id="6628900">Call</span><span class="op" id="6628904">(</span><span class="string" id="6628905">&#34;Arith.Add&#34;</span><span class="op" id="6628916">,</span>&nbsp;<span class="ident" id="6628918">args</span><span class="op" id="6628922">,</span>&nbsp;<span class="ident" id="6628924">reply</span><span class="op" id="6628929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6628933">if</span>&nbsp;<span class="ident" id="6628936">err</span>&nbsp;<span class="op" id="6628940">!=</span>&nbsp;<span class="builtintype" id="6628943">nil</span>&nbsp;<span class="op" id="6628947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6628952">t</span><span class="op" id="6628953">.</span><span class="ident" id="6628954">Errorf</span><span class="op" id="6628960">(</span><span class="string" id="6628961">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6629003">,</span>&nbsp;<span class="ident" id="6629005">err</span><span class="op" id="6629008">.</span><span class="ident" id="6629009">Error</span><span class="op" id="6629014">(</span><span class="op" id="6629015">)</span><span class="op" id="6629016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6629020">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6629024">if</span>&nbsp;<span class="ident" id="6629027">reply</span><span class="op" id="6629032">.</span><span class="ident" id="6629033">C</span>&nbsp;<span class="op" id="6629035">!=</span>&nbsp;<span class="ident" id="6629038">args</span><span class="op" id="6629042">.</span><span class="ident" id="6629043">A</span><span class="op" id="6629044">+</span><span class="ident" id="6629045">args</span><span class="op" id="6629049">.</span><span class="ident" id="6629050">B</span>&nbsp;<span class="op" id="6629052">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6629057">t</span><span class="op" id="6629058">.</span><span class="ident" id="6629059">Errorf</span><span class="op" id="6629065">(</span><span class="string" id="6629066">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6629091">,</span>&nbsp;<span class="ident" id="6629093">reply</span><span class="op" id="6629098">.</span><span class="ident" id="6629099">C</span><span class="op" id="6629100">,</span>&nbsp;<span class="ident" id="6629102">args</span><span class="op" id="6629106">.</span><span class="ident" id="6629107">A</span><span class="op" id="6629108">+</span><span class="ident" id="6629109">args</span><span class="op" id="6629113">.</span><span class="ident" id="6629114">B</span><span class="op" id="6629115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6629119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6629122">}</span><span class="op" id="6629123">)</span><br>
<span class="lineno"></span><span class="op" id="6629125">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">505</span><span class="keyword" id="6629128">func</span>&nbsp;<span class="ident" id="6629133">TestCountMallocs</span><span class="op" id="6629149">(</span><span class="ident" id="6629150">t</span>&nbsp;<span class="op" id="6629152">*</span><span class="ident" id="6629153">testing</span><span class="op" id="6629160">.</span><span class="ident" id="6629161">T</span><span class="op" id="6629162">)</span>&nbsp;<span class="op" id="6629164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6629167">if</span>&nbsp;<span class="ident" id="6629170">testing</span><span class="op" id="6629177">.</span><span class="ident" id="6629178">Short</span><span class="op" id="6629183">(</span><span class="op" id="6629184">)</span>&nbsp;<span class="op" id="6629186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6629190">t</span><span class="op" id="6629191">.</span><span class="ident" id="6629192">Skip</span><span class="op" id="6629196">(</span><span class="string" id="6629197">&#34;skipping&nbsp;malloc&nbsp;count&nbsp;in&nbsp;short&nbsp;mode&#34;</span><span class="op" id="6629234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6629237">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6629240">if</span>&nbsp;<span class="ident" id="6629243">runtime</span><span class="op" id="6629250">.</span><span class="ident" id="6629251">GOMAXPROCS</span><span class="op" id="6629261">(</span><span class="num" id="6629262">0</span><span class="op" id="6629263">)</span>&nbsp;<span class="op" id="6629265">&gt;</span>&nbsp;<span class="num" id="6629267">1</span>&nbsp;<span class="op" id="6629269">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6629273">t</span><span class="op" id="6629274">.</span><span class="ident" id="6629275">Skip</span><span class="op" id="6629279">(</span><span class="string" id="6629280">&#34;skipping;&nbsp;GOMAXPROCS&gt;1&#34;</span><span class="op" id="6629304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6629307">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6629310">fmt</span><span class="op" id="6629313">.</span><span class="ident" id="6629314">Printf</span><span class="op" id="6629320">(</span><span class="string" id="6629321">&#34;mallocs&nbsp;per&nbsp;rpc&nbsp;round&nbsp;trip:&nbsp;%v\n&#34;</span><span class="op" id="6629355">,</span>&nbsp;<span class="ident" id="6629357">countMallocs</span><span class="op" id="6629369">(</span><span class="ident" id="6629370">dialDirect</span><span class="op" id="6629380">,</span>&nbsp;<span class="ident" id="6629382">t</span><span class="op" id="6629383">)</span><span class="op" id="6629384">)</span><br>
<span class="lineno"></span><span class="op" id="6629386">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span><span class="keyword" id="6629389">func</span>&nbsp;<span class="ident" id="6629394">TestCountMallocsOverHTTP</span><span class="op" id="6629418">(</span><span class="ident" id="6629419">t</span>&nbsp;<span class="op" id="6629421">*</span><span class="ident" id="6629422">testing</span><span class="op" id="6629429">.</span><span class="ident" id="6629430">T</span><span class="op" id="6629431">)</span>&nbsp;<span class="op" id="6629433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6629436">if</span>&nbsp;<span class="ident" id="6629439">testing</span><span class="op" id="6629446">.</span><span class="ident" id="6629447">Short</span><span class="op" id="6629452">(</span><span class="op" id="6629453">)</span>&nbsp;<span class="op" id="6629455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6629459">t</span><span class="op" id="6629460">.</span><span class="ident" id="6629461">Skip</span><span class="op" id="6629465">(</span><span class="string" id="6629466">&#34;skipping&nbsp;malloc&nbsp;count&nbsp;in&nbsp;short&nbsp;mode&#34;</span><span class="op" id="6629503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6629506">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6629509">if</span>&nbsp;<span class="ident" id="6629512">runtime</span><span class="op" id="6629519">.</span><span class="ident" id="6629520">GOMAXPROCS</span><span class="op" id="6629530">(</span><span class="num" id="6629531">0</span><span class="op" id="6629532">)</span>&nbsp;<span class="op" id="6629534">&gt;</span>&nbsp;<span class="num" id="6629536">1</span>&nbsp;<span class="op" id="6629538">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6629542">t</span><span class="op" id="6629543">.</span><span class="ident" id="6629544">Skip</span><span class="op" id="6629548">(</span><span class="string" id="6629549">&#34;skipping;&nbsp;GOMAXPROCS&gt;1&#34;</span><span class="op" id="6629573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6629576">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6629579">fmt</span><span class="op" id="6629582">.</span><span class="ident" id="6629583">Printf</span><span class="op" id="6629589">(</span><span class="string" id="6629590">&#34;mallocs&nbsp;per&nbsp;HTTP&nbsp;rpc&nbsp;round&nbsp;trip:&nbsp;%v\n&#34;</span><span class="op" id="6629629">,</span>&nbsp;<span class="ident" id="6629631">countMallocs</span><span class="op" id="6629643">(</span><span class="ident" id="6629644">dialHTTP</span><span class="op" id="6629652">,</span>&nbsp;<span class="ident" id="6629654">t</span><span class="op" id="6629655">)</span><span class="op" id="6629656">)</span><br>
<span class="lineno"></span><span class="op" id="6629658">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">525</span><span class="keyword" id="6629661">type</span>&nbsp;<span class="ident" id="6629666">writeCrasher</span>&nbsp;<span class="keyword" id="6629679">struct</span>&nbsp;<span class="op" id="6629686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6629689">done</span>&nbsp;<span class="keyword" id="6629694">chan</span>&nbsp;<span class="builtintype" id="6629699">bool</span><br>
<span class="lineno"></span><span class="op" id="6629704">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6629707">func</span>&nbsp;<span class="op" id="6629712">(</span><span class="ident" id="6629713">writeCrasher</span><span class="op" id="6629725">)</span>&nbsp;<span class="ident" id="6629727">Close</span><span class="op" id="6629732">(</span><span class="op" id="6629733">)</span>&nbsp;<span class="builtintype" id="6629735">error</span>&nbsp;<span class="op" id="6629741">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6629744">return</span>&nbsp;<span class="builtintype" id="6629751">nil</span><br>
<span class="lineno"></span><span class="op" id="6629755">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6629758">func</span>&nbsp;<span class="op" id="6629763">(</span><span class="ident" id="6629764">w</span>&nbsp;<span class="op" id="6629766">*</span><span class="ident" id="6629767">writeCrasher</span><span class="op" id="6629779">)</span>&nbsp;<span class="ident" id="6629781">Read</span><span class="op" id="6629785">(</span><span class="ident" id="6629786">p</span>&nbsp;<span class="op" id="6629788">[</span><span class="op" id="6629789">]</span><span class="builtintype" id="6629790">byte</span><span class="op" id="6629794">)</span>&nbsp;<span class="op" id="6629796">(</span><span class="builtintype" id="6629797">int</span><span class="op" id="6629800">,</span>&nbsp;<span class="builtintype" id="6629802">error</span><span class="op" id="6629807">)</span>&nbsp;<span class="op" id="6629809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6629812">&lt;-</span><span class="ident" id="6629814">w</span><span class="op" id="6629815">.</span><span class="ident" id="6629816">done</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6629822">return</span>&nbsp;<span class="num" id="6629829">0</span><span class="op" id="6629830">,</span>&nbsp;<span class="ident" id="6629832">io</span><span class="op" id="6629834">.</span><span class="ident" id="6629835">EOF</span><br>
<span class="lineno"></span><span class="op" id="6629839">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6629842">func</span>&nbsp;<span class="op" id="6629847">(</span><span class="ident" id="6629848">writeCrasher</span><span class="op" id="6629860">)</span>&nbsp;<span class="ident" id="6629862">Write</span><span class="op" id="6629867">(</span><span class="ident" id="6629868">p</span>&nbsp;<span class="op" id="6629870">[</span><span class="op" id="6629871">]</span><span class="builtintype" id="6629872">byte</span><span class="op" id="6629876">)</span>&nbsp;<span class="op" id="6629878">(</span><span class="builtintype" id="6629879">int</span><span class="op" id="6629882">,</span>&nbsp;<span class="builtintype" id="6629884">error</span><span class="op" id="6629889">)</span>&nbsp;<span class="op" id="6629891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6629894">return</span>&nbsp;<span class="num" id="6629901">0</span><span class="op" id="6629902">,</span>&nbsp;<span class="ident" id="6629904">errors</span><span class="op" id="6629910">.</span><span class="ident" id="6629911">New</span><span class="op" id="6629914">(</span><span class="string" id="6629915">&#34;fake&nbsp;write&nbsp;failure&#34;</span><span class="op" id="6629935">)</span><br>
<span class="lineno">540</span><span class="op" id="6629937">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6629940">func</span>&nbsp;<span class="ident" id="6629945">TestClientWriteError</span><span class="op" id="6629965">(</span><span class="ident" id="6629966">t</span>&nbsp;<span class="op" id="6629968">*</span><span class="ident" id="6629969">testing</span><span class="op" id="6629976">.</span><span class="ident" id="6629977">T</span><span class="op" id="6629978">)</span>&nbsp;<span class="op" id="6629980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6629983">w</span>&nbsp;<span class="op" id="6629985">:=</span>&nbsp;<span class="op" id="6629988">&amp;</span><span class="ident" id="6629989">writeCrasher</span><span class="op" id="6630001">{</span><span class="ident" id="6630002">done</span><span class="op" id="6630006">:</span>&nbsp;<span class="builtinfunc" id="6630008">make</span><span class="op" id="6630012">(</span><span class="keyword" id="6630013">chan</span>&nbsp;<span class="builtintype" id="6630018">bool</span><span class="op" id="6630022">)</span><span class="op" id="6630023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6630026">c</span>&nbsp;<span class="op" id="6630028">:=</span>&nbsp;<span class="ident" id="6630031">NewClient</span><span class="op" id="6630040">(</span><span class="ident" id="6630041">w</span><span class="op" id="6630042">)</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6630045">defer</span>&nbsp;<span class="ident" id="6630051">c</span><span class="op" id="6630052">.</span><span class="ident" id="6630053">Close</span><span class="op" id="6630058">(</span><span class="op" id="6630059">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6630063">res</span>&nbsp;<span class="op" id="6630067">:=</span>&nbsp;<span class="builtintype" id="6630070">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6630077">err</span>&nbsp;<span class="op" id="6630081">:=</span>&nbsp;<span class="ident" id="6630084">c</span><span class="op" id="6630085">.</span><span class="ident" id="6630086">Call</span><span class="op" id="6630090">(</span><span class="string" id="6630091">&#34;foo&#34;</span><span class="op" id="6630096">,</span>&nbsp;<span class="num" id="6630098">1</span><span class="op" id="6630099">,</span>&nbsp;<span class="op" id="6630101">&amp;</span><span class="ident" id="6630102">res</span><span class="op" id="6630105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6630108">if</span>&nbsp;<span class="ident" id="6630111">err</span>&nbsp;<span class="op" id="6630115">==</span>&nbsp;<span class="builtintype" id="6630118">nil</span>&nbsp;<span class="op" id="6630122">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6630126">t</span><span class="op" id="6630127">.</span><span class="ident" id="6630128">Fatal</span><span class="op" id="6630133">(</span><span class="string" id="6630134">&#34;expected&nbsp;error&#34;</span><span class="op" id="6630150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6630153">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6630156">if</span>&nbsp;<span class="ident" id="6630159">err</span><span class="op" id="6630162">.</span><span class="ident" id="6630163">Error</span><span class="op" id="6630168">(</span><span class="op" id="6630169">)</span>&nbsp;<span class="op" id="6630171">!=</span>&nbsp;<span class="string" id="6630174">&#34;fake&nbsp;write&nbsp;failure&#34;</span>&nbsp;<span class="op" id="6630195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6630199">t</span><span class="op" id="6630200">.</span><span class="ident" id="6630201">Error</span><span class="op" id="6630206">(</span><span class="string" id="6630207">&#34;unexpected&nbsp;value&nbsp;of&nbsp;error:&#34;</span><span class="op" id="6630235">,</span>&nbsp;<span class="ident" id="6630237">err</span><span class="op" id="6630240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6630243">}</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6630246">w</span><span class="op" id="6630247">.</span><span class="ident" id="6630248">done</span>&nbsp;<span class="op" id="6630253">&lt;-</span>&nbsp;<span class="builtintype" id="6630256">true</span><br>
<span class="lineno"></span><span class="op" id="6630261">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6630264">func</span>&nbsp;<span class="ident" id="6630269">TestTCPClose</span><span class="op" id="6630281">(</span><span class="ident" id="6630282">t</span>&nbsp;<span class="op" id="6630284">*</span><span class="ident" id="6630285">testing</span><span class="op" id="6630292">.</span><span class="ident" id="6630293">T</span><span class="op" id="6630294">)</span>&nbsp;<span class="op" id="6630296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6630299">once</span><span class="op" id="6630303">.</span><span class="ident" id="6630304">Do</span><span class="op" id="6630306">(</span><span class="ident" id="6630307">startServer</span><span class="op" id="6630318">)</span><br>
<span class="lineno">560</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6630322">client</span><span class="op" id="6630328">,</span>&nbsp;<span class="ident" id="6630330">err</span>&nbsp;<span class="op" id="6630334">:=</span>&nbsp;<span class="ident" id="6630337">dialHTTP</span><span class="op" id="6630345">(</span><span class="op" id="6630346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6630349">if</span>&nbsp;<span class="ident" id="6630352">err</span>&nbsp;<span class="op" id="6630356">!=</span>&nbsp;<span class="builtintype" id="6630359">nil</span>&nbsp;<span class="op" id="6630363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6630367">t</span><span class="op" id="6630368">.</span><span class="ident" id="6630369">Fatalf</span><span class="op" id="6630375">(</span><span class="string" id="6630376">&#34;dialing:&nbsp;%v&#34;</span><span class="op" id="6630389">,</span>&nbsp;<span class="ident" id="6630391">err</span><span class="op" id="6630394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6630397">}</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6630400">defer</span>&nbsp;<span class="ident" id="6630406">client</span><span class="op" id="6630412">.</span><span class="ident" id="6630413">Close</span><span class="op" id="6630418">(</span><span class="op" id="6630419">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6630423">args</span>&nbsp;<span class="op" id="6630428">:=</span>&nbsp;<span class="ident" id="6630431">Args</span><span class="op" id="6630435">{</span><span class="num" id="6630436">17</span><span class="op" id="6630438">,</span>&nbsp;<span class="num" id="6630440">8</span><span class="op" id="6630441">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6630444">var</span>&nbsp;<span class="ident" id="6630448">reply</span>&nbsp;<span class="ident" id="6630454">Reply</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6630461">err</span>&nbsp;<span class="op" id="6630465">=</span>&nbsp;<span class="ident" id="6630467">client</span><span class="op" id="6630473">.</span><span class="ident" id="6630474">Call</span><span class="op" id="6630478">(</span><span class="string" id="6630479">&#34;Arith.Mul&#34;</span><span class="op" id="6630490">,</span>&nbsp;<span class="ident" id="6630492">args</span><span class="op" id="6630496">,</span>&nbsp;<span class="op" id="6630498">&amp;</span><span class="ident" id="6630499">reply</span><span class="op" id="6630504">)</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6630507">if</span>&nbsp;<span class="ident" id="6630510">err</span>&nbsp;<span class="op" id="6630514">!=</span>&nbsp;<span class="builtintype" id="6630517">nil</span>&nbsp;<span class="op" id="6630521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6630525">t</span><span class="op" id="6630526">.</span><span class="ident" id="6630527">Fatal</span><span class="op" id="6630532">(</span><span class="string" id="6630533">&#34;arith&nbsp;error:&#34;</span><span class="op" id="6630547">,</span>&nbsp;<span class="ident" id="6630549">err</span><span class="op" id="6630552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6630555">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6630558">t</span><span class="op" id="6630559">.</span><span class="ident" id="6630560">Logf</span><span class="op" id="6630564">(</span><span class="string" id="6630565">&#34;Arith:&nbsp;%d*%d=%d\n&#34;</span><span class="op" id="6630584">,</span>&nbsp;<span class="ident" id="6630586">args</span><span class="op" id="6630590">.</span><span class="ident" id="6630591">A</span><span class="op" id="6630592">,</span>&nbsp;<span class="ident" id="6630594">args</span><span class="op" id="6630598">.</span><span class="ident" id="6630599">B</span><span class="op" id="6630600">,</span>&nbsp;<span class="ident" id="6630602">reply</span><span class="op" id="6630607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6630610">if</span>&nbsp;<span class="ident" id="6630613">reply</span><span class="op" id="6630618">.</span><span class="ident" id="6630619">C</span>&nbsp;<span class="op" id="6630621">!=</span>&nbsp;<span class="ident" id="6630624">args</span><span class="op" id="6630628">.</span><span class="ident" id="6630629">A</span><span class="op" id="6630630">*</span><span class="ident" id="6630631">args</span><span class="op" id="6630635">.</span><span class="ident" id="6630636">B</span>&nbsp;<span class="op" id="6630638">{</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6630642">t</span><span class="op" id="6630643">.</span><span class="ident" id="6630644">Errorf</span><span class="op" id="6630650">(</span><span class="string" id="6630651">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6630676">,</span>&nbsp;<span class="ident" id="6630678">reply</span><span class="op" id="6630683">.</span><span class="ident" id="6630684">C</span><span class="op" id="6630685">,</span>&nbsp;<span class="ident" id="6630687">args</span><span class="op" id="6630691">.</span><span class="ident" id="6630692">A</span><span class="op" id="6630693">*</span><span class="ident" id="6630694">args</span><span class="op" id="6630698">.</span><span class="ident" id="6630699">B</span><span class="op" id="6630700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6630703">}</span><br>
<span class="lineno"></span><span class="op" id="6630705">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6630708">func</span>&nbsp;<span class="ident" id="6630713">TestErrorAfterClientClose</span><span class="op" id="6630738">(</span><span class="ident" id="6630739">t</span>&nbsp;<span class="op" id="6630741">*</span><span class="ident" id="6630742">testing</span><span class="op" id="6630749">.</span><span class="ident" id="6630750">T</span><span class="op" id="6630751">)</span>&nbsp;<span class="op" id="6630753">{</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6630756">once</span><span class="op" id="6630760">.</span><span class="ident" id="6630761">Do</span><span class="op" id="6630763">(</span><span class="ident" id="6630764">startServer</span><span class="op" id="6630775">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6630779">client</span><span class="op" id="6630785">,</span>&nbsp;<span class="ident" id="6630787">err</span>&nbsp;<span class="op" id="6630791">:=</span>&nbsp;<span class="ident" id="6630794">dialHTTP</span><span class="op" id="6630802">(</span><span class="op" id="6630803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6630806">if</span>&nbsp;<span class="ident" id="6630809">err</span>&nbsp;<span class="op" id="6630813">!=</span>&nbsp;<span class="builtintype" id="6630816">nil</span>&nbsp;<span class="op" id="6630820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6630824">t</span><span class="op" id="6630825">.</span><span class="ident" id="6630826">Fatalf</span><span class="op" id="6630832">(</span><span class="string" id="6630833">&#34;dialing:&nbsp;%v&#34;</span><span class="op" id="6630846">,</span>&nbsp;<span class="ident" id="6630848">err</span><span class="op" id="6630851">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6630854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6630857">err</span>&nbsp;<span class="op" id="6630861">=</span>&nbsp;<span class="ident" id="6630863">client</span><span class="op" id="6630869">.</span><span class="ident" id="6630870">Close</span><span class="op" id="6630875">(</span><span class="op" id="6630876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6630879">if</span>&nbsp;<span class="ident" id="6630882">err</span>&nbsp;<span class="op" id="6630886">!=</span>&nbsp;<span class="builtintype" id="6630889">nil</span>&nbsp;<span class="op" id="6630893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6630897">t</span><span class="op" id="6630898">.</span><span class="ident" id="6630899">Fatal</span><span class="op" id="6630904">(</span><span class="string" id="6630905">&#34;close&nbsp;error:&#34;</span><span class="op" id="6630919">,</span>&nbsp;<span class="ident" id="6630921">err</span><span class="op" id="6630924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6630927">}</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6630930">err</span>&nbsp;<span class="op" id="6630934">=</span>&nbsp;<span class="ident" id="6630936">client</span><span class="op" id="6630942">.</span><span class="ident" id="6630943">Call</span><span class="op" id="6630947">(</span><span class="string" id="6630948">&#34;Arith.Add&#34;</span><span class="op" id="6630959">,</span>&nbsp;<span class="op" id="6630961">&amp;</span><span class="ident" id="6630962">Args</span><span class="op" id="6630966">{</span><span class="num" id="6630967">7</span><span class="op" id="6630968">,</span>&nbsp;<span class="num" id="6630970">9</span><span class="op" id="6630971">}</span><span class="op" id="6630972">,</span>&nbsp;<span class="builtinfunc" id="6630974">new</span><span class="op" id="6630977">(</span><span class="ident" id="6630978">Reply</span><span class="op" id="6630983">)</span><span class="op" id="6630984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6630987">if</span>&nbsp;<span class="ident" id="6630990">err</span>&nbsp;<span class="op" id="6630994">!=</span>&nbsp;<span class="ident" id="6630997">ErrShutdown</span>&nbsp;<span class="op" id="6631009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6631013">t</span><span class="op" id="6631014">.</span><span class="ident" id="6631015">Errorf</span><span class="op" id="6631021">(</span><span class="string" id="6631022">&#34;Forever:&nbsp;expected&nbsp;ErrShutdown&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6631060">,</span>&nbsp;<span class="ident" id="6631062">err</span><span class="op" id="6631065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6631068">}</span><br>
<span class="lineno"></span><span class="op" id="6631070">}</span><br>
<span class="lineno">595</span><br>
<span class="lineno"></span><span class="keyword" id="6631073">func</span>&nbsp;<span class="ident" id="6631078">benchmarkEndToEnd</span><span class="op" id="6631095">(</span><span class="ident" id="6631096">dial</span>&nbsp;<span class="keyword" id="6631101">func</span><span class="op" id="6631105">(</span><span class="op" id="6631106">)</span>&nbsp;<span class="op" id="6631108">(</span><span class="op" id="6631109">*</span><span class="ident" id="6631110">Client</span><span class="op" id="6631116">,</span>&nbsp;<span class="builtintype" id="6631118">error</span><span class="op" id="6631123">)</span><span class="op" id="6631124">,</span>&nbsp;<span class="ident" id="6631126">b</span>&nbsp;<span class="op" id="6631128">*</span><span class="ident" id="6631129">testing</span><span class="op" id="6631136">.</span><span class="ident" id="6631137">B</span><span class="op" id="6631138">)</span>&nbsp;<span class="op" id="6631140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6631143">once</span><span class="op" id="6631147">.</span><span class="ident" id="6631148">Do</span><span class="op" id="6631150">(</span><span class="ident" id="6631151">startServer</span><span class="op" id="6631162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6631165">client</span><span class="op" id="6631171">,</span>&nbsp;<span class="ident" id="6631173">err</span>&nbsp;<span class="op" id="6631177">:=</span>&nbsp;<span class="ident" id="6631180">dial</span><span class="op" id="6631184">(</span><span class="op" id="6631185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6631188">if</span>&nbsp;<span class="ident" id="6631191">err</span>&nbsp;<span class="op" id="6631195">!=</span>&nbsp;<span class="builtintype" id="6631198">nil</span>&nbsp;<span class="op" id="6631202">{</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6631206">b</span><span class="op" id="6631207">.</span><span class="ident" id="6631208">Fatal</span><span class="op" id="6631213">(</span><span class="string" id="6631214">&#34;error&nbsp;dialing:&#34;</span><span class="op" id="6631230">,</span>&nbsp;<span class="ident" id="6631232">err</span><span class="op" id="6631235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6631238">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6631241">defer</span>&nbsp;<span class="ident" id="6631247">client</span><span class="op" id="6631253">.</span><span class="ident" id="6631254">Close</span><span class="op" id="6631259">(</span><span class="op" id="6631260">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6631264">//&nbsp;Synchronous&nbsp;calls</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6631286">args</span>&nbsp;<span class="op" id="6631291">:=</span>&nbsp;<span class="op" id="6631294">&amp;</span><span class="ident" id="6631295">Args</span><span class="op" id="6631299">{</span><span class="num" id="6631300">7</span><span class="op" id="6631301">,</span>&nbsp;<span class="num" id="6631303">8</span><span class="op" id="6631304">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6631307">b</span><span class="op" id="6631308">.</span><span class="ident" id="6631309">ResetTimer</span><span class="op" id="6631319">(</span><span class="op" id="6631320">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6631324">b</span><span class="op" id="6631325">.</span><span class="ident" id="6631326">RunParallel</span><span class="op" id="6631337">(</span><span class="keyword" id="6631338">func</span><span class="op" id="6631342">(</span><span class="ident" id="6631343">pb</span>&nbsp;<span class="op" id="6631346">*</span><span class="ident" id="6631347">testing</span><span class="op" id="6631354">.</span><span class="ident" id="6631355">PB</span><span class="op" id="6631357">)</span>&nbsp;<span class="op" id="6631359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6631363">reply</span>&nbsp;<span class="op" id="6631369">:=</span>&nbsp;<span class="builtinfunc" id="6631372">new</span><span class="op" id="6631375">(</span><span class="ident" id="6631376">Reply</span><span class="op" id="6631381">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6631385">for</span>&nbsp;<span class="ident" id="6631389">pb</span><span class="op" id="6631391">.</span><span class="ident" id="6631392">Next</span><span class="op" id="6631396">(</span><span class="op" id="6631397">)</span>&nbsp;<span class="op" id="6631399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6631404">err</span>&nbsp;<span class="op" id="6631408">:=</span>&nbsp;<span class="ident" id="6631411">client</span><span class="op" id="6631417">.</span><span class="ident" id="6631418">Call</span><span class="op" id="6631422">(</span><span class="string" id="6631423">&#34;Arith.Add&#34;</span><span class="op" id="6631434">,</span>&nbsp;<span class="ident" id="6631436">args</span><span class="op" id="6631440">,</span>&nbsp;<span class="ident" id="6631442">reply</span><span class="op" id="6631447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6631452">if</span>&nbsp;<span class="ident" id="6631455">err</span>&nbsp;<span class="op" id="6631459">!=</span>&nbsp;<span class="builtintype" id="6631462">nil</span>&nbsp;<span class="op" id="6631466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6631472">b</span><span class="op" id="6631473">.</span><span class="ident" id="6631474">Fatalf</span><span class="op" id="6631480">(</span><span class="string" id="6631481">&#34;rpc&nbsp;error:&nbsp;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6631534">,</span>&nbsp;<span class="ident" id="6631536">err</span><span class="op" id="6631539">.</span><span class="ident" id="6631540">Error</span><span class="op" id="6631545">(</span><span class="op" id="6631546">)</span><span class="op" id="6631547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6631552">}</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6631557">if</span>&nbsp;<span class="ident" id="6631560">reply</span><span class="op" id="6631565">.</span><span class="ident" id="6631566">C</span>&nbsp;<span class="op" id="6631568">!=</span>&nbsp;<span class="ident" id="6631571">args</span><span class="op" id="6631575">.</span><span class="ident" id="6631576">A</span><span class="op" id="6631577">+</span><span class="ident" id="6631578">args</span><span class="op" id="6631582">.</span><span class="ident" id="6631583">B</span>&nbsp;<span class="op" id="6631585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6631591">b</span><span class="op" id="6631592">.</span><span class="ident" id="6631593">Fatalf</span><span class="op" id="6631599">(</span><span class="string" id="6631600">&#34;rpc&nbsp;error:&nbsp;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6631636">,</span>&nbsp;<span class="ident" id="6631638">reply</span><span class="op" id="6631643">.</span><span class="ident" id="6631644">C</span><span class="op" id="6631645">,</span>&nbsp;<span class="ident" id="6631647">args</span><span class="op" id="6631651">.</span><span class="ident" id="6631652">A</span><span class="op" id="6631653">+</span><span class="ident" id="6631654">args</span><span class="op" id="6631658">.</span><span class="ident" id="6631659">B</span><span class="op" id="6631660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6631665">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6631669">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6631672">}</span><span class="op" id="6631673">)</span><br>
<span class="lineno">620</span><span class="op" id="6631675">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6631678">func</span>&nbsp;<span class="ident" id="6631683">benchmarkEndToEndAsync</span><span class="op" id="6631705">(</span><span class="ident" id="6631706">dial</span>&nbsp;<span class="keyword" id="6631711">func</span><span class="op" id="6631715">(</span><span class="op" id="6631716">)</span>&nbsp;<span class="op" id="6631718">(</span><span class="op" id="6631719">*</span><span class="ident" id="6631720">Client</span><span class="op" id="6631726">,</span>&nbsp;<span class="builtintype" id="6631728">error</span><span class="op" id="6631733">)</span><span class="op" id="6631734">,</span>&nbsp;<span class="ident" id="6631736">b</span>&nbsp;<span class="op" id="6631738">*</span><span class="ident" id="6631739">testing</span><span class="op" id="6631746">.</span><span class="ident" id="6631747">B</span><span class="op" id="6631748">)</span>&nbsp;<span class="op" id="6631750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6631753">const</span>&nbsp;<span class="ident" id="6631759">MaxConcurrentCalls</span>&nbsp;<span class="op" id="6631778">=</span>&nbsp;<span class="num" id="6631780">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6631785">once</span><span class="op" id="6631789">.</span><span class="ident" id="6631790">Do</span><span class="op" id="6631792">(</span><span class="ident" id="6631793">startServer</span><span class="op" id="6631804">)</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6631807">client</span><span class="op" id="6631813">,</span>&nbsp;<span class="ident" id="6631815">err</span>&nbsp;<span class="op" id="6631819">:=</span>&nbsp;<span class="ident" id="6631822">dial</span><span class="op" id="6631826">(</span><span class="op" id="6631827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6631830">if</span>&nbsp;<span class="ident" id="6631833">err</span>&nbsp;<span class="op" id="6631837">!=</span>&nbsp;<span class="builtintype" id="6631840">nil</span>&nbsp;<span class="op" id="6631844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6631848">b</span><span class="op" id="6631849">.</span><span class="ident" id="6631850">Fatal</span><span class="op" id="6631855">(</span><span class="string" id="6631856">&#34;error&nbsp;dialing:&#34;</span><span class="op" id="6631872">,</span>&nbsp;<span class="ident" id="6631874">err</span><span class="op" id="6631877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6631880">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6631883">defer</span>&nbsp;<span class="ident" id="6631889">client</span><span class="op" id="6631895">.</span><span class="ident" id="6631896">Close</span><span class="op" id="6631901">(</span><span class="op" id="6631902">)</span><br>
<span class="lineno">630</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6631906">//&nbsp;Asynchronous&nbsp;calls</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6631929">args</span>&nbsp;<span class="op" id="6631934">:=</span>&nbsp;<span class="op" id="6631937">&amp;</span><span class="ident" id="6631938">Args</span><span class="op" id="6631942">{</span><span class="num" id="6631943">7</span><span class="op" id="6631944">,</span>&nbsp;<span class="num" id="6631946">8</span><span class="op" id="6631947">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6631950">procs</span>&nbsp;<span class="op" id="6631956">:=</span>&nbsp;<span class="num" id="6631959">4</span>&nbsp;<span class="op" id="6631961">*</span>&nbsp;<span class="ident" id="6631963">runtime</span><span class="op" id="6631970">.</span><span class="ident" id="6631971">GOMAXPROCS</span><span class="op" id="6631981">(</span><span class="op" id="6631982">-</span><span class="num" id="6631983">1</span><span class="op" id="6631984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6631987">send</span>&nbsp;<span class="op" id="6631992">:=</span>&nbsp;<span class="builtintype" id="6631995">int32</span><span class="op" id="6632000">(</span><span class="ident" id="6632001">b</span><span class="op" id="6632002">.</span><span class="ident" id="6632003">N</span><span class="op" id="6632004">)</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6632007">recv</span>&nbsp;<span class="op" id="6632012">:=</span>&nbsp;<span class="builtintype" id="6632015">int32</span><span class="op" id="6632020">(</span><span class="ident" id="6632021">b</span><span class="op" id="6632022">.</span><span class="ident" id="6632023">N</span><span class="op" id="6632024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6632027">var</span>&nbsp;<span class="ident" id="6632031">wg</span>&nbsp;<span class="ident" id="6632034">sync</span><span class="op" id="6632038">.</span><span class="ident" id="6632039">WaitGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6632050">wg</span><span class="op" id="6632052">.</span><span class="ident" id="6632053">Add</span><span class="op" id="6632056">(</span><span class="ident" id="6632057">procs</span><span class="op" id="6632062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6632065">gate</span>&nbsp;<span class="op" id="6632070">:=</span>&nbsp;<span class="builtinfunc" id="6632073">make</span><span class="op" id="6632077">(</span><span class="keyword" id="6632078">chan</span>&nbsp;<span class="builtintype" id="6632083">bool</span><span class="op" id="6632087">,</span>&nbsp;<span class="ident" id="6632089">MaxConcurrentCalls</span><span class="op" id="6632107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6632110">res</span>&nbsp;<span class="op" id="6632114">:=</span>&nbsp;<span class="builtinfunc" id="6632117">make</span><span class="op" id="6632121">(</span><span class="keyword" id="6632122">chan</span>&nbsp;<span class="op" id="6632127">*</span><span class="ident" id="6632128">Call</span><span class="op" id="6632132">,</span>&nbsp;<span class="ident" id="6632134">MaxConcurrentCalls</span><span class="op" id="6632152">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6632155">b</span><span class="op" id="6632156">.</span><span class="ident" id="6632157">ResetTimer</span><span class="op" id="6632167">(</span><span class="op" id="6632168">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6632172">for</span>&nbsp;<span class="ident" id="6632176">p</span>&nbsp;<span class="op" id="6632178">:=</span>&nbsp;<span class="num" id="6632181">0</span><span class="op" id="6632182">;</span>&nbsp;<span class="ident" id="6632184">p</span>&nbsp;<span class="op" id="6632186">&lt;</span>&nbsp;<span class="ident" id="6632188">procs</span><span class="op" id="6632193">;</span>&nbsp;<span class="ident" id="6632195">p</span><span class="op" id="6632196">++</span>&nbsp;<span class="op" id="6632199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6632203">go</span>&nbsp;<span class="keyword" id="6632206">func</span><span class="op" id="6632210">(</span><span class="op" id="6632211">)</span>&nbsp;<span class="op" id="6632213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6632218">for</span>&nbsp;<span class="ident" id="6632222">atomic</span><span class="op" id="6632228">.</span><span class="ident" id="6632229">AddInt32</span><span class="op" id="6632237">(</span><span class="op" id="6632238">&amp;</span><span class="ident" id="6632239">send</span><span class="op" id="6632243">,</span>&nbsp;<span class="op" id="6632245">-</span><span class="num" id="6632246">1</span><span class="op" id="6632247">)</span>&nbsp;<span class="op" id="6632249">&gt;=</span>&nbsp;<span class="num" id="6632252">0</span>&nbsp;<span class="op" id="6632254">{</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6632260">gate</span>&nbsp;<span class="op" id="6632265">&lt;-</span>&nbsp;<span class="builtintype" id="6632268">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6632277">reply</span>&nbsp;<span class="op" id="6632283">:=</span>&nbsp;<span class="builtinfunc" id="6632286">new</span><span class="op" id="6632289">(</span><span class="ident" id="6632290">Reply</span><span class="op" id="6632295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6632301">client</span><span class="op" id="6632307">.</span><span class="ident" id="6632308">Go</span><span class="op" id="6632310">(</span><span class="string" id="6632311">&#34;Arith.Add&#34;</span><span class="op" id="6632322">,</span>&nbsp;<span class="ident" id="6632324">args</span><span class="op" id="6632328">,</span>&nbsp;<span class="ident" id="6632330">reply</span><span class="op" id="6632335">,</span>&nbsp;<span class="ident" id="6632337">res</span><span class="op" id="6632340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6632345">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6632349">}</span><span class="op" id="6632350">(</span><span class="op" id="6632351">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6632355">go</span>&nbsp;<span class="keyword" id="6632358">func</span><span class="op" id="6632362">(</span><span class="op" id="6632363">)</span>&nbsp;<span class="op" id="6632365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6632370">for</span>&nbsp;<span class="ident" id="6632374">call</span>&nbsp;<span class="op" id="6632379">:=</span>&nbsp;<span class="keyword" id="6632382">range</span>&nbsp;<span class="ident" id="6632388">res</span>&nbsp;<span class="op" id="6632392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6632398">A</span>&nbsp;<span class="op" id="6632400">:=</span>&nbsp;<span class="ident" id="6632403">call</span><span class="op" id="6632407">.</span><span class="ident" id="6632408">Args</span><span class="op" id="6632412">.</span><span class="op" id="6632413">(</span><span class="op" id="6632414">*</span><span class="ident" id="6632415">Args</span><span class="op" id="6632419">)</span><span class="op" id="6632420">.</span><span class="ident" id="6632421">A</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6632427">B</span>&nbsp;<span class="op" id="6632429">:=</span>&nbsp;<span class="ident" id="6632432">call</span><span class="op" id="6632436">.</span><span class="ident" id="6632437">Args</span><span class="op" id="6632441">.</span><span class="op" id="6632442">(</span><span class="op" id="6632443">*</span><span class="ident" id="6632444">Args</span><span class="op" id="6632448">)</span><span class="op" id="6632449">.</span><span class="ident" id="6632450">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6632456">C</span>&nbsp;<span class="op" id="6632458">:=</span>&nbsp;<span class="ident" id="6632461">call</span><span class="op" id="6632465">.</span><span class="ident" id="6632466">Reply</span><span class="op" id="6632471">.</span><span class="op" id="6632472">(</span><span class="op" id="6632473">*</span><span class="ident" id="6632474">Reply</span><span class="op" id="6632479">)</span><span class="op" id="6632480">.</span><span class="ident" id="6632481">C</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6632487">if</span>&nbsp;<span class="ident" id="6632490">A</span><span class="op" id="6632491">+</span><span class="ident" id="6632492">B</span>&nbsp;<span class="op" id="6632494">!=</span>&nbsp;<span class="ident" id="6632497">C</span>&nbsp;<span class="op" id="6632499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6632506">b</span><span class="op" id="6632507">.</span><span class="ident" id="6632508">Fatalf</span><span class="op" id="6632514">(</span><span class="string" id="6632515">&#34;incorrect&nbsp;reply:&nbsp;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6632557">,</span>&nbsp;<span class="ident" id="6632559">A</span><span class="op" id="6632560">+</span><span class="ident" id="6632561">B</span><span class="op" id="6632562">,</span>&nbsp;<span class="ident" id="6632564">C</span><span class="op" id="6632565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6632571">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6632577">&lt;-</span><span class="ident" id="6632579">gate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6632588">if</span>&nbsp;<span class="ident" id="6632591">atomic</span><span class="op" id="6632597">.</span><span class="ident" id="6632598">AddInt32</span><span class="op" id="6632606">(</span><span class="op" id="6632607">&amp;</span><span class="ident" id="6632608">recv</span><span class="op" id="6632612">,</span>&nbsp;<span class="op" id="6632614">-</span><span class="num" id="6632615">1</span><span class="op" id="6632616">)</span>&nbsp;<span class="op" id="6632618">==</span>&nbsp;<span class="num" id="6632621">0</span>&nbsp;<span class="op" id="6632623">{</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6632630">close</span><span class="op" id="6632635">(</span><span class="ident" id="6632636">res</span><span class="op" id="6632639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6632645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6632650">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6632655">wg</span><span class="op" id="6632657">.</span><span class="ident" id="6632658">Done</span><span class="op" id="6632662">(</span><span class="op" id="6632663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6632667">}</span><span class="op" id="6632668">(</span><span class="op" id="6632669">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6632672">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6632675">wg</span><span class="op" id="6632677">.</span><span class="ident" id="6632678">Wait</span><span class="op" id="6632682">(</span><span class="op" id="6632683">)</span><br>
<span class="lineno"></span><span class="op" id="6632685">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6632688">func</span>&nbsp;<span class="ident" id="6632693">BenchmarkEndToEnd</span><span class="op" id="6632710">(</span><span class="ident" id="6632711">b</span>&nbsp;<span class="op" id="6632713">*</span><span class="ident" id="6632714">testing</span><span class="op" id="6632721">.</span><span class="ident" id="6632722">B</span><span class="op" id="6632723">)</span>&nbsp;<span class="op" id="6632725">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6632728">benchmarkEndToEnd</span><span class="op" id="6632745">(</span><span class="ident" id="6632746">dialDirect</span><span class="op" id="6632756">,</span>&nbsp;<span class="ident" id="6632758">b</span><span class="op" id="6632759">)</span><br>
<span class="lineno"></span><span class="op" id="6632761">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6632764">func</span>&nbsp;<span class="ident" id="6632769">BenchmarkEndToEndHTTP</span><span class="op" id="6632790">(</span><span class="ident" id="6632791">b</span>&nbsp;<span class="op" id="6632793">*</span><span class="ident" id="6632794">testing</span><span class="op" id="6632801">.</span><span class="ident" id="6632802">B</span><span class="op" id="6632803">)</span>&nbsp;<span class="op" id="6632805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6632808">benchmarkEndToEnd</span><span class="op" id="6632825">(</span><span class="ident" id="6632826">dialHTTP</span><span class="op" id="6632834">,</span>&nbsp;<span class="ident" id="6632836">b</span><span class="op" id="6632837">)</span><br>
<span class="lineno">675</span><span class="op" id="6632839">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6632842">func</span>&nbsp;<span class="ident" id="6632847">BenchmarkEndToEndAsync</span><span class="op" id="6632869">(</span><span class="ident" id="6632870">b</span>&nbsp;<span class="op" id="6632872">*</span><span class="ident" id="6632873">testing</span><span class="op" id="6632880">.</span><span class="ident" id="6632881">B</span><span class="op" id="6632882">)</span>&nbsp;<span class="op" id="6632884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6632887">benchmarkEndToEndAsync</span><span class="op" id="6632909">(</span><span class="ident" id="6632910">dialDirect</span><span class="op" id="6632920">,</span>&nbsp;<span class="ident" id="6632922">b</span><span class="op" id="6632923">)</span><br>
<span class="lineno"></span><span class="op" id="6632925">}</span><br>
<span class="lineno">680</span><br>
<span class="lineno"></span><span class="keyword" id="6632928">func</span>&nbsp;<span class="ident" id="6632933">BenchmarkEndToEndAsyncHTTP</span><span class="op" id="6632959">(</span><span class="ident" id="6632960">b</span>&nbsp;<span class="op" id="6632962">*</span><span class="ident" id="6632963">testing</span><span class="op" id="6632970">.</span><span class="ident" id="6632971">B</span><span class="op" id="6632972">)</span>&nbsp;<span class="op" id="6632974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6632977">benchmarkEndToEndAsync</span><span class="op" id="6632999">(</span><span class="ident" id="6633000">dialHTTP</span><span class="op" id="6633008">,</span>&nbsp;<span class="ident" id="6633010">b</span><span class="op" id="6633011">)</span><br>
<span class="lineno"></span><span class="op" id="6633013">}</span>
</div>
</body>
</html>
