<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="7412075">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7412130">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7412184">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7412235">package</span>&nbsp;<span class="ident" id="7412243">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7412248">import</span>&nbsp;<span class="op" id="7412255">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7412258">&#34;math/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7412271">&#34;testing&#34;</span><br>
<span class="lineno">10</span><span class="op" id="7412281">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7412284">func</span>&nbsp;<span class="ident" id="7412289">checkDistribution</span><span class="op" id="7412306">(</span><span class="ident" id="7412307">t</span>&nbsp;<span class="op" id="7412309">*</span><span class="ident" id="7412310">testing</span><span class="op" id="7412317">.</span><span class="ident" id="7412318">T</span><span class="op" id="7412319">,</span>&nbsp;<span class="ident" id="7412321">data</span>&nbsp;<span class="op" id="7412326">[</span><span class="op" id="7412327">]</span><span class="op" id="7412328">*</span><span class="ident" id="7412329">SRV</span><span class="op" id="7412332">,</span>&nbsp;<span class="ident" id="7412334">margin</span>&nbsp;<span class="builtintype" id="7412341">float64</span><span class="op" id="7412348">)</span>&nbsp;<span class="op" id="7412350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7412353">sum</span>&nbsp;<span class="op" id="7412357">:=</span>&nbsp;<span class="num" id="7412360">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7412363">for</span>&nbsp;<span class="ident" id="7412367">_</span><span class="op" id="7412368">,</span>&nbsp;<span class="ident" id="7412370">srv</span>&nbsp;<span class="op" id="7412374">:=</span>&nbsp;<span class="keyword" id="7412377">range</span>&nbsp;<span class="ident" id="7412383">data</span>&nbsp;<span class="op" id="7412388">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7412392">sum</span>&nbsp;<span class="op" id="7412396">+=</span>&nbsp;<span class="builtintype" id="7412399">int</span><span class="op" id="7412402">(</span><span class="ident" id="7412403">srv</span><span class="op" id="7412406">.</span><span class="ident" id="7412407">Weight</span><span class="op" id="7412413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7412416">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7412420">results</span>&nbsp;<span class="op" id="7412428">:=</span>&nbsp;<span class="builtinfunc" id="7412431">make</span><span class="op" id="7412435">(</span><span class="keyword" id="7412436">map</span><span class="op" id="7412439">[</span><span class="builtintype" id="7412440">string</span><span class="op" id="7412446">]</span><span class="builtintype" id="7412447">int</span><span class="op" id="7412450">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7412454">count</span>&nbsp;<span class="op" id="7412460">:=</span>&nbsp;<span class="num" id="7412463">1000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7412469">for</span>&nbsp;<span class="ident" id="7412473">j</span>&nbsp;<span class="op" id="7412475">:=</span>&nbsp;<span class="num" id="7412478">0</span><span class="op" id="7412479">;</span>&nbsp;<span class="ident" id="7412481">j</span>&nbsp;<span class="op" id="7412483">&lt;</span>&nbsp;<span class="ident" id="7412485">count</span><span class="op" id="7412490">;</span>&nbsp;<span class="ident" id="7412492">j</span><span class="op" id="7412493">++</span>&nbsp;<span class="op" id="7412496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7412500">d</span>&nbsp;<span class="op" id="7412502">:=</span>&nbsp;<span class="builtinfunc" id="7412505">make</span><span class="op" id="7412509">(</span><span class="op" id="7412510">[</span><span class="op" id="7412511">]</span><span class="op" id="7412512">*</span><span class="ident" id="7412513">SRV</span><span class="op" id="7412516">,</span>&nbsp;<span class="builtinfunc" id="7412518">len</span><span class="op" id="7412521">(</span><span class="ident" id="7412522">data</span><span class="op" id="7412526">)</span><span class="op" id="7412527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7412531">copy</span><span class="op" id="7412535">(</span><span class="ident" id="7412536">d</span><span class="op" id="7412537">,</span>&nbsp;<span class="ident" id="7412539">data</span><span class="op" id="7412543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7412547">byPriorityWeight</span><span class="op" id="7412563">(</span><span class="ident" id="7412564">d</span><span class="op" id="7412565">)</span><span class="op" id="7412566">.</span><span class="ident" id="7412567">shuffleByWeight</span><span class="op" id="7412582">(</span><span class="op" id="7412583">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7412587">key</span>&nbsp;<span class="op" id="7412591">:=</span>&nbsp;<span class="ident" id="7412594">d</span><span class="op" id="7412595">[</span><span class="num" id="7412596">0</span><span class="op" id="7412597">]</span><span class="op" id="7412598">.</span><span class="ident" id="7412599">Target</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7412608">results</span><span class="op" id="7412615">[</span><span class="ident" id="7412616">key</span><span class="op" id="7412619">]</span>&nbsp;<span class="op" id="7412621">=</span>&nbsp;<span class="ident" id="7412623">results</span><span class="op" id="7412630">[</span><span class="ident" id="7412631">key</span><span class="op" id="7412634">]</span>&nbsp;<span class="op" id="7412636">+</span>&nbsp;<span class="num" id="7412638">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7412641">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7412645">actual</span>&nbsp;<span class="op" id="7412652">:=</span>&nbsp;<span class="ident" id="7412655">results</span><span class="op" id="7412662">[</span><span class="ident" id="7412663">data</span><span class="op" id="7412667">[</span><span class="num" id="7412668">0</span><span class="op" id="7412669">]</span><span class="op" id="7412670">.</span><span class="ident" id="7412671">Target</span><span class="op" id="7412677">]</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7412680">expected</span>&nbsp;<span class="op" id="7412689">:=</span>&nbsp;<span class="builtintype" id="7412692">float64</span><span class="op" id="7412699">(</span><span class="ident" id="7412700">count</span><span class="op" id="7412705">)</span>&nbsp;<span class="op" id="7412707">*</span>&nbsp;<span class="builtintype" id="7412709">float64</span><span class="op" id="7412716">(</span><span class="ident" id="7412717">data</span><span class="op" id="7412721">[</span><span class="num" id="7412722">0</span><span class="op" id="7412723">]</span><span class="op" id="7412724">.</span><span class="ident" id="7412725">Weight</span><span class="op" id="7412731">)</span>&nbsp;<span class="op" id="7412733">/</span>&nbsp;<span class="builtintype" id="7412735">float64</span><span class="op" id="7412742">(</span><span class="ident" id="7412743">sum</span><span class="op" id="7412746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7412749">diff</span>&nbsp;<span class="op" id="7412754">:=</span>&nbsp;<span class="builtintype" id="7412757">float64</span><span class="op" id="7412764">(</span><span class="ident" id="7412765">actual</span><span class="op" id="7412771">)</span>&nbsp;<span class="op" id="7412773">-</span>&nbsp;<span class="ident" id="7412775">expected</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7412785">t</span><span class="op" id="7412786">.</span><span class="ident" id="7412787">Logf</span><span class="op" id="7412791">(</span><span class="string" id="7412792">&#34;actual:&nbsp;%v&nbsp;diff:&nbsp;%v&nbsp;e:&nbsp;%v&nbsp;m:&nbsp;%v&#34;</span><span class="op" id="7412825">,</span>&nbsp;<span class="ident" id="7412827">actual</span><span class="op" id="7412833">,</span>&nbsp;<span class="ident" id="7412835">diff</span><span class="op" id="7412839">,</span>&nbsp;<span class="ident" id="7412841">expected</span><span class="op" id="7412849">,</span>&nbsp;<span class="ident" id="7412851">margin</span><span class="op" id="7412857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7412860">if</span>&nbsp;<span class="ident" id="7412863">diff</span>&nbsp;<span class="op" id="7412868">&lt;</span>&nbsp;<span class="num" id="7412870">0</span>&nbsp;<span class="op" id="7412872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7412876">diff</span>&nbsp;<span class="op" id="7412881">=</span>&nbsp;<span class="op" id="7412883">-</span><span class="ident" id="7412884">diff</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7412890">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7412893">if</span>&nbsp;<span class="ident" id="7412896">diff</span>&nbsp;<span class="op" id="7412901">&gt;</span>&nbsp;<span class="op" id="7412903">(</span><span class="ident" id="7412904">expected</span>&nbsp;<span class="op" id="7412913">*</span>&nbsp;<span class="ident" id="7412915">margin</span><span class="op" id="7412921">)</span>&nbsp;<span class="op" id="7412923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7412927">t</span><span class="op" id="7412928">.</span><span class="ident" id="7412929">Errorf</span><span class="op" id="7412935">(</span><span class="string" id="7412936">&#34;missed&nbsp;target&nbsp;weight:&nbsp;expected&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="7412975">,</span>&nbsp;<span class="ident" id="7412977">expected</span><span class="op" id="7412985">,</span>&nbsp;<span class="ident" id="7412987">actual</span><span class="op" id="7412993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7412996">}</span><br>
<span class="lineno"></span><span class="op" id="7412998">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="7413001">func</span>&nbsp;<span class="ident" id="7413006">testUniformity</span><span class="op" id="7413020">(</span><span class="ident" id="7413021">t</span>&nbsp;<span class="op" id="7413023">*</span><span class="ident" id="7413024">testing</span><span class="op" id="7413031">.</span><span class="ident" id="7413032">T</span><span class="op" id="7413033">,</span>&nbsp;<span class="ident" id="7413035">size</span>&nbsp;<span class="builtintype" id="7413040">int</span><span class="op" id="7413043">,</span>&nbsp;<span class="ident" id="7413045">margin</span>&nbsp;<span class="builtintype" id="7413052">float64</span><span class="op" id="7413059">)</span>&nbsp;<span class="op" id="7413061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7413064">rand</span><span class="op" id="7413068">.</span><span class="ident" id="7413069">Seed</span><span class="op" id="7413073">(</span><span class="num" id="7413074">1</span><span class="op" id="7413075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7413078">data</span>&nbsp;<span class="op" id="7413083">:=</span>&nbsp;<span class="builtinfunc" id="7413086">make</span><span class="op" id="7413090">(</span><span class="op" id="7413091">[</span><span class="op" id="7413092">]</span><span class="op" id="7413093">*</span><span class="ident" id="7413094">SRV</span><span class="op" id="7413097">,</span>&nbsp;<span class="ident" id="7413099">size</span><span class="op" id="7413103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7413106">for</span>&nbsp;<span class="ident" id="7413110">i</span>&nbsp;<span class="op" id="7413112">:=</span>&nbsp;<span class="num" id="7413115">0</span><span class="op" id="7413116">;</span>&nbsp;<span class="ident" id="7413118">i</span>&nbsp;<span class="op" id="7413120">&lt;</span>&nbsp;<span class="ident" id="7413122">size</span><span class="op" id="7413126">;</span>&nbsp;<span class="ident" id="7413128">i</span><span class="op" id="7413129">++</span>&nbsp;<span class="op" id="7413132">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7413136">data</span><span class="op" id="7413140">[</span><span class="ident" id="7413141">i</span><span class="op" id="7413142">]</span>&nbsp;<span class="op" id="7413144">=</span>&nbsp;<span class="op" id="7413146">&amp;</span><span class="ident" id="7413147">SRV</span><span class="op" id="7413150">{</span><span class="ident" id="7413151">Target</span><span class="op" id="7413157">:</span>&nbsp;<span class="builtintype" id="7413159">string</span><span class="op" id="7413165">(</span><span class="string" id="7413166">&#39;a&#39;</span>&nbsp;<span class="op" id="7413170">+</span>&nbsp;<span class="ident" id="7413172">i</span><span class="op" id="7413173">)</span><span class="op" id="7413174">,</span>&nbsp;<span class="ident" id="7413176">Weight</span><span class="op" id="7413182">:</span>&nbsp;<span class="num" id="7413184">1</span><span class="op" id="7413185">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7413188">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7413191">checkDistribution</span><span class="op" id="7413208">(</span><span class="ident" id="7413209">t</span><span class="op" id="7413210">,</span>&nbsp;<span class="ident" id="7413212">data</span><span class="op" id="7413216">,</span>&nbsp;<span class="ident" id="7413218">margin</span><span class="op" id="7413224">)</span><br>
<span class="lineno"></span><span class="op" id="7413226">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="keyword" id="7413229">func</span>&nbsp;<span class="ident" id="7413234">TestUniformity</span><span class="op" id="7413248">(</span><span class="ident" id="7413249">t</span>&nbsp;<span class="op" id="7413251">*</span><span class="ident" id="7413252">testing</span><span class="op" id="7413259">.</span><span class="ident" id="7413260">T</span><span class="op" id="7413261">)</span>&nbsp;<span class="op" id="7413263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7413266">testUniformity</span><span class="op" id="7413280">(</span><span class="ident" id="7413281">t</span><span class="op" id="7413282">,</span>&nbsp;<span class="num" id="7413284">2</span><span class="op" id="7413285">,</span>&nbsp;<span class="num" id="7413287">0.05</span><span class="op" id="7413291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7413294">testUniformity</span><span class="op" id="7413308">(</span><span class="ident" id="7413309">t</span><span class="op" id="7413310">,</span>&nbsp;<span class="num" id="7413312">3</span><span class="op" id="7413313">,</span>&nbsp;<span class="num" id="7413315">0.10</span><span class="op" id="7413319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7413322">testUniformity</span><span class="op" id="7413336">(</span><span class="ident" id="7413337">t</span><span class="op" id="7413338">,</span>&nbsp;<span class="num" id="7413340">10</span><span class="op" id="7413342">,</span>&nbsp;<span class="num" id="7413344">0.20</span><span class="op" id="7413348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7413351">testWeighting</span><span class="op" id="7413364">(</span><span class="ident" id="7413365">t</span><span class="op" id="7413366">,</span>&nbsp;<span class="num" id="7413368">0.05</span><span class="op" id="7413372">)</span><br>
<span class="lineno">55</span><span class="op" id="7413374">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7413377">func</span>&nbsp;<span class="ident" id="7413382">testWeighting</span><span class="op" id="7413395">(</span><span class="ident" id="7413396">t</span>&nbsp;<span class="op" id="7413398">*</span><span class="ident" id="7413399">testing</span><span class="op" id="7413406">.</span><span class="ident" id="7413407">T</span><span class="op" id="7413408">,</span>&nbsp;<span class="ident" id="7413410">margin</span>&nbsp;<span class="builtintype" id="7413417">float64</span><span class="op" id="7413424">)</span>&nbsp;<span class="op" id="7413426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7413429">rand</span><span class="op" id="7413433">.</span><span class="ident" id="7413434">Seed</span><span class="op" id="7413438">(</span><span class="num" id="7413439">1</span><span class="op" id="7413440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7413443">data</span>&nbsp;<span class="op" id="7413448">:=</span>&nbsp;<span class="op" id="7413451">[</span><span class="op" id="7413452">]</span><span class="op" id="7413453">*</span><span class="ident" id="7413454">SRV</span><span class="op" id="7413457">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7413461">{</span><span class="ident" id="7413462">Target</span><span class="op" id="7413468">:</span>&nbsp;<span class="string" id="7413470">&#34;a&#34;</span><span class="op" id="7413473">,</span>&nbsp;<span class="ident" id="7413475">Weight</span><span class="op" id="7413481">:</span>&nbsp;<span class="num" id="7413483">60</span><span class="op" id="7413485">}</span><span class="op" id="7413486">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7413490">{</span><span class="ident" id="7413491">Target</span><span class="op" id="7413497">:</span>&nbsp;<span class="string" id="7413499">&#34;b&#34;</span><span class="op" id="7413502">,</span>&nbsp;<span class="ident" id="7413504">Weight</span><span class="op" id="7413510">:</span>&nbsp;<span class="num" id="7413512">30</span><span class="op" id="7413514">}</span><span class="op" id="7413515">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7413519">{</span><span class="ident" id="7413520">Target</span><span class="op" id="7413526">:</span>&nbsp;<span class="string" id="7413528">&#34;c&#34;</span><span class="op" id="7413531">,</span>&nbsp;<span class="ident" id="7413533">Weight</span><span class="op" id="7413539">:</span>&nbsp;<span class="num" id="7413541">10</span><span class="op" id="7413543">}</span><span class="op" id="7413544">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7413547">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7413550">checkDistribution</span><span class="op" id="7413567">(</span><span class="ident" id="7413568">t</span><span class="op" id="7413569">,</span>&nbsp;<span class="ident" id="7413571">data</span><span class="op" id="7413575">,</span>&nbsp;<span class="ident" id="7413577">margin</span><span class="op" id="7413583">)</span><br>
<span class="lineno">65</span><span class="op" id="7413585">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7413588">func</span>&nbsp;<span class="ident" id="7413593">TestWeighting</span><span class="op" id="7413606">(</span><span class="ident" id="7413607">t</span>&nbsp;<span class="op" id="7413609">*</span><span class="ident" id="7413610">testing</span><span class="op" id="7413617">.</span><span class="ident" id="7413618">T</span><span class="op" id="7413619">)</span>&nbsp;<span class="op" id="7413621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7413624">testWeighting</span><span class="op" id="7413637">(</span><span class="ident" id="7413638">t</span><span class="op" id="7413639">,</span>&nbsp;<span class="num" id="7413641">0.05</span><span class="op" id="7413645">)</span><br>
<span class="lineno"></span><span class="op" id="7413647">}</span>
</div>
</body>
</html>
