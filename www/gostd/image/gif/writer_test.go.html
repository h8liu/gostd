<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/gif</h2>
<ul>
<li><a href="/gostd/image/gif/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/gif/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/gif/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/gif/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7121921">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7121976">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7122030">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7122081">package</span>&nbsp;<span class="ident" id="7122089">gif</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7122094">import</span>&nbsp;<span class="op" id="7122101">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7122104">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7122113">&#34;image&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7122122">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7122137">_</span>&nbsp;<span class="string" id="7122139">&#34;image/png&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7122152">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7122165">&#34;math/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7122178">&#34;os&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7122184">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7122194">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7122197">func</span>&nbsp;<span class="ident" id="7122202">readImg</span><span class="op" id="7122209">(</span><span class="ident" id="7122210">filename</span>&nbsp;<span class="builtintype" id="7122219">string</span><span class="op" id="7122225">)</span>&nbsp;<span class="op" id="7122227">(</span><span class="ident" id="7122228">image</span><span class="op" id="7122233">.</span><span class="ident" id="7122234">Image</span><span class="op" id="7122239">,</span>&nbsp;<span class="builtintype" id="7122241">error</span><span class="op" id="7122246">)</span>&nbsp;<span class="op" id="7122248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7122251">f</span><span class="op" id="7122252">,</span>&nbsp;<span class="ident" id="7122254">err</span>&nbsp;<span class="op" id="7122258">:=</span>&nbsp;<span class="ident" id="7122261">os</span><span class="op" id="7122263">.</span><span class="ident" id="7122264">Open</span><span class="op" id="7122268">(</span><span class="ident" id="7122269">filename</span><span class="op" id="7122277">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7122280">if</span>&nbsp;<span class="ident" id="7122283">err</span>&nbsp;<span class="op" id="7122287">!=</span>&nbsp;<span class="ident" id="7122290">nil</span>&nbsp;<span class="op" id="7122294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7122298">return</span>&nbsp;<span class="ident" id="7122305">nil</span><span class="op" id="7122308">,</span>&nbsp;<span class="ident" id="7122310">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7122315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7122318">defer</span>&nbsp;<span class="ident" id="7122324">f</span><span class="op" id="7122325">.</span><span class="ident" id="7122326">Close</span><span class="op" id="7122331">(</span><span class="op" id="7122332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7122335">m</span><span class="op" id="7122336">,</span>&nbsp;<span class="ident" id="7122338">_</span><span class="op" id="7122339">,</span>&nbsp;<span class="ident" id="7122341">err</span>&nbsp;<span class="op" id="7122345">:=</span>&nbsp;<span class="ident" id="7122348">image</span><span class="op" id="7122353">.</span><span class="ident" id="7122354">Decode</span><span class="op" id="7122360">(</span><span class="ident" id="7122361">f</span><span class="op" id="7122362">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7122365">return</span>&nbsp;<span class="ident" id="7122372">m</span><span class="op" id="7122373">,</span>&nbsp;<span class="ident" id="7122375">err</span><br>
<span class="lineno"></span><span class="op" id="7122379">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7122382">func</span>&nbsp;<span class="ident" id="7122387">readGIF</span><span class="op" id="7122394">(</span><span class="ident" id="7122395">filename</span>&nbsp;<span class="builtintype" id="7122404">string</span><span class="op" id="7122410">)</span>&nbsp;<span class="op" id="7122412">(</span><span class="op" id="7122413">*</span><span class="ident" id="7122414">GIF</span><span class="op" id="7122417">,</span>&nbsp;<span class="builtintype" id="7122419">error</span><span class="op" id="7122424">)</span>&nbsp;<span class="op" id="7122426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7122429">f</span><span class="op" id="7122430">,</span>&nbsp;<span class="ident" id="7122432">err</span>&nbsp;<span class="op" id="7122436">:=</span>&nbsp;<span class="ident" id="7122439">os</span><span class="op" id="7122441">.</span><span class="ident" id="7122442">Open</span><span class="op" id="7122446">(</span><span class="ident" id="7122447">filename</span><span class="op" id="7122455">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7122458">if</span>&nbsp;<span class="ident" id="7122461">err</span>&nbsp;<span class="op" id="7122465">!=</span>&nbsp;<span class="ident" id="7122468">nil</span>&nbsp;<span class="op" id="7122472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7122476">return</span>&nbsp;<span class="ident" id="7122483">nil</span><span class="op" id="7122486">,</span>&nbsp;<span class="ident" id="7122488">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7122493">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7122496">defer</span>&nbsp;<span class="ident" id="7122502">f</span><span class="op" id="7122503">.</span><span class="ident" id="7122504">Close</span><span class="op" id="7122509">(</span><span class="op" id="7122510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7122513">return</span>&nbsp;<span class="ident" id="7122520">DecodeAll</span><span class="op" id="7122529">(</span><span class="ident" id="7122530">f</span><span class="op" id="7122531">)</span><br>
<span class="lineno">35</span><span class="op" id="7122533">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7122536">func</span>&nbsp;<span class="ident" id="7122541">delta</span><span class="op" id="7122546">(</span><span class="ident" id="7122547">u0</span><span class="op" id="7122549">,</span>&nbsp;<span class="ident" id="7122551">u1</span>&nbsp;<span class="builtintype" id="7122554">uint32</span><span class="op" id="7122560">)</span>&nbsp;<span class="ident" id="7122562">int64</span>&nbsp;<span class="op" id="7122568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7122571">d</span>&nbsp;<span class="op" id="7122573">:=</span>&nbsp;<span class="ident" id="7122576">int64</span><span class="op" id="7122581">(</span><span class="ident" id="7122582">u0</span><span class="op" id="7122584">)</span>&nbsp;<span class="op" id="7122586">-</span>&nbsp;<span class="ident" id="7122588">int64</span><span class="op" id="7122593">(</span><span class="ident" id="7122594">u1</span><span class="op" id="7122596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7122599">if</span>&nbsp;<span class="ident" id="7122602">d</span>&nbsp;<span class="op" id="7122604">&lt;</span>&nbsp;<span class="num" id="7122606">0</span>&nbsp;<span class="op" id="7122608">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7122612">return</span>&nbsp;<span class="op" id="7122619">-</span><span class="ident" id="7122620">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7122623">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7122626">return</span>&nbsp;<span class="ident" id="7122633">d</span><br>
<span class="lineno"></span><span class="op" id="7122635">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="7122638">//&nbsp;averageDelta&nbsp;returns&nbsp;the&nbsp;average&nbsp;delta&nbsp;in&nbsp;RGB&nbsp;space.&nbsp;The&nbsp;two&nbsp;images&nbsp;must</span><br>
<span class="lineno"></span><span class="comment" id="7122714">//&nbsp;have&nbsp;the&nbsp;same&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="7122739">func</span>&nbsp;<span class="ident" id="7122744">averageDelta</span><span class="op" id="7122756">(</span><span class="ident" id="7122757">m0</span><span class="op" id="7122759">,</span>&nbsp;<span class="ident" id="7122761">m1</span>&nbsp;<span class="ident" id="7122764">image</span><span class="op" id="7122769">.</span><span class="ident" id="7122770">Image</span><span class="op" id="7122775">)</span>&nbsp;<span class="ident" id="7122777">int64</span>&nbsp;<span class="op" id="7122783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7122786">b</span>&nbsp;<span class="op" id="7122788">:=</span>&nbsp;<span class="ident" id="7122791">m0</span><span class="op" id="7122793">.</span><span class="ident" id="7122794">Bounds</span><span class="op" id="7122800">(</span><span class="op" id="7122801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7122804">var</span>&nbsp;<span class="ident" id="7122808">sum</span><span class="op" id="7122811">,</span>&nbsp;<span class="ident" id="7122813">n</span>&nbsp;<span class="ident" id="7122815">int64</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7122822">for</span>&nbsp;<span class="ident" id="7122826">y</span>&nbsp;<span class="op" id="7122828">:=</span>&nbsp;<span class="ident" id="7122831">b</span><span class="op" id="7122832">.</span><span class="ident" id="7122833">Min</span><span class="op" id="7122836">.</span><span class="ident" id="7122837">Y</span><span class="op" id="7122838">;</span>&nbsp;<span class="ident" id="7122840">y</span>&nbsp;<span class="op" id="7122842">&lt;</span>&nbsp;<span class="ident" id="7122844">b</span><span class="op" id="7122845">.</span><span class="ident" id="7122846">Max</span><span class="op" id="7122849">.</span><span class="ident" id="7122850">Y</span><span class="op" id="7122851">;</span>&nbsp;<span class="ident" id="7122853">y</span><span class="op" id="7122854">++</span>&nbsp;<span class="op" id="7122857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7122861">for</span>&nbsp;<span class="ident" id="7122865">x</span>&nbsp;<span class="op" id="7122867">:=</span>&nbsp;<span class="ident" id="7122870">b</span><span class="op" id="7122871">.</span><span class="ident" id="7122872">Min</span><span class="op" id="7122875">.</span><span class="ident" id="7122876">X</span><span class="op" id="7122877">;</span>&nbsp;<span class="ident" id="7122879">x</span>&nbsp;<span class="op" id="7122881">&lt;</span>&nbsp;<span class="ident" id="7122883">b</span><span class="op" id="7122884">.</span><span class="ident" id="7122885">Max</span><span class="op" id="7122888">.</span><span class="ident" id="7122889">X</span><span class="op" id="7122890">;</span>&nbsp;<span class="ident" id="7122892">x</span><span class="op" id="7122893">++</span>&nbsp;<span class="op" id="7122896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7122901">c0</span>&nbsp;<span class="op" id="7122904">:=</span>&nbsp;<span class="ident" id="7122907">m0</span><span class="op" id="7122909">.</span><span class="ident" id="7122910">At</span><span class="op" id="7122912">(</span><span class="ident" id="7122913">x</span><span class="op" id="7122914">,</span>&nbsp;<span class="ident" id="7122916">y</span><span class="op" id="7122917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7122922">c1</span>&nbsp;<span class="op" id="7122925">:=</span>&nbsp;<span class="ident" id="7122928">m1</span><span class="op" id="7122930">.</span><span class="ident" id="7122931">At</span><span class="op" id="7122933">(</span><span class="ident" id="7122934">x</span><span class="op" id="7122935">,</span>&nbsp;<span class="ident" id="7122937">y</span><span class="op" id="7122938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7122943">r0</span><span class="op" id="7122945">,</span>&nbsp;<span class="ident" id="7122947">g0</span><span class="op" id="7122949">,</span>&nbsp;<span class="ident" id="7122951">b0</span><span class="op" id="7122953">,</span>&nbsp;<span class="ident" id="7122955">_</span>&nbsp;<span class="op" id="7122957">:=</span>&nbsp;<span class="ident" id="7122960">c0</span><span class="op" id="7122962">.</span><span class="ident" id="7122963">RGBA</span><span class="op" id="7122967">(</span><span class="op" id="7122968">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7122973">r1</span><span class="op" id="7122975">,</span>&nbsp;<span class="ident" id="7122977">g1</span><span class="op" id="7122979">,</span>&nbsp;<span class="ident" id="7122981">b1</span><span class="op" id="7122983">,</span>&nbsp;<span class="ident" id="7122985">_</span>&nbsp;<span class="op" id="7122987">:=</span>&nbsp;<span class="ident" id="7122990">c1</span><span class="op" id="7122992">.</span><span class="ident" id="7122993">RGBA</span><span class="op" id="7122997">(</span><span class="op" id="7122998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7123003">sum</span>&nbsp;<span class="op" id="7123007">+=</span>&nbsp;<span class="ident" id="7123010">delta</span><span class="op" id="7123015">(</span><span class="ident" id="7123016">r0</span><span class="op" id="7123018">,</span>&nbsp;<span class="ident" id="7123020">r1</span><span class="op" id="7123022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7123027">sum</span>&nbsp;<span class="op" id="7123031">+=</span>&nbsp;<span class="ident" id="7123034">delta</span><span class="op" id="7123039">(</span><span class="ident" id="7123040">g0</span><span class="op" id="7123042">,</span>&nbsp;<span class="ident" id="7123044">g1</span><span class="op" id="7123046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7123051">sum</span>&nbsp;<span class="op" id="7123055">+=</span>&nbsp;<span class="ident" id="7123058">delta</span><span class="op" id="7123063">(</span><span class="ident" id="7123064">b0</span><span class="op" id="7123066">,</span>&nbsp;<span class="ident" id="7123068">b1</span><span class="op" id="7123070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7123075">n</span>&nbsp;<span class="op" id="7123077">+=</span>&nbsp;<span class="num" id="7123080">3</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7123084">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7123087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7123090">return</span>&nbsp;<span class="ident" id="7123097">sum</span>&nbsp;<span class="op" id="7123101">/</span>&nbsp;<span class="ident" id="7123103">n</span><br>
<span class="lineno"></span><span class="op" id="7123105">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="keyword" id="7123108">var</span>&nbsp;<span class="ident" id="7123112">testCase</span>&nbsp;<span class="op" id="7123121">=</span>&nbsp;<span class="op" id="7123123">[</span><span class="op" id="7123124">]</span><span class="keyword" id="7123125">struct</span>&nbsp;<span class="op" id="7123132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7123135">filename</span>&nbsp;&nbsp;<span class="builtintype" id="7123145">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7123153">tolerance</span>&nbsp;<span class="ident" id="7123163">int64</span><br>
<span class="lineno"></span><span class="op" id="7123169">}</span><span class="op" id="7123170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7123173">{</span><span class="string" id="7123174">&#34;../testdata/video-001.png&#34;</span><span class="op" id="7123201">,</span>&nbsp;<span class="num" id="7123203">1</span>&nbsp;<span class="op" id="7123205">&lt;&lt;</span>&nbsp;<span class="num" id="7123208">12</span><span class="op" id="7123210">}</span><span class="op" id="7123211">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7123214">{</span><span class="string" id="7123215">&#34;../testdata/video-001.gif&#34;</span><span class="op" id="7123242">,</span>&nbsp;<span class="num" id="7123244">0</span><span class="op" id="7123245">}</span><span class="op" id="7123246">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7123249">{</span><span class="string" id="7123250">&#34;../testdata/video-001.interlaced.gif&#34;</span><span class="op" id="7123288">,</span>&nbsp;<span class="num" id="7123290">0</span><span class="op" id="7123291">}</span><span class="op" id="7123292">,</span><br>
<span class="lineno"></span><span class="op" id="7123294">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7123297">func</span>&nbsp;<span class="ident" id="7123302">TestWriter</span><span class="op" id="7123312">(</span><span class="ident" id="7123313">t</span>&nbsp;<span class="op" id="7123315">*</span><span class="ident" id="7123316">testing</span><span class="op" id="7123323">.</span><span class="ident" id="7123324">T</span><span class="op" id="7123325">)</span>&nbsp;<span class="op" id="7123327">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7123330">for</span>&nbsp;<span class="ident" id="7123334">_</span><span class="op" id="7123335">,</span>&nbsp;<span class="ident" id="7123337">tc</span>&nbsp;<span class="op" id="7123340">:=</span>&nbsp;<span class="keyword" id="7123343">range</span>&nbsp;<span class="ident" id="7123349">testCase</span>&nbsp;<span class="op" id="7123358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7123362">m0</span><span class="op" id="7123364">,</span>&nbsp;<span class="ident" id="7123366">err</span>&nbsp;<span class="op" id="7123370">:=</span>&nbsp;<span class="ident" id="7123373">readImg</span><span class="op" id="7123380">(</span><span class="ident" id="7123381">tc</span><span class="op" id="7123383">.</span><span class="ident" id="7123384">filename</span><span class="op" id="7123392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7123396">if</span>&nbsp;<span class="ident" id="7123399">err</span>&nbsp;<span class="op" id="7123403">!=</span>&nbsp;<span class="ident" id="7123406">nil</span>&nbsp;<span class="op" id="7123410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7123415">t</span><span class="op" id="7123416">.</span><span class="ident" id="7123417">Error</span><span class="op" id="7123422">(</span><span class="ident" id="7123423">tc</span><span class="op" id="7123425">.</span><span class="ident" id="7123426">filename</span><span class="op" id="7123434">,</span>&nbsp;<span class="ident" id="7123436">err</span><span class="op" id="7123439">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7123444">continue</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7123455">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7123459">var</span>&nbsp;<span class="ident" id="7123463">buf</span>&nbsp;<span class="ident" id="7123467">bytes</span><span class="op" id="7123472">.</span><span class="ident" id="7123473">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7123482">err</span>&nbsp;<span class="op" id="7123486">=</span>&nbsp;<span class="ident" id="7123488">Encode</span><span class="op" id="7123494">(</span><span class="op" id="7123495">&amp;</span><span class="ident" id="7123496">buf</span><span class="op" id="7123499">,</span>&nbsp;<span class="ident" id="7123501">m0</span><span class="op" id="7123503">,</span>&nbsp;<span class="ident" id="7123505">nil</span><span class="op" id="7123508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7123512">if</span>&nbsp;<span class="ident" id="7123515">err</span>&nbsp;<span class="op" id="7123519">!=</span>&nbsp;<span class="ident" id="7123522">nil</span>&nbsp;<span class="op" id="7123526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7123531">t</span><span class="op" id="7123532">.</span><span class="ident" id="7123533">Error</span><span class="op" id="7123538">(</span><span class="ident" id="7123539">tc</span><span class="op" id="7123541">.</span><span class="ident" id="7123542">filename</span><span class="op" id="7123550">,</span>&nbsp;<span class="ident" id="7123552">err</span><span class="op" id="7123555">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7123560">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7123571">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7123575">m1</span><span class="op" id="7123577">,</span>&nbsp;<span class="ident" id="7123579">err</span>&nbsp;<span class="op" id="7123583">:=</span>&nbsp;<span class="ident" id="7123586">Decode</span><span class="op" id="7123592">(</span><span class="op" id="7123593">&amp;</span><span class="ident" id="7123594">buf</span><span class="op" id="7123597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7123601">if</span>&nbsp;<span class="ident" id="7123604">err</span>&nbsp;<span class="op" id="7123608">!=</span>&nbsp;<span class="ident" id="7123611">nil</span>&nbsp;<span class="op" id="7123615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7123620">t</span><span class="op" id="7123621">.</span><span class="ident" id="7123622">Error</span><span class="op" id="7123627">(</span><span class="ident" id="7123628">tc</span><span class="op" id="7123630">.</span><span class="ident" id="7123631">filename</span><span class="op" id="7123639">,</span>&nbsp;<span class="ident" id="7123641">err</span><span class="op" id="7123644">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7123649">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7123660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7123664">if</span>&nbsp;<span class="ident" id="7123667">m0</span><span class="op" id="7123669">.</span><span class="ident" id="7123670">Bounds</span><span class="op" id="7123676">(</span><span class="op" id="7123677">)</span>&nbsp;<span class="op" id="7123679">!=</span>&nbsp;<span class="ident" id="7123682">m1</span><span class="op" id="7123684">.</span><span class="ident" id="7123685">Bounds</span><span class="op" id="7123691">(</span><span class="op" id="7123692">)</span>&nbsp;<span class="op" id="7123694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7123699">t</span><span class="op" id="7123700">.</span><span class="ident" id="7123701">Errorf</span><span class="op" id="7123707">(</span><span class="string" id="7123708">&#34;%s,&nbsp;bounds&nbsp;differ:&nbsp;%v&nbsp;and&nbsp;%v&#34;</span><span class="op" id="7123738">,</span>&nbsp;<span class="ident" id="7123740">tc</span><span class="op" id="7123742">.</span><span class="ident" id="7123743">filename</span><span class="op" id="7123751">,</span>&nbsp;<span class="ident" id="7123753">m0</span><span class="op" id="7123755">.</span><span class="ident" id="7123756">Bounds</span><span class="op" id="7123762">(</span><span class="op" id="7123763">)</span><span class="op" id="7123764">,</span>&nbsp;<span class="ident" id="7123766">m1</span><span class="op" id="7123768">.</span><span class="ident" id="7123769">Bounds</span><span class="op" id="7123775">(</span><span class="op" id="7123776">)</span><span class="op" id="7123777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7123782">continue</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7123793">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7123797">//&nbsp;Compare&nbsp;the&nbsp;average&nbsp;delta&nbsp;to&nbsp;the&nbsp;tolerance&nbsp;level.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7123852">avgDelta</span>&nbsp;<span class="op" id="7123861">:=</span>&nbsp;<span class="ident" id="7123864">averageDelta</span><span class="op" id="7123876">(</span><span class="ident" id="7123877">m0</span><span class="op" id="7123879">,</span>&nbsp;<span class="ident" id="7123881">m1</span><span class="op" id="7123883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7123887">if</span>&nbsp;<span class="ident" id="7123890">avgDelta</span>&nbsp;<span class="op" id="7123899">&gt;</span>&nbsp;<span class="ident" id="7123901">tc</span><span class="op" id="7123903">.</span><span class="ident" id="7123904">tolerance</span>&nbsp;<span class="op" id="7123914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7123919">t</span><span class="op" id="7123920">.</span><span class="ident" id="7123921">Errorf</span><span class="op" id="7123927">(</span><span class="string" id="7123928">&#34;%s:&nbsp;average&nbsp;delta&nbsp;is&nbsp;too&nbsp;high.&nbsp;expected:&nbsp;%d,&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7123981">,</span>&nbsp;<span class="ident" id="7123983">tc</span><span class="op" id="7123985">.</span><span class="ident" id="7123986">filename</span><span class="op" id="7123994">,</span>&nbsp;<span class="ident" id="7123996">tc</span><span class="op" id="7123998">.</span><span class="ident" id="7123999">tolerance</span><span class="op" id="7124008">,</span>&nbsp;<span class="ident" id="7124010">avgDelta</span><span class="op" id="7124018">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7124023">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7124034">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7124037">}</span><br>
<span class="lineno"></span><span class="op" id="7124039">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="keyword" id="7124042">func</span>&nbsp;<span class="ident" id="7124047">TestSubImage</span><span class="op" id="7124059">(</span><span class="ident" id="7124060">t</span>&nbsp;<span class="op" id="7124062">*</span><span class="ident" id="7124063">testing</span><span class="op" id="7124070">.</span><span class="ident" id="7124071">T</span><span class="op" id="7124072">)</span>&nbsp;<span class="op" id="7124074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7124077">m0</span><span class="op" id="7124079">,</span>&nbsp;<span class="ident" id="7124081">err</span>&nbsp;<span class="op" id="7124085">:=</span>&nbsp;<span class="ident" id="7124088">readImg</span><span class="op" id="7124095">(</span><span class="string" id="7124096">&#34;../testdata/video-001.gif&#34;</span><span class="op" id="7124123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7124126">if</span>&nbsp;<span class="ident" id="7124129">err</span>&nbsp;<span class="op" id="7124133">!=</span>&nbsp;<span class="ident" id="7124136">nil</span>&nbsp;<span class="op" id="7124140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7124144">t</span><span class="op" id="7124145">.</span><span class="ident" id="7124146">Fatalf</span><span class="op" id="7124152">(</span><span class="string" id="7124153">&#34;readImg:&nbsp;%v&#34;</span><span class="op" id="7124166">,</span>&nbsp;<span class="ident" id="7124168">err</span><span class="op" id="7124171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7124174">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7124177">m0</span>&nbsp;<span class="op" id="7124180">=</span>&nbsp;<span class="ident" id="7124182">m0</span><span class="op" id="7124184">.</span><span class="op" id="7124185">(</span><span class="op" id="7124186">*</span><span class="ident" id="7124187">image</span><span class="op" id="7124192">.</span><span class="ident" id="7124193">Paletted</span><span class="op" id="7124201">)</span><span class="op" id="7124202">.</span><span class="ident" id="7124203">SubImage</span><span class="op" id="7124211">(</span><span class="ident" id="7124212">image</span><span class="op" id="7124217">.</span><span class="ident" id="7124218">Rect</span><span class="op" id="7124222">(</span><span class="num" id="7124223">0</span><span class="op" id="7124224">,</span>&nbsp;<span class="num" id="7124226">0</span><span class="op" id="7124227">,</span>&nbsp;<span class="num" id="7124229">50</span><span class="op" id="7124231">,</span>&nbsp;<span class="num" id="7124233">30</span><span class="op" id="7124235">)</span><span class="op" id="7124236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7124239">var</span>&nbsp;<span class="ident" id="7124243">buf</span>&nbsp;<span class="ident" id="7124247">bytes</span><span class="op" id="7124252">.</span><span class="ident" id="7124253">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7124261">err</span>&nbsp;<span class="op" id="7124265">=</span>&nbsp;<span class="ident" id="7124267">Encode</span><span class="op" id="7124273">(</span><span class="op" id="7124274">&amp;</span><span class="ident" id="7124275">buf</span><span class="op" id="7124278">,</span>&nbsp;<span class="ident" id="7124280">m0</span><span class="op" id="7124282">,</span>&nbsp;<span class="ident" id="7124284">nil</span><span class="op" id="7124287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7124290">if</span>&nbsp;<span class="ident" id="7124293">err</span>&nbsp;<span class="op" id="7124297">!=</span>&nbsp;<span class="ident" id="7124300">nil</span>&nbsp;<span class="op" id="7124304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7124308">t</span><span class="op" id="7124309">.</span><span class="ident" id="7124310">Fatalf</span><span class="op" id="7124316">(</span><span class="string" id="7124317">&#34;Encode:&nbsp;%v&#34;</span><span class="op" id="7124329">,</span>&nbsp;<span class="ident" id="7124331">err</span><span class="op" id="7124334">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7124337">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7124340">m1</span><span class="op" id="7124342">,</span>&nbsp;<span class="ident" id="7124344">err</span>&nbsp;<span class="op" id="7124348">:=</span>&nbsp;<span class="ident" id="7124351">Decode</span><span class="op" id="7124357">(</span><span class="op" id="7124358">&amp;</span><span class="ident" id="7124359">buf</span><span class="op" id="7124362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7124365">if</span>&nbsp;<span class="ident" id="7124368">err</span>&nbsp;<span class="op" id="7124372">!=</span>&nbsp;<span class="ident" id="7124375">nil</span>&nbsp;<span class="op" id="7124379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7124383">t</span><span class="op" id="7124384">.</span><span class="ident" id="7124385">Fatalf</span><span class="op" id="7124391">(</span><span class="string" id="7124392">&#34;Decode:&nbsp;%v&#34;</span><span class="op" id="7124404">,</span>&nbsp;<span class="ident" id="7124406">err</span><span class="op" id="7124409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7124412">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7124415">if</span>&nbsp;<span class="ident" id="7124418">m0</span><span class="op" id="7124420">.</span><span class="ident" id="7124421">Bounds</span><span class="op" id="7124427">(</span><span class="op" id="7124428">)</span>&nbsp;<span class="op" id="7124430">!=</span>&nbsp;<span class="ident" id="7124433">m1</span><span class="op" id="7124435">.</span><span class="ident" id="7124436">Bounds</span><span class="op" id="7124442">(</span><span class="op" id="7124443">)</span>&nbsp;<span class="op" id="7124445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7124449">t</span><span class="op" id="7124450">.</span><span class="ident" id="7124451">Fatalf</span><span class="op" id="7124457">(</span><span class="string" id="7124458">&#34;bounds&nbsp;differ:&nbsp;%v&nbsp;and&nbsp;%v&#34;</span><span class="op" id="7124484">,</span>&nbsp;<span class="ident" id="7124486">m0</span><span class="op" id="7124488">.</span><span class="ident" id="7124489">Bounds</span><span class="op" id="7124495">(</span><span class="op" id="7124496">)</span><span class="op" id="7124497">,</span>&nbsp;<span class="ident" id="7124499">m1</span><span class="op" id="7124501">.</span><span class="ident" id="7124502">Bounds</span><span class="op" id="7124508">(</span><span class="op" id="7124509">)</span><span class="op" id="7124510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7124513">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7124516">if</span>&nbsp;<span class="ident" id="7124519">averageDelta</span><span class="op" id="7124531">(</span><span class="ident" id="7124532">m0</span><span class="op" id="7124534">,</span>&nbsp;<span class="ident" id="7124536">m1</span><span class="op" id="7124538">)</span>&nbsp;<span class="op" id="7124540">!=</span>&nbsp;<span class="num" id="7124543">0</span>&nbsp;<span class="op" id="7124545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7124549">t</span><span class="op" id="7124550">.</span><span class="ident" id="7124551">Fatalf</span><span class="op" id="7124557">(</span><span class="string" id="7124558">&#34;images&nbsp;differ&#34;</span><span class="op" id="7124573">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7124576">}</span><br>
<span class="lineno"></span><span class="op" id="7124578">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7124581">var</span>&nbsp;<span class="ident" id="7124585">frames</span>&nbsp;<span class="op" id="7124592">=</span>&nbsp;<span class="op" id="7124594">[</span><span class="op" id="7124595">]</span><span class="builtintype" id="7124596">string</span><span class="op" id="7124602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7124605">&#34;../testdata/video-001.gif&#34;</span><span class="op" id="7124632">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7124635">&#34;../testdata/video-005.gray.gif&#34;</span><span class="op" id="7124667">,</span><br>
<span class="lineno"></span><span class="op" id="7124669">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7124672">func</span>&nbsp;<span class="ident" id="7124677">TestEncodeAll</span><span class="op" id="7124690">(</span><span class="ident" id="7124691">t</span>&nbsp;<span class="op" id="7124693">*</span><span class="ident" id="7124694">testing</span><span class="op" id="7124701">.</span><span class="ident" id="7124702">T</span><span class="op" id="7124703">)</span>&nbsp;<span class="op" id="7124705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7124708">g0</span>&nbsp;<span class="op" id="7124711">:=</span>&nbsp;<span class="op" id="7124714">&amp;</span><span class="ident" id="7124715">GIF</span><span class="op" id="7124718">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7124722">Image</span><span class="op" id="7124727">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7124733">make</span><span class="op" id="7124737">(</span><span class="op" id="7124738">[</span><span class="op" id="7124739">]</span><span class="op" id="7124740">*</span><span class="ident" id="7124741">image</span><span class="op" id="7124746">.</span><span class="ident" id="7124747">Paletted</span><span class="op" id="7124755">,</span>&nbsp;<span class="builtinfunc" id="7124757">len</span><span class="op" id="7124760">(</span><span class="ident" id="7124761">frames</span><span class="op" id="7124767">)</span><span class="op" id="7124768">)</span><span class="op" id="7124769">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7124773">Delay</span><span class="op" id="7124778">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7124784">make</span><span class="op" id="7124788">(</span><span class="op" id="7124789">[</span><span class="op" id="7124790">]</span><span class="builtintype" id="7124791">int</span><span class="op" id="7124794">,</span>&nbsp;<span class="builtinfunc" id="7124796">len</span><span class="op" id="7124799">(</span><span class="ident" id="7124800">frames</span><span class="op" id="7124806">)</span><span class="op" id="7124807">)</span><span class="op" id="7124808">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7124812">LoopCount</span><span class="op" id="7124821">:</span>&nbsp;<span class="num" id="7124823">5</span><span class="op" id="7124824">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7124827">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7124830">for</span>&nbsp;<span class="ident" id="7124834">i</span><span class="op" id="7124835">,</span>&nbsp;<span class="ident" id="7124837">f</span>&nbsp;<span class="op" id="7124839">:=</span>&nbsp;<span class="keyword" id="7124842">range</span>&nbsp;<span class="ident" id="7124848">frames</span>&nbsp;<span class="op" id="7124855">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7124859">m</span><span class="op" id="7124860">,</span>&nbsp;<span class="ident" id="7124862">err</span>&nbsp;<span class="op" id="7124866">:=</span>&nbsp;<span class="ident" id="7124869">readGIF</span><span class="op" id="7124876">(</span><span class="ident" id="7124877">f</span><span class="op" id="7124878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7124882">if</span>&nbsp;<span class="ident" id="7124885">err</span>&nbsp;<span class="op" id="7124889">!=</span>&nbsp;<span class="ident" id="7124892">nil</span>&nbsp;<span class="op" id="7124896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7124901">t</span><span class="op" id="7124902">.</span><span class="ident" id="7124903">Fatal</span><span class="op" id="7124908">(</span><span class="ident" id="7124909">f</span><span class="op" id="7124910">,</span>&nbsp;<span class="ident" id="7124912">err</span><span class="op" id="7124915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7124919">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7124923">g0</span><span class="op" id="7124925">.</span><span class="ident" id="7124926">Image</span><span class="op" id="7124931">[</span><span class="ident" id="7124932">i</span><span class="op" id="7124933">]</span>&nbsp;<span class="op" id="7124935">=</span>&nbsp;<span class="ident" id="7124937">m</span><span class="op" id="7124938">.</span><span class="ident" id="7124939">Image</span><span class="op" id="7124944">[</span><span class="num" id="7124945">0</span><span class="op" id="7124946">]</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7124949">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7124952">var</span>&nbsp;<span class="ident" id="7124956">buf</span>&nbsp;<span class="ident" id="7124960">bytes</span><span class="op" id="7124965">.</span><span class="ident" id="7124966">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7124974">if</span>&nbsp;<span class="ident" id="7124977">err</span>&nbsp;<span class="op" id="7124981">:=</span>&nbsp;<span class="ident" id="7124984">EncodeAll</span><span class="op" id="7124993">(</span><span class="op" id="7124994">&amp;</span><span class="ident" id="7124995">buf</span><span class="op" id="7124998">,</span>&nbsp;<span class="ident" id="7125000">g0</span><span class="op" id="7125002">)</span><span class="op" id="7125003">;</span>&nbsp;<span class="ident" id="7125005">err</span>&nbsp;<span class="op" id="7125009">!=</span>&nbsp;<span class="ident" id="7125012">nil</span>&nbsp;<span class="op" id="7125016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7125020">t</span><span class="op" id="7125021">.</span><span class="ident" id="7125022">Fatal</span><span class="op" id="7125027">(</span><span class="string" id="7125028">&#34;EncodeAll:&#34;</span><span class="op" id="7125040">,</span>&nbsp;<span class="ident" id="7125042">err</span><span class="op" id="7125045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7125048">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7125051">g1</span><span class="op" id="7125053">,</span>&nbsp;<span class="ident" id="7125055">err</span>&nbsp;<span class="op" id="7125059">:=</span>&nbsp;<span class="ident" id="7125062">DecodeAll</span><span class="op" id="7125071">(</span><span class="op" id="7125072">&amp;</span><span class="ident" id="7125073">buf</span><span class="op" id="7125076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7125079">if</span>&nbsp;<span class="ident" id="7125082">err</span>&nbsp;<span class="op" id="7125086">!=</span>&nbsp;<span class="ident" id="7125089">nil</span>&nbsp;<span class="op" id="7125093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7125097">t</span><span class="op" id="7125098">.</span><span class="ident" id="7125099">Fatal</span><span class="op" id="7125104">(</span><span class="string" id="7125105">&#34;DecodeAll:&#34;</span><span class="op" id="7125117">,</span>&nbsp;<span class="ident" id="7125119">err</span><span class="op" id="7125122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7125125">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7125128">if</span>&nbsp;<span class="ident" id="7125131">g0</span><span class="op" id="7125133">.</span><span class="ident" id="7125134">LoopCount</span>&nbsp;<span class="op" id="7125144">!=</span>&nbsp;<span class="ident" id="7125147">g1</span><span class="op" id="7125149">.</span><span class="ident" id="7125150">LoopCount</span>&nbsp;<span class="op" id="7125160">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7125164">t</span><span class="op" id="7125165">.</span><span class="ident" id="7125166">Errorf</span><span class="op" id="7125172">(</span><span class="string" id="7125173">&#34;loop&nbsp;counts&nbsp;differ:&nbsp;%d&nbsp;and&nbsp;%d&#34;</span><span class="op" id="7125204">,</span>&nbsp;<span class="ident" id="7125206">g0</span><span class="op" id="7125208">.</span><span class="ident" id="7125209">LoopCount</span><span class="op" id="7125218">,</span>&nbsp;<span class="ident" id="7125220">g1</span><span class="op" id="7125222">.</span><span class="ident" id="7125223">LoopCount</span><span class="op" id="7125232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7125235">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7125238">for</span>&nbsp;<span class="ident" id="7125242">i</span>&nbsp;<span class="op" id="7125244">:=</span>&nbsp;<span class="keyword" id="7125247">range</span>&nbsp;<span class="ident" id="7125253">g0</span><span class="op" id="7125255">.</span><span class="ident" id="7125256">Image</span>&nbsp;<span class="op" id="7125262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7125266">m0</span><span class="op" id="7125268">,</span>&nbsp;<span class="ident" id="7125270">m1</span>&nbsp;<span class="op" id="7125273">:=</span>&nbsp;<span class="ident" id="7125276">g0</span><span class="op" id="7125278">.</span><span class="ident" id="7125279">Image</span><span class="op" id="7125284">[</span><span class="ident" id="7125285">i</span><span class="op" id="7125286">]</span><span class="op" id="7125287">,</span>&nbsp;<span class="ident" id="7125289">g1</span><span class="op" id="7125291">.</span><span class="ident" id="7125292">Image</span><span class="op" id="7125297">[</span><span class="ident" id="7125298">i</span><span class="op" id="7125299">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7125303">if</span>&nbsp;<span class="ident" id="7125306">m0</span><span class="op" id="7125308">.</span><span class="ident" id="7125309">Bounds</span><span class="op" id="7125315">(</span><span class="op" id="7125316">)</span>&nbsp;<span class="op" id="7125318">!=</span>&nbsp;<span class="ident" id="7125321">m1</span><span class="op" id="7125323">.</span><span class="ident" id="7125324">Bounds</span><span class="op" id="7125330">(</span><span class="op" id="7125331">)</span>&nbsp;<span class="op" id="7125333">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7125338">t</span><span class="op" id="7125339">.</span><span class="ident" id="7125340">Errorf</span><span class="op" id="7125346">(</span><span class="string" id="7125347">&#34;%s,&nbsp;bounds&nbsp;differ:&nbsp;%v&nbsp;and&nbsp;%v&#34;</span><span class="op" id="7125377">,</span>&nbsp;<span class="ident" id="7125379">frames</span><span class="op" id="7125385">[</span><span class="ident" id="7125386">i</span><span class="op" id="7125387">]</span><span class="op" id="7125388">,</span>&nbsp;<span class="ident" id="7125390">m0</span><span class="op" id="7125392">.</span><span class="ident" id="7125393">Bounds</span><span class="op" id="7125399">(</span><span class="op" id="7125400">)</span><span class="op" id="7125401">,</span>&nbsp;<span class="ident" id="7125403">m1</span><span class="op" id="7125405">.</span><span class="ident" id="7125406">Bounds</span><span class="op" id="7125412">(</span><span class="op" id="7125413">)</span><span class="op" id="7125414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7125418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7125422">d0</span><span class="op" id="7125424">,</span>&nbsp;<span class="ident" id="7125426">d1</span>&nbsp;<span class="op" id="7125429">:=</span>&nbsp;<span class="ident" id="7125432">g0</span><span class="op" id="7125434">.</span><span class="ident" id="7125435">Delay</span><span class="op" id="7125440">[</span><span class="ident" id="7125441">i</span><span class="op" id="7125442">]</span><span class="op" id="7125443">,</span>&nbsp;<span class="ident" id="7125445">g1</span><span class="op" id="7125447">.</span><span class="ident" id="7125448">Delay</span><span class="op" id="7125453">[</span><span class="ident" id="7125454">i</span><span class="op" id="7125455">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7125459">if</span>&nbsp;<span class="ident" id="7125462">d0</span>&nbsp;<span class="op" id="7125465">!=</span>&nbsp;<span class="ident" id="7125468">d1</span>&nbsp;<span class="op" id="7125471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7125476">t</span><span class="op" id="7125477">.</span><span class="ident" id="7125478">Errorf</span><span class="op" id="7125484">(</span><span class="string" id="7125485">&#34;%s:&nbsp;delay&nbsp;values&nbsp;differ:&nbsp;%d&nbsp;and&nbsp;%d&#34;</span><span class="op" id="7125521">,</span>&nbsp;<span class="ident" id="7125523">frames</span><span class="op" id="7125529">[</span><span class="ident" id="7125530">i</span><span class="op" id="7125531">]</span><span class="op" id="7125532">,</span>&nbsp;<span class="ident" id="7125534">d0</span><span class="op" id="7125536">,</span>&nbsp;<span class="ident" id="7125538">d1</span><span class="op" id="7125540">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7125544">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7125547">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7125551">g1</span><span class="op" id="7125553">.</span><span class="ident" id="7125554">Delay</span>&nbsp;<span class="op" id="7125560">=</span>&nbsp;<span class="builtinfunc" id="7125562">make</span><span class="op" id="7125566">(</span><span class="op" id="7125567">[</span><span class="op" id="7125568">]</span><span class="builtintype" id="7125569">int</span><span class="op" id="7125572">,</span>&nbsp;<span class="num" id="7125574">1</span><span class="op" id="7125575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7125578">if</span>&nbsp;<span class="ident" id="7125581">err</span>&nbsp;<span class="op" id="7125585">:=</span>&nbsp;<span class="ident" id="7125588">EncodeAll</span><span class="op" id="7125597">(</span><span class="ident" id="7125598">ioutil</span><span class="op" id="7125604">.</span><span class="ident" id="7125605">Discard</span><span class="op" id="7125612">,</span>&nbsp;<span class="ident" id="7125614">g1</span><span class="op" id="7125616">)</span><span class="op" id="7125617">;</span>&nbsp;<span class="ident" id="7125619">err</span>&nbsp;<span class="op" id="7125623">==</span>&nbsp;<span class="ident" id="7125626">nil</span>&nbsp;<span class="op" id="7125630">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7125634">t</span><span class="op" id="7125635">.</span><span class="ident" id="7125636">Error</span><span class="op" id="7125641">(</span><span class="string" id="7125642">&#34;expected&nbsp;error&nbsp;from&nbsp;mismatched&nbsp;delay&nbsp;and&nbsp;image&nbsp;slice&nbsp;lengths&#34;</span><span class="op" id="7125704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7125707">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7125710">if</span>&nbsp;<span class="ident" id="7125713">err</span>&nbsp;<span class="op" id="7125717">:=</span>&nbsp;<span class="ident" id="7125720">EncodeAll</span><span class="op" id="7125729">(</span><span class="ident" id="7125730">ioutil</span><span class="op" id="7125736">.</span><span class="ident" id="7125737">Discard</span><span class="op" id="7125744">,</span>&nbsp;<span class="op" id="7125746">&amp;</span><span class="ident" id="7125747">GIF</span><span class="op" id="7125750">{</span><span class="op" id="7125751">}</span><span class="op" id="7125752">)</span><span class="op" id="7125753">;</span>&nbsp;<span class="ident" id="7125755">err</span>&nbsp;<span class="op" id="7125759">==</span>&nbsp;<span class="ident" id="7125762">nil</span>&nbsp;<span class="op" id="7125766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7125770">t</span><span class="op" id="7125771">.</span><span class="ident" id="7125772">Error</span><span class="op" id="7125777">(</span><span class="string" id="7125778">&#34;expected&nbsp;error&nbsp;from&nbsp;providing&nbsp;empty&nbsp;gif&#34;</span><span class="op" id="7125819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7125822">}</span><br>
<span class="lineno">175</span><span class="op" id="7125824">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7125827">func</span>&nbsp;<span class="ident" id="7125832">BenchmarkEncode</span><span class="op" id="7125847">(</span><span class="ident" id="7125848">b</span>&nbsp;<span class="op" id="7125850">*</span><span class="ident" id="7125851">testing</span><span class="op" id="7125858">.</span><span class="ident" id="7125859">B</span><span class="op" id="7125860">)</span>&nbsp;<span class="op" id="7125862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7125865">b</span><span class="op" id="7125866">.</span><span class="ident" id="7125867">StopTimer</span><span class="op" id="7125876">(</span><span class="op" id="7125877">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7125881">bo</span>&nbsp;<span class="op" id="7125884">:=</span>&nbsp;<span class="ident" id="7125887">image</span><span class="op" id="7125892">.</span><span class="ident" id="7125893">Rect</span><span class="op" id="7125897">(</span><span class="num" id="7125898">0</span><span class="op" id="7125899">,</span>&nbsp;<span class="num" id="7125901">0</span><span class="op" id="7125902">,</span>&nbsp;<span class="num" id="7125904">640</span><span class="op" id="7125907">,</span>&nbsp;<span class="num" id="7125909">480</span><span class="op" id="7125912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7125915">rnd</span>&nbsp;<span class="op" id="7125919">:=</span>&nbsp;<span class="ident" id="7125922">rand</span><span class="op" id="7125926">.</span><span class="ident" id="7125927">New</span><span class="op" id="7125930">(</span><span class="ident" id="7125931">rand</span><span class="op" id="7125935">.</span><span class="ident" id="7125936">NewSource</span><span class="op" id="7125945">(</span><span class="num" id="7125946">123</span><span class="op" id="7125949">)</span><span class="op" id="7125950">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7125954">//&nbsp;Restrict&nbsp;to&nbsp;a&nbsp;256-color&nbsp;paletted&nbsp;image&nbsp;to&nbsp;avoid&nbsp;quantization&nbsp;path.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7126025">palette</span>&nbsp;<span class="op" id="7126033">:=</span>&nbsp;<span class="builtinfunc" id="7126036">make</span><span class="op" id="7126040">(</span><span class="ident" id="7126041">color</span><span class="op" id="7126046">.</span><span class="ident" id="7126047">Palette</span><span class="op" id="7126054">,</span>&nbsp;<span class="num" id="7126056">256</span><span class="op" id="7126059">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7126062">for</span>&nbsp;<span class="ident" id="7126066">i</span>&nbsp;<span class="op" id="7126068">:=</span>&nbsp;<span class="keyword" id="7126071">range</span>&nbsp;<span class="ident" id="7126077">palette</span>&nbsp;<span class="op" id="7126085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7126089">palette</span><span class="op" id="7126096">[</span><span class="ident" id="7126097">i</span><span class="op" id="7126098">]</span>&nbsp;<span class="op" id="7126100">=</span>&nbsp;<span class="ident" id="7126102">color</span><span class="op" id="7126107">.</span><span class="ident" id="7126108">RGBA</span><span class="op" id="7126112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7126117">uint8</span><span class="op" id="7126122">(</span><span class="ident" id="7126123">rnd</span><span class="op" id="7126126">.</span><span class="ident" id="7126127">Intn</span><span class="op" id="7126131">(</span><span class="num" id="7126132">256</span><span class="op" id="7126135">)</span><span class="op" id="7126136">)</span><span class="op" id="7126137">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7126142">uint8</span><span class="op" id="7126147">(</span><span class="ident" id="7126148">rnd</span><span class="op" id="7126151">.</span><span class="ident" id="7126152">Intn</span><span class="op" id="7126156">(</span><span class="num" id="7126157">256</span><span class="op" id="7126160">)</span><span class="op" id="7126161">)</span><span class="op" id="7126162">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7126167">uint8</span><span class="op" id="7126172">(</span><span class="ident" id="7126173">rnd</span><span class="op" id="7126176">.</span><span class="ident" id="7126177">Intn</span><span class="op" id="7126181">(</span><span class="num" id="7126182">256</span><span class="op" id="7126185">)</span><span class="op" id="7126186">)</span><span class="op" id="7126187">,</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7126192">255</span><span class="op" id="7126195">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7126199">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7126202">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7126205">img</span>&nbsp;<span class="op" id="7126209">:=</span>&nbsp;<span class="ident" id="7126212">image</span><span class="op" id="7126217">.</span><span class="ident" id="7126218">NewPaletted</span><span class="op" id="7126229">(</span><span class="ident" id="7126230">image</span><span class="op" id="7126235">.</span><span class="ident" id="7126236">Rect</span><span class="op" id="7126240">(</span><span class="num" id="7126241">0</span><span class="op" id="7126242">,</span>&nbsp;<span class="num" id="7126244">0</span><span class="op" id="7126245">,</span>&nbsp;<span class="num" id="7126247">640</span><span class="op" id="7126250">,</span>&nbsp;<span class="num" id="7126252">480</span><span class="op" id="7126255">)</span><span class="op" id="7126256">,</span>&nbsp;<span class="ident" id="7126258">palette</span><span class="op" id="7126265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7126268">for</span>&nbsp;<span class="ident" id="7126272">y</span>&nbsp;<span class="op" id="7126274">:=</span>&nbsp;<span class="ident" id="7126277">bo</span><span class="op" id="7126279">.</span><span class="ident" id="7126280">Min</span><span class="op" id="7126283">.</span><span class="ident" id="7126284">Y</span><span class="op" id="7126285">;</span>&nbsp;<span class="ident" id="7126287">y</span>&nbsp;<span class="op" id="7126289">&lt;</span>&nbsp;<span class="ident" id="7126291">bo</span><span class="op" id="7126293">.</span><span class="ident" id="7126294">Max</span><span class="op" id="7126297">.</span><span class="ident" id="7126298">Y</span><span class="op" id="7126299">;</span>&nbsp;<span class="ident" id="7126301">y</span><span class="op" id="7126302">++</span>&nbsp;<span class="op" id="7126305">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7126309">for</span>&nbsp;<span class="ident" id="7126313">x</span>&nbsp;<span class="op" id="7126315">:=</span>&nbsp;<span class="ident" id="7126318">bo</span><span class="op" id="7126320">.</span><span class="ident" id="7126321">Min</span><span class="op" id="7126324">.</span><span class="ident" id="7126325">X</span><span class="op" id="7126326">;</span>&nbsp;<span class="ident" id="7126328">x</span>&nbsp;<span class="op" id="7126330">&lt;</span>&nbsp;<span class="ident" id="7126332">bo</span><span class="op" id="7126334">.</span><span class="ident" id="7126335">Max</span><span class="op" id="7126338">.</span><span class="ident" id="7126339">X</span><span class="op" id="7126340">;</span>&nbsp;<span class="ident" id="7126342">x</span><span class="op" id="7126343">++</span>&nbsp;<span class="op" id="7126346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7126351">img</span><span class="op" id="7126354">.</span><span class="ident" id="7126355">Set</span><span class="op" id="7126358">(</span><span class="ident" id="7126359">x</span><span class="op" id="7126360">,</span>&nbsp;<span class="ident" id="7126362">y</span><span class="op" id="7126363">,</span>&nbsp;<span class="ident" id="7126365">palette</span><span class="op" id="7126372">[</span><span class="ident" id="7126373">rnd</span><span class="op" id="7126376">.</span><span class="ident" id="7126377">Intn</span><span class="op" id="7126381">(</span><span class="num" id="7126382">256</span><span class="op" id="7126385">)</span><span class="op" id="7126386">]</span><span class="op" id="7126387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7126391">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7126394">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7126398">b</span><span class="op" id="7126399">.</span><span class="ident" id="7126400">SetBytes</span><span class="op" id="7126408">(</span><span class="num" id="7126409">640</span>&nbsp;<span class="op" id="7126413">*</span>&nbsp;<span class="num" id="7126415">480</span>&nbsp;<span class="op" id="7126419">*</span>&nbsp;<span class="num" id="7126421">4</span><span class="op" id="7126422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7126425">b</span><span class="op" id="7126426">.</span><span class="ident" id="7126427">StartTimer</span><span class="op" id="7126437">(</span><span class="op" id="7126438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7126441">for</span>&nbsp;<span class="ident" id="7126445">i</span>&nbsp;<span class="op" id="7126447">:=</span>&nbsp;<span class="num" id="7126450">0</span><span class="op" id="7126451">;</span>&nbsp;<span class="ident" id="7126453">i</span>&nbsp;<span class="op" id="7126455">&lt;</span>&nbsp;<span class="ident" id="7126457">b</span><span class="op" id="7126458">.</span><span class="ident" id="7126459">N</span><span class="op" id="7126460">;</span>&nbsp;<span class="ident" id="7126462">i</span><span class="op" id="7126463">++</span>&nbsp;<span class="op" id="7126466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7126470">Encode</span><span class="op" id="7126476">(</span><span class="ident" id="7126477">ioutil</span><span class="op" id="7126483">.</span><span class="ident" id="7126484">Discard</span><span class="op" id="7126491">,</span>&nbsp;<span class="ident" id="7126493">img</span><span class="op" id="7126496">,</span>&nbsp;<span class="ident" id="7126498">nil</span><span class="op" id="7126501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7126504">}</span><br>
<span class="lineno">205</span><span class="op" id="7126506">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7126509">func</span>&nbsp;<span class="ident" id="7126514">BenchmarkQuantizedEncode</span><span class="op" id="7126538">(</span><span class="ident" id="7126539">b</span>&nbsp;<span class="op" id="7126541">*</span><span class="ident" id="7126542">testing</span><span class="op" id="7126549">.</span><span class="ident" id="7126550">B</span><span class="op" id="7126551">)</span>&nbsp;<span class="op" id="7126553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7126556">b</span><span class="op" id="7126557">.</span><span class="ident" id="7126558">StopTimer</span><span class="op" id="7126567">(</span><span class="op" id="7126568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7126571">img</span>&nbsp;<span class="op" id="7126575">:=</span>&nbsp;<span class="ident" id="7126578">image</span><span class="op" id="7126583">.</span><span class="ident" id="7126584">NewRGBA</span><span class="op" id="7126591">(</span><span class="ident" id="7126592">image</span><span class="op" id="7126597">.</span><span class="ident" id="7126598">Rect</span><span class="op" id="7126602">(</span><span class="num" id="7126603">0</span><span class="op" id="7126604">,</span>&nbsp;<span class="num" id="7126606">0</span><span class="op" id="7126607">,</span>&nbsp;<span class="num" id="7126609">640</span><span class="op" id="7126612">,</span>&nbsp;<span class="num" id="7126614">480</span><span class="op" id="7126617">)</span><span class="op" id="7126618">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7126621">bo</span>&nbsp;<span class="op" id="7126624">:=</span>&nbsp;<span class="ident" id="7126627">img</span><span class="op" id="7126630">.</span><span class="ident" id="7126631">Bounds</span><span class="op" id="7126637">(</span><span class="op" id="7126638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7126641">rnd</span>&nbsp;<span class="op" id="7126645">:=</span>&nbsp;<span class="ident" id="7126648">rand</span><span class="op" id="7126652">.</span><span class="ident" id="7126653">New</span><span class="op" id="7126656">(</span><span class="ident" id="7126657">rand</span><span class="op" id="7126661">.</span><span class="ident" id="7126662">NewSource</span><span class="op" id="7126671">(</span><span class="num" id="7126672">123</span><span class="op" id="7126675">)</span><span class="op" id="7126676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7126679">for</span>&nbsp;<span class="ident" id="7126683">y</span>&nbsp;<span class="op" id="7126685">:=</span>&nbsp;<span class="ident" id="7126688">bo</span><span class="op" id="7126690">.</span><span class="ident" id="7126691">Min</span><span class="op" id="7126694">.</span><span class="ident" id="7126695">Y</span><span class="op" id="7126696">;</span>&nbsp;<span class="ident" id="7126698">y</span>&nbsp;<span class="op" id="7126700">&lt;</span>&nbsp;<span class="ident" id="7126702">bo</span><span class="op" id="7126704">.</span><span class="ident" id="7126705">Max</span><span class="op" id="7126708">.</span><span class="ident" id="7126709">Y</span><span class="op" id="7126710">;</span>&nbsp;<span class="ident" id="7126712">y</span><span class="op" id="7126713">++</span>&nbsp;<span class="op" id="7126716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7126720">for</span>&nbsp;<span class="ident" id="7126724">x</span>&nbsp;<span class="op" id="7126726">:=</span>&nbsp;<span class="ident" id="7126729">bo</span><span class="op" id="7126731">.</span><span class="ident" id="7126732">Min</span><span class="op" id="7126735">.</span><span class="ident" id="7126736">X</span><span class="op" id="7126737">;</span>&nbsp;<span class="ident" id="7126739">x</span>&nbsp;<span class="op" id="7126741">&lt;</span>&nbsp;<span class="ident" id="7126743">bo</span><span class="op" id="7126745">.</span><span class="ident" id="7126746">Max</span><span class="op" id="7126749">.</span><span class="ident" id="7126750">X</span><span class="op" id="7126751">;</span>&nbsp;<span class="ident" id="7126753">x</span><span class="op" id="7126754">++</span>&nbsp;<span class="op" id="7126757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7126762">img</span><span class="op" id="7126765">.</span><span class="ident" id="7126766">SetRGBA</span><span class="op" id="7126773">(</span><span class="ident" id="7126774">x</span><span class="op" id="7126775">,</span>&nbsp;<span class="ident" id="7126777">y</span><span class="op" id="7126778">,</span>&nbsp;<span class="ident" id="7126780">color</span><span class="op" id="7126785">.</span><span class="ident" id="7126786">RGBA</span><span class="op" id="7126790">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7126796">uint8</span><span class="op" id="7126801">(</span><span class="ident" id="7126802">rnd</span><span class="op" id="7126805">.</span><span class="ident" id="7126806">Intn</span><span class="op" id="7126810">(</span><span class="num" id="7126811">256</span><span class="op" id="7126814">)</span><span class="op" id="7126815">)</span><span class="op" id="7126816">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7126822">uint8</span><span class="op" id="7126827">(</span><span class="ident" id="7126828">rnd</span><span class="op" id="7126831">.</span><span class="ident" id="7126832">Intn</span><span class="op" id="7126836">(</span><span class="num" id="7126837">256</span><span class="op" id="7126840">)</span><span class="op" id="7126841">)</span><span class="op" id="7126842">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7126848">uint8</span><span class="op" id="7126853">(</span><span class="ident" id="7126854">rnd</span><span class="op" id="7126857">.</span><span class="ident" id="7126858">Intn</span><span class="op" id="7126862">(</span><span class="num" id="7126863">256</span><span class="op" id="7126866">)</span><span class="op" id="7126867">)</span><span class="op" id="7126868">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7126874">255</span><span class="op" id="7126877">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7126882">}</span><span class="op" id="7126883">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7126887">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7126890">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7126893">b</span><span class="op" id="7126894">.</span><span class="ident" id="7126895">SetBytes</span><span class="op" id="7126903">(</span><span class="num" id="7126904">640</span>&nbsp;<span class="op" id="7126908">*</span>&nbsp;<span class="num" id="7126910">480</span>&nbsp;<span class="op" id="7126914">*</span>&nbsp;<span class="num" id="7126916">4</span><span class="op" id="7126917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7126920">b</span><span class="op" id="7126921">.</span><span class="ident" id="7126922">StartTimer</span><span class="op" id="7126932">(</span><span class="op" id="7126933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7126936">for</span>&nbsp;<span class="ident" id="7126940">i</span>&nbsp;<span class="op" id="7126942">:=</span>&nbsp;<span class="num" id="7126945">0</span><span class="op" id="7126946">;</span>&nbsp;<span class="ident" id="7126948">i</span>&nbsp;<span class="op" id="7126950">&lt;</span>&nbsp;<span class="ident" id="7126952">b</span><span class="op" id="7126953">.</span><span class="ident" id="7126954">N</span><span class="op" id="7126955">;</span>&nbsp;<span class="ident" id="7126957">i</span><span class="op" id="7126958">++</span>&nbsp;<span class="op" id="7126961">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7126965">Encode</span><span class="op" id="7126971">(</span><span class="ident" id="7126972">ioutil</span><span class="op" id="7126978">.</span><span class="ident" id="7126979">Discard</span><span class="op" id="7126986">,</span>&nbsp;<span class="ident" id="7126988">img</span><span class="op" id="7126991">,</span>&nbsp;<span class="ident" id="7126993">nil</span><span class="op" id="7126996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7126999">}</span><br>
<span class="lineno"></span><span class="op" id="7127001">}</span>
</div>
</body>
</html>
