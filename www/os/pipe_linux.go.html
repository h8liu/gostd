<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2239632">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2239687">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2239741">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2239792">package</span>&nbsp;<span class="ident" id="2239800">os</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2239804">import</span>&nbsp;<span class="string" id="2239811">&#34;syscall&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2239822">//&nbsp;Pipe&nbsp;returns&nbsp;a&nbsp;connected&nbsp;pair&nbsp;of&nbsp;Files;&nbsp;reads&nbsp;from&nbsp;r&nbsp;return&nbsp;bytes&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno">10</span><span class="comment" id="2239905">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;files&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="2239951">func</span>&nbsp;<span class="ident" id="2239956">Pipe</span><span class="op" id="2239960">(</span><span class="op" id="2239961">)</span>&nbsp;<span class="op" id="2239963">(</span><span class="ident" id="2239964">r</span>&nbsp;<span class="op" id="2239966">*</span><span class="ident" id="2239967">File</span><span class="op" id="2239971">,</span>&nbsp;<span class="ident" id="2239973">w</span>&nbsp;<span class="op" id="2239975">*</span><span class="ident" id="2239976">File</span><span class="op" id="2239980">,</span>&nbsp;<span class="ident" id="2239982">err</span>&nbsp;<span class="builtintype" id="2239986">error</span><span class="op" id="2239991">)</span>&nbsp;<span class="op" id="2239993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2239996">var</span>&nbsp;<span class="ident" id="2240000">p</span>&nbsp;<span class="op" id="2240002">[</span><span class="num" id="2240003">2</span><span class="op" id="2240004">]</span><span class="builtintype" id="2240005">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2240011">e</span>&nbsp;<span class="op" id="2240013">:=</span>&nbsp;<span class="ident" id="2240016">syscall</span><span class="op" id="2240023">.</span><span class="ident" id="2240024">Pipe2</span><span class="op" id="2240029">(</span><span class="ident" id="2240030">p</span><span class="op" id="2240031">[</span><span class="num" id="2240032">0</span><span class="op" id="2240033">:</span><span class="op" id="2240034">]</span><span class="op" id="2240035">,</span>&nbsp;<span class="ident" id="2240037">syscall</span><span class="op" id="2240044">.</span><span class="ident" id="2240045">O_CLOEXEC</span><span class="op" id="2240054">)</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2240057">//&nbsp;pipe2&nbsp;was&nbsp;added&nbsp;in&nbsp;2.6.27&nbsp;and&nbsp;our&nbsp;minimum&nbsp;requirement&nbsp;is&nbsp;2.6.23,&nbsp;so&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2240132">//&nbsp;might&nbsp;not&nbsp;be&nbsp;implemented.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2240162">if</span>&nbsp;<span class="ident" id="2240165">e</span>&nbsp;<span class="op" id="2240167">==</span>&nbsp;<span class="ident" id="2240170">syscall</span><span class="op" id="2240177">.</span><span class="ident" id="2240178">ENOSYS</span>&nbsp;<span class="op" id="2240185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2240189">//&nbsp;See&nbsp;../syscall/exec.go&nbsp;for&nbsp;description&nbsp;of&nbsp;lock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2240242">syscall</span><span class="op" id="2240249">.</span><span class="ident" id="2240250">ForkLock</span><span class="op" id="2240258">.</span><span class="ident" id="2240259">RLock</span><span class="op" id="2240264">(</span><span class="op" id="2240265">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2240269">e</span>&nbsp;<span class="op" id="2240271">=</span>&nbsp;<span class="ident" id="2240273">syscall</span><span class="op" id="2240280">.</span><span class="ident" id="2240281">Pipe</span><span class="op" id="2240285">(</span><span class="ident" id="2240286">p</span><span class="op" id="2240287">[</span><span class="num" id="2240288">0</span><span class="op" id="2240289">:</span><span class="op" id="2240290">]</span><span class="op" id="2240291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2240295">if</span>&nbsp;<span class="ident" id="2240298">e</span>&nbsp;<span class="op" id="2240300">!=</span>&nbsp;<span class="ident" id="2240303">nil</span>&nbsp;<span class="op" id="2240307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2240312">syscall</span><span class="op" id="2240319">.</span><span class="ident" id="2240320">ForkLock</span><span class="op" id="2240328">.</span><span class="ident" id="2240329">RUnlock</span><span class="op" id="2240336">(</span><span class="op" id="2240337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2240342">return</span>&nbsp;<span class="ident" id="2240349">nil</span><span class="op" id="2240352">,</span>&nbsp;<span class="ident" id="2240354">nil</span><span class="op" id="2240357">,</span>&nbsp;<span class="ident" id="2240359">NewSyscallError</span><span class="op" id="2240374">(</span><span class="string" id="2240375">&#34;pipe&#34;</span><span class="op" id="2240381">,</span>&nbsp;<span class="ident" id="2240383">e</span><span class="op" id="2240384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2240388">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2240392">syscall</span><span class="op" id="2240399">.</span><span class="ident" id="2240400">CloseOnExec</span><span class="op" id="2240411">(</span><span class="ident" id="2240412">p</span><span class="op" id="2240413">[</span><span class="num" id="2240414">0</span><span class="op" id="2240415">]</span><span class="op" id="2240416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2240420">syscall</span><span class="op" id="2240427">.</span><span class="ident" id="2240428">CloseOnExec</span><span class="op" id="2240439">(</span><span class="ident" id="2240440">p</span><span class="op" id="2240441">[</span><span class="num" id="2240442">1</span><span class="op" id="2240443">]</span><span class="op" id="2240444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2240448">syscall</span><span class="op" id="2240455">.</span><span class="ident" id="2240456">ForkLock</span><span class="op" id="2240464">.</span><span class="ident" id="2240465">RUnlock</span><span class="op" id="2240472">(</span><span class="op" id="2240473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2240476">}</span>&nbsp;<span class="keyword" id="2240478">else</span>&nbsp;<span class="keyword" id="2240483">if</span>&nbsp;<span class="ident" id="2240486">e</span>&nbsp;<span class="op" id="2240488">!=</span>&nbsp;<span class="ident" id="2240491">nil</span>&nbsp;<span class="op" id="2240495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2240499">return</span>&nbsp;<span class="ident" id="2240506">nil</span><span class="op" id="2240509">,</span>&nbsp;<span class="ident" id="2240511">nil</span><span class="op" id="2240514">,</span>&nbsp;<span class="ident" id="2240516">NewSyscallError</span><span class="op" id="2240531">(</span><span class="string" id="2240532">&#34;pipe2&#34;</span><span class="op" id="2240539">,</span>&nbsp;<span class="ident" id="2240541">e</span><span class="op" id="2240542">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2240545">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2240549">return</span>&nbsp;<span class="ident" id="2240556">NewFile</span><span class="op" id="2240563">(</span><span class="builtintype" id="2240564">uintptr</span><span class="op" id="2240571">(</span><span class="ident" id="2240572">p</span><span class="op" id="2240573">[</span><span class="num" id="2240574">0</span><span class="op" id="2240575">]</span><span class="op" id="2240576">)</span><span class="op" id="2240577">,</span>&nbsp;<span class="string" id="2240579">&#34;|0&#34;</span><span class="op" id="2240583">)</span><span class="op" id="2240584">,</span>&nbsp;<span class="ident" id="2240586">NewFile</span><span class="op" id="2240593">(</span><span class="builtintype" id="2240594">uintptr</span><span class="op" id="2240601">(</span><span class="ident" id="2240602">p</span><span class="op" id="2240603">[</span><span class="num" id="2240604">1</span><span class="op" id="2240605">]</span><span class="op" id="2240606">)</span><span class="op" id="2240607">,</span>&nbsp;<span class="string" id="2240609">&#34;|1&#34;</span><span class="op" id="2240613">)</span><span class="op" id="2240614">,</span>&nbsp;<span class="ident" id="2240616">nil</span><br>
<span class="lineno"></span><span class="op" id="2240620">}</span>
</div>
</body>
</html>
