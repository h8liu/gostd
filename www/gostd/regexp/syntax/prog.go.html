<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5318970">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5319025">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5319079">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5319130">package</span>&nbsp;<span class="ident" id="5319138">syntax</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5319146">import</span>&nbsp;<span class="op" id="5319153">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5319156">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5319165">&#34;strconv&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5319176">&#34;unicode&#34;</span><br>
<span class="lineno"></span><span class="op" id="5319186">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5319189">//&nbsp;Compiled&nbsp;program.</span><br>
<span class="lineno"></span><span class="comment" id="5319210">//&nbsp;May&nbsp;not&nbsp;belong&nbsp;in&nbsp;this&nbsp;package,&nbsp;but&nbsp;convenient&nbsp;for&nbsp;now.</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="5319270">//&nbsp;A&nbsp;Prog&nbsp;is&nbsp;a&nbsp;compiled&nbsp;regular&nbsp;expression&nbsp;program.</span><br>
<span class="lineno"></span><span class="keyword" id="5319322">type</span>&nbsp;<span class="ident" id="5319327">Prog</span>&nbsp;<span class="keyword" id="5319332">struct</span>&nbsp;<span class="op" id="5319339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5319342">Inst</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5319349">[</span><span class="op" id="5319350">]</span><span class="ident" id="5319351">Inst</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5319357">Start</span>&nbsp;&nbsp;<span class="builtintype" id="5319364">int</span>&nbsp;<span class="comment" id="5319368">//&nbsp;index&nbsp;of&nbsp;start&nbsp;instruction</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5319399">NumCap</span>&nbsp;<span class="builtintype" id="5319406">int</span>&nbsp;<span class="comment" id="5319410">//&nbsp;number&nbsp;of&nbsp;InstCapture&nbsp;insts&nbsp;in&nbsp;re</span><br>
<span class="lineno"></span><span class="op" id="5319447">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5319450">//&nbsp;An&nbsp;InstOp&nbsp;is&nbsp;an&nbsp;instruction&nbsp;opcode.</span><br>
<span class="lineno"></span><span class="keyword" id="5319489">type</span>&nbsp;<span class="ident" id="5319494">InstOp</span>&nbsp;<span class="builtintype" id="5319501">uint8</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="5319508">const</span>&nbsp;<span class="op" id="5319514">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5319517">InstAlt</span>&nbsp;<span class="ident" id="5319525">InstOp</span>&nbsp;<span class="op" id="5319532">=</span>&nbsp;<span class="ident" id="5319534">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5319540">InstAltMatch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5319554">InstCapture</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5319567">InstEmptyWidth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5319583">InstMatch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5319594">InstFail</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5319604">InstNop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5319613">InstRune</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5319623">InstRune1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5319634">InstRuneAny</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5319647">InstRuneAnyNotNL</span><br>
<span class="lineno"></span><span class="op" id="5319664">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="5319667">var</span>&nbsp;<span class="ident" id="5319671">instOpNames</span>&nbsp;<span class="op" id="5319683">=</span>&nbsp;<span class="op" id="5319685">[</span><span class="op" id="5319686">]</span><span class="builtintype" id="5319687">string</span><span class="op" id="5319693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5319696">&#34;InstAlt&#34;</span><span class="op" id="5319705">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5319708">&#34;InstAltMatch&#34;</span><span class="op" id="5319722">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5319725">&#34;InstCapture&#34;</span><span class="op" id="5319738">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5319741">&#34;InstEmptyWidth&#34;</span><span class="op" id="5319757">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5319760">&#34;InstMatch&#34;</span><span class="op" id="5319771">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5319774">&#34;InstFail&#34;</span><span class="op" id="5319784">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5319787">&#34;InstNop&#34;</span><span class="op" id="5319796">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5319799">&#34;InstRune&#34;</span><span class="op" id="5319809">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5319812">&#34;InstRune1&#34;</span><span class="op" id="5319823">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5319826">&#34;InstRuneAny&#34;</span><span class="op" id="5319839">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5319842">&#34;InstRuneAnyNotNL&#34;</span><span class="op" id="5319860">,</span><br>
<span class="lineno"></span><span class="op" id="5319862">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5319865">func</span>&nbsp;<span class="op" id="5319870">(</span><span class="ident" id="5319871">i</span>&nbsp;<span class="ident" id="5319873">InstOp</span><span class="op" id="5319879">)</span>&nbsp;<span class="ident" id="5319881">String</span><span class="op" id="5319887">(</span><span class="op" id="5319888">)</span>&nbsp;<span class="builtintype" id="5319890">string</span>&nbsp;<span class="op" id="5319897">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5319900">if</span>&nbsp;<span class="builtintype" id="5319903">uint</span><span class="op" id="5319907">(</span><span class="ident" id="5319908">i</span><span class="op" id="5319909">)</span>&nbsp;<span class="op" id="5319911">&gt;=</span>&nbsp;<span class="builtintype" id="5319914">uint</span><span class="op" id="5319918">(</span><span class="builtinfunc" id="5319919">len</span><span class="op" id="5319922">(</span><span class="ident" id="5319923">instOpNames</span><span class="op" id="5319934">)</span><span class="op" id="5319935">)</span>&nbsp;<span class="op" id="5319937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5319941">return</span>&nbsp;<span class="string" id="5319948">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5319952">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5319955">return</span>&nbsp;<span class="ident" id="5319962">instOpNames</span><span class="op" id="5319973">[</span><span class="ident" id="5319974">i</span><span class="op" id="5319975">]</span><br>
<span class="lineno"></span><span class="op" id="5319977">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="comment" id="5319980">//&nbsp;An&nbsp;EmptyOp&nbsp;specifies&nbsp;a&nbsp;kind&nbsp;or&nbsp;mixture&nbsp;of&nbsp;zero-width&nbsp;assertions.</span><br>
<span class="lineno"></span><span class="keyword" id="5320048">type</span>&nbsp;<span class="ident" id="5320053">EmptyOp</span>&nbsp;<span class="builtintype" id="5320061">uint8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5320068">const</span>&nbsp;<span class="op" id="5320074">(</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5320077">EmptyBeginLine</span>&nbsp;<span class="ident" id="5320092">EmptyOp</span>&nbsp;<span class="op" id="5320100">=</span>&nbsp;<span class="num" id="5320102">1</span>&nbsp;<span class="op" id="5320104">&lt;&lt;</span>&nbsp;<span class="ident" id="5320107">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5320113">EmptyEndLine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5320127">EmptyBeginText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5320143">EmptyEndText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5320157">EmptyWordBoundary</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5320176">EmptyNoWordBoundary</span><br>
<span class="lineno"></span><span class="op" id="5320196">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5320199">//&nbsp;EmptyOpContext&nbsp;returns&nbsp;the&nbsp;zero-width&nbsp;assertions</span><br>
<span class="lineno"></span><span class="comment" id="5320251">//&nbsp;satisfied&nbsp;at&nbsp;the&nbsp;position&nbsp;between&nbsp;the&nbsp;runes&nbsp;r1&nbsp;and&nbsp;r2.</span><br>
<span class="lineno">75</span><span class="comment" id="5320309">//&nbsp;Passing&nbsp;r1&nbsp;==&nbsp;-1&nbsp;indicates&nbsp;that&nbsp;the&nbsp;position&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="5320360">//&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;text.</span><br>
<span class="lineno"></span><span class="comment" id="5320393">//&nbsp;Passing&nbsp;r2&nbsp;==&nbsp;-1&nbsp;indicates&nbsp;that&nbsp;the&nbsp;position&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="5320444">//&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;text.</span><br>
<span class="lineno"></span><span class="keyword" id="5320471">func</span>&nbsp;<span class="ident" id="5320476">EmptyOpContext</span><span class="op" id="5320490">(</span><span class="ident" id="5320491">r1</span><span class="op" id="5320493">,</span>&nbsp;<span class="ident" id="5320495">r2</span>&nbsp;<span class="builtintype" id="5320498">rune</span><span class="op" id="5320502">)</span>&nbsp;<span class="ident" id="5320504">EmptyOp</span>&nbsp;<span class="op" id="5320512">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5320515">var</span>&nbsp;<span class="ident" id="5320519">op</span>&nbsp;<span class="ident" id="5320522">EmptyOp</span>&nbsp;<span class="op" id="5320530">=</span>&nbsp;<span class="ident" id="5320532">EmptyNoWordBoundary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5320553">var</span>&nbsp;<span class="ident" id="5320557">boundary</span>&nbsp;<span class="builtintype" id="5320566">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5320572">switch</span>&nbsp;<span class="op" id="5320579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5320582">case</span>&nbsp;<span class="ident" id="5320587">IsWordChar</span><span class="op" id="5320597">(</span><span class="ident" id="5320598">r1</span><span class="op" id="5320600">)</span><span class="op" id="5320601">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5320605">boundary</span>&nbsp;<span class="op" id="5320614">=</span>&nbsp;<span class="num" id="5320616">1</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5320619">case</span>&nbsp;<span class="ident" id="5320624">r1</span>&nbsp;<span class="op" id="5320627">==</span>&nbsp;<span class="string" id="5320630">&#39;\n&#39;</span><span class="op" id="5320634">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5320638">op</span>&nbsp;<span class="op" id="5320641">|=</span>&nbsp;<span class="ident" id="5320644">EmptyBeginLine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5320660">case</span>&nbsp;<span class="ident" id="5320665">r1</span>&nbsp;<span class="op" id="5320668">&lt;</span>&nbsp;<span class="num" id="5320670">0</span><span class="op" id="5320671">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5320675">op</span>&nbsp;<span class="op" id="5320678">|=</span>&nbsp;<span class="ident" id="5320681">EmptyBeginText</span>&nbsp;<span class="op" id="5320696">|</span>&nbsp;<span class="ident" id="5320698">EmptyBeginLine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5320714">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5320717">switch</span>&nbsp;<span class="op" id="5320724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5320727">case</span>&nbsp;<span class="ident" id="5320732">IsWordChar</span><span class="op" id="5320742">(</span><span class="ident" id="5320743">r2</span><span class="op" id="5320745">)</span><span class="op" id="5320746">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5320750">boundary</span>&nbsp;<span class="op" id="5320759">^=</span>&nbsp;<span class="num" id="5320762">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5320765">case</span>&nbsp;<span class="ident" id="5320770">r2</span>&nbsp;<span class="op" id="5320773">==</span>&nbsp;<span class="string" id="5320776">&#39;\n&#39;</span><span class="op" id="5320780">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5320784">op</span>&nbsp;<span class="op" id="5320787">|=</span>&nbsp;<span class="ident" id="5320790">EmptyEndLine</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5320804">case</span>&nbsp;<span class="ident" id="5320809">r2</span>&nbsp;<span class="op" id="5320812">&lt;</span>&nbsp;<span class="num" id="5320814">0</span><span class="op" id="5320815">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5320819">op</span>&nbsp;<span class="op" id="5320822">|=</span>&nbsp;<span class="ident" id="5320825">EmptyEndText</span>&nbsp;<span class="op" id="5320838">|</span>&nbsp;<span class="ident" id="5320840">EmptyEndLine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5320854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5320857">if</span>&nbsp;<span class="ident" id="5320860">boundary</span>&nbsp;<span class="op" id="5320869">!=</span>&nbsp;<span class="num" id="5320872">0</span>&nbsp;<span class="op" id="5320874">{</span>&nbsp;<span class="comment" id="5320876">//&nbsp;IsWordChar(r1)&nbsp;!=&nbsp;IsWordChar(r2)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5320914">op</span>&nbsp;<span class="op" id="5320917">^=</span>&nbsp;<span class="op" id="5320920">(</span><span class="ident" id="5320921">EmptyWordBoundary</span>&nbsp;<span class="op" id="5320939">|</span>&nbsp;<span class="ident" id="5320941">EmptyNoWordBoundary</span><span class="op" id="5320960">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5320963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5320966">return</span>&nbsp;<span class="ident" id="5320973">op</span><br>
<span class="lineno"></span><span class="op" id="5320976">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5320979">//&nbsp;IsWordChar&nbsp;reports&nbsp;whether&nbsp;r&nbsp;is&nbsp;consider&nbsp;a&nbsp;``word&nbsp;character&#39;&#39;</span><br>
<span class="lineno">105</span><span class="comment" id="5321044">//&nbsp;during&nbsp;the&nbsp;evaluation&nbsp;of&nbsp;the&nbsp;\b&nbsp;and&nbsp;\B&nbsp;zero-width&nbsp;assertions.</span><br>
<span class="lineno"></span><span class="comment" id="5321109">//&nbsp;These&nbsp;assertions&nbsp;are&nbsp;ASCII-only:&nbsp;the&nbsp;word&nbsp;characters&nbsp;are&nbsp;[A-Za-z0-9_].</span><br>
<span class="lineno"></span><span class="keyword" id="5321183">func</span>&nbsp;<span class="ident" id="5321188">IsWordChar</span><span class="op" id="5321198">(</span><span class="ident" id="5321199">r</span>&nbsp;<span class="builtintype" id="5321201">rune</span><span class="op" id="5321205">)</span>&nbsp;<span class="builtintype" id="5321207">bool</span>&nbsp;<span class="op" id="5321212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5321215">return</span>&nbsp;<span class="string" id="5321222">&#39;A&#39;</span>&nbsp;<span class="op" id="5321226">&lt;=</span>&nbsp;<span class="ident" id="5321229">r</span>&nbsp;<span class="op" id="5321231">&amp;&amp;</span>&nbsp;<span class="ident" id="5321234">r</span>&nbsp;<span class="op" id="5321236">&lt;=</span>&nbsp;<span class="string" id="5321239">&#39;Z&#39;</span>&nbsp;<span class="op" id="5321243">||</span>&nbsp;<span class="string" id="5321246">&#39;a&#39;</span>&nbsp;<span class="op" id="5321250">&lt;=</span>&nbsp;<span class="ident" id="5321253">r</span>&nbsp;<span class="op" id="5321255">&amp;&amp;</span>&nbsp;<span class="ident" id="5321258">r</span>&nbsp;<span class="op" id="5321260">&lt;=</span>&nbsp;<span class="string" id="5321263">&#39;z&#39;</span>&nbsp;<span class="op" id="5321267">||</span>&nbsp;<span class="string" id="5321270">&#39;0&#39;</span>&nbsp;<span class="op" id="5321274">&lt;=</span>&nbsp;<span class="ident" id="5321277">r</span>&nbsp;<span class="op" id="5321279">&amp;&amp;</span>&nbsp;<span class="ident" id="5321282">r</span>&nbsp;<span class="op" id="5321284">&lt;=</span>&nbsp;<span class="string" id="5321287">&#39;9&#39;</span>&nbsp;<span class="op" id="5321291">||</span>&nbsp;<span class="ident" id="5321294">r</span>&nbsp;<span class="op" id="5321296">==</span>&nbsp;<span class="string" id="5321299">&#39;_&#39;</span><br>
<span class="lineno"></span><span class="op" id="5321303">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="comment" id="5321306">//&nbsp;An&nbsp;Inst&nbsp;is&nbsp;a&nbsp;single&nbsp;instruction&nbsp;in&nbsp;a&nbsp;regular&nbsp;expression&nbsp;program.</span><br>
<span class="lineno"></span><span class="keyword" id="5321374">type</span>&nbsp;<span class="ident" id="5321379">Inst</span>&nbsp;<span class="keyword" id="5321384">struct</span>&nbsp;<span class="op" id="5321391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5321394">Op</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5321399">InstOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5321407">Out</span>&nbsp;&nbsp;<span class="builtintype" id="5321412">uint32</span>&nbsp;<span class="comment" id="5321419">//&nbsp;all&nbsp;but&nbsp;InstMatch,&nbsp;InstFail</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5321451">Arg</span>&nbsp;&nbsp;<span class="builtintype" id="5321456">uint32</span>&nbsp;<span class="comment" id="5321463">//&nbsp;InstAlt,&nbsp;InstAltMatch,&nbsp;InstCapture,&nbsp;InstEmptyWidth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5321518">Rune</span>&nbsp;<span class="op" id="5321523">[</span><span class="op" id="5321524">]</span><span class="builtintype" id="5321525">rune</span><br>
<span class="lineno"></span><span class="op" id="5321530">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5321533">func</span>&nbsp;<span class="op" id="5321538">(</span><span class="ident" id="5321539">p</span>&nbsp;<span class="op" id="5321541">*</span><span class="ident" id="5321542">Prog</span><span class="op" id="5321546">)</span>&nbsp;<span class="ident" id="5321548">String</span><span class="op" id="5321554">(</span><span class="op" id="5321555">)</span>&nbsp;<span class="builtintype" id="5321557">string</span>&nbsp;<span class="op" id="5321564">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5321567">var</span>&nbsp;<span class="ident" id="5321571">b</span>&nbsp;<span class="ident" id="5321573">bytes</span><span class="op" id="5321578">.</span><span class="ident" id="5321579">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5321587">dumpProg</span><span class="op" id="5321595">(</span><span class="op" id="5321596">&amp;</span><span class="ident" id="5321597">b</span><span class="op" id="5321598">,</span>&nbsp;<span class="ident" id="5321600">p</span><span class="op" id="5321601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5321604">return</span>&nbsp;<span class="ident" id="5321611">b</span><span class="op" id="5321612">.</span><span class="ident" id="5321613">String</span><span class="op" id="5321619">(</span><span class="op" id="5321620">)</span><br>
<span class="lineno"></span><span class="op" id="5321622">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment" id="5321625">//&nbsp;skipNop&nbsp;follows&nbsp;any&nbsp;no-op&nbsp;or&nbsp;capturing&nbsp;instructions</span><br>
<span class="lineno"></span><span class="comment" id="5321680">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;resulting&nbsp;pc.</span><br>
<span class="lineno"></span><span class="keyword" id="5321713">func</span>&nbsp;<span class="op" id="5321718">(</span><span class="ident" id="5321719">p</span>&nbsp;<span class="op" id="5321721">*</span><span class="ident" id="5321722">Prog</span><span class="op" id="5321726">)</span>&nbsp;<span class="ident" id="5321728">skipNop</span><span class="op" id="5321735">(</span><span class="ident" id="5321736">pc</span>&nbsp;<span class="builtintype" id="5321739">uint32</span><span class="op" id="5321745">)</span>&nbsp;<span class="op" id="5321747">(</span><span class="op" id="5321748">*</span><span class="ident" id="5321749">Inst</span><span class="op" id="5321753">,</span>&nbsp;<span class="builtintype" id="5321755">uint32</span><span class="op" id="5321761">)</span>&nbsp;<span class="op" id="5321763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5321766">i</span>&nbsp;<span class="op" id="5321768">:=</span>&nbsp;<span class="op" id="5321771">&amp;</span><span class="ident" id="5321772">p</span><span class="op" id="5321773">.</span><span class="ident" id="5321774">Inst</span><span class="op" id="5321778">[</span><span class="ident" id="5321779">pc</span><span class="op" id="5321781">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5321784">for</span>&nbsp;<span class="ident" id="5321788">i</span><span class="op" id="5321789">.</span><span class="ident" id="5321790">Op</span>&nbsp;<span class="op" id="5321793">==</span>&nbsp;<span class="ident" id="5321796">InstNop</span>&nbsp;<span class="op" id="5321804">||</span>&nbsp;<span class="ident" id="5321807">i</span><span class="op" id="5321808">.</span><span class="ident" id="5321809">Op</span>&nbsp;<span class="op" id="5321812">==</span>&nbsp;<span class="ident" id="5321815">InstCapture</span>&nbsp;<span class="op" id="5321827">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5321831">pc</span>&nbsp;<span class="op" id="5321834">=</span>&nbsp;<span class="ident" id="5321836">i</span><span class="op" id="5321837">.</span><span class="ident" id="5321838">Out</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5321844">i</span>&nbsp;<span class="op" id="5321846">=</span>&nbsp;<span class="op" id="5321848">&amp;</span><span class="ident" id="5321849">p</span><span class="op" id="5321850">.</span><span class="ident" id="5321851">Inst</span><span class="op" id="5321855">[</span><span class="ident" id="5321856">pc</span><span class="op" id="5321858">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5321861">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5321864">return</span>&nbsp;<span class="ident" id="5321871">i</span><span class="op" id="5321872">,</span>&nbsp;<span class="ident" id="5321874">pc</span><br>
<span class="lineno"></span><span class="op" id="5321877">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span><span class="comment" id="5321880">//&nbsp;op&nbsp;returns&nbsp;i.Op&nbsp;but&nbsp;merges&nbsp;all&nbsp;the&nbsp;Rune&nbsp;special&nbsp;cases&nbsp;into&nbsp;InstRune</span><br>
<span class="lineno"></span><span class="keyword" id="5321951">func</span>&nbsp;<span class="op" id="5321956">(</span><span class="ident" id="5321957">i</span>&nbsp;<span class="op" id="5321959">*</span><span class="ident" id="5321960">Inst</span><span class="op" id="5321964">)</span>&nbsp;<span class="ident" id="5321966">op</span><span class="op" id="5321968">(</span><span class="op" id="5321969">)</span>&nbsp;<span class="ident" id="5321971">InstOp</span>&nbsp;<span class="op" id="5321978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5321981">op</span>&nbsp;<span class="op" id="5321984">:=</span>&nbsp;<span class="ident" id="5321987">i</span><span class="op" id="5321988">.</span><span class="ident" id="5321989">Op</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5321993">switch</span>&nbsp;<span class="ident" id="5322000">op</span>&nbsp;<span class="op" id="5322003">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5322006">case</span>&nbsp;<span class="ident" id="5322011">InstRune1</span><span class="op" id="5322020">,</span>&nbsp;<span class="ident" id="5322022">InstRuneAny</span><span class="op" id="5322033">,</span>&nbsp;<span class="ident" id="5322035">InstRuneAnyNotNL</span><span class="op" id="5322051">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5322055">op</span>&nbsp;<span class="op" id="5322058">=</span>&nbsp;<span class="ident" id="5322060">InstRune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5322070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5322073">return</span>&nbsp;<span class="ident" id="5322080">op</span><br>
<span class="lineno"></span><span class="op" id="5322083">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="comment" id="5322086">//&nbsp;Prefix&nbsp;returns&nbsp;a&nbsp;literal&nbsp;string&nbsp;that&nbsp;all&nbsp;matches&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5322146">//&nbsp;regexp&nbsp;must&nbsp;start&nbsp;with.&nbsp;&nbsp;Complete&nbsp;is&nbsp;true&nbsp;if&nbsp;the&nbsp;prefix</span><br>
<span class="lineno"></span><span class="comment" id="5322205">//&nbsp;is&nbsp;the&nbsp;entire&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="5322229">func</span>&nbsp;<span class="op" id="5322234">(</span><span class="ident" id="5322235">p</span>&nbsp;<span class="op" id="5322237">*</span><span class="ident" id="5322238">Prog</span><span class="op" id="5322242">)</span>&nbsp;<span class="ident" id="5322244">Prefix</span><span class="op" id="5322250">(</span><span class="op" id="5322251">)</span>&nbsp;<span class="op" id="5322253">(</span><span class="ident" id="5322254">prefix</span>&nbsp;<span class="builtintype" id="5322261">string</span><span class="op" id="5322267">,</span>&nbsp;<span class="ident" id="5322269">complete</span>&nbsp;<span class="builtintype" id="5322278">bool</span><span class="op" id="5322282">)</span>&nbsp;<span class="op" id="5322284">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5322287">i</span><span class="op" id="5322288">,</span>&nbsp;<span class="ident" id="5322290">_</span>&nbsp;<span class="op" id="5322292">:=</span>&nbsp;<span class="ident" id="5322295">p</span><span class="op" id="5322296">.</span><span class="ident" id="5322297">skipNop</span><span class="op" id="5322304">(</span><span class="builtintype" id="5322305">uint32</span><span class="op" id="5322311">(</span><span class="ident" id="5322312">p</span><span class="op" id="5322313">.</span><span class="ident" id="5322314">Start</span><span class="op" id="5322319">)</span><span class="op" id="5322320">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5322324">//&nbsp;Avoid&nbsp;allocation&nbsp;of&nbsp;buffer&nbsp;if&nbsp;prefix&nbsp;is&nbsp;empty.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5322375">if</span>&nbsp;<span class="ident" id="5322378">i</span><span class="op" id="5322379">.</span><span class="ident" id="5322380">op</span><span class="op" id="5322382">(</span><span class="op" id="5322383">)</span>&nbsp;<span class="op" id="5322385">!=</span>&nbsp;<span class="ident" id="5322388">InstRune</span>&nbsp;<span class="op" id="5322397">||</span>&nbsp;<span class="builtinfunc" id="5322400">len</span><span class="op" id="5322403">(</span><span class="ident" id="5322404">i</span><span class="op" id="5322405">.</span><span class="ident" id="5322406">Rune</span><span class="op" id="5322410">)</span>&nbsp;<span class="op" id="5322412">!=</span>&nbsp;<span class="num" id="5322415">1</span>&nbsp;<span class="op" id="5322417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5322421">return</span>&nbsp;<span class="string" id="5322428">&#34;&#34;</span><span class="op" id="5322430">,</span>&nbsp;<span class="ident" id="5322432">i</span><span class="op" id="5322433">.</span><span class="ident" id="5322434">Op</span>&nbsp;<span class="op" id="5322437">==</span>&nbsp;<span class="ident" id="5322440">InstMatch</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5322451">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5322455">//&nbsp;Have&nbsp;prefix;&nbsp;gather&nbsp;characters.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5322491">var</span>&nbsp;<span class="ident" id="5322495">buf</span>&nbsp;<span class="ident" id="5322499">bytes</span><span class="op" id="5322504">.</span><span class="ident" id="5322505">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5322513">for</span>&nbsp;<span class="ident" id="5322517">i</span><span class="op" id="5322518">.</span><span class="ident" id="5322519">op</span><span class="op" id="5322521">(</span><span class="op" id="5322522">)</span>&nbsp;<span class="op" id="5322524">==</span>&nbsp;<span class="ident" id="5322527">InstRune</span>&nbsp;<span class="op" id="5322536">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5322539">len</span><span class="op" id="5322542">(</span><span class="ident" id="5322543">i</span><span class="op" id="5322544">.</span><span class="ident" id="5322545">Rune</span><span class="op" id="5322549">)</span>&nbsp;<span class="op" id="5322551">==</span>&nbsp;<span class="num" id="5322554">1</span>&nbsp;<span class="op" id="5322556">&amp;&amp;</span>&nbsp;<span class="ident" id="5322559">Flags</span><span class="op" id="5322564">(</span><span class="ident" id="5322565">i</span><span class="op" id="5322566">.</span><span class="ident" id="5322567">Arg</span><span class="op" id="5322570">)</span><span class="op" id="5322571">&amp;</span><span class="ident" id="5322572">FoldCase</span>&nbsp;<span class="op" id="5322581">==</span>&nbsp;<span class="num" id="5322584">0</span>&nbsp;<span class="op" id="5322586">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5322590">buf</span><span class="op" id="5322593">.</span><span class="ident" id="5322594">WriteRune</span><span class="op" id="5322603">(</span><span class="ident" id="5322604">i</span><span class="op" id="5322605">.</span><span class="ident" id="5322606">Rune</span><span class="op" id="5322610">[</span><span class="num" id="5322611">0</span><span class="op" id="5322612">]</span><span class="op" id="5322613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5322617">i</span><span class="op" id="5322618">,</span>&nbsp;<span class="ident" id="5322620">_</span>&nbsp;<span class="op" id="5322622">=</span>&nbsp;<span class="ident" id="5322624">p</span><span class="op" id="5322625">.</span><span class="ident" id="5322626">skipNop</span><span class="op" id="5322633">(</span><span class="ident" id="5322634">i</span><span class="op" id="5322635">.</span><span class="ident" id="5322636">Out</span><span class="op" id="5322639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5322642">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5322645">return</span>&nbsp;<span class="ident" id="5322652">buf</span><span class="op" id="5322655">.</span><span class="ident" id="5322656">String</span><span class="op" id="5322662">(</span><span class="op" id="5322663">)</span><span class="op" id="5322664">,</span>&nbsp;<span class="ident" id="5322666">i</span><span class="op" id="5322667">.</span><span class="ident" id="5322668">Op</span>&nbsp;<span class="op" id="5322671">==</span>&nbsp;<span class="ident" id="5322674">InstMatch</span><br>
<span class="lineno"></span><span class="op" id="5322684">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="comment" id="5322687">//&nbsp;StartCond&nbsp;returns&nbsp;the&nbsp;leading&nbsp;empty-width&nbsp;conditions&nbsp;that&nbsp;must</span><br>
<span class="lineno"></span><span class="comment" id="5322753">//&nbsp;be&nbsp;true&nbsp;in&nbsp;any&nbsp;match.&nbsp;&nbsp;It&nbsp;returns&nbsp;^EmptyOp(0)&nbsp;if&nbsp;no&nbsp;matches&nbsp;are&nbsp;possible.</span><br>
<span class="lineno"></span><span class="keyword" id="5322830">func</span>&nbsp;<span class="op" id="5322835">(</span><span class="ident" id="5322836">p</span>&nbsp;<span class="op" id="5322838">*</span><span class="ident" id="5322839">Prog</span><span class="op" id="5322843">)</span>&nbsp;<span class="ident" id="5322845">StartCond</span><span class="op" id="5322854">(</span><span class="op" id="5322855">)</span>&nbsp;<span class="ident" id="5322857">EmptyOp</span>&nbsp;<span class="op" id="5322865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5322868">var</span>&nbsp;<span class="ident" id="5322872">flag</span>&nbsp;<span class="ident" id="5322877">EmptyOp</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5322886">pc</span>&nbsp;<span class="op" id="5322889">:=</span>&nbsp;<span class="builtintype" id="5322892">uint32</span><span class="op" id="5322898">(</span><span class="ident" id="5322899">p</span><span class="op" id="5322900">.</span><span class="ident" id="5322901">Start</span><span class="op" id="5322906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5322909">i</span>&nbsp;<span class="op" id="5322911">:=</span>&nbsp;<span class="op" id="5322914">&amp;</span><span class="ident" id="5322915">p</span><span class="op" id="5322916">.</span><span class="ident" id="5322917">Inst</span><span class="op" id="5322921">[</span><span class="ident" id="5322922">pc</span><span class="op" id="5322924">]</span><br>
<span class="lineno"></span><span class="ident" id="5322926">Loop</span><span class="op" id="5322930">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5322933">for</span>&nbsp;<span class="op" id="5322937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5322941">switch</span>&nbsp;<span class="ident" id="5322948">i</span><span class="op" id="5322949">.</span><span class="ident" id="5322950">Op</span>&nbsp;<span class="op" id="5322953">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5322957">case</span>&nbsp;<span class="ident" id="5322962">InstEmptyWidth</span><span class="op" id="5322976">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5322981">flag</span>&nbsp;<span class="op" id="5322986">|=</span>&nbsp;<span class="ident" id="5322989">EmptyOp</span><span class="op" id="5322996">(</span><span class="ident" id="5322997">i</span><span class="op" id="5322998">.</span><span class="ident" id="5322999">Arg</span><span class="op" id="5323002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5323006">case</span>&nbsp;<span class="ident" id="5323011">InstFail</span><span class="op" id="5323019">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5323024">return</span>&nbsp;<span class="op" id="5323031">^</span><span class="ident" id="5323032">EmptyOp</span><span class="op" id="5323039">(</span><span class="num" id="5323040">0</span><span class="op" id="5323041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5323045">case</span>&nbsp;<span class="ident" id="5323050">InstCapture</span><span class="op" id="5323061">,</span>&nbsp;<span class="ident" id="5323063">InstNop</span><span class="op" id="5323070">:</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5323075">//&nbsp;skip</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5323085">default</span><span class="op" id="5323092">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5323097">break</span>&nbsp;<span class="ident" id="5323103">Loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5323110">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5323114">pc</span>&nbsp;<span class="op" id="5323117">=</span>&nbsp;<span class="ident" id="5323119">i</span><span class="op" id="5323120">.</span><span class="ident" id="5323121">Out</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5323127">i</span>&nbsp;<span class="op" id="5323129">=</span>&nbsp;<span class="op" id="5323131">&amp;</span><span class="ident" id="5323132">p</span><span class="op" id="5323133">.</span><span class="ident" id="5323134">Inst</span><span class="op" id="5323138">[</span><span class="ident" id="5323139">pc</span><span class="op" id="5323141">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5323144">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5323147">return</span>&nbsp;<span class="ident" id="5323154">flag</span><br>
<span class="lineno"></span><span class="op" id="5323159">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="keyword" id="5323162">const</span>&nbsp;<span class="ident" id="5323168">noMatch</span>&nbsp;<span class="op" id="5323176">=</span>&nbsp;<span class="op" id="5323178">-</span><span class="num" id="5323179">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5323182">//&nbsp;MatchRune&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;instruction&nbsp;matches&nbsp;(and&nbsp;consumes)&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="5323253">//&nbsp;It&nbsp;should&nbsp;only&nbsp;be&nbsp;called&nbsp;when&nbsp;i.Op&nbsp;==&nbsp;InstRune.</span><br>
<span class="lineno"></span><span class="keyword" id="5323304">func</span>&nbsp;<span class="op" id="5323309">(</span><span class="ident" id="5323310">i</span>&nbsp;<span class="op" id="5323312">*</span><span class="ident" id="5323313">Inst</span><span class="op" id="5323317">)</span>&nbsp;<span class="ident" id="5323319">MatchRune</span><span class="op" id="5323328">(</span><span class="ident" id="5323329">r</span>&nbsp;<span class="builtintype" id="5323331">rune</span><span class="op" id="5323335">)</span>&nbsp;<span class="builtintype" id="5323337">bool</span>&nbsp;<span class="op" id="5323342">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5323345">return</span>&nbsp;<span class="ident" id="5323352">i</span><span class="op" id="5323353">.</span><span class="ident" id="5323354">MatchRunePos</span><span class="op" id="5323366">(</span><span class="ident" id="5323367">r</span><span class="op" id="5323368">)</span>&nbsp;<span class="op" id="5323370">!=</span>&nbsp;<span class="ident" id="5323373">noMatch</span><br>
<span class="lineno"></span><span class="op" id="5323381">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5323384">//&nbsp;MatchRunePos&nbsp;checks&nbsp;whether&nbsp;the&nbsp;instruction&nbsp;matches&nbsp;(and&nbsp;consumes)&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="5323457">//&nbsp;If&nbsp;so,&nbsp;MatchRunePos&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;matching&nbsp;rune&nbsp;pair</span><br>
<span class="lineno">200</span><span class="comment" id="5323524">//&nbsp;(or,&nbsp;when&nbsp;len(i.Rune)&nbsp;==&nbsp;1,&nbsp;rune&nbsp;singleton).</span><br>
<span class="lineno"></span><span class="comment" id="5323572">//&nbsp;If&nbsp;not,&nbsp;MatchRunePos&nbsp;returns&nbsp;-1.</span><br>
<span class="lineno"></span><span class="comment" id="5323608">//&nbsp;MatchRunePos&nbsp;should&nbsp;only&nbsp;be&nbsp;called&nbsp;when&nbsp;i.Op&nbsp;==&nbsp;InstRune.</span><br>
<span class="lineno"></span><span class="keyword" id="5323669">func</span>&nbsp;<span class="op" id="5323674">(</span><span class="ident" id="5323675">i</span>&nbsp;<span class="op" id="5323677">*</span><span class="ident" id="5323678">Inst</span><span class="op" id="5323682">)</span>&nbsp;<span class="ident" id="5323684">MatchRunePos</span><span class="op" id="5323696">(</span><span class="ident" id="5323697">r</span>&nbsp;<span class="builtintype" id="5323699">rune</span><span class="op" id="5323703">)</span>&nbsp;<span class="builtintype" id="5323705">int</span>&nbsp;<span class="op" id="5323709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5323712">rune</span>&nbsp;<span class="op" id="5323717">:=</span>&nbsp;<span class="ident" id="5323720">i</span><span class="op" id="5323721">.</span><span class="ident" id="5323722">Rune</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5323729">//&nbsp;Special&nbsp;case:&nbsp;single-rune&nbsp;slice&nbsp;is&nbsp;from&nbsp;literal&nbsp;string,&nbsp;not&nbsp;char&nbsp;class.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5323805">if</span>&nbsp;<span class="builtinfunc" id="5323808">len</span><span class="op" id="5323811">(</span><span class="builtintype" id="5323812">rune</span><span class="op" id="5323816">)</span>&nbsp;<span class="op" id="5323818">==</span>&nbsp;<span class="num" id="5323821">1</span>&nbsp;<span class="op" id="5323823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5323827">r0</span>&nbsp;<span class="op" id="5323830">:=</span>&nbsp;<span class="builtintype" id="5323833">rune</span><span class="op" id="5323837">[</span><span class="num" id="5323838">0</span><span class="op" id="5323839">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5323843">if</span>&nbsp;<span class="ident" id="5323846">r</span>&nbsp;<span class="op" id="5323848">==</span>&nbsp;<span class="ident" id="5323851">r0</span>&nbsp;<span class="op" id="5323854">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5323859">return</span>&nbsp;<span class="num" id="5323866">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5323870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5323874">if</span>&nbsp;<span class="ident" id="5323877">Flags</span><span class="op" id="5323882">(</span><span class="ident" id="5323883">i</span><span class="op" id="5323884">.</span><span class="ident" id="5323885">Arg</span><span class="op" id="5323888">)</span><span class="op" id="5323889">&amp;</span><span class="ident" id="5323890">FoldCase</span>&nbsp;<span class="op" id="5323899">!=</span>&nbsp;<span class="num" id="5323902">0</span>&nbsp;<span class="op" id="5323904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5323909">for</span>&nbsp;<span class="ident" id="5323913">r1</span>&nbsp;<span class="op" id="5323916">:=</span>&nbsp;<span class="ident" id="5323919">unicode</span><span class="op" id="5323926">.</span><span class="ident" id="5323927">SimpleFold</span><span class="op" id="5323937">(</span><span class="ident" id="5323938">r0</span><span class="op" id="5323940">)</span><span class="op" id="5323941">;</span>&nbsp;<span class="ident" id="5323943">r1</span>&nbsp;<span class="op" id="5323946">!=</span>&nbsp;<span class="ident" id="5323949">r0</span><span class="op" id="5323951">;</span>&nbsp;<span class="ident" id="5323953">r1</span>&nbsp;<span class="op" id="5323956">=</span>&nbsp;<span class="ident" id="5323958">unicode</span><span class="op" id="5323965">.</span><span class="ident" id="5323966">SimpleFold</span><span class="op" id="5323976">(</span><span class="ident" id="5323977">r1</span><span class="op" id="5323979">)</span>&nbsp;<span class="op" id="5323981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5323987">if</span>&nbsp;<span class="ident" id="5323990">r</span>&nbsp;<span class="op" id="5323992">==</span>&nbsp;<span class="ident" id="5323995">r1</span>&nbsp;<span class="op" id="5323998">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5324005">return</span>&nbsp;<span class="num" id="5324012">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5324018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5324023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5324027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5324031">return</span>&nbsp;<span class="ident" id="5324038">noMatch</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5324047">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5324051">//&nbsp;Peek&nbsp;at&nbsp;the&nbsp;first&nbsp;few&nbsp;pairs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5324084">//&nbsp;Should&nbsp;handle&nbsp;ASCII&nbsp;well.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5324114">for</span>&nbsp;<span class="ident" id="5324118">j</span>&nbsp;<span class="op" id="5324120">:=</span>&nbsp;<span class="num" id="5324123">0</span><span class="op" id="5324124">;</span>&nbsp;<span class="ident" id="5324126">j</span>&nbsp;<span class="op" id="5324128">&lt;</span>&nbsp;<span class="builtinfunc" id="5324130">len</span><span class="op" id="5324133">(</span><span class="builtintype" id="5324134">rune</span><span class="op" id="5324138">)</span>&nbsp;<span class="op" id="5324140">&amp;&amp;</span>&nbsp;<span class="ident" id="5324143">j</span>&nbsp;<span class="op" id="5324145">&lt;=</span>&nbsp;<span class="num" id="5324148">8</span><span class="op" id="5324149">;</span>&nbsp;<span class="ident" id="5324151">j</span>&nbsp;<span class="op" id="5324153">+=</span>&nbsp;<span class="num" id="5324156">2</span>&nbsp;<span class="op" id="5324158">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5324162">if</span>&nbsp;<span class="ident" id="5324165">r</span>&nbsp;<span class="op" id="5324167">&lt;</span>&nbsp;<span class="builtintype" id="5324169">rune</span><span class="op" id="5324173">[</span><span class="ident" id="5324174">j</span><span class="op" id="5324175">]</span>&nbsp;<span class="op" id="5324177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5324182">return</span>&nbsp;<span class="ident" id="5324189">noMatch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5324199">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5324203">if</span>&nbsp;<span class="ident" id="5324206">r</span>&nbsp;<span class="op" id="5324208">&lt;=</span>&nbsp;<span class="builtintype" id="5324211">rune</span><span class="op" id="5324215">[</span><span class="ident" id="5324216">j</span><span class="op" id="5324217">+</span><span class="num" id="5324218">1</span><span class="op" id="5324219">]</span>&nbsp;<span class="op" id="5324221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5324226">return</span>&nbsp;<span class="ident" id="5324233">j</span>&nbsp;<span class="op" id="5324235">/</span>&nbsp;<span class="num" id="5324237">2</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5324241">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5324244">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5324248">//&nbsp;Otherwise&nbsp;binary&nbsp;search.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5324277">lo</span>&nbsp;<span class="op" id="5324280">:=</span>&nbsp;<span class="num" id="5324283">0</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5324286">hi</span>&nbsp;<span class="op" id="5324289">:=</span>&nbsp;<span class="builtinfunc" id="5324292">len</span><span class="op" id="5324295">(</span><span class="builtintype" id="5324296">rune</span><span class="op" id="5324300">)</span>&nbsp;<span class="op" id="5324302">/</span>&nbsp;<span class="num" id="5324304">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5324307">for</span>&nbsp;<span class="ident" id="5324311">lo</span>&nbsp;<span class="op" id="5324314">&lt;</span>&nbsp;<span class="ident" id="5324316">hi</span>&nbsp;<span class="op" id="5324319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5324323">m</span>&nbsp;<span class="op" id="5324325">:=</span>&nbsp;<span class="ident" id="5324328">lo</span>&nbsp;<span class="op" id="5324331">+</span>&nbsp;<span class="op" id="5324333">(</span><span class="ident" id="5324334">hi</span><span class="op" id="5324336">-</span><span class="ident" id="5324337">lo</span><span class="op" id="5324339">)</span><span class="op" id="5324340">/</span><span class="num" id="5324341">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5324345">if</span>&nbsp;<span class="ident" id="5324348">c</span>&nbsp;<span class="op" id="5324350">:=</span>&nbsp;<span class="builtintype" id="5324353">rune</span><span class="op" id="5324357">[</span><span class="num" id="5324358">2</span><span class="op" id="5324359">*</span><span class="ident" id="5324360">m</span><span class="op" id="5324361">]</span><span class="op" id="5324362">;</span>&nbsp;<span class="ident" id="5324364">c</span>&nbsp;<span class="op" id="5324366">&lt;=</span>&nbsp;<span class="ident" id="5324369">r</span>&nbsp;<span class="op" id="5324371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5324376">if</span>&nbsp;<span class="ident" id="5324379">r</span>&nbsp;<span class="op" id="5324381">&lt;=</span>&nbsp;<span class="builtintype" id="5324384">rune</span><span class="op" id="5324388">[</span><span class="num" id="5324389">2</span><span class="op" id="5324390">*</span><span class="ident" id="5324391">m</span><span class="op" id="5324392">+</span><span class="num" id="5324393">1</span><span class="op" id="5324394">]</span>&nbsp;<span class="op" id="5324396">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5324402">return</span>&nbsp;<span class="ident" id="5324409">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5324414">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5324419">lo</span>&nbsp;<span class="op" id="5324422">=</span>&nbsp;<span class="ident" id="5324424">m</span>&nbsp;<span class="op" id="5324426">+</span>&nbsp;<span class="num" id="5324428">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5324432">}</span>&nbsp;<span class="keyword" id="5324434">else</span>&nbsp;<span class="op" id="5324439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5324444">hi</span>&nbsp;<span class="op" id="5324447">=</span>&nbsp;<span class="ident" id="5324449">m</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5324453">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5324456">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5324459">return</span>&nbsp;<span class="ident" id="5324466">noMatch</span><br>
<span class="lineno"></span><span class="op" id="5324474">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="comment" id="5324477">//&nbsp;As&nbsp;per&nbsp;re2&#39;s&nbsp;Prog::IsWordChar.&nbsp;Determines&nbsp;whether&nbsp;rune&nbsp;is&nbsp;an&nbsp;ASCII&nbsp;word&nbsp;char.</span><br>
<span class="lineno"></span><span class="comment" id="5324558">//&nbsp;Since&nbsp;we&nbsp;act&nbsp;on&nbsp;runes,&nbsp;it&nbsp;would&nbsp;be&nbsp;easy&nbsp;to&nbsp;support&nbsp;Unicode&nbsp;here.</span><br>
<span class="lineno"></span><span class="keyword" id="5324626">func</span>&nbsp;<span class="ident" id="5324631">wordRune</span><span class="op" id="5324639">(</span><span class="ident" id="5324640">r</span>&nbsp;<span class="builtintype" id="5324642">rune</span><span class="op" id="5324646">)</span>&nbsp;<span class="builtintype" id="5324648">bool</span>&nbsp;<span class="op" id="5324653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5324656">return</span>&nbsp;<span class="ident" id="5324663">r</span>&nbsp;<span class="op" id="5324665">==</span>&nbsp;<span class="string" id="5324668">&#39;_&#39;</span>&nbsp;<span class="op" id="5324672">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5324677">(</span><span class="string" id="5324678">&#39;A&#39;</span>&nbsp;<span class="op" id="5324682">&lt;=</span>&nbsp;<span class="ident" id="5324685">r</span>&nbsp;<span class="op" id="5324687">&amp;&amp;</span>&nbsp;<span class="ident" id="5324690">r</span>&nbsp;<span class="op" id="5324692">&lt;=</span>&nbsp;<span class="string" id="5324695">&#39;Z&#39;</span><span class="op" id="5324698">)</span>&nbsp;<span class="op" id="5324700">||</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5324705">(</span><span class="string" id="5324706">&#39;a&#39;</span>&nbsp;<span class="op" id="5324710">&lt;=</span>&nbsp;<span class="ident" id="5324713">r</span>&nbsp;<span class="op" id="5324715">&amp;&amp;</span>&nbsp;<span class="ident" id="5324718">r</span>&nbsp;<span class="op" id="5324720">&lt;=</span>&nbsp;<span class="string" id="5324723">&#39;z&#39;</span><span class="op" id="5324726">)</span>&nbsp;<span class="op" id="5324728">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5324733">(</span><span class="string" id="5324734">&#39;0&#39;</span>&nbsp;<span class="op" id="5324738">&lt;=</span>&nbsp;<span class="ident" id="5324741">r</span>&nbsp;<span class="op" id="5324743">&amp;&amp;</span>&nbsp;<span class="ident" id="5324746">r</span>&nbsp;<span class="op" id="5324748">&lt;=</span>&nbsp;<span class="string" id="5324751">&#39;9&#39;</span><span class="op" id="5324754">)</span><br>
<span class="lineno"></span><span class="op" id="5324756">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5324759">//&nbsp;MatchEmptyWidth&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;instruction&nbsp;matches</span><br>
<span class="lineno">260</span><span class="comment" id="5324818">//&nbsp;an&nbsp;empty&nbsp;string&nbsp;between&nbsp;the&nbsp;runes&nbsp;before&nbsp;and&nbsp;after.</span><br>
<span class="lineno"></span><span class="comment" id="5324873">//&nbsp;It&nbsp;should&nbsp;only&nbsp;be&nbsp;called&nbsp;when&nbsp;i.Op&nbsp;==&nbsp;InstEmptyWidth.</span><br>
<span class="lineno"></span><span class="keyword" id="5324930">func</span>&nbsp;<span class="op" id="5324935">(</span><span class="ident" id="5324936">i</span>&nbsp;<span class="op" id="5324938">*</span><span class="ident" id="5324939">Inst</span><span class="op" id="5324943">)</span>&nbsp;<span class="ident" id="5324945">MatchEmptyWidth</span><span class="op" id="5324960">(</span><span class="ident" id="5324961">before</span>&nbsp;<span class="builtintype" id="5324968">rune</span><span class="op" id="5324972">,</span>&nbsp;<span class="ident" id="5324974">after</span>&nbsp;<span class="builtintype" id="5324980">rune</span><span class="op" id="5324984">)</span>&nbsp;<span class="builtintype" id="5324986">bool</span>&nbsp;<span class="op" id="5324991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5324994">switch</span>&nbsp;<span class="ident" id="5325001">EmptyOp</span><span class="op" id="5325008">(</span><span class="ident" id="5325009">i</span><span class="op" id="5325010">.</span><span class="ident" id="5325011">Arg</span><span class="op" id="5325014">)</span>&nbsp;<span class="op" id="5325016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5325019">case</span>&nbsp;<span class="ident" id="5325024">EmptyBeginLine</span><span class="op" id="5325038">:</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5325042">return</span>&nbsp;<span class="ident" id="5325049">before</span>&nbsp;<span class="op" id="5325056">==</span>&nbsp;<span class="string" id="5325059">&#39;\n&#39;</span>&nbsp;<span class="op" id="5325064">||</span>&nbsp;<span class="ident" id="5325067">before</span>&nbsp;<span class="op" id="5325074">==</span>&nbsp;<span class="op" id="5325077">-</span><span class="num" id="5325078">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5325081">case</span>&nbsp;<span class="ident" id="5325086">EmptyEndLine</span><span class="op" id="5325098">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5325102">return</span>&nbsp;<span class="ident" id="5325109">after</span>&nbsp;<span class="op" id="5325115">==</span>&nbsp;<span class="string" id="5325118">&#39;\n&#39;</span>&nbsp;<span class="op" id="5325123">||</span>&nbsp;<span class="ident" id="5325126">after</span>&nbsp;<span class="op" id="5325132">==</span>&nbsp;<span class="op" id="5325135">-</span><span class="num" id="5325136">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5325139">case</span>&nbsp;<span class="ident" id="5325144">EmptyBeginText</span><span class="op" id="5325158">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5325162">return</span>&nbsp;<span class="ident" id="5325169">before</span>&nbsp;<span class="op" id="5325176">==</span>&nbsp;<span class="op" id="5325179">-</span><span class="num" id="5325180">1</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5325183">case</span>&nbsp;<span class="ident" id="5325188">EmptyEndText</span><span class="op" id="5325200">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5325204">return</span>&nbsp;<span class="ident" id="5325211">after</span>&nbsp;<span class="op" id="5325217">==</span>&nbsp;<span class="op" id="5325220">-</span><span class="num" id="5325221">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5325224">case</span>&nbsp;<span class="ident" id="5325229">EmptyWordBoundary</span><span class="op" id="5325246">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5325250">return</span>&nbsp;<span class="ident" id="5325257">wordRune</span><span class="op" id="5325265">(</span><span class="ident" id="5325266">before</span><span class="op" id="5325272">)</span>&nbsp;<span class="op" id="5325274">!=</span>&nbsp;<span class="ident" id="5325277">wordRune</span><span class="op" id="5325285">(</span><span class="ident" id="5325286">after</span><span class="op" id="5325291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5325294">case</span>&nbsp;<span class="ident" id="5325299">EmptyNoWordBoundary</span><span class="op" id="5325318">:</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5325322">return</span>&nbsp;<span class="ident" id="5325329">wordRune</span><span class="op" id="5325337">(</span><span class="ident" id="5325338">before</span><span class="op" id="5325344">)</span>&nbsp;<span class="op" id="5325346">==</span>&nbsp;<span class="ident" id="5325349">wordRune</span><span class="op" id="5325357">(</span><span class="ident" id="5325358">after</span><span class="op" id="5325363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5325366">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5325369">panic</span><span class="op" id="5325374">(</span><span class="string" id="5325375">&#34;unknown&nbsp;empty&nbsp;width&nbsp;arg&#34;</span><span class="op" id="5325400">)</span><br>
<span class="lineno"></span><span class="op" id="5325402">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span><span class="keyword" id="5325405">func</span>&nbsp;<span class="op" id="5325410">(</span><span class="ident" id="5325411">i</span>&nbsp;<span class="op" id="5325413">*</span><span class="ident" id="5325414">Inst</span><span class="op" id="5325418">)</span>&nbsp;<span class="ident" id="5325420">String</span><span class="op" id="5325426">(</span><span class="op" id="5325427">)</span>&nbsp;<span class="builtintype" id="5325429">string</span>&nbsp;<span class="op" id="5325436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5325439">var</span>&nbsp;<span class="ident" id="5325443">b</span>&nbsp;<span class="ident" id="5325445">bytes</span><span class="op" id="5325450">.</span><span class="ident" id="5325451">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5325459">dumpInst</span><span class="op" id="5325467">(</span><span class="op" id="5325468">&amp;</span><span class="ident" id="5325469">b</span><span class="op" id="5325470">,</span>&nbsp;<span class="ident" id="5325472">i</span><span class="op" id="5325473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5325476">return</span>&nbsp;<span class="ident" id="5325483">b</span><span class="op" id="5325484">.</span><span class="ident" id="5325485">String</span><span class="op" id="5325491">(</span><span class="op" id="5325492">)</span><br>
<span class="lineno"></span><span class="op" id="5325494">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span><span class="keyword" id="5325497">func</span>&nbsp;<span class="ident" id="5325502">bw</span><span class="op" id="5325504">(</span><span class="ident" id="5325505">b</span>&nbsp;<span class="op" id="5325507">*</span><span class="ident" id="5325508">bytes</span><span class="op" id="5325513">.</span><span class="ident" id="5325514">Buffer</span><span class="op" id="5325520">,</span>&nbsp;<span class="ident" id="5325522">args</span>&nbsp;<span class="op" id="5325527">...</span><span class="builtintype" id="5325530">string</span><span class="op" id="5325536">)</span>&nbsp;<span class="op" id="5325538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5325541">for</span>&nbsp;<span class="ident" id="5325545">_</span><span class="op" id="5325546">,</span>&nbsp;<span class="ident" id="5325548">s</span>&nbsp;<span class="op" id="5325550">:=</span>&nbsp;<span class="keyword" id="5325553">range</span>&nbsp;<span class="ident" id="5325559">args</span>&nbsp;<span class="op" id="5325564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5325568">b</span><span class="op" id="5325569">.</span><span class="ident" id="5325570">WriteString</span><span class="op" id="5325581">(</span><span class="ident" id="5325582">s</span><span class="op" id="5325583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5325586">}</span><br>
<span class="lineno">290</span><span class="op" id="5325588">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5325591">func</span>&nbsp;<span class="ident" id="5325596">dumpProg</span><span class="op" id="5325604">(</span><span class="ident" id="5325605">b</span>&nbsp;<span class="op" id="5325607">*</span><span class="ident" id="5325608">bytes</span><span class="op" id="5325613">.</span><span class="ident" id="5325614">Buffer</span><span class="op" id="5325620">,</span>&nbsp;<span class="ident" id="5325622">p</span>&nbsp;<span class="op" id="5325624">*</span><span class="ident" id="5325625">Prog</span><span class="op" id="5325629">)</span>&nbsp;<span class="op" id="5325631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5325634">for</span>&nbsp;<span class="ident" id="5325638">j</span>&nbsp;<span class="op" id="5325640">:=</span>&nbsp;<span class="keyword" id="5325643">range</span>&nbsp;<span class="ident" id="5325649">p</span><span class="op" id="5325650">.</span><span class="ident" id="5325651">Inst</span>&nbsp;<span class="op" id="5325656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5325660">i</span>&nbsp;<span class="op" id="5325662">:=</span>&nbsp;<span class="op" id="5325665">&amp;</span><span class="ident" id="5325666">p</span><span class="op" id="5325667">.</span><span class="ident" id="5325668">Inst</span><span class="op" id="5325672">[</span><span class="ident" id="5325673">j</span><span class="op" id="5325674">]</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5325678">pc</span>&nbsp;<span class="op" id="5325681">:=</span>&nbsp;<span class="ident" id="5325684">strconv</span><span class="op" id="5325691">.</span><span class="ident" id="5325692">Itoa</span><span class="op" id="5325696">(</span><span class="ident" id="5325697">j</span><span class="op" id="5325698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5325702">if</span>&nbsp;<span class="builtinfunc" id="5325705">len</span><span class="op" id="5325708">(</span><span class="ident" id="5325709">pc</span><span class="op" id="5325711">)</span>&nbsp;<span class="op" id="5325713">&lt;</span>&nbsp;<span class="num" id="5325715">3</span>&nbsp;<span class="op" id="5325717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5325722">b</span><span class="op" id="5325723">.</span><span class="ident" id="5325724">WriteString</span><span class="op" id="5325735">(</span><span class="string" id="5325736">&#34;&nbsp;&nbsp;&nbsp;&#34;</span><span class="op" id="5325741">[</span><span class="builtinfunc" id="5325742">len</span><span class="op" id="5325745">(</span><span class="ident" id="5325746">pc</span><span class="op" id="5325748">)</span><span class="op" id="5325749">:</span><span class="op" id="5325750">]</span><span class="op" id="5325751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5325755">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5325759">if</span>&nbsp;<span class="ident" id="5325762">j</span>&nbsp;<span class="op" id="5325764">==</span>&nbsp;<span class="ident" id="5325767">p</span><span class="op" id="5325768">.</span><span class="ident" id="5325769">Start</span>&nbsp;<span class="op" id="5325775">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5325780">pc</span>&nbsp;<span class="op" id="5325783">+=</span>&nbsp;<span class="string" id="5325786">&#34;*&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5325792">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5325796">bw</span><span class="op" id="5325798">(</span><span class="ident" id="5325799">b</span><span class="op" id="5325800">,</span>&nbsp;<span class="ident" id="5325802">pc</span><span class="op" id="5325804">,</span>&nbsp;<span class="string" id="5325806">&#34;\t&#34;</span><span class="op" id="5325810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5325814">dumpInst</span><span class="op" id="5325822">(</span><span class="ident" id="5325823">b</span><span class="op" id="5325824">,</span>&nbsp;<span class="ident" id="5325826">i</span><span class="op" id="5325827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5325831">bw</span><span class="op" id="5325833">(</span><span class="ident" id="5325834">b</span><span class="op" id="5325835">,</span>&nbsp;<span class="string" id="5325837">&#34;\n&#34;</span><span class="op" id="5325841">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5325844">}</span><br>
<span class="lineno"></span><span class="op" id="5325846">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5325849">func</span>&nbsp;<span class="ident" id="5325854">u32</span><span class="op" id="5325857">(</span><span class="ident" id="5325858">i</span>&nbsp;<span class="builtintype" id="5325860">uint32</span><span class="op" id="5325866">)</span>&nbsp;<span class="builtintype" id="5325868">string</span>&nbsp;<span class="op" id="5325875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5325878">return</span>&nbsp;<span class="ident" id="5325885">strconv</span><span class="op" id="5325892">.</span><span class="ident" id="5325893">FormatUint</span><span class="op" id="5325903">(</span><span class="ident" id="5325904">uint64</span><span class="op" id="5325910">(</span><span class="ident" id="5325911">i</span><span class="op" id="5325912">)</span><span class="op" id="5325913">,</span>&nbsp;<span class="num" id="5325915">10</span><span class="op" id="5325917">)</span><br>
<span class="lineno">310</span><span class="op" id="5325919">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5325922">func</span>&nbsp;<span class="ident" id="5325927">dumpInst</span><span class="op" id="5325935">(</span><span class="ident" id="5325936">b</span>&nbsp;<span class="op" id="5325938">*</span><span class="ident" id="5325939">bytes</span><span class="op" id="5325944">.</span><span class="ident" id="5325945">Buffer</span><span class="op" id="5325951">,</span>&nbsp;<span class="ident" id="5325953">i</span>&nbsp;<span class="op" id="5325955">*</span><span class="ident" id="5325956">Inst</span><span class="op" id="5325960">)</span>&nbsp;<span class="op" id="5325962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5325965">switch</span>&nbsp;<span class="ident" id="5325972">i</span><span class="op" id="5325973">.</span><span class="ident" id="5325974">Op</span>&nbsp;<span class="op" id="5325977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5325980">case</span>&nbsp;<span class="ident" id="5325985">InstAlt</span><span class="op" id="5325992">:</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5325996">bw</span><span class="op" id="5325998">(</span><span class="ident" id="5325999">b</span><span class="op" id="5326000">,</span>&nbsp;<span class="string" id="5326002">&#34;alt&nbsp;-&gt;&nbsp;&#34;</span><span class="op" id="5326011">,</span>&nbsp;<span class="ident" id="5326013">u32</span><span class="op" id="5326016">(</span><span class="ident" id="5326017">i</span><span class="op" id="5326018">.</span><span class="ident" id="5326019">Out</span><span class="op" id="5326022">)</span><span class="op" id="5326023">,</span>&nbsp;<span class="string" id="5326025">&#34;,&nbsp;&#34;</span><span class="op" id="5326029">,</span>&nbsp;<span class="ident" id="5326031">u32</span><span class="op" id="5326034">(</span><span class="ident" id="5326035">i</span><span class="op" id="5326036">.</span><span class="ident" id="5326037">Arg</span><span class="op" id="5326040">)</span><span class="op" id="5326041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5326044">case</span>&nbsp;<span class="ident" id="5326049">InstAltMatch</span><span class="op" id="5326061">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5326065">bw</span><span class="op" id="5326067">(</span><span class="ident" id="5326068">b</span><span class="op" id="5326069">,</span>&nbsp;<span class="string" id="5326071">&#34;altmatch&nbsp;-&gt;&nbsp;&#34;</span><span class="op" id="5326085">,</span>&nbsp;<span class="ident" id="5326087">u32</span><span class="op" id="5326090">(</span><span class="ident" id="5326091">i</span><span class="op" id="5326092">.</span><span class="ident" id="5326093">Out</span><span class="op" id="5326096">)</span><span class="op" id="5326097">,</span>&nbsp;<span class="string" id="5326099">&#34;,&nbsp;&#34;</span><span class="op" id="5326103">,</span>&nbsp;<span class="ident" id="5326105">u32</span><span class="op" id="5326108">(</span><span class="ident" id="5326109">i</span><span class="op" id="5326110">.</span><span class="ident" id="5326111">Arg</span><span class="op" id="5326114">)</span><span class="op" id="5326115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5326118">case</span>&nbsp;<span class="ident" id="5326123">InstCapture</span><span class="op" id="5326134">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5326138">bw</span><span class="op" id="5326140">(</span><span class="ident" id="5326141">b</span><span class="op" id="5326142">,</span>&nbsp;<span class="string" id="5326144">&#34;cap&nbsp;&#34;</span><span class="op" id="5326150">,</span>&nbsp;<span class="ident" id="5326152">u32</span><span class="op" id="5326155">(</span><span class="ident" id="5326156">i</span><span class="op" id="5326157">.</span><span class="ident" id="5326158">Arg</span><span class="op" id="5326161">)</span><span class="op" id="5326162">,</span>&nbsp;<span class="string" id="5326164">&#34;&nbsp;-&gt;&nbsp;&#34;</span><span class="op" id="5326170">,</span>&nbsp;<span class="ident" id="5326172">u32</span><span class="op" id="5326175">(</span><span class="ident" id="5326176">i</span><span class="op" id="5326177">.</span><span class="ident" id="5326178">Out</span><span class="op" id="5326181">)</span><span class="op" id="5326182">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5326185">case</span>&nbsp;<span class="ident" id="5326190">InstEmptyWidth</span><span class="op" id="5326204">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5326208">bw</span><span class="op" id="5326210">(</span><span class="ident" id="5326211">b</span><span class="op" id="5326212">,</span>&nbsp;<span class="string" id="5326214">&#34;empty&nbsp;&#34;</span><span class="op" id="5326222">,</span>&nbsp;<span class="ident" id="5326224">u32</span><span class="op" id="5326227">(</span><span class="ident" id="5326228">i</span><span class="op" id="5326229">.</span><span class="ident" id="5326230">Arg</span><span class="op" id="5326233">)</span><span class="op" id="5326234">,</span>&nbsp;<span class="string" id="5326236">&#34;&nbsp;-&gt;&nbsp;&#34;</span><span class="op" id="5326242">,</span>&nbsp;<span class="ident" id="5326244">u32</span><span class="op" id="5326247">(</span><span class="ident" id="5326248">i</span><span class="op" id="5326249">.</span><span class="ident" id="5326250">Out</span><span class="op" id="5326253">)</span><span class="op" id="5326254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5326257">case</span>&nbsp;<span class="ident" id="5326262">InstMatch</span><span class="op" id="5326271">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5326275">bw</span><span class="op" id="5326277">(</span><span class="ident" id="5326278">b</span><span class="op" id="5326279">,</span>&nbsp;<span class="string" id="5326281">&#34;match&#34;</span><span class="op" id="5326288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5326291">case</span>&nbsp;<span class="ident" id="5326296">InstFail</span><span class="op" id="5326304">:</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5326308">bw</span><span class="op" id="5326310">(</span><span class="ident" id="5326311">b</span><span class="op" id="5326312">,</span>&nbsp;<span class="string" id="5326314">&#34;fail&#34;</span><span class="op" id="5326320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5326323">case</span>&nbsp;<span class="ident" id="5326328">InstNop</span><span class="op" id="5326335">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5326339">bw</span><span class="op" id="5326341">(</span><span class="ident" id="5326342">b</span><span class="op" id="5326343">,</span>&nbsp;<span class="string" id="5326345">&#34;nop&nbsp;-&gt;&nbsp;&#34;</span><span class="op" id="5326354">,</span>&nbsp;<span class="ident" id="5326356">u32</span><span class="op" id="5326359">(</span><span class="ident" id="5326360">i</span><span class="op" id="5326361">.</span><span class="ident" id="5326362">Out</span><span class="op" id="5326365">)</span><span class="op" id="5326366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5326369">case</span>&nbsp;<span class="ident" id="5326374">InstRune</span><span class="op" id="5326382">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5326386">if</span>&nbsp;<span class="ident" id="5326389">i</span><span class="op" id="5326390">.</span><span class="ident" id="5326391">Rune</span>&nbsp;<span class="op" id="5326396">==</span>&nbsp;<span class="ident" id="5326399">nil</span>&nbsp;<span class="op" id="5326403">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5326408">//&nbsp;shouldn&#39;t&nbsp;happen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5326431">bw</span><span class="op" id="5326433">(</span><span class="ident" id="5326434">b</span><span class="op" id="5326435">,</span>&nbsp;<span class="string" id="5326437">&#34;rune&nbsp;&lt;nil&gt;&#34;</span><span class="op" id="5326449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5326453">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5326457">bw</span><span class="op" id="5326459">(</span><span class="ident" id="5326460">b</span><span class="op" id="5326461">,</span>&nbsp;<span class="string" id="5326463">&#34;rune&nbsp;&#34;</span><span class="op" id="5326470">,</span>&nbsp;<span class="ident" id="5326472">strconv</span><span class="op" id="5326479">.</span><span class="ident" id="5326480">QuoteToASCII</span><span class="op" id="5326492">(</span><span class="builtintype" id="5326493">string</span><span class="op" id="5326499">(</span><span class="ident" id="5326500">i</span><span class="op" id="5326501">.</span><span class="ident" id="5326502">Rune</span><span class="op" id="5326506">)</span><span class="op" id="5326507">)</span><span class="op" id="5326508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5326512">if</span>&nbsp;<span class="ident" id="5326515">Flags</span><span class="op" id="5326520">(</span><span class="ident" id="5326521">i</span><span class="op" id="5326522">.</span><span class="ident" id="5326523">Arg</span><span class="op" id="5326526">)</span><span class="op" id="5326527">&amp;</span><span class="ident" id="5326528">FoldCase</span>&nbsp;<span class="op" id="5326537">!=</span>&nbsp;<span class="num" id="5326540">0</span>&nbsp;<span class="op" id="5326542">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5326547">bw</span><span class="op" id="5326549">(</span><span class="ident" id="5326550">b</span><span class="op" id="5326551">,</span>&nbsp;<span class="string" id="5326553">&#34;/i&#34;</span><span class="op" id="5326557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5326561">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5326565">bw</span><span class="op" id="5326567">(</span><span class="ident" id="5326568">b</span><span class="op" id="5326569">,</span>&nbsp;<span class="string" id="5326571">&#34;&nbsp;-&gt;&nbsp;&#34;</span><span class="op" id="5326577">,</span>&nbsp;<span class="ident" id="5326579">u32</span><span class="op" id="5326582">(</span><span class="ident" id="5326583">i</span><span class="op" id="5326584">.</span><span class="ident" id="5326585">Out</span><span class="op" id="5326588">)</span><span class="op" id="5326589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5326592">case</span>&nbsp;<span class="ident" id="5326597">InstRune1</span><span class="op" id="5326606">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5326610">bw</span><span class="op" id="5326612">(</span><span class="ident" id="5326613">b</span><span class="op" id="5326614">,</span>&nbsp;<span class="string" id="5326616">&#34;rune1&nbsp;&#34;</span><span class="op" id="5326624">,</span>&nbsp;<span class="ident" id="5326626">strconv</span><span class="op" id="5326633">.</span><span class="ident" id="5326634">QuoteToASCII</span><span class="op" id="5326646">(</span><span class="builtintype" id="5326647">string</span><span class="op" id="5326653">(</span><span class="ident" id="5326654">i</span><span class="op" id="5326655">.</span><span class="ident" id="5326656">Rune</span><span class="op" id="5326660">)</span><span class="op" id="5326661">)</span><span class="op" id="5326662">,</span>&nbsp;<span class="string" id="5326664">&#34;&nbsp;-&gt;&nbsp;&#34;</span><span class="op" id="5326670">,</span>&nbsp;<span class="ident" id="5326672">u32</span><span class="op" id="5326675">(</span><span class="ident" id="5326676">i</span><span class="op" id="5326677">.</span><span class="ident" id="5326678">Out</span><span class="op" id="5326681">)</span><span class="op" id="5326682">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5326685">case</span>&nbsp;<span class="ident" id="5326690">InstRuneAny</span><span class="op" id="5326701">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5326705">bw</span><span class="op" id="5326707">(</span><span class="ident" id="5326708">b</span><span class="op" id="5326709">,</span>&nbsp;<span class="string" id="5326711">&#34;any&nbsp;-&gt;&nbsp;&#34;</span><span class="op" id="5326720">,</span>&nbsp;<span class="ident" id="5326722">u32</span><span class="op" id="5326725">(</span><span class="ident" id="5326726">i</span><span class="op" id="5326727">.</span><span class="ident" id="5326728">Out</span><span class="op" id="5326731">)</span><span class="op" id="5326732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5326735">case</span>&nbsp;<span class="ident" id="5326740">InstRuneAnyNotNL</span><span class="op" id="5326756">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5326760">bw</span><span class="op" id="5326762">(</span><span class="ident" id="5326763">b</span><span class="op" id="5326764">,</span>&nbsp;<span class="string" id="5326766">&#34;anynotnl&nbsp;-&gt;&nbsp;&#34;</span><span class="op" id="5326780">,</span>&nbsp;<span class="ident" id="5326782">u32</span><span class="op" id="5326785">(</span><span class="ident" id="5326786">i</span><span class="op" id="5326787">.</span><span class="ident" id="5326788">Out</span><span class="op" id="5326791">)</span><span class="op" id="5326792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5326795">}</span><br>
<span class="lineno">345</span><span class="op" id="5326797">}</span>
</div>
</body>
</html>
