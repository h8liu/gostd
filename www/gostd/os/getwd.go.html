<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>os</h2>
<ul>
<li><a href="/gostd/os/dir_unix.go.html">dir_unix.go</a></li>
<li><a href="/gostd/os/doc.go.html">doc.go</a></li>
<li><a href="/gostd/os/env.go.html">env.go</a></li>
<li><a href="/gostd/os/env_test.go.html">env_test.go</a></li>
<li><a href="/gostd/os/env_unix_test.go.html">env_unix_test.go</a></li>
<li><a href="/gostd/os/error.go.html">error.go</a></li>
<li><a href="/gostd/os/error_test.go.html">error_test.go</a></li>
<li><a href="/gostd/os/error_unix.go.html">error_unix.go</a></li>
<li><a href="/gostd/os/exec.go.html">exec.go</a></li>
<li><a href="/gostd/os/exec_posix.go.html">exec_posix.go</a></li>
<li><a href="/gostd/os/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/os/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/os/file.go.html">file.go</a></li>
<li><a href="/gostd/os/file_posix.go.html">file_posix.go</a></li>
<li><a href="/gostd/os/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/os/getwd.go.html" class="current">getwd.go</a></li>
<li><a href="/gostd/os/os_test.go.html">os_test.go</a></li>
<li><a href="/gostd/os/os_unix_test.go.html">os_unix_test.go</a></li>
<li><a href="/gostd/os/path.go.html">path.go</a></li>
<li><a href="/gostd/os/path_test.go.html">path_test.go</a></li>
<li><a href="/gostd/os/path_unix.go.html">path_unix.go</a></li>
<li><a href="/gostd/os/pipe_linux.go.html">pipe_linux.go</a></li>
<li><a href="/gostd/os/proc.go.html">proc.go</a></li>
<li><a href="/gostd/os/stat_linux.go.html">stat_linux.go</a></li>
<li><a href="/gostd/os/sys_linux.go.html">sys_linux.go</a></li>
<li><a href="/gostd/os/sys_unix.go.html">sys_unix.go</a></li>
<li><a href="/gostd/os/types.go.html">types.go</a></li>
<li><a href="/gostd/os/types_notwin.go.html">types_notwin.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2461391">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2461446">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2461500">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2461551">package</span>&nbsp;<span class="ident" id="2461559">os</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2461563">import</span>&nbsp;<span class="op" id="2461570">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2461573">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2461584">&#34;sync&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2461592">&#34;syscall&#34;</span><br>
<span class="lineno"></span><span class="op" id="2461602">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2461605">var</span>&nbsp;<span class="ident" id="2461609">getwdCache</span>&nbsp;<span class="keyword" id="2461620">struct</span>&nbsp;<span class="op" id="2461627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2461630"><a href="/gostd/os/getwd.go.html#2461584">sync</a></span><span class="op" id="2461634">.</span><span class="ident" id="2461635"><a href="/gostd/sync/mutex.go.html#1443974">Mutex</a></span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2461642">dir</span>&nbsp;<span class="builtintype" id="2461646">string</span><br>
<span class="lineno"></span><span class="op" id="2461653">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2461656">//&nbsp;useSyscallwd&nbsp;determines&nbsp;whether&nbsp;to&nbsp;use&nbsp;the&nbsp;return&nbsp;value&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="2461718">//&nbsp;syscall.Getwd&nbsp;based&nbsp;on&nbsp;its&nbsp;error.</span><br>
<span class="lineno">20</span><span class="keyword" id="2461755">var</span>&nbsp;<span class="ident" id="2461759">useSyscallwd</span>&nbsp;<span class="op" id="2461772">=</span>&nbsp;<span class="keyword" id="2461774">func</span><span class="op" id="2461778">(</span><span class="builtintype" id="2461779">error</span><span class="op" id="2461784">)</span>&nbsp;<span class="builtintype" id="2461786">bool</span>&nbsp;<span class="op" id="2461791">{</span>&nbsp;<span class="keyword" id="2461793">return</span>&nbsp;<span class="builtintype" id="2461800">true</span>&nbsp;<span class="op" id="2461805">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2461808">//&nbsp;Getwd&nbsp;returns&nbsp;a&nbsp;rooted&nbsp;path&nbsp;name&nbsp;corresponding&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2461865">//&nbsp;current&nbsp;directory.&nbsp;&nbsp;If&nbsp;the&nbsp;current&nbsp;directory&nbsp;can&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="2461920">//&nbsp;reached&nbsp;via&nbsp;multiple&nbsp;paths&nbsp;(due&nbsp;to&nbsp;symbolic&nbsp;links),</span><br>
<span class="lineno">25</span><span class="comment" id="2461975">//&nbsp;Getwd&nbsp;may&nbsp;return&nbsp;any&nbsp;one&nbsp;of&nbsp;them.</span><br>
<span class="lineno"></span><span class="keyword" id="2462012">func</span>&nbsp;<span class="ident" id="2462017">Getwd</span><span class="op" id="2462022">(</span><span class="op" id="2462023">)</span>&nbsp;<span class="op" id="2462025">(</span><span class="ident" id="2462026">dir</span>&nbsp;<span class="builtintype" id="2462030">string</span><span class="op" id="2462036">,</span>&nbsp;<span class="ident" id="2462038">err</span>&nbsp;<span class="builtintype" id="2462042">error</span><span class="op" id="2462047">)</span>&nbsp;<span class="op" id="2462049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2462052">if</span>&nbsp;<span class="ident" id="2462055"><a href="/gostd/os/getwd.go.html#2461573">runtime</a></span><span class="op" id="2462062">.</span><span class="ident" id="2462063"><a href="/gostd/runtime/extern.go.html#1533673">GOOS</a></span>&nbsp;<span class="op" id="2462068">==</span>&nbsp;<span class="string" id="2462071">&#34;windows&#34;</span>&nbsp;<span class="op" id="2462081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2462085">return</span>&nbsp;<span class="ident" id="2462092"><a href="/gostd/os/getwd.go.html#2461592">syscall</a></span><span class="op" id="2462099">.</span><span class="ident" id="2462100"><a href="/gostd/syscall/syscall_linux.go.html#2514764">Getwd</a></span><span class="op" id="2462105">(</span><span class="op" id="2462106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2462109">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2462113">//&nbsp;Clumsy&nbsp;but&nbsp;widespread&nbsp;kludge:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2462147">//&nbsp;if&nbsp;$PWD&nbsp;is&nbsp;set&nbsp;and&nbsp;matches&nbsp;&#34;.&#34;,&nbsp;use&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2462191">dot</span><span class="op" id="2462194">,</span>&nbsp;<span class="ident" id="2462196"><a href="/gostd/os/getwd.go.html#2462038">err</a></span>&nbsp;<span class="op" id="2462200">:=</span>&nbsp;<span class="ident" id="2462203"><a href="/gostd/os/file_unix.go.html#2455511">Stat</a></span><span class="op" id="2462207">(</span><span class="string" id="2462208">&#34;.&#34;</span><span class="op" id="2462211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2462214">if</span>&nbsp;<span class="ident" id="2462217"><a href="/gostd/os/getwd.go.html#2462038">err</a></span>&nbsp;<span class="op" id="2462221">!=</span>&nbsp;<span class="builtintype" id="2462224">nil</span>&nbsp;<span class="op" id="2462228">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2462232">return</span>&nbsp;<span class="string" id="2462239">&#34;&#34;</span><span class="op" id="2462241">,</span>&nbsp;<span class="ident" id="2462243"><a href="/gostd/os/getwd.go.html#2462038">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2462248">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2462251"><a href="/gostd/os/getwd.go.html#2462026">dir</a></span>&nbsp;<span class="op" id="2462255">=</span>&nbsp;<span class="ident" id="2462257"><a href="/gostd/os/env.go.html#2429715">Getenv</a></span><span class="op" id="2462263">(</span><span class="string" id="2462264">&#34;PWD&#34;</span><span class="op" id="2462269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2462272">if</span>&nbsp;<span class="builtinfunc" id="2462275">len</span><span class="op" id="2462278">(</span><span class="ident" id="2462279"><a href="/gostd/os/getwd.go.html#2462026">dir</a></span><span class="op" id="2462282">)</span>&nbsp;<span class="op" id="2462284">&gt;</span>&nbsp;<span class="num" id="2462286">0</span>&nbsp;<span class="op" id="2462288">&amp;&amp;</span>&nbsp;<span class="ident" id="2462291"><a href="/gostd/os/getwd.go.html#2462026">dir</a></span><span class="op" id="2462294">[</span><span class="num" id="2462295">0</span><span class="op" id="2462296">]</span>&nbsp;<span class="op" id="2462298">==</span>&nbsp;<span class="string" id="2462301">&#39;/&#39;</span>&nbsp;<span class="op" id="2462305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2462309">d</span><span class="op" id="2462310">,</span>&nbsp;<span class="ident" id="2462312">err</span>&nbsp;<span class="op" id="2462316">:=</span>&nbsp;<span class="ident" id="2462319"><a href="/gostd/os/file_unix.go.html#2455511">Stat</a></span><span class="op" id="2462323">(</span><span class="ident" id="2462324"><a href="/gostd/os/getwd.go.html#2462026">dir</a></span><span class="op" id="2462327">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2462331">if</span>&nbsp;<span class="ident" id="2462334"><a href="/gostd/os/getwd.go.html#2462312">err</a></span>&nbsp;<span class="op" id="2462338">==</span>&nbsp;<span class="builtintype" id="2462341">nil</span>&nbsp;<span class="op" id="2462345">&amp;&amp;</span>&nbsp;<span class="ident" id="2462348"><a href="/gostd/os/types.go.html#2475949">SameFile</a></span><span class="op" id="2462356">(</span><span class="ident" id="2462357"><a href="/gostd/os/getwd.go.html#2462191">dot</a></span><span class="op" id="2462360">,</span>&nbsp;<span class="ident" id="2462362"><a href="/gostd/os/getwd.go.html#2462309">d</a></span><span class="op" id="2462363">)</span>&nbsp;<span class="op" id="2462365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2462370">return</span>&nbsp;<span class="ident" id="2462377"><a href="/gostd/os/getwd.go.html#2462026">dir</a></span><span class="op" id="2462380">,</span>&nbsp;<span class="builtintype" id="2462382">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2462388">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2462391">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2462395">//&nbsp;If&nbsp;the&nbsp;operating&nbsp;system&nbsp;provides&nbsp;a&nbsp;Getwd&nbsp;call,&nbsp;use&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2462454">//&nbsp;Otherwise,&nbsp;we&#39;re&nbsp;trying&nbsp;to&nbsp;find&nbsp;our&nbsp;way&nbsp;back&nbsp;to&nbsp;&#34;.&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2462511">if</span>&nbsp;<span class="ident" id="2462514"><a href="/gostd/os/getwd.go.html#2461592">syscall</a></span><span class="op" id="2462521">.</span><span class="ident" id="2462522"><a href="/gostd/syscall/syscall_linux.go.html#2514690">ImplementsGetwd</a></span>&nbsp;<span class="op" id="2462538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2462542">s</span><span class="op" id="2462543">,</span>&nbsp;<span class="ident" id="2462545">e</span>&nbsp;<span class="op" id="2462547">:=</span>&nbsp;<span class="ident" id="2462550"><a href="/gostd/os/getwd.go.html#2461592">syscall</a></span><span class="op" id="2462557">.</span><span class="ident" id="2462558"><a href="/gostd/syscall/syscall_linux.go.html#2514764">Getwd</a></span><span class="op" id="2462563">(</span><span class="op" id="2462564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2462568">if</span>&nbsp;<span class="ident" id="2462571"><a href="/gostd/os/getwd.go.html#2461759">useSyscallwd</a></span><span class="op" id="2462583">(</span><span class="ident" id="2462584"><a href="/gostd/os/getwd.go.html#2462545">e</a></span><span class="op" id="2462585">)</span>&nbsp;<span class="op" id="2462587">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2462592">return</span>&nbsp;<span class="ident" id="2462599"><a href="/gostd/os/getwd.go.html#2462542">s</a></span><span class="op" id="2462600">,</span>&nbsp;<span class="ident" id="2462602"><a href="/gostd/os/error.go.html#2431472">NewSyscallError</a></span><span class="op" id="2462617">(</span><span class="string" id="2462618">&#34;getwd&#34;</span><span class="op" id="2462625">,</span>&nbsp;<span class="ident" id="2462627"><a href="/gostd/os/getwd.go.html#2462545">e</a></span><span class="op" id="2462628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2462632">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2462635">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2462639">//&nbsp;Apply&nbsp;same&nbsp;kludge&nbsp;but&nbsp;to&nbsp;cached&nbsp;dir&nbsp;instead&nbsp;of&nbsp;$PWD.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2462696"><a href="/gostd/os/getwd.go.html#2461609">getwdCache</a></span><span class="op" id="2462706">.</span><span class="ident" id="2462707"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="2462711">(</span><span class="op" id="2462712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2462715"><a href="/gostd/os/getwd.go.html#2462026">dir</a></span>&nbsp;<span class="op" id="2462719">=</span>&nbsp;<span class="ident" id="2462721"><a href="/gostd/os/getwd.go.html#2461609">getwdCache</a></span><span class="op" id="2462731">.</span><span class="ident" id="2462732"><a href="/gostd/os/getwd.go.html#2461642">dir</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2462737"><a href="/gostd/os/getwd.go.html#2461609">getwdCache</a></span><span class="op" id="2462747">.</span><span class="ident" id="2462748"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="2462754">(</span><span class="op" id="2462755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2462758">if</span>&nbsp;<span class="builtinfunc" id="2462761">len</span><span class="op" id="2462764">(</span><span class="ident" id="2462765"><a href="/gostd/os/getwd.go.html#2462026">dir</a></span><span class="op" id="2462768">)</span>&nbsp;<span class="op" id="2462770">&gt;</span>&nbsp;<span class="num" id="2462772">0</span>&nbsp;<span class="op" id="2462774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2462778">d</span><span class="op" id="2462779">,</span>&nbsp;<span class="ident" id="2462781">err</span>&nbsp;<span class="op" id="2462785">:=</span>&nbsp;<span class="ident" id="2462788"><a href="/gostd/os/file_unix.go.html#2455511">Stat</a></span><span class="op" id="2462792">(</span><span class="ident" id="2462793"><a href="/gostd/os/getwd.go.html#2462026">dir</a></span><span class="op" id="2462796">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2462800">if</span>&nbsp;<span class="ident" id="2462803"><a href="/gostd/os/getwd.go.html#2462781">err</a></span>&nbsp;<span class="op" id="2462807">==</span>&nbsp;<span class="builtintype" id="2462810">nil</span>&nbsp;<span class="op" id="2462814">&amp;&amp;</span>&nbsp;<span class="ident" id="2462817"><a href="/gostd/os/types.go.html#2475949">SameFile</a></span><span class="op" id="2462825">(</span><span class="ident" id="2462826"><a href="/gostd/os/getwd.go.html#2462191">dot</a></span><span class="op" id="2462829">,</span>&nbsp;<span class="ident" id="2462831"><a href="/gostd/os/getwd.go.html#2462778">d</a></span><span class="op" id="2462832">)</span>&nbsp;<span class="op" id="2462834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2462839">return</span>&nbsp;<span class="ident" id="2462846"><a href="/gostd/os/getwd.go.html#2462026">dir</a></span><span class="op" id="2462849">,</span>&nbsp;<span class="builtintype" id="2462851">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2462857">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2462860">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2462864">//&nbsp;Root&nbsp;is&nbsp;a&nbsp;special&nbsp;case&nbsp;because&nbsp;it&nbsp;has&nbsp;no&nbsp;parent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2462916">//&nbsp;and&nbsp;ends&nbsp;in&nbsp;a&nbsp;slash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2462941">root</span><span class="op" id="2462945">,</span>&nbsp;<span class="ident" id="2462947"><a href="/gostd/os/getwd.go.html#2462038">err</a></span>&nbsp;<span class="op" id="2462951">:=</span>&nbsp;<span class="ident" id="2462954"><a href="/gostd/os/file_unix.go.html#2455511">Stat</a></span><span class="op" id="2462958">(</span><span class="string" id="2462959">&#34;/&#34;</span><span class="op" id="2462962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2462965">if</span>&nbsp;<span class="ident" id="2462968"><a href="/gostd/os/getwd.go.html#2462038">err</a></span>&nbsp;<span class="op" id="2462972">!=</span>&nbsp;<span class="builtintype" id="2462975">nil</span>&nbsp;<span class="op" id="2462979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2462983">//&nbsp;Can&#39;t&nbsp;stat&nbsp;root&nbsp;-&nbsp;no&nbsp;hope.</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2463015">return</span>&nbsp;<span class="string" id="2463022">&#34;&#34;</span><span class="op" id="2463024">,</span>&nbsp;<span class="ident" id="2463026"><a href="/gostd/os/getwd.go.html#2462038">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2463031">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2463034">if</span>&nbsp;<span class="ident" id="2463037"><a href="/gostd/os/types.go.html#2475949">SameFile</a></span><span class="op" id="2463045">(</span><span class="ident" id="2463046"><a href="/gostd/os/getwd.go.html#2462941">root</a></span><span class="op" id="2463050">,</span>&nbsp;<span class="ident" id="2463052"><a href="/gostd/os/getwd.go.html#2462191">dot</a></span><span class="op" id="2463055">)</span>&nbsp;<span class="op" id="2463057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2463061">return</span>&nbsp;<span class="string" id="2463068">&#34;/&#34;</span><span class="op" id="2463071">,</span>&nbsp;<span class="builtintype" id="2463073">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2463078">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2463082">//&nbsp;General&nbsp;algorithm:&nbsp;find&nbsp;name&nbsp;in&nbsp;parent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2463125">//&nbsp;and&nbsp;then&nbsp;find&nbsp;name&nbsp;of&nbsp;parent.&nbsp;&nbsp;Each&nbsp;iteration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2463175">//&nbsp;adds&nbsp;/name&nbsp;to&nbsp;the&nbsp;beginning&nbsp;of&nbsp;dir.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2463215"><a href="/gostd/os/getwd.go.html#2462026">dir</a></span>&nbsp;<span class="op" id="2463219">=</span>&nbsp;<span class="string" id="2463221">&#34;&#34;</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2463225">for</span>&nbsp;<span class="ident" id="2463229">parent</span>&nbsp;<span class="op" id="2463236">:=</span>&nbsp;<span class="string" id="2463239">&#34;..&#34;</span><span class="op" id="2463243">;</span>&nbsp;<span class="op" id="2463245">;</span>&nbsp;<span class="ident" id="2463247"><a href="/gostd/os/getwd.go.html#2463229">parent</a></span>&nbsp;<span class="op" id="2463254">=</span>&nbsp;<span class="string" id="2463256">&#34;../&#34;</span>&nbsp;<span class="op" id="2463262">+</span>&nbsp;<span class="ident" id="2463264"><a href="/gostd/os/getwd.go.html#2463229">parent</a></span>&nbsp;<span class="op" id="2463271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2463275">if</span>&nbsp;<span class="builtinfunc" id="2463278">len</span><span class="op" id="2463281">(</span><span class="ident" id="2463282"><a href="/gostd/os/getwd.go.html#2463229">parent</a></span><span class="op" id="2463288">)</span>&nbsp;<span class="op" id="2463290">&gt;=</span>&nbsp;<span class="num" id="2463293">1024</span>&nbsp;<span class="op" id="2463298">{</span>&nbsp;<span class="comment" id="2463300">//&nbsp;Sanity&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2463319">return</span>&nbsp;<span class="string" id="2463326">&#34;&#34;</span><span class="op" id="2463328">,</span>&nbsp;<span class="ident" id="2463330"><a href="/gostd/os/getwd.go.html#2461592">syscall</a></span><span class="op" id="2463337">.</span><span class="ident" id="2463338"><a href="/gostd/syscall/zerrors_linux_amd64.go.html#2602074">ENAMETOOLONG</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2463353">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2463357">fd</span><span class="op" id="2463359">,</span>&nbsp;<span class="ident" id="2463361">err</span>&nbsp;<span class="op" id="2463365">:=</span>&nbsp;<span class="ident" id="2463368"><a href="/gostd/os/file.go.html#2446863">Open</a></span><span class="op" id="2463372">(</span><span class="ident" id="2463373"><a href="/gostd/os/getwd.go.html#2463229">parent</a></span><span class="op" id="2463379">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2463383">if</span>&nbsp;<span class="ident" id="2463386"><a href="/gostd/os/getwd.go.html#2463361">err</a></span>&nbsp;<span class="op" id="2463390">!=</span>&nbsp;<span class="builtintype" id="2463393">nil</span>&nbsp;<span class="op" id="2463397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2463402">return</span>&nbsp;<span class="string" id="2463409">&#34;&#34;</span><span class="op" id="2463411">,</span>&nbsp;<span class="ident" id="2463413"><a href="/gostd/os/getwd.go.html#2463361">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2463419">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2463424">for</span>&nbsp;<span class="op" id="2463428">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2463433">names</span><span class="op" id="2463438">,</span>&nbsp;<span class="ident" id="2463440">err</span>&nbsp;<span class="op" id="2463444">:=</span>&nbsp;<span class="ident" id="2463447"><a href="/gostd/os/getwd.go.html#2463357">fd</a></span><span class="op" id="2463449">.</span><span class="ident" id="2463450"><a href="/gostd/os/doc.go.html#2427225">Readdirnames</a></span><span class="op" id="2463462">(</span><span class="num" id="2463463">100</span><span class="op" id="2463466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2463471">if</span>&nbsp;<span class="ident" id="2463474"><a href="/gostd/os/getwd.go.html#2463440">err</a></span>&nbsp;<span class="op" id="2463478">!=</span>&nbsp;<span class="builtintype" id="2463481">nil</span>&nbsp;<span class="op" id="2463485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2463491"><a href="/gostd/os/getwd.go.html#2463357">fd</a></span><span class="op" id="2463493">.</span><span class="ident" id="2463494"><a href="/gostd/os/file_unix.go.html#2454611">Close</a></span><span class="op" id="2463499">(</span><span class="op" id="2463500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2463506">return</span>&nbsp;<span class="string" id="2463513">&#34;&#34;</span><span class="op" id="2463515">,</span>&nbsp;<span class="ident" id="2463517"><a href="/gostd/os/getwd.go.html#2463440">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2463524">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2463529">for</span>&nbsp;<span class="ident" id="2463533">_</span><span class="op" id="2463534">,</span>&nbsp;<span class="ident" id="2463536">name</span>&nbsp;<span class="op" id="2463541">:=</span>&nbsp;<span class="keyword" id="2463544">range</span>&nbsp;<span class="ident" id="2463550"><a href="/gostd/os/getwd.go.html#2463433">names</a></span>&nbsp;<span class="op" id="2463556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2463562">d</span><span class="op" id="2463563">,</span>&nbsp;<span class="ident" id="2463565">_</span>&nbsp;<span class="op" id="2463567">:=</span>&nbsp;<span class="ident" id="2463570"><a href="/gostd/os/file_unix.go.html#2455973">Lstat</a></span><span class="op" id="2463575">(</span><span class="ident" id="2463576"><a href="/gostd/os/getwd.go.html#2463229">parent</a></span>&nbsp;<span class="op" id="2463583">+</span>&nbsp;<span class="string" id="2463585">&#34;/&#34;</span>&nbsp;<span class="op" id="2463589">+</span>&nbsp;<span class="ident" id="2463591"><a href="/gostd/os/getwd.go.html#2463536">name</a></span><span class="op" id="2463595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2463601">if</span>&nbsp;<span class="ident" id="2463604"><a href="/gostd/os/types.go.html#2475949">SameFile</a></span><span class="op" id="2463612">(</span><span class="ident" id="2463613"><a href="/gostd/os/getwd.go.html#2463562">d</a></span><span class="op" id="2463614">,</span>&nbsp;<span class="ident" id="2463616"><a href="/gostd/os/getwd.go.html#2462191">dot</a></span><span class="op" id="2463619">)</span>&nbsp;<span class="op" id="2463621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2463628"><a href="/gostd/os/getwd.go.html#2462026">dir</a></span>&nbsp;<span class="op" id="2463632">=</span>&nbsp;<span class="string" id="2463634">&#34;/&#34;</span>&nbsp;<span class="op" id="2463638">+</span>&nbsp;<span class="ident" id="2463640"><a href="/gostd/os/getwd.go.html#2463536">name</a></span>&nbsp;<span class="op" id="2463645">+</span>&nbsp;<span class="ident" id="2463647"><a href="/gostd/os/getwd.go.html#2462026">dir</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2463656">goto</span>&nbsp;<span class="ident" id="2463661"><a href="/gostd/os/getwd.go.html#2463684">Found</a></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2463671">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2463676">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2463680">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2463684">Found</span><span class="op" id="2463689">:</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2463693">pd</span><span class="op" id="2463695">,</span>&nbsp;<span class="ident" id="2463697"><a href="/gostd/os/getwd.go.html#2463361">err</a></span>&nbsp;<span class="op" id="2463701">:=</span>&nbsp;<span class="ident" id="2463704"><a href="/gostd/os/getwd.go.html#2463357">fd</a></span><span class="op" id="2463706">.</span><span class="ident" id="2463707"><a href="/gostd/os/file_unix.go.html#2455146">Stat</a></span><span class="op" id="2463711">(</span><span class="op" id="2463712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2463716">if</span>&nbsp;<span class="ident" id="2463719"><a href="/gostd/os/getwd.go.html#2463361">err</a></span>&nbsp;<span class="op" id="2463723">!=</span>&nbsp;<span class="builtintype" id="2463726">nil</span>&nbsp;<span class="op" id="2463730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2463735">return</span>&nbsp;<span class="string" id="2463742">&#34;&#34;</span><span class="op" id="2463744">,</span>&nbsp;<span class="ident" id="2463746"><a href="/gostd/os/getwd.go.html#2463361">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2463752">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2463756"><a href="/gostd/os/getwd.go.html#2463357">fd</a></span><span class="op" id="2463758">.</span><span class="ident" id="2463759"><a href="/gostd/os/file_unix.go.html#2454611">Close</a></span><span class="op" id="2463764">(</span><span class="op" id="2463765">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2463769">if</span>&nbsp;<span class="ident" id="2463772"><a href="/gostd/os/types.go.html#2475949">SameFile</a></span><span class="op" id="2463780">(</span><span class="ident" id="2463781"><a href="/gostd/os/getwd.go.html#2463693">pd</a></span><span class="op" id="2463783">,</span>&nbsp;<span class="ident" id="2463785"><a href="/gostd/os/getwd.go.html#2462941">root</a></span><span class="op" id="2463789">)</span>&nbsp;<span class="op" id="2463791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2463796">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2463804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2463808">//&nbsp;Set&nbsp;up&nbsp;for&nbsp;next&nbsp;round.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2463836"><a href="/gostd/os/getwd.go.html#2462191">dot</a></span>&nbsp;<span class="op" id="2463840">=</span>&nbsp;<span class="ident" id="2463842"><a href="/gostd/os/getwd.go.html#2463693">pd</a></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2463846">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2463850">//&nbsp;Save&nbsp;answer&nbsp;as&nbsp;hint&nbsp;to&nbsp;avoid&nbsp;the&nbsp;expensive&nbsp;path&nbsp;next&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2463913"><a href="/gostd/os/getwd.go.html#2461609">getwdCache</a></span><span class="op" id="2463923">.</span><span class="ident" id="2463924"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="2463928">(</span><span class="op" id="2463929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2463932"><a href="/gostd/os/getwd.go.html#2461609">getwdCache</a></span><span class="op" id="2463942">.</span><span class="ident" id="2463943"><a href="/gostd/os/getwd.go.html#2461642">dir</a></span>&nbsp;<span class="op" id="2463947">=</span>&nbsp;<span class="ident" id="2463949"><a href="/gostd/os/getwd.go.html#2462026">dir</a></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2463954"><a href="/gostd/os/getwd.go.html#2461609">getwdCache</a></span><span class="op" id="2463964">.</span><span class="ident" id="2463965"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="2463971">(</span><span class="op" id="2463972">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2463976">return</span>&nbsp;<span class="ident" id="2463983"><a href="/gostd/os/getwd.go.html#2462026">dir</a></span><span class="op" id="2463986">,</span>&nbsp;<span class="builtintype" id="2463988">nil</span><br>
<span class="lineno"></span><span class="op" id="2463992">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
