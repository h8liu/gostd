<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/httptest</h2>
<ul>
<li><a href="/gostd/net/http/httptest/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/http/httptest/recorder.go.html" class="current">recorder.go</a></li>
<li><a href="/gostd/net/http/httptest/recorder_test.go.html">recorder_test.go</a></li>
<li><a href="/gostd/net/http/httptest/server.go.html">server.go</a></li>
<li><a href="/gostd/net/http/httptest/server_test.go.html">server_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6287843">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6287898">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6287952">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6288003">//&nbsp;Package&nbsp;httptest&nbsp;provides&nbsp;utilities&nbsp;for&nbsp;HTTP&nbsp;testing.</span><br>
<span class="lineno"></span><span class="keyword" id="6288060">package</span>&nbsp;<span class="ident" id="6288068">httptest</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6288078">import</span>&nbsp;<span class="op" id="6288085">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6288088">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6288097">&#34;net/http&#34;</span><br>
<span class="lineno"></span><span class="op" id="6288108">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6288111">//&nbsp;ResponseRecorder&nbsp;is&nbsp;an&nbsp;implementation&nbsp;of&nbsp;http.ResponseWriter&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="6288180">//&nbsp;records&nbsp;its&nbsp;mutations&nbsp;for&nbsp;later&nbsp;inspection&nbsp;in&nbsp;tests.</span><br>
<span class="lineno">15</span><span class="keyword" id="6288236">type</span>&nbsp;<span class="ident" id="6288241">ResponseRecorder</span>&nbsp;<span class="keyword" id="6288258">struct</span>&nbsp;<span class="op" id="6288265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6288268">Code</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6288278">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6288292">//&nbsp;the&nbsp;HTTP&nbsp;response&nbsp;code&nbsp;from&nbsp;WriteHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6288336">HeaderMap</span>&nbsp;<span class="ident" id="6288346">http</span><span class="op" id="6288350">.</span><span class="ident" id="6288351">Header</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="6288360">//&nbsp;the&nbsp;HTTP&nbsp;response&nbsp;headers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6288390">Body</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6288400">*</span><span class="ident" id="6288401">bytes</span><span class="op" id="6288406">.</span><span class="ident" id="6288407">Buffer</span>&nbsp;<span class="comment" id="6288414">//&nbsp;if&nbsp;non-nil,&nbsp;the&nbsp;bytes.Buffer&nbsp;to&nbsp;append&nbsp;written&nbsp;data&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6288473">Flushed</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6288483">bool</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6288490">wroteHeader</span>&nbsp;<span class="builtintype" id="6288502">bool</span><br>
<span class="lineno"></span><span class="op" id="6288507">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6288510">//&nbsp;NewRecorder&nbsp;returns&nbsp;an&nbsp;initialized&nbsp;ResponseRecorder.</span><br>
<span class="lineno">25</span><span class="keyword" id="6288566">func</span>&nbsp;<span class="ident" id="6288571">NewRecorder</span><span class="op" id="6288582">(</span><span class="op" id="6288583">)</span>&nbsp;<span class="op" id="6288585">*</span><span class="ident" id="6288586">ResponseRecorder</span>&nbsp;<span class="op" id="6288603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6288606">return</span>&nbsp;<span class="op" id="6288613">&amp;</span><span class="ident" id="6288614">ResponseRecorder</span><span class="op" id="6288630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6288634">HeaderMap</span><span class="op" id="6288643">:</span>&nbsp;<span class="builtinfunc" id="6288645">make</span><span class="op" id="6288649">(</span><span class="ident" id="6288650">http</span><span class="op" id="6288654">.</span><span class="ident" id="6288655">Header</span><span class="op" id="6288661">)</span><span class="op" id="6288662">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6288666">Body</span><span class="op" id="6288670">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6288677">new</span><span class="op" id="6288680">(</span><span class="ident" id="6288681">bytes</span><span class="op" id="6288686">.</span><span class="ident" id="6288687">Buffer</span><span class="op" id="6288693">)</span><span class="op" id="6288694">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6288698">Code</span><span class="op" id="6288702">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6288709">200</span><span class="op" id="6288712">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6288715">}</span><br>
<span class="lineno"></span><span class="op" id="6288717">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6288720">//&nbsp;DefaultRemoteAddr&nbsp;is&nbsp;the&nbsp;default&nbsp;remote&nbsp;address&nbsp;to&nbsp;return&nbsp;in&nbsp;RemoteAddr&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="6288798">//&nbsp;an&nbsp;explicit&nbsp;DefaultRemoteAddr&nbsp;isn&#39;t&nbsp;set&nbsp;on&nbsp;ResponseRecorder.</span><br>
<span class="lineno">35</span><span class="keyword" id="6288862">const</span>&nbsp;<span class="ident" id="6288868">DefaultRemoteAddr</span>&nbsp;<span class="op" id="6288886">=</span>&nbsp;<span class="string" id="6288888">&#34;1.2.3.4&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6288899">//&nbsp;Header&nbsp;returns&nbsp;the&nbsp;response&nbsp;headers.</span><br>
<span class="lineno"></span><span class="keyword" id="6288939">func</span>&nbsp;<span class="op" id="6288944">(</span><span class="ident" id="6288945">rw</span>&nbsp;<span class="op" id="6288948">*</span><span class="ident" id="6288949">ResponseRecorder</span><span class="op" id="6288965">)</span>&nbsp;<span class="ident" id="6288967">Header</span><span class="op" id="6288973">(</span><span class="op" id="6288974">)</span>&nbsp;<span class="ident" id="6288976">http</span><span class="op" id="6288980">.</span><span class="ident" id="6288981">Header</span>&nbsp;<span class="op" id="6288988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6288991">m</span>&nbsp;<span class="op" id="6288993">:=</span>&nbsp;<span class="ident" id="6288996">rw</span><span class="op" id="6288998">.</span><span class="ident" id="6288999">HeaderMap</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6289010">if</span>&nbsp;<span class="ident" id="6289013">m</span>&nbsp;<span class="op" id="6289015">==</span>&nbsp;<span class="builtintype" id="6289018">nil</span>&nbsp;<span class="op" id="6289022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6289026">m</span>&nbsp;<span class="op" id="6289028">=</span>&nbsp;<span class="builtinfunc" id="6289030">make</span><span class="op" id="6289034">(</span><span class="ident" id="6289035">http</span><span class="op" id="6289039">.</span><span class="ident" id="6289040">Header</span><span class="op" id="6289046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6289050">rw</span><span class="op" id="6289052">.</span><span class="ident" id="6289053">HeaderMap</span>&nbsp;<span class="op" id="6289063">=</span>&nbsp;<span class="ident" id="6289065">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6289068">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6289071">return</span>&nbsp;<span class="ident" id="6289078">m</span><br>
<span class="lineno">45</span><span class="op" id="6289080">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6289083">//&nbsp;Write&nbsp;always&nbsp;succeeds&nbsp;and&nbsp;writes&nbsp;to&nbsp;rw.Body,&nbsp;if&nbsp;not&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="6289143">func</span>&nbsp;<span class="op" id="6289148">(</span><span class="ident" id="6289149">rw</span>&nbsp;<span class="op" id="6289152">*</span><span class="ident" id="6289153">ResponseRecorder</span><span class="op" id="6289169">)</span>&nbsp;<span class="ident" id="6289171">Write</span><span class="op" id="6289176">(</span><span class="ident" id="6289177">buf</span>&nbsp;<span class="op" id="6289181">[</span><span class="op" id="6289182">]</span><span class="builtintype" id="6289183">byte</span><span class="op" id="6289187">)</span>&nbsp;<span class="op" id="6289189">(</span><span class="builtintype" id="6289190">int</span><span class="op" id="6289193">,</span>&nbsp;<span class="builtintype" id="6289195">error</span><span class="op" id="6289200">)</span>&nbsp;<span class="op" id="6289202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6289205">if</span>&nbsp;<span class="op" id="6289208">!</span><span class="ident" id="6289209">rw</span><span class="op" id="6289211">.</span><span class="ident" id="6289212">wroteHeader</span>&nbsp;<span class="op" id="6289224">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6289228">rw</span><span class="op" id="6289230">.</span><span class="ident" id="6289231">WriteHeader</span><span class="op" id="6289242">(</span><span class="num" id="6289243">200</span><span class="op" id="6289246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6289249">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6289252">if</span>&nbsp;<span class="ident" id="6289255">rw</span><span class="op" id="6289257">.</span><span class="ident" id="6289258">Body</span>&nbsp;<span class="op" id="6289263">!=</span>&nbsp;<span class="builtintype" id="6289266">nil</span>&nbsp;<span class="op" id="6289270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6289274">rw</span><span class="op" id="6289276">.</span><span class="ident" id="6289277">Body</span><span class="op" id="6289281">.</span><span class="ident" id="6289282">Write</span><span class="op" id="6289287">(</span><span class="ident" id="6289288">buf</span><span class="op" id="6289291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6289294">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6289297">return</span>&nbsp;<span class="builtinfunc" id="6289304">len</span><span class="op" id="6289307">(</span><span class="ident" id="6289308">buf</span><span class="op" id="6289311">)</span><span class="op" id="6289312">,</span>&nbsp;<span class="builtintype" id="6289314">nil</span><br>
<span class="lineno"></span><span class="op" id="6289318">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6289321">//&nbsp;WriteHeader&nbsp;sets&nbsp;rw.Code.</span><br>
<span class="lineno"></span><span class="keyword" id="6289350">func</span>&nbsp;<span class="op" id="6289355">(</span><span class="ident" id="6289356">rw</span>&nbsp;<span class="op" id="6289359">*</span><span class="ident" id="6289360">ResponseRecorder</span><span class="op" id="6289376">)</span>&nbsp;<span class="ident" id="6289378">WriteHeader</span><span class="op" id="6289389">(</span><span class="ident" id="6289390">code</span>&nbsp;<span class="builtintype" id="6289395">int</span><span class="op" id="6289398">)</span>&nbsp;<span class="op" id="6289400">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6289403">if</span>&nbsp;<span class="op" id="6289406">!</span><span class="ident" id="6289407">rw</span><span class="op" id="6289409">.</span><span class="ident" id="6289410">wroteHeader</span>&nbsp;<span class="op" id="6289422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6289426">rw</span><span class="op" id="6289428">.</span><span class="ident" id="6289429">Code</span>&nbsp;<span class="op" id="6289434">=</span>&nbsp;<span class="ident" id="6289436">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6289442">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6289445">rw</span><span class="op" id="6289447">.</span><span class="ident" id="6289448">wroteHeader</span>&nbsp;<span class="op" id="6289460">=</span>&nbsp;<span class="builtintype" id="6289462">true</span><br>
<span class="lineno"></span><span class="op" id="6289467">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="comment" id="6289470">//&nbsp;Flush&nbsp;sets&nbsp;rw.Flushed&nbsp;to&nbsp;true.</span><br>
<span class="lineno"></span><span class="keyword" id="6289504">func</span>&nbsp;<span class="op" id="6289509">(</span><span class="ident" id="6289510">rw</span>&nbsp;<span class="op" id="6289513">*</span><span class="ident" id="6289514">ResponseRecorder</span><span class="op" id="6289530">)</span>&nbsp;<span class="ident" id="6289532">Flush</span><span class="op" id="6289537">(</span><span class="op" id="6289538">)</span>&nbsp;<span class="op" id="6289540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6289543">if</span>&nbsp;<span class="op" id="6289546">!</span><span class="ident" id="6289547">rw</span><span class="op" id="6289549">.</span><span class="ident" id="6289550">wroteHeader</span>&nbsp;<span class="op" id="6289562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6289566">rw</span><span class="op" id="6289568">.</span><span class="ident" id="6289569">WriteHeader</span><span class="op" id="6289580">(</span><span class="num" id="6289581">200</span><span class="op" id="6289584">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6289587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6289590">rw</span><span class="op" id="6289592">.</span><span class="ident" id="6289593">Flushed</span>&nbsp;<span class="op" id="6289601">=</span>&nbsp;<span class="builtintype" id="6289603">true</span><br>
<span class="lineno"></span><span class="op" id="6289608">}</span>
</div>
</body>
</html>
