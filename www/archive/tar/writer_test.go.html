<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6653819">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6653874">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6653928">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6653979">package</span>&nbsp;<span class="ident" id="6653987">tar</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6653992">import</span>&nbsp;<span class="op" id="6653999">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6654002">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6654011">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6654018">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6654024">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6654037">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6654043">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6654054">&#34;strings&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6654065">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6654076">&#34;testing/iotest&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6654094">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6654101">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="6654104">type</span>&nbsp;<span class="ident" id="6654109">writerTestEntry</span>&nbsp;<span class="keyword" id="6654125">struct</span>&nbsp;<span class="op" id="6654132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6654135">header</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6654144">*</span><span class="ident" id="6654145"><a href="/archive/tar/common.go.html#6187053">Header</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6654153">contents</span>&nbsp;<span class="builtintype" id="6654162">string</span><br>
<span class="lineno"></span><span class="op" id="6654169">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="6654172">type</span>&nbsp;<span class="ident" id="6654177">writerTest</span>&nbsp;<span class="keyword" id="6654188">struct</span>&nbsp;<span class="op" id="6654195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6654198">file</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6654206">string</span>&nbsp;<span class="comment" id="6654213">//&nbsp;filename&nbsp;of&nbsp;expected&nbsp;output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6654245">entries</span>&nbsp;<span class="op" id="6654253">[</span><span class="op" id="6654254">]</span><span class="op" id="6654255">*</span><span class="ident" id="6654256"><a href="/archive/tar/writer_test.go.html#6654109">writerTestEntry</a></span><br>
<span class="lineno"></span><span class="op" id="6654272">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="6654275">var</span>&nbsp;<span class="ident" id="6654279">writerTests</span>&nbsp;<span class="op" id="6654291">=</span>&nbsp;<span class="op" id="6654293">[</span><span class="op" id="6654294">]</span><span class="op" id="6654295">*</span><span class="ident" id="6654296"><a href="/archive/tar/writer_test.go.html#6654177">writerTest</a></span><span class="op" id="6654306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6654309">//&nbsp;The&nbsp;writer&nbsp;test&nbsp;file&nbsp;was&nbsp;produced&nbsp;with&nbsp;this&nbsp;command:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6654366">//&nbsp;tar&nbsp;(GNU&nbsp;tar)&nbsp;1.26</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6654389">//&nbsp;&nbsp;&nbsp;ln&nbsp;-s&nbsp;small.txt&nbsp;link.txt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6654420">//&nbsp;&nbsp;&nbsp;tar&nbsp;-b&nbsp;1&nbsp;--format=ustar&nbsp;-c&nbsp;-f&nbsp;writer.tar&nbsp;small.txt&nbsp;small2.txt&nbsp;link.txt</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6654497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6654501">file</span><span class="op" id="6654505">:</span>&nbsp;<span class="string" id="6654507">&#34;testdata/writer.tar&#34;</span><span class="op" id="6654528">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6654532">entries</span><span class="op" id="6654539">:</span>&nbsp;<span class="op" id="6654541">[</span><span class="op" id="6654542">]</span><span class="op" id="6654543">*</span><span class="ident" id="6654544"><a href="/archive/tar/writer_test.go.html#6654109">writerTestEntry</a></span><span class="op" id="6654559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6654564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6654570">header</span><span class="op" id="6654576">:</span>&nbsp;<span class="op" id="6654578">&amp;</span><span class="ident" id="6654579"><a href="/archive/tar/common.go.html#6187053">Header</a></span><span class="op" id="6654585">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6654592">Name</span><span class="op" id="6654596">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6654602">&#34;small.txt&#34;</span><span class="op" id="6654613">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6654620">Mode</span><span class="op" id="6654624">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6654630">0640</span><span class="op" id="6654634">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6654641">Uid</span><span class="op" id="6654644">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6654651">73025</span><span class="op" id="6654656">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6654663">Gid</span><span class="op" id="6654666">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6654673">5000</span><span class="op" id="6654677">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6654684">Size</span><span class="op" id="6654688">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6654694">5</span><span class="op" id="6654695">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6654702">ModTime</span><span class="op" id="6654709">:</span>&nbsp;&nbsp;<span class="ident" id="6654712"><a href="/archive/tar/writer_test.go.html#6654094">time</a></span><span class="op" id="6654716">.</span><span class="ident" id="6654717">Unix</span><span class="op" id="6654721">(</span><span class="num" id="6654722">1246508266</span><span class="op" id="6654732">,</span>&nbsp;<span class="num" id="6654734">0</span><span class="op" id="6654735">)</span><span class="op" id="6654736">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6654743">Typeflag</span><span class="op" id="6654751">:</span>&nbsp;<span class="string" id="6654753">&#39;0&#39;</span><span class="op" id="6654756">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6654763">Uname</span><span class="op" id="6654768">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6654773">&#34;dsymonds&#34;</span><span class="op" id="6654783">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6654790">Gname</span><span class="op" id="6654795">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6654800">&#34;eng&#34;</span><span class="op" id="6654805">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6654811">}</span><span class="op" id="6654812">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6654818">contents</span><span class="op" id="6654826">:</span>&nbsp;<span class="string" id="6654828">&#34;Kilts&#34;</span><span class="op" id="6654835">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6654840">}</span><span class="op" id="6654841">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6654846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6654852">header</span><span class="op" id="6654858">:</span>&nbsp;<span class="op" id="6654860">&amp;</span><span class="ident" id="6654861"><a href="/archive/tar/common.go.html#6187053">Header</a></span><span class="op" id="6654867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6654874">Name</span><span class="op" id="6654878">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6654884">&#34;small2.txt&#34;</span><span class="op" id="6654896">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6654903">Mode</span><span class="op" id="6654907">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6654913">0640</span><span class="op" id="6654917">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6654924">Uid</span><span class="op" id="6654927">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6654934">73025</span><span class="op" id="6654939">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6654946">Gid</span><span class="op" id="6654949">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6654956">5000</span><span class="op" id="6654960">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6654967">Size</span><span class="op" id="6654971">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6654977">11</span><span class="op" id="6654979">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6654986">ModTime</span><span class="op" id="6654993">:</span>&nbsp;&nbsp;<span class="ident" id="6654996"><a href="/archive/tar/writer_test.go.html#6654094">time</a></span><span class="op" id="6655000">.</span><span class="ident" id="6655001">Unix</span><span class="op" id="6655005">(</span><span class="num" id="6655006">1245217492</span><span class="op" id="6655016">,</span>&nbsp;<span class="num" id="6655018">0</span><span class="op" id="6655019">)</span><span class="op" id="6655020">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6655027">Typeflag</span><span class="op" id="6655035">:</span>&nbsp;<span class="string" id="6655037">&#39;0&#39;</span><span class="op" id="6655040">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6655047">Uname</span><span class="op" id="6655052">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6655057">&#34;dsymonds&#34;</span><span class="op" id="6655067">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6655074">Gname</span><span class="op" id="6655079">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6655084">&#34;eng&#34;</span><span class="op" id="6655089">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6655095">}</span><span class="op" id="6655096">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6655102">contents</span><span class="op" id="6655110">:</span>&nbsp;<span class="string" id="6655112">&#34;Google.com\n&#34;</span><span class="op" id="6655126">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6655131">}</span><span class="op" id="6655132">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6655137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6655143">header</span><span class="op" id="6655149">:</span>&nbsp;<span class="op" id="6655151">&amp;</span><span class="ident" id="6655152"><a href="/archive/tar/common.go.html#6187053">Header</a></span><span class="op" id="6655158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6655165">Name</span><span class="op" id="6655169">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6655175">&#34;link.txt&#34;</span><span class="op" id="6655185">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6655192">Mode</span><span class="op" id="6655196">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6655202">0777</span><span class="op" id="6655206">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6655213">Uid</span><span class="op" id="6655216">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6655223">1000</span><span class="op" id="6655227">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6655234">Gid</span><span class="op" id="6655237">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6655244">1000</span><span class="op" id="6655248">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6655255">Size</span><span class="op" id="6655259">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6655265">0</span><span class="op" id="6655266">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6655273">ModTime</span><span class="op" id="6655280">:</span>&nbsp;&nbsp;<span class="ident" id="6655283"><a href="/archive/tar/writer_test.go.html#6654094">time</a></span><span class="op" id="6655287">.</span><span class="ident" id="6655288">Unix</span><span class="op" id="6655292">(</span><span class="num" id="6655293">1314603082</span><span class="op" id="6655303">,</span>&nbsp;<span class="num" id="6655305">0</span><span class="op" id="6655306">)</span><span class="op" id="6655307">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6655314">Typeflag</span><span class="op" id="6655322">:</span>&nbsp;<span class="string" id="6655324">&#39;2&#39;</span><span class="op" id="6655327">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6655334">Linkname</span><span class="op" id="6655342">:</span>&nbsp;<span class="string" id="6655344">&#34;small.txt&#34;</span><span class="op" id="6655355">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6655362">Uname</span><span class="op" id="6655367">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6655372">&#34;strings&#34;</span><span class="op" id="6655381">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6655388">Gname</span><span class="op" id="6655393">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6655398">&#34;strings&#34;</span><span class="op" id="6655407">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6655413">}</span><span class="op" id="6655414">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6655420">//&nbsp;no&nbsp;contents</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6655438">}</span><span class="op" id="6655439">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6655443">}</span><span class="op" id="6655444">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6655447">}</span><span class="op" id="6655448">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6655451">//&nbsp;The&nbsp;truncated&nbsp;test&nbsp;file&nbsp;was&nbsp;produced&nbsp;using&nbsp;these&nbsp;commands:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6655514">//&nbsp;&nbsp;&nbsp;dd&nbsp;if=/dev/zero&nbsp;bs=1048576&nbsp;count=16384&nbsp;&gt;&nbsp;/tmp/16gig.txt</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6655576">//&nbsp;&nbsp;&nbsp;tar&nbsp;-b&nbsp;1&nbsp;-c&nbsp;-f-&nbsp;/tmp/16gig.txt&nbsp;|&nbsp;dd&nbsp;bs=512&nbsp;count=8&nbsp;&gt;&nbsp;writer-big.tar</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6655650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6655654">file</span><span class="op" id="6655658">:</span>&nbsp;<span class="string" id="6655660">&#34;testdata/writer-big.tar&#34;</span><span class="op" id="6655685">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6655689">entries</span><span class="op" id="6655696">:</span>&nbsp;<span class="op" id="6655698">[</span><span class="op" id="6655699">]</span><span class="op" id="6655700">*</span><span class="ident" id="6655701"><a href="/archive/tar/writer_test.go.html#6654109">writerTestEntry</a></span><span class="op" id="6655716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6655721">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6655727">header</span><span class="op" id="6655733">:</span>&nbsp;<span class="op" id="6655735">&amp;</span><span class="ident" id="6655736"><a href="/archive/tar/common.go.html#6187053">Header</a></span><span class="op" id="6655742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6655749">Name</span><span class="op" id="6655753">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6655759">&#34;tmp/16gig.txt&#34;</span><span class="op" id="6655774">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6655781">Mode</span><span class="op" id="6655785">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6655791">0640</span><span class="op" id="6655795">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6655802">Uid</span><span class="op" id="6655805">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6655812">73025</span><span class="op" id="6655817">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6655824">Gid</span><span class="op" id="6655827">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6655834">5000</span><span class="op" id="6655838">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6655845">Size</span><span class="op" id="6655849">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6655855">16</span>&nbsp;<span class="op" id="6655858">&lt;&lt;</span>&nbsp;<span class="num" id="6655861">30</span><span class="op" id="6655863">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6655870">ModTime</span><span class="op" id="6655877">:</span>&nbsp;&nbsp;<span class="ident" id="6655880"><a href="/archive/tar/writer_test.go.html#6654094">time</a></span><span class="op" id="6655884">.</span><span class="ident" id="6655885">Unix</span><span class="op" id="6655889">(</span><span class="num" id="6655890">1254699560</span><span class="op" id="6655900">,</span>&nbsp;<span class="num" id="6655902">0</span><span class="op" id="6655903">)</span><span class="op" id="6655904">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6655911">Typeflag</span><span class="op" id="6655919">:</span>&nbsp;<span class="string" id="6655921">&#39;0&#39;</span><span class="op" id="6655924">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6655931">Uname</span><span class="op" id="6655936">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6655941">&#34;dsymonds&#34;</span><span class="op" id="6655951">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6655958">Gname</span><span class="op" id="6655963">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6655968">&#34;eng&#34;</span><span class="op" id="6655973">,</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6655979">}</span><span class="op" id="6655980">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6655986">//&nbsp;fake&nbsp;contents</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6656007">contents</span><span class="op" id="6656015">:</span>&nbsp;<span class="ident" id="6656017"><a href="/archive/tar/writer_test.go.html#6654054">strings</a></span><span class="op" id="6656024">.</span><span class="ident" id="6656025">Repeat</span><span class="op" id="6656031">(</span><span class="string" id="6656032">&#34;\x00&#34;</span><span class="op" id="6656038">,</span>&nbsp;<span class="num" id="6656040">4</span><span class="op" id="6656041">&lt;&lt;</span><span class="num" id="6656043">10</span><span class="op" id="6656045">)</span><span class="op" id="6656046">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6656051">}</span><span class="op" id="6656052">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6656056">}</span><span class="op" id="6656057">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6656060">}</span><span class="op" id="6656061">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6656064">//&nbsp;The&nbsp;truncated&nbsp;test&nbsp;file&nbsp;was&nbsp;produced&nbsp;using&nbsp;these&nbsp;commands:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6656127">//&nbsp;&nbsp;&nbsp;dd&nbsp;if=/dev/zero&nbsp;bs=1048576&nbsp;count=16384&nbsp;&gt;&nbsp;(longname/)*15&nbsp;/16gig.txt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6656200">//&nbsp;&nbsp;&nbsp;tar&nbsp;-b&nbsp;1&nbsp;-c&nbsp;-f-&nbsp;(longname/)*15&nbsp;/16gig.txt&nbsp;|&nbsp;dd&nbsp;bs=512&nbsp;count=8&nbsp;&gt;&nbsp;writer-big-long.tar</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6656290">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6656294">file</span><span class="op" id="6656298">:</span>&nbsp;<span class="string" id="6656300">&#34;testdata/writer-big-long.tar&#34;</span><span class="op" id="6656330">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6656334">entries</span><span class="op" id="6656341">:</span>&nbsp;<span class="op" id="6656343">[</span><span class="op" id="6656344">]</span><span class="op" id="6656345">*</span><span class="ident" id="6656346"><a href="/archive/tar/writer_test.go.html#6654109">writerTestEntry</a></span><span class="op" id="6656361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6656366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6656372">header</span><span class="op" id="6656378">:</span>&nbsp;<span class="op" id="6656380">&amp;</span><span class="ident" id="6656381"><a href="/archive/tar/common.go.html#6187053">Header</a></span><span class="op" id="6656387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6656394">Name</span><span class="op" id="6656398">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6656404"><a href="/archive/tar/writer_test.go.html#6654054">strings</a></span><span class="op" id="6656411">.</span><span class="ident" id="6656412">Repeat</span><span class="op" id="6656418">(</span><span class="string" id="6656419">&#34;longname/&#34;</span><span class="op" id="6656430">,</span>&nbsp;<span class="num" id="6656432">15</span><span class="op" id="6656434">)</span>&nbsp;<span class="op" id="6656436">+</span>&nbsp;<span class="string" id="6656438">&#34;16gig.txt&#34;</span><span class="op" id="6656449">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6656456">Mode</span><span class="op" id="6656460">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6656466">0644</span><span class="op" id="6656470">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6656477">Uid</span><span class="op" id="6656480">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6656487">1000</span><span class="op" id="6656491">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6656498">Gid</span><span class="op" id="6656501">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6656508">1000</span><span class="op" id="6656512">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6656519">Size</span><span class="op" id="6656523">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6656529">16</span>&nbsp;<span class="op" id="6656532">&lt;&lt;</span>&nbsp;<span class="num" id="6656535">30</span><span class="op" id="6656537">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6656544">ModTime</span><span class="op" id="6656551">:</span>&nbsp;&nbsp;<span class="ident" id="6656554"><a href="/archive/tar/writer_test.go.html#6654094">time</a></span><span class="op" id="6656558">.</span><span class="ident" id="6656559">Unix</span><span class="op" id="6656563">(</span><span class="num" id="6656564">1399583047</span><span class="op" id="6656574">,</span>&nbsp;<span class="num" id="6656576">0</span><span class="op" id="6656577">)</span><span class="op" id="6656578">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6656585">Typeflag</span><span class="op" id="6656593">:</span>&nbsp;<span class="string" id="6656595">&#39;0&#39;</span><span class="op" id="6656598">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6656605">Uname</span><span class="op" id="6656610">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6656615">&#34;guillaume&#34;</span><span class="op" id="6656626">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6656633">Gname</span><span class="op" id="6656638">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6656643">&#34;guillaume&#34;</span><span class="op" id="6656654">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6656660">}</span><span class="op" id="6656661">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6656667">//&nbsp;fake&nbsp;contents</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6656688">contents</span><span class="op" id="6656696">:</span>&nbsp;<span class="ident" id="6656698"><a href="/archive/tar/writer_test.go.html#6654054">strings</a></span><span class="op" id="6656705">.</span><span class="ident" id="6656706">Repeat</span><span class="op" id="6656712">(</span><span class="string" id="6656713">&#34;\x00&#34;</span><span class="op" id="6656719">,</span>&nbsp;<span class="num" id="6656721">4</span><span class="op" id="6656722">&lt;&lt;</span><span class="num" id="6656724">10</span><span class="op" id="6656726">)</span><span class="op" id="6656727">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6656732">}</span><span class="op" id="6656733">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6656737">}</span><span class="op" id="6656738">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6656741">}</span><span class="op" id="6656742">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6656745">//&nbsp;This&nbsp;file&nbsp;was&nbsp;produced&nbsp;using&nbsp;gnu&nbsp;tar&nbsp;1.17</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6656791">//&nbsp;gnutar&nbsp;&nbsp;-b&nbsp;4&nbsp;--format=ustar&nbsp;(longname/)*15&nbsp;+&nbsp;file.txt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6656849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6656853">file</span><span class="op" id="6656857">:</span>&nbsp;<span class="string" id="6656859">&#34;testdata/ustar.tar&#34;</span><span class="op" id="6656879">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6656883">entries</span><span class="op" id="6656890">:</span>&nbsp;<span class="op" id="6656892">[</span><span class="op" id="6656893">]</span><span class="op" id="6656894">*</span><span class="ident" id="6656895"><a href="/archive/tar/writer_test.go.html#6654109">writerTestEntry</a></span><span class="op" id="6656910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6656915">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6656921">header</span><span class="op" id="6656927">:</span>&nbsp;<span class="op" id="6656929">&amp;</span><span class="ident" id="6656930"><a href="/archive/tar/common.go.html#6187053">Header</a></span><span class="op" id="6656936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6656943">Name</span><span class="op" id="6656947">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6656953"><a href="/archive/tar/writer_test.go.html#6654054">strings</a></span><span class="op" id="6656960">.</span><span class="ident" id="6656961">Repeat</span><span class="op" id="6656967">(</span><span class="string" id="6656968">&#34;longname/&#34;</span><span class="op" id="6656979">,</span>&nbsp;<span class="num" id="6656981">15</span><span class="op" id="6656983">)</span>&nbsp;<span class="op" id="6656985">+</span>&nbsp;<span class="string" id="6656987">&#34;file.txt&#34;</span><span class="op" id="6656997">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6657004">Mode</span><span class="op" id="6657008">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6657014">0644</span><span class="op" id="6657018">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6657025">Uid</span><span class="op" id="6657028">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6657035">0765</span><span class="op" id="6657039">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6657046">Gid</span><span class="op" id="6657049">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6657056">024</span><span class="op" id="6657059">,</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6657066">Size</span><span class="op" id="6657070">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6657076">06</span><span class="op" id="6657078">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6657085">ModTime</span><span class="op" id="6657092">:</span>&nbsp;&nbsp;<span class="ident" id="6657095"><a href="/archive/tar/writer_test.go.html#6654094">time</a></span><span class="op" id="6657099">.</span><span class="ident" id="6657100">Unix</span><span class="op" id="6657104">(</span><span class="num" id="6657105">1360135598</span><span class="op" id="6657115">,</span>&nbsp;<span class="num" id="6657117">0</span><span class="op" id="6657118">)</span><span class="op" id="6657119">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6657126">Typeflag</span><span class="op" id="6657134">:</span>&nbsp;<span class="string" id="6657136">&#39;0&#39;</span><span class="op" id="6657139">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6657146">Uname</span><span class="op" id="6657151">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6657156">&#34;shane&#34;</span><span class="op" id="6657163">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6657170">Gname</span><span class="op" id="6657175">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6657180">&#34;staff&#34;</span><span class="op" id="6657187">,</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6657193">}</span><span class="op" id="6657194">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6657200">contents</span><span class="op" id="6657208">:</span>&nbsp;<span class="string" id="6657210">&#34;hello\n&#34;</span><span class="op" id="6657219">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6657224">}</span><span class="op" id="6657225">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6657229">}</span><span class="op" id="6657230">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6657233">}</span><span class="op" id="6657234">,</span><br>
<span class="lineno">150</span><span class="op" id="6657236">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6657239">//&nbsp;Render&nbsp;byte&nbsp;array&nbsp;in&nbsp;a&nbsp;two-character&nbsp;hexadecimal&nbsp;string,&nbsp;spaced&nbsp;for&nbsp;easy&nbsp;visual&nbsp;inspection.</span><br>
<span class="lineno"></span><span class="keyword" id="6657334">func</span>&nbsp;<span class="ident" id="6657339">bytestr</span><span class="op" id="6657346">(</span><span class="ident" id="6657347">offset</span>&nbsp;<span class="builtintype" id="6657354">int</span><span class="op" id="6657357">,</span>&nbsp;<span class="ident" id="6657359">b</span>&nbsp;<span class="op" id="6657361">[</span><span class="op" id="6657362">]</span><span class="builtintype" id="6657363">byte</span><span class="op" id="6657367">)</span>&nbsp;<span class="builtintype" id="6657369">string</span>&nbsp;<span class="op" id="6657376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6657379">const</span>&nbsp;<span class="ident" id="6657385">rowLen</span>&nbsp;<span class="op" id="6657392">=</span>&nbsp;<span class="num" id="6657394">32</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6657398">s</span>&nbsp;<span class="op" id="6657400">:=</span>&nbsp;<span class="ident" id="6657403"><a href="/archive/tar/writer_test.go.html#6654011">fmt</a></span><span class="op" id="6657406">.</span><span class="ident" id="6657407">Sprintf</span><span class="op" id="6657414">(</span><span class="string" id="6657415">&#34;%04x&nbsp;&#34;</span><span class="op" id="6657422">,</span>&nbsp;<span class="ident" id="6657424"><a href="/archive/tar/writer_test.go.html#6657347">offset</a></span><span class="op" id="6657430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6657433">for</span>&nbsp;<span class="ident" id="6657437">_</span><span class="op" id="6657438">,</span>&nbsp;<span class="ident" id="6657440">ch</span>&nbsp;<span class="op" id="6657443">:=</span>&nbsp;<span class="keyword" id="6657446">range</span>&nbsp;<span class="ident" id="6657452"><a href="/archive/tar/writer_test.go.html#6657359">b</a></span>&nbsp;<span class="op" id="6657454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6657458">switch</span>&nbsp;<span class="op" id="6657465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6657469">case</span>&nbsp;<span class="string" id="6657474">&#39;0&#39;</span>&nbsp;<span class="op" id="6657478">&lt;=</span>&nbsp;<span class="ident" id="6657481"><a href="/archive/tar/writer_test.go.html#6657440">ch</a></span>&nbsp;<span class="op" id="6657484">&amp;&amp;</span>&nbsp;<span class="ident" id="6657487"><a href="/archive/tar/writer_test.go.html#6657440">ch</a></span>&nbsp;<span class="op" id="6657490">&lt;=</span>&nbsp;<span class="string" id="6657493">&#39;9&#39;</span><span class="op" id="6657496">,</span>&nbsp;<span class="string" id="6657498">&#39;A&#39;</span>&nbsp;<span class="op" id="6657502">&lt;=</span>&nbsp;<span class="ident" id="6657505"><a href="/archive/tar/writer_test.go.html#6657440">ch</a></span>&nbsp;<span class="op" id="6657508">&amp;&amp;</span>&nbsp;<span class="ident" id="6657511"><a href="/archive/tar/writer_test.go.html#6657440">ch</a></span>&nbsp;<span class="op" id="6657514">&lt;=</span>&nbsp;<span class="string" id="6657517">&#39;Z&#39;</span><span class="op" id="6657520">,</span>&nbsp;<span class="string" id="6657522">&#39;a&#39;</span>&nbsp;<span class="op" id="6657526">&lt;=</span>&nbsp;<span class="ident" id="6657529"><a href="/archive/tar/writer_test.go.html#6657440">ch</a></span>&nbsp;<span class="op" id="6657532">&amp;&amp;</span>&nbsp;<span class="ident" id="6657535"><a href="/archive/tar/writer_test.go.html#6657440">ch</a></span>&nbsp;<span class="op" id="6657538">&lt;=</span>&nbsp;<span class="string" id="6657541">&#39;z&#39;</span><span class="op" id="6657544">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6657549"><a href="/archive/tar/writer_test.go.html#6657398">s</a></span>&nbsp;<span class="op" id="6657551">+=</span>&nbsp;<span class="ident" id="6657554"><a href="/archive/tar/writer_test.go.html#6654011">fmt</a></span><span class="op" id="6657557">.</span><span class="ident" id="6657558">Sprintf</span><span class="op" id="6657565">(</span><span class="string" id="6657566">&#34;&nbsp;&nbsp;%c&#34;</span><span class="op" id="6657572">,</span>&nbsp;<span class="ident" id="6657574"><a href="/archive/tar/writer_test.go.html#6657440">ch</a></span><span class="op" id="6657576">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6657580">default</span><span class="op" id="6657587">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6657592"><a href="/archive/tar/writer_test.go.html#6657398">s</a></span>&nbsp;<span class="op" id="6657594">+=</span>&nbsp;<span class="ident" id="6657597"><a href="/archive/tar/writer_test.go.html#6654011">fmt</a></span><span class="op" id="6657600">.</span><span class="ident" id="6657601">Sprintf</span><span class="op" id="6657608">(</span><span class="string" id="6657609">&#34;&nbsp;%02x&#34;</span><span class="op" id="6657616">,</span>&nbsp;<span class="ident" id="6657618"><a href="/archive/tar/writer_test.go.html#6657440">ch</a></span><span class="op" id="6657620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6657624">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6657627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6657630">return</span>&nbsp;<span class="ident" id="6657637"><a href="/archive/tar/writer_test.go.html#6657398">s</a></span><br>
<span class="lineno">165</span><span class="op" id="6657639">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6657642">//&nbsp;Render&nbsp;a&nbsp;pseudo-diff&nbsp;between&nbsp;two&nbsp;blocks&nbsp;of&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="6657695">func</span>&nbsp;<span class="ident" id="6657700">bytediff</span><span class="op" id="6657708">(</span><span class="ident" id="6657709">a</span>&nbsp;<span class="op" id="6657711">[</span><span class="op" id="6657712">]</span><span class="builtintype" id="6657713">byte</span><span class="op" id="6657717">,</span>&nbsp;<span class="ident" id="6657719">b</span>&nbsp;<span class="op" id="6657721">[</span><span class="op" id="6657722">]</span><span class="builtintype" id="6657723">byte</span><span class="op" id="6657727">)</span>&nbsp;<span class="builtintype" id="6657729">string</span>&nbsp;<span class="op" id="6657736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6657739">const</span>&nbsp;<span class="ident" id="6657745">rowLen</span>&nbsp;<span class="op" id="6657752">=</span>&nbsp;<span class="num" id="6657754">32</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6657758">s</span>&nbsp;<span class="op" id="6657760">:=</span>&nbsp;<span class="ident" id="6657763"><a href="/archive/tar/writer_test.go.html#6654011">fmt</a></span><span class="op" id="6657766">.</span><span class="ident" id="6657767">Sprintf</span><span class="op" id="6657774">(</span><span class="string" id="6657775">&#34;(%d&nbsp;bytes&nbsp;vs.&nbsp;%d&nbsp;bytes)\n&#34;</span><span class="op" id="6657802">,</span>&nbsp;<span class="builtinfunc" id="6657804">len</span><span class="op" id="6657807">(</span><span class="ident" id="6657808"><a href="/archive/tar/writer_test.go.html#6657709">a</a></span><span class="op" id="6657809">)</span><span class="op" id="6657810">,</span>&nbsp;<span class="builtinfunc" id="6657812">len</span><span class="op" id="6657815">(</span><span class="ident" id="6657816"><a href="/archive/tar/writer_test.go.html#6657719">b</a></span><span class="op" id="6657817">)</span><span class="op" id="6657818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6657821">for</span>&nbsp;<span class="ident" id="6657825">offset</span>&nbsp;<span class="op" id="6657832">:=</span>&nbsp;<span class="num" id="6657835">0</span><span class="op" id="6657836">;</span>&nbsp;<span class="builtinfunc" id="6657838">len</span><span class="op" id="6657841">(</span><span class="ident" id="6657842"><a href="/archive/tar/writer_test.go.html#6657709">a</a></span><span class="op" id="6657843">)</span><span class="op" id="6657844">+</span><span class="builtinfunc" id="6657845">len</span><span class="op" id="6657848">(</span><span class="ident" id="6657849"><a href="/archive/tar/writer_test.go.html#6657719">b</a></span><span class="op" id="6657850">)</span>&nbsp;<span class="op" id="6657852">&gt;</span>&nbsp;<span class="num" id="6657854">0</span><span class="op" id="6657855">;</span>&nbsp;<span class="ident" id="6657857"><a href="/archive/tar/writer_test.go.html#6657825">offset</a></span>&nbsp;<span class="op" id="6657864">+=</span>&nbsp;<span class="ident" id="6657867"><a href="/archive/tar/writer_test.go.html#6657745">rowLen</a></span>&nbsp;<span class="op" id="6657874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6657878">na</span><span class="op" id="6657880">,</span>&nbsp;<span class="ident" id="6657882">nb</span>&nbsp;<span class="op" id="6657885">:=</span>&nbsp;<span class="ident" id="6657888"><a href="/archive/tar/writer_test.go.html#6657745">rowLen</a></span><span class="op" id="6657894">,</span>&nbsp;<span class="ident" id="6657896"><a href="/archive/tar/writer_test.go.html#6657745">rowLen</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6657905">if</span>&nbsp;<span class="ident" id="6657908"><a href="/archive/tar/writer_test.go.html#6657878">na</a></span>&nbsp;<span class="op" id="6657911">&gt;</span>&nbsp;<span class="builtinfunc" id="6657913">len</span><span class="op" id="6657916">(</span><span class="ident" id="6657917"><a href="/archive/tar/writer_test.go.html#6657709">a</a></span><span class="op" id="6657918">)</span>&nbsp;<span class="op" id="6657920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6657925"><a href="/archive/tar/writer_test.go.html#6657878">na</a></span>&nbsp;<span class="op" id="6657928">=</span>&nbsp;<span class="builtinfunc" id="6657930">len</span><span class="op" id="6657933">(</span><span class="ident" id="6657934"><a href="/archive/tar/writer_test.go.html#6657709">a</a></span><span class="op" id="6657935">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6657939">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6657943">if</span>&nbsp;<span class="ident" id="6657946"><a href="/archive/tar/writer_test.go.html#6657882">nb</a></span>&nbsp;<span class="op" id="6657949">&gt;</span>&nbsp;<span class="builtinfunc" id="6657951">len</span><span class="op" id="6657954">(</span><span class="ident" id="6657955"><a href="/archive/tar/writer_test.go.html#6657719">b</a></span><span class="op" id="6657956">)</span>&nbsp;<span class="op" id="6657958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6657963"><a href="/archive/tar/writer_test.go.html#6657882">nb</a></span>&nbsp;<span class="op" id="6657966">=</span>&nbsp;<span class="builtinfunc" id="6657968">len</span><span class="op" id="6657971">(</span><span class="ident" id="6657972"><a href="/archive/tar/writer_test.go.html#6657719">b</a></span><span class="op" id="6657973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6657977">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6657981">sa</span>&nbsp;<span class="op" id="6657984">:=</span>&nbsp;<span class="ident" id="6657987"><a href="/archive/tar/writer_test.go.html#6657339">bytestr</a></span><span class="op" id="6657994">(</span><span class="ident" id="6657995"><a href="/archive/tar/writer_test.go.html#6657825">offset</a></span><span class="op" id="6658001">,</span>&nbsp;<span class="ident" id="6658003"><a href="/archive/tar/writer_test.go.html#6657709">a</a></span><span class="op" id="6658004">[</span><span class="num" id="6658005">0</span><span class="op" id="6658006">:</span><span class="ident" id="6658007"><a href="/archive/tar/writer_test.go.html#6657878">na</a></span><span class="op" id="6658009">]</span><span class="op" id="6658010">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6658014">sb</span>&nbsp;<span class="op" id="6658017">:=</span>&nbsp;<span class="ident" id="6658020"><a href="/archive/tar/writer_test.go.html#6657339">bytestr</a></span><span class="op" id="6658027">(</span><span class="ident" id="6658028"><a href="/archive/tar/writer_test.go.html#6657825">offset</a></span><span class="op" id="6658034">,</span>&nbsp;<span class="ident" id="6658036"><a href="/archive/tar/writer_test.go.html#6657719">b</a></span><span class="op" id="6658037">[</span><span class="num" id="6658038">0</span><span class="op" id="6658039">:</span><span class="ident" id="6658040"><a href="/archive/tar/writer_test.go.html#6657882">nb</a></span><span class="op" id="6658042">]</span><span class="op" id="6658043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6658047">if</span>&nbsp;<span class="ident" id="6658050"><a href="/archive/tar/writer_test.go.html#6657981">sa</a></span>&nbsp;<span class="op" id="6658053">!=</span>&nbsp;<span class="ident" id="6658056"><a href="/archive/tar/writer_test.go.html#6658014">sb</a></span>&nbsp;<span class="op" id="6658059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6658064"><a href="/archive/tar/writer_test.go.html#6657758">s</a></span>&nbsp;<span class="op" id="6658066">+=</span>&nbsp;<span class="ident" id="6658069"><a href="/archive/tar/writer_test.go.html#6654011">fmt</a></span><span class="op" id="6658072">.</span><span class="ident" id="6658073">Sprintf</span><span class="op" id="6658080">(</span><span class="string" id="6658081">&#34;-%v\n+%v\n&#34;</span><span class="op" id="6658093">,</span>&nbsp;<span class="ident" id="6658095"><a href="/archive/tar/writer_test.go.html#6657981">sa</a></span><span class="op" id="6658097">,</span>&nbsp;<span class="ident" id="6658099"><a href="/archive/tar/writer_test.go.html#6658014">sb</a></span><span class="op" id="6658101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6658105">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6658109"><a href="/archive/tar/writer_test.go.html#6657709">a</a></span>&nbsp;<span class="op" id="6658111">=</span>&nbsp;<span class="ident" id="6658113"><a href="/archive/tar/writer_test.go.html#6657709">a</a></span><span class="op" id="6658114">[</span><span class="ident" id="6658115"><a href="/archive/tar/writer_test.go.html#6657878">na</a></span><span class="op" id="6658117">:</span><span class="op" id="6658118">]</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6658122"><a href="/archive/tar/writer_test.go.html#6657719">b</a></span>&nbsp;<span class="op" id="6658124">=</span>&nbsp;<span class="ident" id="6658126"><a href="/archive/tar/writer_test.go.html#6657719">b</a></span><span class="op" id="6658127">[</span><span class="ident" id="6658128"><a href="/archive/tar/writer_test.go.html#6657882">nb</a></span><span class="op" id="6658130">:</span><span class="op" id="6658131">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6658134">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6658137">return</span>&nbsp;<span class="ident" id="6658144"><a href="/archive/tar/writer_test.go.html#6657758">s</a></span><br>
<span class="lineno"></span><span class="op" id="6658146">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="keyword" id="6658149">func</span>&nbsp;<span class="ident" id="6658154">TestWriter</span><span class="op" id="6658164">(</span><span class="ident" id="6658165">t</span>&nbsp;<span class="op" id="6658167">*</span><span class="ident" id="6658168"><a href="/archive/tar/writer_test.go.html#6654065">testing</a></span><span class="op" id="6658175">.</span><span class="ident" id="6658176">T</span><span class="op" id="6658177">)</span>&nbsp;<span class="op" id="6658179">{</span><br>
<span class="lineno"></span><span class="ident" id="6658181">testLoop</span><span class="op" id="6658189">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6658192">for</span>&nbsp;<span class="ident" id="6658196">i</span><span class="op" id="6658197">,</span>&nbsp;<span class="ident" id="6658199">test</span>&nbsp;<span class="op" id="6658204">:=</span>&nbsp;<span class="keyword" id="6658207">range</span>&nbsp;<span class="ident" id="6658213"><a href="/archive/tar/writer_test.go.html#6654279">writerTests</a></span>&nbsp;<span class="op" id="6658225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6658229">expected</span><span class="op" id="6658237">,</span>&nbsp;<span class="ident" id="6658239">err</span>&nbsp;<span class="op" id="6658243">:=</span>&nbsp;<span class="ident" id="6658246"><a href="/archive/tar/writer_test.go.html#6654024">ioutil</a></span><span class="op" id="6658252">.</span><span class="ident" id="6658253">ReadFile</span><span class="op" id="6658261">(</span><span class="ident" id="6658262"><a href="/archive/tar/writer_test.go.html#6658199">test</a></span><span class="op" id="6658266">.</span><span class="ident" id="6658267">file</span><span class="op" id="6658271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6658275">if</span>&nbsp;<span class="ident" id="6658278"><a href="/archive/tar/writer_test.go.html#6658239">err</a></span>&nbsp;<span class="op" id="6658282">!=</span>&nbsp;<span class="ident" id="6658285">nil</span>&nbsp;<span class="op" id="6658289">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6658294"><a href="/archive/tar/writer_test.go.html#6658165">t</a></span><span class="op" id="6658295">.</span><span class="ident" id="6658296">Errorf</span><span class="op" id="6658302">(</span><span class="string" id="6658303">&#34;test&nbsp;%d:&nbsp;Unexpected&nbsp;error:&nbsp;%v&#34;</span><span class="op" id="6658334">,</span>&nbsp;<span class="ident" id="6658336"><a href="/archive/tar/writer_test.go.html#6658196">i</a></span><span class="op" id="6658337">,</span>&nbsp;<span class="ident" id="6658339"><a href="/archive/tar/writer_test.go.html#6658239">err</a></span><span class="op" id="6658342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6658347">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6658358">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6658363">buf</span>&nbsp;<span class="op" id="6658367">:=</span>&nbsp;<span class="builtinfunc" id="6658370">new</span><span class="op" id="6658373">(</span><span class="ident" id="6658374"><a href="/archive/tar/writer_test.go.html#6654002">bytes</a></span><span class="op" id="6658379">.</span><span class="ident" id="6658380">Buffer</span><span class="op" id="6658386">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6658390">tw</span>&nbsp;<span class="op" id="6658393">:=</span>&nbsp;<span class="ident" id="6658396"><a href="/archive/tar/writer.go.html#6218490">NewWriter</a></span><span class="op" id="6658405">(</span><span class="ident" id="6658406"><a href="/archive/tar/writer_test.go.html#6654076">iotest</a></span><span class="op" id="6658412">.</span><span class="ident" id="6658413">TruncateWriter</span><span class="op" id="6658427">(</span><span class="ident" id="6658428"><a href="/archive/tar/writer_test.go.html#6658363">buf</a></span><span class="op" id="6658431">,</span>&nbsp;<span class="num" id="6658433">4</span><span class="op" id="6658434">&lt;&lt;</span><span class="num" id="6658436">10</span><span class="op" id="6658438">)</span><span class="op" id="6658439">)</span>&nbsp;<span class="comment" id="6658441">//&nbsp;only&nbsp;catch&nbsp;the&nbsp;first&nbsp;4&nbsp;KB</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6658472">big</span>&nbsp;<span class="op" id="6658476">:=</span>&nbsp;<span class="builtintype" id="6658479">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6658487">for</span>&nbsp;<span class="ident" id="6658491">j</span><span class="op" id="6658492">,</span>&nbsp;<span class="ident" id="6658494">entry</span>&nbsp;<span class="op" id="6658500">:=</span>&nbsp;<span class="keyword" id="6658503">range</span>&nbsp;<span class="ident" id="6658509"><a href="/archive/tar/writer_test.go.html#6658199">test</a></span><span class="op" id="6658513">.</span><span class="ident" id="6658514">entries</span>&nbsp;<span class="op" id="6658522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6658527"><a href="/archive/tar/writer_test.go.html#6658472">big</a></span>&nbsp;<span class="op" id="6658531">=</span>&nbsp;<span class="ident" id="6658533"><a href="/archive/tar/writer_test.go.html#6658472">big</a></span>&nbsp;<span class="op" id="6658537">||</span>&nbsp;<span class="ident" id="6658540"><a href="/archive/tar/writer_test.go.html#6658494">entry</a></span><span class="op" id="6658545">.</span><span class="ident" id="6658546">header</span><span class="op" id="6658552">.</span><span class="ident" id="6658553">Size</span>&nbsp;<span class="op" id="6658558">&gt;</span>&nbsp;<span class="num" id="6658560">1</span><span class="op" id="6658561">&lt;&lt;</span><span class="num" id="6658563">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6658569">if</span>&nbsp;<span class="ident" id="6658572">err</span>&nbsp;<span class="op" id="6658576">:=</span>&nbsp;<span class="ident" id="6658579"><a href="/archive/tar/writer_test.go.html#6658390">tw</a></span><span class="op" id="6658581">.</span><span class="ident" id="6658582">WriteHeader</span><span class="op" id="6658593">(</span><span class="ident" id="6658594"><a href="/archive/tar/writer_test.go.html#6658494">entry</a></span><span class="op" id="6658599">.</span><span class="ident" id="6658600">header</span><span class="op" id="6658606">)</span><span class="op" id="6658607">;</span>&nbsp;<span class="ident" id="6658609"><a href="/archive/tar/writer_test.go.html#6658572">err</a></span>&nbsp;<span class="op" id="6658613">!=</span>&nbsp;<span class="ident" id="6658616">nil</span>&nbsp;<span class="op" id="6658620">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6658626"><a href="/archive/tar/writer_test.go.html#6658165">t</a></span><span class="op" id="6658627">.</span><span class="ident" id="6658628">Errorf</span><span class="op" id="6658634">(</span><span class="string" id="6658635">&#34;test&nbsp;%d,&nbsp;entry&nbsp;%d:&nbsp;Failed&nbsp;writing&nbsp;header:&nbsp;%v&#34;</span><span class="op" id="6658681">,</span>&nbsp;<span class="ident" id="6658683"><a href="/archive/tar/writer_test.go.html#6658196">i</a></span><span class="op" id="6658684">,</span>&nbsp;<span class="ident" id="6658686"><a href="/archive/tar/writer_test.go.html#6658491">j</a></span><span class="op" id="6658687">,</span>&nbsp;<span class="ident" id="6658689"><a href="/archive/tar/writer_test.go.html#6658572">err</a></span><span class="op" id="6658692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6658698">continue</span>&nbsp;<span class="ident" id="6658707">testLoop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6658719">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6658724">if</span>&nbsp;<span class="ident" id="6658727">_</span><span class="op" id="6658728">,</span>&nbsp;<span class="ident" id="6658730">err</span>&nbsp;<span class="op" id="6658734">:=</span>&nbsp;<span class="ident" id="6658737"><a href="/archive/tar/writer_test.go.html#6654018">io</a></span><span class="op" id="6658739">.</span><span class="ident" id="6658740">WriteString</span><span class="op" id="6658751">(</span><span class="ident" id="6658752"><a href="/archive/tar/writer_test.go.html#6658390">tw</a></span><span class="op" id="6658754">,</span>&nbsp;<span class="ident" id="6658756"><a href="/archive/tar/writer_test.go.html#6658494">entry</a></span><span class="op" id="6658761">.</span><span class="ident" id="6658762">contents</span><span class="op" id="6658770">)</span><span class="op" id="6658771">;</span>&nbsp;<span class="ident" id="6658773"><a href="/archive/tar/writer_test.go.html#6658730">err</a></span>&nbsp;<span class="op" id="6658777">!=</span>&nbsp;<span class="ident" id="6658780">nil</span>&nbsp;<span class="op" id="6658784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6658790"><a href="/archive/tar/writer_test.go.html#6658165">t</a></span><span class="op" id="6658791">.</span><span class="ident" id="6658792">Errorf</span><span class="op" id="6658798">(</span><span class="string" id="6658799">&#34;test&nbsp;%d,&nbsp;entry&nbsp;%d:&nbsp;Failed&nbsp;writing&nbsp;contents:&nbsp;%v&#34;</span><span class="op" id="6658847">,</span>&nbsp;<span class="ident" id="6658849"><a href="/archive/tar/writer_test.go.html#6658196">i</a></span><span class="op" id="6658850">,</span>&nbsp;<span class="ident" id="6658852"><a href="/archive/tar/writer_test.go.html#6658491">j</a></span><span class="op" id="6658853">,</span>&nbsp;<span class="ident" id="6658855"><a href="/archive/tar/writer_test.go.html#6658730">err</a></span><span class="op" id="6658858">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6658864">continue</span>&nbsp;<span class="ident" id="6658873">testLoop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6658885">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6658889">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6658893">//&nbsp;Only&nbsp;interested&nbsp;in&nbsp;Close&nbsp;failures&nbsp;for&nbsp;the&nbsp;small&nbsp;tests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6658953">if</span>&nbsp;<span class="ident" id="6658956">err</span>&nbsp;<span class="op" id="6658960">:=</span>&nbsp;<span class="ident" id="6658963"><a href="/archive/tar/writer_test.go.html#6658390">tw</a></span><span class="op" id="6658965">.</span><span class="ident" id="6658966">Close</span><span class="op" id="6658971">(</span><span class="op" id="6658972">)</span><span class="op" id="6658973">;</span>&nbsp;<span class="ident" id="6658975"><a href="/archive/tar/writer_test.go.html#6658956">err</a></span>&nbsp;<span class="op" id="6658979">!=</span>&nbsp;<span class="ident" id="6658982">nil</span>&nbsp;<span class="op" id="6658986">&amp;&amp;</span>&nbsp;<span class="op" id="6658989">!</span><span class="ident" id="6658990"><a href="/archive/tar/writer_test.go.html#6658472">big</a></span>&nbsp;<span class="op" id="6658994">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6658999"><a href="/archive/tar/writer_test.go.html#6658165">t</a></span><span class="op" id="6659000">.</span><span class="ident" id="6659001">Errorf</span><span class="op" id="6659007">(</span><span class="string" id="6659008">&#34;test&nbsp;%d:&nbsp;Failed&nbsp;closing&nbsp;archive:&nbsp;%v&#34;</span><span class="op" id="6659045">,</span>&nbsp;<span class="ident" id="6659047"><a href="/archive/tar/writer_test.go.html#6658196">i</a></span><span class="op" id="6659048">,</span>&nbsp;<span class="ident" id="6659050"><a href="/archive/tar/writer_test.go.html#6658956">err</a></span><span class="op" id="6659053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6659058">continue</span>&nbsp;<span class="ident" id="6659067">testLoop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6659078">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6659083">actual</span>&nbsp;<span class="op" id="6659090">:=</span>&nbsp;<span class="ident" id="6659093"><a href="/archive/tar/writer_test.go.html#6658363">buf</a></span><span class="op" id="6659096">.</span><span class="ident" id="6659097">Bytes</span><span class="op" id="6659102">(</span><span class="op" id="6659103">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6659107">if</span>&nbsp;<span class="op" id="6659110">!</span><span class="ident" id="6659111"><a href="/archive/tar/writer_test.go.html#6654002">bytes</a></span><span class="op" id="6659116">.</span><span class="ident" id="6659117">Equal</span><span class="op" id="6659122">(</span><span class="ident" id="6659123"><a href="/archive/tar/writer_test.go.html#6658229">expected</a></span><span class="op" id="6659131">,</span>&nbsp;<span class="ident" id="6659133"><a href="/archive/tar/writer_test.go.html#6659083">actual</a></span><span class="op" id="6659139">)</span>&nbsp;<span class="op" id="6659141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6659146"><a href="/archive/tar/writer_test.go.html#6658165">t</a></span><span class="op" id="6659147">.</span><span class="ident" id="6659148">Errorf</span><span class="op" id="6659154">(</span><span class="string" id="6659155">&#34;test&nbsp;%d:&nbsp;Incorrect&nbsp;result:&nbsp;(-=expected,&nbsp;+=actual)\n%v&#34;</span><span class="op" id="6659210">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6659216"><a href="/archive/tar/writer_test.go.html#6658196">i</a></span><span class="op" id="6659217">,</span>&nbsp;<span class="ident" id="6659219"><a href="/archive/tar/writer_test.go.html#6657700">bytediff</a></span><span class="op" id="6659227">(</span><span class="ident" id="6659228"><a href="/archive/tar/writer_test.go.html#6658229">expected</a></span><span class="op" id="6659236">,</span>&nbsp;<span class="ident" id="6659238"><a href="/archive/tar/writer_test.go.html#6659083">actual</a></span><span class="op" id="6659244">)</span><span class="op" id="6659245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6659249">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6659253">if</span>&nbsp;<span class="ident" id="6659256"><a href="/archive/tar/writer_test.go.html#6654065">testing</a></span><span class="op" id="6659263">.</span><span class="ident" id="6659264">Short</span><span class="op" id="6659269">(</span><span class="op" id="6659270">)</span>&nbsp;<span class="op" id="6659272">{</span>&nbsp;<span class="comment" id="6659274">//&nbsp;The&nbsp;second&nbsp;test&nbsp;is&nbsp;expensive.</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6659310">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6659318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6659321">}</span><br>
<span class="lineno"></span><span class="op" id="6659323">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="keyword" id="6659326">func</span>&nbsp;<span class="ident" id="6659331">TestPax</span><span class="op" id="6659338">(</span><span class="ident" id="6659339">t</span>&nbsp;<span class="op" id="6659341">*</span><span class="ident" id="6659342"><a href="/archive/tar/writer_test.go.html#6654065">testing</a></span><span class="op" id="6659349">.</span><span class="ident" id="6659350">T</span><span class="op" id="6659351">)</span>&nbsp;<span class="op" id="6659353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6659356">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;a&nbsp;large&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6659396">fileinfo</span><span class="op" id="6659404">,</span>&nbsp;<span class="ident" id="6659406">err</span>&nbsp;<span class="op" id="6659410">:=</span>&nbsp;<span class="ident" id="6659413"><a href="/archive/tar/writer_test.go.html#6654037">os</a></span><span class="op" id="6659415">.</span><span class="ident" id="6659416">Stat</span><span class="op" id="6659420">(</span><span class="string" id="6659421">&#34;testdata/small.txt&#34;</span><span class="op" id="6659441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6659444">if</span>&nbsp;<span class="ident" id="6659447"><a href="/archive/tar/writer_test.go.html#6659406">err</a></span>&nbsp;<span class="op" id="6659451">!=</span>&nbsp;<span class="ident" id="6659454">nil</span>&nbsp;<span class="op" id="6659458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6659462"><a href="/archive/tar/writer_test.go.html#6659339">t</a></span><span class="op" id="6659463">.</span><span class="ident" id="6659464">Fatal</span><span class="op" id="6659469">(</span><span class="ident" id="6659470"><a href="/archive/tar/writer_test.go.html#6659406">err</a></span><span class="op" id="6659473">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6659476">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6659479">hdr</span><span class="op" id="6659482">,</span>&nbsp;<span class="ident" id="6659484"><a href="/archive/tar/writer_test.go.html#6659406">err</a></span>&nbsp;<span class="op" id="6659488">:=</span>&nbsp;<span class="ident" id="6659491"><a href="/archive/tar/common.go.html#6191374">FileInfoHeader</a></span><span class="op" id="6659505">(</span><span class="ident" id="6659506"><a href="/archive/tar/writer_test.go.html#6659396">fileinfo</a></span><span class="op" id="6659514">,</span>&nbsp;<span class="string" id="6659516">&#34;&#34;</span><span class="op" id="6659518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6659521">if</span>&nbsp;<span class="ident" id="6659524"><a href="/archive/tar/writer_test.go.html#6659406">err</a></span>&nbsp;<span class="op" id="6659528">!=</span>&nbsp;<span class="ident" id="6659531">nil</span>&nbsp;<span class="op" id="6659535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6659539"><a href="/archive/tar/writer_test.go.html#6659339">t</a></span><span class="op" id="6659540">.</span><span class="ident" id="6659541">Fatalf</span><span class="op" id="6659547">(</span><span class="string" id="6659548">&#34;os.Stat:&nbsp;%v&#34;</span><span class="op" id="6659561">,</span>&nbsp;<span class="ident" id="6659563"><a href="/archive/tar/writer_test.go.html#6659406">err</a></span><span class="op" id="6659566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6659569">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6659572">//&nbsp;Force&nbsp;a&nbsp;PAX&nbsp;long&nbsp;name&nbsp;to&nbsp;be&nbsp;written</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6659612">longName</span>&nbsp;<span class="op" id="6659621">:=</span>&nbsp;<span class="ident" id="6659624"><a href="/archive/tar/writer_test.go.html#6654054">strings</a></span><span class="op" id="6659631">.</span><span class="ident" id="6659632">Repeat</span><span class="op" id="6659638">(</span><span class="string" id="6659639">&#34;ab&#34;</span><span class="op" id="6659643">,</span>&nbsp;<span class="num" id="6659645">100</span><span class="op" id="6659648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6659651">contents</span>&nbsp;<span class="op" id="6659660">:=</span>&nbsp;<span class="ident" id="6659663"><a href="/archive/tar/writer_test.go.html#6654054">strings</a></span><span class="op" id="6659670">.</span><span class="ident" id="6659671">Repeat</span><span class="op" id="6659677">(</span><span class="string" id="6659678">&#34;&nbsp;&#34;</span><span class="op" id="6659681">,</span>&nbsp;<span class="builtintype" id="6659683">int</span><span class="op" id="6659686">(</span><span class="ident" id="6659687"><a href="/archive/tar/writer_test.go.html#6659479">hdr</a></span><span class="op" id="6659690">.</span><span class="ident" id="6659691">Size</span><span class="op" id="6659695">)</span><span class="op" id="6659696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6659699"><a href="/archive/tar/writer_test.go.html#6659479">hdr</a></span><span class="op" id="6659702">.</span><span class="ident" id="6659703">Name</span>&nbsp;<span class="op" id="6659708">=</span>&nbsp;<span class="ident" id="6659710"><a href="/archive/tar/writer_test.go.html#6659612">longName</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6659720">var</span>&nbsp;<span class="ident" id="6659724">buf</span>&nbsp;<span class="ident" id="6659728"><a href="/archive/tar/writer_test.go.html#6654002">bytes</a></span><span class="op" id="6659733">.</span><span class="ident" id="6659734">Buffer</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6659742">writer</span>&nbsp;<span class="op" id="6659749">:=</span>&nbsp;<span class="ident" id="6659752"><a href="/archive/tar/writer.go.html#6218490">NewWriter</a></span><span class="op" id="6659761">(</span><span class="op" id="6659762">&amp;</span><span class="ident" id="6659763"><a href="/archive/tar/writer_test.go.html#6659724">buf</a></span><span class="op" id="6659766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6659769">if</span>&nbsp;<span class="ident" id="6659772">err</span>&nbsp;<span class="op" id="6659776">:=</span>&nbsp;<span class="ident" id="6659779"><a href="/archive/tar/writer_test.go.html#6659742">writer</a></span><span class="op" id="6659785">.</span><span class="ident" id="6659786">WriteHeader</span><span class="op" id="6659797">(</span><span class="ident" id="6659798"><a href="/archive/tar/writer_test.go.html#6659479">hdr</a></span><span class="op" id="6659801">)</span><span class="op" id="6659802">;</span>&nbsp;<span class="ident" id="6659804"><a href="/archive/tar/writer_test.go.html#6659772">err</a></span>&nbsp;<span class="op" id="6659808">!=</span>&nbsp;<span class="ident" id="6659811">nil</span>&nbsp;<span class="op" id="6659815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6659819"><a href="/archive/tar/writer_test.go.html#6659339">t</a></span><span class="op" id="6659820">.</span><span class="ident" id="6659821">Fatal</span><span class="op" id="6659826">(</span><span class="ident" id="6659827"><a href="/archive/tar/writer_test.go.html#6659772">err</a></span><span class="op" id="6659830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6659833">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6659836">if</span>&nbsp;<span class="ident" id="6659839">_</span><span class="op" id="6659840">,</span>&nbsp;<span class="ident" id="6659842"><a href="/archive/tar/writer_test.go.html#6659406">err</a></span>&nbsp;<span class="op" id="6659846">=</span>&nbsp;<span class="ident" id="6659848"><a href="/archive/tar/writer_test.go.html#6659742">writer</a></span><span class="op" id="6659854">.</span><span class="ident" id="6659855">Write</span><span class="op" id="6659860">(</span><span class="op" id="6659861">[</span><span class="op" id="6659862">]</span><span class="builtintype" id="6659863">byte</span><span class="op" id="6659867">(</span><span class="ident" id="6659868"><a href="/archive/tar/writer_test.go.html#6659651">contents</a></span><span class="op" id="6659876">)</span><span class="op" id="6659877">)</span><span class="op" id="6659878">;</span>&nbsp;<span class="ident" id="6659880"><a href="/archive/tar/writer_test.go.html#6659406">err</a></span>&nbsp;<span class="op" id="6659884">!=</span>&nbsp;<span class="ident" id="6659887">nil</span>&nbsp;<span class="op" id="6659891">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6659895"><a href="/archive/tar/writer_test.go.html#6659339">t</a></span><span class="op" id="6659896">.</span><span class="ident" id="6659897">Fatal</span><span class="op" id="6659902">(</span><span class="ident" id="6659903"><a href="/archive/tar/writer_test.go.html#6659406">err</a></span><span class="op" id="6659906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6659909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6659912">if</span>&nbsp;<span class="ident" id="6659915">err</span>&nbsp;<span class="op" id="6659919">:=</span>&nbsp;<span class="ident" id="6659922"><a href="/archive/tar/writer_test.go.html#6659742">writer</a></span><span class="op" id="6659928">.</span><span class="ident" id="6659929">Close</span><span class="op" id="6659934">(</span><span class="op" id="6659935">)</span><span class="op" id="6659936">;</span>&nbsp;<span class="ident" id="6659938"><a href="/archive/tar/writer_test.go.html#6659915">err</a></span>&nbsp;<span class="op" id="6659942">!=</span>&nbsp;<span class="ident" id="6659945">nil</span>&nbsp;<span class="op" id="6659949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6659953"><a href="/archive/tar/writer_test.go.html#6659339">t</a></span><span class="op" id="6659954">.</span><span class="ident" id="6659955">Fatal</span><span class="op" id="6659960">(</span><span class="ident" id="6659961"><a href="/archive/tar/writer_test.go.html#6659915">err</a></span><span class="op" id="6659964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6659967">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6659970">//&nbsp;Simple&nbsp;test&nbsp;to&nbsp;make&nbsp;sure&nbsp;PAX&nbsp;extensions&nbsp;are&nbsp;in&nbsp;effect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6660028">if</span>&nbsp;<span class="op" id="6660031">!</span><span class="ident" id="6660032"><a href="/archive/tar/writer_test.go.html#6654002">bytes</a></span><span class="op" id="6660037">.</span><span class="ident" id="6660038">Contains</span><span class="op" id="6660046">(</span><span class="ident" id="6660047"><a href="/archive/tar/writer_test.go.html#6659724">buf</a></span><span class="op" id="6660050">.</span><span class="ident" id="6660051">Bytes</span><span class="op" id="6660056">(</span><span class="op" id="6660057">)</span><span class="op" id="6660058">,</span>&nbsp;<span class="op" id="6660060">[</span><span class="op" id="6660061">]</span><span class="builtintype" id="6660062">byte</span><span class="op" id="6660066">(</span><span class="string" id="6660067">&#34;PaxHeaders.&#34;</span><span class="op" id="6660080">)</span><span class="op" id="6660081">)</span>&nbsp;<span class="op" id="6660083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6660087"><a href="/archive/tar/writer_test.go.html#6659339">t</a></span><span class="op" id="6660088">.</span><span class="ident" id="6660089">Fatal</span><span class="op" id="6660094">(</span><span class="string" id="6660095">&#34;Expected&nbsp;at&nbsp;least&nbsp;one&nbsp;PAX&nbsp;header&nbsp;to&nbsp;be&nbsp;written.&#34;</span><span class="op" id="6660144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6660147">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6660150">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;a&nbsp;long&nbsp;name&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6660212">reader</span>&nbsp;<span class="op" id="6660219">:=</span>&nbsp;<span class="ident" id="6660222"><a href="/archive/tar/reader.go.html#6196034">NewReader</a></span><span class="op" id="6660231">(</span><span class="op" id="6660232">&amp;</span><span class="ident" id="6660233"><a href="/archive/tar/writer_test.go.html#6659724">buf</a></span><span class="op" id="6660236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6660239"><a href="/archive/tar/writer_test.go.html#6659479">hdr</a></span><span class="op" id="6660242">,</span>&nbsp;<span class="ident" id="6660244"><a href="/archive/tar/writer_test.go.html#6659406">err</a></span>&nbsp;<span class="op" id="6660248">=</span>&nbsp;<span class="ident" id="6660250"><a href="/archive/tar/writer_test.go.html#6660212">reader</a></span><span class="op" id="6660256">.</span><span class="ident" id="6660257">Next</span><span class="op" id="6660261">(</span><span class="op" id="6660262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6660265">if</span>&nbsp;<span class="ident" id="6660268"><a href="/archive/tar/writer_test.go.html#6659406">err</a></span>&nbsp;<span class="op" id="6660272">!=</span>&nbsp;<span class="ident" id="6660275">nil</span>&nbsp;<span class="op" id="6660279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6660283"><a href="/archive/tar/writer_test.go.html#6659339">t</a></span><span class="op" id="6660284">.</span><span class="ident" id="6660285">Fatal</span><span class="op" id="6660290">(</span><span class="ident" id="6660291"><a href="/archive/tar/writer_test.go.html#6659406">err</a></span><span class="op" id="6660294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6660297">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6660300">if</span>&nbsp;<span class="ident" id="6660303"><a href="/archive/tar/writer_test.go.html#6659479">hdr</a></span><span class="op" id="6660306">.</span><span class="ident" id="6660307">Name</span>&nbsp;<span class="op" id="6660312">!=</span>&nbsp;<span class="ident" id="6660315"><a href="/archive/tar/writer_test.go.html#6659612">longName</a></span>&nbsp;<span class="op" id="6660324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6660328"><a href="/archive/tar/writer_test.go.html#6659339">t</a></span><span class="op" id="6660329">.</span><span class="ident" id="6660330">Fatal</span><span class="op" id="6660335">(</span><span class="string" id="6660336">&#34;Couldn&#39;t&nbsp;recover&nbsp;long&nbsp;file&nbsp;name&#34;</span><span class="op" id="6660369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6660372">}</span><br>
<span class="lineno"></span><span class="op" id="6660374">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="keyword" id="6660377">func</span>&nbsp;<span class="ident" id="6660382">TestPaxSymlink</span><span class="op" id="6660396">(</span><span class="ident" id="6660397">t</span>&nbsp;<span class="op" id="6660399">*</span><span class="ident" id="6660400"><a href="/archive/tar/writer_test.go.html#6654065">testing</a></span><span class="op" id="6660407">.</span><span class="ident" id="6660408">T</span><span class="op" id="6660409">)</span>&nbsp;<span class="op" id="6660411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6660414">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;a&nbsp;large&nbsp;linkname</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6660458">fileinfo</span><span class="op" id="6660466">,</span>&nbsp;<span class="ident" id="6660468">err</span>&nbsp;<span class="op" id="6660472">:=</span>&nbsp;<span class="ident" id="6660475"><a href="/archive/tar/writer_test.go.html#6654037">os</a></span><span class="op" id="6660477">.</span><span class="ident" id="6660478">Stat</span><span class="op" id="6660482">(</span><span class="string" id="6660483">&#34;testdata/small.txt&#34;</span><span class="op" id="6660503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6660506">if</span>&nbsp;<span class="ident" id="6660509"><a href="/archive/tar/writer_test.go.html#6660468">err</a></span>&nbsp;<span class="op" id="6660513">!=</span>&nbsp;<span class="ident" id="6660516">nil</span>&nbsp;<span class="op" id="6660520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6660524"><a href="/archive/tar/writer_test.go.html#6660397">t</a></span><span class="op" id="6660525">.</span><span class="ident" id="6660526">Fatal</span><span class="op" id="6660531">(</span><span class="ident" id="6660532"><a href="/archive/tar/writer_test.go.html#6660468">err</a></span><span class="op" id="6660535">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6660538">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6660541">hdr</span><span class="op" id="6660544">,</span>&nbsp;<span class="ident" id="6660546"><a href="/archive/tar/writer_test.go.html#6660468">err</a></span>&nbsp;<span class="op" id="6660550">:=</span>&nbsp;<span class="ident" id="6660553"><a href="/archive/tar/common.go.html#6191374">FileInfoHeader</a></span><span class="op" id="6660567">(</span><span class="ident" id="6660568"><a href="/archive/tar/writer_test.go.html#6660458">fileinfo</a></span><span class="op" id="6660576">,</span>&nbsp;<span class="string" id="6660578">&#34;&#34;</span><span class="op" id="6660580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6660583"><a href="/archive/tar/writer_test.go.html#6660541">hdr</a></span><span class="op" id="6660586">.</span><span class="ident" id="6660587">Typeflag</span>&nbsp;<span class="op" id="6660596">=</span>&nbsp;<span class="ident" id="6660598"><a href="/archive/tar/common.go.html#6186407">TypeSymlink</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6660611">if</span>&nbsp;<span class="ident" id="6660614"><a href="/archive/tar/writer_test.go.html#6660468">err</a></span>&nbsp;<span class="op" id="6660618">!=</span>&nbsp;<span class="ident" id="6660621">nil</span>&nbsp;<span class="op" id="6660625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6660629"><a href="/archive/tar/writer_test.go.html#6660397">t</a></span><span class="op" id="6660630">.</span><span class="ident" id="6660631">Fatalf</span><span class="op" id="6660637">(</span><span class="string" id="6660638">&#34;os.Stat:1&nbsp;%v&#34;</span><span class="op" id="6660652">,</span>&nbsp;<span class="ident" id="6660654"><a href="/archive/tar/writer_test.go.html#6660468">err</a></span><span class="op" id="6660657">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6660660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6660663">//&nbsp;Force&nbsp;a&nbsp;PAX&nbsp;long&nbsp;linkname&nbsp;to&nbsp;be&nbsp;written</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6660707">longLinkname</span>&nbsp;<span class="op" id="6660720">:=</span>&nbsp;<span class="ident" id="6660723"><a href="/archive/tar/writer_test.go.html#6654054">strings</a></span><span class="op" id="6660730">.</span><span class="ident" id="6660731">Repeat</span><span class="op" id="6660737">(</span><span class="string" id="6660738">&#34;1234567890/1234567890&#34;</span><span class="op" id="6660761">,</span>&nbsp;<span class="num" id="6660763">10</span><span class="op" id="6660765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6660768"><a href="/archive/tar/writer_test.go.html#6660541">hdr</a></span><span class="op" id="6660771">.</span><span class="ident" id="6660772">Linkname</span>&nbsp;<span class="op" id="6660781">=</span>&nbsp;<span class="ident" id="6660783"><a href="/archive/tar/writer_test.go.html#6660707">longLinkname</a></span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6660798"><a href="/archive/tar/writer_test.go.html#6660541">hdr</a></span><span class="op" id="6660801">.</span><span class="ident" id="6660802">Size</span>&nbsp;<span class="op" id="6660807">=</span>&nbsp;<span class="num" id="6660809">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6660812">var</span>&nbsp;<span class="ident" id="6660816">buf</span>&nbsp;<span class="ident" id="6660820"><a href="/archive/tar/writer_test.go.html#6654002">bytes</a></span><span class="op" id="6660825">.</span><span class="ident" id="6660826">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6660834">writer</span>&nbsp;<span class="op" id="6660841">:=</span>&nbsp;<span class="ident" id="6660844"><a href="/archive/tar/writer.go.html#6218490">NewWriter</a></span><span class="op" id="6660853">(</span><span class="op" id="6660854">&amp;</span><span class="ident" id="6660855"><a href="/archive/tar/writer_test.go.html#6660816">buf</a></span><span class="op" id="6660858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6660861">if</span>&nbsp;<span class="ident" id="6660864">err</span>&nbsp;<span class="op" id="6660868">:=</span>&nbsp;<span class="ident" id="6660871"><a href="/archive/tar/writer_test.go.html#6660834">writer</a></span><span class="op" id="6660877">.</span><span class="ident" id="6660878">WriteHeader</span><span class="op" id="6660889">(</span><span class="ident" id="6660890"><a href="/archive/tar/writer_test.go.html#6660541">hdr</a></span><span class="op" id="6660893">)</span><span class="op" id="6660894">;</span>&nbsp;<span class="ident" id="6660896"><a href="/archive/tar/writer_test.go.html#6660864">err</a></span>&nbsp;<span class="op" id="6660900">!=</span>&nbsp;<span class="ident" id="6660903">nil</span>&nbsp;<span class="op" id="6660907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6660911"><a href="/archive/tar/writer_test.go.html#6660397">t</a></span><span class="op" id="6660912">.</span><span class="ident" id="6660913">Fatal</span><span class="op" id="6660918">(</span><span class="ident" id="6660919"><a href="/archive/tar/writer_test.go.html#6660864">err</a></span><span class="op" id="6660922">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6660925">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6660928">if</span>&nbsp;<span class="ident" id="6660931">err</span>&nbsp;<span class="op" id="6660935">:=</span>&nbsp;<span class="ident" id="6660938"><a href="/archive/tar/writer_test.go.html#6660834">writer</a></span><span class="op" id="6660944">.</span><span class="ident" id="6660945">Close</span><span class="op" id="6660950">(</span><span class="op" id="6660951">)</span><span class="op" id="6660952">;</span>&nbsp;<span class="ident" id="6660954"><a href="/archive/tar/writer_test.go.html#6660931">err</a></span>&nbsp;<span class="op" id="6660958">!=</span>&nbsp;<span class="ident" id="6660961">nil</span>&nbsp;<span class="op" id="6660965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6660969"><a href="/archive/tar/writer_test.go.html#6660397">t</a></span><span class="op" id="6660970">.</span><span class="ident" id="6660971">Fatal</span><span class="op" id="6660976">(</span><span class="ident" id="6660977"><a href="/archive/tar/writer_test.go.html#6660931">err</a></span><span class="op" id="6660980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6660983">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6660986">//&nbsp;Simple&nbsp;test&nbsp;to&nbsp;make&nbsp;sure&nbsp;PAX&nbsp;extensions&nbsp;are&nbsp;in&nbsp;effect</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6661044">if</span>&nbsp;<span class="op" id="6661047">!</span><span class="ident" id="6661048"><a href="/archive/tar/writer_test.go.html#6654002">bytes</a></span><span class="op" id="6661053">.</span><span class="ident" id="6661054">Contains</span><span class="op" id="6661062">(</span><span class="ident" id="6661063"><a href="/archive/tar/writer_test.go.html#6660816">buf</a></span><span class="op" id="6661066">.</span><span class="ident" id="6661067">Bytes</span><span class="op" id="6661072">(</span><span class="op" id="6661073">)</span><span class="op" id="6661074">,</span>&nbsp;<span class="op" id="6661076">[</span><span class="op" id="6661077">]</span><span class="builtintype" id="6661078">byte</span><span class="op" id="6661082">(</span><span class="string" id="6661083">&#34;PaxHeaders.&#34;</span><span class="op" id="6661096">)</span><span class="op" id="6661097">)</span>&nbsp;<span class="op" id="6661099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6661103"><a href="/archive/tar/writer_test.go.html#6660397">t</a></span><span class="op" id="6661104">.</span><span class="ident" id="6661105">Fatal</span><span class="op" id="6661110">(</span><span class="string" id="6661111">&#34;Expected&nbsp;at&nbsp;least&nbsp;one&nbsp;PAX&nbsp;header&nbsp;to&nbsp;be&nbsp;written.&#34;</span><span class="op" id="6661160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6661163">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6661166">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;a&nbsp;long&nbsp;name&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6661228">reader</span>&nbsp;<span class="op" id="6661235">:=</span>&nbsp;<span class="ident" id="6661238"><a href="/archive/tar/reader.go.html#6196034">NewReader</a></span><span class="op" id="6661247">(</span><span class="op" id="6661248">&amp;</span><span class="ident" id="6661249"><a href="/archive/tar/writer_test.go.html#6660816">buf</a></span><span class="op" id="6661252">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6661255"><a href="/archive/tar/writer_test.go.html#6660541">hdr</a></span><span class="op" id="6661258">,</span>&nbsp;<span class="ident" id="6661260"><a href="/archive/tar/writer_test.go.html#6660468">err</a></span>&nbsp;<span class="op" id="6661264">=</span>&nbsp;<span class="ident" id="6661266"><a href="/archive/tar/writer_test.go.html#6661228">reader</a></span><span class="op" id="6661272">.</span><span class="ident" id="6661273">Next</span><span class="op" id="6661277">(</span><span class="op" id="6661278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6661281">if</span>&nbsp;<span class="ident" id="6661284"><a href="/archive/tar/writer_test.go.html#6660468">err</a></span>&nbsp;<span class="op" id="6661288">!=</span>&nbsp;<span class="ident" id="6661291">nil</span>&nbsp;<span class="op" id="6661295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6661299"><a href="/archive/tar/writer_test.go.html#6660397">t</a></span><span class="op" id="6661300">.</span><span class="ident" id="6661301">Fatal</span><span class="op" id="6661306">(</span><span class="ident" id="6661307"><a href="/archive/tar/writer_test.go.html#6660468">err</a></span><span class="op" id="6661310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6661313">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6661316">if</span>&nbsp;<span class="ident" id="6661319"><a href="/archive/tar/writer_test.go.html#6660541">hdr</a></span><span class="op" id="6661322">.</span><span class="ident" id="6661323">Linkname</span>&nbsp;<span class="op" id="6661332">!=</span>&nbsp;<span class="ident" id="6661335"><a href="/archive/tar/writer_test.go.html#6660707">longLinkname</a></span>&nbsp;<span class="op" id="6661348">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6661352"><a href="/archive/tar/writer_test.go.html#6660397">t</a></span><span class="op" id="6661353">.</span><span class="ident" id="6661354">Fatal</span><span class="op" id="6661359">(</span><span class="string" id="6661360">&#34;Couldn&#39;t&nbsp;recover&nbsp;long&nbsp;link&nbsp;name&#34;</span><span class="op" id="6661393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6661396">}</span><br>
<span class="lineno"></span><span class="op" id="6661398">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6661401">func</span>&nbsp;<span class="ident" id="6661406">TestPaxNonAscii</span><span class="op" id="6661421">(</span><span class="ident" id="6661422">t</span>&nbsp;<span class="op" id="6661424">*</span><span class="ident" id="6661425"><a href="/archive/tar/writer_test.go.html#6654065">testing</a></span><span class="op" id="6661432">.</span><span class="ident" id="6661433">T</span><span class="op" id="6661434">)</span>&nbsp;<span class="op" id="6661436">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6661439">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;non&nbsp;ascii.&nbsp;These&nbsp;should&nbsp;trigger&nbsp;a&nbsp;pax&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6661511">//&nbsp;because&nbsp;pax&nbsp;headers&nbsp;have&nbsp;a&nbsp;defined&nbsp;utf-8&nbsp;encoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6661566">fileinfo</span><span class="op" id="6661574">,</span>&nbsp;<span class="ident" id="6661576">err</span>&nbsp;<span class="op" id="6661580">:=</span>&nbsp;<span class="ident" id="6661583"><a href="/archive/tar/writer_test.go.html#6654037">os</a></span><span class="op" id="6661585">.</span><span class="ident" id="6661586">Stat</span><span class="op" id="6661590">(</span><span class="string" id="6661591">&#34;testdata/small.txt&#34;</span><span class="op" id="6661611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6661614">if</span>&nbsp;<span class="ident" id="6661617"><a href="/archive/tar/writer_test.go.html#6661576">err</a></span>&nbsp;<span class="op" id="6661621">!=</span>&nbsp;<span class="ident" id="6661624">nil</span>&nbsp;<span class="op" id="6661628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6661632"><a href="/archive/tar/writer_test.go.html#6661422">t</a></span><span class="op" id="6661633">.</span><span class="ident" id="6661634">Fatal</span><span class="op" id="6661639">(</span><span class="ident" id="6661640"><a href="/archive/tar/writer_test.go.html#6661576">err</a></span><span class="op" id="6661643">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6661646">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6661650">hdr</span><span class="op" id="6661653">,</span>&nbsp;<span class="ident" id="6661655"><a href="/archive/tar/writer_test.go.html#6661576">err</a></span>&nbsp;<span class="op" id="6661659">:=</span>&nbsp;<span class="ident" id="6661662"><a href="/archive/tar/common.go.html#6191374">FileInfoHeader</a></span><span class="op" id="6661676">(</span><span class="ident" id="6661677"><a href="/archive/tar/writer_test.go.html#6661566">fileinfo</a></span><span class="op" id="6661685">,</span>&nbsp;<span class="string" id="6661687">&#34;&#34;</span><span class="op" id="6661689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6661692">if</span>&nbsp;<span class="ident" id="6661695"><a href="/archive/tar/writer_test.go.html#6661576">err</a></span>&nbsp;<span class="op" id="6661699">!=</span>&nbsp;<span class="ident" id="6661702">nil</span>&nbsp;<span class="op" id="6661706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6661710"><a href="/archive/tar/writer_test.go.html#6661422">t</a></span><span class="op" id="6661711">.</span><span class="ident" id="6661712">Fatalf</span><span class="op" id="6661718">(</span><span class="string" id="6661719">&#34;os.Stat:1&nbsp;%v&#34;</span><span class="op" id="6661733">,</span>&nbsp;<span class="ident" id="6661735"><a href="/archive/tar/writer_test.go.html#6661576">err</a></span><span class="op" id="6661738">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6661741">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6661745">//&nbsp;some&nbsp;sample&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6661766">chineseFilename</span>&nbsp;<span class="op" id="6661782">:=</span>&nbsp;<span class="string" id="6661785">&#34;文件名&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6661798">chineseGroupname</span>&nbsp;<span class="op" id="6661815">:=</span>&nbsp;<span class="string" id="6661818">&#34;組&#34;</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6661825">chineseUsername</span>&nbsp;<span class="op" id="6661841">:=</span>&nbsp;<span class="string" id="6661844">&#34;用戶名&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6661858"><a href="/archive/tar/writer_test.go.html#6661650">hdr</a></span><span class="op" id="6661861">.</span><span class="ident" id="6661862">Name</span>&nbsp;<span class="op" id="6661867">=</span>&nbsp;<span class="ident" id="6661869"><a href="/archive/tar/writer_test.go.html#6661766">chineseFilename</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6661886"><a href="/archive/tar/writer_test.go.html#6661650">hdr</a></span><span class="op" id="6661889">.</span><span class="ident" id="6661890">Gname</span>&nbsp;<span class="op" id="6661896">=</span>&nbsp;<span class="ident" id="6661898"><a href="/archive/tar/writer_test.go.html#6661798">chineseGroupname</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6661916"><a href="/archive/tar/writer_test.go.html#6661650">hdr</a></span><span class="op" id="6661919">.</span><span class="ident" id="6661920">Uname</span>&nbsp;<span class="op" id="6661926">=</span>&nbsp;<span class="ident" id="6661928"><a href="/archive/tar/writer_test.go.html#6661825">chineseUsername</a></span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6661946">contents</span>&nbsp;<span class="op" id="6661955">:=</span>&nbsp;<span class="ident" id="6661958"><a href="/archive/tar/writer_test.go.html#6654054">strings</a></span><span class="op" id="6661965">.</span><span class="ident" id="6661966">Repeat</span><span class="op" id="6661972">(</span><span class="string" id="6661973">&#34;&nbsp;&#34;</span><span class="op" id="6661976">,</span>&nbsp;<span class="builtintype" id="6661978">int</span><span class="op" id="6661981">(</span><span class="ident" id="6661982"><a href="/archive/tar/writer_test.go.html#6661650">hdr</a></span><span class="op" id="6661985">.</span><span class="ident" id="6661986">Size</span><span class="op" id="6661990">)</span><span class="op" id="6661991">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6661995">var</span>&nbsp;<span class="ident" id="6661999">buf</span>&nbsp;<span class="ident" id="6662003"><a href="/archive/tar/writer_test.go.html#6654002">bytes</a></span><span class="op" id="6662008">.</span><span class="ident" id="6662009">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6662017">writer</span>&nbsp;<span class="op" id="6662024">:=</span>&nbsp;<span class="ident" id="6662027"><a href="/archive/tar/writer.go.html#6218490">NewWriter</a></span><span class="op" id="6662036">(</span><span class="op" id="6662037">&amp;</span><span class="ident" id="6662038"><a href="/archive/tar/writer_test.go.html#6661999">buf</a></span><span class="op" id="6662041">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6662044">if</span>&nbsp;<span class="ident" id="6662047">err</span>&nbsp;<span class="op" id="6662051">:=</span>&nbsp;<span class="ident" id="6662054"><a href="/archive/tar/writer_test.go.html#6662017">writer</a></span><span class="op" id="6662060">.</span><span class="ident" id="6662061">WriteHeader</span><span class="op" id="6662072">(</span><span class="ident" id="6662073"><a href="/archive/tar/writer_test.go.html#6661650">hdr</a></span><span class="op" id="6662076">)</span><span class="op" id="6662077">;</span>&nbsp;<span class="ident" id="6662079"><a href="/archive/tar/writer_test.go.html#6662047">err</a></span>&nbsp;<span class="op" id="6662083">!=</span>&nbsp;<span class="ident" id="6662086">nil</span>&nbsp;<span class="op" id="6662090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6662094"><a href="/archive/tar/writer_test.go.html#6661422">t</a></span><span class="op" id="6662095">.</span><span class="ident" id="6662096">Fatal</span><span class="op" id="6662101">(</span><span class="ident" id="6662102"><a href="/archive/tar/writer_test.go.html#6662047">err</a></span><span class="op" id="6662105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6662108">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6662111">if</span>&nbsp;<span class="ident" id="6662114">_</span><span class="op" id="6662115">,</span>&nbsp;<span class="ident" id="6662117"><a href="/archive/tar/writer_test.go.html#6661576">err</a></span>&nbsp;<span class="op" id="6662121">=</span>&nbsp;<span class="ident" id="6662123"><a href="/archive/tar/writer_test.go.html#6662017">writer</a></span><span class="op" id="6662129">.</span><span class="ident" id="6662130">Write</span><span class="op" id="6662135">(</span><span class="op" id="6662136">[</span><span class="op" id="6662137">]</span><span class="builtintype" id="6662138">byte</span><span class="op" id="6662142">(</span><span class="ident" id="6662143"><a href="/archive/tar/writer_test.go.html#6661946">contents</a></span><span class="op" id="6662151">)</span><span class="op" id="6662152">)</span><span class="op" id="6662153">;</span>&nbsp;<span class="ident" id="6662155"><a href="/archive/tar/writer_test.go.html#6661576">err</a></span>&nbsp;<span class="op" id="6662159">!=</span>&nbsp;<span class="ident" id="6662162">nil</span>&nbsp;<span class="op" id="6662166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6662170"><a href="/archive/tar/writer_test.go.html#6661422">t</a></span><span class="op" id="6662171">.</span><span class="ident" id="6662172">Fatal</span><span class="op" id="6662177">(</span><span class="ident" id="6662178"><a href="/archive/tar/writer_test.go.html#6661576">err</a></span><span class="op" id="6662181">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6662184">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6662187">if</span>&nbsp;<span class="ident" id="6662190">err</span>&nbsp;<span class="op" id="6662194">:=</span>&nbsp;<span class="ident" id="6662197"><a href="/archive/tar/writer_test.go.html#6662017">writer</a></span><span class="op" id="6662203">.</span><span class="ident" id="6662204">Close</span><span class="op" id="6662209">(</span><span class="op" id="6662210">)</span><span class="op" id="6662211">;</span>&nbsp;<span class="ident" id="6662213"><a href="/archive/tar/writer_test.go.html#6662190">err</a></span>&nbsp;<span class="op" id="6662217">!=</span>&nbsp;<span class="ident" id="6662220">nil</span>&nbsp;<span class="op" id="6662224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6662228"><a href="/archive/tar/writer_test.go.html#6661422">t</a></span><span class="op" id="6662229">.</span><span class="ident" id="6662230">Fatal</span><span class="op" id="6662235">(</span><span class="ident" id="6662236"><a href="/archive/tar/writer_test.go.html#6662190">err</a></span><span class="op" id="6662239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6662242">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6662245">//&nbsp;Simple&nbsp;test&nbsp;to&nbsp;make&nbsp;sure&nbsp;PAX&nbsp;extensions&nbsp;are&nbsp;in&nbsp;effect</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6662303">if</span>&nbsp;<span class="op" id="6662306">!</span><span class="ident" id="6662307"><a href="/archive/tar/writer_test.go.html#6654002">bytes</a></span><span class="op" id="6662312">.</span><span class="ident" id="6662313">Contains</span><span class="op" id="6662321">(</span><span class="ident" id="6662322"><a href="/archive/tar/writer_test.go.html#6661999">buf</a></span><span class="op" id="6662325">.</span><span class="ident" id="6662326">Bytes</span><span class="op" id="6662331">(</span><span class="op" id="6662332">)</span><span class="op" id="6662333">,</span>&nbsp;<span class="op" id="6662335">[</span><span class="op" id="6662336">]</span><span class="builtintype" id="6662337">byte</span><span class="op" id="6662341">(</span><span class="string" id="6662342">&#34;PaxHeaders.&#34;</span><span class="op" id="6662355">)</span><span class="op" id="6662356">)</span>&nbsp;<span class="op" id="6662358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6662362"><a href="/archive/tar/writer_test.go.html#6661422">t</a></span><span class="op" id="6662363">.</span><span class="ident" id="6662364">Fatal</span><span class="op" id="6662369">(</span><span class="string" id="6662370">&#34;Expected&nbsp;at&nbsp;least&nbsp;one&nbsp;PAX&nbsp;header&nbsp;to&nbsp;be&nbsp;written.&#34;</span><span class="op" id="6662419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6662422">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6662425">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;a&nbsp;long&nbsp;name&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6662487">reader</span>&nbsp;<span class="op" id="6662494">:=</span>&nbsp;<span class="ident" id="6662497"><a href="/archive/tar/reader.go.html#6196034">NewReader</a></span><span class="op" id="6662506">(</span><span class="op" id="6662507">&amp;</span><span class="ident" id="6662508"><a href="/archive/tar/writer_test.go.html#6661999">buf</a></span><span class="op" id="6662511">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6662514"><a href="/archive/tar/writer_test.go.html#6661650">hdr</a></span><span class="op" id="6662517">,</span>&nbsp;<span class="ident" id="6662519"><a href="/archive/tar/writer_test.go.html#6661576">err</a></span>&nbsp;<span class="op" id="6662523">=</span>&nbsp;<span class="ident" id="6662525"><a href="/archive/tar/writer_test.go.html#6662487">reader</a></span><span class="op" id="6662531">.</span><span class="ident" id="6662532">Next</span><span class="op" id="6662536">(</span><span class="op" id="6662537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6662540">if</span>&nbsp;<span class="ident" id="6662543"><a href="/archive/tar/writer_test.go.html#6661576">err</a></span>&nbsp;<span class="op" id="6662547">!=</span>&nbsp;<span class="ident" id="6662550">nil</span>&nbsp;<span class="op" id="6662554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6662558"><a href="/archive/tar/writer_test.go.html#6661422">t</a></span><span class="op" id="6662559">.</span><span class="ident" id="6662560">Fatal</span><span class="op" id="6662565">(</span><span class="ident" id="6662566"><a href="/archive/tar/writer_test.go.html#6661576">err</a></span><span class="op" id="6662569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6662572">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6662575">if</span>&nbsp;<span class="ident" id="6662578"><a href="/archive/tar/writer_test.go.html#6661650">hdr</a></span><span class="op" id="6662581">.</span><span class="ident" id="6662582">Name</span>&nbsp;<span class="op" id="6662587">!=</span>&nbsp;<span class="ident" id="6662590"><a href="/archive/tar/writer_test.go.html#6661766">chineseFilename</a></span>&nbsp;<span class="op" id="6662606">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6662610"><a href="/archive/tar/writer_test.go.html#6661422">t</a></span><span class="op" id="6662611">.</span><span class="ident" id="6662612">Fatal</span><span class="op" id="6662617">(</span><span class="string" id="6662618">&#34;Couldn&#39;t&nbsp;recover&nbsp;unicode&nbsp;name&#34;</span><span class="op" id="6662649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6662652">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6662655">if</span>&nbsp;<span class="ident" id="6662658"><a href="/archive/tar/writer_test.go.html#6661650">hdr</a></span><span class="op" id="6662661">.</span><span class="ident" id="6662662">Gname</span>&nbsp;<span class="op" id="6662668">!=</span>&nbsp;<span class="ident" id="6662671"><a href="/archive/tar/writer_test.go.html#6661798">chineseGroupname</a></span>&nbsp;<span class="op" id="6662688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6662692"><a href="/archive/tar/writer_test.go.html#6661422">t</a></span><span class="op" id="6662693">.</span><span class="ident" id="6662694">Fatal</span><span class="op" id="6662699">(</span><span class="string" id="6662700">&#34;Couldn&#39;t&nbsp;recover&nbsp;unicode&nbsp;group&#34;</span><span class="op" id="6662732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6662735">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6662738">if</span>&nbsp;<span class="ident" id="6662741"><a href="/archive/tar/writer_test.go.html#6661650">hdr</a></span><span class="op" id="6662744">.</span><span class="ident" id="6662745">Uname</span>&nbsp;<span class="op" id="6662751">!=</span>&nbsp;<span class="ident" id="6662754"><a href="/archive/tar/writer_test.go.html#6661825">chineseUsername</a></span>&nbsp;<span class="op" id="6662770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6662774"><a href="/archive/tar/writer_test.go.html#6661422">t</a></span><span class="op" id="6662775">.</span><span class="ident" id="6662776">Fatal</span><span class="op" id="6662781">(</span><span class="string" id="6662782">&#34;Couldn&#39;t&nbsp;recover&nbsp;unicode&nbsp;user&#34;</span><span class="op" id="6662813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6662816">}</span><br>
<span class="lineno"></span><span class="op" id="6662818">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="keyword" id="6662821">func</span>&nbsp;<span class="ident" id="6662826">TestPaxXattrs</span><span class="op" id="6662839">(</span><span class="ident" id="6662840">t</span>&nbsp;<span class="op" id="6662842">*</span><span class="ident" id="6662843"><a href="/archive/tar/writer_test.go.html#6654065">testing</a></span><span class="op" id="6662850">.</span><span class="ident" id="6662851">T</span><span class="op" id="6662852">)</span>&nbsp;<span class="op" id="6662854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6662857">xattrs</span>&nbsp;<span class="op" id="6662864">:=</span>&nbsp;<span class="keyword" id="6662867">map</span><span class="op" id="6662870">[</span><span class="builtintype" id="6662871">string</span><span class="op" id="6662877">]</span><span class="builtintype" id="6662878">string</span><span class="op" id="6662884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6662888">&#34;user.key&#34;</span><span class="op" id="6662898">:</span>&nbsp;<span class="string" id="6662900">&#34;value&#34;</span><span class="op" id="6662907">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6662910">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6662914">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;an&nbsp;xattr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6662950">fileinfo</span><span class="op" id="6662958">,</span>&nbsp;<span class="ident" id="6662960">err</span>&nbsp;<span class="op" id="6662964">:=</span>&nbsp;<span class="ident" id="6662967"><a href="/archive/tar/writer_test.go.html#6654037">os</a></span><span class="op" id="6662969">.</span><span class="ident" id="6662970">Stat</span><span class="op" id="6662974">(</span><span class="string" id="6662975">&#34;testdata/small.txt&#34;</span><span class="op" id="6662995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6662998">if</span>&nbsp;<span class="ident" id="6663001"><a href="/archive/tar/writer_test.go.html#6662960">err</a></span>&nbsp;<span class="op" id="6663005">!=</span>&nbsp;<span class="ident" id="6663008">nil</span>&nbsp;<span class="op" id="6663012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6663016"><a href="/archive/tar/writer_test.go.html#6662840">t</a></span><span class="op" id="6663017">.</span><span class="ident" id="6663018">Fatal</span><span class="op" id="6663023">(</span><span class="ident" id="6663024"><a href="/archive/tar/writer_test.go.html#6662960">err</a></span><span class="op" id="6663027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6663030">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6663033">hdr</span><span class="op" id="6663036">,</span>&nbsp;<span class="ident" id="6663038"><a href="/archive/tar/writer_test.go.html#6662960">err</a></span>&nbsp;<span class="op" id="6663042">:=</span>&nbsp;<span class="ident" id="6663045"><a href="/archive/tar/common.go.html#6191374">FileInfoHeader</a></span><span class="op" id="6663059">(</span><span class="ident" id="6663060"><a href="/archive/tar/writer_test.go.html#6662950">fileinfo</a></span><span class="op" id="6663068">,</span>&nbsp;<span class="string" id="6663070">&#34;&#34;</span><span class="op" id="6663072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6663075">if</span>&nbsp;<span class="ident" id="6663078"><a href="/archive/tar/writer_test.go.html#6662960">err</a></span>&nbsp;<span class="op" id="6663082">!=</span>&nbsp;<span class="ident" id="6663085">nil</span>&nbsp;<span class="op" id="6663089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6663093"><a href="/archive/tar/writer_test.go.html#6662840">t</a></span><span class="op" id="6663094">.</span><span class="ident" id="6663095">Fatalf</span><span class="op" id="6663101">(</span><span class="string" id="6663102">&#34;os.Stat:&nbsp;%v&#34;</span><span class="op" id="6663115">,</span>&nbsp;<span class="ident" id="6663117"><a href="/archive/tar/writer_test.go.html#6662960">err</a></span><span class="op" id="6663120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6663123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6663126">contents</span>&nbsp;<span class="op" id="6663135">:=</span>&nbsp;<span class="string" id="6663138">&#34;Kilts&#34;</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6663147"><a href="/archive/tar/writer_test.go.html#6663033">hdr</a></span><span class="op" id="6663150">.</span><span class="ident" id="6663151">Xattrs</span>&nbsp;<span class="op" id="6663158">=</span>&nbsp;<span class="ident" id="6663160"><a href="/archive/tar/writer_test.go.html#6662857">xattrs</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6663168">var</span>&nbsp;<span class="ident" id="6663172">buf</span>&nbsp;<span class="ident" id="6663176"><a href="/archive/tar/writer_test.go.html#6654002">bytes</a></span><span class="op" id="6663181">.</span><span class="ident" id="6663182">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6663190">writer</span>&nbsp;<span class="op" id="6663197">:=</span>&nbsp;<span class="ident" id="6663200"><a href="/archive/tar/writer.go.html#6218490">NewWriter</a></span><span class="op" id="6663209">(</span><span class="op" id="6663210">&amp;</span><span class="ident" id="6663211"><a href="/archive/tar/writer_test.go.html#6663172">buf</a></span><span class="op" id="6663214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6663217">if</span>&nbsp;<span class="ident" id="6663220">err</span>&nbsp;<span class="op" id="6663224">:=</span>&nbsp;<span class="ident" id="6663227"><a href="/archive/tar/writer_test.go.html#6663190">writer</a></span><span class="op" id="6663233">.</span><span class="ident" id="6663234">WriteHeader</span><span class="op" id="6663245">(</span><span class="ident" id="6663246"><a href="/archive/tar/writer_test.go.html#6663033">hdr</a></span><span class="op" id="6663249">)</span><span class="op" id="6663250">;</span>&nbsp;<span class="ident" id="6663252"><a href="/archive/tar/writer_test.go.html#6663220">err</a></span>&nbsp;<span class="op" id="6663256">!=</span>&nbsp;<span class="ident" id="6663259">nil</span>&nbsp;<span class="op" id="6663263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6663267"><a href="/archive/tar/writer_test.go.html#6662840">t</a></span><span class="op" id="6663268">.</span><span class="ident" id="6663269">Fatal</span><span class="op" id="6663274">(</span><span class="ident" id="6663275"><a href="/archive/tar/writer_test.go.html#6663220">err</a></span><span class="op" id="6663278">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6663281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6663284">if</span>&nbsp;<span class="ident" id="6663287">_</span><span class="op" id="6663288">,</span>&nbsp;<span class="ident" id="6663290"><a href="/archive/tar/writer_test.go.html#6662960">err</a></span>&nbsp;<span class="op" id="6663294">=</span>&nbsp;<span class="ident" id="6663296"><a href="/archive/tar/writer_test.go.html#6663190">writer</a></span><span class="op" id="6663302">.</span><span class="ident" id="6663303">Write</span><span class="op" id="6663308">(</span><span class="op" id="6663309">[</span><span class="op" id="6663310">]</span><span class="builtintype" id="6663311">byte</span><span class="op" id="6663315">(</span><span class="ident" id="6663316"><a href="/archive/tar/writer_test.go.html#6663126">contents</a></span><span class="op" id="6663324">)</span><span class="op" id="6663325">)</span><span class="op" id="6663326">;</span>&nbsp;<span class="ident" id="6663328"><a href="/archive/tar/writer_test.go.html#6662960">err</a></span>&nbsp;<span class="op" id="6663332">!=</span>&nbsp;<span class="ident" id="6663335">nil</span>&nbsp;<span class="op" id="6663339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6663343"><a href="/archive/tar/writer_test.go.html#6662840">t</a></span><span class="op" id="6663344">.</span><span class="ident" id="6663345">Fatal</span><span class="op" id="6663350">(</span><span class="ident" id="6663351"><a href="/archive/tar/writer_test.go.html#6662960">err</a></span><span class="op" id="6663354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6663357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6663360">if</span>&nbsp;<span class="ident" id="6663363">err</span>&nbsp;<span class="op" id="6663367">:=</span>&nbsp;<span class="ident" id="6663370"><a href="/archive/tar/writer_test.go.html#6663190">writer</a></span><span class="op" id="6663376">.</span><span class="ident" id="6663377">Close</span><span class="op" id="6663382">(</span><span class="op" id="6663383">)</span><span class="op" id="6663384">;</span>&nbsp;<span class="ident" id="6663386"><a href="/archive/tar/writer_test.go.html#6663363">err</a></span>&nbsp;<span class="op" id="6663390">!=</span>&nbsp;<span class="ident" id="6663393">nil</span>&nbsp;<span class="op" id="6663397">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6663401"><a href="/archive/tar/writer_test.go.html#6662840">t</a></span><span class="op" id="6663402">.</span><span class="ident" id="6663403">Fatal</span><span class="op" id="6663408">(</span><span class="ident" id="6663409"><a href="/archive/tar/writer_test.go.html#6663363">err</a></span><span class="op" id="6663412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6663415">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6663418">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;the&nbsp;xattrs&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6663479">reader</span>&nbsp;<span class="op" id="6663486">:=</span>&nbsp;<span class="ident" id="6663489"><a href="/archive/tar/reader.go.html#6196034">NewReader</a></span><span class="op" id="6663498">(</span><span class="op" id="6663499">&amp;</span><span class="ident" id="6663500"><a href="/archive/tar/writer_test.go.html#6663172">buf</a></span><span class="op" id="6663503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6663506"><a href="/archive/tar/writer_test.go.html#6663033">hdr</a></span><span class="op" id="6663509">,</span>&nbsp;<span class="ident" id="6663511"><a href="/archive/tar/writer_test.go.html#6662960">err</a></span>&nbsp;<span class="op" id="6663515">=</span>&nbsp;<span class="ident" id="6663517"><a href="/archive/tar/writer_test.go.html#6663479">reader</a></span><span class="op" id="6663523">.</span><span class="ident" id="6663524">Next</span><span class="op" id="6663528">(</span><span class="op" id="6663529">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6663532">if</span>&nbsp;<span class="ident" id="6663535"><a href="/archive/tar/writer_test.go.html#6662960">err</a></span>&nbsp;<span class="op" id="6663539">!=</span>&nbsp;<span class="ident" id="6663542">nil</span>&nbsp;<span class="op" id="6663546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6663550"><a href="/archive/tar/writer_test.go.html#6662840">t</a></span><span class="op" id="6663551">.</span><span class="ident" id="6663552">Fatal</span><span class="op" id="6663557">(</span><span class="ident" id="6663558"><a href="/archive/tar/writer_test.go.html#6662960">err</a></span><span class="op" id="6663561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6663564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6663567">if</span>&nbsp;<span class="op" id="6663570">!</span><span class="ident" id="6663571"><a href="/archive/tar/writer_test.go.html#6654043">reflect</a></span><span class="op" id="6663578">.</span><span class="ident" id="6663579">DeepEqual</span><span class="op" id="6663588">(</span><span class="ident" id="6663589"><a href="/archive/tar/writer_test.go.html#6663033">hdr</a></span><span class="op" id="6663592">.</span><span class="ident" id="6663593">Xattrs</span><span class="op" id="6663599">,</span>&nbsp;<span class="ident" id="6663601"><a href="/archive/tar/writer_test.go.html#6662857">xattrs</a></span><span class="op" id="6663607">)</span>&nbsp;<span class="op" id="6663609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6663613"><a href="/archive/tar/writer_test.go.html#6662840">t</a></span><span class="op" id="6663614">.</span><span class="ident" id="6663615">Fatalf</span><span class="op" id="6663621">(</span><span class="string" id="6663622">&#34;xattrs&nbsp;did&nbsp;not&nbsp;survive&nbsp;round&nbsp;trip:&nbsp;got&nbsp;%+v,&nbsp;want&nbsp;%+v&#34;</span><span class="op" id="6663676">,</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6663681"><a href="/archive/tar/writer_test.go.html#6663033">hdr</a></span><span class="op" id="6663684">.</span><span class="ident" id="6663685">Xattrs</span><span class="op" id="6663691">,</span>&nbsp;<span class="ident" id="6663693"><a href="/archive/tar/writer_test.go.html#6662857">xattrs</a></span><span class="op" id="6663699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6663702">}</span><br>
<span class="lineno"></span><span class="op" id="6663704">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6663707">func</span>&nbsp;<span class="ident" id="6663712">TestPAXHeader</span><span class="op" id="6663725">(</span><span class="ident" id="6663726">t</span>&nbsp;<span class="op" id="6663728">*</span><span class="ident" id="6663729"><a href="/archive/tar/writer_test.go.html#6654065">testing</a></span><span class="op" id="6663736">.</span><span class="ident" id="6663737">T</span><span class="op" id="6663738">)</span>&nbsp;<span class="op" id="6663740">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6663743">medName</span>&nbsp;<span class="op" id="6663751">:=</span>&nbsp;<span class="ident" id="6663754"><a href="/archive/tar/writer_test.go.html#6654054">strings</a></span><span class="op" id="6663761">.</span><span class="ident" id="6663762">Repeat</span><span class="op" id="6663768">(</span><span class="string" id="6663769">&#34;CD&#34;</span><span class="op" id="6663773">,</span>&nbsp;<span class="num" id="6663775">50</span><span class="op" id="6663777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6663780">longName</span>&nbsp;<span class="op" id="6663789">:=</span>&nbsp;<span class="ident" id="6663792"><a href="/archive/tar/writer_test.go.html#6654054">strings</a></span><span class="op" id="6663799">.</span><span class="ident" id="6663800">Repeat</span><span class="op" id="6663806">(</span><span class="string" id="6663807">&#34;AB&#34;</span><span class="op" id="6663811">,</span>&nbsp;<span class="num" id="6663813">100</span><span class="op" id="6663816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6663819">paxTests</span>&nbsp;<span class="op" id="6663828">:=</span>&nbsp;<span class="op" id="6663831">[</span><span class="op" id="6663832">]</span><span class="op" id="6663833">[</span><span class="num" id="6663834">2</span><span class="op" id="6663835">]</span><span class="builtintype" id="6663836">string</span><span class="op" id="6663842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6663846">{</span><span class="ident" id="6663847"><a href="/archive/tar/common.go.html#6190816">paxPath</a></span>&nbsp;<span class="op" id="6663855">+</span>&nbsp;<span class="string" id="6663857">&#34;=/etc/hosts&#34;</span><span class="op" id="6663870">,</span>&nbsp;<span class="string" id="6663872">&#34;19&nbsp;path=/etc/hosts\n&#34;</span><span class="op" id="6663894">}</span><span class="op" id="6663895">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6663899">{</span><span class="string" id="6663900">&#34;a=b&#34;</span><span class="op" id="6663905">,</span>&nbsp;<span class="string" id="6663907">&#34;6&nbsp;a=b\n&#34;</span><span class="op" id="6663916">}</span><span class="op" id="6663917">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6663928">//&nbsp;Single&nbsp;digit&nbsp;length</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6663953">{</span><span class="string" id="6663954">&#34;a=names&#34;</span><span class="op" id="6663963">,</span>&nbsp;<span class="string" id="6663965">&#34;11&nbsp;a=names\n&#34;</span><span class="op" id="6663979">}</span><span class="op" id="6663980">,</span>&nbsp;<span class="comment" id="6663982">//&nbsp;Test&nbsp;case&nbsp;involving&nbsp;carries</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6664015">{</span><span class="ident" id="6664016"><a href="/archive/tar/common.go.html#6190816">paxPath</a></span>&nbsp;<span class="op" id="6664024">+</span>&nbsp;<span class="string" id="6664026">&#34;=&#34;</span>&nbsp;<span class="op" id="6664030">+</span>&nbsp;<span class="ident" id="6664032"><a href="/archive/tar/writer_test.go.html#6663780">longName</a></span><span class="op" id="6664040">,</span>&nbsp;<span class="ident" id="6664042"><a href="/archive/tar/writer_test.go.html#6654011">fmt</a></span><span class="op" id="6664045">.</span><span class="ident" id="6664046">Sprintf</span><span class="op" id="6664053">(</span><span class="string" id="6664054">&#34;210&nbsp;path=%s\n&#34;</span><span class="op" id="6664069">,</span>&nbsp;<span class="ident" id="6664071"><a href="/archive/tar/writer_test.go.html#6663780">longName</a></span><span class="op" id="6664079">)</span><span class="op" id="6664080">}</span><span class="op" id="6664081">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6664085">{</span><span class="ident" id="6664086"><a href="/archive/tar/common.go.html#6190816">paxPath</a></span>&nbsp;<span class="op" id="6664094">+</span>&nbsp;<span class="string" id="6664096">&#34;=&#34;</span>&nbsp;<span class="op" id="6664100">+</span>&nbsp;<span class="ident" id="6664102"><a href="/archive/tar/writer_test.go.html#6663743">medName</a></span><span class="op" id="6664109">,</span>&nbsp;<span class="ident" id="6664111"><a href="/archive/tar/writer_test.go.html#6654011">fmt</a></span><span class="op" id="6664114">.</span><span class="ident" id="6664115">Sprintf</span><span class="op" id="6664122">(</span><span class="string" id="6664123">&#34;110&nbsp;path=%s\n&#34;</span><span class="op" id="6664138">,</span>&nbsp;<span class="ident" id="6664140"><a href="/archive/tar/writer_test.go.html#6663743">medName</a></span><span class="op" id="6664147">)</span><span class="op" id="6664148">}</span><span class="op" id="6664149">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6664153">for</span>&nbsp;<span class="ident" id="6664157">_</span><span class="op" id="6664158">,</span>&nbsp;<span class="ident" id="6664160">test</span>&nbsp;<span class="op" id="6664165">:=</span>&nbsp;<span class="keyword" id="6664168">range</span>&nbsp;<span class="ident" id="6664174"><a href="/archive/tar/writer_test.go.html#6663819">paxTests</a></span>&nbsp;<span class="op" id="6664183">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6664187">key</span><span class="op" id="6664190">,</span>&nbsp;<span class="ident" id="6664192">expected</span>&nbsp;<span class="op" id="6664201">:=</span>&nbsp;<span class="ident" id="6664204"><a href="/archive/tar/writer_test.go.html#6664160">test</a></span><span class="op" id="6664208">[</span><span class="num" id="6664209">0</span><span class="op" id="6664210">]</span><span class="op" id="6664211">,</span>&nbsp;<span class="ident" id="6664213"><a href="/archive/tar/writer_test.go.html#6664160">test</a></span><span class="op" id="6664217">[</span><span class="num" id="6664218">1</span><span class="op" id="6664219">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6664223">if</span>&nbsp;<span class="ident" id="6664226">result</span>&nbsp;<span class="op" id="6664233">:=</span>&nbsp;<span class="ident" id="6664236"><a href="/archive/tar/writer.go.html#6227513">paxHeader</a></span><span class="op" id="6664245">(</span><span class="ident" id="6664246"><a href="/archive/tar/writer_test.go.html#6664187">key</a></span><span class="op" id="6664249">)</span><span class="op" id="6664250">;</span>&nbsp;<span class="ident" id="6664252"><a href="/archive/tar/writer_test.go.html#6664226">result</a></span>&nbsp;<span class="op" id="6664259">!=</span>&nbsp;<span class="ident" id="6664262"><a href="/archive/tar/writer_test.go.html#6664192">expected</a></span>&nbsp;<span class="op" id="6664271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6664276"><a href="/archive/tar/writer_test.go.html#6663726">t</a></span><span class="op" id="6664277">.</span><span class="ident" id="6664278">Fatalf</span><span class="op" id="6664284">(</span><span class="string" id="6664285">&#34;paxHeader:&nbsp;got&nbsp;%s,&nbsp;expected&nbsp;%s&#34;</span><span class="op" id="6664317">,</span>&nbsp;<span class="ident" id="6664319"><a href="/archive/tar/writer_test.go.html#6664226">result</a></span><span class="op" id="6664325">,</span>&nbsp;<span class="ident" id="6664327"><a href="/archive/tar/writer_test.go.html#6664192">expected</a></span><span class="op" id="6664335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6664339">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6664342">}</span><br>
<span class="lineno">420</span><span class="op" id="6664344">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6664347">func</span>&nbsp;<span class="ident" id="6664352">TestUSTARLongName</span><span class="op" id="6664369">(</span><span class="ident" id="6664370">t</span>&nbsp;<span class="op" id="6664372">*</span><span class="ident" id="6664373"><a href="/archive/tar/writer_test.go.html#6654065">testing</a></span><span class="op" id="6664380">.</span><span class="ident" id="6664381">T</span><span class="op" id="6664382">)</span>&nbsp;<span class="op" id="6664384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6664387">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;a&nbsp;path&nbsp;that&nbsp;failed&nbsp;to&nbsp;split&nbsp;with&nbsp;USTAR&nbsp;extension&nbsp;in&nbsp;previous&nbsp;versions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6664485">fileinfo</span><span class="op" id="6664493">,</span>&nbsp;<span class="ident" id="6664495">err</span>&nbsp;<span class="op" id="6664499">:=</span>&nbsp;<span class="ident" id="6664502"><a href="/archive/tar/writer_test.go.html#6654037">os</a></span><span class="op" id="6664504">.</span><span class="ident" id="6664505">Stat</span><span class="op" id="6664509">(</span><span class="string" id="6664510">&#34;testdata/small.txt&#34;</span><span class="op" id="6664530">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6664533">if</span>&nbsp;<span class="ident" id="6664536"><a href="/archive/tar/writer_test.go.html#6664495">err</a></span>&nbsp;<span class="op" id="6664540">!=</span>&nbsp;<span class="ident" id="6664543">nil</span>&nbsp;<span class="op" id="6664547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6664551"><a href="/archive/tar/writer_test.go.html#6664370">t</a></span><span class="op" id="6664552">.</span><span class="ident" id="6664553">Fatal</span><span class="op" id="6664558">(</span><span class="ident" id="6664559"><a href="/archive/tar/writer_test.go.html#6664495">err</a></span><span class="op" id="6664562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6664565">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6664568">hdr</span><span class="op" id="6664571">,</span>&nbsp;<span class="ident" id="6664573"><a href="/archive/tar/writer_test.go.html#6664495">err</a></span>&nbsp;<span class="op" id="6664577">:=</span>&nbsp;<span class="ident" id="6664580"><a href="/archive/tar/common.go.html#6191374">FileInfoHeader</a></span><span class="op" id="6664594">(</span><span class="ident" id="6664595"><a href="/archive/tar/writer_test.go.html#6664485">fileinfo</a></span><span class="op" id="6664603">,</span>&nbsp;<span class="string" id="6664605">&#34;&#34;</span><span class="op" id="6664607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6664610"><a href="/archive/tar/writer_test.go.html#6664568">hdr</a></span><span class="op" id="6664613">.</span><span class="ident" id="6664614">Typeflag</span>&nbsp;<span class="op" id="6664623">=</span>&nbsp;<span class="ident" id="6664625"><a href="/archive/tar/common.go.html#6186554">TypeDir</a></span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6664634">if</span>&nbsp;<span class="ident" id="6664637"><a href="/archive/tar/writer_test.go.html#6664495">err</a></span>&nbsp;<span class="op" id="6664641">!=</span>&nbsp;<span class="ident" id="6664644">nil</span>&nbsp;<span class="op" id="6664648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6664652"><a href="/archive/tar/writer_test.go.html#6664370">t</a></span><span class="op" id="6664653">.</span><span class="ident" id="6664654">Fatalf</span><span class="op" id="6664660">(</span><span class="string" id="6664661">&#34;os.Stat:1&nbsp;%v&#34;</span><span class="op" id="6664675">,</span>&nbsp;<span class="ident" id="6664677"><a href="/archive/tar/writer_test.go.html#6664495">err</a></span><span class="op" id="6664680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6664683">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6664686">//&nbsp;Force&nbsp;a&nbsp;PAX&nbsp;long&nbsp;name&nbsp;to&nbsp;be&nbsp;written.&nbsp;The&nbsp;name&nbsp;was&nbsp;taken&nbsp;from&nbsp;a&nbsp;practical&nbsp;example</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6664771">//&nbsp;that&nbsp;fails&nbsp;and&nbsp;replaced&nbsp;ever&nbsp;char&nbsp;through&nbsp;numbers&nbsp;to&nbsp;anonymize&nbsp;the&nbsp;sample.</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6664850">longName</span>&nbsp;<span class="op" id="6664859">:=</span>&nbsp;<span class="string" id="6664862">&#34;/0000_0000000/00000-000000000/0000_0000000/00000-0000000000000/0000_0000000/00000-0000000-00000000/0000_0000000/00000000/0000_0000000/000/0000_0000000/00000000v00/0000_0000000/000000/0000_0000000/0000000/0000_0000000/00000y-00/0000/0000/00000000/0x000000/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6665121"><a href="/archive/tar/writer_test.go.html#6664568">hdr</a></span><span class="op" id="6665124">.</span><span class="ident" id="6665125">Name</span>&nbsp;<span class="op" id="6665130">=</span>&nbsp;<span class="ident" id="6665132"><a href="/archive/tar/writer_test.go.html#6664850">longName</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6665143"><a href="/archive/tar/writer_test.go.html#6664568">hdr</a></span><span class="op" id="6665146">.</span><span class="ident" id="6665147">Size</span>&nbsp;<span class="op" id="6665152">=</span>&nbsp;<span class="num" id="6665154">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6665157">var</span>&nbsp;<span class="ident" id="6665161">buf</span>&nbsp;<span class="ident" id="6665165"><a href="/archive/tar/writer_test.go.html#6654002">bytes</a></span><span class="op" id="6665170">.</span><span class="ident" id="6665171">Buffer</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6665179">writer</span>&nbsp;<span class="op" id="6665186">:=</span>&nbsp;<span class="ident" id="6665189"><a href="/archive/tar/writer.go.html#6218490">NewWriter</a></span><span class="op" id="6665198">(</span><span class="op" id="6665199">&amp;</span><span class="ident" id="6665200"><a href="/archive/tar/writer_test.go.html#6665161">buf</a></span><span class="op" id="6665203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6665206">if</span>&nbsp;<span class="ident" id="6665209">err</span>&nbsp;<span class="op" id="6665213">:=</span>&nbsp;<span class="ident" id="6665216"><a href="/archive/tar/writer_test.go.html#6665179">writer</a></span><span class="op" id="6665222">.</span><span class="ident" id="6665223">WriteHeader</span><span class="op" id="6665234">(</span><span class="ident" id="6665235"><a href="/archive/tar/writer_test.go.html#6664568">hdr</a></span><span class="op" id="6665238">)</span><span class="op" id="6665239">;</span>&nbsp;<span class="ident" id="6665241"><a href="/archive/tar/writer_test.go.html#6665209">err</a></span>&nbsp;<span class="op" id="6665245">!=</span>&nbsp;<span class="ident" id="6665248">nil</span>&nbsp;<span class="op" id="6665252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6665256"><a href="/archive/tar/writer_test.go.html#6664370">t</a></span><span class="op" id="6665257">.</span><span class="ident" id="6665258">Fatal</span><span class="op" id="6665263">(</span><span class="ident" id="6665264"><a href="/archive/tar/writer_test.go.html#6665209">err</a></span><span class="op" id="6665267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6665270">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6665273">if</span>&nbsp;<span class="ident" id="6665276">err</span>&nbsp;<span class="op" id="6665280">:=</span>&nbsp;<span class="ident" id="6665283"><a href="/archive/tar/writer_test.go.html#6665179">writer</a></span><span class="op" id="6665289">.</span><span class="ident" id="6665290">Close</span><span class="op" id="6665295">(</span><span class="op" id="6665296">)</span><span class="op" id="6665297">;</span>&nbsp;<span class="ident" id="6665299"><a href="/archive/tar/writer_test.go.html#6665276">err</a></span>&nbsp;<span class="op" id="6665303">!=</span>&nbsp;<span class="ident" id="6665306">nil</span>&nbsp;<span class="op" id="6665310">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6665314"><a href="/archive/tar/writer_test.go.html#6664370">t</a></span><span class="op" id="6665315">.</span><span class="ident" id="6665316">Fatal</span><span class="op" id="6665321">(</span><span class="ident" id="6665322"><a href="/archive/tar/writer_test.go.html#6665276">err</a></span><span class="op" id="6665325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6665328">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6665331">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;a&nbsp;long&nbsp;name&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6665393">reader</span>&nbsp;<span class="op" id="6665400">:=</span>&nbsp;<span class="ident" id="6665403"><a href="/archive/tar/reader.go.html#6196034">NewReader</a></span><span class="op" id="6665412">(</span><span class="op" id="6665413">&amp;</span><span class="ident" id="6665414"><a href="/archive/tar/writer_test.go.html#6665161">buf</a></span><span class="op" id="6665417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6665420"><a href="/archive/tar/writer_test.go.html#6664568">hdr</a></span><span class="op" id="6665423">,</span>&nbsp;<span class="ident" id="6665425"><a href="/archive/tar/writer_test.go.html#6664495">err</a></span>&nbsp;<span class="op" id="6665429">=</span>&nbsp;<span class="ident" id="6665431"><a href="/archive/tar/writer_test.go.html#6665393">reader</a></span><span class="op" id="6665437">.</span><span class="ident" id="6665438">Next</span><span class="op" id="6665442">(</span><span class="op" id="6665443">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6665446">if</span>&nbsp;<span class="ident" id="6665449"><a href="/archive/tar/writer_test.go.html#6664495">err</a></span>&nbsp;<span class="op" id="6665453">!=</span>&nbsp;<span class="ident" id="6665456">nil</span>&nbsp;<span class="op" id="6665460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6665464"><a href="/archive/tar/writer_test.go.html#6664370">t</a></span><span class="op" id="6665465">.</span><span class="ident" id="6665466">Fatal</span><span class="op" id="6665471">(</span><span class="ident" id="6665472"><a href="/archive/tar/writer_test.go.html#6664495">err</a></span><span class="op" id="6665475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6665478">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6665481">if</span>&nbsp;<span class="ident" id="6665484"><a href="/archive/tar/writer_test.go.html#6664568">hdr</a></span><span class="op" id="6665487">.</span><span class="ident" id="6665488">Name</span>&nbsp;<span class="op" id="6665493">!=</span>&nbsp;<span class="ident" id="6665496"><a href="/archive/tar/writer_test.go.html#6664850">longName</a></span>&nbsp;<span class="op" id="6665505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6665509"><a href="/archive/tar/writer_test.go.html#6664370">t</a></span><span class="op" id="6665510">.</span><span class="ident" id="6665511">Fatal</span><span class="op" id="6665516">(</span><span class="string" id="6665517">&#34;Couldn&#39;t&nbsp;recover&nbsp;long&nbsp;name&#34;</span><span class="op" id="6665545">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6665548">}</span><br>
<span class="lineno"></span><span class="op" id="6665550">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6665553">func</span>&nbsp;<span class="ident" id="6665558">TestValidTypeflagWithPAXHeader</span><span class="op" id="6665588">(</span><span class="ident" id="6665589">t</span>&nbsp;<span class="op" id="6665591">*</span><span class="ident" id="6665592"><a href="/archive/tar/writer_test.go.html#6654065">testing</a></span><span class="op" id="6665599">.</span><span class="ident" id="6665600">T</span><span class="op" id="6665601">)</span>&nbsp;<span class="op" id="6665603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6665606">var</span>&nbsp;<span class="ident" id="6665610">buffer</span>&nbsp;<span class="ident" id="6665617"><a href="/archive/tar/writer_test.go.html#6654002">bytes</a></span><span class="op" id="6665622">.</span><span class="ident" id="6665623">Buffer</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6665631">tw</span>&nbsp;<span class="op" id="6665634">:=</span>&nbsp;<span class="ident" id="6665637"><a href="/archive/tar/writer.go.html#6218490">NewWriter</a></span><span class="op" id="6665646">(</span><span class="op" id="6665647">&amp;</span><span class="ident" id="6665648"><a href="/archive/tar/writer_test.go.html#6665610">buffer</a></span><span class="op" id="6665654">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6665658">fileName</span>&nbsp;<span class="op" id="6665667">:=</span>&nbsp;<span class="ident" id="6665670"><a href="/archive/tar/writer_test.go.html#6654054">strings</a></span><span class="op" id="6665677">.</span><span class="ident" id="6665678">Repeat</span><span class="op" id="6665684">(</span><span class="string" id="6665685">&#34;ab&#34;</span><span class="op" id="6665689">,</span>&nbsp;<span class="num" id="6665691">100</span><span class="op" id="6665694">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6665698">hdr</span>&nbsp;<span class="op" id="6665702">:=</span>&nbsp;<span class="op" id="6665705">&amp;</span><span class="ident" id="6665706"><a href="/archive/tar/common.go.html#6187053">Header</a></span><span class="op" id="6665712">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6665716">Name</span><span class="op" id="6665720">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6665726"><a href="/archive/tar/writer_test.go.html#6665658">fileName</a></span><span class="op" id="6665734">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6665738">Size</span><span class="op" id="6665742">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6665748">4</span><span class="op" id="6665749">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6665753">Typeflag</span><span class="op" id="6665761">:</span>&nbsp;<span class="num" id="6665763">0</span><span class="op" id="6665764">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6665767">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6665770">if</span>&nbsp;<span class="ident" id="6665773">err</span>&nbsp;<span class="op" id="6665777">:=</span>&nbsp;<span class="ident" id="6665780"><a href="/archive/tar/writer_test.go.html#6665631">tw</a></span><span class="op" id="6665782">.</span><span class="ident" id="6665783">WriteHeader</span><span class="op" id="6665794">(</span><span class="ident" id="6665795"><a href="/archive/tar/writer_test.go.html#6665698">hdr</a></span><span class="op" id="6665798">)</span><span class="op" id="6665799">;</span>&nbsp;<span class="ident" id="6665801"><a href="/archive/tar/writer_test.go.html#6665773">err</a></span>&nbsp;<span class="op" id="6665805">!=</span>&nbsp;<span class="ident" id="6665808">nil</span>&nbsp;<span class="op" id="6665812">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6665816"><a href="/archive/tar/writer_test.go.html#6665589">t</a></span><span class="op" id="6665817">.</span><span class="ident" id="6665818">Fatalf</span><span class="op" id="6665824">(</span><span class="string" id="6665825">&#34;Failed&nbsp;to&nbsp;write&nbsp;header:&nbsp;%s&#34;</span><span class="op" id="6665853">,</span>&nbsp;<span class="ident" id="6665855"><a href="/archive/tar/writer_test.go.html#6665773">err</a></span><span class="op" id="6665858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6665861">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6665864">if</span>&nbsp;<span class="ident" id="6665867">_</span><span class="op" id="6665868">,</span>&nbsp;<span class="ident" id="6665870">err</span>&nbsp;<span class="op" id="6665874">:=</span>&nbsp;<span class="ident" id="6665877"><a href="/archive/tar/writer_test.go.html#6665631">tw</a></span><span class="op" id="6665879">.</span><span class="ident" id="6665880">Write</span><span class="op" id="6665885">(</span><span class="op" id="6665886">[</span><span class="op" id="6665887">]</span><span class="builtintype" id="6665888">byte</span><span class="op" id="6665892">(</span><span class="string" id="6665893">&#34;fooo&#34;</span><span class="op" id="6665899">)</span><span class="op" id="6665900">)</span><span class="op" id="6665901">;</span>&nbsp;<span class="ident" id="6665903"><a href="/archive/tar/writer_test.go.html#6665870">err</a></span>&nbsp;<span class="op" id="6665907">!=</span>&nbsp;<span class="ident" id="6665910">nil</span>&nbsp;<span class="op" id="6665914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6665918"><a href="/archive/tar/writer_test.go.html#6665589">t</a></span><span class="op" id="6665919">.</span><span class="ident" id="6665920">Fatalf</span><span class="op" id="6665926">(</span><span class="string" id="6665927">&#34;Failed&nbsp;to&nbsp;write&nbsp;the&nbsp;file&#39;s&nbsp;data:&nbsp;%s&#34;</span><span class="op" id="6665964">,</span>&nbsp;<span class="ident" id="6665966"><a href="/archive/tar/writer_test.go.html#6665870">err</a></span><span class="op" id="6665969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6665972">}</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6665975"><a href="/archive/tar/writer_test.go.html#6665631">tw</a></span><span class="op" id="6665977">.</span><span class="ident" id="6665978">Close</span><span class="op" id="6665983">(</span><span class="op" id="6665984">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6665988">tr</span>&nbsp;<span class="op" id="6665991">:=</span>&nbsp;<span class="ident" id="6665994"><a href="/archive/tar/reader.go.html#6196034">NewReader</a></span><span class="op" id="6666003">(</span><span class="op" id="6666004">&amp;</span><span class="ident" id="6666005"><a href="/archive/tar/writer_test.go.html#6665610">buffer</a></span><span class="op" id="6666011">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6666015">for</span>&nbsp;<span class="op" id="6666019">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6666023">header</span><span class="op" id="6666029">,</span>&nbsp;<span class="ident" id="6666031">err</span>&nbsp;<span class="op" id="6666035">:=</span>&nbsp;<span class="ident" id="6666038"><a href="/archive/tar/writer_test.go.html#6665988">tr</a></span><span class="op" id="6666040">.</span><span class="ident" id="6666041">Next</span><span class="op" id="6666045">(</span><span class="op" id="6666046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6666050">if</span>&nbsp;<span class="ident" id="6666053"><a href="/archive/tar/writer_test.go.html#6666031">err</a></span>&nbsp;<span class="op" id="6666057">==</span>&nbsp;<span class="ident" id="6666060"><a href="/archive/tar/writer_test.go.html#6654018">io</a></span><span class="op" id="6666062">.</span><span class="ident" id="6666063">EOF</span>&nbsp;<span class="op" id="6666067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6666072">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6666080">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6666084">if</span>&nbsp;<span class="ident" id="6666087"><a href="/archive/tar/writer_test.go.html#6666031">err</a></span>&nbsp;<span class="op" id="6666091">!=</span>&nbsp;<span class="ident" id="6666094">nil</span>&nbsp;<span class="op" id="6666098">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6666103"><a href="/archive/tar/writer_test.go.html#6665589">t</a></span><span class="op" id="6666104">.</span><span class="ident" id="6666105">Fatalf</span><span class="op" id="6666111">(</span><span class="string" id="6666112">&#34;Failed&nbsp;to&nbsp;read&nbsp;header:&nbsp;%s&#34;</span><span class="op" id="6666139">,</span>&nbsp;<span class="ident" id="6666141"><a href="/archive/tar/writer_test.go.html#6666031">err</a></span><span class="op" id="6666144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6666148">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6666152">if</span>&nbsp;<span class="ident" id="6666155"><a href="/archive/tar/writer_test.go.html#6666023">header</a></span><span class="op" id="6666161">.</span><span class="ident" id="6666162">Typeflag</span>&nbsp;<span class="op" id="6666171">!=</span>&nbsp;<span class="num" id="6666174">0</span>&nbsp;<span class="op" id="6666176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6666181"><a href="/archive/tar/writer_test.go.html#6665589">t</a></span><span class="op" id="6666182">.</span><span class="ident" id="6666183">Fatalf</span><span class="op" id="6666189">(</span><span class="string" id="6666190">&#34;Typeflag&nbsp;should&#39;ve&nbsp;been&nbsp;0,&nbsp;found&nbsp;%d&#34;</span><span class="op" id="6666227">,</span>&nbsp;<span class="ident" id="6666229"><a href="/archive/tar/writer_test.go.html#6666023">header</a></span><span class="op" id="6666235">.</span><span class="ident" id="6666236">Typeflag</span><span class="op" id="6666244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6666248">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6666251">}</span><br>
<span class="lineno"></span><span class="op" id="6666253">}</span>
</div>
</body>
</html>
