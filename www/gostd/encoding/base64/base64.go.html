<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/base64</h2>
<ul>
<li><a href="/gostd/encoding/base64/base64.go.html">base64.go</a></li>
<li><a href="/gostd/encoding/base64/base64_test.go.html">base64_test.go</a></li>
<li><a href="/gostd/encoding/base64/example_test.go.html">example_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3669997">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3670052">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3670106">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3670157">//&nbsp;Package&nbsp;base64&nbsp;implements&nbsp;base64&nbsp;encoding&nbsp;as&nbsp;specified&nbsp;by&nbsp;RFC&nbsp;4648.</span><br>
<span class="lineno"></span><span class="keyword" id="3670228">package</span>&nbsp;<span class="ident" id="3670236">base64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3670244">import</span>&nbsp;<span class="op" id="3670251">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3670254">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3670263">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3670269">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3670280">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="3670290">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="3670293">/*<br>
<span class="lineno"></span>&nbsp;*&nbsp;Encodings<br>
<span class="lineno"></span>&nbsp;*/</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3670314">//&nbsp;An&nbsp;Encoding&nbsp;is&nbsp;a&nbsp;radix&nbsp;64&nbsp;encoding/decoding&nbsp;scheme,&nbsp;defined&nbsp;by&nbsp;a</span><br>
<span class="lineno">20</span><span class="comment" id="3670382">//&nbsp;64-character&nbsp;alphabet.&nbsp;&nbsp;The&nbsp;most&nbsp;common&nbsp;encoding&nbsp;is&nbsp;the&nbsp;&#34;base64&#34;</span><br>
<span class="lineno"></span><span class="comment" id="3670450">//&nbsp;encoding&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;4648&nbsp;and&nbsp;used&nbsp;in&nbsp;MIME&nbsp;(RFC&nbsp;2045)&nbsp;and&nbsp;PEM</span><br>
<span class="lineno"></span><span class="comment" id="3670518">//&nbsp;(RFC&nbsp;1421).&nbsp;&nbsp;RFC&nbsp;4648&nbsp;also&nbsp;defines&nbsp;an&nbsp;alternate&nbsp;encoding,&nbsp;which&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3670588">//&nbsp;the&nbsp;standard&nbsp;encoding&nbsp;with&nbsp;-&nbsp;and&nbsp;_&nbsp;substituted&nbsp;for&nbsp;+&nbsp;and&nbsp;/.</span><br>
<span class="lineno"></span><span class="keyword" id="3670651">type</span>&nbsp;<span class="ident" id="3670656">Encoding</span>&nbsp;<span class="keyword" id="3670665">struct</span>&nbsp;<span class="op" id="3670672">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3670675">encode</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3670685">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3670693">decodeMap</span>&nbsp;<span class="op" id="3670703">[</span><span class="num" id="3670704">256</span><span class="op" id="3670707">]</span><span class="builtintype" id="3670708">byte</span><br>
<span class="lineno"></span><span class="op" id="3670713">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3670716">const</span>&nbsp;<span class="ident" id="3670722">encodeStd</span>&nbsp;<span class="op" id="3670732">=</span>&nbsp;<span class="string" id="3670734">&#34;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&#34;</span><br>
<span class="lineno">30</span><span class="keyword" id="3670801">const</span>&nbsp;<span class="ident" id="3670807">encodeURL</span>&nbsp;<span class="op" id="3670817">=</span>&nbsp;<span class="string" id="3670819">&#34;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3670887">//&nbsp;NewEncoding&nbsp;returns&nbsp;a&nbsp;new&nbsp;Encoding&nbsp;defined&nbsp;by&nbsp;the&nbsp;given&nbsp;alphabet,</span><br>
<span class="lineno"></span><span class="comment" id="3670956">//&nbsp;which&nbsp;must&nbsp;be&nbsp;a&nbsp;64-byte&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="3670991">func</span>&nbsp;<span class="ident" id="3670996">NewEncoding</span><span class="op" id="3671007">(</span><span class="ident" id="3671008">encoder</span>&nbsp;<span class="builtintype" id="3671016">string</span><span class="op" id="3671022">)</span>&nbsp;<span class="op" id="3671024">*</span><span class="ident" id="3671025">Encoding</span>&nbsp;<span class="op" id="3671034">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3671037">e</span>&nbsp;<span class="op" id="3671039">:=</span>&nbsp;<span class="builtinfunc" id="3671042">new</span><span class="op" id="3671045">(</span><span class="ident" id="3671046">Encoding</span><span class="op" id="3671054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3671057">e</span><span class="op" id="3671058">.</span><span class="ident" id="3671059">encode</span>&nbsp;<span class="op" id="3671066">=</span>&nbsp;<span class="ident" id="3671068">encoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3671077">for</span>&nbsp;<span class="ident" id="3671081">i</span>&nbsp;<span class="op" id="3671083">:=</span>&nbsp;<span class="num" id="3671086">0</span><span class="op" id="3671087">;</span>&nbsp;<span class="ident" id="3671089">i</span>&nbsp;<span class="op" id="3671091">&lt;</span>&nbsp;<span class="builtinfunc" id="3671093">len</span><span class="op" id="3671096">(</span><span class="ident" id="3671097">e</span><span class="op" id="3671098">.</span><span class="ident" id="3671099">decodeMap</span><span class="op" id="3671108">)</span><span class="op" id="3671109">;</span>&nbsp;<span class="ident" id="3671111">i</span><span class="op" id="3671112">++</span>&nbsp;<span class="op" id="3671115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3671119">e</span><span class="op" id="3671120">.</span><span class="ident" id="3671121">decodeMap</span><span class="op" id="3671130">[</span><span class="ident" id="3671131">i</span><span class="op" id="3671132">]</span>&nbsp;<span class="op" id="3671134">=</span>&nbsp;<span class="num" id="3671136">0xFF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3671142">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3671145">for</span>&nbsp;<span class="ident" id="3671149">i</span>&nbsp;<span class="op" id="3671151">:=</span>&nbsp;<span class="num" id="3671154">0</span><span class="op" id="3671155">;</span>&nbsp;<span class="ident" id="3671157">i</span>&nbsp;<span class="op" id="3671159">&lt;</span>&nbsp;<span class="builtinfunc" id="3671161">len</span><span class="op" id="3671164">(</span><span class="ident" id="3671165">encoder</span><span class="op" id="3671172">)</span><span class="op" id="3671173">;</span>&nbsp;<span class="ident" id="3671175">i</span><span class="op" id="3671176">++</span>&nbsp;<span class="op" id="3671179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3671183">e</span><span class="op" id="3671184">.</span><span class="ident" id="3671185">decodeMap</span><span class="op" id="3671194">[</span><span class="ident" id="3671195">encoder</span><span class="op" id="3671202">[</span><span class="ident" id="3671203">i</span><span class="op" id="3671204">]</span><span class="op" id="3671205">]</span>&nbsp;<span class="op" id="3671207">=</span>&nbsp;<span class="builtintype" id="3671209">byte</span><span class="op" id="3671213">(</span><span class="ident" id="3671214">i</span><span class="op" id="3671215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3671218">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3671221">return</span>&nbsp;<span class="ident" id="3671228">e</span><br>
<span class="lineno"></span><span class="op" id="3671230">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="3671233">//&nbsp;StdEncoding&nbsp;is&nbsp;the&nbsp;standard&nbsp;base64&nbsp;encoding,&nbsp;as&nbsp;defined&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="3671295">//&nbsp;RFC&nbsp;4648.</span><br>
<span class="lineno"></span><span class="keyword" id="3671308">var</span>&nbsp;<span class="ident" id="3671312">StdEncoding</span>&nbsp;<span class="op" id="3671324">=</span>&nbsp;<span class="ident" id="3671326">NewEncoding</span><span class="op" id="3671337">(</span><span class="ident" id="3671338">encodeStd</span><span class="op" id="3671347">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="3671350">//&nbsp;URLEncoding&nbsp;is&nbsp;the&nbsp;alternate&nbsp;base64&nbsp;encoding&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;4648.</span><br>
<span class="lineno"></span><span class="comment" id="3671419">//&nbsp;It&nbsp;is&nbsp;typically&nbsp;used&nbsp;in&nbsp;URLs&nbsp;and&nbsp;file&nbsp;names.</span><br>
<span class="lineno"></span><span class="keyword" id="3671467">var</span>&nbsp;<span class="ident" id="3671471">URLEncoding</span>&nbsp;<span class="op" id="3671483">=</span>&nbsp;<span class="ident" id="3671485">NewEncoding</span><span class="op" id="3671496">(</span><span class="ident" id="3671497">encodeURL</span><span class="op" id="3671506">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3671509">var</span>&nbsp;<span class="ident" id="3671513">removeNewlinesMapper</span>&nbsp;<span class="op" id="3671534">=</span>&nbsp;<span class="keyword" id="3671536">func</span><span class="op" id="3671540">(</span><span class="ident" id="3671541">r</span>&nbsp;<span class="builtintype" id="3671543">rune</span><span class="op" id="3671547">)</span>&nbsp;<span class="builtintype" id="3671549">rune</span>&nbsp;<span class="op" id="3671554">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3671557">if</span>&nbsp;<span class="ident" id="3671560">r</span>&nbsp;<span class="op" id="3671562">==</span>&nbsp;<span class="string" id="3671565">&#39;\r&#39;</span>&nbsp;<span class="op" id="3671570">||</span>&nbsp;<span class="ident" id="3671573">r</span>&nbsp;<span class="op" id="3671575">==</span>&nbsp;<span class="string" id="3671578">&#39;\n&#39;</span>&nbsp;<span class="op" id="3671583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3671587">return</span>&nbsp;<span class="op" id="3671594">-</span><span class="num" id="3671595">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3671598">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3671601">return</span>&nbsp;<span class="ident" id="3671608">r</span><br>
<span class="lineno"></span><span class="op" id="3671610">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="comment" id="3671613">/*<br>
<span class="lineno"></span>&nbsp;*&nbsp;Encoder<br>
<span class="lineno"></span>&nbsp;*/</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="3671632">//&nbsp;Encode&nbsp;encodes&nbsp;src&nbsp;using&nbsp;the&nbsp;encoding&nbsp;enc,&nbsp;writing</span><br>
<span class="lineno"></span><span class="comment" id="3671686">//&nbsp;EncodedLen(len(src))&nbsp;bytes&nbsp;to&nbsp;dst.</span><br>
<span class="lineno"></span><span class="comment" id="3671724">//</span><br>
<span class="lineno"></span><span class="comment" id="3671727">//&nbsp;The&nbsp;encoding&nbsp;pads&nbsp;the&nbsp;output&nbsp;to&nbsp;a&nbsp;multiple&nbsp;of&nbsp;4&nbsp;bytes,</span><br>
<span class="lineno"></span><span class="comment" id="3671785">//&nbsp;so&nbsp;Encode&nbsp;is&nbsp;not&nbsp;appropriate&nbsp;for&nbsp;use&nbsp;on&nbsp;individual&nbsp;blocks</span><br>
<span class="lineno">70</span><span class="comment" id="3671846">//&nbsp;of&nbsp;a&nbsp;large&nbsp;data&nbsp;stream.&nbsp;&nbsp;Use&nbsp;NewEncoder()&nbsp;instead.</span><br>
<span class="lineno"></span><span class="keyword" id="3671900">func</span>&nbsp;<span class="op" id="3671905">(</span><span class="ident" id="3671906">enc</span>&nbsp;<span class="op" id="3671910">*</span><span class="ident" id="3671911">Encoding</span><span class="op" id="3671919">)</span>&nbsp;<span class="ident" id="3671921">Encode</span><span class="op" id="3671927">(</span><span class="ident" id="3671928">dst</span><span class="op" id="3671931">,</span>&nbsp;<span class="ident" id="3671933">src</span>&nbsp;<span class="op" id="3671937">[</span><span class="op" id="3671938">]</span><span class="builtintype" id="3671939">byte</span><span class="op" id="3671943">)</span>&nbsp;<span class="op" id="3671945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3671948">if</span>&nbsp;<span class="builtinfunc" id="3671951">len</span><span class="op" id="3671954">(</span><span class="ident" id="3671955">src</span><span class="op" id="3671958">)</span>&nbsp;<span class="op" id="3671960">==</span>&nbsp;<span class="num" id="3671963">0</span>&nbsp;<span class="op" id="3671965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3671969">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3671977">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3671981">for</span>&nbsp;<span class="builtinfunc" id="3671985">len</span><span class="op" id="3671988">(</span><span class="ident" id="3671989">src</span><span class="op" id="3671992">)</span>&nbsp;<span class="op" id="3671994">&gt;</span>&nbsp;<span class="num" id="3671996">0</span>&nbsp;<span class="op" id="3671998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3672002">var</span>&nbsp;<span class="ident" id="3672006">b0</span><span class="op" id="3672008">,</span>&nbsp;<span class="ident" id="3672010">b1</span><span class="op" id="3672012">,</span>&nbsp;<span class="ident" id="3672014">b2</span><span class="op" id="3672016">,</span>&nbsp;<span class="ident" id="3672018">b3</span>&nbsp;<span class="builtintype" id="3672021">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3672029">//&nbsp;Unpack&nbsp;4x&nbsp;6-bit&nbsp;source&nbsp;blocks&nbsp;into&nbsp;a&nbsp;4&nbsp;byte</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3672078">//&nbsp;destination&nbsp;quantum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3672103">switch</span>&nbsp;<span class="builtinfunc" id="3672110">len</span><span class="op" id="3672113">(</span><span class="ident" id="3672114">src</span><span class="op" id="3672117">)</span>&nbsp;<span class="op" id="3672119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3672123">default</span><span class="op" id="3672130">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3672135">b3</span>&nbsp;<span class="op" id="3672138">=</span>&nbsp;<span class="ident" id="3672140">src</span><span class="op" id="3672143">[</span><span class="num" id="3672144">2</span><span class="op" id="3672145">]</span>&nbsp;<span class="op" id="3672147">&amp;</span>&nbsp;<span class="num" id="3672149">0x3F</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3672157">b2</span>&nbsp;<span class="op" id="3672160">=</span>&nbsp;<span class="ident" id="3672162">src</span><span class="op" id="3672165">[</span><span class="num" id="3672166">2</span><span class="op" id="3672167">]</span>&nbsp;<span class="op" id="3672169">&gt;&gt;</span>&nbsp;<span class="num" id="3672172">6</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3672177">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3672191">case</span>&nbsp;<span class="num" id="3672196">2</span><span class="op" id="3672197">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3672202">b2</span>&nbsp;<span class="op" id="3672205">|=</span>&nbsp;<span class="op" id="3672208">(</span><span class="ident" id="3672209">src</span><span class="op" id="3672212">[</span><span class="num" id="3672213">1</span><span class="op" id="3672214">]</span>&nbsp;<span class="op" id="3672216">&lt;&lt;</span>&nbsp;<span class="num" id="3672219">2</span><span class="op" id="3672220">)</span>&nbsp;<span class="op" id="3672222">&amp;</span>&nbsp;<span class="num" id="3672224">0x3F</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3672232">b1</span>&nbsp;<span class="op" id="3672235">=</span>&nbsp;<span class="ident" id="3672237">src</span><span class="op" id="3672240">[</span><span class="num" id="3672241">1</span><span class="op" id="3672242">]</span>&nbsp;<span class="op" id="3672244">&gt;&gt;</span>&nbsp;<span class="num" id="3672247">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3672252">fallthrough</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3672266">case</span>&nbsp;<span class="num" id="3672271">1</span><span class="op" id="3672272">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3672277">b1</span>&nbsp;<span class="op" id="3672280">|=</span>&nbsp;<span class="op" id="3672283">(</span><span class="ident" id="3672284">src</span><span class="op" id="3672287">[</span><span class="num" id="3672288">0</span><span class="op" id="3672289">]</span>&nbsp;<span class="op" id="3672291">&lt;&lt;</span>&nbsp;<span class="num" id="3672294">4</span><span class="op" id="3672295">)</span>&nbsp;<span class="op" id="3672297">&amp;</span>&nbsp;<span class="num" id="3672299">0x3F</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3672307">b0</span>&nbsp;<span class="op" id="3672310">=</span>&nbsp;<span class="ident" id="3672312">src</span><span class="op" id="3672315">[</span><span class="num" id="3672316">0</span><span class="op" id="3672317">]</span>&nbsp;<span class="op" id="3672319">&gt;&gt;</span>&nbsp;<span class="num" id="3672322">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3672326">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3672331">//&nbsp;Encode&nbsp;6-bit&nbsp;blocks&nbsp;using&nbsp;the&nbsp;base64&nbsp;alphabet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3672382">dst</span><span class="op" id="3672385">[</span><span class="num" id="3672386">0</span><span class="op" id="3672387">]</span>&nbsp;<span class="op" id="3672389">=</span>&nbsp;<span class="ident" id="3672391">enc</span><span class="op" id="3672394">.</span><span class="ident" id="3672395">encode</span><span class="op" id="3672401">[</span><span class="ident" id="3672402">b0</span><span class="op" id="3672404">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3672408">dst</span><span class="op" id="3672411">[</span><span class="num" id="3672412">1</span><span class="op" id="3672413">]</span>&nbsp;<span class="op" id="3672415">=</span>&nbsp;<span class="ident" id="3672417">enc</span><span class="op" id="3672420">.</span><span class="ident" id="3672421">encode</span><span class="op" id="3672427">[</span><span class="ident" id="3672428">b1</span><span class="op" id="3672430">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3672434">dst</span><span class="op" id="3672437">[</span><span class="num" id="3672438">2</span><span class="op" id="3672439">]</span>&nbsp;<span class="op" id="3672441">=</span>&nbsp;<span class="ident" id="3672443">enc</span><span class="op" id="3672446">.</span><span class="ident" id="3672447">encode</span><span class="op" id="3672453">[</span><span class="ident" id="3672454">b2</span><span class="op" id="3672456">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3672460">dst</span><span class="op" id="3672463">[</span><span class="num" id="3672464">3</span><span class="op" id="3672465">]</span>&nbsp;<span class="op" id="3672467">=</span>&nbsp;<span class="ident" id="3672469">enc</span><span class="op" id="3672472">.</span><span class="ident" id="3672473">encode</span><span class="op" id="3672479">[</span><span class="ident" id="3672480">b3</span><span class="op" id="3672482">]</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3672487">//&nbsp;Pad&nbsp;the&nbsp;final&nbsp;quantum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3672514">if</span>&nbsp;<span class="builtinfunc" id="3672517">len</span><span class="op" id="3672520">(</span><span class="ident" id="3672521">src</span><span class="op" id="3672524">)</span>&nbsp;<span class="op" id="3672526">&lt;</span>&nbsp;<span class="num" id="3672528">3</span>&nbsp;<span class="op" id="3672530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3672535">dst</span><span class="op" id="3672538">[</span><span class="num" id="3672539">3</span><span class="op" id="3672540">]</span>&nbsp;<span class="op" id="3672542">=</span>&nbsp;<span class="string" id="3672544">&#39;=&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3672551">if</span>&nbsp;<span class="builtinfunc" id="3672554">len</span><span class="op" id="3672557">(</span><span class="ident" id="3672558">src</span><span class="op" id="3672561">)</span>&nbsp;<span class="op" id="3672563">&lt;</span>&nbsp;<span class="num" id="3672565">2</span>&nbsp;<span class="op" id="3672567">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3672573">dst</span><span class="op" id="3672576">[</span><span class="num" id="3672577">2</span><span class="op" id="3672578">]</span>&nbsp;<span class="op" id="3672580">=</span>&nbsp;<span class="string" id="3672582">&#39;=&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3672589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3672594">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3672602">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3672607">src</span>&nbsp;<span class="op" id="3672611">=</span>&nbsp;<span class="ident" id="3672613">src</span><span class="op" id="3672616">[</span><span class="num" id="3672617">3</span><span class="op" id="3672618">:</span><span class="op" id="3672619">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3672623">dst</span>&nbsp;<span class="op" id="3672627">=</span>&nbsp;<span class="ident" id="3672629">dst</span><span class="op" id="3672632">[</span><span class="num" id="3672633">4</span><span class="op" id="3672634">:</span><span class="op" id="3672635">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3672638">}</span><br>
<span class="lineno"></span><span class="op" id="3672640">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="comment" id="3672643">//&nbsp;EncodeToString&nbsp;returns&nbsp;the&nbsp;base64&nbsp;encoding&nbsp;of&nbsp;src.</span><br>
<span class="lineno"></span><span class="keyword" id="3672697">func</span>&nbsp;<span class="op" id="3672702">(</span><span class="ident" id="3672703">enc</span>&nbsp;<span class="op" id="3672707">*</span><span class="ident" id="3672708">Encoding</span><span class="op" id="3672716">)</span>&nbsp;<span class="ident" id="3672718">EncodeToString</span><span class="op" id="3672732">(</span><span class="ident" id="3672733">src</span>&nbsp;<span class="op" id="3672737">[</span><span class="op" id="3672738">]</span><span class="builtintype" id="3672739">byte</span><span class="op" id="3672743">)</span>&nbsp;<span class="builtintype" id="3672745">string</span>&nbsp;<span class="op" id="3672752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3672755">buf</span>&nbsp;<span class="op" id="3672759">:=</span>&nbsp;<span class="builtinfunc" id="3672762">make</span><span class="op" id="3672766">(</span><span class="op" id="3672767">[</span><span class="op" id="3672768">]</span><span class="builtintype" id="3672769">byte</span><span class="op" id="3672773">,</span>&nbsp;<span class="ident" id="3672775">enc</span><span class="op" id="3672778">.</span><span class="ident" id="3672779">EncodedLen</span><span class="op" id="3672789">(</span><span class="builtinfunc" id="3672790">len</span><span class="op" id="3672793">(</span><span class="ident" id="3672794">src</span><span class="op" id="3672797">)</span><span class="op" id="3672798">)</span><span class="op" id="3672799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3672802">enc</span><span class="op" id="3672805">.</span><span class="ident" id="3672806">Encode</span><span class="op" id="3672812">(</span><span class="ident" id="3672813">buf</span><span class="op" id="3672816">,</span>&nbsp;<span class="ident" id="3672818">src</span><span class="op" id="3672821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3672824">return</span>&nbsp;<span class="builtintype" id="3672831">string</span><span class="op" id="3672837">(</span><span class="ident" id="3672838">buf</span><span class="op" id="3672841">)</span><br>
<span class="lineno">120</span><span class="op" id="3672843">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3672846">type</span>&nbsp;<span class="ident" id="3672851">encoder</span>&nbsp;<span class="keyword" id="3672859">struct</span>&nbsp;<span class="op" id="3672866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3672869">err</span>&nbsp;&nbsp;<span class="builtintype" id="3672874">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3672881">enc</span>&nbsp;&nbsp;<span class="op" id="3672886">*</span><span class="ident" id="3672887">Encoding</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3672897">w</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3672902">io</span><span class="op" id="3672904">.</span><span class="ident" id="3672905">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3672913">buf</span>&nbsp;&nbsp;<span class="op" id="3672918">[</span><span class="num" id="3672919">3</span><span class="op" id="3672920">]</span><span class="builtintype" id="3672921">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3672929">//&nbsp;buffered&nbsp;data&nbsp;waiting&nbsp;to&nbsp;be&nbsp;encoded</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3672969">nbuf</span>&nbsp;<span class="builtintype" id="3672974">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3672985">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;in&nbsp;buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3673012">out</span>&nbsp;&nbsp;<span class="op" id="3673017">[</span><span class="num" id="3673018">1024</span><span class="op" id="3673022">]</span><span class="builtintype" id="3673023">byte</span>&nbsp;<span class="comment" id="3673028">//&nbsp;output&nbsp;buffer</span><br>
<span class="lineno"></span><span class="op" id="3673045">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="keyword" id="3673048">func</span>&nbsp;<span class="op" id="3673053">(</span><span class="ident" id="3673054">e</span>&nbsp;<span class="op" id="3673056">*</span><span class="ident" id="3673057">encoder</span><span class="op" id="3673064">)</span>&nbsp;<span class="ident" id="3673066">Write</span><span class="op" id="3673071">(</span><span class="ident" id="3673072">p</span>&nbsp;<span class="op" id="3673074">[</span><span class="op" id="3673075">]</span><span class="builtintype" id="3673076">byte</span><span class="op" id="3673080">)</span>&nbsp;<span class="op" id="3673082">(</span><span class="ident" id="3673083">n</span>&nbsp;<span class="builtintype" id="3673085">int</span><span class="op" id="3673088">,</span>&nbsp;<span class="ident" id="3673090">err</span>&nbsp;<span class="builtintype" id="3673094">error</span><span class="op" id="3673099">)</span>&nbsp;<span class="op" id="3673101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3673104">if</span>&nbsp;<span class="ident" id="3673107">e</span><span class="op" id="3673108">.</span><span class="ident" id="3673109">err</span>&nbsp;<span class="op" id="3673113">!=</span>&nbsp;<span class="ident" id="3673116">nil</span>&nbsp;<span class="op" id="3673120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3673124">return</span>&nbsp;<span class="num" id="3673131">0</span><span class="op" id="3673132">,</span>&nbsp;<span class="ident" id="3673134">e</span><span class="op" id="3673135">.</span><span class="ident" id="3673136">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3673141">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3673145">//&nbsp;Leading&nbsp;fringe.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3673165">if</span>&nbsp;<span class="ident" id="3673168">e</span><span class="op" id="3673169">.</span><span class="ident" id="3673170">nbuf</span>&nbsp;<span class="op" id="3673175">&gt;</span>&nbsp;<span class="num" id="3673177">0</span>&nbsp;<span class="op" id="3673179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3673183">var</span>&nbsp;<span class="ident" id="3673187">i</span>&nbsp;<span class="builtintype" id="3673189">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3673195">for</span>&nbsp;<span class="ident" id="3673199">i</span>&nbsp;<span class="op" id="3673201">=</span>&nbsp;<span class="num" id="3673203">0</span><span class="op" id="3673204">;</span>&nbsp;<span class="ident" id="3673206">i</span>&nbsp;<span class="op" id="3673208">&lt;</span>&nbsp;<span class="builtinfunc" id="3673210">len</span><span class="op" id="3673213">(</span><span class="ident" id="3673214">p</span><span class="op" id="3673215">)</span>&nbsp;<span class="op" id="3673217">&amp;&amp;</span>&nbsp;<span class="ident" id="3673220">e</span><span class="op" id="3673221">.</span><span class="ident" id="3673222">nbuf</span>&nbsp;<span class="op" id="3673227">&lt;</span>&nbsp;<span class="num" id="3673229">3</span><span class="op" id="3673230">;</span>&nbsp;<span class="ident" id="3673232">i</span><span class="op" id="3673233">++</span>&nbsp;<span class="op" id="3673236">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3673241">e</span><span class="op" id="3673242">.</span><span class="ident" id="3673243">buf</span><span class="op" id="3673246">[</span><span class="ident" id="3673247">e</span><span class="op" id="3673248">.</span><span class="ident" id="3673249">nbuf</span><span class="op" id="3673253">]</span>&nbsp;<span class="op" id="3673255">=</span>&nbsp;<span class="ident" id="3673257">p</span><span class="op" id="3673258">[</span><span class="ident" id="3673259">i</span><span class="op" id="3673260">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3673265">e</span><span class="op" id="3673266">.</span><span class="ident" id="3673267">nbuf</span><span class="op" id="3673271">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3673276">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3673280">n</span>&nbsp;<span class="op" id="3673282">+=</span>&nbsp;<span class="ident" id="3673285">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3673289">p</span>&nbsp;<span class="op" id="3673291">=</span>&nbsp;<span class="ident" id="3673293">p</span><span class="op" id="3673294">[</span><span class="ident" id="3673295">i</span><span class="op" id="3673296">:</span><span class="op" id="3673297">]</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3673301">if</span>&nbsp;<span class="ident" id="3673304">e</span><span class="op" id="3673305">.</span><span class="ident" id="3673306">nbuf</span>&nbsp;<span class="op" id="3673311">&lt;</span>&nbsp;<span class="num" id="3673313">3</span>&nbsp;<span class="op" id="3673315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3673320">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3673329">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3673333">e</span><span class="op" id="3673334">.</span><span class="ident" id="3673335">enc</span><span class="op" id="3673338">.</span><span class="ident" id="3673339">Encode</span><span class="op" id="3673345">(</span><span class="ident" id="3673346">e</span><span class="op" id="3673347">.</span><span class="ident" id="3673348">out</span><span class="op" id="3673351">[</span><span class="num" id="3673352">0</span><span class="op" id="3673353">:</span><span class="op" id="3673354">]</span><span class="op" id="3673355">,</span>&nbsp;<span class="ident" id="3673357">e</span><span class="op" id="3673358">.</span><span class="ident" id="3673359">buf</span><span class="op" id="3673362">[</span><span class="num" id="3673363">0</span><span class="op" id="3673364">:</span><span class="op" id="3673365">]</span><span class="op" id="3673366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3673370">if</span>&nbsp;<span class="ident" id="3673373">_</span><span class="op" id="3673374">,</span>&nbsp;<span class="ident" id="3673376">e</span><span class="op" id="3673377">.</span><span class="ident" id="3673378">err</span>&nbsp;<span class="op" id="3673382">=</span>&nbsp;<span class="ident" id="3673384">e</span><span class="op" id="3673385">.</span><span class="ident" id="3673386">w</span><span class="op" id="3673387">.</span><span class="ident" id="3673388">Write</span><span class="op" id="3673393">(</span><span class="ident" id="3673394">e</span><span class="op" id="3673395">.</span><span class="ident" id="3673396">out</span><span class="op" id="3673399">[</span><span class="num" id="3673400">0</span><span class="op" id="3673401">:</span><span class="num" id="3673402">4</span><span class="op" id="3673403">]</span><span class="op" id="3673404">)</span><span class="op" id="3673405">;</span>&nbsp;<span class="ident" id="3673407">e</span><span class="op" id="3673408">.</span><span class="ident" id="3673409">err</span>&nbsp;<span class="op" id="3673413">!=</span>&nbsp;<span class="ident" id="3673416">nil</span>&nbsp;<span class="op" id="3673420">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3673425">return</span>&nbsp;<span class="ident" id="3673432">n</span><span class="op" id="3673433">,</span>&nbsp;<span class="ident" id="3673435">e</span><span class="op" id="3673436">.</span><span class="ident" id="3673437">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3673443">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3673447">e</span><span class="op" id="3673448">.</span><span class="ident" id="3673449">nbuf</span>&nbsp;<span class="op" id="3673454">=</span>&nbsp;<span class="num" id="3673456">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3673459">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3673463">//&nbsp;Large&nbsp;interior&nbsp;chunks.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3673490">for</span>&nbsp;<span class="builtinfunc" id="3673494">len</span><span class="op" id="3673497">(</span><span class="ident" id="3673498">p</span><span class="op" id="3673499">)</span>&nbsp;<span class="op" id="3673501">&gt;=</span>&nbsp;<span class="num" id="3673504">3</span>&nbsp;<span class="op" id="3673506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3673510">nn</span>&nbsp;<span class="op" id="3673513">:=</span>&nbsp;<span class="builtinfunc" id="3673516">len</span><span class="op" id="3673519">(</span><span class="ident" id="3673520">e</span><span class="op" id="3673521">.</span><span class="ident" id="3673522">out</span><span class="op" id="3673525">)</span>&nbsp;<span class="op" id="3673527">/</span>&nbsp;<span class="num" id="3673529">4</span>&nbsp;<span class="op" id="3673531">*</span>&nbsp;<span class="num" id="3673533">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3673537">if</span>&nbsp;<span class="ident" id="3673540">nn</span>&nbsp;<span class="op" id="3673543">&gt;</span>&nbsp;<span class="builtinfunc" id="3673545">len</span><span class="op" id="3673548">(</span><span class="ident" id="3673549">p</span><span class="op" id="3673550">)</span>&nbsp;<span class="op" id="3673552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3673557">nn</span>&nbsp;<span class="op" id="3673560">=</span>&nbsp;<span class="builtinfunc" id="3673562">len</span><span class="op" id="3673565">(</span><span class="ident" id="3673566">p</span><span class="op" id="3673567">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3673572">nn</span>&nbsp;<span class="op" id="3673575">-=</span>&nbsp;<span class="ident" id="3673578">nn</span>&nbsp;<span class="op" id="3673581">%</span>&nbsp;<span class="num" id="3673583">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3673587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3673591">e</span><span class="op" id="3673592">.</span><span class="ident" id="3673593">enc</span><span class="op" id="3673596">.</span><span class="ident" id="3673597">Encode</span><span class="op" id="3673603">(</span><span class="ident" id="3673604">e</span><span class="op" id="3673605">.</span><span class="ident" id="3673606">out</span><span class="op" id="3673609">[</span><span class="num" id="3673610">0</span><span class="op" id="3673611">:</span><span class="op" id="3673612">]</span><span class="op" id="3673613">,</span>&nbsp;<span class="ident" id="3673615">p</span><span class="op" id="3673616">[</span><span class="num" id="3673617">0</span><span class="op" id="3673618">:</span><span class="ident" id="3673619">nn</span><span class="op" id="3673621">]</span><span class="op" id="3673622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3673626">if</span>&nbsp;<span class="ident" id="3673629">_</span><span class="op" id="3673630">,</span>&nbsp;<span class="ident" id="3673632">e</span><span class="op" id="3673633">.</span><span class="ident" id="3673634">err</span>&nbsp;<span class="op" id="3673638">=</span>&nbsp;<span class="ident" id="3673640">e</span><span class="op" id="3673641">.</span><span class="ident" id="3673642">w</span><span class="op" id="3673643">.</span><span class="ident" id="3673644">Write</span><span class="op" id="3673649">(</span><span class="ident" id="3673650">e</span><span class="op" id="3673651">.</span><span class="ident" id="3673652">out</span><span class="op" id="3673655">[</span><span class="num" id="3673656">0</span>&nbsp;<span class="op" id="3673658">:</span>&nbsp;<span class="ident" id="3673660">nn</span><span class="op" id="3673662">/</span><span class="num" id="3673663">3</span><span class="op" id="3673664">*</span><span class="num" id="3673665">4</span><span class="op" id="3673666">]</span><span class="op" id="3673667">)</span><span class="op" id="3673668">;</span>&nbsp;<span class="ident" id="3673670">e</span><span class="op" id="3673671">.</span><span class="ident" id="3673672">err</span>&nbsp;<span class="op" id="3673676">!=</span>&nbsp;<span class="ident" id="3673679">nil</span>&nbsp;<span class="op" id="3673683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3673688">return</span>&nbsp;<span class="ident" id="3673695">n</span><span class="op" id="3673696">,</span>&nbsp;<span class="ident" id="3673698">e</span><span class="op" id="3673699">.</span><span class="ident" id="3673700">err</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3673706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3673710">n</span>&nbsp;<span class="op" id="3673712">+=</span>&nbsp;<span class="ident" id="3673715">nn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3673720">p</span>&nbsp;<span class="op" id="3673722">=</span>&nbsp;<span class="ident" id="3673724">p</span><span class="op" id="3673725">[</span><span class="ident" id="3673726">nn</span><span class="op" id="3673728">:</span><span class="op" id="3673729">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3673732">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3673736">//&nbsp;Trailing&nbsp;fringe.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3673757">for</span>&nbsp;<span class="ident" id="3673761">i</span>&nbsp;<span class="op" id="3673763">:=</span>&nbsp;<span class="num" id="3673766">0</span><span class="op" id="3673767">;</span>&nbsp;<span class="ident" id="3673769">i</span>&nbsp;<span class="op" id="3673771">&lt;</span>&nbsp;<span class="builtinfunc" id="3673773">len</span><span class="op" id="3673776">(</span><span class="ident" id="3673777">p</span><span class="op" id="3673778">)</span><span class="op" id="3673779">;</span>&nbsp;<span class="ident" id="3673781">i</span><span class="op" id="3673782">++</span>&nbsp;<span class="op" id="3673785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3673789">e</span><span class="op" id="3673790">.</span><span class="ident" id="3673791">buf</span><span class="op" id="3673794">[</span><span class="ident" id="3673795">i</span><span class="op" id="3673796">]</span>&nbsp;<span class="op" id="3673798">=</span>&nbsp;<span class="ident" id="3673800">p</span><span class="op" id="3673801">[</span><span class="ident" id="3673802">i</span><span class="op" id="3673803">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3673806">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3673809">e</span><span class="op" id="3673810">.</span><span class="ident" id="3673811">nbuf</span>&nbsp;<span class="op" id="3673816">=</span>&nbsp;<span class="builtinfunc" id="3673818">len</span><span class="op" id="3673821">(</span><span class="ident" id="3673822">p</span><span class="op" id="3673823">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3673826">n</span>&nbsp;<span class="op" id="3673828">+=</span>&nbsp;<span class="builtinfunc" id="3673831">len</span><span class="op" id="3673834">(</span><span class="ident" id="3673835">p</span><span class="op" id="3673836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3673839">return</span><br>
<span class="lineno"></span><span class="op" id="3673846">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3673849">//&nbsp;Close&nbsp;flushes&nbsp;any&nbsp;pending&nbsp;output&nbsp;from&nbsp;the&nbsp;encoder.</span><br>
<span class="lineno">180</span><span class="comment" id="3673903">//&nbsp;It&nbsp;is&nbsp;an&nbsp;error&nbsp;to&nbsp;call&nbsp;Write&nbsp;after&nbsp;calling&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="3673956">func</span>&nbsp;<span class="op" id="3673961">(</span><span class="ident" id="3673962">e</span>&nbsp;<span class="op" id="3673964">*</span><span class="ident" id="3673965">encoder</span><span class="op" id="3673972">)</span>&nbsp;<span class="ident" id="3673974">Close</span><span class="op" id="3673979">(</span><span class="op" id="3673980">)</span>&nbsp;<span class="builtintype" id="3673982">error</span>&nbsp;<span class="op" id="3673988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3673991">//&nbsp;If&nbsp;there&#39;s&nbsp;anything&nbsp;left&nbsp;in&nbsp;the&nbsp;buffer,&nbsp;flush&nbsp;it&nbsp;out</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3674048">if</span>&nbsp;<span class="ident" id="3674051">e</span><span class="op" id="3674052">.</span><span class="ident" id="3674053">err</span>&nbsp;<span class="op" id="3674057">==</span>&nbsp;<span class="ident" id="3674060">nil</span>&nbsp;<span class="op" id="3674064">&amp;&amp;</span>&nbsp;<span class="ident" id="3674067">e</span><span class="op" id="3674068">.</span><span class="ident" id="3674069">nbuf</span>&nbsp;<span class="op" id="3674074">&gt;</span>&nbsp;<span class="num" id="3674076">0</span>&nbsp;<span class="op" id="3674078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3674082">e</span><span class="op" id="3674083">.</span><span class="ident" id="3674084">enc</span><span class="op" id="3674087">.</span><span class="ident" id="3674088">Encode</span><span class="op" id="3674094">(</span><span class="ident" id="3674095">e</span><span class="op" id="3674096">.</span><span class="ident" id="3674097">out</span><span class="op" id="3674100">[</span><span class="num" id="3674101">0</span><span class="op" id="3674102">:</span><span class="op" id="3674103">]</span><span class="op" id="3674104">,</span>&nbsp;<span class="ident" id="3674106">e</span><span class="op" id="3674107">.</span><span class="ident" id="3674108">buf</span><span class="op" id="3674111">[</span><span class="num" id="3674112">0</span><span class="op" id="3674113">:</span><span class="ident" id="3674114">e</span><span class="op" id="3674115">.</span><span class="ident" id="3674116">nbuf</span><span class="op" id="3674120">]</span><span class="op" id="3674121">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3674125">e</span><span class="op" id="3674126">.</span><span class="ident" id="3674127">nbuf</span>&nbsp;<span class="op" id="3674132">=</span>&nbsp;<span class="num" id="3674134">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3674138">_</span><span class="op" id="3674139">,</span>&nbsp;<span class="ident" id="3674141">e</span><span class="op" id="3674142">.</span><span class="ident" id="3674143">err</span>&nbsp;<span class="op" id="3674147">=</span>&nbsp;<span class="ident" id="3674149">e</span><span class="op" id="3674150">.</span><span class="ident" id="3674151">w</span><span class="op" id="3674152">.</span><span class="ident" id="3674153">Write</span><span class="op" id="3674158">(</span><span class="ident" id="3674159">e</span><span class="op" id="3674160">.</span><span class="ident" id="3674161">out</span><span class="op" id="3674164">[</span><span class="num" id="3674165">0</span><span class="op" id="3674166">:</span><span class="num" id="3674167">4</span><span class="op" id="3674168">]</span><span class="op" id="3674169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3674172">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3674175">return</span>&nbsp;<span class="ident" id="3674182">e</span><span class="op" id="3674183">.</span><span class="ident" id="3674184">err</span><br>
<span class="lineno"></span><span class="op" id="3674188">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="comment" id="3674191">//&nbsp;NewEncoder&nbsp;returns&nbsp;a&nbsp;new&nbsp;base64&nbsp;stream&nbsp;encoder.&nbsp;&nbsp;Data&nbsp;written&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3674259">//&nbsp;the&nbsp;returned&nbsp;writer&nbsp;will&nbsp;be&nbsp;encoded&nbsp;using&nbsp;enc&nbsp;and&nbsp;then&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="comment" id="3674331">//&nbsp;Base64&nbsp;encodings&nbsp;operate&nbsp;in&nbsp;4-byte&nbsp;blocks;&nbsp;when&nbsp;finished</span><br>
<span class="lineno"></span><span class="comment" id="3674391">//&nbsp;writing,&nbsp;the&nbsp;caller&nbsp;must&nbsp;Close&nbsp;the&nbsp;returned&nbsp;encoder&nbsp;to&nbsp;flush&nbsp;any</span><br>
<span class="lineno">195</span><span class="comment" id="3674459">//&nbsp;partially&nbsp;written&nbsp;blocks.</span><br>
<span class="lineno"></span><span class="keyword" id="3674488">func</span>&nbsp;<span class="ident" id="3674493">NewEncoder</span><span class="op" id="3674503">(</span><span class="ident" id="3674504">enc</span>&nbsp;<span class="op" id="3674508">*</span><span class="ident" id="3674509">Encoding</span><span class="op" id="3674517">,</span>&nbsp;<span class="ident" id="3674519">w</span>&nbsp;<span class="ident" id="3674521">io</span><span class="op" id="3674523">.</span><span class="ident" id="3674524">Writer</span><span class="op" id="3674530">)</span>&nbsp;<span class="ident" id="3674532">io</span><span class="op" id="3674534">.</span><span class="ident" id="3674535">WriteCloser</span>&nbsp;<span class="op" id="3674547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3674550">return</span>&nbsp;<span class="op" id="3674557">&amp;</span><span class="ident" id="3674558">encoder</span><span class="op" id="3674565">{</span><span class="ident" id="3674566">enc</span><span class="op" id="3674569">:</span>&nbsp;<span class="ident" id="3674571">enc</span><span class="op" id="3674574">,</span>&nbsp;<span class="ident" id="3674576">w</span><span class="op" id="3674577">:</span>&nbsp;<span class="ident" id="3674579">w</span><span class="op" id="3674580">}</span><br>
<span class="lineno"></span><span class="op" id="3674582">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span><span class="comment" id="3674585">//&nbsp;EncodedLen&nbsp;returns&nbsp;the&nbsp;length&nbsp;in&nbsp;bytes&nbsp;of&nbsp;the&nbsp;base64&nbsp;encoding</span><br>
<span class="lineno"></span><span class="comment" id="3674650">//&nbsp;of&nbsp;an&nbsp;input&nbsp;buffer&nbsp;of&nbsp;length&nbsp;n.</span><br>
<span class="lineno"></span><span class="keyword" id="3674685">func</span>&nbsp;<span class="op" id="3674690">(</span><span class="ident" id="3674691">enc</span>&nbsp;<span class="op" id="3674695">*</span><span class="ident" id="3674696">Encoding</span><span class="op" id="3674704">)</span>&nbsp;<span class="ident" id="3674706">EncodedLen</span><span class="op" id="3674716">(</span><span class="ident" id="3674717">n</span>&nbsp;<span class="builtintype" id="3674719">int</span><span class="op" id="3674722">)</span>&nbsp;<span class="builtintype" id="3674724">int</span>&nbsp;<span class="op" id="3674728">{</span>&nbsp;<span class="keyword" id="3674730">return</span>&nbsp;<span class="op" id="3674737">(</span><span class="ident" id="3674738">n</span>&nbsp;<span class="op" id="3674740">+</span>&nbsp;<span class="num" id="3674742">2</span><span class="op" id="3674743">)</span>&nbsp;<span class="op" id="3674745">/</span>&nbsp;<span class="num" id="3674747">3</span>&nbsp;<span class="op" id="3674749">*</span>&nbsp;<span class="num" id="3674751">4</span>&nbsp;<span class="op" id="3674753">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3674756">/*<br>
<span class="lineno">205</span>&nbsp;*&nbsp;Decoder<br>
<span class="lineno"></span>&nbsp;*/</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3674775">type</span>&nbsp;<span class="ident" id="3674780">CorruptInputError</span>&nbsp;<span class="ident" id="3674798">int64</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="keyword" id="3674805">func</span>&nbsp;<span class="op" id="3674810">(</span><span class="ident" id="3674811">e</span>&nbsp;<span class="ident" id="3674813">CorruptInputError</span><span class="op" id="3674830">)</span>&nbsp;<span class="ident" id="3674832">Error</span><span class="op" id="3674837">(</span><span class="op" id="3674838">)</span>&nbsp;<span class="builtintype" id="3674840">string</span>&nbsp;<span class="op" id="3674847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3674850">return</span>&nbsp;<span class="string" id="3674857">&#34;illegal&nbsp;base64&nbsp;data&nbsp;at&nbsp;input&nbsp;byte&nbsp;&#34;</span>&nbsp;<span class="op" id="3674894">+</span>&nbsp;<span class="ident" id="3674896">strconv</span><span class="op" id="3674903">.</span><span class="ident" id="3674904">FormatInt</span><span class="op" id="3674913">(</span><span class="ident" id="3674914">int64</span><span class="op" id="3674919">(</span><span class="ident" id="3674920">e</span><span class="op" id="3674921">)</span><span class="op" id="3674922">,</span>&nbsp;<span class="num" id="3674924">10</span><span class="op" id="3674926">)</span><br>
<span class="lineno"></span><span class="op" id="3674928">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3674931">//&nbsp;decode&nbsp;is&nbsp;like&nbsp;Decode&nbsp;but&nbsp;returns&nbsp;an&nbsp;additional&nbsp;&#39;end&#39;&nbsp;value,&nbsp;which</span><br>
<span class="lineno">215</span><span class="comment" id="3675001">//&nbsp;indicates&nbsp;if&nbsp;end-of-message&nbsp;padding&nbsp;was&nbsp;encountered&nbsp;and&nbsp;thus&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="3675069">//&nbsp;additional&nbsp;data&nbsp;is&nbsp;an&nbsp;error.&nbsp;This&nbsp;method&nbsp;assumes&nbsp;that&nbsp;src&nbsp;has&nbsp;been</span><br>
<span class="lineno"></span><span class="comment" id="3675139">//&nbsp;stripped&nbsp;of&nbsp;all&nbsp;supported&nbsp;whitespace&nbsp;(&#39;\r&#39;&nbsp;and&nbsp;&#39;\n&#39;).</span><br>
<span class="lineno"></span><span class="keyword" id="3675196">func</span>&nbsp;<span class="op" id="3675201">(</span><span class="ident" id="3675202">enc</span>&nbsp;<span class="op" id="3675206">*</span><span class="ident" id="3675207">Encoding</span><span class="op" id="3675215">)</span>&nbsp;<span class="ident" id="3675217">decode</span><span class="op" id="3675223">(</span><span class="ident" id="3675224">dst</span><span class="op" id="3675227">,</span>&nbsp;<span class="ident" id="3675229">src</span>&nbsp;<span class="op" id="3675233">[</span><span class="op" id="3675234">]</span><span class="builtintype" id="3675235">byte</span><span class="op" id="3675239">)</span>&nbsp;<span class="op" id="3675241">(</span><span class="ident" id="3675242">n</span>&nbsp;<span class="builtintype" id="3675244">int</span><span class="op" id="3675247">,</span>&nbsp;<span class="ident" id="3675249">end</span>&nbsp;<span class="builtintype" id="3675253">bool</span><span class="op" id="3675257">,</span>&nbsp;<span class="ident" id="3675259">err</span>&nbsp;<span class="builtintype" id="3675263">error</span><span class="op" id="3675268">)</span>&nbsp;<span class="op" id="3675270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3675273">olen</span>&nbsp;<span class="op" id="3675278">:=</span>&nbsp;<span class="builtinfunc" id="3675281">len</span><span class="op" id="3675284">(</span><span class="ident" id="3675285">src</span><span class="op" id="3675288">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3675291">for</span>&nbsp;<span class="builtinfunc" id="3675295">len</span><span class="op" id="3675298">(</span><span class="ident" id="3675299">src</span><span class="op" id="3675302">)</span>&nbsp;<span class="op" id="3675304">&gt;</span>&nbsp;<span class="num" id="3675306">0</span>&nbsp;<span class="op" id="3675308">&amp;&amp;</span>&nbsp;<span class="op" id="3675311">!</span><span class="ident" id="3675312">end</span>&nbsp;<span class="op" id="3675316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3675320">//&nbsp;Decode&nbsp;quantum&nbsp;using&nbsp;the&nbsp;base64&nbsp;alphabet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3675366">var</span>&nbsp;<span class="ident" id="3675370">dbuf</span>&nbsp;<span class="op" id="3675375">[</span><span class="num" id="3675376">4</span><span class="op" id="3675377">]</span><span class="builtintype" id="3675378">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3675385">dlen</span>&nbsp;<span class="op" id="3675390">:=</span>&nbsp;<span class="num" id="3675393">4</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3675398">for</span>&nbsp;<span class="ident" id="3675402">j</span>&nbsp;<span class="op" id="3675404">:=</span>&nbsp;<span class="keyword" id="3675407">range</span>&nbsp;<span class="ident" id="3675413">dbuf</span>&nbsp;<span class="op" id="3675418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3675423">if</span>&nbsp;<span class="builtinfunc" id="3675426">len</span><span class="op" id="3675429">(</span><span class="ident" id="3675430">src</span><span class="op" id="3675433">)</span>&nbsp;<span class="op" id="3675435">==</span>&nbsp;<span class="num" id="3675438">0</span>&nbsp;<span class="op" id="3675440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3675446">return</span>&nbsp;<span class="ident" id="3675453">n</span><span class="op" id="3675454">,</span>&nbsp;<span class="builtintype" id="3675456">false</span><span class="op" id="3675461">,</span>&nbsp;<span class="ident" id="3675463">CorruptInputError</span><span class="op" id="3675480">(</span><span class="ident" id="3675481">olen</span>&nbsp;<span class="op" id="3675486">-</span>&nbsp;<span class="builtinfunc" id="3675488">len</span><span class="op" id="3675491">(</span><span class="ident" id="3675492">src</span><span class="op" id="3675495">)</span>&nbsp;<span class="op" id="3675497">-</span>&nbsp;<span class="ident" id="3675499">j</span><span class="op" id="3675500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3675505">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3675510">in</span>&nbsp;<span class="op" id="3675513">:=</span>&nbsp;<span class="ident" id="3675516">src</span><span class="op" id="3675519">[</span><span class="num" id="3675520">0</span><span class="op" id="3675521">]</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3675526">src</span>&nbsp;<span class="op" id="3675530">=</span>&nbsp;<span class="ident" id="3675532">src</span><span class="op" id="3675535">[</span><span class="num" id="3675536">1</span><span class="op" id="3675537">:</span><span class="op" id="3675538">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3675543">if</span>&nbsp;<span class="ident" id="3675546">in</span>&nbsp;<span class="op" id="3675549">==</span>&nbsp;<span class="string" id="3675552">&#39;=&#39;</span>&nbsp;<span class="op" id="3675556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3675562">//&nbsp;We&#39;ve&nbsp;reached&nbsp;the&nbsp;end&nbsp;and&nbsp;there&#39;s&nbsp;padding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3675611">switch</span>&nbsp;<span class="ident" id="3675618">j</span>&nbsp;<span class="op" id="3675620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3675626">case</span>&nbsp;<span class="num" id="3675631">0</span><span class="op" id="3675632">,</span>&nbsp;<span class="num" id="3675634">1</span><span class="op" id="3675635">:</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3675642">//&nbsp;incorrect&nbsp;padding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3675668">return</span>&nbsp;<span class="ident" id="3675675">n</span><span class="op" id="3675676">,</span>&nbsp;<span class="builtintype" id="3675678">false</span><span class="op" id="3675683">,</span>&nbsp;<span class="ident" id="3675685">CorruptInputError</span><span class="op" id="3675702">(</span><span class="ident" id="3675703">olen</span>&nbsp;<span class="op" id="3675708">-</span>&nbsp;<span class="builtinfunc" id="3675710">len</span><span class="op" id="3675713">(</span><span class="ident" id="3675714">src</span><span class="op" id="3675717">)</span>&nbsp;<span class="op" id="3675719">-</span>&nbsp;<span class="num" id="3675721">1</span><span class="op" id="3675722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3675728">case</span>&nbsp;<span class="num" id="3675733">2</span><span class="op" id="3675734">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3675741">//&nbsp;&#34;==&#34;&nbsp;is&nbsp;expected,&nbsp;the&nbsp;first&nbsp;&#34;=&#34;&nbsp;is&nbsp;already&nbsp;consumed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3675802">if</span>&nbsp;<span class="builtinfunc" id="3675805">len</span><span class="op" id="3675808">(</span><span class="ident" id="3675809">src</span><span class="op" id="3675812">)</span>&nbsp;<span class="op" id="3675814">==</span>&nbsp;<span class="num" id="3675817">0</span>&nbsp;<span class="op" id="3675819">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3675827">//&nbsp;not&nbsp;enough&nbsp;padding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3675855">return</span>&nbsp;<span class="ident" id="3675862">n</span><span class="op" id="3675863">,</span>&nbsp;<span class="builtintype" id="3675865">false</span><span class="op" id="3675870">,</span>&nbsp;<span class="ident" id="3675872">CorruptInputError</span><span class="op" id="3675889">(</span><span class="ident" id="3675890">olen</span><span class="op" id="3675894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3675901">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3675908">if</span>&nbsp;<span class="ident" id="3675911">src</span><span class="op" id="3675914">[</span><span class="num" id="3675915">0</span><span class="op" id="3675916">]</span>&nbsp;<span class="op" id="3675918">!=</span>&nbsp;<span class="string" id="3675921">&#39;=&#39;</span>&nbsp;<span class="op" id="3675925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3675933">//&nbsp;incorrect&nbsp;padding</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3675960">return</span>&nbsp;<span class="ident" id="3675967">n</span><span class="op" id="3675968">,</span>&nbsp;<span class="builtintype" id="3675970">false</span><span class="op" id="3675975">,</span>&nbsp;<span class="ident" id="3675977">CorruptInputError</span><span class="op" id="3675994">(</span><span class="ident" id="3675995">olen</span>&nbsp;<span class="op" id="3676000">-</span>&nbsp;<span class="builtinfunc" id="3676002">len</span><span class="op" id="3676005">(</span><span class="ident" id="3676006">src</span><span class="op" id="3676009">)</span>&nbsp;<span class="op" id="3676011">-</span>&nbsp;<span class="num" id="3676013">1</span><span class="op" id="3676014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3676021">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3676028">src</span>&nbsp;<span class="op" id="3676032">=</span>&nbsp;<span class="ident" id="3676034">src</span><span class="op" id="3676037">[</span><span class="num" id="3676038">1</span><span class="op" id="3676039">:</span><span class="op" id="3676040">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3676046">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3676052">if</span>&nbsp;<span class="builtinfunc" id="3676055">len</span><span class="op" id="3676058">(</span><span class="ident" id="3676059">src</span><span class="op" id="3676062">)</span>&nbsp;<span class="op" id="3676064">&gt;</span>&nbsp;<span class="num" id="3676066">0</span>&nbsp;<span class="op" id="3676068">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3676075">//&nbsp;trailing&nbsp;garbage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3676100">err</span>&nbsp;<span class="op" id="3676104">=</span>&nbsp;<span class="ident" id="3676106">CorruptInputError</span><span class="op" id="3676123">(</span><span class="ident" id="3676124">olen</span>&nbsp;<span class="op" id="3676129">-</span>&nbsp;<span class="builtinfunc" id="3676131">len</span><span class="op" id="3676134">(</span><span class="ident" id="3676135">src</span><span class="op" id="3676138">)</span><span class="op" id="3676139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3676145">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3676151">dlen</span><span class="op" id="3676155">,</span>&nbsp;<span class="ident" id="3676157">end</span>&nbsp;<span class="op" id="3676161">=</span>&nbsp;<span class="ident" id="3676163">j</span><span class="op" id="3676164">,</span>&nbsp;<span class="builtintype" id="3676166">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3676175">break</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3676184">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3676189">dbuf</span><span class="op" id="3676193">[</span><span class="ident" id="3676194">j</span><span class="op" id="3676195">]</span>&nbsp;<span class="op" id="3676197">=</span>&nbsp;<span class="ident" id="3676199">enc</span><span class="op" id="3676202">.</span><span class="ident" id="3676203">decodeMap</span><span class="op" id="3676212">[</span><span class="ident" id="3676213">in</span><span class="op" id="3676215">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3676220">if</span>&nbsp;<span class="ident" id="3676223">dbuf</span><span class="op" id="3676227">[</span><span class="ident" id="3676228">j</span><span class="op" id="3676229">]</span>&nbsp;<span class="op" id="3676231">==</span>&nbsp;<span class="num" id="3676234">0xFF</span>&nbsp;<span class="op" id="3676239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3676245">return</span>&nbsp;<span class="ident" id="3676252">n</span><span class="op" id="3676253">,</span>&nbsp;<span class="builtintype" id="3676255">false</span><span class="op" id="3676260">,</span>&nbsp;<span class="ident" id="3676262">CorruptInputError</span><span class="op" id="3676279">(</span><span class="ident" id="3676280">olen</span>&nbsp;<span class="op" id="3676285">-</span>&nbsp;<span class="builtinfunc" id="3676287">len</span><span class="op" id="3676290">(</span><span class="ident" id="3676291">src</span><span class="op" id="3676294">)</span>&nbsp;<span class="op" id="3676296">-</span>&nbsp;<span class="num" id="3676298">1</span><span class="op" id="3676299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3676304">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3676308">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3676313">//&nbsp;Pack&nbsp;4x&nbsp;6-bit&nbsp;source&nbsp;blocks&nbsp;into&nbsp;3&nbsp;byte&nbsp;destination</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3676370">//&nbsp;quantum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3676383">switch</span>&nbsp;<span class="ident" id="3676390">dlen</span>&nbsp;<span class="op" id="3676395">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3676399">case</span>&nbsp;<span class="num" id="3676404">4</span><span class="op" id="3676405">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3676410">dst</span><span class="op" id="3676413">[</span><span class="num" id="3676414">2</span><span class="op" id="3676415">]</span>&nbsp;<span class="op" id="3676417">=</span>&nbsp;<span class="ident" id="3676419">dbuf</span><span class="op" id="3676423">[</span><span class="num" id="3676424">2</span><span class="op" id="3676425">]</span><span class="op" id="3676426">&lt;&lt;</span><span class="num" id="3676428">6</span>&nbsp;<span class="op" id="3676430">|</span>&nbsp;<span class="ident" id="3676432">dbuf</span><span class="op" id="3676436">[</span><span class="num" id="3676437">3</span><span class="op" id="3676438">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3676443">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3676457">case</span>&nbsp;<span class="num" id="3676462">3</span><span class="op" id="3676463">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3676468">dst</span><span class="op" id="3676471">[</span><span class="num" id="3676472">1</span><span class="op" id="3676473">]</span>&nbsp;<span class="op" id="3676475">=</span>&nbsp;<span class="ident" id="3676477">dbuf</span><span class="op" id="3676481">[</span><span class="num" id="3676482">1</span><span class="op" id="3676483">]</span><span class="op" id="3676484">&lt;&lt;</span><span class="num" id="3676486">4</span>&nbsp;<span class="op" id="3676488">|</span>&nbsp;<span class="ident" id="3676490">dbuf</span><span class="op" id="3676494">[</span><span class="num" id="3676495">2</span><span class="op" id="3676496">]</span><span class="op" id="3676497">&gt;&gt;</span><span class="num" id="3676499">2</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3676504">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3676518">case</span>&nbsp;<span class="num" id="3676523">2</span><span class="op" id="3676524">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3676529">dst</span><span class="op" id="3676532">[</span><span class="num" id="3676533">0</span><span class="op" id="3676534">]</span>&nbsp;<span class="op" id="3676536">=</span>&nbsp;<span class="ident" id="3676538">dbuf</span><span class="op" id="3676542">[</span><span class="num" id="3676543">0</span><span class="op" id="3676544">]</span><span class="op" id="3676545">&lt;&lt;</span><span class="num" id="3676547">2</span>&nbsp;<span class="op" id="3676549">|</span>&nbsp;<span class="ident" id="3676551">dbuf</span><span class="op" id="3676555">[</span><span class="num" id="3676556">1</span><span class="op" id="3676557">]</span><span class="op" id="3676558">&gt;&gt;</span><span class="num" id="3676560">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3676564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3676568">dst</span>&nbsp;<span class="op" id="3676572">=</span>&nbsp;<span class="ident" id="3676574">dst</span><span class="op" id="3676577">[</span><span class="num" id="3676578">3</span><span class="op" id="3676579">:</span><span class="op" id="3676580">]</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3676584">n</span>&nbsp;<span class="op" id="3676586">+=</span>&nbsp;<span class="ident" id="3676589">dlen</span>&nbsp;<span class="op" id="3676594">-</span>&nbsp;<span class="num" id="3676596">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3676599">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3676603">return</span>&nbsp;<span class="ident" id="3676610">n</span><span class="op" id="3676611">,</span>&nbsp;<span class="ident" id="3676613">end</span><span class="op" id="3676616">,</span>&nbsp;<span class="ident" id="3676618">err</span><br>
<span class="lineno"></span><span class="op" id="3676622">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="comment" id="3676625">//&nbsp;Decode&nbsp;decodes&nbsp;src&nbsp;using&nbsp;the&nbsp;encoding&nbsp;enc.&nbsp;&nbsp;It&nbsp;writes&nbsp;at&nbsp;most</span><br>
<span class="lineno"></span><span class="comment" id="3676690">//&nbsp;DecodedLen(len(src))&nbsp;bytes&nbsp;to&nbsp;dst&nbsp;and&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes</span><br>
<span class="lineno"></span><span class="comment" id="3676759">//&nbsp;written.&nbsp;&nbsp;If&nbsp;src&nbsp;contains&nbsp;invalid&nbsp;base64&nbsp;data,&nbsp;it&nbsp;will&nbsp;return&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3676828">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;successfully&nbsp;written&nbsp;and&nbsp;CorruptInputError.</span><br>
<span class="lineno">285</span><span class="comment" id="3676891">//&nbsp;New&nbsp;line&nbsp;characters&nbsp;(\r&nbsp;and&nbsp;\n)&nbsp;are&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="keyword" id="3676939">func</span>&nbsp;<span class="op" id="3676944">(</span><span class="ident" id="3676945">enc</span>&nbsp;<span class="op" id="3676949">*</span><span class="ident" id="3676950">Encoding</span><span class="op" id="3676958">)</span>&nbsp;<span class="ident" id="3676960">Decode</span><span class="op" id="3676966">(</span><span class="ident" id="3676967">dst</span><span class="op" id="3676970">,</span>&nbsp;<span class="ident" id="3676972">src</span>&nbsp;<span class="op" id="3676976">[</span><span class="op" id="3676977">]</span><span class="builtintype" id="3676978">byte</span><span class="op" id="3676982">)</span>&nbsp;<span class="op" id="3676984">(</span><span class="ident" id="3676985">n</span>&nbsp;<span class="builtintype" id="3676987">int</span><span class="op" id="3676990">,</span>&nbsp;<span class="ident" id="3676992">err</span>&nbsp;<span class="builtintype" id="3676996">error</span><span class="op" id="3677001">)</span>&nbsp;<span class="op" id="3677003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3677006">src</span>&nbsp;<span class="op" id="3677010">=</span>&nbsp;<span class="ident" id="3677012">bytes</span><span class="op" id="3677017">.</span><span class="ident" id="3677018">Map</span><span class="op" id="3677021">(</span><span class="ident" id="3677022">removeNewlinesMapper</span><span class="op" id="3677042">,</span>&nbsp;<span class="ident" id="3677044">src</span><span class="op" id="3677047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3677050">n</span><span class="op" id="3677051">,</span>&nbsp;<span class="ident" id="3677053">_</span><span class="op" id="3677054">,</span>&nbsp;<span class="ident" id="3677056">err</span>&nbsp;<span class="op" id="3677060">=</span>&nbsp;<span class="ident" id="3677062">enc</span><span class="op" id="3677065">.</span><span class="ident" id="3677066">decode</span><span class="op" id="3677072">(</span><span class="ident" id="3677073">dst</span><span class="op" id="3677076">,</span>&nbsp;<span class="ident" id="3677078">src</span><span class="op" id="3677081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3677084">return</span><br>
<span class="lineno">290</span><span class="op" id="3677091">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3677094">//&nbsp;DecodeString&nbsp;returns&nbsp;the&nbsp;bytes&nbsp;represented&nbsp;by&nbsp;the&nbsp;base64&nbsp;string&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="3677164">func</span>&nbsp;<span class="op" id="3677169">(</span><span class="ident" id="3677170">enc</span>&nbsp;<span class="op" id="3677174">*</span><span class="ident" id="3677175">Encoding</span><span class="op" id="3677183">)</span>&nbsp;<span class="ident" id="3677185">DecodeString</span><span class="op" id="3677197">(</span><span class="ident" id="3677198">s</span>&nbsp;<span class="builtintype" id="3677200">string</span><span class="op" id="3677206">)</span>&nbsp;<span class="op" id="3677208">(</span><span class="op" id="3677209">[</span><span class="op" id="3677210">]</span><span class="builtintype" id="3677211">byte</span><span class="op" id="3677215">,</span>&nbsp;<span class="builtintype" id="3677217">error</span><span class="op" id="3677222">)</span>&nbsp;<span class="op" id="3677224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3677227">s</span>&nbsp;<span class="op" id="3677229">=</span>&nbsp;<span class="ident" id="3677231">strings</span><span class="op" id="3677238">.</span><span class="ident" id="3677239">Map</span><span class="op" id="3677242">(</span><span class="ident" id="3677243">removeNewlinesMapper</span><span class="op" id="3677263">,</span>&nbsp;<span class="ident" id="3677265">s</span><span class="op" id="3677266">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3677269">dbuf</span>&nbsp;<span class="op" id="3677274">:=</span>&nbsp;<span class="builtinfunc" id="3677277">make</span><span class="op" id="3677281">(</span><span class="op" id="3677282">[</span><span class="op" id="3677283">]</span><span class="builtintype" id="3677284">byte</span><span class="op" id="3677288">,</span>&nbsp;<span class="ident" id="3677290">enc</span><span class="op" id="3677293">.</span><span class="ident" id="3677294">DecodedLen</span><span class="op" id="3677304">(</span><span class="builtinfunc" id="3677305">len</span><span class="op" id="3677308">(</span><span class="ident" id="3677309">s</span><span class="op" id="3677310">)</span><span class="op" id="3677311">)</span><span class="op" id="3677312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3677315">n</span><span class="op" id="3677316">,</span>&nbsp;<span class="ident" id="3677318">_</span><span class="op" id="3677319">,</span>&nbsp;<span class="ident" id="3677321">err</span>&nbsp;<span class="op" id="3677325">:=</span>&nbsp;<span class="ident" id="3677328">enc</span><span class="op" id="3677331">.</span><span class="ident" id="3677332">decode</span><span class="op" id="3677338">(</span><span class="ident" id="3677339">dbuf</span><span class="op" id="3677343">,</span>&nbsp;<span class="op" id="3677345">[</span><span class="op" id="3677346">]</span><span class="builtintype" id="3677347">byte</span><span class="op" id="3677351">(</span><span class="ident" id="3677352">s</span><span class="op" id="3677353">)</span><span class="op" id="3677354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3677357">return</span>&nbsp;<span class="ident" id="3677364">dbuf</span><span class="op" id="3677368">[</span><span class="op" id="3677369">:</span><span class="ident" id="3677370">n</span><span class="op" id="3677371">]</span><span class="op" id="3677372">,</span>&nbsp;<span class="ident" id="3677374">err</span><br>
<span class="lineno"></span><span class="op" id="3677378">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span><span class="keyword" id="3677381">type</span>&nbsp;<span class="ident" id="3677386">decoder</span>&nbsp;<span class="keyword" id="3677394">struct</span>&nbsp;<span class="op" id="3677401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3677404">err</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3677411">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3677418">enc</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3677425">*</span><span class="ident" id="3677426">Encoding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3677436">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3677443">io</span><span class="op" id="3677445">.</span><span class="ident" id="3677446">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3677454">end</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3677461">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3677472">//&nbsp;saw&nbsp;end&nbsp;of&nbsp;message</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3677495">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3677502">[</span><span class="num" id="3677503">1024</span><span class="op" id="3677507">]</span><span class="builtintype" id="3677508">byte</span>&nbsp;<span class="comment" id="3677513">//&nbsp;leftover&nbsp;input</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3677532">nbuf</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3677539">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3677544">out</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3677551">[</span><span class="op" id="3677552">]</span><span class="builtintype" id="3677553">byte</span>&nbsp;<span class="comment" id="3677558">//&nbsp;leftover&nbsp;decoded&nbsp;output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3677586">outbuf</span>&nbsp;<span class="op" id="3677593">[</span><span class="num" id="3677594">1024</span>&nbsp;<span class="op" id="3677599">/</span>&nbsp;<span class="num" id="3677601">4</span>&nbsp;<span class="op" id="3677603">*</span>&nbsp;<span class="num" id="3677605">3</span><span class="op" id="3677606">]</span><span class="builtintype" id="3677607">byte</span><br>
<span class="lineno"></span><span class="op" id="3677612">}</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span><span class="keyword" id="3677615">func</span>&nbsp;<span class="op" id="3677620">(</span><span class="ident" id="3677621">d</span>&nbsp;<span class="op" id="3677623">*</span><span class="ident" id="3677624">decoder</span><span class="op" id="3677631">)</span>&nbsp;<span class="ident" id="3677633">Read</span><span class="op" id="3677637">(</span><span class="ident" id="3677638">p</span>&nbsp;<span class="op" id="3677640">[</span><span class="op" id="3677641">]</span><span class="builtintype" id="3677642">byte</span><span class="op" id="3677646">)</span>&nbsp;<span class="op" id="3677648">(</span><span class="ident" id="3677649">n</span>&nbsp;<span class="builtintype" id="3677651">int</span><span class="op" id="3677654">,</span>&nbsp;<span class="ident" id="3677656">err</span>&nbsp;<span class="builtintype" id="3677660">error</span><span class="op" id="3677665">)</span>&nbsp;<span class="op" id="3677667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3677670">if</span>&nbsp;<span class="ident" id="3677673">d</span><span class="op" id="3677674">.</span><span class="ident" id="3677675">err</span>&nbsp;<span class="op" id="3677679">!=</span>&nbsp;<span class="ident" id="3677682">nil</span>&nbsp;<span class="op" id="3677686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3677690">return</span>&nbsp;<span class="num" id="3677697">0</span><span class="op" id="3677698">,</span>&nbsp;<span class="ident" id="3677700">d</span><span class="op" id="3677701">.</span><span class="ident" id="3677702">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3677707">}</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3677711">//&nbsp;Use&nbsp;leftover&nbsp;decoded&nbsp;output&nbsp;from&nbsp;last&nbsp;read.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3677759">if</span>&nbsp;<span class="builtinfunc" id="3677762">len</span><span class="op" id="3677765">(</span><span class="ident" id="3677766">d</span><span class="op" id="3677767">.</span><span class="ident" id="3677768">out</span><span class="op" id="3677771">)</span>&nbsp;<span class="op" id="3677773">&gt;</span>&nbsp;<span class="num" id="3677775">0</span>&nbsp;<span class="op" id="3677777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3677781">n</span>&nbsp;<span class="op" id="3677783">=</span>&nbsp;<span class="builtinfunc" id="3677785">copy</span><span class="op" id="3677789">(</span><span class="ident" id="3677790">p</span><span class="op" id="3677791">,</span>&nbsp;<span class="ident" id="3677793">d</span><span class="op" id="3677794">.</span><span class="ident" id="3677795">out</span><span class="op" id="3677798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3677802">d</span><span class="op" id="3677803">.</span><span class="ident" id="3677804">out</span>&nbsp;<span class="op" id="3677808">=</span>&nbsp;<span class="ident" id="3677810">d</span><span class="op" id="3677811">.</span><span class="ident" id="3677812">out</span><span class="op" id="3677815">[</span><span class="ident" id="3677816">n</span><span class="op" id="3677817">:</span><span class="op" id="3677818">]</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3677822">return</span>&nbsp;<span class="ident" id="3677829">n</span><span class="op" id="3677830">,</span>&nbsp;<span class="ident" id="3677832">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3677837">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3677841">//&nbsp;Read&nbsp;a&nbsp;chunk.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3677859">nn</span>&nbsp;<span class="op" id="3677862">:=</span>&nbsp;<span class="builtinfunc" id="3677865">len</span><span class="op" id="3677868">(</span><span class="ident" id="3677869">p</span><span class="op" id="3677870">)</span>&nbsp;<span class="op" id="3677872">/</span>&nbsp;<span class="num" id="3677874">3</span>&nbsp;<span class="op" id="3677876">*</span>&nbsp;<span class="num" id="3677878">4</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3677881">if</span>&nbsp;<span class="ident" id="3677884">nn</span>&nbsp;<span class="op" id="3677887">&lt;</span>&nbsp;<span class="num" id="3677889">4</span>&nbsp;<span class="op" id="3677891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3677895">nn</span>&nbsp;<span class="op" id="3677898">=</span>&nbsp;<span class="num" id="3677900">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3677903">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3677906">if</span>&nbsp;<span class="ident" id="3677909">nn</span>&nbsp;<span class="op" id="3677912">&gt;</span>&nbsp;<span class="builtinfunc" id="3677914">len</span><span class="op" id="3677917">(</span><span class="ident" id="3677918">d</span><span class="op" id="3677919">.</span><span class="ident" id="3677920">buf</span><span class="op" id="3677923">)</span>&nbsp;<span class="op" id="3677925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3677929">nn</span>&nbsp;<span class="op" id="3677932">=</span>&nbsp;<span class="builtinfunc" id="3677934">len</span><span class="op" id="3677937">(</span><span class="ident" id="3677938">d</span><span class="op" id="3677939">.</span><span class="ident" id="3677940">buf</span><span class="op" id="3677943">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3677946">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3677949">nn</span><span class="op" id="3677951">,</span>&nbsp;<span class="ident" id="3677953">d</span><span class="op" id="3677954">.</span><span class="ident" id="3677955">err</span>&nbsp;<span class="op" id="3677959">=</span>&nbsp;<span class="ident" id="3677961">io</span><span class="op" id="3677963">.</span><span class="ident" id="3677964">ReadAtLeast</span><span class="op" id="3677975">(</span><span class="ident" id="3677976">d</span><span class="op" id="3677977">.</span><span class="ident" id="3677978">r</span><span class="op" id="3677979">,</span>&nbsp;<span class="ident" id="3677981">d</span><span class="op" id="3677982">.</span><span class="ident" id="3677983">buf</span><span class="op" id="3677986">[</span><span class="ident" id="3677987">d</span><span class="op" id="3677988">.</span><span class="ident" id="3677989">nbuf</span><span class="op" id="3677993">:</span><span class="ident" id="3677994">nn</span><span class="op" id="3677996">]</span><span class="op" id="3677997">,</span>&nbsp;<span class="num" id="3677999">4</span><span class="op" id="3678000">-</span><span class="ident" id="3678001">d</span><span class="op" id="3678002">.</span><span class="ident" id="3678003">nbuf</span><span class="op" id="3678007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3678010">d</span><span class="op" id="3678011">.</span><span class="ident" id="3678012">nbuf</span>&nbsp;<span class="op" id="3678017">+=</span>&nbsp;<span class="ident" id="3678020">nn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3678024">if</span>&nbsp;<span class="ident" id="3678027">d</span><span class="op" id="3678028">.</span><span class="ident" id="3678029">err</span>&nbsp;<span class="op" id="3678033">!=</span>&nbsp;<span class="ident" id="3678036">nil</span>&nbsp;<span class="op" id="3678040">||</span>&nbsp;<span class="ident" id="3678043">d</span><span class="op" id="3678044">.</span><span class="ident" id="3678045">nbuf</span>&nbsp;<span class="op" id="3678050">&lt;</span>&nbsp;<span class="num" id="3678052">4</span>&nbsp;<span class="op" id="3678054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3678058">return</span>&nbsp;<span class="num" id="3678065">0</span><span class="op" id="3678066">,</span>&nbsp;<span class="ident" id="3678068">d</span><span class="op" id="3678069">.</span><span class="ident" id="3678070">err</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3678075">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3678079">//&nbsp;Decode&nbsp;chunk&nbsp;into&nbsp;p,&nbsp;or&nbsp;d.out&nbsp;and&nbsp;then&nbsp;p&nbsp;if&nbsp;p&nbsp;is&nbsp;too&nbsp;small.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3678143">nr</span>&nbsp;<span class="op" id="3678146">:=</span>&nbsp;<span class="ident" id="3678149">d</span><span class="op" id="3678150">.</span><span class="ident" id="3678151">nbuf</span>&nbsp;<span class="op" id="3678156">/</span>&nbsp;<span class="num" id="3678158">4</span>&nbsp;<span class="op" id="3678160">*</span>&nbsp;<span class="num" id="3678162">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3678165">nw</span>&nbsp;<span class="op" id="3678168">:=</span>&nbsp;<span class="ident" id="3678171">d</span><span class="op" id="3678172">.</span><span class="ident" id="3678173">nbuf</span>&nbsp;<span class="op" id="3678178">/</span>&nbsp;<span class="num" id="3678180">4</span>&nbsp;<span class="op" id="3678182">*</span>&nbsp;<span class="num" id="3678184">3</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3678187">if</span>&nbsp;<span class="ident" id="3678190">nw</span>&nbsp;<span class="op" id="3678193">&gt;</span>&nbsp;<span class="builtinfunc" id="3678195">len</span><span class="op" id="3678198">(</span><span class="ident" id="3678199">p</span><span class="op" id="3678200">)</span>&nbsp;<span class="op" id="3678202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3678206">nw</span><span class="op" id="3678208">,</span>&nbsp;<span class="ident" id="3678210">d</span><span class="op" id="3678211">.</span><span class="ident" id="3678212">end</span><span class="op" id="3678215">,</span>&nbsp;<span class="ident" id="3678217">d</span><span class="op" id="3678218">.</span><span class="ident" id="3678219">err</span>&nbsp;<span class="op" id="3678223">=</span>&nbsp;<span class="ident" id="3678225">d</span><span class="op" id="3678226">.</span><span class="ident" id="3678227">enc</span><span class="op" id="3678230">.</span><span class="ident" id="3678231">decode</span><span class="op" id="3678237">(</span><span class="ident" id="3678238">d</span><span class="op" id="3678239">.</span><span class="ident" id="3678240">outbuf</span><span class="op" id="3678246">[</span><span class="num" id="3678247">0</span><span class="op" id="3678248">:</span><span class="op" id="3678249">]</span><span class="op" id="3678250">,</span>&nbsp;<span class="ident" id="3678252">d</span><span class="op" id="3678253">.</span><span class="ident" id="3678254">buf</span><span class="op" id="3678257">[</span><span class="num" id="3678258">0</span><span class="op" id="3678259">:</span><span class="ident" id="3678260">nr</span><span class="op" id="3678262">]</span><span class="op" id="3678263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3678267">d</span><span class="op" id="3678268">.</span><span class="ident" id="3678269">out</span>&nbsp;<span class="op" id="3678273">=</span>&nbsp;<span class="ident" id="3678275">d</span><span class="op" id="3678276">.</span><span class="ident" id="3678277">outbuf</span><span class="op" id="3678283">[</span><span class="num" id="3678284">0</span><span class="op" id="3678285">:</span><span class="ident" id="3678286">nw</span><span class="op" id="3678288">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3678292">n</span>&nbsp;<span class="op" id="3678294">=</span>&nbsp;<span class="builtinfunc" id="3678296">copy</span><span class="op" id="3678300">(</span><span class="ident" id="3678301">p</span><span class="op" id="3678302">,</span>&nbsp;<span class="ident" id="3678304">d</span><span class="op" id="3678305">.</span><span class="ident" id="3678306">out</span><span class="op" id="3678309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3678313">d</span><span class="op" id="3678314">.</span><span class="ident" id="3678315">out</span>&nbsp;<span class="op" id="3678319">=</span>&nbsp;<span class="ident" id="3678321">d</span><span class="op" id="3678322">.</span><span class="ident" id="3678323">out</span><span class="op" id="3678326">[</span><span class="ident" id="3678327">n</span><span class="op" id="3678328">:</span><span class="op" id="3678329">]</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3678332">}</span>&nbsp;<span class="keyword" id="3678334">else</span>&nbsp;<span class="op" id="3678339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3678343">n</span><span class="op" id="3678344">,</span>&nbsp;<span class="ident" id="3678346">d</span><span class="op" id="3678347">.</span><span class="ident" id="3678348">end</span><span class="op" id="3678351">,</span>&nbsp;<span class="ident" id="3678353">d</span><span class="op" id="3678354">.</span><span class="ident" id="3678355">err</span>&nbsp;<span class="op" id="3678359">=</span>&nbsp;<span class="ident" id="3678361">d</span><span class="op" id="3678362">.</span><span class="ident" id="3678363">enc</span><span class="op" id="3678366">.</span><span class="ident" id="3678367">decode</span><span class="op" id="3678373">(</span><span class="ident" id="3678374">p</span><span class="op" id="3678375">,</span>&nbsp;<span class="ident" id="3678377">d</span><span class="op" id="3678378">.</span><span class="ident" id="3678379">buf</span><span class="op" id="3678382">[</span><span class="num" id="3678383">0</span><span class="op" id="3678384">:</span><span class="ident" id="3678385">nr</span><span class="op" id="3678387">]</span><span class="op" id="3678388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3678391">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3678394">d</span><span class="op" id="3678395">.</span><span class="ident" id="3678396">nbuf</span>&nbsp;<span class="op" id="3678401">-=</span>&nbsp;<span class="ident" id="3678404">nr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3678408">for</span>&nbsp;<span class="ident" id="3678412">i</span>&nbsp;<span class="op" id="3678414">:=</span>&nbsp;<span class="num" id="3678417">0</span><span class="op" id="3678418">;</span>&nbsp;<span class="ident" id="3678420">i</span>&nbsp;<span class="op" id="3678422">&lt;</span>&nbsp;<span class="ident" id="3678424">d</span><span class="op" id="3678425">.</span><span class="ident" id="3678426">nbuf</span><span class="op" id="3678430">;</span>&nbsp;<span class="ident" id="3678432">i</span><span class="op" id="3678433">++</span>&nbsp;<span class="op" id="3678436">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3678440">d</span><span class="op" id="3678441">.</span><span class="ident" id="3678442">buf</span><span class="op" id="3678445">[</span><span class="ident" id="3678446">i</span><span class="op" id="3678447">]</span>&nbsp;<span class="op" id="3678449">=</span>&nbsp;<span class="ident" id="3678451">d</span><span class="op" id="3678452">.</span><span class="ident" id="3678453">buf</span><span class="op" id="3678456">[</span><span class="ident" id="3678457">i</span><span class="op" id="3678458">+</span><span class="ident" id="3678459">nr</span><span class="op" id="3678461">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3678464">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3678468">if</span>&nbsp;<span class="ident" id="3678471">d</span><span class="op" id="3678472">.</span><span class="ident" id="3678473">err</span>&nbsp;<span class="op" id="3678477">==</span>&nbsp;<span class="ident" id="3678480">nil</span>&nbsp;<span class="op" id="3678484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3678488">d</span><span class="op" id="3678489">.</span><span class="ident" id="3678490">err</span>&nbsp;<span class="op" id="3678494">=</span>&nbsp;<span class="ident" id="3678496">err</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3678501">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3678504">return</span>&nbsp;<span class="ident" id="3678511">n</span><span class="op" id="3678512">,</span>&nbsp;<span class="ident" id="3678514">d</span><span class="op" id="3678515">.</span><span class="ident" id="3678516">err</span><br>
<span class="lineno"></span><span class="op" id="3678520">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3678523">type</span>&nbsp;<span class="ident" id="3678528">newlineFilteringReader</span>&nbsp;<span class="keyword" id="3678551">struct</span>&nbsp;<span class="op" id="3678558">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3678561">wrapped</span>&nbsp;<span class="ident" id="3678569">io</span><span class="op" id="3678571">.</span><span class="ident" id="3678572">Reader</span><br>
<span class="lineno"></span><span class="op" id="3678579">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3678582">func</span>&nbsp;<span class="op" id="3678587">(</span><span class="ident" id="3678588">r</span>&nbsp;<span class="op" id="3678590">*</span><span class="ident" id="3678591">newlineFilteringReader</span><span class="op" id="3678613">)</span>&nbsp;<span class="ident" id="3678615">Read</span><span class="op" id="3678619">(</span><span class="ident" id="3678620">p</span>&nbsp;<span class="op" id="3678622">[</span><span class="op" id="3678623">]</span><span class="builtintype" id="3678624">byte</span><span class="op" id="3678628">)</span>&nbsp;<span class="op" id="3678630">(</span><span class="builtintype" id="3678631">int</span><span class="op" id="3678634">,</span>&nbsp;<span class="builtintype" id="3678636">error</span><span class="op" id="3678641">)</span>&nbsp;<span class="op" id="3678643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3678646">n</span><span class="op" id="3678647">,</span>&nbsp;<span class="ident" id="3678649">err</span>&nbsp;<span class="op" id="3678653">:=</span>&nbsp;<span class="ident" id="3678656">r</span><span class="op" id="3678657">.</span><span class="ident" id="3678658">wrapped</span><span class="op" id="3678665">.</span><span class="ident" id="3678666">Read</span><span class="op" id="3678670">(</span><span class="ident" id="3678671">p</span><span class="op" id="3678672">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3678675">for</span>&nbsp;<span class="ident" id="3678679">n</span>&nbsp;<span class="op" id="3678681">&gt;</span>&nbsp;<span class="num" id="3678683">0</span>&nbsp;<span class="op" id="3678685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3678689">offset</span>&nbsp;<span class="op" id="3678696">:=</span>&nbsp;<span class="num" id="3678699">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3678703">for</span>&nbsp;<span class="ident" id="3678707">i</span><span class="op" id="3678708">,</span>&nbsp;<span class="ident" id="3678710">b</span>&nbsp;<span class="op" id="3678712">:=</span>&nbsp;<span class="keyword" id="3678715">range</span>&nbsp;<span class="ident" id="3678721">p</span><span class="op" id="3678722">[</span><span class="num" id="3678723">0</span><span class="op" id="3678724">:</span><span class="ident" id="3678725">n</span><span class="op" id="3678726">]</span>&nbsp;<span class="op" id="3678728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3678733">if</span>&nbsp;<span class="ident" id="3678736">b</span>&nbsp;<span class="op" id="3678738">!=</span>&nbsp;<span class="string" id="3678741">&#39;\r&#39;</span>&nbsp;<span class="op" id="3678746">&amp;&amp;</span>&nbsp;<span class="ident" id="3678749">b</span>&nbsp;<span class="op" id="3678751">!=</span>&nbsp;<span class="string" id="3678754">&#39;\n&#39;</span>&nbsp;<span class="op" id="3678759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3678765">if</span>&nbsp;<span class="ident" id="3678768">i</span>&nbsp;<span class="op" id="3678770">!=</span>&nbsp;<span class="ident" id="3678773">offset</span>&nbsp;<span class="op" id="3678780">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3678787">p</span><span class="op" id="3678788">[</span><span class="ident" id="3678789">offset</span><span class="op" id="3678795">]</span>&nbsp;<span class="op" id="3678797">=</span>&nbsp;<span class="ident" id="3678799">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3678805">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3678811">offset</span><span class="op" id="3678817">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3678823">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3678827">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3678831">if</span>&nbsp;<span class="ident" id="3678834">offset</span>&nbsp;<span class="op" id="3678841">&gt;</span>&nbsp;<span class="num" id="3678843">0</span>&nbsp;<span class="op" id="3678845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3678850">return</span>&nbsp;<span class="ident" id="3678857">offset</span><span class="op" id="3678863">,</span>&nbsp;<span class="ident" id="3678865">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3678871">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3678875">//&nbsp;Previous&nbsp;buffer&nbsp;entirely&nbsp;whitespace,&nbsp;read&nbsp;again</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3678928">n</span><span class="op" id="3678929">,</span>&nbsp;<span class="ident" id="3678931">err</span>&nbsp;<span class="op" id="3678935">=</span>&nbsp;<span class="ident" id="3678937">r</span><span class="op" id="3678938">.</span><span class="ident" id="3678939">wrapped</span><span class="op" id="3678946">.</span><span class="ident" id="3678947">Read</span><span class="op" id="3678951">(</span><span class="ident" id="3678952">p</span><span class="op" id="3678953">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3678956">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3678959">return</span>&nbsp;<span class="ident" id="3678966">n</span><span class="op" id="3678967">,</span>&nbsp;<span class="ident" id="3678969">err</span><br>
<span class="lineno"></span><span class="op" id="3678973">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3678976">//&nbsp;NewDecoder&nbsp;constructs&nbsp;a&nbsp;new&nbsp;base64&nbsp;stream&nbsp;decoder.</span><br>
<span class="lineno">385</span><span class="keyword" id="3679030">func</span>&nbsp;<span class="ident" id="3679035">NewDecoder</span><span class="op" id="3679045">(</span><span class="ident" id="3679046">enc</span>&nbsp;<span class="op" id="3679050">*</span><span class="ident" id="3679051">Encoding</span><span class="op" id="3679059">,</span>&nbsp;<span class="ident" id="3679061">r</span>&nbsp;<span class="ident" id="3679063">io</span><span class="op" id="3679065">.</span><span class="ident" id="3679066">Reader</span><span class="op" id="3679072">)</span>&nbsp;<span class="ident" id="3679074">io</span><span class="op" id="3679076">.</span><span class="ident" id="3679077">Reader</span>&nbsp;<span class="op" id="3679084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3679087">return</span>&nbsp;<span class="op" id="3679094">&amp;</span><span class="ident" id="3679095">decoder</span><span class="op" id="3679102">{</span><span class="ident" id="3679103">enc</span><span class="op" id="3679106">:</span>&nbsp;<span class="ident" id="3679108">enc</span><span class="op" id="3679111">,</span>&nbsp;<span class="ident" id="3679113">r</span><span class="op" id="3679114">:</span>&nbsp;<span class="op" id="3679116">&amp;</span><span class="ident" id="3679117">newlineFilteringReader</span><span class="op" id="3679139">{</span><span class="ident" id="3679140">r</span><span class="op" id="3679141">}</span><span class="op" id="3679142">}</span><br>
<span class="lineno"></span><span class="op" id="3679144">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3679147">//&nbsp;DecodedLen&nbsp;returns&nbsp;the&nbsp;maximum&nbsp;length&nbsp;in&nbsp;bytes&nbsp;of&nbsp;the&nbsp;decoded&nbsp;data</span><br>
<span class="lineno">390</span><span class="comment" id="3679217">//&nbsp;corresponding&nbsp;to&nbsp;n&nbsp;bytes&nbsp;of&nbsp;base64-encoded&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="3679269">func</span>&nbsp;<span class="op" id="3679274">(</span><span class="ident" id="3679275">enc</span>&nbsp;<span class="op" id="3679279">*</span><span class="ident" id="3679280">Encoding</span><span class="op" id="3679288">)</span>&nbsp;<span class="ident" id="3679290">DecodedLen</span><span class="op" id="3679300">(</span><span class="ident" id="3679301">n</span>&nbsp;<span class="builtintype" id="3679303">int</span><span class="op" id="3679306">)</span>&nbsp;<span class="builtintype" id="3679308">int</span>&nbsp;<span class="op" id="3679312">{</span>&nbsp;<span class="keyword" id="3679314">return</span>&nbsp;<span class="ident" id="3679321">n</span>&nbsp;<span class="op" id="3679323">/</span>&nbsp;<span class="num" id="3679325">4</span>&nbsp;<span class="op" id="3679327">*</span>&nbsp;<span class="num" id="3679329">3</span>&nbsp;<span class="op" id="3679331">}</span>
</div>
</body>
</html>
