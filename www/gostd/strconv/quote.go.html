<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>strconv</h2>
<ul>
<li><a href="/gostd/strconv/atob.go.html">atob.go</a></li>
<li><a href="/gostd/strconv/atob_test.go.html">atob_test.go</a></li>
<li><a href="/gostd/strconv/atof.go.html">atof.go</a></li>
<li><a href="/gostd/strconv/atof_test.go.html">atof_test.go</a></li>
<li><a href="/gostd/strconv/atoi.go.html">atoi.go</a></li>
<li><a href="/gostd/strconv/atoi_test.go.html">atoi_test.go</a></li>
<li><a href="/gostd/strconv/decimal.go.html">decimal.go</a></li>
<li><a href="/gostd/strconv/decimal_test.go.html">decimal_test.go</a></li>
<li><a href="/gostd/strconv/extfloat.go.html">extfloat.go</a></li>
<li><a href="/gostd/strconv/fp_test.go.html">fp_test.go</a></li>
<li><a href="/gostd/strconv/ftoa.go.html">ftoa.go</a></li>
<li><a href="/gostd/strconv/ftoa_test.go.html">ftoa_test.go</a></li>
<li><a href="/gostd/strconv/internal_test.go.html">internal_test.go</a></li>
<li><a href="/gostd/strconv/isprint.go.html">isprint.go</a></li>
<li><a href="/gostd/strconv/itoa.go.html">itoa.go</a></li>
<li><a href="/gostd/strconv/itoa_test.go.html">itoa_test.go</a></li>
<li><a href="/gostd/strconv/quote.go.html" class="current">quote.go</a></li>
<li><a href="/gostd/strconv/quote_example_test.go.html">quote_example_test.go</a></li>
<li><a href="/gostd/strconv/quote_test.go.html">quote_test.go</a></li>
<li><a href="/gostd/strconv/strconv_test.go.html">strconv_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2381298">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2381353">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2381407">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2381458">//go:generate&nbsp;go&nbsp;run&nbsp;makeisprint.go&nbsp;-output&nbsp;isprint.go</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2381514">package</span>&nbsp;<span class="ident" id="2381522">strconv</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2381531">import</span>&nbsp;<span class="op" id="2381538">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2381541">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="2381556">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2381559">const</span>&nbsp;<span class="ident" id="2381565">lowerhex</span>&nbsp;<span class="op" id="2381574">=</span>&nbsp;<span class="string" id="2381576">&#34;0123456789abcdef&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="2381596">func</span>&nbsp;<span class="ident" id="2381601">quoteWith</span><span class="op" id="2381610">(</span><span class="ident" id="2381611">s</span>&nbsp;<span class="builtintype" id="2381613">string</span><span class="op" id="2381619">,</span>&nbsp;<span class="ident" id="2381621">quote</span>&nbsp;<span class="builtintype" id="2381627">byte</span><span class="op" id="2381631">,</span>&nbsp;<span class="ident" id="2381633">ASCIIonly</span>&nbsp;<span class="builtintype" id="2381643">bool</span><span class="op" id="2381647">)</span>&nbsp;<span class="builtintype" id="2381649">string</span>&nbsp;<span class="op" id="2381656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2381659">var</span>&nbsp;<span class="ident" id="2381663">runeTmp</span>&nbsp;<span class="op" id="2381671">[</span><span class="ident" id="2381672">utf8</span><span class="op" id="2381676">.</span><span class="ident" id="2381677">UTFMax</span><span class="op" id="2381683">]</span><span class="builtintype" id="2381684">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2381690">buf</span>&nbsp;<span class="op" id="2381694">:=</span>&nbsp;<span class="builtinfunc" id="2381697">make</span><span class="op" id="2381701">(</span><span class="op" id="2381702">[</span><span class="op" id="2381703">]</span><span class="builtintype" id="2381704">byte</span><span class="op" id="2381708">,</span>&nbsp;<span class="num" id="2381710">0</span><span class="op" id="2381711">,</span>&nbsp;<span class="num" id="2381713">3</span><span class="op" id="2381714">*</span><span class="builtinfunc" id="2381715">len</span><span class="op" id="2381718">(</span><span class="ident" id="2381719">s</span><span class="op" id="2381720">)</span><span class="op" id="2381721">/</span><span class="num" id="2381722">2</span><span class="op" id="2381723">)</span>&nbsp;<span class="comment" id="2381725">//&nbsp;Try&nbsp;to&nbsp;avoid&nbsp;more&nbsp;allocations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2381760">buf</span>&nbsp;<span class="op" id="2381764">=</span>&nbsp;<span class="builtinfunc" id="2381766">append</span><span class="op" id="2381772">(</span><span class="ident" id="2381773">buf</span><span class="op" id="2381776">,</span>&nbsp;<span class="ident" id="2381778">quote</span><span class="op" id="2381783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2381786">for</span>&nbsp;<span class="ident" id="2381790">width</span>&nbsp;<span class="op" id="2381796">:=</span>&nbsp;<span class="num" id="2381799">0</span><span class="op" id="2381800">;</span>&nbsp;<span class="builtinfunc" id="2381802">len</span><span class="op" id="2381805">(</span><span class="ident" id="2381806">s</span><span class="op" id="2381807">)</span>&nbsp;<span class="op" id="2381809">&gt;</span>&nbsp;<span class="num" id="2381811">0</span><span class="op" id="2381812">;</span>&nbsp;<span class="ident" id="2381814">s</span>&nbsp;<span class="op" id="2381816">=</span>&nbsp;<span class="ident" id="2381818">s</span><span class="op" id="2381819">[</span><span class="ident" id="2381820">width</span><span class="op" id="2381825">:</span><span class="op" id="2381826">]</span>&nbsp;<span class="op" id="2381828">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2381832">r</span>&nbsp;<span class="op" id="2381834">:=</span>&nbsp;<span class="builtintype" id="2381837">rune</span><span class="op" id="2381841">(</span><span class="ident" id="2381842">s</span><span class="op" id="2381843">[</span><span class="num" id="2381844">0</span><span class="op" id="2381845">]</span><span class="op" id="2381846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2381850">width</span>&nbsp;<span class="op" id="2381856">=</span>&nbsp;<span class="num" id="2381858">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2381862">if</span>&nbsp;<span class="ident" id="2381865">r</span>&nbsp;<span class="op" id="2381867">&gt;=</span>&nbsp;<span class="ident" id="2381870">utf8</span><span class="op" id="2381874">.</span><span class="ident" id="2381875">RuneSelf</span>&nbsp;<span class="op" id="2381884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2381889">r</span><span class="op" id="2381890">,</span>&nbsp;<span class="ident" id="2381892">width</span>&nbsp;<span class="op" id="2381898">=</span>&nbsp;<span class="ident" id="2381900">utf8</span><span class="op" id="2381904">.</span><span class="ident" id="2381905">DecodeRuneInString</span><span class="op" id="2381923">(</span><span class="ident" id="2381924">s</span><span class="op" id="2381925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2381929">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2381933">if</span>&nbsp;<span class="ident" id="2381936">width</span>&nbsp;<span class="op" id="2381942">==</span>&nbsp;<span class="num" id="2381945">1</span>&nbsp;<span class="op" id="2381947">&amp;&amp;</span>&nbsp;<span class="ident" id="2381950">r</span>&nbsp;<span class="op" id="2381952">==</span>&nbsp;<span class="ident" id="2381955">utf8</span><span class="op" id="2381959">.</span><span class="ident" id="2381960">RuneError</span>&nbsp;<span class="op" id="2381970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2381975">buf</span>&nbsp;<span class="op" id="2381979">=</span>&nbsp;<span class="builtinfunc" id="2381981">append</span><span class="op" id="2381987">(</span><span class="ident" id="2381988">buf</span><span class="op" id="2381991">,</span>&nbsp;<span class="string" id="2381993">`\x`</span><span class="op" id="2381997">...</span><span class="op" id="2382000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2382005">buf</span>&nbsp;<span class="op" id="2382009">=</span>&nbsp;<span class="builtinfunc" id="2382011">append</span><span class="op" id="2382017">(</span><span class="ident" id="2382018">buf</span><span class="op" id="2382021">,</span>&nbsp;<span class="ident" id="2382023">lowerhex</span><span class="op" id="2382031">[</span><span class="ident" id="2382032">s</span><span class="op" id="2382033">[</span><span class="num" id="2382034">0</span><span class="op" id="2382035">]</span><span class="op" id="2382036">&gt;&gt;</span><span class="num" id="2382038">4</span><span class="op" id="2382039">]</span><span class="op" id="2382040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2382045">buf</span>&nbsp;<span class="op" id="2382049">=</span>&nbsp;<span class="builtinfunc" id="2382051">append</span><span class="op" id="2382057">(</span><span class="ident" id="2382058">buf</span><span class="op" id="2382061">,</span>&nbsp;<span class="ident" id="2382063">lowerhex</span><span class="op" id="2382071">[</span><span class="ident" id="2382072">s</span><span class="op" id="2382073">[</span><span class="num" id="2382074">0</span><span class="op" id="2382075">]</span><span class="op" id="2382076">&amp;</span><span class="num" id="2382077">0xF</span><span class="op" id="2382080">]</span><span class="op" id="2382081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2382086">continue</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2382097">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2382101">if</span>&nbsp;<span class="ident" id="2382104">r</span>&nbsp;<span class="op" id="2382106">==</span>&nbsp;<span class="builtintype" id="2382109">rune</span><span class="op" id="2382113">(</span><span class="ident" id="2382114">quote</span><span class="op" id="2382119">)</span>&nbsp;<span class="op" id="2382121">||</span>&nbsp;<span class="ident" id="2382124">r</span>&nbsp;<span class="op" id="2382126">==</span>&nbsp;<span class="string" id="2382129">&#39;\\&#39;</span>&nbsp;<span class="op" id="2382134">{</span>&nbsp;<span class="comment" id="2382136">//&nbsp;always&nbsp;backslashed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2382161">buf</span>&nbsp;<span class="op" id="2382165">=</span>&nbsp;<span class="builtinfunc" id="2382167">append</span><span class="op" id="2382173">(</span><span class="ident" id="2382174">buf</span><span class="op" id="2382177">,</span>&nbsp;<span class="string" id="2382179">&#39;\\&#39;</span><span class="op" id="2382183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2382188">buf</span>&nbsp;<span class="op" id="2382192">=</span>&nbsp;<span class="builtinfunc" id="2382194">append</span><span class="op" id="2382200">(</span><span class="ident" id="2382201">buf</span><span class="op" id="2382204">,</span>&nbsp;<span class="builtintype" id="2382206">byte</span><span class="op" id="2382210">(</span><span class="ident" id="2382211">r</span><span class="op" id="2382212">)</span><span class="op" id="2382213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2382218">continue</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2382229">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2382233">if</span>&nbsp;<span class="ident" id="2382236">ASCIIonly</span>&nbsp;<span class="op" id="2382246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2382251">if</span>&nbsp;<span class="ident" id="2382254">r</span>&nbsp;<span class="op" id="2382256">&lt;</span>&nbsp;<span class="ident" id="2382258">utf8</span><span class="op" id="2382262">.</span><span class="ident" id="2382263">RuneSelf</span>&nbsp;<span class="op" id="2382272">&amp;&amp;</span>&nbsp;<span class="ident" id="2382275">IsPrint</span><span class="op" id="2382282">(</span><span class="ident" id="2382283">r</span><span class="op" id="2382284">)</span>&nbsp;<span class="op" id="2382286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2382292">buf</span>&nbsp;<span class="op" id="2382296">=</span>&nbsp;<span class="builtinfunc" id="2382298">append</span><span class="op" id="2382304">(</span><span class="ident" id="2382305">buf</span><span class="op" id="2382308">,</span>&nbsp;<span class="builtintype" id="2382310">byte</span><span class="op" id="2382314">(</span><span class="ident" id="2382315">r</span><span class="op" id="2382316">)</span><span class="op" id="2382317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2382323">continue</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2382335">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2382339">}</span>&nbsp;<span class="keyword" id="2382341">else</span>&nbsp;<span class="keyword" id="2382346">if</span>&nbsp;<span class="ident" id="2382349">IsPrint</span><span class="op" id="2382356">(</span><span class="ident" id="2382357">r</span><span class="op" id="2382358">)</span>&nbsp;<span class="op" id="2382360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2382365">n</span>&nbsp;<span class="op" id="2382367">:=</span>&nbsp;<span class="ident" id="2382370">utf8</span><span class="op" id="2382374">.</span><span class="ident" id="2382375">EncodeRune</span><span class="op" id="2382385">(</span><span class="ident" id="2382386">runeTmp</span><span class="op" id="2382393">[</span><span class="op" id="2382394">:</span><span class="op" id="2382395">]</span><span class="op" id="2382396">,</span>&nbsp;<span class="ident" id="2382398">r</span><span class="op" id="2382399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2382404">buf</span>&nbsp;<span class="op" id="2382408">=</span>&nbsp;<span class="builtinfunc" id="2382410">append</span><span class="op" id="2382416">(</span><span class="ident" id="2382417">buf</span><span class="op" id="2382420">,</span>&nbsp;<span class="ident" id="2382422">runeTmp</span><span class="op" id="2382429">[</span><span class="op" id="2382430">:</span><span class="ident" id="2382431">n</span><span class="op" id="2382432">]</span><span class="op" id="2382433">...</span><span class="op" id="2382436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2382441">continue</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2382452">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2382456">switch</span>&nbsp;<span class="ident" id="2382463">r</span>&nbsp;<span class="op" id="2382465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2382469">case</span>&nbsp;<span class="string" id="2382474">&#39;\a&#39;</span><span class="op" id="2382478">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2382483">buf</span>&nbsp;<span class="op" id="2382487">=</span>&nbsp;<span class="builtinfunc" id="2382489">append</span><span class="op" id="2382495">(</span><span class="ident" id="2382496">buf</span><span class="op" id="2382499">,</span>&nbsp;<span class="string" id="2382501">`\a`</span><span class="op" id="2382505">...</span><span class="op" id="2382508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2382512">case</span>&nbsp;<span class="string" id="2382517">&#39;\b&#39;</span><span class="op" id="2382521">:</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2382526">buf</span>&nbsp;<span class="op" id="2382530">=</span>&nbsp;<span class="builtinfunc" id="2382532">append</span><span class="op" id="2382538">(</span><span class="ident" id="2382539">buf</span><span class="op" id="2382542">,</span>&nbsp;<span class="string" id="2382544">`\b`</span><span class="op" id="2382548">...</span><span class="op" id="2382551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2382555">case</span>&nbsp;<span class="string" id="2382560">&#39;\f&#39;</span><span class="op" id="2382564">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2382569">buf</span>&nbsp;<span class="op" id="2382573">=</span>&nbsp;<span class="builtinfunc" id="2382575">append</span><span class="op" id="2382581">(</span><span class="ident" id="2382582">buf</span><span class="op" id="2382585">,</span>&nbsp;<span class="string" id="2382587">`\f`</span><span class="op" id="2382591">...</span><span class="op" id="2382594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2382598">case</span>&nbsp;<span class="string" id="2382603">&#39;\n&#39;</span><span class="op" id="2382607">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2382612">buf</span>&nbsp;<span class="op" id="2382616">=</span>&nbsp;<span class="builtinfunc" id="2382618">append</span><span class="op" id="2382624">(</span><span class="ident" id="2382625">buf</span><span class="op" id="2382628">,</span>&nbsp;<span class="string" id="2382630">`\n`</span><span class="op" id="2382634">...</span><span class="op" id="2382637">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2382641">case</span>&nbsp;<span class="string" id="2382646">&#39;\r&#39;</span><span class="op" id="2382650">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2382655">buf</span>&nbsp;<span class="op" id="2382659">=</span>&nbsp;<span class="builtinfunc" id="2382661">append</span><span class="op" id="2382667">(</span><span class="ident" id="2382668">buf</span><span class="op" id="2382671">,</span>&nbsp;<span class="string" id="2382673">`\r`</span><span class="op" id="2382677">...</span><span class="op" id="2382680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2382684">case</span>&nbsp;<span class="string" id="2382689">&#39;\t&#39;</span><span class="op" id="2382693">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2382698">buf</span>&nbsp;<span class="op" id="2382702">=</span>&nbsp;<span class="builtinfunc" id="2382704">append</span><span class="op" id="2382710">(</span><span class="ident" id="2382711">buf</span><span class="op" id="2382714">,</span>&nbsp;<span class="string" id="2382716">`\t`</span><span class="op" id="2382720">...</span><span class="op" id="2382723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2382727">case</span>&nbsp;<span class="string" id="2382732">&#39;\v&#39;</span><span class="op" id="2382736">:</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2382741">buf</span>&nbsp;<span class="op" id="2382745">=</span>&nbsp;<span class="builtinfunc" id="2382747">append</span><span class="op" id="2382753">(</span><span class="ident" id="2382754">buf</span><span class="op" id="2382757">,</span>&nbsp;<span class="string" id="2382759">`\v`</span><span class="op" id="2382763">...</span><span class="op" id="2382766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2382770">default</span><span class="op" id="2382777">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2382782">switch</span>&nbsp;<span class="op" id="2382789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2382794">case</span>&nbsp;<span class="ident" id="2382799">r</span>&nbsp;<span class="op" id="2382801">&lt;</span>&nbsp;<span class="string" id="2382803">&#39;&nbsp;&#39;</span><span class="op" id="2382806">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2382812">buf</span>&nbsp;<span class="op" id="2382816">=</span>&nbsp;<span class="builtinfunc" id="2382818">append</span><span class="op" id="2382824">(</span><span class="ident" id="2382825">buf</span><span class="op" id="2382828">,</span>&nbsp;<span class="string" id="2382830">`\x`</span><span class="op" id="2382834">...</span><span class="op" id="2382837">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2382843">buf</span>&nbsp;<span class="op" id="2382847">=</span>&nbsp;<span class="builtinfunc" id="2382849">append</span><span class="op" id="2382855">(</span><span class="ident" id="2382856">buf</span><span class="op" id="2382859">,</span>&nbsp;<span class="ident" id="2382861">lowerhex</span><span class="op" id="2382869">[</span><span class="ident" id="2382870">s</span><span class="op" id="2382871">[</span><span class="num" id="2382872">0</span><span class="op" id="2382873">]</span><span class="op" id="2382874">&gt;&gt;</span><span class="num" id="2382876">4</span><span class="op" id="2382877">]</span><span class="op" id="2382878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2382884">buf</span>&nbsp;<span class="op" id="2382888">=</span>&nbsp;<span class="builtinfunc" id="2382890">append</span><span class="op" id="2382896">(</span><span class="ident" id="2382897">buf</span><span class="op" id="2382900">,</span>&nbsp;<span class="ident" id="2382902">lowerhex</span><span class="op" id="2382910">[</span><span class="ident" id="2382911">s</span><span class="op" id="2382912">[</span><span class="num" id="2382913">0</span><span class="op" id="2382914">]</span><span class="op" id="2382915">&amp;</span><span class="num" id="2382916">0xF</span><span class="op" id="2382919">]</span><span class="op" id="2382920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2382925">case</span>&nbsp;<span class="ident" id="2382930">r</span>&nbsp;<span class="op" id="2382932">&gt;</span>&nbsp;<span class="ident" id="2382934">utf8</span><span class="op" id="2382938">.</span><span class="ident" id="2382939">MaxRune</span><span class="op" id="2382946">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2382952">r</span>&nbsp;<span class="op" id="2382954">=</span>&nbsp;<span class="num" id="2382956">0xFFFD</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2382967">fallthrough</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2382982">case</span>&nbsp;<span class="ident" id="2382987">r</span>&nbsp;<span class="op" id="2382989">&lt;</span>&nbsp;<span class="num" id="2382991">0x10000</span><span class="op" id="2382998">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2383004">buf</span>&nbsp;<span class="op" id="2383008">=</span>&nbsp;<span class="builtinfunc" id="2383010">append</span><span class="op" id="2383016">(</span><span class="ident" id="2383017">buf</span><span class="op" id="2383020">,</span>&nbsp;<span class="string" id="2383022">`\u`</span><span class="op" id="2383026">...</span><span class="op" id="2383029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2383035">for</span>&nbsp;<span class="ident" id="2383039">s</span>&nbsp;<span class="op" id="2383041">:=</span>&nbsp;<span class="num" id="2383044">12</span><span class="op" id="2383046">;</span>&nbsp;<span class="ident" id="2383048">s</span>&nbsp;<span class="op" id="2383050">&gt;=</span>&nbsp;<span class="num" id="2383053">0</span><span class="op" id="2383054">;</span>&nbsp;<span class="ident" id="2383056">s</span>&nbsp;<span class="op" id="2383058">-=</span>&nbsp;<span class="num" id="2383061">4</span>&nbsp;<span class="op" id="2383063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2383070">buf</span>&nbsp;<span class="op" id="2383074">=</span>&nbsp;<span class="builtinfunc" id="2383076">append</span><span class="op" id="2383082">(</span><span class="ident" id="2383083">buf</span><span class="op" id="2383086">,</span>&nbsp;<span class="ident" id="2383088">lowerhex</span><span class="op" id="2383096">[</span><span class="ident" id="2383097">r</span><span class="op" id="2383098">&gt;&gt;</span><span class="builtintype" id="2383100">uint</span><span class="op" id="2383104">(</span><span class="ident" id="2383105">s</span><span class="op" id="2383106">)</span><span class="op" id="2383107">&amp;</span><span class="num" id="2383108">0xF</span><span class="op" id="2383111">]</span><span class="op" id="2383112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2383118">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2383123">default</span><span class="op" id="2383130">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2383136">buf</span>&nbsp;<span class="op" id="2383140">=</span>&nbsp;<span class="builtinfunc" id="2383142">append</span><span class="op" id="2383148">(</span><span class="ident" id="2383149">buf</span><span class="op" id="2383152">,</span>&nbsp;<span class="string" id="2383154">`\U`</span><span class="op" id="2383158">...</span><span class="op" id="2383161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2383167">for</span>&nbsp;<span class="ident" id="2383171">s</span>&nbsp;<span class="op" id="2383173">:=</span>&nbsp;<span class="num" id="2383176">28</span><span class="op" id="2383178">;</span>&nbsp;<span class="ident" id="2383180">s</span>&nbsp;<span class="op" id="2383182">&gt;=</span>&nbsp;<span class="num" id="2383185">0</span><span class="op" id="2383186">;</span>&nbsp;<span class="ident" id="2383188">s</span>&nbsp;<span class="op" id="2383190">-=</span>&nbsp;<span class="num" id="2383193">4</span>&nbsp;<span class="op" id="2383195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2383202">buf</span>&nbsp;<span class="op" id="2383206">=</span>&nbsp;<span class="builtinfunc" id="2383208">append</span><span class="op" id="2383214">(</span><span class="ident" id="2383215">buf</span><span class="op" id="2383218">,</span>&nbsp;<span class="ident" id="2383220">lowerhex</span><span class="op" id="2383228">[</span><span class="ident" id="2383229">r</span><span class="op" id="2383230">&gt;&gt;</span><span class="builtintype" id="2383232">uint</span><span class="op" id="2383236">(</span><span class="ident" id="2383237">s</span><span class="op" id="2383238">)</span><span class="op" id="2383239">&amp;</span><span class="num" id="2383240">0xF</span><span class="op" id="2383243">]</span><span class="op" id="2383244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2383250">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2383255">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2383259">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2383262">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2383265">buf</span>&nbsp;<span class="op" id="2383269">=</span>&nbsp;<span class="builtinfunc" id="2383271">append</span><span class="op" id="2383277">(</span><span class="ident" id="2383278">buf</span><span class="op" id="2383281">,</span>&nbsp;<span class="ident" id="2383283">quote</span><span class="op" id="2383288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2383291">return</span>&nbsp;<span class="builtintype" id="2383298">string</span><span class="op" id="2383304">(</span><span class="ident" id="2383305">buf</span><span class="op" id="2383308">)</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="op" id="2383311">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2383314">//&nbsp;Quote&nbsp;returns&nbsp;a&nbsp;double-quoted&nbsp;Go&nbsp;string&nbsp;literal&nbsp;representing&nbsp;s.&nbsp;&nbsp;The</span><br>
<span class="lineno"></span><span class="comment" id="2383386">//&nbsp;returned&nbsp;string&nbsp;uses&nbsp;Go&nbsp;escape&nbsp;sequences&nbsp;(\t,&nbsp;\n,&nbsp;\xFF,&nbsp;\u0100)&nbsp;for</span><br>
<span class="lineno">90</span><span class="comment" id="2383457">//&nbsp;control&nbsp;characters&nbsp;and&nbsp;non-printable&nbsp;characters&nbsp;as&nbsp;defined&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="2383522">//&nbsp;IsPrint.</span><br>
<span class="lineno"></span><span class="keyword" id="2383534">func</span>&nbsp;<span class="ident" id="2383539">Quote</span><span class="op" id="2383544">(</span><span class="ident" id="2383545">s</span>&nbsp;<span class="builtintype" id="2383547">string</span><span class="op" id="2383553">)</span>&nbsp;<span class="builtintype" id="2383555">string</span>&nbsp;<span class="op" id="2383562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2383565">return</span>&nbsp;<span class="ident" id="2383572">quoteWith</span><span class="op" id="2383581">(</span><span class="ident" id="2383582">s</span><span class="op" id="2383583">,</span>&nbsp;<span class="string" id="2383585">&#39;&#34;&#39;</span><span class="op" id="2383588">,</span>&nbsp;<span class="builtintype" id="2383590">false</span><span class="op" id="2383595">)</span><br>
<span class="lineno"></span><span class="op" id="2383597">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="comment" id="2383600">//&nbsp;AppendQuote&nbsp;appends&nbsp;a&nbsp;double-quoted&nbsp;Go&nbsp;string&nbsp;literal&nbsp;representing&nbsp;s,</span><br>
<span class="lineno"></span><span class="comment" id="2383673">//&nbsp;as&nbsp;generated&nbsp;by&nbsp;Quote,&nbsp;to&nbsp;dst&nbsp;and&nbsp;returns&nbsp;the&nbsp;extended&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="2383739">func</span>&nbsp;<span class="ident" id="2383744">AppendQuote</span><span class="op" id="2383755">(</span><span class="ident" id="2383756">dst</span>&nbsp;<span class="op" id="2383760">[</span><span class="op" id="2383761">]</span><span class="builtintype" id="2383762">byte</span><span class="op" id="2383766">,</span>&nbsp;<span class="ident" id="2383768">s</span>&nbsp;<span class="builtintype" id="2383770">string</span><span class="op" id="2383776">)</span>&nbsp;<span class="op" id="2383778">[</span><span class="op" id="2383779">]</span><span class="builtintype" id="2383780">byte</span>&nbsp;<span class="op" id="2383785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2383788">return</span>&nbsp;<span class="builtinfunc" id="2383795">append</span><span class="op" id="2383801">(</span><span class="ident" id="2383802">dst</span><span class="op" id="2383805">,</span>&nbsp;<span class="ident" id="2383807">Quote</span><span class="op" id="2383812">(</span><span class="ident" id="2383813">s</span><span class="op" id="2383814">)</span><span class="op" id="2383815">...</span><span class="op" id="2383818">)</span><br>
<span class="lineno">100</span><span class="op" id="2383820">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2383823">//&nbsp;QuoteToASCII&nbsp;returns&nbsp;a&nbsp;double-quoted&nbsp;Go&nbsp;string&nbsp;literal&nbsp;representing&nbsp;s.</span><br>
<span class="lineno"></span><span class="comment" id="2383897">//&nbsp;The&nbsp;returned&nbsp;string&nbsp;uses&nbsp;Go&nbsp;escape&nbsp;sequences&nbsp;(\t,&nbsp;\n,&nbsp;\xFF,&nbsp;\u0100)&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="2383972">//&nbsp;non-ASCII&nbsp;characters&nbsp;and&nbsp;non-printable&nbsp;characters&nbsp;as&nbsp;defined&nbsp;by&nbsp;IsPrint.</span><br>
<span class="lineno">105</span><span class="keyword" id="2384048">func</span>&nbsp;<span class="ident" id="2384053">QuoteToASCII</span><span class="op" id="2384065">(</span><span class="ident" id="2384066">s</span>&nbsp;<span class="builtintype" id="2384068">string</span><span class="op" id="2384074">)</span>&nbsp;<span class="builtintype" id="2384076">string</span>&nbsp;<span class="op" id="2384083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2384086">return</span>&nbsp;<span class="ident" id="2384093">quoteWith</span><span class="op" id="2384102">(</span><span class="ident" id="2384103">s</span><span class="op" id="2384104">,</span>&nbsp;<span class="string" id="2384106">&#39;&#34;&#39;</span><span class="op" id="2384109">,</span>&nbsp;<span class="builtintype" id="2384111">true</span><span class="op" id="2384115">)</span><br>
<span class="lineno"></span><span class="op" id="2384117">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2384120">//&nbsp;AppendQuoteToASCII&nbsp;appends&nbsp;a&nbsp;double-quoted&nbsp;Go&nbsp;string&nbsp;literal&nbsp;representing&nbsp;s,</span><br>
<span class="lineno">110</span><span class="comment" id="2384200">//&nbsp;as&nbsp;generated&nbsp;by&nbsp;QuoteToASCII,&nbsp;to&nbsp;dst&nbsp;and&nbsp;returns&nbsp;the&nbsp;extended&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="2384273">func</span>&nbsp;<span class="ident" id="2384278">AppendQuoteToASCII</span><span class="op" id="2384296">(</span><span class="ident" id="2384297">dst</span>&nbsp;<span class="op" id="2384301">[</span><span class="op" id="2384302">]</span><span class="builtintype" id="2384303">byte</span><span class="op" id="2384307">,</span>&nbsp;<span class="ident" id="2384309">s</span>&nbsp;<span class="builtintype" id="2384311">string</span><span class="op" id="2384317">)</span>&nbsp;<span class="op" id="2384319">[</span><span class="op" id="2384320">]</span><span class="builtintype" id="2384321">byte</span>&nbsp;<span class="op" id="2384326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2384329">return</span>&nbsp;<span class="builtinfunc" id="2384336">append</span><span class="op" id="2384342">(</span><span class="ident" id="2384343">dst</span><span class="op" id="2384346">,</span>&nbsp;<span class="ident" id="2384348">QuoteToASCII</span><span class="op" id="2384360">(</span><span class="ident" id="2384361">s</span><span class="op" id="2384362">)</span><span class="op" id="2384363">...</span><span class="op" id="2384366">)</span><br>
<span class="lineno"></span><span class="op" id="2384368">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="comment" id="2384371">//&nbsp;QuoteRune&nbsp;returns&nbsp;a&nbsp;single-quoted&nbsp;Go&nbsp;character&nbsp;literal&nbsp;representing&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2384446">//&nbsp;rune.&nbsp;&nbsp;The&nbsp;returned&nbsp;string&nbsp;uses&nbsp;Go&nbsp;escape&nbsp;sequences&nbsp;(\t,&nbsp;\n,&nbsp;\xFF,&nbsp;\u0100)</span><br>
<span class="lineno"></span><span class="comment" id="2384524">//&nbsp;for&nbsp;control&nbsp;characters&nbsp;and&nbsp;non-printable&nbsp;characters&nbsp;as&nbsp;defined&nbsp;by&nbsp;IsPrint.</span><br>
<span class="lineno"></span><span class="keyword" id="2384602">func</span>&nbsp;<span class="ident" id="2384607">QuoteRune</span><span class="op" id="2384616">(</span><span class="ident" id="2384617">r</span>&nbsp;<span class="builtintype" id="2384619">rune</span><span class="op" id="2384623">)</span>&nbsp;<span class="builtintype" id="2384625">string</span>&nbsp;<span class="op" id="2384632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2384635">//&nbsp;TODO:&nbsp;avoid&nbsp;the&nbsp;allocation&nbsp;here.</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2384672">return</span>&nbsp;<span class="ident" id="2384679">quoteWith</span><span class="op" id="2384688">(</span><span class="builtintype" id="2384689">string</span><span class="op" id="2384695">(</span><span class="ident" id="2384696">r</span><span class="op" id="2384697">)</span><span class="op" id="2384698">,</span>&nbsp;<span class="string" id="2384700">&#39;\&#39;&#39;</span><span class="op" id="2384704">,</span>&nbsp;<span class="builtintype" id="2384706">false</span><span class="op" id="2384711">)</span><br>
<span class="lineno"></span><span class="op" id="2384713">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2384716">//&nbsp;AppendQuoteRune&nbsp;appends&nbsp;a&nbsp;single-quoted&nbsp;Go&nbsp;character&nbsp;literal&nbsp;representing&nbsp;the&nbsp;rune,</span><br>
<span class="lineno"></span><span class="comment" id="2384803">//&nbsp;as&nbsp;generated&nbsp;by&nbsp;QuoteRune,&nbsp;to&nbsp;dst&nbsp;and&nbsp;returns&nbsp;the&nbsp;extended&nbsp;buffer.</span><br>
<span class="lineno">125</span><span class="keyword" id="2384873">func</span>&nbsp;<span class="ident" id="2384878">AppendQuoteRune</span><span class="op" id="2384893">(</span><span class="ident" id="2384894">dst</span>&nbsp;<span class="op" id="2384898">[</span><span class="op" id="2384899">]</span><span class="builtintype" id="2384900">byte</span><span class="op" id="2384904">,</span>&nbsp;<span class="ident" id="2384906">r</span>&nbsp;<span class="builtintype" id="2384908">rune</span><span class="op" id="2384912">)</span>&nbsp;<span class="op" id="2384914">[</span><span class="op" id="2384915">]</span><span class="builtintype" id="2384916">byte</span>&nbsp;<span class="op" id="2384921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2384924">return</span>&nbsp;<span class="builtinfunc" id="2384931">append</span><span class="op" id="2384937">(</span><span class="ident" id="2384938">dst</span><span class="op" id="2384941">,</span>&nbsp;<span class="ident" id="2384943">QuoteRune</span><span class="op" id="2384952">(</span><span class="ident" id="2384953">r</span><span class="op" id="2384954">)</span><span class="op" id="2384955">...</span><span class="op" id="2384958">)</span><br>
<span class="lineno"></span><span class="op" id="2384960">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2384963">//&nbsp;QuoteRuneToASCII&nbsp;returns&nbsp;a&nbsp;single-quoted&nbsp;Go&nbsp;character&nbsp;literal&nbsp;representing</span><br>
<span class="lineno">130</span><span class="comment" id="2385041">//&nbsp;the&nbsp;rune.&nbsp;&nbsp;The&nbsp;returned&nbsp;string&nbsp;uses&nbsp;Go&nbsp;escape&nbsp;sequences&nbsp;(\t,&nbsp;\n,&nbsp;\xFF,</span><br>
<span class="lineno"></span><span class="comment" id="2385115">//&nbsp;\u0100)&nbsp;for&nbsp;non-ASCII&nbsp;characters&nbsp;and&nbsp;non-printable&nbsp;characters&nbsp;as&nbsp;defined</span><br>
<span class="lineno"></span><span class="comment" id="2385191">//&nbsp;by&nbsp;IsPrint.</span><br>
<span class="lineno"></span><span class="keyword" id="2385206">func</span>&nbsp;<span class="ident" id="2385211">QuoteRuneToASCII</span><span class="op" id="2385227">(</span><span class="ident" id="2385228">r</span>&nbsp;<span class="builtintype" id="2385230">rune</span><span class="op" id="2385234">)</span>&nbsp;<span class="builtintype" id="2385236">string</span>&nbsp;<span class="op" id="2385243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2385246">//&nbsp;TODO:&nbsp;avoid&nbsp;the&nbsp;allocation&nbsp;here.</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2385283">return</span>&nbsp;<span class="ident" id="2385290">quoteWith</span><span class="op" id="2385299">(</span><span class="builtintype" id="2385300">string</span><span class="op" id="2385306">(</span><span class="ident" id="2385307">r</span><span class="op" id="2385308">)</span><span class="op" id="2385309">,</span>&nbsp;<span class="string" id="2385311">&#39;\&#39;&#39;</span><span class="op" id="2385315">,</span>&nbsp;<span class="builtintype" id="2385317">true</span><span class="op" id="2385321">)</span><br>
<span class="lineno"></span><span class="op" id="2385323">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2385326">//&nbsp;AppendQuoteRuneToASCII&nbsp;appends&nbsp;a&nbsp;single-quoted&nbsp;Go&nbsp;character&nbsp;literal&nbsp;representing&nbsp;the&nbsp;rune,</span><br>
<span class="lineno"></span><span class="comment" id="2385420">//&nbsp;as&nbsp;generated&nbsp;by&nbsp;QuoteRuneToASCII,&nbsp;to&nbsp;dst&nbsp;and&nbsp;returns&nbsp;the&nbsp;extended&nbsp;buffer.</span><br>
<span class="lineno">140</span><span class="keyword" id="2385497">func</span>&nbsp;<span class="ident" id="2385502">AppendQuoteRuneToASCII</span><span class="op" id="2385524">(</span><span class="ident" id="2385525">dst</span>&nbsp;<span class="op" id="2385529">[</span><span class="op" id="2385530">]</span><span class="builtintype" id="2385531">byte</span><span class="op" id="2385535">,</span>&nbsp;<span class="ident" id="2385537">r</span>&nbsp;<span class="builtintype" id="2385539">rune</span><span class="op" id="2385543">)</span>&nbsp;<span class="op" id="2385545">[</span><span class="op" id="2385546">]</span><span class="builtintype" id="2385547">byte</span>&nbsp;<span class="op" id="2385552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2385555">return</span>&nbsp;<span class="builtinfunc" id="2385562">append</span><span class="op" id="2385568">(</span><span class="ident" id="2385569">dst</span><span class="op" id="2385572">,</span>&nbsp;<span class="ident" id="2385574">QuoteRuneToASCII</span><span class="op" id="2385590">(</span><span class="ident" id="2385591">r</span><span class="op" id="2385592">)</span><span class="op" id="2385593">...</span><span class="op" id="2385596">)</span><br>
<span class="lineno"></span><span class="op" id="2385598">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2385601">//&nbsp;CanBackquote&nbsp;reports&nbsp;whether&nbsp;the&nbsp;string&nbsp;s&nbsp;can&nbsp;be&nbsp;represented</span><br>
<span class="lineno">145</span><span class="comment" id="2385665">//&nbsp;unchanged&nbsp;as&nbsp;a&nbsp;single-line&nbsp;backquoted&nbsp;string&nbsp;without&nbsp;control</span><br>
<span class="lineno"></span><span class="comment" id="2385729">//&nbsp;characters&nbsp;other&nbsp;than&nbsp;tab.</span><br>
<span class="lineno"></span><span class="keyword" id="2385759">func</span>&nbsp;<span class="ident" id="2385764">CanBackquote</span><span class="op" id="2385776">(</span><span class="ident" id="2385777">s</span>&nbsp;<span class="builtintype" id="2385779">string</span><span class="op" id="2385785">)</span>&nbsp;<span class="builtintype" id="2385787">bool</span>&nbsp;<span class="op" id="2385792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2385795">for</span>&nbsp;<span class="builtinfunc" id="2385799">len</span><span class="op" id="2385802">(</span><span class="ident" id="2385803">s</span><span class="op" id="2385804">)</span>&nbsp;<span class="op" id="2385806">&gt;</span>&nbsp;<span class="num" id="2385808">0</span>&nbsp;<span class="op" id="2385810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2385814">r</span><span class="op" id="2385815">,</span>&nbsp;<span class="ident" id="2385817">wid</span>&nbsp;<span class="op" id="2385821">:=</span>&nbsp;<span class="ident" id="2385824">utf8</span><span class="op" id="2385828">.</span><span class="ident" id="2385829">DecodeRuneInString</span><span class="op" id="2385847">(</span><span class="ident" id="2385848">s</span><span class="op" id="2385849">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2385853">s</span>&nbsp;<span class="op" id="2385855">=</span>&nbsp;<span class="ident" id="2385857">s</span><span class="op" id="2385858">[</span><span class="ident" id="2385859">wid</span><span class="op" id="2385862">:</span><span class="op" id="2385863">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2385867">if</span>&nbsp;<span class="ident" id="2385870">wid</span>&nbsp;<span class="op" id="2385874">&gt;</span>&nbsp;<span class="num" id="2385876">1</span>&nbsp;<span class="op" id="2385878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2385883">if</span>&nbsp;<span class="ident" id="2385886">r</span>&nbsp;<span class="op" id="2385888">==</span>&nbsp;<span class="string" id="2385891">&#39;\ufeff&#39;</span>&nbsp;<span class="op" id="2385900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2385906">return</span>&nbsp;<span class="builtintype" id="2385913">false</span>&nbsp;<span class="comment" id="2385919">//&nbsp;BOMs&nbsp;are&nbsp;invisible&nbsp;and&nbsp;should&nbsp;not&nbsp;be&nbsp;quoted.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2385970">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2385975">continue</span>&nbsp;<span class="comment" id="2385984">//&nbsp;All&nbsp;other&nbsp;multibyte&nbsp;runes&nbsp;are&nbsp;correctly&nbsp;encoded&nbsp;and&nbsp;assumed&nbsp;printable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2386060">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2386064">if</span>&nbsp;<span class="ident" id="2386067">r</span>&nbsp;<span class="op" id="2386069">==</span>&nbsp;<span class="ident" id="2386072">utf8</span><span class="op" id="2386076">.</span><span class="ident" id="2386077">RuneError</span>&nbsp;<span class="op" id="2386087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2386092">return</span>&nbsp;<span class="builtintype" id="2386099">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2386107">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2386111">if</span>&nbsp;<span class="op" id="2386114">(</span><span class="ident" id="2386115">r</span>&nbsp;<span class="op" id="2386117">&lt;</span>&nbsp;<span class="string" id="2386119">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="2386123">&amp;&amp;</span>&nbsp;<span class="ident" id="2386126">r</span>&nbsp;<span class="op" id="2386128">!=</span>&nbsp;<span class="string" id="2386131">&#39;\t&#39;</span><span class="op" id="2386135">)</span>&nbsp;<span class="op" id="2386137">||</span>&nbsp;<span class="ident" id="2386140">r</span>&nbsp;<span class="op" id="2386142">==</span>&nbsp;<span class="string" id="2386145">&#39;`&#39;</span>&nbsp;<span class="op" id="2386149">||</span>&nbsp;<span class="ident" id="2386152">r</span>&nbsp;<span class="op" id="2386154">==</span>&nbsp;<span class="string" id="2386157">&#39;\u007F&#39;</span>&nbsp;<span class="op" id="2386166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2386171">return</span>&nbsp;<span class="builtintype" id="2386178">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2386186">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2386189">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2386192">return</span>&nbsp;<span class="builtintype" id="2386199">true</span><br>
<span class="lineno">165</span><span class="op" id="2386204">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2386207">func</span>&nbsp;<span class="ident" id="2386212">unhex</span><span class="op" id="2386217">(</span><span class="ident" id="2386218">b</span>&nbsp;<span class="builtintype" id="2386220">byte</span><span class="op" id="2386224">)</span>&nbsp;<span class="op" id="2386226">(</span><span class="ident" id="2386227">v</span>&nbsp;<span class="builtintype" id="2386229">rune</span><span class="op" id="2386233">,</span>&nbsp;<span class="ident" id="2386235">ok</span>&nbsp;<span class="builtintype" id="2386238">bool</span><span class="op" id="2386242">)</span>&nbsp;<span class="op" id="2386244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2386247">c</span>&nbsp;<span class="op" id="2386249">:=</span>&nbsp;<span class="builtintype" id="2386252">rune</span><span class="op" id="2386256">(</span><span class="ident" id="2386257">b</span><span class="op" id="2386258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2386261">switch</span>&nbsp;<span class="op" id="2386268">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2386271">case</span>&nbsp;<span class="string" id="2386276">&#39;0&#39;</span>&nbsp;<span class="op" id="2386280">&lt;=</span>&nbsp;<span class="ident" id="2386283">c</span>&nbsp;<span class="op" id="2386285">&amp;&amp;</span>&nbsp;<span class="ident" id="2386288">c</span>&nbsp;<span class="op" id="2386290">&lt;=</span>&nbsp;<span class="string" id="2386293">&#39;9&#39;</span><span class="op" id="2386296">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2386300">return</span>&nbsp;<span class="ident" id="2386307">c</span>&nbsp;<span class="op" id="2386309">-</span>&nbsp;<span class="string" id="2386311">&#39;0&#39;</span><span class="op" id="2386314">,</span>&nbsp;<span class="builtintype" id="2386316">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2386322">case</span>&nbsp;<span class="string" id="2386327">&#39;a&#39;</span>&nbsp;<span class="op" id="2386331">&lt;=</span>&nbsp;<span class="ident" id="2386334">c</span>&nbsp;<span class="op" id="2386336">&amp;&amp;</span>&nbsp;<span class="ident" id="2386339">c</span>&nbsp;<span class="op" id="2386341">&lt;=</span>&nbsp;<span class="string" id="2386344">&#39;f&#39;</span><span class="op" id="2386347">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2386351">return</span>&nbsp;<span class="ident" id="2386358">c</span>&nbsp;<span class="op" id="2386360">-</span>&nbsp;<span class="string" id="2386362">&#39;a&#39;</span>&nbsp;<span class="op" id="2386366">+</span>&nbsp;<span class="num" id="2386368">10</span><span class="op" id="2386370">,</span>&nbsp;<span class="builtintype" id="2386372">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2386378">case</span>&nbsp;<span class="string" id="2386383">&#39;A&#39;</span>&nbsp;<span class="op" id="2386387">&lt;=</span>&nbsp;<span class="ident" id="2386390">c</span>&nbsp;<span class="op" id="2386392">&amp;&amp;</span>&nbsp;<span class="ident" id="2386395">c</span>&nbsp;<span class="op" id="2386397">&lt;=</span>&nbsp;<span class="string" id="2386400">&#39;F&#39;</span><span class="op" id="2386403">:</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2386407">return</span>&nbsp;<span class="ident" id="2386414">c</span>&nbsp;<span class="op" id="2386416">-</span>&nbsp;<span class="string" id="2386418">&#39;A&#39;</span>&nbsp;<span class="op" id="2386422">+</span>&nbsp;<span class="num" id="2386424">10</span><span class="op" id="2386426">,</span>&nbsp;<span class="builtintype" id="2386428">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2386434">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2386437">return</span><br>
<span class="lineno"></span><span class="op" id="2386444">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="comment" id="2386447">//&nbsp;UnquoteChar&nbsp;decodes&nbsp;the&nbsp;first&nbsp;character&nbsp;or&nbsp;byte&nbsp;in&nbsp;the&nbsp;escaped&nbsp;string</span><br>
<span class="lineno"></span><span class="comment" id="2386520">//&nbsp;or&nbsp;character&nbsp;literal&nbsp;represented&nbsp;by&nbsp;the&nbsp;string&nbsp;s.</span><br>
<span class="lineno"></span><span class="comment" id="2386573">//&nbsp;It&nbsp;returns&nbsp;four&nbsp;values:</span><br>
<span class="lineno"></span><span class="comment" id="2386600">//</span><br>
<span class="lineno"></span><span class="comment" id="2386603">//&nbsp;&nbsp;&nbsp;&nbsp;1)&nbsp;value,&nbsp;the&nbsp;decoded&nbsp;Unicode&nbsp;code&nbsp;point&nbsp;or&nbsp;byte&nbsp;value;</span><br>
<span class="lineno">185</span><span class="comment" id="2386662">//&nbsp;&nbsp;&nbsp;&nbsp;2)&nbsp;multibyte,&nbsp;a&nbsp;boolean&nbsp;indicating&nbsp;whether&nbsp;the&nbsp;decoded&nbsp;character&nbsp;requires&nbsp;a&nbsp;multibyte&nbsp;UTF-8&nbsp;representation;</span><br>
<span class="lineno"></span><span class="comment" id="2386773">//&nbsp;&nbsp;&nbsp;&nbsp;3)&nbsp;tail,&nbsp;the&nbsp;remainder&nbsp;of&nbsp;the&nbsp;string&nbsp;after&nbsp;the&nbsp;character;&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="2386838">//&nbsp;&nbsp;&nbsp;&nbsp;4)&nbsp;an&nbsp;error&nbsp;that&nbsp;will&nbsp;be&nbsp;nil&nbsp;if&nbsp;the&nbsp;character&nbsp;is&nbsp;syntactically&nbsp;valid.</span><br>
<span class="lineno"></span><span class="comment" id="2386911">//</span><br>
<span class="lineno"></span><span class="comment" id="2386914">//&nbsp;The&nbsp;second&nbsp;argument,&nbsp;quote,&nbsp;specifies&nbsp;the&nbsp;type&nbsp;of&nbsp;literal&nbsp;being&nbsp;parsed</span><br>
<span class="lineno">190</span><span class="comment" id="2386988">//&nbsp;and&nbsp;therefore&nbsp;which&nbsp;escaped&nbsp;quote&nbsp;character&nbsp;is&nbsp;permitted.</span><br>
<span class="lineno"></span><span class="comment" id="2387049">//&nbsp;If&nbsp;set&nbsp;to&nbsp;a&nbsp;single&nbsp;quote,&nbsp;it&nbsp;permits&nbsp;the&nbsp;sequence&nbsp;\&#39;&nbsp;and&nbsp;disallows&nbsp;unescaped&nbsp;&#39;.</span><br>
<span class="lineno"></span><span class="comment" id="2387132">//&nbsp;If&nbsp;set&nbsp;to&nbsp;a&nbsp;double&nbsp;quote,&nbsp;it&nbsp;permits&nbsp;\&#34;&nbsp;and&nbsp;disallows&nbsp;unescaped&nbsp;&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="2387202">//&nbsp;If&nbsp;set&nbsp;to&nbsp;zero,&nbsp;it&nbsp;does&nbsp;not&nbsp;permit&nbsp;either&nbsp;escape&nbsp;and&nbsp;allows&nbsp;both&nbsp;quote&nbsp;characters&nbsp;to&nbsp;appear&nbsp;unescaped.</span><br>
<span class="lineno"></span><span class="keyword" id="2387308">func</span>&nbsp;<span class="ident" id="2387313">UnquoteChar</span><span class="op" id="2387324">(</span><span class="ident" id="2387325">s</span>&nbsp;<span class="builtintype" id="2387327">string</span><span class="op" id="2387333">,</span>&nbsp;<span class="ident" id="2387335">quote</span>&nbsp;<span class="builtintype" id="2387341">byte</span><span class="op" id="2387345">)</span>&nbsp;<span class="op" id="2387347">(</span><span class="ident" id="2387348">value</span>&nbsp;<span class="builtintype" id="2387354">rune</span><span class="op" id="2387358">,</span>&nbsp;<span class="ident" id="2387360">multibyte</span>&nbsp;<span class="builtintype" id="2387370">bool</span><span class="op" id="2387374">,</span>&nbsp;<span class="ident" id="2387376">tail</span>&nbsp;<span class="builtintype" id="2387381">string</span><span class="op" id="2387387">,</span>&nbsp;<span class="ident" id="2387389">err</span>&nbsp;<span class="builtintype" id="2387393">error</span><span class="op" id="2387398">)</span>&nbsp;<span class="op" id="2387400">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2387403">//&nbsp;easy&nbsp;cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2387418">switch</span>&nbsp;<span class="ident" id="2387425">c</span>&nbsp;<span class="op" id="2387427">:=</span>&nbsp;<span class="ident" id="2387430">s</span><span class="op" id="2387431">[</span><span class="num" id="2387432">0</span><span class="op" id="2387433">]</span><span class="op" id="2387434">;</span>&nbsp;<span class="op" id="2387436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2387439">case</span>&nbsp;<span class="ident" id="2387444">c</span>&nbsp;<span class="op" id="2387446">==</span>&nbsp;<span class="ident" id="2387449">quote</span>&nbsp;<span class="op" id="2387455">&amp;&amp;</span>&nbsp;<span class="op" id="2387458">(</span><span class="ident" id="2387459">quote</span>&nbsp;<span class="op" id="2387465">==</span>&nbsp;<span class="string" id="2387468">&#39;\&#39;&#39;</span>&nbsp;<span class="op" id="2387473">||</span>&nbsp;<span class="ident" id="2387476">quote</span>&nbsp;<span class="op" id="2387482">==</span>&nbsp;<span class="string" id="2387485">&#39;&#34;&#39;</span><span class="op" id="2387488">)</span><span class="op" id="2387489">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2387493">err</span>&nbsp;<span class="op" id="2387497">=</span>&nbsp;<span class="ident" id="2387499">ErrSyntax</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2387511">return</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2387519">case</span>&nbsp;<span class="ident" id="2387524">c</span>&nbsp;<span class="op" id="2387526">&gt;=</span>&nbsp;<span class="ident" id="2387529">utf8</span><span class="op" id="2387533">.</span><span class="ident" id="2387534">RuneSelf</span><span class="op" id="2387542">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2387546">r</span><span class="op" id="2387547">,</span>&nbsp;<span class="ident" id="2387549">size</span>&nbsp;<span class="op" id="2387554">:=</span>&nbsp;<span class="ident" id="2387557">utf8</span><span class="op" id="2387561">.</span><span class="ident" id="2387562">DecodeRuneInString</span><span class="op" id="2387580">(</span><span class="ident" id="2387581">s</span><span class="op" id="2387582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2387586">return</span>&nbsp;<span class="ident" id="2387593">r</span><span class="op" id="2387594">,</span>&nbsp;<span class="builtintype" id="2387596">true</span><span class="op" id="2387600">,</span>&nbsp;<span class="ident" id="2387602">s</span><span class="op" id="2387603">[</span><span class="ident" id="2387604">size</span><span class="op" id="2387608">:</span><span class="op" id="2387609">]</span><span class="op" id="2387610">,</span>&nbsp;<span class="ident" id="2387612">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2387617">case</span>&nbsp;<span class="ident" id="2387622">c</span>&nbsp;<span class="op" id="2387624">!=</span>&nbsp;<span class="string" id="2387627">&#39;\\&#39;</span><span class="op" id="2387631">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2387635">return</span>&nbsp;<span class="builtintype" id="2387642">rune</span><span class="op" id="2387646">(</span><span class="ident" id="2387647">s</span><span class="op" id="2387648">[</span><span class="num" id="2387649">0</span><span class="op" id="2387650">]</span><span class="op" id="2387651">)</span><span class="op" id="2387652">,</span>&nbsp;<span class="builtintype" id="2387654">false</span><span class="op" id="2387659">,</span>&nbsp;<span class="ident" id="2387661">s</span><span class="op" id="2387662">[</span><span class="num" id="2387663">1</span><span class="op" id="2387664">:</span><span class="op" id="2387665">]</span><span class="op" id="2387666">,</span>&nbsp;<span class="ident" id="2387668">nil</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2387673">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2387677">//&nbsp;hard&nbsp;case:&nbsp;c&nbsp;is&nbsp;backslash</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2387707">if</span>&nbsp;<span class="builtinfunc" id="2387710">len</span><span class="op" id="2387713">(</span><span class="ident" id="2387714">s</span><span class="op" id="2387715">)</span>&nbsp;<span class="op" id="2387717">&lt;=</span>&nbsp;<span class="num" id="2387720">1</span>&nbsp;<span class="op" id="2387722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2387726">err</span>&nbsp;<span class="op" id="2387730">=</span>&nbsp;<span class="ident" id="2387732">ErrSyntax</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2387744">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2387752">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2387755">c</span>&nbsp;<span class="op" id="2387757">:=</span>&nbsp;<span class="ident" id="2387760">s</span><span class="op" id="2387761">[</span><span class="num" id="2387762">1</span><span class="op" id="2387763">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2387766">s</span>&nbsp;<span class="op" id="2387768">=</span>&nbsp;<span class="ident" id="2387770">s</span><span class="op" id="2387771">[</span><span class="num" id="2387772">2</span><span class="op" id="2387773">:</span><span class="op" id="2387774">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2387778">switch</span>&nbsp;<span class="ident" id="2387785">c</span>&nbsp;<span class="op" id="2387787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2387790">case</span>&nbsp;<span class="string" id="2387795">&#39;a&#39;</span><span class="op" id="2387798">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2387802">value</span>&nbsp;<span class="op" id="2387808">=</span>&nbsp;<span class="string" id="2387810">&#39;\a&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2387816">case</span>&nbsp;<span class="string" id="2387821">&#39;b&#39;</span><span class="op" id="2387824">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2387828">value</span>&nbsp;<span class="op" id="2387834">=</span>&nbsp;<span class="string" id="2387836">&#39;\b&#39;</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2387842">case</span>&nbsp;<span class="string" id="2387847">&#39;f&#39;</span><span class="op" id="2387850">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2387854">value</span>&nbsp;<span class="op" id="2387860">=</span>&nbsp;<span class="string" id="2387862">&#39;\f&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2387868">case</span>&nbsp;<span class="string" id="2387873">&#39;n&#39;</span><span class="op" id="2387876">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2387880">value</span>&nbsp;<span class="op" id="2387886">=</span>&nbsp;<span class="string" id="2387888">&#39;\n&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2387894">case</span>&nbsp;<span class="string" id="2387899">&#39;r&#39;</span><span class="op" id="2387902">:</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2387906">value</span>&nbsp;<span class="op" id="2387912">=</span>&nbsp;<span class="string" id="2387914">&#39;\r&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2387920">case</span>&nbsp;<span class="string" id="2387925">&#39;t&#39;</span><span class="op" id="2387928">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2387932">value</span>&nbsp;<span class="op" id="2387938">=</span>&nbsp;<span class="string" id="2387940">&#39;\t&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2387946">case</span>&nbsp;<span class="string" id="2387951">&#39;v&#39;</span><span class="op" id="2387954">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2387958">value</span>&nbsp;<span class="op" id="2387964">=</span>&nbsp;<span class="string" id="2387966">&#39;\v&#39;</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2387972">case</span>&nbsp;<span class="string" id="2387977">&#39;x&#39;</span><span class="op" id="2387980">,</span>&nbsp;<span class="string" id="2387982">&#39;u&#39;</span><span class="op" id="2387985">,</span>&nbsp;<span class="string" id="2387987">&#39;U&#39;</span><span class="op" id="2387990">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2387994">n</span>&nbsp;<span class="op" id="2387996">:=</span>&nbsp;<span class="num" id="2387999">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2388003">switch</span>&nbsp;<span class="ident" id="2388010">c</span>&nbsp;<span class="op" id="2388012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2388016">case</span>&nbsp;<span class="string" id="2388021">&#39;x&#39;</span><span class="op" id="2388024">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2388029">n</span>&nbsp;<span class="op" id="2388031">=</span>&nbsp;<span class="num" id="2388033">2</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2388037">case</span>&nbsp;<span class="string" id="2388042">&#39;u&#39;</span><span class="op" id="2388045">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2388050">n</span>&nbsp;<span class="op" id="2388052">=</span>&nbsp;<span class="num" id="2388054">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2388058">case</span>&nbsp;<span class="string" id="2388063">&#39;U&#39;</span><span class="op" id="2388066">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2388071">n</span>&nbsp;<span class="op" id="2388073">=</span>&nbsp;<span class="num" id="2388075">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2388079">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2388083">var</span>&nbsp;<span class="ident" id="2388087">v</span>&nbsp;<span class="builtintype" id="2388089">rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2388096">if</span>&nbsp;<span class="builtinfunc" id="2388099">len</span><span class="op" id="2388102">(</span><span class="ident" id="2388103">s</span><span class="op" id="2388104">)</span>&nbsp;<span class="op" id="2388106">&lt;</span>&nbsp;<span class="ident" id="2388108">n</span>&nbsp;<span class="op" id="2388110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2388115">err</span>&nbsp;<span class="op" id="2388119">=</span>&nbsp;<span class="ident" id="2388121">ErrSyntax</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2388134">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2388143">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2388147">for</span>&nbsp;<span class="ident" id="2388151">j</span>&nbsp;<span class="op" id="2388153">:=</span>&nbsp;<span class="num" id="2388156">0</span><span class="op" id="2388157">;</span>&nbsp;<span class="ident" id="2388159">j</span>&nbsp;<span class="op" id="2388161">&lt;</span>&nbsp;<span class="ident" id="2388163">n</span><span class="op" id="2388164">;</span>&nbsp;<span class="ident" id="2388166">j</span><span class="op" id="2388167">++</span>&nbsp;<span class="op" id="2388170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2388175">x</span><span class="op" id="2388176">,</span>&nbsp;<span class="ident" id="2388178">ok</span>&nbsp;<span class="op" id="2388181">:=</span>&nbsp;<span class="ident" id="2388184">unhex</span><span class="op" id="2388189">(</span><span class="ident" id="2388190">s</span><span class="op" id="2388191">[</span><span class="ident" id="2388192">j</span><span class="op" id="2388193">]</span><span class="op" id="2388194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2388199">if</span>&nbsp;<span class="op" id="2388202">!</span><span class="ident" id="2388203">ok</span>&nbsp;<span class="op" id="2388206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2388212">err</span>&nbsp;<span class="op" id="2388216">=</span>&nbsp;<span class="ident" id="2388218">ErrSyntax</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2388232">return</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2388242">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2388247">v</span>&nbsp;<span class="op" id="2388249">=</span>&nbsp;<span class="ident" id="2388251">v</span><span class="op" id="2388252">&lt;&lt;</span><span class="num" id="2388254">4</span>&nbsp;<span class="op" id="2388256">|</span>&nbsp;<span class="ident" id="2388258">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2388262">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2388266">s</span>&nbsp;<span class="op" id="2388268">=</span>&nbsp;<span class="ident" id="2388270">s</span><span class="op" id="2388271">[</span><span class="ident" id="2388272">n</span><span class="op" id="2388273">:</span><span class="op" id="2388274">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2388278">if</span>&nbsp;<span class="ident" id="2388281">c</span>&nbsp;<span class="op" id="2388283">==</span>&nbsp;<span class="string" id="2388286">&#39;x&#39;</span>&nbsp;<span class="op" id="2388290">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2388295">//&nbsp;single-byte&nbsp;string,&nbsp;possibly&nbsp;not&nbsp;UTF-8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2388340">value</span>&nbsp;<span class="op" id="2388346">=</span>&nbsp;<span class="ident" id="2388348">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2388353">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2388361">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2388365">if</span>&nbsp;<span class="ident" id="2388368">v</span>&nbsp;<span class="op" id="2388370">&gt;</span>&nbsp;<span class="ident" id="2388372">utf8</span><span class="op" id="2388376">.</span><span class="ident" id="2388377">MaxRune</span>&nbsp;<span class="op" id="2388385">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2388390">err</span>&nbsp;<span class="op" id="2388394">=</span>&nbsp;<span class="ident" id="2388396">ErrSyntax</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2388409">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2388418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2388422">value</span>&nbsp;<span class="op" id="2388428">=</span>&nbsp;<span class="ident" id="2388430">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2388434">multibyte</span>&nbsp;<span class="op" id="2388444">=</span>&nbsp;<span class="builtintype" id="2388446">true</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2388452">case</span>&nbsp;<span class="string" id="2388457">&#39;0&#39;</span><span class="op" id="2388460">,</span>&nbsp;<span class="string" id="2388462">&#39;1&#39;</span><span class="op" id="2388465">,</span>&nbsp;<span class="string" id="2388467">&#39;2&#39;</span><span class="op" id="2388470">,</span>&nbsp;<span class="string" id="2388472">&#39;3&#39;</span><span class="op" id="2388475">,</span>&nbsp;<span class="string" id="2388477">&#39;4&#39;</span><span class="op" id="2388480">,</span>&nbsp;<span class="string" id="2388482">&#39;5&#39;</span><span class="op" id="2388485">,</span>&nbsp;<span class="string" id="2388487">&#39;6&#39;</span><span class="op" id="2388490">,</span>&nbsp;<span class="string" id="2388492">&#39;7&#39;</span><span class="op" id="2388495">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2388499">v</span>&nbsp;<span class="op" id="2388501">:=</span>&nbsp;<span class="builtintype" id="2388504">rune</span><span class="op" id="2388508">(</span><span class="ident" id="2388509">c</span><span class="op" id="2388510">)</span>&nbsp;<span class="op" id="2388512">-</span>&nbsp;<span class="string" id="2388514">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2388520">if</span>&nbsp;<span class="builtinfunc" id="2388523">len</span><span class="op" id="2388526">(</span><span class="ident" id="2388527">s</span><span class="op" id="2388528">)</span>&nbsp;<span class="op" id="2388530">&lt;</span>&nbsp;<span class="num" id="2388532">2</span>&nbsp;<span class="op" id="2388534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2388539">err</span>&nbsp;<span class="op" id="2388543">=</span>&nbsp;<span class="ident" id="2388545">ErrSyntax</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2388558">return</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2388567">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2388571">for</span>&nbsp;<span class="ident" id="2388575">j</span>&nbsp;<span class="op" id="2388577">:=</span>&nbsp;<span class="num" id="2388580">0</span><span class="op" id="2388581">;</span>&nbsp;<span class="ident" id="2388583">j</span>&nbsp;<span class="op" id="2388585">&lt;</span>&nbsp;<span class="num" id="2388587">2</span><span class="op" id="2388588">;</span>&nbsp;<span class="ident" id="2388590">j</span><span class="op" id="2388591">++</span>&nbsp;<span class="op" id="2388594">{</span>&nbsp;<span class="comment" id="2388596">//&nbsp;one&nbsp;digit&nbsp;already;&nbsp;two&nbsp;more</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2388630">x</span>&nbsp;<span class="op" id="2388632">:=</span>&nbsp;<span class="builtintype" id="2388635">rune</span><span class="op" id="2388639">(</span><span class="ident" id="2388640">s</span><span class="op" id="2388641">[</span><span class="ident" id="2388642">j</span><span class="op" id="2388643">]</span><span class="op" id="2388644">)</span>&nbsp;<span class="op" id="2388646">-</span>&nbsp;<span class="string" id="2388648">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2388655">if</span>&nbsp;<span class="ident" id="2388658">x</span>&nbsp;<span class="op" id="2388660">&lt;</span>&nbsp;<span class="num" id="2388662">0</span>&nbsp;<span class="op" id="2388664">||</span>&nbsp;<span class="ident" id="2388667">x</span>&nbsp;<span class="op" id="2388669">&gt;</span>&nbsp;<span class="num" id="2388671">7</span>&nbsp;<span class="op" id="2388673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2388679">err</span>&nbsp;<span class="op" id="2388683">=</span>&nbsp;<span class="ident" id="2388685">ErrSyntax</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2388699">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2388709">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2388714">v</span>&nbsp;<span class="op" id="2388716">=</span>&nbsp;<span class="op" id="2388718">(</span><span class="ident" id="2388719">v</span>&nbsp;<span class="op" id="2388721">&lt;&lt;</span>&nbsp;<span class="num" id="2388724">3</span><span class="op" id="2388725">)</span>&nbsp;<span class="op" id="2388727">|</span>&nbsp;<span class="ident" id="2388729">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2388733">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2388737">s</span>&nbsp;<span class="op" id="2388739">=</span>&nbsp;<span class="ident" id="2388741">s</span><span class="op" id="2388742">[</span><span class="num" id="2388743">2</span><span class="op" id="2388744">:</span><span class="op" id="2388745">]</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2388749">if</span>&nbsp;<span class="ident" id="2388752">v</span>&nbsp;<span class="op" id="2388754">&gt;</span>&nbsp;<span class="num" id="2388756">255</span>&nbsp;<span class="op" id="2388760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2388765">err</span>&nbsp;<span class="op" id="2388769">=</span>&nbsp;<span class="ident" id="2388771">ErrSyntax</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2388784">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2388793">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2388797">value</span>&nbsp;<span class="op" id="2388803">=</span>&nbsp;<span class="ident" id="2388805">v</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2388808">case</span>&nbsp;<span class="string" id="2388813">&#39;\\&#39;</span><span class="op" id="2388817">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2388821">value</span>&nbsp;<span class="op" id="2388827">=</span>&nbsp;<span class="string" id="2388829">&#39;\\&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2388835">case</span>&nbsp;<span class="string" id="2388840">&#39;\&#39;&#39;</span><span class="op" id="2388844">,</span>&nbsp;<span class="string" id="2388846">&#39;&#34;&#39;</span><span class="op" id="2388849">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2388853">if</span>&nbsp;<span class="ident" id="2388856">c</span>&nbsp;<span class="op" id="2388858">!=</span>&nbsp;<span class="ident" id="2388861">quote</span>&nbsp;<span class="op" id="2388867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2388872">err</span>&nbsp;<span class="op" id="2388876">=</span>&nbsp;<span class="ident" id="2388878">ErrSyntax</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2388891">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2388900">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2388904">value</span>&nbsp;<span class="op" id="2388910">=</span>&nbsp;<span class="builtintype" id="2388912">rune</span><span class="op" id="2388916">(</span><span class="ident" id="2388917">c</span><span class="op" id="2388918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2388921">default</span><span class="op" id="2388928">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2388932">err</span>&nbsp;<span class="op" id="2388936">=</span>&nbsp;<span class="ident" id="2388938">ErrSyntax</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2388950">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2388958">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2388961">tail</span>&nbsp;<span class="op" id="2388966">=</span>&nbsp;<span class="ident" id="2388968">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2388971">return</span><br>
<span class="lineno"></span><span class="op" id="2388978">}</span><br>
<span class="lineno">300</span><br>
<span class="lineno"></span><span class="comment" id="2388981">//&nbsp;Unquote&nbsp;interprets&nbsp;s&nbsp;as&nbsp;a&nbsp;single-quoted,&nbsp;double-quoted,</span><br>
<span class="lineno"></span><span class="comment" id="2389040">//&nbsp;or&nbsp;backquoted&nbsp;Go&nbsp;string&nbsp;literal,&nbsp;returning&nbsp;the&nbsp;string&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="2389103">//&nbsp;that&nbsp;s&nbsp;quotes.&nbsp;&nbsp;(If&nbsp;s&nbsp;is&nbsp;single-quoted,&nbsp;it&nbsp;would&nbsp;be&nbsp;a&nbsp;Go</span><br>
<span class="lineno"></span><span class="comment" id="2389163">//&nbsp;character&nbsp;literal;&nbsp;Unquote&nbsp;returns&nbsp;the&nbsp;corresponding</span><br>
<span class="lineno">305</span><span class="comment" id="2389219">//&nbsp;one-character&nbsp;string.)</span><br>
<span class="lineno"></span><span class="keyword" id="2389245">func</span>&nbsp;<span class="ident" id="2389250">Unquote</span><span class="op" id="2389257">(</span><span class="ident" id="2389258">s</span>&nbsp;<span class="builtintype" id="2389260">string</span><span class="op" id="2389266">)</span>&nbsp;<span class="op" id="2389268">(</span><span class="ident" id="2389269">t</span>&nbsp;<span class="builtintype" id="2389271">string</span><span class="op" id="2389277">,</span>&nbsp;<span class="ident" id="2389279">err</span>&nbsp;<span class="builtintype" id="2389283">error</span><span class="op" id="2389288">)</span>&nbsp;<span class="op" id="2389290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2389293">n</span>&nbsp;<span class="op" id="2389295">:=</span>&nbsp;<span class="builtinfunc" id="2389298">len</span><span class="op" id="2389301">(</span><span class="ident" id="2389302">s</span><span class="op" id="2389303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2389306">if</span>&nbsp;<span class="ident" id="2389309">n</span>&nbsp;<span class="op" id="2389311">&lt;</span>&nbsp;<span class="num" id="2389313">2</span>&nbsp;<span class="op" id="2389315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2389319">return</span>&nbsp;<span class="string" id="2389326">&#34;&#34;</span><span class="op" id="2389328">,</span>&nbsp;<span class="ident" id="2389330">ErrSyntax</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2389341">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2389344">quote</span>&nbsp;<span class="op" id="2389350">:=</span>&nbsp;<span class="ident" id="2389353">s</span><span class="op" id="2389354">[</span><span class="num" id="2389355">0</span><span class="op" id="2389356">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2389359">if</span>&nbsp;<span class="ident" id="2389362">quote</span>&nbsp;<span class="op" id="2389368">!=</span>&nbsp;<span class="ident" id="2389371">s</span><span class="op" id="2389372">[</span><span class="ident" id="2389373">n</span><span class="op" id="2389374">-</span><span class="num" id="2389375">1</span><span class="op" id="2389376">]</span>&nbsp;<span class="op" id="2389378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2389382">return</span>&nbsp;<span class="string" id="2389389">&#34;&#34;</span><span class="op" id="2389391">,</span>&nbsp;<span class="ident" id="2389393">ErrSyntax</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2389404">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2389407">s</span>&nbsp;<span class="op" id="2389409">=</span>&nbsp;<span class="ident" id="2389411">s</span><span class="op" id="2389412">[</span><span class="num" id="2389413">1</span>&nbsp;<span class="op" id="2389415">:</span>&nbsp;<span class="ident" id="2389417">n</span><span class="op" id="2389418">-</span><span class="num" id="2389419">1</span><span class="op" id="2389420">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2389424">if</span>&nbsp;<span class="ident" id="2389427">quote</span>&nbsp;<span class="op" id="2389433">==</span>&nbsp;<span class="string" id="2389436">&#39;`&#39;</span>&nbsp;<span class="op" id="2389440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2389444">if</span>&nbsp;<span class="ident" id="2389447">contains</span><span class="op" id="2389455">(</span><span class="ident" id="2389456">s</span><span class="op" id="2389457">,</span>&nbsp;<span class="string" id="2389459">&#39;`&#39;</span><span class="op" id="2389462">)</span>&nbsp;<span class="op" id="2389464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2389469">return</span>&nbsp;<span class="string" id="2389476">&#34;&#34;</span><span class="op" id="2389478">,</span>&nbsp;<span class="ident" id="2389480">ErrSyntax</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2389492">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2389496">return</span>&nbsp;<span class="ident" id="2389503">s</span><span class="op" id="2389504">,</span>&nbsp;<span class="ident" id="2389506">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2389511">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2389514">if</span>&nbsp;<span class="ident" id="2389517">quote</span>&nbsp;<span class="op" id="2389523">!=</span>&nbsp;<span class="string" id="2389526">&#39;&#34;&#39;</span>&nbsp;<span class="op" id="2389530">&amp;&amp;</span>&nbsp;<span class="ident" id="2389533">quote</span>&nbsp;<span class="op" id="2389539">!=</span>&nbsp;<span class="string" id="2389542">&#39;\&#39;&#39;</span>&nbsp;<span class="op" id="2389547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2389551">return</span>&nbsp;<span class="string" id="2389558">&#34;&#34;</span><span class="op" id="2389560">,</span>&nbsp;<span class="ident" id="2389562">ErrSyntax</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2389573">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2389576">if</span>&nbsp;<span class="ident" id="2389579">contains</span><span class="op" id="2389587">(</span><span class="ident" id="2389588">s</span><span class="op" id="2389589">,</span>&nbsp;<span class="string" id="2389591">&#39;\n&#39;</span><span class="op" id="2389595">)</span>&nbsp;<span class="op" id="2389597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2389601">return</span>&nbsp;<span class="string" id="2389608">&#34;&#34;</span><span class="op" id="2389610">,</span>&nbsp;<span class="ident" id="2389612">ErrSyntax</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2389623">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2389627">//&nbsp;Is&nbsp;it&nbsp;trivial?&nbsp;&nbsp;Avoid&nbsp;allocation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2389665">if</span>&nbsp;<span class="op" id="2389668">!</span><span class="ident" id="2389669">contains</span><span class="op" id="2389677">(</span><span class="ident" id="2389678">s</span><span class="op" id="2389679">,</span>&nbsp;<span class="string" id="2389681">&#39;\\&#39;</span><span class="op" id="2389685">)</span>&nbsp;<span class="op" id="2389687">&amp;&amp;</span>&nbsp;<span class="op" id="2389690">!</span><span class="ident" id="2389691">contains</span><span class="op" id="2389699">(</span><span class="ident" id="2389700">s</span><span class="op" id="2389701">,</span>&nbsp;<span class="ident" id="2389703">quote</span><span class="op" id="2389708">)</span>&nbsp;<span class="op" id="2389710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2389714">switch</span>&nbsp;<span class="ident" id="2389721">quote</span>&nbsp;<span class="op" id="2389727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2389731">case</span>&nbsp;<span class="string" id="2389736">&#39;&#34;&#39;</span><span class="op" id="2389739">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2389744">return</span>&nbsp;<span class="ident" id="2389751">s</span><span class="op" id="2389752">,</span>&nbsp;<span class="ident" id="2389754">nil</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2389760">case</span>&nbsp;<span class="string" id="2389765">&#39;\&#39;&#39;</span><span class="op" id="2389769">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2389774">r</span><span class="op" id="2389775">,</span>&nbsp;<span class="ident" id="2389777">size</span>&nbsp;<span class="op" id="2389782">:=</span>&nbsp;<span class="ident" id="2389785">utf8</span><span class="op" id="2389789">.</span><span class="ident" id="2389790">DecodeRuneInString</span><span class="op" id="2389808">(</span><span class="ident" id="2389809">s</span><span class="op" id="2389810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2389815">if</span>&nbsp;<span class="ident" id="2389818">size</span>&nbsp;<span class="op" id="2389823">==</span>&nbsp;<span class="builtinfunc" id="2389826">len</span><span class="op" id="2389829">(</span><span class="ident" id="2389830">s</span><span class="op" id="2389831">)</span>&nbsp;<span class="op" id="2389833">&amp;&amp;</span>&nbsp;<span class="op" id="2389836">(</span><span class="ident" id="2389837">r</span>&nbsp;<span class="op" id="2389839">!=</span>&nbsp;<span class="ident" id="2389842">utf8</span><span class="op" id="2389846">.</span><span class="ident" id="2389847">RuneError</span>&nbsp;<span class="op" id="2389857">||</span>&nbsp;<span class="ident" id="2389860">size</span>&nbsp;<span class="op" id="2389865">!=</span>&nbsp;<span class="num" id="2389868">1</span><span class="op" id="2389869">)</span>&nbsp;<span class="op" id="2389871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2389877">return</span>&nbsp;<span class="ident" id="2389884">s</span><span class="op" id="2389885">,</span>&nbsp;<span class="ident" id="2389887">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2389894">}</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2389898">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2389901">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2389905">var</span>&nbsp;<span class="ident" id="2389909">runeTmp</span>&nbsp;<span class="op" id="2389917">[</span><span class="ident" id="2389918">utf8</span><span class="op" id="2389922">.</span><span class="ident" id="2389923">UTFMax</span><span class="op" id="2389929">]</span><span class="builtintype" id="2389930">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2389936">buf</span>&nbsp;<span class="op" id="2389940">:=</span>&nbsp;<span class="builtinfunc" id="2389943">make</span><span class="op" id="2389947">(</span><span class="op" id="2389948">[</span><span class="op" id="2389949">]</span><span class="builtintype" id="2389950">byte</span><span class="op" id="2389954">,</span>&nbsp;<span class="num" id="2389956">0</span><span class="op" id="2389957">,</span>&nbsp;<span class="num" id="2389959">3</span><span class="op" id="2389960">*</span><span class="builtinfunc" id="2389961">len</span><span class="op" id="2389964">(</span><span class="ident" id="2389965">s</span><span class="op" id="2389966">)</span><span class="op" id="2389967">/</span><span class="num" id="2389968">2</span><span class="op" id="2389969">)</span>&nbsp;<span class="comment" id="2389971">//&nbsp;Try&nbsp;to&nbsp;avoid&nbsp;more&nbsp;allocations.</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2390006">for</span>&nbsp;<span class="builtinfunc" id="2390010">len</span><span class="op" id="2390013">(</span><span class="ident" id="2390014">s</span><span class="op" id="2390015">)</span>&nbsp;<span class="op" id="2390017">&gt;</span>&nbsp;<span class="num" id="2390019">0</span>&nbsp;<span class="op" id="2390021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2390025">c</span><span class="op" id="2390026">,</span>&nbsp;<span class="ident" id="2390028">multibyte</span><span class="op" id="2390037">,</span>&nbsp;<span class="ident" id="2390039">ss</span><span class="op" id="2390041">,</span>&nbsp;<span class="ident" id="2390043">err</span>&nbsp;<span class="op" id="2390047">:=</span>&nbsp;<span class="ident" id="2390050">UnquoteChar</span><span class="op" id="2390061">(</span><span class="ident" id="2390062">s</span><span class="op" id="2390063">,</span>&nbsp;<span class="ident" id="2390065">quote</span><span class="op" id="2390070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2390074">if</span>&nbsp;<span class="ident" id="2390077">err</span>&nbsp;<span class="op" id="2390081">!=</span>&nbsp;<span class="ident" id="2390084">nil</span>&nbsp;<span class="op" id="2390088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2390093">return</span>&nbsp;<span class="string" id="2390100">&#34;&#34;</span><span class="op" id="2390102">,</span>&nbsp;<span class="ident" id="2390104">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2390110">}</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2390114">s</span>&nbsp;<span class="op" id="2390116">=</span>&nbsp;<span class="ident" id="2390118">ss</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2390123">if</span>&nbsp;<span class="ident" id="2390126">c</span>&nbsp;<span class="op" id="2390128">&lt;</span>&nbsp;<span class="ident" id="2390130">utf8</span><span class="op" id="2390134">.</span><span class="ident" id="2390135">RuneSelf</span>&nbsp;<span class="op" id="2390144">||</span>&nbsp;<span class="op" id="2390147">!</span><span class="ident" id="2390148">multibyte</span>&nbsp;<span class="op" id="2390158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2390163">buf</span>&nbsp;<span class="op" id="2390167">=</span>&nbsp;<span class="builtinfunc" id="2390169">append</span><span class="op" id="2390175">(</span><span class="ident" id="2390176">buf</span><span class="op" id="2390179">,</span>&nbsp;<span class="builtintype" id="2390181">byte</span><span class="op" id="2390185">(</span><span class="ident" id="2390186">c</span><span class="op" id="2390187">)</span><span class="op" id="2390188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2390192">}</span>&nbsp;<span class="keyword" id="2390194">else</span>&nbsp;<span class="op" id="2390199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2390204">n</span>&nbsp;<span class="op" id="2390206">:=</span>&nbsp;<span class="ident" id="2390209">utf8</span><span class="op" id="2390213">.</span><span class="ident" id="2390214">EncodeRune</span><span class="op" id="2390224">(</span><span class="ident" id="2390225">runeTmp</span><span class="op" id="2390232">[</span><span class="op" id="2390233">:</span><span class="op" id="2390234">]</span><span class="op" id="2390235">,</span>&nbsp;<span class="ident" id="2390237">c</span><span class="op" id="2390238">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2390243">buf</span>&nbsp;<span class="op" id="2390247">=</span>&nbsp;<span class="builtinfunc" id="2390249">append</span><span class="op" id="2390255">(</span><span class="ident" id="2390256">buf</span><span class="op" id="2390259">,</span>&nbsp;<span class="ident" id="2390261">runeTmp</span><span class="op" id="2390268">[</span><span class="op" id="2390269">:</span><span class="ident" id="2390270">n</span><span class="op" id="2390271">]</span><span class="op" id="2390272">...</span><span class="op" id="2390275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2390279">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2390283">if</span>&nbsp;<span class="ident" id="2390286">quote</span>&nbsp;<span class="op" id="2390292">==</span>&nbsp;<span class="string" id="2390295">&#39;\&#39;&#39;</span>&nbsp;<span class="op" id="2390300">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2390303">len</span><span class="op" id="2390306">(</span><span class="ident" id="2390307">s</span><span class="op" id="2390308">)</span>&nbsp;<span class="op" id="2390310">!=</span>&nbsp;<span class="num" id="2390313">0</span>&nbsp;<span class="op" id="2390315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2390320">//&nbsp;single-quoted&nbsp;must&nbsp;be&nbsp;single&nbsp;character</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2390365">return</span>&nbsp;<span class="string" id="2390372">&#34;&#34;</span><span class="op" id="2390374">,</span>&nbsp;<span class="ident" id="2390376">ErrSyntax</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2390388">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2390391">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2390394">return</span>&nbsp;<span class="builtintype" id="2390401">string</span><span class="op" id="2390407">(</span><span class="ident" id="2390408">buf</span><span class="op" id="2390411">)</span><span class="op" id="2390412">,</span>&nbsp;<span class="ident" id="2390414">nil</span><br>
<span class="lineno"></span><span class="op" id="2390418">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="comment" id="2390421">//&nbsp;contains&nbsp;reports&nbsp;whether&nbsp;the&nbsp;string&nbsp;contains&nbsp;the&nbsp;byte&nbsp;c.</span><br>
<span class="lineno"></span><span class="keyword" id="2390481">func</span>&nbsp;<span class="ident" id="2390486">contains</span><span class="op" id="2390494">(</span><span class="ident" id="2390495">s</span>&nbsp;<span class="builtintype" id="2390497">string</span><span class="op" id="2390503">,</span>&nbsp;<span class="ident" id="2390505">c</span>&nbsp;<span class="builtintype" id="2390507">byte</span><span class="op" id="2390511">)</span>&nbsp;<span class="builtintype" id="2390513">bool</span>&nbsp;<span class="op" id="2390518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2390521">for</span>&nbsp;<span class="ident" id="2390525">i</span>&nbsp;<span class="op" id="2390527">:=</span>&nbsp;<span class="num" id="2390530">0</span><span class="op" id="2390531">;</span>&nbsp;<span class="ident" id="2390533">i</span>&nbsp;<span class="op" id="2390535">&lt;</span>&nbsp;<span class="builtinfunc" id="2390537">len</span><span class="op" id="2390540">(</span><span class="ident" id="2390541">s</span><span class="op" id="2390542">)</span><span class="op" id="2390543">;</span>&nbsp;<span class="ident" id="2390545">i</span><span class="op" id="2390546">++</span>&nbsp;<span class="op" id="2390549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2390553">if</span>&nbsp;<span class="ident" id="2390556">s</span><span class="op" id="2390557">[</span><span class="ident" id="2390558">i</span><span class="op" id="2390559">]</span>&nbsp;<span class="op" id="2390561">==</span>&nbsp;<span class="ident" id="2390564">c</span>&nbsp;<span class="op" id="2390566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2390571">return</span>&nbsp;<span class="builtintype" id="2390578">true</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2390585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2390588">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2390591">return</span>&nbsp;<span class="builtintype" id="2390598">false</span><br>
<span class="lineno"></span><span class="op" id="2390604">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">375</span><span class="comment" id="2390607">//&nbsp;bsearch16&nbsp;returns&nbsp;the&nbsp;smallest&nbsp;i&nbsp;such&nbsp;that&nbsp;a[i]&nbsp;&gt;=&nbsp;x.</span><br>
<span class="lineno"></span><span class="comment" id="2390664">//&nbsp;If&nbsp;there&nbsp;is&nbsp;no&nbsp;such&nbsp;i,&nbsp;bsearch16&nbsp;returns&nbsp;len(a).</span><br>
<span class="lineno"></span><span class="keyword" id="2390716">func</span>&nbsp;<span class="ident" id="2390721">bsearch16</span><span class="op" id="2390730">(</span><span class="ident" id="2390731">a</span>&nbsp;<span class="op" id="2390733">[</span><span class="op" id="2390734">]</span><span class="builtintype" id="2390735">uint16</span><span class="op" id="2390741">,</span>&nbsp;<span class="ident" id="2390743">x</span>&nbsp;<span class="builtintype" id="2390745">uint16</span><span class="op" id="2390751">)</span>&nbsp;<span class="builtintype" id="2390753">int</span>&nbsp;<span class="op" id="2390757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2390760">i</span><span class="op" id="2390761">,</span>&nbsp;<span class="ident" id="2390763">j</span>&nbsp;<span class="op" id="2390765">:=</span>&nbsp;<span class="num" id="2390768">0</span><span class="op" id="2390769">,</span>&nbsp;<span class="builtinfunc" id="2390771">len</span><span class="op" id="2390774">(</span><span class="ident" id="2390775">a</span><span class="op" id="2390776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2390779">for</span>&nbsp;<span class="ident" id="2390783">i</span>&nbsp;<span class="op" id="2390785">&lt;</span>&nbsp;<span class="ident" id="2390787">j</span>&nbsp;<span class="op" id="2390789">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2390793">h</span>&nbsp;<span class="op" id="2390795">:=</span>&nbsp;<span class="ident" id="2390798">i</span>&nbsp;<span class="op" id="2390800">+</span>&nbsp;<span class="op" id="2390802">(</span><span class="ident" id="2390803">j</span><span class="op" id="2390804">-</span><span class="ident" id="2390805">i</span><span class="op" id="2390806">)</span><span class="op" id="2390807">/</span><span class="num" id="2390808">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2390812">if</span>&nbsp;<span class="ident" id="2390815">a</span><span class="op" id="2390816">[</span><span class="ident" id="2390817">h</span><span class="op" id="2390818">]</span>&nbsp;<span class="op" id="2390820">&lt;</span>&nbsp;<span class="ident" id="2390822">x</span>&nbsp;<span class="op" id="2390824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2390829">i</span>&nbsp;<span class="op" id="2390831">=</span>&nbsp;<span class="ident" id="2390833">h</span>&nbsp;<span class="op" id="2390835">+</span>&nbsp;<span class="num" id="2390837">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2390841">}</span>&nbsp;<span class="keyword" id="2390843">else</span>&nbsp;<span class="op" id="2390848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2390853">j</span>&nbsp;<span class="op" id="2390855">=</span>&nbsp;<span class="ident" id="2390857">h</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2390861">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2390864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2390867">return</span>&nbsp;<span class="ident" id="2390874">i</span><br>
<span class="lineno"></span><span class="op" id="2390876">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">390</span><span class="comment" id="2390879">//&nbsp;bsearch32&nbsp;returns&nbsp;the&nbsp;smallest&nbsp;i&nbsp;such&nbsp;that&nbsp;a[i]&nbsp;&gt;=&nbsp;x.</span><br>
<span class="lineno"></span><span class="comment" id="2390936">//&nbsp;If&nbsp;there&nbsp;is&nbsp;no&nbsp;such&nbsp;i,&nbsp;bsearch32&nbsp;returns&nbsp;len(a).</span><br>
<span class="lineno"></span><span class="keyword" id="2390988">func</span>&nbsp;<span class="ident" id="2390993">bsearch32</span><span class="op" id="2391002">(</span><span class="ident" id="2391003">a</span>&nbsp;<span class="op" id="2391005">[</span><span class="op" id="2391006">]</span><span class="builtintype" id="2391007">uint32</span><span class="op" id="2391013">,</span>&nbsp;<span class="ident" id="2391015">x</span>&nbsp;<span class="builtintype" id="2391017">uint32</span><span class="op" id="2391023">)</span>&nbsp;<span class="builtintype" id="2391025">int</span>&nbsp;<span class="op" id="2391029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2391032">i</span><span class="op" id="2391033">,</span>&nbsp;<span class="ident" id="2391035">j</span>&nbsp;<span class="op" id="2391037">:=</span>&nbsp;<span class="num" id="2391040">0</span><span class="op" id="2391041">,</span>&nbsp;<span class="builtinfunc" id="2391043">len</span><span class="op" id="2391046">(</span><span class="ident" id="2391047">a</span><span class="op" id="2391048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2391051">for</span>&nbsp;<span class="ident" id="2391055">i</span>&nbsp;<span class="op" id="2391057">&lt;</span>&nbsp;<span class="ident" id="2391059">j</span>&nbsp;<span class="op" id="2391061">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2391065">h</span>&nbsp;<span class="op" id="2391067">:=</span>&nbsp;<span class="ident" id="2391070">i</span>&nbsp;<span class="op" id="2391072">+</span>&nbsp;<span class="op" id="2391074">(</span><span class="ident" id="2391075">j</span><span class="op" id="2391076">-</span><span class="ident" id="2391077">i</span><span class="op" id="2391078">)</span><span class="op" id="2391079">/</span><span class="num" id="2391080">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2391084">if</span>&nbsp;<span class="ident" id="2391087">a</span><span class="op" id="2391088">[</span><span class="ident" id="2391089">h</span><span class="op" id="2391090">]</span>&nbsp;<span class="op" id="2391092">&lt;</span>&nbsp;<span class="ident" id="2391094">x</span>&nbsp;<span class="op" id="2391096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2391101">i</span>&nbsp;<span class="op" id="2391103">=</span>&nbsp;<span class="ident" id="2391105">h</span>&nbsp;<span class="op" id="2391107">+</span>&nbsp;<span class="num" id="2391109">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2391113">}</span>&nbsp;<span class="keyword" id="2391115">else</span>&nbsp;<span class="op" id="2391120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2391125">j</span>&nbsp;<span class="op" id="2391127">=</span>&nbsp;<span class="ident" id="2391129">h</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2391133">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2391136">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2391139">return</span>&nbsp;<span class="ident" id="2391146">i</span><br>
<span class="lineno"></span><span class="op" id="2391148">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span><span class="comment" id="2391151">//&nbsp;TODO:&nbsp;IsPrint&nbsp;is&nbsp;a&nbsp;local&nbsp;implementation&nbsp;of&nbsp;unicode.IsPrint,&nbsp;verified&nbsp;by&nbsp;the&nbsp;tests</span><br>
<span class="lineno"></span><span class="comment" id="2391236">//&nbsp;to&nbsp;give&nbsp;the&nbsp;same&nbsp;answer.&nbsp;It&nbsp;allows&nbsp;this&nbsp;package&nbsp;not&nbsp;to&nbsp;depend&nbsp;on&nbsp;unicode,</span><br>
<span class="lineno"></span><span class="comment" id="2391313">//&nbsp;and&nbsp;therefore&nbsp;not&nbsp;pull&nbsp;in&nbsp;all&nbsp;the&nbsp;Unicode&nbsp;tables.&nbsp;If&nbsp;the&nbsp;linker&nbsp;were&nbsp;better</span><br>
<span class="lineno"></span><span class="comment" id="2391392">//&nbsp;at&nbsp;tossing&nbsp;unused&nbsp;tables,&nbsp;we&nbsp;could&nbsp;get&nbsp;rid&nbsp;of&nbsp;this&nbsp;implementation.</span><br>
<span class="lineno"></span><span class="comment" id="2391462">//&nbsp;That&nbsp;would&nbsp;be&nbsp;nice.</span><br>
<span class="lineno">410</span><br>
<span class="lineno"></span><span class="comment" id="2391486">//&nbsp;IsPrint&nbsp;reports&nbsp;whether&nbsp;the&nbsp;rune&nbsp;is&nbsp;defined&nbsp;as&nbsp;printable&nbsp;by&nbsp;Go,&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="2391558">//&nbsp;the&nbsp;same&nbsp;definition&nbsp;as&nbsp;unicode.IsPrint:&nbsp;letters,&nbsp;numbers,&nbsp;punctuation,</span><br>
<span class="lineno"></span><span class="comment" id="2391632">//&nbsp;symbols&nbsp;and&nbsp;ASCII&nbsp;space.</span><br>
<span class="lineno"></span><span class="keyword" id="2391660">func</span>&nbsp;<span class="ident" id="2391665">IsPrint</span><span class="op" id="2391672">(</span><span class="ident" id="2391673">r</span>&nbsp;<span class="builtintype" id="2391675">rune</span><span class="op" id="2391679">)</span>&nbsp;<span class="builtintype" id="2391681">bool</span>&nbsp;<span class="op" id="2391686">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2391689">//&nbsp;Fast&nbsp;check&nbsp;for&nbsp;Latin-1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2391716">if</span>&nbsp;<span class="ident" id="2391719">r</span>&nbsp;<span class="op" id="2391721">&lt;=</span>&nbsp;<span class="num" id="2391724">0xFF</span>&nbsp;<span class="op" id="2391729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2391733">if</span>&nbsp;<span class="num" id="2391736">0x20</span>&nbsp;<span class="op" id="2391741">&lt;=</span>&nbsp;<span class="ident" id="2391744">r</span>&nbsp;<span class="op" id="2391746">&amp;&amp;</span>&nbsp;<span class="ident" id="2391749">r</span>&nbsp;<span class="op" id="2391751">&lt;=</span>&nbsp;<span class="num" id="2391754">0x7E</span>&nbsp;<span class="op" id="2391759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2391764">//&nbsp;All&nbsp;the&nbsp;ASCII&nbsp;is&nbsp;printable&nbsp;from&nbsp;space&nbsp;through&nbsp;DEL-1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2391823">return</span>&nbsp;<span class="builtintype" id="2391830">true</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2391837">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2391841">if</span>&nbsp;<span class="num" id="2391844">0xA1</span>&nbsp;<span class="op" id="2391849">&lt;=</span>&nbsp;<span class="ident" id="2391852">r</span>&nbsp;<span class="op" id="2391854">&amp;&amp;</span>&nbsp;<span class="ident" id="2391857">r</span>&nbsp;<span class="op" id="2391859">&lt;=</span>&nbsp;<span class="num" id="2391862">0xFF</span>&nbsp;<span class="op" id="2391867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2391872">//&nbsp;Similarly&nbsp;for&nbsp;&nbsp;through&nbsp;...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2391909">return</span>&nbsp;<span class="ident" id="2391916">r</span>&nbsp;<span class="op" id="2391918">!=</span>&nbsp;<span class="num" id="2391921">0xAD</span>&nbsp;<span class="comment" id="2391926">//&nbsp;...except&nbsp;for&nbsp;the&nbsp;bizarre&nbsp;soft&nbsp;hyphen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2391970">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2391974">return</span>&nbsp;<span class="builtintype" id="2391981">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2391988">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2391992">//&nbsp;Same&nbsp;algorithm,&nbsp;either&nbsp;on&nbsp;uint16&nbsp;or&nbsp;uint32&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2392046">//&nbsp;First,&nbsp;find&nbsp;first&nbsp;i&nbsp;such&nbsp;that&nbsp;isPrint[i]&nbsp;&gt;=&nbsp;x.</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2392097">//&nbsp;This&nbsp;is&nbsp;the&nbsp;index&nbsp;of&nbsp;either&nbsp;the&nbsp;start&nbsp;or&nbsp;end&nbsp;of&nbsp;a&nbsp;pair&nbsp;that&nbsp;might&nbsp;span&nbsp;x.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2392175">//&nbsp;The&nbsp;start&nbsp;is&nbsp;even&nbsp;(isPrint[i&amp;^1])&nbsp;and&nbsp;the&nbsp;end&nbsp;is&nbsp;odd&nbsp;(isPrint[i|1]).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2392248">//&nbsp;If&nbsp;we&nbsp;find&nbsp;x&nbsp;in&nbsp;a&nbsp;range,&nbsp;make&nbsp;sure&nbsp;x&nbsp;is&nbsp;not&nbsp;in&nbsp;isNotPrint&nbsp;list.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2392317">if</span>&nbsp;<span class="num" id="2392320">0</span>&nbsp;<span class="op" id="2392322">&lt;=</span>&nbsp;<span class="ident" id="2392325">r</span>&nbsp;<span class="op" id="2392327">&amp;&amp;</span>&nbsp;<span class="ident" id="2392330">r</span>&nbsp;<span class="op" id="2392332">&lt;</span>&nbsp;<span class="num" id="2392334">1</span><span class="op" id="2392335">&lt;&lt;</span><span class="num" id="2392337">16</span>&nbsp;<span class="op" id="2392340">{</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2392344">rr</span><span class="op" id="2392346">,</span>&nbsp;<span class="ident" id="2392348">isPrint</span><span class="op" id="2392355">,</span>&nbsp;<span class="ident" id="2392357">isNotPrint</span>&nbsp;<span class="op" id="2392368">:=</span>&nbsp;<span class="builtintype" id="2392371">uint16</span><span class="op" id="2392377">(</span><span class="ident" id="2392378">r</span><span class="op" id="2392379">)</span><span class="op" id="2392380">,</span>&nbsp;<span class="ident" id="2392382">isPrint16</span><span class="op" id="2392391">,</span>&nbsp;<span class="ident" id="2392393">isNotPrint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2392408">i</span>&nbsp;<span class="op" id="2392410">:=</span>&nbsp;<span class="ident" id="2392413">bsearch16</span><span class="op" id="2392422">(</span><span class="ident" id="2392423">isPrint</span><span class="op" id="2392430">,</span>&nbsp;<span class="ident" id="2392432">rr</span><span class="op" id="2392434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2392438">if</span>&nbsp;<span class="ident" id="2392441">i</span>&nbsp;<span class="op" id="2392443">&gt;=</span>&nbsp;<span class="builtinfunc" id="2392446">len</span><span class="op" id="2392449">(</span><span class="ident" id="2392450">isPrint</span><span class="op" id="2392457">)</span>&nbsp;<span class="op" id="2392459">||</span>&nbsp;<span class="ident" id="2392462">rr</span>&nbsp;<span class="op" id="2392465">&lt;</span>&nbsp;<span class="ident" id="2392467">isPrint</span><span class="op" id="2392474">[</span><span class="ident" id="2392475">i</span><span class="op" id="2392476">&amp;^</span><span class="num" id="2392478">1</span><span class="op" id="2392479">]</span>&nbsp;<span class="op" id="2392481">||</span>&nbsp;<span class="ident" id="2392484">isPrint</span><span class="op" id="2392491">[</span><span class="ident" id="2392492">i</span><span class="op" id="2392493">|</span><span class="num" id="2392494">1</span><span class="op" id="2392495">]</span>&nbsp;<span class="op" id="2392497">&lt;</span>&nbsp;<span class="ident" id="2392499">rr</span>&nbsp;<span class="op" id="2392502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2392507">return</span>&nbsp;<span class="builtintype" id="2392514">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2392522">}</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2392526">j</span>&nbsp;<span class="op" id="2392528">:=</span>&nbsp;<span class="ident" id="2392531">bsearch16</span><span class="op" id="2392540">(</span><span class="ident" id="2392541">isNotPrint</span><span class="op" id="2392551">,</span>&nbsp;<span class="ident" id="2392553">rr</span><span class="op" id="2392555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2392559">return</span>&nbsp;<span class="ident" id="2392566">j</span>&nbsp;<span class="op" id="2392568">&gt;=</span>&nbsp;<span class="builtinfunc" id="2392571">len</span><span class="op" id="2392574">(</span><span class="ident" id="2392575">isNotPrint</span><span class="op" id="2392585">)</span>&nbsp;<span class="op" id="2392587">||</span>&nbsp;<span class="ident" id="2392590">isNotPrint</span><span class="op" id="2392600">[</span><span class="ident" id="2392601">j</span><span class="op" id="2392602">]</span>&nbsp;<span class="op" id="2392604">!=</span>&nbsp;<span class="ident" id="2392607">rr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2392611">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2392615">rr</span><span class="op" id="2392617">,</span>&nbsp;<span class="ident" id="2392619">isPrint</span><span class="op" id="2392626">,</span>&nbsp;<span class="ident" id="2392628">isNotPrint</span>&nbsp;<span class="op" id="2392639">:=</span>&nbsp;<span class="builtintype" id="2392642">uint32</span><span class="op" id="2392648">(</span><span class="ident" id="2392649">r</span><span class="op" id="2392650">)</span><span class="op" id="2392651">,</span>&nbsp;<span class="ident" id="2392653">isPrint32</span><span class="op" id="2392662">,</span>&nbsp;<span class="ident" id="2392664">isNotPrint32</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2392678">i</span>&nbsp;<span class="op" id="2392680">:=</span>&nbsp;<span class="ident" id="2392683">bsearch32</span><span class="op" id="2392692">(</span><span class="ident" id="2392693">isPrint</span><span class="op" id="2392700">,</span>&nbsp;<span class="ident" id="2392702">rr</span><span class="op" id="2392704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2392707">if</span>&nbsp;<span class="ident" id="2392710">i</span>&nbsp;<span class="op" id="2392712">&gt;=</span>&nbsp;<span class="builtinfunc" id="2392715">len</span><span class="op" id="2392718">(</span><span class="ident" id="2392719">isPrint</span><span class="op" id="2392726">)</span>&nbsp;<span class="op" id="2392728">||</span>&nbsp;<span class="ident" id="2392731">rr</span>&nbsp;<span class="op" id="2392734">&lt;</span>&nbsp;<span class="ident" id="2392736">isPrint</span><span class="op" id="2392743">[</span><span class="ident" id="2392744">i</span><span class="op" id="2392745">&amp;^</span><span class="num" id="2392747">1</span><span class="op" id="2392748">]</span>&nbsp;<span class="op" id="2392750">||</span>&nbsp;<span class="ident" id="2392753">isPrint</span><span class="op" id="2392760">[</span><span class="ident" id="2392761">i</span><span class="op" id="2392762">|</span><span class="num" id="2392763">1</span><span class="op" id="2392764">]</span>&nbsp;<span class="op" id="2392766">&lt;</span>&nbsp;<span class="ident" id="2392768">rr</span>&nbsp;<span class="op" id="2392771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2392775">return</span>&nbsp;<span class="builtintype" id="2392782">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2392789">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2392792">if</span>&nbsp;<span class="ident" id="2392795">r</span>&nbsp;<span class="op" id="2392797">&gt;=</span>&nbsp;<span class="num" id="2392800">0x20000</span>&nbsp;<span class="op" id="2392808">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2392812">return</span>&nbsp;<span class="builtintype" id="2392819">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2392825">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2392828">r</span>&nbsp;<span class="op" id="2392830">-=</span>&nbsp;<span class="num" id="2392833">0x10000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2392842">j</span>&nbsp;<span class="op" id="2392844">:=</span>&nbsp;<span class="ident" id="2392847">bsearch16</span><span class="op" id="2392856">(</span><span class="ident" id="2392857">isNotPrint</span><span class="op" id="2392867">,</span>&nbsp;<span class="builtintype" id="2392869">uint16</span><span class="op" id="2392875">(</span><span class="ident" id="2392876">r</span><span class="op" id="2392877">)</span><span class="op" id="2392878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2392881">return</span>&nbsp;<span class="ident" id="2392888">j</span>&nbsp;<span class="op" id="2392890">&gt;=</span>&nbsp;<span class="builtinfunc" id="2392893">len</span><span class="op" id="2392896">(</span><span class="ident" id="2392897">isNotPrint</span><span class="op" id="2392907">)</span>&nbsp;<span class="op" id="2392909">||</span>&nbsp;<span class="ident" id="2392912">isNotPrint</span><span class="op" id="2392922">[</span><span class="ident" id="2392923">j</span><span class="op" id="2392924">]</span>&nbsp;<span class="op" id="2392926">!=</span>&nbsp;<span class="builtintype" id="2392929">uint16</span><span class="op" id="2392935">(</span><span class="ident" id="2392936">r</span><span class="op" id="2392937">)</span><br>
<span class="lineno">455</span><span class="op" id="2392939">}</span>
</div>
</body>
</html>
