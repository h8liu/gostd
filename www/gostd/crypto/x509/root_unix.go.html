<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3953249">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3953304">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3953358">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3953409">//&nbsp;+build&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3953472">package</span>&nbsp;<span class="ident" id="3953480">x509</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3953486">import</span>&nbsp;<span class="string" id="3953493">&#34;io/ioutil&#34;</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="3953506">//&nbsp;Possible&nbsp;certificate&nbsp;files;&nbsp;stop&nbsp;after&nbsp;finding&nbsp;one.</span><br>
<span class="lineno"></span><span class="keyword" id="3953561">var</span>&nbsp;<span class="ident" id="3953565">certFiles</span>&nbsp;<span class="op" id="3953575">=</span>&nbsp;<span class="op" id="3953577">[</span><span class="op" id="3953578">]</span><span class="builtintype" id="3953579">string</span><span class="op" id="3953585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3953588">&#34;/etc/ssl/certs/ca-certificates.crt&#34;</span><span class="op" id="3953624">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3953630">//&nbsp;Debian/Ubuntu/Gentoo&nbsp;etc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3953660">&#34;/etc/pki/tls/certs/ca-bundle.crt&#34;</span><span class="op" id="3953694">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3953702">//&nbsp;Fedora/RHEL</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3953718">&#34;/etc/ssl/ca-bundle.pem&#34;</span><span class="op" id="3953742">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3953760">//&nbsp;OpenSUSE</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3953773">&#34;/etc/ssl/cert.pem&#34;</span><span class="op" id="3953792">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3953815">//&nbsp;OpenBSD</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3953827">&#34;/usr/local/share/certs/ca-root-nss.crt&#34;</span><span class="op" id="3953867">,</span>&nbsp;<span class="comment" id="3953869">//&nbsp;FreeBSD/DragonFly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3953891">&#34;/etc/pki/tls/cacert.pem&#34;</span><span class="op" id="3953916">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3953933">//&nbsp;OpenELEC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3953946">&#34;/etc/certs/ca-certificates.crt&#34;</span><span class="op" id="3953978">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3953988">//&nbsp;Solaris&nbsp;11.2+</span><br>
<span class="lineno">20</span><span class="op" id="3954005">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3954008">//&nbsp;Possible&nbsp;directories&nbsp;with&nbsp;certificate&nbsp;files;&nbsp;stop&nbsp;after&nbsp;successfully</span><br>
<span class="lineno"></span><span class="comment" id="3954080">//&nbsp;reading&nbsp;at&nbsp;least&nbsp;one&nbsp;file&nbsp;from&nbsp;a&nbsp;directory.</span><br>
<span class="lineno"></span><span class="keyword" id="3954127">var</span>&nbsp;<span class="ident" id="3954131">certDirectories</span>&nbsp;<span class="op" id="3954147">=</span>&nbsp;<span class="op" id="3954149">[</span><span class="op" id="3954150">]</span><span class="builtintype" id="3954151">string</span><span class="op" id="3954157">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3954160">&#34;/system/etc/security/cacerts&#34;</span><span class="op" id="3954190">,</span>&nbsp;<span class="comment" id="3954192">//&nbsp;Android</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="op" id="3954204">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3954207">func</span>&nbsp;<span class="op" id="3954212">(</span><span class="ident" id="3954213">c</span>&nbsp;<span class="op" id="3954215">*</span><span class="ident" id="3954216">Certificate</span><span class="op" id="3954227">)</span>&nbsp;<span class="ident" id="3954229">systemVerify</span><span class="op" id="3954241">(</span><span class="ident" id="3954242">opts</span>&nbsp;<span class="op" id="3954247">*</span><span class="ident" id="3954248">VerifyOptions</span><span class="op" id="3954261">)</span>&nbsp;<span class="op" id="3954263">(</span><span class="ident" id="3954264">chains</span>&nbsp;<span class="op" id="3954271">[</span><span class="op" id="3954272">]</span><span class="op" id="3954273">[</span><span class="op" id="3954274">]</span><span class="op" id="3954275">*</span><span class="ident" id="3954276">Certificate</span><span class="op" id="3954287">,</span>&nbsp;<span class="ident" id="3954289">err</span>&nbsp;<span class="builtintype" id="3954293">error</span><span class="op" id="3954298">)</span>&nbsp;<span class="op" id="3954300">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3954303">return</span>&nbsp;<span class="ident" id="3954310">nil</span><span class="op" id="3954313">,</span>&nbsp;<span class="ident" id="3954315">nil</span><br>
<span class="lineno"></span><span class="op" id="3954319">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3954322">func</span>&nbsp;<span class="ident" id="3954327">initSystemRoots</span><span class="op" id="3954342">(</span><span class="op" id="3954343">)</span>&nbsp;<span class="op" id="3954345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3954348">roots</span>&nbsp;<span class="op" id="3954354">:=</span>&nbsp;<span class="ident" id="3954357">NewCertPool</span><span class="op" id="3954368">(</span><span class="op" id="3954369">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3954372">for</span>&nbsp;<span class="ident" id="3954376">_</span><span class="op" id="3954377">,</span>&nbsp;<span class="ident" id="3954379">file</span>&nbsp;<span class="op" id="3954384">:=</span>&nbsp;<span class="keyword" id="3954387">range</span>&nbsp;<span class="ident" id="3954393">certFiles</span>&nbsp;<span class="op" id="3954403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3954407">data</span><span class="op" id="3954411">,</span>&nbsp;<span class="ident" id="3954413">err</span>&nbsp;<span class="op" id="3954417">:=</span>&nbsp;<span class="ident" id="3954420">ioutil</span><span class="op" id="3954426">.</span><span class="ident" id="3954427">ReadFile</span><span class="op" id="3954435">(</span><span class="ident" id="3954436">file</span><span class="op" id="3954440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3954444">if</span>&nbsp;<span class="ident" id="3954447">err</span>&nbsp;<span class="op" id="3954451">==</span>&nbsp;<span class="ident" id="3954454">nil</span>&nbsp;<span class="op" id="3954458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3954463">roots</span><span class="op" id="3954468">.</span><span class="ident" id="3954469">AppendCertsFromPEM</span><span class="op" id="3954487">(</span><span class="ident" id="3954488">data</span><span class="op" id="3954492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3954497">systemRoots</span>&nbsp;<span class="op" id="3954509">=</span>&nbsp;<span class="ident" id="3954511">roots</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3954520">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3954529">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3954532">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3954536">for</span>&nbsp;<span class="ident" id="3954540">_</span><span class="op" id="3954541">,</span>&nbsp;<span class="ident" id="3954543">directory</span>&nbsp;<span class="op" id="3954553">:=</span>&nbsp;<span class="keyword" id="3954556">range</span>&nbsp;<span class="ident" id="3954562">certDirectories</span>&nbsp;<span class="op" id="3954578">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3954582">fis</span><span class="op" id="3954585">,</span>&nbsp;<span class="ident" id="3954587">err</span>&nbsp;<span class="op" id="3954591">:=</span>&nbsp;<span class="ident" id="3954594">ioutil</span><span class="op" id="3954600">.</span><span class="ident" id="3954601">ReadDir</span><span class="op" id="3954608">(</span><span class="ident" id="3954609">directory</span><span class="op" id="3954618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3954622">if</span>&nbsp;<span class="ident" id="3954625">err</span>&nbsp;<span class="op" id="3954629">!=</span>&nbsp;<span class="ident" id="3954632">nil</span>&nbsp;<span class="op" id="3954636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3954641">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3954652">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3954656">rootsAdded</span>&nbsp;<span class="op" id="3954667">:=</span>&nbsp;<span class="builtintype" id="3954670">false</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3954678">for</span>&nbsp;<span class="ident" id="3954682">_</span><span class="op" id="3954683">,</span>&nbsp;<span class="ident" id="3954685">fi</span>&nbsp;<span class="op" id="3954688">:=</span>&nbsp;<span class="keyword" id="3954691">range</span>&nbsp;<span class="ident" id="3954697">fis</span>&nbsp;<span class="op" id="3954701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3954706">data</span><span class="op" id="3954710">,</span>&nbsp;<span class="ident" id="3954712">err</span>&nbsp;<span class="op" id="3954716">:=</span>&nbsp;<span class="ident" id="3954719">ioutil</span><span class="op" id="3954725">.</span><span class="ident" id="3954726">ReadFile</span><span class="op" id="3954734">(</span><span class="ident" id="3954735">directory</span>&nbsp;<span class="op" id="3954745">+</span>&nbsp;<span class="string" id="3954747">&#34;/&#34;</span>&nbsp;<span class="op" id="3954751">+</span>&nbsp;<span class="ident" id="3954753">fi</span><span class="op" id="3954755">.</span><span class="ident" id="3954756">Name</span><span class="op" id="3954760">(</span><span class="op" id="3954761">)</span><span class="op" id="3954762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3954767">if</span>&nbsp;<span class="ident" id="3954770">err</span>&nbsp;<span class="op" id="3954774">==</span>&nbsp;<span class="ident" id="3954777">nil</span>&nbsp;<span class="op" id="3954781">&amp;&amp;</span>&nbsp;<span class="ident" id="3954784">roots</span><span class="op" id="3954789">.</span><span class="ident" id="3954790">AppendCertsFromPEM</span><span class="op" id="3954808">(</span><span class="ident" id="3954809">data</span><span class="op" id="3954813">)</span>&nbsp;<span class="op" id="3954815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3954821">rootsAdded</span>&nbsp;<span class="op" id="3954832">=</span>&nbsp;<span class="builtintype" id="3954834">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3954842">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3954846">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3954850">if</span>&nbsp;<span class="ident" id="3954853">rootsAdded</span>&nbsp;<span class="op" id="3954864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3954869">systemRoots</span>&nbsp;<span class="op" id="3954881">=</span>&nbsp;<span class="ident" id="3954883">roots</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3954892">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3954901">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3954904">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3954908">//&nbsp;All&nbsp;of&nbsp;the&nbsp;files&nbsp;failed&nbsp;to&nbsp;load.&nbsp;systemRoots&nbsp;will&nbsp;be&nbsp;nil&nbsp;which&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3954980">//&nbsp;trigger&nbsp;a&nbsp;specific&nbsp;error&nbsp;at&nbsp;verification&nbsp;time.</span><br>
<span class="lineno"></span><span class="op" id="3955030">}</span>
</div>
</body>
</html>
