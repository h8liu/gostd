<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="1421135">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1421190">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1421244">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1421295">package</span>&nbsp;<span class="ident" id="1421303">io</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1421307">type</span>&nbsp;<span class="ident" id="1421312">multiReader</span>&nbsp;<span class="keyword" id="1421324">struct</span>&nbsp;<span class="op" id="1421331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1421334">readers</span>&nbsp;<span class="op" id="1421342">[</span><span class="op" id="1421343">]</span><span class="ident" id="1421344">Reader</span><br>
<span class="lineno"></span><span class="op" id="1421351">}</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="1421354">func</span>&nbsp;<span class="op" id="1421359">(</span><span class="ident" id="1421360">mr</span>&nbsp;<span class="op" id="1421363">*</span><span class="ident" id="1421364">multiReader</span><span class="op" id="1421375">)</span>&nbsp;<span class="ident" id="1421377">Read</span><span class="op" id="1421381">(</span><span class="ident" id="1421382">p</span>&nbsp;<span class="op" id="1421384">[</span><span class="op" id="1421385">]</span><span class="builtintype" id="1421386">byte</span><span class="op" id="1421390">)</span>&nbsp;<span class="op" id="1421392">(</span><span class="ident" id="1421393">n</span>&nbsp;<span class="builtintype" id="1421395">int</span><span class="op" id="1421398">,</span>&nbsp;<span class="ident" id="1421400">err</span>&nbsp;<span class="builtintype" id="1421404">error</span><span class="op" id="1421409">)</span>&nbsp;<span class="op" id="1421411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1421414">for</span>&nbsp;<span class="builtinfunc" id="1421418">len</span><span class="op" id="1421421">(</span><span class="ident" id="1421422">mr</span><span class="op" id="1421424">.</span><span class="ident" id="1421425">readers</span><span class="op" id="1421432">)</span>&nbsp;<span class="op" id="1421434">&gt;</span>&nbsp;<span class="num" id="1421436">0</span>&nbsp;<span class="op" id="1421438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1421442">n</span><span class="op" id="1421443">,</span>&nbsp;<span class="ident" id="1421445">err</span>&nbsp;<span class="op" id="1421449">=</span>&nbsp;<span class="ident" id="1421451">mr</span><span class="op" id="1421453">.</span><span class="ident" id="1421454">readers</span><span class="op" id="1421461">[</span><span class="num" id="1421462">0</span><span class="op" id="1421463">]</span><span class="op" id="1421464">.</span><span class="ident" id="1421465">Read</span><span class="op" id="1421469">(</span><span class="ident" id="1421470">p</span><span class="op" id="1421471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1421475">if</span>&nbsp;<span class="ident" id="1421478">n</span>&nbsp;<span class="op" id="1421480">&gt;</span>&nbsp;<span class="num" id="1421482">0</span>&nbsp;<span class="op" id="1421484">||</span>&nbsp;<span class="ident" id="1421487">err</span>&nbsp;<span class="op" id="1421491">!=</span>&nbsp;<span class="ident" id="1421494">EOF</span>&nbsp;<span class="op" id="1421498">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1421503">if</span>&nbsp;<span class="ident" id="1421506">err</span>&nbsp;<span class="op" id="1421510">==</span>&nbsp;<span class="ident" id="1421513">EOF</span>&nbsp;<span class="op" id="1421517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1421523">//&nbsp;Don&#39;t&nbsp;return&nbsp;EOF&nbsp;yet.&nbsp;There&nbsp;may&nbsp;be&nbsp;more&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1421576">//&nbsp;in&nbsp;the&nbsp;remaining&nbsp;readers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1421609">err</span>&nbsp;<span class="op" id="1421613">=</span>&nbsp;<span class="ident" id="1421615">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1421622">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1421627">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1421636">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1421640">mr</span><span class="op" id="1421642">.</span><span class="ident" id="1421643">readers</span>&nbsp;<span class="op" id="1421651">=</span>&nbsp;<span class="ident" id="1421653">mr</span><span class="op" id="1421655">.</span><span class="ident" id="1421656">readers</span><span class="op" id="1421663">[</span><span class="num" id="1421664">1</span><span class="op" id="1421665">:</span><span class="op" id="1421666">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1421669">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1421672">return</span>&nbsp;<span class="num" id="1421679">0</span><span class="op" id="1421680">,</span>&nbsp;<span class="ident" id="1421682">EOF</span><br>
<span class="lineno">25</span><span class="op" id="1421686">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1421689">//&nbsp;MultiReader&nbsp;returns&nbsp;a&nbsp;Reader&nbsp;that&#39;s&nbsp;the&nbsp;logical&nbsp;concatenation&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="1421757">//&nbsp;the&nbsp;provided&nbsp;input&nbsp;readers.&nbsp;&nbsp;They&#39;re&nbsp;read&nbsp;sequentially.&nbsp;&nbsp;Once&nbsp;all</span><br>
<span class="lineno"></span><span class="comment" id="1421826">//&nbsp;inputs&nbsp;have&nbsp;returned&nbsp;EOF,&nbsp;Read&nbsp;will&nbsp;return&nbsp;EOF.&nbsp;&nbsp;If&nbsp;any&nbsp;of&nbsp;the&nbsp;readers</span><br>
<span class="lineno">30</span><span class="comment" id="1421900">//&nbsp;return&nbsp;a&nbsp;non-nil,&nbsp;non-EOF&nbsp;error,&nbsp;Read&nbsp;will&nbsp;return&nbsp;that&nbsp;error.</span><br>
<span class="lineno"></span><span class="keyword" id="1421965">func</span>&nbsp;<span class="ident" id="1421970">MultiReader</span><span class="op" id="1421981">(</span><span class="ident" id="1421982">readers</span>&nbsp;<span class="op" id="1421990">...</span><span class="ident" id="1421993">Reader</span><span class="op" id="1421999">)</span>&nbsp;<span class="ident" id="1422001">Reader</span>&nbsp;<span class="op" id="1422008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1422011">r</span>&nbsp;<span class="op" id="1422013">:=</span>&nbsp;<span class="builtinfunc" id="1422016">make</span><span class="op" id="1422020">(</span><span class="op" id="1422021">[</span><span class="op" id="1422022">]</span><span class="ident" id="1422023">Reader</span><span class="op" id="1422029">,</span>&nbsp;<span class="builtinfunc" id="1422031">len</span><span class="op" id="1422034">(</span><span class="ident" id="1422035">readers</span><span class="op" id="1422042">)</span><span class="op" id="1422043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1422046">copy</span><span class="op" id="1422050">(</span><span class="ident" id="1422051">r</span><span class="op" id="1422052">,</span>&nbsp;<span class="ident" id="1422054">readers</span><span class="op" id="1422061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1422064">return</span>&nbsp;<span class="op" id="1422071">&amp;</span><span class="ident" id="1422072">multiReader</span><span class="op" id="1422083">{</span><span class="ident" id="1422084">r</span><span class="op" id="1422085">}</span><br>
<span class="lineno">35</span><span class="op" id="1422087">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1422090">type</span>&nbsp;<span class="ident" id="1422095">multiWriter</span>&nbsp;<span class="keyword" id="1422107">struct</span>&nbsp;<span class="op" id="1422114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1422117">writers</span>&nbsp;<span class="op" id="1422125">[</span><span class="op" id="1422126">]</span><span class="ident" id="1422127">Writer</span><br>
<span class="lineno"></span><span class="op" id="1422134">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="1422137">func</span>&nbsp;<span class="op" id="1422142">(</span><span class="ident" id="1422143">t</span>&nbsp;<span class="op" id="1422145">*</span><span class="ident" id="1422146">multiWriter</span><span class="op" id="1422157">)</span>&nbsp;<span class="ident" id="1422159">Write</span><span class="op" id="1422164">(</span><span class="ident" id="1422165">p</span>&nbsp;<span class="op" id="1422167">[</span><span class="op" id="1422168">]</span><span class="builtintype" id="1422169">byte</span><span class="op" id="1422173">)</span>&nbsp;<span class="op" id="1422175">(</span><span class="ident" id="1422176">n</span>&nbsp;<span class="builtintype" id="1422178">int</span><span class="op" id="1422181">,</span>&nbsp;<span class="ident" id="1422183">err</span>&nbsp;<span class="builtintype" id="1422187">error</span><span class="op" id="1422192">)</span>&nbsp;<span class="op" id="1422194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1422197">for</span>&nbsp;<span class="ident" id="1422201">_</span><span class="op" id="1422202">,</span>&nbsp;<span class="ident" id="1422204">w</span>&nbsp;<span class="op" id="1422206">:=</span>&nbsp;<span class="keyword" id="1422209">range</span>&nbsp;<span class="ident" id="1422215">t</span><span class="op" id="1422216">.</span><span class="ident" id="1422217">writers</span>&nbsp;<span class="op" id="1422225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1422229">n</span><span class="op" id="1422230">,</span>&nbsp;<span class="ident" id="1422232">err</span>&nbsp;<span class="op" id="1422236">=</span>&nbsp;<span class="ident" id="1422238">w</span><span class="op" id="1422239">.</span><span class="ident" id="1422240">Write</span><span class="op" id="1422245">(</span><span class="ident" id="1422246">p</span><span class="op" id="1422247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1422251">if</span>&nbsp;<span class="ident" id="1422254">err</span>&nbsp;<span class="op" id="1422258">!=</span>&nbsp;<span class="ident" id="1422261">nil</span>&nbsp;<span class="op" id="1422265">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1422270">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1422279">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1422283">if</span>&nbsp;<span class="ident" id="1422286">n</span>&nbsp;<span class="op" id="1422288">!=</span>&nbsp;<span class="builtinfunc" id="1422291">len</span><span class="op" id="1422294">(</span><span class="ident" id="1422295">p</span><span class="op" id="1422296">)</span>&nbsp;<span class="op" id="1422298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1422303">err</span>&nbsp;<span class="op" id="1422307">=</span>&nbsp;<span class="ident" id="1422309">ErrShortWrite</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1422326">return</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1422335">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1422338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1422341">return</span>&nbsp;<span class="builtinfunc" id="1422348">len</span><span class="op" id="1422351">(</span><span class="ident" id="1422352">p</span><span class="op" id="1422353">)</span><span class="op" id="1422354">,</span>&nbsp;<span class="ident" id="1422356">nil</span><br>
<span class="lineno"></span><span class="op" id="1422360">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="1422363">//&nbsp;MultiWriter&nbsp;creates&nbsp;a&nbsp;writer&nbsp;that&nbsp;duplicates&nbsp;its&nbsp;writes&nbsp;to&nbsp;all&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1422433">//&nbsp;provided&nbsp;writers,&nbsp;similar&nbsp;to&nbsp;the&nbsp;Unix&nbsp;tee(1)&nbsp;command.</span><br>
<span class="lineno"></span><span class="keyword" id="1422490">func</span>&nbsp;<span class="ident" id="1422495">MultiWriter</span><span class="op" id="1422506">(</span><span class="ident" id="1422507">writers</span>&nbsp;<span class="op" id="1422515">...</span><span class="ident" id="1422518">Writer</span><span class="op" id="1422524">)</span>&nbsp;<span class="ident" id="1422526">Writer</span>&nbsp;<span class="op" id="1422533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1422536">w</span>&nbsp;<span class="op" id="1422538">:=</span>&nbsp;<span class="builtinfunc" id="1422541">make</span><span class="op" id="1422545">(</span><span class="op" id="1422546">[</span><span class="op" id="1422547">]</span><span class="ident" id="1422548">Writer</span><span class="op" id="1422554">,</span>&nbsp;<span class="builtinfunc" id="1422556">len</span><span class="op" id="1422559">(</span><span class="ident" id="1422560">writers</span><span class="op" id="1422567">)</span><span class="op" id="1422568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1422571">copy</span><span class="op" id="1422575">(</span><span class="ident" id="1422576">w</span><span class="op" id="1422577">,</span>&nbsp;<span class="ident" id="1422579">writers</span><span class="op" id="1422586">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1422589">return</span>&nbsp;<span class="op" id="1422596">&amp;</span><span class="ident" id="1422597">multiWriter</span><span class="op" id="1422608">{</span><span class="ident" id="1422609">w</span><span class="op" id="1422610">}</span><br>
<span class="lineno"></span><span class="op" id="1422612">}</span>
</div>
</body>
</html>
