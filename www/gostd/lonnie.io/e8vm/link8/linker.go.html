<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>lonnie.io/e8vm/link8</h2>
<ul>
<li><a href="/gostd/lonnie.io/e8vm/link8/func.go.html">func.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/layout.go.html">layout.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/link.go.html">link.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/linker.go.html">linker.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/package.go.html">package.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/pkg_sym.go.html">pkg_sym.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/symbol.go.html">symbol.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/trace_used.go.html">trace_used.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/var.go.html">var.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/writer.go.html">writer.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="keyword" id="4814792">package</span>&nbsp;<span class="ident" id="4814800">link8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4814807">//&nbsp;Linker&nbsp;provides&nbsp;the&nbsp;framework&nbsp;to&nbsp;link&nbsp;packages&nbsp;together.</span><br>
<span class="lineno"></span><span class="keyword" id="4814867">type</span>&nbsp;<span class="ident" id="4814872">Linker</span>&nbsp;<span class="keyword" id="4814879">struct</span>&nbsp;<span class="op" id="4814886">{</span><br>
<span class="lineno">5</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4814889">pkgs</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4814898">[</span><span class="op" id="4814899">]</span><span class="op" id="4814900">*</span><span class="ident" id="4814901">Package</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4814910">pkgIndex</span>&nbsp;<span class="keyword" id="4814919">map</span><span class="op" id="4814922">[</span><span class="builtintype" id="4814923">string</span><span class="op" id="4814929">]</span><span class="builtintype" id="4814930">int</span><br>
<span class="lineno"></span><span class="op" id="4814934">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4814937">//&nbsp;NewLinker&nbsp;creates&nbsp;a&nbsp;new&nbsp;linker&nbsp;with&nbsp;no&nbsp;packages.</span><br>
<span class="lineno">10</span><span class="keyword" id="4814989">func</span>&nbsp;<span class="ident" id="4814994">NewLinker</span><span class="op" id="4815003">(</span><span class="op" id="4815004">)</span>&nbsp;<span class="op" id="4815006">*</span><span class="ident" id="4815007">Linker</span>&nbsp;<span class="op" id="4815014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4815017">ret</span>&nbsp;<span class="op" id="4815021">:=</span>&nbsp;<span class="builtinfunc" id="4815024">new</span><span class="op" id="4815027">(</span><span class="ident" id="4815028">Linker</span><span class="op" id="4815034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4815037">ret</span><span class="op" id="4815040">.</span><span class="ident" id="4815041">pkgIndex</span>&nbsp;<span class="op" id="4815050">=</span>&nbsp;<span class="builtinfunc" id="4815052">make</span><span class="op" id="4815056">(</span><span class="keyword" id="4815057">map</span><span class="op" id="4815060">[</span><span class="builtintype" id="4815061">string</span><span class="op" id="4815067">]</span><span class="builtintype" id="4815068">int</span><span class="op" id="4815071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4815074">return</span>&nbsp;<span class="ident" id="4815081">ret</span><br>
<span class="lineno"></span><span class="op" id="4815085">}</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="4815088">//&nbsp;AddPkg&nbsp;adds&nbsp;a&nbsp;package&nbsp;into&nbsp;the&nbsp;linker.</span><br>
<span class="lineno"></span><span class="comment" id="4815130">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;package&nbsp;and&nbsp;if&nbsp;the&nbsp;package</span><br>
<span class="lineno"></span><span class="comment" id="4815188">//&nbsp;is&nbsp;new.</span><br>
<span class="lineno"></span><span class="keyword" id="4815199">func</span>&nbsp;<span class="op" id="4815204">(</span><span class="ident" id="4815205">lnk</span>&nbsp;<span class="op" id="4815209">*</span><span class="ident" id="4815210">Linker</span><span class="op" id="4815216">)</span>&nbsp;<span class="ident" id="4815218">AddPkg</span><span class="op" id="4815224">(</span><span class="ident" id="4815225">p</span>&nbsp;<span class="op" id="4815227">*</span><span class="ident" id="4815228">Package</span><span class="op" id="4815235">)</span>&nbsp;<span class="op" id="4815237">(</span><span class="ident" id="4815238">index</span>&nbsp;<span class="builtintype" id="4815244">int</span><span class="op" id="4815247">,</span>&nbsp;<span class="ident" id="4815249">isNew</span>&nbsp;<span class="builtintype" id="4815255">bool</span><span class="op" id="4815259">)</span>&nbsp;<span class="op" id="4815261">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4815264">path</span>&nbsp;<span class="op" id="4815269">:=</span>&nbsp;<span class="ident" id="4815272">p</span><span class="op" id="4815273">.</span><span class="ident" id="4815274">path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4815280">index</span><span class="op" id="4815285">,</span>&nbsp;<span class="ident" id="4815287">found</span>&nbsp;<span class="op" id="4815293">:=</span>&nbsp;<span class="ident" id="4815296">lnk</span><span class="op" id="4815299">.</span><span class="ident" id="4815300">pkgIndex</span><span class="op" id="4815308">[</span><span class="ident" id="4815309">path</span><span class="op" id="4815313">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4815316">if</span>&nbsp;<span class="ident" id="4815319">found</span>&nbsp;<span class="op" id="4815325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4815329">return</span>&nbsp;<span class="ident" id="4815336">index</span><span class="op" id="4815341">,</span>&nbsp;<span class="builtintype" id="4815343">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4815350">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4815354">index</span>&nbsp;<span class="op" id="4815360">=</span>&nbsp;<span class="builtinfunc" id="4815362">len</span><span class="op" id="4815365">(</span><span class="ident" id="4815366">lnk</span><span class="op" id="4815369">.</span><span class="ident" id="4815370">pkgs</span><span class="op" id="4815374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4815377">lnk</span><span class="op" id="4815380">.</span><span class="ident" id="4815381">pkgs</span>&nbsp;<span class="op" id="4815386">=</span>&nbsp;<span class="builtinfunc" id="4815388">append</span><span class="op" id="4815394">(</span><span class="ident" id="4815395">lnk</span><span class="op" id="4815398">.</span><span class="ident" id="4815399">pkgs</span><span class="op" id="4815403">,</span>&nbsp;<span class="ident" id="4815405">p</span><span class="op" id="4815406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4815409">lnk</span><span class="op" id="4815412">.</span><span class="ident" id="4815413">pkgIndex</span><span class="op" id="4815421">[</span><span class="ident" id="4815422">path</span><span class="op" id="4815426">]</span>&nbsp;<span class="op" id="4815428">=</span>&nbsp;<span class="ident" id="4815430">index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4815437">return</span>&nbsp;<span class="ident" id="4815444">index</span><span class="op" id="4815449">,</span>&nbsp;<span class="builtintype" id="4815451">true</span><br>
<span class="lineno">30</span><span class="op" id="4815456">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4815459">//&nbsp;AddPkgs&nbsp;adds&nbsp;the&nbsp;package&nbsp;and&nbsp;recursively&nbsp;adds&nbsp;the&nbsp;packages</span><br>
<span class="lineno"></span><span class="comment" id="4815521">//&nbsp;it&nbsp;requires.&nbsp;It&nbsp;returns&nbsp;the&nbsp;package&nbsp;index.</span><br>
<span class="lineno"></span><span class="keyword" id="4815567">func</span>&nbsp;<span class="op" id="4815572">(</span><span class="ident" id="4815573">lnk</span>&nbsp;<span class="op" id="4815577">*</span><span class="ident" id="4815578">Linker</span><span class="op" id="4815584">)</span>&nbsp;<span class="ident" id="4815586">AddPkgs</span><span class="op" id="4815593">(</span><span class="ident" id="4815594">p</span>&nbsp;<span class="op" id="4815596">*</span><span class="ident" id="4815597">Package</span><span class="op" id="4815604">)</span>&nbsp;<span class="builtintype" id="4815606">int</span>&nbsp;<span class="op" id="4815610">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4815613">index</span><span class="op" id="4815618">,</span>&nbsp;<span class="ident" id="4815620">isNew</span>&nbsp;<span class="op" id="4815626">:=</span>&nbsp;<span class="ident" id="4815629">lnk</span><span class="op" id="4815632">.</span><span class="ident" id="4815633">AddPkg</span><span class="op" id="4815639">(</span><span class="ident" id="4815640">p</span><span class="op" id="4815641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4815644">if</span>&nbsp;<span class="ident" id="4815647">isNew</span>&nbsp;<span class="op" id="4815653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4815657">for</span>&nbsp;<span class="ident" id="4815661">_</span><span class="op" id="4815662">,</span>&nbsp;<span class="ident" id="4815664">req</span>&nbsp;<span class="op" id="4815668">:=</span>&nbsp;<span class="keyword" id="4815671">range</span>&nbsp;<span class="ident" id="4815677">p</span><span class="op" id="4815678">.</span><span class="ident" id="4815679">requires</span>&nbsp;<span class="op" id="4815688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4815693">lnk</span><span class="op" id="4815696">.</span><span class="ident" id="4815697">AddPkgs</span><span class="op" id="4815704">(</span><span class="ident" id="4815705">req</span><span class="op" id="4815708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4815712">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4815715">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4815719">return</span>&nbsp;<span class="ident" id="4815726">index</span><br>
<span class="lineno"></span><span class="op" id="4815732">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="4815735">//&nbsp;PkgIndex&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;particular&nbsp;package.</span><br>
<span class="lineno"></span><span class="keyword" id="4815792">func</span>&nbsp;<span class="op" id="4815797">(</span><span class="ident" id="4815798">lnk</span>&nbsp;<span class="op" id="4815802">*</span><span class="ident" id="4815803">Linker</span><span class="op" id="4815809">)</span>&nbsp;<span class="ident" id="4815811">PkgIndex</span><span class="op" id="4815819">(</span><span class="ident" id="4815820">path</span>&nbsp;<span class="builtintype" id="4815825">string</span><span class="op" id="4815831">)</span>&nbsp;<span class="builtintype" id="4815833">int</span>&nbsp;<span class="op" id="4815837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4815840">ret</span><span class="op" id="4815843">,</span>&nbsp;<span class="ident" id="4815845">found</span>&nbsp;<span class="op" id="4815851">:=</span>&nbsp;<span class="ident" id="4815854">lnk</span><span class="op" id="4815857">.</span><span class="ident" id="4815858">pkgIndex</span><span class="op" id="4815866">[</span><span class="ident" id="4815867">path</span><span class="op" id="4815871">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4815874">if</span>&nbsp;<span class="op" id="4815877">!</span><span class="ident" id="4815878">found</span>&nbsp;<span class="op" id="4815884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4815888">panic</span><span class="op" id="4815893">(</span><span class="string" id="4815894">&#34;not&nbsp;found&#34;</span><span class="op" id="4815905">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4815908">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4815911">return</span>&nbsp;<span class="ident" id="4815918">ret</span><br>
<span class="lineno"></span><span class="op" id="4815922">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4815925">//&nbsp;Pkg&nbsp;returns&nbsp;the&nbsp;package&nbsp;of&nbsp;index&nbsp;i.</span><br>
<span class="lineno">55</span><span class="keyword" id="4815964">func</span>&nbsp;<span class="op" id="4815969">(</span><span class="ident" id="4815970">lnk</span>&nbsp;<span class="op" id="4815974">*</span><span class="ident" id="4815975">Linker</span><span class="op" id="4815981">)</span>&nbsp;<span class="ident" id="4815983">Pkg</span><span class="op" id="4815986">(</span><span class="ident" id="4815987">i</span>&nbsp;<span class="builtintype" id="4815989">int</span><span class="op" id="4815992">)</span>&nbsp;<span class="op" id="4815994">*</span><span class="ident" id="4815995">Package</span>&nbsp;<span class="op" id="4816003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4816006">return</span>&nbsp;<span class="ident" id="4816013">lnk</span><span class="op" id="4816016">.</span><span class="ident" id="4816017">pkgs</span><span class="op" id="4816021">[</span><span class="ident" id="4816022">i</span><span class="op" id="4816023">]</span><br>
<span class="lineno"></span><span class="op" id="4816025">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4816028">//&nbsp;Npkg&nbsp;retunrs&nbsp;the&nbsp;total&nbsp;number&nbsp;of&nbsp;packages.</span><br>
<span class="lineno">60</span><span class="keyword" id="4816074">func</span>&nbsp;<span class="op" id="4816079">(</span><span class="ident" id="4816080">lnk</span>&nbsp;<span class="op" id="4816084">*</span><span class="ident" id="4816085">Linker</span><span class="op" id="4816091">)</span>&nbsp;<span class="ident" id="4816093">Npkg</span><span class="op" id="4816097">(</span><span class="op" id="4816098">)</span>&nbsp;<span class="builtintype" id="4816100">int</span>&nbsp;<span class="op" id="4816104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4816107">return</span>&nbsp;<span class="builtinfunc" id="4816114">len</span><span class="op" id="4816117">(</span><span class="ident" id="4816118">lnk</span><span class="op" id="4816121">.</span><span class="ident" id="4816122">pkgs</span><span class="op" id="4816126">)</span><br>
<span class="lineno"></span><span class="op" id="4816128">}</span>
</div>
</body>
</html>
