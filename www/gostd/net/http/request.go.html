<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http</h2>
<ul>
<li><a href="/gostd/net/http/client.go.html">client.go</a></li>
<li><a href="/gostd/net/http/client_test.go.html">client_test.go</a></li>
<li><a href="/gostd/net/http/cookie.go.html">cookie.go</a></li>
<li><a href="/gostd/net/http/cookie_test.go.html">cookie_test.go</a></li>
<li><a href="/gostd/net/http/doc.go.html">doc.go</a></li>
<li><a href="/gostd/net/http/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/http/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/net/http/filetransport.go.html">filetransport.go</a></li>
<li><a href="/gostd/net/http/filetransport_test.go.html">filetransport_test.go</a></li>
<li><a href="/gostd/net/http/fs.go.html">fs.go</a></li>
<li><a href="/gostd/net/http/fs_test.go.html">fs_test.go</a></li>
<li><a href="/gostd/net/http/header.go.html">header.go</a></li>
<li><a href="/gostd/net/http/header_test.go.html">header_test.go</a></li>
<li><a href="/gostd/net/http/jar.go.html">jar.go</a></li>
<li><a href="/gostd/net/http/lex.go.html">lex.go</a></li>
<li><a href="/gostd/net/http/lex_test.go.html">lex_test.go</a></li>
<li><a href="/gostd/net/http/main_test.go.html">main_test.go</a></li>
<li><a href="/gostd/net/http/npn_test.go.html">npn_test.go</a></li>
<li><a href="/gostd/net/http/proxy_test.go.html">proxy_test.go</a></li>
<li><a href="/gostd/net/http/range_test.go.html">range_test.go</a></li>
<li><a href="/gostd/net/http/readrequest_test.go.html">readrequest_test.go</a></li>
<li><a href="/gostd/net/http/request.go.html" class="current">request.go</a></li>
<li><a href="/gostd/net/http/request_test.go.html">request_test.go</a></li>
<li><a href="/gostd/net/http/requestwrite_test.go.html">requestwrite_test.go</a></li>
<li><a href="/gostd/net/http/response.go.html">response.go</a></li>
<li><a href="/gostd/net/http/response_test.go.html">response_test.go</a></li>
<li><a href="/gostd/net/http/responsewrite_test.go.html">responsewrite_test.go</a></li>
<li><a href="/gostd/net/http/serve_test.go.html">serve_test.go</a></li>
<li><a href="/gostd/net/http/server.go.html">server.go</a></li>
<li><a href="/gostd/net/http/sniff.go.html">sniff.go</a></li>
<li><a href="/gostd/net/http/sniff_test.go.html">sniff_test.go</a></li>
<li><a href="/gostd/net/http/status.go.html">status.go</a></li>
<li><a href="/gostd/net/http/transfer.go.html">transfer.go</a></li>
<li><a href="/gostd/net/http/transfer_test.go.html">transfer_test.go</a></li>
<li><a href="/gostd/net/http/transport.go.html">transport.go</a></li>
<li><a href="/gostd/net/http/transport_test.go.html">transport_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3841612">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3841667">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3841721">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3841772">//&nbsp;HTTP&nbsp;Request&nbsp;reading&nbsp;and&nbsp;parsing.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3841810">package</span>&nbsp;<span class="ident" id="3841818">http</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3841824">import</span>&nbsp;<span class="op" id="3841831">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3841834">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3841843">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3841852">&#34;crypto/tls&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3841866">&#34;encoding/base64&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3841885">&#34;errors&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3841895">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3841902">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3841908">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3841921">&#34;mime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3841929">&#34;mime/multipart&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3841947">&#34;net/textproto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3841964">&#34;net/url&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3841975">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3841986">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3841997">&#34;sync&#34;</span><br>
<span class="lineno">25</span><span class="op" id="3842004">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3842007">const</span>&nbsp;<span class="op" id="3842013">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3842016">maxValueLength</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3842033">=</span>&nbsp;<span class="num" id="3842035">4096</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3842041">maxHeaderLines</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3842058">=</span>&nbsp;<span class="num" id="3842060">1024</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3842066">chunkSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3842083">=</span>&nbsp;<span class="num" id="3842085">4</span>&nbsp;<span class="op" id="3842087">&lt;&lt;</span>&nbsp;<span class="num" id="3842090">10</span>&nbsp;&nbsp;<span class="comment" id="3842094">//&nbsp;4&nbsp;KB&nbsp;chunks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3842110">defaultMaxMemory</span>&nbsp;<span class="op" id="3842127">=</span>&nbsp;<span class="num" id="3842129">32</span>&nbsp;<span class="op" id="3842132">&lt;&lt;</span>&nbsp;<span class="num" id="3842135">20</span>&nbsp;<span class="comment" id="3842138">//&nbsp;32&nbsp;MB</span><br>
<span class="lineno"></span><span class="op" id="3842147">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3842150">//&nbsp;ErrMissingFile&nbsp;is&nbsp;returned&nbsp;by&nbsp;FormFile&nbsp;when&nbsp;the&nbsp;provided&nbsp;file&nbsp;field&nbsp;name</span><br>
<span class="lineno">35</span><span class="comment" id="3842226">//&nbsp;is&nbsp;either&nbsp;not&nbsp;present&nbsp;in&nbsp;the&nbsp;request&nbsp;or&nbsp;not&nbsp;a&nbsp;file&nbsp;field.</span><br>
<span class="lineno"></span><span class="keyword" id="3842287">var</span>&nbsp;<span class="ident" id="3842291">ErrMissingFile</span>&nbsp;<span class="op" id="3842306">=</span>&nbsp;<span class="ident" id="3842308">errors</span><span class="op" id="3842314">.</span><span class="ident" id="3842315">New</span><span class="op" id="3842318">(</span><span class="string" id="3842319">&#34;http:&nbsp;no&nbsp;such&nbsp;file&#34;</span><span class="op" id="3842339">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3842342">//&nbsp;HTTP&nbsp;request&nbsp;parsing&nbsp;errors.</span><br>
<span class="lineno"></span><span class="keyword" id="3842374">type</span>&nbsp;<span class="ident" id="3842379">ProtocolError</span>&nbsp;<span class="keyword" id="3842393">struct</span>&nbsp;<span class="op" id="3842400">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3842403">ErrorString</span>&nbsp;<span class="builtintype" id="3842415">string</span><br>
<span class="lineno"></span><span class="op" id="3842422">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3842425">func</span>&nbsp;<span class="op" id="3842430">(</span><span class="ident" id="3842431">err</span>&nbsp;<span class="op" id="3842435">*</span><span class="ident" id="3842436">ProtocolError</span><span class="op" id="3842449">)</span>&nbsp;<span class="ident" id="3842451">Error</span><span class="op" id="3842456">(</span><span class="op" id="3842457">)</span>&nbsp;<span class="builtintype" id="3842459">string</span>&nbsp;<span class="op" id="3842466">{</span>&nbsp;<span class="keyword" id="3842468">return</span>&nbsp;<span class="ident" id="3842475">err</span><span class="op" id="3842478">.</span><span class="ident" id="3842479">ErrorString</span>&nbsp;<span class="op" id="3842491">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="3842494">var</span>&nbsp;<span class="op" id="3842498">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3842501">ErrHeaderTooLong</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3842525">=</span>&nbsp;<span class="op" id="3842527">&amp;</span><span class="ident" id="3842528">ProtocolError</span><span class="op" id="3842541">{</span><span class="string" id="3842542">&#34;header&nbsp;too&nbsp;long&#34;</span><span class="op" id="3842559">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3842562">ErrShortBody</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3842586">=</span>&nbsp;<span class="op" id="3842588">&amp;</span><span class="ident" id="3842589">ProtocolError</span><span class="op" id="3842602">{</span><span class="string" id="3842603">&#34;entity&nbsp;body&nbsp;too&nbsp;short&#34;</span><span class="op" id="3842626">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3842629">ErrNotSupported</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3842653">=</span>&nbsp;<span class="op" id="3842655">&amp;</span><span class="ident" id="3842656">ProtocolError</span><span class="op" id="3842669">{</span><span class="string" id="3842670">&#34;feature&nbsp;not&nbsp;supported&#34;</span><span class="op" id="3842693">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3842696">ErrUnexpectedTrailer</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3842720">=</span>&nbsp;<span class="op" id="3842722">&amp;</span><span class="ident" id="3842723">ProtocolError</span><span class="op" id="3842736">{</span><span class="string" id="3842737">&#34;trailer&nbsp;header&nbsp;without&nbsp;chunked&nbsp;transfer&nbsp;encoding&#34;</span><span class="op" id="3842787">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3842790">ErrMissingContentLength</span>&nbsp;<span class="op" id="3842814">=</span>&nbsp;<span class="op" id="3842816">&amp;</span><span class="ident" id="3842817">ProtocolError</span><span class="op" id="3842830">{</span><span class="string" id="3842831">&#34;missing&nbsp;ContentLength&nbsp;in&nbsp;HEAD&nbsp;response&#34;</span><span class="op" id="3842871">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3842874">ErrNotMultipart</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3842898">=</span>&nbsp;<span class="op" id="3842900">&amp;</span><span class="ident" id="3842901">ProtocolError</span><span class="op" id="3842914">{</span><span class="string" id="3842915">&#34;request&nbsp;Content-Type&nbsp;isn&#39;t&nbsp;multipart/form-data&#34;</span><span class="op" id="3842963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3842966">ErrMissingBoundary</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3842990">=</span>&nbsp;<span class="op" id="3842992">&amp;</span><span class="ident" id="3842993">ProtocolError</span><span class="op" id="3843006">{</span><span class="string" id="3843007">&#34;no&nbsp;multipart&nbsp;boundary&nbsp;param&nbsp;in&nbsp;Content-Type&#34;</span><span class="op" id="3843052">}</span><br>
<span class="lineno"></span><span class="op" id="3843054">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="3843057">type</span>&nbsp;<span class="ident" id="3843062">badStringError</span>&nbsp;<span class="keyword" id="3843077">struct</span>&nbsp;<span class="op" id="3843084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3843087">what</span>&nbsp;<span class="builtintype" id="3843092">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3843100">str</span>&nbsp;&nbsp;<span class="builtintype" id="3843105">string</span><br>
<span class="lineno"></span><span class="op" id="3843112">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="keyword" id="3843115">func</span>&nbsp;<span class="op" id="3843120">(</span><span class="ident" id="3843121">e</span>&nbsp;<span class="op" id="3843123">*</span><span class="ident" id="3843124">badStringError</span><span class="op" id="3843138">)</span>&nbsp;<span class="ident" id="3843140">Error</span><span class="op" id="3843145">(</span><span class="op" id="3843146">)</span>&nbsp;<span class="builtintype" id="3843148">string</span>&nbsp;<span class="op" id="3843155">{</span>&nbsp;<span class="keyword" id="3843157">return</span>&nbsp;<span class="ident" id="3843164">fmt</span><span class="op" id="3843167">.</span><span class="ident" id="3843168">Sprintf</span><span class="op" id="3843175">(</span><span class="string" id="3843176">&#34;%s&nbsp;%q&#34;</span><span class="op" id="3843183">,</span>&nbsp;<span class="ident" id="3843185">e</span><span class="op" id="3843186">.</span><span class="ident" id="3843187">what</span><span class="op" id="3843191">,</span>&nbsp;<span class="ident" id="3843193">e</span><span class="op" id="3843194">.</span><span class="ident" id="3843195">str</span><span class="op" id="3843198">)</span>&nbsp;<span class="op" id="3843200">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3843203">//&nbsp;Headers&nbsp;that&nbsp;Request.Write&nbsp;handles&nbsp;itself&nbsp;and&nbsp;should&nbsp;be&nbsp;skipped.</span><br>
<span class="lineno"></span><span class="keyword" id="3843271">var</span>&nbsp;<span class="ident" id="3843275">reqWriteExcludeHeader</span>&nbsp;<span class="op" id="3843297">=</span>&nbsp;<span class="keyword" id="3843299">map</span><span class="op" id="3843302">[</span><span class="builtintype" id="3843303">string</span><span class="op" id="3843309">]</span><span class="builtintype" id="3843310">bool</span><span class="op" id="3843314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3843317">&#34;Host&#34;</span><span class="op" id="3843323">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3843338">true</span><span class="op" id="3843342">,</span>&nbsp;<span class="comment" id="3843344">//&nbsp;not&nbsp;in&nbsp;Header&nbsp;map&nbsp;anyway</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3843373">&#34;User-Agent&#34;</span><span class="op" id="3843385">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3843394">true</span><span class="op" id="3843398">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3843401">&#34;Content-Length&#34;</span><span class="op" id="3843417">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3843422">true</span><span class="op" id="3843426">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3843429">&#34;Transfer-Encoding&#34;</span><span class="op" id="3843448">:</span>&nbsp;<span class="builtintype" id="3843450">true</span><span class="op" id="3843454">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3843457">&#34;Trailer&#34;</span><span class="op" id="3843466">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3843478">true</span><span class="op" id="3843482">,</span><br>
<span class="lineno"></span><span class="op" id="3843484">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="comment" id="3843487">//&nbsp;A&nbsp;Request&nbsp;represents&nbsp;an&nbsp;HTTP&nbsp;request&nbsp;received&nbsp;by&nbsp;a&nbsp;server</span><br>
<span class="lineno"></span><span class="comment" id="3843548">//&nbsp;or&nbsp;to&nbsp;be&nbsp;sent&nbsp;by&nbsp;a&nbsp;client.</span><br>
<span class="lineno"></span><span class="comment" id="3843578">//</span><br>
<span class="lineno"></span><span class="comment" id="3843581">//&nbsp;The&nbsp;field&nbsp;semantics&nbsp;differ&nbsp;slightly&nbsp;between&nbsp;client&nbsp;and&nbsp;server</span><br>
<span class="lineno">75</span><span class="comment" id="3843646">//&nbsp;usage.&nbsp;In&nbsp;addition&nbsp;to&nbsp;the&nbsp;notes&nbsp;on&nbsp;the&nbsp;fields&nbsp;below,&nbsp;see&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3843710">//&nbsp;documentation&nbsp;for&nbsp;Request.Write&nbsp;and&nbsp;RoundTripper.</span><br>
<span class="lineno"></span><span class="keyword" id="3843763">type</span>&nbsp;<span class="ident" id="3843768">Request</span>&nbsp;<span class="keyword" id="3843776">struct</span>&nbsp;<span class="op" id="3843783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3843786">//&nbsp;Method&nbsp;specifies&nbsp;the&nbsp;HTTP&nbsp;method&nbsp;(GET,&nbsp;POST,&nbsp;PUT,&nbsp;etc.).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3843847">//&nbsp;For&nbsp;client&nbsp;requests&nbsp;an&nbsp;empty&nbsp;string&nbsp;means&nbsp;GET.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3843898">Method</span>&nbsp;<span class="builtintype" id="3843905">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3843914">//&nbsp;URL&nbsp;specifies&nbsp;either&nbsp;the&nbsp;URI&nbsp;being&nbsp;requested&nbsp;(for&nbsp;server</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3843975">//&nbsp;requests)&nbsp;or&nbsp;the&nbsp;URL&nbsp;to&nbsp;access&nbsp;(for&nbsp;client&nbsp;requests).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3844033">//</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3844037">//&nbsp;For&nbsp;server&nbsp;requests&nbsp;the&nbsp;URL&nbsp;is&nbsp;parsed&nbsp;from&nbsp;the&nbsp;URI</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3844092">//&nbsp;supplied&nbsp;on&nbsp;the&nbsp;Request-Line&nbsp;as&nbsp;stored&nbsp;in&nbsp;RequestURI.&nbsp;&nbsp;For</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3844155">//&nbsp;most&nbsp;requests,&nbsp;fields&nbsp;other&nbsp;than&nbsp;Path&nbsp;and&nbsp;RawQuery&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3844218">//&nbsp;empty.&nbsp;(See&nbsp;RFC&nbsp;2616,&nbsp;Section&nbsp;5.1.2)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3844259">//</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3844263">//&nbsp;For&nbsp;client&nbsp;requests,&nbsp;the&nbsp;URL&#39;s&nbsp;Host&nbsp;specifies&nbsp;the&nbsp;server&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3844327">//&nbsp;connect&nbsp;to,&nbsp;while&nbsp;the&nbsp;Request&#39;s&nbsp;Host&nbsp;field&nbsp;optionally</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3844385">//&nbsp;specifies&nbsp;the&nbsp;Host&nbsp;header&nbsp;value&nbsp;to&nbsp;send&nbsp;in&nbsp;the&nbsp;HTTP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3844441">//&nbsp;request.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3844454">URL</span>&nbsp;<span class="op" id="3844458">*</span><span class="ident" id="3844459">url</span><span class="op" id="3844462">.</span><span class="ident" id="3844463">URL</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3844469">//&nbsp;The&nbsp;protocol&nbsp;version&nbsp;for&nbsp;incoming&nbsp;requests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3844517">//&nbsp;Client&nbsp;requests&nbsp;always&nbsp;use&nbsp;HTTP/1.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3844558">Proto</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3844569">string</span>&nbsp;<span class="comment" id="3844576">//&nbsp;&#34;HTTP/1.0&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3844591">ProtoMajor</span>&nbsp;<span class="builtintype" id="3844602">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3844609">//&nbsp;1</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3844615">ProtoMinor</span>&nbsp;<span class="builtintype" id="3844626">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3844633">//&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3844640">//&nbsp;A&nbsp;header&nbsp;maps&nbsp;request&nbsp;lines&nbsp;to&nbsp;their&nbsp;values.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3844689">//&nbsp;If&nbsp;the&nbsp;header&nbsp;says</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3844712">//</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3844716">//&nbsp;&nbsp;&nbsp;&nbspaccept-encoding:&nbsp;gzip,&nbsp;deflate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3844751">//&nbsp;&nbsp;&nbsp;&nbspAccept-Language:&nbsp;en-us</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3844778">//&nbsp;&nbsp;&nbsp;&nbspConnection:&nbsp;keep-alive</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3844805">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3844809">//&nbsp;then</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3844818">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3844822">//&nbsp;&nbsp;&nbsp;&nbspHeader&nbsp;=&nbsp;map[string][]string{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3844856">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&#34;Accept-Encoding&#34;:&nbsp;{&#34;gzip,&nbsp;deflate&#34;},</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3844899">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&#34;Accept-Language&#34;:&nbsp;{&#34;en-us&#34;},</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3844934">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&#34;Connection&#34;:&nbsp;{&#34;keep-alive&#34;},</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3844969">//&nbsp;&nbsp;&nbsp;&nbsp}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3844975">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3844979">//&nbsp;HTTP&nbsp;defines&nbsp;that&nbsp;header&nbsp;names&nbsp;are&nbsp;case-insensitive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3845036">//&nbsp;The&nbsp;request&nbsp;parser&nbsp;implements&nbsp;this&nbsp;by&nbsp;canonicalizing&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3845097">//&nbsp;name,&nbsp;making&nbsp;the&nbsp;first&nbsp;character&nbsp;and&nbsp;any&nbsp;characters</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3845153">//&nbsp;following&nbsp;a&nbsp;hyphen&nbsp;uppercase&nbsp;and&nbsp;the&nbsp;rest&nbsp;lowercase.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3845210">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3845214">//&nbsp;For&nbsp;client&nbsp;requests&nbsp;certain&nbsp;headers&nbsp;are&nbsp;automatically</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3845272">//&nbsp;added&nbsp;and&nbsp;may&nbsp;override&nbsp;values&nbsp;in&nbsp;Header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3845317">//</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3845321">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;the&nbsp;Request.Write&nbsp;method.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3845377">Header</span>&nbsp;<span class="ident" id="3845384">Header</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3845393">//&nbsp;Body&nbsp;is&nbsp;the&nbsp;request&#39;s&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3845425">//</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3845429">//&nbsp;For&nbsp;client&nbsp;requests&nbsp;a&nbsp;nil&nbsp;body&nbsp;means&nbsp;the&nbsp;request&nbsp;has&nbsp;no</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3845489">//&nbsp;body,&nbsp;such&nbsp;as&nbsp;a&nbsp;GET&nbsp;request.&nbsp;The&nbsp;HTTP&nbsp;Client&#39;s&nbsp;Transport</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3845550">//&nbsp;is&nbsp;responsible&nbsp;for&nbsp;calling&nbsp;the&nbsp;Close&nbsp;method.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3845599">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3845603">//&nbsp;For&nbsp;server&nbsp;requests&nbsp;the&nbsp;Request&nbsp;Body&nbsp;is&nbsp;always&nbsp;non-nil</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3845662">//&nbsp;but&nbsp;will&nbsp;return&nbsp;EOF&nbsp;immediately&nbsp;when&nbsp;no&nbsp;body&nbsp;is&nbsp;present.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3845723">//&nbsp;The&nbsp;Server&nbsp;will&nbsp;close&nbsp;the&nbsp;request&nbsp;body.&nbsp;The&nbsp;ServeHTTP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3845781">//&nbsp;Handler&nbsp;does&nbsp;not&nbsp;need&nbsp;to.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3845811">Body</span>&nbsp;<span class="ident" id="3845816">io</span><span class="op" id="3845818">.</span><span class="ident" id="3845819">ReadCloser</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3845832">//&nbsp;ContentLength&nbsp;records&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;associated&nbsp;content.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3845896">//&nbsp;The&nbsp;value&nbsp;-1&nbsp;indicates&nbsp;that&nbsp;the&nbsp;length&nbsp;is&nbsp;unknown.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3845951">//&nbsp;Values&nbsp;&gt;=&nbsp;0&nbsp;indicate&nbsp;that&nbsp;the&nbsp;given&nbsp;number&nbsp;of&nbsp;bytes&nbsp;may</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3846011">//&nbsp;be&nbsp;read&nbsp;from&nbsp;Body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3846034">//&nbsp;For&nbsp;client&nbsp;requests,&nbsp;a&nbsp;value&nbsp;of&nbsp;0&nbsp;means&nbsp;unknown&nbsp;if&nbsp;Body&nbsp;is&nbsp;not&nbsp;nil.</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3846106">ContentLength</span>&nbsp;<span class="ident" id="3846120">int64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3846128">//&nbsp;TransferEncoding&nbsp;lists&nbsp;the&nbsp;transfer&nbsp;encodings&nbsp;from&nbsp;outermost&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3846196">//&nbsp;innermost.&nbsp;An&nbsp;empty&nbsp;list&nbsp;denotes&nbsp;the&nbsp;&#34;identity&#34;&nbsp;encoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3846258">//&nbsp;TransferEncoding&nbsp;can&nbsp;usually&nbsp;be&nbsp;ignored;&nbsp;chunked&nbsp;encoding&nbsp;is</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3846323">//&nbsp;automatically&nbsp;added&nbsp;and&nbsp;removed&nbsp;as&nbsp;necessary&nbsp;when&nbsp;sending&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3846389">//&nbsp;receiving&nbsp;requests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3846413">TransferEncoding</span>&nbsp;<span class="op" id="3846430">[</span><span class="op" id="3846431">]</span><span class="builtintype" id="3846432">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3846441">//&nbsp;Close&nbsp;indicates&nbsp;whether&nbsp;to&nbsp;close&nbsp;the&nbsp;connection&nbsp;after</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3846499">//&nbsp;replying&nbsp;to&nbsp;this&nbsp;request&nbsp;(for&nbsp;servers)&nbsp;or&nbsp;after&nbsp;sending</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3846559">//&nbsp;the&nbsp;request&nbsp;(for&nbsp;clients).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3846590">Close</span>&nbsp;<span class="builtintype" id="3846596">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3846603">//&nbsp;For&nbsp;server&nbsp;requests&nbsp;Host&nbsp;specifies&nbsp;the&nbsp;host&nbsp;on&nbsp;which&nbsp;the</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3846664">//&nbsp;URL&nbsp;is&nbsp;sought.&nbsp;Per&nbsp;RFC&nbsp;2616,&nbsp;this&nbsp;is&nbsp;either&nbsp;the&nbsp;value&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3846725">//&nbsp;the&nbsp;&#34;Host&#34;&nbsp;header&nbsp;or&nbsp;the&nbsp;host&nbsp;name&nbsp;given&nbsp;in&nbsp;the&nbsp;URL&nbsp;itself.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3846789">//&nbsp;It&nbsp;may&nbsp;be&nbsp;of&nbsp;the&nbsp;form&nbsp;&#34;host:port&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3846828">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3846832">//&nbsp;For&nbsp;client&nbsp;requests&nbsp;Host&nbsp;optionally&nbsp;overrides&nbsp;the&nbsp;Host</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3846891">//&nbsp;header&nbsp;to&nbsp;send.&nbsp;If&nbsp;empty,&nbsp;the&nbsp;Request.Write&nbsp;method&nbsp;uses</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3846951">//&nbsp;the&nbsp;value&nbsp;of&nbsp;URL.Host.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3846978">Host</span>&nbsp;<span class="builtintype" id="3846983">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3846992">//&nbsp;Form&nbsp;contains&nbsp;the&nbsp;parsed&nbsp;form&nbsp;data,&nbsp;including&nbsp;both&nbsp;the&nbsp;URL</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3847055">//&nbsp;field&#39;s&nbsp;query&nbsp;parameters&nbsp;and&nbsp;the&nbsp;POST&nbsp;or&nbsp;PUT&nbsp;form&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3847115">//&nbsp;This&nbsp;field&nbsp;is&nbsp;only&nbsp;available&nbsp;after&nbsp;ParseForm&nbsp;is&nbsp;called.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3847175">//&nbsp;The&nbsp;HTTP&nbsp;client&nbsp;ignores&nbsp;Form&nbsp;and&nbsp;uses&nbsp;Body&nbsp;instead.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3847231">Form</span>&nbsp;<span class="ident" id="3847236">url</span><span class="op" id="3847239">.</span><span class="ident" id="3847240">Values</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3847249">//&nbsp;PostForm&nbsp;contains&nbsp;the&nbsp;parsed&nbsp;form&nbsp;data&nbsp;from&nbsp;POST&nbsp;or&nbsp;PUT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3847309">//&nbsp;body&nbsp;parameters.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3847330">//&nbsp;This&nbsp;field&nbsp;is&nbsp;only&nbsp;available&nbsp;after&nbsp;ParseForm&nbsp;is&nbsp;called.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3847390">//&nbsp;The&nbsp;HTTP&nbsp;client&nbsp;ignores&nbsp;PostForm&nbsp;and&nbsp;uses&nbsp;Body&nbsp;instead.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3847450">PostForm</span>&nbsp;<span class="ident" id="3847459">url</span><span class="op" id="3847462">.</span><span class="ident" id="3847463">Values</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3847472">//&nbsp;MultipartForm&nbsp;is&nbsp;the&nbsp;parsed&nbsp;multipart&nbsp;form,&nbsp;including&nbsp;file&nbsp;uploads.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3847544">//&nbsp;This&nbsp;field&nbsp;is&nbsp;only&nbsp;available&nbsp;after&nbsp;ParseMultipartForm&nbsp;is&nbsp;called.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3847613">//&nbsp;The&nbsp;HTTP&nbsp;client&nbsp;ignores&nbsp;MultipartForm&nbsp;and&nbsp;uses&nbsp;Body&nbsp;instead.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3847678">MultipartForm</span>&nbsp;<span class="op" id="3847692">*</span><span class="ident" id="3847693">multipart</span><span class="op" id="3847702">.</span><span class="ident" id="3847703">Form</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3847710">//&nbsp;Trailer&nbsp;specifies&nbsp;additional&nbsp;headers&nbsp;that&nbsp;are&nbsp;sent&nbsp;after&nbsp;the&nbsp;request</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3847783">//&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3847793">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3847797">//&nbsp;For&nbsp;server&nbsp;requests&nbsp;the&nbsp;Trailer&nbsp;map&nbsp;initially&nbsp;contains&nbsp;only&nbsp;the</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3847865">//&nbsp;trailer&nbsp;keys,&nbsp;with&nbsp;nil&nbsp;values.&nbsp;(The&nbsp;client&nbsp;declares&nbsp;which&nbsp;trailers&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3847939">//&nbsp;will&nbsp;later&nbsp;send.)&nbsp;&nbsp;While&nbsp;the&nbsp;handler&nbsp;is&nbsp;reading&nbsp;from&nbsp;Body,&nbsp;it&nbsp;must</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3848010">//&nbsp;not&nbsp;reference&nbsp;Trailer.&nbsp;After&nbsp;reading&nbsp;from&nbsp;Body&nbsp;returns&nbsp;EOF,&nbsp;Trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3848082">//&nbsp;can&nbsp;be&nbsp;read&nbsp;again&nbsp;and&nbsp;will&nbsp;contain&nbsp;non-nil&nbsp;values,&nbsp;if&nbsp;they&nbsp;were&nbsp;sent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3848155">//&nbsp;by&nbsp;the&nbsp;client.</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3848174">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3848178">//&nbsp;For&nbsp;client&nbsp;requests&nbsp;Trailer&nbsp;must&nbsp;be&nbsp;initialized&nbsp;to&nbsp;a&nbsp;map&nbsp;containing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3848250">//&nbsp;the&nbsp;trailer&nbsp;keys&nbsp;to&nbsp;later&nbsp;send.&nbsp;The&nbsp;values&nbsp;may&nbsp;be&nbsp;nil&nbsp;or&nbsp;their&nbsp;final</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3848323">//&nbsp;values.&nbsp;The&nbsp;ContentLength&nbsp;must&nbsp;be&nbsp;0&nbsp;or&nbsp;-1,&nbsp;to&nbsp;send&nbsp;a&nbsp;chunked&nbsp;request.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3848397">//&nbsp;After&nbsp;the&nbsp;HTTP&nbsp;request&nbsp;is&nbsp;sent&nbsp;the&nbsp;map&nbsp;values&nbsp;can&nbsp;be&nbsp;updated&nbsp;while</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3848468">//&nbsp;the&nbsp;request&nbsp;body&nbsp;is&nbsp;read.&nbsp;Once&nbsp;the&nbsp;body&nbsp;returns&nbsp;EOF,&nbsp;the&nbsp;caller&nbsp;must</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3848541">//&nbsp;not&nbsp;mutate&nbsp;Trailer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3848565">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3848569">//&nbsp;Few&nbsp;HTTP&nbsp;clients,&nbsp;servers,&nbsp;or&nbsp;proxies&nbsp;support&nbsp;HTTP&nbsp;trailers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3848634">Trailer</span>&nbsp;<span class="ident" id="3848642">Header</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3848651">//&nbsp;RemoteAddr&nbsp;allows&nbsp;HTTP&nbsp;servers&nbsp;and&nbsp;other&nbsp;software&nbsp;to&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3848715">//&nbsp;the&nbsp;network&nbsp;address&nbsp;that&nbsp;sent&nbsp;the&nbsp;request,&nbsp;usually&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3848774">//&nbsp;logging.&nbsp;This&nbsp;field&nbsp;is&nbsp;not&nbsp;filled&nbsp;in&nbsp;by&nbsp;ReadRequest&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3848834">//&nbsp;has&nbsp;no&nbsp;defined&nbsp;format.&nbsp;The&nbsp;HTTP&nbsp;server&nbsp;in&nbsp;this&nbsp;package</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3848893">//&nbsp;sets&nbsp;RemoteAddr&nbsp;to&nbsp;an&nbsp;&#34;IP:port&#34;&nbsp;address&nbsp;before&nbsp;invoking&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3848955">//&nbsp;handler.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3848968">//&nbsp;This&nbsp;field&nbsp;is&nbsp;ignored&nbsp;by&nbsp;the&nbsp;HTTP&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3849014">RemoteAddr</span>&nbsp;<span class="builtintype" id="3849025">string</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3849034">//&nbsp;RequestURI&nbsp;is&nbsp;the&nbsp;unmodified&nbsp;Request-URI&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3849086">//&nbsp;Request-Line&nbsp;(RFC&nbsp;2616,&nbsp;Section&nbsp;5.1)&nbsp;as&nbsp;sent&nbsp;by&nbsp;the&nbsp;client</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3849149">//&nbsp;to&nbsp;a&nbsp;server.&nbsp;Usually&nbsp;the&nbsp;URL&nbsp;field&nbsp;should&nbsp;be&nbsp;used&nbsp;instead.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3849212">//&nbsp;It&nbsp;is&nbsp;an&nbsp;error&nbsp;to&nbsp;set&nbsp;this&nbsp;field&nbsp;in&nbsp;an&nbsp;HTTP&nbsp;client&nbsp;request.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3849276">RequestURI</span>&nbsp;<span class="builtintype" id="3849287">string</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3849296">//&nbsp;TLS&nbsp;allows&nbsp;HTTP&nbsp;servers&nbsp;and&nbsp;other&nbsp;software&nbsp;to&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3849353">//&nbsp;information&nbsp;about&nbsp;the&nbsp;TLS&nbsp;connection&nbsp;on&nbsp;which&nbsp;the&nbsp;request</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3849415">//&nbsp;was&nbsp;received.&nbsp;This&nbsp;field&nbsp;is&nbsp;not&nbsp;filled&nbsp;in&nbsp;by&nbsp;ReadRequest.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3849477">//&nbsp;The&nbsp;HTTP&nbsp;server&nbsp;in&nbsp;this&nbsp;package&nbsp;sets&nbsp;the&nbsp;field&nbsp;for</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3849532">//&nbsp;TLS-enabled&nbsp;connections&nbsp;before&nbsp;invoking&nbsp;a&nbsp;handler;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3849587">//&nbsp;otherwise&nbsp;it&nbsp;leaves&nbsp;the&nbsp;field&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3849626">//&nbsp;This&nbsp;field&nbsp;is&nbsp;ignored&nbsp;by&nbsp;the&nbsp;HTTP&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3849672">TLS</span>&nbsp;<span class="op" id="3849676">*</span><span class="ident" id="3849677">tls</span><span class="op" id="3849680">.</span><span class="ident" id="3849681">ConnectionState</span><br>
<span class="lineno"></span><span class="op" id="3849697">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="3849700">//&nbsp;ProtoAtLeast&nbsp;reports&nbsp;whether&nbsp;the&nbsp;HTTP&nbsp;protocol&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="3849755">//&nbsp;in&nbsp;the&nbsp;request&nbsp;is&nbsp;at&nbsp;least&nbsp;major.minor.</span><br>
<span class="lineno"></span><span class="keyword" id="3849798">func</span>&nbsp;<span class="op" id="3849803">(</span><span class="ident" id="3849804">r</span>&nbsp;<span class="op" id="3849806">*</span><span class="ident" id="3849807">Request</span><span class="op" id="3849814">)</span>&nbsp;<span class="ident" id="3849816">ProtoAtLeast</span><span class="op" id="3849828">(</span><span class="ident" id="3849829">major</span><span class="op" id="3849834">,</span>&nbsp;<span class="ident" id="3849836">minor</span>&nbsp;<span class="builtintype" id="3849842">int</span><span class="op" id="3849845">)</span>&nbsp;<span class="builtintype" id="3849847">bool</span>&nbsp;<span class="op" id="3849852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3849855">return</span>&nbsp;<span class="ident" id="3849862">r</span><span class="op" id="3849863">.</span><span class="ident" id="3849864">ProtoMajor</span>&nbsp;<span class="op" id="3849875">&gt;</span>&nbsp;<span class="ident" id="3849877">major</span>&nbsp;<span class="op" id="3849883">||</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3849888">r</span><span class="op" id="3849889">.</span><span class="ident" id="3849890">ProtoMajor</span>&nbsp;<span class="op" id="3849901">==</span>&nbsp;<span class="ident" id="3849904">major</span>&nbsp;<span class="op" id="3849910">&amp;&amp;</span>&nbsp;<span class="ident" id="3849913">r</span><span class="op" id="3849914">.</span><span class="ident" id="3849915">ProtoMinor</span>&nbsp;<span class="op" id="3849926">&gt;=</span>&nbsp;<span class="ident" id="3849929">minor</span><br>
<span class="lineno"></span><span class="op" id="3849935">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3849938">//&nbsp;UserAgent&nbsp;returns&nbsp;the&nbsp;client&#39;s&nbsp;User-Agent,&nbsp;if&nbsp;sent&nbsp;in&nbsp;the&nbsp;request.</span><br>
<span class="lineno"></span><span class="keyword" id="3850008">func</span>&nbsp;<span class="op" id="3850013">(</span><span class="ident" id="3850014">r</span>&nbsp;<span class="op" id="3850016">*</span><span class="ident" id="3850017">Request</span><span class="op" id="3850024">)</span>&nbsp;<span class="ident" id="3850026">UserAgent</span><span class="op" id="3850035">(</span><span class="op" id="3850036">)</span>&nbsp;<span class="builtintype" id="3850038">string</span>&nbsp;<span class="op" id="3850045">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3850048">return</span>&nbsp;<span class="ident" id="3850055">r</span><span class="op" id="3850056">.</span><span class="ident" id="3850057">Header</span><span class="op" id="3850063">.</span><span class="ident" id="3850064">Get</span><span class="op" id="3850067">(</span><span class="string" id="3850068">&#34;User-Agent&#34;</span><span class="op" id="3850080">)</span><br>
<span class="lineno"></span><span class="op" id="3850082">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3850085">//&nbsp;Cookies&nbsp;parses&nbsp;and&nbsp;returns&nbsp;the&nbsp;HTTP&nbsp;cookies&nbsp;sent&nbsp;with&nbsp;the&nbsp;request.</span><br>
<span class="lineno"></span><span class="keyword" id="3850155">func</span>&nbsp;<span class="op" id="3850160">(</span><span class="ident" id="3850161">r</span>&nbsp;<span class="op" id="3850163">*</span><span class="ident" id="3850164">Request</span><span class="op" id="3850171">)</span>&nbsp;<span class="ident" id="3850173">Cookies</span><span class="op" id="3850180">(</span><span class="op" id="3850181">)</span>&nbsp;<span class="op" id="3850183">[</span><span class="op" id="3850184">]</span><span class="op" id="3850185">*</span><span class="ident" id="3850186">Cookie</span>&nbsp;<span class="op" id="3850193">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3850196">return</span>&nbsp;<span class="ident" id="3850203">readCookies</span><span class="op" id="3850214">(</span><span class="ident" id="3850215">r</span><span class="op" id="3850216">.</span><span class="ident" id="3850217">Header</span><span class="op" id="3850223">,</span>&nbsp;<span class="string" id="3850225">&#34;&#34;</span><span class="op" id="3850227">)</span><br>
<span class="lineno"></span><span class="op" id="3850229">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3850232">var</span>&nbsp;<span class="ident" id="3850236">ErrNoCookie</span>&nbsp;<span class="op" id="3850248">=</span>&nbsp;<span class="ident" id="3850250">errors</span><span class="op" id="3850256">.</span><span class="ident" id="3850257">New</span><span class="op" id="3850260">(</span><span class="string" id="3850261">&#34;http:&nbsp;named&nbsp;cookie&nbsp;not&nbsp;present&#34;</span><span class="op" id="3850293">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="comment" id="3850296">//&nbsp;Cookie&nbsp;returns&nbsp;the&nbsp;named&nbsp;cookie&nbsp;provided&nbsp;in&nbsp;the&nbsp;request&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="3850358">//&nbsp;ErrNoCookie&nbsp;if&nbsp;not&nbsp;found.</span><br>
<span class="lineno"></span><span class="keyword" id="3850387">func</span>&nbsp;<span class="op" id="3850392">(</span><span class="ident" id="3850393">r</span>&nbsp;<span class="op" id="3850395">*</span><span class="ident" id="3850396">Request</span><span class="op" id="3850403">)</span>&nbsp;<span class="ident" id="3850405">Cookie</span><span class="op" id="3850411">(</span><span class="ident" id="3850412">name</span>&nbsp;<span class="builtintype" id="3850417">string</span><span class="op" id="3850423">)</span>&nbsp;<span class="op" id="3850425">(</span><span class="op" id="3850426">*</span><span class="ident" id="3850427">Cookie</span><span class="op" id="3850433">,</span>&nbsp;<span class="builtintype" id="3850435">error</span><span class="op" id="3850440">)</span>&nbsp;<span class="op" id="3850442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3850445">for</span>&nbsp;<span class="ident" id="3850449">_</span><span class="op" id="3850450">,</span>&nbsp;<span class="ident" id="3850452">c</span>&nbsp;<span class="op" id="3850454">:=</span>&nbsp;<span class="keyword" id="3850457">range</span>&nbsp;<span class="ident" id="3850463">readCookies</span><span class="op" id="3850474">(</span><span class="ident" id="3850475">r</span><span class="op" id="3850476">.</span><span class="ident" id="3850477">Header</span><span class="op" id="3850483">,</span>&nbsp;<span class="ident" id="3850485">name</span><span class="op" id="3850489">)</span>&nbsp;<span class="op" id="3850491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3850495">return</span>&nbsp;<span class="ident" id="3850502">c</span><span class="op" id="3850503">,</span>&nbsp;<span class="ident" id="3850505">nil</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3850510">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3850513">return</span>&nbsp;<span class="ident" id="3850520">nil</span><span class="op" id="3850523">,</span>&nbsp;<span class="ident" id="3850525">ErrNoCookie</span><br>
<span class="lineno"></span><span class="op" id="3850537">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3850540">//&nbsp;AddCookie&nbsp;adds&nbsp;a&nbsp;cookie&nbsp;to&nbsp;the&nbsp;request.&nbsp;&nbsp;Per&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.4,</span><br>
<span class="lineno">260</span><span class="comment" id="3850610">//&nbsp;AddCookie&nbsp;does&nbsp;not&nbsp;attach&nbsp;more&nbsp;than&nbsp;one&nbsp;Cookie&nbsp;header&nbsp;field.&nbsp;&nbsp;That</span><br>
<span class="lineno"></span><span class="comment" id="3850680">//&nbsp;means&nbsp;all&nbsp;cookies,&nbsp;if&nbsp;any,&nbsp;are&nbsp;written&nbsp;into&nbsp;the&nbsp;same&nbsp;line,</span><br>
<span class="lineno"></span><span class="comment" id="3850742">//&nbsp;separated&nbsp;by&nbsp;semicolon.</span><br>
<span class="lineno"></span><span class="keyword" id="3850769">func</span>&nbsp;<span class="op" id="3850774">(</span><span class="ident" id="3850775">r</span>&nbsp;<span class="op" id="3850777">*</span><span class="ident" id="3850778">Request</span><span class="op" id="3850785">)</span>&nbsp;<span class="ident" id="3850787">AddCookie</span><span class="op" id="3850796">(</span><span class="ident" id="3850797">c</span>&nbsp;<span class="op" id="3850799">*</span><span class="ident" id="3850800">Cookie</span><span class="op" id="3850806">)</span>&nbsp;<span class="op" id="3850808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3850811">s</span>&nbsp;<span class="op" id="3850813">:=</span>&nbsp;<span class="ident" id="3850816">fmt</span><span class="op" id="3850819">.</span><span class="ident" id="3850820">Sprintf</span><span class="op" id="3850827">(</span><span class="string" id="3850828">&#34;%s=%s&#34;</span><span class="op" id="3850835">,</span>&nbsp;<span class="ident" id="3850837">sanitizeCookieName</span><span class="op" id="3850855">(</span><span class="ident" id="3850856">c</span><span class="op" id="3850857">.</span><span class="ident" id="3850858">Name</span><span class="op" id="3850862">)</span><span class="op" id="3850863">,</span>&nbsp;<span class="ident" id="3850865">sanitizeCookieValue</span><span class="op" id="3850884">(</span><span class="ident" id="3850885">c</span><span class="op" id="3850886">.</span><span class="ident" id="3850887">Value</span><span class="op" id="3850892">)</span><span class="op" id="3850893">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3850896">if</span>&nbsp;<span class="ident" id="3850899">c</span>&nbsp;<span class="op" id="3850901">:=</span>&nbsp;<span class="ident" id="3850904">r</span><span class="op" id="3850905">.</span><span class="ident" id="3850906">Header</span><span class="op" id="3850912">.</span><span class="ident" id="3850913">Get</span><span class="op" id="3850916">(</span><span class="string" id="3850917">&#34;Cookie&#34;</span><span class="op" id="3850925">)</span><span class="op" id="3850926">;</span>&nbsp;<span class="ident" id="3850928">c</span>&nbsp;<span class="op" id="3850930">!=</span>&nbsp;<span class="string" id="3850933">&#34;&#34;</span>&nbsp;<span class="op" id="3850936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3850940">r</span><span class="op" id="3850941">.</span><span class="ident" id="3850942">Header</span><span class="op" id="3850948">.</span><span class="ident" id="3850949">Set</span><span class="op" id="3850952">(</span><span class="string" id="3850953">&#34;Cookie&#34;</span><span class="op" id="3850961">,</span>&nbsp;<span class="ident" id="3850963">c</span><span class="op" id="3850964">+</span><span class="string" id="3850965">&#34;;&nbsp;&#34;</span><span class="op" id="3850969">+</span><span class="ident" id="3850970">s</span><span class="op" id="3850971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3850974">}</span>&nbsp;<span class="keyword" id="3850976">else</span>&nbsp;<span class="op" id="3850981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3850985">r</span><span class="op" id="3850986">.</span><span class="ident" id="3850987">Header</span><span class="op" id="3850993">.</span><span class="ident" id="3850994">Set</span><span class="op" id="3850997">(</span><span class="string" id="3850998">&#34;Cookie&#34;</span><span class="op" id="3851006">,</span>&nbsp;<span class="ident" id="3851008">s</span><span class="op" id="3851009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3851012">}</span><br>
<span class="lineno">270</span><span class="op" id="3851014">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3851017">//&nbsp;Referer&nbsp;returns&nbsp;the&nbsp;referring&nbsp;URL,&nbsp;if&nbsp;sent&nbsp;in&nbsp;the&nbsp;request.</span><br>
<span class="lineno"></span><span class="comment" id="3851079">//</span><br>
<span class="lineno"></span><span class="comment" id="3851082">//&nbsp;Referer&nbsp;is&nbsp;misspelled&nbsp;as&nbsp;in&nbsp;the&nbsp;request&nbsp;itself,&nbsp;a&nbsp;mistake&nbsp;from&nbsp;the</span><br>
<span class="lineno">275</span><span class="comment" id="3851152">//&nbsp;earliest&nbsp;days&nbsp;of&nbsp;HTTP.&nbsp;&nbsp;This&nbsp;value&nbsp;can&nbsp;also&nbsp;be&nbsp;fetched&nbsp;from&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3851219">//&nbsp;Header&nbsp;map&nbsp;as&nbsp;Header[&#34;Referer&#34;];&nbsp;the&nbsp;benefit&nbsp;of&nbsp;making&nbsp;it&nbsp;available</span><br>
<span class="lineno"></span><span class="comment" id="3851290">//&nbsp;as&nbsp;a&nbsp;method&nbsp;is&nbsp;that&nbsp;the&nbsp;compiler&nbsp;can&nbsp;diagnose&nbsp;programs&nbsp;that&nbsp;use&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3851361">//&nbsp;alternate&nbsp;(correct&nbsp;English)&nbsp;spelling&nbsp;req.Referrer()&nbsp;but&nbsp;cannot</span><br>
<span class="lineno"></span><span class="comment" id="3851427">//&nbsp;diagnose&nbsp;programs&nbsp;that&nbsp;use&nbsp;Header[&#34;Referrer&#34;].</span><br>
<span class="lineno">280</span><span class="keyword" id="3851477">func</span>&nbsp;<span class="op" id="3851482">(</span><span class="ident" id="3851483">r</span>&nbsp;<span class="op" id="3851485">*</span><span class="ident" id="3851486">Request</span><span class="op" id="3851493">)</span>&nbsp;<span class="ident" id="3851495">Referer</span><span class="op" id="3851502">(</span><span class="op" id="3851503">)</span>&nbsp;<span class="builtintype" id="3851505">string</span>&nbsp;<span class="op" id="3851512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3851515">return</span>&nbsp;<span class="ident" id="3851522">r</span><span class="op" id="3851523">.</span><span class="ident" id="3851524">Header</span><span class="op" id="3851530">.</span><span class="ident" id="3851531">Get</span><span class="op" id="3851534">(</span><span class="string" id="3851535">&#34;Referer&#34;</span><span class="op" id="3851544">)</span><br>
<span class="lineno"></span><span class="op" id="3851546">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3851549">//&nbsp;multipartByReader&nbsp;is&nbsp;a&nbsp;sentinel&nbsp;value.</span><br>
<span class="lineno">285</span><span class="comment" id="3851591">//&nbsp;Its&nbsp;presence&nbsp;in&nbsp;Request.MultipartForm&nbsp;indicates&nbsp;that&nbsp;parsing&nbsp;of&nbsp;the&nbsp;request</span><br>
<span class="lineno"></span><span class="comment" id="3851670">//&nbsp;body&nbsp;has&nbsp;been&nbsp;handed&nbsp;off&nbsp;to&nbsp;a&nbsp;MultipartReader&nbsp;instead&nbsp;of&nbsp;ParseMultipartFrom.</span><br>
<span class="lineno"></span><span class="keyword" id="3851750">var</span>&nbsp;<span class="ident" id="3851754">multipartByReader</span>&nbsp;<span class="op" id="3851772">=</span>&nbsp;<span class="op" id="3851774">&amp;</span><span class="ident" id="3851775">multipart</span><span class="op" id="3851784">.</span><span class="ident" id="3851785">Form</span><span class="op" id="3851789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3851792">Value</span><span class="op" id="3851797">:</span>&nbsp;<span class="builtinfunc" id="3851799">make</span><span class="op" id="3851803">(</span><span class="keyword" id="3851804">map</span><span class="op" id="3851807">[</span><span class="builtintype" id="3851808">string</span><span class="op" id="3851814">]</span><span class="op" id="3851815">[</span><span class="op" id="3851816">]</span><span class="builtintype" id="3851817">string</span><span class="op" id="3851823">)</span><span class="op" id="3851824">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3851827">File</span><span class="op" id="3851831">:</span>&nbsp;&nbsp;<span class="builtinfunc" id="3851834">make</span><span class="op" id="3851838">(</span><span class="keyword" id="3851839">map</span><span class="op" id="3851842">[</span><span class="builtintype" id="3851843">string</span><span class="op" id="3851849">]</span><span class="op" id="3851850">[</span><span class="op" id="3851851">]</span><span class="op" id="3851852">*</span><span class="ident" id="3851853">multipart</span><span class="op" id="3851862">.</span><span class="ident" id="3851863">FileHeader</span><span class="op" id="3851873">)</span><span class="op" id="3851874">,</span><br>
<span class="lineno">290</span><span class="op" id="3851876">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3851879">//&nbsp;MultipartReader&nbsp;returns&nbsp;a&nbsp;MIME&nbsp;multipart&nbsp;reader&nbsp;if&nbsp;this&nbsp;is&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3851943">//&nbsp;multipart/form-data&nbsp;POST&nbsp;request,&nbsp;else&nbsp;returns&nbsp;nil&nbsp;and&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="3852011">//&nbsp;Use&nbsp;this&nbsp;function&nbsp;instead&nbsp;of&nbsp;ParseMultipartForm&nbsp;to</span><br>
<span class="lineno">295</span><span class="comment" id="3852065">//&nbsp;process&nbsp;the&nbsp;request&nbsp;body&nbsp;as&nbsp;a&nbsp;stream.</span><br>
<span class="lineno"></span><span class="keyword" id="3852106">func</span>&nbsp;<span class="op" id="3852111">(</span><span class="ident" id="3852112">r</span>&nbsp;<span class="op" id="3852114">*</span><span class="ident" id="3852115">Request</span><span class="op" id="3852122">)</span>&nbsp;<span class="ident" id="3852124">MultipartReader</span><span class="op" id="3852139">(</span><span class="op" id="3852140">)</span>&nbsp;<span class="op" id="3852142">(</span><span class="op" id="3852143">*</span><span class="ident" id="3852144">multipart</span><span class="op" id="3852153">.</span><span class="ident" id="3852154">Reader</span><span class="op" id="3852160">,</span>&nbsp;<span class="builtintype" id="3852162">error</span><span class="op" id="3852167">)</span>&nbsp;<span class="op" id="3852169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3852172">if</span>&nbsp;<span class="ident" id="3852175">r</span><span class="op" id="3852176">.</span><span class="ident" id="3852177">MultipartForm</span>&nbsp;<span class="op" id="3852191">==</span>&nbsp;<span class="ident" id="3852194">multipartByReader</span>&nbsp;<span class="op" id="3852212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3852216">return</span>&nbsp;<span class="ident" id="3852223">nil</span><span class="op" id="3852226">,</span>&nbsp;<span class="ident" id="3852228">errors</span><span class="op" id="3852234">.</span><span class="ident" id="3852235">New</span><span class="op" id="3852238">(</span><span class="string" id="3852239">&#34;http:&nbsp;MultipartReader&nbsp;called&nbsp;twice&#34;</span><span class="op" id="3852275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3852278">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3852281">if</span>&nbsp;<span class="ident" id="3852284">r</span><span class="op" id="3852285">.</span><span class="ident" id="3852286">MultipartForm</span>&nbsp;<span class="op" id="3852300">!=</span>&nbsp;<span class="ident" id="3852303">nil</span>&nbsp;<span class="op" id="3852307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3852311">return</span>&nbsp;<span class="ident" id="3852318">nil</span><span class="op" id="3852321">,</span>&nbsp;<span class="ident" id="3852323">errors</span><span class="op" id="3852329">.</span><span class="ident" id="3852330">New</span><span class="op" id="3852333">(</span><span class="string" id="3852334">&#34;http:&nbsp;multipart&nbsp;handled&nbsp;by&nbsp;ParseMultipartForm&#34;</span><span class="op" id="3852381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3852384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3852387">r</span><span class="op" id="3852388">.</span><span class="ident" id="3852389">MultipartForm</span>&nbsp;<span class="op" id="3852403">=</span>&nbsp;<span class="ident" id="3852405">multipartByReader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3852424">return</span>&nbsp;<span class="ident" id="3852431">r</span><span class="op" id="3852432">.</span><span class="ident" id="3852433">multipartReader</span><span class="op" id="3852448">(</span><span class="op" id="3852449">)</span><br>
<span class="lineno">305</span><span class="op" id="3852451">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3852454">func</span>&nbsp;<span class="op" id="3852459">(</span><span class="ident" id="3852460">r</span>&nbsp;<span class="op" id="3852462">*</span><span class="ident" id="3852463">Request</span><span class="op" id="3852470">)</span>&nbsp;<span class="ident" id="3852472">multipartReader</span><span class="op" id="3852487">(</span><span class="op" id="3852488">)</span>&nbsp;<span class="op" id="3852490">(</span><span class="op" id="3852491">*</span><span class="ident" id="3852492">multipart</span><span class="op" id="3852501">.</span><span class="ident" id="3852502">Reader</span><span class="op" id="3852508">,</span>&nbsp;<span class="builtintype" id="3852510">error</span><span class="op" id="3852515">)</span>&nbsp;<span class="op" id="3852517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3852520">v</span>&nbsp;<span class="op" id="3852522">:=</span>&nbsp;<span class="ident" id="3852525">r</span><span class="op" id="3852526">.</span><span class="ident" id="3852527">Header</span><span class="op" id="3852533">.</span><span class="ident" id="3852534">Get</span><span class="op" id="3852537">(</span><span class="string" id="3852538">&#34;Content-Type&#34;</span><span class="op" id="3852552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3852555">if</span>&nbsp;<span class="ident" id="3852558">v</span>&nbsp;<span class="op" id="3852560">==</span>&nbsp;<span class="string" id="3852563">&#34;&#34;</span>&nbsp;<span class="op" id="3852566">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3852570">return</span>&nbsp;<span class="ident" id="3852577">nil</span><span class="op" id="3852580">,</span>&nbsp;<span class="ident" id="3852582">ErrNotMultipart</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3852599">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3852602">d</span><span class="op" id="3852603">,</span>&nbsp;<span class="ident" id="3852605">params</span><span class="op" id="3852611">,</span>&nbsp;<span class="ident" id="3852613">err</span>&nbsp;<span class="op" id="3852617">:=</span>&nbsp;<span class="ident" id="3852620">mime</span><span class="op" id="3852624">.</span><span class="ident" id="3852625">ParseMediaType</span><span class="op" id="3852639">(</span><span class="ident" id="3852640">v</span><span class="op" id="3852641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3852644">if</span>&nbsp;<span class="ident" id="3852647">err</span>&nbsp;<span class="op" id="3852651">!=</span>&nbsp;<span class="ident" id="3852654">nil</span>&nbsp;<span class="op" id="3852658">||</span>&nbsp;<span class="ident" id="3852661">d</span>&nbsp;<span class="op" id="3852663">!=</span>&nbsp;<span class="string" id="3852666">&#34;multipart/form-data&#34;</span>&nbsp;<span class="op" id="3852688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3852692">return</span>&nbsp;<span class="ident" id="3852699">nil</span><span class="op" id="3852702">,</span>&nbsp;<span class="ident" id="3852704">ErrNotMultipart</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3852721">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3852724">boundary</span><span class="op" id="3852732">,</span>&nbsp;<span class="ident" id="3852734">ok</span>&nbsp;<span class="op" id="3852737">:=</span>&nbsp;<span class="ident" id="3852740">params</span><span class="op" id="3852746">[</span><span class="string" id="3852747">&#34;boundary&#34;</span><span class="op" id="3852757">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3852760">if</span>&nbsp;<span class="op" id="3852763">!</span><span class="ident" id="3852764">ok</span>&nbsp;<span class="op" id="3852767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3852771">return</span>&nbsp;<span class="ident" id="3852778">nil</span><span class="op" id="3852781">,</span>&nbsp;<span class="ident" id="3852783">ErrMissingBoundary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3852803">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3852806">return</span>&nbsp;<span class="ident" id="3852813">multipart</span><span class="op" id="3852822">.</span><span class="ident" id="3852823">NewReader</span><span class="op" id="3852832">(</span><span class="ident" id="3852833">r</span><span class="op" id="3852834">.</span><span class="ident" id="3852835">Body</span><span class="op" id="3852839">,</span>&nbsp;<span class="ident" id="3852841">boundary</span><span class="op" id="3852849">)</span><span class="op" id="3852850">,</span>&nbsp;<span class="ident" id="3852852">nil</span><br>
<span class="lineno"></span><span class="op" id="3852856">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3852859">//&nbsp;Return&nbsp;value&nbsp;if&nbsp;nonempty,&nbsp;def&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="keyword" id="3852903">func</span>&nbsp;<span class="ident" id="3852908">valueOrDefault</span><span class="op" id="3852922">(</span><span class="ident" id="3852923">value</span><span class="op" id="3852928">,</span>&nbsp;<span class="ident" id="3852930">def</span>&nbsp;<span class="builtintype" id="3852934">string</span><span class="op" id="3852940">)</span>&nbsp;<span class="builtintype" id="3852942">string</span>&nbsp;<span class="op" id="3852949">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3852952">if</span>&nbsp;<span class="ident" id="3852955">value</span>&nbsp;<span class="op" id="3852961">!=</span>&nbsp;<span class="string" id="3852964">&#34;&#34;</span>&nbsp;<span class="op" id="3852967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3852971">return</span>&nbsp;<span class="ident" id="3852978">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3852985">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3852988">return</span>&nbsp;<span class="ident" id="3852995">def</span><br>
<span class="lineno"></span><span class="op" id="3852999">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="comment" id="3853002">//&nbsp;NOTE:&nbsp;This&nbsp;is&nbsp;not&nbsp;intended&nbsp;to&nbsp;reflect&nbsp;the&nbsp;actual&nbsp;Go&nbsp;version&nbsp;being&nbsp;used.</span><br>
<span class="lineno"></span><span class="comment" id="3853077">//&nbsp;It&nbsp;was&nbsp;changed&nbsp;from&nbsp;&#34;Go&nbsp;http&nbsp;package&#34;&nbsp;to&nbsp;&#34;Go&nbsp;1.1&nbsp;package&nbsp;http&#34;&nbsp;at&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3853150">//&nbsp;time&nbsp;of&nbsp;the&nbsp;Go&nbsp;1.1&nbsp;release&nbsp;because&nbsp;the&nbsp;former&nbsp;User-Agent&nbsp;had&nbsp;ended&nbsp;up</span><br>
<span class="lineno"></span><span class="comment" id="3853223">//&nbsp;on&nbsp;a&nbsp;blacklist&nbsp;for&nbsp;some&nbsp;intrusion&nbsp;detection&nbsp;systems.</span><br>
<span class="lineno">335</span><span class="comment" id="3853279">//&nbsp;See&nbsp;https://codereview.appspot.com/7532043.</span><br>
<span class="lineno"></span><span class="keyword" id="3853326">const</span>&nbsp;<span class="ident" id="3853332">defaultUserAgent</span>&nbsp;<span class="op" id="3853349">=</span>&nbsp;<span class="string" id="3853351">&#34;Go&nbsp;1.1&nbsp;package&nbsp;http&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3853374">//&nbsp;Write&nbsp;writes&nbsp;an&nbsp;HTTP/1.1&nbsp;request&nbsp;--&nbsp;header&nbsp;and&nbsp;body&nbsp;--&nbsp;in&nbsp;wire&nbsp;format.</span><br>
<span class="lineno"></span><span class="comment" id="3853448">//&nbsp;This&nbsp;method&nbsp;consults&nbsp;the&nbsp;following&nbsp;fields&nbsp;of&nbsp;the&nbsp;request:</span><br>
<span class="lineno">340</span><span class="comment" id="3853509">//&nbsp;&nbsp;&nbsp;&nbspHost</span><br>
<span class="lineno"></span><span class="comment" id="3853517">//&nbsp;&nbsp;&nbsp;&nbspURL</span><br>
<span class="lineno"></span><span class="comment" id="3853524">//&nbsp;&nbsp;&nbsp;&nbspMethod&nbsp;(defaults&nbsp;to&nbsp;&#34;GET&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="3853554">//&nbsp;&nbsp;&nbsp;&nbspHeader</span><br>
<span class="lineno"></span><span class="comment" id="3853564">//&nbsp;&nbsp;&nbsp;&nbspContentLength</span><br>
<span class="lineno">345</span><span class="comment" id="3853581">//&nbsp;&nbsp;&nbsp;&nbspTransferEncoding</span><br>
<span class="lineno"></span><span class="comment" id="3853601">//&nbsp;&nbsp;&nbsp;&nbspBody</span><br>
<span class="lineno"></span><span class="comment" id="3853609">//</span><br>
<span class="lineno"></span><span class="comment" id="3853612">//&nbsp;If&nbsp;Body&nbsp;is&nbsp;present,&nbsp;Content-Length&nbsp;is&nbsp;&lt;=&nbsp;0&nbsp;and&nbsp;TransferEncoding</span><br>
<span class="lineno"></span><span class="comment" id="3853679">//&nbsp;hasn&#39;t&nbsp;been&nbsp;set&nbsp;to&nbsp;&#34;identity&#34;,&nbsp;Write&nbsp;adds&nbsp;&#34;Transfer-Encoding:</span><br>
<span class="lineno">350</span><span class="comment" id="3853744">//&nbsp;chunked&#34;&nbsp;to&nbsp;the&nbsp;header.&nbsp;Body&nbsp;is&nbsp;closed&nbsp;after&nbsp;it&nbsp;is&nbsp;sent.</span><br>
<span class="lineno"></span><span class="keyword" id="3853804">func</span>&nbsp;<span class="op" id="3853809">(</span><span class="ident" id="3853810">r</span>&nbsp;<span class="op" id="3853812">*</span><span class="ident" id="3853813">Request</span><span class="op" id="3853820">)</span>&nbsp;<span class="ident" id="3853822">Write</span><span class="op" id="3853827">(</span><span class="ident" id="3853828">w</span>&nbsp;<span class="ident" id="3853830">io</span><span class="op" id="3853832">.</span><span class="ident" id="3853833">Writer</span><span class="op" id="3853839">)</span>&nbsp;<span class="builtintype" id="3853841">error</span>&nbsp;<span class="op" id="3853847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3853850">return</span>&nbsp;<span class="ident" id="3853857">r</span><span class="op" id="3853858">.</span><span class="ident" id="3853859">write</span><span class="op" id="3853864">(</span><span class="ident" id="3853865">w</span><span class="op" id="3853866">,</span>&nbsp;<span class="builtintype" id="3853868">false</span><span class="op" id="3853873">,</span>&nbsp;<span class="ident" id="3853875">nil</span><span class="op" id="3853878">)</span><br>
<span class="lineno"></span><span class="op" id="3853880">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="comment" id="3853883">//&nbsp;WriteProxy&nbsp;is&nbsp;like&nbsp;Write&nbsp;but&nbsp;writes&nbsp;the&nbsp;request&nbsp;in&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="3853946">//&nbsp;expected&nbsp;by&nbsp;an&nbsp;HTTP&nbsp;proxy.&nbsp;&nbsp;In&nbsp;particular,&nbsp;WriteProxy&nbsp;writes&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3854014">//&nbsp;initial&nbsp;Request-URI&nbsp;line&nbsp;of&nbsp;the&nbsp;request&nbsp;with&nbsp;an&nbsp;absolute&nbsp;URI,&nbsp;per</span><br>
<span class="lineno"></span><span class="comment" id="3854083">//&nbsp;section&nbsp;5.1.2&nbsp;of&nbsp;RFC&nbsp;2616,&nbsp;including&nbsp;the&nbsp;scheme&nbsp;and&nbsp;host.</span><br>
<span class="lineno"></span><span class="comment" id="3854144">//&nbsp;In&nbsp;either&nbsp;case,&nbsp;WriteProxy&nbsp;also&nbsp;writes&nbsp;a&nbsp;Host&nbsp;header,&nbsp;using</span><br>
<span class="lineno">360</span><span class="comment" id="3854207">//&nbsp;either&nbsp;r.Host&nbsp;or&nbsp;r.URL.Host.</span><br>
<span class="lineno"></span><span class="keyword" id="3854239">func</span>&nbsp;<span class="op" id="3854244">(</span><span class="ident" id="3854245">r</span>&nbsp;<span class="op" id="3854247">*</span><span class="ident" id="3854248">Request</span><span class="op" id="3854255">)</span>&nbsp;<span class="ident" id="3854257">WriteProxy</span><span class="op" id="3854267">(</span><span class="ident" id="3854268">w</span>&nbsp;<span class="ident" id="3854270">io</span><span class="op" id="3854272">.</span><span class="ident" id="3854273">Writer</span><span class="op" id="3854279">)</span>&nbsp;<span class="builtintype" id="3854281">error</span>&nbsp;<span class="op" id="3854287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3854290">return</span>&nbsp;<span class="ident" id="3854297">r</span><span class="op" id="3854298">.</span><span class="ident" id="3854299">write</span><span class="op" id="3854304">(</span><span class="ident" id="3854305">w</span><span class="op" id="3854306">,</span>&nbsp;<span class="builtintype" id="3854308">true</span><span class="op" id="3854312">,</span>&nbsp;<span class="ident" id="3854314">nil</span><span class="op" id="3854317">)</span><br>
<span class="lineno"></span><span class="op" id="3854319">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="comment" id="3854322">//&nbsp;extraHeaders&nbsp;may&nbsp;be&nbsp;nil</span><br>
<span class="lineno"></span><span class="keyword" id="3854349">func</span>&nbsp;<span class="op" id="3854354">(</span><span class="ident" id="3854355">req</span>&nbsp;<span class="op" id="3854359">*</span><span class="ident" id="3854360">Request</span><span class="op" id="3854367">)</span>&nbsp;<span class="ident" id="3854369">write</span><span class="op" id="3854374">(</span><span class="ident" id="3854375">w</span>&nbsp;<span class="ident" id="3854377">io</span><span class="op" id="3854379">.</span><span class="ident" id="3854380">Writer</span><span class="op" id="3854386">,</span>&nbsp;<span class="ident" id="3854388">usingProxy</span>&nbsp;<span class="builtintype" id="3854399">bool</span><span class="op" id="3854403">,</span>&nbsp;<span class="ident" id="3854405">extraHeaders</span>&nbsp;<span class="ident" id="3854418">Header</span><span class="op" id="3854424">)</span>&nbsp;<span class="builtintype" id="3854426">error</span>&nbsp;<span class="op" id="3854432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3854435">host</span>&nbsp;<span class="op" id="3854440">:=</span>&nbsp;<span class="ident" id="3854443">req</span><span class="op" id="3854446">.</span><span class="ident" id="3854447">Host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3854453">if</span>&nbsp;<span class="ident" id="3854456">host</span>&nbsp;<span class="op" id="3854461">==</span>&nbsp;<span class="string" id="3854464">&#34;&#34;</span>&nbsp;<span class="op" id="3854467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3854471">if</span>&nbsp;<span class="ident" id="3854474">req</span><span class="op" id="3854477">.</span><span class="ident" id="3854478">URL</span>&nbsp;<span class="op" id="3854482">==</span>&nbsp;<span class="ident" id="3854485">nil</span>&nbsp;<span class="op" id="3854489">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3854494">return</span>&nbsp;<span class="ident" id="3854501">errors</span><span class="op" id="3854507">.</span><span class="ident" id="3854508">New</span><span class="op" id="3854511">(</span><span class="string" id="3854512">&#34;http:&nbsp;Request.Write&nbsp;on&nbsp;Request&nbsp;with&nbsp;no&nbsp;Host&nbsp;or&nbsp;URL&nbsp;set&#34;</span><span class="op" id="3854568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3854572">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3854576">host</span>&nbsp;<span class="op" id="3854581">=</span>&nbsp;<span class="ident" id="3854583">req</span><span class="op" id="3854586">.</span><span class="ident" id="3854587">URL</span><span class="op" id="3854590">.</span><span class="ident" id="3854591">Host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3854597">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3854601">ruri</span>&nbsp;<span class="op" id="3854606">:=</span>&nbsp;<span class="ident" id="3854609">req</span><span class="op" id="3854612">.</span><span class="ident" id="3854613">URL</span><span class="op" id="3854616">.</span><span class="ident" id="3854617">RequestURI</span><span class="op" id="3854627">(</span><span class="op" id="3854628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3854631">if</span>&nbsp;<span class="ident" id="3854634">usingProxy</span>&nbsp;<span class="op" id="3854645">&amp;&amp;</span>&nbsp;<span class="ident" id="3854648">req</span><span class="op" id="3854651">.</span><span class="ident" id="3854652">URL</span><span class="op" id="3854655">.</span><span class="ident" id="3854656">Scheme</span>&nbsp;<span class="op" id="3854663">!=</span>&nbsp;<span class="string" id="3854666">&#34;&#34;</span>&nbsp;<span class="op" id="3854669">&amp;&amp;</span>&nbsp;<span class="ident" id="3854672">req</span><span class="op" id="3854675">.</span><span class="ident" id="3854676">URL</span><span class="op" id="3854679">.</span><span class="ident" id="3854680">Opaque</span>&nbsp;<span class="op" id="3854687">==</span>&nbsp;<span class="string" id="3854690">&#34;&#34;</span>&nbsp;<span class="op" id="3854693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3854697">ruri</span>&nbsp;<span class="op" id="3854702">=</span>&nbsp;<span class="ident" id="3854704">req</span><span class="op" id="3854707">.</span><span class="ident" id="3854708">URL</span><span class="op" id="3854711">.</span><span class="ident" id="3854712">Scheme</span>&nbsp;<span class="op" id="3854719">+</span>&nbsp;<span class="string" id="3854721">&#34;://&#34;</span>&nbsp;<span class="op" id="3854727">+</span>&nbsp;<span class="ident" id="3854729">host</span>&nbsp;<span class="op" id="3854734">+</span>&nbsp;<span class="ident" id="3854736">ruri</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3854742">}</span>&nbsp;<span class="keyword" id="3854744">else</span>&nbsp;<span class="keyword" id="3854749">if</span>&nbsp;<span class="ident" id="3854752">req</span><span class="op" id="3854755">.</span><span class="ident" id="3854756">Method</span>&nbsp;<span class="op" id="3854763">==</span>&nbsp;<span class="string" id="3854766">&#34;CONNECT&#34;</span>&nbsp;<span class="op" id="3854776">&amp;&amp;</span>&nbsp;<span class="ident" id="3854779">req</span><span class="op" id="3854782">.</span><span class="ident" id="3854783">URL</span><span class="op" id="3854786">.</span><span class="ident" id="3854787">Path</span>&nbsp;<span class="op" id="3854792">==</span>&nbsp;<span class="string" id="3854795">&#34;&#34;</span>&nbsp;<span class="op" id="3854798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3854802">//&nbsp;CONNECT&nbsp;requests&nbsp;normally&nbsp;give&nbsp;just&nbsp;the&nbsp;host&nbsp;and&nbsp;port,&nbsp;not&nbsp;a&nbsp;full&nbsp;URL.</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3854878">ruri</span>&nbsp;<span class="op" id="3854883">=</span>&nbsp;<span class="ident" id="3854885">host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3854891">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3854894">//&nbsp;TODO(bradfitz):&nbsp;escape&nbsp;at&nbsp;least&nbsp;newlines&nbsp;in&nbsp;ruri?</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3854949">//&nbsp;Wrap&nbsp;the&nbsp;writer&nbsp;in&nbsp;a&nbsp;bufio&nbsp;Writer&nbsp;if&nbsp;it&#39;s&nbsp;not&nbsp;already&nbsp;buffered.</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3855017">//&nbsp;Don&#39;t&nbsp;always&nbsp;call&nbsp;NewWriter,&nbsp;as&nbsp;that&nbsp;forces&nbsp;a&nbsp;bytes.Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3855080">//&nbsp;and&nbsp;other&nbsp;small&nbsp;bufio&nbsp;Writers&nbsp;to&nbsp;have&nbsp;a&nbsp;minimum&nbsp;4k&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3855142">//&nbsp;size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3855152">var</span>&nbsp;<span class="ident" id="3855156">bw</span>&nbsp;<span class="op" id="3855159">*</span><span class="ident" id="3855160">bufio</span><span class="op" id="3855165">.</span><span class="ident" id="3855166">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3855174">if</span>&nbsp;<span class="ident" id="3855177">_</span><span class="op" id="3855178">,</span>&nbsp;<span class="ident" id="3855180">ok</span>&nbsp;<span class="op" id="3855183">:=</span>&nbsp;<span class="ident" id="3855186">w</span><span class="op" id="3855187">.</span><span class="op" id="3855188">(</span><span class="ident" id="3855189">io</span><span class="op" id="3855191">.</span><span class="ident" id="3855192">ByteWriter</span><span class="op" id="3855202">)</span><span class="op" id="3855203">;</span>&nbsp;<span class="op" id="3855205">!</span><span class="ident" id="3855206">ok</span>&nbsp;<span class="op" id="3855209">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3855213">bw</span>&nbsp;<span class="op" id="3855216">=</span>&nbsp;<span class="ident" id="3855218">bufio</span><span class="op" id="3855223">.</span><span class="ident" id="3855224">NewWriter</span><span class="op" id="3855233">(</span><span class="ident" id="3855234">w</span><span class="op" id="3855235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3855239">w</span>&nbsp;<span class="op" id="3855241">=</span>&nbsp;<span class="ident" id="3855243">bw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3855247">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3855251">_</span><span class="op" id="3855252">,</span>&nbsp;<span class="ident" id="3855254">err</span>&nbsp;<span class="op" id="3855258">:=</span>&nbsp;<span class="ident" id="3855261">fmt</span><span class="op" id="3855264">.</span><span class="ident" id="3855265">Fprintf</span><span class="op" id="3855272">(</span><span class="ident" id="3855273">w</span><span class="op" id="3855274">,</span>&nbsp;<span class="string" id="3855276">&#34;%s&nbsp;%s&nbsp;HTTP/1.1\r\n&#34;</span><span class="op" id="3855296">,</span>&nbsp;<span class="ident" id="3855298">valueOrDefault</span><span class="op" id="3855312">(</span><span class="ident" id="3855313">req</span><span class="op" id="3855316">.</span><span class="ident" id="3855317">Method</span><span class="op" id="3855323">,</span>&nbsp;<span class="string" id="3855325">&#34;GET&#34;</span><span class="op" id="3855330">)</span><span class="op" id="3855331">,</span>&nbsp;<span class="ident" id="3855333">ruri</span><span class="op" id="3855337">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3855340">if</span>&nbsp;<span class="ident" id="3855343">err</span>&nbsp;<span class="op" id="3855347">!=</span>&nbsp;<span class="ident" id="3855350">nil</span>&nbsp;<span class="op" id="3855354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3855358">return</span>&nbsp;<span class="ident" id="3855365">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3855370">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3855374">//&nbsp;Header&nbsp;lines</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3855391">_</span><span class="op" id="3855392">,</span>&nbsp;<span class="ident" id="3855394">err</span>&nbsp;<span class="op" id="3855398">=</span>&nbsp;<span class="ident" id="3855400">fmt</span><span class="op" id="3855403">.</span><span class="ident" id="3855404">Fprintf</span><span class="op" id="3855411">(</span><span class="ident" id="3855412">w</span><span class="op" id="3855413">,</span>&nbsp;<span class="string" id="3855415">&#34;Host:&nbsp;%s\r\n&#34;</span><span class="op" id="3855429">,</span>&nbsp;<span class="ident" id="3855431">host</span><span class="op" id="3855435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3855438">if</span>&nbsp;<span class="ident" id="3855441">err</span>&nbsp;<span class="op" id="3855445">!=</span>&nbsp;<span class="ident" id="3855448">nil</span>&nbsp;<span class="op" id="3855452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3855456">return</span>&nbsp;<span class="ident" id="3855463">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3855468">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3855472">//&nbsp;Use&nbsp;the&nbsp;defaultUserAgent&nbsp;unless&nbsp;the&nbsp;Header&nbsp;contains&nbsp;one,&nbsp;which</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3855539">//&nbsp;may&nbsp;be&nbsp;blank&nbsp;to&nbsp;not&nbsp;send&nbsp;the&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3855580">userAgent</span>&nbsp;<span class="op" id="3855590">:=</span>&nbsp;<span class="ident" id="3855593">defaultUserAgent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3855611">if</span>&nbsp;<span class="ident" id="3855614">req</span><span class="op" id="3855617">.</span><span class="ident" id="3855618">Header</span>&nbsp;<span class="op" id="3855625">!=</span>&nbsp;<span class="ident" id="3855628">nil</span>&nbsp;<span class="op" id="3855632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3855636">if</span>&nbsp;<span class="ident" id="3855639">ua</span>&nbsp;<span class="op" id="3855642">:=</span>&nbsp;<span class="ident" id="3855645">req</span><span class="op" id="3855648">.</span><span class="ident" id="3855649">Header</span><span class="op" id="3855655">[</span><span class="string" id="3855656">&#34;User-Agent&#34;</span><span class="op" id="3855668">]</span><span class="op" id="3855669">;</span>&nbsp;<span class="builtinfunc" id="3855671">len</span><span class="op" id="3855674">(</span><span class="ident" id="3855675">ua</span><span class="op" id="3855677">)</span>&nbsp;<span class="op" id="3855679">&gt;</span>&nbsp;<span class="num" id="3855681">0</span>&nbsp;<span class="op" id="3855683">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3855688">userAgent</span>&nbsp;<span class="op" id="3855698">=</span>&nbsp;<span class="ident" id="3855700">ua</span><span class="op" id="3855702">[</span><span class="num" id="3855703">0</span><span class="op" id="3855704">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3855708">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3855711">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3855714">if</span>&nbsp;<span class="ident" id="3855717">userAgent</span>&nbsp;<span class="op" id="3855727">!=</span>&nbsp;<span class="string" id="3855730">&#34;&#34;</span>&nbsp;<span class="op" id="3855733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3855737">_</span><span class="op" id="3855738">,</span>&nbsp;<span class="ident" id="3855740">err</span>&nbsp;<span class="op" id="3855744">=</span>&nbsp;<span class="ident" id="3855746">fmt</span><span class="op" id="3855749">.</span><span class="ident" id="3855750">Fprintf</span><span class="op" id="3855757">(</span><span class="ident" id="3855758">w</span><span class="op" id="3855759">,</span>&nbsp;<span class="string" id="3855761">&#34;User-Agent:&nbsp;%s\r\n&#34;</span><span class="op" id="3855781">,</span>&nbsp;<span class="ident" id="3855783">userAgent</span><span class="op" id="3855792">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3855796">if</span>&nbsp;<span class="ident" id="3855799">err</span>&nbsp;<span class="op" id="3855803">!=</span>&nbsp;<span class="ident" id="3855806">nil</span>&nbsp;<span class="op" id="3855810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3855815">return</span>&nbsp;<span class="ident" id="3855822">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3855828">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3855831">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3855835">//&nbsp;Process&nbsp;Body,ContentLength,Close,Trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3855880">tw</span><span class="op" id="3855882">,</span>&nbsp;<span class="ident" id="3855884">err</span>&nbsp;<span class="op" id="3855888">:=</span>&nbsp;<span class="ident" id="3855891">newTransferWriter</span><span class="op" id="3855908">(</span><span class="ident" id="3855909">req</span><span class="op" id="3855912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3855915">if</span>&nbsp;<span class="ident" id="3855918">err</span>&nbsp;<span class="op" id="3855922">!=</span>&nbsp;<span class="ident" id="3855925">nil</span>&nbsp;<span class="op" id="3855929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3855933">return</span>&nbsp;<span class="ident" id="3855940">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3855945">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3855948">err</span>&nbsp;<span class="op" id="3855952">=</span>&nbsp;<span class="ident" id="3855954">tw</span><span class="op" id="3855956">.</span><span class="ident" id="3855957">WriteHeader</span><span class="op" id="3855968">(</span><span class="ident" id="3855969">w</span><span class="op" id="3855970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3855973">if</span>&nbsp;<span class="ident" id="3855976">err</span>&nbsp;<span class="op" id="3855980">!=</span>&nbsp;<span class="ident" id="3855983">nil</span>&nbsp;<span class="op" id="3855987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3855991">return</span>&nbsp;<span class="ident" id="3855998">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3856003">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3856007">err</span>&nbsp;<span class="op" id="3856011">=</span>&nbsp;<span class="ident" id="3856013">req</span><span class="op" id="3856016">.</span><span class="ident" id="3856017">Header</span><span class="op" id="3856023">.</span><span class="ident" id="3856024">WriteSubset</span><span class="op" id="3856035">(</span><span class="ident" id="3856036">w</span><span class="op" id="3856037">,</span>&nbsp;<span class="ident" id="3856039">reqWriteExcludeHeader</span><span class="op" id="3856060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3856063">if</span>&nbsp;<span class="ident" id="3856066">err</span>&nbsp;<span class="op" id="3856070">!=</span>&nbsp;<span class="ident" id="3856073">nil</span>&nbsp;<span class="op" id="3856077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3856081">return</span>&nbsp;<span class="ident" id="3856088">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3856093">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3856097">if</span>&nbsp;<span class="ident" id="3856100">extraHeaders</span>&nbsp;<span class="op" id="3856113">!=</span>&nbsp;<span class="ident" id="3856116">nil</span>&nbsp;<span class="op" id="3856120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3856124">err</span>&nbsp;<span class="op" id="3856128">=</span>&nbsp;<span class="ident" id="3856130">extraHeaders</span><span class="op" id="3856142">.</span><span class="ident" id="3856143">Write</span><span class="op" id="3856148">(</span><span class="ident" id="3856149">w</span><span class="op" id="3856150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3856154">if</span>&nbsp;<span class="ident" id="3856157">err</span>&nbsp;<span class="op" id="3856161">!=</span>&nbsp;<span class="ident" id="3856164">nil</span>&nbsp;<span class="op" id="3856168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3856173">return</span>&nbsp;<span class="ident" id="3856180">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3856186">}</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3856189">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3856193">_</span><span class="op" id="3856194">,</span>&nbsp;<span class="ident" id="3856196">err</span>&nbsp;<span class="op" id="3856200">=</span>&nbsp;<span class="ident" id="3856202">io</span><span class="op" id="3856204">.</span><span class="ident" id="3856205">WriteString</span><span class="op" id="3856216">(</span><span class="ident" id="3856217">w</span><span class="op" id="3856218">,</span>&nbsp;<span class="string" id="3856220">&#34;\r\n&#34;</span><span class="op" id="3856226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3856229">if</span>&nbsp;<span class="ident" id="3856232">err</span>&nbsp;<span class="op" id="3856236">!=</span>&nbsp;<span class="ident" id="3856239">nil</span>&nbsp;<span class="op" id="3856243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3856247">return</span>&nbsp;<span class="ident" id="3856254">err</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3856259">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3856263">//&nbsp;Write&nbsp;body&nbsp;and&nbsp;trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3856290">err</span>&nbsp;<span class="op" id="3856294">=</span>&nbsp;<span class="ident" id="3856296">tw</span><span class="op" id="3856298">.</span><span class="ident" id="3856299">WriteBody</span><span class="op" id="3856308">(</span><span class="ident" id="3856309">w</span><span class="op" id="3856310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3856313">if</span>&nbsp;<span class="ident" id="3856316">err</span>&nbsp;<span class="op" id="3856320">!=</span>&nbsp;<span class="ident" id="3856323">nil</span>&nbsp;<span class="op" id="3856327">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3856331">return</span>&nbsp;<span class="ident" id="3856338">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3856343">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3856347">if</span>&nbsp;<span class="ident" id="3856350">bw</span>&nbsp;<span class="op" id="3856353">!=</span>&nbsp;<span class="ident" id="3856356">nil</span>&nbsp;<span class="op" id="3856360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3856364">return</span>&nbsp;<span class="ident" id="3856371">bw</span><span class="op" id="3856373">.</span><span class="ident" id="3856374">Flush</span><span class="op" id="3856379">(</span><span class="op" id="3856380">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3856383">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3856386">return</span>&nbsp;<span class="ident" id="3856393">nil</span><br>
<span class="lineno"></span><span class="op" id="3856397">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3856400">//&nbsp;ParseHTTPVersion&nbsp;parses&nbsp;a&nbsp;HTTP&nbsp;version&nbsp;string.</span><br>
<span class="lineno">460</span><span class="comment" id="3856450">//&nbsp;&#34;HTTP/1.0&#34;&nbsp;returns&nbsp;(1,&nbsp;0,&nbsp;true).</span><br>
<span class="lineno"></span><span class="keyword" id="3856486">func</span>&nbsp;<span class="ident" id="3856491">ParseHTTPVersion</span><span class="op" id="3856507">(</span><span class="ident" id="3856508">vers</span>&nbsp;<span class="builtintype" id="3856513">string</span><span class="op" id="3856519">)</span>&nbsp;<span class="op" id="3856521">(</span><span class="ident" id="3856522">major</span><span class="op" id="3856527">,</span>&nbsp;<span class="ident" id="3856529">minor</span>&nbsp;<span class="builtintype" id="3856535">int</span><span class="op" id="3856538">,</span>&nbsp;<span class="ident" id="3856540">ok</span>&nbsp;<span class="builtintype" id="3856543">bool</span><span class="op" id="3856547">)</span>&nbsp;<span class="op" id="3856549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3856552">const</span>&nbsp;<span class="ident" id="3856558">Big</span>&nbsp;<span class="op" id="3856562">=</span>&nbsp;<span class="num" id="3856564">1000000</span>&nbsp;<span class="comment" id="3856572">//&nbsp;arbitrary&nbsp;upper&nbsp;bound</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3856598">switch</span>&nbsp;<span class="ident" id="3856605">vers</span>&nbsp;<span class="op" id="3856610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3856613">case</span>&nbsp;<span class="string" id="3856618">&#34;HTTP/1.1&#34;</span><span class="op" id="3856628">:</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3856632">return</span>&nbsp;<span class="num" id="3856639">1</span><span class="op" id="3856640">,</span>&nbsp;<span class="num" id="3856642">1</span><span class="op" id="3856643">,</span>&nbsp;<span class="builtintype" id="3856645">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3856651">case</span>&nbsp;<span class="string" id="3856656">&#34;HTTP/1.0&#34;</span><span class="op" id="3856666">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3856670">return</span>&nbsp;<span class="num" id="3856677">1</span><span class="op" id="3856678">,</span>&nbsp;<span class="num" id="3856680">0</span><span class="op" id="3856681">,</span>&nbsp;<span class="builtintype" id="3856683">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3856689">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3856692">if</span>&nbsp;<span class="op" id="3856695">!</span><span class="ident" id="3856696">strings</span><span class="op" id="3856703">.</span><span class="ident" id="3856704">HasPrefix</span><span class="op" id="3856713">(</span><span class="ident" id="3856714">vers</span><span class="op" id="3856718">,</span>&nbsp;<span class="string" id="3856720">&#34;HTTP/&#34;</span><span class="op" id="3856727">)</span>&nbsp;<span class="op" id="3856729">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3856733">return</span>&nbsp;<span class="num" id="3856740">0</span><span class="op" id="3856741">,</span>&nbsp;<span class="num" id="3856743">0</span><span class="op" id="3856744">,</span>&nbsp;<span class="builtintype" id="3856746">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3856753">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3856756">dot</span>&nbsp;<span class="op" id="3856760">:=</span>&nbsp;<span class="ident" id="3856763">strings</span><span class="op" id="3856770">.</span><span class="ident" id="3856771">Index</span><span class="op" id="3856776">(</span><span class="ident" id="3856777">vers</span><span class="op" id="3856781">,</span>&nbsp;<span class="string" id="3856783">&#34;.&#34;</span><span class="op" id="3856786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3856789">if</span>&nbsp;<span class="ident" id="3856792">dot</span>&nbsp;<span class="op" id="3856796">&lt;</span>&nbsp;<span class="num" id="3856798">0</span>&nbsp;<span class="op" id="3856800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3856804">return</span>&nbsp;<span class="num" id="3856811">0</span><span class="op" id="3856812">,</span>&nbsp;<span class="num" id="3856814">0</span><span class="op" id="3856815">,</span>&nbsp;<span class="builtintype" id="3856817">false</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3856824">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3856827">major</span><span class="op" id="3856832">,</span>&nbsp;<span class="ident" id="3856834">err</span>&nbsp;<span class="op" id="3856838">:=</span>&nbsp;<span class="ident" id="3856841">strconv</span><span class="op" id="3856848">.</span><span class="ident" id="3856849">Atoi</span><span class="op" id="3856853">(</span><span class="ident" id="3856854">vers</span><span class="op" id="3856858">[</span><span class="num" id="3856859">5</span><span class="op" id="3856860">:</span><span class="ident" id="3856861">dot</span><span class="op" id="3856864">]</span><span class="op" id="3856865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3856868">if</span>&nbsp;<span class="ident" id="3856871">err</span>&nbsp;<span class="op" id="3856875">!=</span>&nbsp;<span class="ident" id="3856878">nil</span>&nbsp;<span class="op" id="3856882">||</span>&nbsp;<span class="ident" id="3856885">major</span>&nbsp;<span class="op" id="3856891">&lt;</span>&nbsp;<span class="num" id="3856893">0</span>&nbsp;<span class="op" id="3856895">||</span>&nbsp;<span class="ident" id="3856898">major</span>&nbsp;<span class="op" id="3856904">&gt;</span>&nbsp;<span class="ident" id="3856906">Big</span>&nbsp;<span class="op" id="3856910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3856914">return</span>&nbsp;<span class="num" id="3856921">0</span><span class="op" id="3856922">,</span>&nbsp;<span class="num" id="3856924">0</span><span class="op" id="3856925">,</span>&nbsp;<span class="builtintype" id="3856927">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3856934">}</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3856937">minor</span><span class="op" id="3856942">,</span>&nbsp;<span class="ident" id="3856944">err</span>&nbsp;<span class="op" id="3856948">=</span>&nbsp;<span class="ident" id="3856950">strconv</span><span class="op" id="3856957">.</span><span class="ident" id="3856958">Atoi</span><span class="op" id="3856962">(</span><span class="ident" id="3856963">vers</span><span class="op" id="3856967">[</span><span class="ident" id="3856968">dot</span><span class="op" id="3856971">+</span><span class="num" id="3856972">1</span><span class="op" id="3856973">:</span><span class="op" id="3856974">]</span><span class="op" id="3856975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3856978">if</span>&nbsp;<span class="ident" id="3856981">err</span>&nbsp;<span class="op" id="3856985">!=</span>&nbsp;<span class="ident" id="3856988">nil</span>&nbsp;<span class="op" id="3856992">||</span>&nbsp;<span class="ident" id="3856995">minor</span>&nbsp;<span class="op" id="3857001">&lt;</span>&nbsp;<span class="num" id="3857003">0</span>&nbsp;<span class="op" id="3857005">||</span>&nbsp;<span class="ident" id="3857008">minor</span>&nbsp;<span class="op" id="3857014">&gt;</span>&nbsp;<span class="ident" id="3857016">Big</span>&nbsp;<span class="op" id="3857020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3857024">return</span>&nbsp;<span class="num" id="3857031">0</span><span class="op" id="3857032">,</span>&nbsp;<span class="num" id="3857034">0</span><span class="op" id="3857035">,</span>&nbsp;<span class="builtintype" id="3857037">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3857044">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3857047">return</span>&nbsp;<span class="ident" id="3857054">major</span><span class="op" id="3857059">,</span>&nbsp;<span class="ident" id="3857061">minor</span><span class="op" id="3857066">,</span>&nbsp;<span class="builtintype" id="3857068">true</span><br>
<span class="lineno">485</span><span class="op" id="3857073">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3857076">//&nbsp;NewRequest&nbsp;returns&nbsp;a&nbsp;new&nbsp;Request&nbsp;given&nbsp;a&nbsp;method,&nbsp;URL,&nbsp;and&nbsp;optional&nbsp;body.</span><br>
<span class="lineno"></span><span class="comment" id="3857152">//</span><br>
<span class="lineno"></span><span class="comment" id="3857155">//&nbsp;If&nbsp;the&nbsp;provided&nbsp;body&nbsp;is&nbsp;also&nbsp;an&nbsp;io.Closer,&nbsp;the&nbsp;returned</span><br>
<span class="lineno">490</span><span class="comment" id="3857214">//&nbsp;Request.Body&nbsp;is&nbsp;set&nbsp;to&nbsp;body&nbsp;and&nbsp;will&nbsp;be&nbsp;closed&nbsp;by&nbsp;the&nbsp;Client</span><br>
<span class="lineno"></span><span class="comment" id="3857278">//&nbsp;methods&nbsp;Do,&nbsp;Post,&nbsp;and&nbsp;PostForm,&nbsp;and&nbsp;Transport.RoundTrip.</span><br>
<span class="lineno"></span><span class="keyword" id="3857338">func</span>&nbsp;<span class="ident" id="3857343">NewRequest</span><span class="op" id="3857353">(</span><span class="ident" id="3857354">method</span><span class="op" id="3857360">,</span>&nbsp;<span class="ident" id="3857362">urlStr</span>&nbsp;<span class="builtintype" id="3857369">string</span><span class="op" id="3857375">,</span>&nbsp;<span class="ident" id="3857377">body</span>&nbsp;<span class="ident" id="3857382">io</span><span class="op" id="3857384">.</span><span class="ident" id="3857385">Reader</span><span class="op" id="3857391">)</span>&nbsp;<span class="op" id="3857393">(</span><span class="op" id="3857394">*</span><span class="ident" id="3857395">Request</span><span class="op" id="3857402">,</span>&nbsp;<span class="builtintype" id="3857404">error</span><span class="op" id="3857409">)</span>&nbsp;<span class="op" id="3857411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3857414">u</span><span class="op" id="3857415">,</span>&nbsp;<span class="ident" id="3857417">err</span>&nbsp;<span class="op" id="3857421">:=</span>&nbsp;<span class="ident" id="3857424">url</span><span class="op" id="3857427">.</span><span class="ident" id="3857428">Parse</span><span class="op" id="3857433">(</span><span class="ident" id="3857434">urlStr</span><span class="op" id="3857440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3857443">if</span>&nbsp;<span class="ident" id="3857446">err</span>&nbsp;<span class="op" id="3857450">!=</span>&nbsp;<span class="ident" id="3857453">nil</span>&nbsp;<span class="op" id="3857457">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3857461">return</span>&nbsp;<span class="ident" id="3857468">nil</span><span class="op" id="3857471">,</span>&nbsp;<span class="ident" id="3857473">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3857478">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3857481">rc</span><span class="op" id="3857483">,</span>&nbsp;<span class="ident" id="3857485">ok</span>&nbsp;<span class="op" id="3857488">:=</span>&nbsp;<span class="ident" id="3857491">body</span><span class="op" id="3857495">.</span><span class="op" id="3857496">(</span><span class="ident" id="3857497">io</span><span class="op" id="3857499">.</span><span class="ident" id="3857500">ReadCloser</span><span class="op" id="3857510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3857513">if</span>&nbsp;<span class="op" id="3857516">!</span><span class="ident" id="3857517">ok</span>&nbsp;<span class="op" id="3857520">&amp;&amp;</span>&nbsp;<span class="ident" id="3857523">body</span>&nbsp;<span class="op" id="3857528">!=</span>&nbsp;<span class="ident" id="3857531">nil</span>&nbsp;<span class="op" id="3857535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3857539">rc</span>&nbsp;<span class="op" id="3857542">=</span>&nbsp;<span class="ident" id="3857544">ioutil</span><span class="op" id="3857550">.</span><span class="ident" id="3857551">NopCloser</span><span class="op" id="3857560">(</span><span class="ident" id="3857561">body</span><span class="op" id="3857565">)</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3857568">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3857571">req</span>&nbsp;<span class="op" id="3857575">:=</span>&nbsp;<span class="op" id="3857578">&amp;</span><span class="ident" id="3857579">Request</span><span class="op" id="3857586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3857590">Method</span><span class="op" id="3857596">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3857602">method</span><span class="op" id="3857608">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3857612">URL</span><span class="op" id="3857615">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3857624">u</span><span class="op" id="3857625">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3857629">Proto</span><span class="op" id="3857634">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3857641">&#34;HTTP/1.1&#34;</span><span class="op" id="3857651">,</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3857655">ProtoMajor</span><span class="op" id="3857665">:</span>&nbsp;<span class="num" id="3857667">1</span><span class="op" id="3857668">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3857672">ProtoMinor</span><span class="op" id="3857682">:</span>&nbsp;<span class="num" id="3857684">1</span><span class="op" id="3857685">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3857689">Header</span><span class="op" id="3857695">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3857701">make</span><span class="op" id="3857705">(</span><span class="ident" id="3857706">Header</span><span class="op" id="3857712">)</span><span class="op" id="3857713">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3857717">Body</span><span class="op" id="3857721">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3857729">rc</span><span class="op" id="3857731">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3857735">Host</span><span class="op" id="3857739">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3857747">u</span><span class="op" id="3857748">.</span><span class="ident" id="3857749">Host</span><span class="op" id="3857753">,</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3857756">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3857759">if</span>&nbsp;<span class="ident" id="3857762">body</span>&nbsp;<span class="op" id="3857767">!=</span>&nbsp;<span class="ident" id="3857770">nil</span>&nbsp;<span class="op" id="3857774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3857778">switch</span>&nbsp;<span class="ident" id="3857785">v</span>&nbsp;<span class="op" id="3857787">:=</span>&nbsp;<span class="ident" id="3857790">body</span><span class="op" id="3857794">.</span><span class="op" id="3857795">(</span><span class="keyword" id="3857796">type</span><span class="op" id="3857800">)</span>&nbsp;<span class="op" id="3857802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3857806">case</span>&nbsp;<span class="op" id="3857811">*</span><span class="ident" id="3857812">bytes</span><span class="op" id="3857817">.</span><span class="ident" id="3857818">Buffer</span><span class="op" id="3857824">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3857829">req</span><span class="op" id="3857832">.</span><span class="ident" id="3857833">ContentLength</span>&nbsp;<span class="op" id="3857847">=</span>&nbsp;<span class="ident" id="3857849">int64</span><span class="op" id="3857854">(</span><span class="ident" id="3857855">v</span><span class="op" id="3857856">.</span><span class="ident" id="3857857">Len</span><span class="op" id="3857860">(</span><span class="op" id="3857861">)</span><span class="op" id="3857862">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3857866">case</span>&nbsp;<span class="op" id="3857871">*</span><span class="ident" id="3857872">bytes</span><span class="op" id="3857877">.</span><span class="ident" id="3857878">Reader</span><span class="op" id="3857884">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3857889">req</span><span class="op" id="3857892">.</span><span class="ident" id="3857893">ContentLength</span>&nbsp;<span class="op" id="3857907">=</span>&nbsp;<span class="ident" id="3857909">int64</span><span class="op" id="3857914">(</span><span class="ident" id="3857915">v</span><span class="op" id="3857916">.</span><span class="ident" id="3857917">Len</span><span class="op" id="3857920">(</span><span class="op" id="3857921">)</span><span class="op" id="3857922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3857926">case</span>&nbsp;<span class="op" id="3857931">*</span><span class="ident" id="3857932">strings</span><span class="op" id="3857939">.</span><span class="ident" id="3857940">Reader</span><span class="op" id="3857946">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3857951">req</span><span class="op" id="3857954">.</span><span class="ident" id="3857955">ContentLength</span>&nbsp;<span class="op" id="3857969">=</span>&nbsp;<span class="ident" id="3857971">int64</span><span class="op" id="3857976">(</span><span class="ident" id="3857977">v</span><span class="op" id="3857978">.</span><span class="ident" id="3857979">Len</span><span class="op" id="3857982">(</span><span class="op" id="3857983">)</span><span class="op" id="3857984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3857988">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3857991">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3857995">return</span>&nbsp;<span class="ident" id="3858002">req</span><span class="op" id="3858005">,</span>&nbsp;<span class="ident" id="3858007">nil</span><br>
<span class="lineno"></span><span class="op" id="3858011">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">525</span><span class="comment" id="3858014">//&nbsp;BasicAuth&nbsp;returns&nbsp;the&nbsp;username&nbsp;and&nbsp;password&nbsp;provided&nbsp;in&nbsp;the&nbsp;request&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="3858087">//&nbsp;Authorization&nbsp;header,&nbsp;if&nbsp;the&nbsp;request&nbsp;uses&nbsp;HTTP&nbsp;Basic&nbsp;Authentication.</span><br>
<span class="lineno"></span><span class="comment" id="3858159">//&nbsp;See&nbsp;RFC&nbsp;2617,&nbsp;Section&nbsp;2.</span><br>
<span class="lineno"></span><span class="keyword" id="3858187">func</span>&nbsp;<span class="op" id="3858192">(</span><span class="ident" id="3858193">r</span>&nbsp;<span class="op" id="3858195">*</span><span class="ident" id="3858196">Request</span><span class="op" id="3858203">)</span>&nbsp;<span class="ident" id="3858205">BasicAuth</span><span class="op" id="3858214">(</span><span class="op" id="3858215">)</span>&nbsp;<span class="op" id="3858217">(</span><span class="ident" id="3858218">username</span><span class="op" id="3858226">,</span>&nbsp;<span class="ident" id="3858228">password</span>&nbsp;<span class="builtintype" id="3858237">string</span><span class="op" id="3858243">,</span>&nbsp;<span class="ident" id="3858245">ok</span>&nbsp;<span class="builtintype" id="3858248">bool</span><span class="op" id="3858252">)</span>&nbsp;<span class="op" id="3858254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3858257">auth</span>&nbsp;<span class="op" id="3858262">:=</span>&nbsp;<span class="ident" id="3858265">r</span><span class="op" id="3858266">.</span><span class="ident" id="3858267">Header</span><span class="op" id="3858273">.</span><span class="ident" id="3858274">Get</span><span class="op" id="3858277">(</span><span class="string" id="3858278">&#34;Authorization&#34;</span><span class="op" id="3858293">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3858296">if</span>&nbsp;<span class="ident" id="3858299">auth</span>&nbsp;<span class="op" id="3858304">==</span>&nbsp;<span class="string" id="3858307">&#34;&#34;</span>&nbsp;<span class="op" id="3858310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3858314">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3858322">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3858325">return</span>&nbsp;<span class="ident" id="3858332">parseBasicAuth</span><span class="op" id="3858346">(</span><span class="ident" id="3858347">auth</span><span class="op" id="3858351">)</span><br>
<span class="lineno"></span><span class="op" id="3858353">}</span><br>
<span class="lineno">535</span><br>
<span class="lineno"></span><span class="comment" id="3858356">//&nbsp;parseBasicAuth&nbsp;parses&nbsp;an&nbsp;HTTP&nbsp;Basic&nbsp;Authentication&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="3858418">//&nbsp;&#34;Basic&nbsp;QWxhZGRpbjpvcGVuIHNlc2FtZQ==&#34;&nbsp;returns&nbsp;(&#34;Aladdin&#34;,&nbsp;&#34;open&nbsp;sesame&#34;,&nbsp;true).</span><br>
<span class="lineno"></span><span class="keyword" id="3858500">func</span>&nbsp;<span class="ident" id="3858505">parseBasicAuth</span><span class="op" id="3858519">(</span><span class="ident" id="3858520">auth</span>&nbsp;<span class="builtintype" id="3858525">string</span><span class="op" id="3858531">)</span>&nbsp;<span class="op" id="3858533">(</span><span class="ident" id="3858534">username</span><span class="op" id="3858542">,</span>&nbsp;<span class="ident" id="3858544">password</span>&nbsp;<span class="builtintype" id="3858553">string</span><span class="op" id="3858559">,</span>&nbsp;<span class="ident" id="3858561">ok</span>&nbsp;<span class="builtintype" id="3858564">bool</span><span class="op" id="3858568">)</span>&nbsp;<span class="op" id="3858570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3858573">if</span>&nbsp;<span class="op" id="3858576">!</span><span class="ident" id="3858577">strings</span><span class="op" id="3858584">.</span><span class="ident" id="3858585">HasPrefix</span><span class="op" id="3858594">(</span><span class="ident" id="3858595">auth</span><span class="op" id="3858599">,</span>&nbsp;<span class="string" id="3858601">&#34;Basic&nbsp;&#34;</span><span class="op" id="3858609">)</span>&nbsp;<span class="op" id="3858611">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3858615">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3858623">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3858626">c</span><span class="op" id="3858627">,</span>&nbsp;<span class="ident" id="3858629">err</span>&nbsp;<span class="op" id="3858633">:=</span>&nbsp;<span class="ident" id="3858636">base64</span><span class="op" id="3858642">.</span><span class="ident" id="3858643">StdEncoding</span><span class="op" id="3858654">.</span><span class="ident" id="3858655">DecodeString</span><span class="op" id="3858667">(</span><span class="ident" id="3858668">strings</span><span class="op" id="3858675">.</span><span class="ident" id="3858676">TrimPrefix</span><span class="op" id="3858686">(</span><span class="ident" id="3858687">auth</span><span class="op" id="3858691">,</span>&nbsp;<span class="string" id="3858693">&#34;Basic&nbsp;&#34;</span><span class="op" id="3858701">)</span><span class="op" id="3858702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3858705">if</span>&nbsp;<span class="ident" id="3858708">err</span>&nbsp;<span class="op" id="3858712">!=</span>&nbsp;<span class="ident" id="3858715">nil</span>&nbsp;<span class="op" id="3858719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3858723">return</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3858731">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3858734">cs</span>&nbsp;<span class="op" id="3858737">:=</span>&nbsp;<span class="builtintype" id="3858740">string</span><span class="op" id="3858746">(</span><span class="ident" id="3858747">c</span><span class="op" id="3858748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3858751">s</span>&nbsp;<span class="op" id="3858753">:=</span>&nbsp;<span class="ident" id="3858756">strings</span><span class="op" id="3858763">.</span><span class="ident" id="3858764">IndexByte</span><span class="op" id="3858773">(</span><span class="ident" id="3858774">cs</span><span class="op" id="3858776">,</span>&nbsp;<span class="string" id="3858778">&#39;:&#39;</span><span class="op" id="3858781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3858784">if</span>&nbsp;<span class="ident" id="3858787">s</span>&nbsp;<span class="op" id="3858789">&lt;</span>&nbsp;<span class="num" id="3858791">0</span>&nbsp;<span class="op" id="3858793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3858797">return</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3858805">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3858808">return</span>&nbsp;<span class="ident" id="3858815">cs</span><span class="op" id="3858817">[</span><span class="op" id="3858818">:</span><span class="ident" id="3858819">s</span><span class="op" id="3858820">]</span><span class="op" id="3858821">,</span>&nbsp;<span class="ident" id="3858823">cs</span><span class="op" id="3858825">[</span><span class="ident" id="3858826">s</span><span class="op" id="3858827">+</span><span class="num" id="3858828">1</span><span class="op" id="3858829">:</span><span class="op" id="3858830">]</span><span class="op" id="3858831">,</span>&nbsp;<span class="builtintype" id="3858833">true</span><br>
<span class="lineno"></span><span class="op" id="3858838">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3858841">//&nbsp;SetBasicAuth&nbsp;sets&nbsp;the&nbsp;request&#39;s&nbsp;Authorization&nbsp;header&nbsp;to&nbsp;use&nbsp;HTTP</span><br>
<span class="lineno">555</span><span class="comment" id="3858909">//&nbsp;Basic&nbsp;Authentication&nbsp;with&nbsp;the&nbsp;provided&nbsp;username&nbsp;and&nbsp;password.</span><br>
<span class="lineno"></span><span class="comment" id="3858974">//</span><br>
<span class="lineno"></span><span class="comment" id="3858977">//&nbsp;With&nbsp;HTTP&nbsp;Basic&nbsp;Authentication&nbsp;the&nbsp;provided&nbsp;username&nbsp;and&nbsp;password</span><br>
<span class="lineno"></span><span class="comment" id="3859046">//&nbsp;are&nbsp;not&nbsp;encrypted.</span><br>
<span class="lineno"></span><span class="keyword" id="3859068">func</span>&nbsp;<span class="op" id="3859073">(</span><span class="ident" id="3859074">r</span>&nbsp;<span class="op" id="3859076">*</span><span class="ident" id="3859077">Request</span><span class="op" id="3859084">)</span>&nbsp;<span class="ident" id="3859086">SetBasicAuth</span><span class="op" id="3859098">(</span><span class="ident" id="3859099">username</span><span class="op" id="3859107">,</span>&nbsp;<span class="ident" id="3859109">password</span>&nbsp;<span class="builtintype" id="3859118">string</span><span class="op" id="3859124">)</span>&nbsp;<span class="op" id="3859126">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3859129">r</span><span class="op" id="3859130">.</span><span class="ident" id="3859131">Header</span><span class="op" id="3859137">.</span><span class="ident" id="3859138">Set</span><span class="op" id="3859141">(</span><span class="string" id="3859142">&#34;Authorization&#34;</span><span class="op" id="3859157">,</span>&nbsp;<span class="string" id="3859159">&#34;Basic&nbsp;&#34;</span><span class="op" id="3859167">+</span><span class="ident" id="3859168">basicAuth</span><span class="op" id="3859177">(</span><span class="ident" id="3859178">username</span><span class="op" id="3859186">,</span>&nbsp;<span class="ident" id="3859188">password</span><span class="op" id="3859196">)</span><span class="op" id="3859197">)</span><br>
<span class="lineno"></span><span class="op" id="3859199">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3859202">//&nbsp;parseRequestLine&nbsp;parses&nbsp;&#34;GET&nbsp;/foo&nbsp;HTTP/1.1&#34;&nbsp;into&nbsp;its&nbsp;three&nbsp;parts.</span><br>
<span class="lineno"></span><span class="keyword" id="3859271">func</span>&nbsp;<span class="ident" id="3859276">parseRequestLine</span><span class="op" id="3859292">(</span><span class="ident" id="3859293">line</span>&nbsp;<span class="builtintype" id="3859298">string</span><span class="op" id="3859304">)</span>&nbsp;<span class="op" id="3859306">(</span><span class="ident" id="3859307">method</span><span class="op" id="3859313">,</span>&nbsp;<span class="ident" id="3859315">requestURI</span><span class="op" id="3859325">,</span>&nbsp;<span class="ident" id="3859327">proto</span>&nbsp;<span class="builtintype" id="3859333">string</span><span class="op" id="3859339">,</span>&nbsp;<span class="ident" id="3859341">ok</span>&nbsp;<span class="builtintype" id="3859344">bool</span><span class="op" id="3859348">)</span>&nbsp;<span class="op" id="3859350">{</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3859353">s1</span>&nbsp;<span class="op" id="3859356">:=</span>&nbsp;<span class="ident" id="3859359">strings</span><span class="op" id="3859366">.</span><span class="ident" id="3859367">Index</span><span class="op" id="3859372">(</span><span class="ident" id="3859373">line</span><span class="op" id="3859377">,</span>&nbsp;<span class="string" id="3859379">&#34;&nbsp;&#34;</span><span class="op" id="3859382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3859385">s2</span>&nbsp;<span class="op" id="3859388">:=</span>&nbsp;<span class="ident" id="3859391">strings</span><span class="op" id="3859398">.</span><span class="ident" id="3859399">Index</span><span class="op" id="3859404">(</span><span class="ident" id="3859405">line</span><span class="op" id="3859409">[</span><span class="ident" id="3859410">s1</span><span class="op" id="3859412">+</span><span class="num" id="3859413">1</span><span class="op" id="3859414">:</span><span class="op" id="3859415">]</span><span class="op" id="3859416">,</span>&nbsp;<span class="string" id="3859418">&#34;&nbsp;&#34;</span><span class="op" id="3859421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3859424">if</span>&nbsp;<span class="ident" id="3859427">s1</span>&nbsp;<span class="op" id="3859430">&lt;</span>&nbsp;<span class="num" id="3859432">0</span>&nbsp;<span class="op" id="3859434">||</span>&nbsp;<span class="ident" id="3859437">s2</span>&nbsp;<span class="op" id="3859440">&lt;</span>&nbsp;<span class="num" id="3859442">0</span>&nbsp;<span class="op" id="3859444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3859448">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3859456">}</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3859459">s2</span>&nbsp;<span class="op" id="3859462">+=</span>&nbsp;<span class="ident" id="3859465">s1</span>&nbsp;<span class="op" id="3859468">+</span>&nbsp;<span class="num" id="3859470">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3859473">return</span>&nbsp;<span class="ident" id="3859480">line</span><span class="op" id="3859484">[</span><span class="op" id="3859485">:</span><span class="ident" id="3859486">s1</span><span class="op" id="3859488">]</span><span class="op" id="3859489">,</span>&nbsp;<span class="ident" id="3859491">line</span><span class="op" id="3859495">[</span><span class="ident" id="3859496">s1</span><span class="op" id="3859498">+</span><span class="num" id="3859499">1</span>&nbsp;<span class="op" id="3859501">:</span>&nbsp;<span class="ident" id="3859503">s2</span><span class="op" id="3859505">]</span><span class="op" id="3859506">,</span>&nbsp;<span class="ident" id="3859508">line</span><span class="op" id="3859512">[</span><span class="ident" id="3859513">s2</span><span class="op" id="3859515">+</span><span class="num" id="3859516">1</span><span class="op" id="3859517">:</span><span class="op" id="3859518">]</span><span class="op" id="3859519">,</span>&nbsp;<span class="builtintype" id="3859521">true</span><br>
<span class="lineno"></span><span class="op" id="3859526">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3859529">var</span>&nbsp;<span class="ident" id="3859533">textprotoReaderPool</span>&nbsp;<span class="ident" id="3859553">sync</span><span class="op" id="3859557">.</span><span class="ident" id="3859558">Pool</span><br>
<span class="lineno">575</span><br>
<span class="lineno"></span><span class="keyword" id="3859564">func</span>&nbsp;<span class="ident" id="3859569">newTextprotoReader</span><span class="op" id="3859587">(</span><span class="ident" id="3859588">br</span>&nbsp;<span class="op" id="3859591">*</span><span class="ident" id="3859592">bufio</span><span class="op" id="3859597">.</span><span class="ident" id="3859598">Reader</span><span class="op" id="3859604">)</span>&nbsp;<span class="op" id="3859606">*</span><span class="ident" id="3859607">textproto</span><span class="op" id="3859616">.</span><span class="ident" id="3859617">Reader</span>&nbsp;<span class="op" id="3859624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3859627">if</span>&nbsp;<span class="ident" id="3859630">v</span>&nbsp;<span class="op" id="3859632">:=</span>&nbsp;<span class="ident" id="3859635">textprotoReaderPool</span><span class="op" id="3859654">.</span><span class="ident" id="3859655">Get</span><span class="op" id="3859658">(</span><span class="op" id="3859659">)</span><span class="op" id="3859660">;</span>&nbsp;<span class="ident" id="3859662">v</span>&nbsp;<span class="op" id="3859664">!=</span>&nbsp;<span class="ident" id="3859667">nil</span>&nbsp;<span class="op" id="3859671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3859675">tr</span>&nbsp;<span class="op" id="3859678">:=</span>&nbsp;<span class="ident" id="3859681">v</span><span class="op" id="3859682">.</span><span class="op" id="3859683">(</span><span class="op" id="3859684">*</span><span class="ident" id="3859685">textproto</span><span class="op" id="3859694">.</span><span class="ident" id="3859695">Reader</span><span class="op" id="3859701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3859705">tr</span><span class="op" id="3859707">.</span><span class="ident" id="3859708">R</span>&nbsp;<span class="op" id="3859710">=</span>&nbsp;<span class="ident" id="3859712">br</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3859717">return</span>&nbsp;<span class="ident" id="3859724">tr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3859728">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3859731">return</span>&nbsp;<span class="ident" id="3859738">textproto</span><span class="op" id="3859747">.</span><span class="ident" id="3859748">NewReader</span><span class="op" id="3859757">(</span><span class="ident" id="3859758">br</span><span class="op" id="3859760">)</span><br>
<span class="lineno"></span><span class="op" id="3859762">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">585</span><span class="keyword" id="3859765">func</span>&nbsp;<span class="ident" id="3859770">putTextprotoReader</span><span class="op" id="3859788">(</span><span class="ident" id="3859789">r</span>&nbsp;<span class="op" id="3859791">*</span><span class="ident" id="3859792">textproto</span><span class="op" id="3859801">.</span><span class="ident" id="3859802">Reader</span><span class="op" id="3859808">)</span>&nbsp;<span class="op" id="3859810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3859813">r</span><span class="op" id="3859814">.</span><span class="ident" id="3859815">R</span>&nbsp;<span class="op" id="3859817">=</span>&nbsp;<span class="ident" id="3859819">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3859824">textprotoReaderPool</span><span class="op" id="3859843">.</span><span class="ident" id="3859844">Put</span><span class="op" id="3859847">(</span><span class="ident" id="3859848">r</span><span class="op" id="3859849">)</span><br>
<span class="lineno"></span><span class="op" id="3859851">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">590</span><span class="comment" id="3859854">//&nbsp;ReadRequest&nbsp;reads&nbsp;and&nbsp;parses&nbsp;a&nbsp;request&nbsp;from&nbsp;b.</span><br>
<span class="lineno"></span><span class="keyword" id="3859904">func</span>&nbsp;<span class="ident" id="3859909">ReadRequest</span><span class="op" id="3859920">(</span><span class="ident" id="3859921">b</span>&nbsp;<span class="op" id="3859923">*</span><span class="ident" id="3859924">bufio</span><span class="op" id="3859929">.</span><span class="ident" id="3859930">Reader</span><span class="op" id="3859936">)</span>&nbsp;<span class="op" id="3859938">(</span><span class="ident" id="3859939">req</span>&nbsp;<span class="op" id="3859943">*</span><span class="ident" id="3859944">Request</span><span class="op" id="3859951">,</span>&nbsp;<span class="ident" id="3859953">err</span>&nbsp;<span class="builtintype" id="3859957">error</span><span class="op" id="3859962">)</span>&nbsp;<span class="op" id="3859964">{</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3859968">tp</span>&nbsp;<span class="op" id="3859971">:=</span>&nbsp;<span class="ident" id="3859974">newTextprotoReader</span><span class="op" id="3859992">(</span><span class="ident" id="3859993">b</span><span class="op" id="3859994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3859997">req</span>&nbsp;<span class="op" id="3860001">=</span>&nbsp;<span class="builtinfunc" id="3860003">new</span><span class="op" id="3860006">(</span><span class="ident" id="3860007">Request</span><span class="op" id="3860014">)</span><br>
<span class="lineno">595</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3860018">//&nbsp;First&nbsp;line:&nbsp;GET&nbsp;/index.html&nbsp;HTTP/1.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3860059">var</span>&nbsp;<span class="ident" id="3860063">s</span>&nbsp;<span class="builtintype" id="3860065">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3860073">if</span>&nbsp;<span class="ident" id="3860076">s</span><span class="op" id="3860077">,</span>&nbsp;<span class="ident" id="3860079">err</span>&nbsp;<span class="op" id="3860083">=</span>&nbsp;<span class="ident" id="3860085">tp</span><span class="op" id="3860087">.</span><span class="ident" id="3860088">ReadLine</span><span class="op" id="3860096">(</span><span class="op" id="3860097">)</span><span class="op" id="3860098">;</span>&nbsp;<span class="ident" id="3860100">err</span>&nbsp;<span class="op" id="3860104">!=</span>&nbsp;<span class="ident" id="3860107">nil</span>&nbsp;<span class="op" id="3860111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3860115">return</span>&nbsp;<span class="ident" id="3860122">nil</span><span class="op" id="3860125">,</span>&nbsp;<span class="ident" id="3860127">err</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3860132">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3860135">defer</span>&nbsp;<span class="keyword" id="3860141">func</span><span class="op" id="3860145">(</span><span class="op" id="3860146">)</span>&nbsp;<span class="op" id="3860148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3860152">putTextprotoReader</span><span class="op" id="3860170">(</span><span class="ident" id="3860171">tp</span><span class="op" id="3860173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3860177">if</span>&nbsp;<span class="ident" id="3860180">err</span>&nbsp;<span class="op" id="3860184">==</span>&nbsp;<span class="ident" id="3860187">io</span><span class="op" id="3860189">.</span><span class="ident" id="3860190">EOF</span>&nbsp;<span class="op" id="3860194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3860199">err</span>&nbsp;<span class="op" id="3860203">=</span>&nbsp;<span class="ident" id="3860205">io</span><span class="op" id="3860207">.</span><span class="ident" id="3860208">ErrUnexpectedEOF</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3860227">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3860230">}</span><span class="op" id="3860231">(</span><span class="op" id="3860232">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3860236">var</span>&nbsp;<span class="ident" id="3860240">ok</span>&nbsp;<span class="builtintype" id="3860243">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3860249">req</span><span class="op" id="3860252">.</span><span class="ident" id="3860253">Method</span><span class="op" id="3860259">,</span>&nbsp;<span class="ident" id="3860261">req</span><span class="op" id="3860264">.</span><span class="ident" id="3860265">RequestURI</span><span class="op" id="3860275">,</span>&nbsp;<span class="ident" id="3860277">req</span><span class="op" id="3860280">.</span><span class="ident" id="3860281">Proto</span><span class="op" id="3860286">,</span>&nbsp;<span class="ident" id="3860288">ok</span>&nbsp;<span class="op" id="3860291">=</span>&nbsp;<span class="ident" id="3860293">parseRequestLine</span><span class="op" id="3860309">(</span><span class="ident" id="3860310">s</span><span class="op" id="3860311">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3860314">if</span>&nbsp;<span class="op" id="3860317">!</span><span class="ident" id="3860318">ok</span>&nbsp;<span class="op" id="3860321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3860325">return</span>&nbsp;<span class="ident" id="3860332">nil</span><span class="op" id="3860335">,</span>&nbsp;<span class="op" id="3860337">&amp;</span><span class="ident" id="3860338">badStringError</span><span class="op" id="3860352">{</span><span class="string" id="3860353">&#34;malformed&nbsp;HTTP&nbsp;request&#34;</span><span class="op" id="3860377">,</span>&nbsp;<span class="ident" id="3860379">s</span><span class="op" id="3860380">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3860383">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3860386">rawurl</span>&nbsp;<span class="op" id="3860393">:=</span>&nbsp;<span class="ident" id="3860396">req</span><span class="op" id="3860399">.</span><span class="ident" id="3860400">RequestURI</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3860412">if</span>&nbsp;<span class="ident" id="3860415">req</span><span class="op" id="3860418">.</span><span class="ident" id="3860419">ProtoMajor</span><span class="op" id="3860429">,</span>&nbsp;<span class="ident" id="3860431">req</span><span class="op" id="3860434">.</span><span class="ident" id="3860435">ProtoMinor</span><span class="op" id="3860445">,</span>&nbsp;<span class="ident" id="3860447">ok</span>&nbsp;<span class="op" id="3860450">=</span>&nbsp;<span class="ident" id="3860452">ParseHTTPVersion</span><span class="op" id="3860468">(</span><span class="ident" id="3860469">req</span><span class="op" id="3860472">.</span><span class="ident" id="3860473">Proto</span><span class="op" id="3860478">)</span><span class="op" id="3860479">;</span>&nbsp;<span class="op" id="3860481">!</span><span class="ident" id="3860482">ok</span>&nbsp;<span class="op" id="3860485">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3860489">return</span>&nbsp;<span class="ident" id="3860496">nil</span><span class="op" id="3860499">,</span>&nbsp;<span class="op" id="3860501">&amp;</span><span class="ident" id="3860502">badStringError</span><span class="op" id="3860516">{</span><span class="string" id="3860517">&#34;malformed&nbsp;HTTP&nbsp;version&#34;</span><span class="op" id="3860541">,</span>&nbsp;<span class="ident" id="3860543">req</span><span class="op" id="3860546">.</span><span class="ident" id="3860547">Proto</span><span class="op" id="3860552">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3860555">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3860559">//&nbsp;CONNECT&nbsp;requests&nbsp;are&nbsp;used&nbsp;two&nbsp;different&nbsp;ways,&nbsp;and&nbsp;neither&nbsp;uses&nbsp;a&nbsp;full&nbsp;URL:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3860638">//&nbsp;The&nbsp;standard&nbsp;use&nbsp;is&nbsp;to&nbsp;tunnel&nbsp;HTTPS&nbsp;through&nbsp;an&nbsp;HTTP&nbsp;proxy.</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3860701">//&nbsp;It&nbsp;looks&nbsp;like&nbsp;&#34;CONNECT&nbsp;www.google.com:443&nbsp;HTTP/1.1&#34;,&nbsp;and&nbsp;the&nbsp;parameter&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3860779">//&nbsp;just&nbsp;the&nbsp;authority&nbsp;section&nbsp;of&nbsp;a&nbsp;URL.&nbsp;This&nbsp;information&nbsp;should&nbsp;go&nbsp;in&nbsp;req.URL.Host.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3860864">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3860868">//&nbsp;The&nbsp;net/rpc&nbsp;package&nbsp;also&nbsp;uses&nbsp;CONNECT,&nbsp;but&nbsp;there&nbsp;the&nbsp;parameter&nbsp;is&nbsp;a&nbsp;path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3860945">//&nbsp;that&nbsp;starts&nbsp;with&nbsp;a&nbsp;slash.&nbsp;It&nbsp;can&nbsp;be&nbsp;parsed&nbsp;with&nbsp;the&nbsp;regular&nbsp;URL&nbsp;parser,</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3861021">//&nbsp;and&nbsp;the&nbsp;path&nbsp;will&nbsp;end&nbsp;up&nbsp;in&nbsp;req.URL.Path,&nbsp;where&nbsp;it&nbsp;needs&nbsp;to&nbsp;be&nbsp;in&nbsp;order&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3861101">//&nbsp;RPC&nbsp;to&nbsp;work.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3861118">justAuthority</span>&nbsp;<span class="op" id="3861132">:=</span>&nbsp;<span class="ident" id="3861135">req</span><span class="op" id="3861138">.</span><span class="ident" id="3861139">Method</span>&nbsp;<span class="op" id="3861146">==</span>&nbsp;<span class="string" id="3861149">&#34;CONNECT&#34;</span>&nbsp;<span class="op" id="3861159">&amp;&amp;</span>&nbsp;<span class="op" id="3861162">!</span><span class="ident" id="3861163">strings</span><span class="op" id="3861170">.</span><span class="ident" id="3861171">HasPrefix</span><span class="op" id="3861180">(</span><span class="ident" id="3861181">rawurl</span><span class="op" id="3861187">,</span>&nbsp;<span class="string" id="3861189">&#34;/&#34;</span><span class="op" id="3861192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3861195">if</span>&nbsp;<span class="ident" id="3861198">justAuthority</span>&nbsp;<span class="op" id="3861212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3861216">rawurl</span>&nbsp;<span class="op" id="3861223">=</span>&nbsp;<span class="string" id="3861225">&#34;http://&#34;</span>&nbsp;<span class="op" id="3861235">+</span>&nbsp;<span class="ident" id="3861237">rawurl</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3861245">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3861249">if</span>&nbsp;<span class="ident" id="3861252">req</span><span class="op" id="3861255">.</span><span class="ident" id="3861256">URL</span><span class="op" id="3861259">,</span>&nbsp;<span class="ident" id="3861261">err</span>&nbsp;<span class="op" id="3861265">=</span>&nbsp;<span class="ident" id="3861267">url</span><span class="op" id="3861270">.</span><span class="ident" id="3861271">ParseRequestURI</span><span class="op" id="3861286">(</span><span class="ident" id="3861287">rawurl</span><span class="op" id="3861293">)</span><span class="op" id="3861294">;</span>&nbsp;<span class="ident" id="3861296">err</span>&nbsp;<span class="op" id="3861300">!=</span>&nbsp;<span class="ident" id="3861303">nil</span>&nbsp;<span class="op" id="3861307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3861311">return</span>&nbsp;<span class="ident" id="3861318">nil</span><span class="op" id="3861321">,</span>&nbsp;<span class="ident" id="3861323">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3861328">}</span><br>
<span class="lineno">635</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3861332">if</span>&nbsp;<span class="ident" id="3861335">justAuthority</span>&nbsp;<span class="op" id="3861349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3861353">//&nbsp;Strip&nbsp;the&nbsp;bogus&nbsp;&#34;http://&#34;&nbsp;back&nbsp;off.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3861394">req</span><span class="op" id="3861397">.</span><span class="ident" id="3861398">URL</span><span class="op" id="3861401">.</span><span class="ident" id="3861402">Scheme</span>&nbsp;<span class="op" id="3861409">=</span>&nbsp;<span class="string" id="3861411">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3861415">}</span><br>
<span class="lineno">640</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3861419">//&nbsp;Subsequent&nbsp;lines:&nbsp;Key:&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3861453">mimeHeader</span><span class="op" id="3861463">,</span>&nbsp;<span class="ident" id="3861465">err</span>&nbsp;<span class="op" id="3861469">:=</span>&nbsp;<span class="ident" id="3861472">tp</span><span class="op" id="3861474">.</span><span class="ident" id="3861475">ReadMIMEHeader</span><span class="op" id="3861489">(</span><span class="op" id="3861490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3861493">if</span>&nbsp;<span class="ident" id="3861496">err</span>&nbsp;<span class="op" id="3861500">!=</span>&nbsp;<span class="ident" id="3861503">nil</span>&nbsp;<span class="op" id="3861507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3861511">return</span>&nbsp;<span class="ident" id="3861518">nil</span><span class="op" id="3861521">,</span>&nbsp;<span class="ident" id="3861523">err</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3861528">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3861531">req</span><span class="op" id="3861534">.</span><span class="ident" id="3861535">Header</span>&nbsp;<span class="op" id="3861542">=</span>&nbsp;<span class="ident" id="3861544">Header</span><span class="op" id="3861550">(</span><span class="ident" id="3861551">mimeHeader</span><span class="op" id="3861561">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3861565">//&nbsp;RFC2616:&nbsp;Must&nbsp;treat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3861589">//&nbsp;&nbsp;&nbsp;&nbspGET&nbsp;/index.html&nbsp;HTTP/1.1</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3861618">//&nbsp;&nbsp;&nbsp;&nbspHost:&nbsp;www.google.com</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3861643">//&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3861651">//&nbsp;&nbsp;&nbsp;&nbspGET&nbsp;http://www.google.com/index.html&nbsp;HTTP/1.1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3861701">//&nbsp;&nbsp;&nbsp;&nbspHost:&nbsp;doesntmatter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3861724">//&nbsp;the&nbsp;same.&nbsp;&nbsp;In&nbsp;the&nbsp;second&nbsp;case,&nbsp;any&nbsp;Host&nbsp;line&nbsp;is&nbsp;ignored.</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3861785">req</span><span class="op" id="3861788">.</span><span class="ident" id="3861789">Host</span>&nbsp;<span class="op" id="3861794">=</span>&nbsp;<span class="ident" id="3861796">req</span><span class="op" id="3861799">.</span><span class="ident" id="3861800">URL</span><span class="op" id="3861803">.</span><span class="ident" id="3861804">Host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3861810">if</span>&nbsp;<span class="ident" id="3861813">req</span><span class="op" id="3861816">.</span><span class="ident" id="3861817">Host</span>&nbsp;<span class="op" id="3861822">==</span>&nbsp;<span class="string" id="3861825">&#34;&#34;</span>&nbsp;<span class="op" id="3861828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3861832">req</span><span class="op" id="3861835">.</span><span class="ident" id="3861836">Host</span>&nbsp;<span class="op" id="3861841">=</span>&nbsp;<span class="ident" id="3861843">req</span><span class="op" id="3861846">.</span><span class="ident" id="3861847">Header</span><span class="op" id="3861853">.</span><span class="ident" id="3861854">get</span><span class="op" id="3861857">(</span><span class="string" id="3861858">&#34;Host&#34;</span><span class="op" id="3861864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3861867">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3861870">delete</span><span class="op" id="3861876">(</span><span class="ident" id="3861877">req</span><span class="op" id="3861880">.</span><span class="ident" id="3861881">Header</span><span class="op" id="3861887">,</span>&nbsp;<span class="string" id="3861889">&#34;Host&#34;</span><span class="op" id="3861895">)</span><br>
<span class="lineno">660</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3861899">fixPragmaCacheControl</span><span class="op" id="3861920">(</span><span class="ident" id="3861921">req</span><span class="op" id="3861924">.</span><span class="ident" id="3861925">Header</span><span class="op" id="3861931">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3861935">err</span>&nbsp;<span class="op" id="3861939">=</span>&nbsp;<span class="ident" id="3861941">readTransfer</span><span class="op" id="3861953">(</span><span class="ident" id="3861954">req</span><span class="op" id="3861957">,</span>&nbsp;<span class="ident" id="3861959">b</span><span class="op" id="3861960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3861963">if</span>&nbsp;<span class="ident" id="3861966">err</span>&nbsp;<span class="op" id="3861970">!=</span>&nbsp;<span class="ident" id="3861973">nil</span>&nbsp;<span class="op" id="3861977">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3861981">return</span>&nbsp;<span class="ident" id="3861988">nil</span><span class="op" id="3861991">,</span>&nbsp;<span class="ident" id="3861993">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3861998">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3862002">req</span><span class="op" id="3862005">.</span><span class="ident" id="3862006">Close</span>&nbsp;<span class="op" id="3862012">=</span>&nbsp;<span class="ident" id="3862014">shouldClose</span><span class="op" id="3862025">(</span><span class="ident" id="3862026">req</span><span class="op" id="3862029">.</span><span class="ident" id="3862030">ProtoMajor</span><span class="op" id="3862040">,</span>&nbsp;<span class="ident" id="3862042">req</span><span class="op" id="3862045">.</span><span class="ident" id="3862046">ProtoMinor</span><span class="op" id="3862056">,</span>&nbsp;<span class="ident" id="3862058">req</span><span class="op" id="3862061">.</span><span class="ident" id="3862062">Header</span><span class="op" id="3862068">,</span>&nbsp;<span class="builtintype" id="3862070">false</span><span class="op" id="3862075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3862078">return</span>&nbsp;<span class="ident" id="3862085">req</span><span class="op" id="3862088">,</span>&nbsp;<span class="ident" id="3862090">nil</span><br>
<span class="lineno">670</span><span class="op" id="3862094">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3862097">//&nbsp;MaxBytesReader&nbsp;is&nbsp;similar&nbsp;to&nbsp;io.LimitReader&nbsp;but&nbsp;is&nbsp;intended&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="3862164">//&nbsp;limiting&nbsp;the&nbsp;size&nbsp;of&nbsp;incoming&nbsp;request&nbsp;bodies.&nbsp;In&nbsp;contrast&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3862228">//&nbsp;io.LimitReader,&nbsp;MaxBytesReader&#39;s&nbsp;result&nbsp;is&nbsp;a&nbsp;ReadCloser,&nbsp;returns&nbsp;a</span><br>
<span class="lineno">675</span><span class="comment" id="3862298">//&nbsp;non-EOF&nbsp;error&nbsp;for&nbsp;a&nbsp;Read&nbsp;beyond&nbsp;the&nbsp;limit,&nbsp;and&nbsp;Closes&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3862359">//&nbsp;underlying&nbsp;reader&nbsp;when&nbsp;its&nbsp;Close&nbsp;method&nbsp;is&nbsp;called.</span><br>
<span class="lineno"></span><span class="comment" id="3862413">//</span><br>
<span class="lineno"></span><span class="comment" id="3862416">//&nbsp;MaxBytesReader&nbsp;prevents&nbsp;clients&nbsp;from&nbsp;accidentally&nbsp;or&nbsp;maliciously</span><br>
<span class="lineno"></span><span class="comment" id="3862484">//&nbsp;sending&nbsp;a&nbsp;large&nbsp;request&nbsp;and&nbsp;wasting&nbsp;server&nbsp;resources.</span><br>
<span class="lineno">680</span><span class="keyword" id="3862541">func</span>&nbsp;<span class="ident" id="3862546">MaxBytesReader</span><span class="op" id="3862560">(</span><span class="ident" id="3862561">w</span>&nbsp;<span class="ident" id="3862563">ResponseWriter</span><span class="op" id="3862577">,</span>&nbsp;<span class="ident" id="3862579">r</span>&nbsp;<span class="ident" id="3862581">io</span><span class="op" id="3862583">.</span><span class="ident" id="3862584">ReadCloser</span><span class="op" id="3862594">,</span>&nbsp;<span class="ident" id="3862596">n</span>&nbsp;<span class="ident" id="3862598">int64</span><span class="op" id="3862603">)</span>&nbsp;<span class="ident" id="3862605">io</span><span class="op" id="3862607">.</span><span class="ident" id="3862608">ReadCloser</span>&nbsp;<span class="op" id="3862619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3862622">return</span>&nbsp;<span class="op" id="3862629">&amp;</span><span class="ident" id="3862630">maxBytesReader</span><span class="op" id="3862644">{</span><span class="ident" id="3862645">w</span><span class="op" id="3862646">:</span>&nbsp;<span class="ident" id="3862648">w</span><span class="op" id="3862649">,</span>&nbsp;<span class="ident" id="3862651">r</span><span class="op" id="3862652">:</span>&nbsp;<span class="ident" id="3862654">r</span><span class="op" id="3862655">,</span>&nbsp;<span class="ident" id="3862657">n</span><span class="op" id="3862658">:</span>&nbsp;<span class="ident" id="3862660">n</span><span class="op" id="3862661">}</span><br>
<span class="lineno"></span><span class="op" id="3862663">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3862666">type</span>&nbsp;<span class="ident" id="3862671">maxBytesReader</span>&nbsp;<span class="keyword" id="3862686">struct</span>&nbsp;<span class="op" id="3862693">{</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3862696">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3862704">ResponseWriter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3862720">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3862728">io</span><span class="op" id="3862730">.</span><span class="ident" id="3862731">ReadCloser</span>&nbsp;<span class="comment" id="3862742">//&nbsp;underlying&nbsp;reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3862764">n</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3862772">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3862786">//&nbsp;max&nbsp;bytes&nbsp;remaining</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3862810">stopped</span>&nbsp;<span class="builtintype" id="3862818">bool</span><br>
<span class="lineno"></span><span class="op" id="3862823">}</span><br>
<span class="lineno">690</span><br>
<span class="lineno"></span><span class="keyword" id="3862826">func</span>&nbsp;<span class="op" id="3862831">(</span><span class="ident" id="3862832">l</span>&nbsp;<span class="op" id="3862834">*</span><span class="ident" id="3862835">maxBytesReader</span><span class="op" id="3862849">)</span>&nbsp;<span class="ident" id="3862851">Read</span><span class="op" id="3862855">(</span><span class="ident" id="3862856">p</span>&nbsp;<span class="op" id="3862858">[</span><span class="op" id="3862859">]</span><span class="builtintype" id="3862860">byte</span><span class="op" id="3862864">)</span>&nbsp;<span class="op" id="3862866">(</span><span class="ident" id="3862867">n</span>&nbsp;<span class="builtintype" id="3862869">int</span><span class="op" id="3862872">,</span>&nbsp;<span class="ident" id="3862874">err</span>&nbsp;<span class="builtintype" id="3862878">error</span><span class="op" id="3862883">)</span>&nbsp;<span class="op" id="3862885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3862888">if</span>&nbsp;<span class="ident" id="3862891">l</span><span class="op" id="3862892">.</span><span class="ident" id="3862893">n</span>&nbsp;<span class="op" id="3862895">&lt;=</span>&nbsp;<span class="num" id="3862898">0</span>&nbsp;<span class="op" id="3862900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3862904">if</span>&nbsp;<span class="op" id="3862907">!</span><span class="ident" id="3862908">l</span><span class="op" id="3862909">.</span><span class="ident" id="3862910">stopped</span>&nbsp;<span class="op" id="3862918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3862923">l</span><span class="op" id="3862924">.</span><span class="ident" id="3862925">stopped</span>&nbsp;<span class="op" id="3862933">=</span>&nbsp;<span class="builtintype" id="3862935">true</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3862943">if</span>&nbsp;<span class="ident" id="3862946">res</span><span class="op" id="3862949">,</span>&nbsp;<span class="ident" id="3862951">ok</span>&nbsp;<span class="op" id="3862954">:=</span>&nbsp;<span class="ident" id="3862957">l</span><span class="op" id="3862958">.</span><span class="ident" id="3862959">w</span><span class="op" id="3862960">.</span><span class="op" id="3862961">(</span><span class="op" id="3862962">*</span><span class="ident" id="3862963">response</span><span class="op" id="3862971">)</span><span class="op" id="3862972">;</span>&nbsp;<span class="ident" id="3862974">ok</span>&nbsp;<span class="op" id="3862977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3862983">res</span><span class="op" id="3862986">.</span><span class="ident" id="3862987">requestTooLarge</span><span class="op" id="3863002">(</span><span class="op" id="3863003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3863008">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3863012">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3863016">return</span>&nbsp;<span class="num" id="3863023">0</span><span class="op" id="3863024">,</span>&nbsp;<span class="ident" id="3863026">errors</span><span class="op" id="3863032">.</span><span class="ident" id="3863033">New</span><span class="op" id="3863036">(</span><span class="string" id="3863037">&#34;http:&nbsp;request&nbsp;body&nbsp;too&nbsp;large&#34;</span><span class="op" id="3863067">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3863070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3863073">if</span>&nbsp;<span class="ident" id="3863076">int64</span><span class="op" id="3863081">(</span><span class="builtinfunc" id="3863082">len</span><span class="op" id="3863085">(</span><span class="ident" id="3863086">p</span><span class="op" id="3863087">)</span><span class="op" id="3863088">)</span>&nbsp;<span class="op" id="3863090">&gt;</span>&nbsp;<span class="ident" id="3863092">l</span><span class="op" id="3863093">.</span><span class="ident" id="3863094">n</span>&nbsp;<span class="op" id="3863096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3863100">p</span>&nbsp;<span class="op" id="3863102">=</span>&nbsp;<span class="ident" id="3863104">p</span><span class="op" id="3863105">[</span><span class="op" id="3863106">:</span><span class="ident" id="3863107">l</span><span class="op" id="3863108">.</span><span class="ident" id="3863109">n</span><span class="op" id="3863110">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3863113">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3863116">n</span><span class="op" id="3863117">,</span>&nbsp;<span class="ident" id="3863119">err</span>&nbsp;<span class="op" id="3863123">=</span>&nbsp;<span class="ident" id="3863125">l</span><span class="op" id="3863126">.</span><span class="ident" id="3863127">r</span><span class="op" id="3863128">.</span><span class="ident" id="3863129">Read</span><span class="op" id="3863133">(</span><span class="ident" id="3863134">p</span><span class="op" id="3863135">)</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3863138">l</span><span class="op" id="3863139">.</span><span class="ident" id="3863140">n</span>&nbsp;<span class="op" id="3863142">-=</span>&nbsp;<span class="ident" id="3863145">int64</span><span class="op" id="3863150">(</span><span class="ident" id="3863151">n</span><span class="op" id="3863152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3863155">return</span><br>
<span class="lineno"></span><span class="op" id="3863162">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3863165">func</span>&nbsp;<span class="op" id="3863170">(</span><span class="ident" id="3863171">l</span>&nbsp;<span class="op" id="3863173">*</span><span class="ident" id="3863174">maxBytesReader</span><span class="op" id="3863188">)</span>&nbsp;<span class="ident" id="3863190">Close</span><span class="op" id="3863195">(</span><span class="op" id="3863196">)</span>&nbsp;<span class="builtintype" id="3863198">error</span>&nbsp;<span class="op" id="3863204">{</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3863207">return</span>&nbsp;<span class="ident" id="3863214">l</span><span class="op" id="3863215">.</span><span class="ident" id="3863216">r</span><span class="op" id="3863217">.</span><span class="ident" id="3863218">Close</span><span class="op" id="3863223">(</span><span class="op" id="3863224">)</span><br>
<span class="lineno"></span><span class="op" id="3863226">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3863229">func</span>&nbsp;<span class="ident" id="3863234">copyValues</span><span class="op" id="3863244">(</span><span class="ident" id="3863245">dst</span><span class="op" id="3863248">,</span>&nbsp;<span class="ident" id="3863250">src</span>&nbsp;<span class="ident" id="3863254">url</span><span class="op" id="3863257">.</span><span class="ident" id="3863258">Values</span><span class="op" id="3863264">)</span>&nbsp;<span class="op" id="3863266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3863269">for</span>&nbsp;<span class="ident" id="3863273">k</span><span class="op" id="3863274">,</span>&nbsp;<span class="ident" id="3863276">vs</span>&nbsp;<span class="op" id="3863279">:=</span>&nbsp;<span class="keyword" id="3863282">range</span>&nbsp;<span class="ident" id="3863288">src</span>&nbsp;<span class="op" id="3863292">{</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3863296">for</span>&nbsp;<span class="ident" id="3863300">_</span><span class="op" id="3863301">,</span>&nbsp;<span class="ident" id="3863303">value</span>&nbsp;<span class="op" id="3863309">:=</span>&nbsp;<span class="keyword" id="3863312">range</span>&nbsp;<span class="ident" id="3863318">vs</span>&nbsp;<span class="op" id="3863321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3863326">dst</span><span class="op" id="3863329">.</span><span class="ident" id="3863330">Add</span><span class="op" id="3863333">(</span><span class="ident" id="3863334">k</span><span class="op" id="3863335">,</span>&nbsp;<span class="ident" id="3863337">value</span><span class="op" id="3863342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3863346">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3863349">}</span><br>
<span class="lineno"></span><span class="op" id="3863351">}</span><br>
<span class="lineno">720</span><br>
<span class="lineno"></span><span class="keyword" id="3863354">func</span>&nbsp;<span class="ident" id="3863359">parsePostForm</span><span class="op" id="3863372">(</span><span class="ident" id="3863373">r</span>&nbsp;<span class="op" id="3863375">*</span><span class="ident" id="3863376">Request</span><span class="op" id="3863383">)</span>&nbsp;<span class="op" id="3863385">(</span><span class="ident" id="3863386">vs</span>&nbsp;<span class="ident" id="3863389">url</span><span class="op" id="3863392">.</span><span class="ident" id="3863393">Values</span><span class="op" id="3863399">,</span>&nbsp;<span class="ident" id="3863401">err</span>&nbsp;<span class="builtintype" id="3863405">error</span><span class="op" id="3863410">)</span>&nbsp;<span class="op" id="3863412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3863415">if</span>&nbsp;<span class="ident" id="3863418">r</span><span class="op" id="3863419">.</span><span class="ident" id="3863420">Body</span>&nbsp;<span class="op" id="3863425">==</span>&nbsp;<span class="ident" id="3863428">nil</span>&nbsp;<span class="op" id="3863432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3863436">err</span>&nbsp;<span class="op" id="3863440">=</span>&nbsp;<span class="ident" id="3863442">errors</span><span class="op" id="3863448">.</span><span class="ident" id="3863449">New</span><span class="op" id="3863452">(</span><span class="string" id="3863453">&#34;missing&nbsp;form&nbsp;body&#34;</span><span class="op" id="3863472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3863476">return</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3863484">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3863487">ct</span>&nbsp;<span class="op" id="3863490">:=</span>&nbsp;<span class="ident" id="3863493">r</span><span class="op" id="3863494">.</span><span class="ident" id="3863495">Header</span><span class="op" id="3863501">.</span><span class="ident" id="3863502">Get</span><span class="op" id="3863505">(</span><span class="string" id="3863506">&#34;Content-Type&#34;</span><span class="op" id="3863520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3863523">//&nbsp;RFC&nbsp;2616,&nbsp;section&nbsp;7.2.1&nbsp;-&nbsp;empty&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3863564">//&nbsp;&nbsp;&nbsp;SHOULD&nbsp;be&nbsp;treated&nbsp;as&nbsp;application/octet-stream</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3863616">if</span>&nbsp;<span class="ident" id="3863619">ct</span>&nbsp;<span class="op" id="3863622">==</span>&nbsp;<span class="string" id="3863625">&#34;&#34;</span>&nbsp;<span class="op" id="3863628">{</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3863632">ct</span>&nbsp;<span class="op" id="3863635">=</span>&nbsp;<span class="string" id="3863637">&#34;application/octet-stream&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3863665">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3863668">ct</span><span class="op" id="3863670">,</span>&nbsp;<span class="ident" id="3863672">_</span><span class="op" id="3863673">,</span>&nbsp;<span class="ident" id="3863675">err</span>&nbsp;<span class="op" id="3863679">=</span>&nbsp;<span class="ident" id="3863681">mime</span><span class="op" id="3863685">.</span><span class="ident" id="3863686">ParseMediaType</span><span class="op" id="3863700">(</span><span class="ident" id="3863701">ct</span><span class="op" id="3863703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3863706">switch</span>&nbsp;<span class="op" id="3863713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3863716">case</span>&nbsp;<span class="ident" id="3863721">ct</span>&nbsp;<span class="op" id="3863724">==</span>&nbsp;<span class="string" id="3863727">&#34;application/x-www-form-urlencoded&#34;</span><span class="op" id="3863762">:</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3863766">var</span>&nbsp;<span class="ident" id="3863770">reader</span>&nbsp;<span class="ident" id="3863777">io</span><span class="op" id="3863779">.</span><span class="ident" id="3863780">Reader</span>&nbsp;<span class="op" id="3863787">=</span>&nbsp;<span class="ident" id="3863789">r</span><span class="op" id="3863790">.</span><span class="ident" id="3863791">Body</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3863798">maxFormSize</span>&nbsp;<span class="op" id="3863810">:=</span>&nbsp;<span class="ident" id="3863813">int64</span><span class="op" id="3863818">(</span><span class="num" id="3863819">1</span><span class="op" id="3863820">&lt;&lt;</span><span class="num" id="3863822">63</span>&nbsp;<span class="op" id="3863825">-</span>&nbsp;<span class="num" id="3863827">1</span><span class="op" id="3863828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3863832">if</span>&nbsp;<span class="ident" id="3863835">_</span><span class="op" id="3863836">,</span>&nbsp;<span class="ident" id="3863838">ok</span>&nbsp;<span class="op" id="3863841">:=</span>&nbsp;<span class="ident" id="3863844">r</span><span class="op" id="3863845">.</span><span class="ident" id="3863846">Body</span><span class="op" id="3863850">.</span><span class="op" id="3863851">(</span><span class="op" id="3863852">*</span><span class="ident" id="3863853">maxBytesReader</span><span class="op" id="3863867">)</span><span class="op" id="3863868">;</span>&nbsp;<span class="op" id="3863870">!</span><span class="ident" id="3863871">ok</span>&nbsp;<span class="op" id="3863874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3863879">maxFormSize</span>&nbsp;<span class="op" id="3863891">=</span>&nbsp;<span class="ident" id="3863893">int64</span><span class="op" id="3863898">(</span><span class="num" id="3863899">10</span>&nbsp;<span class="op" id="3863902">&lt;&lt;</span>&nbsp;<span class="num" id="3863905">20</span><span class="op" id="3863907">)</span>&nbsp;<span class="comment" id="3863909">//&nbsp;10&nbsp;MB&nbsp;is&nbsp;a&nbsp;lot&nbsp;of&nbsp;text.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3863939">reader</span>&nbsp;<span class="op" id="3863946">=</span>&nbsp;<span class="ident" id="3863948">io</span><span class="op" id="3863950">.</span><span class="ident" id="3863951">LimitReader</span><span class="op" id="3863962">(</span><span class="ident" id="3863963">r</span><span class="op" id="3863964">.</span><span class="ident" id="3863965">Body</span><span class="op" id="3863969">,</span>&nbsp;<span class="ident" id="3863971">maxFormSize</span><span class="op" id="3863982">+</span><span class="num" id="3863983">1</span><span class="op" id="3863984">)</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3863988">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3863992">b</span><span class="op" id="3863993">,</span>&nbsp;<span class="ident" id="3863995">e</span>&nbsp;<span class="op" id="3863997">:=</span>&nbsp;<span class="ident" id="3864000">ioutil</span><span class="op" id="3864006">.</span><span class="ident" id="3864007">ReadAll</span><span class="op" id="3864014">(</span><span class="ident" id="3864015">reader</span><span class="op" id="3864021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3864025">if</span>&nbsp;<span class="ident" id="3864028">e</span>&nbsp;<span class="op" id="3864030">!=</span>&nbsp;<span class="ident" id="3864033">nil</span>&nbsp;<span class="op" id="3864037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3864042">if</span>&nbsp;<span class="ident" id="3864045">err</span>&nbsp;<span class="op" id="3864049">==</span>&nbsp;<span class="ident" id="3864052">nil</span>&nbsp;<span class="op" id="3864056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3864062">err</span>&nbsp;<span class="op" id="3864066">=</span>&nbsp;<span class="ident" id="3864068">e</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3864073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3864078">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3864086">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3864090">if</span>&nbsp;<span class="ident" id="3864093">int64</span><span class="op" id="3864098">(</span><span class="builtinfunc" id="3864099">len</span><span class="op" id="3864102">(</span><span class="ident" id="3864103">b</span><span class="op" id="3864104">)</span><span class="op" id="3864105">)</span>&nbsp;<span class="op" id="3864107">&gt;</span>&nbsp;<span class="ident" id="3864109">maxFormSize</span>&nbsp;<span class="op" id="3864121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3864126">err</span>&nbsp;<span class="op" id="3864130">=</span>&nbsp;<span class="ident" id="3864132">errors</span><span class="op" id="3864138">.</span><span class="ident" id="3864139">New</span><span class="op" id="3864142">(</span><span class="string" id="3864143">&#34;http:&nbsp;POST&nbsp;too&nbsp;large&#34;</span><span class="op" id="3864165">)</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3864170">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3864179">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3864183">vs</span><span class="op" id="3864185">,</span>&nbsp;<span class="ident" id="3864187">e</span>&nbsp;<span class="op" id="3864189">=</span>&nbsp;<span class="ident" id="3864191">url</span><span class="op" id="3864194">.</span><span class="ident" id="3864195">ParseQuery</span><span class="op" id="3864205">(</span><span class="builtintype" id="3864206">string</span><span class="op" id="3864212">(</span><span class="ident" id="3864213">b</span><span class="op" id="3864214">)</span><span class="op" id="3864215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3864219">if</span>&nbsp;<span class="ident" id="3864222">err</span>&nbsp;<span class="op" id="3864226">==</span>&nbsp;<span class="ident" id="3864229">nil</span>&nbsp;<span class="op" id="3864233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3864238">err</span>&nbsp;<span class="op" id="3864242">=</span>&nbsp;<span class="ident" id="3864244">e</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3864248">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3864251">case</span>&nbsp;<span class="ident" id="3864256">ct</span>&nbsp;<span class="op" id="3864259">==</span>&nbsp;<span class="string" id="3864262">&#34;multipart/form-data&#34;</span><span class="op" id="3864283">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3864287">//&nbsp;handled&nbsp;by&nbsp;ParseMultipartForm&nbsp;(which&nbsp;is&nbsp;calling&nbsp;us,&nbsp;or&nbsp;should&nbsp;be)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3864358">//&nbsp;TODO(bradfitz):&nbsp;there&nbsp;are&nbsp;too&nbsp;many&nbsp;possible</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3864407">//&nbsp;orders&nbsp;to&nbsp;call&nbsp;too&nbsp;many&nbsp;functions&nbsp;here.</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3864452">//&nbsp;Clean&nbsp;this&nbsp;up&nbsp;and&nbsp;write&nbsp;more&nbsp;tests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3864493">//&nbsp;request_test.go&nbsp;contains&nbsp;the&nbsp;start&nbsp;of&nbsp;this,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3864542">//&nbsp;in&nbsp;TestParseMultipartFormOrder&nbsp;and&nbsp;others.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3864589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3864592">return</span><br>
<span class="lineno">765</span><span class="op" id="3864599">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3864602">//&nbsp;ParseForm&nbsp;parses&nbsp;the&nbsp;raw&nbsp;query&nbsp;from&nbsp;the&nbsp;URL&nbsp;and&nbsp;updates&nbsp;r.Form.</span><br>
<span class="lineno"></span><span class="comment" id="3864669">//</span><br>
<span class="lineno"></span><span class="comment" id="3864672">//&nbsp;For&nbsp;POST&nbsp;or&nbsp;PUT&nbsp;requests,&nbsp;it&nbsp;also&nbsp;parses&nbsp;the&nbsp;request&nbsp;body&nbsp;as&nbsp;a&nbsp;form&nbsp;and</span><br>
<span class="lineno">770</span><span class="comment" id="3864747">//&nbsp;put&nbsp;the&nbsp;results&nbsp;into&nbsp;both&nbsp;r.PostForm&nbsp;and&nbsp;r.Form.</span><br>
<span class="lineno"></span><span class="comment" id="3864799">//&nbsp;POST&nbsp;and&nbsp;PUT&nbsp;body&nbsp;parameters&nbsp;take&nbsp;precedence&nbsp;over&nbsp;URL&nbsp;query&nbsp;string&nbsp;values</span><br>
<span class="lineno"></span><span class="comment" id="3864876">//&nbsp;in&nbsp;r.Form.</span><br>
<span class="lineno"></span><span class="comment" id="3864890">//</span><br>
<span class="lineno"></span><span class="comment" id="3864893">//&nbsp;If&nbsp;the&nbsp;request&nbsp;Body&#39;s&nbsp;size&nbsp;has&nbsp;not&nbsp;already&nbsp;been&nbsp;limited&nbsp;by&nbsp;MaxBytesReader,</span><br>
<span class="lineno">775</span><span class="comment" id="3864971">//&nbsp;the&nbsp;size&nbsp;is&nbsp;capped&nbsp;at&nbsp;10MB.</span><br>
<span class="lineno"></span><span class="comment" id="3865002">//</span><br>
<span class="lineno"></span><span class="comment" id="3865005">//&nbsp;ParseMultipartForm&nbsp;calls&nbsp;ParseForm&nbsp;automatically.</span><br>
<span class="lineno"></span><span class="comment" id="3865058">//&nbsp;It&nbsp;is&nbsp;idempotent.</span><br>
<span class="lineno"></span><span class="keyword" id="3865079">func</span>&nbsp;<span class="op" id="3865084">(</span><span class="ident" id="3865085">r</span>&nbsp;<span class="op" id="3865087">*</span><span class="ident" id="3865088">Request</span><span class="op" id="3865095">)</span>&nbsp;<span class="ident" id="3865097">ParseForm</span><span class="op" id="3865106">(</span><span class="op" id="3865107">)</span>&nbsp;<span class="builtintype" id="3865109">error</span>&nbsp;<span class="op" id="3865115">{</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3865118">var</span>&nbsp;<span class="ident" id="3865122">err</span>&nbsp;<span class="builtintype" id="3865126">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3865133">if</span>&nbsp;<span class="ident" id="3865136">r</span><span class="op" id="3865137">.</span><span class="ident" id="3865138">PostForm</span>&nbsp;<span class="op" id="3865147">==</span>&nbsp;<span class="ident" id="3865150">nil</span>&nbsp;<span class="op" id="3865154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3865158">if</span>&nbsp;<span class="ident" id="3865161">r</span><span class="op" id="3865162">.</span><span class="ident" id="3865163">Method</span>&nbsp;<span class="op" id="3865170">==</span>&nbsp;<span class="string" id="3865173">&#34;POST&#34;</span>&nbsp;<span class="op" id="3865180">||</span>&nbsp;<span class="ident" id="3865183">r</span><span class="op" id="3865184">.</span><span class="ident" id="3865185">Method</span>&nbsp;<span class="op" id="3865192">==</span>&nbsp;<span class="string" id="3865195">&#34;PUT&#34;</span>&nbsp;<span class="op" id="3865201">||</span>&nbsp;<span class="ident" id="3865204">r</span><span class="op" id="3865205">.</span><span class="ident" id="3865206">Method</span>&nbsp;<span class="op" id="3865213">==</span>&nbsp;<span class="string" id="3865216">&#34;PATCH&#34;</span>&nbsp;<span class="op" id="3865224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3865229">r</span><span class="op" id="3865230">.</span><span class="ident" id="3865231">PostForm</span><span class="op" id="3865239">,</span>&nbsp;<span class="ident" id="3865241">err</span>&nbsp;<span class="op" id="3865245">=</span>&nbsp;<span class="ident" id="3865247">parsePostForm</span><span class="op" id="3865260">(</span><span class="ident" id="3865261">r</span><span class="op" id="3865262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3865266">}</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3865270">if</span>&nbsp;<span class="ident" id="3865273">r</span><span class="op" id="3865274">.</span><span class="ident" id="3865275">PostForm</span>&nbsp;<span class="op" id="3865284">==</span>&nbsp;<span class="ident" id="3865287">nil</span>&nbsp;<span class="op" id="3865291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3865296">r</span><span class="op" id="3865297">.</span><span class="ident" id="3865298">PostForm</span>&nbsp;<span class="op" id="3865307">=</span>&nbsp;<span class="builtinfunc" id="3865309">make</span><span class="op" id="3865313">(</span><span class="ident" id="3865314">url</span><span class="op" id="3865317">.</span><span class="ident" id="3865318">Values</span><span class="op" id="3865324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3865328">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3865331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3865334">if</span>&nbsp;<span class="ident" id="3865337">r</span><span class="op" id="3865338">.</span><span class="ident" id="3865339">Form</span>&nbsp;<span class="op" id="3865344">==</span>&nbsp;<span class="ident" id="3865347">nil</span>&nbsp;<span class="op" id="3865351">{</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3865355">if</span>&nbsp;<span class="builtinfunc" id="3865358">len</span><span class="op" id="3865361">(</span><span class="ident" id="3865362">r</span><span class="op" id="3865363">.</span><span class="ident" id="3865364">PostForm</span><span class="op" id="3865372">)</span>&nbsp;<span class="op" id="3865374">&gt;</span>&nbsp;<span class="num" id="3865376">0</span>&nbsp;<span class="op" id="3865378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3865383">r</span><span class="op" id="3865384">.</span><span class="ident" id="3865385">Form</span>&nbsp;<span class="op" id="3865390">=</span>&nbsp;<span class="builtinfunc" id="3865392">make</span><span class="op" id="3865396">(</span><span class="ident" id="3865397">url</span><span class="op" id="3865400">.</span><span class="ident" id="3865401">Values</span><span class="op" id="3865407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3865412">copyValues</span><span class="op" id="3865422">(</span><span class="ident" id="3865423">r</span><span class="op" id="3865424">.</span><span class="ident" id="3865425">Form</span><span class="op" id="3865429">,</span>&nbsp;<span class="ident" id="3865431">r</span><span class="op" id="3865432">.</span><span class="ident" id="3865433">PostForm</span><span class="op" id="3865441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3865445">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3865449">var</span>&nbsp;<span class="ident" id="3865453">newValues</span>&nbsp;<span class="ident" id="3865463">url</span><span class="op" id="3865466">.</span><span class="ident" id="3865467">Values</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3865476">if</span>&nbsp;<span class="ident" id="3865479">r</span><span class="op" id="3865480">.</span><span class="ident" id="3865481">URL</span>&nbsp;<span class="op" id="3865485">!=</span>&nbsp;<span class="ident" id="3865488">nil</span>&nbsp;<span class="op" id="3865492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3865497">var</span>&nbsp;<span class="ident" id="3865501">e</span>&nbsp;<span class="builtintype" id="3865503">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3865512">newValues</span><span class="op" id="3865521">,</span>&nbsp;<span class="ident" id="3865523">e</span>&nbsp;<span class="op" id="3865525">=</span>&nbsp;<span class="ident" id="3865527">url</span><span class="op" id="3865530">.</span><span class="ident" id="3865531">ParseQuery</span><span class="op" id="3865541">(</span><span class="ident" id="3865542">r</span><span class="op" id="3865543">.</span><span class="ident" id="3865544">URL</span><span class="op" id="3865547">.</span><span class="ident" id="3865548">RawQuery</span><span class="op" id="3865556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3865561">if</span>&nbsp;<span class="ident" id="3865564">err</span>&nbsp;<span class="op" id="3865568">==</span>&nbsp;<span class="ident" id="3865571">nil</span>&nbsp;<span class="op" id="3865575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3865581">err</span>&nbsp;<span class="op" id="3865585">=</span>&nbsp;<span class="ident" id="3865587">e</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3865592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3865596">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3865600">if</span>&nbsp;<span class="ident" id="3865603">newValues</span>&nbsp;<span class="op" id="3865613">==</span>&nbsp;<span class="ident" id="3865616">nil</span>&nbsp;<span class="op" id="3865620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3865625">newValues</span>&nbsp;<span class="op" id="3865635">=</span>&nbsp;<span class="builtinfunc" id="3865637">make</span><span class="op" id="3865641">(</span><span class="ident" id="3865642">url</span><span class="op" id="3865645">.</span><span class="ident" id="3865646">Values</span><span class="op" id="3865652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3865656">}</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3865660">if</span>&nbsp;<span class="ident" id="3865663">r</span><span class="op" id="3865664">.</span><span class="ident" id="3865665">Form</span>&nbsp;<span class="op" id="3865670">==</span>&nbsp;<span class="ident" id="3865673">nil</span>&nbsp;<span class="op" id="3865677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3865682">r</span><span class="op" id="3865683">.</span><span class="ident" id="3865684">Form</span>&nbsp;<span class="op" id="3865689">=</span>&nbsp;<span class="ident" id="3865691">newValues</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3865703">}</span>&nbsp;<span class="keyword" id="3865705">else</span>&nbsp;<span class="op" id="3865710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3865715">copyValues</span><span class="op" id="3865725">(</span><span class="ident" id="3865726">r</span><span class="op" id="3865727">.</span><span class="ident" id="3865728">Form</span><span class="op" id="3865732">,</span>&nbsp;<span class="ident" id="3865734">newValues</span><span class="op" id="3865743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3865747">}</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3865750">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3865753">return</span>&nbsp;<span class="ident" id="3865760">err</span><br>
<span class="lineno"></span><span class="op" id="3865764">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3865767">//&nbsp;ParseMultipartForm&nbsp;parses&nbsp;a&nbsp;request&nbsp;body&nbsp;as&nbsp;multipart/form-data.</span><br>
<span class="lineno">815</span><span class="comment" id="3865835">//&nbsp;The&nbsp;whole&nbsp;request&nbsp;body&nbsp;is&nbsp;parsed&nbsp;and&nbsp;up&nbsp;to&nbsp;a&nbsp;total&nbsp;of&nbsp;maxMemory&nbsp;bytes&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3865911">//&nbsp;its&nbsp;file&nbsp;parts&nbsp;are&nbsp;stored&nbsp;in&nbsp;memory,&nbsp;with&nbsp;the&nbsp;remainder&nbsp;stored&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="3865980">//&nbsp;disk&nbsp;in&nbsp;temporary&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="3866008">//&nbsp;ParseMultipartForm&nbsp;calls&nbsp;ParseForm&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span><span class="comment" id="3866060">//&nbsp;After&nbsp;one&nbsp;call&nbsp;to&nbsp;ParseMultipartForm,&nbsp;subsequent&nbsp;calls&nbsp;have&nbsp;no&nbsp;effect.</span><br>
<span class="lineno">820</span><span class="keyword" id="3866134">func</span>&nbsp;<span class="op" id="3866139">(</span><span class="ident" id="3866140">r</span>&nbsp;<span class="op" id="3866142">*</span><span class="ident" id="3866143">Request</span><span class="op" id="3866150">)</span>&nbsp;<span class="ident" id="3866152">ParseMultipartForm</span><span class="op" id="3866170">(</span><span class="ident" id="3866171">maxMemory</span>&nbsp;<span class="ident" id="3866181">int64</span><span class="op" id="3866186">)</span>&nbsp;<span class="builtintype" id="3866188">error</span>&nbsp;<span class="op" id="3866194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3866197">if</span>&nbsp;<span class="ident" id="3866200">r</span><span class="op" id="3866201">.</span><span class="ident" id="3866202">MultipartForm</span>&nbsp;<span class="op" id="3866216">==</span>&nbsp;<span class="ident" id="3866219">multipartByReader</span>&nbsp;<span class="op" id="3866237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3866241">return</span>&nbsp;<span class="ident" id="3866248">errors</span><span class="op" id="3866254">.</span><span class="ident" id="3866255">New</span><span class="op" id="3866258">(</span><span class="string" id="3866259">&#34;http:&nbsp;multipart&nbsp;handled&nbsp;by&nbsp;MultipartReader&#34;</span><span class="op" id="3866303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3866306">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3866309">if</span>&nbsp;<span class="ident" id="3866312">r</span><span class="op" id="3866313">.</span><span class="ident" id="3866314">Form</span>&nbsp;<span class="op" id="3866319">==</span>&nbsp;<span class="ident" id="3866322">nil</span>&nbsp;<span class="op" id="3866326">{</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3866330">err</span>&nbsp;<span class="op" id="3866334">:=</span>&nbsp;<span class="ident" id="3866337">r</span><span class="op" id="3866338">.</span><span class="ident" id="3866339">ParseForm</span><span class="op" id="3866348">(</span><span class="op" id="3866349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3866353">if</span>&nbsp;<span class="ident" id="3866356">err</span>&nbsp;<span class="op" id="3866360">!=</span>&nbsp;<span class="ident" id="3866363">nil</span>&nbsp;<span class="op" id="3866367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3866372">return</span>&nbsp;<span class="ident" id="3866379">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3866385">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3866388">}</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3866391">if</span>&nbsp;<span class="ident" id="3866394">r</span><span class="op" id="3866395">.</span><span class="ident" id="3866396">MultipartForm</span>&nbsp;<span class="op" id="3866410">!=</span>&nbsp;<span class="ident" id="3866413">nil</span>&nbsp;<span class="op" id="3866417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3866421">return</span>&nbsp;<span class="ident" id="3866428">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3866433">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3866437">mr</span><span class="op" id="3866439">,</span>&nbsp;<span class="ident" id="3866441">err</span>&nbsp;<span class="op" id="3866445">:=</span>&nbsp;<span class="ident" id="3866448">r</span><span class="op" id="3866449">.</span><span class="ident" id="3866450">multipartReader</span><span class="op" id="3866465">(</span><span class="op" id="3866466">)</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3866469">if</span>&nbsp;<span class="ident" id="3866472">err</span>&nbsp;<span class="op" id="3866476">!=</span>&nbsp;<span class="ident" id="3866479">nil</span>&nbsp;<span class="op" id="3866483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3866487">return</span>&nbsp;<span class="ident" id="3866494">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3866499">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3866503">f</span><span class="op" id="3866504">,</span>&nbsp;<span class="ident" id="3866506">err</span>&nbsp;<span class="op" id="3866510">:=</span>&nbsp;<span class="ident" id="3866513">mr</span><span class="op" id="3866515">.</span><span class="ident" id="3866516">ReadForm</span><span class="op" id="3866524">(</span><span class="ident" id="3866525">maxMemory</span><span class="op" id="3866534">)</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3866537">if</span>&nbsp;<span class="ident" id="3866540">err</span>&nbsp;<span class="op" id="3866544">!=</span>&nbsp;<span class="ident" id="3866547">nil</span>&nbsp;<span class="op" id="3866551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3866555">return</span>&nbsp;<span class="ident" id="3866562">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3866567">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3866570">for</span>&nbsp;<span class="ident" id="3866574">k</span><span class="op" id="3866575">,</span>&nbsp;<span class="ident" id="3866577">v</span>&nbsp;<span class="op" id="3866579">:=</span>&nbsp;<span class="keyword" id="3866582">range</span>&nbsp;<span class="ident" id="3866588">f</span><span class="op" id="3866589">.</span><span class="ident" id="3866590">Value</span>&nbsp;<span class="op" id="3866596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3866600">r</span><span class="op" id="3866601">.</span><span class="ident" id="3866602">Form</span><span class="op" id="3866606">[</span><span class="ident" id="3866607">k</span><span class="op" id="3866608">]</span>&nbsp;<span class="op" id="3866610">=</span>&nbsp;<span class="builtinfunc" id="3866612">append</span><span class="op" id="3866618">(</span><span class="ident" id="3866619">r</span><span class="op" id="3866620">.</span><span class="ident" id="3866621">Form</span><span class="op" id="3866625">[</span><span class="ident" id="3866626">k</span><span class="op" id="3866627">]</span><span class="op" id="3866628">,</span>&nbsp;<span class="ident" id="3866630">v</span><span class="op" id="3866631">...</span><span class="op" id="3866634">)</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3866637">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3866640">r</span><span class="op" id="3866641">.</span><span class="ident" id="3866642">MultipartForm</span>&nbsp;<span class="op" id="3866656">=</span>&nbsp;<span class="ident" id="3866658">f</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3866662">return</span>&nbsp;<span class="ident" id="3866669">nil</span><br>
<span class="lineno"></span><span class="op" id="3866673">}</span><br>
<span class="lineno">850</span><br>
<span class="lineno"></span><span class="comment" id="3866676">//&nbsp;FormValue&nbsp;returns&nbsp;the&nbsp;first&nbsp;value&nbsp;for&nbsp;the&nbsp;named&nbsp;component&nbsp;of&nbsp;the&nbsp;query.</span><br>
<span class="lineno"></span><span class="comment" id="3866751">//&nbsp;POST&nbsp;and&nbsp;PUT&nbsp;body&nbsp;parameters&nbsp;take&nbsp;precedence&nbsp;over&nbsp;URL&nbsp;query&nbsp;string&nbsp;values.</span><br>
<span class="lineno"></span><span class="comment" id="3866829">//&nbsp;FormValue&nbsp;calls&nbsp;ParseMultipartForm&nbsp;and&nbsp;ParseForm&nbsp;if&nbsp;necessary&nbsp;and&nbsp;ignores</span><br>
<span class="lineno"></span><span class="comment" id="3866906">//&nbsp;any&nbsp;errors&nbsp;returned&nbsp;by&nbsp;these&nbsp;functions.</span><br>
<span class="lineno">855</span><span class="comment" id="3866949">//&nbsp;To&nbsp;access&nbsp;multiple&nbsp;values&nbsp;of&nbsp;the&nbsp;same&nbsp;key,&nbsp;call&nbsp;ParseForm&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3867014">//&nbsp;then&nbsp;inspect&nbsp;Request.Form&nbsp;directly.</span><br>
<span class="lineno"></span><span class="keyword" id="3867053">func</span>&nbsp;<span class="op" id="3867058">(</span><span class="ident" id="3867059">r</span>&nbsp;<span class="op" id="3867061">*</span><span class="ident" id="3867062">Request</span><span class="op" id="3867069">)</span>&nbsp;<span class="ident" id="3867071">FormValue</span><span class="op" id="3867080">(</span><span class="ident" id="3867081">key</span>&nbsp;<span class="builtintype" id="3867085">string</span><span class="op" id="3867091">)</span>&nbsp;<span class="builtintype" id="3867093">string</span>&nbsp;<span class="op" id="3867100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3867103">if</span>&nbsp;<span class="ident" id="3867106">r</span><span class="op" id="3867107">.</span><span class="ident" id="3867108">Form</span>&nbsp;<span class="op" id="3867113">==</span>&nbsp;<span class="ident" id="3867116">nil</span>&nbsp;<span class="op" id="3867120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3867124">r</span><span class="op" id="3867125">.</span><span class="ident" id="3867126">ParseMultipartForm</span><span class="op" id="3867144">(</span><span class="ident" id="3867145">defaultMaxMemory</span><span class="op" id="3867161">)</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3867164">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3867167">if</span>&nbsp;<span class="ident" id="3867170">vs</span>&nbsp;<span class="op" id="3867173">:=</span>&nbsp;<span class="ident" id="3867176">r</span><span class="op" id="3867177">.</span><span class="ident" id="3867178">Form</span><span class="op" id="3867182">[</span><span class="ident" id="3867183">key</span><span class="op" id="3867186">]</span><span class="op" id="3867187">;</span>&nbsp;<span class="builtinfunc" id="3867189">len</span><span class="op" id="3867192">(</span><span class="ident" id="3867193">vs</span><span class="op" id="3867195">)</span>&nbsp;<span class="op" id="3867197">&gt;</span>&nbsp;<span class="num" id="3867199">0</span>&nbsp;<span class="op" id="3867201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3867205">return</span>&nbsp;<span class="ident" id="3867212">vs</span><span class="op" id="3867214">[</span><span class="num" id="3867215">0</span><span class="op" id="3867216">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3867219">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3867222">return</span>&nbsp;<span class="string" id="3867229">&#34;&#34;</span><br>
<span class="lineno">865</span><span class="op" id="3867232">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3867235">//&nbsp;PostFormValue&nbsp;returns&nbsp;the&nbsp;first&nbsp;value&nbsp;for&nbsp;the&nbsp;named&nbsp;component&nbsp;of&nbsp;the&nbsp;POST</span><br>
<span class="lineno"></span><span class="comment" id="3867312">//&nbsp;or&nbsp;PUT&nbsp;request&nbsp;body.&nbsp;URL&nbsp;query&nbsp;parameters&nbsp;are&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="3867370">//&nbsp;PostFormValue&nbsp;calls&nbsp;ParseMultipartForm&nbsp;and&nbsp;ParseForm&nbsp;if&nbsp;necessary&nbsp;and&nbsp;ignores</span><br>
<span class="lineno">870</span><span class="comment" id="3867451">//&nbsp;any&nbsp;errors&nbsp;returned&nbsp;by&nbsp;these&nbsp;functions.</span><br>
<span class="lineno"></span><span class="keyword" id="3867494">func</span>&nbsp;<span class="op" id="3867499">(</span><span class="ident" id="3867500">r</span>&nbsp;<span class="op" id="3867502">*</span><span class="ident" id="3867503">Request</span><span class="op" id="3867510">)</span>&nbsp;<span class="ident" id="3867512">PostFormValue</span><span class="op" id="3867525">(</span><span class="ident" id="3867526">key</span>&nbsp;<span class="builtintype" id="3867530">string</span><span class="op" id="3867536">)</span>&nbsp;<span class="builtintype" id="3867538">string</span>&nbsp;<span class="op" id="3867545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3867548">if</span>&nbsp;<span class="ident" id="3867551">r</span><span class="op" id="3867552">.</span><span class="ident" id="3867553">PostForm</span>&nbsp;<span class="op" id="3867562">==</span>&nbsp;<span class="ident" id="3867565">nil</span>&nbsp;<span class="op" id="3867569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3867573">r</span><span class="op" id="3867574">.</span><span class="ident" id="3867575">ParseMultipartForm</span><span class="op" id="3867593">(</span><span class="ident" id="3867594">defaultMaxMemory</span><span class="op" id="3867610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3867613">}</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3867616">if</span>&nbsp;<span class="ident" id="3867619">vs</span>&nbsp;<span class="op" id="3867622">:=</span>&nbsp;<span class="ident" id="3867625">r</span><span class="op" id="3867626">.</span><span class="ident" id="3867627">PostForm</span><span class="op" id="3867635">[</span><span class="ident" id="3867636">key</span><span class="op" id="3867639">]</span><span class="op" id="3867640">;</span>&nbsp;<span class="builtinfunc" id="3867642">len</span><span class="op" id="3867645">(</span><span class="ident" id="3867646">vs</span><span class="op" id="3867648">)</span>&nbsp;<span class="op" id="3867650">&gt;</span>&nbsp;<span class="num" id="3867652">0</span>&nbsp;<span class="op" id="3867654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3867658">return</span>&nbsp;<span class="ident" id="3867665">vs</span><span class="op" id="3867667">[</span><span class="num" id="3867668">0</span><span class="op" id="3867669">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3867672">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3867675">return</span>&nbsp;<span class="string" id="3867682">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="3867685">}</span><br>
<span class="lineno">880</span><br>
<span class="lineno"></span><span class="comment" id="3867688">//&nbsp;FormFile&nbsp;returns&nbsp;the&nbsp;first&nbsp;file&nbsp;for&nbsp;the&nbsp;provided&nbsp;form&nbsp;key.</span><br>
<span class="lineno"></span><span class="comment" id="3867750">//&nbsp;FormFile&nbsp;calls&nbsp;ParseMultipartForm&nbsp;and&nbsp;ParseForm&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span><span class="keyword" id="3867815">func</span>&nbsp;<span class="op" id="3867820">(</span><span class="ident" id="3867821">r</span>&nbsp;<span class="op" id="3867823">*</span><span class="ident" id="3867824">Request</span><span class="op" id="3867831">)</span>&nbsp;<span class="ident" id="3867833">FormFile</span><span class="op" id="3867841">(</span><span class="ident" id="3867842">key</span>&nbsp;<span class="builtintype" id="3867846">string</span><span class="op" id="3867852">)</span>&nbsp;<span class="op" id="3867854">(</span><span class="ident" id="3867855">multipart</span><span class="op" id="3867864">.</span><span class="ident" id="3867865">File</span><span class="op" id="3867869">,</span>&nbsp;<span class="op" id="3867871">*</span><span class="ident" id="3867872">multipart</span><span class="op" id="3867881">.</span><span class="ident" id="3867882">FileHeader</span><span class="op" id="3867892">,</span>&nbsp;<span class="builtintype" id="3867894">error</span><span class="op" id="3867899">)</span>&nbsp;<span class="op" id="3867901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3867904">if</span>&nbsp;<span class="ident" id="3867907">r</span><span class="op" id="3867908">.</span><span class="ident" id="3867909">MultipartForm</span>&nbsp;<span class="op" id="3867923">==</span>&nbsp;<span class="ident" id="3867926">multipartByReader</span>&nbsp;<span class="op" id="3867944">{</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3867948">return</span>&nbsp;<span class="ident" id="3867955">nil</span><span class="op" id="3867958">,</span>&nbsp;<span class="ident" id="3867960">nil</span><span class="op" id="3867963">,</span>&nbsp;<span class="ident" id="3867965">errors</span><span class="op" id="3867971">.</span><span class="ident" id="3867972">New</span><span class="op" id="3867975">(</span><span class="string" id="3867976">&#34;http:&nbsp;multipart&nbsp;handled&nbsp;by&nbsp;MultipartReader&#34;</span><span class="op" id="3868020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3868023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3868026">if</span>&nbsp;<span class="ident" id="3868029">r</span><span class="op" id="3868030">.</span><span class="ident" id="3868031">MultipartForm</span>&nbsp;<span class="op" id="3868045">==</span>&nbsp;<span class="ident" id="3868048">nil</span>&nbsp;<span class="op" id="3868052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3868056">err</span>&nbsp;<span class="op" id="3868060">:=</span>&nbsp;<span class="ident" id="3868063">r</span><span class="op" id="3868064">.</span><span class="ident" id="3868065">ParseMultipartForm</span><span class="op" id="3868083">(</span><span class="ident" id="3868084">defaultMaxMemory</span><span class="op" id="3868100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3868104">if</span>&nbsp;<span class="ident" id="3868107">err</span>&nbsp;<span class="op" id="3868111">!=</span>&nbsp;<span class="ident" id="3868114">nil</span>&nbsp;<span class="op" id="3868118">{</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3868123">return</span>&nbsp;<span class="ident" id="3868130">nil</span><span class="op" id="3868133">,</span>&nbsp;<span class="ident" id="3868135">nil</span><span class="op" id="3868138">,</span>&nbsp;<span class="ident" id="3868140">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3868146">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3868149">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3868152">if</span>&nbsp;<span class="ident" id="3868155">r</span><span class="op" id="3868156">.</span><span class="ident" id="3868157">MultipartForm</span>&nbsp;<span class="op" id="3868171">!=</span>&nbsp;<span class="ident" id="3868174">nil</span>&nbsp;<span class="op" id="3868178">&amp;&amp;</span>&nbsp;<span class="ident" id="3868181">r</span><span class="op" id="3868182">.</span><span class="ident" id="3868183">MultipartForm</span><span class="op" id="3868196">.</span><span class="ident" id="3868197">File</span>&nbsp;<span class="op" id="3868202">!=</span>&nbsp;<span class="ident" id="3868205">nil</span>&nbsp;<span class="op" id="3868209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3868213">if</span>&nbsp;<span class="ident" id="3868216">fhs</span>&nbsp;<span class="op" id="3868220">:=</span>&nbsp;<span class="ident" id="3868223">r</span><span class="op" id="3868224">.</span><span class="ident" id="3868225">MultipartForm</span><span class="op" id="3868238">.</span><span class="ident" id="3868239">File</span><span class="op" id="3868243">[</span><span class="ident" id="3868244">key</span><span class="op" id="3868247">]</span><span class="op" id="3868248">;</span>&nbsp;<span class="builtinfunc" id="3868250">len</span><span class="op" id="3868253">(</span><span class="ident" id="3868254">fhs</span><span class="op" id="3868257">)</span>&nbsp;<span class="op" id="3868259">&gt;</span>&nbsp;<span class="num" id="3868261">0</span>&nbsp;<span class="op" id="3868263">{</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3868268">f</span><span class="op" id="3868269">,</span>&nbsp;<span class="ident" id="3868271">err</span>&nbsp;<span class="op" id="3868275">:=</span>&nbsp;<span class="ident" id="3868278">fhs</span><span class="op" id="3868281">[</span><span class="num" id="3868282">0</span><span class="op" id="3868283">]</span><span class="op" id="3868284">.</span><span class="ident" id="3868285">Open</span><span class="op" id="3868289">(</span><span class="op" id="3868290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3868295">return</span>&nbsp;<span class="ident" id="3868302">f</span><span class="op" id="3868303">,</span>&nbsp;<span class="ident" id="3868305">fhs</span><span class="op" id="3868308">[</span><span class="num" id="3868309">0</span><span class="op" id="3868310">]</span><span class="op" id="3868311">,</span>&nbsp;<span class="ident" id="3868313">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3868319">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3868322">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3868325">return</span>&nbsp;<span class="ident" id="3868332">nil</span><span class="op" id="3868335">,</span>&nbsp;<span class="ident" id="3868337">nil</span><span class="op" id="3868340">,</span>&nbsp;<span class="ident" id="3868342">ErrMissingFile</span><br>
<span class="lineno">900</span><span class="op" id="3868357">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3868360">func</span>&nbsp;<span class="op" id="3868365">(</span><span class="ident" id="3868366">r</span>&nbsp;<span class="op" id="3868368">*</span><span class="ident" id="3868369">Request</span><span class="op" id="3868376">)</span>&nbsp;<span class="ident" id="3868378">expectsContinue</span><span class="op" id="3868393">(</span><span class="op" id="3868394">)</span>&nbsp;<span class="builtintype" id="3868396">bool</span>&nbsp;<span class="op" id="3868401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3868404">return</span>&nbsp;<span class="ident" id="3868411">hasToken</span><span class="op" id="3868419">(</span><span class="ident" id="3868420">r</span><span class="op" id="3868421">.</span><span class="ident" id="3868422">Header</span><span class="op" id="3868428">.</span><span class="ident" id="3868429">get</span><span class="op" id="3868432">(</span><span class="string" id="3868433">&#34;Expect&#34;</span><span class="op" id="3868441">)</span><span class="op" id="3868442">,</span>&nbsp;<span class="string" id="3868444">&#34;100-continue&#34;</span><span class="op" id="3868458">)</span><br>
<span class="lineno"></span><span class="op" id="3868460">}</span><br>
<span class="lineno">905</span><br>
<span class="lineno"></span><span class="keyword" id="3868463">func</span>&nbsp;<span class="op" id="3868468">(</span><span class="ident" id="3868469">r</span>&nbsp;<span class="op" id="3868471">*</span><span class="ident" id="3868472">Request</span><span class="op" id="3868479">)</span>&nbsp;<span class="ident" id="3868481">wantsHttp10KeepAlive</span><span class="op" id="3868501">(</span><span class="op" id="3868502">)</span>&nbsp;<span class="builtintype" id="3868504">bool</span>&nbsp;<span class="op" id="3868509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3868512">if</span>&nbsp;<span class="ident" id="3868515">r</span><span class="op" id="3868516">.</span><span class="ident" id="3868517">ProtoMajor</span>&nbsp;<span class="op" id="3868528">!=</span>&nbsp;<span class="num" id="3868531">1</span>&nbsp;<span class="op" id="3868533">||</span>&nbsp;<span class="ident" id="3868536">r</span><span class="op" id="3868537">.</span><span class="ident" id="3868538">ProtoMinor</span>&nbsp;<span class="op" id="3868549">!=</span>&nbsp;<span class="num" id="3868552">0</span>&nbsp;<span class="op" id="3868554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3868558">return</span>&nbsp;<span class="builtintype" id="3868565">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3868572">}</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3868575">return</span>&nbsp;<span class="ident" id="3868582">hasToken</span><span class="op" id="3868590">(</span><span class="ident" id="3868591">r</span><span class="op" id="3868592">.</span><span class="ident" id="3868593">Header</span><span class="op" id="3868599">.</span><span class="ident" id="3868600">get</span><span class="op" id="3868603">(</span><span class="string" id="3868604">&#34;Connection&#34;</span><span class="op" id="3868616">)</span><span class="op" id="3868617">,</span>&nbsp;<span class="string" id="3868619">&#34;keep-alive&#34;</span><span class="op" id="3868631">)</span><br>
<span class="lineno"></span><span class="op" id="3868633">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3868636">func</span>&nbsp;<span class="op" id="3868641">(</span><span class="ident" id="3868642">r</span>&nbsp;<span class="op" id="3868644">*</span><span class="ident" id="3868645">Request</span><span class="op" id="3868652">)</span>&nbsp;<span class="ident" id="3868654">wantsClose</span><span class="op" id="3868664">(</span><span class="op" id="3868665">)</span>&nbsp;<span class="builtintype" id="3868667">bool</span>&nbsp;<span class="op" id="3868672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3868675">return</span>&nbsp;<span class="ident" id="3868682">hasToken</span><span class="op" id="3868690">(</span><span class="ident" id="3868691">r</span><span class="op" id="3868692">.</span><span class="ident" id="3868693">Header</span><span class="op" id="3868699">.</span><span class="ident" id="3868700">get</span><span class="op" id="3868703">(</span><span class="string" id="3868704">&#34;Connection&#34;</span><span class="op" id="3868716">)</span><span class="op" id="3868717">,</span>&nbsp;<span class="string" id="3868719">&#34;close&#34;</span><span class="op" id="3868726">)</span><br>
<span class="lineno">915</span><span class="op" id="3868728">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3868731">func</span>&nbsp;<span class="op" id="3868736">(</span><span class="ident" id="3868737">r</span>&nbsp;<span class="op" id="3868739">*</span><span class="ident" id="3868740">Request</span><span class="op" id="3868747">)</span>&nbsp;<span class="ident" id="3868749">closeBody</span><span class="op" id="3868758">(</span><span class="op" id="3868759">)</span>&nbsp;<span class="op" id="3868761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3868764">if</span>&nbsp;<span class="ident" id="3868767">r</span><span class="op" id="3868768">.</span><span class="ident" id="3868769">Body</span>&nbsp;<span class="op" id="3868774">!=</span>&nbsp;<span class="ident" id="3868777">nil</span>&nbsp;<span class="op" id="3868781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3868785">r</span><span class="op" id="3868786">.</span><span class="ident" id="3868787">Body</span><span class="op" id="3868791">.</span><span class="ident" id="3868792">Close</span><span class="op" id="3868797">(</span><span class="op" id="3868798">)</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3868801">}</span><br>
<span class="lineno"></span><span class="op" id="3868803">}</span>
</div>
</body>
</html>
