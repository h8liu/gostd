<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>strings</h2>
<ul>
<li><a href="/gostd/strings/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/strings/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/strings/reader.go.html">reader.go</a></li>
<li><a href="/gostd/strings/reader_test.go.html" class="current">reader_test.go</a></li>
<li><a href="/gostd/strings/replace.go.html">replace.go</a></li>
<li><a href="/gostd/strings/replace_test.go.html">replace_test.go</a></li>
<li><a href="/gostd/strings/search.go.html">search.go</a></li>
<li><a href="/gostd/strings/search_test.go.html">search_test.go</a></li>
<li><a href="/gostd/strings/strings.go.html">strings.go</a></li>
<li><a href="/gostd/strings/strings_decl.go.html">strings_decl.go</a></li>
<li><a href="/gostd/strings/strings_test.go.html">strings_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1072914">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1072969">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1073023">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1073074">package</span>&nbsp;<span class="ident" id="1073082">strings_test</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1073096">import</span>&nbsp;<span class="op" id="1073103">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1073106">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1073115">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1073122">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1073128">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1073134">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1073145">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1073153">&#34;testing&#34;</span><br>
<span class="lineno">15</span><span class="op" id="1073163">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1073166">func</span>&nbsp;<span class="ident" id="1073171">TestReader</span><span class="op" id="1073181">(</span><span class="ident" id="1073182">t</span>&nbsp;<span class="op" id="1073184">*</span><span class="ident" id="1073185">testing</span><span class="op" id="1073192">.</span><span class="ident" id="1073193">T</span><span class="op" id="1073194">)</span>&nbsp;<span class="op" id="1073196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1073199">r</span>&nbsp;<span class="op" id="1073201">:=</span>&nbsp;<span class="ident" id="1073204">strings</span><span class="op" id="1073211">.</span><span class="ident" id="1073212">NewReader</span><span class="op" id="1073221">(</span><span class="string" id="1073222">&#34;0123456789&#34;</span><span class="op" id="1073234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1073237">tests</span>&nbsp;<span class="op" id="1073243">:=</span>&nbsp;<span class="op" id="1073246">[</span><span class="op" id="1073247">]</span><span class="keyword" id="1073248">struct</span>&nbsp;<span class="op" id="1073255">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1073259">off</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1073267">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1073275">seek</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1073283">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1073289">n</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1073297">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1073303">want</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1073311">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1073320">wantpos</span>&nbsp;<span class="ident" id="1073328">int64</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1073336">seekerr</span>&nbsp;<span class="builtintype" id="1073344">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1073352">}</span><span class="op" id="1073353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1073357">{</span><span class="ident" id="1073358">seek</span><span class="op" id="1073362">:</span>&nbsp;<span class="ident" id="1073364">os</span><span class="op" id="1073366">.</span><span class="ident" id="1073367">SEEK_SET</span><span class="op" id="1073375">,</span>&nbsp;<span class="ident" id="1073377">off</span><span class="op" id="1073380">:</span>&nbsp;<span class="num" id="1073382">0</span><span class="op" id="1073383">,</span>&nbsp;<span class="ident" id="1073385">n</span><span class="op" id="1073386">:</span>&nbsp;<span class="num" id="1073388">20</span><span class="op" id="1073390">,</span>&nbsp;<span class="ident" id="1073392">want</span><span class="op" id="1073396">:</span>&nbsp;<span class="string" id="1073398">&#34;0123456789&#34;</span><span class="op" id="1073410">}</span><span class="op" id="1073411">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1073415">{</span><span class="ident" id="1073416">seek</span><span class="op" id="1073420">:</span>&nbsp;<span class="ident" id="1073422">os</span><span class="op" id="1073424">.</span><span class="ident" id="1073425">SEEK_SET</span><span class="op" id="1073433">,</span>&nbsp;<span class="ident" id="1073435">off</span><span class="op" id="1073438">:</span>&nbsp;<span class="num" id="1073440">1</span><span class="op" id="1073441">,</span>&nbsp;<span class="ident" id="1073443">n</span><span class="op" id="1073444">:</span>&nbsp;<span class="num" id="1073446">1</span><span class="op" id="1073447">,</span>&nbsp;<span class="ident" id="1073449">want</span><span class="op" id="1073453">:</span>&nbsp;<span class="string" id="1073455">&#34;1&#34;</span><span class="op" id="1073458">}</span><span class="op" id="1073459">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1073463">{</span><span class="ident" id="1073464">seek</span><span class="op" id="1073468">:</span>&nbsp;<span class="ident" id="1073470">os</span><span class="op" id="1073472">.</span><span class="ident" id="1073473">SEEK_CUR</span><span class="op" id="1073481">,</span>&nbsp;<span class="ident" id="1073483">off</span><span class="op" id="1073486">:</span>&nbsp;<span class="num" id="1073488">1</span><span class="op" id="1073489">,</span>&nbsp;<span class="ident" id="1073491">wantpos</span><span class="op" id="1073498">:</span>&nbsp;<span class="num" id="1073500">3</span><span class="op" id="1073501">,</span>&nbsp;<span class="ident" id="1073503">n</span><span class="op" id="1073504">:</span>&nbsp;<span class="num" id="1073506">2</span><span class="op" id="1073507">,</span>&nbsp;<span class="ident" id="1073509">want</span><span class="op" id="1073513">:</span>&nbsp;<span class="string" id="1073515">&#34;34&#34;</span><span class="op" id="1073519">}</span><span class="op" id="1073520">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1073524">{</span><span class="ident" id="1073525">seek</span><span class="op" id="1073529">:</span>&nbsp;<span class="ident" id="1073531">os</span><span class="op" id="1073533">.</span><span class="ident" id="1073534">SEEK_SET</span><span class="op" id="1073542">,</span>&nbsp;<span class="ident" id="1073544">off</span><span class="op" id="1073547">:</span>&nbsp;<span class="op" id="1073549">-</span><span class="num" id="1073550">1</span><span class="op" id="1073551">,</span>&nbsp;<span class="ident" id="1073553">seekerr</span><span class="op" id="1073560">:</span>&nbsp;<span class="string" id="1073562">&#34;strings.Reader.Seek:&nbsp;negative&nbsp;position&#34;</span><span class="op" id="1073602">}</span><span class="op" id="1073603">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1073607">{</span><span class="ident" id="1073608">seek</span><span class="op" id="1073612">:</span>&nbsp;<span class="ident" id="1073614">os</span><span class="op" id="1073616">.</span><span class="ident" id="1073617">SEEK_SET</span><span class="op" id="1073625">,</span>&nbsp;<span class="ident" id="1073627">off</span><span class="op" id="1073630">:</span>&nbsp;<span class="num" id="1073632">1</span>&nbsp;<span class="op" id="1073634">&lt;&lt;</span>&nbsp;<span class="num" id="1073637">33</span><span class="op" id="1073639">,</span>&nbsp;<span class="ident" id="1073641">wantpos</span><span class="op" id="1073648">:</span>&nbsp;<span class="num" id="1073650">1</span>&nbsp;<span class="op" id="1073652">&lt;&lt;</span>&nbsp;<span class="num" id="1073655">33</span><span class="op" id="1073657">}</span><span class="op" id="1073658">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1073662">{</span><span class="ident" id="1073663">seek</span><span class="op" id="1073667">:</span>&nbsp;<span class="ident" id="1073669">os</span><span class="op" id="1073671">.</span><span class="ident" id="1073672">SEEK_CUR</span><span class="op" id="1073680">,</span>&nbsp;<span class="ident" id="1073682">off</span><span class="op" id="1073685">:</span>&nbsp;<span class="num" id="1073687">1</span><span class="op" id="1073688">,</span>&nbsp;<span class="ident" id="1073690">wantpos</span><span class="op" id="1073697">:</span>&nbsp;<span class="num" id="1073699">1</span><span class="op" id="1073700">&lt;&lt;</span><span class="num" id="1073702">33</span>&nbsp;<span class="op" id="1073705">+</span>&nbsp;<span class="num" id="1073707">1</span><span class="op" id="1073708">}</span><span class="op" id="1073709">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1073713">{</span><span class="ident" id="1073714">seek</span><span class="op" id="1073718">:</span>&nbsp;<span class="ident" id="1073720">os</span><span class="op" id="1073722">.</span><span class="ident" id="1073723">SEEK_SET</span><span class="op" id="1073731">,</span>&nbsp;<span class="ident" id="1073733">n</span><span class="op" id="1073734">:</span>&nbsp;<span class="num" id="1073736">5</span><span class="op" id="1073737">,</span>&nbsp;<span class="ident" id="1073739">want</span><span class="op" id="1073743">:</span>&nbsp;<span class="string" id="1073745">&#34;01234&#34;</span><span class="op" id="1073752">}</span><span class="op" id="1073753">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1073757">{</span><span class="ident" id="1073758">seek</span><span class="op" id="1073762">:</span>&nbsp;<span class="ident" id="1073764">os</span><span class="op" id="1073766">.</span><span class="ident" id="1073767">SEEK_CUR</span><span class="op" id="1073775">,</span>&nbsp;<span class="ident" id="1073777">n</span><span class="op" id="1073778">:</span>&nbsp;<span class="num" id="1073780">5</span><span class="op" id="1073781">,</span>&nbsp;<span class="ident" id="1073783">want</span><span class="op" id="1073787">:</span>&nbsp;<span class="string" id="1073789">&#34;56789&#34;</span><span class="op" id="1073796">}</span><span class="op" id="1073797">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1073801">{</span><span class="ident" id="1073802">seek</span><span class="op" id="1073806">:</span>&nbsp;<span class="ident" id="1073808">os</span><span class="op" id="1073810">.</span><span class="ident" id="1073811">SEEK_END</span><span class="op" id="1073819">,</span>&nbsp;<span class="ident" id="1073821">off</span><span class="op" id="1073824">:</span>&nbsp;<span class="op" id="1073826">-</span><span class="num" id="1073827">1</span><span class="op" id="1073828">,</span>&nbsp;<span class="ident" id="1073830">n</span><span class="op" id="1073831">:</span>&nbsp;<span class="num" id="1073833">1</span><span class="op" id="1073834">,</span>&nbsp;<span class="ident" id="1073836">wantpos</span><span class="op" id="1073843">:</span>&nbsp;<span class="num" id="1073845">9</span><span class="op" id="1073846">,</span>&nbsp;<span class="ident" id="1073848">want</span><span class="op" id="1073852">:</span>&nbsp;<span class="string" id="1073854">&#34;9&#34;</span><span class="op" id="1073857">}</span><span class="op" id="1073858">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1073861">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1073865">for</span>&nbsp;<span class="ident" id="1073869">i</span><span class="op" id="1073870">,</span>&nbsp;<span class="ident" id="1073872">tt</span>&nbsp;<span class="op" id="1073875">:=</span>&nbsp;<span class="keyword" id="1073878">range</span>&nbsp;<span class="ident" id="1073884">tests</span>&nbsp;<span class="op" id="1073890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1073894">pos</span><span class="op" id="1073897">,</span>&nbsp;<span class="ident" id="1073899">err</span>&nbsp;<span class="op" id="1073903">:=</span>&nbsp;<span class="ident" id="1073906">r</span><span class="op" id="1073907">.</span><span class="ident" id="1073908">Seek</span><span class="op" id="1073912">(</span><span class="ident" id="1073913">tt</span><span class="op" id="1073915">.</span><span class="ident" id="1073916">off</span><span class="op" id="1073919">,</span>&nbsp;<span class="ident" id="1073921">tt</span><span class="op" id="1073923">.</span><span class="ident" id="1073924">seek</span><span class="op" id="1073928">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1073932">if</span>&nbsp;<span class="ident" id="1073935">err</span>&nbsp;<span class="op" id="1073939">==</span>&nbsp;<span class="builtintype" id="1073942">nil</span>&nbsp;<span class="op" id="1073946">&amp;&amp;</span>&nbsp;<span class="ident" id="1073949">tt</span><span class="op" id="1073951">.</span><span class="ident" id="1073952">seekerr</span>&nbsp;<span class="op" id="1073960">!=</span>&nbsp;<span class="string" id="1073963">&#34;&#34;</span>&nbsp;<span class="op" id="1073966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1073971">t</span><span class="op" id="1073972">.</span><span class="ident" id="1073973">Errorf</span><span class="op" id="1073979">(</span><span class="string" id="1073980">&#34;%d.&nbsp;want&nbsp;seek&nbsp;error&nbsp;%q&#34;</span><span class="op" id="1074004">,</span>&nbsp;<span class="ident" id="1074006">i</span><span class="op" id="1074007">,</span>&nbsp;<span class="ident" id="1074009">tt</span><span class="op" id="1074011">.</span><span class="ident" id="1074012">seekerr</span><span class="op" id="1074019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1074024">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1074035">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1074039">if</span>&nbsp;<span class="ident" id="1074042">err</span>&nbsp;<span class="op" id="1074046">!=</span>&nbsp;<span class="builtintype" id="1074049">nil</span>&nbsp;<span class="op" id="1074053">&amp;&amp;</span>&nbsp;<span class="ident" id="1074056">err</span><span class="op" id="1074059">.</span><span class="ident" id="1074060">Error</span><span class="op" id="1074065">(</span><span class="op" id="1074066">)</span>&nbsp;<span class="op" id="1074068">!=</span>&nbsp;<span class="ident" id="1074071">tt</span><span class="op" id="1074073">.</span><span class="ident" id="1074074">seekerr</span>&nbsp;<span class="op" id="1074082">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1074087">t</span><span class="op" id="1074088">.</span><span class="ident" id="1074089">Errorf</span><span class="op" id="1074095">(</span><span class="string" id="1074096">&#34;%d.&nbsp;seek&nbsp;error&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="1074126">,</span>&nbsp;<span class="ident" id="1074128">i</span><span class="op" id="1074129">,</span>&nbsp;<span class="ident" id="1074131">err</span><span class="op" id="1074134">.</span><span class="ident" id="1074135">Error</span><span class="op" id="1074140">(</span><span class="op" id="1074141">)</span><span class="op" id="1074142">,</span>&nbsp;<span class="ident" id="1074144">tt</span><span class="op" id="1074146">.</span><span class="ident" id="1074147">seekerr</span><span class="op" id="1074154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1074159">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1074170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1074174">if</span>&nbsp;<span class="ident" id="1074177">tt</span><span class="op" id="1074179">.</span><span class="ident" id="1074180">wantpos</span>&nbsp;<span class="op" id="1074188">!=</span>&nbsp;<span class="num" id="1074191">0</span>&nbsp;<span class="op" id="1074193">&amp;&amp;</span>&nbsp;<span class="ident" id="1074196">tt</span><span class="op" id="1074198">.</span><span class="ident" id="1074199">wantpos</span>&nbsp;<span class="op" id="1074207">!=</span>&nbsp;<span class="ident" id="1074210">pos</span>&nbsp;<span class="op" id="1074214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1074219">t</span><span class="op" id="1074220">.</span><span class="ident" id="1074221">Errorf</span><span class="op" id="1074227">(</span><span class="string" id="1074228">&#34;%d.&nbsp;pos&nbsp;=&nbsp;%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="1074251">,</span>&nbsp;<span class="ident" id="1074253">i</span><span class="op" id="1074254">,</span>&nbsp;<span class="ident" id="1074256">pos</span><span class="op" id="1074259">,</span>&nbsp;<span class="ident" id="1074261">tt</span><span class="op" id="1074263">.</span><span class="ident" id="1074264">wantpos</span><span class="op" id="1074271">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1074275">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1074279">buf</span>&nbsp;<span class="op" id="1074283">:=</span>&nbsp;<span class="builtinfunc" id="1074286">make</span><span class="op" id="1074290">(</span><span class="op" id="1074291">[</span><span class="op" id="1074292">]</span><span class="builtintype" id="1074293">byte</span><span class="op" id="1074297">,</span>&nbsp;<span class="ident" id="1074299">tt</span><span class="op" id="1074301">.</span><span class="ident" id="1074302">n</span><span class="op" id="1074303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1074307">n</span><span class="op" id="1074308">,</span>&nbsp;<span class="ident" id="1074310">err</span>&nbsp;<span class="op" id="1074314">:=</span>&nbsp;<span class="ident" id="1074317">r</span><span class="op" id="1074318">.</span><span class="ident" id="1074319">Read</span><span class="op" id="1074323">(</span><span class="ident" id="1074324">buf</span><span class="op" id="1074327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1074331">if</span>&nbsp;<span class="ident" id="1074334">err</span>&nbsp;<span class="op" id="1074338">!=</span>&nbsp;<span class="builtintype" id="1074341">nil</span>&nbsp;<span class="op" id="1074345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1074350">t</span><span class="op" id="1074351">.</span><span class="ident" id="1074352">Errorf</span><span class="op" id="1074358">(</span><span class="string" id="1074359">&#34;%d.&nbsp;read&nbsp;=&nbsp;%v&#34;</span><span class="op" id="1074374">,</span>&nbsp;<span class="ident" id="1074376">i</span><span class="op" id="1074377">,</span>&nbsp;<span class="ident" id="1074379">err</span><span class="op" id="1074382">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1074387">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1074398">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1074402">got</span>&nbsp;<span class="op" id="1074406">:=</span>&nbsp;<span class="builtintype" id="1074409">string</span><span class="op" id="1074415">(</span><span class="ident" id="1074416">buf</span><span class="op" id="1074419">[</span><span class="op" id="1074420">:</span><span class="ident" id="1074421">n</span><span class="op" id="1074422">]</span><span class="op" id="1074423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1074427">if</span>&nbsp;<span class="ident" id="1074430">got</span>&nbsp;<span class="op" id="1074434">!=</span>&nbsp;<span class="ident" id="1074437">tt</span><span class="op" id="1074439">.</span><span class="ident" id="1074440">want</span>&nbsp;<span class="op" id="1074445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1074450">t</span><span class="op" id="1074451">.</span><span class="ident" id="1074452">Errorf</span><span class="op" id="1074458">(</span><span class="string" id="1074459">&#34;%d.&nbsp;got&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="1074480">,</span>&nbsp;<span class="ident" id="1074482">i</span><span class="op" id="1074483">,</span>&nbsp;<span class="ident" id="1074485">got</span><span class="op" id="1074488">,</span>&nbsp;<span class="ident" id="1074490">tt</span><span class="op" id="1074492">.</span><span class="ident" id="1074493">want</span><span class="op" id="1074497">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1074501">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1074504">}</span><br>
<span class="lineno"></span><span class="op" id="1074506">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1074509">func</span>&nbsp;<span class="ident" id="1074514">TestReadAfterBigSeek</span><span class="op" id="1074534">(</span><span class="ident" id="1074535">t</span>&nbsp;<span class="op" id="1074537">*</span><span class="ident" id="1074538">testing</span><span class="op" id="1074545">.</span><span class="ident" id="1074546">T</span><span class="op" id="1074547">)</span>&nbsp;<span class="op" id="1074549">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1074552">r</span>&nbsp;<span class="op" id="1074554">:=</span>&nbsp;<span class="ident" id="1074557">strings</span><span class="op" id="1074564">.</span><span class="ident" id="1074565">NewReader</span><span class="op" id="1074574">(</span><span class="string" id="1074575">&#34;0123456789&#34;</span><span class="op" id="1074587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1074590">if</span>&nbsp;<span class="ident" id="1074593">_</span><span class="op" id="1074594">,</span>&nbsp;<span class="ident" id="1074596">err</span>&nbsp;<span class="op" id="1074600">:=</span>&nbsp;<span class="ident" id="1074603">r</span><span class="op" id="1074604">.</span><span class="ident" id="1074605">Seek</span><span class="op" id="1074609">(</span><span class="num" id="1074610">1</span><span class="op" id="1074611">&lt;&lt;</span><span class="num" id="1074613">31</span><span class="op" id="1074615">+</span><span class="num" id="1074616">5</span><span class="op" id="1074617">,</span>&nbsp;<span class="ident" id="1074619">os</span><span class="op" id="1074621">.</span><span class="ident" id="1074622">SEEK_SET</span><span class="op" id="1074630">)</span><span class="op" id="1074631">;</span>&nbsp;<span class="ident" id="1074633">err</span>&nbsp;<span class="op" id="1074637">!=</span>&nbsp;<span class="builtintype" id="1074640">nil</span>&nbsp;<span class="op" id="1074644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1074648">t</span><span class="op" id="1074649">.</span><span class="ident" id="1074650">Fatal</span><span class="op" id="1074655">(</span><span class="ident" id="1074656">err</span><span class="op" id="1074659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1074662">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1074665">if</span>&nbsp;<span class="ident" id="1074668">n</span><span class="op" id="1074669">,</span>&nbsp;<span class="ident" id="1074671">err</span>&nbsp;<span class="op" id="1074675">:=</span>&nbsp;<span class="ident" id="1074678">r</span><span class="op" id="1074679">.</span><span class="ident" id="1074680">Read</span><span class="op" id="1074684">(</span><span class="builtinfunc" id="1074685">make</span><span class="op" id="1074689">(</span><span class="op" id="1074690">[</span><span class="op" id="1074691">]</span><span class="builtintype" id="1074692">byte</span><span class="op" id="1074696">,</span>&nbsp;<span class="num" id="1074698">10</span><span class="op" id="1074700">)</span><span class="op" id="1074701">)</span><span class="op" id="1074702">;</span>&nbsp;<span class="ident" id="1074704">n</span>&nbsp;<span class="op" id="1074706">!=</span>&nbsp;<span class="num" id="1074709">0</span>&nbsp;<span class="op" id="1074711">||</span>&nbsp;<span class="ident" id="1074714">err</span>&nbsp;<span class="op" id="1074718">!=</span>&nbsp;<span class="ident" id="1074721">io</span><span class="op" id="1074723">.</span><span class="ident" id="1074724">EOF</span>&nbsp;<span class="op" id="1074728">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1074732">t</span><span class="op" id="1074733">.</span><span class="ident" id="1074734">Errorf</span><span class="op" id="1074740">(</span><span class="string" id="1074741">&#34;Read&nbsp;=&nbsp;%d,&nbsp;%v;&nbsp;want&nbsp;0,&nbsp;EOF&#34;</span><span class="op" id="1074769">,</span>&nbsp;<span class="ident" id="1074771">n</span><span class="op" id="1074772">,</span>&nbsp;<span class="ident" id="1074774">err</span><span class="op" id="1074777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1074780">}</span><br>
<span class="lineno"></span><span class="op" id="1074782">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1074785">func</span>&nbsp;<span class="ident" id="1074790">TestReaderAt</span><span class="op" id="1074802">(</span><span class="ident" id="1074803">t</span>&nbsp;<span class="op" id="1074805">*</span><span class="ident" id="1074806">testing</span><span class="op" id="1074813">.</span><span class="ident" id="1074814">T</span><span class="op" id="1074815">)</span>&nbsp;<span class="op" id="1074817">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1074820">r</span>&nbsp;<span class="op" id="1074822">:=</span>&nbsp;<span class="ident" id="1074825">strings</span><span class="op" id="1074832">.</span><span class="ident" id="1074833">NewReader</span><span class="op" id="1074842">(</span><span class="string" id="1074843">&#34;0123456789&#34;</span><span class="op" id="1074855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1074858">tests</span>&nbsp;<span class="op" id="1074864">:=</span>&nbsp;<span class="op" id="1074867">[</span><span class="op" id="1074868">]</span><span class="keyword" id="1074869">struct</span>&nbsp;<span class="op" id="1074876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1074880">off</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1074888">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1074896">n</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1074904">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1074910">want</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1074918">string</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1074927">wanterr</span>&nbsp;<span class="keyword" id="1074935">interface</span><span class="op" id="1074944">{</span><span class="op" id="1074945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1074948">}</span><span class="op" id="1074949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1074953">{</span><span class="num" id="1074954">0</span><span class="op" id="1074955">,</span>&nbsp;<span class="num" id="1074957">10</span><span class="op" id="1074959">,</span>&nbsp;<span class="string" id="1074961">&#34;0123456789&#34;</span><span class="op" id="1074973">,</span>&nbsp;<span class="builtintype" id="1074975">nil</span><span class="op" id="1074978">}</span><span class="op" id="1074979">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1074983">{</span><span class="num" id="1074984">1</span><span class="op" id="1074985">,</span>&nbsp;<span class="num" id="1074987">10</span><span class="op" id="1074989">,</span>&nbsp;<span class="string" id="1074991">&#34;123456789&#34;</span><span class="op" id="1075002">,</span>&nbsp;<span class="ident" id="1075004">io</span><span class="op" id="1075006">.</span><span class="ident" id="1075007">EOF</span><span class="op" id="1075010">}</span><span class="op" id="1075011">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1075015">{</span><span class="num" id="1075016">1</span><span class="op" id="1075017">,</span>&nbsp;<span class="num" id="1075019">9</span><span class="op" id="1075020">,</span>&nbsp;<span class="string" id="1075022">&#34;123456789&#34;</span><span class="op" id="1075033">,</span>&nbsp;<span class="builtintype" id="1075035">nil</span><span class="op" id="1075038">}</span><span class="op" id="1075039">,</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1075043">{</span><span class="num" id="1075044">11</span><span class="op" id="1075046">,</span>&nbsp;<span class="num" id="1075048">10</span><span class="op" id="1075050">,</span>&nbsp;<span class="string" id="1075052">&#34;&#34;</span><span class="op" id="1075054">,</span>&nbsp;<span class="ident" id="1075056">io</span><span class="op" id="1075058">.</span><span class="ident" id="1075059">EOF</span><span class="op" id="1075062">}</span><span class="op" id="1075063">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1075067">{</span><span class="num" id="1075068">0</span><span class="op" id="1075069">,</span>&nbsp;<span class="num" id="1075071">0</span><span class="op" id="1075072">,</span>&nbsp;<span class="string" id="1075074">&#34;&#34;</span><span class="op" id="1075076">,</span>&nbsp;<span class="builtintype" id="1075078">nil</span><span class="op" id="1075081">}</span><span class="op" id="1075082">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1075086">{</span><span class="op" id="1075087">-</span><span class="num" id="1075088">1</span><span class="op" id="1075089">,</span>&nbsp;<span class="num" id="1075091">0</span><span class="op" id="1075092">,</span>&nbsp;<span class="string" id="1075094">&#34;&#34;</span><span class="op" id="1075096">,</span>&nbsp;<span class="string" id="1075098">&#34;strings.Reader.ReadAt:&nbsp;negative&nbsp;offset&#34;</span><span class="op" id="1075138">}</span><span class="op" id="1075139">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1075142">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1075145">for</span>&nbsp;<span class="ident" id="1075149">i</span><span class="op" id="1075150">,</span>&nbsp;<span class="ident" id="1075152">tt</span>&nbsp;<span class="op" id="1075155">:=</span>&nbsp;<span class="keyword" id="1075158">range</span>&nbsp;<span class="ident" id="1075164">tests</span>&nbsp;<span class="op" id="1075170">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1075174">b</span>&nbsp;<span class="op" id="1075176">:=</span>&nbsp;<span class="builtinfunc" id="1075179">make</span><span class="op" id="1075183">(</span><span class="op" id="1075184">[</span><span class="op" id="1075185">]</span><span class="builtintype" id="1075186">byte</span><span class="op" id="1075190">,</span>&nbsp;<span class="ident" id="1075192">tt</span><span class="op" id="1075194">.</span><span class="ident" id="1075195">n</span><span class="op" id="1075196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1075200">rn</span><span class="op" id="1075202">,</span>&nbsp;<span class="ident" id="1075204">err</span>&nbsp;<span class="op" id="1075208">:=</span>&nbsp;<span class="ident" id="1075211">r</span><span class="op" id="1075212">.</span><span class="ident" id="1075213">ReadAt</span><span class="op" id="1075219">(</span><span class="ident" id="1075220">b</span><span class="op" id="1075221">,</span>&nbsp;<span class="ident" id="1075223">tt</span><span class="op" id="1075225">.</span><span class="ident" id="1075226">off</span><span class="op" id="1075229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1075233">got</span>&nbsp;<span class="op" id="1075237">:=</span>&nbsp;<span class="builtintype" id="1075240">string</span><span class="op" id="1075246">(</span><span class="ident" id="1075247">b</span><span class="op" id="1075248">[</span><span class="op" id="1075249">:</span><span class="ident" id="1075250">rn</span><span class="op" id="1075252">]</span><span class="op" id="1075253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1075257">if</span>&nbsp;<span class="ident" id="1075260">got</span>&nbsp;<span class="op" id="1075264">!=</span>&nbsp;<span class="ident" id="1075267">tt</span><span class="op" id="1075269">.</span><span class="ident" id="1075270">want</span>&nbsp;<span class="op" id="1075275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1075280">t</span><span class="op" id="1075281">.</span><span class="ident" id="1075282">Errorf</span><span class="op" id="1075288">(</span><span class="string" id="1075289">&#34;%d.&nbsp;got&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="1075310">,</span>&nbsp;<span class="ident" id="1075312">i</span><span class="op" id="1075313">,</span>&nbsp;<span class="ident" id="1075315">got</span><span class="op" id="1075318">,</span>&nbsp;<span class="ident" id="1075320">tt</span><span class="op" id="1075322">.</span><span class="ident" id="1075323">want</span><span class="op" id="1075327">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1075331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1075335">if</span>&nbsp;<span class="ident" id="1075338">fmt</span><span class="op" id="1075341">.</span><span class="ident" id="1075342">Sprintf</span><span class="op" id="1075349">(</span><span class="string" id="1075350">&#34;%v&#34;</span><span class="op" id="1075354">,</span>&nbsp;<span class="ident" id="1075356">err</span><span class="op" id="1075359">)</span>&nbsp;<span class="op" id="1075361">!=</span>&nbsp;<span class="ident" id="1075364">fmt</span><span class="op" id="1075367">.</span><span class="ident" id="1075368">Sprintf</span><span class="op" id="1075375">(</span><span class="string" id="1075376">&#34;%v&#34;</span><span class="op" id="1075380">,</span>&nbsp;<span class="ident" id="1075382">tt</span><span class="op" id="1075384">.</span><span class="ident" id="1075385">wanterr</span><span class="op" id="1075392">)</span>&nbsp;<span class="op" id="1075394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1075399">t</span><span class="op" id="1075400">.</span><span class="ident" id="1075401">Errorf</span><span class="op" id="1075407">(</span><span class="string" id="1075408">&#34;%d.&nbsp;got&nbsp;error&nbsp;=&nbsp;%v;&nbsp;want&nbsp;%v&#34;</span><span class="op" id="1075437">,</span>&nbsp;<span class="ident" id="1075439">i</span><span class="op" id="1075440">,</span>&nbsp;<span class="ident" id="1075442">err</span><span class="op" id="1075445">,</span>&nbsp;<span class="ident" id="1075447">tt</span><span class="op" id="1075449">.</span><span class="ident" id="1075450">wanterr</span><span class="op" id="1075457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1075461">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1075464">}</span><br>
<span class="lineno">100</span><span class="op" id="1075466">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1075469">func</span>&nbsp;<span class="ident" id="1075474">TestReaderAtConcurrent</span><span class="op" id="1075496">(</span><span class="ident" id="1075497">t</span>&nbsp;<span class="op" id="1075499">*</span><span class="ident" id="1075500">testing</span><span class="op" id="1075507">.</span><span class="ident" id="1075508">T</span><span class="op" id="1075509">)</span>&nbsp;<span class="op" id="1075511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1075514">//&nbsp;Test&nbsp;for&nbsp;the&nbsp;race&nbsp;detector,&nbsp;to&nbsp;verify&nbsp;ReadAt&nbsp;doesn&#39;t&nbsp;mutate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1075578">//&nbsp;any&nbsp;state.</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1075593">r</span>&nbsp;<span class="op" id="1075595">:=</span>&nbsp;<span class="ident" id="1075598">strings</span><span class="op" id="1075605">.</span><span class="ident" id="1075606">NewReader</span><span class="op" id="1075615">(</span><span class="string" id="1075616">&#34;0123456789&#34;</span><span class="op" id="1075628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1075631">var</span>&nbsp;<span class="ident" id="1075635">wg</span>&nbsp;<span class="ident" id="1075638">sync</span><span class="op" id="1075642">.</span><span class="ident" id="1075643">WaitGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1075654">for</span>&nbsp;<span class="ident" id="1075658">i</span>&nbsp;<span class="op" id="1075660">:=</span>&nbsp;<span class="num" id="1075663">0</span><span class="op" id="1075664">;</span>&nbsp;<span class="ident" id="1075666">i</span>&nbsp;<span class="op" id="1075668">&lt;</span>&nbsp;<span class="num" id="1075670">5</span><span class="op" id="1075671">;</span>&nbsp;<span class="ident" id="1075673">i</span><span class="op" id="1075674">++</span>&nbsp;<span class="op" id="1075677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1075681">wg</span><span class="op" id="1075683">.</span><span class="ident" id="1075684">Add</span><span class="op" id="1075687">(</span><span class="num" id="1075688">1</span><span class="op" id="1075689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1075693">go</span>&nbsp;<span class="keyword" id="1075696">func</span><span class="op" id="1075700">(</span><span class="ident" id="1075701">i</span>&nbsp;<span class="builtintype" id="1075703">int</span><span class="op" id="1075706">)</span>&nbsp;<span class="op" id="1075708">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1075713">defer</span>&nbsp;<span class="ident" id="1075719">wg</span><span class="op" id="1075721">.</span><span class="ident" id="1075722">Done</span><span class="op" id="1075726">(</span><span class="op" id="1075727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1075732">var</span>&nbsp;<span class="ident" id="1075736">buf</span>&nbsp;<span class="op" id="1075740">[</span><span class="num" id="1075741">1</span><span class="op" id="1075742">]</span><span class="builtintype" id="1075743">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1075751">r</span><span class="op" id="1075752">.</span><span class="ident" id="1075753">ReadAt</span><span class="op" id="1075759">(</span><span class="ident" id="1075760">buf</span><span class="op" id="1075763">[</span><span class="op" id="1075764">:</span><span class="op" id="1075765">]</span><span class="op" id="1075766">,</span>&nbsp;<span class="ident" id="1075768">int64</span><span class="op" id="1075773">(</span><span class="ident" id="1075774">i</span><span class="op" id="1075775">)</span><span class="op" id="1075776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1075780">}</span><span class="op" id="1075781">(</span><span class="ident" id="1075782">i</span><span class="op" id="1075783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1075786">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1075789">wg</span><span class="op" id="1075791">.</span><span class="ident" id="1075792">Wait</span><span class="op" id="1075796">(</span><span class="op" id="1075797">)</span><br>
<span class="lineno"></span><span class="op" id="1075799">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1075802">func</span>&nbsp;<span class="ident" id="1075807">TestEmptyReaderConcurrent</span><span class="op" id="1075832">(</span><span class="ident" id="1075833">t</span>&nbsp;<span class="op" id="1075835">*</span><span class="ident" id="1075836">testing</span><span class="op" id="1075843">.</span><span class="ident" id="1075844">T</span><span class="op" id="1075845">)</span>&nbsp;<span class="op" id="1075847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1075850">//&nbsp;Test&nbsp;for&nbsp;the&nbsp;race&nbsp;detector,&nbsp;to&nbsp;verify&nbsp;a&nbsp;Read&nbsp;that&nbsp;doesn&#39;t&nbsp;yield&nbsp;any&nbsp;bytes</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1075928">//&nbsp;is&nbsp;okay&nbsp;to&nbsp;use&nbsp;from&nbsp;multiple&nbsp;goroutines.&nbsp;This&nbsp;was&nbsp;our&nbsp;historic&nbsp;behavior.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1076005">//&nbsp;See&nbsp;golang.org/issue/7856</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1076035">r</span>&nbsp;<span class="op" id="1076037">:=</span>&nbsp;<span class="ident" id="1076040">strings</span><span class="op" id="1076047">.</span><span class="ident" id="1076048">NewReader</span><span class="op" id="1076057">(</span><span class="string" id="1076058">&#34;&#34;</span><span class="op" id="1076060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1076063">var</span>&nbsp;<span class="ident" id="1076067">wg</span>&nbsp;<span class="ident" id="1076070">sync</span><span class="op" id="1076074">.</span><span class="ident" id="1076075">WaitGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1076086">for</span>&nbsp;<span class="ident" id="1076090">i</span>&nbsp;<span class="op" id="1076092">:=</span>&nbsp;<span class="num" id="1076095">0</span><span class="op" id="1076096">;</span>&nbsp;<span class="ident" id="1076098">i</span>&nbsp;<span class="op" id="1076100">&lt;</span>&nbsp;<span class="num" id="1076102">5</span><span class="op" id="1076103">;</span>&nbsp;<span class="ident" id="1076105">i</span><span class="op" id="1076106">++</span>&nbsp;<span class="op" id="1076109">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1076113">wg</span><span class="op" id="1076115">.</span><span class="ident" id="1076116">Add</span><span class="op" id="1076119">(</span><span class="num" id="1076120">2</span><span class="op" id="1076121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1076125">go</span>&nbsp;<span class="keyword" id="1076128">func</span><span class="op" id="1076132">(</span><span class="op" id="1076133">)</span>&nbsp;<span class="op" id="1076135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1076140">defer</span>&nbsp;<span class="ident" id="1076146">wg</span><span class="op" id="1076148">.</span><span class="ident" id="1076149">Done</span><span class="op" id="1076153">(</span><span class="op" id="1076154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1076159">var</span>&nbsp;<span class="ident" id="1076163">buf</span>&nbsp;<span class="op" id="1076167">[</span><span class="num" id="1076168">1</span><span class="op" id="1076169">]</span><span class="builtintype" id="1076170">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1076178">r</span><span class="op" id="1076179">.</span><span class="ident" id="1076180">Read</span><span class="op" id="1076184">(</span><span class="ident" id="1076185">buf</span><span class="op" id="1076188">[</span><span class="op" id="1076189">:</span><span class="op" id="1076190">]</span><span class="op" id="1076191">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1076195">}</span><span class="op" id="1076196">(</span><span class="op" id="1076197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1076201">go</span>&nbsp;<span class="keyword" id="1076204">func</span><span class="op" id="1076208">(</span><span class="op" id="1076209">)</span>&nbsp;<span class="op" id="1076211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1076216">defer</span>&nbsp;<span class="ident" id="1076222">wg</span><span class="op" id="1076224">.</span><span class="ident" id="1076225">Done</span><span class="op" id="1076229">(</span><span class="op" id="1076230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1076235">r</span><span class="op" id="1076236">.</span><span class="ident" id="1076237">Read</span><span class="op" id="1076241">(</span><span class="builtintype" id="1076242">nil</span><span class="op" id="1076245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1076249">}</span><span class="op" id="1076250">(</span><span class="op" id="1076251">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1076254">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1076257">wg</span><span class="op" id="1076259">.</span><span class="ident" id="1076260">Wait</span><span class="op" id="1076264">(</span><span class="op" id="1076265">)</span><br>
<span class="lineno"></span><span class="op" id="1076267">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1076270">func</span>&nbsp;<span class="ident" id="1076275">TestWriteTo</span><span class="op" id="1076286">(</span><span class="ident" id="1076287">t</span>&nbsp;<span class="op" id="1076289">*</span><span class="ident" id="1076290">testing</span><span class="op" id="1076297">.</span><span class="ident" id="1076298">T</span><span class="op" id="1076299">)</span>&nbsp;<span class="op" id="1076301">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1076304">const</span>&nbsp;<span class="ident" id="1076310">str</span>&nbsp;<span class="op" id="1076314">=</span>&nbsp;<span class="string" id="1076316">&#34;0123456789&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1076330">for</span>&nbsp;<span class="ident" id="1076334">i</span>&nbsp;<span class="op" id="1076336">:=</span>&nbsp;<span class="num" id="1076339">0</span><span class="op" id="1076340">;</span>&nbsp;<span class="ident" id="1076342">i</span>&nbsp;<span class="op" id="1076344">&lt;=</span>&nbsp;<span class="builtinfunc" id="1076347">len</span><span class="op" id="1076350">(</span><span class="ident" id="1076351">str</span><span class="op" id="1076354">)</span><span class="op" id="1076355">;</span>&nbsp;<span class="ident" id="1076357">i</span><span class="op" id="1076358">++</span>&nbsp;<span class="op" id="1076361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1076365">s</span>&nbsp;<span class="op" id="1076367">:=</span>&nbsp;<span class="ident" id="1076370">str</span><span class="op" id="1076373">[</span><span class="ident" id="1076374">i</span><span class="op" id="1076375">:</span><span class="op" id="1076376">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1076380">r</span>&nbsp;<span class="op" id="1076382">:=</span>&nbsp;<span class="ident" id="1076385">strings</span><span class="op" id="1076392">.</span><span class="ident" id="1076393">NewReader</span><span class="op" id="1076402">(</span><span class="ident" id="1076403">s</span><span class="op" id="1076404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1076408">var</span>&nbsp;<span class="ident" id="1076412">b</span>&nbsp;<span class="ident" id="1076414">bytes</span><span class="op" id="1076419">.</span><span class="ident" id="1076420">Buffer</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1076429">n</span><span class="op" id="1076430">,</span>&nbsp;<span class="ident" id="1076432">err</span>&nbsp;<span class="op" id="1076436">:=</span>&nbsp;<span class="ident" id="1076439">r</span><span class="op" id="1076440">.</span><span class="ident" id="1076441">WriteTo</span><span class="op" id="1076448">(</span><span class="op" id="1076449">&amp;</span><span class="ident" id="1076450">b</span><span class="op" id="1076451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1076455">if</span>&nbsp;<span class="ident" id="1076458">expect</span>&nbsp;<span class="op" id="1076465">:=</span>&nbsp;<span class="ident" id="1076468">int64</span><span class="op" id="1076473">(</span><span class="builtinfunc" id="1076474">len</span><span class="op" id="1076477">(</span><span class="ident" id="1076478">s</span><span class="op" id="1076479">)</span><span class="op" id="1076480">)</span><span class="op" id="1076481">;</span>&nbsp;<span class="ident" id="1076483">n</span>&nbsp;<span class="op" id="1076485">!=</span>&nbsp;<span class="ident" id="1076488">expect</span>&nbsp;<span class="op" id="1076495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1076500">t</span><span class="op" id="1076501">.</span><span class="ident" id="1076502">Errorf</span><span class="op" id="1076508">(</span><span class="string" id="1076509">&#34;got&nbsp;%v;&nbsp;want&nbsp;%v&#34;</span><span class="op" id="1076526">,</span>&nbsp;<span class="ident" id="1076528">n</span><span class="op" id="1076529">,</span>&nbsp;<span class="ident" id="1076531">expect</span><span class="op" id="1076537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1076541">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1076545">if</span>&nbsp;<span class="ident" id="1076548">err</span>&nbsp;<span class="op" id="1076552">!=</span>&nbsp;<span class="builtintype" id="1076555">nil</span>&nbsp;<span class="op" id="1076559">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1076564">t</span><span class="op" id="1076565">.</span><span class="ident" id="1076566">Errorf</span><span class="op" id="1076572">(</span><span class="string" id="1076573">&#34;for&nbsp;length&nbsp;%d:&nbsp;got&nbsp;error&nbsp;=&nbsp;%v;&nbsp;want&nbsp;nil&#34;</span><span class="op" id="1076614">,</span>&nbsp;<span class="builtinfunc" id="1076616">len</span><span class="op" id="1076619">(</span><span class="ident" id="1076620">s</span><span class="op" id="1076621">)</span><span class="op" id="1076622">,</span>&nbsp;<span class="ident" id="1076624">err</span><span class="op" id="1076627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1076631">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1076635">if</span>&nbsp;<span class="ident" id="1076638">b</span><span class="op" id="1076639">.</span><span class="ident" id="1076640">String</span><span class="op" id="1076646">(</span><span class="op" id="1076647">)</span>&nbsp;<span class="op" id="1076649">!=</span>&nbsp;<span class="ident" id="1076652">s</span>&nbsp;<span class="op" id="1076654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1076659">t</span><span class="op" id="1076660">.</span><span class="ident" id="1076661">Errorf</span><span class="op" id="1076667">(</span><span class="string" id="1076668">&#34;got&nbsp;string&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="1076692">,</span>&nbsp;<span class="ident" id="1076694">b</span><span class="op" id="1076695">.</span><span class="ident" id="1076696">String</span><span class="op" id="1076702">(</span><span class="op" id="1076703">)</span><span class="op" id="1076704">,</span>&nbsp;<span class="ident" id="1076706">s</span><span class="op" id="1076707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1076711">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1076715">if</span>&nbsp;<span class="ident" id="1076718">r</span><span class="op" id="1076719">.</span><span class="ident" id="1076720">Len</span><span class="op" id="1076723">(</span><span class="op" id="1076724">)</span>&nbsp;<span class="op" id="1076726">!=</span>&nbsp;<span class="num" id="1076729">0</span>&nbsp;<span class="op" id="1076731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1076736">t</span><span class="op" id="1076737">.</span><span class="ident" id="1076738">Errorf</span><span class="op" id="1076744">(</span><span class="string" id="1076745">&#34;reader&nbsp;contains&nbsp;%v&nbsp;bytes;&nbsp;want&nbsp;0&#34;</span><span class="op" id="1076779">,</span>&nbsp;<span class="ident" id="1076781">r</span><span class="op" id="1076782">.</span><span class="ident" id="1076783">Len</span><span class="op" id="1076786">(</span><span class="op" id="1076787">)</span><span class="op" id="1076788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1076792">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1076795">}</span><br>
<span class="lineno"></span><span class="op" id="1076797">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
