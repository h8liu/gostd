<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/jpeg</h2>
<ul>
<li><a href="/gostd/image/jpeg/dct_test.go.html">dct_test.go</a></li>
<li><a href="/gostd/image/jpeg/fdct.go.html">fdct.go</a></li>
<li><a href="/gostd/image/jpeg/huffman.go.html">huffman.go</a></li>
<li><a href="/gostd/image/jpeg/idct.go.html">idct.go</a></li>
<li><a href="/gostd/image/jpeg/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/jpeg/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/jpeg/scan.go.html">scan.go</a></li>
<li><a href="/gostd/image/jpeg/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/jpeg/writer_test.go.html" class="current">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7679841">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7679896">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7679950">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7680001">package</span>&nbsp;<span class="ident" id="7680009">jpeg</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7680015">import</span>&nbsp;<span class="op" id="7680022">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7680025">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7680034">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7680041">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7680050">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7680065">&#34;image/png&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7680078">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7680091">&#34;math/rand&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7680104">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7680110">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7680120">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7680123">//&nbsp;zigzag&nbsp;maps&nbsp;from&nbsp;the&nbsp;natural&nbsp;ordering&nbsp;to&nbsp;the&nbsp;zig-zag&nbsp;ordering.&nbsp;For&nbsp;example,</span><br>
<span class="lineno">20</span><span class="comment" id="7680202">//&nbsp;zigzag[0*8&nbsp;+&nbsp;3]&nbsp;is&nbsp;the&nbsp;zig-zag&nbsp;sequence&nbsp;number&nbsp;of&nbsp;the&nbsp;element&nbsp;in&nbsp;the&nbsp;fourth</span><br>
<span class="lineno"></span><span class="comment" id="7680281">//&nbsp;column&nbsp;and&nbsp;first&nbsp;row.</span><br>
<span class="lineno"></span><span class="keyword" id="7680306">var</span>&nbsp;<span class="ident" id="7680310">zigzag</span>&nbsp;<span class="op" id="7680317">=</span>&nbsp;<span class="op" id="7680319">[</span><span class="ident" id="7680320">blockSize</span><span class="op" id="7680329">]</span><span class="builtintype" id="7680330">int</span><span class="op" id="7680333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7680336">0</span><span class="op" id="7680337">,</span>&nbsp;<span class="num" id="7680339">1</span><span class="op" id="7680340">,</span>&nbsp;<span class="num" id="7680342">5</span><span class="op" id="7680343">,</span>&nbsp;<span class="num" id="7680345">6</span><span class="op" id="7680346">,</span>&nbsp;<span class="num" id="7680348">14</span><span class="op" id="7680350">,</span>&nbsp;<span class="num" id="7680352">15</span><span class="op" id="7680354">,</span>&nbsp;<span class="num" id="7680356">27</span><span class="op" id="7680358">,</span>&nbsp;<span class="num" id="7680360">28</span><span class="op" id="7680362">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7680365">2</span><span class="op" id="7680366">,</span>&nbsp;<span class="num" id="7680368">4</span><span class="op" id="7680369">,</span>&nbsp;<span class="num" id="7680371">7</span><span class="op" id="7680372">,</span>&nbsp;<span class="num" id="7680374">13</span><span class="op" id="7680376">,</span>&nbsp;<span class="num" id="7680378">16</span><span class="op" id="7680380">,</span>&nbsp;<span class="num" id="7680382">26</span><span class="op" id="7680384">,</span>&nbsp;<span class="num" id="7680386">29</span><span class="op" id="7680388">,</span>&nbsp;<span class="num" id="7680390">42</span><span class="op" id="7680392">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7680395">3</span><span class="op" id="7680396">,</span>&nbsp;<span class="num" id="7680398">8</span><span class="op" id="7680399">,</span>&nbsp;<span class="num" id="7680401">12</span><span class="op" id="7680403">,</span>&nbsp;<span class="num" id="7680405">17</span><span class="op" id="7680407">,</span>&nbsp;<span class="num" id="7680409">25</span><span class="op" id="7680411">,</span>&nbsp;<span class="num" id="7680413">30</span><span class="op" id="7680415">,</span>&nbsp;<span class="num" id="7680417">41</span><span class="op" id="7680419">,</span>&nbsp;<span class="num" id="7680421">43</span><span class="op" id="7680423">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7680426">9</span><span class="op" id="7680427">,</span>&nbsp;<span class="num" id="7680429">11</span><span class="op" id="7680431">,</span>&nbsp;<span class="num" id="7680433">18</span><span class="op" id="7680435">,</span>&nbsp;<span class="num" id="7680437">24</span><span class="op" id="7680439">,</span>&nbsp;<span class="num" id="7680441">31</span><span class="op" id="7680443">,</span>&nbsp;<span class="num" id="7680445">40</span><span class="op" id="7680447">,</span>&nbsp;<span class="num" id="7680449">44</span><span class="op" id="7680451">,</span>&nbsp;<span class="num" id="7680453">53</span><span class="op" id="7680455">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7680458">10</span><span class="op" id="7680460">,</span>&nbsp;<span class="num" id="7680462">19</span><span class="op" id="7680464">,</span>&nbsp;<span class="num" id="7680466">23</span><span class="op" id="7680468">,</span>&nbsp;<span class="num" id="7680470">32</span><span class="op" id="7680472">,</span>&nbsp;<span class="num" id="7680474">39</span><span class="op" id="7680476">,</span>&nbsp;<span class="num" id="7680478">45</span><span class="op" id="7680480">,</span>&nbsp;<span class="num" id="7680482">52</span><span class="op" id="7680484">,</span>&nbsp;<span class="num" id="7680486">54</span><span class="op" id="7680488">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7680491">20</span><span class="op" id="7680493">,</span>&nbsp;<span class="num" id="7680495">22</span><span class="op" id="7680497">,</span>&nbsp;<span class="num" id="7680499">33</span><span class="op" id="7680501">,</span>&nbsp;<span class="num" id="7680503">38</span><span class="op" id="7680505">,</span>&nbsp;<span class="num" id="7680507">46</span><span class="op" id="7680509">,</span>&nbsp;<span class="num" id="7680511">51</span><span class="op" id="7680513">,</span>&nbsp;<span class="num" id="7680515">55</span><span class="op" id="7680517">,</span>&nbsp;<span class="num" id="7680519">60</span><span class="op" id="7680521">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7680524">21</span><span class="op" id="7680526">,</span>&nbsp;<span class="num" id="7680528">34</span><span class="op" id="7680530">,</span>&nbsp;<span class="num" id="7680532">37</span><span class="op" id="7680534">,</span>&nbsp;<span class="num" id="7680536">47</span><span class="op" id="7680538">,</span>&nbsp;<span class="num" id="7680540">50</span><span class="op" id="7680542">,</span>&nbsp;<span class="num" id="7680544">56</span><span class="op" id="7680546">,</span>&nbsp;<span class="num" id="7680548">59</span><span class="op" id="7680550">,</span>&nbsp;<span class="num" id="7680552">61</span><span class="op" id="7680554">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7680557">35</span><span class="op" id="7680559">,</span>&nbsp;<span class="num" id="7680561">36</span><span class="op" id="7680563">,</span>&nbsp;<span class="num" id="7680565">48</span><span class="op" id="7680567">,</span>&nbsp;<span class="num" id="7680569">49</span><span class="op" id="7680571">,</span>&nbsp;<span class="num" id="7680573">57</span><span class="op" id="7680575">,</span>&nbsp;<span class="num" id="7680577">58</span><span class="op" id="7680579">,</span>&nbsp;<span class="num" id="7680581">62</span><span class="op" id="7680583">,</span>&nbsp;<span class="num" id="7680585">63</span><span class="op" id="7680587">,</span><br>
<span class="lineno"></span><span class="op" id="7680589">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7680592">func</span>&nbsp;<span class="ident" id="7680597">TestZigUnzig</span><span class="op" id="7680609">(</span><span class="ident" id="7680610">t</span>&nbsp;<span class="op" id="7680612">*</span><span class="ident" id="7680613">testing</span><span class="op" id="7680620">.</span><span class="ident" id="7680621">T</span><span class="op" id="7680622">)</span>&nbsp;<span class="op" id="7680624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7680627">for</span>&nbsp;<span class="ident" id="7680631">i</span>&nbsp;<span class="op" id="7680633">:=</span>&nbsp;<span class="num" id="7680636">0</span><span class="op" id="7680637">;</span>&nbsp;<span class="ident" id="7680639">i</span>&nbsp;<span class="op" id="7680641">&lt;</span>&nbsp;<span class="ident" id="7680643">blockSize</span><span class="op" id="7680652">;</span>&nbsp;<span class="ident" id="7680654">i</span><span class="op" id="7680655">++</span>&nbsp;<span class="op" id="7680658">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7680662">if</span>&nbsp;<span class="ident" id="7680665">unzig</span><span class="op" id="7680670">[</span><span class="ident" id="7680671">zigzag</span><span class="op" id="7680677">[</span><span class="ident" id="7680678">i</span><span class="op" id="7680679">]</span><span class="op" id="7680680">]</span>&nbsp;<span class="op" id="7680682">!=</span>&nbsp;<span class="ident" id="7680685">i</span>&nbsp;<span class="op" id="7680687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7680692">t</span><span class="op" id="7680693">.</span><span class="ident" id="7680694">Errorf</span><span class="op" id="7680700">(</span><span class="string" id="7680701">&#34;unzig[zigzag[%d]]&nbsp;==&nbsp;%d&#34;</span><span class="op" id="7680726">,</span>&nbsp;<span class="ident" id="7680728">i</span><span class="op" id="7680729">,</span>&nbsp;<span class="ident" id="7680731">unzig</span><span class="op" id="7680736">[</span><span class="ident" id="7680737">zigzag</span><span class="op" id="7680743">[</span><span class="ident" id="7680744">i</span><span class="op" id="7680745">]</span><span class="op" id="7680746">]</span><span class="op" id="7680747">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7680751">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7680755">if</span>&nbsp;<span class="ident" id="7680758">zigzag</span><span class="op" id="7680764">[</span><span class="ident" id="7680765">unzig</span><span class="op" id="7680770">[</span><span class="ident" id="7680771">i</span><span class="op" id="7680772">]</span><span class="op" id="7680773">]</span>&nbsp;<span class="op" id="7680775">!=</span>&nbsp;<span class="ident" id="7680778">i</span>&nbsp;<span class="op" id="7680780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7680785">t</span><span class="op" id="7680786">.</span><span class="ident" id="7680787">Errorf</span><span class="op" id="7680793">(</span><span class="string" id="7680794">&#34;zigzag[unzig[%d]]&nbsp;==&nbsp;%d&#34;</span><span class="op" id="7680819">,</span>&nbsp;<span class="ident" id="7680821">i</span><span class="op" id="7680822">,</span>&nbsp;<span class="ident" id="7680824">zigzag</span><span class="op" id="7680830">[</span><span class="ident" id="7680831">unzig</span><span class="op" id="7680836">[</span><span class="ident" id="7680837">i</span><span class="op" id="7680838">]</span><span class="op" id="7680839">]</span><span class="op" id="7680840">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7680844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7680847">}</span><br>
<span class="lineno"></span><span class="op" id="7680849">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7680852">//&nbsp;unscaledQuantInNaturalOrder&nbsp;are&nbsp;the&nbsp;unscaled&nbsp;quantization&nbsp;tables&nbsp;in</span><br>
<span class="lineno">45</span><span class="comment" id="7680923">//&nbsp;natural&nbsp;(not&nbsp;zig-zag)&nbsp;order,&nbsp;as&nbsp;specified&nbsp;in&nbsp;section&nbsp;K.1.</span><br>
<span class="lineno"></span><span class="keyword" id="7680984">var</span>&nbsp;<span class="ident" id="7680988">unscaledQuantInNaturalOrder</span>&nbsp;<span class="op" id="7681016">=</span>&nbsp;<span class="op" id="7681018">[</span><span class="ident" id="7681019">nQuantIndex</span><span class="op" id="7681030">]</span><span class="op" id="7681031">[</span><span class="ident" id="7681032">blockSize</span><span class="op" id="7681041">]</span><span class="builtintype" id="7681042">byte</span><span class="op" id="7681046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7681049">//&nbsp;Luminance.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7681064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7681068">16</span><span class="op" id="7681070">,</span>&nbsp;<span class="num" id="7681072">11</span><span class="op" id="7681074">,</span>&nbsp;<span class="num" id="7681076">10</span><span class="op" id="7681078">,</span>&nbsp;<span class="num" id="7681080">16</span><span class="op" id="7681082">,</span>&nbsp;<span class="num" id="7681084">24</span><span class="op" id="7681086">,</span>&nbsp;<span class="num" id="7681088">40</span><span class="op" id="7681090">,</span>&nbsp;<span class="num" id="7681092">51</span><span class="op" id="7681094">,</span>&nbsp;<span class="num" id="7681096">61</span><span class="op" id="7681098">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7681102">12</span><span class="op" id="7681104">,</span>&nbsp;<span class="num" id="7681106">12</span><span class="op" id="7681108">,</span>&nbsp;<span class="num" id="7681110">14</span><span class="op" id="7681112">,</span>&nbsp;<span class="num" id="7681114">19</span><span class="op" id="7681116">,</span>&nbsp;<span class="num" id="7681118">26</span><span class="op" id="7681120">,</span>&nbsp;<span class="num" id="7681122">58</span><span class="op" id="7681124">,</span>&nbsp;<span class="num" id="7681126">60</span><span class="op" id="7681128">,</span>&nbsp;<span class="num" id="7681130">55</span><span class="op" id="7681132">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7681136">14</span><span class="op" id="7681138">,</span>&nbsp;<span class="num" id="7681140">13</span><span class="op" id="7681142">,</span>&nbsp;<span class="num" id="7681144">16</span><span class="op" id="7681146">,</span>&nbsp;<span class="num" id="7681148">24</span><span class="op" id="7681150">,</span>&nbsp;<span class="num" id="7681152">40</span><span class="op" id="7681154">,</span>&nbsp;<span class="num" id="7681156">57</span><span class="op" id="7681158">,</span>&nbsp;<span class="num" id="7681160">69</span><span class="op" id="7681162">,</span>&nbsp;<span class="num" id="7681164">56</span><span class="op" id="7681166">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7681170">14</span><span class="op" id="7681172">,</span>&nbsp;<span class="num" id="7681174">17</span><span class="op" id="7681176">,</span>&nbsp;<span class="num" id="7681178">22</span><span class="op" id="7681180">,</span>&nbsp;<span class="num" id="7681182">29</span><span class="op" id="7681184">,</span>&nbsp;<span class="num" id="7681186">51</span><span class="op" id="7681188">,</span>&nbsp;<span class="num" id="7681190">87</span><span class="op" id="7681192">,</span>&nbsp;<span class="num" id="7681194">80</span><span class="op" id="7681196">,</span>&nbsp;<span class="num" id="7681198">62</span><span class="op" id="7681200">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7681204">18</span><span class="op" id="7681206">,</span>&nbsp;<span class="num" id="7681208">22</span><span class="op" id="7681210">,</span>&nbsp;<span class="num" id="7681212">37</span><span class="op" id="7681214">,</span>&nbsp;<span class="num" id="7681216">56</span><span class="op" id="7681218">,</span>&nbsp;<span class="num" id="7681220">68</span><span class="op" id="7681222">,</span>&nbsp;<span class="num" id="7681224">109</span><span class="op" id="7681227">,</span>&nbsp;<span class="num" id="7681229">103</span><span class="op" id="7681232">,</span>&nbsp;<span class="num" id="7681234">77</span><span class="op" id="7681236">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7681240">24</span><span class="op" id="7681242">,</span>&nbsp;<span class="num" id="7681244">35</span><span class="op" id="7681246">,</span>&nbsp;<span class="num" id="7681248">55</span><span class="op" id="7681250">,</span>&nbsp;<span class="num" id="7681252">64</span><span class="op" id="7681254">,</span>&nbsp;<span class="num" id="7681256">81</span><span class="op" id="7681258">,</span>&nbsp;<span class="num" id="7681260">104</span><span class="op" id="7681263">,</span>&nbsp;<span class="num" id="7681265">113</span><span class="op" id="7681268">,</span>&nbsp;<span class="num" id="7681270">92</span><span class="op" id="7681272">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7681276">49</span><span class="op" id="7681278">,</span>&nbsp;<span class="num" id="7681280">64</span><span class="op" id="7681282">,</span>&nbsp;<span class="num" id="7681284">78</span><span class="op" id="7681286">,</span>&nbsp;<span class="num" id="7681288">87</span><span class="op" id="7681290">,</span>&nbsp;<span class="num" id="7681292">103</span><span class="op" id="7681295">,</span>&nbsp;<span class="num" id="7681297">121</span><span class="op" id="7681300">,</span>&nbsp;<span class="num" id="7681302">120</span><span class="op" id="7681305">,</span>&nbsp;<span class="num" id="7681307">101</span><span class="op" id="7681310">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7681314">72</span><span class="op" id="7681316">,</span>&nbsp;<span class="num" id="7681318">92</span><span class="op" id="7681320">,</span>&nbsp;<span class="num" id="7681322">95</span><span class="op" id="7681324">,</span>&nbsp;<span class="num" id="7681326">98</span><span class="op" id="7681328">,</span>&nbsp;<span class="num" id="7681330">112</span><span class="op" id="7681333">,</span>&nbsp;<span class="num" id="7681335">100</span><span class="op" id="7681338">,</span>&nbsp;<span class="num" id="7681340">103</span><span class="op" id="7681343">,</span>&nbsp;<span class="num" id="7681345">99</span><span class="op" id="7681347">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7681350">}</span><span class="op" id="7681351">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7681354">//&nbsp;Chrominance.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7681371">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7681375">17</span><span class="op" id="7681377">,</span>&nbsp;<span class="num" id="7681379">18</span><span class="op" id="7681381">,</span>&nbsp;<span class="num" id="7681383">24</span><span class="op" id="7681385">,</span>&nbsp;<span class="num" id="7681387">47</span><span class="op" id="7681389">,</span>&nbsp;<span class="num" id="7681391">99</span><span class="op" id="7681393">,</span>&nbsp;<span class="num" id="7681395">99</span><span class="op" id="7681397">,</span>&nbsp;<span class="num" id="7681399">99</span><span class="op" id="7681401">,</span>&nbsp;<span class="num" id="7681403">99</span><span class="op" id="7681405">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7681409">18</span><span class="op" id="7681411">,</span>&nbsp;<span class="num" id="7681413">21</span><span class="op" id="7681415">,</span>&nbsp;<span class="num" id="7681417">26</span><span class="op" id="7681419">,</span>&nbsp;<span class="num" id="7681421">66</span><span class="op" id="7681423">,</span>&nbsp;<span class="num" id="7681425">99</span><span class="op" id="7681427">,</span>&nbsp;<span class="num" id="7681429">99</span><span class="op" id="7681431">,</span>&nbsp;<span class="num" id="7681433">99</span><span class="op" id="7681435">,</span>&nbsp;<span class="num" id="7681437">99</span><span class="op" id="7681439">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7681443">24</span><span class="op" id="7681445">,</span>&nbsp;<span class="num" id="7681447">26</span><span class="op" id="7681449">,</span>&nbsp;<span class="num" id="7681451">56</span><span class="op" id="7681453">,</span>&nbsp;<span class="num" id="7681455">99</span><span class="op" id="7681457">,</span>&nbsp;<span class="num" id="7681459">99</span><span class="op" id="7681461">,</span>&nbsp;<span class="num" id="7681463">99</span><span class="op" id="7681465">,</span>&nbsp;<span class="num" id="7681467">99</span><span class="op" id="7681469">,</span>&nbsp;<span class="num" id="7681471">99</span><span class="op" id="7681473">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7681477">47</span><span class="op" id="7681479">,</span>&nbsp;<span class="num" id="7681481">66</span><span class="op" id="7681483">,</span>&nbsp;<span class="num" id="7681485">99</span><span class="op" id="7681487">,</span>&nbsp;<span class="num" id="7681489">99</span><span class="op" id="7681491">,</span>&nbsp;<span class="num" id="7681493">99</span><span class="op" id="7681495">,</span>&nbsp;<span class="num" id="7681497">99</span><span class="op" id="7681499">,</span>&nbsp;<span class="num" id="7681501">99</span><span class="op" id="7681503">,</span>&nbsp;<span class="num" id="7681505">99</span><span class="op" id="7681507">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7681511">99</span><span class="op" id="7681513">,</span>&nbsp;<span class="num" id="7681515">99</span><span class="op" id="7681517">,</span>&nbsp;<span class="num" id="7681519">99</span><span class="op" id="7681521">,</span>&nbsp;<span class="num" id="7681523">99</span><span class="op" id="7681525">,</span>&nbsp;<span class="num" id="7681527">99</span><span class="op" id="7681529">,</span>&nbsp;<span class="num" id="7681531">99</span><span class="op" id="7681533">,</span>&nbsp;<span class="num" id="7681535">99</span><span class="op" id="7681537">,</span>&nbsp;<span class="num" id="7681539">99</span><span class="op" id="7681541">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7681545">99</span><span class="op" id="7681547">,</span>&nbsp;<span class="num" id="7681549">99</span><span class="op" id="7681551">,</span>&nbsp;<span class="num" id="7681553">99</span><span class="op" id="7681555">,</span>&nbsp;<span class="num" id="7681557">99</span><span class="op" id="7681559">,</span>&nbsp;<span class="num" id="7681561">99</span><span class="op" id="7681563">,</span>&nbsp;<span class="num" id="7681565">99</span><span class="op" id="7681567">,</span>&nbsp;<span class="num" id="7681569">99</span><span class="op" id="7681571">,</span>&nbsp;<span class="num" id="7681573">99</span><span class="op" id="7681575">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7681579">99</span><span class="op" id="7681581">,</span>&nbsp;<span class="num" id="7681583">99</span><span class="op" id="7681585">,</span>&nbsp;<span class="num" id="7681587">99</span><span class="op" id="7681589">,</span>&nbsp;<span class="num" id="7681591">99</span><span class="op" id="7681593">,</span>&nbsp;<span class="num" id="7681595">99</span><span class="op" id="7681597">,</span>&nbsp;<span class="num" id="7681599">99</span><span class="op" id="7681601">,</span>&nbsp;<span class="num" id="7681603">99</span><span class="op" id="7681605">,</span>&nbsp;<span class="num" id="7681607">99</span><span class="op" id="7681609">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7681613">99</span><span class="op" id="7681615">,</span>&nbsp;<span class="num" id="7681617">99</span><span class="op" id="7681619">,</span>&nbsp;<span class="num" id="7681621">99</span><span class="op" id="7681623">,</span>&nbsp;<span class="num" id="7681625">99</span><span class="op" id="7681627">,</span>&nbsp;<span class="num" id="7681629">99</span><span class="op" id="7681631">,</span>&nbsp;<span class="num" id="7681633">99</span><span class="op" id="7681635">,</span>&nbsp;<span class="num" id="7681637">99</span><span class="op" id="7681639">,</span>&nbsp;<span class="num" id="7681641">99</span><span class="op" id="7681643">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7681646">}</span><span class="op" id="7681647">,</span><br>
<span class="lineno"></span><span class="op" id="7681649">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="7681652">func</span>&nbsp;<span class="ident" id="7681657">TestUnscaledQuant</span><span class="op" id="7681674">(</span><span class="ident" id="7681675">t</span>&nbsp;<span class="op" id="7681677">*</span><span class="ident" id="7681678">testing</span><span class="op" id="7681685">.</span><span class="ident" id="7681686">T</span><span class="op" id="7681687">)</span>&nbsp;<span class="op" id="7681689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7681692">bad</span>&nbsp;<span class="op" id="7681696">:=</span>&nbsp;<span class="builtintype" id="7681699">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7681706">for</span>&nbsp;<span class="ident" id="7681710">i</span>&nbsp;<span class="op" id="7681712">:=</span>&nbsp;<span class="ident" id="7681715">quantIndex</span><span class="op" id="7681725">(</span><span class="num" id="7681726">0</span><span class="op" id="7681727">)</span><span class="op" id="7681728">;</span>&nbsp;<span class="ident" id="7681730">i</span>&nbsp;<span class="op" id="7681732">&lt;</span>&nbsp;<span class="ident" id="7681734">nQuantIndex</span><span class="op" id="7681745">;</span>&nbsp;<span class="ident" id="7681747">i</span><span class="op" id="7681748">++</span>&nbsp;<span class="op" id="7681751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7681755">for</span>&nbsp;<span class="ident" id="7681759">zig</span>&nbsp;<span class="op" id="7681763">:=</span>&nbsp;<span class="num" id="7681766">0</span><span class="op" id="7681767">;</span>&nbsp;<span class="ident" id="7681769">zig</span>&nbsp;<span class="op" id="7681773">&lt;</span>&nbsp;<span class="ident" id="7681775">blockSize</span><span class="op" id="7681784">;</span>&nbsp;<span class="ident" id="7681786">zig</span><span class="op" id="7681789">++</span>&nbsp;<span class="op" id="7681792">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7681797">got</span>&nbsp;<span class="op" id="7681801">:=</span>&nbsp;<span class="ident" id="7681804">unscaledQuant</span><span class="op" id="7681817">[</span><span class="ident" id="7681818">i</span><span class="op" id="7681819">]</span><span class="op" id="7681820">[</span><span class="ident" id="7681821">zig</span><span class="op" id="7681824">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7681829">want</span>&nbsp;<span class="op" id="7681834">:=</span>&nbsp;<span class="ident" id="7681837">unscaledQuantInNaturalOrder</span><span class="op" id="7681864">[</span><span class="ident" id="7681865">i</span><span class="op" id="7681866">]</span><span class="op" id="7681867">[</span><span class="ident" id="7681868">unzig</span><span class="op" id="7681873">[</span><span class="ident" id="7681874">zig</span><span class="op" id="7681877">]</span><span class="op" id="7681878">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7681883">if</span>&nbsp;<span class="ident" id="7681886">got</span>&nbsp;<span class="op" id="7681890">!=</span>&nbsp;<span class="ident" id="7681893">want</span>&nbsp;<span class="op" id="7681898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7681904">t</span><span class="op" id="7681905">.</span><span class="ident" id="7681906">Errorf</span><span class="op" id="7681912">(</span><span class="string" id="7681913">&#34;i=%d,&nbsp;zig=%d:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7681944">,</span>&nbsp;<span class="ident" id="7681946">i</span><span class="op" id="7681947">,</span>&nbsp;<span class="ident" id="7681949">zig</span><span class="op" id="7681952">,</span>&nbsp;<span class="ident" id="7681954">got</span><span class="op" id="7681957">,</span>&nbsp;<span class="ident" id="7681959">want</span><span class="op" id="7681963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7681969">bad</span>&nbsp;<span class="op" id="7681973">=</span>&nbsp;<span class="builtintype" id="7681975">true</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7681983">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7681987">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7681990">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7681993">if</span>&nbsp;<span class="ident" id="7681996">bad</span>&nbsp;<span class="op" id="7682000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7682004">names</span>&nbsp;<span class="op" id="7682010">:=</span>&nbsp;<span class="op" id="7682013">[</span><span class="ident" id="7682014">nQuantIndex</span><span class="op" id="7682025">]</span><span class="builtintype" id="7682026">string</span><span class="op" id="7682032">{</span><span class="string" id="7682033">&#34;Luminance&#34;</span><span class="op" id="7682044">,</span>&nbsp;<span class="string" id="7682046">&#34;Chrominance&#34;</span><span class="op" id="7682059">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7682063">buf</span>&nbsp;<span class="op" id="7682067">:=</span>&nbsp;<span class="op" id="7682070">&amp;</span><span class="ident" id="7682071">bytes</span><span class="op" id="7682076">.</span><span class="ident" id="7682077">Buffer</span><span class="op" id="7682083">{</span><span class="op" id="7682084">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7682088">for</span>&nbsp;<span class="ident" id="7682092">i</span><span class="op" id="7682093">,</span>&nbsp;<span class="ident" id="7682095">name</span>&nbsp;<span class="op" id="7682100">:=</span>&nbsp;<span class="keyword" id="7682103">range</span>&nbsp;<span class="ident" id="7682109">names</span>&nbsp;<span class="op" id="7682115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7682120">fmt</span><span class="op" id="7682123">.</span><span class="ident" id="7682124">Fprintf</span><span class="op" id="7682131">(</span><span class="ident" id="7682132">buf</span><span class="op" id="7682135">,</span>&nbsp;<span class="string" id="7682137">&#34;//&nbsp;%s.\n{\n&#34;</span><span class="op" id="7682150">,</span>&nbsp;<span class="ident" id="7682152">name</span><span class="op" id="7682156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7682161">for</span>&nbsp;<span class="ident" id="7682165">zig</span>&nbsp;<span class="op" id="7682169">:=</span>&nbsp;<span class="num" id="7682172">0</span><span class="op" id="7682173">;</span>&nbsp;<span class="ident" id="7682175">zig</span>&nbsp;<span class="op" id="7682179">&lt;</span>&nbsp;<span class="ident" id="7682181">blockSize</span><span class="op" id="7682190">;</span>&nbsp;<span class="ident" id="7682192">zig</span><span class="op" id="7682195">++</span>&nbsp;<span class="op" id="7682198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7682204">fmt</span><span class="op" id="7682207">.</span><span class="ident" id="7682208">Fprintf</span><span class="op" id="7682215">(</span><span class="ident" id="7682216">buf</span><span class="op" id="7682219">,</span>&nbsp;<span class="string" id="7682221">&#34;%d,&nbsp;&#34;</span><span class="op" id="7682227">,</span>&nbsp;<span class="ident" id="7682229">unscaledQuantInNaturalOrder</span><span class="op" id="7682256">[</span><span class="ident" id="7682257">i</span><span class="op" id="7682258">]</span><span class="op" id="7682259">[</span><span class="ident" id="7682260">unzig</span><span class="op" id="7682265">[</span><span class="ident" id="7682266">zig</span><span class="op" id="7682269">]</span><span class="op" id="7682270">]</span><span class="op" id="7682271">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7682277">if</span>&nbsp;<span class="ident" id="7682280">zig</span><span class="op" id="7682283">%</span><span class="num" id="7682284">8</span>&nbsp;<span class="op" id="7682286">==</span>&nbsp;<span class="num" id="7682289">7</span>&nbsp;<span class="op" id="7682291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7682298">buf</span><span class="op" id="7682301">.</span><span class="ident" id="7682302">WriteString</span><span class="op" id="7682313">(</span><span class="string" id="7682314">&#34;\n&#34;</span><span class="op" id="7682318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7682324">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7682329">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7682334">buf</span><span class="op" id="7682337">.</span><span class="ident" id="7682338">WriteString</span><span class="op" id="7682349">(</span><span class="string" id="7682350">&#34;},\n&#34;</span><span class="op" id="7682356">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7682360">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7682364">t</span><span class="op" id="7682365">.</span><span class="ident" id="7682366">Logf</span><span class="op" id="7682370">(</span><span class="string" id="7682371">&#34;expected&nbsp;unscaledQuant&nbsp;values:\n%s&#34;</span><span class="op" id="7682407">,</span>&nbsp;<span class="ident" id="7682409">buf</span><span class="op" id="7682412">.</span><span class="ident" id="7682413">String</span><span class="op" id="7682419">(</span><span class="op" id="7682420">)</span><span class="op" id="7682421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7682424">}</span><br>
<span class="lineno"></span><span class="op" id="7682426">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="keyword" id="7682429">var</span>&nbsp;<span class="ident" id="7682433">testCase</span>&nbsp;<span class="op" id="7682442">=</span>&nbsp;<span class="op" id="7682444">[</span><span class="op" id="7682445">]</span><span class="keyword" id="7682446">struct</span>&nbsp;<span class="op" id="7682453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7682456">filename</span>&nbsp;&nbsp;<span class="builtintype" id="7682466">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7682474">quality</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7682484">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7682489">tolerance</span>&nbsp;<span class="ident" id="7682499">int64</span><br>
<span class="lineno"></span><span class="op" id="7682505">}</span><span class="op" id="7682506">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7682509">{</span><span class="string" id="7682510">&#34;../testdata/video-001.png&#34;</span><span class="op" id="7682537">,</span>&nbsp;<span class="num" id="7682539">1</span><span class="op" id="7682540">,</span>&nbsp;<span class="num" id="7682542">24</span>&nbsp;<span class="op" id="7682545">&lt;&lt;</span>&nbsp;<span class="num" id="7682548">8</span><span class="op" id="7682549">}</span><span class="op" id="7682550">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7682553">{</span><span class="string" id="7682554">&#34;../testdata/video-001.png&#34;</span><span class="op" id="7682581">,</span>&nbsp;<span class="num" id="7682583">20</span><span class="op" id="7682585">,</span>&nbsp;<span class="num" id="7682587">12</span>&nbsp;<span class="op" id="7682590">&lt;&lt;</span>&nbsp;<span class="num" id="7682593">8</span><span class="op" id="7682594">}</span><span class="op" id="7682595">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7682598">{</span><span class="string" id="7682599">&#34;../testdata/video-001.png&#34;</span><span class="op" id="7682626">,</span>&nbsp;<span class="num" id="7682628">60</span><span class="op" id="7682630">,</span>&nbsp;<span class="num" id="7682632">8</span>&nbsp;<span class="op" id="7682634">&lt;&lt;</span>&nbsp;<span class="num" id="7682637">8</span><span class="op" id="7682638">}</span><span class="op" id="7682639">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7682642">{</span><span class="string" id="7682643">&#34;../testdata/video-001.png&#34;</span><span class="op" id="7682670">,</span>&nbsp;<span class="num" id="7682672">80</span><span class="op" id="7682674">,</span>&nbsp;<span class="num" id="7682676">6</span>&nbsp;<span class="op" id="7682678">&lt;&lt;</span>&nbsp;<span class="num" id="7682681">8</span><span class="op" id="7682682">}</span><span class="op" id="7682683">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7682686">{</span><span class="string" id="7682687">&#34;../testdata/video-001.png&#34;</span><span class="op" id="7682714">,</span>&nbsp;<span class="num" id="7682716">90</span><span class="op" id="7682718">,</span>&nbsp;<span class="num" id="7682720">4</span>&nbsp;<span class="op" id="7682722">&lt;&lt;</span>&nbsp;<span class="num" id="7682725">8</span><span class="op" id="7682726">}</span><span class="op" id="7682727">,</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7682730">{</span><span class="string" id="7682731">&#34;../testdata/video-001.png&#34;</span><span class="op" id="7682758">,</span>&nbsp;<span class="num" id="7682760">100</span><span class="op" id="7682763">,</span>&nbsp;<span class="num" id="7682765">2</span>&nbsp;<span class="op" id="7682767">&lt;&lt;</span>&nbsp;<span class="num" id="7682770">8</span><span class="op" id="7682771">}</span><span class="op" id="7682772">,</span><br>
<span class="lineno"></span><span class="op" id="7682774">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7682777">func</span>&nbsp;<span class="ident" id="7682782">delta</span><span class="op" id="7682787">(</span><span class="ident" id="7682788">u0</span><span class="op" id="7682790">,</span>&nbsp;<span class="ident" id="7682792">u1</span>&nbsp;<span class="builtintype" id="7682795">uint32</span><span class="op" id="7682801">)</span>&nbsp;<span class="ident" id="7682803">int64</span>&nbsp;<span class="op" id="7682809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7682812">d</span>&nbsp;<span class="op" id="7682814">:=</span>&nbsp;<span class="ident" id="7682817">int64</span><span class="op" id="7682822">(</span><span class="ident" id="7682823">u0</span><span class="op" id="7682825">)</span>&nbsp;<span class="op" id="7682827">-</span>&nbsp;<span class="ident" id="7682829">int64</span><span class="op" id="7682834">(</span><span class="ident" id="7682835">u1</span><span class="op" id="7682837">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7682840">if</span>&nbsp;<span class="ident" id="7682843">d</span>&nbsp;<span class="op" id="7682845">&lt;</span>&nbsp;<span class="num" id="7682847">0</span>&nbsp;<span class="op" id="7682849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7682853">return</span>&nbsp;<span class="op" id="7682860">-</span><span class="ident" id="7682861">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7682864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7682867">return</span>&nbsp;<span class="ident" id="7682874">d</span><br>
<span class="lineno"></span><span class="op" id="7682876">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="keyword" id="7682879">func</span>&nbsp;<span class="ident" id="7682884">readPng</span><span class="op" id="7682891">(</span><span class="ident" id="7682892">filename</span>&nbsp;<span class="builtintype" id="7682901">string</span><span class="op" id="7682907">)</span>&nbsp;<span class="op" id="7682909">(</span><span class="ident" id="7682910">image</span><span class="op" id="7682915">.</span><span class="ident" id="7682916">Image</span><span class="op" id="7682921">,</span>&nbsp;<span class="builtintype" id="7682923">error</span><span class="op" id="7682928">)</span>&nbsp;<span class="op" id="7682930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7682933">f</span><span class="op" id="7682934">,</span>&nbsp;<span class="ident" id="7682936">err</span>&nbsp;<span class="op" id="7682940">:=</span>&nbsp;<span class="ident" id="7682943">os</span><span class="op" id="7682945">.</span><span class="ident" id="7682946">Open</span><span class="op" id="7682950">(</span><span class="ident" id="7682951">filename</span><span class="op" id="7682959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7682962">if</span>&nbsp;<span class="ident" id="7682965">err</span>&nbsp;<span class="op" id="7682969">!=</span>&nbsp;<span class="builtintype" id="7682972">nil</span>&nbsp;<span class="op" id="7682976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7682980">return</span>&nbsp;<span class="builtintype" id="7682987">nil</span><span class="op" id="7682990">,</span>&nbsp;<span class="ident" id="7682992">err</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7682997">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7683000">defer</span>&nbsp;<span class="ident" id="7683006">f</span><span class="op" id="7683007">.</span><span class="ident" id="7683008">Close</span><span class="op" id="7683013">(</span><span class="op" id="7683014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7683017">return</span>&nbsp;<span class="ident" id="7683024">png</span><span class="op" id="7683027">.</span><span class="ident" id="7683028">Decode</span><span class="op" id="7683034">(</span><span class="ident" id="7683035">f</span><span class="op" id="7683036">)</span><br>
<span class="lineno"></span><span class="op" id="7683038">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="7683041">func</span>&nbsp;<span class="ident" id="7683046">TestWriter</span><span class="op" id="7683056">(</span><span class="ident" id="7683057">t</span>&nbsp;<span class="op" id="7683059">*</span><span class="ident" id="7683060">testing</span><span class="op" id="7683067">.</span><span class="ident" id="7683068">T</span><span class="op" id="7683069">)</span>&nbsp;<span class="op" id="7683071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7683074">for</span>&nbsp;<span class="ident" id="7683078">_</span><span class="op" id="7683079">,</span>&nbsp;<span class="ident" id="7683081">tc</span>&nbsp;<span class="op" id="7683084">:=</span>&nbsp;<span class="keyword" id="7683087">range</span>&nbsp;<span class="ident" id="7683093">testCase</span>&nbsp;<span class="op" id="7683102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7683106">//&nbsp;Read&nbsp;the&nbsp;image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7683127">m0</span><span class="op" id="7683129">,</span>&nbsp;<span class="ident" id="7683131">err</span>&nbsp;<span class="op" id="7683135">:=</span>&nbsp;<span class="ident" id="7683138">readPng</span><span class="op" id="7683145">(</span><span class="ident" id="7683146">tc</span><span class="op" id="7683148">.</span><span class="ident" id="7683149">filename</span><span class="op" id="7683157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7683161">if</span>&nbsp;<span class="ident" id="7683164">err</span>&nbsp;<span class="op" id="7683168">!=</span>&nbsp;<span class="builtintype" id="7683171">nil</span>&nbsp;<span class="op" id="7683175">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7683180">t</span><span class="op" id="7683181">.</span><span class="ident" id="7683182">Error</span><span class="op" id="7683187">(</span><span class="ident" id="7683188">tc</span><span class="op" id="7683190">.</span><span class="ident" id="7683191">filename</span><span class="op" id="7683199">,</span>&nbsp;<span class="ident" id="7683201">err</span><span class="op" id="7683204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7683209">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7683220">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7683224">//&nbsp;Encode&nbsp;that&nbsp;image&nbsp;as&nbsp;JPEG.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7683256">var</span>&nbsp;<span class="ident" id="7683260">buf</span>&nbsp;<span class="ident" id="7683264">bytes</span><span class="op" id="7683269">.</span><span class="ident" id="7683270">Buffer</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7683279">err</span>&nbsp;<span class="op" id="7683283">=</span>&nbsp;<span class="ident" id="7683285">Encode</span><span class="op" id="7683291">(</span><span class="op" id="7683292">&amp;</span><span class="ident" id="7683293">buf</span><span class="op" id="7683296">,</span>&nbsp;<span class="ident" id="7683298">m0</span><span class="op" id="7683300">,</span>&nbsp;<span class="op" id="7683302">&amp;</span><span class="ident" id="7683303">Options</span><span class="op" id="7683310">{</span><span class="ident" id="7683311">Quality</span><span class="op" id="7683318">:</span>&nbsp;<span class="ident" id="7683320">tc</span><span class="op" id="7683322">.</span><span class="ident" id="7683323">quality</span><span class="op" id="7683330">}</span><span class="op" id="7683331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7683335">if</span>&nbsp;<span class="ident" id="7683338">err</span>&nbsp;<span class="op" id="7683342">!=</span>&nbsp;<span class="builtintype" id="7683345">nil</span>&nbsp;<span class="op" id="7683349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7683354">t</span><span class="op" id="7683355">.</span><span class="ident" id="7683356">Error</span><span class="op" id="7683361">(</span><span class="ident" id="7683362">tc</span><span class="op" id="7683364">.</span><span class="ident" id="7683365">filename</span><span class="op" id="7683373">,</span>&nbsp;<span class="ident" id="7683375">err</span><span class="op" id="7683378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7683383">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7683394">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7683398">//&nbsp;Decode&nbsp;that&nbsp;JPEG.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7683421">m1</span><span class="op" id="7683423">,</span>&nbsp;<span class="ident" id="7683425">err</span>&nbsp;<span class="op" id="7683429">:=</span>&nbsp;<span class="ident" id="7683432">Decode</span><span class="op" id="7683438">(</span><span class="op" id="7683439">&amp;</span><span class="ident" id="7683440">buf</span><span class="op" id="7683443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7683447">if</span>&nbsp;<span class="ident" id="7683450">err</span>&nbsp;<span class="op" id="7683454">!=</span>&nbsp;<span class="builtintype" id="7683457">nil</span>&nbsp;<span class="op" id="7683461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7683466">t</span><span class="op" id="7683467">.</span><span class="ident" id="7683468">Error</span><span class="op" id="7683473">(</span><span class="ident" id="7683474">tc</span><span class="op" id="7683476">.</span><span class="ident" id="7683477">filename</span><span class="op" id="7683485">,</span>&nbsp;<span class="ident" id="7683487">err</span><span class="op" id="7683490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7683495">continue</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7683506">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7683510">if</span>&nbsp;<span class="ident" id="7683513">m0</span><span class="op" id="7683515">.</span><span class="ident" id="7683516">Bounds</span><span class="op" id="7683522">(</span><span class="op" id="7683523">)</span>&nbsp;<span class="op" id="7683525">!=</span>&nbsp;<span class="ident" id="7683528">m1</span><span class="op" id="7683530">.</span><span class="ident" id="7683531">Bounds</span><span class="op" id="7683537">(</span><span class="op" id="7683538">)</span>&nbsp;<span class="op" id="7683540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7683545">t</span><span class="op" id="7683546">.</span><span class="ident" id="7683547">Errorf</span><span class="op" id="7683553">(</span><span class="string" id="7683554">&#34;%s,&nbsp;bounds&nbsp;differ:&nbsp;%v&nbsp;and&nbsp;%v&#34;</span><span class="op" id="7683584">,</span>&nbsp;<span class="ident" id="7683586">tc</span><span class="op" id="7683588">.</span><span class="ident" id="7683589">filename</span><span class="op" id="7683597">,</span>&nbsp;<span class="ident" id="7683599">m0</span><span class="op" id="7683601">.</span><span class="ident" id="7683602">Bounds</span><span class="op" id="7683608">(</span><span class="op" id="7683609">)</span><span class="op" id="7683610">,</span>&nbsp;<span class="ident" id="7683612">m1</span><span class="op" id="7683614">.</span><span class="ident" id="7683615">Bounds</span><span class="op" id="7683621">(</span><span class="op" id="7683622">)</span><span class="op" id="7683623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7683628">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7683639">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7683643">//&nbsp;Compare&nbsp;the&nbsp;average&nbsp;delta&nbsp;to&nbsp;the&nbsp;tolerance&nbsp;level.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7683698">if</span>&nbsp;<span class="ident" id="7683701">averageDelta</span><span class="op" id="7683713">(</span><span class="ident" id="7683714">m0</span><span class="op" id="7683716">,</span>&nbsp;<span class="ident" id="7683718">m1</span><span class="op" id="7683720">)</span>&nbsp;<span class="op" id="7683722">&gt;</span>&nbsp;<span class="ident" id="7683724">tc</span><span class="op" id="7683726">.</span><span class="ident" id="7683727">tolerance</span>&nbsp;<span class="op" id="7683737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7683742">t</span><span class="op" id="7683743">.</span><span class="ident" id="7683744">Errorf</span><span class="op" id="7683750">(</span><span class="string" id="7683751">&#34;%s,&nbsp;quality=%d:&nbsp;average&nbsp;delta&nbsp;is&nbsp;too&nbsp;high&#34;</span><span class="op" id="7683794">,</span>&nbsp;<span class="ident" id="7683796">tc</span><span class="op" id="7683798">.</span><span class="ident" id="7683799">filename</span><span class="op" id="7683807">,</span>&nbsp;<span class="ident" id="7683809">tc</span><span class="op" id="7683811">.</span><span class="ident" id="7683812">quality</span><span class="op" id="7683819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7683824">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7683835">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7683838">}</span><br>
<span class="lineno"></span><span class="op" id="7683840">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7683843">//&nbsp;TestWriteGrayscale&nbsp;tests&nbsp;that&nbsp;a&nbsp;grayscale&nbsp;images&nbsp;survives&nbsp;a&nbsp;round-trip</span><br>
<span class="lineno"></span><span class="comment" id="7683917">//&nbsp;through&nbsp;encode/decode&nbsp;cycle.</span><br>
<span class="lineno">165</span><span class="keyword" id="7683949">func</span>&nbsp;<span class="ident" id="7683954">TestWriteGrayscale</span><span class="op" id="7683972">(</span><span class="ident" id="7683973">t</span>&nbsp;<span class="op" id="7683975">*</span><span class="ident" id="7683976">testing</span><span class="op" id="7683983">.</span><span class="ident" id="7683984">T</span><span class="op" id="7683985">)</span>&nbsp;<span class="op" id="7683987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7683990">m0</span>&nbsp;<span class="op" id="7683993">:=</span>&nbsp;<span class="ident" id="7683996">image</span><span class="op" id="7684001">.</span><span class="ident" id="7684002">NewGray</span><span class="op" id="7684009">(</span><span class="ident" id="7684010">image</span><span class="op" id="7684015">.</span><span class="ident" id="7684016">Rect</span><span class="op" id="7684020">(</span><span class="num" id="7684021">0</span><span class="op" id="7684022">,</span>&nbsp;<span class="num" id="7684024">0</span><span class="op" id="7684025">,</span>&nbsp;<span class="num" id="7684027">32</span><span class="op" id="7684029">,</span>&nbsp;<span class="num" id="7684031">32</span><span class="op" id="7684033">)</span><span class="op" id="7684034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7684037">for</span>&nbsp;<span class="ident" id="7684041">i</span>&nbsp;<span class="op" id="7684043">:=</span>&nbsp;<span class="keyword" id="7684046">range</span>&nbsp;<span class="ident" id="7684052">m0</span><span class="op" id="7684054">.</span><span class="ident" id="7684055">Pix</span>&nbsp;<span class="op" id="7684059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7684063">m0</span><span class="op" id="7684065">.</span><span class="ident" id="7684066">Pix</span><span class="op" id="7684069">[</span><span class="ident" id="7684070">i</span><span class="op" id="7684071">]</span>&nbsp;<span class="op" id="7684073">=</span>&nbsp;<span class="builtintype" id="7684075">uint8</span><span class="op" id="7684080">(</span><span class="ident" id="7684081">i</span><span class="op" id="7684082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7684085">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7684088">var</span>&nbsp;<span class="ident" id="7684092">buf</span>&nbsp;<span class="ident" id="7684096">bytes</span><span class="op" id="7684101">.</span><span class="ident" id="7684102">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7684110">if</span>&nbsp;<span class="ident" id="7684113">err</span>&nbsp;<span class="op" id="7684117">:=</span>&nbsp;<span class="ident" id="7684120">Encode</span><span class="op" id="7684126">(</span><span class="op" id="7684127">&amp;</span><span class="ident" id="7684128">buf</span><span class="op" id="7684131">,</span>&nbsp;<span class="ident" id="7684133">m0</span><span class="op" id="7684135">,</span>&nbsp;<span class="builtintype" id="7684137">nil</span><span class="op" id="7684140">)</span><span class="op" id="7684141">;</span>&nbsp;<span class="ident" id="7684143">err</span>&nbsp;<span class="op" id="7684147">!=</span>&nbsp;<span class="builtintype" id="7684150">nil</span>&nbsp;<span class="op" id="7684154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7684158">t</span><span class="op" id="7684159">.</span><span class="ident" id="7684160">Fatal</span><span class="op" id="7684165">(</span><span class="ident" id="7684166">err</span><span class="op" id="7684169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7684172">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7684175">m1</span><span class="op" id="7684177">,</span>&nbsp;<span class="ident" id="7684179">err</span>&nbsp;<span class="op" id="7684183">:=</span>&nbsp;<span class="ident" id="7684186">Decode</span><span class="op" id="7684192">(</span><span class="op" id="7684193">&amp;</span><span class="ident" id="7684194">buf</span><span class="op" id="7684197">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7684200">if</span>&nbsp;<span class="ident" id="7684203">err</span>&nbsp;<span class="op" id="7684207">!=</span>&nbsp;<span class="builtintype" id="7684210">nil</span>&nbsp;<span class="op" id="7684214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7684218">t</span><span class="op" id="7684219">.</span><span class="ident" id="7684220">Fatal</span><span class="op" id="7684225">(</span><span class="ident" id="7684226">err</span><span class="op" id="7684229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7684232">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7684235">if</span>&nbsp;<span class="ident" id="7684238">m0</span><span class="op" id="7684240">.</span><span class="ident" id="7684241">Bounds</span><span class="op" id="7684247">(</span><span class="op" id="7684248">)</span>&nbsp;<span class="op" id="7684250">!=</span>&nbsp;<span class="ident" id="7684253">m1</span><span class="op" id="7684255">.</span><span class="ident" id="7684256">Bounds</span><span class="op" id="7684262">(</span><span class="op" id="7684263">)</span>&nbsp;<span class="op" id="7684265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7684269">t</span><span class="op" id="7684270">.</span><span class="ident" id="7684271">Fatalf</span><span class="op" id="7684277">(</span><span class="string" id="7684278">&#34;bounds&nbsp;differ:&nbsp;%v&nbsp;and&nbsp;%v&#34;</span><span class="op" id="7684304">,</span>&nbsp;<span class="ident" id="7684306">m0</span><span class="op" id="7684308">.</span><span class="ident" id="7684309">Bounds</span><span class="op" id="7684315">(</span><span class="op" id="7684316">)</span><span class="op" id="7684317">,</span>&nbsp;<span class="ident" id="7684319">m1</span><span class="op" id="7684321">.</span><span class="ident" id="7684322">Bounds</span><span class="op" id="7684328">(</span><span class="op" id="7684329">)</span><span class="op" id="7684330">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7684333">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7684336">if</span>&nbsp;<span class="ident" id="7684339">_</span><span class="op" id="7684340">,</span>&nbsp;<span class="ident" id="7684342">ok</span>&nbsp;<span class="op" id="7684345">:=</span>&nbsp;<span class="ident" id="7684348">m1</span><span class="op" id="7684350">.</span><span class="op" id="7684351">(</span><span class="op" id="7684352">*</span><span class="ident" id="7684353">image</span><span class="op" id="7684358">.</span><span class="ident" id="7684359">Gray</span><span class="op" id="7684363">)</span><span class="op" id="7684364">;</span>&nbsp;<span class="op" id="7684366">!</span><span class="ident" id="7684367">ok</span>&nbsp;<span class="op" id="7684370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7684374">t</span><span class="op" id="7684375">.</span><span class="ident" id="7684376">Errorf</span><span class="op" id="7684382">(</span><span class="string" id="7684383">&#34;got&nbsp;%T,&nbsp;want&nbsp;*image.Gray&#34;</span><span class="op" id="7684409">,</span>&nbsp;<span class="ident" id="7684411">m1</span><span class="op" id="7684413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7684416">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7684419">//&nbsp;Compare&nbsp;the&nbsp;average&nbsp;delta&nbsp;to&nbsp;the&nbsp;tolerance&nbsp;level.</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7684473">want</span>&nbsp;<span class="op" id="7684478">:=</span>&nbsp;<span class="ident" id="7684481">int64</span><span class="op" id="7684486">(</span><span class="num" id="7684487">2</span>&nbsp;<span class="op" id="7684489">&lt;&lt;</span>&nbsp;<span class="num" id="7684492">8</span><span class="op" id="7684493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7684496">if</span>&nbsp;<span class="ident" id="7684499">got</span>&nbsp;<span class="op" id="7684503">:=</span>&nbsp;<span class="ident" id="7684506">averageDelta</span><span class="op" id="7684518">(</span><span class="ident" id="7684519">m0</span><span class="op" id="7684521">,</span>&nbsp;<span class="ident" id="7684523">m1</span><span class="op" id="7684525">)</span><span class="op" id="7684526">;</span>&nbsp;<span class="ident" id="7684528">got</span>&nbsp;<span class="op" id="7684532">&gt;</span>&nbsp;<span class="ident" id="7684534">want</span>&nbsp;<span class="op" id="7684539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7684543">t</span><span class="op" id="7684544">.</span><span class="ident" id="7684545">Errorf</span><span class="op" id="7684551">(</span><span class="string" id="7684552">&#34;average&nbsp;delta&nbsp;too&nbsp;high;&nbsp;got&nbsp;%d,&nbsp;want&nbsp;&lt;=&nbsp;%d&#34;</span><span class="op" id="7684596">,</span>&nbsp;<span class="ident" id="7684598">got</span><span class="op" id="7684601">,</span>&nbsp;<span class="ident" id="7684603">want</span><span class="op" id="7684607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7684610">}</span><br>
<span class="lineno"></span><span class="op" id="7684612">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="comment" id="7684615">//&nbsp;averageDelta&nbsp;returns&nbsp;the&nbsp;average&nbsp;delta&nbsp;in&nbsp;RGB&nbsp;space.&nbsp;The&nbsp;two&nbsp;images&nbsp;must</span><br>
<span class="lineno"></span><span class="comment" id="7684691">//&nbsp;have&nbsp;the&nbsp;same&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="7684716">func</span>&nbsp;<span class="ident" id="7684721">averageDelta</span><span class="op" id="7684733">(</span><span class="ident" id="7684734">m0</span><span class="op" id="7684736">,</span>&nbsp;<span class="ident" id="7684738">m1</span>&nbsp;<span class="ident" id="7684741">image</span><span class="op" id="7684746">.</span><span class="ident" id="7684747">Image</span><span class="op" id="7684752">)</span>&nbsp;<span class="ident" id="7684754">int64</span>&nbsp;<span class="op" id="7684760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7684763">b</span>&nbsp;<span class="op" id="7684765">:=</span>&nbsp;<span class="ident" id="7684768">m0</span><span class="op" id="7684770">.</span><span class="ident" id="7684771">Bounds</span><span class="op" id="7684777">(</span><span class="op" id="7684778">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7684781">var</span>&nbsp;<span class="ident" id="7684785">sum</span><span class="op" id="7684788">,</span>&nbsp;<span class="ident" id="7684790">n</span>&nbsp;<span class="ident" id="7684792">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7684799">for</span>&nbsp;<span class="ident" id="7684803">y</span>&nbsp;<span class="op" id="7684805">:=</span>&nbsp;<span class="ident" id="7684808">b</span><span class="op" id="7684809">.</span><span class="ident" id="7684810">Min</span><span class="op" id="7684813">.</span><span class="ident" id="7684814">Y</span><span class="op" id="7684815">;</span>&nbsp;<span class="ident" id="7684817">y</span>&nbsp;<span class="op" id="7684819">&lt;</span>&nbsp;<span class="ident" id="7684821">b</span><span class="op" id="7684822">.</span><span class="ident" id="7684823">Max</span><span class="op" id="7684826">.</span><span class="ident" id="7684827">Y</span><span class="op" id="7684828">;</span>&nbsp;<span class="ident" id="7684830">y</span><span class="op" id="7684831">++</span>&nbsp;<span class="op" id="7684834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7684838">for</span>&nbsp;<span class="ident" id="7684842">x</span>&nbsp;<span class="op" id="7684844">:=</span>&nbsp;<span class="ident" id="7684847">b</span><span class="op" id="7684848">.</span><span class="ident" id="7684849">Min</span><span class="op" id="7684852">.</span><span class="ident" id="7684853">X</span><span class="op" id="7684854">;</span>&nbsp;<span class="ident" id="7684856">x</span>&nbsp;<span class="op" id="7684858">&lt;</span>&nbsp;<span class="ident" id="7684860">b</span><span class="op" id="7684861">.</span><span class="ident" id="7684862">Max</span><span class="op" id="7684865">.</span><span class="ident" id="7684866">X</span><span class="op" id="7684867">;</span>&nbsp;<span class="ident" id="7684869">x</span><span class="op" id="7684870">++</span>&nbsp;<span class="op" id="7684873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7684878">c0</span>&nbsp;<span class="op" id="7684881">:=</span>&nbsp;<span class="ident" id="7684884">m0</span><span class="op" id="7684886">.</span><span class="ident" id="7684887">At</span><span class="op" id="7684889">(</span><span class="ident" id="7684890">x</span><span class="op" id="7684891">,</span>&nbsp;<span class="ident" id="7684893">y</span><span class="op" id="7684894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7684899">c1</span>&nbsp;<span class="op" id="7684902">:=</span>&nbsp;<span class="ident" id="7684905">m1</span><span class="op" id="7684907">.</span><span class="ident" id="7684908">At</span><span class="op" id="7684910">(</span><span class="ident" id="7684911">x</span><span class="op" id="7684912">,</span>&nbsp;<span class="ident" id="7684914">y</span><span class="op" id="7684915">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7684920">r0</span><span class="op" id="7684922">,</span>&nbsp;<span class="ident" id="7684924">g0</span><span class="op" id="7684926">,</span>&nbsp;<span class="ident" id="7684928">b0</span><span class="op" id="7684930">,</span>&nbsp;<span class="ident" id="7684932">_</span>&nbsp;<span class="op" id="7684934">:=</span>&nbsp;<span class="ident" id="7684937">c0</span><span class="op" id="7684939">.</span><span class="ident" id="7684940">RGBA</span><span class="op" id="7684944">(</span><span class="op" id="7684945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7684950">r1</span><span class="op" id="7684952">,</span>&nbsp;<span class="ident" id="7684954">g1</span><span class="op" id="7684956">,</span>&nbsp;<span class="ident" id="7684958">b1</span><span class="op" id="7684960">,</span>&nbsp;<span class="ident" id="7684962">_</span>&nbsp;<span class="op" id="7684964">:=</span>&nbsp;<span class="ident" id="7684967">c1</span><span class="op" id="7684969">.</span><span class="ident" id="7684970">RGBA</span><span class="op" id="7684974">(</span><span class="op" id="7684975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7684980">sum</span>&nbsp;<span class="op" id="7684984">+=</span>&nbsp;<span class="ident" id="7684987">delta</span><span class="op" id="7684992">(</span><span class="ident" id="7684993">r0</span><span class="op" id="7684995">,</span>&nbsp;<span class="ident" id="7684997">r1</span><span class="op" id="7684999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7685004">sum</span>&nbsp;<span class="op" id="7685008">+=</span>&nbsp;<span class="ident" id="7685011">delta</span><span class="op" id="7685016">(</span><span class="ident" id="7685017">g0</span><span class="op" id="7685019">,</span>&nbsp;<span class="ident" id="7685021">g1</span><span class="op" id="7685023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7685028">sum</span>&nbsp;<span class="op" id="7685032">+=</span>&nbsp;<span class="ident" id="7685035">delta</span><span class="op" id="7685040">(</span><span class="ident" id="7685041">b0</span><span class="op" id="7685043">,</span>&nbsp;<span class="ident" id="7685045">b1</span><span class="op" id="7685047">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7685052">n</span>&nbsp;<span class="op" id="7685054">+=</span>&nbsp;<span class="num" id="7685057">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7685061">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7685064">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7685067">return</span>&nbsp;<span class="ident" id="7685074">sum</span>&nbsp;<span class="op" id="7685078">/</span>&nbsp;<span class="ident" id="7685080">n</span><br>
<span class="lineno"></span><span class="op" id="7685082">}</span><br>
<span class="lineno">210</span><br>
<span class="lineno"></span><span class="keyword" id="7685085">func</span>&nbsp;<span class="ident" id="7685090">BenchmarkEncode</span><span class="op" id="7685105">(</span><span class="ident" id="7685106">b</span>&nbsp;<span class="op" id="7685108">*</span><span class="ident" id="7685109">testing</span><span class="op" id="7685116">.</span><span class="ident" id="7685117">B</span><span class="op" id="7685118">)</span>&nbsp;<span class="op" id="7685120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7685123">b</span><span class="op" id="7685124">.</span><span class="ident" id="7685125">StopTimer</span><span class="op" id="7685134">(</span><span class="op" id="7685135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7685138">img</span>&nbsp;<span class="op" id="7685142">:=</span>&nbsp;<span class="ident" id="7685145">image</span><span class="op" id="7685150">.</span><span class="ident" id="7685151">NewRGBA</span><span class="op" id="7685158">(</span><span class="ident" id="7685159">image</span><span class="op" id="7685164">.</span><span class="ident" id="7685165">Rect</span><span class="op" id="7685169">(</span><span class="num" id="7685170">0</span><span class="op" id="7685171">,</span>&nbsp;<span class="num" id="7685173">0</span><span class="op" id="7685174">,</span>&nbsp;<span class="num" id="7685176">640</span><span class="op" id="7685179">,</span>&nbsp;<span class="num" id="7685181">480</span><span class="op" id="7685184">)</span><span class="op" id="7685185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7685188">bo</span>&nbsp;<span class="op" id="7685191">:=</span>&nbsp;<span class="ident" id="7685194">img</span><span class="op" id="7685197">.</span><span class="ident" id="7685198">Bounds</span><span class="op" id="7685204">(</span><span class="op" id="7685205">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7685208">rnd</span>&nbsp;<span class="op" id="7685212">:=</span>&nbsp;<span class="ident" id="7685215">rand</span><span class="op" id="7685219">.</span><span class="ident" id="7685220">New</span><span class="op" id="7685223">(</span><span class="ident" id="7685224">rand</span><span class="op" id="7685228">.</span><span class="ident" id="7685229">NewSource</span><span class="op" id="7685238">(</span><span class="num" id="7685239">123</span><span class="op" id="7685242">)</span><span class="op" id="7685243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7685246">for</span>&nbsp;<span class="ident" id="7685250">y</span>&nbsp;<span class="op" id="7685252">:=</span>&nbsp;<span class="ident" id="7685255">bo</span><span class="op" id="7685257">.</span><span class="ident" id="7685258">Min</span><span class="op" id="7685261">.</span><span class="ident" id="7685262">Y</span><span class="op" id="7685263">;</span>&nbsp;<span class="ident" id="7685265">y</span>&nbsp;<span class="op" id="7685267">&lt;</span>&nbsp;<span class="ident" id="7685269">bo</span><span class="op" id="7685271">.</span><span class="ident" id="7685272">Max</span><span class="op" id="7685275">.</span><span class="ident" id="7685276">Y</span><span class="op" id="7685277">;</span>&nbsp;<span class="ident" id="7685279">y</span><span class="op" id="7685280">++</span>&nbsp;<span class="op" id="7685283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7685287">for</span>&nbsp;<span class="ident" id="7685291">x</span>&nbsp;<span class="op" id="7685293">:=</span>&nbsp;<span class="ident" id="7685296">bo</span><span class="op" id="7685298">.</span><span class="ident" id="7685299">Min</span><span class="op" id="7685302">.</span><span class="ident" id="7685303">X</span><span class="op" id="7685304">;</span>&nbsp;<span class="ident" id="7685306">x</span>&nbsp;<span class="op" id="7685308">&lt;</span>&nbsp;<span class="ident" id="7685310">bo</span><span class="op" id="7685312">.</span><span class="ident" id="7685313">Max</span><span class="op" id="7685316">.</span><span class="ident" id="7685317">X</span><span class="op" id="7685318">;</span>&nbsp;<span class="ident" id="7685320">x</span><span class="op" id="7685321">++</span>&nbsp;<span class="op" id="7685324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7685329">img</span><span class="op" id="7685332">.</span><span class="ident" id="7685333">SetRGBA</span><span class="op" id="7685340">(</span><span class="ident" id="7685341">x</span><span class="op" id="7685342">,</span>&nbsp;<span class="ident" id="7685344">y</span><span class="op" id="7685345">,</span>&nbsp;<span class="ident" id="7685347">color</span><span class="op" id="7685352">.</span><span class="ident" id="7685353">RGBA</span><span class="op" id="7685357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7685363">uint8</span><span class="op" id="7685368">(</span><span class="ident" id="7685369">rnd</span><span class="op" id="7685372">.</span><span class="ident" id="7685373">Intn</span><span class="op" id="7685377">(</span><span class="num" id="7685378">256</span><span class="op" id="7685381">)</span><span class="op" id="7685382">)</span><span class="op" id="7685383">,</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7685389">uint8</span><span class="op" id="7685394">(</span><span class="ident" id="7685395">rnd</span><span class="op" id="7685398">.</span><span class="ident" id="7685399">Intn</span><span class="op" id="7685403">(</span><span class="num" id="7685404">256</span><span class="op" id="7685407">)</span><span class="op" id="7685408">)</span><span class="op" id="7685409">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7685415">uint8</span><span class="op" id="7685420">(</span><span class="ident" id="7685421">rnd</span><span class="op" id="7685424">.</span><span class="ident" id="7685425">Intn</span><span class="op" id="7685429">(</span><span class="num" id="7685430">256</span><span class="op" id="7685433">)</span><span class="op" id="7685434">)</span><span class="op" id="7685435">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7685441">255</span><span class="op" id="7685444">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7685449">}</span><span class="op" id="7685450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7685454">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7685457">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7685460">b</span><span class="op" id="7685461">.</span><span class="ident" id="7685462">SetBytes</span><span class="op" id="7685470">(</span><span class="num" id="7685471">640</span>&nbsp;<span class="op" id="7685475">*</span>&nbsp;<span class="num" id="7685477">480</span>&nbsp;<span class="op" id="7685481">*</span>&nbsp;<span class="num" id="7685483">4</span><span class="op" id="7685484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7685487">b</span><span class="op" id="7685488">.</span><span class="ident" id="7685489">StartTimer</span><span class="op" id="7685499">(</span><span class="op" id="7685500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7685503">options</span>&nbsp;<span class="op" id="7685511">:=</span>&nbsp;<span class="op" id="7685514">&amp;</span><span class="ident" id="7685515">Options</span><span class="op" id="7685522">{</span><span class="ident" id="7685523">Quality</span><span class="op" id="7685530">:</span>&nbsp;<span class="num" id="7685532">90</span><span class="op" id="7685534">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7685537">for</span>&nbsp;<span class="ident" id="7685541">i</span>&nbsp;<span class="op" id="7685543">:=</span>&nbsp;<span class="num" id="7685546">0</span><span class="op" id="7685547">;</span>&nbsp;<span class="ident" id="7685549">i</span>&nbsp;<span class="op" id="7685551">&lt;</span>&nbsp;<span class="ident" id="7685553">b</span><span class="op" id="7685554">.</span><span class="ident" id="7685555">N</span><span class="op" id="7685556">;</span>&nbsp;<span class="ident" id="7685558">i</span><span class="op" id="7685559">++</span>&nbsp;<span class="op" id="7685562">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7685566">Encode</span><span class="op" id="7685572">(</span><span class="ident" id="7685573">ioutil</span><span class="op" id="7685579">.</span><span class="ident" id="7685580">Discard</span><span class="op" id="7685587">,</span>&nbsp;<span class="ident" id="7685589">img</span><span class="op" id="7685592">,</span>&nbsp;<span class="ident" id="7685594">options</span><span class="op" id="7685601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7685604">}</span><br>
<span class="lineno"></span><span class="op" id="7685606">}</span>
</div>
</body>
</html>
