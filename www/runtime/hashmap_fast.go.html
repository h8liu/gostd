<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="1549703">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1549758">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1549812">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1549863">package</span>&nbsp;<span class="ident" id="1549871">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1549880">import</span>&nbsp;<span class="op" id="1549887">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1549890">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="1549899">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="1549902">func</span>&nbsp;<span class="ident" id="1549907">mapaccess1_fast32</span><span class="op" id="1549924">(</span><span class="ident" id="1549925">t</span>&nbsp;<span class="op" id="1549927">*</span><span class="ident" id="1549928">maptype</span><span class="op" id="1549935">,</span>&nbsp;<span class="ident" id="1549937">h</span>&nbsp;<span class="op" id="1549939">*</span><span class="ident" id="1549940">hmap</span><span class="op" id="1549944">,</span>&nbsp;<span class="ident" id="1549946">key</span>&nbsp;<span class="builtintype" id="1549950">uint32</span><span class="op" id="1549956">)</span>&nbsp;<span class="ident" id="1549958">unsafe</span><span class="op" id="1549964">.</span><span class="ident" id="1549965">Pointer</span>&nbsp;<span class="op" id="1549973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1549976">if</span>&nbsp;<span class="ident" id="1549979">raceenabled</span>&nbsp;<span class="op" id="1549991">&amp;&amp;</span>&nbsp;<span class="ident" id="1549994">h</span>&nbsp;<span class="op" id="1549996">!=</span>&nbsp;<span class="ident" id="1549999">nil</span>&nbsp;<span class="op" id="1550003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1550007">callerpc</span>&nbsp;<span class="op" id="1550016">:=</span>&nbsp;<span class="ident" id="1550019">getcallerpc</span><span class="op" id="1550030">(</span><span class="ident" id="1550031">unsafe</span><span class="op" id="1550037">.</span><span class="ident" id="1550038">Pointer</span><span class="op" id="1550045">(</span><span class="op" id="1550046">&amp;</span><span class="ident" id="1550047">t</span><span class="op" id="1550048">)</span><span class="op" id="1550049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1550053">racereadpc</span><span class="op" id="1550063">(</span><span class="ident" id="1550064">unsafe</span><span class="op" id="1550070">.</span><span class="ident" id="1550071">Pointer</span><span class="op" id="1550078">(</span><span class="ident" id="1550079">h</span><span class="op" id="1550080">)</span><span class="op" id="1550081">,</span>&nbsp;<span class="ident" id="1550083">callerpc</span><span class="op" id="1550091">,</span>&nbsp;<span class="ident" id="1550093">funcPC</span><span class="op" id="1550099">(</span><span class="ident" id="1550100">mapaccess1_fast32</span><span class="op" id="1550117">)</span><span class="op" id="1550118">)</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1550121">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1550124">if</span>&nbsp;<span class="ident" id="1550127">h</span>&nbsp;<span class="op" id="1550129">==</span>&nbsp;<span class="ident" id="1550132">nil</span>&nbsp;<span class="op" id="1550136">||</span>&nbsp;<span class="ident" id="1550139">h</span><span class="op" id="1550140">.</span><span class="ident" id="1550141">count</span>&nbsp;<span class="op" id="1550147">==</span>&nbsp;<span class="num" id="1550150">0</span>&nbsp;<span class="op" id="1550152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1550156">return</span>&nbsp;<span class="ident" id="1550163">unsafe</span><span class="op" id="1550169">.</span><span class="ident" id="1550170">Pointer</span><span class="op" id="1550177">(</span><span class="ident" id="1550178">t</span><span class="op" id="1550179">.</span><span class="ident" id="1550180">elem</span><span class="op" id="1550184">.</span><span class="ident" id="1550185">zero</span><span class="op" id="1550189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1550192">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1550195">var</span>&nbsp;<span class="ident" id="1550199">b</span>&nbsp;<span class="op" id="1550201">*</span><span class="ident" id="1550202">bmap</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1550208">if</span>&nbsp;<span class="ident" id="1550211">h</span><span class="op" id="1550212">.</span><span class="ident" id="1550213">B</span>&nbsp;<span class="op" id="1550215">==</span>&nbsp;<span class="num" id="1550218">0</span>&nbsp;<span class="op" id="1550220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1550224">//&nbsp;One-bucket&nbsp;table.&nbsp;&nbsp;No&nbsp;need&nbsp;to&nbsp;hash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1550265">b</span>&nbsp;<span class="op" id="1550267">=</span>&nbsp;<span class="op" id="1550269">(</span><span class="op" id="1550270">*</span><span class="ident" id="1550271">bmap</span><span class="op" id="1550275">)</span><span class="op" id="1550276">(</span><span class="ident" id="1550277">h</span><span class="op" id="1550278">.</span><span class="ident" id="1550279">buckets</span><span class="op" id="1550286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1550289">}</span>&nbsp;<span class="keyword" id="1550291">else</span>&nbsp;<span class="op" id="1550296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1550300">hash</span>&nbsp;<span class="op" id="1550305">:=</span>&nbsp;<span class="ident" id="1550308">goalg</span><span class="op" id="1550313">(</span><span class="ident" id="1550314">t</span><span class="op" id="1550315">.</span><span class="ident" id="1550316">key</span><span class="op" id="1550319">.</span><span class="ident" id="1550320">alg</span><span class="op" id="1550323">)</span><span class="op" id="1550324">.</span><span class="ident" id="1550325">hash</span><span class="op" id="1550329">(</span><span class="ident" id="1550330">noescape</span><span class="op" id="1550338">(</span><span class="ident" id="1550339">unsafe</span><span class="op" id="1550345">.</span><span class="ident" id="1550346">Pointer</span><span class="op" id="1550353">(</span><span class="op" id="1550354">&amp;</span><span class="ident" id="1550355">key</span><span class="op" id="1550358">)</span><span class="op" id="1550359">)</span><span class="op" id="1550360">,</span>&nbsp;<span class="num" id="1550362">4</span><span class="op" id="1550363">,</span>&nbsp;<span class="builtintype" id="1550365">uintptr</span><span class="op" id="1550372">(</span><span class="ident" id="1550373">h</span><span class="op" id="1550374">.</span><span class="ident" id="1550375">hash0</span><span class="op" id="1550380">)</span><span class="op" id="1550381">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1550385">m</span>&nbsp;<span class="op" id="1550387">:=</span>&nbsp;<span class="builtintype" id="1550390">uintptr</span><span class="op" id="1550397">(</span><span class="num" id="1550398">1</span><span class="op" id="1550399">)</span><span class="op" id="1550400">&lt;&lt;</span><span class="ident" id="1550402">h</span><span class="op" id="1550403">.</span><span class="ident" id="1550404">B</span>&nbsp;<span class="op" id="1550406">-</span>&nbsp;<span class="num" id="1550408">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1550412">b</span>&nbsp;<span class="op" id="1550414">=</span>&nbsp;<span class="op" id="1550416">(</span><span class="op" id="1550417">*</span><span class="ident" id="1550418">bmap</span><span class="op" id="1550422">)</span><span class="op" id="1550423">(</span><span class="ident" id="1550424">add</span><span class="op" id="1550427">(</span><span class="ident" id="1550428">h</span><span class="op" id="1550429">.</span><span class="ident" id="1550430">buckets</span><span class="op" id="1550437">,</span>&nbsp;<span class="op" id="1550439">(</span><span class="ident" id="1550440">hash</span><span class="op" id="1550444">&amp;</span><span class="ident" id="1550445">m</span><span class="op" id="1550446">)</span><span class="op" id="1550447">*</span><span class="builtintype" id="1550448">uintptr</span><span class="op" id="1550455">(</span><span class="ident" id="1550456">t</span><span class="op" id="1550457">.</span><span class="ident" id="1550458">bucketsize</span><span class="op" id="1550468">)</span><span class="op" id="1550469">)</span><span class="op" id="1550470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1550474">if</span>&nbsp;<span class="ident" id="1550477">c</span>&nbsp;<span class="op" id="1550479">:=</span>&nbsp;<span class="ident" id="1550482">h</span><span class="op" id="1550483">.</span><span class="ident" id="1550484">oldbuckets</span><span class="op" id="1550494">;</span>&nbsp;<span class="ident" id="1550496">c</span>&nbsp;<span class="op" id="1550498">!=</span>&nbsp;<span class="ident" id="1550501">nil</span>&nbsp;<span class="op" id="1550505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1550510">oldb</span>&nbsp;<span class="op" id="1550515">:=</span>&nbsp;<span class="op" id="1550518">(</span><span class="op" id="1550519">*</span><span class="ident" id="1550520">bmap</span><span class="op" id="1550524">)</span><span class="op" id="1550525">(</span><span class="ident" id="1550526">add</span><span class="op" id="1550529">(</span><span class="ident" id="1550530">c</span><span class="op" id="1550531">,</span>&nbsp;<span class="op" id="1550533">(</span><span class="ident" id="1550534">hash</span><span class="op" id="1550538">&amp;</span><span class="op" id="1550539">(</span><span class="ident" id="1550540">m</span><span class="op" id="1550541">&gt;&gt;</span><span class="num" id="1550543">1</span><span class="op" id="1550544">)</span><span class="op" id="1550545">)</span><span class="op" id="1550546">*</span><span class="builtintype" id="1550547">uintptr</span><span class="op" id="1550554">(</span><span class="ident" id="1550555">t</span><span class="op" id="1550556">.</span><span class="ident" id="1550557">bucketsize</span><span class="op" id="1550567">)</span><span class="op" id="1550568">)</span><span class="op" id="1550569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1550574">if</span>&nbsp;<span class="op" id="1550577">!</span><span class="ident" id="1550578">evacuated</span><span class="op" id="1550587">(</span><span class="ident" id="1550588">oldb</span><span class="op" id="1550592">)</span>&nbsp;<span class="op" id="1550594">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1550600">b</span>&nbsp;<span class="op" id="1550602">=</span>&nbsp;<span class="ident" id="1550604">oldb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1550612">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1550616">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1550619">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1550622">for</span>&nbsp;<span class="op" id="1550626">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1550630">for</span>&nbsp;<span class="ident" id="1550634">i</span>&nbsp;<span class="op" id="1550636">:=</span>&nbsp;<span class="builtintype" id="1550639">uintptr</span><span class="op" id="1550646">(</span><span class="num" id="1550647">0</span><span class="op" id="1550648">)</span><span class="op" id="1550649">;</span>&nbsp;<span class="ident" id="1550651">i</span>&nbsp;<span class="op" id="1550653">&lt;</span>&nbsp;<span class="ident" id="1550655">bucketCnt</span><span class="op" id="1550664">;</span>&nbsp;<span class="ident" id="1550666">i</span><span class="op" id="1550667">++</span>&nbsp;<span class="op" id="1550670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1550675">k</span>&nbsp;<span class="op" id="1550677">:=</span>&nbsp;<span class="op" id="1550680">*</span><span class="op" id="1550681">(</span><span class="op" id="1550682">(</span><span class="op" id="1550683">*</span><span class="builtintype" id="1550684">uint32</span><span class="op" id="1550690">)</span><span class="op" id="1550691">(</span><span class="ident" id="1550692">add</span><span class="op" id="1550695">(</span><span class="ident" id="1550696">unsafe</span><span class="op" id="1550702">.</span><span class="ident" id="1550703">Pointer</span><span class="op" id="1550710">(</span><span class="ident" id="1550711">b</span><span class="op" id="1550712">)</span><span class="op" id="1550713">,</span>&nbsp;<span class="ident" id="1550715">dataOffset</span><span class="op" id="1550725">+</span><span class="ident" id="1550726">i</span><span class="op" id="1550727">*</span><span class="num" id="1550728">4</span><span class="op" id="1550729">)</span><span class="op" id="1550730">)</span><span class="op" id="1550731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1550736">if</span>&nbsp;<span class="ident" id="1550739">k</span>&nbsp;<span class="op" id="1550741">!=</span>&nbsp;<span class="ident" id="1550744">key</span>&nbsp;<span class="op" id="1550748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1550754">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1550766">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1550771">x</span>&nbsp;<span class="op" id="1550773">:=</span>&nbsp;<span class="op" id="1550776">*</span><span class="op" id="1550777">(</span><span class="op" id="1550778">(</span><span class="op" id="1550779">*</span><span class="builtintype" id="1550780">uint8</span><span class="op" id="1550785">)</span><span class="op" id="1550786">(</span><span class="ident" id="1550787">add</span><span class="op" id="1550790">(</span><span class="ident" id="1550791">unsafe</span><span class="op" id="1550797">.</span><span class="ident" id="1550798">Pointer</span><span class="op" id="1550805">(</span><span class="ident" id="1550806">b</span><span class="op" id="1550807">)</span><span class="op" id="1550808">,</span>&nbsp;<span class="ident" id="1550810">i</span><span class="op" id="1550811">)</span><span class="op" id="1550812">)</span><span class="op" id="1550813">)</span>&nbsp;<span class="comment" id="1550815">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1550859">if</span>&nbsp;<span class="ident" id="1550862">x</span>&nbsp;<span class="op" id="1550864">==</span>&nbsp;<span class="ident" id="1550867">empty</span>&nbsp;<span class="op" id="1550873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1550879">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1550891">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1550896">return</span>&nbsp;<span class="ident" id="1550903">add</span><span class="op" id="1550906">(</span><span class="ident" id="1550907">unsafe</span><span class="op" id="1550913">.</span><span class="ident" id="1550914">Pointer</span><span class="op" id="1550921">(</span><span class="ident" id="1550922">b</span><span class="op" id="1550923">)</span><span class="op" id="1550924">,</span>&nbsp;<span class="ident" id="1550926">dataOffset</span><span class="op" id="1550936">+</span><span class="ident" id="1550937">bucketCnt</span><span class="op" id="1550946">*</span><span class="num" id="1550947">4</span><span class="op" id="1550948">+</span><span class="ident" id="1550949">i</span><span class="op" id="1550950">*</span><span class="builtintype" id="1550951">uintptr</span><span class="op" id="1550958">(</span><span class="ident" id="1550959">t</span><span class="op" id="1550960">.</span><span class="ident" id="1550961">valuesize</span><span class="op" id="1550970">)</span><span class="op" id="1550971">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1550975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1550979">b</span>&nbsp;<span class="op" id="1550981">=</span>&nbsp;<span class="ident" id="1550983">b</span><span class="op" id="1550984">.</span><span class="ident" id="1550985">overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1550996">if</span>&nbsp;<span class="ident" id="1550999">b</span>&nbsp;<span class="op" id="1551001">==</span>&nbsp;<span class="ident" id="1551004">nil</span>&nbsp;<span class="op" id="1551008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1551013">return</span>&nbsp;<span class="ident" id="1551020">unsafe</span><span class="op" id="1551026">.</span><span class="ident" id="1551027">Pointer</span><span class="op" id="1551034">(</span><span class="ident" id="1551035">t</span><span class="op" id="1551036">.</span><span class="ident" id="1551037">elem</span><span class="op" id="1551041">.</span><span class="ident" id="1551042">zero</span><span class="op" id="1551046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1551050">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1551053">}</span><br>
<span class="lineno"></span><span class="op" id="1551055">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1551058">func</span>&nbsp;<span class="ident" id="1551063">mapaccess2_fast32</span><span class="op" id="1551080">(</span><span class="ident" id="1551081">t</span>&nbsp;<span class="op" id="1551083">*</span><span class="ident" id="1551084">maptype</span><span class="op" id="1551091">,</span>&nbsp;<span class="ident" id="1551093">h</span>&nbsp;<span class="op" id="1551095">*</span><span class="ident" id="1551096">hmap</span><span class="op" id="1551100">,</span>&nbsp;<span class="ident" id="1551102">key</span>&nbsp;<span class="builtintype" id="1551106">uint32</span><span class="op" id="1551112">)</span>&nbsp;<span class="op" id="1551114">(</span><span class="ident" id="1551115">unsafe</span><span class="op" id="1551121">.</span><span class="ident" id="1551122">Pointer</span><span class="op" id="1551129">,</span>&nbsp;<span class="builtintype" id="1551131">bool</span><span class="op" id="1551135">)</span>&nbsp;<span class="op" id="1551137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1551140">if</span>&nbsp;<span class="ident" id="1551143">raceenabled</span>&nbsp;<span class="op" id="1551155">&amp;&amp;</span>&nbsp;<span class="ident" id="1551158">h</span>&nbsp;<span class="op" id="1551160">!=</span>&nbsp;<span class="ident" id="1551163">nil</span>&nbsp;<span class="op" id="1551167">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1551171">callerpc</span>&nbsp;<span class="op" id="1551180">:=</span>&nbsp;<span class="ident" id="1551183">getcallerpc</span><span class="op" id="1551194">(</span><span class="ident" id="1551195">unsafe</span><span class="op" id="1551201">.</span><span class="ident" id="1551202">Pointer</span><span class="op" id="1551209">(</span><span class="op" id="1551210">&amp;</span><span class="ident" id="1551211">t</span><span class="op" id="1551212">)</span><span class="op" id="1551213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1551217">racereadpc</span><span class="op" id="1551227">(</span><span class="ident" id="1551228">unsafe</span><span class="op" id="1551234">.</span><span class="ident" id="1551235">Pointer</span><span class="op" id="1551242">(</span><span class="ident" id="1551243">h</span><span class="op" id="1551244">)</span><span class="op" id="1551245">,</span>&nbsp;<span class="ident" id="1551247">callerpc</span><span class="op" id="1551255">,</span>&nbsp;<span class="ident" id="1551257">funcPC</span><span class="op" id="1551263">(</span><span class="ident" id="1551264">mapaccess2_fast32</span><span class="op" id="1551281">)</span><span class="op" id="1551282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1551285">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1551288">if</span>&nbsp;<span class="ident" id="1551291">h</span>&nbsp;<span class="op" id="1551293">==</span>&nbsp;<span class="ident" id="1551296">nil</span>&nbsp;<span class="op" id="1551300">||</span>&nbsp;<span class="ident" id="1551303">h</span><span class="op" id="1551304">.</span><span class="ident" id="1551305">count</span>&nbsp;<span class="op" id="1551311">==</span>&nbsp;<span class="num" id="1551314">0</span>&nbsp;<span class="op" id="1551316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1551320">return</span>&nbsp;<span class="ident" id="1551327">unsafe</span><span class="op" id="1551333">.</span><span class="ident" id="1551334">Pointer</span><span class="op" id="1551341">(</span><span class="ident" id="1551342">t</span><span class="op" id="1551343">.</span><span class="ident" id="1551344">elem</span><span class="op" id="1551348">.</span><span class="ident" id="1551349">zero</span><span class="op" id="1551353">)</span><span class="op" id="1551354">,</span>&nbsp;<span class="ident" id="1551356">false</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1551363">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1551366">var</span>&nbsp;<span class="ident" id="1551370">b</span>&nbsp;<span class="op" id="1551372">*</span><span class="ident" id="1551373">bmap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1551379">if</span>&nbsp;<span class="ident" id="1551382">h</span><span class="op" id="1551383">.</span><span class="ident" id="1551384">B</span>&nbsp;<span class="op" id="1551386">==</span>&nbsp;<span class="num" id="1551389">0</span>&nbsp;<span class="op" id="1551391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1551395">//&nbsp;One-bucket&nbsp;table.&nbsp;&nbsp;No&nbsp;need&nbsp;to&nbsp;hash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1551436">b</span>&nbsp;<span class="op" id="1551438">=</span>&nbsp;<span class="op" id="1551440">(</span><span class="op" id="1551441">*</span><span class="ident" id="1551442">bmap</span><span class="op" id="1551446">)</span><span class="op" id="1551447">(</span><span class="ident" id="1551448">h</span><span class="op" id="1551449">.</span><span class="ident" id="1551450">buckets</span><span class="op" id="1551457">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1551460">}</span>&nbsp;<span class="keyword" id="1551462">else</span>&nbsp;<span class="op" id="1551467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1551471">hash</span>&nbsp;<span class="op" id="1551476">:=</span>&nbsp;<span class="ident" id="1551479">goalg</span><span class="op" id="1551484">(</span><span class="ident" id="1551485">t</span><span class="op" id="1551486">.</span><span class="ident" id="1551487">key</span><span class="op" id="1551490">.</span><span class="ident" id="1551491">alg</span><span class="op" id="1551494">)</span><span class="op" id="1551495">.</span><span class="ident" id="1551496">hash</span><span class="op" id="1551500">(</span><span class="ident" id="1551501">noescape</span><span class="op" id="1551509">(</span><span class="ident" id="1551510">unsafe</span><span class="op" id="1551516">.</span><span class="ident" id="1551517">Pointer</span><span class="op" id="1551524">(</span><span class="op" id="1551525">&amp;</span><span class="ident" id="1551526">key</span><span class="op" id="1551529">)</span><span class="op" id="1551530">)</span><span class="op" id="1551531">,</span>&nbsp;<span class="num" id="1551533">4</span><span class="op" id="1551534">,</span>&nbsp;<span class="builtintype" id="1551536">uintptr</span><span class="op" id="1551543">(</span><span class="ident" id="1551544">h</span><span class="op" id="1551545">.</span><span class="ident" id="1551546">hash0</span><span class="op" id="1551551">)</span><span class="op" id="1551552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1551556">m</span>&nbsp;<span class="op" id="1551558">:=</span>&nbsp;<span class="builtintype" id="1551561">uintptr</span><span class="op" id="1551568">(</span><span class="num" id="1551569">1</span><span class="op" id="1551570">)</span><span class="op" id="1551571">&lt;&lt;</span><span class="ident" id="1551573">h</span><span class="op" id="1551574">.</span><span class="ident" id="1551575">B</span>&nbsp;<span class="op" id="1551577">-</span>&nbsp;<span class="num" id="1551579">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1551583">b</span>&nbsp;<span class="op" id="1551585">=</span>&nbsp;<span class="op" id="1551587">(</span><span class="op" id="1551588">*</span><span class="ident" id="1551589">bmap</span><span class="op" id="1551593">)</span><span class="op" id="1551594">(</span><span class="ident" id="1551595">add</span><span class="op" id="1551598">(</span><span class="ident" id="1551599">h</span><span class="op" id="1551600">.</span><span class="ident" id="1551601">buckets</span><span class="op" id="1551608">,</span>&nbsp;<span class="op" id="1551610">(</span><span class="ident" id="1551611">hash</span><span class="op" id="1551615">&amp;</span><span class="ident" id="1551616">m</span><span class="op" id="1551617">)</span><span class="op" id="1551618">*</span><span class="builtintype" id="1551619">uintptr</span><span class="op" id="1551626">(</span><span class="ident" id="1551627">t</span><span class="op" id="1551628">.</span><span class="ident" id="1551629">bucketsize</span><span class="op" id="1551639">)</span><span class="op" id="1551640">)</span><span class="op" id="1551641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1551645">if</span>&nbsp;<span class="ident" id="1551648">c</span>&nbsp;<span class="op" id="1551650">:=</span>&nbsp;<span class="ident" id="1551653">h</span><span class="op" id="1551654">.</span><span class="ident" id="1551655">oldbuckets</span><span class="op" id="1551665">;</span>&nbsp;<span class="ident" id="1551667">c</span>&nbsp;<span class="op" id="1551669">!=</span>&nbsp;<span class="ident" id="1551672">nil</span>&nbsp;<span class="op" id="1551676">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1551681">oldb</span>&nbsp;<span class="op" id="1551686">:=</span>&nbsp;<span class="op" id="1551689">(</span><span class="op" id="1551690">*</span><span class="ident" id="1551691">bmap</span><span class="op" id="1551695">)</span><span class="op" id="1551696">(</span><span class="ident" id="1551697">add</span><span class="op" id="1551700">(</span><span class="ident" id="1551701">c</span><span class="op" id="1551702">,</span>&nbsp;<span class="op" id="1551704">(</span><span class="ident" id="1551705">hash</span><span class="op" id="1551709">&amp;</span><span class="op" id="1551710">(</span><span class="ident" id="1551711">m</span><span class="op" id="1551712">&gt;&gt;</span><span class="num" id="1551714">1</span><span class="op" id="1551715">)</span><span class="op" id="1551716">)</span><span class="op" id="1551717">*</span><span class="builtintype" id="1551718">uintptr</span><span class="op" id="1551725">(</span><span class="ident" id="1551726">t</span><span class="op" id="1551727">.</span><span class="ident" id="1551728">bucketsize</span><span class="op" id="1551738">)</span><span class="op" id="1551739">)</span><span class="op" id="1551740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1551745">if</span>&nbsp;<span class="op" id="1551748">!</span><span class="ident" id="1551749">evacuated</span><span class="op" id="1551758">(</span><span class="ident" id="1551759">oldb</span><span class="op" id="1551763">)</span>&nbsp;<span class="op" id="1551765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1551771">b</span>&nbsp;<span class="op" id="1551773">=</span>&nbsp;<span class="ident" id="1551775">oldb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1551783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1551787">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1551790">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1551793">for</span>&nbsp;<span class="op" id="1551797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1551801">for</span>&nbsp;<span class="ident" id="1551805">i</span>&nbsp;<span class="op" id="1551807">:=</span>&nbsp;<span class="builtintype" id="1551810">uintptr</span><span class="op" id="1551817">(</span><span class="num" id="1551818">0</span><span class="op" id="1551819">)</span><span class="op" id="1551820">;</span>&nbsp;<span class="ident" id="1551822">i</span>&nbsp;<span class="op" id="1551824">&lt;</span>&nbsp;<span class="ident" id="1551826">bucketCnt</span><span class="op" id="1551835">;</span>&nbsp;<span class="ident" id="1551837">i</span><span class="op" id="1551838">++</span>&nbsp;<span class="op" id="1551841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1551846">k</span>&nbsp;<span class="op" id="1551848">:=</span>&nbsp;<span class="op" id="1551851">*</span><span class="op" id="1551852">(</span><span class="op" id="1551853">(</span><span class="op" id="1551854">*</span><span class="builtintype" id="1551855">uint32</span><span class="op" id="1551861">)</span><span class="op" id="1551862">(</span><span class="ident" id="1551863">add</span><span class="op" id="1551866">(</span><span class="ident" id="1551867">unsafe</span><span class="op" id="1551873">.</span><span class="ident" id="1551874">Pointer</span><span class="op" id="1551881">(</span><span class="ident" id="1551882">b</span><span class="op" id="1551883">)</span><span class="op" id="1551884">,</span>&nbsp;<span class="ident" id="1551886">dataOffset</span><span class="op" id="1551896">+</span><span class="ident" id="1551897">i</span><span class="op" id="1551898">*</span><span class="num" id="1551899">4</span><span class="op" id="1551900">)</span><span class="op" id="1551901">)</span><span class="op" id="1551902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1551907">if</span>&nbsp;<span class="ident" id="1551910">k</span>&nbsp;<span class="op" id="1551912">!=</span>&nbsp;<span class="ident" id="1551915">key</span>&nbsp;<span class="op" id="1551919">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1551925">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1551937">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1551942">x</span>&nbsp;<span class="op" id="1551944">:=</span>&nbsp;<span class="op" id="1551947">*</span><span class="op" id="1551948">(</span><span class="op" id="1551949">(</span><span class="op" id="1551950">*</span><span class="builtintype" id="1551951">uint8</span><span class="op" id="1551956">)</span><span class="op" id="1551957">(</span><span class="ident" id="1551958">add</span><span class="op" id="1551961">(</span><span class="ident" id="1551962">unsafe</span><span class="op" id="1551968">.</span><span class="ident" id="1551969">Pointer</span><span class="op" id="1551976">(</span><span class="ident" id="1551977">b</span><span class="op" id="1551978">)</span><span class="op" id="1551979">,</span>&nbsp;<span class="ident" id="1551981">i</span><span class="op" id="1551982">)</span><span class="op" id="1551983">)</span><span class="op" id="1551984">)</span>&nbsp;<span class="comment" id="1551986">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1552030">if</span>&nbsp;<span class="ident" id="1552033">x</span>&nbsp;<span class="op" id="1552035">==</span>&nbsp;<span class="ident" id="1552038">empty</span>&nbsp;<span class="op" id="1552044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1552050">continue</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1552062">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1552067">return</span>&nbsp;<span class="ident" id="1552074">add</span><span class="op" id="1552077">(</span><span class="ident" id="1552078">unsafe</span><span class="op" id="1552084">.</span><span class="ident" id="1552085">Pointer</span><span class="op" id="1552092">(</span><span class="ident" id="1552093">b</span><span class="op" id="1552094">)</span><span class="op" id="1552095">,</span>&nbsp;<span class="ident" id="1552097">dataOffset</span><span class="op" id="1552107">+</span><span class="ident" id="1552108">bucketCnt</span><span class="op" id="1552117">*</span><span class="num" id="1552118">4</span><span class="op" id="1552119">+</span><span class="ident" id="1552120">i</span><span class="op" id="1552121">*</span><span class="builtintype" id="1552122">uintptr</span><span class="op" id="1552129">(</span><span class="ident" id="1552130">t</span><span class="op" id="1552131">.</span><span class="ident" id="1552132">valuesize</span><span class="op" id="1552141">)</span><span class="op" id="1552142">)</span><span class="op" id="1552143">,</span>&nbsp;<span class="ident" id="1552145">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1552152">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1552156">b</span>&nbsp;<span class="op" id="1552158">=</span>&nbsp;<span class="ident" id="1552160">b</span><span class="op" id="1552161">.</span><span class="ident" id="1552162">overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1552173">if</span>&nbsp;<span class="ident" id="1552176">b</span>&nbsp;<span class="op" id="1552178">==</span>&nbsp;<span class="ident" id="1552181">nil</span>&nbsp;<span class="op" id="1552185">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1552190">return</span>&nbsp;<span class="ident" id="1552197">unsafe</span><span class="op" id="1552203">.</span><span class="ident" id="1552204">Pointer</span><span class="op" id="1552211">(</span><span class="ident" id="1552212">t</span><span class="op" id="1552213">.</span><span class="ident" id="1552214">elem</span><span class="op" id="1552218">.</span><span class="ident" id="1552219">zero</span><span class="op" id="1552223">)</span><span class="op" id="1552224">,</span>&nbsp;<span class="ident" id="1552226">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1552234">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1552237">}</span><br>
<span class="lineno"></span><span class="op" id="1552239">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="1552242">func</span>&nbsp;<span class="ident" id="1552247">mapaccess1_fast64</span><span class="op" id="1552264">(</span><span class="ident" id="1552265">t</span>&nbsp;<span class="op" id="1552267">*</span><span class="ident" id="1552268">maptype</span><span class="op" id="1552275">,</span>&nbsp;<span class="ident" id="1552277">h</span>&nbsp;<span class="op" id="1552279">*</span><span class="ident" id="1552280">hmap</span><span class="op" id="1552284">,</span>&nbsp;<span class="ident" id="1552286">key</span>&nbsp;<span class="ident" id="1552290">uint64</span><span class="op" id="1552296">)</span>&nbsp;<span class="ident" id="1552298">unsafe</span><span class="op" id="1552304">.</span><span class="ident" id="1552305">Pointer</span>&nbsp;<span class="op" id="1552313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1552316">if</span>&nbsp;<span class="ident" id="1552319">raceenabled</span>&nbsp;<span class="op" id="1552331">&amp;&amp;</span>&nbsp;<span class="ident" id="1552334">h</span>&nbsp;<span class="op" id="1552336">!=</span>&nbsp;<span class="ident" id="1552339">nil</span>&nbsp;<span class="op" id="1552343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1552347">callerpc</span>&nbsp;<span class="op" id="1552356">:=</span>&nbsp;<span class="ident" id="1552359">getcallerpc</span><span class="op" id="1552370">(</span><span class="ident" id="1552371">unsafe</span><span class="op" id="1552377">.</span><span class="ident" id="1552378">Pointer</span><span class="op" id="1552385">(</span><span class="op" id="1552386">&amp;</span><span class="ident" id="1552387">t</span><span class="op" id="1552388">)</span><span class="op" id="1552389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1552393">racereadpc</span><span class="op" id="1552403">(</span><span class="ident" id="1552404">unsafe</span><span class="op" id="1552410">.</span><span class="ident" id="1552411">Pointer</span><span class="op" id="1552418">(</span><span class="ident" id="1552419">h</span><span class="op" id="1552420">)</span><span class="op" id="1552421">,</span>&nbsp;<span class="ident" id="1552423">callerpc</span><span class="op" id="1552431">,</span>&nbsp;<span class="ident" id="1552433">funcPC</span><span class="op" id="1552439">(</span><span class="ident" id="1552440">mapaccess1_fast64</span><span class="op" id="1552457">)</span><span class="op" id="1552458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1552461">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1552464">if</span>&nbsp;<span class="ident" id="1552467">h</span>&nbsp;<span class="op" id="1552469">==</span>&nbsp;<span class="ident" id="1552472">nil</span>&nbsp;<span class="op" id="1552476">||</span>&nbsp;<span class="ident" id="1552479">h</span><span class="op" id="1552480">.</span><span class="ident" id="1552481">count</span>&nbsp;<span class="op" id="1552487">==</span>&nbsp;<span class="num" id="1552490">0</span>&nbsp;<span class="op" id="1552492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1552496">return</span>&nbsp;<span class="ident" id="1552503">unsafe</span><span class="op" id="1552509">.</span><span class="ident" id="1552510">Pointer</span><span class="op" id="1552517">(</span><span class="ident" id="1552518">t</span><span class="op" id="1552519">.</span><span class="ident" id="1552520">elem</span><span class="op" id="1552524">.</span><span class="ident" id="1552525">zero</span><span class="op" id="1552529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1552532">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1552535">var</span>&nbsp;<span class="ident" id="1552539">b</span>&nbsp;<span class="op" id="1552541">*</span><span class="ident" id="1552542">bmap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1552548">if</span>&nbsp;<span class="ident" id="1552551">h</span><span class="op" id="1552552">.</span><span class="ident" id="1552553">B</span>&nbsp;<span class="op" id="1552555">==</span>&nbsp;<span class="num" id="1552558">0</span>&nbsp;<span class="op" id="1552560">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1552564">//&nbsp;One-bucket&nbsp;table.&nbsp;&nbsp;No&nbsp;need&nbsp;to&nbsp;hash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1552605">b</span>&nbsp;<span class="op" id="1552607">=</span>&nbsp;<span class="op" id="1552609">(</span><span class="op" id="1552610">*</span><span class="ident" id="1552611">bmap</span><span class="op" id="1552615">)</span><span class="op" id="1552616">(</span><span class="ident" id="1552617">h</span><span class="op" id="1552618">.</span><span class="ident" id="1552619">buckets</span><span class="op" id="1552626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1552629">}</span>&nbsp;<span class="keyword" id="1552631">else</span>&nbsp;<span class="op" id="1552636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1552640">hash</span>&nbsp;<span class="op" id="1552645">:=</span>&nbsp;<span class="ident" id="1552648">goalg</span><span class="op" id="1552653">(</span><span class="ident" id="1552654">t</span><span class="op" id="1552655">.</span><span class="ident" id="1552656">key</span><span class="op" id="1552659">.</span><span class="ident" id="1552660">alg</span><span class="op" id="1552663">)</span><span class="op" id="1552664">.</span><span class="ident" id="1552665">hash</span><span class="op" id="1552669">(</span><span class="ident" id="1552670">noescape</span><span class="op" id="1552678">(</span><span class="ident" id="1552679">unsafe</span><span class="op" id="1552685">.</span><span class="ident" id="1552686">Pointer</span><span class="op" id="1552693">(</span><span class="op" id="1552694">&amp;</span><span class="ident" id="1552695">key</span><span class="op" id="1552698">)</span><span class="op" id="1552699">)</span><span class="op" id="1552700">,</span>&nbsp;<span class="num" id="1552702">8</span><span class="op" id="1552703">,</span>&nbsp;<span class="builtintype" id="1552705">uintptr</span><span class="op" id="1552712">(</span><span class="ident" id="1552713">h</span><span class="op" id="1552714">.</span><span class="ident" id="1552715">hash0</span><span class="op" id="1552720">)</span><span class="op" id="1552721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1552725">m</span>&nbsp;<span class="op" id="1552727">:=</span>&nbsp;<span class="builtintype" id="1552730">uintptr</span><span class="op" id="1552737">(</span><span class="num" id="1552738">1</span><span class="op" id="1552739">)</span><span class="op" id="1552740">&lt;&lt;</span><span class="ident" id="1552742">h</span><span class="op" id="1552743">.</span><span class="ident" id="1552744">B</span>&nbsp;<span class="op" id="1552746">-</span>&nbsp;<span class="num" id="1552748">1</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1552752">b</span>&nbsp;<span class="op" id="1552754">=</span>&nbsp;<span class="op" id="1552756">(</span><span class="op" id="1552757">*</span><span class="ident" id="1552758">bmap</span><span class="op" id="1552762">)</span><span class="op" id="1552763">(</span><span class="ident" id="1552764">add</span><span class="op" id="1552767">(</span><span class="ident" id="1552768">h</span><span class="op" id="1552769">.</span><span class="ident" id="1552770">buckets</span><span class="op" id="1552777">,</span>&nbsp;<span class="op" id="1552779">(</span><span class="ident" id="1552780">hash</span><span class="op" id="1552784">&amp;</span><span class="ident" id="1552785">m</span><span class="op" id="1552786">)</span><span class="op" id="1552787">*</span><span class="builtintype" id="1552788">uintptr</span><span class="op" id="1552795">(</span><span class="ident" id="1552796">t</span><span class="op" id="1552797">.</span><span class="ident" id="1552798">bucketsize</span><span class="op" id="1552808">)</span><span class="op" id="1552809">)</span><span class="op" id="1552810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1552814">if</span>&nbsp;<span class="ident" id="1552817">c</span>&nbsp;<span class="op" id="1552819">:=</span>&nbsp;<span class="ident" id="1552822">h</span><span class="op" id="1552823">.</span><span class="ident" id="1552824">oldbuckets</span><span class="op" id="1552834">;</span>&nbsp;<span class="ident" id="1552836">c</span>&nbsp;<span class="op" id="1552838">!=</span>&nbsp;<span class="ident" id="1552841">nil</span>&nbsp;<span class="op" id="1552845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1552850">oldb</span>&nbsp;<span class="op" id="1552855">:=</span>&nbsp;<span class="op" id="1552858">(</span><span class="op" id="1552859">*</span><span class="ident" id="1552860">bmap</span><span class="op" id="1552864">)</span><span class="op" id="1552865">(</span><span class="ident" id="1552866">add</span><span class="op" id="1552869">(</span><span class="ident" id="1552870">c</span><span class="op" id="1552871">,</span>&nbsp;<span class="op" id="1552873">(</span><span class="ident" id="1552874">hash</span><span class="op" id="1552878">&amp;</span><span class="op" id="1552879">(</span><span class="ident" id="1552880">m</span><span class="op" id="1552881">&gt;&gt;</span><span class="num" id="1552883">1</span><span class="op" id="1552884">)</span><span class="op" id="1552885">)</span><span class="op" id="1552886">*</span><span class="builtintype" id="1552887">uintptr</span><span class="op" id="1552894">(</span><span class="ident" id="1552895">t</span><span class="op" id="1552896">.</span><span class="ident" id="1552897">bucketsize</span><span class="op" id="1552907">)</span><span class="op" id="1552908">)</span><span class="op" id="1552909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1552914">if</span>&nbsp;<span class="op" id="1552917">!</span><span class="ident" id="1552918">evacuated</span><span class="op" id="1552927">(</span><span class="ident" id="1552928">oldb</span><span class="op" id="1552932">)</span>&nbsp;<span class="op" id="1552934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1552940">b</span>&nbsp;<span class="op" id="1552942">=</span>&nbsp;<span class="ident" id="1552944">oldb</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1552952">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1552956">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1552959">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1552962">for</span>&nbsp;<span class="op" id="1552966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1552970">for</span>&nbsp;<span class="ident" id="1552974">i</span>&nbsp;<span class="op" id="1552976">:=</span>&nbsp;<span class="builtintype" id="1552979">uintptr</span><span class="op" id="1552986">(</span><span class="num" id="1552987">0</span><span class="op" id="1552988">)</span><span class="op" id="1552989">;</span>&nbsp;<span class="ident" id="1552991">i</span>&nbsp;<span class="op" id="1552993">&lt;</span>&nbsp;<span class="ident" id="1552995">bucketCnt</span><span class="op" id="1553004">;</span>&nbsp;<span class="ident" id="1553006">i</span><span class="op" id="1553007">++</span>&nbsp;<span class="op" id="1553010">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1553015">k</span>&nbsp;<span class="op" id="1553017">:=</span>&nbsp;<span class="op" id="1553020">*</span><span class="op" id="1553021">(</span><span class="op" id="1553022">(</span><span class="op" id="1553023">*</span><span class="ident" id="1553024">uint64</span><span class="op" id="1553030">)</span><span class="op" id="1553031">(</span><span class="ident" id="1553032">add</span><span class="op" id="1553035">(</span><span class="ident" id="1553036">unsafe</span><span class="op" id="1553042">.</span><span class="ident" id="1553043">Pointer</span><span class="op" id="1553050">(</span><span class="ident" id="1553051">b</span><span class="op" id="1553052">)</span><span class="op" id="1553053">,</span>&nbsp;<span class="ident" id="1553055">dataOffset</span><span class="op" id="1553065">+</span><span class="ident" id="1553066">i</span><span class="op" id="1553067">*</span><span class="num" id="1553068">8</span><span class="op" id="1553069">)</span><span class="op" id="1553070">)</span><span class="op" id="1553071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1553076">if</span>&nbsp;<span class="ident" id="1553079">k</span>&nbsp;<span class="op" id="1553081">!=</span>&nbsp;<span class="ident" id="1553084">key</span>&nbsp;<span class="op" id="1553088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1553094">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1553106">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1553111">x</span>&nbsp;<span class="op" id="1553113">:=</span>&nbsp;<span class="op" id="1553116">*</span><span class="op" id="1553117">(</span><span class="op" id="1553118">(</span><span class="op" id="1553119">*</span><span class="builtintype" id="1553120">uint8</span><span class="op" id="1553125">)</span><span class="op" id="1553126">(</span><span class="ident" id="1553127">add</span><span class="op" id="1553130">(</span><span class="ident" id="1553131">unsafe</span><span class="op" id="1553137">.</span><span class="ident" id="1553138">Pointer</span><span class="op" id="1553145">(</span><span class="ident" id="1553146">b</span><span class="op" id="1553147">)</span><span class="op" id="1553148">,</span>&nbsp;<span class="ident" id="1553150">i</span><span class="op" id="1553151">)</span><span class="op" id="1553152">)</span><span class="op" id="1553153">)</span>&nbsp;<span class="comment" id="1553155">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1553199">if</span>&nbsp;<span class="ident" id="1553202">x</span>&nbsp;<span class="op" id="1553204">==</span>&nbsp;<span class="ident" id="1553207">empty</span>&nbsp;<span class="op" id="1553213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1553219">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1553231">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1553236">return</span>&nbsp;<span class="ident" id="1553243">add</span><span class="op" id="1553246">(</span><span class="ident" id="1553247">unsafe</span><span class="op" id="1553253">.</span><span class="ident" id="1553254">Pointer</span><span class="op" id="1553261">(</span><span class="ident" id="1553262">b</span><span class="op" id="1553263">)</span><span class="op" id="1553264">,</span>&nbsp;<span class="ident" id="1553266">dataOffset</span><span class="op" id="1553276">+</span><span class="ident" id="1553277">bucketCnt</span><span class="op" id="1553286">*</span><span class="num" id="1553287">8</span><span class="op" id="1553288">+</span><span class="ident" id="1553289">i</span><span class="op" id="1553290">*</span><span class="builtintype" id="1553291">uintptr</span><span class="op" id="1553298">(</span><span class="ident" id="1553299">t</span><span class="op" id="1553300">.</span><span class="ident" id="1553301">valuesize</span><span class="op" id="1553310">)</span><span class="op" id="1553311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1553315">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1553319">b</span>&nbsp;<span class="op" id="1553321">=</span>&nbsp;<span class="ident" id="1553323">b</span><span class="op" id="1553324">.</span><span class="ident" id="1553325">overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1553336">if</span>&nbsp;<span class="ident" id="1553339">b</span>&nbsp;<span class="op" id="1553341">==</span>&nbsp;<span class="ident" id="1553344">nil</span>&nbsp;<span class="op" id="1553348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1553353">return</span>&nbsp;<span class="ident" id="1553360">unsafe</span><span class="op" id="1553366">.</span><span class="ident" id="1553367">Pointer</span><span class="op" id="1553374">(</span><span class="ident" id="1553375">t</span><span class="op" id="1553376">.</span><span class="ident" id="1553377">elem</span><span class="op" id="1553381">.</span><span class="ident" id="1553382">zero</span><span class="op" id="1553386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1553390">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1553393">}</span><br>
<span class="lineno">135</span><span class="op" id="1553395">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1553398">func</span>&nbsp;<span class="ident" id="1553403">mapaccess2_fast64</span><span class="op" id="1553420">(</span><span class="ident" id="1553421">t</span>&nbsp;<span class="op" id="1553423">*</span><span class="ident" id="1553424">maptype</span><span class="op" id="1553431">,</span>&nbsp;<span class="ident" id="1553433">h</span>&nbsp;<span class="op" id="1553435">*</span><span class="ident" id="1553436">hmap</span><span class="op" id="1553440">,</span>&nbsp;<span class="ident" id="1553442">key</span>&nbsp;<span class="ident" id="1553446">uint64</span><span class="op" id="1553452">)</span>&nbsp;<span class="op" id="1553454">(</span><span class="ident" id="1553455">unsafe</span><span class="op" id="1553461">.</span><span class="ident" id="1553462">Pointer</span><span class="op" id="1553469">,</span>&nbsp;<span class="builtintype" id="1553471">bool</span><span class="op" id="1553475">)</span>&nbsp;<span class="op" id="1553477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1553480">if</span>&nbsp;<span class="ident" id="1553483">raceenabled</span>&nbsp;<span class="op" id="1553495">&amp;&amp;</span>&nbsp;<span class="ident" id="1553498">h</span>&nbsp;<span class="op" id="1553500">!=</span>&nbsp;<span class="ident" id="1553503">nil</span>&nbsp;<span class="op" id="1553507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1553511">callerpc</span>&nbsp;<span class="op" id="1553520">:=</span>&nbsp;<span class="ident" id="1553523">getcallerpc</span><span class="op" id="1553534">(</span><span class="ident" id="1553535">unsafe</span><span class="op" id="1553541">.</span><span class="ident" id="1553542">Pointer</span><span class="op" id="1553549">(</span><span class="op" id="1553550">&amp;</span><span class="ident" id="1553551">t</span><span class="op" id="1553552">)</span><span class="op" id="1553553">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1553557">racereadpc</span><span class="op" id="1553567">(</span><span class="ident" id="1553568">unsafe</span><span class="op" id="1553574">.</span><span class="ident" id="1553575">Pointer</span><span class="op" id="1553582">(</span><span class="ident" id="1553583">h</span><span class="op" id="1553584">)</span><span class="op" id="1553585">,</span>&nbsp;<span class="ident" id="1553587">callerpc</span><span class="op" id="1553595">,</span>&nbsp;<span class="ident" id="1553597">funcPC</span><span class="op" id="1553603">(</span><span class="ident" id="1553604">mapaccess2_fast64</span><span class="op" id="1553621">)</span><span class="op" id="1553622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1553625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1553628">if</span>&nbsp;<span class="ident" id="1553631">h</span>&nbsp;<span class="op" id="1553633">==</span>&nbsp;<span class="ident" id="1553636">nil</span>&nbsp;<span class="op" id="1553640">||</span>&nbsp;<span class="ident" id="1553643">h</span><span class="op" id="1553644">.</span><span class="ident" id="1553645">count</span>&nbsp;<span class="op" id="1553651">==</span>&nbsp;<span class="num" id="1553654">0</span>&nbsp;<span class="op" id="1553656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1553660">return</span>&nbsp;<span class="ident" id="1553667">unsafe</span><span class="op" id="1553673">.</span><span class="ident" id="1553674">Pointer</span><span class="op" id="1553681">(</span><span class="ident" id="1553682">t</span><span class="op" id="1553683">.</span><span class="ident" id="1553684">elem</span><span class="op" id="1553688">.</span><span class="ident" id="1553689">zero</span><span class="op" id="1553693">)</span><span class="op" id="1553694">,</span>&nbsp;<span class="ident" id="1553696">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1553703">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1553706">var</span>&nbsp;<span class="ident" id="1553710">b</span>&nbsp;<span class="op" id="1553712">*</span><span class="ident" id="1553713">bmap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1553719">if</span>&nbsp;<span class="ident" id="1553722">h</span><span class="op" id="1553723">.</span><span class="ident" id="1553724">B</span>&nbsp;<span class="op" id="1553726">==</span>&nbsp;<span class="num" id="1553729">0</span>&nbsp;<span class="op" id="1553731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1553735">//&nbsp;One-bucket&nbsp;table.&nbsp;&nbsp;No&nbsp;need&nbsp;to&nbsp;hash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1553776">b</span>&nbsp;<span class="op" id="1553778">=</span>&nbsp;<span class="op" id="1553780">(</span><span class="op" id="1553781">*</span><span class="ident" id="1553782">bmap</span><span class="op" id="1553786">)</span><span class="op" id="1553787">(</span><span class="ident" id="1553788">h</span><span class="op" id="1553789">.</span><span class="ident" id="1553790">buckets</span><span class="op" id="1553797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1553800">}</span>&nbsp;<span class="keyword" id="1553802">else</span>&nbsp;<span class="op" id="1553807">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1553811">hash</span>&nbsp;<span class="op" id="1553816">:=</span>&nbsp;<span class="ident" id="1553819">goalg</span><span class="op" id="1553824">(</span><span class="ident" id="1553825">t</span><span class="op" id="1553826">.</span><span class="ident" id="1553827">key</span><span class="op" id="1553830">.</span><span class="ident" id="1553831">alg</span><span class="op" id="1553834">)</span><span class="op" id="1553835">.</span><span class="ident" id="1553836">hash</span><span class="op" id="1553840">(</span><span class="ident" id="1553841">noescape</span><span class="op" id="1553849">(</span><span class="ident" id="1553850">unsafe</span><span class="op" id="1553856">.</span><span class="ident" id="1553857">Pointer</span><span class="op" id="1553864">(</span><span class="op" id="1553865">&amp;</span><span class="ident" id="1553866">key</span><span class="op" id="1553869">)</span><span class="op" id="1553870">)</span><span class="op" id="1553871">,</span>&nbsp;<span class="num" id="1553873">8</span><span class="op" id="1553874">,</span>&nbsp;<span class="builtintype" id="1553876">uintptr</span><span class="op" id="1553883">(</span><span class="ident" id="1553884">h</span><span class="op" id="1553885">.</span><span class="ident" id="1553886">hash0</span><span class="op" id="1553891">)</span><span class="op" id="1553892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1553896">m</span>&nbsp;<span class="op" id="1553898">:=</span>&nbsp;<span class="builtintype" id="1553901">uintptr</span><span class="op" id="1553908">(</span><span class="num" id="1553909">1</span><span class="op" id="1553910">)</span><span class="op" id="1553911">&lt;&lt;</span><span class="ident" id="1553913">h</span><span class="op" id="1553914">.</span><span class="ident" id="1553915">B</span>&nbsp;<span class="op" id="1553917">-</span>&nbsp;<span class="num" id="1553919">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1553923">b</span>&nbsp;<span class="op" id="1553925">=</span>&nbsp;<span class="op" id="1553927">(</span><span class="op" id="1553928">*</span><span class="ident" id="1553929">bmap</span><span class="op" id="1553933">)</span><span class="op" id="1553934">(</span><span class="ident" id="1553935">add</span><span class="op" id="1553938">(</span><span class="ident" id="1553939">h</span><span class="op" id="1553940">.</span><span class="ident" id="1553941">buckets</span><span class="op" id="1553948">,</span>&nbsp;<span class="op" id="1553950">(</span><span class="ident" id="1553951">hash</span><span class="op" id="1553955">&amp;</span><span class="ident" id="1553956">m</span><span class="op" id="1553957">)</span><span class="op" id="1553958">*</span><span class="builtintype" id="1553959">uintptr</span><span class="op" id="1553966">(</span><span class="ident" id="1553967">t</span><span class="op" id="1553968">.</span><span class="ident" id="1553969">bucketsize</span><span class="op" id="1553979">)</span><span class="op" id="1553980">)</span><span class="op" id="1553981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1553985">if</span>&nbsp;<span class="ident" id="1553988">c</span>&nbsp;<span class="op" id="1553990">:=</span>&nbsp;<span class="ident" id="1553993">h</span><span class="op" id="1553994">.</span><span class="ident" id="1553995">oldbuckets</span><span class="op" id="1554005">;</span>&nbsp;<span class="ident" id="1554007">c</span>&nbsp;<span class="op" id="1554009">!=</span>&nbsp;<span class="ident" id="1554012">nil</span>&nbsp;<span class="op" id="1554016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1554021">oldb</span>&nbsp;<span class="op" id="1554026">:=</span>&nbsp;<span class="op" id="1554029">(</span><span class="op" id="1554030">*</span><span class="ident" id="1554031">bmap</span><span class="op" id="1554035">)</span><span class="op" id="1554036">(</span><span class="ident" id="1554037">add</span><span class="op" id="1554040">(</span><span class="ident" id="1554041">c</span><span class="op" id="1554042">,</span>&nbsp;<span class="op" id="1554044">(</span><span class="ident" id="1554045">hash</span><span class="op" id="1554049">&amp;</span><span class="op" id="1554050">(</span><span class="ident" id="1554051">m</span><span class="op" id="1554052">&gt;&gt;</span><span class="num" id="1554054">1</span><span class="op" id="1554055">)</span><span class="op" id="1554056">)</span><span class="op" id="1554057">*</span><span class="builtintype" id="1554058">uintptr</span><span class="op" id="1554065">(</span><span class="ident" id="1554066">t</span><span class="op" id="1554067">.</span><span class="ident" id="1554068">bucketsize</span><span class="op" id="1554078">)</span><span class="op" id="1554079">)</span><span class="op" id="1554080">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1554085">if</span>&nbsp;<span class="op" id="1554088">!</span><span class="ident" id="1554089">evacuated</span><span class="op" id="1554098">(</span><span class="ident" id="1554099">oldb</span><span class="op" id="1554103">)</span>&nbsp;<span class="op" id="1554105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1554111">b</span>&nbsp;<span class="op" id="1554113">=</span>&nbsp;<span class="ident" id="1554115">oldb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1554123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1554127">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1554130">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1554133">for</span>&nbsp;<span class="op" id="1554137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1554141">for</span>&nbsp;<span class="ident" id="1554145">i</span>&nbsp;<span class="op" id="1554147">:=</span>&nbsp;<span class="builtintype" id="1554150">uintptr</span><span class="op" id="1554157">(</span><span class="num" id="1554158">0</span><span class="op" id="1554159">)</span><span class="op" id="1554160">;</span>&nbsp;<span class="ident" id="1554162">i</span>&nbsp;<span class="op" id="1554164">&lt;</span>&nbsp;<span class="ident" id="1554166">bucketCnt</span><span class="op" id="1554175">;</span>&nbsp;<span class="ident" id="1554177">i</span><span class="op" id="1554178">++</span>&nbsp;<span class="op" id="1554181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1554186">k</span>&nbsp;<span class="op" id="1554188">:=</span>&nbsp;<span class="op" id="1554191">*</span><span class="op" id="1554192">(</span><span class="op" id="1554193">(</span><span class="op" id="1554194">*</span><span class="ident" id="1554195">uint64</span><span class="op" id="1554201">)</span><span class="op" id="1554202">(</span><span class="ident" id="1554203">add</span><span class="op" id="1554206">(</span><span class="ident" id="1554207">unsafe</span><span class="op" id="1554213">.</span><span class="ident" id="1554214">Pointer</span><span class="op" id="1554221">(</span><span class="ident" id="1554222">b</span><span class="op" id="1554223">)</span><span class="op" id="1554224">,</span>&nbsp;<span class="ident" id="1554226">dataOffset</span><span class="op" id="1554236">+</span><span class="ident" id="1554237">i</span><span class="op" id="1554238">*</span><span class="num" id="1554239">8</span><span class="op" id="1554240">)</span><span class="op" id="1554241">)</span><span class="op" id="1554242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1554247">if</span>&nbsp;<span class="ident" id="1554250">k</span>&nbsp;<span class="op" id="1554252">!=</span>&nbsp;<span class="ident" id="1554255">key</span>&nbsp;<span class="op" id="1554259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1554265">continue</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1554277">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1554282">x</span>&nbsp;<span class="op" id="1554284">:=</span>&nbsp;<span class="op" id="1554287">*</span><span class="op" id="1554288">(</span><span class="op" id="1554289">(</span><span class="op" id="1554290">*</span><span class="builtintype" id="1554291">uint8</span><span class="op" id="1554296">)</span><span class="op" id="1554297">(</span><span class="ident" id="1554298">add</span><span class="op" id="1554301">(</span><span class="ident" id="1554302">unsafe</span><span class="op" id="1554308">.</span><span class="ident" id="1554309">Pointer</span><span class="op" id="1554316">(</span><span class="ident" id="1554317">b</span><span class="op" id="1554318">)</span><span class="op" id="1554319">,</span>&nbsp;<span class="ident" id="1554321">i</span><span class="op" id="1554322">)</span><span class="op" id="1554323">)</span><span class="op" id="1554324">)</span>&nbsp;<span class="comment" id="1554326">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1554370">if</span>&nbsp;<span class="ident" id="1554373">x</span>&nbsp;<span class="op" id="1554375">==</span>&nbsp;<span class="ident" id="1554378">empty</span>&nbsp;<span class="op" id="1554384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1554390">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1554402">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1554407">return</span>&nbsp;<span class="ident" id="1554414">add</span><span class="op" id="1554417">(</span><span class="ident" id="1554418">unsafe</span><span class="op" id="1554424">.</span><span class="ident" id="1554425">Pointer</span><span class="op" id="1554432">(</span><span class="ident" id="1554433">b</span><span class="op" id="1554434">)</span><span class="op" id="1554435">,</span>&nbsp;<span class="ident" id="1554437">dataOffset</span><span class="op" id="1554447">+</span><span class="ident" id="1554448">bucketCnt</span><span class="op" id="1554457">*</span><span class="num" id="1554458">8</span><span class="op" id="1554459">+</span><span class="ident" id="1554460">i</span><span class="op" id="1554461">*</span><span class="builtintype" id="1554462">uintptr</span><span class="op" id="1554469">(</span><span class="ident" id="1554470">t</span><span class="op" id="1554471">.</span><span class="ident" id="1554472">valuesize</span><span class="op" id="1554481">)</span><span class="op" id="1554482">)</span><span class="op" id="1554483">,</span>&nbsp;<span class="ident" id="1554485">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1554492">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1554496">b</span>&nbsp;<span class="op" id="1554498">=</span>&nbsp;<span class="ident" id="1554500">b</span><span class="op" id="1554501">.</span><span class="ident" id="1554502">overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1554513">if</span>&nbsp;<span class="ident" id="1554516">b</span>&nbsp;<span class="op" id="1554518">==</span>&nbsp;<span class="ident" id="1554521">nil</span>&nbsp;<span class="op" id="1554525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1554530">return</span>&nbsp;<span class="ident" id="1554537">unsafe</span><span class="op" id="1554543">.</span><span class="ident" id="1554544">Pointer</span><span class="op" id="1554551">(</span><span class="ident" id="1554552">t</span><span class="op" id="1554553">.</span><span class="ident" id="1554554">elem</span><span class="op" id="1554558">.</span><span class="ident" id="1554559">zero</span><span class="op" id="1554563">)</span><span class="op" id="1554564">,</span>&nbsp;<span class="ident" id="1554566">false</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1554574">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1554577">}</span><br>
<span class="lineno"></span><span class="op" id="1554579">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1554582">func</span>&nbsp;<span class="ident" id="1554587">mapaccess1_faststr</span><span class="op" id="1554605">(</span><span class="ident" id="1554606">t</span>&nbsp;<span class="op" id="1554608">*</span><span class="ident" id="1554609">maptype</span><span class="op" id="1554616">,</span>&nbsp;<span class="ident" id="1554618">h</span>&nbsp;<span class="op" id="1554620">*</span><span class="ident" id="1554621">hmap</span><span class="op" id="1554625">,</span>&nbsp;<span class="ident" id="1554627">ky</span>&nbsp;<span class="builtintype" id="1554630">string</span><span class="op" id="1554636">)</span>&nbsp;<span class="ident" id="1554638">unsafe</span><span class="op" id="1554644">.</span><span class="ident" id="1554645">Pointer</span>&nbsp;<span class="op" id="1554653">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1554656">if</span>&nbsp;<span class="ident" id="1554659">raceenabled</span>&nbsp;<span class="op" id="1554671">&amp;&amp;</span>&nbsp;<span class="ident" id="1554674">h</span>&nbsp;<span class="op" id="1554676">!=</span>&nbsp;<span class="ident" id="1554679">nil</span>&nbsp;<span class="op" id="1554683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1554687">callerpc</span>&nbsp;<span class="op" id="1554696">:=</span>&nbsp;<span class="ident" id="1554699">getcallerpc</span><span class="op" id="1554710">(</span><span class="ident" id="1554711">unsafe</span><span class="op" id="1554717">.</span><span class="ident" id="1554718">Pointer</span><span class="op" id="1554725">(</span><span class="op" id="1554726">&amp;</span><span class="ident" id="1554727">t</span><span class="op" id="1554728">)</span><span class="op" id="1554729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1554733">racereadpc</span><span class="op" id="1554743">(</span><span class="ident" id="1554744">unsafe</span><span class="op" id="1554750">.</span><span class="ident" id="1554751">Pointer</span><span class="op" id="1554758">(</span><span class="ident" id="1554759">h</span><span class="op" id="1554760">)</span><span class="op" id="1554761">,</span>&nbsp;<span class="ident" id="1554763">callerpc</span><span class="op" id="1554771">,</span>&nbsp;<span class="ident" id="1554773">funcPC</span><span class="op" id="1554779">(</span><span class="ident" id="1554780">mapaccess1_faststr</span><span class="op" id="1554798">)</span><span class="op" id="1554799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1554802">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1554805">if</span>&nbsp;<span class="ident" id="1554808">h</span>&nbsp;<span class="op" id="1554810">==</span>&nbsp;<span class="ident" id="1554813">nil</span>&nbsp;<span class="op" id="1554817">||</span>&nbsp;<span class="ident" id="1554820">h</span><span class="op" id="1554821">.</span><span class="ident" id="1554822">count</span>&nbsp;<span class="op" id="1554828">==</span>&nbsp;<span class="num" id="1554831">0</span>&nbsp;<span class="op" id="1554833">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1554837">return</span>&nbsp;<span class="ident" id="1554844">unsafe</span><span class="op" id="1554850">.</span><span class="ident" id="1554851">Pointer</span><span class="op" id="1554858">(</span><span class="ident" id="1554859">t</span><span class="op" id="1554860">.</span><span class="ident" id="1554861">elem</span><span class="op" id="1554865">.</span><span class="ident" id="1554866">zero</span><span class="op" id="1554870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1554873">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1554876">key</span>&nbsp;<span class="op" id="1554880">:=</span>&nbsp;<span class="op" id="1554883">(</span><span class="op" id="1554884">*</span><span class="ident" id="1554885">stringStruct</span><span class="op" id="1554897">)</span><span class="op" id="1554898">(</span><span class="ident" id="1554899">unsafe</span><span class="op" id="1554905">.</span><span class="ident" id="1554906">Pointer</span><span class="op" id="1554913">(</span><span class="op" id="1554914">&amp;</span><span class="ident" id="1554915">ky</span><span class="op" id="1554917">)</span><span class="op" id="1554918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1554921">if</span>&nbsp;<span class="ident" id="1554924">h</span><span class="op" id="1554925">.</span><span class="ident" id="1554926">B</span>&nbsp;<span class="op" id="1554928">==</span>&nbsp;<span class="num" id="1554931">0</span>&nbsp;<span class="op" id="1554933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1554937">//&nbsp;One-bucket&nbsp;table.</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1554960">b</span>&nbsp;<span class="op" id="1554962">:=</span>&nbsp;<span class="op" id="1554965">(</span><span class="op" id="1554966">*</span><span class="ident" id="1554967">bmap</span><span class="op" id="1554971">)</span><span class="op" id="1554972">(</span><span class="ident" id="1554973">h</span><span class="op" id="1554974">.</span><span class="ident" id="1554975">buckets</span><span class="op" id="1554982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1554986">if</span>&nbsp;<span class="ident" id="1554989">key</span><span class="op" id="1554992">.</span><span class="builtinfunc" id="1554993">len</span>&nbsp;<span class="op" id="1554997">&lt;</span>&nbsp;<span class="num" id="1554999">32</span>&nbsp;<span class="op" id="1555002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1555007">//&nbsp;short&nbsp;key,&nbsp;doing&nbsp;lots&nbsp;of&nbsp;comparisons&nbsp;is&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1555056">for</span>&nbsp;<span class="ident" id="1555060">i</span>&nbsp;<span class="op" id="1555062">:=</span>&nbsp;<span class="builtintype" id="1555065">uintptr</span><span class="op" id="1555072">(</span><span class="num" id="1555073">0</span><span class="op" id="1555074">)</span><span class="op" id="1555075">;</span>&nbsp;<span class="ident" id="1555077">i</span>&nbsp;<span class="op" id="1555079">&lt;</span>&nbsp;<span class="ident" id="1555081">bucketCnt</span><span class="op" id="1555090">;</span>&nbsp;<span class="ident" id="1555092">i</span><span class="op" id="1555093">++</span>&nbsp;<span class="op" id="1555096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1555102">x</span>&nbsp;<span class="op" id="1555104">:=</span>&nbsp;<span class="op" id="1555107">*</span><span class="op" id="1555108">(</span><span class="op" id="1555109">(</span><span class="op" id="1555110">*</span><span class="builtintype" id="1555111">uint8</span><span class="op" id="1555116">)</span><span class="op" id="1555117">(</span><span class="ident" id="1555118">add</span><span class="op" id="1555121">(</span><span class="ident" id="1555122">unsafe</span><span class="op" id="1555128">.</span><span class="ident" id="1555129">Pointer</span><span class="op" id="1555136">(</span><span class="ident" id="1555137">b</span><span class="op" id="1555138">)</span><span class="op" id="1555139">,</span>&nbsp;<span class="ident" id="1555141">i</span><span class="op" id="1555142">)</span><span class="op" id="1555143">)</span><span class="op" id="1555144">)</span>&nbsp;<span class="comment" id="1555146">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1555191">if</span>&nbsp;<span class="ident" id="1555194">x</span>&nbsp;<span class="op" id="1555196">==</span>&nbsp;<span class="ident" id="1555199">empty</span>&nbsp;<span class="op" id="1555205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1555212">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1555225">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1555231">k</span>&nbsp;<span class="op" id="1555233">:=</span>&nbsp;<span class="op" id="1555236">(</span><span class="op" id="1555237">*</span><span class="ident" id="1555238">stringStruct</span><span class="op" id="1555250">)</span><span class="op" id="1555251">(</span><span class="ident" id="1555252">add</span><span class="op" id="1555255">(</span><span class="ident" id="1555256">unsafe</span><span class="op" id="1555262">.</span><span class="ident" id="1555263">Pointer</span><span class="op" id="1555270">(</span><span class="ident" id="1555271">b</span><span class="op" id="1555272">)</span><span class="op" id="1555273">,</span>&nbsp;<span class="ident" id="1555275">dataOffset</span><span class="op" id="1555285">+</span><span class="ident" id="1555286">i</span><span class="op" id="1555287">*</span><span class="num" id="1555288">2</span><span class="op" id="1555289">*</span><span class="ident" id="1555290">ptrSize</span><span class="op" id="1555297">)</span><span class="op" id="1555298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1555304">if</span>&nbsp;<span class="ident" id="1555307">k</span><span class="op" id="1555308">.</span><span class="builtinfunc" id="1555309">len</span>&nbsp;<span class="op" id="1555313">!=</span>&nbsp;<span class="ident" id="1555316">key</span><span class="op" id="1555319">.</span><span class="builtinfunc" id="1555320">len</span>&nbsp;<span class="op" id="1555324">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1555331">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1555344">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1555350">if</span>&nbsp;<span class="ident" id="1555353">k</span><span class="op" id="1555354">.</span><span class="ident" id="1555355">str</span>&nbsp;<span class="op" id="1555359">==</span>&nbsp;<span class="ident" id="1555362">key</span><span class="op" id="1555365">.</span><span class="ident" id="1555366">str</span>&nbsp;<span class="op" id="1555370">||</span>&nbsp;<span class="ident" id="1555373">memeq</span><span class="op" id="1555378">(</span><span class="ident" id="1555379">k</span><span class="op" id="1555380">.</span><span class="ident" id="1555381">str</span><span class="op" id="1555384">,</span>&nbsp;<span class="ident" id="1555386">key</span><span class="op" id="1555389">.</span><span class="ident" id="1555390">str</span><span class="op" id="1555393">,</span>&nbsp;<span class="builtintype" id="1555395">uintptr</span><span class="op" id="1555402">(</span><span class="ident" id="1555403">key</span><span class="op" id="1555406">.</span><span class="builtinfunc" id="1555407">len</span><span class="op" id="1555410">)</span><span class="op" id="1555411">)</span>&nbsp;<span class="op" id="1555413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1555420">return</span>&nbsp;<span class="ident" id="1555427">add</span><span class="op" id="1555430">(</span><span class="ident" id="1555431">unsafe</span><span class="op" id="1555437">.</span><span class="ident" id="1555438">Pointer</span><span class="op" id="1555445">(</span><span class="ident" id="1555446">b</span><span class="op" id="1555447">)</span><span class="op" id="1555448">,</span>&nbsp;<span class="ident" id="1555450">dataOffset</span><span class="op" id="1555460">+</span><span class="ident" id="1555461">bucketCnt</span><span class="op" id="1555470">*</span><span class="num" id="1555471">2</span><span class="op" id="1555472">*</span><span class="ident" id="1555473">ptrSize</span><span class="op" id="1555480">+</span><span class="ident" id="1555481">i</span><span class="op" id="1555482">*</span><span class="builtintype" id="1555483">uintptr</span><span class="op" id="1555490">(</span><span class="ident" id="1555491">t</span><span class="op" id="1555492">.</span><span class="ident" id="1555493">valuesize</span><span class="op" id="1555502">)</span><span class="op" id="1555503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1555509">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1555514">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1555519">return</span>&nbsp;<span class="ident" id="1555526">unsafe</span><span class="op" id="1555532">.</span><span class="ident" id="1555533">Pointer</span><span class="op" id="1555540">(</span><span class="ident" id="1555541">t</span><span class="op" id="1555542">.</span><span class="ident" id="1555543">elem</span><span class="op" id="1555547">.</span><span class="ident" id="1555548">zero</span><span class="op" id="1555552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1555556">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1555560">//&nbsp;long&nbsp;key,&nbsp;try&nbsp;not&nbsp;to&nbsp;do&nbsp;more&nbsp;comparisons&nbsp;than&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1555621">keymaybe</span>&nbsp;<span class="op" id="1555630">:=</span>&nbsp;<span class="builtintype" id="1555633">uintptr</span><span class="op" id="1555640">(</span><span class="ident" id="1555641">bucketCnt</span><span class="op" id="1555650">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1555654">for</span>&nbsp;<span class="ident" id="1555658">i</span>&nbsp;<span class="op" id="1555660">:=</span>&nbsp;<span class="builtintype" id="1555663">uintptr</span><span class="op" id="1555670">(</span><span class="num" id="1555671">0</span><span class="op" id="1555672">)</span><span class="op" id="1555673">;</span>&nbsp;<span class="ident" id="1555675">i</span>&nbsp;<span class="op" id="1555677">&lt;</span>&nbsp;<span class="ident" id="1555679">bucketCnt</span><span class="op" id="1555688">;</span>&nbsp;<span class="ident" id="1555690">i</span><span class="op" id="1555691">++</span>&nbsp;<span class="op" id="1555694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1555699">x</span>&nbsp;<span class="op" id="1555701">:=</span>&nbsp;<span class="op" id="1555704">*</span><span class="op" id="1555705">(</span><span class="op" id="1555706">(</span><span class="op" id="1555707">*</span><span class="builtintype" id="1555708">uint8</span><span class="op" id="1555713">)</span><span class="op" id="1555714">(</span><span class="ident" id="1555715">add</span><span class="op" id="1555718">(</span><span class="ident" id="1555719">unsafe</span><span class="op" id="1555725">.</span><span class="ident" id="1555726">Pointer</span><span class="op" id="1555733">(</span><span class="ident" id="1555734">b</span><span class="op" id="1555735">)</span><span class="op" id="1555736">,</span>&nbsp;<span class="ident" id="1555738">i</span><span class="op" id="1555739">)</span><span class="op" id="1555740">)</span><span class="op" id="1555741">)</span>&nbsp;<span class="comment" id="1555743">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1555787">if</span>&nbsp;<span class="ident" id="1555790">x</span>&nbsp;<span class="op" id="1555792">==</span>&nbsp;<span class="ident" id="1555795">empty</span>&nbsp;<span class="op" id="1555801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1555807">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1555819">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1555824">k</span>&nbsp;<span class="op" id="1555826">:=</span>&nbsp;<span class="op" id="1555829">(</span><span class="op" id="1555830">*</span><span class="ident" id="1555831">stringStruct</span><span class="op" id="1555843">)</span><span class="op" id="1555844">(</span><span class="ident" id="1555845">add</span><span class="op" id="1555848">(</span><span class="ident" id="1555849">unsafe</span><span class="op" id="1555855">.</span><span class="ident" id="1555856">Pointer</span><span class="op" id="1555863">(</span><span class="ident" id="1555864">b</span><span class="op" id="1555865">)</span><span class="op" id="1555866">,</span>&nbsp;<span class="ident" id="1555868">dataOffset</span><span class="op" id="1555878">+</span><span class="ident" id="1555879">i</span><span class="op" id="1555880">*</span><span class="num" id="1555881">2</span><span class="op" id="1555882">*</span><span class="ident" id="1555883">ptrSize</span><span class="op" id="1555890">)</span><span class="op" id="1555891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1555896">if</span>&nbsp;<span class="ident" id="1555899">k</span><span class="op" id="1555900">.</span><span class="builtinfunc" id="1555901">len</span>&nbsp;<span class="op" id="1555905">!=</span>&nbsp;<span class="ident" id="1555908">key</span><span class="op" id="1555911">.</span><span class="builtinfunc" id="1555912">len</span>&nbsp;<span class="op" id="1555916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1555922">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1555934">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1555939">if</span>&nbsp;<span class="ident" id="1555942">k</span><span class="op" id="1555943">.</span><span class="ident" id="1555944">str</span>&nbsp;<span class="op" id="1555948">==</span>&nbsp;<span class="ident" id="1555951">key</span><span class="op" id="1555954">.</span><span class="ident" id="1555955">str</span>&nbsp;<span class="op" id="1555959">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1555965">return</span>&nbsp;<span class="ident" id="1555972">add</span><span class="op" id="1555975">(</span><span class="ident" id="1555976">unsafe</span><span class="op" id="1555982">.</span><span class="ident" id="1555983">Pointer</span><span class="op" id="1555990">(</span><span class="ident" id="1555991">b</span><span class="op" id="1555992">)</span><span class="op" id="1555993">,</span>&nbsp;<span class="ident" id="1555995">dataOffset</span><span class="op" id="1556005">+</span><span class="ident" id="1556006">bucketCnt</span><span class="op" id="1556015">*</span><span class="num" id="1556016">2</span><span class="op" id="1556017">*</span><span class="ident" id="1556018">ptrSize</span><span class="op" id="1556025">+</span><span class="ident" id="1556026">i</span><span class="op" id="1556027">*</span><span class="builtintype" id="1556028">uintptr</span><span class="op" id="1556035">(</span><span class="ident" id="1556036">t</span><span class="op" id="1556037">.</span><span class="ident" id="1556038">valuesize</span><span class="op" id="1556047">)</span><span class="op" id="1556048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1556053">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1556058">//&nbsp;check&nbsp;first&nbsp;4&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1556084">//&nbsp;TODO:&nbsp;on&nbsp;amd64/386&nbsp;at&nbsp;least,&nbsp;make&nbsp;this&nbsp;compile&nbsp;to&nbsp;one&nbsp;4-byte&nbsp;comparison&nbsp;instead&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1556173">//&nbsp;four&nbsp;1-byte&nbsp;comparisons.</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1556204">if</span>&nbsp;<span class="op" id="1556207">*</span><span class="op" id="1556208">(</span><span class="op" id="1556209">(</span><span class="op" id="1556210">*</span><span class="op" id="1556211">[</span><span class="num" id="1556212">4</span><span class="op" id="1556213">]</span><span class="builtintype" id="1556214">byte</span><span class="op" id="1556218">)</span><span class="op" id="1556219">(</span><span class="ident" id="1556220">key</span><span class="op" id="1556223">.</span><span class="ident" id="1556224">str</span><span class="op" id="1556227">)</span><span class="op" id="1556228">)</span>&nbsp;<span class="op" id="1556230">!=</span>&nbsp;<span class="op" id="1556233">*</span><span class="op" id="1556234">(</span><span class="op" id="1556235">(</span><span class="op" id="1556236">*</span><span class="op" id="1556237">[</span><span class="num" id="1556238">4</span><span class="op" id="1556239">]</span><span class="builtintype" id="1556240">byte</span><span class="op" id="1556244">)</span><span class="op" id="1556245">(</span><span class="ident" id="1556246">k</span><span class="op" id="1556247">.</span><span class="ident" id="1556248">str</span><span class="op" id="1556251">)</span><span class="op" id="1556252">)</span>&nbsp;<span class="op" id="1556254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1556260">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1556272">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1556277">//&nbsp;check&nbsp;last&nbsp;4&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1556302">if</span>&nbsp;<span class="op" id="1556305">*</span><span class="op" id="1556306">(</span><span class="op" id="1556307">(</span><span class="op" id="1556308">*</span><span class="op" id="1556309">[</span><span class="num" id="1556310">4</span><span class="op" id="1556311">]</span><span class="builtintype" id="1556312">byte</span><span class="op" id="1556316">)</span><span class="op" id="1556317">(</span><span class="ident" id="1556318">add</span><span class="op" id="1556321">(</span><span class="ident" id="1556322">key</span><span class="op" id="1556325">.</span><span class="ident" id="1556326">str</span><span class="op" id="1556329">,</span>&nbsp;<span class="builtintype" id="1556331">uintptr</span><span class="op" id="1556338">(</span><span class="ident" id="1556339">key</span><span class="op" id="1556342">.</span><span class="builtinfunc" id="1556343">len</span><span class="op" id="1556346">)</span><span class="op" id="1556347">-</span><span class="num" id="1556348">4</span><span class="op" id="1556349">)</span><span class="op" id="1556350">)</span><span class="op" id="1556351">)</span>&nbsp;<span class="op" id="1556353">!=</span>&nbsp;<span class="op" id="1556356">*</span><span class="op" id="1556357">(</span><span class="op" id="1556358">(</span><span class="op" id="1556359">*</span><span class="op" id="1556360">[</span><span class="num" id="1556361">4</span><span class="op" id="1556362">]</span><span class="builtintype" id="1556363">byte</span><span class="op" id="1556367">)</span><span class="op" id="1556368">(</span><span class="ident" id="1556369">add</span><span class="op" id="1556372">(</span><span class="ident" id="1556373">k</span><span class="op" id="1556374">.</span><span class="ident" id="1556375">str</span><span class="op" id="1556378">,</span>&nbsp;<span class="builtintype" id="1556380">uintptr</span><span class="op" id="1556387">(</span><span class="ident" id="1556388">key</span><span class="op" id="1556391">.</span><span class="builtinfunc" id="1556392">len</span><span class="op" id="1556395">)</span><span class="op" id="1556396">-</span><span class="num" id="1556397">4</span><span class="op" id="1556398">)</span><span class="op" id="1556399">)</span><span class="op" id="1556400">)</span>&nbsp;<span class="op" id="1556402">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1556408">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1556420">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1556425">if</span>&nbsp;<span class="ident" id="1556428">keymaybe</span>&nbsp;<span class="op" id="1556437">!=</span>&nbsp;<span class="ident" id="1556440">bucketCnt</span>&nbsp;<span class="op" id="1556450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1556456">//&nbsp;Two&nbsp;keys&nbsp;are&nbsp;potential&nbsp;matches.&nbsp;&nbsp;Use&nbsp;hash&nbsp;to&nbsp;distinguish&nbsp;them.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1556526">goto</span>&nbsp;<span class="ident" id="1556531">dohash</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1556541">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1556546">keymaybe</span>&nbsp;<span class="op" id="1556555">=</span>&nbsp;<span class="ident" id="1556557">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1556561">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1556565">if</span>&nbsp;<span class="ident" id="1556568">keymaybe</span>&nbsp;<span class="op" id="1556577">!=</span>&nbsp;<span class="ident" id="1556580">bucketCnt</span>&nbsp;<span class="op" id="1556590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1556595">k</span>&nbsp;<span class="op" id="1556597">:=</span>&nbsp;<span class="op" id="1556600">(</span><span class="op" id="1556601">*</span><span class="ident" id="1556602">stringStruct</span><span class="op" id="1556614">)</span><span class="op" id="1556615">(</span><span class="ident" id="1556616">add</span><span class="op" id="1556619">(</span><span class="ident" id="1556620">unsafe</span><span class="op" id="1556626">.</span><span class="ident" id="1556627">Pointer</span><span class="op" id="1556634">(</span><span class="ident" id="1556635">b</span><span class="op" id="1556636">)</span><span class="op" id="1556637">,</span>&nbsp;<span class="ident" id="1556639">dataOffset</span><span class="op" id="1556649">+</span><span class="ident" id="1556650">keymaybe</span><span class="op" id="1556658">*</span><span class="num" id="1556659">2</span><span class="op" id="1556660">*</span><span class="ident" id="1556661">ptrSize</span><span class="op" id="1556668">)</span><span class="op" id="1556669">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1556674">if</span>&nbsp;<span class="ident" id="1556677">memeq</span><span class="op" id="1556682">(</span><span class="ident" id="1556683">k</span><span class="op" id="1556684">.</span><span class="ident" id="1556685">str</span><span class="op" id="1556688">,</span>&nbsp;<span class="ident" id="1556690">key</span><span class="op" id="1556693">.</span><span class="ident" id="1556694">str</span><span class="op" id="1556697">,</span>&nbsp;<span class="builtintype" id="1556699">uintptr</span><span class="op" id="1556706">(</span><span class="ident" id="1556707">key</span><span class="op" id="1556710">.</span><span class="builtinfunc" id="1556711">len</span><span class="op" id="1556714">)</span><span class="op" id="1556715">)</span>&nbsp;<span class="op" id="1556717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1556723">return</span>&nbsp;<span class="ident" id="1556730">add</span><span class="op" id="1556733">(</span><span class="ident" id="1556734">unsafe</span><span class="op" id="1556740">.</span><span class="ident" id="1556741">Pointer</span><span class="op" id="1556748">(</span><span class="ident" id="1556749">b</span><span class="op" id="1556750">)</span><span class="op" id="1556751">,</span>&nbsp;<span class="ident" id="1556753">dataOffset</span><span class="op" id="1556763">+</span><span class="ident" id="1556764">bucketCnt</span><span class="op" id="1556773">*</span><span class="num" id="1556774">2</span><span class="op" id="1556775">*</span><span class="ident" id="1556776">ptrSize</span><span class="op" id="1556783">+</span><span class="ident" id="1556784">keymaybe</span><span class="op" id="1556792">*</span><span class="builtintype" id="1556793">uintptr</span><span class="op" id="1556800">(</span><span class="ident" id="1556801">t</span><span class="op" id="1556802">.</span><span class="ident" id="1556803">valuesize</span><span class="op" id="1556812">)</span><span class="op" id="1556813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1556818">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1556822">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1556826">return</span>&nbsp;<span class="ident" id="1556833">unsafe</span><span class="op" id="1556839">.</span><span class="ident" id="1556840">Pointer</span><span class="op" id="1556847">(</span><span class="ident" id="1556848">t</span><span class="op" id="1556849">.</span><span class="ident" id="1556850">elem</span><span class="op" id="1556854">.</span><span class="ident" id="1556855">zero</span><span class="op" id="1556859">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1556862">}</span><br>
<span class="lineno"></span><span class="ident" id="1556864">dohash</span><span class="op" id="1556870">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1556873">hash</span>&nbsp;<span class="op" id="1556878">:=</span>&nbsp;<span class="ident" id="1556881">goalg</span><span class="op" id="1556886">(</span><span class="ident" id="1556887">t</span><span class="op" id="1556888">.</span><span class="ident" id="1556889">key</span><span class="op" id="1556892">.</span><span class="ident" id="1556893">alg</span><span class="op" id="1556896">)</span><span class="op" id="1556897">.</span><span class="ident" id="1556898">hash</span><span class="op" id="1556902">(</span><span class="ident" id="1556903">noescape</span><span class="op" id="1556911">(</span><span class="ident" id="1556912">unsafe</span><span class="op" id="1556918">.</span><span class="ident" id="1556919">Pointer</span><span class="op" id="1556926">(</span><span class="op" id="1556927">&amp;</span><span class="ident" id="1556928">ky</span><span class="op" id="1556930">)</span><span class="op" id="1556931">)</span><span class="op" id="1556932">,</span>&nbsp;<span class="num" id="1556934">2</span><span class="op" id="1556935">*</span><span class="ident" id="1556936">ptrSize</span><span class="op" id="1556943">,</span>&nbsp;<span class="builtintype" id="1556945">uintptr</span><span class="op" id="1556952">(</span><span class="ident" id="1556953">h</span><span class="op" id="1556954">.</span><span class="ident" id="1556955">hash0</span><span class="op" id="1556960">)</span><span class="op" id="1556961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1556964">m</span>&nbsp;<span class="op" id="1556966">:=</span>&nbsp;<span class="builtintype" id="1556969">uintptr</span><span class="op" id="1556976">(</span><span class="num" id="1556977">1</span><span class="op" id="1556978">)</span><span class="op" id="1556979">&lt;&lt;</span><span class="ident" id="1556981">h</span><span class="op" id="1556982">.</span><span class="ident" id="1556983">B</span>&nbsp;<span class="op" id="1556985">-</span>&nbsp;<span class="num" id="1556987">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1556990">b</span>&nbsp;<span class="op" id="1556992">:=</span>&nbsp;<span class="op" id="1556995">(</span><span class="op" id="1556996">*</span><span class="ident" id="1556997">bmap</span><span class="op" id="1557001">)</span><span class="op" id="1557002">(</span><span class="ident" id="1557003">add</span><span class="op" id="1557006">(</span><span class="ident" id="1557007">h</span><span class="op" id="1557008">.</span><span class="ident" id="1557009">buckets</span><span class="op" id="1557016">,</span>&nbsp;<span class="op" id="1557018">(</span><span class="ident" id="1557019">hash</span><span class="op" id="1557023">&amp;</span><span class="ident" id="1557024">m</span><span class="op" id="1557025">)</span><span class="op" id="1557026">*</span><span class="builtintype" id="1557027">uintptr</span><span class="op" id="1557034">(</span><span class="ident" id="1557035">t</span><span class="op" id="1557036">.</span><span class="ident" id="1557037">bucketsize</span><span class="op" id="1557047">)</span><span class="op" id="1557048">)</span><span class="op" id="1557049">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1557052">if</span>&nbsp;<span class="ident" id="1557055">c</span>&nbsp;<span class="op" id="1557057">:=</span>&nbsp;<span class="ident" id="1557060">h</span><span class="op" id="1557061">.</span><span class="ident" id="1557062">oldbuckets</span><span class="op" id="1557072">;</span>&nbsp;<span class="ident" id="1557074">c</span>&nbsp;<span class="op" id="1557076">!=</span>&nbsp;<span class="ident" id="1557079">nil</span>&nbsp;<span class="op" id="1557083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1557087">oldb</span>&nbsp;<span class="op" id="1557092">:=</span>&nbsp;<span class="op" id="1557095">(</span><span class="op" id="1557096">*</span><span class="ident" id="1557097">bmap</span><span class="op" id="1557101">)</span><span class="op" id="1557102">(</span><span class="ident" id="1557103">add</span><span class="op" id="1557106">(</span><span class="ident" id="1557107">c</span><span class="op" id="1557108">,</span>&nbsp;<span class="op" id="1557110">(</span><span class="ident" id="1557111">hash</span><span class="op" id="1557115">&amp;</span><span class="op" id="1557116">(</span><span class="ident" id="1557117">m</span><span class="op" id="1557118">&gt;&gt;</span><span class="num" id="1557120">1</span><span class="op" id="1557121">)</span><span class="op" id="1557122">)</span><span class="op" id="1557123">*</span><span class="builtintype" id="1557124">uintptr</span><span class="op" id="1557131">(</span><span class="ident" id="1557132">t</span><span class="op" id="1557133">.</span><span class="ident" id="1557134">bucketsize</span><span class="op" id="1557144">)</span><span class="op" id="1557145">)</span><span class="op" id="1557146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1557150">if</span>&nbsp;<span class="op" id="1557153">!</span><span class="ident" id="1557154">evacuated</span><span class="op" id="1557163">(</span><span class="ident" id="1557164">oldb</span><span class="op" id="1557168">)</span>&nbsp;<span class="op" id="1557170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1557175">b</span>&nbsp;<span class="op" id="1557177">=</span>&nbsp;<span class="ident" id="1557179">oldb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1557186">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1557189">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1557192">top</span>&nbsp;<span class="op" id="1557196">:=</span>&nbsp;<span class="builtintype" id="1557199">uint8</span><span class="op" id="1557204">(</span><span class="ident" id="1557205">hash</span>&nbsp;<span class="op" id="1557210">&gt;&gt;</span>&nbsp;<span class="op" id="1557213">(</span><span class="ident" id="1557214">ptrSize</span><span class="op" id="1557221">*</span><span class="num" id="1557222">8</span>&nbsp;<span class="op" id="1557224">-</span>&nbsp;<span class="num" id="1557226">8</span><span class="op" id="1557227">)</span><span class="op" id="1557228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1557231">if</span>&nbsp;<span class="ident" id="1557234">top</span>&nbsp;<span class="op" id="1557238">&lt;</span>&nbsp;<span class="ident" id="1557240">minTopHash</span>&nbsp;<span class="op" id="1557251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1557255">top</span>&nbsp;<span class="op" id="1557259">+=</span>&nbsp;<span class="ident" id="1557262">minTopHash</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1557274">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1557277">for</span>&nbsp;<span class="op" id="1557281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1557285">for</span>&nbsp;<span class="ident" id="1557289">i</span>&nbsp;<span class="op" id="1557291">:=</span>&nbsp;<span class="builtintype" id="1557294">uintptr</span><span class="op" id="1557301">(</span><span class="num" id="1557302">0</span><span class="op" id="1557303">)</span><span class="op" id="1557304">;</span>&nbsp;<span class="ident" id="1557306">i</span>&nbsp;<span class="op" id="1557308">&lt;</span>&nbsp;<span class="ident" id="1557310">bucketCnt</span><span class="op" id="1557319">;</span>&nbsp;<span class="ident" id="1557321">i</span><span class="op" id="1557322">++</span>&nbsp;<span class="op" id="1557325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1557330">x</span>&nbsp;<span class="op" id="1557332">:=</span>&nbsp;<span class="op" id="1557335">*</span><span class="op" id="1557336">(</span><span class="op" id="1557337">(</span><span class="op" id="1557338">*</span><span class="builtintype" id="1557339">uint8</span><span class="op" id="1557344">)</span><span class="op" id="1557345">(</span><span class="ident" id="1557346">add</span><span class="op" id="1557349">(</span><span class="ident" id="1557350">unsafe</span><span class="op" id="1557356">.</span><span class="ident" id="1557357">Pointer</span><span class="op" id="1557364">(</span><span class="ident" id="1557365">b</span><span class="op" id="1557366">)</span><span class="op" id="1557367">,</span>&nbsp;<span class="ident" id="1557369">i</span><span class="op" id="1557370">)</span><span class="op" id="1557371">)</span><span class="op" id="1557372">)</span>&nbsp;<span class="comment" id="1557374">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1557418">if</span>&nbsp;<span class="ident" id="1557421">x</span>&nbsp;<span class="op" id="1557423">!=</span>&nbsp;<span class="ident" id="1557426">top</span>&nbsp;<span class="op" id="1557430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1557436">continue</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1557448">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1557453">k</span>&nbsp;<span class="op" id="1557455">:=</span>&nbsp;<span class="op" id="1557458">(</span><span class="op" id="1557459">*</span><span class="ident" id="1557460">stringStruct</span><span class="op" id="1557472">)</span><span class="op" id="1557473">(</span><span class="ident" id="1557474">add</span><span class="op" id="1557477">(</span><span class="ident" id="1557478">unsafe</span><span class="op" id="1557484">.</span><span class="ident" id="1557485">Pointer</span><span class="op" id="1557492">(</span><span class="ident" id="1557493">b</span><span class="op" id="1557494">)</span><span class="op" id="1557495">,</span>&nbsp;<span class="ident" id="1557497">dataOffset</span><span class="op" id="1557507">+</span><span class="ident" id="1557508">i</span><span class="op" id="1557509">*</span><span class="num" id="1557510">2</span><span class="op" id="1557511">*</span><span class="ident" id="1557512">ptrSize</span><span class="op" id="1557519">)</span><span class="op" id="1557520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1557525">if</span>&nbsp;<span class="ident" id="1557528">k</span><span class="op" id="1557529">.</span><span class="builtinfunc" id="1557530">len</span>&nbsp;<span class="op" id="1557534">!=</span>&nbsp;<span class="ident" id="1557537">key</span><span class="op" id="1557540">.</span><span class="builtinfunc" id="1557541">len</span>&nbsp;<span class="op" id="1557545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1557551">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1557563">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1557568">if</span>&nbsp;<span class="ident" id="1557571">k</span><span class="op" id="1557572">.</span><span class="ident" id="1557573">str</span>&nbsp;<span class="op" id="1557577">==</span>&nbsp;<span class="ident" id="1557580">key</span><span class="op" id="1557583">.</span><span class="ident" id="1557584">str</span>&nbsp;<span class="op" id="1557588">||</span>&nbsp;<span class="ident" id="1557591">memeq</span><span class="op" id="1557596">(</span><span class="ident" id="1557597">k</span><span class="op" id="1557598">.</span><span class="ident" id="1557599">str</span><span class="op" id="1557602">,</span>&nbsp;<span class="ident" id="1557604">key</span><span class="op" id="1557607">.</span><span class="ident" id="1557608">str</span><span class="op" id="1557611">,</span>&nbsp;<span class="builtintype" id="1557613">uintptr</span><span class="op" id="1557620">(</span><span class="ident" id="1557621">key</span><span class="op" id="1557624">.</span><span class="builtinfunc" id="1557625">len</span><span class="op" id="1557628">)</span><span class="op" id="1557629">)</span>&nbsp;<span class="op" id="1557631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1557637">return</span>&nbsp;<span class="ident" id="1557644">add</span><span class="op" id="1557647">(</span><span class="ident" id="1557648">unsafe</span><span class="op" id="1557654">.</span><span class="ident" id="1557655">Pointer</span><span class="op" id="1557662">(</span><span class="ident" id="1557663">b</span><span class="op" id="1557664">)</span><span class="op" id="1557665">,</span>&nbsp;<span class="ident" id="1557667">dataOffset</span><span class="op" id="1557677">+</span><span class="ident" id="1557678">bucketCnt</span><span class="op" id="1557687">*</span><span class="num" id="1557688">2</span><span class="op" id="1557689">*</span><span class="ident" id="1557690">ptrSize</span><span class="op" id="1557697">+</span><span class="ident" id="1557698">i</span><span class="op" id="1557699">*</span><span class="builtintype" id="1557700">uintptr</span><span class="op" id="1557707">(</span><span class="ident" id="1557708">t</span><span class="op" id="1557709">.</span><span class="ident" id="1557710">valuesize</span><span class="op" id="1557719">)</span><span class="op" id="1557720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1557725">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1557729">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1557733">b</span>&nbsp;<span class="op" id="1557735">=</span>&nbsp;<span class="ident" id="1557737">b</span><span class="op" id="1557738">.</span><span class="ident" id="1557739">overflow</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1557750">if</span>&nbsp;<span class="ident" id="1557753">b</span>&nbsp;<span class="op" id="1557755">==</span>&nbsp;<span class="ident" id="1557758">nil</span>&nbsp;<span class="op" id="1557762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1557767">return</span>&nbsp;<span class="ident" id="1557774">unsafe</span><span class="op" id="1557780">.</span><span class="ident" id="1557781">Pointer</span><span class="op" id="1557788">(</span><span class="ident" id="1557789">t</span><span class="op" id="1557790">.</span><span class="ident" id="1557791">elem</span><span class="op" id="1557795">.</span><span class="ident" id="1557796">zero</span><span class="op" id="1557800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1557804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1557807">}</span><br>
<span class="lineno"></span><span class="op" id="1557809">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="keyword" id="1557812">func</span>&nbsp;<span class="ident" id="1557817">mapaccess2_faststr</span><span class="op" id="1557835">(</span><span class="ident" id="1557836">t</span>&nbsp;<span class="op" id="1557838">*</span><span class="ident" id="1557839">maptype</span><span class="op" id="1557846">,</span>&nbsp;<span class="ident" id="1557848">h</span>&nbsp;<span class="op" id="1557850">*</span><span class="ident" id="1557851">hmap</span><span class="op" id="1557855">,</span>&nbsp;<span class="ident" id="1557857">ky</span>&nbsp;<span class="builtintype" id="1557860">string</span><span class="op" id="1557866">)</span>&nbsp;<span class="op" id="1557868">(</span><span class="ident" id="1557869">unsafe</span><span class="op" id="1557875">.</span><span class="ident" id="1557876">Pointer</span><span class="op" id="1557883">,</span>&nbsp;<span class="builtintype" id="1557885">bool</span><span class="op" id="1557889">)</span>&nbsp;<span class="op" id="1557891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1557894">if</span>&nbsp;<span class="ident" id="1557897">raceenabled</span>&nbsp;<span class="op" id="1557909">&amp;&amp;</span>&nbsp;<span class="ident" id="1557912">h</span>&nbsp;<span class="op" id="1557914">!=</span>&nbsp;<span class="ident" id="1557917">nil</span>&nbsp;<span class="op" id="1557921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1557925">callerpc</span>&nbsp;<span class="op" id="1557934">:=</span>&nbsp;<span class="ident" id="1557937">getcallerpc</span><span class="op" id="1557948">(</span><span class="ident" id="1557949">unsafe</span><span class="op" id="1557955">.</span><span class="ident" id="1557956">Pointer</span><span class="op" id="1557963">(</span><span class="op" id="1557964">&amp;</span><span class="ident" id="1557965">t</span><span class="op" id="1557966">)</span><span class="op" id="1557967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1557971">racereadpc</span><span class="op" id="1557981">(</span><span class="ident" id="1557982">unsafe</span><span class="op" id="1557988">.</span><span class="ident" id="1557989">Pointer</span><span class="op" id="1557996">(</span><span class="ident" id="1557997">h</span><span class="op" id="1557998">)</span><span class="op" id="1557999">,</span>&nbsp;<span class="ident" id="1558001">callerpc</span><span class="op" id="1558009">,</span>&nbsp;<span class="ident" id="1558011">funcPC</span><span class="op" id="1558017">(</span><span class="ident" id="1558018">mapaccess2_faststr</span><span class="op" id="1558036">)</span><span class="op" id="1558037">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1558040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1558043">if</span>&nbsp;<span class="ident" id="1558046">h</span>&nbsp;<span class="op" id="1558048">==</span>&nbsp;<span class="ident" id="1558051">nil</span>&nbsp;<span class="op" id="1558055">||</span>&nbsp;<span class="ident" id="1558058">h</span><span class="op" id="1558059">.</span><span class="ident" id="1558060">count</span>&nbsp;<span class="op" id="1558066">==</span>&nbsp;<span class="num" id="1558069">0</span>&nbsp;<span class="op" id="1558071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1558075">return</span>&nbsp;<span class="ident" id="1558082">unsafe</span><span class="op" id="1558088">.</span><span class="ident" id="1558089">Pointer</span><span class="op" id="1558096">(</span><span class="ident" id="1558097">t</span><span class="op" id="1558098">.</span><span class="ident" id="1558099">elem</span><span class="op" id="1558103">.</span><span class="ident" id="1558104">zero</span><span class="op" id="1558108">)</span><span class="op" id="1558109">,</span>&nbsp;<span class="ident" id="1558111">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1558118">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1558121">key</span>&nbsp;<span class="op" id="1558125">:=</span>&nbsp;<span class="op" id="1558128">(</span><span class="op" id="1558129">*</span><span class="ident" id="1558130">stringStruct</span><span class="op" id="1558142">)</span><span class="op" id="1558143">(</span><span class="ident" id="1558144">unsafe</span><span class="op" id="1558150">.</span><span class="ident" id="1558151">Pointer</span><span class="op" id="1558158">(</span><span class="op" id="1558159">&amp;</span><span class="ident" id="1558160">ky</span><span class="op" id="1558162">)</span><span class="op" id="1558163">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1558166">if</span>&nbsp;<span class="ident" id="1558169">h</span><span class="op" id="1558170">.</span><span class="ident" id="1558171">B</span>&nbsp;<span class="op" id="1558173">==</span>&nbsp;<span class="num" id="1558176">0</span>&nbsp;<span class="op" id="1558178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1558182">//&nbsp;One-bucket&nbsp;table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1558205">b</span>&nbsp;<span class="op" id="1558207">:=</span>&nbsp;<span class="op" id="1558210">(</span><span class="op" id="1558211">*</span><span class="ident" id="1558212">bmap</span><span class="op" id="1558216">)</span><span class="op" id="1558217">(</span><span class="ident" id="1558218">h</span><span class="op" id="1558219">.</span><span class="ident" id="1558220">buckets</span><span class="op" id="1558227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1558231">if</span>&nbsp;<span class="ident" id="1558234">key</span><span class="op" id="1558237">.</span><span class="builtinfunc" id="1558238">len</span>&nbsp;<span class="op" id="1558242">&lt;</span>&nbsp;<span class="num" id="1558244">32</span>&nbsp;<span class="op" id="1558247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1558252">//&nbsp;short&nbsp;key,&nbsp;doing&nbsp;lots&nbsp;of&nbsp;comparisons&nbsp;is&nbsp;ok</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1558301">for</span>&nbsp;<span class="ident" id="1558305">i</span>&nbsp;<span class="op" id="1558307">:=</span>&nbsp;<span class="builtintype" id="1558310">uintptr</span><span class="op" id="1558317">(</span><span class="num" id="1558318">0</span><span class="op" id="1558319">)</span><span class="op" id="1558320">;</span>&nbsp;<span class="ident" id="1558322">i</span>&nbsp;<span class="op" id="1558324">&lt;</span>&nbsp;<span class="ident" id="1558326">bucketCnt</span><span class="op" id="1558335">;</span>&nbsp;<span class="ident" id="1558337">i</span><span class="op" id="1558338">++</span>&nbsp;<span class="op" id="1558341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1558347">x</span>&nbsp;<span class="op" id="1558349">:=</span>&nbsp;<span class="op" id="1558352">*</span><span class="op" id="1558353">(</span><span class="op" id="1558354">(</span><span class="op" id="1558355">*</span><span class="builtintype" id="1558356">uint8</span><span class="op" id="1558361">)</span><span class="op" id="1558362">(</span><span class="ident" id="1558363">add</span><span class="op" id="1558366">(</span><span class="ident" id="1558367">unsafe</span><span class="op" id="1558373">.</span><span class="ident" id="1558374">Pointer</span><span class="op" id="1558381">(</span><span class="ident" id="1558382">b</span><span class="op" id="1558383">)</span><span class="op" id="1558384">,</span>&nbsp;<span class="ident" id="1558386">i</span><span class="op" id="1558387">)</span><span class="op" id="1558388">)</span><span class="op" id="1558389">)</span>&nbsp;<span class="comment" id="1558391">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1558436">if</span>&nbsp;<span class="ident" id="1558439">x</span>&nbsp;<span class="op" id="1558441">==</span>&nbsp;<span class="ident" id="1558444">empty</span>&nbsp;<span class="op" id="1558450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1558457">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1558470">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1558476">k</span>&nbsp;<span class="op" id="1558478">:=</span>&nbsp;<span class="op" id="1558481">(</span><span class="op" id="1558482">*</span><span class="ident" id="1558483">stringStruct</span><span class="op" id="1558495">)</span><span class="op" id="1558496">(</span><span class="ident" id="1558497">add</span><span class="op" id="1558500">(</span><span class="ident" id="1558501">unsafe</span><span class="op" id="1558507">.</span><span class="ident" id="1558508">Pointer</span><span class="op" id="1558515">(</span><span class="ident" id="1558516">b</span><span class="op" id="1558517">)</span><span class="op" id="1558518">,</span>&nbsp;<span class="ident" id="1558520">dataOffset</span><span class="op" id="1558530">+</span><span class="ident" id="1558531">i</span><span class="op" id="1558532">*</span><span class="num" id="1558533">2</span><span class="op" id="1558534">*</span><span class="ident" id="1558535">ptrSize</span><span class="op" id="1558542">)</span><span class="op" id="1558543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1558549">if</span>&nbsp;<span class="ident" id="1558552">k</span><span class="op" id="1558553">.</span><span class="builtinfunc" id="1558554">len</span>&nbsp;<span class="op" id="1558558">!=</span>&nbsp;<span class="ident" id="1558561">key</span><span class="op" id="1558564">.</span><span class="builtinfunc" id="1558565">len</span>&nbsp;<span class="op" id="1558569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1558576">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1558589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1558595">if</span>&nbsp;<span class="ident" id="1558598">k</span><span class="op" id="1558599">.</span><span class="ident" id="1558600">str</span>&nbsp;<span class="op" id="1558604">==</span>&nbsp;<span class="ident" id="1558607">key</span><span class="op" id="1558610">.</span><span class="ident" id="1558611">str</span>&nbsp;<span class="op" id="1558615">||</span>&nbsp;<span class="ident" id="1558618">memeq</span><span class="op" id="1558623">(</span><span class="ident" id="1558624">k</span><span class="op" id="1558625">.</span><span class="ident" id="1558626">str</span><span class="op" id="1558629">,</span>&nbsp;<span class="ident" id="1558631">key</span><span class="op" id="1558634">.</span><span class="ident" id="1558635">str</span><span class="op" id="1558638">,</span>&nbsp;<span class="builtintype" id="1558640">uintptr</span><span class="op" id="1558647">(</span><span class="ident" id="1558648">key</span><span class="op" id="1558651">.</span><span class="builtinfunc" id="1558652">len</span><span class="op" id="1558655">)</span><span class="op" id="1558656">)</span>&nbsp;<span class="op" id="1558658">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1558665">return</span>&nbsp;<span class="ident" id="1558672">add</span><span class="op" id="1558675">(</span><span class="ident" id="1558676">unsafe</span><span class="op" id="1558682">.</span><span class="ident" id="1558683">Pointer</span><span class="op" id="1558690">(</span><span class="ident" id="1558691">b</span><span class="op" id="1558692">)</span><span class="op" id="1558693">,</span>&nbsp;<span class="ident" id="1558695">dataOffset</span><span class="op" id="1558705">+</span><span class="ident" id="1558706">bucketCnt</span><span class="op" id="1558715">*</span><span class="num" id="1558716">2</span><span class="op" id="1558717">*</span><span class="ident" id="1558718">ptrSize</span><span class="op" id="1558725">+</span><span class="ident" id="1558726">i</span><span class="op" id="1558727">*</span><span class="builtintype" id="1558728">uintptr</span><span class="op" id="1558735">(</span><span class="ident" id="1558736">t</span><span class="op" id="1558737">.</span><span class="ident" id="1558738">valuesize</span><span class="op" id="1558747">)</span><span class="op" id="1558748">)</span><span class="op" id="1558749">,</span>&nbsp;<span class="ident" id="1558751">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1558760">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1558765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1558770">return</span>&nbsp;<span class="ident" id="1558777">unsafe</span><span class="op" id="1558783">.</span><span class="ident" id="1558784">Pointer</span><span class="op" id="1558791">(</span><span class="ident" id="1558792">t</span><span class="op" id="1558793">.</span><span class="ident" id="1558794">elem</span><span class="op" id="1558798">.</span><span class="ident" id="1558799">zero</span><span class="op" id="1558803">)</span><span class="op" id="1558804">,</span>&nbsp;<span class="ident" id="1558806">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1558814">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1558818">//&nbsp;long&nbsp;key,&nbsp;try&nbsp;not&nbsp;to&nbsp;do&nbsp;more&nbsp;comparisons&nbsp;than&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1558879">keymaybe</span>&nbsp;<span class="op" id="1558888">:=</span>&nbsp;<span class="builtintype" id="1558891">uintptr</span><span class="op" id="1558898">(</span><span class="ident" id="1558899">bucketCnt</span><span class="op" id="1558908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1558912">for</span>&nbsp;<span class="ident" id="1558916">i</span>&nbsp;<span class="op" id="1558918">:=</span>&nbsp;<span class="builtintype" id="1558921">uintptr</span><span class="op" id="1558928">(</span><span class="num" id="1558929">0</span><span class="op" id="1558930">)</span><span class="op" id="1558931">;</span>&nbsp;<span class="ident" id="1558933">i</span>&nbsp;<span class="op" id="1558935">&lt;</span>&nbsp;<span class="ident" id="1558937">bucketCnt</span><span class="op" id="1558946">;</span>&nbsp;<span class="ident" id="1558948">i</span><span class="op" id="1558949">++</span>&nbsp;<span class="op" id="1558952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1558957">x</span>&nbsp;<span class="op" id="1558959">:=</span>&nbsp;<span class="op" id="1558962">*</span><span class="op" id="1558963">(</span><span class="op" id="1558964">(</span><span class="op" id="1558965">*</span><span class="builtintype" id="1558966">uint8</span><span class="op" id="1558971">)</span><span class="op" id="1558972">(</span><span class="ident" id="1558973">add</span><span class="op" id="1558976">(</span><span class="ident" id="1558977">unsafe</span><span class="op" id="1558983">.</span><span class="ident" id="1558984">Pointer</span><span class="op" id="1558991">(</span><span class="ident" id="1558992">b</span><span class="op" id="1558993">)</span><span class="op" id="1558994">,</span>&nbsp;<span class="ident" id="1558996">i</span><span class="op" id="1558997">)</span><span class="op" id="1558998">)</span><span class="op" id="1558999">)</span>&nbsp;<span class="comment" id="1559001">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1559045">if</span>&nbsp;<span class="ident" id="1559048">x</span>&nbsp;<span class="op" id="1559050">==</span>&nbsp;<span class="ident" id="1559053">empty</span>&nbsp;<span class="op" id="1559059">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1559065">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1559077">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1559082">k</span>&nbsp;<span class="op" id="1559084">:=</span>&nbsp;<span class="op" id="1559087">(</span><span class="op" id="1559088">*</span><span class="ident" id="1559089">stringStruct</span><span class="op" id="1559101">)</span><span class="op" id="1559102">(</span><span class="ident" id="1559103">add</span><span class="op" id="1559106">(</span><span class="ident" id="1559107">unsafe</span><span class="op" id="1559113">.</span><span class="ident" id="1559114">Pointer</span><span class="op" id="1559121">(</span><span class="ident" id="1559122">b</span><span class="op" id="1559123">)</span><span class="op" id="1559124">,</span>&nbsp;<span class="ident" id="1559126">dataOffset</span><span class="op" id="1559136">+</span><span class="ident" id="1559137">i</span><span class="op" id="1559138">*</span><span class="num" id="1559139">2</span><span class="op" id="1559140">*</span><span class="ident" id="1559141">ptrSize</span><span class="op" id="1559148">)</span><span class="op" id="1559149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1559154">if</span>&nbsp;<span class="ident" id="1559157">k</span><span class="op" id="1559158">.</span><span class="builtinfunc" id="1559159">len</span>&nbsp;<span class="op" id="1559163">!=</span>&nbsp;<span class="ident" id="1559166">key</span><span class="op" id="1559169">.</span><span class="builtinfunc" id="1559170">len</span>&nbsp;<span class="op" id="1559174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1559180">continue</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1559192">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1559197">if</span>&nbsp;<span class="ident" id="1559200">k</span><span class="op" id="1559201">.</span><span class="ident" id="1559202">str</span>&nbsp;<span class="op" id="1559206">==</span>&nbsp;<span class="ident" id="1559209">key</span><span class="op" id="1559212">.</span><span class="ident" id="1559213">str</span>&nbsp;<span class="op" id="1559217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1559223">return</span>&nbsp;<span class="ident" id="1559230">add</span><span class="op" id="1559233">(</span><span class="ident" id="1559234">unsafe</span><span class="op" id="1559240">.</span><span class="ident" id="1559241">Pointer</span><span class="op" id="1559248">(</span><span class="ident" id="1559249">b</span><span class="op" id="1559250">)</span><span class="op" id="1559251">,</span>&nbsp;<span class="ident" id="1559253">dataOffset</span><span class="op" id="1559263">+</span><span class="ident" id="1559264">bucketCnt</span><span class="op" id="1559273">*</span><span class="num" id="1559274">2</span><span class="op" id="1559275">*</span><span class="ident" id="1559276">ptrSize</span><span class="op" id="1559283">+</span><span class="ident" id="1559284">i</span><span class="op" id="1559285">*</span><span class="builtintype" id="1559286">uintptr</span><span class="op" id="1559293">(</span><span class="ident" id="1559294">t</span><span class="op" id="1559295">.</span><span class="ident" id="1559296">valuesize</span><span class="op" id="1559305">)</span><span class="op" id="1559306">)</span><span class="op" id="1559307">,</span>&nbsp;<span class="ident" id="1559309">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1559317">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1559322">//&nbsp;check&nbsp;first&nbsp;4&nbsp;bytes</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1559348">if</span>&nbsp;<span class="op" id="1559351">*</span><span class="op" id="1559352">(</span><span class="op" id="1559353">(</span><span class="op" id="1559354">*</span><span class="op" id="1559355">[</span><span class="num" id="1559356">4</span><span class="op" id="1559357">]</span><span class="builtintype" id="1559358">byte</span><span class="op" id="1559362">)</span><span class="op" id="1559363">(</span><span class="ident" id="1559364">key</span><span class="op" id="1559367">.</span><span class="ident" id="1559368">str</span><span class="op" id="1559371">)</span><span class="op" id="1559372">)</span>&nbsp;<span class="op" id="1559374">!=</span>&nbsp;<span class="op" id="1559377">*</span><span class="op" id="1559378">(</span><span class="op" id="1559379">(</span><span class="op" id="1559380">*</span><span class="op" id="1559381">[</span><span class="num" id="1559382">4</span><span class="op" id="1559383">]</span><span class="builtintype" id="1559384">byte</span><span class="op" id="1559388">)</span><span class="op" id="1559389">(</span><span class="ident" id="1559390">k</span><span class="op" id="1559391">.</span><span class="ident" id="1559392">str</span><span class="op" id="1559395">)</span><span class="op" id="1559396">)</span>&nbsp;<span class="op" id="1559398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1559404">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1559416">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1559421">//&nbsp;check&nbsp;last&nbsp;4&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1559446">if</span>&nbsp;<span class="op" id="1559449">*</span><span class="op" id="1559450">(</span><span class="op" id="1559451">(</span><span class="op" id="1559452">*</span><span class="op" id="1559453">[</span><span class="num" id="1559454">4</span><span class="op" id="1559455">]</span><span class="builtintype" id="1559456">byte</span><span class="op" id="1559460">)</span><span class="op" id="1559461">(</span><span class="ident" id="1559462">add</span><span class="op" id="1559465">(</span><span class="ident" id="1559466">key</span><span class="op" id="1559469">.</span><span class="ident" id="1559470">str</span><span class="op" id="1559473">,</span>&nbsp;<span class="builtintype" id="1559475">uintptr</span><span class="op" id="1559482">(</span><span class="ident" id="1559483">key</span><span class="op" id="1559486">.</span><span class="builtinfunc" id="1559487">len</span><span class="op" id="1559490">)</span><span class="op" id="1559491">-</span><span class="num" id="1559492">4</span><span class="op" id="1559493">)</span><span class="op" id="1559494">)</span><span class="op" id="1559495">)</span>&nbsp;<span class="op" id="1559497">!=</span>&nbsp;<span class="op" id="1559500">*</span><span class="op" id="1559501">(</span><span class="op" id="1559502">(</span><span class="op" id="1559503">*</span><span class="op" id="1559504">[</span><span class="num" id="1559505">4</span><span class="op" id="1559506">]</span><span class="builtintype" id="1559507">byte</span><span class="op" id="1559511">)</span><span class="op" id="1559512">(</span><span class="ident" id="1559513">add</span><span class="op" id="1559516">(</span><span class="ident" id="1559517">k</span><span class="op" id="1559518">.</span><span class="ident" id="1559519">str</span><span class="op" id="1559522">,</span>&nbsp;<span class="builtintype" id="1559524">uintptr</span><span class="op" id="1559531">(</span><span class="ident" id="1559532">key</span><span class="op" id="1559535">.</span><span class="builtinfunc" id="1559536">len</span><span class="op" id="1559539">)</span><span class="op" id="1559540">-</span><span class="num" id="1559541">4</span><span class="op" id="1559542">)</span><span class="op" id="1559543">)</span><span class="op" id="1559544">)</span>&nbsp;<span class="op" id="1559546">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1559552">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1559564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1559569">if</span>&nbsp;<span class="ident" id="1559572">keymaybe</span>&nbsp;<span class="op" id="1559581">!=</span>&nbsp;<span class="ident" id="1559584">bucketCnt</span>&nbsp;<span class="op" id="1559594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1559600">//&nbsp;Two&nbsp;keys&nbsp;are&nbsp;potential&nbsp;matches.&nbsp;&nbsp;Use&nbsp;hash&nbsp;to&nbsp;distinguish&nbsp;them.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1559670">goto</span>&nbsp;<span class="ident" id="1559675">dohash</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1559685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1559690">keymaybe</span>&nbsp;<span class="op" id="1559699">=</span>&nbsp;<span class="ident" id="1559701">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1559705">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1559709">if</span>&nbsp;<span class="ident" id="1559712">keymaybe</span>&nbsp;<span class="op" id="1559721">!=</span>&nbsp;<span class="ident" id="1559724">bucketCnt</span>&nbsp;<span class="op" id="1559734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1559739">k</span>&nbsp;<span class="op" id="1559741">:=</span>&nbsp;<span class="op" id="1559744">(</span><span class="op" id="1559745">*</span><span class="ident" id="1559746">stringStruct</span><span class="op" id="1559758">)</span><span class="op" id="1559759">(</span><span class="ident" id="1559760">add</span><span class="op" id="1559763">(</span><span class="ident" id="1559764">unsafe</span><span class="op" id="1559770">.</span><span class="ident" id="1559771">Pointer</span><span class="op" id="1559778">(</span><span class="ident" id="1559779">b</span><span class="op" id="1559780">)</span><span class="op" id="1559781">,</span>&nbsp;<span class="ident" id="1559783">dataOffset</span><span class="op" id="1559793">+</span><span class="ident" id="1559794">keymaybe</span><span class="op" id="1559802">*</span><span class="num" id="1559803">2</span><span class="op" id="1559804">*</span><span class="ident" id="1559805">ptrSize</span><span class="op" id="1559812">)</span><span class="op" id="1559813">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1559818">if</span>&nbsp;<span class="ident" id="1559821">memeq</span><span class="op" id="1559826">(</span><span class="ident" id="1559827">k</span><span class="op" id="1559828">.</span><span class="ident" id="1559829">str</span><span class="op" id="1559832">,</span>&nbsp;<span class="ident" id="1559834">key</span><span class="op" id="1559837">.</span><span class="ident" id="1559838">str</span><span class="op" id="1559841">,</span>&nbsp;<span class="builtintype" id="1559843">uintptr</span><span class="op" id="1559850">(</span><span class="ident" id="1559851">key</span><span class="op" id="1559854">.</span><span class="builtinfunc" id="1559855">len</span><span class="op" id="1559858">)</span><span class="op" id="1559859">)</span>&nbsp;<span class="op" id="1559861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1559867">return</span>&nbsp;<span class="ident" id="1559874">add</span><span class="op" id="1559877">(</span><span class="ident" id="1559878">unsafe</span><span class="op" id="1559884">.</span><span class="ident" id="1559885">Pointer</span><span class="op" id="1559892">(</span><span class="ident" id="1559893">b</span><span class="op" id="1559894">)</span><span class="op" id="1559895">,</span>&nbsp;<span class="ident" id="1559897">dataOffset</span><span class="op" id="1559907">+</span><span class="ident" id="1559908">bucketCnt</span><span class="op" id="1559917">*</span><span class="num" id="1559918">2</span><span class="op" id="1559919">*</span><span class="ident" id="1559920">ptrSize</span><span class="op" id="1559927">+</span><span class="ident" id="1559928">keymaybe</span><span class="op" id="1559936">*</span><span class="builtintype" id="1559937">uintptr</span><span class="op" id="1559944">(</span><span class="ident" id="1559945">t</span><span class="op" id="1559946">.</span><span class="ident" id="1559947">valuesize</span><span class="op" id="1559956">)</span><span class="op" id="1559957">)</span><span class="op" id="1559958">,</span>&nbsp;<span class="ident" id="1559960">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1559968">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1559972">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1559976">return</span>&nbsp;<span class="ident" id="1559983">unsafe</span><span class="op" id="1559989">.</span><span class="ident" id="1559990">Pointer</span><span class="op" id="1559997">(</span><span class="ident" id="1559998">t</span><span class="op" id="1559999">.</span><span class="ident" id="1560000">elem</span><span class="op" id="1560004">.</span><span class="ident" id="1560005">zero</span><span class="op" id="1560009">)</span><span class="op" id="1560010">,</span>&nbsp;<span class="ident" id="1560012">false</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1560019">}</span><br>
<span class="lineno"></span><span class="ident" id="1560021">dohash</span><span class="op" id="1560027">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1560030">hash</span>&nbsp;<span class="op" id="1560035">:=</span>&nbsp;<span class="ident" id="1560038">goalg</span><span class="op" id="1560043">(</span><span class="ident" id="1560044">t</span><span class="op" id="1560045">.</span><span class="ident" id="1560046">key</span><span class="op" id="1560049">.</span><span class="ident" id="1560050">alg</span><span class="op" id="1560053">)</span><span class="op" id="1560054">.</span><span class="ident" id="1560055">hash</span><span class="op" id="1560059">(</span><span class="ident" id="1560060">noescape</span><span class="op" id="1560068">(</span><span class="ident" id="1560069">unsafe</span><span class="op" id="1560075">.</span><span class="ident" id="1560076">Pointer</span><span class="op" id="1560083">(</span><span class="op" id="1560084">&amp;</span><span class="ident" id="1560085">ky</span><span class="op" id="1560087">)</span><span class="op" id="1560088">)</span><span class="op" id="1560089">,</span>&nbsp;<span class="num" id="1560091">2</span><span class="op" id="1560092">*</span><span class="ident" id="1560093">ptrSize</span><span class="op" id="1560100">,</span>&nbsp;<span class="builtintype" id="1560102">uintptr</span><span class="op" id="1560109">(</span><span class="ident" id="1560110">h</span><span class="op" id="1560111">.</span><span class="ident" id="1560112">hash0</span><span class="op" id="1560117">)</span><span class="op" id="1560118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1560121">m</span>&nbsp;<span class="op" id="1560123">:=</span>&nbsp;<span class="builtintype" id="1560126">uintptr</span><span class="op" id="1560133">(</span><span class="num" id="1560134">1</span><span class="op" id="1560135">)</span><span class="op" id="1560136">&lt;&lt;</span><span class="ident" id="1560138">h</span><span class="op" id="1560139">.</span><span class="ident" id="1560140">B</span>&nbsp;<span class="op" id="1560142">-</span>&nbsp;<span class="num" id="1560144">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1560147">b</span>&nbsp;<span class="op" id="1560149">:=</span>&nbsp;<span class="op" id="1560152">(</span><span class="op" id="1560153">*</span><span class="ident" id="1560154">bmap</span><span class="op" id="1560158">)</span><span class="op" id="1560159">(</span><span class="ident" id="1560160">add</span><span class="op" id="1560163">(</span><span class="ident" id="1560164">h</span><span class="op" id="1560165">.</span><span class="ident" id="1560166">buckets</span><span class="op" id="1560173">,</span>&nbsp;<span class="op" id="1560175">(</span><span class="ident" id="1560176">hash</span><span class="op" id="1560180">&amp;</span><span class="ident" id="1560181">m</span><span class="op" id="1560182">)</span><span class="op" id="1560183">*</span><span class="builtintype" id="1560184">uintptr</span><span class="op" id="1560191">(</span><span class="ident" id="1560192">t</span><span class="op" id="1560193">.</span><span class="ident" id="1560194">bucketsize</span><span class="op" id="1560204">)</span><span class="op" id="1560205">)</span><span class="op" id="1560206">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1560209">if</span>&nbsp;<span class="ident" id="1560212">c</span>&nbsp;<span class="op" id="1560214">:=</span>&nbsp;<span class="ident" id="1560217">h</span><span class="op" id="1560218">.</span><span class="ident" id="1560219">oldbuckets</span><span class="op" id="1560229">;</span>&nbsp;<span class="ident" id="1560231">c</span>&nbsp;<span class="op" id="1560233">!=</span>&nbsp;<span class="ident" id="1560236">nil</span>&nbsp;<span class="op" id="1560240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1560244">oldb</span>&nbsp;<span class="op" id="1560249">:=</span>&nbsp;<span class="op" id="1560252">(</span><span class="op" id="1560253">*</span><span class="ident" id="1560254">bmap</span><span class="op" id="1560258">)</span><span class="op" id="1560259">(</span><span class="ident" id="1560260">add</span><span class="op" id="1560263">(</span><span class="ident" id="1560264">c</span><span class="op" id="1560265">,</span>&nbsp;<span class="op" id="1560267">(</span><span class="ident" id="1560268">hash</span><span class="op" id="1560272">&amp;</span><span class="op" id="1560273">(</span><span class="ident" id="1560274">m</span><span class="op" id="1560275">&gt;&gt;</span><span class="num" id="1560277">1</span><span class="op" id="1560278">)</span><span class="op" id="1560279">)</span><span class="op" id="1560280">*</span><span class="builtintype" id="1560281">uintptr</span><span class="op" id="1560288">(</span><span class="ident" id="1560289">t</span><span class="op" id="1560290">.</span><span class="ident" id="1560291">bucketsize</span><span class="op" id="1560301">)</span><span class="op" id="1560302">)</span><span class="op" id="1560303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1560307">if</span>&nbsp;<span class="op" id="1560310">!</span><span class="ident" id="1560311">evacuated</span><span class="op" id="1560320">(</span><span class="ident" id="1560321">oldb</span><span class="op" id="1560325">)</span>&nbsp;<span class="op" id="1560327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1560332">b</span>&nbsp;<span class="op" id="1560334">=</span>&nbsp;<span class="ident" id="1560336">oldb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1560343">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1560346">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1560349">top</span>&nbsp;<span class="op" id="1560353">:=</span>&nbsp;<span class="builtintype" id="1560356">uint8</span><span class="op" id="1560361">(</span><span class="ident" id="1560362">hash</span>&nbsp;<span class="op" id="1560367">&gt;&gt;</span>&nbsp;<span class="op" id="1560370">(</span><span class="ident" id="1560371">ptrSize</span><span class="op" id="1560378">*</span><span class="num" id="1560379">8</span>&nbsp;<span class="op" id="1560381">-</span>&nbsp;<span class="num" id="1560383">8</span><span class="op" id="1560384">)</span><span class="op" id="1560385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1560388">if</span>&nbsp;<span class="ident" id="1560391">top</span>&nbsp;<span class="op" id="1560395">&lt;</span>&nbsp;<span class="ident" id="1560397">minTopHash</span>&nbsp;<span class="op" id="1560408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1560412">top</span>&nbsp;<span class="op" id="1560416">+=</span>&nbsp;<span class="ident" id="1560419">minTopHash</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1560431">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1560434">for</span>&nbsp;<span class="op" id="1560438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1560442">for</span>&nbsp;<span class="ident" id="1560446">i</span>&nbsp;<span class="op" id="1560448">:=</span>&nbsp;<span class="builtintype" id="1560451">uintptr</span><span class="op" id="1560458">(</span><span class="num" id="1560459">0</span><span class="op" id="1560460">)</span><span class="op" id="1560461">;</span>&nbsp;<span class="ident" id="1560463">i</span>&nbsp;<span class="op" id="1560465">&lt;</span>&nbsp;<span class="ident" id="1560467">bucketCnt</span><span class="op" id="1560476">;</span>&nbsp;<span class="ident" id="1560478">i</span><span class="op" id="1560479">++</span>&nbsp;<span class="op" id="1560482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1560487">x</span>&nbsp;<span class="op" id="1560489">:=</span>&nbsp;<span class="op" id="1560492">*</span><span class="op" id="1560493">(</span><span class="op" id="1560494">(</span><span class="op" id="1560495">*</span><span class="builtintype" id="1560496">uint8</span><span class="op" id="1560501">)</span><span class="op" id="1560502">(</span><span class="ident" id="1560503">add</span><span class="op" id="1560506">(</span><span class="ident" id="1560507">unsafe</span><span class="op" id="1560513">.</span><span class="ident" id="1560514">Pointer</span><span class="op" id="1560521">(</span><span class="ident" id="1560522">b</span><span class="op" id="1560523">)</span><span class="op" id="1560524">,</span>&nbsp;<span class="ident" id="1560526">i</span><span class="op" id="1560527">)</span><span class="op" id="1560528">)</span><span class="op" id="1560529">)</span>&nbsp;<span class="comment" id="1560531">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1560575">if</span>&nbsp;<span class="ident" id="1560578">x</span>&nbsp;<span class="op" id="1560580">!=</span>&nbsp;<span class="ident" id="1560583">top</span>&nbsp;<span class="op" id="1560587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1560593">continue</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1560605">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1560610">k</span>&nbsp;<span class="op" id="1560612">:=</span>&nbsp;<span class="op" id="1560615">(</span><span class="op" id="1560616">*</span><span class="ident" id="1560617">stringStruct</span><span class="op" id="1560629">)</span><span class="op" id="1560630">(</span><span class="ident" id="1560631">add</span><span class="op" id="1560634">(</span><span class="ident" id="1560635">unsafe</span><span class="op" id="1560641">.</span><span class="ident" id="1560642">Pointer</span><span class="op" id="1560649">(</span><span class="ident" id="1560650">b</span><span class="op" id="1560651">)</span><span class="op" id="1560652">,</span>&nbsp;<span class="ident" id="1560654">dataOffset</span><span class="op" id="1560664">+</span><span class="ident" id="1560665">i</span><span class="op" id="1560666">*</span><span class="num" id="1560667">2</span><span class="op" id="1560668">*</span><span class="ident" id="1560669">ptrSize</span><span class="op" id="1560676">)</span><span class="op" id="1560677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1560682">if</span>&nbsp;<span class="ident" id="1560685">k</span><span class="op" id="1560686">.</span><span class="builtinfunc" id="1560687">len</span>&nbsp;<span class="op" id="1560691">!=</span>&nbsp;<span class="ident" id="1560694">key</span><span class="op" id="1560697">.</span><span class="builtinfunc" id="1560698">len</span>&nbsp;<span class="op" id="1560702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1560708">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1560720">}</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1560725">if</span>&nbsp;<span class="ident" id="1560728">k</span><span class="op" id="1560729">.</span><span class="ident" id="1560730">str</span>&nbsp;<span class="op" id="1560734">==</span>&nbsp;<span class="ident" id="1560737">key</span><span class="op" id="1560740">.</span><span class="ident" id="1560741">str</span>&nbsp;<span class="op" id="1560745">||</span>&nbsp;<span class="ident" id="1560748">memeq</span><span class="op" id="1560753">(</span><span class="ident" id="1560754">k</span><span class="op" id="1560755">.</span><span class="ident" id="1560756">str</span><span class="op" id="1560759">,</span>&nbsp;<span class="ident" id="1560761">key</span><span class="op" id="1560764">.</span><span class="ident" id="1560765">str</span><span class="op" id="1560768">,</span>&nbsp;<span class="builtintype" id="1560770">uintptr</span><span class="op" id="1560777">(</span><span class="ident" id="1560778">key</span><span class="op" id="1560781">.</span><span class="builtinfunc" id="1560782">len</span><span class="op" id="1560785">)</span><span class="op" id="1560786">)</span>&nbsp;<span class="op" id="1560788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1560794">return</span>&nbsp;<span class="ident" id="1560801">add</span><span class="op" id="1560804">(</span><span class="ident" id="1560805">unsafe</span><span class="op" id="1560811">.</span><span class="ident" id="1560812">Pointer</span><span class="op" id="1560819">(</span><span class="ident" id="1560820">b</span><span class="op" id="1560821">)</span><span class="op" id="1560822">,</span>&nbsp;<span class="ident" id="1560824">dataOffset</span><span class="op" id="1560834">+</span><span class="ident" id="1560835">bucketCnt</span><span class="op" id="1560844">*</span><span class="num" id="1560845">2</span><span class="op" id="1560846">*</span><span class="ident" id="1560847">ptrSize</span><span class="op" id="1560854">+</span><span class="ident" id="1560855">i</span><span class="op" id="1560856">*</span><span class="builtintype" id="1560857">uintptr</span><span class="op" id="1560864">(</span><span class="ident" id="1560865">t</span><span class="op" id="1560866">.</span><span class="ident" id="1560867">valuesize</span><span class="op" id="1560876">)</span><span class="op" id="1560877">)</span><span class="op" id="1560878">,</span>&nbsp;<span class="ident" id="1560880">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1560888">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1560892">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1560896">b</span>&nbsp;<span class="op" id="1560898">=</span>&nbsp;<span class="ident" id="1560900">b</span><span class="op" id="1560901">.</span><span class="ident" id="1560902">overflow</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1560913">if</span>&nbsp;<span class="ident" id="1560916">b</span>&nbsp;<span class="op" id="1560918">==</span>&nbsp;<span class="ident" id="1560921">nil</span>&nbsp;<span class="op" id="1560925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1560930">return</span>&nbsp;<span class="ident" id="1560937">unsafe</span><span class="op" id="1560943">.</span><span class="ident" id="1560944">Pointer</span><span class="op" id="1560951">(</span><span class="ident" id="1560952">t</span><span class="op" id="1560953">.</span><span class="ident" id="1560954">elem</span><span class="op" id="1560958">.</span><span class="ident" id="1560959">zero</span><span class="op" id="1560963">)</span><span class="op" id="1560964">,</span>&nbsp;<span class="ident" id="1560966">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1560974">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1560977">}</span><br>
<span class="lineno"></span><span class="op" id="1560979">}</span>
</div>
</body>
</html>
