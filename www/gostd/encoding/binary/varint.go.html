<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/binary</h2>
<ul>
<li><a href="/gostd/encoding/binary/binary.go.html">binary.go</a></li>
<li><a href="/gostd/encoding/binary/binary_test.go.html">binary_test.go</a></li>
<li><a href="/gostd/encoding/binary/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/binary/varint.go.html">varint.go</a></li>
<li><a href="/gostd/encoding/binary/varint_test.go.html">varint_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3621013">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3621069">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3621123">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3621174">package</span>&nbsp;<span class="ident" id="3621182">binary</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3621190">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;&#34;varint&#34;&nbsp;encoding&nbsp;of&nbsp;64-bit&nbsp;integers.</span><br>
<span class="lineno"></span><span class="comment" id="3621252">//&nbsp;The&nbsp;encoding&nbsp;is:</span><br>
<span class="lineno"></span><span class="comment" id="3621272">//&nbsp;-&nbsp;unsigned&nbsp;integers&nbsp;are&nbsp;serialized&nbsp;7&nbsp;bits&nbsp;at&nbsp;a&nbsp;time,&nbsp;starting&nbsp;with&nbsp;the</span><br>
<span class="lineno">10</span><span class="comment" id="3621346">//&nbsp;&nbsp;&nbsp;least&nbsp;significant&nbsp;bits</span><br>
<span class="lineno"></span><span class="comment" id="3621374">//&nbsp;-&nbsp;the&nbsp;most&nbsp;significant&nbsp;bit&nbsp;(msb)&nbsp;in&nbsp;each&nbsp;output&nbsp;byte&nbsp;indicates&nbsp;if&nbsp;there</span><br>
<span class="lineno"></span><span class="comment" id="3621449">//&nbsp;&nbsp;&nbsp;is&nbsp;a&nbsp;continuation&nbsp;byte&nbsp;(msb&nbsp;=&nbsp;1)</span><br>
<span class="lineno"></span><span class="comment" id="3621487">//&nbsp;-&nbsp;signed&nbsp;integers&nbsp;are&nbsp;mapped&nbsp;to&nbsp;unsigned&nbsp;integers&nbsp;using&nbsp;&#34;zig-zag&#34;</span><br>
<span class="lineno"></span><span class="comment" id="3621556">//&nbsp;&nbsp;&nbsp;encoding:&nbsp;Positive&nbsp;values&nbsp;x&nbsp;are&nbsp;written&nbsp;as&nbsp;2*x&nbsp;+&nbsp;0,&nbsp;negative&nbsp;values</span><br>
<span class="lineno">15</span><span class="comment" id="3621629">//&nbsp;&nbsp;&nbsp;are&nbsp;written&nbsp;as&nbsp;2*(^x)&nbsp;+&nbsp;1;&nbsp;that&nbsp;is,&nbsp;negative&nbsp;numbers&nbsp;are&nbsp;complemented</span><br>
<span class="lineno"></span><span class="comment" id="3621704">//&nbsp;&nbsp;&nbsp;and&nbsp;whether&nbsp;to&nbsp;complement&nbsp;is&nbsp;encoded&nbsp;in&nbsp;bit&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="3621756">//</span><br>
<span class="lineno"></span><span class="comment" id="3621759">//&nbsp;Design&nbsp;note:</span><br>
<span class="lineno"></span><span class="comment" id="3621775">//&nbsp;At&nbsp;most&nbsp;10&nbsp;bytes&nbsp;are&nbsp;needed&nbsp;for&nbsp;64-bit&nbsp;values.&nbsp;The&nbsp;encoding&nbsp;could</span><br>
<span class="lineno">20</span><span class="comment" id="3621844">//&nbsp;be&nbsp;more&nbsp;dense:&nbsp;a&nbsp;full&nbsp;64-bit&nbsp;value&nbsp;needs&nbsp;an&nbsp;extra&nbsp;byte&nbsp;just&nbsp;to&nbsp;hold&nbsp;bit&nbsp;63.</span><br>
<span class="lineno"></span><span class="comment" id="3621923">//&nbsp;Instead,&nbsp;the&nbsp;msb&nbsp;of&nbsp;the&nbsp;previous&nbsp;byte&nbsp;could&nbsp;be&nbsp;used&nbsp;to&nbsp;hold&nbsp;bit&nbsp;63&nbsp;since&nbsp;we</span><br>
<span class="lineno"></span><span class="comment" id="3622002">//&nbsp;know&nbsp;there&nbsp;can&#39;t&nbsp;be&nbsp;more&nbsp;than&nbsp;64&nbsp;bits.&nbsp;This&nbsp;is&nbsp;a&nbsp;trivial&nbsp;improvement&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3622078">//&nbsp;would&nbsp;reduce&nbsp;the&nbsp;maximum&nbsp;encoding&nbsp;length&nbsp;to&nbsp;9&nbsp;bytes.&nbsp;However,&nbsp;it&nbsp;breaks&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3622157">//&nbsp;invariant&nbsp;that&nbsp;the&nbsp;msb&nbsp;is&nbsp;always&nbsp;the&nbsp;&#34;continuation&nbsp;bit&#34;&nbsp;and&nbsp;thus&nbsp;makes&nbsp;the</span><br>
<span class="lineno">25</span><span class="comment" id="3622235">//&nbsp;format&nbsp;incompatible&nbsp;with&nbsp;a&nbsp;varint&nbsp;encoding&nbsp;for&nbsp;larger&nbsp;numbers&nbsp;(say&nbsp;128-bit).</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3622316">import</span>&nbsp;<span class="op" id="3622323">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3622326">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3622336">&#34;io&#34;</span><br>
<span class="lineno">30</span><span class="op" id="3622341">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3622344">//&nbsp;MaxVarintLenN&nbsp;is&nbsp;the&nbsp;maximum&nbsp;length&nbsp;of&nbsp;a&nbsp;varint-encoded&nbsp;N-bit&nbsp;integer.</span><br>
<span class="lineno"></span><span class="keyword" id="3622418">const</span>&nbsp;<span class="op" id="3622424">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3622427">MaxVarintLen16</span>&nbsp;<span class="op" id="3622442">=</span>&nbsp;<span class="num" id="3622444">3</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3622447">MaxVarintLen32</span>&nbsp;<span class="op" id="3622462">=</span>&nbsp;<span class="num" id="3622464">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3622467">MaxVarintLen64</span>&nbsp;<span class="op" id="3622482">=</span>&nbsp;<span class="num" id="3622484">10</span><br>
<span class="lineno"></span><span class="op" id="3622487">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3622490">//&nbsp;PutUvarint&nbsp;encodes&nbsp;a&nbsp;uint64&nbsp;into&nbsp;buf&nbsp;and&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno">40</span><span class="comment" id="3622571">//&nbsp;If&nbsp;the&nbsp;buffer&nbsp;is&nbsp;too&nbsp;small,&nbsp;PutUvarint&nbsp;will&nbsp;panic.</span><br>
<span class="lineno"></span><span class="keyword" id="3622625">func</span>&nbsp;<span class="ident" id="3622630">PutUvarint</span><span class="op" id="3622640">(</span><span class="ident" id="3622641">buf</span>&nbsp;<span class="op" id="3622645">[</span><span class="op" id="3622646">]</span><span class="builtintype" id="3622647">byte</span><span class="op" id="3622651">,</span>&nbsp;<span class="ident" id="3622653">x</span>&nbsp;<span class="ident" id="3622655">uint64</span><span class="op" id="3622661">)</span>&nbsp;<span class="builtintype" id="3622663">int</span>&nbsp;<span class="op" id="3622667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3622670">i</span>&nbsp;<span class="op" id="3622672">:=</span>&nbsp;<span class="num" id="3622675">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3622678">for</span>&nbsp;<span class="ident" id="3622682">x</span>&nbsp;<span class="op" id="3622684">&gt;=</span>&nbsp;<span class="num" id="3622687">0x80</span>&nbsp;<span class="op" id="3622692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3622696">buf</span><span class="op" id="3622699">[</span><span class="ident" id="3622700">i</span><span class="op" id="3622701">]</span>&nbsp;<span class="op" id="3622703">=</span>&nbsp;<span class="builtintype" id="3622705">byte</span><span class="op" id="3622709">(</span><span class="ident" id="3622710">x</span><span class="op" id="3622711">)</span>&nbsp;<span class="op" id="3622713">|</span>&nbsp;<span class="num" id="3622715">0x80</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3622722">x</span>&nbsp;<span class="op" id="3622724">&gt;&gt;=</span>&nbsp;<span class="num" id="3622728">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3622732">i</span><span class="op" id="3622733">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3622737">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3622740">buf</span><span class="op" id="3622743">[</span><span class="ident" id="3622744">i</span><span class="op" id="3622745">]</span>&nbsp;<span class="op" id="3622747">=</span>&nbsp;<span class="builtintype" id="3622749">byte</span><span class="op" id="3622753">(</span><span class="ident" id="3622754">x</span><span class="op" id="3622755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3622758">return</span>&nbsp;<span class="ident" id="3622765">i</span>&nbsp;<span class="op" id="3622767">+</span>&nbsp;<span class="num" id="3622769">1</span><br>
<span class="lineno">50</span><span class="op" id="3622771">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3622774">//&nbsp;Uvarint&nbsp;decodes&nbsp;a&nbsp;uint64&nbsp;from&nbsp;buf&nbsp;and&nbsp;returns&nbsp;that&nbsp;value&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3622842">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;(&gt;&nbsp;0).&nbsp;If&nbsp;an&nbsp;error&nbsp;occurred,&nbsp;the&nbsp;value&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span><span class="comment" id="3622910">//&nbsp;and&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;n&nbsp;is&nbsp;&lt;=&nbsp;0&nbsp;meaning:</span><br>
<span class="lineno">55</span><span class="comment" id="3622956">//</span><br>
<span class="lineno"></span><span class="comment" id="3622959">//&nbsp;&nbsp;&nbsp;&nbspn&nbsp;==&nbsp;0:&nbsp;buf&nbsp;too&nbsp;small</span><br>
<span class="lineno"></span><span class="comment" id="3622984">//&nbsp;&nbsp;&nbsp;&nbspn&nbsp;&nbsp;&lt;&nbsp;0:&nbsp;value&nbsp;larger&nbsp;than&nbsp;64&nbsp;bits&nbsp;(overflow)</span><br>
<span class="lineno"></span><span class="comment" id="3623032">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;-n&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read</span><br>
<span class="lineno"></span><span class="comment" id="3623083">//</span><br>
<span class="lineno">60</span><span class="keyword" id="3623086">func</span>&nbsp;<span class="ident" id="3623091">Uvarint</span><span class="op" id="3623098">(</span><span class="ident" id="3623099">buf</span>&nbsp;<span class="op" id="3623103">[</span><span class="op" id="3623104">]</span><span class="builtintype" id="3623105">byte</span><span class="op" id="3623109">)</span>&nbsp;<span class="op" id="3623111">(</span><span class="ident" id="3623112">uint64</span><span class="op" id="3623118">,</span>&nbsp;<span class="builtintype" id="3623120">int</span><span class="op" id="3623123">)</span>&nbsp;<span class="op" id="3623125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3623128">var</span>&nbsp;<span class="ident" id="3623132">x</span>&nbsp;<span class="ident" id="3623134">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3623142">var</span>&nbsp;<span class="ident" id="3623146">s</span>&nbsp;<span class="builtintype" id="3623148">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3623154">for</span>&nbsp;<span class="ident" id="3623158">i</span><span class="op" id="3623159">,</span>&nbsp;<span class="ident" id="3623161">b</span>&nbsp;<span class="op" id="3623163">:=</span>&nbsp;<span class="keyword" id="3623166">range</span>&nbsp;<span class="ident" id="3623172">buf</span>&nbsp;<span class="op" id="3623176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3623180">if</span>&nbsp;<span class="ident" id="3623183">b</span>&nbsp;<span class="op" id="3623185">&lt;</span>&nbsp;<span class="num" id="3623187">0x80</span>&nbsp;<span class="op" id="3623192">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3623197">if</span>&nbsp;<span class="ident" id="3623200">i</span>&nbsp;<span class="op" id="3623202">&gt;</span>&nbsp;<span class="num" id="3623204">9</span>&nbsp;<span class="op" id="3623206">||</span>&nbsp;<span class="ident" id="3623209">i</span>&nbsp;<span class="op" id="3623211">==</span>&nbsp;<span class="num" id="3623214">9</span>&nbsp;<span class="op" id="3623216">&amp;&amp;</span>&nbsp;<span class="ident" id="3623219">b</span>&nbsp;<span class="op" id="3623221">&gt;</span>&nbsp;<span class="num" id="3623223">1</span>&nbsp;<span class="op" id="3623225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3623231">return</span>&nbsp;<span class="num" id="3623238">0</span><span class="op" id="3623239">,</span>&nbsp;<span class="op" id="3623241">-</span><span class="op" id="3623242">(</span><span class="ident" id="3623243">i</span>&nbsp;<span class="op" id="3623245">+</span>&nbsp;<span class="num" id="3623247">1</span><span class="op" id="3623248">)</span>&nbsp;<span class="comment" id="3623250">//&nbsp;overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3623265">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3623270">return</span>&nbsp;<span class="ident" id="3623277">x</span>&nbsp;<span class="op" id="3623279">|</span>&nbsp;<span class="ident" id="3623281">uint64</span><span class="op" id="3623287">(</span><span class="ident" id="3623288">b</span><span class="op" id="3623289">)</span><span class="op" id="3623290">&lt;&lt;</span><span class="ident" id="3623292">s</span><span class="op" id="3623293">,</span>&nbsp;<span class="ident" id="3623295">i</span>&nbsp;<span class="op" id="3623297">+</span>&nbsp;<span class="num" id="3623299">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3623303">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3623307">x</span>&nbsp;<span class="op" id="3623309">|=</span>&nbsp;<span class="ident" id="3623312">uint64</span><span class="op" id="3623318">(</span><span class="ident" id="3623319">b</span><span class="op" id="3623320">&amp;</span><span class="num" id="3623321">0x7f</span><span class="op" id="3623325">)</span>&nbsp;<span class="op" id="3623327">&lt;&lt;</span>&nbsp;<span class="ident" id="3623330">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3623334">s</span>&nbsp;<span class="op" id="3623336">+=</span>&nbsp;<span class="num" id="3623339">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3623342">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3623345">return</span>&nbsp;<span class="num" id="3623352">0</span><span class="op" id="3623353">,</span>&nbsp;<span class="num" id="3623355">0</span><br>
<span class="lineno"></span><span class="op" id="3623357">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="comment" id="3623360">//&nbsp;PutVarint&nbsp;encodes&nbsp;an&nbsp;int64&nbsp;into&nbsp;buf&nbsp;and&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno"></span><span class="comment" id="3623440">//&nbsp;If&nbsp;the&nbsp;buffer&nbsp;is&nbsp;too&nbsp;small,&nbsp;PutVarint&nbsp;will&nbsp;panic.</span><br>
<span class="lineno"></span><span class="keyword" id="3623493">func</span>&nbsp;<span class="ident" id="3623498">PutVarint</span><span class="op" id="3623507">(</span><span class="ident" id="3623508">buf</span>&nbsp;<span class="op" id="3623512">[</span><span class="op" id="3623513">]</span><span class="builtintype" id="3623514">byte</span><span class="op" id="3623518">,</span>&nbsp;<span class="ident" id="3623520">x</span>&nbsp;<span class="ident" id="3623522">int64</span><span class="op" id="3623527">)</span>&nbsp;<span class="builtintype" id="3623529">int</span>&nbsp;<span class="op" id="3623533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3623536">ux</span>&nbsp;<span class="op" id="3623539">:=</span>&nbsp;<span class="ident" id="3623542">uint64</span><span class="op" id="3623548">(</span><span class="ident" id="3623549">x</span><span class="op" id="3623550">)</span>&nbsp;<span class="op" id="3623552">&lt;&lt;</span>&nbsp;<span class="num" id="3623555">1</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3623558">if</span>&nbsp;<span class="ident" id="3623561">x</span>&nbsp;<span class="op" id="3623563">&lt;</span>&nbsp;<span class="num" id="3623565">0</span>&nbsp;<span class="op" id="3623567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3623571">ux</span>&nbsp;<span class="op" id="3623574">=</span>&nbsp;<span class="op" id="3623576">^</span><span class="ident" id="3623577">ux</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3623581">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3623584">return</span>&nbsp;<span class="ident" id="3623591">PutUvarint</span><span class="op" id="3623601">(</span><span class="ident" id="3623602">buf</span><span class="op" id="3623605">,</span>&nbsp;<span class="ident" id="3623607">ux</span><span class="op" id="3623609">)</span><br>
<span class="lineno"></span><span class="op" id="3623611">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="3623614">//&nbsp;Varint&nbsp;decodes&nbsp;an&nbsp;int64&nbsp;from&nbsp;buf&nbsp;and&nbsp;returns&nbsp;that&nbsp;value&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3623681">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;(&gt;&nbsp;0).&nbsp;If&nbsp;an&nbsp;error&nbsp;occurred,&nbsp;the&nbsp;value&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span><span class="comment" id="3623749">//&nbsp;and&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;n&nbsp;is&nbsp;&lt;=&nbsp;0&nbsp;with&nbsp;the&nbsp;following&nbsp;meaning:</span><br>
<span class="lineno"></span><span class="comment" id="3623814">//</span><br>
<span class="lineno">90</span><span class="comment" id="3623817">//&nbsp;&nbsp;&nbsp;&nbspn&nbsp;==&nbsp;0:&nbsp;buf&nbsp;too&nbsp;small</span><br>
<span class="lineno"></span><span class="comment" id="3623842">//&nbsp;&nbsp;&nbsp;&nbspn&nbsp;&nbsp;&lt;&nbsp;0:&nbsp;value&nbsp;larger&nbsp;than&nbsp;64&nbsp;bits&nbsp;(overflow)</span><br>
<span class="lineno"></span><span class="comment" id="3623890">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;-n&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read</span><br>
<span class="lineno"></span><span class="comment" id="3623941">//</span><br>
<span class="lineno"></span><span class="keyword" id="3623944">func</span>&nbsp;<span class="ident" id="3623949">Varint</span><span class="op" id="3623955">(</span><span class="ident" id="3623956">buf</span>&nbsp;<span class="op" id="3623960">[</span><span class="op" id="3623961">]</span><span class="builtintype" id="3623962">byte</span><span class="op" id="3623966">)</span>&nbsp;<span class="op" id="3623968">(</span><span class="ident" id="3623969">int64</span><span class="op" id="3623974">,</span>&nbsp;<span class="builtintype" id="3623976">int</span><span class="op" id="3623979">)</span>&nbsp;<span class="op" id="3623981">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3623984">ux</span><span class="op" id="3623986">,</span>&nbsp;<span class="ident" id="3623988">n</span>&nbsp;<span class="op" id="3623990">:=</span>&nbsp;<span class="ident" id="3623993">Uvarint</span><span class="op" id="3624000">(</span><span class="ident" id="3624001">buf</span><span class="op" id="3624004">)</span>&nbsp;<span class="comment" id="3624006">//&nbsp;ok&nbsp;to&nbsp;continue&nbsp;in&nbsp;presence&nbsp;of&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3624046">x</span>&nbsp;<span class="op" id="3624048">:=</span>&nbsp;<span class="ident" id="3624051">int64</span><span class="op" id="3624056">(</span><span class="ident" id="3624057">ux</span>&nbsp;<span class="op" id="3624060">&gt;&gt;</span>&nbsp;<span class="num" id="3624063">1</span><span class="op" id="3624064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3624067">if</span>&nbsp;<span class="ident" id="3624070">ux</span><span class="op" id="3624072">&amp;</span><span class="num" id="3624073">1</span>&nbsp;<span class="op" id="3624075">!=</span>&nbsp;<span class="num" id="3624078">0</span>&nbsp;<span class="op" id="3624080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3624084">x</span>&nbsp;<span class="op" id="3624086">=</span>&nbsp;<span class="op" id="3624088">^</span><span class="ident" id="3624089">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3624092">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3624095">return</span>&nbsp;<span class="ident" id="3624102">x</span><span class="op" id="3624103">,</span>&nbsp;<span class="ident" id="3624105">n</span><br>
<span class="lineno"></span><span class="op" id="3624107">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3624110">var</span>&nbsp;<span class="ident" id="3624114">overflow</span>&nbsp;<span class="op" id="3624123">=</span>&nbsp;<span class="ident" id="3624125">errors</span><span class="op" id="3624131">.</span><span class="ident" id="3624132">New</span><span class="op" id="3624135">(</span><span class="string" id="3624136">&#34;binary:&nbsp;varint&nbsp;overflows&nbsp;a&nbsp;64-bit&nbsp;integer&#34;</span><span class="op" id="3624179">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="3624182">//&nbsp;ReadUvarint&nbsp;reads&nbsp;an&nbsp;encoded&nbsp;unsigned&nbsp;integer&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;it&nbsp;as&nbsp;a&nbsp;uint64.</span><br>
<span class="lineno"></span><span class="keyword" id="3624266">func</span>&nbsp;<span class="ident" id="3624271">ReadUvarint</span><span class="op" id="3624282">(</span><span class="ident" id="3624283">r</span>&nbsp;<span class="ident" id="3624285">io</span><span class="op" id="3624287">.</span><span class="ident" id="3624288">ByteReader</span><span class="op" id="3624298">)</span>&nbsp;<span class="op" id="3624300">(</span><span class="ident" id="3624301">uint64</span><span class="op" id="3624307">,</span>&nbsp;<span class="builtintype" id="3624309">error</span><span class="op" id="3624314">)</span>&nbsp;<span class="op" id="3624316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3624319">var</span>&nbsp;<span class="ident" id="3624323">x</span>&nbsp;<span class="ident" id="3624325">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3624333">var</span>&nbsp;<span class="ident" id="3624337">s</span>&nbsp;<span class="builtintype" id="3624339">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3624345">for</span>&nbsp;<span class="ident" id="3624349">i</span>&nbsp;<span class="op" id="3624351">:=</span>&nbsp;<span class="num" id="3624354">0</span><span class="op" id="3624355">;</span>&nbsp;<span class="op" id="3624357">;</span>&nbsp;<span class="ident" id="3624359">i</span><span class="op" id="3624360">++</span>&nbsp;<span class="op" id="3624363">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3624367">b</span><span class="op" id="3624368">,</span>&nbsp;<span class="ident" id="3624370">err</span>&nbsp;<span class="op" id="3624374">:=</span>&nbsp;<span class="ident" id="3624377">r</span><span class="op" id="3624378">.</span><span class="ident" id="3624379">ReadByte</span><span class="op" id="3624387">(</span><span class="op" id="3624388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3624392">if</span>&nbsp;<span class="ident" id="3624395">err</span>&nbsp;<span class="op" id="3624399">!=</span>&nbsp;<span class="ident" id="3624402">nil</span>&nbsp;<span class="op" id="3624406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3624411">return</span>&nbsp;<span class="ident" id="3624418">x</span><span class="op" id="3624419">,</span>&nbsp;<span class="ident" id="3624421">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3624427">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3624431">if</span>&nbsp;<span class="ident" id="3624434">b</span>&nbsp;<span class="op" id="3624436">&lt;</span>&nbsp;<span class="num" id="3624438">0x80</span>&nbsp;<span class="op" id="3624443">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3624448">if</span>&nbsp;<span class="ident" id="3624451">i</span>&nbsp;<span class="op" id="3624453">&gt;</span>&nbsp;<span class="num" id="3624455">9</span>&nbsp;<span class="op" id="3624457">||</span>&nbsp;<span class="ident" id="3624460">i</span>&nbsp;<span class="op" id="3624462">==</span>&nbsp;<span class="num" id="3624465">9</span>&nbsp;<span class="op" id="3624467">&amp;&amp;</span>&nbsp;<span class="ident" id="3624470">b</span>&nbsp;<span class="op" id="3624472">&gt;</span>&nbsp;<span class="num" id="3624474">1</span>&nbsp;<span class="op" id="3624476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3624482">return</span>&nbsp;<span class="ident" id="3624489">x</span><span class="op" id="3624490">,</span>&nbsp;<span class="ident" id="3624492">overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3624504">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3624509">return</span>&nbsp;<span class="ident" id="3624516">x</span>&nbsp;<span class="op" id="3624518">|</span>&nbsp;<span class="ident" id="3624520">uint64</span><span class="op" id="3624526">(</span><span class="ident" id="3624527">b</span><span class="op" id="3624528">)</span><span class="op" id="3624529">&lt;&lt;</span><span class="ident" id="3624531">s</span><span class="op" id="3624532">,</span>&nbsp;<span class="ident" id="3624534">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3624540">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3624544">x</span>&nbsp;<span class="op" id="3624546">|=</span>&nbsp;<span class="ident" id="3624549">uint64</span><span class="op" id="3624555">(</span><span class="ident" id="3624556">b</span><span class="op" id="3624557">&amp;</span><span class="num" id="3624558">0x7f</span><span class="op" id="3624562">)</span>&nbsp;<span class="op" id="3624564">&lt;&lt;</span>&nbsp;<span class="ident" id="3624567">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3624571">s</span>&nbsp;<span class="op" id="3624573">+=</span>&nbsp;<span class="num" id="3624576">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3624579">}</span><br>
<span class="lineno"></span><span class="op" id="3624581">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment" id="3624584">//&nbsp;ReadVarint&nbsp;reads&nbsp;an&nbsp;encoded&nbsp;signed&nbsp;integer&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;it&nbsp;as&nbsp;an&nbsp;int64.</span><br>
<span class="lineno"></span><span class="keyword" id="3624665">func</span>&nbsp;<span class="ident" id="3624670">ReadVarint</span><span class="op" id="3624680">(</span><span class="ident" id="3624681">r</span>&nbsp;<span class="ident" id="3624683">io</span><span class="op" id="3624685">.</span><span class="ident" id="3624686">ByteReader</span><span class="op" id="3624696">)</span>&nbsp;<span class="op" id="3624698">(</span><span class="ident" id="3624699">int64</span><span class="op" id="3624704">,</span>&nbsp;<span class="builtintype" id="3624706">error</span><span class="op" id="3624711">)</span>&nbsp;<span class="op" id="3624713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3624716">ux</span><span class="op" id="3624718">,</span>&nbsp;<span class="ident" id="3624720">err</span>&nbsp;<span class="op" id="3624724">:=</span>&nbsp;<span class="ident" id="3624727">ReadUvarint</span><span class="op" id="3624738">(</span><span class="ident" id="3624739">r</span><span class="op" id="3624740">)</span>&nbsp;<span class="comment" id="3624742">//&nbsp;ok&nbsp;to&nbsp;continue&nbsp;in&nbsp;presence&nbsp;of&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3624782">x</span>&nbsp;<span class="op" id="3624784">:=</span>&nbsp;<span class="ident" id="3624787">int64</span><span class="op" id="3624792">(</span><span class="ident" id="3624793">ux</span>&nbsp;<span class="op" id="3624796">&gt;&gt;</span>&nbsp;<span class="num" id="3624799">1</span><span class="op" id="3624800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3624803">if</span>&nbsp;<span class="ident" id="3624806">ux</span><span class="op" id="3624808">&amp;</span><span class="num" id="3624809">1</span>&nbsp;<span class="op" id="3624811">!=</span>&nbsp;<span class="num" id="3624814">0</span>&nbsp;<span class="op" id="3624816">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3624820">x</span>&nbsp;<span class="op" id="3624822">=</span>&nbsp;<span class="op" id="3624824">^</span><span class="ident" id="3624825">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3624828">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3624831">return</span>&nbsp;<span class="ident" id="3624838">x</span><span class="op" id="3624839">,</span>&nbsp;<span class="ident" id="3624841">err</span><br>
<span class="lineno"></span><span class="op" id="3624845">}</span>
</div>
</body>
</html>
