<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/ast</h2>
<ul>
<li><a href="/gostd/go/ast/ast.go.html">ast.go</a></li>
<li><a href="/gostd/go/ast/ast_test.go.html">ast_test.go</a></li>
<li><a href="/gostd/go/ast/commentmap.go.html">commentmap.go</a></li>
<li><a href="/gostd/go/ast/commentmap_test.go.html">commentmap_test.go</a></li>
<li><a href="/gostd/go/ast/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/ast/filter.go.html">filter.go</a></li>
<li><a href="/gostd/go/ast/filter_test.go.html">filter_test.go</a></li>
<li><a href="/gostd/go/ast/import.go.html">import.go</a></li>
<li><a href="/gostd/go/ast/print.go.html">print.go</a></li>
<li><a href="/gostd/go/ast/print_test.go.html">print_test.go</a></li>
<li><a href="/gostd/go/ast/resolve.go.html">resolve.go</a></li>
<li><a href="/gostd/go/ast/scope.go.html">scope.go</a></li>
<li><a href="/gostd/go/ast/walk.go.html">walk.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3617676">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3617731">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3617785">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3617836">//&nbsp;This&nbsp;file&nbsp;contains&nbsp;printing&nbsp;support&nbsp;for&nbsp;ASTs.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3617886">package</span>&nbsp;<span class="ident" id="3617894">ast</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3617899">import</span>&nbsp;<span class="op" id="3617906">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3617909">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3617916">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3617928">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3617934">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3617940">&#34;reflect&#34;</span><br>
<span class="lineno">15</span><span class="op" id="3617950">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3617953">//&nbsp;A&nbsp;FieldFilter&nbsp;may&nbsp;be&nbsp;provided&nbsp;to&nbsp;Fprint&nbsp;to&nbsp;control&nbsp;the&nbsp;output.</span><br>
<span class="lineno"></span><span class="keyword" id="3618019">type</span>&nbsp;<span class="ident" id="3618024">FieldFilter</span>&nbsp;<span class="keyword" id="3618036">func</span><span class="op" id="3618040">(</span><span class="ident" id="3618041">name</span>&nbsp;<span class="builtintype" id="3618046">string</span><span class="op" id="3618052">,</span>&nbsp;<span class="ident" id="3618054">value</span>&nbsp;<span class="ident" id="3618060">reflect</span><span class="op" id="3618067">.</span><span class="ident" id="3618068">Value</span><span class="op" id="3618073">)</span>&nbsp;<span class="builtintype" id="3618075">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="3618081">//&nbsp;NotNilFilter&nbsp;returns&nbsp;true&nbsp;for&nbsp;field&nbsp;values&nbsp;that&nbsp;are&nbsp;not&nbsp;nil;</span><br>
<span class="lineno"></span><span class="comment" id="3618145">//&nbsp;it&nbsp;returns&nbsp;false&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="keyword" id="3618176">func</span>&nbsp;<span class="ident" id="3618181">NotNilFilter</span><span class="op" id="3618193">(</span><span class="ident" id="3618194">_</span>&nbsp;<span class="builtintype" id="3618196">string</span><span class="op" id="3618202">,</span>&nbsp;<span class="ident" id="3618204">v</span>&nbsp;<span class="ident" id="3618206">reflect</span><span class="op" id="3618213">.</span><span class="ident" id="3618214">Value</span><span class="op" id="3618219">)</span>&nbsp;<span class="builtintype" id="3618221">bool</span>&nbsp;<span class="op" id="3618226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3618229">switch</span>&nbsp;<span class="ident" id="3618236">v</span><span class="op" id="3618237">.</span><span class="ident" id="3618238">Kind</span><span class="op" id="3618242">(</span><span class="op" id="3618243">)</span>&nbsp;<span class="op" id="3618245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3618248">case</span>&nbsp;<span class="ident" id="3618253">reflect</span><span class="op" id="3618260">.</span><span class="ident" id="3618261">Chan</span><span class="op" id="3618265">,</span>&nbsp;<span class="ident" id="3618267">reflect</span><span class="op" id="3618274">.</span><span class="ident" id="3618275">Func</span><span class="op" id="3618279">,</span>&nbsp;<span class="ident" id="3618281">reflect</span><span class="op" id="3618288">.</span><span class="ident" id="3618289">Interface</span><span class="op" id="3618298">,</span>&nbsp;<span class="ident" id="3618300">reflect</span><span class="op" id="3618307">.</span><span class="ident" id="3618308">Map</span><span class="op" id="3618311">,</span>&nbsp;<span class="ident" id="3618313">reflect</span><span class="op" id="3618320">.</span><span class="ident" id="3618321">Ptr</span><span class="op" id="3618324">,</span>&nbsp;<span class="ident" id="3618326">reflect</span><span class="op" id="3618333">.</span><span class="ident" id="3618334">Slice</span><span class="op" id="3618339">:</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3618343">return</span>&nbsp;<span class="op" id="3618350">!</span><span class="ident" id="3618351">v</span><span class="op" id="3618352">.</span><span class="ident" id="3618353">IsNil</span><span class="op" id="3618358">(</span><span class="op" id="3618359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3618362">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3618365">return</span>&nbsp;<span class="builtintype" id="3618372">true</span><br>
<span class="lineno"></span><span class="op" id="3618377">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="3618380">//&nbsp;Fprint&nbsp;prints&nbsp;the&nbsp;(sub-)tree&nbsp;starting&nbsp;at&nbsp;AST&nbsp;node&nbsp;x&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="comment" id="3618441">//&nbsp;If&nbsp;fset&nbsp;!=&nbsp;nil,&nbsp;position&nbsp;information&nbsp;is&nbsp;interpreted&nbsp;relative</span><br>
<span class="lineno"></span><span class="comment" id="3618505">//&nbsp;to&nbsp;that&nbsp;file&nbsp;set.&nbsp;Otherwise&nbsp;positions&nbsp;are&nbsp;printed&nbsp;as&nbsp;integer</span><br>
<span class="lineno"></span><span class="comment" id="3618569">//&nbsp;values&nbsp;(file&nbsp;set&nbsp;specific&nbsp;offsets).</span><br>
<span class="lineno"></span><span class="comment" id="3618608">//</span><br>
<span class="lineno">35</span><span class="comment" id="3618611">//&nbsp;A&nbsp;non-nil&nbsp;FieldFilter&nbsp;f&nbsp;may&nbsp;be&nbsp;provided&nbsp;to&nbsp;control&nbsp;the&nbsp;output:</span><br>
<span class="lineno"></span><span class="comment" id="3618677">//&nbsp;struct&nbsp;fields&nbsp;for&nbsp;which&nbsp;f(fieldname,&nbsp;fieldvalue)&nbsp;is&nbsp;true&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="3618741">//&nbsp;printed;&nbsp;all&nbsp;others&nbsp;are&nbsp;filtered&nbsp;from&nbsp;the&nbsp;output.&nbsp;Unexported</span><br>
<span class="lineno"></span><span class="comment" id="3618805">//&nbsp;struct&nbsp;fields&nbsp;are&nbsp;never&nbsp;printed.</span><br>
<span class="lineno"></span><span class="comment" id="3618841">//</span><br>
<span class="lineno">40</span><span class="keyword" id="3618844">func</span>&nbsp;<span class="ident" id="3618849">Fprint</span><span class="op" id="3618855">(</span><span class="ident" id="3618856">w</span>&nbsp;<span class="ident" id="3618858">io</span><span class="op" id="3618860">.</span><span class="ident" id="3618861">Writer</span><span class="op" id="3618867">,</span>&nbsp;<span class="ident" id="3618869">fset</span>&nbsp;<span class="op" id="3618874">*</span><span class="ident" id="3618875">token</span><span class="op" id="3618880">.</span><span class="ident" id="3618881">FileSet</span><span class="op" id="3618888">,</span>&nbsp;<span class="ident" id="3618890">x</span>&nbsp;<span class="keyword" id="3618892">interface</span><span class="op" id="3618901">{</span><span class="op" id="3618902">}</span><span class="op" id="3618903">,</span>&nbsp;<span class="ident" id="3618905">f</span>&nbsp;<span class="ident" id="3618907">FieldFilter</span><span class="op" id="3618918">)</span>&nbsp;<span class="op" id="3618920">(</span><span class="ident" id="3618921">err</span>&nbsp;<span class="builtintype" id="3618925">error</span><span class="op" id="3618930">)</span>&nbsp;<span class="op" id="3618932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3618935">//&nbsp;setup&nbsp;printer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3618953">p</span>&nbsp;<span class="op" id="3618955">:=</span>&nbsp;<span class="ident" id="3618958">printer</span><span class="op" id="3618965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3618969">output</span><span class="op" id="3618975">:</span>&nbsp;<span class="ident" id="3618977">w</span><span class="op" id="3618978">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3618982">fset</span><span class="op" id="3618986">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3618990">fset</span><span class="op" id="3618994">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3618998">filter</span><span class="op" id="3619004">:</span>&nbsp;<span class="ident" id="3619006">f</span><span class="op" id="3619007">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3619011">ptrmap</span><span class="op" id="3619017">:</span>&nbsp;<span class="builtinfunc" id="3619019">make</span><span class="op" id="3619023">(</span><span class="keyword" id="3619024">map</span><span class="op" id="3619027">[</span><span class="keyword" id="3619028">interface</span><span class="op" id="3619037">{</span><span class="op" id="3619038">}</span><span class="op" id="3619039">]</span><span class="builtintype" id="3619040">int</span><span class="op" id="3619043">)</span><span class="op" id="3619044">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3619048">last</span><span class="op" id="3619052">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="3619056">&#39;\n&#39;</span><span class="op" id="3619060">,</span>&nbsp;<span class="comment" id="3619062">//&nbsp;force&nbsp;printing&nbsp;of&nbsp;line&nbsp;number&nbsp;on&nbsp;first&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3619110">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3619114">//&nbsp;install&nbsp;error&nbsp;handler</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3619140">defer</span>&nbsp;<span class="keyword" id="3619146">func</span><span class="op" id="3619150">(</span><span class="op" id="3619151">)</span>&nbsp;<span class="op" id="3619153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3619157">if</span>&nbsp;<span class="ident" id="3619160">e</span>&nbsp;<span class="op" id="3619162">:=</span>&nbsp;<span class="builtinfunc" id="3619165">recover</span><span class="op" id="3619172">(</span><span class="op" id="3619173">)</span><span class="op" id="3619174">;</span>&nbsp;<span class="ident" id="3619176">e</span>&nbsp;<span class="op" id="3619178">!=</span>&nbsp;<span class="ident" id="3619181">nil</span>&nbsp;<span class="op" id="3619185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3619190">err</span>&nbsp;<span class="op" id="3619194">=</span>&nbsp;<span class="ident" id="3619196">e</span><span class="op" id="3619197">.</span><span class="op" id="3619198">(</span><span class="ident" id="3619199">localError</span><span class="op" id="3619209">)</span><span class="op" id="3619210">.</span><span class="ident" id="3619211">err</span>&nbsp;<span class="comment" id="3619215">//&nbsp;re-panics&nbsp;if&nbsp;it&#39;s&nbsp;not&nbsp;a&nbsp;localError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3619255">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3619258">}</span><span class="op" id="3619259">(</span><span class="op" id="3619260">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3619264">//&nbsp;print&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3619276">if</span>&nbsp;<span class="ident" id="3619279">x</span>&nbsp;<span class="op" id="3619281">==</span>&nbsp;<span class="ident" id="3619284">nil</span>&nbsp;<span class="op" id="3619288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3619292">p</span><span class="op" id="3619293">.</span><span class="ident" id="3619294">printf</span><span class="op" id="3619300">(</span><span class="string" id="3619301">&#34;nil\n&#34;</span><span class="op" id="3619308">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3619312">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3619320">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3619323">p</span><span class="op" id="3619324">.</span><span class="builtinfunc" id="3619325">print</span><span class="op" id="3619330">(</span><span class="ident" id="3619331">reflect</span><span class="op" id="3619338">.</span><span class="ident" id="3619339">ValueOf</span><span class="op" id="3619346">(</span><span class="ident" id="3619347">x</span><span class="op" id="3619348">)</span><span class="op" id="3619349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3619352">p</span><span class="op" id="3619353">.</span><span class="ident" id="3619354">printf</span><span class="op" id="3619360">(</span><span class="string" id="3619361">&#34;\n&#34;</span><span class="op" id="3619365">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3619369">return</span><br>
<span class="lineno"></span><span class="op" id="3619376">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3619379">//&nbsp;Print&nbsp;prints&nbsp;x&nbsp;to&nbsp;standard&nbsp;output,&nbsp;skipping&nbsp;nil&nbsp;fields.</span><br>
<span class="lineno"></span><span class="comment" id="3619438">//&nbsp;Print(fset,&nbsp;x)&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;Fprint(os.Stdout,&nbsp;fset,&nbsp;x,&nbsp;NotNilFilter).</span><br>
<span class="lineno">70</span><span class="keyword" id="3619513">func</span>&nbsp;<span class="ident" id="3619518">Print</span><span class="op" id="3619523">(</span><span class="ident" id="3619524">fset</span>&nbsp;<span class="op" id="3619529">*</span><span class="ident" id="3619530">token</span><span class="op" id="3619535">.</span><span class="ident" id="3619536">FileSet</span><span class="op" id="3619543">,</span>&nbsp;<span class="ident" id="3619545">x</span>&nbsp;<span class="keyword" id="3619547">interface</span><span class="op" id="3619556">{</span><span class="op" id="3619557">}</span><span class="op" id="3619558">)</span>&nbsp;<span class="builtintype" id="3619560">error</span>&nbsp;<span class="op" id="3619566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3619569">return</span>&nbsp;<span class="ident" id="3619576">Fprint</span><span class="op" id="3619582">(</span><span class="ident" id="3619583">os</span><span class="op" id="3619585">.</span><span class="ident" id="3619586">Stdout</span><span class="op" id="3619592">,</span>&nbsp;<span class="ident" id="3619594">fset</span><span class="op" id="3619598">,</span>&nbsp;<span class="ident" id="3619600">x</span><span class="op" id="3619601">,</span>&nbsp;<span class="ident" id="3619603">NotNilFilter</span><span class="op" id="3619615">)</span><br>
<span class="lineno"></span><span class="op" id="3619617">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3619620">type</span>&nbsp;<span class="ident" id="3619625">printer</span>&nbsp;<span class="keyword" id="3619633">struct</span>&nbsp;<span class="op" id="3619640">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3619643">output</span>&nbsp;<span class="ident" id="3619650">io</span><span class="op" id="3619652">.</span><span class="ident" id="3619653">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3619661">fset</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3619668">*</span><span class="ident" id="3619669">token</span><span class="op" id="3619674">.</span><span class="ident" id="3619675">FileSet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3619684">filter</span>&nbsp;<span class="ident" id="3619691">FieldFilter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3619704">ptrmap</span>&nbsp;<span class="keyword" id="3619711">map</span><span class="op" id="3619714">[</span><span class="keyword" id="3619715">interface</span><span class="op" id="3619724">{</span><span class="op" id="3619725">}</span><span class="op" id="3619726">]</span><span class="builtintype" id="3619727">int</span>&nbsp;<span class="comment" id="3619731">//&nbsp;*T&nbsp;-&gt;&nbsp;line&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3619753">indent</span>&nbsp;<span class="builtintype" id="3619760">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3619780">//&nbsp;current&nbsp;indentation&nbsp;level</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3619810">last</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3619817">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3619837">//&nbsp;the&nbsp;last&nbsp;byte&nbsp;processed&nbsp;by&nbsp;Write</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3619874">line</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3619881">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3619901">//&nbsp;current&nbsp;line&nbsp;number</span><br>
<span class="lineno"></span><span class="op" id="3619924">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3619927">var</span>&nbsp;<span class="ident" id="3619931">indent</span>&nbsp;<span class="op" id="3619938">=</span>&nbsp;<span class="op" id="3619940">[</span><span class="op" id="3619941">]</span><span class="builtintype" id="3619942">byte</span><span class="op" id="3619946">(</span><span class="string" id="3619947">&#34;.&nbsp;&nbsp;&#34;</span><span class="op" id="3619952">)</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="keyword" id="3619955">func</span>&nbsp;<span class="op" id="3619960">(</span><span class="ident" id="3619961">p</span>&nbsp;<span class="op" id="3619963">*</span><span class="ident" id="3619964">printer</span><span class="op" id="3619971">)</span>&nbsp;<span class="ident" id="3619973">Write</span><span class="op" id="3619978">(</span><span class="ident" id="3619979">data</span>&nbsp;<span class="op" id="3619984">[</span><span class="op" id="3619985">]</span><span class="builtintype" id="3619986">byte</span><span class="op" id="3619990">)</span>&nbsp;<span class="op" id="3619992">(</span><span class="ident" id="3619993">n</span>&nbsp;<span class="builtintype" id="3619995">int</span><span class="op" id="3619998">,</span>&nbsp;<span class="ident" id="3620000">err</span>&nbsp;<span class="builtintype" id="3620004">error</span><span class="op" id="3620009">)</span>&nbsp;<span class="op" id="3620011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3620014">var</span>&nbsp;<span class="ident" id="3620018">m</span>&nbsp;<span class="builtintype" id="3620020">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3620025">for</span>&nbsp;<span class="ident" id="3620029">i</span><span class="op" id="3620030">,</span>&nbsp;<span class="ident" id="3620032">b</span>&nbsp;<span class="op" id="3620034">:=</span>&nbsp;<span class="keyword" id="3620037">range</span>&nbsp;<span class="ident" id="3620043">data</span>&nbsp;<span class="op" id="3620048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3620052">//&nbsp;invariant:&nbsp;data[0:n]&nbsp;has&nbsp;been&nbsp;written</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3620095">if</span>&nbsp;<span class="ident" id="3620098">b</span>&nbsp;<span class="op" id="3620100">==</span>&nbsp;<span class="string" id="3620103">&#39;\n&#39;</span>&nbsp;<span class="op" id="3620108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3620113">m</span><span class="op" id="3620114">,</span>&nbsp;<span class="ident" id="3620116">err</span>&nbsp;<span class="op" id="3620120">=</span>&nbsp;<span class="ident" id="3620122">p</span><span class="op" id="3620123">.</span><span class="ident" id="3620124">output</span><span class="op" id="3620130">.</span><span class="ident" id="3620131">Write</span><span class="op" id="3620136">(</span><span class="ident" id="3620137">data</span><span class="op" id="3620141">[</span><span class="ident" id="3620142">n</span>&nbsp;<span class="op" id="3620144">:</span>&nbsp;<span class="ident" id="3620146">i</span><span class="op" id="3620147">+</span><span class="num" id="3620148">1</span><span class="op" id="3620149">]</span><span class="op" id="3620150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3620155">n</span>&nbsp;<span class="op" id="3620157">+=</span>&nbsp;<span class="ident" id="3620160">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3620165">if</span>&nbsp;<span class="ident" id="3620168">err</span>&nbsp;<span class="op" id="3620172">!=</span>&nbsp;<span class="ident" id="3620175">nil</span>&nbsp;<span class="op" id="3620179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3620185">return</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3620195">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3620200">p</span><span class="op" id="3620201">.</span><span class="ident" id="3620202">line</span><span class="op" id="3620206">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3620211">}</span>&nbsp;<span class="keyword" id="3620213">else</span>&nbsp;<span class="keyword" id="3620218">if</span>&nbsp;<span class="ident" id="3620221">p</span><span class="op" id="3620222">.</span><span class="ident" id="3620223">last</span>&nbsp;<span class="op" id="3620228">==</span>&nbsp;<span class="string" id="3620231">&#39;\n&#39;</span>&nbsp;<span class="op" id="3620236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3620241">_</span><span class="op" id="3620242">,</span>&nbsp;<span class="ident" id="3620244">err</span>&nbsp;<span class="op" id="3620248">=</span>&nbsp;<span class="ident" id="3620250">fmt</span><span class="op" id="3620253">.</span><span class="ident" id="3620254">Fprintf</span><span class="op" id="3620261">(</span><span class="ident" id="3620262">p</span><span class="op" id="3620263">.</span><span class="ident" id="3620264">output</span><span class="op" id="3620270">,</span>&nbsp;<span class="string" id="3620272">&#34;%6d&nbsp;&nbsp;&#34;</span><span class="op" id="3620279">,</span>&nbsp;<span class="ident" id="3620281">p</span><span class="op" id="3620282">.</span><span class="ident" id="3620283">line</span><span class="op" id="3620287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3620292">if</span>&nbsp;<span class="ident" id="3620295">err</span>&nbsp;<span class="op" id="3620299">!=</span>&nbsp;<span class="ident" id="3620302">nil</span>&nbsp;<span class="op" id="3620306">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3620312">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3620322">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3620327">for</span>&nbsp;<span class="ident" id="3620331">j</span>&nbsp;<span class="op" id="3620333">:=</span>&nbsp;<span class="ident" id="3620336">p</span><span class="op" id="3620337">.</span><span class="ident" id="3620338">indent</span><span class="op" id="3620344">;</span>&nbsp;<span class="ident" id="3620346">j</span>&nbsp;<span class="op" id="3620348">&gt;</span>&nbsp;<span class="num" id="3620350">0</span><span class="op" id="3620351">;</span>&nbsp;<span class="ident" id="3620353">j</span><span class="op" id="3620354">--</span>&nbsp;<span class="op" id="3620357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3620363">_</span><span class="op" id="3620364">,</span>&nbsp;<span class="ident" id="3620366">err</span>&nbsp;<span class="op" id="3620370">=</span>&nbsp;<span class="ident" id="3620372">p</span><span class="op" id="3620373">.</span><span class="ident" id="3620374">output</span><span class="op" id="3620380">.</span><span class="ident" id="3620381">Write</span><span class="op" id="3620386">(</span><span class="ident" id="3620387">indent</span><span class="op" id="3620393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3620399">if</span>&nbsp;<span class="ident" id="3620402">err</span>&nbsp;<span class="op" id="3620406">!=</span>&nbsp;<span class="ident" id="3620409">nil</span>&nbsp;<span class="op" id="3620413">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3620420">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3620431">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3620436">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3620440">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3620444">p</span><span class="op" id="3620445">.</span><span class="ident" id="3620446">last</span>&nbsp;<span class="op" id="3620451">=</span>&nbsp;<span class="ident" id="3620453">b</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3620456">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3620459">if</span>&nbsp;<span class="builtinfunc" id="3620462">len</span><span class="op" id="3620465">(</span><span class="ident" id="3620466">data</span><span class="op" id="3620470">)</span>&nbsp;<span class="op" id="3620472">&gt;</span>&nbsp;<span class="ident" id="3620474">n</span>&nbsp;<span class="op" id="3620476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3620480">m</span><span class="op" id="3620481">,</span>&nbsp;<span class="ident" id="3620483">err</span>&nbsp;<span class="op" id="3620487">=</span>&nbsp;<span class="ident" id="3620489">p</span><span class="op" id="3620490">.</span><span class="ident" id="3620491">output</span><span class="op" id="3620497">.</span><span class="ident" id="3620498">Write</span><span class="op" id="3620503">(</span><span class="ident" id="3620504">data</span><span class="op" id="3620508">[</span><span class="ident" id="3620509">n</span><span class="op" id="3620510">:</span><span class="op" id="3620511">]</span><span class="op" id="3620512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3620516">n</span>&nbsp;<span class="op" id="3620518">+=</span>&nbsp;<span class="ident" id="3620521">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3620524">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3620527">return</span><br>
<span class="lineno"></span><span class="op" id="3620534">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3620537">//&nbsp;localError&nbsp;wraps&nbsp;locally&nbsp;caught&nbsp;errors&nbsp;so&nbsp;we&nbsp;can&nbsp;distinguish</span><br>
<span class="lineno"></span><span class="comment" id="3620601">//&nbsp;them&nbsp;from&nbsp;genuine&nbsp;panics&nbsp;which&nbsp;we&nbsp;don&#39;t&nbsp;want&nbsp;to&nbsp;return&nbsp;as&nbsp;errors.</span><br>
<span class="lineno">120</span><span class="keyword" id="3620670">type</span>&nbsp;<span class="ident" id="3620675">localError</span>&nbsp;<span class="keyword" id="3620686">struct</span>&nbsp;<span class="op" id="3620693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3620696">err</span>&nbsp;<span class="builtintype" id="3620700">error</span><br>
<span class="lineno"></span><span class="op" id="3620706">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3620709">//&nbsp;printf&nbsp;is&nbsp;a&nbsp;convenience&nbsp;wrapper&nbsp;that&nbsp;takes&nbsp;care&nbsp;of&nbsp;print&nbsp;errors.</span><br>
<span class="lineno">125</span><span class="keyword" id="3620777">func</span>&nbsp;<span class="op" id="3620782">(</span><span class="ident" id="3620783">p</span>&nbsp;<span class="op" id="3620785">*</span><span class="ident" id="3620786">printer</span><span class="op" id="3620793">)</span>&nbsp;<span class="ident" id="3620795">printf</span><span class="op" id="3620801">(</span><span class="ident" id="3620802">format</span>&nbsp;<span class="builtintype" id="3620809">string</span><span class="op" id="3620815">,</span>&nbsp;<span class="ident" id="3620817">args</span>&nbsp;<span class="op" id="3620822">...</span><span class="keyword" id="3620825">interface</span><span class="op" id="3620834">{</span><span class="op" id="3620835">}</span><span class="op" id="3620836">)</span>&nbsp;<span class="op" id="3620838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3620841">if</span>&nbsp;<span class="ident" id="3620844">_</span><span class="op" id="3620845">,</span>&nbsp;<span class="ident" id="3620847">err</span>&nbsp;<span class="op" id="3620851">:=</span>&nbsp;<span class="ident" id="3620854">fmt</span><span class="op" id="3620857">.</span><span class="ident" id="3620858">Fprintf</span><span class="op" id="3620865">(</span><span class="ident" id="3620866">p</span><span class="op" id="3620867">,</span>&nbsp;<span class="ident" id="3620869">format</span><span class="op" id="3620875">,</span>&nbsp;<span class="ident" id="3620877">args</span><span class="op" id="3620881">...</span><span class="op" id="3620884">)</span><span class="op" id="3620885">;</span>&nbsp;<span class="ident" id="3620887">err</span>&nbsp;<span class="op" id="3620891">!=</span>&nbsp;<span class="ident" id="3620894">nil</span>&nbsp;<span class="op" id="3620898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3620902">panic</span><span class="op" id="3620907">(</span><span class="ident" id="3620908">localError</span><span class="op" id="3620918">{</span><span class="ident" id="3620919">err</span><span class="op" id="3620922">}</span><span class="op" id="3620923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3620926">}</span><br>
<span class="lineno"></span><span class="op" id="3620928">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="3620931">//&nbsp;Implementation&nbsp;note:&nbsp;Print&nbsp;is&nbsp;written&nbsp;for&nbsp;AST&nbsp;nodes&nbsp;but&nbsp;could&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="3620999">//&nbsp;used&nbsp;to&nbsp;print&nbsp;arbitrary&nbsp;data&nbsp;structures;&nbsp;such&nbsp;a&nbsp;version&nbsp;should</span><br>
<span class="lineno"></span><span class="comment" id="3621065">//&nbsp;probably&nbsp;be&nbsp;in&nbsp;a&nbsp;different&nbsp;package.</span><br>
<span class="lineno"></span><span class="comment" id="3621104">//</span><br>
<span class="lineno">135</span><span class="comment" id="3621107">//&nbsp;Note:&nbsp;This&nbsp;code&nbsp;detects&nbsp;(some)&nbsp;cycles&nbsp;created&nbsp;via&nbsp;pointers&nbsp;but</span><br>
<span class="lineno"></span><span class="comment" id="3621173">//&nbsp;not&nbsp;cycles&nbsp;that&nbsp;are&nbsp;created&nbsp;via&nbsp;slices&nbsp;or&nbsp;maps&nbsp;containing&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3621238">//&nbsp;same&nbsp;slice&nbsp;or&nbsp;map.&nbsp;Code&nbsp;for&nbsp;general&nbsp;data&nbsp;structures&nbsp;probably</span><br>
<span class="lineno"></span><span class="comment" id="3621302">//&nbsp;should&nbsp;catch&nbsp;those&nbsp;as&nbsp;well.</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span><span class="keyword" id="3621334">func</span>&nbsp;<span class="op" id="3621339">(</span><span class="ident" id="3621340">p</span>&nbsp;<span class="op" id="3621342">*</span><span class="ident" id="3621343">printer</span><span class="op" id="3621350">)</span>&nbsp;<span class="builtinfunc" id="3621352">print</span><span class="op" id="3621357">(</span><span class="ident" id="3621358">x</span>&nbsp;<span class="ident" id="3621360">reflect</span><span class="op" id="3621367">.</span><span class="ident" id="3621368">Value</span><span class="op" id="3621373">)</span>&nbsp;<span class="op" id="3621375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3621378">if</span>&nbsp;<span class="op" id="3621381">!</span><span class="ident" id="3621382">NotNilFilter</span><span class="op" id="3621394">(</span><span class="string" id="3621395">&#34;&#34;</span><span class="op" id="3621397">,</span>&nbsp;<span class="ident" id="3621399">x</span><span class="op" id="3621400">)</span>&nbsp;<span class="op" id="3621402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3621406">p</span><span class="op" id="3621407">.</span><span class="ident" id="3621408">printf</span><span class="op" id="3621414">(</span><span class="string" id="3621415">&#34;nil&#34;</span><span class="op" id="3621420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3621424">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3621432">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3621436">switch</span>&nbsp;<span class="ident" id="3621443">x</span><span class="op" id="3621444">.</span><span class="ident" id="3621445">Kind</span><span class="op" id="3621449">(</span><span class="op" id="3621450">)</span>&nbsp;<span class="op" id="3621452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3621455">case</span>&nbsp;<span class="ident" id="3621460">reflect</span><span class="op" id="3621467">.</span><span class="ident" id="3621468">Interface</span><span class="op" id="3621477">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3621481">p</span><span class="op" id="3621482">.</span><span class="builtinfunc" id="3621483">print</span><span class="op" id="3621488">(</span><span class="ident" id="3621489">x</span><span class="op" id="3621490">.</span><span class="ident" id="3621491">Elem</span><span class="op" id="3621495">(</span><span class="op" id="3621496">)</span><span class="op" id="3621497">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3621501">case</span>&nbsp;<span class="ident" id="3621506">reflect</span><span class="op" id="3621513">.</span><span class="ident" id="3621514">Map</span><span class="op" id="3621517">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3621521">p</span><span class="op" id="3621522">.</span><span class="ident" id="3621523">printf</span><span class="op" id="3621529">(</span><span class="string" id="3621530">&#34;%s&nbsp;(len&nbsp;=&nbsp;%d)&nbsp;{&#34;</span><span class="op" id="3621547">,</span>&nbsp;<span class="ident" id="3621549">x</span><span class="op" id="3621550">.</span><span class="ident" id="3621551">Type</span><span class="op" id="3621555">(</span><span class="op" id="3621556">)</span><span class="op" id="3621557">,</span>&nbsp;<span class="ident" id="3621559">x</span><span class="op" id="3621560">.</span><span class="ident" id="3621561">Len</span><span class="op" id="3621564">(</span><span class="op" id="3621565">)</span><span class="op" id="3621566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3621570">if</span>&nbsp;<span class="ident" id="3621573">x</span><span class="op" id="3621574">.</span><span class="ident" id="3621575">Len</span><span class="op" id="3621578">(</span><span class="op" id="3621579">)</span>&nbsp;<span class="op" id="3621581">&gt;</span>&nbsp;<span class="num" id="3621583">0</span>&nbsp;<span class="op" id="3621585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3621590">p</span><span class="op" id="3621591">.</span><span class="ident" id="3621592">indent</span><span class="op" id="3621598">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3621604">p</span><span class="op" id="3621605">.</span><span class="ident" id="3621606">printf</span><span class="op" id="3621612">(</span><span class="string" id="3621613">&#34;\n&#34;</span><span class="op" id="3621617">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3621622">for</span>&nbsp;<span class="ident" id="3621626">_</span><span class="op" id="3621627">,</span>&nbsp;<span class="ident" id="3621629">key</span>&nbsp;<span class="op" id="3621633">:=</span>&nbsp;<span class="keyword" id="3621636">range</span>&nbsp;<span class="ident" id="3621642">x</span><span class="op" id="3621643">.</span><span class="ident" id="3621644">MapKeys</span><span class="op" id="3621651">(</span><span class="op" id="3621652">)</span>&nbsp;<span class="op" id="3621654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3621660">p</span><span class="op" id="3621661">.</span><span class="builtinfunc" id="3621662">print</span><span class="op" id="3621667">(</span><span class="ident" id="3621668">key</span><span class="op" id="3621671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3621677">p</span><span class="op" id="3621678">.</span><span class="ident" id="3621679">printf</span><span class="op" id="3621685">(</span><span class="string" id="3621686">&#34;:&nbsp;&#34;</span><span class="op" id="3621690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3621696">p</span><span class="op" id="3621697">.</span><span class="builtinfunc" id="3621698">print</span><span class="op" id="3621703">(</span><span class="ident" id="3621704">x</span><span class="op" id="3621705">.</span><span class="ident" id="3621706">MapIndex</span><span class="op" id="3621714">(</span><span class="ident" id="3621715">key</span><span class="op" id="3621718">)</span><span class="op" id="3621719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3621725">p</span><span class="op" id="3621726">.</span><span class="ident" id="3621727">printf</span><span class="op" id="3621733">(</span><span class="string" id="3621734">&#34;\n&#34;</span><span class="op" id="3621738">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3621743">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3621748">p</span><span class="op" id="3621749">.</span><span class="ident" id="3621750">indent</span><span class="op" id="3621756">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3621761">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3621765">p</span><span class="op" id="3621766">.</span><span class="ident" id="3621767">printf</span><span class="op" id="3621773">(</span><span class="string" id="3621774">&#34;}&#34;</span><span class="op" id="3621777">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3621781">case</span>&nbsp;<span class="ident" id="3621786">reflect</span><span class="op" id="3621793">.</span><span class="ident" id="3621794">Ptr</span><span class="op" id="3621797">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3621801">p</span><span class="op" id="3621802">.</span><span class="ident" id="3621803">printf</span><span class="op" id="3621809">(</span><span class="string" id="3621810">&#34;*&#34;</span><span class="op" id="3621813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3621817">//&nbsp;type-checked&nbsp;ASTs&nbsp;may&nbsp;contain&nbsp;cycles&nbsp;-&nbsp;use&nbsp;ptrmap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3621872">//&nbsp;to&nbsp;keep&nbsp;track&nbsp;of&nbsp;objects&nbsp;that&nbsp;have&nbsp;been&nbsp;printed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3621925">//&nbsp;already&nbsp;and&nbsp;print&nbsp;the&nbsp;respective&nbsp;line&nbsp;number&nbsp;instead</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3621983">ptr</span>&nbsp;<span class="op" id="3621987">:=</span>&nbsp;<span class="ident" id="3621990">x</span><span class="op" id="3621991">.</span><span class="ident" id="3621992">Interface</span><span class="op" id="3622001">(</span><span class="op" id="3622002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3622006">if</span>&nbsp;<span class="ident" id="3622009">line</span><span class="op" id="3622013">,</span>&nbsp;<span class="ident" id="3622015">exists</span>&nbsp;<span class="op" id="3622022">:=</span>&nbsp;<span class="ident" id="3622025">p</span><span class="op" id="3622026">.</span><span class="ident" id="3622027">ptrmap</span><span class="op" id="3622033">[</span><span class="ident" id="3622034">ptr</span><span class="op" id="3622037">]</span><span class="op" id="3622038">;</span>&nbsp;<span class="ident" id="3622040">exists</span>&nbsp;<span class="op" id="3622047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3622052">p</span><span class="op" id="3622053">.</span><span class="ident" id="3622054">printf</span><span class="op" id="3622060">(</span><span class="string" id="3622061">&#34;(obj&nbsp;@&nbsp;%d)&#34;</span><span class="op" id="3622073">,</span>&nbsp;<span class="ident" id="3622075">line</span><span class="op" id="3622079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3622083">}</span>&nbsp;<span class="keyword" id="3622085">else</span>&nbsp;<span class="op" id="3622090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3622095">p</span><span class="op" id="3622096">.</span><span class="ident" id="3622097">ptrmap</span><span class="op" id="3622103">[</span><span class="ident" id="3622104">ptr</span><span class="op" id="3622107">]</span>&nbsp;<span class="op" id="3622109">=</span>&nbsp;<span class="ident" id="3622111">p</span><span class="op" id="3622112">.</span><span class="ident" id="3622113">line</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3622121">p</span><span class="op" id="3622122">.</span><span class="builtinfunc" id="3622123">print</span><span class="op" id="3622128">(</span><span class="ident" id="3622129">x</span><span class="op" id="3622130">.</span><span class="ident" id="3622131">Elem</span><span class="op" id="3622135">(</span><span class="op" id="3622136">)</span><span class="op" id="3622137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3622141">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3622145">case</span>&nbsp;<span class="ident" id="3622150">reflect</span><span class="op" id="3622157">.</span><span class="ident" id="3622158">Array</span><span class="op" id="3622163">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3622167">p</span><span class="op" id="3622168">.</span><span class="ident" id="3622169">printf</span><span class="op" id="3622175">(</span><span class="string" id="3622176">&#34;%s&nbsp;{&#34;</span><span class="op" id="3622182">,</span>&nbsp;<span class="ident" id="3622184">x</span><span class="op" id="3622185">.</span><span class="ident" id="3622186">Type</span><span class="op" id="3622190">(</span><span class="op" id="3622191">)</span><span class="op" id="3622192">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3622196">if</span>&nbsp;<span class="ident" id="3622199">x</span><span class="op" id="3622200">.</span><span class="ident" id="3622201">Len</span><span class="op" id="3622204">(</span><span class="op" id="3622205">)</span>&nbsp;<span class="op" id="3622207">&gt;</span>&nbsp;<span class="num" id="3622209">0</span>&nbsp;<span class="op" id="3622211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3622216">p</span><span class="op" id="3622217">.</span><span class="ident" id="3622218">indent</span><span class="op" id="3622224">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3622230">p</span><span class="op" id="3622231">.</span><span class="ident" id="3622232">printf</span><span class="op" id="3622238">(</span><span class="string" id="3622239">&#34;\n&#34;</span><span class="op" id="3622243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3622248">for</span>&nbsp;<span class="ident" id="3622252">i</span><span class="op" id="3622253">,</span>&nbsp;<span class="ident" id="3622255">n</span>&nbsp;<span class="op" id="3622257">:=</span>&nbsp;<span class="num" id="3622260">0</span><span class="op" id="3622261">,</span>&nbsp;<span class="ident" id="3622263">x</span><span class="op" id="3622264">.</span><span class="ident" id="3622265">Len</span><span class="op" id="3622268">(</span><span class="op" id="3622269">)</span><span class="op" id="3622270">;</span>&nbsp;<span class="ident" id="3622272">i</span>&nbsp;<span class="op" id="3622274">&lt;</span>&nbsp;<span class="ident" id="3622276">n</span><span class="op" id="3622277">;</span>&nbsp;<span class="ident" id="3622279">i</span><span class="op" id="3622280">++</span>&nbsp;<span class="op" id="3622283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3622289">p</span><span class="op" id="3622290">.</span><span class="ident" id="3622291">printf</span><span class="op" id="3622297">(</span><span class="string" id="3622298">&#34;%d:&nbsp;&#34;</span><span class="op" id="3622304">,</span>&nbsp;<span class="ident" id="3622306">i</span><span class="op" id="3622307">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3622313">p</span><span class="op" id="3622314">.</span><span class="builtinfunc" id="3622315">print</span><span class="op" id="3622320">(</span><span class="ident" id="3622321">x</span><span class="op" id="3622322">.</span><span class="ident" id="3622323">Index</span><span class="op" id="3622328">(</span><span class="ident" id="3622329">i</span><span class="op" id="3622330">)</span><span class="op" id="3622331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3622337">p</span><span class="op" id="3622338">.</span><span class="ident" id="3622339">printf</span><span class="op" id="3622345">(</span><span class="string" id="3622346">&#34;\n&#34;</span><span class="op" id="3622350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3622355">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3622360">p</span><span class="op" id="3622361">.</span><span class="ident" id="3622362">indent</span><span class="op" id="3622368">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3622373">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3622377">p</span><span class="op" id="3622378">.</span><span class="ident" id="3622379">printf</span><span class="op" id="3622385">(</span><span class="string" id="3622386">&#34;}&#34;</span><span class="op" id="3622389">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3622393">case</span>&nbsp;<span class="ident" id="3622398">reflect</span><span class="op" id="3622405">.</span><span class="ident" id="3622406">Slice</span><span class="op" id="3622411">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3622415">if</span>&nbsp;<span class="ident" id="3622418">s</span><span class="op" id="3622419">,</span>&nbsp;<span class="ident" id="3622421">ok</span>&nbsp;<span class="op" id="3622424">:=</span>&nbsp;<span class="ident" id="3622427">x</span><span class="op" id="3622428">.</span><span class="ident" id="3622429">Interface</span><span class="op" id="3622438">(</span><span class="op" id="3622439">)</span><span class="op" id="3622440">.</span><span class="op" id="3622441">(</span><span class="op" id="3622442">[</span><span class="op" id="3622443">]</span><span class="builtintype" id="3622444">byte</span><span class="op" id="3622448">)</span><span class="op" id="3622449">;</span>&nbsp;<span class="ident" id="3622451">ok</span>&nbsp;<span class="op" id="3622454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3622459">p</span><span class="op" id="3622460">.</span><span class="ident" id="3622461">printf</span><span class="op" id="3622467">(</span><span class="string" id="3622468">&#34;%#q&#34;</span><span class="op" id="3622473">,</span>&nbsp;<span class="ident" id="3622475">s</span><span class="op" id="3622476">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3622481">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3622490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3622494">p</span><span class="op" id="3622495">.</span><span class="ident" id="3622496">printf</span><span class="op" id="3622502">(</span><span class="string" id="3622503">&#34;%s&nbsp;(len&nbsp;=&nbsp;%d)&nbsp;{&#34;</span><span class="op" id="3622520">,</span>&nbsp;<span class="ident" id="3622522">x</span><span class="op" id="3622523">.</span><span class="ident" id="3622524">Type</span><span class="op" id="3622528">(</span><span class="op" id="3622529">)</span><span class="op" id="3622530">,</span>&nbsp;<span class="ident" id="3622532">x</span><span class="op" id="3622533">.</span><span class="ident" id="3622534">Len</span><span class="op" id="3622537">(</span><span class="op" id="3622538">)</span><span class="op" id="3622539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3622543">if</span>&nbsp;<span class="ident" id="3622546">x</span><span class="op" id="3622547">.</span><span class="ident" id="3622548">Len</span><span class="op" id="3622551">(</span><span class="op" id="3622552">)</span>&nbsp;<span class="op" id="3622554">&gt;</span>&nbsp;<span class="num" id="3622556">0</span>&nbsp;<span class="op" id="3622558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3622563">p</span><span class="op" id="3622564">.</span><span class="ident" id="3622565">indent</span><span class="op" id="3622571">++</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3622577">p</span><span class="op" id="3622578">.</span><span class="ident" id="3622579">printf</span><span class="op" id="3622585">(</span><span class="string" id="3622586">&#34;\n&#34;</span><span class="op" id="3622590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3622595">for</span>&nbsp;<span class="ident" id="3622599">i</span><span class="op" id="3622600">,</span>&nbsp;<span class="ident" id="3622602">n</span>&nbsp;<span class="op" id="3622604">:=</span>&nbsp;<span class="num" id="3622607">0</span><span class="op" id="3622608">,</span>&nbsp;<span class="ident" id="3622610">x</span><span class="op" id="3622611">.</span><span class="ident" id="3622612">Len</span><span class="op" id="3622615">(</span><span class="op" id="3622616">)</span><span class="op" id="3622617">;</span>&nbsp;<span class="ident" id="3622619">i</span>&nbsp;<span class="op" id="3622621">&lt;</span>&nbsp;<span class="ident" id="3622623">n</span><span class="op" id="3622624">;</span>&nbsp;<span class="ident" id="3622626">i</span><span class="op" id="3622627">++</span>&nbsp;<span class="op" id="3622630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3622636">p</span><span class="op" id="3622637">.</span><span class="ident" id="3622638">printf</span><span class="op" id="3622644">(</span><span class="string" id="3622645">&#34;%d:&nbsp;&#34;</span><span class="op" id="3622651">,</span>&nbsp;<span class="ident" id="3622653">i</span><span class="op" id="3622654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3622660">p</span><span class="op" id="3622661">.</span><span class="builtinfunc" id="3622662">print</span><span class="op" id="3622667">(</span><span class="ident" id="3622668">x</span><span class="op" id="3622669">.</span><span class="ident" id="3622670">Index</span><span class="op" id="3622675">(</span><span class="ident" id="3622676">i</span><span class="op" id="3622677">)</span><span class="op" id="3622678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3622684">p</span><span class="op" id="3622685">.</span><span class="ident" id="3622686">printf</span><span class="op" id="3622692">(</span><span class="string" id="3622693">&#34;\n&#34;</span><span class="op" id="3622697">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3622702">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3622707">p</span><span class="op" id="3622708">.</span><span class="ident" id="3622709">indent</span><span class="op" id="3622715">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3622720">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3622724">p</span><span class="op" id="3622725">.</span><span class="ident" id="3622726">printf</span><span class="op" id="3622732">(</span><span class="string" id="3622733">&#34;}&#34;</span><span class="op" id="3622736">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3622740">case</span>&nbsp;<span class="ident" id="3622745">reflect</span><span class="op" id="3622752">.</span><span class="ident" id="3622753">Struct</span><span class="op" id="3622759">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3622763">t</span>&nbsp;<span class="op" id="3622765">:=</span>&nbsp;<span class="ident" id="3622768">x</span><span class="op" id="3622769">.</span><span class="ident" id="3622770">Type</span><span class="op" id="3622774">(</span><span class="op" id="3622775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3622779">p</span><span class="op" id="3622780">.</span><span class="ident" id="3622781">printf</span><span class="op" id="3622787">(</span><span class="string" id="3622788">&#34;%s&nbsp;{&#34;</span><span class="op" id="3622794">,</span>&nbsp;<span class="ident" id="3622796">t</span><span class="op" id="3622797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3622801">p</span><span class="op" id="3622802">.</span><span class="ident" id="3622803">indent</span><span class="op" id="3622809">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3622814">first</span>&nbsp;<span class="op" id="3622820">:=</span>&nbsp;<span class="builtintype" id="3622823">true</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3622830">for</span>&nbsp;<span class="ident" id="3622834">i</span><span class="op" id="3622835">,</span>&nbsp;<span class="ident" id="3622837">n</span>&nbsp;<span class="op" id="3622839">:=</span>&nbsp;<span class="num" id="3622842">0</span><span class="op" id="3622843">,</span>&nbsp;<span class="ident" id="3622845">t</span><span class="op" id="3622846">.</span><span class="ident" id="3622847">NumField</span><span class="op" id="3622855">(</span><span class="op" id="3622856">)</span><span class="op" id="3622857">;</span>&nbsp;<span class="ident" id="3622859">i</span>&nbsp;<span class="op" id="3622861">&lt;</span>&nbsp;<span class="ident" id="3622863">n</span><span class="op" id="3622864">;</span>&nbsp;<span class="ident" id="3622866">i</span><span class="op" id="3622867">++</span>&nbsp;<span class="op" id="3622870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3622875">//&nbsp;exclude&nbsp;non-exported&nbsp;fields&nbsp;because&nbsp;their</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3622923">//&nbsp;values&nbsp;cannot&nbsp;be&nbsp;accessed&nbsp;via&nbsp;reflection</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3622970">if</span>&nbsp;<span class="ident" id="3622973">name</span>&nbsp;<span class="op" id="3622978">:=</span>&nbsp;<span class="ident" id="3622981">t</span><span class="op" id="3622982">.</span><span class="ident" id="3622983">Field</span><span class="op" id="3622988">(</span><span class="ident" id="3622989">i</span><span class="op" id="3622990">)</span><span class="op" id="3622991">.</span><span class="ident" id="3622992">Name</span><span class="op" id="3622996">;</span>&nbsp;<span class="ident" id="3622998">IsExported</span><span class="op" id="3623008">(</span><span class="ident" id="3623009">name</span><span class="op" id="3623013">)</span>&nbsp;<span class="op" id="3623015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3623021">value</span>&nbsp;<span class="op" id="3623027">:=</span>&nbsp;<span class="ident" id="3623030">x</span><span class="op" id="3623031">.</span><span class="ident" id="3623032">Field</span><span class="op" id="3623037">(</span><span class="ident" id="3623038">i</span><span class="op" id="3623039">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3623045">if</span>&nbsp;<span class="ident" id="3623048">p</span><span class="op" id="3623049">.</span><span class="ident" id="3623050">filter</span>&nbsp;<span class="op" id="3623057">==</span>&nbsp;<span class="ident" id="3623060">nil</span>&nbsp;<span class="op" id="3623064">||</span>&nbsp;<span class="ident" id="3623067">p</span><span class="op" id="3623068">.</span><span class="ident" id="3623069">filter</span><span class="op" id="3623075">(</span><span class="ident" id="3623076">name</span><span class="op" id="3623080">,</span>&nbsp;<span class="ident" id="3623082">value</span><span class="op" id="3623087">)</span>&nbsp;<span class="op" id="3623089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3623096">if</span>&nbsp;<span class="ident" id="3623099">first</span>&nbsp;<span class="op" id="3623105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3623113">p</span><span class="op" id="3623114">.</span><span class="ident" id="3623115">printf</span><span class="op" id="3623121">(</span><span class="string" id="3623122">&#34;\n&#34;</span><span class="op" id="3623126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3623134">first</span>&nbsp;<span class="op" id="3623140">=</span>&nbsp;<span class="builtintype" id="3623142">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3623153">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3623160">p</span><span class="op" id="3623161">.</span><span class="ident" id="3623162">printf</span><span class="op" id="3623168">(</span><span class="string" id="3623169">&#34;%s:&nbsp;&#34;</span><span class="op" id="3623175">,</span>&nbsp;<span class="ident" id="3623177">name</span><span class="op" id="3623181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3623188">p</span><span class="op" id="3623189">.</span><span class="builtinfunc" id="3623190">print</span><span class="op" id="3623195">(</span><span class="ident" id="3623196">value</span><span class="op" id="3623201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3623208">p</span><span class="op" id="3623209">.</span><span class="ident" id="3623210">printf</span><span class="op" id="3623216">(</span><span class="string" id="3623217">&#34;\n&#34;</span><span class="op" id="3623221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3623227">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3623232">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3623236">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3623240">p</span><span class="op" id="3623241">.</span><span class="ident" id="3623242">indent</span><span class="op" id="3623248">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3623253">p</span><span class="op" id="3623254">.</span><span class="ident" id="3623255">printf</span><span class="op" id="3623261">(</span><span class="string" id="3623262">&#34;}&#34;</span><span class="op" id="3623265">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3623269">default</span><span class="op" id="3623276">:</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3623280">v</span>&nbsp;<span class="op" id="3623282">:=</span>&nbsp;<span class="ident" id="3623285">x</span><span class="op" id="3623286">.</span><span class="ident" id="3623287">Interface</span><span class="op" id="3623296">(</span><span class="op" id="3623297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3623301">switch</span>&nbsp;<span class="ident" id="3623308">v</span>&nbsp;<span class="op" id="3623310">:=</span>&nbsp;<span class="ident" id="3623313">v</span><span class="op" id="3623314">.</span><span class="op" id="3623315">(</span><span class="keyword" id="3623316">type</span><span class="op" id="3623320">)</span>&nbsp;<span class="op" id="3623322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3623326">case</span>&nbsp;<span class="builtintype" id="3623331">string</span><span class="op" id="3623337">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3623342">//&nbsp;print&nbsp;strings&nbsp;in&nbsp;quotes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3623372">p</span><span class="op" id="3623373">.</span><span class="ident" id="3623374">printf</span><span class="op" id="3623380">(</span><span class="string" id="3623381">&#34;%q&#34;</span><span class="op" id="3623385">,</span>&nbsp;<span class="ident" id="3623387">v</span><span class="op" id="3623388">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3623393">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3623402">case</span>&nbsp;<span class="ident" id="3623407">token</span><span class="op" id="3623412">.</span><span class="ident" id="3623413">Pos</span><span class="op" id="3623416">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3623421">//&nbsp;position&nbsp;values&nbsp;can&nbsp;be&nbsp;printed&nbsp;nicely&nbsp;if&nbsp;we&nbsp;have&nbsp;a&nbsp;file&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3623487">if</span>&nbsp;<span class="ident" id="3623490">p</span><span class="op" id="3623491">.</span><span class="ident" id="3623492">fset</span>&nbsp;<span class="op" id="3623497">!=</span>&nbsp;<span class="ident" id="3623500">nil</span>&nbsp;<span class="op" id="3623504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3623510">p</span><span class="op" id="3623511">.</span><span class="ident" id="3623512">printf</span><span class="op" id="3623518">(</span><span class="string" id="3623519">&#34;%s&#34;</span><span class="op" id="3623523">,</span>&nbsp;<span class="ident" id="3623525">p</span><span class="op" id="3623526">.</span><span class="ident" id="3623527">fset</span><span class="op" id="3623531">.</span><span class="ident" id="3623532">Position</span><span class="op" id="3623540">(</span><span class="ident" id="3623541">v</span><span class="op" id="3623542">)</span><span class="op" id="3623543">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3623549">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3623559">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3623563">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3623567">//&nbsp;default</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3623580">p</span><span class="op" id="3623581">.</span><span class="ident" id="3623582">printf</span><span class="op" id="3623588">(</span><span class="string" id="3623589">&#34;%v&#34;</span><span class="op" id="3623593">,</span>&nbsp;<span class="ident" id="3623595">v</span><span class="op" id="3623596">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3623599">}</span><br>
<span class="lineno"></span><span class="op" id="3623601">}</span>
</div>
</body>
</html>
