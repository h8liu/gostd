<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/printer</h2>
<ul>
<li><a href="/gostd/go/printer/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/printer/nodes.go.html">nodes.go</a></li>
<li><a href="/gostd/go/printer/performance_test.go.html">performance_test.go</a></li>
<li><a href="/gostd/go/printer/printer.go.html">printer.go</a></li>
<li><a href="/gostd/go/printer/printer_test.go.html">printer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7716997">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7717052">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7717106">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7717157">package</span>&nbsp;<span class="ident" id="7717165">printer</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7717174">import</span>&nbsp;<span class="op" id="7717181">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7717184">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7717193">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7717203">&#34;flag&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7717211">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7717218">&#34;go/ast&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7717228">&#34;go/parser&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7717241">&#34;go/token&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7717253">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7717266">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7717283">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7717294">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7717301">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="7717304">const</span>&nbsp;<span class="op" id="7717310">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7717313">dataDir</span>&nbsp;&nbsp;<span class="op" id="7717322">=</span>&nbsp;<span class="string" id="7717324">&#34;testdata&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7717336">tabwidth</span>&nbsp;<span class="op" id="7717345">=</span>&nbsp;<span class="num" id="7717347">8</span><br>
<span class="lineno"></span><span class="op" id="7717349">)</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="7717352">var</span>&nbsp;<span class="ident" id="7717356">update</span>&nbsp;<span class="op" id="7717363">=</span>&nbsp;<span class="ident" id="7717365">flag</span><span class="op" id="7717369">.</span><span class="ident" id="7717370">Bool</span><span class="op" id="7717374">(</span><span class="string" id="7717375">&#34;update&#34;</span><span class="op" id="7717383">,</span>&nbsp;<span class="builtintype" id="7717385">false</span><span class="op" id="7717390">,</span>&nbsp;<span class="string" id="7717392">&#34;update&nbsp;golden&nbsp;files&#34;</span><span class="op" id="7717413">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7717416">var</span>&nbsp;<span class="ident" id="7717420">fset</span>&nbsp;<span class="op" id="7717425">=</span>&nbsp;<span class="ident" id="7717427">token</span><span class="op" id="7717432">.</span><span class="ident" id="7717433">NewFileSet</span><span class="op" id="7717443">(</span><span class="op" id="7717444">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="7717447">type</span>&nbsp;<span class="ident" id="7717452">checkMode</span>&nbsp;<span class="builtintype" id="7717462">uint</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7717468">const</span>&nbsp;<span class="op" id="7717474">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7717477">export</span>&nbsp;<span class="ident" id="7717484">checkMode</span>&nbsp;<span class="op" id="7717494">=</span>&nbsp;<span class="num" id="7717496">1</span>&nbsp;<span class="op" id="7717498">&lt;&lt;</span>&nbsp;<span class="ident" id="7717501">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7717507">rawFormat</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7717518">idempotent</span><br>
<span class="lineno"></span><span class="op" id="7717529">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7717532">//&nbsp;format&nbsp;parses&nbsp;src,&nbsp;prints&nbsp;the&nbsp;corresponding&nbsp;AST,&nbsp;verifies&nbsp;the&nbsp;resulting</span><br>
<span class="lineno"></span><span class="comment" id="7717607">//&nbsp;src&nbsp;is&nbsp;syntactically&nbsp;correct,&nbsp;and&nbsp;returns&nbsp;the&nbsp;resulting&nbsp;src&nbsp;or&nbsp;an&nbsp;error</span><br>
<span class="lineno">40</span><span class="comment" id="7717682">//&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="7717693">func</span>&nbsp;<span class="ident" id="7717698">format</span><span class="op" id="7717704">(</span><span class="ident" id="7717705">src</span>&nbsp;<span class="op" id="7717709">[</span><span class="op" id="7717710">]</span><span class="builtintype" id="7717711">byte</span><span class="op" id="7717715">,</span>&nbsp;<span class="ident" id="7717717">mode</span>&nbsp;<span class="ident" id="7717722">checkMode</span><span class="op" id="7717731">)</span>&nbsp;<span class="op" id="7717733">(</span><span class="op" id="7717734">[</span><span class="op" id="7717735">]</span><span class="builtintype" id="7717736">byte</span><span class="op" id="7717740">,</span>&nbsp;<span class="builtintype" id="7717742">error</span><span class="op" id="7717747">)</span>&nbsp;<span class="op" id="7717749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7717752">//&nbsp;parse&nbsp;src</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7717766">f</span><span class="op" id="7717767">,</span>&nbsp;<span class="ident" id="7717769">err</span>&nbsp;<span class="op" id="7717773">:=</span>&nbsp;<span class="ident" id="7717776">parser</span><span class="op" id="7717782">.</span><span class="ident" id="7717783">ParseFile</span><span class="op" id="7717792">(</span><span class="ident" id="7717793">fset</span><span class="op" id="7717797">,</span>&nbsp;<span class="string" id="7717799">&#34;&#34;</span><span class="op" id="7717801">,</span>&nbsp;<span class="ident" id="7717803">src</span><span class="op" id="7717806">,</span>&nbsp;<span class="ident" id="7717808">parser</span><span class="op" id="7717814">.</span><span class="ident" id="7717815">ParseComments</span><span class="op" id="7717828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7717831">if</span>&nbsp;<span class="ident" id="7717834">err</span>&nbsp;<span class="op" id="7717838">!=</span>&nbsp;<span class="ident" id="7717841">nil</span>&nbsp;<span class="op" id="7717845">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7717849">return</span>&nbsp;<span class="ident" id="7717856">nil</span><span class="op" id="7717859">,</span>&nbsp;<span class="ident" id="7717861">fmt</span><span class="op" id="7717864">.</span><span class="ident" id="7717865">Errorf</span><span class="op" id="7717871">(</span><span class="string" id="7717872">&#34;parse:&nbsp;%s\n%s&#34;</span><span class="op" id="7717887">,</span>&nbsp;<span class="ident" id="7717889">err</span><span class="op" id="7717892">,</span>&nbsp;<span class="ident" id="7717894">src</span><span class="op" id="7717897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7717900">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7717904">//&nbsp;filter&nbsp;exports&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7717936">if</span>&nbsp;<span class="ident" id="7717939">mode</span><span class="op" id="7717943">&amp;</span><span class="ident" id="7717944">export</span>&nbsp;<span class="op" id="7717951">!=</span>&nbsp;<span class="num" id="7717954">0</span>&nbsp;<span class="op" id="7717956">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7717960">ast</span><span class="op" id="7717963">.</span><span class="ident" id="7717964">FileExports</span><span class="op" id="7717975">(</span><span class="ident" id="7717976">f</span><span class="op" id="7717977">)</span>&nbsp;<span class="comment" id="7717979">//&nbsp;ignore&nbsp;result</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7717998">f</span><span class="op" id="7717999">.</span><span class="ident" id="7718000">Comments</span>&nbsp;<span class="op" id="7718009">=</span>&nbsp;<span class="ident" id="7718011">nil</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="7718017">//&nbsp;don&#39;t&nbsp;print&nbsp;comments&nbsp;that&nbsp;are&nbsp;not&nbsp;in&nbsp;AST</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7718062">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7718066">//&nbsp;determine&nbsp;printer&nbsp;configuration</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7718102">cfg</span>&nbsp;<span class="op" id="7718106">:=</span>&nbsp;<span class="ident" id="7718109">Config</span><span class="op" id="7718115">{</span><span class="ident" id="7718116">Tabwidth</span><span class="op" id="7718124">:</span>&nbsp;<span class="ident" id="7718126">tabwidth</span><span class="op" id="7718134">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7718137">if</span>&nbsp;<span class="ident" id="7718140">mode</span><span class="op" id="7718144">&amp;</span><span class="ident" id="7718145">rawFormat</span>&nbsp;<span class="op" id="7718155">!=</span>&nbsp;<span class="num" id="7718158">0</span>&nbsp;<span class="op" id="7718160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7718164">cfg</span><span class="op" id="7718167">.</span><span class="ident" id="7718168">Mode</span>&nbsp;<span class="op" id="7718173">|=</span>&nbsp;<span class="ident" id="7718176">RawFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7718187">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7718191">//&nbsp;print&nbsp;AST</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7718205">var</span>&nbsp;<span class="ident" id="7718209">buf</span>&nbsp;<span class="ident" id="7718213">bytes</span><span class="op" id="7718218">.</span><span class="ident" id="7718219">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7718227">if</span>&nbsp;<span class="ident" id="7718230">err</span>&nbsp;<span class="op" id="7718234">:=</span>&nbsp;<span class="ident" id="7718237">cfg</span><span class="op" id="7718240">.</span><span class="ident" id="7718241">Fprint</span><span class="op" id="7718247">(</span><span class="op" id="7718248">&amp;</span><span class="ident" id="7718249">buf</span><span class="op" id="7718252">,</span>&nbsp;<span class="ident" id="7718254">fset</span><span class="op" id="7718258">,</span>&nbsp;<span class="ident" id="7718260">f</span><span class="op" id="7718261">)</span><span class="op" id="7718262">;</span>&nbsp;<span class="ident" id="7718264">err</span>&nbsp;<span class="op" id="7718268">!=</span>&nbsp;<span class="ident" id="7718271">nil</span>&nbsp;<span class="op" id="7718275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7718279">return</span>&nbsp;<span class="ident" id="7718286">nil</span><span class="op" id="7718289">,</span>&nbsp;<span class="ident" id="7718291">fmt</span><span class="op" id="7718294">.</span><span class="ident" id="7718295">Errorf</span><span class="op" id="7718301">(</span><span class="string" id="7718302">&#34;print:&nbsp;%s&#34;</span><span class="op" id="7718313">,</span>&nbsp;<span class="ident" id="7718315">err</span><span class="op" id="7718318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7718321">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7718325">//&nbsp;make&nbsp;sure&nbsp;formatted&nbsp;output&nbsp;is&nbsp;syntactically&nbsp;correct</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7718381">res</span>&nbsp;<span class="op" id="7718385">:=</span>&nbsp;<span class="ident" id="7718388">buf</span><span class="op" id="7718391">.</span><span class="ident" id="7718392">Bytes</span><span class="op" id="7718397">(</span><span class="op" id="7718398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7718401">if</span>&nbsp;<span class="ident" id="7718404">_</span><span class="op" id="7718405">,</span>&nbsp;<span class="ident" id="7718407">err</span>&nbsp;<span class="op" id="7718411">:=</span>&nbsp;<span class="ident" id="7718414">parser</span><span class="op" id="7718420">.</span><span class="ident" id="7718421">ParseFile</span><span class="op" id="7718430">(</span><span class="ident" id="7718431">fset</span><span class="op" id="7718435">,</span>&nbsp;<span class="string" id="7718437">&#34;&#34;</span><span class="op" id="7718439">,</span>&nbsp;<span class="ident" id="7718441">res</span><span class="op" id="7718444">,</span>&nbsp;<span class="num" id="7718446">0</span><span class="op" id="7718447">)</span><span class="op" id="7718448">;</span>&nbsp;<span class="ident" id="7718450">err</span>&nbsp;<span class="op" id="7718454">!=</span>&nbsp;<span class="ident" id="7718457">nil</span>&nbsp;<span class="op" id="7718461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7718465">return</span>&nbsp;<span class="ident" id="7718472">nil</span><span class="op" id="7718475">,</span>&nbsp;<span class="ident" id="7718477">fmt</span><span class="op" id="7718480">.</span><span class="ident" id="7718481">Errorf</span><span class="op" id="7718487">(</span><span class="string" id="7718488">&#34;re-parse:&nbsp;%s\n%s&#34;</span><span class="op" id="7718506">,</span>&nbsp;<span class="ident" id="7718508">err</span><span class="op" id="7718511">,</span>&nbsp;<span class="ident" id="7718513">buf</span><span class="op" id="7718516">.</span><span class="ident" id="7718517">Bytes</span><span class="op" id="7718522">(</span><span class="op" id="7718523">)</span><span class="op" id="7718524">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7718527">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7718531">return</span>&nbsp;<span class="ident" id="7718538">res</span><span class="op" id="7718541">,</span>&nbsp;<span class="ident" id="7718543">nil</span><br>
<span class="lineno"></span><span class="op" id="7718547">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="comment" id="7718550">//&nbsp;lineAt&nbsp;returns&nbsp;the&nbsp;line&nbsp;in&nbsp;text&nbsp;starting&nbsp;at&nbsp;offset&nbsp;offs.</span><br>
<span class="lineno"></span><span class="keyword" id="7718610">func</span>&nbsp;<span class="ident" id="7718615">lineAt</span><span class="op" id="7718621">(</span><span class="ident" id="7718622">text</span>&nbsp;<span class="op" id="7718627">[</span><span class="op" id="7718628">]</span><span class="builtintype" id="7718629">byte</span><span class="op" id="7718633">,</span>&nbsp;<span class="ident" id="7718635">offs</span>&nbsp;<span class="builtintype" id="7718640">int</span><span class="op" id="7718643">)</span>&nbsp;<span class="op" id="7718645">[</span><span class="op" id="7718646">]</span><span class="builtintype" id="7718647">byte</span>&nbsp;<span class="op" id="7718652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7718655">i</span>&nbsp;<span class="op" id="7718657">:=</span>&nbsp;<span class="ident" id="7718660">offs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7718666">for</span>&nbsp;<span class="ident" id="7718670">i</span>&nbsp;<span class="op" id="7718672">&lt;</span>&nbsp;<span class="builtinfunc" id="7718674">len</span><span class="op" id="7718677">(</span><span class="ident" id="7718678">text</span><span class="op" id="7718682">)</span>&nbsp;<span class="op" id="7718684">&amp;&amp;</span>&nbsp;<span class="ident" id="7718687">text</span><span class="op" id="7718691">[</span><span class="ident" id="7718692">i</span><span class="op" id="7718693">]</span>&nbsp;<span class="op" id="7718695">!=</span>&nbsp;<span class="string" id="7718698">&#39;\n&#39;</span>&nbsp;<span class="op" id="7718703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7718707">i</span><span class="op" id="7718708">++</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7718712">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7718715">return</span>&nbsp;<span class="ident" id="7718722">text</span><span class="op" id="7718726">[</span><span class="ident" id="7718727">offs</span><span class="op" id="7718731">:</span><span class="ident" id="7718732">i</span><span class="op" id="7718733">]</span><br>
<span class="lineno"></span><span class="op" id="7718735">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7718738">//&nbsp;diff&nbsp;compares&nbsp;a&nbsp;and&nbsp;b.</span><br>
<span class="lineno">85</span><span class="keyword" id="7718764">func</span>&nbsp;<span class="ident" id="7718769">diff</span><span class="op" id="7718773">(</span><span class="ident" id="7718774">aname</span><span class="op" id="7718779">,</span>&nbsp;<span class="ident" id="7718781">bname</span>&nbsp;<span class="builtintype" id="7718787">string</span><span class="op" id="7718793">,</span>&nbsp;<span class="ident" id="7718795">a</span><span class="op" id="7718796">,</span>&nbsp;<span class="ident" id="7718798">b</span>&nbsp;<span class="op" id="7718800">[</span><span class="op" id="7718801">]</span><span class="builtintype" id="7718802">byte</span><span class="op" id="7718806">)</span>&nbsp;<span class="builtintype" id="7718808">error</span>&nbsp;<span class="op" id="7718814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7718817">var</span>&nbsp;<span class="ident" id="7718821">buf</span>&nbsp;<span class="ident" id="7718825">bytes</span><span class="op" id="7718830">.</span><span class="ident" id="7718831">Buffer</span>&nbsp;<span class="comment" id="7718838">//&nbsp;holding&nbsp;long&nbsp;error&nbsp;message</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7718870">//&nbsp;compare&nbsp;lengths</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7718890">if</span>&nbsp;<span class="builtinfunc" id="7718893">len</span><span class="op" id="7718896">(</span><span class="ident" id="7718897">a</span><span class="op" id="7718898">)</span>&nbsp;<span class="op" id="7718900">!=</span>&nbsp;<span class="builtinfunc" id="7718903">len</span><span class="op" id="7718906">(</span><span class="ident" id="7718907">b</span><span class="op" id="7718908">)</span>&nbsp;<span class="op" id="7718910">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7718914">fmt</span><span class="op" id="7718917">.</span><span class="ident" id="7718918">Fprintf</span><span class="op" id="7718925">(</span><span class="op" id="7718926">&amp;</span><span class="ident" id="7718927">buf</span><span class="op" id="7718930">,</span>&nbsp;<span class="string" id="7718932">&#34;\nlength&nbsp;changed:&nbsp;len(%s)&nbsp;=&nbsp;%d,&nbsp;len(%s)&nbsp;=&nbsp;%d&#34;</span><span class="op" id="7718978">,</span>&nbsp;<span class="ident" id="7718980">aname</span><span class="op" id="7718985">,</span>&nbsp;<span class="builtinfunc" id="7718987">len</span><span class="op" id="7718990">(</span><span class="ident" id="7718991">a</span><span class="op" id="7718992">)</span><span class="op" id="7718993">,</span>&nbsp;<span class="ident" id="7718995">bname</span><span class="op" id="7719000">,</span>&nbsp;<span class="builtinfunc" id="7719002">len</span><span class="op" id="7719005">(</span><span class="ident" id="7719006">b</span><span class="op" id="7719007">)</span><span class="op" id="7719008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7719011">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7719015">//&nbsp;compare&nbsp;contents</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7719036">line</span>&nbsp;<span class="op" id="7719041">:=</span>&nbsp;<span class="num" id="7719044">1</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7719047">offs</span>&nbsp;<span class="op" id="7719052">:=</span>&nbsp;<span class="num" id="7719055">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7719058">for</span>&nbsp;<span class="ident" id="7719062">i</span>&nbsp;<span class="op" id="7719064">:=</span>&nbsp;<span class="num" id="7719067">0</span><span class="op" id="7719068">;</span>&nbsp;<span class="ident" id="7719070">i</span>&nbsp;<span class="op" id="7719072">&lt;</span>&nbsp;<span class="builtinfunc" id="7719074">len</span><span class="op" id="7719077">(</span><span class="ident" id="7719078">a</span><span class="op" id="7719079">)</span>&nbsp;<span class="op" id="7719081">&amp;&amp;</span>&nbsp;<span class="ident" id="7719084">i</span>&nbsp;<span class="op" id="7719086">&lt;</span>&nbsp;<span class="builtinfunc" id="7719088">len</span><span class="op" id="7719091">(</span><span class="ident" id="7719092">b</span><span class="op" id="7719093">)</span><span class="op" id="7719094">;</span>&nbsp;<span class="ident" id="7719096">i</span><span class="op" id="7719097">++</span>&nbsp;<span class="op" id="7719100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7719104">ch</span>&nbsp;<span class="op" id="7719107">:=</span>&nbsp;<span class="ident" id="7719110">a</span><span class="op" id="7719111">[</span><span class="ident" id="7719112">i</span><span class="op" id="7719113">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7719117">if</span>&nbsp;<span class="ident" id="7719120">ch</span>&nbsp;<span class="op" id="7719123">!=</span>&nbsp;<span class="ident" id="7719126">b</span><span class="op" id="7719127">[</span><span class="ident" id="7719128">i</span><span class="op" id="7719129">]</span>&nbsp;<span class="op" id="7719131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7719136">fmt</span><span class="op" id="7719139">.</span><span class="ident" id="7719140">Fprintf</span><span class="op" id="7719147">(</span><span class="op" id="7719148">&amp;</span><span class="ident" id="7719149">buf</span><span class="op" id="7719152">,</span>&nbsp;<span class="string" id="7719154">&#34;\n%s:%d:%d:&nbsp;%s&#34;</span><span class="op" id="7719170">,</span>&nbsp;<span class="ident" id="7719172">aname</span><span class="op" id="7719177">,</span>&nbsp;<span class="ident" id="7719179">line</span><span class="op" id="7719183">,</span>&nbsp;<span class="ident" id="7719185">i</span><span class="op" id="7719186">-</span><span class="ident" id="7719187">offs</span><span class="op" id="7719191">+</span><span class="num" id="7719192">1</span><span class="op" id="7719193">,</span>&nbsp;<span class="ident" id="7719195">lineAt</span><span class="op" id="7719201">(</span><span class="ident" id="7719202">a</span><span class="op" id="7719203">,</span>&nbsp;<span class="ident" id="7719205">offs</span><span class="op" id="7719209">)</span><span class="op" id="7719210">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7719215">fmt</span><span class="op" id="7719218">.</span><span class="ident" id="7719219">Fprintf</span><span class="op" id="7719226">(</span><span class="op" id="7719227">&amp;</span><span class="ident" id="7719228">buf</span><span class="op" id="7719231">,</span>&nbsp;<span class="string" id="7719233">&#34;\n%s:%d:%d:&nbsp;%s&#34;</span><span class="op" id="7719249">,</span>&nbsp;<span class="ident" id="7719251">bname</span><span class="op" id="7719256">,</span>&nbsp;<span class="ident" id="7719258">line</span><span class="op" id="7719262">,</span>&nbsp;<span class="ident" id="7719264">i</span><span class="op" id="7719265">-</span><span class="ident" id="7719266">offs</span><span class="op" id="7719270">+</span><span class="num" id="7719271">1</span><span class="op" id="7719272">,</span>&nbsp;<span class="ident" id="7719274">lineAt</span><span class="op" id="7719280">(</span><span class="ident" id="7719281">b</span><span class="op" id="7719282">,</span>&nbsp;<span class="ident" id="7719284">offs</span><span class="op" id="7719288">)</span><span class="op" id="7719289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7719294">fmt</span><span class="op" id="7719297">.</span><span class="ident" id="7719298">Fprintf</span><span class="op" id="7719305">(</span><span class="op" id="7719306">&amp;</span><span class="ident" id="7719307">buf</span><span class="op" id="7719310">,</span>&nbsp;<span class="string" id="7719312">&#34;\n\n&#34;</span><span class="op" id="7719318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7719323">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7719331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7719335">if</span>&nbsp;<span class="ident" id="7719338">ch</span>&nbsp;<span class="op" id="7719341">==</span>&nbsp;<span class="string" id="7719344">&#39;\n&#39;</span>&nbsp;<span class="op" id="7719349">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7719354">line</span><span class="op" id="7719358">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7719364">offs</span>&nbsp;<span class="op" id="7719369">=</span>&nbsp;<span class="ident" id="7719371">i</span>&nbsp;<span class="op" id="7719373">+</span>&nbsp;<span class="num" id="7719375">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7719379">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7719382">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7719386">if</span>&nbsp;<span class="ident" id="7719389">buf</span><span class="op" id="7719392">.</span><span class="ident" id="7719393">Len</span><span class="op" id="7719396">(</span><span class="op" id="7719397">)</span>&nbsp;<span class="op" id="7719399">&gt;</span>&nbsp;<span class="num" id="7719401">0</span>&nbsp;<span class="op" id="7719403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7719407">return</span>&nbsp;<span class="ident" id="7719414">errors</span><span class="op" id="7719420">.</span><span class="ident" id="7719421">New</span><span class="op" id="7719424">(</span><span class="ident" id="7719425">buf</span><span class="op" id="7719428">.</span><span class="ident" id="7719429">String</span><span class="op" id="7719435">(</span><span class="op" id="7719436">)</span><span class="op" id="7719437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7719440">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7719443">return</span>&nbsp;<span class="ident" id="7719450">nil</span><br>
<span class="lineno"></span><span class="op" id="7719454">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="keyword" id="7719457">func</span>&nbsp;<span class="ident" id="7719462">runcheck</span><span class="op" id="7719470">(</span><span class="ident" id="7719471">t</span>&nbsp;<span class="op" id="7719473">*</span><span class="ident" id="7719474">testing</span><span class="op" id="7719481">.</span><span class="ident" id="7719482">T</span><span class="op" id="7719483">,</span>&nbsp;<span class="ident" id="7719485">source</span><span class="op" id="7719491">,</span>&nbsp;<span class="ident" id="7719493">golden</span>&nbsp;<span class="builtintype" id="7719500">string</span><span class="op" id="7719506">,</span>&nbsp;<span class="ident" id="7719508">mode</span>&nbsp;<span class="ident" id="7719513">checkMode</span><span class="op" id="7719522">)</span>&nbsp;<span class="op" id="7719524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7719527">src</span><span class="op" id="7719530">,</span>&nbsp;<span class="ident" id="7719532">err</span>&nbsp;<span class="op" id="7719536">:=</span>&nbsp;<span class="ident" id="7719539">ioutil</span><span class="op" id="7719545">.</span><span class="ident" id="7719546">ReadFile</span><span class="op" id="7719554">(</span><span class="ident" id="7719555">source</span><span class="op" id="7719561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7719564">if</span>&nbsp;<span class="ident" id="7719567">err</span>&nbsp;<span class="op" id="7719571">!=</span>&nbsp;<span class="ident" id="7719574">nil</span>&nbsp;<span class="op" id="7719578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7719582">t</span><span class="op" id="7719583">.</span><span class="ident" id="7719584">Error</span><span class="op" id="7719589">(</span><span class="ident" id="7719590">err</span><span class="op" id="7719593">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7719597">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7719605">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7719609">res</span><span class="op" id="7719612">,</span>&nbsp;<span class="ident" id="7719614">err</span>&nbsp;<span class="op" id="7719618">:=</span>&nbsp;<span class="ident" id="7719621">format</span><span class="op" id="7719627">(</span><span class="ident" id="7719628">src</span><span class="op" id="7719631">,</span>&nbsp;<span class="ident" id="7719633">mode</span><span class="op" id="7719637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7719640">if</span>&nbsp;<span class="ident" id="7719643">err</span>&nbsp;<span class="op" id="7719647">!=</span>&nbsp;<span class="ident" id="7719650">nil</span>&nbsp;<span class="op" id="7719654">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7719658">t</span><span class="op" id="7719659">.</span><span class="ident" id="7719660">Error</span><span class="op" id="7719665">(</span><span class="ident" id="7719666">err</span><span class="op" id="7719669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7719673">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7719681">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7719685">//&nbsp;update&nbsp;golden&nbsp;files&nbsp;if&nbsp;necessary</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7719722">if</span>&nbsp;<span class="op" id="7719725">*</span><span class="ident" id="7719726">update</span>&nbsp;<span class="op" id="7719733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7719737">if</span>&nbsp;<span class="ident" id="7719740">err</span>&nbsp;<span class="op" id="7719744">:=</span>&nbsp;<span class="ident" id="7719747">ioutil</span><span class="op" id="7719753">.</span><span class="ident" id="7719754">WriteFile</span><span class="op" id="7719763">(</span><span class="ident" id="7719764">golden</span><span class="op" id="7719770">,</span>&nbsp;<span class="ident" id="7719772">res</span><span class="op" id="7719775">,</span>&nbsp;<span class="num" id="7719777">0644</span><span class="op" id="7719781">)</span><span class="op" id="7719782">;</span>&nbsp;<span class="ident" id="7719784">err</span>&nbsp;<span class="op" id="7719788">!=</span>&nbsp;<span class="ident" id="7719791">nil</span>&nbsp;<span class="op" id="7719795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7719800">t</span><span class="op" id="7719801">.</span><span class="ident" id="7719802">Error</span><span class="op" id="7719807">(</span><span class="ident" id="7719808">err</span><span class="op" id="7719811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7719815">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7719819">return</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7719827">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7719831">//&nbsp;get&nbsp;golden</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7719846">gld</span><span class="op" id="7719849">,</span>&nbsp;<span class="ident" id="7719851">err</span>&nbsp;<span class="op" id="7719855">:=</span>&nbsp;<span class="ident" id="7719858">ioutil</span><span class="op" id="7719864">.</span><span class="ident" id="7719865">ReadFile</span><span class="op" id="7719873">(</span><span class="ident" id="7719874">golden</span><span class="op" id="7719880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7719883">if</span>&nbsp;<span class="ident" id="7719886">err</span>&nbsp;<span class="op" id="7719890">!=</span>&nbsp;<span class="ident" id="7719893">nil</span>&nbsp;<span class="op" id="7719897">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7719901">t</span><span class="op" id="7719902">.</span><span class="ident" id="7719903">Error</span><span class="op" id="7719908">(</span><span class="ident" id="7719909">err</span><span class="op" id="7719912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7719916">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7719924">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7719928">//&nbsp;formatted&nbsp;source&nbsp;and&nbsp;golden&nbsp;must&nbsp;be&nbsp;the&nbsp;same</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7719977">if</span>&nbsp;<span class="ident" id="7719980">err</span>&nbsp;<span class="op" id="7719984">:=</span>&nbsp;<span class="ident" id="7719987">diff</span><span class="op" id="7719991">(</span><span class="ident" id="7719992">source</span><span class="op" id="7719998">,</span>&nbsp;<span class="ident" id="7720000">golden</span><span class="op" id="7720006">,</span>&nbsp;<span class="ident" id="7720008">res</span><span class="op" id="7720011">,</span>&nbsp;<span class="ident" id="7720013">gld</span><span class="op" id="7720016">)</span><span class="op" id="7720017">;</span>&nbsp;<span class="ident" id="7720019">err</span>&nbsp;<span class="op" id="7720023">!=</span>&nbsp;<span class="ident" id="7720026">nil</span>&nbsp;<span class="op" id="7720030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7720034">t</span><span class="op" id="7720035">.</span><span class="ident" id="7720036">Error</span><span class="op" id="7720041">(</span><span class="ident" id="7720042">err</span><span class="op" id="7720045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7720049">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7720057">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7720061">if</span>&nbsp;<span class="ident" id="7720064">mode</span><span class="op" id="7720068">&amp;</span><span class="ident" id="7720069">idempotent</span>&nbsp;<span class="op" id="7720080">!=</span>&nbsp;<span class="num" id="7720083">0</span>&nbsp;<span class="op" id="7720085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7720089">//&nbsp;formatting&nbsp;golden&nbsp;must&nbsp;be&nbsp;idempotent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7720131">//&nbsp;(This&nbsp;is&nbsp;very&nbsp;difficult&nbsp;to&nbsp;achieve&nbsp;in&nbsp;general&nbsp;and&nbsp;for&nbsp;now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7720194">//&nbsp;it&nbsp;is&nbsp;only&nbsp;checked&nbsp;for&nbsp;files&nbsp;explicitly&nbsp;marked&nbsp;as&nbsp;such.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7720256">res</span><span class="op" id="7720259">,</span>&nbsp;<span class="ident" id="7720261">err</span>&nbsp;<span class="op" id="7720265">=</span>&nbsp;<span class="ident" id="7720267">format</span><span class="op" id="7720273">(</span><span class="ident" id="7720274">gld</span><span class="op" id="7720277">,</span>&nbsp;<span class="ident" id="7720279">mode</span><span class="op" id="7720283">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7720287">if</span>&nbsp;<span class="ident" id="7720290">err</span>&nbsp;<span class="op" id="7720294">:=</span>&nbsp;<span class="ident" id="7720297">diff</span><span class="op" id="7720301">(</span><span class="ident" id="7720302">golden</span><span class="op" id="7720308">,</span>&nbsp;<span class="ident" id="7720310">fmt</span><span class="op" id="7720313">.</span><span class="ident" id="7720314">Sprintf</span><span class="op" id="7720321">(</span><span class="string" id="7720322">&#34;format(%s)&#34;</span><span class="op" id="7720334">,</span>&nbsp;<span class="ident" id="7720336">golden</span><span class="op" id="7720342">)</span><span class="op" id="7720343">,</span>&nbsp;<span class="ident" id="7720345">gld</span><span class="op" id="7720348">,</span>&nbsp;<span class="ident" id="7720350">res</span><span class="op" id="7720353">)</span><span class="op" id="7720354">;</span>&nbsp;<span class="ident" id="7720356">err</span>&nbsp;<span class="op" id="7720360">!=</span>&nbsp;<span class="ident" id="7720363">nil</span>&nbsp;<span class="op" id="7720367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7720372">t</span><span class="op" id="7720373">.</span><span class="ident" id="7720374">Errorf</span><span class="op" id="7720380">(</span><span class="string" id="7720381">&#34;golden&nbsp;is&nbsp;not&nbsp;idempotent:&nbsp;%s&#34;</span><span class="op" id="7720411">,</span>&nbsp;<span class="ident" id="7720413">err</span><span class="op" id="7720416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7720420">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7720423">}</span><br>
<span class="lineno"></span><span class="op" id="7720425">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span><span class="keyword" id="7720428">func</span>&nbsp;<span class="ident" id="7720433">check</span><span class="op" id="7720438">(</span><span class="ident" id="7720439">t</span>&nbsp;<span class="op" id="7720441">*</span><span class="ident" id="7720442">testing</span><span class="op" id="7720449">.</span><span class="ident" id="7720450">T</span><span class="op" id="7720451">,</span>&nbsp;<span class="ident" id="7720453">source</span><span class="op" id="7720459">,</span>&nbsp;<span class="ident" id="7720461">golden</span>&nbsp;<span class="builtintype" id="7720468">string</span><span class="op" id="7720474">,</span>&nbsp;<span class="ident" id="7720476">mode</span>&nbsp;<span class="ident" id="7720481">checkMode</span><span class="op" id="7720490">)</span>&nbsp;<span class="op" id="7720492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7720495">//&nbsp;run&nbsp;the&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7720512">cc</span>&nbsp;<span class="op" id="7720515">:=</span>&nbsp;<span class="builtinfunc" id="7720518">make</span><span class="op" id="7720522">(</span><span class="keyword" id="7720523">chan</span>&nbsp;<span class="builtintype" id="7720528">int</span><span class="op" id="7720531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7720534">go</span>&nbsp;<span class="keyword" id="7720537">func</span><span class="op" id="7720541">(</span><span class="op" id="7720542">)</span>&nbsp;<span class="op" id="7720544">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7720548">runcheck</span><span class="op" id="7720556">(</span><span class="ident" id="7720557">t</span><span class="op" id="7720558">,</span>&nbsp;<span class="ident" id="7720560">source</span><span class="op" id="7720566">,</span>&nbsp;<span class="ident" id="7720568">golden</span><span class="op" id="7720574">,</span>&nbsp;<span class="ident" id="7720576">mode</span><span class="op" id="7720580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7720584">cc</span>&nbsp;<span class="op" id="7720587">&lt;-</span>&nbsp;<span class="num" id="7720590">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7720593">}</span><span class="op" id="7720594">(</span><span class="op" id="7720595">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7720599">//&nbsp;wait&nbsp;with&nbsp;timeout</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7720621">select</span>&nbsp;<span class="op" id="7720628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7720631">case</span>&nbsp;<span class="op" id="7720636">&lt;-</span><span class="ident" id="7720638">time</span><span class="op" id="7720642">.</span><span class="ident" id="7720643">After</span><span class="op" id="7720648">(</span><span class="num" id="7720649">10</span>&nbsp;<span class="op" id="7720652">*</span>&nbsp;<span class="ident" id="7720654">time</span><span class="op" id="7720658">.</span><span class="ident" id="7720659">Second</span><span class="op" id="7720665">)</span><span class="op" id="7720666">:</span>&nbsp;<span class="comment" id="7720668">//&nbsp;plenty&nbsp;of&nbsp;a&nbsp;safety&nbsp;margin,&nbsp;even&nbsp;for&nbsp;very&nbsp;slow&nbsp;machines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7720728">//&nbsp;test&nbsp;running&nbsp;past&nbsp;time&nbsp;out</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7720760">t</span><span class="op" id="7720761">.</span><span class="ident" id="7720762">Errorf</span><span class="op" id="7720768">(</span><span class="string" id="7720769">&#34;%s:&nbsp;running&nbsp;too&nbsp;slowly&#34;</span><span class="op" id="7720793">,</span>&nbsp;<span class="ident" id="7720795">source</span><span class="op" id="7720801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7720804">case</span>&nbsp;<span class="op" id="7720809">&lt;-</span><span class="ident" id="7720811">cc</span><span class="op" id="7720813">:</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7720817">//&nbsp;test&nbsp;finished&nbsp;within&nbsp;allotted&nbsp;time&nbsp;margin</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7720863">}</span><br>
<span class="lineno"></span><span class="op" id="7720865">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7720868">type</span>&nbsp;<span class="ident" id="7720873">entry</span>&nbsp;<span class="keyword" id="7720879">struct</span>&nbsp;<span class="op" id="7720886">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7720889">source</span><span class="op" id="7720895">,</span>&nbsp;<span class="ident" id="7720897">golden</span>&nbsp;<span class="builtintype" id="7720904">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7720912">mode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7720927">checkMode</span><br>
<span class="lineno"></span><span class="op" id="7720937">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7720940">//&nbsp;Use&nbsp;go&nbsp;test&nbsp;-update&nbsp;to&nbsp;create/update&nbsp;the&nbsp;respective&nbsp;golden&nbsp;files.</span><br>
<span class="lineno">185</span><span class="keyword" id="7721009">var</span>&nbsp;<span class="ident" id="7721013">data</span>&nbsp;<span class="op" id="7721018">=</span>&nbsp;<span class="op" id="7721020">[</span><span class="op" id="7721021">]</span><span class="ident" id="7721022">entry</span><span class="op" id="7721027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7721030">{</span><span class="string" id="7721031">&#34;empty.input&#34;</span><span class="op" id="7721044">,</span>&nbsp;<span class="string" id="7721046">&#34;empty.golden&#34;</span><span class="op" id="7721060">,</span>&nbsp;<span class="ident" id="7721062">idempotent</span><span class="op" id="7721072">}</span><span class="op" id="7721073">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7721076">{</span><span class="string" id="7721077">&#34;comments.input&#34;</span><span class="op" id="7721093">,</span>&nbsp;<span class="string" id="7721095">&#34;comments.golden&#34;</span><span class="op" id="7721112">,</span>&nbsp;<span class="num" id="7721114">0</span><span class="op" id="7721115">}</span><span class="op" id="7721116">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7721119">{</span><span class="string" id="7721120">&#34;comments.input&#34;</span><span class="op" id="7721136">,</span>&nbsp;<span class="string" id="7721138">&#34;comments.x&#34;</span><span class="op" id="7721150">,</span>&nbsp;<span class="ident" id="7721152">export</span><span class="op" id="7721158">}</span><span class="op" id="7721159">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7721162">{</span><span class="string" id="7721163">&#34;comments2.input&#34;</span><span class="op" id="7721180">,</span>&nbsp;<span class="string" id="7721182">&#34;comments2.golden&#34;</span><span class="op" id="7721200">,</span>&nbsp;<span class="ident" id="7721202">idempotent</span><span class="op" id="7721212">}</span><span class="op" id="7721213">,</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7721216">{</span><span class="string" id="7721217">&#34;linebreaks.input&#34;</span><span class="op" id="7721235">,</span>&nbsp;<span class="string" id="7721237">&#34;linebreaks.golden&#34;</span><span class="op" id="7721256">,</span>&nbsp;<span class="ident" id="7721258">idempotent</span><span class="op" id="7721268">}</span><span class="op" id="7721269">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7721272">{</span><span class="string" id="7721273">&#34;expressions.input&#34;</span><span class="op" id="7721292">,</span>&nbsp;<span class="string" id="7721294">&#34;expressions.golden&#34;</span><span class="op" id="7721314">,</span>&nbsp;<span class="ident" id="7721316">idempotent</span><span class="op" id="7721326">}</span><span class="op" id="7721327">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7721330">{</span><span class="string" id="7721331">&#34;expressions.input&#34;</span><span class="op" id="7721350">,</span>&nbsp;<span class="string" id="7721352">&#34;expressions.raw&#34;</span><span class="op" id="7721369">,</span>&nbsp;<span class="ident" id="7721371">rawFormat</span>&nbsp;<span class="op" id="7721381">|</span>&nbsp;<span class="ident" id="7721383">idempotent</span><span class="op" id="7721393">}</span><span class="op" id="7721394">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7721397">{</span><span class="string" id="7721398">&#34;declarations.input&#34;</span><span class="op" id="7721418">,</span>&nbsp;<span class="string" id="7721420">&#34;declarations.golden&#34;</span><span class="op" id="7721441">,</span>&nbsp;<span class="num" id="7721443">0</span><span class="op" id="7721444">}</span><span class="op" id="7721445">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7721448">{</span><span class="string" id="7721449">&#34;statements.input&#34;</span><span class="op" id="7721467">,</span>&nbsp;<span class="string" id="7721469">&#34;statements.golden&#34;</span><span class="op" id="7721488">,</span>&nbsp;<span class="num" id="7721490">0</span><span class="op" id="7721491">}</span><span class="op" id="7721492">,</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7721495">{</span><span class="string" id="7721496">&#34;slow.input&#34;</span><span class="op" id="7721508">,</span>&nbsp;<span class="string" id="7721510">&#34;slow.golden&#34;</span><span class="op" id="7721523">,</span>&nbsp;<span class="ident" id="7721525">idempotent</span><span class="op" id="7721535">}</span><span class="op" id="7721536">,</span><br>
<span class="lineno"></span><span class="op" id="7721538">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7721541">func</span>&nbsp;<span class="ident" id="7721546">TestFiles</span><span class="op" id="7721555">(</span><span class="ident" id="7721556">t</span>&nbsp;<span class="op" id="7721558">*</span><span class="ident" id="7721559">testing</span><span class="op" id="7721566">.</span><span class="ident" id="7721567">T</span><span class="op" id="7721568">)</span>&nbsp;<span class="op" id="7721570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7721573">for</span>&nbsp;<span class="ident" id="7721577">_</span><span class="op" id="7721578">,</span>&nbsp;<span class="ident" id="7721580">e</span>&nbsp;<span class="op" id="7721582">:=</span>&nbsp;<span class="keyword" id="7721585">range</span>&nbsp;<span class="ident" id="7721591">data</span>&nbsp;<span class="op" id="7721596">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7721600">source</span>&nbsp;<span class="op" id="7721607">:=</span>&nbsp;<span class="ident" id="7721610">filepath</span><span class="op" id="7721618">.</span><span class="ident" id="7721619">Join</span><span class="op" id="7721623">(</span><span class="ident" id="7721624">dataDir</span><span class="op" id="7721631">,</span>&nbsp;<span class="ident" id="7721633">e</span><span class="op" id="7721634">.</span><span class="ident" id="7721635">source</span><span class="op" id="7721641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7721645">golden</span>&nbsp;<span class="op" id="7721652">:=</span>&nbsp;<span class="ident" id="7721655">filepath</span><span class="op" id="7721663">.</span><span class="ident" id="7721664">Join</span><span class="op" id="7721668">(</span><span class="ident" id="7721669">dataDir</span><span class="op" id="7721676">,</span>&nbsp;<span class="ident" id="7721678">e</span><span class="op" id="7721679">.</span><span class="ident" id="7721680">golden</span><span class="op" id="7721686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7721690">check</span><span class="op" id="7721695">(</span><span class="ident" id="7721696">t</span><span class="op" id="7721697">,</span>&nbsp;<span class="ident" id="7721699">source</span><span class="op" id="7721705">,</span>&nbsp;<span class="ident" id="7721707">golden</span><span class="op" id="7721713">,</span>&nbsp;<span class="ident" id="7721715">e</span><span class="op" id="7721716">.</span><span class="ident" id="7721717">mode</span><span class="op" id="7721721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7721725">//&nbsp;TODO(gri)&nbsp;check&nbsp;that&nbsp;golden&nbsp;is&nbsp;idempotent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7721772">//check(t,&nbsp;golden,&nbsp;golden,&nbsp;e.mode)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7721808">}</span><br>
<span class="lineno"></span><span class="op" id="7721810">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7721813">//&nbsp;TestLineComments,&nbsp;using&nbsp;a&nbsp;simple&nbsp;test&nbsp;case,&nbsp;checks&nbsp;that&nbsp;consecutive&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="7721889">//&nbsp;comments&nbsp;are&nbsp;properly&nbsp;terminated&nbsp;with&nbsp;a&nbsp;newline&nbsp;even&nbsp;if&nbsp;the&nbsp;AST&nbsp;position</span><br>
<span class="lineno">210</span><span class="comment" id="7721965">//&nbsp;information&nbsp;is&nbsp;incorrect.</span><br>
<span class="lineno"></span><span class="comment" id="7721994">//</span><br>
<span class="lineno"></span><span class="keyword" id="7721997">func</span>&nbsp;<span class="ident" id="7722002">TestLineComments</span><span class="op" id="7722018">(</span><span class="ident" id="7722019">t</span>&nbsp;<span class="op" id="7722021">*</span><span class="ident" id="7722022">testing</span><span class="op" id="7722029">.</span><span class="ident" id="7722030">T</span><span class="op" id="7722031">)</span>&nbsp;<span class="op" id="7722033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7722036">const</span>&nbsp;<span class="ident" id="7722042">src</span>&nbsp;<span class="op" id="7722046">=</span>&nbsp;<span class="string" id="7722048">`//&nbsp;comment&nbsp;1<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;comment&nbsp;2<br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;comment&nbsp;3<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsppackage&nbsp;main<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7722109">fset</span>&nbsp;<span class="op" id="7722114">:=</span>&nbsp;<span class="ident" id="7722117">token</span><span class="op" id="7722122">.</span><span class="ident" id="7722123">NewFileSet</span><span class="op" id="7722133">(</span><span class="op" id="7722134">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7722137">f</span><span class="op" id="7722138">,</span>&nbsp;<span class="ident" id="7722140">err</span>&nbsp;<span class="op" id="7722144">:=</span>&nbsp;<span class="ident" id="7722147">parser</span><span class="op" id="7722153">.</span><span class="ident" id="7722154">ParseFile</span><span class="op" id="7722163">(</span><span class="ident" id="7722164">fset</span><span class="op" id="7722168">,</span>&nbsp;<span class="string" id="7722170">&#34;&#34;</span><span class="op" id="7722172">,</span>&nbsp;<span class="ident" id="7722174">src</span><span class="op" id="7722177">,</span>&nbsp;<span class="ident" id="7722179">parser</span><span class="op" id="7722185">.</span><span class="ident" id="7722186">ParseComments</span><span class="op" id="7722199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7722202">if</span>&nbsp;<span class="ident" id="7722205">err</span>&nbsp;<span class="op" id="7722209">!=</span>&nbsp;<span class="ident" id="7722212">nil</span>&nbsp;<span class="op" id="7722216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7722220">panic</span><span class="op" id="7722225">(</span><span class="ident" id="7722226">err</span><span class="op" id="7722229">)</span>&nbsp;<span class="comment" id="7722231">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7722249">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7722253">var</span>&nbsp;<span class="ident" id="7722257">buf</span>&nbsp;<span class="ident" id="7722261">bytes</span><span class="op" id="7722266">.</span><span class="ident" id="7722267">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7722275">fset</span>&nbsp;<span class="op" id="7722280">=</span>&nbsp;<span class="ident" id="7722282">token</span><span class="op" id="7722287">.</span><span class="ident" id="7722288">NewFileSet</span><span class="op" id="7722298">(</span><span class="op" id="7722299">)</span>&nbsp;<span class="comment" id="7722301">//&nbsp;use&nbsp;the&nbsp;wrong&nbsp;file&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7722328">Fprint</span><span class="op" id="7722334">(</span><span class="op" id="7722335">&amp;</span><span class="ident" id="7722336">buf</span><span class="op" id="7722339">,</span>&nbsp;<span class="ident" id="7722341">fset</span><span class="op" id="7722345">,</span>&nbsp;<span class="ident" id="7722347">f</span><span class="op" id="7722348">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7722352">nlines</span>&nbsp;<span class="op" id="7722359">:=</span>&nbsp;<span class="num" id="7722362">0</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7722365">for</span>&nbsp;<span class="ident" id="7722369">_</span><span class="op" id="7722370">,</span>&nbsp;<span class="ident" id="7722372">ch</span>&nbsp;<span class="op" id="7722375">:=</span>&nbsp;<span class="keyword" id="7722378">range</span>&nbsp;<span class="ident" id="7722384">buf</span><span class="op" id="7722387">.</span><span class="ident" id="7722388">Bytes</span><span class="op" id="7722393">(</span><span class="op" id="7722394">)</span>&nbsp;<span class="op" id="7722396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7722400">if</span>&nbsp;<span class="ident" id="7722403">ch</span>&nbsp;<span class="op" id="7722406">==</span>&nbsp;<span class="string" id="7722409">&#39;\n&#39;</span>&nbsp;<span class="op" id="7722414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7722419">nlines</span><span class="op" id="7722425">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7722430">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7722433">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7722437">const</span>&nbsp;<span class="ident" id="7722443">expected</span>&nbsp;<span class="op" id="7722452">=</span>&nbsp;<span class="num" id="7722454">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7722457">if</span>&nbsp;<span class="ident" id="7722460">nlines</span>&nbsp;<span class="op" id="7722467">&lt;</span>&nbsp;<span class="ident" id="7722469">expected</span>&nbsp;<span class="op" id="7722478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7722482">t</span><span class="op" id="7722483">.</span><span class="ident" id="7722484">Errorf</span><span class="op" id="7722490">(</span><span class="string" id="7722491">&#34;got&nbsp;%d,&nbsp;expected&nbsp;%d\n&#34;</span><span class="op" id="7722514">,</span>&nbsp;<span class="ident" id="7722516">nlines</span><span class="op" id="7722522">,</span>&nbsp;<span class="ident" id="7722524">expected</span><span class="op" id="7722532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7722536">t</span><span class="op" id="7722537">.</span><span class="ident" id="7722538">Errorf</span><span class="op" id="7722544">(</span><span class="string" id="7722545">&#34;result:\n%s&#34;</span><span class="op" id="7722558">,</span>&nbsp;<span class="ident" id="7722560">buf</span><span class="op" id="7722563">.</span><span class="ident" id="7722564">Bytes</span><span class="op" id="7722569">(</span><span class="op" id="7722570">)</span><span class="op" id="7722571">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7722574">}</span><br>
<span class="lineno"></span><span class="op" id="7722576">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7722579">//&nbsp;Verify&nbsp;that&nbsp;the&nbsp;printer&nbsp;can&nbsp;be&nbsp;invoked&nbsp;during&nbsp;initialization.</span><br>
<span class="lineno"></span><span class="keyword" id="7722644">func</span>&nbsp;<span class="ident" id="7722649">init</span><span class="op" id="7722653">(</span><span class="op" id="7722654">)</span>&nbsp;<span class="op" id="7722656">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7722659">const</span>&nbsp;<span class="ident" id="7722665">name</span>&nbsp;<span class="op" id="7722670">=</span>&nbsp;<span class="string" id="7722672">&#34;foobar&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7722682">var</span>&nbsp;<span class="ident" id="7722686">buf</span>&nbsp;<span class="ident" id="7722690">bytes</span><span class="op" id="7722695">.</span><span class="ident" id="7722696">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7722704">if</span>&nbsp;<span class="ident" id="7722707">err</span>&nbsp;<span class="op" id="7722711">:=</span>&nbsp;<span class="ident" id="7722714">Fprint</span><span class="op" id="7722720">(</span><span class="op" id="7722721">&amp;</span><span class="ident" id="7722722">buf</span><span class="op" id="7722725">,</span>&nbsp;<span class="ident" id="7722727">fset</span><span class="op" id="7722731">,</span>&nbsp;<span class="op" id="7722733">&amp;</span><span class="ident" id="7722734">ast</span><span class="op" id="7722737">.</span><span class="ident" id="7722738">Ident</span><span class="op" id="7722743">{</span><span class="ident" id="7722744">Name</span><span class="op" id="7722748">:</span>&nbsp;<span class="ident" id="7722750">name</span><span class="op" id="7722754">}</span><span class="op" id="7722755">)</span><span class="op" id="7722756">;</span>&nbsp;<span class="ident" id="7722758">err</span>&nbsp;<span class="op" id="7722762">!=</span>&nbsp;<span class="ident" id="7722765">nil</span>&nbsp;<span class="op" id="7722769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7722773">panic</span><span class="op" id="7722778">(</span><span class="ident" id="7722779">err</span><span class="op" id="7722782">)</span>&nbsp;<span class="comment" id="7722784">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7722802">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7722805">//&nbsp;in&nbsp;debug&nbsp;mode,&nbsp;the&nbsp;result&nbsp;contains&nbsp;additional&nbsp;information;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7722868">//&nbsp;ignore&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7722882">if</span>&nbsp;<span class="ident" id="7722885">s</span>&nbsp;<span class="op" id="7722887">:=</span>&nbsp;<span class="ident" id="7722890">buf</span><span class="op" id="7722893">.</span><span class="ident" id="7722894">String</span><span class="op" id="7722900">(</span><span class="op" id="7722901">)</span><span class="op" id="7722902">;</span>&nbsp;<span class="op" id="7722904">!</span><span class="ident" id="7722905">debug</span>&nbsp;<span class="op" id="7722911">&amp;&amp;</span>&nbsp;<span class="ident" id="7722914">s</span>&nbsp;<span class="op" id="7722916">!=</span>&nbsp;<span class="ident" id="7722919">name</span>&nbsp;<span class="op" id="7722924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7722928">panic</span><span class="op" id="7722933">(</span><span class="string" id="7722934">&#34;got&nbsp;&#34;</span>&nbsp;<span class="op" id="7722941">+</span>&nbsp;<span class="ident" id="7722943">s</span>&nbsp;<span class="op" id="7722945">+</span>&nbsp;<span class="string" id="7722947">&#34;,&nbsp;want&nbsp;&#34;</span>&nbsp;<span class="op" id="7722957">+</span>&nbsp;<span class="ident" id="7722959">name</span><span class="op" id="7722963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7722966">}</span><br>
<span class="lineno">255</span><span class="op" id="7722968">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7722971">//&nbsp;Verify&nbsp;that&nbsp;the&nbsp;printer&nbsp;doesn&#39;t&nbsp;crash&nbsp;if&nbsp;the&nbsp;AST&nbsp;contains&nbsp;BadXXX&nbsp;nodes.</span><br>
<span class="lineno"></span><span class="keyword" id="7723046">func</span>&nbsp;<span class="ident" id="7723051">TestBadNodes</span><span class="op" id="7723063">(</span><span class="ident" id="7723064">t</span>&nbsp;<span class="op" id="7723066">*</span><span class="ident" id="7723067">testing</span><span class="op" id="7723074">.</span><span class="ident" id="7723075">T</span><span class="op" id="7723076">)</span>&nbsp;<span class="op" id="7723078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7723081">const</span>&nbsp;<span class="ident" id="7723087">src</span>&nbsp;<span class="op" id="7723091">=</span>&nbsp;<span class="string" id="7723093">&#34;package&nbsp;p\n(&#34;</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7723109">const</span>&nbsp;<span class="ident" id="7723115">res</span>&nbsp;<span class="op" id="7723119">=</span>&nbsp;<span class="string" id="7723121">&#34;package&nbsp;p\nBadDecl\n&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7723145">f</span><span class="op" id="7723146">,</span>&nbsp;<span class="ident" id="7723148">err</span>&nbsp;<span class="op" id="7723152">:=</span>&nbsp;<span class="ident" id="7723155">parser</span><span class="op" id="7723161">.</span><span class="ident" id="7723162">ParseFile</span><span class="op" id="7723171">(</span><span class="ident" id="7723172">fset</span><span class="op" id="7723176">,</span>&nbsp;<span class="string" id="7723178">&#34;&#34;</span><span class="op" id="7723180">,</span>&nbsp;<span class="ident" id="7723182">src</span><span class="op" id="7723185">,</span>&nbsp;<span class="ident" id="7723187">parser</span><span class="op" id="7723193">.</span><span class="ident" id="7723194">ParseComments</span><span class="op" id="7723207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7723210">if</span>&nbsp;<span class="ident" id="7723213">err</span>&nbsp;<span class="op" id="7723217">==</span>&nbsp;<span class="ident" id="7723220">nil</span>&nbsp;<span class="op" id="7723224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7723228">t</span><span class="op" id="7723229">.</span><span class="ident" id="7723230">Error</span><span class="op" id="7723235">(</span><span class="string" id="7723236">&#34;expected&nbsp;illegal&nbsp;program&#34;</span><span class="op" id="7723262">)</span>&nbsp;<span class="comment" id="7723264">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7723282">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7723285">var</span>&nbsp;<span class="ident" id="7723289">buf</span>&nbsp;<span class="ident" id="7723293">bytes</span><span class="op" id="7723298">.</span><span class="ident" id="7723299">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7723307">Fprint</span><span class="op" id="7723313">(</span><span class="op" id="7723314">&amp;</span><span class="ident" id="7723315">buf</span><span class="op" id="7723318">,</span>&nbsp;<span class="ident" id="7723320">fset</span><span class="op" id="7723324">,</span>&nbsp;<span class="ident" id="7723326">f</span><span class="op" id="7723327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7723330">if</span>&nbsp;<span class="ident" id="7723333">buf</span><span class="op" id="7723336">.</span><span class="ident" id="7723337">String</span><span class="op" id="7723343">(</span><span class="op" id="7723344">)</span>&nbsp;<span class="op" id="7723346">!=</span>&nbsp;<span class="ident" id="7723349">res</span>&nbsp;<span class="op" id="7723353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7723357">t</span><span class="op" id="7723358">.</span><span class="ident" id="7723359">Errorf</span><span class="op" id="7723365">(</span><span class="string" id="7723366">&#34;got&nbsp;%q,&nbsp;expected&nbsp;%q&#34;</span><span class="op" id="7723387">,</span>&nbsp;<span class="ident" id="7723389">buf</span><span class="op" id="7723392">.</span><span class="ident" id="7723393">String</span><span class="op" id="7723399">(</span><span class="op" id="7723400">)</span><span class="op" id="7723401">,</span>&nbsp;<span class="ident" id="7723403">res</span><span class="op" id="7723406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7723409">}</span><br>
<span class="lineno">270</span><span class="op" id="7723411">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7723414">//&nbsp;testComment&nbsp;verifies&nbsp;that&nbsp;f&nbsp;can&nbsp;be&nbsp;parsed&nbsp;again&nbsp;after&nbsp;printing&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="7723483">//&nbsp;with&nbsp;its&nbsp;first&nbsp;comment&nbsp;set&nbsp;to&nbsp;comment&nbsp;at&nbsp;any&nbsp;possible&nbsp;source&nbsp;offset.</span><br>
<span class="lineno"></span><span class="keyword" id="7723555">func</span>&nbsp;<span class="ident" id="7723560">testComment</span><span class="op" id="7723571">(</span><span class="ident" id="7723572">t</span>&nbsp;<span class="op" id="7723574">*</span><span class="ident" id="7723575">testing</span><span class="op" id="7723582">.</span><span class="ident" id="7723583">T</span><span class="op" id="7723584">,</span>&nbsp;<span class="ident" id="7723586">f</span>&nbsp;<span class="op" id="7723588">*</span><span class="ident" id="7723589">ast</span><span class="op" id="7723592">.</span><span class="ident" id="7723593">File</span><span class="op" id="7723597">,</span>&nbsp;<span class="ident" id="7723599">srclen</span>&nbsp;<span class="builtintype" id="7723606">int</span><span class="op" id="7723609">,</span>&nbsp;<span class="ident" id="7723611">comment</span>&nbsp;<span class="op" id="7723619">*</span><span class="ident" id="7723620">ast</span><span class="op" id="7723623">.</span><span class="ident" id="7723624">Comment</span><span class="op" id="7723631">)</span>&nbsp;<span class="op" id="7723633">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7723636">f</span><span class="op" id="7723637">.</span><span class="ident" id="7723638">Comments</span><span class="op" id="7723646">[</span><span class="num" id="7723647">0</span><span class="op" id="7723648">]</span><span class="op" id="7723649">.</span><span class="ident" id="7723650">List</span><span class="op" id="7723654">[</span><span class="num" id="7723655">0</span><span class="op" id="7723656">]</span>&nbsp;<span class="op" id="7723658">=</span>&nbsp;<span class="ident" id="7723660">comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7723669">var</span>&nbsp;<span class="ident" id="7723673">buf</span>&nbsp;<span class="ident" id="7723677">bytes</span><span class="op" id="7723682">.</span><span class="ident" id="7723683">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7723691">for</span>&nbsp;<span class="ident" id="7723695">offs</span>&nbsp;<span class="op" id="7723700">:=</span>&nbsp;<span class="num" id="7723703">0</span><span class="op" id="7723704">;</span>&nbsp;<span class="ident" id="7723706">offs</span>&nbsp;<span class="op" id="7723711">&lt;=</span>&nbsp;<span class="ident" id="7723714">srclen</span><span class="op" id="7723720">;</span>&nbsp;<span class="ident" id="7723722">offs</span><span class="op" id="7723726">++</span>&nbsp;<span class="op" id="7723729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7723733">buf</span><span class="op" id="7723736">.</span><span class="ident" id="7723737">Reset</span><span class="op" id="7723742">(</span><span class="op" id="7723743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7723747">//&nbsp;Printing&nbsp;f&nbsp;should&nbsp;result&nbsp;in&nbsp;a&nbsp;correct&nbsp;program&nbsp;no</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7723801">//&nbsp;matter&nbsp;what&nbsp;the&nbsp;(incorrect)&nbsp;comment&nbsp;position&nbsp;is.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7723855">if</span>&nbsp;<span class="ident" id="7723858">err</span>&nbsp;<span class="op" id="7723862">:=</span>&nbsp;<span class="ident" id="7723865">Fprint</span><span class="op" id="7723871">(</span><span class="op" id="7723872">&amp;</span><span class="ident" id="7723873">buf</span><span class="op" id="7723876">,</span>&nbsp;<span class="ident" id="7723878">fset</span><span class="op" id="7723882">,</span>&nbsp;<span class="ident" id="7723884">f</span><span class="op" id="7723885">)</span><span class="op" id="7723886">;</span>&nbsp;<span class="ident" id="7723888">err</span>&nbsp;<span class="op" id="7723892">!=</span>&nbsp;<span class="ident" id="7723895">nil</span>&nbsp;<span class="op" id="7723899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7723904">t</span><span class="op" id="7723905">.</span><span class="ident" id="7723906">Error</span><span class="op" id="7723911">(</span><span class="ident" id="7723912">err</span><span class="op" id="7723915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7723919">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7723923">if</span>&nbsp;<span class="ident" id="7723926">_</span><span class="op" id="7723927">,</span>&nbsp;<span class="ident" id="7723929">err</span>&nbsp;<span class="op" id="7723933">:=</span>&nbsp;<span class="ident" id="7723936">parser</span><span class="op" id="7723942">.</span><span class="ident" id="7723943">ParseFile</span><span class="op" id="7723952">(</span><span class="ident" id="7723953">fset</span><span class="op" id="7723957">,</span>&nbsp;<span class="string" id="7723959">&#34;&#34;</span><span class="op" id="7723961">,</span>&nbsp;<span class="ident" id="7723963">buf</span><span class="op" id="7723966">.</span><span class="ident" id="7723967">Bytes</span><span class="op" id="7723972">(</span><span class="op" id="7723973">)</span><span class="op" id="7723974">,</span>&nbsp;<span class="num" id="7723976">0</span><span class="op" id="7723977">)</span><span class="op" id="7723978">;</span>&nbsp;<span class="ident" id="7723980">err</span>&nbsp;<span class="op" id="7723984">!=</span>&nbsp;<span class="ident" id="7723987">nil</span>&nbsp;<span class="op" id="7723991">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7723996">t</span><span class="op" id="7723997">.</span><span class="ident" id="7723998">Fatalf</span><span class="op" id="7724004">(</span><span class="string" id="7724005">&#34;incorrect&nbsp;program&nbsp;for&nbsp;pos&nbsp;=&nbsp;%d:\n%s&#34;</span><span class="op" id="7724042">,</span>&nbsp;<span class="ident" id="7724044">comment</span><span class="op" id="7724051">.</span><span class="ident" id="7724052">Slash</span><span class="op" id="7724057">,</span>&nbsp;<span class="ident" id="7724059">buf</span><span class="op" id="7724062">.</span><span class="ident" id="7724063">String</span><span class="op" id="7724069">(</span><span class="op" id="7724070">)</span><span class="op" id="7724071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7724075">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7724079">//&nbsp;Position&nbsp;information&nbsp;is&nbsp;just&nbsp;an&nbsp;offset.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7724124">//&nbsp;Move&nbsp;comment&nbsp;one&nbsp;byte&nbsp;down&nbsp;in&nbsp;the&nbsp;source.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7724171">comment</span><span class="op" id="7724178">.</span><span class="ident" id="7724179">Slash</span><span class="op" id="7724184">++</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7724188">}</span><br>
<span class="lineno"></span><span class="op" id="7724190">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7724193">//&nbsp;Verify&nbsp;that&nbsp;the&nbsp;printer&nbsp;produces&nbsp;a&nbsp;correct&nbsp;program</span><br>
<span class="lineno"></span><span class="comment" id="7724247">//&nbsp;even&nbsp;if&nbsp;the&nbsp;position&nbsp;information&nbsp;of&nbsp;comments&nbsp;introducing&nbsp;newlines</span><br>
<span class="lineno">295</span><span class="comment" id="7724316">//&nbsp;is&nbsp;incorrect.</span><br>
<span class="lineno"></span><span class="keyword" id="7724333">func</span>&nbsp;<span class="ident" id="7724338">TestBadComments</span><span class="op" id="7724353">(</span><span class="ident" id="7724354">t</span>&nbsp;<span class="op" id="7724356">*</span><span class="ident" id="7724357">testing</span><span class="op" id="7724364">.</span><span class="ident" id="7724365">T</span><span class="op" id="7724366">)</span>&nbsp;<span class="op" id="7724368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7724371">const</span>&nbsp;<span class="ident" id="7724377">src</span>&nbsp;<span class="op" id="7724381">=</span>&nbsp;<span class="string" id="7724383">`<br>
<span class="lineno"></span>//&nbsp;first&nbsp;comment&nbsp;-&nbsp;text&nbsp;and&nbsp;position&nbsp;changed&nbsp;by&nbsp;test<br>
<span class="lineno"></span>package&nbsp;p<br>
<span class="lineno">300</span>import&nbsp;&#34;fmt&#34;<br>
<span class="lineno"></span>const&nbsp;pi&nbsp;=&nbsp;3.14&nbsp;//&nbsp;rough&nbsp;circle<br>
<span class="lineno"></span>var&nbsp;(<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspx,&nbsp;y,&nbsp;z&nbsp;int&nbsp;=&nbsp;1,&nbsp;2,&nbsp;3<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspu,&nbsp;v&nbsp;float64<br>
<span class="lineno">305</span>)<br>
<span class="lineno"></span>func&nbsp;fibo(n&nbsp;int)&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspif&nbsp;n&nbsp;&lt;&nbsp;2&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;n&nbsp;/*&nbsp;seed&nbsp;values&nbsp;*/<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp}<br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;fibo(n-1)&nbsp;+&nbsp;fibo(n-2)<br>
<span class="lineno"></span>}<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7724637">f</span><span class="op" id="7724638">,</span>&nbsp;<span class="ident" id="7724640">err</span>&nbsp;<span class="op" id="7724644">:=</span>&nbsp;<span class="ident" id="7724647">parser</span><span class="op" id="7724653">.</span><span class="ident" id="7724654">ParseFile</span><span class="op" id="7724663">(</span><span class="ident" id="7724664">fset</span><span class="op" id="7724668">,</span>&nbsp;<span class="string" id="7724670">&#34;&#34;</span><span class="op" id="7724672">,</span>&nbsp;<span class="ident" id="7724674">src</span><span class="op" id="7724677">,</span>&nbsp;<span class="ident" id="7724679">parser</span><span class="op" id="7724685">.</span><span class="ident" id="7724686">ParseComments</span><span class="op" id="7724699">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7724702">if</span>&nbsp;<span class="ident" id="7724705">err</span>&nbsp;<span class="op" id="7724709">!=</span>&nbsp;<span class="ident" id="7724712">nil</span>&nbsp;<span class="op" id="7724716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7724720">t</span><span class="op" id="7724721">.</span><span class="ident" id="7724722">Error</span><span class="op" id="7724727">(</span><span class="ident" id="7724728">err</span><span class="op" id="7724731">)</span>&nbsp;<span class="comment" id="7724733">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7724751">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7724755">comment</span>&nbsp;<span class="op" id="7724763">:=</span>&nbsp;<span class="ident" id="7724766">f</span><span class="op" id="7724767">.</span><span class="ident" id="7724768">Comments</span><span class="op" id="7724776">[</span><span class="num" id="7724777">0</span><span class="op" id="7724778">]</span><span class="op" id="7724779">.</span><span class="ident" id="7724780">List</span><span class="op" id="7724784">[</span><span class="num" id="7724785">0</span><span class="op" id="7724786">]</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7724789">pos</span>&nbsp;<span class="op" id="7724793">:=</span>&nbsp;<span class="ident" id="7724796">comment</span><span class="op" id="7724803">.</span><span class="ident" id="7724804">Pos</span><span class="op" id="7724807">(</span><span class="op" id="7724808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7724811">if</span>&nbsp;<span class="ident" id="7724814">fset</span><span class="op" id="7724818">.</span><span class="ident" id="7724819">Position</span><span class="op" id="7724827">(</span><span class="ident" id="7724828">pos</span><span class="op" id="7724831">)</span><span class="op" id="7724832">.</span><span class="ident" id="7724833">Offset</span>&nbsp;<span class="op" id="7724840">!=</span>&nbsp;<span class="num" id="7724843">1</span>&nbsp;<span class="op" id="7724845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7724849">t</span><span class="op" id="7724850">.</span><span class="ident" id="7724851">Error</span><span class="op" id="7724856">(</span><span class="string" id="7724857">&#34;expected&nbsp;offset&nbsp;1&#34;</span><span class="op" id="7724876">)</span>&nbsp;<span class="comment" id="7724878">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7724896">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7724900">testComment</span><span class="op" id="7724911">(</span><span class="ident" id="7724912">t</span><span class="op" id="7724913">,</span>&nbsp;<span class="ident" id="7724915">f</span><span class="op" id="7724916">,</span>&nbsp;<span class="builtinfunc" id="7724918">len</span><span class="op" id="7724921">(</span><span class="ident" id="7724922">src</span><span class="op" id="7724925">)</span><span class="op" id="7724926">,</span>&nbsp;<span class="op" id="7724928">&amp;</span><span class="ident" id="7724929">ast</span><span class="op" id="7724932">.</span><span class="ident" id="7724933">Comment</span><span class="op" id="7724940">{</span><span class="ident" id="7724941">Slash</span><span class="op" id="7724946">:</span>&nbsp;<span class="ident" id="7724948">pos</span><span class="op" id="7724951">,</span>&nbsp;<span class="ident" id="7724953">Text</span><span class="op" id="7724957">:</span>&nbsp;<span class="string" id="7724959">&#34;//-style&nbsp;comment&#34;</span><span class="op" id="7724977">}</span><span class="op" id="7724978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7724981">testComment</span><span class="op" id="7724992">(</span><span class="ident" id="7724993">t</span><span class="op" id="7724994">,</span>&nbsp;<span class="ident" id="7724996">f</span><span class="op" id="7724997">,</span>&nbsp;<span class="builtinfunc" id="7724999">len</span><span class="op" id="7725002">(</span><span class="ident" id="7725003">src</span><span class="op" id="7725006">)</span><span class="op" id="7725007">,</span>&nbsp;<span class="op" id="7725009">&amp;</span><span class="ident" id="7725010">ast</span><span class="op" id="7725013">.</span><span class="ident" id="7725014">Comment</span><span class="op" id="7725021">{</span><span class="ident" id="7725022">Slash</span><span class="op" id="7725027">:</span>&nbsp;<span class="ident" id="7725029">pos</span><span class="op" id="7725032">,</span>&nbsp;<span class="ident" id="7725034">Text</span><span class="op" id="7725038">:</span>&nbsp;<span class="string" id="7725040">&#34;/*-style&nbsp;comment&nbsp;*/&#34;</span><span class="op" id="7725061">}</span><span class="op" id="7725062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7725065">testComment</span><span class="op" id="7725076">(</span><span class="ident" id="7725077">t</span><span class="op" id="7725078">,</span>&nbsp;<span class="ident" id="7725080">f</span><span class="op" id="7725081">,</span>&nbsp;<span class="builtinfunc" id="7725083">len</span><span class="op" id="7725086">(</span><span class="ident" id="7725087">src</span><span class="op" id="7725090">)</span><span class="op" id="7725091">,</span>&nbsp;<span class="op" id="7725093">&amp;</span><span class="ident" id="7725094">ast</span><span class="op" id="7725097">.</span><span class="ident" id="7725098">Comment</span><span class="op" id="7725105">{</span><span class="ident" id="7725106">Slash</span><span class="op" id="7725111">:</span>&nbsp;<span class="ident" id="7725113">pos</span><span class="op" id="7725116">,</span>&nbsp;<span class="ident" id="7725118">Text</span><span class="op" id="7725122">:</span>&nbsp;<span class="string" id="7725124">&#34;/*-style&nbsp;\n&nbsp;comment&nbsp;*/&#34;</span><span class="op" id="7725148">}</span><span class="op" id="7725149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7725152">testComment</span><span class="op" id="7725163">(</span><span class="ident" id="7725164">t</span><span class="op" id="7725165">,</span>&nbsp;<span class="ident" id="7725167">f</span><span class="op" id="7725168">,</span>&nbsp;<span class="builtinfunc" id="7725170">len</span><span class="op" id="7725173">(</span><span class="ident" id="7725174">src</span><span class="op" id="7725177">)</span><span class="op" id="7725178">,</span>&nbsp;<span class="op" id="7725180">&amp;</span><span class="ident" id="7725181">ast</span><span class="op" id="7725184">.</span><span class="ident" id="7725185">Comment</span><span class="op" id="7725192">{</span><span class="ident" id="7725193">Slash</span><span class="op" id="7725198">:</span>&nbsp;<span class="ident" id="7725200">pos</span><span class="op" id="7725203">,</span>&nbsp;<span class="ident" id="7725205">Text</span><span class="op" id="7725209">:</span>&nbsp;<span class="string" id="7725211">&#34;/*-style&nbsp;comment&nbsp;\n\n\n&nbsp;*/&#34;</span><span class="op" id="7725239">}</span><span class="op" id="7725240">)</span><br>
<span class="lineno"></span><span class="op" id="7725242">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="keyword" id="7725245">type</span>&nbsp;<span class="ident" id="7725250">visitor</span>&nbsp;<span class="keyword" id="7725258">chan</span>&nbsp;<span class="op" id="7725263">*</span><span class="ident" id="7725264">ast</span><span class="op" id="7725267">.</span><span class="ident" id="7725268">Ident</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7725275">func</span>&nbsp;<span class="op" id="7725280">(</span><span class="ident" id="7725281">v</span>&nbsp;<span class="ident" id="7725283">visitor</span><span class="op" id="7725290">)</span>&nbsp;<span class="ident" id="7725292">Visit</span><span class="op" id="7725297">(</span><span class="ident" id="7725298">n</span>&nbsp;<span class="ident" id="7725300">ast</span><span class="op" id="7725303">.</span><span class="ident" id="7725304">Node</span><span class="op" id="7725308">)</span>&nbsp;<span class="op" id="7725310">(</span><span class="ident" id="7725311">w</span>&nbsp;<span class="ident" id="7725313">ast</span><span class="op" id="7725316">.</span><span class="ident" id="7725317">Visitor</span><span class="op" id="7725324">)</span>&nbsp;<span class="op" id="7725326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7725329">if</span>&nbsp;<span class="ident" id="7725332">ident</span><span class="op" id="7725337">,</span>&nbsp;<span class="ident" id="7725339">ok</span>&nbsp;<span class="op" id="7725342">:=</span>&nbsp;<span class="ident" id="7725345">n</span><span class="op" id="7725346">.</span><span class="op" id="7725347">(</span><span class="op" id="7725348">*</span><span class="ident" id="7725349">ast</span><span class="op" id="7725352">.</span><span class="ident" id="7725353">Ident</span><span class="op" id="7725358">)</span><span class="op" id="7725359">;</span>&nbsp;<span class="ident" id="7725361">ok</span>&nbsp;<span class="op" id="7725364">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7725368">v</span>&nbsp;<span class="op" id="7725370">&lt;-</span>&nbsp;<span class="ident" id="7725373">ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7725380">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7725383">return</span>&nbsp;<span class="ident" id="7725390">v</span><br>
<span class="lineno"></span><span class="op" id="7725392">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span><span class="comment" id="7725395">//&nbsp;idents&nbsp;is&nbsp;an&nbsp;iterator&nbsp;that&nbsp;returns&nbsp;all&nbsp;idents&nbsp;in&nbsp;f&nbsp;via&nbsp;the&nbsp;result&nbsp;channel.</span><br>
<span class="lineno"></span><span class="keyword" id="7725473">func</span>&nbsp;<span class="ident" id="7725478">idents</span><span class="op" id="7725484">(</span><span class="ident" id="7725485">f</span>&nbsp;<span class="op" id="7725487">*</span><span class="ident" id="7725488">ast</span><span class="op" id="7725491">.</span><span class="ident" id="7725492">File</span><span class="op" id="7725496">)</span>&nbsp;<span class="op" id="7725498">&lt;-</span><span class="keyword" id="7725500">chan</span>&nbsp;<span class="op" id="7725505">*</span><span class="ident" id="7725506">ast</span><span class="op" id="7725509">.</span><span class="ident" id="7725510">Ident</span>&nbsp;<span class="op" id="7725516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7725519">v</span>&nbsp;<span class="op" id="7725521">:=</span>&nbsp;<span class="builtinfunc" id="7725524">make</span><span class="op" id="7725528">(</span><span class="ident" id="7725529">visitor</span><span class="op" id="7725536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7725539">go</span>&nbsp;<span class="keyword" id="7725542">func</span><span class="op" id="7725546">(</span><span class="op" id="7725547">)</span>&nbsp;<span class="op" id="7725549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7725553">ast</span><span class="op" id="7725556">.</span><span class="ident" id="7725557">Walk</span><span class="op" id="7725561">(</span><span class="ident" id="7725562">v</span><span class="op" id="7725563">,</span>&nbsp;<span class="ident" id="7725565">f</span><span class="op" id="7725566">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7725570">close</span><span class="op" id="7725575">(</span><span class="ident" id="7725576">v</span><span class="op" id="7725577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7725580">}</span><span class="op" id="7725581">(</span><span class="op" id="7725582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7725585">return</span>&nbsp;<span class="ident" id="7725592">v</span><br>
<span class="lineno"></span><span class="op" id="7725594">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">350</span><span class="comment" id="7725597">//&nbsp;identCount&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;identifiers&nbsp;found&nbsp;in&nbsp;f.</span><br>
<span class="lineno"></span><span class="keyword" id="7725657">func</span>&nbsp;<span class="ident" id="7725662">identCount</span><span class="op" id="7725672">(</span><span class="ident" id="7725673">f</span>&nbsp;<span class="op" id="7725675">*</span><span class="ident" id="7725676">ast</span><span class="op" id="7725679">.</span><span class="ident" id="7725680">File</span><span class="op" id="7725684">)</span>&nbsp;<span class="builtintype" id="7725686">int</span>&nbsp;<span class="op" id="7725690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7725693">n</span>&nbsp;<span class="op" id="7725695">:=</span>&nbsp;<span class="num" id="7725698">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7725701">for</span>&nbsp;<span class="keyword" id="7725705">range</span>&nbsp;<span class="ident" id="7725711">idents</span><span class="op" id="7725717">(</span><span class="ident" id="7725718">f</span><span class="op" id="7725719">)</span>&nbsp;<span class="op" id="7725721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7725725">n</span><span class="op" id="7725726">++</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7725730">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7725733">return</span>&nbsp;<span class="ident" id="7725740">n</span><br>
<span class="lineno"></span><span class="op" id="7725742">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7725745">//&nbsp;Verify&nbsp;that&nbsp;the&nbsp;SourcePos&nbsp;mode&nbsp;emits&nbsp;correct&nbsp;//line&nbsp;comments</span><br>
<span class="lineno">360</span><span class="comment" id="7725809">//&nbsp;by&nbsp;testing&nbsp;that&nbsp;position&nbsp;information&nbsp;for&nbsp;matching&nbsp;identifiers</span><br>
<span class="lineno"></span><span class="comment" id="7725874">//&nbsp;is&nbsp;maintained.</span><br>
<span class="lineno"></span><span class="keyword" id="7725892">func</span>&nbsp;<span class="ident" id="7725897">TestSourcePos</span><span class="op" id="7725910">(</span><span class="ident" id="7725911">t</span>&nbsp;<span class="op" id="7725913">*</span><span class="ident" id="7725914">testing</span><span class="op" id="7725921">.</span><span class="ident" id="7725922">T</span><span class="op" id="7725923">)</span>&nbsp;<span class="op" id="7725925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7725928">const</span>&nbsp;<span class="ident" id="7725934">src</span>&nbsp;<span class="op" id="7725938">=</span>&nbsp;<span class="string" id="7725940">`<br>
<span class="lineno"></span>package&nbsp;p<br>
<span class="lineno">365</span>import&nbsp;(&nbsp;&#34;go/printer&#34;;&nbsp;&#34;math&#34;&nbsp;)<br>
<span class="lineno"></span>const&nbsp;pi&nbsp;=&nbsp;3.14;&nbsp;var&nbsp;x&nbsp;=&nbsp;0<br>
<span class="lineno"></span>type&nbsp;t&nbsp;struct{&nbsp;x,&nbsp;y,&nbsp;z&nbsp;int;&nbsp;u,&nbsp;v,&nbsp;w&nbsp;float32&nbsp;}<br>
<span class="lineno"></span>func&nbsp;(t&nbsp;*t)&nbsp;foo(a,&nbsp;b,&nbsp;c&nbsp;int)&nbsp;int&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;a*t.x&nbsp;+&nbsp;b*t.y&nbsp;+<br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;two&nbsp;extra&nbsp;lines&nbsp;here<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;...<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspc*t.z<br>
<span class="lineno"></span>}<br>
<span class="lineno"></span>`</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7726165">//&nbsp;parse&nbsp;original</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7726184">f1</span><span class="op" id="7726186">,</span>&nbsp;<span class="ident" id="7726188">err</span>&nbsp;<span class="op" id="7726192">:=</span>&nbsp;<span class="ident" id="7726195">parser</span><span class="op" id="7726201">.</span><span class="ident" id="7726202">ParseFile</span><span class="op" id="7726211">(</span><span class="ident" id="7726212">fset</span><span class="op" id="7726216">,</span>&nbsp;<span class="string" id="7726218">&#34;src&#34;</span><span class="op" id="7726223">,</span>&nbsp;<span class="ident" id="7726225">src</span><span class="op" id="7726228">,</span>&nbsp;<span class="ident" id="7726230">parser</span><span class="op" id="7726236">.</span><span class="ident" id="7726237">ParseComments</span><span class="op" id="7726250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7726253">if</span>&nbsp;<span class="ident" id="7726256">err</span>&nbsp;<span class="op" id="7726260">!=</span>&nbsp;<span class="ident" id="7726263">nil</span>&nbsp;<span class="op" id="7726267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7726271">t</span><span class="op" id="7726272">.</span><span class="ident" id="7726273">Fatal</span><span class="op" id="7726278">(</span><span class="ident" id="7726279">err</span><span class="op" id="7726282">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7726285">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7726289">//&nbsp;pretty-print&nbsp;original</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7726315">var</span>&nbsp;<span class="ident" id="7726319">buf</span>&nbsp;<span class="ident" id="7726323">bytes</span><span class="op" id="7726328">.</span><span class="ident" id="7726329">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7726337">err</span>&nbsp;<span class="op" id="7726341">=</span>&nbsp;<span class="op" id="7726343">(</span><span class="op" id="7726344">&amp;</span><span class="ident" id="7726345">Config</span><span class="op" id="7726351">{</span><span class="ident" id="7726352">Mode</span><span class="op" id="7726356">:</span>&nbsp;<span class="ident" id="7726358">UseSpaces</span>&nbsp;<span class="op" id="7726368">|</span>&nbsp;<span class="ident" id="7726370">SourcePos</span><span class="op" id="7726379">,</span>&nbsp;<span class="ident" id="7726381">Tabwidth</span><span class="op" id="7726389">:</span>&nbsp;<span class="num" id="7726391">8</span><span class="op" id="7726392">}</span><span class="op" id="7726393">)</span><span class="op" id="7726394">.</span><span class="ident" id="7726395">Fprint</span><span class="op" id="7726401">(</span><span class="op" id="7726402">&amp;</span><span class="ident" id="7726403">buf</span><span class="op" id="7726406">,</span>&nbsp;<span class="ident" id="7726408">fset</span><span class="op" id="7726412">,</span>&nbsp;<span class="ident" id="7726414">f1</span><span class="op" id="7726416">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7726419">if</span>&nbsp;<span class="ident" id="7726422">err</span>&nbsp;<span class="op" id="7726426">!=</span>&nbsp;<span class="ident" id="7726429">nil</span>&nbsp;<span class="op" id="7726433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7726437">t</span><span class="op" id="7726438">.</span><span class="ident" id="7726439">Fatal</span><span class="op" id="7726444">(</span><span class="ident" id="7726445">err</span><span class="op" id="7726448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7726451">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7726455">//&nbsp;parse&nbsp;pretty&nbsp;printed&nbsp;original</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7726489">//&nbsp;(//line&nbsp;comments&nbsp;must&nbsp;be&nbsp;interpreted&nbsp;even&nbsp;w/o&nbsp;parser.ParseComments&nbsp;set)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7726565">f2</span><span class="op" id="7726567">,</span>&nbsp;<span class="ident" id="7726569">err</span>&nbsp;<span class="op" id="7726573">:=</span>&nbsp;<span class="ident" id="7726576">parser</span><span class="op" id="7726582">.</span><span class="ident" id="7726583">ParseFile</span><span class="op" id="7726592">(</span><span class="ident" id="7726593">fset</span><span class="op" id="7726597">,</span>&nbsp;<span class="string" id="7726599">&#34;&#34;</span><span class="op" id="7726601">,</span>&nbsp;<span class="ident" id="7726603">buf</span><span class="op" id="7726606">.</span><span class="ident" id="7726607">Bytes</span><span class="op" id="7726612">(</span><span class="op" id="7726613">)</span><span class="op" id="7726614">,</span>&nbsp;<span class="num" id="7726616">0</span><span class="op" id="7726617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7726620">if</span>&nbsp;<span class="ident" id="7726623">err</span>&nbsp;<span class="op" id="7726627">!=</span>&nbsp;<span class="ident" id="7726630">nil</span>&nbsp;<span class="op" id="7726634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7726638">t</span><span class="op" id="7726639">.</span><span class="ident" id="7726640">Fatalf</span><span class="op" id="7726646">(</span><span class="string" id="7726647">&#34;%s\n%s&#34;</span><span class="op" id="7726655">,</span>&nbsp;<span class="ident" id="7726657">err</span><span class="op" id="7726660">,</span>&nbsp;<span class="ident" id="7726662">buf</span><span class="op" id="7726665">.</span><span class="ident" id="7726666">Bytes</span><span class="op" id="7726671">(</span><span class="op" id="7726672">)</span><span class="op" id="7726673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7726676">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7726680">//&nbsp;At&nbsp;this&nbsp;point&nbsp;the&nbsp;position&nbsp;information&nbsp;of&nbsp;identifiers&nbsp;in&nbsp;f2&nbsp;should</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7726751">//&nbsp;match&nbsp;the&nbsp;position&nbsp;information&nbsp;of&nbsp;corresponding&nbsp;identifiers&nbsp;in&nbsp;f1.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7726823">//&nbsp;number&nbsp;of&nbsp;identifiers&nbsp;must&nbsp;be&nbsp;&gt;&nbsp;0&nbsp;(test&nbsp;should&nbsp;run)&nbsp;and&nbsp;must&nbsp;match</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7726894">n1</span>&nbsp;<span class="op" id="7726897">:=</span>&nbsp;<span class="ident" id="7726900">identCount</span><span class="op" id="7726910">(</span><span class="ident" id="7726911">f1</span><span class="op" id="7726913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7726916">n2</span>&nbsp;<span class="op" id="7726919">:=</span>&nbsp;<span class="ident" id="7726922">identCount</span><span class="op" id="7726932">(</span><span class="ident" id="7726933">f2</span><span class="op" id="7726935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7726938">if</span>&nbsp;<span class="ident" id="7726941">n1</span>&nbsp;<span class="op" id="7726944">==</span>&nbsp;<span class="num" id="7726947">0</span>&nbsp;<span class="op" id="7726949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7726953">t</span><span class="op" id="7726954">.</span><span class="ident" id="7726955">Fatal</span><span class="op" id="7726960">(</span><span class="string" id="7726961">&#34;got&nbsp;no&nbsp;idents&#34;</span><span class="op" id="7726976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7726979">}</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7726982">if</span>&nbsp;<span class="ident" id="7726985">n2</span>&nbsp;<span class="op" id="7726988">!=</span>&nbsp;<span class="ident" id="7726991">n1</span>&nbsp;<span class="op" id="7726994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7726998">t</span><span class="op" id="7726999">.</span><span class="ident" id="7727000">Errorf</span><span class="op" id="7727006">(</span><span class="string" id="7727007">&#34;got&nbsp;%d&nbsp;idents;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7727031">,</span>&nbsp;<span class="ident" id="7727033">n2</span><span class="op" id="7727035">,</span>&nbsp;<span class="ident" id="7727037">n1</span><span class="op" id="7727039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7727042">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7727046">//&nbsp;verify&nbsp;that&nbsp;all&nbsp;identifiers&nbsp;have&nbsp;correct&nbsp;line&nbsp;information</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7727108">i2range</span>&nbsp;<span class="op" id="7727116">:=</span>&nbsp;<span class="ident" id="7727119">idents</span><span class="op" id="7727125">(</span><span class="ident" id="7727126">f2</span><span class="op" id="7727128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7727131">for</span>&nbsp;<span class="ident" id="7727135">i1</span>&nbsp;<span class="op" id="7727138">:=</span>&nbsp;<span class="keyword" id="7727141">range</span>&nbsp;<span class="ident" id="7727147">idents</span><span class="op" id="7727153">(</span><span class="ident" id="7727154">f1</span><span class="op" id="7727156">)</span>&nbsp;<span class="op" id="7727158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7727162">i2</span>&nbsp;<span class="op" id="7727165">:=</span>&nbsp;<span class="op" id="7727168">&lt;-</span><span class="ident" id="7727170">i2range</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7727181">if</span>&nbsp;<span class="ident" id="7727184">i2</span><span class="op" id="7727186">.</span><span class="ident" id="7727187">Name</span>&nbsp;<span class="op" id="7727192">!=</span>&nbsp;<span class="ident" id="7727195">i1</span><span class="op" id="7727197">.</span><span class="ident" id="7727198">Name</span>&nbsp;<span class="op" id="7727203">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7727208">t</span><span class="op" id="7727209">.</span><span class="ident" id="7727210">Errorf</span><span class="op" id="7727216">(</span><span class="string" id="7727217">&#34;got&nbsp;ident&nbsp;%s;&nbsp;want&nbsp;%s&#34;</span><span class="op" id="7727240">,</span>&nbsp;<span class="ident" id="7727242">i2</span><span class="op" id="7727244">.</span><span class="ident" id="7727245">Name</span><span class="op" id="7727249">,</span>&nbsp;<span class="ident" id="7727251">i1</span><span class="op" id="7727253">.</span><span class="ident" id="7727254">Name</span><span class="op" id="7727258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7727262">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7727267">l1</span>&nbsp;<span class="op" id="7727270">:=</span>&nbsp;<span class="ident" id="7727273">fset</span><span class="op" id="7727277">.</span><span class="ident" id="7727278">Position</span><span class="op" id="7727286">(</span><span class="ident" id="7727287">i1</span><span class="op" id="7727289">.</span><span class="ident" id="7727290">Pos</span><span class="op" id="7727293">(</span><span class="op" id="7727294">)</span><span class="op" id="7727295">)</span><span class="op" id="7727296">.</span><span class="ident" id="7727297">Line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7727304">l2</span>&nbsp;<span class="op" id="7727307">:=</span>&nbsp;<span class="ident" id="7727310">fset</span><span class="op" id="7727314">.</span><span class="ident" id="7727315">Position</span><span class="op" id="7727323">(</span><span class="ident" id="7727324">i2</span><span class="op" id="7727326">.</span><span class="ident" id="7727327">Pos</span><span class="op" id="7727330">(</span><span class="op" id="7727331">)</span><span class="op" id="7727332">)</span><span class="op" id="7727333">.</span><span class="ident" id="7727334">Line</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7727341">if</span>&nbsp;<span class="ident" id="7727344">l2</span>&nbsp;<span class="op" id="7727347">!=</span>&nbsp;<span class="ident" id="7727350">l1</span>&nbsp;<span class="op" id="7727353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7727358">t</span><span class="op" id="7727359">.</span><span class="ident" id="7727360">Errorf</span><span class="op" id="7727366">(</span><span class="string" id="7727367">&#34;got&nbsp;line&nbsp;%d;&nbsp;want&nbsp;%d&nbsp;for&nbsp;%s&#34;</span><span class="op" id="7727396">,</span>&nbsp;<span class="ident" id="7727398">l2</span><span class="op" id="7727400">,</span>&nbsp;<span class="ident" id="7727402">l1</span><span class="op" id="7727404">,</span>&nbsp;<span class="ident" id="7727406">i1</span><span class="op" id="7727408">.</span><span class="ident" id="7727409">Name</span><span class="op" id="7727413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7727417">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7727420">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7727424">if</span>&nbsp;<span class="ident" id="7727427">t</span><span class="op" id="7727428">.</span><span class="ident" id="7727429">Failed</span><span class="op" id="7727435">(</span><span class="op" id="7727436">)</span>&nbsp;<span class="op" id="7727438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7727442">t</span><span class="op" id="7727443">.</span><span class="ident" id="7727444">Logf</span><span class="op" id="7727448">(</span><span class="string" id="7727449">&#34;\n%s&#34;</span><span class="op" id="7727455">,</span>&nbsp;<span class="ident" id="7727457">buf</span><span class="op" id="7727460">.</span><span class="ident" id="7727461">Bytes</span><span class="op" id="7727466">(</span><span class="op" id="7727467">)</span><span class="op" id="7727468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7727471">}</span><br>
<span class="lineno"></span><span class="op" id="7727473">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span><span class="keyword" id="7727476">var</span>&nbsp;<span class="ident" id="7727480">decls</span>&nbsp;<span class="op" id="7727486">=</span>&nbsp;<span class="op" id="7727488">[</span><span class="op" id="7727489">]</span><span class="builtintype" id="7727490">string</span><span class="op" id="7727496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7727499">`import&nbsp;&#34;fmt&#34;`</span><span class="op" id="7727513">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7727516">&#34;const&nbsp;pi&nbsp;=&nbsp;3.1415\nconst&nbsp;e&nbsp;=&nbsp;2.71828\n\nvar&nbsp;x&nbsp;=&nbsp;pi&#34;</span><span class="op" id="7727568">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7727571">&#34;func&nbsp;sum(x,&nbsp;y&nbsp;int)&nbsp;int\t{&nbsp;return&nbsp;x&nbsp;+&nbsp;y&nbsp;}&#34;</span><span class="op" id="7727613">,</span><br>
<span class="lineno"></span><span class="op" id="7727615">}</span><br>
<span class="lineno">435</span><br>
<span class="lineno"></span><span class="keyword" id="7727618">func</span>&nbsp;<span class="ident" id="7727623">TestDeclLists</span><span class="op" id="7727636">(</span><span class="ident" id="7727637">t</span>&nbsp;<span class="op" id="7727639">*</span><span class="ident" id="7727640">testing</span><span class="op" id="7727647">.</span><span class="ident" id="7727648">T</span><span class="op" id="7727649">)</span>&nbsp;<span class="op" id="7727651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7727654">for</span>&nbsp;<span class="ident" id="7727658">_</span><span class="op" id="7727659">,</span>&nbsp;<span class="ident" id="7727661">src</span>&nbsp;<span class="op" id="7727665">:=</span>&nbsp;<span class="keyword" id="7727668">range</span>&nbsp;<span class="ident" id="7727674">decls</span>&nbsp;<span class="op" id="7727680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7727684">file</span><span class="op" id="7727688">,</span>&nbsp;<span class="ident" id="7727690">err</span>&nbsp;<span class="op" id="7727694">:=</span>&nbsp;<span class="ident" id="7727697">parser</span><span class="op" id="7727703">.</span><span class="ident" id="7727704">ParseFile</span><span class="op" id="7727713">(</span><span class="ident" id="7727714">fset</span><span class="op" id="7727718">,</span>&nbsp;<span class="string" id="7727720">&#34;&#34;</span><span class="op" id="7727722">,</span>&nbsp;<span class="string" id="7727724">&#34;package&nbsp;p;&#34;</span><span class="op" id="7727736">+</span><span class="ident" id="7727737">src</span><span class="op" id="7727740">,</span>&nbsp;<span class="ident" id="7727742">parser</span><span class="op" id="7727748">.</span><span class="ident" id="7727749">ParseComments</span><span class="op" id="7727762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7727766">if</span>&nbsp;<span class="ident" id="7727769">err</span>&nbsp;<span class="op" id="7727773">!=</span>&nbsp;<span class="ident" id="7727776">nil</span>&nbsp;<span class="op" id="7727780">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7727785">panic</span><span class="op" id="7727790">(</span><span class="ident" id="7727791">err</span><span class="op" id="7727794">)</span>&nbsp;<span class="comment" id="7727796">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7727815">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7727820">var</span>&nbsp;<span class="ident" id="7727824">buf</span>&nbsp;<span class="ident" id="7727828">bytes</span><span class="op" id="7727833">.</span><span class="ident" id="7727834">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7727843">err</span>&nbsp;<span class="op" id="7727847">=</span>&nbsp;<span class="ident" id="7727849">Fprint</span><span class="op" id="7727855">(</span><span class="op" id="7727856">&amp;</span><span class="ident" id="7727857">buf</span><span class="op" id="7727860">,</span>&nbsp;<span class="ident" id="7727862">fset</span><span class="op" id="7727866">,</span>&nbsp;<span class="ident" id="7727868">file</span><span class="op" id="7727872">.</span><span class="ident" id="7727873">Decls</span><span class="op" id="7727878">)</span>&nbsp;<span class="comment" id="7727880">//&nbsp;only&nbsp;print&nbsp;declarations</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7727909">if</span>&nbsp;<span class="ident" id="7727912">err</span>&nbsp;<span class="op" id="7727916">!=</span>&nbsp;<span class="ident" id="7727919">nil</span>&nbsp;<span class="op" id="7727923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7727928">panic</span><span class="op" id="7727933">(</span><span class="ident" id="7727934">err</span><span class="op" id="7727937">)</span>&nbsp;<span class="comment" id="7727939">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7727958">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7727963">out</span>&nbsp;<span class="op" id="7727967">:=</span>&nbsp;<span class="ident" id="7727970">buf</span><span class="op" id="7727973">.</span><span class="ident" id="7727974">String</span><span class="op" id="7727980">(</span><span class="op" id="7727981">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7727985">if</span>&nbsp;<span class="ident" id="7727988">out</span>&nbsp;<span class="op" id="7727992">!=</span>&nbsp;<span class="ident" id="7727995">src</span>&nbsp;<span class="op" id="7727999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7728004">t</span><span class="op" id="7728005">.</span><span class="ident" id="7728006">Errorf</span><span class="op" id="7728012">(</span><span class="string" id="7728013">&#34;\ngot&nbsp;:&nbsp;%q\nwant:&nbsp;%q\n&#34;</span><span class="op" id="7728037">,</span>&nbsp;<span class="ident" id="7728039">out</span><span class="op" id="7728042">,</span>&nbsp;<span class="ident" id="7728044">src</span><span class="op" id="7728047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7728051">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7728054">}</span><br>
<span class="lineno"></span><span class="op" id="7728056">}</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span><span class="keyword" id="7728059">var</span>&nbsp;<span class="ident" id="7728063">stmts</span>&nbsp;<span class="op" id="7728069">=</span>&nbsp;<span class="op" id="7728071">[</span><span class="op" id="7728072">]</span><span class="builtintype" id="7728073">string</span><span class="op" id="7728079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7728082">&#34;i&nbsp;:=&nbsp;0&#34;</span><span class="op" id="7728090">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7728093">&#34;select&nbsp;{}\nvar&nbsp;a,&nbsp;b&nbsp;=&nbsp;1,&nbsp;2\nreturn&nbsp;a&nbsp;+&nbsp;b&#34;</span><span class="op" id="7728135">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7728138">&#34;go&nbsp;f()\ndefer&nbsp;func()&nbsp;{}()&#34;</span><span class="op" id="7728165">,</span><br>
<span class="lineno">460</span><span class="op" id="7728167">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7728170">func</span>&nbsp;<span class="ident" id="7728175">TestStmtLists</span><span class="op" id="7728188">(</span><span class="ident" id="7728189">t</span>&nbsp;<span class="op" id="7728191">*</span><span class="ident" id="7728192">testing</span><span class="op" id="7728199">.</span><span class="ident" id="7728200">T</span><span class="op" id="7728201">)</span>&nbsp;<span class="op" id="7728203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7728206">for</span>&nbsp;<span class="ident" id="7728210">_</span><span class="op" id="7728211">,</span>&nbsp;<span class="ident" id="7728213">src</span>&nbsp;<span class="op" id="7728217">:=</span>&nbsp;<span class="keyword" id="7728220">range</span>&nbsp;<span class="ident" id="7728226">stmts</span>&nbsp;<span class="op" id="7728232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7728236">file</span><span class="op" id="7728240">,</span>&nbsp;<span class="ident" id="7728242">err</span>&nbsp;<span class="op" id="7728246">:=</span>&nbsp;<span class="ident" id="7728249">parser</span><span class="op" id="7728255">.</span><span class="ident" id="7728256">ParseFile</span><span class="op" id="7728265">(</span><span class="ident" id="7728266">fset</span><span class="op" id="7728270">,</span>&nbsp;<span class="string" id="7728272">&#34;&#34;</span><span class="op" id="7728274">,</span>&nbsp;<span class="string" id="7728276">&#34;package&nbsp;p;&nbsp;func&nbsp;_()&nbsp;{&#34;</span><span class="op" id="7728299">+</span><span class="ident" id="7728300">src</span><span class="op" id="7728303">+</span><span class="string" id="7728304">&#34;}&#34;</span><span class="op" id="7728307">,</span>&nbsp;<span class="ident" id="7728309">parser</span><span class="op" id="7728315">.</span><span class="ident" id="7728316">ParseComments</span><span class="op" id="7728329">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7728333">if</span>&nbsp;<span class="ident" id="7728336">err</span>&nbsp;<span class="op" id="7728340">!=</span>&nbsp;<span class="ident" id="7728343">nil</span>&nbsp;<span class="op" id="7728347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7728352">panic</span><span class="op" id="7728357">(</span><span class="ident" id="7728358">err</span><span class="op" id="7728361">)</span>&nbsp;<span class="comment" id="7728363">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7728382">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7728387">var</span>&nbsp;<span class="ident" id="7728391">buf</span>&nbsp;<span class="ident" id="7728395">bytes</span><span class="op" id="7728400">.</span><span class="ident" id="7728401">Buffer</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7728410">err</span>&nbsp;<span class="op" id="7728414">=</span>&nbsp;<span class="ident" id="7728416">Fprint</span><span class="op" id="7728422">(</span><span class="op" id="7728423">&amp;</span><span class="ident" id="7728424">buf</span><span class="op" id="7728427">,</span>&nbsp;<span class="ident" id="7728429">fset</span><span class="op" id="7728433">,</span>&nbsp;<span class="ident" id="7728435">file</span><span class="op" id="7728439">.</span><span class="ident" id="7728440">Decls</span><span class="op" id="7728445">[</span><span class="num" id="7728446">0</span><span class="op" id="7728447">]</span><span class="op" id="7728448">.</span><span class="op" id="7728449">(</span><span class="op" id="7728450">*</span><span class="ident" id="7728451">ast</span><span class="op" id="7728454">.</span><span class="ident" id="7728455">FuncDecl</span><span class="op" id="7728463">)</span><span class="op" id="7728464">.</span><span class="ident" id="7728465">Body</span><span class="op" id="7728469">.</span><span class="ident" id="7728470">List</span><span class="op" id="7728474">)</span>&nbsp;<span class="comment" id="7728476">//&nbsp;only&nbsp;print&nbsp;statements</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7728503">if</span>&nbsp;<span class="ident" id="7728506">err</span>&nbsp;<span class="op" id="7728510">!=</span>&nbsp;<span class="ident" id="7728513">nil</span>&nbsp;<span class="op" id="7728517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7728522">panic</span><span class="op" id="7728527">(</span><span class="ident" id="7728528">err</span><span class="op" id="7728531">)</span>&nbsp;<span class="comment" id="7728533">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7728552">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7728557">out</span>&nbsp;<span class="op" id="7728561">:=</span>&nbsp;<span class="ident" id="7728564">buf</span><span class="op" id="7728567">.</span><span class="ident" id="7728568">String</span><span class="op" id="7728574">(</span><span class="op" id="7728575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7728579">if</span>&nbsp;<span class="ident" id="7728582">out</span>&nbsp;<span class="op" id="7728586">!=</span>&nbsp;<span class="ident" id="7728589">src</span>&nbsp;<span class="op" id="7728593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7728598">t</span><span class="op" id="7728599">.</span><span class="ident" id="7728600">Errorf</span><span class="op" id="7728606">(</span><span class="string" id="7728607">&#34;\ngot&nbsp;:&nbsp;%q\nwant:&nbsp;%q\n&#34;</span><span class="op" id="7728631">,</span>&nbsp;<span class="ident" id="7728633">out</span><span class="op" id="7728636">,</span>&nbsp;<span class="ident" id="7728638">src</span><span class="op" id="7728641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7728645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7728648">}</span><br>
<span class="lineno">480</span><span class="op" id="7728650">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7728653">func</span>&nbsp;<span class="ident" id="7728658">TestBaseIndent</span><span class="op" id="7728672">(</span><span class="ident" id="7728673">t</span>&nbsp;<span class="op" id="7728675">*</span><span class="ident" id="7728676">testing</span><span class="op" id="7728683">.</span><span class="ident" id="7728684">T</span><span class="op" id="7728685">)</span>&nbsp;<span class="op" id="7728687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7728690">//&nbsp;The&nbsp;testfile&nbsp;must&nbsp;not&nbsp;contain&nbsp;multi-line&nbsp;raw&nbsp;strings&nbsp;since&nbsp;those</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7728759">//&nbsp;are&nbsp;not&nbsp;indented&nbsp;(because&nbsp;their&nbsp;values&nbsp;must&nbsp;not&nbsp;change)&nbsp;and&nbsp;make</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7728828">//&nbsp;this&nbsp;test&nbsp;fail.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7728848">const</span>&nbsp;<span class="ident" id="7728854">filename</span>&nbsp;<span class="op" id="7728863">=</span>&nbsp;<span class="string" id="7728865">&#34;printer.go&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7728879">src</span><span class="op" id="7728882">,</span>&nbsp;<span class="ident" id="7728884">err</span>&nbsp;<span class="op" id="7728888">:=</span>&nbsp;<span class="ident" id="7728891">ioutil</span><span class="op" id="7728897">.</span><span class="ident" id="7728898">ReadFile</span><span class="op" id="7728906">(</span><span class="ident" id="7728907">filename</span><span class="op" id="7728915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7728918">if</span>&nbsp;<span class="ident" id="7728921">err</span>&nbsp;<span class="op" id="7728925">!=</span>&nbsp;<span class="ident" id="7728928">nil</span>&nbsp;<span class="op" id="7728932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7728936">panic</span><span class="op" id="7728941">(</span><span class="ident" id="7728942">err</span><span class="op" id="7728945">)</span>&nbsp;<span class="comment" id="7728947">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7728965">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7728969">file</span><span class="op" id="7728973">,</span>&nbsp;<span class="ident" id="7728975">err</span>&nbsp;<span class="op" id="7728979">:=</span>&nbsp;<span class="ident" id="7728982">parser</span><span class="op" id="7728988">.</span><span class="ident" id="7728989">ParseFile</span><span class="op" id="7728998">(</span><span class="ident" id="7728999">fset</span><span class="op" id="7729003">,</span>&nbsp;<span class="ident" id="7729005">filename</span><span class="op" id="7729013">,</span>&nbsp;<span class="ident" id="7729015">src</span><span class="op" id="7729018">,</span>&nbsp;<span class="num" id="7729020">0</span><span class="op" id="7729021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7729024">if</span>&nbsp;<span class="ident" id="7729027">err</span>&nbsp;<span class="op" id="7729031">!=</span>&nbsp;<span class="ident" id="7729034">nil</span>&nbsp;<span class="op" id="7729038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7729042">panic</span><span class="op" id="7729047">(</span><span class="ident" id="7729048">err</span><span class="op" id="7729051">)</span>&nbsp;<span class="comment" id="7729053">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7729071">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7729075">var</span>&nbsp;<span class="ident" id="7729079">buf</span>&nbsp;<span class="ident" id="7729083">bytes</span><span class="op" id="7729088">.</span><span class="ident" id="7729089">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7729097">for</span>&nbsp;<span class="ident" id="7729101">indent</span>&nbsp;<span class="op" id="7729108">:=</span>&nbsp;<span class="num" id="7729111">0</span><span class="op" id="7729112">;</span>&nbsp;<span class="ident" id="7729114">indent</span>&nbsp;<span class="op" id="7729121">&lt;</span>&nbsp;<span class="num" id="7729123">4</span><span class="op" id="7729124">;</span>&nbsp;<span class="ident" id="7729126">indent</span><span class="op" id="7729132">++</span>&nbsp;<span class="op" id="7729135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7729139">buf</span><span class="op" id="7729142">.</span><span class="ident" id="7729143">Reset</span><span class="op" id="7729148">(</span><span class="op" id="7729149">)</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7729153">(</span><span class="op" id="7729154">&amp;</span><span class="ident" id="7729155">Config</span><span class="op" id="7729161">{</span><span class="ident" id="7729162">Tabwidth</span><span class="op" id="7729170">:</span>&nbsp;<span class="ident" id="7729172">tabwidth</span><span class="op" id="7729180">,</span>&nbsp;<span class="ident" id="7729182">Indent</span><span class="op" id="7729188">:</span>&nbsp;<span class="ident" id="7729190">indent</span><span class="op" id="7729196">}</span><span class="op" id="7729197">)</span><span class="op" id="7729198">.</span><span class="ident" id="7729199">Fprint</span><span class="op" id="7729205">(</span><span class="op" id="7729206">&amp;</span><span class="ident" id="7729207">buf</span><span class="op" id="7729210">,</span>&nbsp;<span class="ident" id="7729212">fset</span><span class="op" id="7729216">,</span>&nbsp;<span class="ident" id="7729218">file</span><span class="op" id="7729222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7729226">//&nbsp;all&nbsp;code&nbsp;must&nbsp;be&nbsp;indented&nbsp;by&nbsp;at&nbsp;least&nbsp;&#39;indent&#39;&nbsp;tabs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7729283">lines</span>&nbsp;<span class="op" id="7729289">:=</span>&nbsp;<span class="ident" id="7729292">bytes</span><span class="op" id="7729297">.</span><span class="ident" id="7729298">Split</span><span class="op" id="7729303">(</span><span class="ident" id="7729304">buf</span><span class="op" id="7729307">.</span><span class="ident" id="7729308">Bytes</span><span class="op" id="7729313">(</span><span class="op" id="7729314">)</span><span class="op" id="7729315">,</span>&nbsp;<span class="op" id="7729317">[</span><span class="op" id="7729318">]</span><span class="builtintype" id="7729319">byte</span><span class="op" id="7729323">{</span><span class="string" id="7729324">&#39;\n&#39;</span><span class="op" id="7729328">}</span><span class="op" id="7729329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7729333">for</span>&nbsp;<span class="ident" id="7729337">i</span><span class="op" id="7729338">,</span>&nbsp;<span class="ident" id="7729340">line</span>&nbsp;<span class="op" id="7729345">:=</span>&nbsp;<span class="keyword" id="7729348">range</span>&nbsp;<span class="ident" id="7729354">lines</span>&nbsp;<span class="op" id="7729360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7729365">if</span>&nbsp;<span class="builtinfunc" id="7729368">len</span><span class="op" id="7729371">(</span><span class="ident" id="7729372">line</span><span class="op" id="7729376">)</span>&nbsp;<span class="op" id="7729378">==</span>&nbsp;<span class="num" id="7729381">0</span>&nbsp;<span class="op" id="7729383">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7729389">continue</span>&nbsp;<span class="comment" id="7729398">//&nbsp;empty&nbsp;lines&nbsp;don&#39;t&nbsp;have&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7729439">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7729444">n</span>&nbsp;<span class="op" id="7729446">:=</span>&nbsp;<span class="num" id="7729449">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7729454">for</span>&nbsp;<span class="ident" id="7729458">j</span><span class="op" id="7729459">,</span>&nbsp;<span class="ident" id="7729461">b</span>&nbsp;<span class="op" id="7729463">:=</span>&nbsp;<span class="keyword" id="7729466">range</span>&nbsp;<span class="ident" id="7729472">line</span>&nbsp;<span class="op" id="7729477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7729483">if</span>&nbsp;<span class="ident" id="7729486">b</span>&nbsp;<span class="op" id="7729488">!=</span>&nbsp;<span class="string" id="7729491">&#39;\t&#39;</span>&nbsp;<span class="op" id="7729496">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7729503">//&nbsp;end&nbsp;of&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7729530">n</span>&nbsp;<span class="op" id="7729532">=</span>&nbsp;<span class="ident" id="7729534">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7729541">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7729551">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7729556">}</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7729561">if</span>&nbsp;<span class="ident" id="7729564">n</span>&nbsp;<span class="op" id="7729566">&lt;</span>&nbsp;<span class="ident" id="7729568">indent</span>&nbsp;<span class="op" id="7729575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7729581">t</span><span class="op" id="7729582">.</span><span class="ident" id="7729583">Errorf</span><span class="op" id="7729589">(</span><span class="string" id="7729590">&#34;line&nbsp;%d:&nbsp;got&nbsp;only&nbsp;%d&nbsp;tabs;&nbsp;want&nbsp;at&nbsp;least&nbsp;%d:&nbsp;%q&#34;</span><span class="op" id="7729639">,</span>&nbsp;<span class="ident" id="7729641">i</span><span class="op" id="7729642">,</span>&nbsp;<span class="ident" id="7729644">n</span><span class="op" id="7729645">,</span>&nbsp;<span class="ident" id="7729647">indent</span><span class="op" id="7729653">,</span>&nbsp;<span class="ident" id="7729655">line</span><span class="op" id="7729659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7729664">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7729668">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7729671">}</span><br>
<span class="lineno">520</span><span class="op" id="7729673">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7729676">//&nbsp;TestFuncType&nbsp;tests&nbsp;that&nbsp;an&nbsp;ast.FuncType&nbsp;with&nbsp;a&nbsp;nil&nbsp;Params&nbsp;field</span><br>
<span class="lineno"></span><span class="comment" id="7729743">//&nbsp;can&nbsp;be&nbsp;printed&nbsp;(per&nbsp;go/ast&nbsp;specification).&nbsp;Test&nbsp;case&nbsp;for&nbsp;issue&nbsp;3870.</span><br>
<span class="lineno"></span><span class="keyword" id="7729815">func</span>&nbsp;<span class="ident" id="7729820">TestFuncType</span><span class="op" id="7729832">(</span><span class="ident" id="7729833">t</span>&nbsp;<span class="op" id="7729835">*</span><span class="ident" id="7729836">testing</span><span class="op" id="7729843">.</span><span class="ident" id="7729844">T</span><span class="op" id="7729845">)</span>&nbsp;<span class="op" id="7729847">{</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7729850">src</span>&nbsp;<span class="op" id="7729854">:=</span>&nbsp;<span class="op" id="7729857">&amp;</span><span class="ident" id="7729858">ast</span><span class="op" id="7729861">.</span><span class="ident" id="7729862">File</span><span class="op" id="7729866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7729870">Name</span><span class="op" id="7729874">:</span>&nbsp;<span class="op" id="7729876">&amp;</span><span class="ident" id="7729877">ast</span><span class="op" id="7729880">.</span><span class="ident" id="7729881">Ident</span><span class="op" id="7729886">{</span><span class="ident" id="7729887">Name</span><span class="op" id="7729891">:</span>&nbsp;<span class="string" id="7729893">&#34;p&#34;</span><span class="op" id="7729896">}</span><span class="op" id="7729897">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7729901">Decls</span><span class="op" id="7729906">:</span>&nbsp;<span class="op" id="7729908">[</span><span class="op" id="7729909">]</span><span class="ident" id="7729910">ast</span><span class="op" id="7729913">.</span><span class="ident" id="7729914">Decl</span><span class="op" id="7729918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7729923">&amp;</span><span class="ident" id="7729924">ast</span><span class="op" id="7729927">.</span><span class="ident" id="7729928">FuncDecl</span><span class="op" id="7729936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7729942">Name</span><span class="op" id="7729946">:</span>&nbsp;<span class="op" id="7729948">&amp;</span><span class="ident" id="7729949">ast</span><span class="op" id="7729952">.</span><span class="ident" id="7729953">Ident</span><span class="op" id="7729958">{</span><span class="ident" id="7729959">Name</span><span class="op" id="7729963">:</span>&nbsp;<span class="string" id="7729965">&#34;f&#34;</span><span class="op" id="7729968">}</span><span class="op" id="7729969">,</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7729975">Type</span><span class="op" id="7729979">:</span>&nbsp;<span class="op" id="7729981">&amp;</span><span class="ident" id="7729982">ast</span><span class="op" id="7729985">.</span><span class="ident" id="7729986">FuncType</span><span class="op" id="7729994">{</span><span class="op" id="7729995">}</span><span class="op" id="7729996">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7730001">}</span><span class="op" id="7730002">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7730006">}</span><span class="op" id="7730007">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7730010">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7730014">var</span>&nbsp;<span class="ident" id="7730018">buf</span>&nbsp;<span class="ident" id="7730022">bytes</span><span class="op" id="7730027">.</span><span class="ident" id="7730028">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7730036">if</span>&nbsp;<span class="ident" id="7730039">err</span>&nbsp;<span class="op" id="7730043">:=</span>&nbsp;<span class="ident" id="7730046">Fprint</span><span class="op" id="7730052">(</span><span class="op" id="7730053">&amp;</span><span class="ident" id="7730054">buf</span><span class="op" id="7730057">,</span>&nbsp;<span class="ident" id="7730059">fset</span><span class="op" id="7730063">,</span>&nbsp;<span class="ident" id="7730065">src</span><span class="op" id="7730068">)</span><span class="op" id="7730069">;</span>&nbsp;<span class="ident" id="7730071">err</span>&nbsp;<span class="op" id="7730075">!=</span>&nbsp;<span class="ident" id="7730078">nil</span>&nbsp;<span class="op" id="7730082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7730086">t</span><span class="op" id="7730087">.</span><span class="ident" id="7730088">Fatal</span><span class="op" id="7730093">(</span><span class="ident" id="7730094">err</span><span class="op" id="7730097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7730100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7730103">got</span>&nbsp;<span class="op" id="7730107">:=</span>&nbsp;<span class="ident" id="7730110">buf</span><span class="op" id="7730113">.</span><span class="ident" id="7730114">String</span><span class="op" id="7730120">(</span><span class="op" id="7730121">)</span><br>
<span class="lineno">540</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7730125">const</span>&nbsp;<span class="ident" id="7730131">want</span>&nbsp;<span class="op" id="7730136">=</span>&nbsp;<span class="string" id="7730138">`package&nbsp;p<br>
<span class="lineno"></span><br>
<span class="lineno"></span>func&nbsp;f()<br>
<span class="lineno"></span>`</span><br>
<span class="lineno">545</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7730163">if</span>&nbsp;<span class="ident" id="7730166">got</span>&nbsp;<span class="op" id="7730170">!=</span>&nbsp;<span class="ident" id="7730173">want</span>&nbsp;<span class="op" id="7730178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7730182">t</span><span class="op" id="7730183">.</span><span class="ident" id="7730184">Fatalf</span><span class="op" id="7730190">(</span><span class="string" id="7730191">&#34;got:\n%s\nwant:\n%s\n&#34;</span><span class="op" id="7730214">,</span>&nbsp;<span class="ident" id="7730216">got</span><span class="op" id="7730219">,</span>&nbsp;<span class="ident" id="7730221">want</span><span class="op" id="7730225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7730228">}</span><br>
<span class="lineno"></span><span class="op" id="7730230">}</span><br>
<span class="lineno">550</span><br>
<span class="lineno"></span><span class="comment" id="7730233">//&nbsp;TextX&nbsp;is&nbsp;a&nbsp;skeleton&nbsp;test&nbsp;that&nbsp;can&nbsp;be&nbsp;filled&nbsp;in&nbsp;for&nbsp;debugging&nbsp;one-off&nbsp;cases.</span><br>
<span class="lineno"></span><span class="comment" id="7730312">//&nbsp;Do&nbsp;not&nbsp;remove.</span><br>
<span class="lineno"></span><span class="keyword" id="7730330">func</span>&nbsp;<span class="ident" id="7730335">TestX</span><span class="op" id="7730340">(</span><span class="ident" id="7730341">t</span>&nbsp;<span class="op" id="7730343">*</span><span class="ident" id="7730344">testing</span><span class="op" id="7730351">.</span><span class="ident" id="7730352">T</span><span class="op" id="7730353">)</span>&nbsp;<span class="op" id="7730355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7730358">const</span>&nbsp;<span class="ident" id="7730364">src</span>&nbsp;<span class="op" id="7730368">=</span>&nbsp;<span class="string" id="7730370">`<br>
<span class="lineno">555</span>package&nbsp;p<br>
<span class="lineno"></span>func&nbsp;_()&nbsp;{}<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7730397">_</span><span class="op" id="7730398">,</span>&nbsp;<span class="ident" id="7730400">err</span>&nbsp;<span class="op" id="7730404">:=</span>&nbsp;<span class="ident" id="7730407">format</span><span class="op" id="7730413">(</span><span class="op" id="7730414">[</span><span class="op" id="7730415">]</span><span class="builtintype" id="7730416">byte</span><span class="op" id="7730420">(</span><span class="ident" id="7730421">src</span><span class="op" id="7730424">)</span><span class="op" id="7730425">,</span>&nbsp;<span class="num" id="7730427">0</span><span class="op" id="7730428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7730431">if</span>&nbsp;<span class="ident" id="7730434">err</span>&nbsp;<span class="op" id="7730438">!=</span>&nbsp;<span class="ident" id="7730441">nil</span>&nbsp;<span class="op" id="7730445">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7730449">t</span><span class="op" id="7730450">.</span><span class="ident" id="7730451">Error</span><span class="op" id="7730456">(</span><span class="ident" id="7730457">err</span><span class="op" id="7730460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7730463">}</span><br>
<span class="lineno"></span><span class="op" id="7730465">}</span>
</div>
</body>
</html>
