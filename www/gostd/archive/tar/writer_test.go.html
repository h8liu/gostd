<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/tar</h2>
<ul>
<li><a href="/gostd/archive/tar/common.go.html">common.go</a></li>
<li><a href="/gostd/archive/tar/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/tar/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/tar/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/tar/stat_atim.go.html">stat_atim.go</a></li>
<li><a href="/gostd/archive/tar/stat_unix.go.html">stat_unix.go</a></li>
<li><a href="/gostd/archive/tar/tar_test.go.html">tar_test.go</a></li>
<li><a href="/gostd/archive/tar/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/tar/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7125788">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7125843">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7125897">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7125948">package</span>&nbsp;<span class="ident" id="7125956">tar</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7125961">import</span>&nbsp;<span class="op" id="7125968">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7125971">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7125980">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7125987">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7125993">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7126006">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7126012">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7126023">&#34;strings&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7126034">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7126045">&#34;testing/iotest&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7126063">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7126070">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="7126073">type</span>&nbsp;<span class="ident" id="7126078">writerTestEntry</span>&nbsp;<span class="keyword" id="7126094">struct</span>&nbsp;<span class="op" id="7126101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7126104">header</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7126113">*</span><span class="ident" id="7126114">Header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7126122">contents</span>&nbsp;<span class="builtintype" id="7126131">string</span><br>
<span class="lineno"></span><span class="op" id="7126138">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="7126141">type</span>&nbsp;<span class="ident" id="7126146">writerTest</span>&nbsp;<span class="keyword" id="7126157">struct</span>&nbsp;<span class="op" id="7126164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7126167">file</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7126175">string</span>&nbsp;<span class="comment" id="7126182">//&nbsp;filename&nbsp;of&nbsp;expected&nbsp;output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7126214">entries</span>&nbsp;<span class="op" id="7126222">[</span><span class="op" id="7126223">]</span><span class="op" id="7126224">*</span><span class="ident" id="7126225">writerTestEntry</span><br>
<span class="lineno"></span><span class="op" id="7126241">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="7126244">var</span>&nbsp;<span class="ident" id="7126248">writerTests</span>&nbsp;<span class="op" id="7126260">=</span>&nbsp;<span class="op" id="7126262">[</span><span class="op" id="7126263">]</span><span class="op" id="7126264">*</span><span class="ident" id="7126265">writerTest</span><span class="op" id="7126275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7126278">//&nbsp;The&nbsp;writer&nbsp;test&nbsp;file&nbsp;was&nbsp;produced&nbsp;with&nbsp;this&nbsp;command:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7126335">//&nbsp;tar&nbsp;(GNU&nbsp;tar)&nbsp;1.26</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7126358">//&nbsp;&nbsp;&nbsp;ln&nbsp;-s&nbsp;small.txt&nbsp;link.txt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7126389">//&nbsp;&nbsp;&nbsp;tar&nbsp;-b&nbsp;1&nbsp;--format=ustar&nbsp;-c&nbsp;-f&nbsp;writer.tar&nbsp;small.txt&nbsp;small2.txt&nbsp;link.txt</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7126466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7126470">file</span><span class="op" id="7126474">:</span>&nbsp;<span class="string" id="7126476">&#34;testdata/writer.tar&#34;</span><span class="op" id="7126497">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7126501">entries</span><span class="op" id="7126508">:</span>&nbsp;<span class="op" id="7126510">[</span><span class="op" id="7126511">]</span><span class="op" id="7126512">*</span><span class="ident" id="7126513">writerTestEntry</span><span class="op" id="7126528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7126533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7126539">header</span><span class="op" id="7126545">:</span>&nbsp;<span class="op" id="7126547">&amp;</span><span class="ident" id="7126548">Header</span><span class="op" id="7126554">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7126561">Name</span><span class="op" id="7126565">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7126571">&#34;small.txt&#34;</span><span class="op" id="7126582">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7126589">Mode</span><span class="op" id="7126593">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7126599">0640</span><span class="op" id="7126603">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7126610">Uid</span><span class="op" id="7126613">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7126620">73025</span><span class="op" id="7126625">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7126632">Gid</span><span class="op" id="7126635">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7126642">5000</span><span class="op" id="7126646">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7126653">Size</span><span class="op" id="7126657">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7126663">5</span><span class="op" id="7126664">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7126671">ModTime</span><span class="op" id="7126678">:</span>&nbsp;&nbsp;<span class="ident" id="7126681">time</span><span class="op" id="7126685">.</span><span class="ident" id="7126686">Unix</span><span class="op" id="7126690">(</span><span class="num" id="7126691">1246508266</span><span class="op" id="7126701">,</span>&nbsp;<span class="num" id="7126703">0</span><span class="op" id="7126704">)</span><span class="op" id="7126705">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7126712">Typeflag</span><span class="op" id="7126720">:</span>&nbsp;<span class="string" id="7126722">&#39;0&#39;</span><span class="op" id="7126725">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7126732">Uname</span><span class="op" id="7126737">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7126742">&#34;dsymonds&#34;</span><span class="op" id="7126752">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7126759">Gname</span><span class="op" id="7126764">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7126769">&#34;eng&#34;</span><span class="op" id="7126774">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7126780">}</span><span class="op" id="7126781">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7126787">contents</span><span class="op" id="7126795">:</span>&nbsp;<span class="string" id="7126797">&#34;Kilts&#34;</span><span class="op" id="7126804">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7126809">}</span><span class="op" id="7126810">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7126815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7126821">header</span><span class="op" id="7126827">:</span>&nbsp;<span class="op" id="7126829">&amp;</span><span class="ident" id="7126830">Header</span><span class="op" id="7126836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7126843">Name</span><span class="op" id="7126847">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7126853">&#34;small2.txt&#34;</span><span class="op" id="7126865">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7126872">Mode</span><span class="op" id="7126876">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7126882">0640</span><span class="op" id="7126886">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7126893">Uid</span><span class="op" id="7126896">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7126903">73025</span><span class="op" id="7126908">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7126915">Gid</span><span class="op" id="7126918">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7126925">5000</span><span class="op" id="7126929">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7126936">Size</span><span class="op" id="7126940">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7126946">11</span><span class="op" id="7126948">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7126955">ModTime</span><span class="op" id="7126962">:</span>&nbsp;&nbsp;<span class="ident" id="7126965">time</span><span class="op" id="7126969">.</span><span class="ident" id="7126970">Unix</span><span class="op" id="7126974">(</span><span class="num" id="7126975">1245217492</span><span class="op" id="7126985">,</span>&nbsp;<span class="num" id="7126987">0</span><span class="op" id="7126988">)</span><span class="op" id="7126989">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7126996">Typeflag</span><span class="op" id="7127004">:</span>&nbsp;<span class="string" id="7127006">&#39;0&#39;</span><span class="op" id="7127009">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7127016">Uname</span><span class="op" id="7127021">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7127026">&#34;dsymonds&#34;</span><span class="op" id="7127036">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7127043">Gname</span><span class="op" id="7127048">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7127053">&#34;eng&#34;</span><span class="op" id="7127058">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7127064">}</span><span class="op" id="7127065">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7127071">contents</span><span class="op" id="7127079">:</span>&nbsp;<span class="string" id="7127081">&#34;Google.com\n&#34;</span><span class="op" id="7127095">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7127100">}</span><span class="op" id="7127101">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7127106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7127112">header</span><span class="op" id="7127118">:</span>&nbsp;<span class="op" id="7127120">&amp;</span><span class="ident" id="7127121">Header</span><span class="op" id="7127127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7127134">Name</span><span class="op" id="7127138">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7127144">&#34;link.txt&#34;</span><span class="op" id="7127154">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7127161">Mode</span><span class="op" id="7127165">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7127171">0777</span><span class="op" id="7127175">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7127182">Uid</span><span class="op" id="7127185">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7127192">1000</span><span class="op" id="7127196">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7127203">Gid</span><span class="op" id="7127206">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7127213">1000</span><span class="op" id="7127217">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7127224">Size</span><span class="op" id="7127228">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7127234">0</span><span class="op" id="7127235">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7127242">ModTime</span><span class="op" id="7127249">:</span>&nbsp;&nbsp;<span class="ident" id="7127252">time</span><span class="op" id="7127256">.</span><span class="ident" id="7127257">Unix</span><span class="op" id="7127261">(</span><span class="num" id="7127262">1314603082</span><span class="op" id="7127272">,</span>&nbsp;<span class="num" id="7127274">0</span><span class="op" id="7127275">)</span><span class="op" id="7127276">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7127283">Typeflag</span><span class="op" id="7127291">:</span>&nbsp;<span class="string" id="7127293">&#39;2&#39;</span><span class="op" id="7127296">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7127303">Linkname</span><span class="op" id="7127311">:</span>&nbsp;<span class="string" id="7127313">&#34;small.txt&#34;</span><span class="op" id="7127324">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7127331">Uname</span><span class="op" id="7127336">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7127341">&#34;strings&#34;</span><span class="op" id="7127350">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7127357">Gname</span><span class="op" id="7127362">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7127367">&#34;strings&#34;</span><span class="op" id="7127376">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7127382">}</span><span class="op" id="7127383">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7127389">//&nbsp;no&nbsp;contents</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7127407">}</span><span class="op" id="7127408">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7127412">}</span><span class="op" id="7127413">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7127416">}</span><span class="op" id="7127417">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7127420">//&nbsp;The&nbsp;truncated&nbsp;test&nbsp;file&nbsp;was&nbsp;produced&nbsp;using&nbsp;these&nbsp;commands:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7127483">//&nbsp;&nbsp;&nbsp;dd&nbsp;if=/dev/zero&nbsp;bs=1048576&nbsp;count=16384&nbsp;&gt;&nbsp;/tmp/16gig.txt</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7127545">//&nbsp;&nbsp;&nbsp;tar&nbsp;-b&nbsp;1&nbsp;-c&nbsp;-f-&nbsp;/tmp/16gig.txt&nbsp;|&nbsp;dd&nbsp;bs=512&nbsp;count=8&nbsp;&gt;&nbsp;writer-big.tar</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7127619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7127623">file</span><span class="op" id="7127627">:</span>&nbsp;<span class="string" id="7127629">&#34;testdata/writer-big.tar&#34;</span><span class="op" id="7127654">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7127658">entries</span><span class="op" id="7127665">:</span>&nbsp;<span class="op" id="7127667">[</span><span class="op" id="7127668">]</span><span class="op" id="7127669">*</span><span class="ident" id="7127670">writerTestEntry</span><span class="op" id="7127685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7127690">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7127696">header</span><span class="op" id="7127702">:</span>&nbsp;<span class="op" id="7127704">&amp;</span><span class="ident" id="7127705">Header</span><span class="op" id="7127711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7127718">Name</span><span class="op" id="7127722">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7127728">&#34;tmp/16gig.txt&#34;</span><span class="op" id="7127743">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7127750">Mode</span><span class="op" id="7127754">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7127760">0640</span><span class="op" id="7127764">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7127771">Uid</span><span class="op" id="7127774">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7127781">73025</span><span class="op" id="7127786">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7127793">Gid</span><span class="op" id="7127796">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7127803">5000</span><span class="op" id="7127807">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7127814">Size</span><span class="op" id="7127818">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7127824">16</span>&nbsp;<span class="op" id="7127827">&lt;&lt;</span>&nbsp;<span class="num" id="7127830">30</span><span class="op" id="7127832">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7127839">ModTime</span><span class="op" id="7127846">:</span>&nbsp;&nbsp;<span class="ident" id="7127849">time</span><span class="op" id="7127853">.</span><span class="ident" id="7127854">Unix</span><span class="op" id="7127858">(</span><span class="num" id="7127859">1254699560</span><span class="op" id="7127869">,</span>&nbsp;<span class="num" id="7127871">0</span><span class="op" id="7127872">)</span><span class="op" id="7127873">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7127880">Typeflag</span><span class="op" id="7127888">:</span>&nbsp;<span class="string" id="7127890">&#39;0&#39;</span><span class="op" id="7127893">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7127900">Uname</span><span class="op" id="7127905">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7127910">&#34;dsymonds&#34;</span><span class="op" id="7127920">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7127927">Gname</span><span class="op" id="7127932">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7127937">&#34;eng&#34;</span><span class="op" id="7127942">,</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7127948">}</span><span class="op" id="7127949">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7127955">//&nbsp;fake&nbsp;contents</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7127976">contents</span><span class="op" id="7127984">:</span>&nbsp;<span class="ident" id="7127986">strings</span><span class="op" id="7127993">.</span><span class="ident" id="7127994">Repeat</span><span class="op" id="7128000">(</span><span class="string" id="7128001">&#34;\x00&#34;</span><span class="op" id="7128007">,</span>&nbsp;<span class="num" id="7128009">4</span><span class="op" id="7128010">&lt;&lt;</span><span class="num" id="7128012">10</span><span class="op" id="7128014">)</span><span class="op" id="7128015">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7128020">}</span><span class="op" id="7128021">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7128025">}</span><span class="op" id="7128026">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7128029">}</span><span class="op" id="7128030">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7128033">//&nbsp;The&nbsp;truncated&nbsp;test&nbsp;file&nbsp;was&nbsp;produced&nbsp;using&nbsp;these&nbsp;commands:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7128096">//&nbsp;&nbsp;&nbsp;dd&nbsp;if=/dev/zero&nbsp;bs=1048576&nbsp;count=16384&nbsp;&gt;&nbsp;(longname/)*15&nbsp;/16gig.txt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7128169">//&nbsp;&nbsp;&nbsp;tar&nbsp;-b&nbsp;1&nbsp;-c&nbsp;-f-&nbsp;(longname/)*15&nbsp;/16gig.txt&nbsp;|&nbsp;dd&nbsp;bs=512&nbsp;count=8&nbsp;&gt;&nbsp;writer-big-long.tar</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7128259">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7128263">file</span><span class="op" id="7128267">:</span>&nbsp;<span class="string" id="7128269">&#34;testdata/writer-big-long.tar&#34;</span><span class="op" id="7128299">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7128303">entries</span><span class="op" id="7128310">:</span>&nbsp;<span class="op" id="7128312">[</span><span class="op" id="7128313">]</span><span class="op" id="7128314">*</span><span class="ident" id="7128315">writerTestEntry</span><span class="op" id="7128330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7128335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7128341">header</span><span class="op" id="7128347">:</span>&nbsp;<span class="op" id="7128349">&amp;</span><span class="ident" id="7128350">Header</span><span class="op" id="7128356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7128363">Name</span><span class="op" id="7128367">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7128373">strings</span><span class="op" id="7128380">.</span><span class="ident" id="7128381">Repeat</span><span class="op" id="7128387">(</span><span class="string" id="7128388">&#34;longname/&#34;</span><span class="op" id="7128399">,</span>&nbsp;<span class="num" id="7128401">15</span><span class="op" id="7128403">)</span>&nbsp;<span class="op" id="7128405">+</span>&nbsp;<span class="string" id="7128407">&#34;16gig.txt&#34;</span><span class="op" id="7128418">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7128425">Mode</span><span class="op" id="7128429">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7128435">0644</span><span class="op" id="7128439">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7128446">Uid</span><span class="op" id="7128449">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7128456">1000</span><span class="op" id="7128460">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7128467">Gid</span><span class="op" id="7128470">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7128477">1000</span><span class="op" id="7128481">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7128488">Size</span><span class="op" id="7128492">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7128498">16</span>&nbsp;<span class="op" id="7128501">&lt;&lt;</span>&nbsp;<span class="num" id="7128504">30</span><span class="op" id="7128506">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7128513">ModTime</span><span class="op" id="7128520">:</span>&nbsp;&nbsp;<span class="ident" id="7128523">time</span><span class="op" id="7128527">.</span><span class="ident" id="7128528">Unix</span><span class="op" id="7128532">(</span><span class="num" id="7128533">1399583047</span><span class="op" id="7128543">,</span>&nbsp;<span class="num" id="7128545">0</span><span class="op" id="7128546">)</span><span class="op" id="7128547">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7128554">Typeflag</span><span class="op" id="7128562">:</span>&nbsp;<span class="string" id="7128564">&#39;0&#39;</span><span class="op" id="7128567">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7128574">Uname</span><span class="op" id="7128579">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7128584">&#34;guillaume&#34;</span><span class="op" id="7128595">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7128602">Gname</span><span class="op" id="7128607">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7128612">&#34;guillaume&#34;</span><span class="op" id="7128623">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7128629">}</span><span class="op" id="7128630">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7128636">//&nbsp;fake&nbsp;contents</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7128657">contents</span><span class="op" id="7128665">:</span>&nbsp;<span class="ident" id="7128667">strings</span><span class="op" id="7128674">.</span><span class="ident" id="7128675">Repeat</span><span class="op" id="7128681">(</span><span class="string" id="7128682">&#34;\x00&#34;</span><span class="op" id="7128688">,</span>&nbsp;<span class="num" id="7128690">4</span><span class="op" id="7128691">&lt;&lt;</span><span class="num" id="7128693">10</span><span class="op" id="7128695">)</span><span class="op" id="7128696">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7128701">}</span><span class="op" id="7128702">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7128706">}</span><span class="op" id="7128707">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7128710">}</span><span class="op" id="7128711">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7128714">//&nbsp;This&nbsp;file&nbsp;was&nbsp;produced&nbsp;using&nbsp;gnu&nbsp;tar&nbsp;1.17</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7128760">//&nbsp;gnutar&nbsp;&nbsp;-b&nbsp;4&nbsp;--format=ustar&nbsp;(longname/)*15&nbsp;+&nbsp;file.txt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7128818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7128822">file</span><span class="op" id="7128826">:</span>&nbsp;<span class="string" id="7128828">&#34;testdata/ustar.tar&#34;</span><span class="op" id="7128848">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7128852">entries</span><span class="op" id="7128859">:</span>&nbsp;<span class="op" id="7128861">[</span><span class="op" id="7128862">]</span><span class="op" id="7128863">*</span><span class="ident" id="7128864">writerTestEntry</span><span class="op" id="7128879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7128884">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7128890">header</span><span class="op" id="7128896">:</span>&nbsp;<span class="op" id="7128898">&amp;</span><span class="ident" id="7128899">Header</span><span class="op" id="7128905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7128912">Name</span><span class="op" id="7128916">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7128922">strings</span><span class="op" id="7128929">.</span><span class="ident" id="7128930">Repeat</span><span class="op" id="7128936">(</span><span class="string" id="7128937">&#34;longname/&#34;</span><span class="op" id="7128948">,</span>&nbsp;<span class="num" id="7128950">15</span><span class="op" id="7128952">)</span>&nbsp;<span class="op" id="7128954">+</span>&nbsp;<span class="string" id="7128956">&#34;file.txt&#34;</span><span class="op" id="7128966">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7128973">Mode</span><span class="op" id="7128977">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7128983">0644</span><span class="op" id="7128987">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7128994">Uid</span><span class="op" id="7128997">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7129004">0765</span><span class="op" id="7129008">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7129015">Gid</span><span class="op" id="7129018">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7129025">024</span><span class="op" id="7129028">,</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7129035">Size</span><span class="op" id="7129039">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7129045">06</span><span class="op" id="7129047">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7129054">ModTime</span><span class="op" id="7129061">:</span>&nbsp;&nbsp;<span class="ident" id="7129064">time</span><span class="op" id="7129068">.</span><span class="ident" id="7129069">Unix</span><span class="op" id="7129073">(</span><span class="num" id="7129074">1360135598</span><span class="op" id="7129084">,</span>&nbsp;<span class="num" id="7129086">0</span><span class="op" id="7129087">)</span><span class="op" id="7129088">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7129095">Typeflag</span><span class="op" id="7129103">:</span>&nbsp;<span class="string" id="7129105">&#39;0&#39;</span><span class="op" id="7129108">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7129115">Uname</span><span class="op" id="7129120">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7129125">&#34;shane&#34;</span><span class="op" id="7129132">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7129139">Gname</span><span class="op" id="7129144">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7129149">&#34;staff&#34;</span><span class="op" id="7129156">,</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7129162">}</span><span class="op" id="7129163">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7129169">contents</span><span class="op" id="7129177">:</span>&nbsp;<span class="string" id="7129179">&#34;hello\n&#34;</span><span class="op" id="7129188">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7129193">}</span><span class="op" id="7129194">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7129198">}</span><span class="op" id="7129199">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7129202">}</span><span class="op" id="7129203">,</span><br>
<span class="lineno">150</span><span class="op" id="7129205">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7129208">//&nbsp;Render&nbsp;byte&nbsp;array&nbsp;in&nbsp;a&nbsp;two-character&nbsp;hexadecimal&nbsp;string,&nbsp;spaced&nbsp;for&nbsp;easy&nbsp;visual&nbsp;inspection.</span><br>
<span class="lineno"></span><span class="keyword" id="7129303">func</span>&nbsp;<span class="ident" id="7129308">bytestr</span><span class="op" id="7129315">(</span><span class="ident" id="7129316">offset</span>&nbsp;<span class="builtintype" id="7129323">int</span><span class="op" id="7129326">,</span>&nbsp;<span class="ident" id="7129328">b</span>&nbsp;<span class="op" id="7129330">[</span><span class="op" id="7129331">]</span><span class="builtintype" id="7129332">byte</span><span class="op" id="7129336">)</span>&nbsp;<span class="builtintype" id="7129338">string</span>&nbsp;<span class="op" id="7129345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7129348">const</span>&nbsp;<span class="ident" id="7129354">rowLen</span>&nbsp;<span class="op" id="7129361">=</span>&nbsp;<span class="num" id="7129363">32</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7129367">s</span>&nbsp;<span class="op" id="7129369">:=</span>&nbsp;<span class="ident" id="7129372">fmt</span><span class="op" id="7129375">.</span><span class="ident" id="7129376">Sprintf</span><span class="op" id="7129383">(</span><span class="string" id="7129384">&#34;%04x&nbsp;&#34;</span><span class="op" id="7129391">,</span>&nbsp;<span class="ident" id="7129393">offset</span><span class="op" id="7129399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7129402">for</span>&nbsp;<span class="ident" id="7129406">_</span><span class="op" id="7129407">,</span>&nbsp;<span class="ident" id="7129409">ch</span>&nbsp;<span class="op" id="7129412">:=</span>&nbsp;<span class="keyword" id="7129415">range</span>&nbsp;<span class="ident" id="7129421">b</span>&nbsp;<span class="op" id="7129423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7129427">switch</span>&nbsp;<span class="op" id="7129434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7129438">case</span>&nbsp;<span class="string" id="7129443">&#39;0&#39;</span>&nbsp;<span class="op" id="7129447">&lt;=</span>&nbsp;<span class="ident" id="7129450">ch</span>&nbsp;<span class="op" id="7129453">&amp;&amp;</span>&nbsp;<span class="ident" id="7129456">ch</span>&nbsp;<span class="op" id="7129459">&lt;=</span>&nbsp;<span class="string" id="7129462">&#39;9&#39;</span><span class="op" id="7129465">,</span>&nbsp;<span class="string" id="7129467">&#39;A&#39;</span>&nbsp;<span class="op" id="7129471">&lt;=</span>&nbsp;<span class="ident" id="7129474">ch</span>&nbsp;<span class="op" id="7129477">&amp;&amp;</span>&nbsp;<span class="ident" id="7129480">ch</span>&nbsp;<span class="op" id="7129483">&lt;=</span>&nbsp;<span class="string" id="7129486">&#39;Z&#39;</span><span class="op" id="7129489">,</span>&nbsp;<span class="string" id="7129491">&#39;a&#39;</span>&nbsp;<span class="op" id="7129495">&lt;=</span>&nbsp;<span class="ident" id="7129498">ch</span>&nbsp;<span class="op" id="7129501">&amp;&amp;</span>&nbsp;<span class="ident" id="7129504">ch</span>&nbsp;<span class="op" id="7129507">&lt;=</span>&nbsp;<span class="string" id="7129510">&#39;z&#39;</span><span class="op" id="7129513">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7129518">s</span>&nbsp;<span class="op" id="7129520">+=</span>&nbsp;<span class="ident" id="7129523">fmt</span><span class="op" id="7129526">.</span><span class="ident" id="7129527">Sprintf</span><span class="op" id="7129534">(</span><span class="string" id="7129535">&#34;&nbsp;&nbsp;%c&#34;</span><span class="op" id="7129541">,</span>&nbsp;<span class="ident" id="7129543">ch</span><span class="op" id="7129545">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7129549">default</span><span class="op" id="7129556">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7129561">s</span>&nbsp;<span class="op" id="7129563">+=</span>&nbsp;<span class="ident" id="7129566">fmt</span><span class="op" id="7129569">.</span><span class="ident" id="7129570">Sprintf</span><span class="op" id="7129577">(</span><span class="string" id="7129578">&#34;&nbsp;%02x&#34;</span><span class="op" id="7129585">,</span>&nbsp;<span class="ident" id="7129587">ch</span><span class="op" id="7129589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7129593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7129596">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7129599">return</span>&nbsp;<span class="ident" id="7129606">s</span><br>
<span class="lineno">165</span><span class="op" id="7129608">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7129611">//&nbsp;Render&nbsp;a&nbsp;pseudo-diff&nbsp;between&nbsp;two&nbsp;blocks&nbsp;of&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="7129664">func</span>&nbsp;<span class="ident" id="7129669">bytediff</span><span class="op" id="7129677">(</span><span class="ident" id="7129678">a</span>&nbsp;<span class="op" id="7129680">[</span><span class="op" id="7129681">]</span><span class="builtintype" id="7129682">byte</span><span class="op" id="7129686">,</span>&nbsp;<span class="ident" id="7129688">b</span>&nbsp;<span class="op" id="7129690">[</span><span class="op" id="7129691">]</span><span class="builtintype" id="7129692">byte</span><span class="op" id="7129696">)</span>&nbsp;<span class="builtintype" id="7129698">string</span>&nbsp;<span class="op" id="7129705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7129708">const</span>&nbsp;<span class="ident" id="7129714">rowLen</span>&nbsp;<span class="op" id="7129721">=</span>&nbsp;<span class="num" id="7129723">32</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7129727">s</span>&nbsp;<span class="op" id="7129729">:=</span>&nbsp;<span class="ident" id="7129732">fmt</span><span class="op" id="7129735">.</span><span class="ident" id="7129736">Sprintf</span><span class="op" id="7129743">(</span><span class="string" id="7129744">&#34;(%d&nbsp;bytes&nbsp;vs.&nbsp;%d&nbsp;bytes)\n&#34;</span><span class="op" id="7129771">,</span>&nbsp;<span class="builtinfunc" id="7129773">len</span><span class="op" id="7129776">(</span><span class="ident" id="7129777">a</span><span class="op" id="7129778">)</span><span class="op" id="7129779">,</span>&nbsp;<span class="builtinfunc" id="7129781">len</span><span class="op" id="7129784">(</span><span class="ident" id="7129785">b</span><span class="op" id="7129786">)</span><span class="op" id="7129787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7129790">for</span>&nbsp;<span class="ident" id="7129794">offset</span>&nbsp;<span class="op" id="7129801">:=</span>&nbsp;<span class="num" id="7129804">0</span><span class="op" id="7129805">;</span>&nbsp;<span class="builtinfunc" id="7129807">len</span><span class="op" id="7129810">(</span><span class="ident" id="7129811">a</span><span class="op" id="7129812">)</span><span class="op" id="7129813">+</span><span class="builtinfunc" id="7129814">len</span><span class="op" id="7129817">(</span><span class="ident" id="7129818">b</span><span class="op" id="7129819">)</span>&nbsp;<span class="op" id="7129821">&gt;</span>&nbsp;<span class="num" id="7129823">0</span><span class="op" id="7129824">;</span>&nbsp;<span class="ident" id="7129826">offset</span>&nbsp;<span class="op" id="7129833">+=</span>&nbsp;<span class="ident" id="7129836">rowLen</span>&nbsp;<span class="op" id="7129843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7129847">na</span><span class="op" id="7129849">,</span>&nbsp;<span class="ident" id="7129851">nb</span>&nbsp;<span class="op" id="7129854">:=</span>&nbsp;<span class="ident" id="7129857">rowLen</span><span class="op" id="7129863">,</span>&nbsp;<span class="ident" id="7129865">rowLen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7129874">if</span>&nbsp;<span class="ident" id="7129877">na</span>&nbsp;<span class="op" id="7129880">&gt;</span>&nbsp;<span class="builtinfunc" id="7129882">len</span><span class="op" id="7129885">(</span><span class="ident" id="7129886">a</span><span class="op" id="7129887">)</span>&nbsp;<span class="op" id="7129889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7129894">na</span>&nbsp;<span class="op" id="7129897">=</span>&nbsp;<span class="builtinfunc" id="7129899">len</span><span class="op" id="7129902">(</span><span class="ident" id="7129903">a</span><span class="op" id="7129904">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7129908">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7129912">if</span>&nbsp;<span class="ident" id="7129915">nb</span>&nbsp;<span class="op" id="7129918">&gt;</span>&nbsp;<span class="builtinfunc" id="7129920">len</span><span class="op" id="7129923">(</span><span class="ident" id="7129924">b</span><span class="op" id="7129925">)</span>&nbsp;<span class="op" id="7129927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7129932">nb</span>&nbsp;<span class="op" id="7129935">=</span>&nbsp;<span class="builtinfunc" id="7129937">len</span><span class="op" id="7129940">(</span><span class="ident" id="7129941">b</span><span class="op" id="7129942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7129946">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7129950">sa</span>&nbsp;<span class="op" id="7129953">:=</span>&nbsp;<span class="ident" id="7129956">bytestr</span><span class="op" id="7129963">(</span><span class="ident" id="7129964">offset</span><span class="op" id="7129970">,</span>&nbsp;<span class="ident" id="7129972">a</span><span class="op" id="7129973">[</span><span class="num" id="7129974">0</span><span class="op" id="7129975">:</span><span class="ident" id="7129976">na</span><span class="op" id="7129978">]</span><span class="op" id="7129979">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7129983">sb</span>&nbsp;<span class="op" id="7129986">:=</span>&nbsp;<span class="ident" id="7129989">bytestr</span><span class="op" id="7129996">(</span><span class="ident" id="7129997">offset</span><span class="op" id="7130003">,</span>&nbsp;<span class="ident" id="7130005">b</span><span class="op" id="7130006">[</span><span class="num" id="7130007">0</span><span class="op" id="7130008">:</span><span class="ident" id="7130009">nb</span><span class="op" id="7130011">]</span><span class="op" id="7130012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7130016">if</span>&nbsp;<span class="ident" id="7130019">sa</span>&nbsp;<span class="op" id="7130022">!=</span>&nbsp;<span class="ident" id="7130025">sb</span>&nbsp;<span class="op" id="7130028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7130033">s</span>&nbsp;<span class="op" id="7130035">+=</span>&nbsp;<span class="ident" id="7130038">fmt</span><span class="op" id="7130041">.</span><span class="ident" id="7130042">Sprintf</span><span class="op" id="7130049">(</span><span class="string" id="7130050">&#34;-%v\n+%v\n&#34;</span><span class="op" id="7130062">,</span>&nbsp;<span class="ident" id="7130064">sa</span><span class="op" id="7130066">,</span>&nbsp;<span class="ident" id="7130068">sb</span><span class="op" id="7130070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7130074">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7130078">a</span>&nbsp;<span class="op" id="7130080">=</span>&nbsp;<span class="ident" id="7130082">a</span><span class="op" id="7130083">[</span><span class="ident" id="7130084">na</span><span class="op" id="7130086">:</span><span class="op" id="7130087">]</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7130091">b</span>&nbsp;<span class="op" id="7130093">=</span>&nbsp;<span class="ident" id="7130095">b</span><span class="op" id="7130096">[</span><span class="ident" id="7130097">nb</span><span class="op" id="7130099">:</span><span class="op" id="7130100">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7130103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7130106">return</span>&nbsp;<span class="ident" id="7130113">s</span><br>
<span class="lineno"></span><span class="op" id="7130115">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="keyword" id="7130118">func</span>&nbsp;<span class="ident" id="7130123">TestWriter</span><span class="op" id="7130133">(</span><span class="ident" id="7130134">t</span>&nbsp;<span class="op" id="7130136">*</span><span class="ident" id="7130137">testing</span><span class="op" id="7130144">.</span><span class="ident" id="7130145">T</span><span class="op" id="7130146">)</span>&nbsp;<span class="op" id="7130148">{</span><br>
<span class="lineno"></span><span class="ident" id="7130150">testLoop</span><span class="op" id="7130158">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7130161">for</span>&nbsp;<span class="ident" id="7130165">i</span><span class="op" id="7130166">,</span>&nbsp;<span class="ident" id="7130168">test</span>&nbsp;<span class="op" id="7130173">:=</span>&nbsp;<span class="keyword" id="7130176">range</span>&nbsp;<span class="ident" id="7130182">writerTests</span>&nbsp;<span class="op" id="7130194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7130198">expected</span><span class="op" id="7130206">,</span>&nbsp;<span class="ident" id="7130208">err</span>&nbsp;<span class="op" id="7130212">:=</span>&nbsp;<span class="ident" id="7130215">ioutil</span><span class="op" id="7130221">.</span><span class="ident" id="7130222">ReadFile</span><span class="op" id="7130230">(</span><span class="ident" id="7130231">test</span><span class="op" id="7130235">.</span><span class="ident" id="7130236">file</span><span class="op" id="7130240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7130244">if</span>&nbsp;<span class="ident" id="7130247">err</span>&nbsp;<span class="op" id="7130251">!=</span>&nbsp;<span class="ident" id="7130254">nil</span>&nbsp;<span class="op" id="7130258">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7130263">t</span><span class="op" id="7130264">.</span><span class="ident" id="7130265">Errorf</span><span class="op" id="7130271">(</span><span class="string" id="7130272">&#34;test&nbsp;%d:&nbsp;Unexpected&nbsp;error:&nbsp;%v&#34;</span><span class="op" id="7130303">,</span>&nbsp;<span class="ident" id="7130305">i</span><span class="op" id="7130306">,</span>&nbsp;<span class="ident" id="7130308">err</span><span class="op" id="7130311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7130316">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7130327">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7130332">buf</span>&nbsp;<span class="op" id="7130336">:=</span>&nbsp;<span class="builtinfunc" id="7130339">new</span><span class="op" id="7130342">(</span><span class="ident" id="7130343">bytes</span><span class="op" id="7130348">.</span><span class="ident" id="7130349">Buffer</span><span class="op" id="7130355">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7130359">tw</span>&nbsp;<span class="op" id="7130362">:=</span>&nbsp;<span class="ident" id="7130365">NewWriter</span><span class="op" id="7130374">(</span><span class="ident" id="7130375">iotest</span><span class="op" id="7130381">.</span><span class="ident" id="7130382">TruncateWriter</span><span class="op" id="7130396">(</span><span class="ident" id="7130397">buf</span><span class="op" id="7130400">,</span>&nbsp;<span class="num" id="7130402">4</span><span class="op" id="7130403">&lt;&lt;</span><span class="num" id="7130405">10</span><span class="op" id="7130407">)</span><span class="op" id="7130408">)</span>&nbsp;<span class="comment" id="7130410">//&nbsp;only&nbsp;catch&nbsp;the&nbsp;first&nbsp;4&nbsp;KB</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7130441">big</span>&nbsp;<span class="op" id="7130445">:=</span>&nbsp;<span class="builtintype" id="7130448">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7130456">for</span>&nbsp;<span class="ident" id="7130460">j</span><span class="op" id="7130461">,</span>&nbsp;<span class="ident" id="7130463">entry</span>&nbsp;<span class="op" id="7130469">:=</span>&nbsp;<span class="keyword" id="7130472">range</span>&nbsp;<span class="ident" id="7130478">test</span><span class="op" id="7130482">.</span><span class="ident" id="7130483">entries</span>&nbsp;<span class="op" id="7130491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7130496">big</span>&nbsp;<span class="op" id="7130500">=</span>&nbsp;<span class="ident" id="7130502">big</span>&nbsp;<span class="op" id="7130506">||</span>&nbsp;<span class="ident" id="7130509">entry</span><span class="op" id="7130514">.</span><span class="ident" id="7130515">header</span><span class="op" id="7130521">.</span><span class="ident" id="7130522">Size</span>&nbsp;<span class="op" id="7130527">&gt;</span>&nbsp;<span class="num" id="7130529">1</span><span class="op" id="7130530">&lt;&lt;</span><span class="num" id="7130532">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7130538">if</span>&nbsp;<span class="ident" id="7130541">err</span>&nbsp;<span class="op" id="7130545">:=</span>&nbsp;<span class="ident" id="7130548">tw</span><span class="op" id="7130550">.</span><span class="ident" id="7130551">WriteHeader</span><span class="op" id="7130562">(</span><span class="ident" id="7130563">entry</span><span class="op" id="7130568">.</span><span class="ident" id="7130569">header</span><span class="op" id="7130575">)</span><span class="op" id="7130576">;</span>&nbsp;<span class="ident" id="7130578">err</span>&nbsp;<span class="op" id="7130582">!=</span>&nbsp;<span class="ident" id="7130585">nil</span>&nbsp;<span class="op" id="7130589">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7130595">t</span><span class="op" id="7130596">.</span><span class="ident" id="7130597">Errorf</span><span class="op" id="7130603">(</span><span class="string" id="7130604">&#34;test&nbsp;%d,&nbsp;entry&nbsp;%d:&nbsp;Failed&nbsp;writing&nbsp;header:&nbsp;%v&#34;</span><span class="op" id="7130650">,</span>&nbsp;<span class="ident" id="7130652">i</span><span class="op" id="7130653">,</span>&nbsp;<span class="ident" id="7130655">j</span><span class="op" id="7130656">,</span>&nbsp;<span class="ident" id="7130658">err</span><span class="op" id="7130661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7130667">continue</span>&nbsp;<span class="ident" id="7130676">testLoop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7130688">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7130693">if</span>&nbsp;<span class="ident" id="7130696">_</span><span class="op" id="7130697">,</span>&nbsp;<span class="ident" id="7130699">err</span>&nbsp;<span class="op" id="7130703">:=</span>&nbsp;<span class="ident" id="7130706">io</span><span class="op" id="7130708">.</span><span class="ident" id="7130709">WriteString</span><span class="op" id="7130720">(</span><span class="ident" id="7130721">tw</span><span class="op" id="7130723">,</span>&nbsp;<span class="ident" id="7130725">entry</span><span class="op" id="7130730">.</span><span class="ident" id="7130731">contents</span><span class="op" id="7130739">)</span><span class="op" id="7130740">;</span>&nbsp;<span class="ident" id="7130742">err</span>&nbsp;<span class="op" id="7130746">!=</span>&nbsp;<span class="ident" id="7130749">nil</span>&nbsp;<span class="op" id="7130753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7130759">t</span><span class="op" id="7130760">.</span><span class="ident" id="7130761">Errorf</span><span class="op" id="7130767">(</span><span class="string" id="7130768">&#34;test&nbsp;%d,&nbsp;entry&nbsp;%d:&nbsp;Failed&nbsp;writing&nbsp;contents:&nbsp;%v&#34;</span><span class="op" id="7130816">,</span>&nbsp;<span class="ident" id="7130818">i</span><span class="op" id="7130819">,</span>&nbsp;<span class="ident" id="7130821">j</span><span class="op" id="7130822">,</span>&nbsp;<span class="ident" id="7130824">err</span><span class="op" id="7130827">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7130833">continue</span>&nbsp;<span class="ident" id="7130842">testLoop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7130854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7130858">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7130862">//&nbsp;Only&nbsp;interested&nbsp;in&nbsp;Close&nbsp;failures&nbsp;for&nbsp;the&nbsp;small&nbsp;tests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7130922">if</span>&nbsp;<span class="ident" id="7130925">err</span>&nbsp;<span class="op" id="7130929">:=</span>&nbsp;<span class="ident" id="7130932">tw</span><span class="op" id="7130934">.</span><span class="ident" id="7130935">Close</span><span class="op" id="7130940">(</span><span class="op" id="7130941">)</span><span class="op" id="7130942">;</span>&nbsp;<span class="ident" id="7130944">err</span>&nbsp;<span class="op" id="7130948">!=</span>&nbsp;<span class="ident" id="7130951">nil</span>&nbsp;<span class="op" id="7130955">&amp;&amp;</span>&nbsp;<span class="op" id="7130958">!</span><span class="ident" id="7130959">big</span>&nbsp;<span class="op" id="7130963">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7130968">t</span><span class="op" id="7130969">.</span><span class="ident" id="7130970">Errorf</span><span class="op" id="7130976">(</span><span class="string" id="7130977">&#34;test&nbsp;%d:&nbsp;Failed&nbsp;closing&nbsp;archive:&nbsp;%v&#34;</span><span class="op" id="7131014">,</span>&nbsp;<span class="ident" id="7131016">i</span><span class="op" id="7131017">,</span>&nbsp;<span class="ident" id="7131019">err</span><span class="op" id="7131022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7131027">continue</span>&nbsp;<span class="ident" id="7131036">testLoop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7131047">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7131052">actual</span>&nbsp;<span class="op" id="7131059">:=</span>&nbsp;<span class="ident" id="7131062">buf</span><span class="op" id="7131065">.</span><span class="ident" id="7131066">Bytes</span><span class="op" id="7131071">(</span><span class="op" id="7131072">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7131076">if</span>&nbsp;<span class="op" id="7131079">!</span><span class="ident" id="7131080">bytes</span><span class="op" id="7131085">.</span><span class="ident" id="7131086">Equal</span><span class="op" id="7131091">(</span><span class="ident" id="7131092">expected</span><span class="op" id="7131100">,</span>&nbsp;<span class="ident" id="7131102">actual</span><span class="op" id="7131108">)</span>&nbsp;<span class="op" id="7131110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7131115">t</span><span class="op" id="7131116">.</span><span class="ident" id="7131117">Errorf</span><span class="op" id="7131123">(</span><span class="string" id="7131124">&#34;test&nbsp;%d:&nbsp;Incorrect&nbsp;result:&nbsp;(-=expected,&nbsp;+=actual)\n%v&#34;</span><span class="op" id="7131179">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7131185">i</span><span class="op" id="7131186">,</span>&nbsp;<span class="ident" id="7131188">bytediff</span><span class="op" id="7131196">(</span><span class="ident" id="7131197">expected</span><span class="op" id="7131205">,</span>&nbsp;<span class="ident" id="7131207">actual</span><span class="op" id="7131213">)</span><span class="op" id="7131214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7131218">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7131222">if</span>&nbsp;<span class="ident" id="7131225">testing</span><span class="op" id="7131232">.</span><span class="ident" id="7131233">Short</span><span class="op" id="7131238">(</span><span class="op" id="7131239">)</span>&nbsp;<span class="op" id="7131241">{</span>&nbsp;<span class="comment" id="7131243">//&nbsp;The&nbsp;second&nbsp;test&nbsp;is&nbsp;expensive.</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7131279">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7131287">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7131290">}</span><br>
<span class="lineno"></span><span class="op" id="7131292">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="keyword" id="7131295">func</span>&nbsp;<span class="ident" id="7131300">TestPax</span><span class="op" id="7131307">(</span><span class="ident" id="7131308">t</span>&nbsp;<span class="op" id="7131310">*</span><span class="ident" id="7131311">testing</span><span class="op" id="7131318">.</span><span class="ident" id="7131319">T</span><span class="op" id="7131320">)</span>&nbsp;<span class="op" id="7131322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7131325">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;a&nbsp;large&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7131365">fileinfo</span><span class="op" id="7131373">,</span>&nbsp;<span class="ident" id="7131375">err</span>&nbsp;<span class="op" id="7131379">:=</span>&nbsp;<span class="ident" id="7131382">os</span><span class="op" id="7131384">.</span><span class="ident" id="7131385">Stat</span><span class="op" id="7131389">(</span><span class="string" id="7131390">&#34;testdata/small.txt&#34;</span><span class="op" id="7131410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7131413">if</span>&nbsp;<span class="ident" id="7131416">err</span>&nbsp;<span class="op" id="7131420">!=</span>&nbsp;<span class="ident" id="7131423">nil</span>&nbsp;<span class="op" id="7131427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7131431">t</span><span class="op" id="7131432">.</span><span class="ident" id="7131433">Fatal</span><span class="op" id="7131438">(</span><span class="ident" id="7131439">err</span><span class="op" id="7131442">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7131445">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7131448">hdr</span><span class="op" id="7131451">,</span>&nbsp;<span class="ident" id="7131453">err</span>&nbsp;<span class="op" id="7131457">:=</span>&nbsp;<span class="ident" id="7131460">FileInfoHeader</span><span class="op" id="7131474">(</span><span class="ident" id="7131475">fileinfo</span><span class="op" id="7131483">,</span>&nbsp;<span class="string" id="7131485">&#34;&#34;</span><span class="op" id="7131487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7131490">if</span>&nbsp;<span class="ident" id="7131493">err</span>&nbsp;<span class="op" id="7131497">!=</span>&nbsp;<span class="ident" id="7131500">nil</span>&nbsp;<span class="op" id="7131504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7131508">t</span><span class="op" id="7131509">.</span><span class="ident" id="7131510">Fatalf</span><span class="op" id="7131516">(</span><span class="string" id="7131517">&#34;os.Stat:&nbsp;%v&#34;</span><span class="op" id="7131530">,</span>&nbsp;<span class="ident" id="7131532">err</span><span class="op" id="7131535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7131538">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7131541">//&nbsp;Force&nbsp;a&nbsp;PAX&nbsp;long&nbsp;name&nbsp;to&nbsp;be&nbsp;written</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7131581">longName</span>&nbsp;<span class="op" id="7131590">:=</span>&nbsp;<span class="ident" id="7131593">strings</span><span class="op" id="7131600">.</span><span class="ident" id="7131601">Repeat</span><span class="op" id="7131607">(</span><span class="string" id="7131608">&#34;ab&#34;</span><span class="op" id="7131612">,</span>&nbsp;<span class="num" id="7131614">100</span><span class="op" id="7131617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7131620">contents</span>&nbsp;<span class="op" id="7131629">:=</span>&nbsp;<span class="ident" id="7131632">strings</span><span class="op" id="7131639">.</span><span class="ident" id="7131640">Repeat</span><span class="op" id="7131646">(</span><span class="string" id="7131647">&#34;&nbsp;&#34;</span><span class="op" id="7131650">,</span>&nbsp;<span class="builtintype" id="7131652">int</span><span class="op" id="7131655">(</span><span class="ident" id="7131656">hdr</span><span class="op" id="7131659">.</span><span class="ident" id="7131660">Size</span><span class="op" id="7131664">)</span><span class="op" id="7131665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7131668">hdr</span><span class="op" id="7131671">.</span><span class="ident" id="7131672">Name</span>&nbsp;<span class="op" id="7131677">=</span>&nbsp;<span class="ident" id="7131679">longName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7131689">var</span>&nbsp;<span class="ident" id="7131693">buf</span>&nbsp;<span class="ident" id="7131697">bytes</span><span class="op" id="7131702">.</span><span class="ident" id="7131703">Buffer</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7131711">writer</span>&nbsp;<span class="op" id="7131718">:=</span>&nbsp;<span class="ident" id="7131721">NewWriter</span><span class="op" id="7131730">(</span><span class="op" id="7131731">&amp;</span><span class="ident" id="7131732">buf</span><span class="op" id="7131735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7131738">if</span>&nbsp;<span class="ident" id="7131741">err</span>&nbsp;<span class="op" id="7131745">:=</span>&nbsp;<span class="ident" id="7131748">writer</span><span class="op" id="7131754">.</span><span class="ident" id="7131755">WriteHeader</span><span class="op" id="7131766">(</span><span class="ident" id="7131767">hdr</span><span class="op" id="7131770">)</span><span class="op" id="7131771">;</span>&nbsp;<span class="ident" id="7131773">err</span>&nbsp;<span class="op" id="7131777">!=</span>&nbsp;<span class="ident" id="7131780">nil</span>&nbsp;<span class="op" id="7131784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7131788">t</span><span class="op" id="7131789">.</span><span class="ident" id="7131790">Fatal</span><span class="op" id="7131795">(</span><span class="ident" id="7131796">err</span><span class="op" id="7131799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7131802">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7131805">if</span>&nbsp;<span class="ident" id="7131808">_</span><span class="op" id="7131809">,</span>&nbsp;<span class="ident" id="7131811">err</span>&nbsp;<span class="op" id="7131815">=</span>&nbsp;<span class="ident" id="7131817">writer</span><span class="op" id="7131823">.</span><span class="ident" id="7131824">Write</span><span class="op" id="7131829">(</span><span class="op" id="7131830">[</span><span class="op" id="7131831">]</span><span class="builtintype" id="7131832">byte</span><span class="op" id="7131836">(</span><span class="ident" id="7131837">contents</span><span class="op" id="7131845">)</span><span class="op" id="7131846">)</span><span class="op" id="7131847">;</span>&nbsp;<span class="ident" id="7131849">err</span>&nbsp;<span class="op" id="7131853">!=</span>&nbsp;<span class="ident" id="7131856">nil</span>&nbsp;<span class="op" id="7131860">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7131864">t</span><span class="op" id="7131865">.</span><span class="ident" id="7131866">Fatal</span><span class="op" id="7131871">(</span><span class="ident" id="7131872">err</span><span class="op" id="7131875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7131878">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7131881">if</span>&nbsp;<span class="ident" id="7131884">err</span>&nbsp;<span class="op" id="7131888">:=</span>&nbsp;<span class="ident" id="7131891">writer</span><span class="op" id="7131897">.</span><span class="ident" id="7131898">Close</span><span class="op" id="7131903">(</span><span class="op" id="7131904">)</span><span class="op" id="7131905">;</span>&nbsp;<span class="ident" id="7131907">err</span>&nbsp;<span class="op" id="7131911">!=</span>&nbsp;<span class="ident" id="7131914">nil</span>&nbsp;<span class="op" id="7131918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7131922">t</span><span class="op" id="7131923">.</span><span class="ident" id="7131924">Fatal</span><span class="op" id="7131929">(</span><span class="ident" id="7131930">err</span><span class="op" id="7131933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7131936">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7131939">//&nbsp;Simple&nbsp;test&nbsp;to&nbsp;make&nbsp;sure&nbsp;PAX&nbsp;extensions&nbsp;are&nbsp;in&nbsp;effect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7131997">if</span>&nbsp;<span class="op" id="7132000">!</span><span class="ident" id="7132001">bytes</span><span class="op" id="7132006">.</span><span class="ident" id="7132007">Contains</span><span class="op" id="7132015">(</span><span class="ident" id="7132016">buf</span><span class="op" id="7132019">.</span><span class="ident" id="7132020">Bytes</span><span class="op" id="7132025">(</span><span class="op" id="7132026">)</span><span class="op" id="7132027">,</span>&nbsp;<span class="op" id="7132029">[</span><span class="op" id="7132030">]</span><span class="builtintype" id="7132031">byte</span><span class="op" id="7132035">(</span><span class="string" id="7132036">&#34;PaxHeaders.&#34;</span><span class="op" id="7132049">)</span><span class="op" id="7132050">)</span>&nbsp;<span class="op" id="7132052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7132056">t</span><span class="op" id="7132057">.</span><span class="ident" id="7132058">Fatal</span><span class="op" id="7132063">(</span><span class="string" id="7132064">&#34;Expected&nbsp;at&nbsp;least&nbsp;one&nbsp;PAX&nbsp;header&nbsp;to&nbsp;be&nbsp;written.&#34;</span><span class="op" id="7132113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7132116">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7132119">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;a&nbsp;long&nbsp;name&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7132181">reader</span>&nbsp;<span class="op" id="7132188">:=</span>&nbsp;<span class="ident" id="7132191">NewReader</span><span class="op" id="7132200">(</span><span class="op" id="7132201">&amp;</span><span class="ident" id="7132202">buf</span><span class="op" id="7132205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7132208">hdr</span><span class="op" id="7132211">,</span>&nbsp;<span class="ident" id="7132213">err</span>&nbsp;<span class="op" id="7132217">=</span>&nbsp;<span class="ident" id="7132219">reader</span><span class="op" id="7132225">.</span><span class="ident" id="7132226">Next</span><span class="op" id="7132230">(</span><span class="op" id="7132231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7132234">if</span>&nbsp;<span class="ident" id="7132237">err</span>&nbsp;<span class="op" id="7132241">!=</span>&nbsp;<span class="ident" id="7132244">nil</span>&nbsp;<span class="op" id="7132248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7132252">t</span><span class="op" id="7132253">.</span><span class="ident" id="7132254">Fatal</span><span class="op" id="7132259">(</span><span class="ident" id="7132260">err</span><span class="op" id="7132263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7132266">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7132269">if</span>&nbsp;<span class="ident" id="7132272">hdr</span><span class="op" id="7132275">.</span><span class="ident" id="7132276">Name</span>&nbsp;<span class="op" id="7132281">!=</span>&nbsp;<span class="ident" id="7132284">longName</span>&nbsp;<span class="op" id="7132293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7132297">t</span><span class="op" id="7132298">.</span><span class="ident" id="7132299">Fatal</span><span class="op" id="7132304">(</span><span class="string" id="7132305">&#34;Couldn&#39;t&nbsp;recover&nbsp;long&nbsp;file&nbsp;name&#34;</span><span class="op" id="7132338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7132341">}</span><br>
<span class="lineno"></span><span class="op" id="7132343">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="keyword" id="7132346">func</span>&nbsp;<span class="ident" id="7132351">TestPaxSymlink</span><span class="op" id="7132365">(</span><span class="ident" id="7132366">t</span>&nbsp;<span class="op" id="7132368">*</span><span class="ident" id="7132369">testing</span><span class="op" id="7132376">.</span><span class="ident" id="7132377">T</span><span class="op" id="7132378">)</span>&nbsp;<span class="op" id="7132380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7132383">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;a&nbsp;large&nbsp;linkname</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7132427">fileinfo</span><span class="op" id="7132435">,</span>&nbsp;<span class="ident" id="7132437">err</span>&nbsp;<span class="op" id="7132441">:=</span>&nbsp;<span class="ident" id="7132444">os</span><span class="op" id="7132446">.</span><span class="ident" id="7132447">Stat</span><span class="op" id="7132451">(</span><span class="string" id="7132452">&#34;testdata/small.txt&#34;</span><span class="op" id="7132472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7132475">if</span>&nbsp;<span class="ident" id="7132478">err</span>&nbsp;<span class="op" id="7132482">!=</span>&nbsp;<span class="ident" id="7132485">nil</span>&nbsp;<span class="op" id="7132489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7132493">t</span><span class="op" id="7132494">.</span><span class="ident" id="7132495">Fatal</span><span class="op" id="7132500">(</span><span class="ident" id="7132501">err</span><span class="op" id="7132504">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7132507">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7132510">hdr</span><span class="op" id="7132513">,</span>&nbsp;<span class="ident" id="7132515">err</span>&nbsp;<span class="op" id="7132519">:=</span>&nbsp;<span class="ident" id="7132522">FileInfoHeader</span><span class="op" id="7132536">(</span><span class="ident" id="7132537">fileinfo</span><span class="op" id="7132545">,</span>&nbsp;<span class="string" id="7132547">&#34;&#34;</span><span class="op" id="7132549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7132552">hdr</span><span class="op" id="7132555">.</span><span class="ident" id="7132556">Typeflag</span>&nbsp;<span class="op" id="7132565">=</span>&nbsp;<span class="ident" id="7132567">TypeSymlink</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7132580">if</span>&nbsp;<span class="ident" id="7132583">err</span>&nbsp;<span class="op" id="7132587">!=</span>&nbsp;<span class="ident" id="7132590">nil</span>&nbsp;<span class="op" id="7132594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7132598">t</span><span class="op" id="7132599">.</span><span class="ident" id="7132600">Fatalf</span><span class="op" id="7132606">(</span><span class="string" id="7132607">&#34;os.Stat:1&nbsp;%v&#34;</span><span class="op" id="7132621">,</span>&nbsp;<span class="ident" id="7132623">err</span><span class="op" id="7132626">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7132629">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7132632">//&nbsp;Force&nbsp;a&nbsp;PAX&nbsp;long&nbsp;linkname&nbsp;to&nbsp;be&nbsp;written</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7132676">longLinkname</span>&nbsp;<span class="op" id="7132689">:=</span>&nbsp;<span class="ident" id="7132692">strings</span><span class="op" id="7132699">.</span><span class="ident" id="7132700">Repeat</span><span class="op" id="7132706">(</span><span class="string" id="7132707">&#34;1234567890/1234567890&#34;</span><span class="op" id="7132730">,</span>&nbsp;<span class="num" id="7132732">10</span><span class="op" id="7132734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7132737">hdr</span><span class="op" id="7132740">.</span><span class="ident" id="7132741">Linkname</span>&nbsp;<span class="op" id="7132750">=</span>&nbsp;<span class="ident" id="7132752">longLinkname</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7132767">hdr</span><span class="op" id="7132770">.</span><span class="ident" id="7132771">Size</span>&nbsp;<span class="op" id="7132776">=</span>&nbsp;<span class="num" id="7132778">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7132781">var</span>&nbsp;<span class="ident" id="7132785">buf</span>&nbsp;<span class="ident" id="7132789">bytes</span><span class="op" id="7132794">.</span><span class="ident" id="7132795">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7132803">writer</span>&nbsp;<span class="op" id="7132810">:=</span>&nbsp;<span class="ident" id="7132813">NewWriter</span><span class="op" id="7132822">(</span><span class="op" id="7132823">&amp;</span><span class="ident" id="7132824">buf</span><span class="op" id="7132827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7132830">if</span>&nbsp;<span class="ident" id="7132833">err</span>&nbsp;<span class="op" id="7132837">:=</span>&nbsp;<span class="ident" id="7132840">writer</span><span class="op" id="7132846">.</span><span class="ident" id="7132847">WriteHeader</span><span class="op" id="7132858">(</span><span class="ident" id="7132859">hdr</span><span class="op" id="7132862">)</span><span class="op" id="7132863">;</span>&nbsp;<span class="ident" id="7132865">err</span>&nbsp;<span class="op" id="7132869">!=</span>&nbsp;<span class="ident" id="7132872">nil</span>&nbsp;<span class="op" id="7132876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7132880">t</span><span class="op" id="7132881">.</span><span class="ident" id="7132882">Fatal</span><span class="op" id="7132887">(</span><span class="ident" id="7132888">err</span><span class="op" id="7132891">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7132894">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7132897">if</span>&nbsp;<span class="ident" id="7132900">err</span>&nbsp;<span class="op" id="7132904">:=</span>&nbsp;<span class="ident" id="7132907">writer</span><span class="op" id="7132913">.</span><span class="ident" id="7132914">Close</span><span class="op" id="7132919">(</span><span class="op" id="7132920">)</span><span class="op" id="7132921">;</span>&nbsp;<span class="ident" id="7132923">err</span>&nbsp;<span class="op" id="7132927">!=</span>&nbsp;<span class="ident" id="7132930">nil</span>&nbsp;<span class="op" id="7132934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7132938">t</span><span class="op" id="7132939">.</span><span class="ident" id="7132940">Fatal</span><span class="op" id="7132945">(</span><span class="ident" id="7132946">err</span><span class="op" id="7132949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7132952">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7132955">//&nbsp;Simple&nbsp;test&nbsp;to&nbsp;make&nbsp;sure&nbsp;PAX&nbsp;extensions&nbsp;are&nbsp;in&nbsp;effect</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7133013">if</span>&nbsp;<span class="op" id="7133016">!</span><span class="ident" id="7133017">bytes</span><span class="op" id="7133022">.</span><span class="ident" id="7133023">Contains</span><span class="op" id="7133031">(</span><span class="ident" id="7133032">buf</span><span class="op" id="7133035">.</span><span class="ident" id="7133036">Bytes</span><span class="op" id="7133041">(</span><span class="op" id="7133042">)</span><span class="op" id="7133043">,</span>&nbsp;<span class="op" id="7133045">[</span><span class="op" id="7133046">]</span><span class="builtintype" id="7133047">byte</span><span class="op" id="7133051">(</span><span class="string" id="7133052">&#34;PaxHeaders.&#34;</span><span class="op" id="7133065">)</span><span class="op" id="7133066">)</span>&nbsp;<span class="op" id="7133068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7133072">t</span><span class="op" id="7133073">.</span><span class="ident" id="7133074">Fatal</span><span class="op" id="7133079">(</span><span class="string" id="7133080">&#34;Expected&nbsp;at&nbsp;least&nbsp;one&nbsp;PAX&nbsp;header&nbsp;to&nbsp;be&nbsp;written.&#34;</span><span class="op" id="7133129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7133132">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7133135">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;a&nbsp;long&nbsp;name&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7133197">reader</span>&nbsp;<span class="op" id="7133204">:=</span>&nbsp;<span class="ident" id="7133207">NewReader</span><span class="op" id="7133216">(</span><span class="op" id="7133217">&amp;</span><span class="ident" id="7133218">buf</span><span class="op" id="7133221">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7133224">hdr</span><span class="op" id="7133227">,</span>&nbsp;<span class="ident" id="7133229">err</span>&nbsp;<span class="op" id="7133233">=</span>&nbsp;<span class="ident" id="7133235">reader</span><span class="op" id="7133241">.</span><span class="ident" id="7133242">Next</span><span class="op" id="7133246">(</span><span class="op" id="7133247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7133250">if</span>&nbsp;<span class="ident" id="7133253">err</span>&nbsp;<span class="op" id="7133257">!=</span>&nbsp;<span class="ident" id="7133260">nil</span>&nbsp;<span class="op" id="7133264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7133268">t</span><span class="op" id="7133269">.</span><span class="ident" id="7133270">Fatal</span><span class="op" id="7133275">(</span><span class="ident" id="7133276">err</span><span class="op" id="7133279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7133282">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7133285">if</span>&nbsp;<span class="ident" id="7133288">hdr</span><span class="op" id="7133291">.</span><span class="ident" id="7133292">Linkname</span>&nbsp;<span class="op" id="7133301">!=</span>&nbsp;<span class="ident" id="7133304">longLinkname</span>&nbsp;<span class="op" id="7133317">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7133321">t</span><span class="op" id="7133322">.</span><span class="ident" id="7133323">Fatal</span><span class="op" id="7133328">(</span><span class="string" id="7133329">&#34;Couldn&#39;t&nbsp;recover&nbsp;long&nbsp;link&nbsp;name&#34;</span><span class="op" id="7133362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7133365">}</span><br>
<span class="lineno"></span><span class="op" id="7133367">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7133370">func</span>&nbsp;<span class="ident" id="7133375">TestPaxNonAscii</span><span class="op" id="7133390">(</span><span class="ident" id="7133391">t</span>&nbsp;<span class="op" id="7133393">*</span><span class="ident" id="7133394">testing</span><span class="op" id="7133401">.</span><span class="ident" id="7133402">T</span><span class="op" id="7133403">)</span>&nbsp;<span class="op" id="7133405">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7133408">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;non&nbsp;ascii.&nbsp;These&nbsp;should&nbsp;trigger&nbsp;a&nbsp;pax&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7133480">//&nbsp;because&nbsp;pax&nbsp;headers&nbsp;have&nbsp;a&nbsp;defined&nbsp;utf-8&nbsp;encoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7133535">fileinfo</span><span class="op" id="7133543">,</span>&nbsp;<span class="ident" id="7133545">err</span>&nbsp;<span class="op" id="7133549">:=</span>&nbsp;<span class="ident" id="7133552">os</span><span class="op" id="7133554">.</span><span class="ident" id="7133555">Stat</span><span class="op" id="7133559">(</span><span class="string" id="7133560">&#34;testdata/small.txt&#34;</span><span class="op" id="7133580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7133583">if</span>&nbsp;<span class="ident" id="7133586">err</span>&nbsp;<span class="op" id="7133590">!=</span>&nbsp;<span class="ident" id="7133593">nil</span>&nbsp;<span class="op" id="7133597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7133601">t</span><span class="op" id="7133602">.</span><span class="ident" id="7133603">Fatal</span><span class="op" id="7133608">(</span><span class="ident" id="7133609">err</span><span class="op" id="7133612">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7133615">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7133619">hdr</span><span class="op" id="7133622">,</span>&nbsp;<span class="ident" id="7133624">err</span>&nbsp;<span class="op" id="7133628">:=</span>&nbsp;<span class="ident" id="7133631">FileInfoHeader</span><span class="op" id="7133645">(</span><span class="ident" id="7133646">fileinfo</span><span class="op" id="7133654">,</span>&nbsp;<span class="string" id="7133656">&#34;&#34;</span><span class="op" id="7133658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7133661">if</span>&nbsp;<span class="ident" id="7133664">err</span>&nbsp;<span class="op" id="7133668">!=</span>&nbsp;<span class="ident" id="7133671">nil</span>&nbsp;<span class="op" id="7133675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7133679">t</span><span class="op" id="7133680">.</span><span class="ident" id="7133681">Fatalf</span><span class="op" id="7133687">(</span><span class="string" id="7133688">&#34;os.Stat:1&nbsp;%v&#34;</span><span class="op" id="7133702">,</span>&nbsp;<span class="ident" id="7133704">err</span><span class="op" id="7133707">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7133710">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7133714">//&nbsp;some&nbsp;sample&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7133735">chineseFilename</span>&nbsp;<span class="op" id="7133751">:=</span>&nbsp;<span class="string" id="7133754">&#34;文件名&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7133767">chineseGroupname</span>&nbsp;<span class="op" id="7133784">:=</span>&nbsp;<span class="string" id="7133787">&#34;組&#34;</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7133794">chineseUsername</span>&nbsp;<span class="op" id="7133810">:=</span>&nbsp;<span class="string" id="7133813">&#34;用戶名&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7133827">hdr</span><span class="op" id="7133830">.</span><span class="ident" id="7133831">Name</span>&nbsp;<span class="op" id="7133836">=</span>&nbsp;<span class="ident" id="7133838">chineseFilename</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7133855">hdr</span><span class="op" id="7133858">.</span><span class="ident" id="7133859">Gname</span>&nbsp;<span class="op" id="7133865">=</span>&nbsp;<span class="ident" id="7133867">chineseGroupname</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7133885">hdr</span><span class="op" id="7133888">.</span><span class="ident" id="7133889">Uname</span>&nbsp;<span class="op" id="7133895">=</span>&nbsp;<span class="ident" id="7133897">chineseUsername</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7133915">contents</span>&nbsp;<span class="op" id="7133924">:=</span>&nbsp;<span class="ident" id="7133927">strings</span><span class="op" id="7133934">.</span><span class="ident" id="7133935">Repeat</span><span class="op" id="7133941">(</span><span class="string" id="7133942">&#34;&nbsp;&#34;</span><span class="op" id="7133945">,</span>&nbsp;<span class="builtintype" id="7133947">int</span><span class="op" id="7133950">(</span><span class="ident" id="7133951">hdr</span><span class="op" id="7133954">.</span><span class="ident" id="7133955">Size</span><span class="op" id="7133959">)</span><span class="op" id="7133960">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7133964">var</span>&nbsp;<span class="ident" id="7133968">buf</span>&nbsp;<span class="ident" id="7133972">bytes</span><span class="op" id="7133977">.</span><span class="ident" id="7133978">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7133986">writer</span>&nbsp;<span class="op" id="7133993">:=</span>&nbsp;<span class="ident" id="7133996">NewWriter</span><span class="op" id="7134005">(</span><span class="op" id="7134006">&amp;</span><span class="ident" id="7134007">buf</span><span class="op" id="7134010">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7134013">if</span>&nbsp;<span class="ident" id="7134016">err</span>&nbsp;<span class="op" id="7134020">:=</span>&nbsp;<span class="ident" id="7134023">writer</span><span class="op" id="7134029">.</span><span class="ident" id="7134030">WriteHeader</span><span class="op" id="7134041">(</span><span class="ident" id="7134042">hdr</span><span class="op" id="7134045">)</span><span class="op" id="7134046">;</span>&nbsp;<span class="ident" id="7134048">err</span>&nbsp;<span class="op" id="7134052">!=</span>&nbsp;<span class="ident" id="7134055">nil</span>&nbsp;<span class="op" id="7134059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7134063">t</span><span class="op" id="7134064">.</span><span class="ident" id="7134065">Fatal</span><span class="op" id="7134070">(</span><span class="ident" id="7134071">err</span><span class="op" id="7134074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7134077">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7134080">if</span>&nbsp;<span class="ident" id="7134083">_</span><span class="op" id="7134084">,</span>&nbsp;<span class="ident" id="7134086">err</span>&nbsp;<span class="op" id="7134090">=</span>&nbsp;<span class="ident" id="7134092">writer</span><span class="op" id="7134098">.</span><span class="ident" id="7134099">Write</span><span class="op" id="7134104">(</span><span class="op" id="7134105">[</span><span class="op" id="7134106">]</span><span class="builtintype" id="7134107">byte</span><span class="op" id="7134111">(</span><span class="ident" id="7134112">contents</span><span class="op" id="7134120">)</span><span class="op" id="7134121">)</span><span class="op" id="7134122">;</span>&nbsp;<span class="ident" id="7134124">err</span>&nbsp;<span class="op" id="7134128">!=</span>&nbsp;<span class="ident" id="7134131">nil</span>&nbsp;<span class="op" id="7134135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7134139">t</span><span class="op" id="7134140">.</span><span class="ident" id="7134141">Fatal</span><span class="op" id="7134146">(</span><span class="ident" id="7134147">err</span><span class="op" id="7134150">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7134153">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7134156">if</span>&nbsp;<span class="ident" id="7134159">err</span>&nbsp;<span class="op" id="7134163">:=</span>&nbsp;<span class="ident" id="7134166">writer</span><span class="op" id="7134172">.</span><span class="ident" id="7134173">Close</span><span class="op" id="7134178">(</span><span class="op" id="7134179">)</span><span class="op" id="7134180">;</span>&nbsp;<span class="ident" id="7134182">err</span>&nbsp;<span class="op" id="7134186">!=</span>&nbsp;<span class="ident" id="7134189">nil</span>&nbsp;<span class="op" id="7134193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7134197">t</span><span class="op" id="7134198">.</span><span class="ident" id="7134199">Fatal</span><span class="op" id="7134204">(</span><span class="ident" id="7134205">err</span><span class="op" id="7134208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7134211">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7134214">//&nbsp;Simple&nbsp;test&nbsp;to&nbsp;make&nbsp;sure&nbsp;PAX&nbsp;extensions&nbsp;are&nbsp;in&nbsp;effect</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7134272">if</span>&nbsp;<span class="op" id="7134275">!</span><span class="ident" id="7134276">bytes</span><span class="op" id="7134281">.</span><span class="ident" id="7134282">Contains</span><span class="op" id="7134290">(</span><span class="ident" id="7134291">buf</span><span class="op" id="7134294">.</span><span class="ident" id="7134295">Bytes</span><span class="op" id="7134300">(</span><span class="op" id="7134301">)</span><span class="op" id="7134302">,</span>&nbsp;<span class="op" id="7134304">[</span><span class="op" id="7134305">]</span><span class="builtintype" id="7134306">byte</span><span class="op" id="7134310">(</span><span class="string" id="7134311">&#34;PaxHeaders.&#34;</span><span class="op" id="7134324">)</span><span class="op" id="7134325">)</span>&nbsp;<span class="op" id="7134327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7134331">t</span><span class="op" id="7134332">.</span><span class="ident" id="7134333">Fatal</span><span class="op" id="7134338">(</span><span class="string" id="7134339">&#34;Expected&nbsp;at&nbsp;least&nbsp;one&nbsp;PAX&nbsp;header&nbsp;to&nbsp;be&nbsp;written.&#34;</span><span class="op" id="7134388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7134391">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7134394">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;a&nbsp;long&nbsp;name&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7134456">reader</span>&nbsp;<span class="op" id="7134463">:=</span>&nbsp;<span class="ident" id="7134466">NewReader</span><span class="op" id="7134475">(</span><span class="op" id="7134476">&amp;</span><span class="ident" id="7134477">buf</span><span class="op" id="7134480">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7134483">hdr</span><span class="op" id="7134486">,</span>&nbsp;<span class="ident" id="7134488">err</span>&nbsp;<span class="op" id="7134492">=</span>&nbsp;<span class="ident" id="7134494">reader</span><span class="op" id="7134500">.</span><span class="ident" id="7134501">Next</span><span class="op" id="7134505">(</span><span class="op" id="7134506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7134509">if</span>&nbsp;<span class="ident" id="7134512">err</span>&nbsp;<span class="op" id="7134516">!=</span>&nbsp;<span class="ident" id="7134519">nil</span>&nbsp;<span class="op" id="7134523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7134527">t</span><span class="op" id="7134528">.</span><span class="ident" id="7134529">Fatal</span><span class="op" id="7134534">(</span><span class="ident" id="7134535">err</span><span class="op" id="7134538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7134541">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7134544">if</span>&nbsp;<span class="ident" id="7134547">hdr</span><span class="op" id="7134550">.</span><span class="ident" id="7134551">Name</span>&nbsp;<span class="op" id="7134556">!=</span>&nbsp;<span class="ident" id="7134559">chineseFilename</span>&nbsp;<span class="op" id="7134575">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7134579">t</span><span class="op" id="7134580">.</span><span class="ident" id="7134581">Fatal</span><span class="op" id="7134586">(</span><span class="string" id="7134587">&#34;Couldn&#39;t&nbsp;recover&nbsp;unicode&nbsp;name&#34;</span><span class="op" id="7134618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7134621">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7134624">if</span>&nbsp;<span class="ident" id="7134627">hdr</span><span class="op" id="7134630">.</span><span class="ident" id="7134631">Gname</span>&nbsp;<span class="op" id="7134637">!=</span>&nbsp;<span class="ident" id="7134640">chineseGroupname</span>&nbsp;<span class="op" id="7134657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7134661">t</span><span class="op" id="7134662">.</span><span class="ident" id="7134663">Fatal</span><span class="op" id="7134668">(</span><span class="string" id="7134669">&#34;Couldn&#39;t&nbsp;recover&nbsp;unicode&nbsp;group&#34;</span><span class="op" id="7134701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7134704">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7134707">if</span>&nbsp;<span class="ident" id="7134710">hdr</span><span class="op" id="7134713">.</span><span class="ident" id="7134714">Uname</span>&nbsp;<span class="op" id="7134720">!=</span>&nbsp;<span class="ident" id="7134723">chineseUsername</span>&nbsp;<span class="op" id="7134739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7134743">t</span><span class="op" id="7134744">.</span><span class="ident" id="7134745">Fatal</span><span class="op" id="7134750">(</span><span class="string" id="7134751">&#34;Couldn&#39;t&nbsp;recover&nbsp;unicode&nbsp;user&#34;</span><span class="op" id="7134782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7134785">}</span><br>
<span class="lineno"></span><span class="op" id="7134787">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="keyword" id="7134790">func</span>&nbsp;<span class="ident" id="7134795">TestPaxXattrs</span><span class="op" id="7134808">(</span><span class="ident" id="7134809">t</span>&nbsp;<span class="op" id="7134811">*</span><span class="ident" id="7134812">testing</span><span class="op" id="7134819">.</span><span class="ident" id="7134820">T</span><span class="op" id="7134821">)</span>&nbsp;<span class="op" id="7134823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7134826">xattrs</span>&nbsp;<span class="op" id="7134833">:=</span>&nbsp;<span class="keyword" id="7134836">map</span><span class="op" id="7134839">[</span><span class="builtintype" id="7134840">string</span><span class="op" id="7134846">]</span><span class="builtintype" id="7134847">string</span><span class="op" id="7134853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7134857">&#34;user.key&#34;</span><span class="op" id="7134867">:</span>&nbsp;<span class="string" id="7134869">&#34;value&#34;</span><span class="op" id="7134876">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7134879">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7134883">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;an&nbsp;xattr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7134919">fileinfo</span><span class="op" id="7134927">,</span>&nbsp;<span class="ident" id="7134929">err</span>&nbsp;<span class="op" id="7134933">:=</span>&nbsp;<span class="ident" id="7134936">os</span><span class="op" id="7134938">.</span><span class="ident" id="7134939">Stat</span><span class="op" id="7134943">(</span><span class="string" id="7134944">&#34;testdata/small.txt&#34;</span><span class="op" id="7134964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7134967">if</span>&nbsp;<span class="ident" id="7134970">err</span>&nbsp;<span class="op" id="7134974">!=</span>&nbsp;<span class="ident" id="7134977">nil</span>&nbsp;<span class="op" id="7134981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7134985">t</span><span class="op" id="7134986">.</span><span class="ident" id="7134987">Fatal</span><span class="op" id="7134992">(</span><span class="ident" id="7134993">err</span><span class="op" id="7134996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7134999">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7135002">hdr</span><span class="op" id="7135005">,</span>&nbsp;<span class="ident" id="7135007">err</span>&nbsp;<span class="op" id="7135011">:=</span>&nbsp;<span class="ident" id="7135014">FileInfoHeader</span><span class="op" id="7135028">(</span><span class="ident" id="7135029">fileinfo</span><span class="op" id="7135037">,</span>&nbsp;<span class="string" id="7135039">&#34;&#34;</span><span class="op" id="7135041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7135044">if</span>&nbsp;<span class="ident" id="7135047">err</span>&nbsp;<span class="op" id="7135051">!=</span>&nbsp;<span class="ident" id="7135054">nil</span>&nbsp;<span class="op" id="7135058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7135062">t</span><span class="op" id="7135063">.</span><span class="ident" id="7135064">Fatalf</span><span class="op" id="7135070">(</span><span class="string" id="7135071">&#34;os.Stat:&nbsp;%v&#34;</span><span class="op" id="7135084">,</span>&nbsp;<span class="ident" id="7135086">err</span><span class="op" id="7135089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7135092">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7135095">contents</span>&nbsp;<span class="op" id="7135104">:=</span>&nbsp;<span class="string" id="7135107">&#34;Kilts&#34;</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7135116">hdr</span><span class="op" id="7135119">.</span><span class="ident" id="7135120">Xattrs</span>&nbsp;<span class="op" id="7135127">=</span>&nbsp;<span class="ident" id="7135129">xattrs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7135137">var</span>&nbsp;<span class="ident" id="7135141">buf</span>&nbsp;<span class="ident" id="7135145">bytes</span><span class="op" id="7135150">.</span><span class="ident" id="7135151">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7135159">writer</span>&nbsp;<span class="op" id="7135166">:=</span>&nbsp;<span class="ident" id="7135169">NewWriter</span><span class="op" id="7135178">(</span><span class="op" id="7135179">&amp;</span><span class="ident" id="7135180">buf</span><span class="op" id="7135183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7135186">if</span>&nbsp;<span class="ident" id="7135189">err</span>&nbsp;<span class="op" id="7135193">:=</span>&nbsp;<span class="ident" id="7135196">writer</span><span class="op" id="7135202">.</span><span class="ident" id="7135203">WriteHeader</span><span class="op" id="7135214">(</span><span class="ident" id="7135215">hdr</span><span class="op" id="7135218">)</span><span class="op" id="7135219">;</span>&nbsp;<span class="ident" id="7135221">err</span>&nbsp;<span class="op" id="7135225">!=</span>&nbsp;<span class="ident" id="7135228">nil</span>&nbsp;<span class="op" id="7135232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7135236">t</span><span class="op" id="7135237">.</span><span class="ident" id="7135238">Fatal</span><span class="op" id="7135243">(</span><span class="ident" id="7135244">err</span><span class="op" id="7135247">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7135250">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7135253">if</span>&nbsp;<span class="ident" id="7135256">_</span><span class="op" id="7135257">,</span>&nbsp;<span class="ident" id="7135259">err</span>&nbsp;<span class="op" id="7135263">=</span>&nbsp;<span class="ident" id="7135265">writer</span><span class="op" id="7135271">.</span><span class="ident" id="7135272">Write</span><span class="op" id="7135277">(</span><span class="op" id="7135278">[</span><span class="op" id="7135279">]</span><span class="builtintype" id="7135280">byte</span><span class="op" id="7135284">(</span><span class="ident" id="7135285">contents</span><span class="op" id="7135293">)</span><span class="op" id="7135294">)</span><span class="op" id="7135295">;</span>&nbsp;<span class="ident" id="7135297">err</span>&nbsp;<span class="op" id="7135301">!=</span>&nbsp;<span class="ident" id="7135304">nil</span>&nbsp;<span class="op" id="7135308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7135312">t</span><span class="op" id="7135313">.</span><span class="ident" id="7135314">Fatal</span><span class="op" id="7135319">(</span><span class="ident" id="7135320">err</span><span class="op" id="7135323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7135326">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7135329">if</span>&nbsp;<span class="ident" id="7135332">err</span>&nbsp;<span class="op" id="7135336">:=</span>&nbsp;<span class="ident" id="7135339">writer</span><span class="op" id="7135345">.</span><span class="ident" id="7135346">Close</span><span class="op" id="7135351">(</span><span class="op" id="7135352">)</span><span class="op" id="7135353">;</span>&nbsp;<span class="ident" id="7135355">err</span>&nbsp;<span class="op" id="7135359">!=</span>&nbsp;<span class="ident" id="7135362">nil</span>&nbsp;<span class="op" id="7135366">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7135370">t</span><span class="op" id="7135371">.</span><span class="ident" id="7135372">Fatal</span><span class="op" id="7135377">(</span><span class="ident" id="7135378">err</span><span class="op" id="7135381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7135384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7135387">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;the&nbsp;xattrs&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7135448">reader</span>&nbsp;<span class="op" id="7135455">:=</span>&nbsp;<span class="ident" id="7135458">NewReader</span><span class="op" id="7135467">(</span><span class="op" id="7135468">&amp;</span><span class="ident" id="7135469">buf</span><span class="op" id="7135472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7135475">hdr</span><span class="op" id="7135478">,</span>&nbsp;<span class="ident" id="7135480">err</span>&nbsp;<span class="op" id="7135484">=</span>&nbsp;<span class="ident" id="7135486">reader</span><span class="op" id="7135492">.</span><span class="ident" id="7135493">Next</span><span class="op" id="7135497">(</span><span class="op" id="7135498">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7135501">if</span>&nbsp;<span class="ident" id="7135504">err</span>&nbsp;<span class="op" id="7135508">!=</span>&nbsp;<span class="ident" id="7135511">nil</span>&nbsp;<span class="op" id="7135515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7135519">t</span><span class="op" id="7135520">.</span><span class="ident" id="7135521">Fatal</span><span class="op" id="7135526">(</span><span class="ident" id="7135527">err</span><span class="op" id="7135530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7135533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7135536">if</span>&nbsp;<span class="op" id="7135539">!</span><span class="ident" id="7135540">reflect</span><span class="op" id="7135547">.</span><span class="ident" id="7135548">DeepEqual</span><span class="op" id="7135557">(</span><span class="ident" id="7135558">hdr</span><span class="op" id="7135561">.</span><span class="ident" id="7135562">Xattrs</span><span class="op" id="7135568">,</span>&nbsp;<span class="ident" id="7135570">xattrs</span><span class="op" id="7135576">)</span>&nbsp;<span class="op" id="7135578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7135582">t</span><span class="op" id="7135583">.</span><span class="ident" id="7135584">Fatalf</span><span class="op" id="7135590">(</span><span class="string" id="7135591">&#34;xattrs&nbsp;did&nbsp;not&nbsp;survive&nbsp;round&nbsp;trip:&nbsp;got&nbsp;%+v,&nbsp;want&nbsp;%+v&#34;</span><span class="op" id="7135645">,</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7135650">hdr</span><span class="op" id="7135653">.</span><span class="ident" id="7135654">Xattrs</span><span class="op" id="7135660">,</span>&nbsp;<span class="ident" id="7135662">xattrs</span><span class="op" id="7135668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7135671">}</span><br>
<span class="lineno"></span><span class="op" id="7135673">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7135676">func</span>&nbsp;<span class="ident" id="7135681">TestPAXHeader</span><span class="op" id="7135694">(</span><span class="ident" id="7135695">t</span>&nbsp;<span class="op" id="7135697">*</span><span class="ident" id="7135698">testing</span><span class="op" id="7135705">.</span><span class="ident" id="7135706">T</span><span class="op" id="7135707">)</span>&nbsp;<span class="op" id="7135709">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7135712">medName</span>&nbsp;<span class="op" id="7135720">:=</span>&nbsp;<span class="ident" id="7135723">strings</span><span class="op" id="7135730">.</span><span class="ident" id="7135731">Repeat</span><span class="op" id="7135737">(</span><span class="string" id="7135738">&#34;CD&#34;</span><span class="op" id="7135742">,</span>&nbsp;<span class="num" id="7135744">50</span><span class="op" id="7135746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7135749">longName</span>&nbsp;<span class="op" id="7135758">:=</span>&nbsp;<span class="ident" id="7135761">strings</span><span class="op" id="7135768">.</span><span class="ident" id="7135769">Repeat</span><span class="op" id="7135775">(</span><span class="string" id="7135776">&#34;AB&#34;</span><span class="op" id="7135780">,</span>&nbsp;<span class="num" id="7135782">100</span><span class="op" id="7135785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7135788">paxTests</span>&nbsp;<span class="op" id="7135797">:=</span>&nbsp;<span class="op" id="7135800">[</span><span class="op" id="7135801">]</span><span class="op" id="7135802">[</span><span class="num" id="7135803">2</span><span class="op" id="7135804">]</span><span class="builtintype" id="7135805">string</span><span class="op" id="7135811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7135815">{</span><span class="ident" id="7135816">paxPath</span>&nbsp;<span class="op" id="7135824">+</span>&nbsp;<span class="string" id="7135826">&#34;=/etc/hosts&#34;</span><span class="op" id="7135839">,</span>&nbsp;<span class="string" id="7135841">&#34;19&nbsp;path=/etc/hosts\n&#34;</span><span class="op" id="7135863">}</span><span class="op" id="7135864">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7135868">{</span><span class="string" id="7135869">&#34;a=b&#34;</span><span class="op" id="7135874">,</span>&nbsp;<span class="string" id="7135876">&#34;6&nbsp;a=b\n&#34;</span><span class="op" id="7135885">}</span><span class="op" id="7135886">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7135897">//&nbsp;Single&nbsp;digit&nbsp;length</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7135922">{</span><span class="string" id="7135923">&#34;a=names&#34;</span><span class="op" id="7135932">,</span>&nbsp;<span class="string" id="7135934">&#34;11&nbsp;a=names\n&#34;</span><span class="op" id="7135948">}</span><span class="op" id="7135949">,</span>&nbsp;<span class="comment" id="7135951">//&nbsp;Test&nbsp;case&nbsp;involving&nbsp;carries</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7135984">{</span><span class="ident" id="7135985">paxPath</span>&nbsp;<span class="op" id="7135993">+</span>&nbsp;<span class="string" id="7135995">&#34;=&#34;</span>&nbsp;<span class="op" id="7135999">+</span>&nbsp;<span class="ident" id="7136001">longName</span><span class="op" id="7136009">,</span>&nbsp;<span class="ident" id="7136011">fmt</span><span class="op" id="7136014">.</span><span class="ident" id="7136015">Sprintf</span><span class="op" id="7136022">(</span><span class="string" id="7136023">&#34;210&nbsp;path=%s\n&#34;</span><span class="op" id="7136038">,</span>&nbsp;<span class="ident" id="7136040">longName</span><span class="op" id="7136048">)</span><span class="op" id="7136049">}</span><span class="op" id="7136050">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7136054">{</span><span class="ident" id="7136055">paxPath</span>&nbsp;<span class="op" id="7136063">+</span>&nbsp;<span class="string" id="7136065">&#34;=&#34;</span>&nbsp;<span class="op" id="7136069">+</span>&nbsp;<span class="ident" id="7136071">medName</span><span class="op" id="7136078">,</span>&nbsp;<span class="ident" id="7136080">fmt</span><span class="op" id="7136083">.</span><span class="ident" id="7136084">Sprintf</span><span class="op" id="7136091">(</span><span class="string" id="7136092">&#34;110&nbsp;path=%s\n&#34;</span><span class="op" id="7136107">,</span>&nbsp;<span class="ident" id="7136109">medName</span><span class="op" id="7136116">)</span><span class="op" id="7136117">}</span><span class="op" id="7136118">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7136122">for</span>&nbsp;<span class="ident" id="7136126">_</span><span class="op" id="7136127">,</span>&nbsp;<span class="ident" id="7136129">test</span>&nbsp;<span class="op" id="7136134">:=</span>&nbsp;<span class="keyword" id="7136137">range</span>&nbsp;<span class="ident" id="7136143">paxTests</span>&nbsp;<span class="op" id="7136152">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7136156">key</span><span class="op" id="7136159">,</span>&nbsp;<span class="ident" id="7136161">expected</span>&nbsp;<span class="op" id="7136170">:=</span>&nbsp;<span class="ident" id="7136173">test</span><span class="op" id="7136177">[</span><span class="num" id="7136178">0</span><span class="op" id="7136179">]</span><span class="op" id="7136180">,</span>&nbsp;<span class="ident" id="7136182">test</span><span class="op" id="7136186">[</span><span class="num" id="7136187">1</span><span class="op" id="7136188">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7136192">if</span>&nbsp;<span class="ident" id="7136195">result</span>&nbsp;<span class="op" id="7136202">:=</span>&nbsp;<span class="ident" id="7136205">paxHeader</span><span class="op" id="7136214">(</span><span class="ident" id="7136215">key</span><span class="op" id="7136218">)</span><span class="op" id="7136219">;</span>&nbsp;<span class="ident" id="7136221">result</span>&nbsp;<span class="op" id="7136228">!=</span>&nbsp;<span class="ident" id="7136231">expected</span>&nbsp;<span class="op" id="7136240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7136245">t</span><span class="op" id="7136246">.</span><span class="ident" id="7136247">Fatalf</span><span class="op" id="7136253">(</span><span class="string" id="7136254">&#34;paxHeader:&nbsp;got&nbsp;%s,&nbsp;expected&nbsp;%s&#34;</span><span class="op" id="7136286">,</span>&nbsp;<span class="ident" id="7136288">result</span><span class="op" id="7136294">,</span>&nbsp;<span class="ident" id="7136296">expected</span><span class="op" id="7136304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7136308">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7136311">}</span><br>
<span class="lineno">420</span><span class="op" id="7136313">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7136316">func</span>&nbsp;<span class="ident" id="7136321">TestUSTARLongName</span><span class="op" id="7136338">(</span><span class="ident" id="7136339">t</span>&nbsp;<span class="op" id="7136341">*</span><span class="ident" id="7136342">testing</span><span class="op" id="7136349">.</span><span class="ident" id="7136350">T</span><span class="op" id="7136351">)</span>&nbsp;<span class="op" id="7136353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7136356">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;a&nbsp;path&nbsp;that&nbsp;failed&nbsp;to&nbsp;split&nbsp;with&nbsp;USTAR&nbsp;extension&nbsp;in&nbsp;previous&nbsp;versions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7136454">fileinfo</span><span class="op" id="7136462">,</span>&nbsp;<span class="ident" id="7136464">err</span>&nbsp;<span class="op" id="7136468">:=</span>&nbsp;<span class="ident" id="7136471">os</span><span class="op" id="7136473">.</span><span class="ident" id="7136474">Stat</span><span class="op" id="7136478">(</span><span class="string" id="7136479">&#34;testdata/small.txt&#34;</span><span class="op" id="7136499">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7136502">if</span>&nbsp;<span class="ident" id="7136505">err</span>&nbsp;<span class="op" id="7136509">!=</span>&nbsp;<span class="ident" id="7136512">nil</span>&nbsp;<span class="op" id="7136516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7136520">t</span><span class="op" id="7136521">.</span><span class="ident" id="7136522">Fatal</span><span class="op" id="7136527">(</span><span class="ident" id="7136528">err</span><span class="op" id="7136531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7136534">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7136537">hdr</span><span class="op" id="7136540">,</span>&nbsp;<span class="ident" id="7136542">err</span>&nbsp;<span class="op" id="7136546">:=</span>&nbsp;<span class="ident" id="7136549">FileInfoHeader</span><span class="op" id="7136563">(</span><span class="ident" id="7136564">fileinfo</span><span class="op" id="7136572">,</span>&nbsp;<span class="string" id="7136574">&#34;&#34;</span><span class="op" id="7136576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7136579">hdr</span><span class="op" id="7136582">.</span><span class="ident" id="7136583">Typeflag</span>&nbsp;<span class="op" id="7136592">=</span>&nbsp;<span class="ident" id="7136594">TypeDir</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7136603">if</span>&nbsp;<span class="ident" id="7136606">err</span>&nbsp;<span class="op" id="7136610">!=</span>&nbsp;<span class="ident" id="7136613">nil</span>&nbsp;<span class="op" id="7136617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7136621">t</span><span class="op" id="7136622">.</span><span class="ident" id="7136623">Fatalf</span><span class="op" id="7136629">(</span><span class="string" id="7136630">&#34;os.Stat:1&nbsp;%v&#34;</span><span class="op" id="7136644">,</span>&nbsp;<span class="ident" id="7136646">err</span><span class="op" id="7136649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7136652">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7136655">//&nbsp;Force&nbsp;a&nbsp;PAX&nbsp;long&nbsp;name&nbsp;to&nbsp;be&nbsp;written.&nbsp;The&nbsp;name&nbsp;was&nbsp;taken&nbsp;from&nbsp;a&nbsp;practical&nbsp;example</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7136740">//&nbsp;that&nbsp;fails&nbsp;and&nbsp;replaced&nbsp;ever&nbsp;char&nbsp;through&nbsp;numbers&nbsp;to&nbsp;anonymize&nbsp;the&nbsp;sample.</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7136819">longName</span>&nbsp;<span class="op" id="7136828">:=</span>&nbsp;<span class="string" id="7136831">&#34;/0000_0000000/00000-000000000/0000_0000000/00000-0000000000000/0000_0000000/00000-0000000-00000000/0000_0000000/00000000/0000_0000000/000/0000_0000000/00000000v00/0000_0000000/000000/0000_0000000/0000000/0000_0000000/00000y-00/0000/0000/00000000/0x000000/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7137090">hdr</span><span class="op" id="7137093">.</span><span class="ident" id="7137094">Name</span>&nbsp;<span class="op" id="7137099">=</span>&nbsp;<span class="ident" id="7137101">longName</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7137112">hdr</span><span class="op" id="7137115">.</span><span class="ident" id="7137116">Size</span>&nbsp;<span class="op" id="7137121">=</span>&nbsp;<span class="num" id="7137123">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7137126">var</span>&nbsp;<span class="ident" id="7137130">buf</span>&nbsp;<span class="ident" id="7137134">bytes</span><span class="op" id="7137139">.</span><span class="ident" id="7137140">Buffer</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7137148">writer</span>&nbsp;<span class="op" id="7137155">:=</span>&nbsp;<span class="ident" id="7137158">NewWriter</span><span class="op" id="7137167">(</span><span class="op" id="7137168">&amp;</span><span class="ident" id="7137169">buf</span><span class="op" id="7137172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7137175">if</span>&nbsp;<span class="ident" id="7137178">err</span>&nbsp;<span class="op" id="7137182">:=</span>&nbsp;<span class="ident" id="7137185">writer</span><span class="op" id="7137191">.</span><span class="ident" id="7137192">WriteHeader</span><span class="op" id="7137203">(</span><span class="ident" id="7137204">hdr</span><span class="op" id="7137207">)</span><span class="op" id="7137208">;</span>&nbsp;<span class="ident" id="7137210">err</span>&nbsp;<span class="op" id="7137214">!=</span>&nbsp;<span class="ident" id="7137217">nil</span>&nbsp;<span class="op" id="7137221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7137225">t</span><span class="op" id="7137226">.</span><span class="ident" id="7137227">Fatal</span><span class="op" id="7137232">(</span><span class="ident" id="7137233">err</span><span class="op" id="7137236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7137239">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7137242">if</span>&nbsp;<span class="ident" id="7137245">err</span>&nbsp;<span class="op" id="7137249">:=</span>&nbsp;<span class="ident" id="7137252">writer</span><span class="op" id="7137258">.</span><span class="ident" id="7137259">Close</span><span class="op" id="7137264">(</span><span class="op" id="7137265">)</span><span class="op" id="7137266">;</span>&nbsp;<span class="ident" id="7137268">err</span>&nbsp;<span class="op" id="7137272">!=</span>&nbsp;<span class="ident" id="7137275">nil</span>&nbsp;<span class="op" id="7137279">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7137283">t</span><span class="op" id="7137284">.</span><span class="ident" id="7137285">Fatal</span><span class="op" id="7137290">(</span><span class="ident" id="7137291">err</span><span class="op" id="7137294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7137297">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7137300">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;a&nbsp;long&nbsp;name&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7137362">reader</span>&nbsp;<span class="op" id="7137369">:=</span>&nbsp;<span class="ident" id="7137372">NewReader</span><span class="op" id="7137381">(</span><span class="op" id="7137382">&amp;</span><span class="ident" id="7137383">buf</span><span class="op" id="7137386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7137389">hdr</span><span class="op" id="7137392">,</span>&nbsp;<span class="ident" id="7137394">err</span>&nbsp;<span class="op" id="7137398">=</span>&nbsp;<span class="ident" id="7137400">reader</span><span class="op" id="7137406">.</span><span class="ident" id="7137407">Next</span><span class="op" id="7137411">(</span><span class="op" id="7137412">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7137415">if</span>&nbsp;<span class="ident" id="7137418">err</span>&nbsp;<span class="op" id="7137422">!=</span>&nbsp;<span class="ident" id="7137425">nil</span>&nbsp;<span class="op" id="7137429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7137433">t</span><span class="op" id="7137434">.</span><span class="ident" id="7137435">Fatal</span><span class="op" id="7137440">(</span><span class="ident" id="7137441">err</span><span class="op" id="7137444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7137447">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7137450">if</span>&nbsp;<span class="ident" id="7137453">hdr</span><span class="op" id="7137456">.</span><span class="ident" id="7137457">Name</span>&nbsp;<span class="op" id="7137462">!=</span>&nbsp;<span class="ident" id="7137465">longName</span>&nbsp;<span class="op" id="7137474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7137478">t</span><span class="op" id="7137479">.</span><span class="ident" id="7137480">Fatal</span><span class="op" id="7137485">(</span><span class="string" id="7137486">&#34;Couldn&#39;t&nbsp;recover&nbsp;long&nbsp;name&#34;</span><span class="op" id="7137514">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7137517">}</span><br>
<span class="lineno"></span><span class="op" id="7137519">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7137522">func</span>&nbsp;<span class="ident" id="7137527">TestValidTypeflagWithPAXHeader</span><span class="op" id="7137557">(</span><span class="ident" id="7137558">t</span>&nbsp;<span class="op" id="7137560">*</span><span class="ident" id="7137561">testing</span><span class="op" id="7137568">.</span><span class="ident" id="7137569">T</span><span class="op" id="7137570">)</span>&nbsp;<span class="op" id="7137572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7137575">var</span>&nbsp;<span class="ident" id="7137579">buffer</span>&nbsp;<span class="ident" id="7137586">bytes</span><span class="op" id="7137591">.</span><span class="ident" id="7137592">Buffer</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7137600">tw</span>&nbsp;<span class="op" id="7137603">:=</span>&nbsp;<span class="ident" id="7137606">NewWriter</span><span class="op" id="7137615">(</span><span class="op" id="7137616">&amp;</span><span class="ident" id="7137617">buffer</span><span class="op" id="7137623">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7137627">fileName</span>&nbsp;<span class="op" id="7137636">:=</span>&nbsp;<span class="ident" id="7137639">strings</span><span class="op" id="7137646">.</span><span class="ident" id="7137647">Repeat</span><span class="op" id="7137653">(</span><span class="string" id="7137654">&#34;ab&#34;</span><span class="op" id="7137658">,</span>&nbsp;<span class="num" id="7137660">100</span><span class="op" id="7137663">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7137667">hdr</span>&nbsp;<span class="op" id="7137671">:=</span>&nbsp;<span class="op" id="7137674">&amp;</span><span class="ident" id="7137675">Header</span><span class="op" id="7137681">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7137685">Name</span><span class="op" id="7137689">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7137695">fileName</span><span class="op" id="7137703">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7137707">Size</span><span class="op" id="7137711">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7137717">4</span><span class="op" id="7137718">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7137722">Typeflag</span><span class="op" id="7137730">:</span>&nbsp;<span class="num" id="7137732">0</span><span class="op" id="7137733">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7137736">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7137739">if</span>&nbsp;<span class="ident" id="7137742">err</span>&nbsp;<span class="op" id="7137746">:=</span>&nbsp;<span class="ident" id="7137749">tw</span><span class="op" id="7137751">.</span><span class="ident" id="7137752">WriteHeader</span><span class="op" id="7137763">(</span><span class="ident" id="7137764">hdr</span><span class="op" id="7137767">)</span><span class="op" id="7137768">;</span>&nbsp;<span class="ident" id="7137770">err</span>&nbsp;<span class="op" id="7137774">!=</span>&nbsp;<span class="ident" id="7137777">nil</span>&nbsp;<span class="op" id="7137781">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7137785">t</span><span class="op" id="7137786">.</span><span class="ident" id="7137787">Fatalf</span><span class="op" id="7137793">(</span><span class="string" id="7137794">&#34;Failed&nbsp;to&nbsp;write&nbsp;header:&nbsp;%s&#34;</span><span class="op" id="7137822">,</span>&nbsp;<span class="ident" id="7137824">err</span><span class="op" id="7137827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7137830">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7137833">if</span>&nbsp;<span class="ident" id="7137836">_</span><span class="op" id="7137837">,</span>&nbsp;<span class="ident" id="7137839">err</span>&nbsp;<span class="op" id="7137843">:=</span>&nbsp;<span class="ident" id="7137846">tw</span><span class="op" id="7137848">.</span><span class="ident" id="7137849">Write</span><span class="op" id="7137854">(</span><span class="op" id="7137855">[</span><span class="op" id="7137856">]</span><span class="builtintype" id="7137857">byte</span><span class="op" id="7137861">(</span><span class="string" id="7137862">&#34;fooo&#34;</span><span class="op" id="7137868">)</span><span class="op" id="7137869">)</span><span class="op" id="7137870">;</span>&nbsp;<span class="ident" id="7137872">err</span>&nbsp;<span class="op" id="7137876">!=</span>&nbsp;<span class="ident" id="7137879">nil</span>&nbsp;<span class="op" id="7137883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7137887">t</span><span class="op" id="7137888">.</span><span class="ident" id="7137889">Fatalf</span><span class="op" id="7137895">(</span><span class="string" id="7137896">&#34;Failed&nbsp;to&nbsp;write&nbsp;the&nbsp;file&#39;s&nbsp;data:&nbsp;%s&#34;</span><span class="op" id="7137933">,</span>&nbsp;<span class="ident" id="7137935">err</span><span class="op" id="7137938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7137941">}</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7137944">tw</span><span class="op" id="7137946">.</span><span class="ident" id="7137947">Close</span><span class="op" id="7137952">(</span><span class="op" id="7137953">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7137957">tr</span>&nbsp;<span class="op" id="7137960">:=</span>&nbsp;<span class="ident" id="7137963">NewReader</span><span class="op" id="7137972">(</span><span class="op" id="7137973">&amp;</span><span class="ident" id="7137974">buffer</span><span class="op" id="7137980">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7137984">for</span>&nbsp;<span class="op" id="7137988">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7137992">header</span><span class="op" id="7137998">,</span>&nbsp;<span class="ident" id="7138000">err</span>&nbsp;<span class="op" id="7138004">:=</span>&nbsp;<span class="ident" id="7138007">tr</span><span class="op" id="7138009">.</span><span class="ident" id="7138010">Next</span><span class="op" id="7138014">(</span><span class="op" id="7138015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7138019">if</span>&nbsp;<span class="ident" id="7138022">err</span>&nbsp;<span class="op" id="7138026">==</span>&nbsp;<span class="ident" id="7138029">io</span><span class="op" id="7138031">.</span><span class="ident" id="7138032">EOF</span>&nbsp;<span class="op" id="7138036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7138041">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7138049">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7138053">if</span>&nbsp;<span class="ident" id="7138056">err</span>&nbsp;<span class="op" id="7138060">!=</span>&nbsp;<span class="ident" id="7138063">nil</span>&nbsp;<span class="op" id="7138067">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7138072">t</span><span class="op" id="7138073">.</span><span class="ident" id="7138074">Fatalf</span><span class="op" id="7138080">(</span><span class="string" id="7138081">&#34;Failed&nbsp;to&nbsp;read&nbsp;header:&nbsp;%s&#34;</span><span class="op" id="7138108">,</span>&nbsp;<span class="ident" id="7138110">err</span><span class="op" id="7138113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7138117">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7138121">if</span>&nbsp;<span class="ident" id="7138124">header</span><span class="op" id="7138130">.</span><span class="ident" id="7138131">Typeflag</span>&nbsp;<span class="op" id="7138140">!=</span>&nbsp;<span class="num" id="7138143">0</span>&nbsp;<span class="op" id="7138145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7138150">t</span><span class="op" id="7138151">.</span><span class="ident" id="7138152">Fatalf</span><span class="op" id="7138158">(</span><span class="string" id="7138159">&#34;Typeflag&nbsp;should&#39;ve&nbsp;been&nbsp;0,&nbsp;found&nbsp;%d&#34;</span><span class="op" id="7138196">,</span>&nbsp;<span class="ident" id="7138198">header</span><span class="op" id="7138204">.</span><span class="ident" id="7138205">Typeflag</span><span class="op" id="7138213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7138217">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7138220">}</span><br>
<span class="lineno"></span><span class="op" id="7138222">}</span>
</div>
</body>
</html>
