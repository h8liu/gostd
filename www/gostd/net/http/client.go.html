<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http</h2>
<ul>
<li><a href="/gostd/net/http/client.go.html" class="current">client.go</a></li>
<li><a href="/gostd/net/http/client_test.go.html">client_test.go</a></li>
<li><a href="/gostd/net/http/cookie.go.html">cookie.go</a></li>
<li><a href="/gostd/net/http/cookie_test.go.html">cookie_test.go</a></li>
<li><a href="/gostd/net/http/doc.go.html">doc.go</a></li>
<li><a href="/gostd/net/http/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/http/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/net/http/filetransport.go.html">filetransport.go</a></li>
<li><a href="/gostd/net/http/filetransport_test.go.html">filetransport_test.go</a></li>
<li><a href="/gostd/net/http/fs.go.html">fs.go</a></li>
<li><a href="/gostd/net/http/fs_test.go.html">fs_test.go</a></li>
<li><a href="/gostd/net/http/header.go.html">header.go</a></li>
<li><a href="/gostd/net/http/header_test.go.html">header_test.go</a></li>
<li><a href="/gostd/net/http/jar.go.html">jar.go</a></li>
<li><a href="/gostd/net/http/lex.go.html">lex.go</a></li>
<li><a href="/gostd/net/http/lex_test.go.html">lex_test.go</a></li>
<li><a href="/gostd/net/http/main_test.go.html">main_test.go</a></li>
<li><a href="/gostd/net/http/npn_test.go.html">npn_test.go</a></li>
<li><a href="/gostd/net/http/proxy_test.go.html">proxy_test.go</a></li>
<li><a href="/gostd/net/http/range_test.go.html">range_test.go</a></li>
<li><a href="/gostd/net/http/readrequest_test.go.html">readrequest_test.go</a></li>
<li><a href="/gostd/net/http/request.go.html">request.go</a></li>
<li><a href="/gostd/net/http/request_test.go.html">request_test.go</a></li>
<li><a href="/gostd/net/http/requestwrite_test.go.html">requestwrite_test.go</a></li>
<li><a href="/gostd/net/http/response.go.html">response.go</a></li>
<li><a href="/gostd/net/http/response_test.go.html">response_test.go</a></li>
<li><a href="/gostd/net/http/responsewrite_test.go.html">responsewrite_test.go</a></li>
<li><a href="/gostd/net/http/serve_test.go.html">serve_test.go</a></li>
<li><a href="/gostd/net/http/server.go.html">server.go</a></li>
<li><a href="/gostd/net/http/sniff.go.html">sniff.go</a></li>
<li><a href="/gostd/net/http/sniff_test.go.html">sniff_test.go</a></li>
<li><a href="/gostd/net/http/status.go.html">status.go</a></li>
<li><a href="/gostd/net/http/transfer.go.html">transfer.go</a></li>
<li><a href="/gostd/net/http/transfer_test.go.html">transfer_test.go</a></li>
<li><a href="/gostd/net/http/transport.go.html">transport.go</a></li>
<li><a href="/gostd/net/http/transport_test.go.html">transport_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4041748">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4041803">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4041857">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4041908">//&nbsp;HTTP&nbsp;client.&nbsp;See&nbsp;RFC&nbsp;2616.</span><br>
<span class="lineno"></span><span class="comment" id="4041938">//</span><br>
<span class="lineno"></span><span class="comment" id="4041941">//&nbsp;This&nbsp;is&nbsp;the&nbsp;high-level&nbsp;Client&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment" id="4041985">//&nbsp;The&nbsp;low-level&nbsp;implementation&nbsp;is&nbsp;in&nbsp;transport.go.</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="4042038">package</span>&nbsp;<span class="ident" id="4042046">http</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4042052">import</span>&nbsp;<span class="op" id="4042059">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4042062">&#34;encoding/base64&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4042081">&#34;errors&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4042091">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4042098">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4042104">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4042117">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4042124">&#34;net/url&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4042135">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4042146">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4042154">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="4042161">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="4042164">//&nbsp;A&nbsp;Client&nbsp;is&nbsp;an&nbsp;HTTP&nbsp;client.&nbsp;Its&nbsp;zero&nbsp;value&nbsp;(DefaultClient)&nbsp;is&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4042231">//&nbsp;usable&nbsp;client&nbsp;that&nbsp;uses&nbsp;DefaultTransport.</span><br>
<span class="lineno"></span><span class="comment" id="4042276">//</span><br>
<span class="lineno"></span><span class="comment" id="4042279">//&nbsp;The&nbsp;Client&#39;s&nbsp;Transport&nbsp;typically&nbsp;has&nbsp;internal&nbsp;state&nbsp;(cached&nbsp;TCP</span><br>
<span class="lineno"></span><span class="comment" id="4042346">//&nbsp;connections),&nbsp;so&nbsp;Clients&nbsp;should&nbsp;be&nbsp;reused&nbsp;instead&nbsp;of&nbsp;created&nbsp;as</span><br>
<span class="lineno">30</span><span class="comment" id="4042413">//&nbsp;needed.&nbsp;Clients&nbsp;are&nbsp;safe&nbsp;for&nbsp;concurrent&nbsp;use&nbsp;by&nbsp;multiple&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="comment" id="4042484">//</span><br>
<span class="lineno"></span><span class="comment" id="4042487">//&nbsp;A&nbsp;Client&nbsp;is&nbsp;higher-level&nbsp;than&nbsp;a&nbsp;RoundTripper&nbsp;(such&nbsp;as&nbsp;Transport)</span><br>
<span class="lineno"></span><span class="comment" id="4042555">//&nbsp;and&nbsp;additionally&nbsp;handles&nbsp;HTTP&nbsp;details&nbsp;such&nbsp;as&nbsp;cookies&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4042616">//&nbsp;redirects.</span><br>
<span class="lineno">35</span><span class="keyword" id="4042630">type</span>&nbsp;<span class="ident" id="4042635">Client</span>&nbsp;<span class="keyword" id="4042642">struct</span>&nbsp;<span class="op" id="4042649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4042652">//&nbsp;Transport&nbsp;specifies&nbsp;the&nbsp;mechanism&nbsp;by&nbsp;which&nbsp;individual</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4042710">//&nbsp;HTTP&nbsp;requests&nbsp;are&nbsp;made.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4042738">//&nbsp;If&nbsp;nil,&nbsp;DefaultTransport&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4042776">Transport</span>&nbsp;<span class="ident" id="4042786">RoundTripper</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4042801">//&nbsp;CheckRedirect&nbsp;specifies&nbsp;the&nbsp;policy&nbsp;for&nbsp;handling&nbsp;redirects.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4042864">//&nbsp;If&nbsp;CheckRedirect&nbsp;is&nbsp;not&nbsp;nil,&nbsp;the&nbsp;client&nbsp;calls&nbsp;it&nbsp;before</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4042924">//&nbsp;following&nbsp;an&nbsp;HTTP&nbsp;redirect.&nbsp;The&nbsp;arguments&nbsp;req&nbsp;and&nbsp;via&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4042986">//&nbsp;the&nbsp;upcoming&nbsp;request&nbsp;and&nbsp;the&nbsp;requests&nbsp;made&nbsp;already,&nbsp;oldest</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4043049">//&nbsp;first.&nbsp;If&nbsp;CheckRedirect&nbsp;returns&nbsp;an&nbsp;error,&nbsp;the&nbsp;Client&#39;s&nbsp;Get</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4043112">//&nbsp;method&nbsp;returns&nbsp;both&nbsp;the&nbsp;previous&nbsp;Response&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4043162">//&nbsp;CheckRedirect&#39;s&nbsp;error&nbsp;(wrapped&nbsp;in&nbsp;a&nbsp;url.Error)&nbsp;instead&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4043224">//&nbsp;issuing&nbsp;the&nbsp;Request&nbsp;req.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4043253">//</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4043257">//&nbsp;If&nbsp;CheckRedirect&nbsp;is&nbsp;nil,&nbsp;the&nbsp;Client&nbsp;uses&nbsp;its&nbsp;default&nbsp;policy,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4043322">//&nbsp;which&nbsp;is&nbsp;to&nbsp;stop&nbsp;after&nbsp;10&nbsp;consecutive&nbsp;requests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4043374">CheckRedirect</span>&nbsp;<span class="keyword" id="4043388">func</span><span class="op" id="4043392">(</span><span class="ident" id="4043393">req</span>&nbsp;<span class="op" id="4043397">*</span><span class="ident" id="4043398">Request</span><span class="op" id="4043405">,</span>&nbsp;<span class="ident" id="4043407">via</span>&nbsp;<span class="op" id="4043411">[</span><span class="op" id="4043412">]</span><span class="op" id="4043413">*</span><span class="ident" id="4043414">Request</span><span class="op" id="4043421">)</span>&nbsp;<span class="builtintype" id="4043423">error</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4043431">//&nbsp;Jar&nbsp;specifies&nbsp;the&nbsp;cookie&nbsp;jar.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4043465">//&nbsp;If&nbsp;Jar&nbsp;is&nbsp;nil,&nbsp;cookies&nbsp;are&nbsp;not&nbsp;sent&nbsp;in&nbsp;requests&nbsp;and&nbsp;ignored</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4043529">//&nbsp;in&nbsp;responses.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4043547">Jar</span>&nbsp;<span class="ident" id="4043551">CookieJar</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4043563">//&nbsp;Timeout&nbsp;specifies&nbsp;a&nbsp;time&nbsp;limit&nbsp;for&nbsp;requests&nbsp;made&nbsp;by&nbsp;this</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4043624">//&nbsp;Client.&nbsp;The&nbsp;timeout&nbsp;includes&nbsp;connection&nbsp;time,&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4043678">//&nbsp;redirects,&nbsp;and&nbsp;reading&nbsp;the&nbsp;response&nbsp;body.&nbsp;The&nbsp;timer&nbsp;remains</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4043742">//&nbsp;running&nbsp;after&nbsp;Get,&nbsp;Head,&nbsp;Post,&nbsp;or&nbsp;Do&nbsp;return&nbsp;and&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4043799">//&nbsp;interrupt&nbsp;reading&nbsp;of&nbsp;the&nbsp;Response.Body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4043843">//</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4043847">//&nbsp;A&nbsp;Timeout&nbsp;of&nbsp;zero&nbsp;means&nbsp;no&nbsp;timeout.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4043887">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4043891">//&nbsp;The&nbsp;Client&#39;s&nbsp;Transport&nbsp;must&nbsp;support&nbsp;the&nbsp;CancelRequest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4043949">//&nbsp;method&nbsp;or&nbsp;Client&nbsp;will&nbsp;return&nbsp;errors&nbsp;when&nbsp;attempting&nbsp;to&nbsp;make</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4044013">//&nbsp;a&nbsp;request&nbsp;with&nbsp;Get,&nbsp;Head,&nbsp;Post,&nbsp;or&nbsp;Do.&nbsp;Client&#39;s&nbsp;default</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4044073">//&nbsp;Transport&nbsp;(DefaultTransport)&nbsp;supports&nbsp;CancelRequest.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4044130">Timeout</span>&nbsp;<span class="ident" id="4044138">time</span><span class="op" id="4044142">.</span><span class="ident" id="4044143">Duration</span><br>
<span class="lineno"></span><span class="op" id="4044152">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4044155">//&nbsp;DefaultClient&nbsp;is&nbsp;the&nbsp;default&nbsp;Client&nbsp;and&nbsp;is&nbsp;used&nbsp;by&nbsp;Get,&nbsp;Head,&nbsp;and&nbsp;Post.</span><br>
<span class="lineno">75</span><span class="keyword" id="4044230">var</span>&nbsp;<span class="ident" id="4044234">DefaultClient</span>&nbsp;<span class="op" id="4044248">=</span>&nbsp;<span class="op" id="4044250">&amp;</span><span class="ident" id="4044251">Client</span><span class="op" id="4044257">{</span><span class="op" id="4044258">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4044261">//&nbsp;RoundTripper&nbsp;is&nbsp;an&nbsp;interface&nbsp;representing&nbsp;the&nbsp;ability&nbsp;to&nbsp;execute&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4044331">//&nbsp;single&nbsp;HTTP&nbsp;transaction,&nbsp;obtaining&nbsp;the&nbsp;Response&nbsp;for&nbsp;a&nbsp;given&nbsp;Request.</span><br>
<span class="lineno"></span><span class="comment" id="4044403">//</span><br>
<span class="lineno">80</span><span class="comment" id="4044406">//&nbsp;A&nbsp;RoundTripper&nbsp;must&nbsp;be&nbsp;safe&nbsp;for&nbsp;concurrent&nbsp;use&nbsp;by&nbsp;multiple</span><br>
<span class="lineno"></span><span class="comment" id="4044468">//&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="keyword" id="4044483">type</span>&nbsp;<span class="ident" id="4044488">RoundTripper</span>&nbsp;<span class="keyword" id="4044501">interface</span>&nbsp;<span class="op" id="4044511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4044514">//&nbsp;RoundTrip&nbsp;executes&nbsp;a&nbsp;single&nbsp;HTTP&nbsp;transaction,&nbsp;returning</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4044574">//&nbsp;the&nbsp;Response&nbsp;for&nbsp;the&nbsp;request&nbsp;req.&nbsp;&nbsp;RoundTrip&nbsp;should&nbsp;not</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4044634">//&nbsp;attempt&nbsp;to&nbsp;interpret&nbsp;the&nbsp;response.&nbsp;&nbsp;In&nbsp;particular,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4044689">//&nbsp;RoundTrip&nbsp;must&nbsp;return&nbsp;err&nbsp;==&nbsp;nil&nbsp;if&nbsp;it&nbsp;obtained&nbsp;a&nbsp;response,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4044753">//&nbsp;regardless&nbsp;of&nbsp;the&nbsp;response&#39;s&nbsp;HTTP&nbsp;status&nbsp;code.&nbsp;&nbsp;A&nbsp;non-nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4044815">//&nbsp;err&nbsp;should&nbsp;be&nbsp;reserved&nbsp;for&nbsp;failure&nbsp;to&nbsp;obtain&nbsp;a&nbsp;response.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4044876">//&nbsp;Similarly,&nbsp;RoundTrip&nbsp;should&nbsp;not&nbsp;attempt&nbsp;to&nbsp;handle</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4044930">//&nbsp;higher-level&nbsp;protocol&nbsp;details&nbsp;such&nbsp;as&nbsp;redirects,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4044983">//&nbsp;authentication,&nbsp;or&nbsp;cookies.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4045015">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4045019">//&nbsp;RoundTrip&nbsp;should&nbsp;not&nbsp;modify&nbsp;the&nbsp;request,&nbsp;except&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4045075">//&nbsp;consuming&nbsp;and&nbsp;closing&nbsp;the&nbsp;Body,&nbsp;including&nbsp;on&nbsp;errors.&nbsp;The</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4045136">//&nbsp;request&#39;s&nbsp;URL&nbsp;and&nbsp;Header&nbsp;fields&nbsp;are&nbsp;guaranteed&nbsp;to&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4045193">//&nbsp;initialized.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4045210">RoundTrip</span><span class="op" id="4045219">(</span><span class="op" id="4045220">*</span><span class="ident" id="4045221">Request</span><span class="op" id="4045228">)</span>&nbsp;<span class="op" id="4045230">(</span><span class="op" id="4045231">*</span><span class="ident" id="4045232">Response</span><span class="op" id="4045240">,</span>&nbsp;<span class="builtintype" id="4045242">error</span><span class="op" id="4045247">)</span><br>
<span class="lineno"></span><span class="op" id="4045249">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="4045252">//&nbsp;Given&nbsp;a&nbsp;string&nbsp;of&nbsp;the&nbsp;form&nbsp;&#34;host&#34;,&nbsp;&#34;host:port&#34;,&nbsp;or&nbsp;&#34;[ipv6::address]:port&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="4045330">//&nbsp;return&nbsp;true&nbsp;if&nbsp;the&nbsp;string&nbsp;includes&nbsp;a&nbsp;port.</span><br>
<span class="lineno"></span><span class="keyword" id="4045376">func</span>&nbsp;<span class="ident" id="4045381">hasPort</span><span class="op" id="4045388">(</span><span class="ident" id="4045389">s</span>&nbsp;<span class="builtintype" id="4045391">string</span><span class="op" id="4045397">)</span>&nbsp;<span class="builtintype" id="4045399">bool</span>&nbsp;<span class="op" id="4045404">{</span>&nbsp;<span class="keyword" id="4045406">return</span>&nbsp;<span class="ident" id="4045413">strings</span><span class="op" id="4045420">.</span><span class="ident" id="4045421">LastIndex</span><span class="op" id="4045430">(</span><span class="ident" id="4045431">s</span><span class="op" id="4045432">,</span>&nbsp;<span class="string" id="4045434">&#34;:&#34;</span><span class="op" id="4045437">)</span>&nbsp;<span class="op" id="4045439">&gt;</span>&nbsp;<span class="ident" id="4045441">strings</span><span class="op" id="4045448">.</span><span class="ident" id="4045449">LastIndex</span><span class="op" id="4045458">(</span><span class="ident" id="4045459">s</span><span class="op" id="4045460">,</span>&nbsp;<span class="string" id="4045462">&#34;]&#34;</span><span class="op" id="4045465">)</span>&nbsp;<span class="op" id="4045467">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4045470">//&nbsp;refererForURL&nbsp;returns&nbsp;a&nbsp;referer&nbsp;without&nbsp;any&nbsp;authentication&nbsp;info&nbsp;or</span><br>
<span class="lineno">105</span><span class="comment" id="4045540">//&nbsp;an&nbsp;empty&nbsp;string&nbsp;if&nbsp;lastReq&nbsp;scheme&nbsp;is&nbsp;https&nbsp;and&nbsp;newReq&nbsp;scheme&nbsp;is&nbsp;http.</span><br>
<span class="lineno"></span><span class="keyword" id="4045613">func</span>&nbsp;<span class="ident" id="4045618">refererForURL</span><span class="op" id="4045631">(</span><span class="ident" id="4045632">lastReq</span><span class="op" id="4045639">,</span>&nbsp;<span class="ident" id="4045641">newReq</span>&nbsp;<span class="op" id="4045648">*</span><span class="ident" id="4045649">url</span><span class="op" id="4045652">.</span><span class="ident" id="4045653">URL</span><span class="op" id="4045656">)</span>&nbsp;<span class="builtintype" id="4045658">string</span>&nbsp;<span class="op" id="4045665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4045668">//&nbsp;https://tools.ietf.org/html/rfc7231#section-5.5.2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4045722">//&nbsp;&nbsp;&nbsp;&#34;Clients&nbsp;SHOULD&nbsp;NOT&nbsp;include&nbsp;a&nbsp;Referer&nbsp;header&nbsp;field&nbsp;in&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4045784">//&nbsp;&nbsp;&nbsp;&nbsp;(non-secure)&nbsp;HTTP&nbsp;request&nbsp;if&nbsp;the&nbsp;referring&nbsp;page&nbsp;was</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4045843">//&nbsp;&nbsp;&nbsp;&nbsp;transferred&nbsp;with&nbsp;a&nbsp;secure&nbsp;protocol.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4045887">if</span>&nbsp;<span class="ident" id="4045890">lastReq</span><span class="op" id="4045897">.</span><span class="ident" id="4045898">Scheme</span>&nbsp;<span class="op" id="4045905">==</span>&nbsp;<span class="string" id="4045908">&#34;https&#34;</span>&nbsp;<span class="op" id="4045916">&amp;&amp;</span>&nbsp;<span class="ident" id="4045919">newReq</span><span class="op" id="4045925">.</span><span class="ident" id="4045926">Scheme</span>&nbsp;<span class="op" id="4045933">==</span>&nbsp;<span class="string" id="4045936">&#34;http&#34;</span>&nbsp;<span class="op" id="4045943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4045947">return</span>&nbsp;<span class="string" id="4045954">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4045958">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4045961">referer</span>&nbsp;<span class="op" id="4045969">:=</span>&nbsp;<span class="ident" id="4045972">lastReq</span><span class="op" id="4045979">.</span><span class="ident" id="4045980">String</span><span class="op" id="4045986">(</span><span class="op" id="4045987">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4045990">if</span>&nbsp;<span class="ident" id="4045993">lastReq</span><span class="op" id="4046000">.</span><span class="ident" id="4046001">User</span>&nbsp;<span class="op" id="4046006">!=</span>&nbsp;<span class="builtintype" id="4046009">nil</span>&nbsp;<span class="op" id="4046013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4046017">//&nbsp;This&nbsp;is&nbsp;not&nbsp;very&nbsp;efficient,&nbsp;but&nbsp;is&nbsp;the&nbsp;best&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4046073">//&nbsp;do&nbsp;without:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4046090">//&nbsp;-&nbsp;introducing&nbsp;a&nbsp;new&nbsp;method&nbsp;on&nbsp;URL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4046129">//&nbsp;-&nbsp;creating&nbsp;a&nbsp;race&nbsp;condition</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4046162">//&nbsp;-&nbsp;copying&nbsp;the&nbsp;URL&nbsp;struct&nbsp;manually,&nbsp;which&nbsp;would&nbsp;cause</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4046220">//&nbsp;&nbsp;&nbsp;maintenance&nbsp;problems&nbsp;down&nbsp;the&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4046262">auth</span>&nbsp;<span class="op" id="4046267">:=</span>&nbsp;<span class="ident" id="4046270">lastReq</span><span class="op" id="4046277">.</span><span class="ident" id="4046278">User</span><span class="op" id="4046282">.</span><span class="ident" id="4046283">String</span><span class="op" id="4046289">(</span><span class="op" id="4046290">)</span>&nbsp;<span class="op" id="4046292">+</span>&nbsp;<span class="string" id="4046294">&#34;@&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4046300">referer</span>&nbsp;<span class="op" id="4046308">=</span>&nbsp;<span class="ident" id="4046310">strings</span><span class="op" id="4046317">.</span><span class="ident" id="4046318">Replace</span><span class="op" id="4046325">(</span><span class="ident" id="4046326">referer</span><span class="op" id="4046333">,</span>&nbsp;<span class="ident" id="4046335">auth</span><span class="op" id="4046339">,</span>&nbsp;<span class="string" id="4046341">&#34;&#34;</span><span class="op" id="4046343">,</span>&nbsp;<span class="num" id="4046345">1</span><span class="op" id="4046346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4046349">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4046352">return</span>&nbsp;<span class="ident" id="4046359">referer</span><br>
<span class="lineno"></span><span class="op" id="4046367">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4046370">//&nbsp;Used&nbsp;in&nbsp;Send&nbsp;to&nbsp;implement&nbsp;io.ReadCloser&nbsp;by&nbsp;bundling&nbsp;together&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4046438">//&nbsp;bufio.Reader&nbsp;through&nbsp;which&nbsp;we&nbsp;read&nbsp;the&nbsp;response,&nbsp;and&nbsp;the&nbsp;underlying</span><br>
<span class="lineno">130</span><span class="comment" id="4046509">//&nbsp;network&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="4046532">type</span>&nbsp;<span class="ident" id="4046537">readClose</span>&nbsp;<span class="keyword" id="4046547">struct</span>&nbsp;<span class="op" id="4046554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4046557">io</span><span class="op" id="4046559">.</span><span class="ident" id="4046560">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4046568">io</span><span class="op" id="4046570">.</span><span class="ident" id="4046571">Closer</span><br>
<span class="lineno"></span><span class="op" id="4046578">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span><span class="keyword" id="4046581">func</span>&nbsp;<span class="op" id="4046586">(</span><span class="ident" id="4046587">c</span>&nbsp;<span class="op" id="4046589">*</span><span class="ident" id="4046590">Client</span><span class="op" id="4046596">)</span>&nbsp;<span class="ident" id="4046598">send</span><span class="op" id="4046602">(</span><span class="ident" id="4046603">req</span>&nbsp;<span class="op" id="4046607">*</span><span class="ident" id="4046608">Request</span><span class="op" id="4046615">)</span>&nbsp;<span class="op" id="4046617">(</span><span class="op" id="4046618">*</span><span class="ident" id="4046619">Response</span><span class="op" id="4046627">,</span>&nbsp;<span class="builtintype" id="4046629">error</span><span class="op" id="4046634">)</span>&nbsp;<span class="op" id="4046636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4046639">if</span>&nbsp;<span class="ident" id="4046642">c</span><span class="op" id="4046643">.</span><span class="ident" id="4046644">Jar</span>&nbsp;<span class="op" id="4046648">!=</span>&nbsp;<span class="builtintype" id="4046651">nil</span>&nbsp;<span class="op" id="4046655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4046659">for</span>&nbsp;<span class="ident" id="4046663">_</span><span class="op" id="4046664">,</span>&nbsp;<span class="ident" id="4046666">cookie</span>&nbsp;<span class="op" id="4046673">:=</span>&nbsp;<span class="keyword" id="4046676">range</span>&nbsp;<span class="ident" id="4046682">c</span><span class="op" id="4046683">.</span><span class="ident" id="4046684">Jar</span><span class="op" id="4046687">.</span><span class="ident" id="4046688">Cookies</span><span class="op" id="4046695">(</span><span class="ident" id="4046696">req</span><span class="op" id="4046699">.</span><span class="ident" id="4046700">URL</span><span class="op" id="4046703">)</span>&nbsp;<span class="op" id="4046705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4046710">req</span><span class="op" id="4046713">.</span><span class="ident" id="4046714">AddCookie</span><span class="op" id="4046723">(</span><span class="ident" id="4046724">cookie</span><span class="op" id="4046730">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4046734">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4046737">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4046740">resp</span><span class="op" id="4046744">,</span>&nbsp;<span class="ident" id="4046746">err</span>&nbsp;<span class="op" id="4046750">:=</span>&nbsp;<span class="ident" id="4046753">send</span><span class="op" id="4046757">(</span><span class="ident" id="4046758">req</span><span class="op" id="4046761">,</span>&nbsp;<span class="ident" id="4046763">c</span><span class="op" id="4046764">.</span><span class="ident" id="4046765">transport</span><span class="op" id="4046774">(</span><span class="op" id="4046775">)</span><span class="op" id="4046776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4046779">if</span>&nbsp;<span class="ident" id="4046782">err</span>&nbsp;<span class="op" id="4046786">!=</span>&nbsp;<span class="builtintype" id="4046789">nil</span>&nbsp;<span class="op" id="4046793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4046797">return</span>&nbsp;<span class="builtintype" id="4046804">nil</span><span class="op" id="4046807">,</span>&nbsp;<span class="ident" id="4046809">err</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4046814">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4046817">if</span>&nbsp;<span class="ident" id="4046820">c</span><span class="op" id="4046821">.</span><span class="ident" id="4046822">Jar</span>&nbsp;<span class="op" id="4046826">!=</span>&nbsp;<span class="builtintype" id="4046829">nil</span>&nbsp;<span class="op" id="4046833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4046837">if</span>&nbsp;<span class="ident" id="4046840">rc</span>&nbsp;<span class="op" id="4046843">:=</span>&nbsp;<span class="ident" id="4046846">resp</span><span class="op" id="4046850">.</span><span class="ident" id="4046851">Cookies</span><span class="op" id="4046858">(</span><span class="op" id="4046859">)</span><span class="op" id="4046860">;</span>&nbsp;<span class="builtinfunc" id="4046862">len</span><span class="op" id="4046865">(</span><span class="ident" id="4046866">rc</span><span class="op" id="4046868">)</span>&nbsp;<span class="op" id="4046870">&gt;</span>&nbsp;<span class="num" id="4046872">0</span>&nbsp;<span class="op" id="4046874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4046879">c</span><span class="op" id="4046880">.</span><span class="ident" id="4046881">Jar</span><span class="op" id="4046884">.</span><span class="ident" id="4046885">SetCookies</span><span class="op" id="4046895">(</span><span class="ident" id="4046896">req</span><span class="op" id="4046899">.</span><span class="ident" id="4046900">URL</span><span class="op" id="4046903">,</span>&nbsp;<span class="ident" id="4046905">rc</span><span class="op" id="4046907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4046911">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4046914">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4046917">return</span>&nbsp;<span class="ident" id="4046924">resp</span><span class="op" id="4046928">,</span>&nbsp;<span class="ident" id="4046930">err</span><br>
<span class="lineno"></span><span class="op" id="4046934">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4046937">//&nbsp;Do&nbsp;sends&nbsp;an&nbsp;HTTP&nbsp;request&nbsp;and&nbsp;returns&nbsp;an&nbsp;HTTP&nbsp;response,&nbsp;following</span><br>
<span class="lineno">155</span><span class="comment" id="4047005">//&nbsp;policy&nbsp;(e.g.&nbsp;redirects,&nbsp;cookies,&nbsp;auth)&nbsp;as&nbsp;configured&nbsp;on&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span><span class="comment" id="4047076">//</span><br>
<span class="lineno"></span><span class="comment" id="4047079">//&nbsp;An&nbsp;error&nbsp;is&nbsp;returned&nbsp;if&nbsp;caused&nbsp;by&nbsp;client&nbsp;policy&nbsp;(such&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="4047139">//&nbsp;CheckRedirect),&nbsp;or&nbsp;if&nbsp;there&nbsp;was&nbsp;an&nbsp;HTTP&nbsp;protocol&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="4047198">//&nbsp;A&nbsp;non-2xx&nbsp;response&nbsp;doesn&#39;t&nbsp;cause&nbsp;an&nbsp;error.</span><br>
<span class="lineno">160</span><span class="comment" id="4047244">//</span><br>
<span class="lineno"></span><span class="comment" id="4047247">//&nbsp;When&nbsp;err&nbsp;is&nbsp;nil,&nbsp;resp&nbsp;always&nbsp;contains&nbsp;a&nbsp;non-nil&nbsp;resp.Body.</span><br>
<span class="lineno"></span><span class="comment" id="4047309">//</span><br>
<span class="lineno"></span><span class="comment" id="4047312">//&nbsp;Callers&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.&nbsp;If</span><br>
<span class="lineno"></span><span class="comment" id="4047376">//&nbsp;resp.Body&nbsp;is&nbsp;not&nbsp;closed,&nbsp;the&nbsp;Client&#39;s&nbsp;underlying&nbsp;RoundTripper</span><br>
<span class="lineno">165</span><span class="comment" id="4047441">//&nbsp;(typically&nbsp;Transport)&nbsp;may&nbsp;not&nbsp;be&nbsp;able&nbsp;to&nbsp;re-use&nbsp;a&nbsp;persistent&nbsp;TCP</span><br>
<span class="lineno"></span><span class="comment" id="4047509">//&nbsp;connection&nbsp;to&nbsp;the&nbsp;server&nbsp;for&nbsp;a&nbsp;subsequent&nbsp;&#34;keep-alive&#34;&nbsp;request.</span><br>
<span class="lineno"></span><span class="comment" id="4047576">//</span><br>
<span class="lineno"></span><span class="comment" id="4047579">//&nbsp;The&nbsp;request&nbsp;Body,&nbsp;if&nbsp;non-nil,&nbsp;will&nbsp;be&nbsp;closed&nbsp;by&nbsp;the&nbsp;underlying</span><br>
<span class="lineno"></span><span class="comment" id="4047645">//&nbsp;Transport,&nbsp;even&nbsp;on&nbsp;errors.</span><br>
<span class="lineno">170</span><span class="comment" id="4047675">//</span><br>
<span class="lineno"></span><span class="comment" id="4047678">//&nbsp;Generally&nbsp;Get,&nbsp;Post,&nbsp;or&nbsp;PostForm&nbsp;will&nbsp;be&nbsp;used&nbsp;instead&nbsp;of&nbsp;Do.</span><br>
<span class="lineno"></span><span class="keyword" id="4047742">func</span>&nbsp;<span class="op" id="4047747">(</span><span class="ident" id="4047748">c</span>&nbsp;<span class="op" id="4047750">*</span><span class="ident" id="4047751">Client</span><span class="op" id="4047757">)</span>&nbsp;<span class="ident" id="4047759">Do</span><span class="op" id="4047761">(</span><span class="ident" id="4047762">req</span>&nbsp;<span class="op" id="4047766">*</span><span class="ident" id="4047767">Request</span><span class="op" id="4047774">)</span>&nbsp;<span class="op" id="4047776">(</span><span class="ident" id="4047777">resp</span>&nbsp;<span class="op" id="4047782">*</span><span class="ident" id="4047783">Response</span><span class="op" id="4047791">,</span>&nbsp;<span class="ident" id="4047793">err</span>&nbsp;<span class="builtintype" id="4047797">error</span><span class="op" id="4047802">)</span>&nbsp;<span class="op" id="4047804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4047807">if</span>&nbsp;<span class="ident" id="4047810">req</span><span class="op" id="4047813">.</span><span class="ident" id="4047814">Method</span>&nbsp;<span class="op" id="4047821">==</span>&nbsp;<span class="string" id="4047824">&#34;GET&#34;</span>&nbsp;<span class="op" id="4047830">||</span>&nbsp;<span class="ident" id="4047833">req</span><span class="op" id="4047836">.</span><span class="ident" id="4047837">Method</span>&nbsp;<span class="op" id="4047844">==</span>&nbsp;<span class="string" id="4047847">&#34;HEAD&#34;</span>&nbsp;<span class="op" id="4047854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4047858">return</span>&nbsp;<span class="ident" id="4047865">c</span><span class="op" id="4047866">.</span><span class="ident" id="4047867">doFollowingRedirects</span><span class="op" id="4047887">(</span><span class="ident" id="4047888">req</span><span class="op" id="4047891">,</span>&nbsp;<span class="ident" id="4047893">shouldRedirectGet</span><span class="op" id="4047910">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4047913">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4047916">if</span>&nbsp;<span class="ident" id="4047919">req</span><span class="op" id="4047922">.</span><span class="ident" id="4047923">Method</span>&nbsp;<span class="op" id="4047930">==</span>&nbsp;<span class="string" id="4047933">&#34;POST&#34;</span>&nbsp;<span class="op" id="4047940">||</span>&nbsp;<span class="ident" id="4047943">req</span><span class="op" id="4047946">.</span><span class="ident" id="4047947">Method</span>&nbsp;<span class="op" id="4047954">==</span>&nbsp;<span class="string" id="4047957">&#34;PUT&#34;</span>&nbsp;<span class="op" id="4047963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4047967">return</span>&nbsp;<span class="ident" id="4047974">c</span><span class="op" id="4047975">.</span><span class="ident" id="4047976">doFollowingRedirects</span><span class="op" id="4047996">(</span><span class="ident" id="4047997">req</span><span class="op" id="4048000">,</span>&nbsp;<span class="ident" id="4048002">shouldRedirectPost</span><span class="op" id="4048020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4048023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4048026">return</span>&nbsp;<span class="ident" id="4048033">c</span><span class="op" id="4048034">.</span><span class="ident" id="4048035">send</span><span class="op" id="4048039">(</span><span class="ident" id="4048040">req</span><span class="op" id="4048043">)</span><br>
<span class="lineno">180</span><span class="op" id="4048045">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4048048">func</span>&nbsp;<span class="op" id="4048053">(</span><span class="ident" id="4048054">c</span>&nbsp;<span class="op" id="4048056">*</span><span class="ident" id="4048057">Client</span><span class="op" id="4048063">)</span>&nbsp;<span class="ident" id="4048065">transport</span><span class="op" id="4048074">(</span><span class="op" id="4048075">)</span>&nbsp;<span class="ident" id="4048077">RoundTripper</span>&nbsp;<span class="op" id="4048090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4048093">if</span>&nbsp;<span class="ident" id="4048096">c</span><span class="op" id="4048097">.</span><span class="ident" id="4048098">Transport</span>&nbsp;<span class="op" id="4048108">!=</span>&nbsp;<span class="builtintype" id="4048111">nil</span>&nbsp;<span class="op" id="4048115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4048119">return</span>&nbsp;<span class="ident" id="4048126">c</span><span class="op" id="4048127">.</span><span class="ident" id="4048128">Transport</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4048139">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4048142">return</span>&nbsp;<span class="ident" id="4048149">DefaultTransport</span><br>
<span class="lineno"></span><span class="op" id="4048166">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4048169">//&nbsp;send&nbsp;issues&nbsp;an&nbsp;HTTP&nbsp;request.</span><br>
<span class="lineno">190</span><span class="comment" id="4048201">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="4048261">func</span>&nbsp;<span class="ident" id="4048266">send</span><span class="op" id="4048270">(</span><span class="ident" id="4048271">req</span>&nbsp;<span class="op" id="4048275">*</span><span class="ident" id="4048276">Request</span><span class="op" id="4048283">,</span>&nbsp;<span class="ident" id="4048285">t</span>&nbsp;<span class="ident" id="4048287">RoundTripper</span><span class="op" id="4048299">)</span>&nbsp;<span class="op" id="4048301">(</span><span class="ident" id="4048302">resp</span>&nbsp;<span class="op" id="4048307">*</span><span class="ident" id="4048308">Response</span><span class="op" id="4048316">,</span>&nbsp;<span class="ident" id="4048318">err</span>&nbsp;<span class="builtintype" id="4048322">error</span><span class="op" id="4048327">)</span>&nbsp;<span class="op" id="4048329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4048332">if</span>&nbsp;<span class="ident" id="4048335">t</span>&nbsp;<span class="op" id="4048337">==</span>&nbsp;<span class="builtintype" id="4048340">nil</span>&nbsp;<span class="op" id="4048344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4048348">req</span><span class="op" id="4048351">.</span><span class="ident" id="4048352">closeBody</span><span class="op" id="4048361">(</span><span class="op" id="4048362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4048366">return</span>&nbsp;<span class="builtintype" id="4048373">nil</span><span class="op" id="4048376">,</span>&nbsp;<span class="ident" id="4048378">errors</span><span class="op" id="4048384">.</span><span class="ident" id="4048385">New</span><span class="op" id="4048388">(</span><span class="string" id="4048389">&#34;http:&nbsp;no&nbsp;Client.Transport&nbsp;or&nbsp;DefaultTransport&#34;</span><span class="op" id="4048436">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4048439">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4048443">if</span>&nbsp;<span class="ident" id="4048446">req</span><span class="op" id="4048449">.</span><span class="ident" id="4048450">URL</span>&nbsp;<span class="op" id="4048454">==</span>&nbsp;<span class="builtintype" id="4048457">nil</span>&nbsp;<span class="op" id="4048461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4048465">req</span><span class="op" id="4048468">.</span><span class="ident" id="4048469">closeBody</span><span class="op" id="4048478">(</span><span class="op" id="4048479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4048483">return</span>&nbsp;<span class="builtintype" id="4048490">nil</span><span class="op" id="4048493">,</span>&nbsp;<span class="ident" id="4048495">errors</span><span class="op" id="4048501">.</span><span class="ident" id="4048502">New</span><span class="op" id="4048505">(</span><span class="string" id="4048506">&#34;http:&nbsp;nil&nbsp;Request.URL&#34;</span><span class="op" id="4048529">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4048532">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4048536">if</span>&nbsp;<span class="ident" id="4048539">req</span><span class="op" id="4048542">.</span><span class="ident" id="4048543">RequestURI</span>&nbsp;<span class="op" id="4048554">!=</span>&nbsp;<span class="string" id="4048557">&#34;&#34;</span>&nbsp;<span class="op" id="4048560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4048564">req</span><span class="op" id="4048567">.</span><span class="ident" id="4048568">closeBody</span><span class="op" id="4048577">(</span><span class="op" id="4048578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4048582">return</span>&nbsp;<span class="builtintype" id="4048589">nil</span><span class="op" id="4048592">,</span>&nbsp;<span class="ident" id="4048594">errors</span><span class="op" id="4048600">.</span><span class="ident" id="4048601">New</span><span class="op" id="4048604">(</span><span class="string" id="4048605">&#34;http:&nbsp;Request.RequestURI&nbsp;can&#39;t&nbsp;be&nbsp;set&nbsp;in&nbsp;client&nbsp;requests.&#34;</span><span class="op" id="4048664">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4048667">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4048671">//&nbsp;Most&nbsp;the&nbsp;callers&nbsp;of&nbsp;send&nbsp;(Get,&nbsp;Post,&nbsp;et&nbsp;al)&nbsp;don&#39;t&nbsp;need</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4048730">//&nbsp;Headers,&nbsp;leaving&nbsp;it&nbsp;uninitialized.&nbsp;&nbsp;We&nbsp;guarantee&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4048790">//&nbsp;Transport&nbsp;that&nbsp;this&nbsp;has&nbsp;been&nbsp;initialized,&nbsp;though.</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4048844">if</span>&nbsp;<span class="ident" id="4048847">req</span><span class="op" id="4048850">.</span><span class="ident" id="4048851">Header</span>&nbsp;<span class="op" id="4048858">==</span>&nbsp;<span class="builtintype" id="4048861">nil</span>&nbsp;<span class="op" id="4048865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4048869">req</span><span class="op" id="4048872">.</span><span class="ident" id="4048873">Header</span>&nbsp;<span class="op" id="4048880">=</span>&nbsp;<span class="builtinfunc" id="4048882">make</span><span class="op" id="4048886">(</span><span class="ident" id="4048887">Header</span><span class="op" id="4048893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4048896">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4048900">if</span>&nbsp;<span class="ident" id="4048903">u</span>&nbsp;<span class="op" id="4048905">:=</span>&nbsp;<span class="ident" id="4048908">req</span><span class="op" id="4048911">.</span><span class="ident" id="4048912">URL</span><span class="op" id="4048915">.</span><span class="ident" id="4048916">User</span><span class="op" id="4048920">;</span>&nbsp;<span class="ident" id="4048922">u</span>&nbsp;<span class="op" id="4048924">!=</span>&nbsp;<span class="builtintype" id="4048927">nil</span>&nbsp;<span class="op" id="4048931">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4048935">username</span>&nbsp;<span class="op" id="4048944">:=</span>&nbsp;<span class="ident" id="4048947">u</span><span class="op" id="4048948">.</span><span class="ident" id="4048949">Username</span><span class="op" id="4048957">(</span><span class="op" id="4048958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4048962">password</span><span class="op" id="4048970">,</span>&nbsp;<span class="ident" id="4048972">_</span>&nbsp;<span class="op" id="4048974">:=</span>&nbsp;<span class="ident" id="4048977">u</span><span class="op" id="4048978">.</span><span class="ident" id="4048979">Password</span><span class="op" id="4048987">(</span><span class="op" id="4048988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4048992">req</span><span class="op" id="4048995">.</span><span class="ident" id="4048996">Header</span><span class="op" id="4049002">.</span><span class="ident" id="4049003">Set</span><span class="op" id="4049006">(</span><span class="string" id="4049007">&#34;Authorization&#34;</span><span class="op" id="4049022">,</span>&nbsp;<span class="string" id="4049024">&#34;Basic&nbsp;&#34;</span><span class="op" id="4049032">+</span><span class="ident" id="4049033">basicAuth</span><span class="op" id="4049042">(</span><span class="ident" id="4049043">username</span><span class="op" id="4049051">,</span>&nbsp;<span class="ident" id="4049053">password</span><span class="op" id="4049061">)</span><span class="op" id="4049062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4049065">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4049068">resp</span><span class="op" id="4049072">,</span>&nbsp;<span class="ident" id="4049074">err</span>&nbsp;<span class="op" id="4049078">=</span>&nbsp;<span class="ident" id="4049080">t</span><span class="op" id="4049081">.</span><span class="ident" id="4049082">RoundTrip</span><span class="op" id="4049091">(</span><span class="ident" id="4049092">req</span><span class="op" id="4049095">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4049098">if</span>&nbsp;<span class="ident" id="4049101">err</span>&nbsp;<span class="op" id="4049105">!=</span>&nbsp;<span class="builtintype" id="4049108">nil</span>&nbsp;<span class="op" id="4049112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4049116">if</span>&nbsp;<span class="ident" id="4049119">resp</span>&nbsp;<span class="op" id="4049124">!=</span>&nbsp;<span class="builtintype" id="4049127">nil</span>&nbsp;<span class="op" id="4049131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4049136">log</span><span class="op" id="4049139">.</span><span class="ident" id="4049140">Printf</span><span class="op" id="4049146">(</span><span class="string" id="4049147">&#34;RoundTripper&nbsp;returned&nbsp;a&nbsp;response&nbsp;&amp;&nbsp;error;&nbsp;ignoring&nbsp;response&#34;</span><span class="op" id="4049208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4049212">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4049216">return</span>&nbsp;<span class="builtintype" id="4049223">nil</span><span class="op" id="4049226">,</span>&nbsp;<span class="ident" id="4049228">err</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4049233">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4049236">return</span>&nbsp;<span class="ident" id="4049243">resp</span><span class="op" id="4049247">,</span>&nbsp;<span class="builtintype" id="4049249">nil</span><br>
<span class="lineno"></span><span class="op" id="4049253">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4049256">//&nbsp;See&nbsp;2&nbsp;(end&nbsp;of&nbsp;page&nbsp;4)&nbsp;http://www.ietf.org/rfc/rfc2617.txt</span><br>
<span class="lineno">230</span><span class="comment" id="4049317">//&nbsp;&#34;To&nbsp;receive&nbsp;authorization,&nbsp;the&nbsp;client&nbsp;sends&nbsp;the&nbsp;userid&nbsp;and&nbsp;password,</span><br>
<span class="lineno"></span><span class="comment" id="4049389">//&nbsp;separated&nbsp;by&nbsp;a&nbsp;single&nbsp;colon&nbsp;(&#34;:&#34;)&nbsp;character,&nbsp;within&nbsp;a&nbsp;base64</span><br>
<span class="lineno"></span><span class="comment" id="4049453">//&nbsp;encoded&nbsp;string&nbsp;in&nbsp;the&nbsp;credentials.&#34;</span><br>
<span class="lineno"></span><span class="comment" id="4049492">//&nbsp;It&nbsp;is&nbsp;not&nbsp;meant&nbsp;to&nbsp;be&nbsp;urlencoded.</span><br>
<span class="lineno"></span><span class="keyword" id="4049529">func</span>&nbsp;<span class="ident" id="4049534">basicAuth</span><span class="op" id="4049543">(</span><span class="ident" id="4049544">username</span><span class="op" id="4049552">,</span>&nbsp;<span class="ident" id="4049554">password</span>&nbsp;<span class="builtintype" id="4049563">string</span><span class="op" id="4049569">)</span>&nbsp;<span class="builtintype" id="4049571">string</span>&nbsp;<span class="op" id="4049578">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4049581">auth</span>&nbsp;<span class="op" id="4049586">:=</span>&nbsp;<span class="ident" id="4049589">username</span>&nbsp;<span class="op" id="4049598">+</span>&nbsp;<span class="string" id="4049600">&#34;:&#34;</span>&nbsp;<span class="op" id="4049604">+</span>&nbsp;<span class="ident" id="4049606">password</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4049616">return</span>&nbsp;<span class="ident" id="4049623">base64</span><span class="op" id="4049629">.</span><span class="ident" id="4049630">StdEncoding</span><span class="op" id="4049641">.</span><span class="ident" id="4049642">EncodeToString</span><span class="op" id="4049656">(</span><span class="op" id="4049657">[</span><span class="op" id="4049658">]</span><span class="builtintype" id="4049659">byte</span><span class="op" id="4049663">(</span><span class="ident" id="4049664">auth</span><span class="op" id="4049668">)</span><span class="op" id="4049669">)</span><br>
<span class="lineno"></span><span class="op" id="4049671">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4049674">//&nbsp;True&nbsp;if&nbsp;the&nbsp;specified&nbsp;HTTP&nbsp;status&nbsp;code&nbsp;is&nbsp;one&nbsp;for&nbsp;which&nbsp;the&nbsp;Get&nbsp;utility&nbsp;should</span><br>
<span class="lineno">240</span><span class="comment" id="4049756">//&nbsp;automatically&nbsp;redirect.</span><br>
<span class="lineno"></span><span class="keyword" id="4049783">func</span>&nbsp;<span class="ident" id="4049788">shouldRedirectGet</span><span class="op" id="4049805">(</span><span class="ident" id="4049806">statusCode</span>&nbsp;<span class="builtintype" id="4049817">int</span><span class="op" id="4049820">)</span>&nbsp;<span class="builtintype" id="4049822">bool</span>&nbsp;<span class="op" id="4049827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4049830">switch</span>&nbsp;<span class="ident" id="4049837">statusCode</span>&nbsp;<span class="op" id="4049848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4049851">case</span>&nbsp;<span class="ident" id="4049856">StatusMovedPermanently</span><span class="op" id="4049878">,</span>&nbsp;<span class="ident" id="4049880">StatusFound</span><span class="op" id="4049891">,</span>&nbsp;<span class="ident" id="4049893">StatusSeeOther</span><span class="op" id="4049907">,</span>&nbsp;<span class="ident" id="4049909">StatusTemporaryRedirect</span><span class="op" id="4049932">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4049936">return</span>&nbsp;<span class="builtintype" id="4049943">true</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4049949">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4049952">return</span>&nbsp;<span class="builtintype" id="4049959">false</span><br>
<span class="lineno"></span><span class="op" id="4049965">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4049968">//&nbsp;True&nbsp;if&nbsp;the&nbsp;specified&nbsp;HTTP&nbsp;status&nbsp;code&nbsp;is&nbsp;one&nbsp;for&nbsp;which&nbsp;the&nbsp;Post&nbsp;utility&nbsp;should</span><br>
<span class="lineno">250</span><span class="comment" id="4050051">//&nbsp;automatically&nbsp;redirect.</span><br>
<span class="lineno"></span><span class="keyword" id="4050078">func</span>&nbsp;<span class="ident" id="4050083">shouldRedirectPost</span><span class="op" id="4050101">(</span><span class="ident" id="4050102">statusCode</span>&nbsp;<span class="builtintype" id="4050113">int</span><span class="op" id="4050116">)</span>&nbsp;<span class="builtintype" id="4050118">bool</span>&nbsp;<span class="op" id="4050123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4050126">switch</span>&nbsp;<span class="ident" id="4050133">statusCode</span>&nbsp;<span class="op" id="4050144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4050147">case</span>&nbsp;<span class="ident" id="4050152">StatusFound</span><span class="op" id="4050163">,</span>&nbsp;<span class="ident" id="4050165">StatusSeeOther</span><span class="op" id="4050179">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4050183">return</span>&nbsp;<span class="builtintype" id="4050190">true</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4050196">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4050199">return</span>&nbsp;<span class="builtintype" id="4050206">false</span><br>
<span class="lineno"></span><span class="op" id="4050212">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4050215">//&nbsp;Get&nbsp;issues&nbsp;a&nbsp;GET&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL.&nbsp;&nbsp;If&nbsp;the&nbsp;response&nbsp;is&nbsp;one&nbsp;of&nbsp;the&nbsp;following</span><br>
<span class="lineno">260</span><span class="comment" id="4050298">//&nbsp;redirect&nbsp;codes,&nbsp;Get&nbsp;follows&nbsp;the&nbsp;redirect,&nbsp;up&nbsp;to&nbsp;a&nbsp;maximum&nbsp;of&nbsp;10&nbsp;redirects:</span><br>
<span class="lineno"></span><span class="comment" id="4050376">//</span><br>
<span class="lineno"></span><span class="comment" id="4050379">//&nbsp;&nbsp;&nbsp;&nbsp;301&nbsp;(Moved&nbsp;Permanently)</span><br>
<span class="lineno"></span><span class="comment" id="4050409">//&nbsp;&nbsp;&nbsp;&nbsp;302&nbsp;(Found)</span><br>
<span class="lineno"></span><span class="comment" id="4050427">//&nbsp;&nbsp;&nbsp;&nbsp;303&nbsp;(See&nbsp;Other)</span><br>
<span class="lineno">265</span><span class="comment" id="4050449">//&nbsp;&nbsp;&nbsp;&nbsp;307&nbsp;(Temporary&nbsp;Redirect)</span><br>
<span class="lineno"></span><span class="comment" id="4050480">//</span><br>
<span class="lineno"></span><span class="comment" id="4050483">//&nbsp;An&nbsp;error&nbsp;is&nbsp;returned&nbsp;if&nbsp;there&nbsp;were&nbsp;too&nbsp;many&nbsp;redirects&nbsp;or&nbsp;if&nbsp;there</span><br>
<span class="lineno"></span><span class="comment" id="4050552">//&nbsp;was&nbsp;an&nbsp;HTTP&nbsp;protocol&nbsp;error.&nbsp;A&nbsp;non-2xx&nbsp;response&nbsp;doesn&#39;t&nbsp;cause&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="4050619">//&nbsp;error.</span><br>
<span class="lineno">270</span><span class="comment" id="4050629">//</span><br>
<span class="lineno"></span><span class="comment" id="4050632">//&nbsp;When&nbsp;err&nbsp;is&nbsp;nil,&nbsp;resp&nbsp;always&nbsp;contains&nbsp;a&nbsp;non-nil&nbsp;resp.Body.</span><br>
<span class="lineno"></span><span class="comment" id="4050694">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="4050754">//</span><br>
<span class="lineno"></span><span class="comment" id="4050757">//&nbsp;Get&nbsp;is&nbsp;a&nbsp;wrapper&nbsp;around&nbsp;DefaultClient.Get.</span><br>
<span class="lineno">275</span><span class="keyword" id="4050803">func</span>&nbsp;<span class="ident" id="4050808">Get</span><span class="op" id="4050811">(</span><span class="ident" id="4050812">url</span>&nbsp;<span class="builtintype" id="4050816">string</span><span class="op" id="4050822">)</span>&nbsp;<span class="op" id="4050824">(</span><span class="ident" id="4050825">resp</span>&nbsp;<span class="op" id="4050830">*</span><span class="ident" id="4050831">Response</span><span class="op" id="4050839">,</span>&nbsp;<span class="ident" id="4050841">err</span>&nbsp;<span class="builtintype" id="4050845">error</span><span class="op" id="4050850">)</span>&nbsp;<span class="op" id="4050852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4050855">return</span>&nbsp;<span class="ident" id="4050862">DefaultClient</span><span class="op" id="4050875">.</span><span class="ident" id="4050876">Get</span><span class="op" id="4050879">(</span><span class="ident" id="4050880">url</span><span class="op" id="4050883">)</span><br>
<span class="lineno"></span><span class="op" id="4050885">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4050888">//&nbsp;Get&nbsp;issues&nbsp;a&nbsp;GET&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL.&nbsp;&nbsp;If&nbsp;the&nbsp;response&nbsp;is&nbsp;one&nbsp;of&nbsp;the</span><br>
<span class="lineno">280</span><span class="comment" id="4050961">//&nbsp;following&nbsp;redirect&nbsp;codes,&nbsp;Get&nbsp;follows&nbsp;the&nbsp;redirect&nbsp;after&nbsp;calling&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4051033">//&nbsp;Client&#39;s&nbsp;CheckRedirect&nbsp;function.</span><br>
<span class="lineno"></span><span class="comment" id="4051069">//</span><br>
<span class="lineno"></span><span class="comment" id="4051072">//&nbsp;&nbsp;&nbsp;&nbsp;301&nbsp;(Moved&nbsp;Permanently)</span><br>
<span class="lineno"></span><span class="comment" id="4051102">//&nbsp;&nbsp;&nbsp;&nbsp;302&nbsp;(Found)</span><br>
<span class="lineno">285</span><span class="comment" id="4051120">//&nbsp;&nbsp;&nbsp;&nbsp;303&nbsp;(See&nbsp;Other)</span><br>
<span class="lineno"></span><span class="comment" id="4051142">//&nbsp;&nbsp;&nbsp;&nbsp;307&nbsp;(Temporary&nbsp;Redirect)</span><br>
<span class="lineno"></span><span class="comment" id="4051173">//</span><br>
<span class="lineno"></span><span class="comment" id="4051176">//&nbsp;An&nbsp;error&nbsp;is&nbsp;returned&nbsp;if&nbsp;the&nbsp;Client&#39;s&nbsp;CheckRedirect&nbsp;function&nbsp;fails</span><br>
<span class="lineno"></span><span class="comment" id="4051245">//&nbsp;or&nbsp;if&nbsp;there&nbsp;was&nbsp;an&nbsp;HTTP&nbsp;protocol&nbsp;error.&nbsp;A&nbsp;non-2xx&nbsp;response&nbsp;doesn&#39;t</span><br>
<span class="lineno">290</span><span class="comment" id="4051315">//&nbsp;cause&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="4051334">//</span><br>
<span class="lineno"></span><span class="comment" id="4051337">//&nbsp;When&nbsp;err&nbsp;is&nbsp;nil,&nbsp;resp&nbsp;always&nbsp;contains&nbsp;a&nbsp;non-nil&nbsp;resp.Body.</span><br>
<span class="lineno"></span><span class="comment" id="4051399">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="4051459">func</span>&nbsp;<span class="op" id="4051464">(</span><span class="ident" id="4051465">c</span>&nbsp;<span class="op" id="4051467">*</span><span class="ident" id="4051468">Client</span><span class="op" id="4051474">)</span>&nbsp;<span class="ident" id="4051476">Get</span><span class="op" id="4051479">(</span><span class="ident" id="4051480">url</span>&nbsp;<span class="builtintype" id="4051484">string</span><span class="op" id="4051490">)</span>&nbsp;<span class="op" id="4051492">(</span><span class="ident" id="4051493">resp</span>&nbsp;<span class="op" id="4051498">*</span><span class="ident" id="4051499">Response</span><span class="op" id="4051507">,</span>&nbsp;<span class="ident" id="4051509">err</span>&nbsp;<span class="builtintype" id="4051513">error</span><span class="op" id="4051518">)</span>&nbsp;<span class="op" id="4051520">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4051523">req</span><span class="op" id="4051526">,</span>&nbsp;<span class="ident" id="4051528">err</span>&nbsp;<span class="op" id="4051532">:=</span>&nbsp;<span class="ident" id="4051535">NewRequest</span><span class="op" id="4051545">(</span><span class="string" id="4051546">&#34;GET&#34;</span><span class="op" id="4051551">,</span>&nbsp;<span class="ident" id="4051553">url</span><span class="op" id="4051556">,</span>&nbsp;<span class="builtintype" id="4051558">nil</span><span class="op" id="4051561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4051564">if</span>&nbsp;<span class="ident" id="4051567">err</span>&nbsp;<span class="op" id="4051571">!=</span>&nbsp;<span class="builtintype" id="4051574">nil</span>&nbsp;<span class="op" id="4051578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4051582">return</span>&nbsp;<span class="builtintype" id="4051589">nil</span><span class="op" id="4051592">,</span>&nbsp;<span class="ident" id="4051594">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4051599">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4051602">return</span>&nbsp;<span class="ident" id="4051609">c</span><span class="op" id="4051610">.</span><span class="ident" id="4051611">doFollowingRedirects</span><span class="op" id="4051631">(</span><span class="ident" id="4051632">req</span><span class="op" id="4051635">,</span>&nbsp;<span class="ident" id="4051637">shouldRedirectGet</span><span class="op" id="4051654">)</span><br>
<span class="lineno">300</span><span class="op" id="4051656">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4051659">func</span>&nbsp;<span class="op" id="4051664">(</span><span class="ident" id="4051665">c</span>&nbsp;<span class="op" id="4051667">*</span><span class="ident" id="4051668">Client</span><span class="op" id="4051674">)</span>&nbsp;<span class="ident" id="4051676">doFollowingRedirects</span><span class="op" id="4051696">(</span><span class="ident" id="4051697">ireq</span>&nbsp;<span class="op" id="4051702">*</span><span class="ident" id="4051703">Request</span><span class="op" id="4051710">,</span>&nbsp;<span class="ident" id="4051712">shouldRedirect</span>&nbsp;<span class="keyword" id="4051727">func</span><span class="op" id="4051731">(</span><span class="builtintype" id="4051732">int</span><span class="op" id="4051735">)</span>&nbsp;<span class="builtintype" id="4051737">bool</span><span class="op" id="4051741">)</span>&nbsp;<span class="op" id="4051743">(</span><span class="ident" id="4051744">resp</span>&nbsp;<span class="op" id="4051749">*</span><span class="ident" id="4051750">Response</span><span class="op" id="4051758">,</span>&nbsp;<span class="ident" id="4051760">err</span>&nbsp;<span class="builtintype" id="4051764">error</span><span class="op" id="4051769">)</span>&nbsp;<span class="op" id="4051771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4051774">var</span>&nbsp;<span class="ident" id="4051778">base</span>&nbsp;<span class="op" id="4051783">*</span><span class="ident" id="4051784">url</span><span class="op" id="4051787">.</span><span class="ident" id="4051788">URL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4051793">redirectChecker</span>&nbsp;<span class="op" id="4051809">:=</span>&nbsp;<span class="ident" id="4051812">c</span><span class="op" id="4051813">.</span><span class="ident" id="4051814">CheckRedirect</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4051829">if</span>&nbsp;<span class="ident" id="4051832">redirectChecker</span>&nbsp;<span class="op" id="4051848">==</span>&nbsp;<span class="builtintype" id="4051851">nil</span>&nbsp;<span class="op" id="4051855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4051859">redirectChecker</span>&nbsp;<span class="op" id="4051875">=</span>&nbsp;<span class="ident" id="4051877">defaultCheckRedirect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4051899">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4051902">var</span>&nbsp;<span class="ident" id="4051906">via</span>&nbsp;<span class="op" id="4051910">[</span><span class="op" id="4051911">]</span><span class="op" id="4051912">*</span><span class="ident" id="4051913">Request</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4051923">if</span>&nbsp;<span class="ident" id="4051926">ireq</span><span class="op" id="4051930">.</span><span class="ident" id="4051931">URL</span>&nbsp;<span class="op" id="4051935">==</span>&nbsp;<span class="builtintype" id="4051938">nil</span>&nbsp;<span class="op" id="4051942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4051946">ireq</span><span class="op" id="4051950">.</span><span class="ident" id="4051951">closeBody</span><span class="op" id="4051960">(</span><span class="op" id="4051961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4051965">return</span>&nbsp;<span class="builtintype" id="4051972">nil</span><span class="op" id="4051975">,</span>&nbsp;<span class="ident" id="4051977">errors</span><span class="op" id="4051983">.</span><span class="ident" id="4051984">New</span><span class="op" id="4051987">(</span><span class="string" id="4051988">&#34;http:&nbsp;nil&nbsp;Request.URL&#34;</span><span class="op" id="4052011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4052014">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4052018">var</span>&nbsp;<span class="ident" id="4052022">reqmu</span>&nbsp;<span class="ident" id="4052028">sync</span><span class="op" id="4052032">.</span><span class="ident" id="4052033">Mutex</span>&nbsp;<span class="comment" id="4052039">//&nbsp;guards&nbsp;req</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4052054">req</span>&nbsp;<span class="op" id="4052058">:=</span>&nbsp;<span class="ident" id="4052061">ireq</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4052068">var</span>&nbsp;<span class="ident" id="4052072">timer</span>&nbsp;<span class="op" id="4052078">*</span><span class="ident" id="4052079">time</span><span class="op" id="4052083">.</span><span class="ident" id="4052084">Timer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4052091">if</span>&nbsp;<span class="ident" id="4052094">c</span><span class="op" id="4052095">.</span><span class="ident" id="4052096">Timeout</span>&nbsp;<span class="op" id="4052104">&gt;</span>&nbsp;<span class="num" id="4052106">0</span>&nbsp;<span class="op" id="4052108">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4052112">type</span>&nbsp;<span class="ident" id="4052117">canceler</span>&nbsp;<span class="keyword" id="4052126">interface</span>&nbsp;<span class="op" id="4052136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4052141">CancelRequest</span><span class="op" id="4052154">(</span><span class="op" id="4052155">*</span><span class="ident" id="4052156">Request</span><span class="op" id="4052163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4052167">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4052171">tr</span><span class="op" id="4052173">,</span>&nbsp;<span class="ident" id="4052175">ok</span>&nbsp;<span class="op" id="4052178">:=</span>&nbsp;<span class="ident" id="4052181">c</span><span class="op" id="4052182">.</span><span class="ident" id="4052183">transport</span><span class="op" id="4052192">(</span><span class="op" id="4052193">)</span><span class="op" id="4052194">.</span><span class="op" id="4052195">(</span><span class="ident" id="4052196">canceler</span><span class="op" id="4052204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4052208">if</span>&nbsp;<span class="op" id="4052211">!</span><span class="ident" id="4052212">ok</span>&nbsp;<span class="op" id="4052215">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4052220">return</span>&nbsp;<span class="builtintype" id="4052227">nil</span><span class="op" id="4052230">,</span>&nbsp;<span class="ident" id="4052232">fmt</span><span class="op" id="4052235">.</span><span class="ident" id="4052236">Errorf</span><span class="op" id="4052242">(</span><span class="string" id="4052243">&#34;net/http:&nbsp;Client&nbsp;Transport&nbsp;of&nbsp;type&nbsp;%T&nbsp;doesn&#39;t&nbsp;support&nbsp;CancelRequest;&nbsp;Timeout&nbsp;not&nbsp;supported&#34;</span><span class="op" id="4052335">,</span>&nbsp;<span class="ident" id="4052337">c</span><span class="op" id="4052338">.</span><span class="ident" id="4052339">transport</span><span class="op" id="4052348">(</span><span class="op" id="4052349">)</span><span class="op" id="4052350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4052354">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4052358">timer</span>&nbsp;<span class="op" id="4052364">=</span>&nbsp;<span class="ident" id="4052366">time</span><span class="op" id="4052370">.</span><span class="ident" id="4052371">AfterFunc</span><span class="op" id="4052380">(</span><span class="ident" id="4052381">c</span><span class="op" id="4052382">.</span><span class="ident" id="4052383">Timeout</span><span class="op" id="4052390">,</span>&nbsp;<span class="keyword" id="4052392">func</span><span class="op" id="4052396">(</span><span class="op" id="4052397">)</span>&nbsp;<span class="op" id="4052399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4052404">reqmu</span><span class="op" id="4052409">.</span><span class="ident" id="4052410">Lock</span><span class="op" id="4052414">(</span><span class="op" id="4052415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4052420">defer</span>&nbsp;<span class="ident" id="4052426">reqmu</span><span class="op" id="4052431">.</span><span class="ident" id="4052432">Unlock</span><span class="op" id="4052438">(</span><span class="op" id="4052439">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4052444">tr</span><span class="op" id="4052446">.</span><span class="ident" id="4052447">CancelRequest</span><span class="op" id="4052460">(</span><span class="ident" id="4052461">req</span><span class="op" id="4052464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4052468">}</span><span class="op" id="4052469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4052472">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4052476">urlStr</span>&nbsp;<span class="op" id="4052483">:=</span>&nbsp;<span class="string" id="4052486">&#34;&#34;</span>&nbsp;<span class="comment" id="4052489">//&nbsp;next&nbsp;relative&nbsp;or&nbsp;absolute&nbsp;URL&nbsp;to&nbsp;fetch&nbsp;(after&nbsp;first&nbsp;request)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4052554">redirectFailed</span>&nbsp;<span class="op" id="4052569">:=</span>&nbsp;<span class="builtintype" id="4052572">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4052579">for</span>&nbsp;<span class="ident" id="4052583">redirect</span>&nbsp;<span class="op" id="4052592">:=</span>&nbsp;<span class="num" id="4052595">0</span><span class="op" id="4052596">;</span>&nbsp;<span class="op" id="4052598">;</span>&nbsp;<span class="ident" id="4052600">redirect</span><span class="op" id="4052608">++</span>&nbsp;<span class="op" id="4052611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4052615">if</span>&nbsp;<span class="ident" id="4052618">redirect</span>&nbsp;<span class="op" id="4052627">!=</span>&nbsp;<span class="num" id="4052630">0</span>&nbsp;<span class="op" id="4052632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4052637">nreq</span>&nbsp;<span class="op" id="4052642">:=</span>&nbsp;<span class="builtinfunc" id="4052645">new</span><span class="op" id="4052648">(</span><span class="ident" id="4052649">Request</span><span class="op" id="4052656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4052661">nreq</span><span class="op" id="4052665">.</span><span class="ident" id="4052666">Method</span>&nbsp;<span class="op" id="4052673">=</span>&nbsp;<span class="ident" id="4052675">ireq</span><span class="op" id="4052679">.</span><span class="ident" id="4052680">Method</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4052690">if</span>&nbsp;<span class="ident" id="4052693">ireq</span><span class="op" id="4052697">.</span><span class="ident" id="4052698">Method</span>&nbsp;<span class="op" id="4052705">==</span>&nbsp;<span class="string" id="4052708">&#34;POST&#34;</span>&nbsp;<span class="op" id="4052715">||</span>&nbsp;<span class="ident" id="4052718">ireq</span><span class="op" id="4052722">.</span><span class="ident" id="4052723">Method</span>&nbsp;<span class="op" id="4052730">==</span>&nbsp;<span class="string" id="4052733">&#34;PUT&#34;</span>&nbsp;<span class="op" id="4052739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4052745">nreq</span><span class="op" id="4052749">.</span><span class="ident" id="4052750">Method</span>&nbsp;<span class="op" id="4052757">=</span>&nbsp;<span class="string" id="4052759">&#34;GET&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4052768">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4052773">nreq</span><span class="op" id="4052777">.</span><span class="ident" id="4052778">Header</span>&nbsp;<span class="op" id="4052785">=</span>&nbsp;<span class="builtinfunc" id="4052787">make</span><span class="op" id="4052791">(</span><span class="ident" id="4052792">Header</span><span class="op" id="4052798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4052803">nreq</span><span class="op" id="4052807">.</span><span class="ident" id="4052808">URL</span><span class="op" id="4052811">,</span>&nbsp;<span class="ident" id="4052813">err</span>&nbsp;<span class="op" id="4052817">=</span>&nbsp;<span class="ident" id="4052819">base</span><span class="op" id="4052823">.</span><span class="ident" id="4052824">Parse</span><span class="op" id="4052829">(</span><span class="ident" id="4052830">urlStr</span><span class="op" id="4052836">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4052841">if</span>&nbsp;<span class="ident" id="4052844">err</span>&nbsp;<span class="op" id="4052848">!=</span>&nbsp;<span class="builtintype" id="4052851">nil</span>&nbsp;<span class="op" id="4052855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4052861">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4052870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4052875">if</span>&nbsp;<span class="builtinfunc" id="4052878">len</span><span class="op" id="4052881">(</span><span class="ident" id="4052882">via</span><span class="op" id="4052885">)</span>&nbsp;<span class="op" id="4052887">&gt;</span>&nbsp;<span class="num" id="4052889">0</span>&nbsp;<span class="op" id="4052891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4052897">//&nbsp;Add&nbsp;the&nbsp;Referer&nbsp;header.</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4052928">lastReq</span>&nbsp;<span class="op" id="4052936">:=</span>&nbsp;<span class="ident" id="4052939">via</span><span class="op" id="4052942">[</span><span class="builtinfunc" id="4052943">len</span><span class="op" id="4052946">(</span><span class="ident" id="4052947">via</span><span class="op" id="4052950">)</span><span class="op" id="4052951">-</span><span class="num" id="4052952">1</span><span class="op" id="4052953">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4052959">if</span>&nbsp;<span class="ident" id="4052962">ref</span>&nbsp;<span class="op" id="4052966">:=</span>&nbsp;<span class="ident" id="4052969">refererForURL</span><span class="op" id="4052982">(</span><span class="ident" id="4052983">lastReq</span><span class="op" id="4052990">.</span><span class="ident" id="4052991">URL</span><span class="op" id="4052994">,</span>&nbsp;<span class="ident" id="4052996">nreq</span><span class="op" id="4053000">.</span><span class="ident" id="4053001">URL</span><span class="op" id="4053004">)</span><span class="op" id="4053005">;</span>&nbsp;<span class="ident" id="4053007">ref</span>&nbsp;<span class="op" id="4053011">!=</span>&nbsp;<span class="string" id="4053014">&#34;&#34;</span>&nbsp;<span class="op" id="4053017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4053024">nreq</span><span class="op" id="4053028">.</span><span class="ident" id="4053029">Header</span><span class="op" id="4053035">.</span><span class="ident" id="4053036">Set</span><span class="op" id="4053039">(</span><span class="string" id="4053040">&#34;Referer&#34;</span><span class="op" id="4053049">,</span>&nbsp;<span class="ident" id="4053051">ref</span><span class="op" id="4053054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4053060">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4053067">err</span>&nbsp;<span class="op" id="4053071">=</span>&nbsp;<span class="ident" id="4053073">redirectChecker</span><span class="op" id="4053088">(</span><span class="ident" id="4053089">nreq</span><span class="op" id="4053093">,</span>&nbsp;<span class="ident" id="4053095">via</span><span class="op" id="4053098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4053104">if</span>&nbsp;<span class="ident" id="4053107">err</span>&nbsp;<span class="op" id="4053111">!=</span>&nbsp;<span class="builtintype" id="4053114">nil</span>&nbsp;<span class="op" id="4053118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4053125">redirectFailed</span>&nbsp;<span class="op" id="4053140">=</span>&nbsp;<span class="builtintype" id="4053142">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4053152">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4053162">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4053167">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4053172">reqmu</span><span class="op" id="4053177">.</span><span class="ident" id="4053178">Lock</span><span class="op" id="4053182">(</span><span class="op" id="4053183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4053188">req</span>&nbsp;<span class="op" id="4053192">=</span>&nbsp;<span class="ident" id="4053194">nreq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4053202">reqmu</span><span class="op" id="4053207">.</span><span class="ident" id="4053208">Unlock</span><span class="op" id="4053214">(</span><span class="op" id="4053215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4053219">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4053224">urlStr</span>&nbsp;<span class="op" id="4053231">=</span>&nbsp;<span class="ident" id="4053233">req</span><span class="op" id="4053236">.</span><span class="ident" id="4053237">URL</span><span class="op" id="4053240">.</span><span class="ident" id="4053241">String</span><span class="op" id="4053247">(</span><span class="op" id="4053248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4053252">if</span>&nbsp;<span class="ident" id="4053255">resp</span><span class="op" id="4053259">,</span>&nbsp;<span class="ident" id="4053261">err</span>&nbsp;<span class="op" id="4053265">=</span>&nbsp;<span class="ident" id="4053267">c</span><span class="op" id="4053268">.</span><span class="ident" id="4053269">send</span><span class="op" id="4053273">(</span><span class="ident" id="4053274">req</span><span class="op" id="4053277">)</span><span class="op" id="4053278">;</span>&nbsp;<span class="ident" id="4053280">err</span>&nbsp;<span class="op" id="4053284">!=</span>&nbsp;<span class="builtintype" id="4053287">nil</span>&nbsp;<span class="op" id="4053291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4053296">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4053304">}</span><br>
<span class="lineno">370</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4053309">if</span>&nbsp;<span class="ident" id="4053312">shouldRedirect</span><span class="op" id="4053326">(</span><span class="ident" id="4053327">resp</span><span class="op" id="4053331">.</span><span class="ident" id="4053332">StatusCode</span><span class="op" id="4053342">)</span>&nbsp;<span class="op" id="4053344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4053349">//&nbsp;Read&nbsp;the&nbsp;body&nbsp;if&nbsp;small&nbsp;so&nbsp;underlying&nbsp;TCP&nbsp;connection&nbsp;will&nbsp;be&nbsp;re-used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4053424">//&nbsp;No&nbsp;need&nbsp;to&nbsp;check&nbsp;for&nbsp;errors:&nbsp;if&nbsp;it&nbsp;fails,&nbsp;Transport&nbsp;won&#39;t&nbsp;reuse&nbsp;it&nbsp;anyway.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4053505">const</span>&nbsp;<span class="ident" id="4053511">maxBodySlurpSize</span>&nbsp;<span class="op" id="4053528">=</span>&nbsp;<span class="num" id="4053530">2</span>&nbsp;<span class="op" id="4053532">&lt;&lt;</span>&nbsp;<span class="num" id="4053535">10</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4053541">if</span>&nbsp;<span class="ident" id="4053544">resp</span><span class="op" id="4053548">.</span><span class="ident" id="4053549">ContentLength</span>&nbsp;<span class="op" id="4053563">==</span>&nbsp;<span class="op" id="4053566">-</span><span class="num" id="4053567">1</span>&nbsp;<span class="op" id="4053569">||</span>&nbsp;<span class="ident" id="4053572">resp</span><span class="op" id="4053576">.</span><span class="ident" id="4053577">ContentLength</span>&nbsp;<span class="op" id="4053591">&lt;=</span>&nbsp;<span class="ident" id="4053594">maxBodySlurpSize</span>&nbsp;<span class="op" id="4053611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4053617">io</span><span class="op" id="4053619">.</span><span class="ident" id="4053620">CopyN</span><span class="op" id="4053625">(</span><span class="ident" id="4053626">ioutil</span><span class="op" id="4053632">.</span><span class="ident" id="4053633">Discard</span><span class="op" id="4053640">,</span>&nbsp;<span class="ident" id="4053642">resp</span><span class="op" id="4053646">.</span><span class="ident" id="4053647">Body</span><span class="op" id="4053651">,</span>&nbsp;<span class="ident" id="4053653">maxBodySlurpSize</span><span class="op" id="4053669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4053674">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4053679">resp</span><span class="op" id="4053683">.</span><span class="ident" id="4053684">Body</span><span class="op" id="4053688">.</span><span class="ident" id="4053689">Close</span><span class="op" id="4053694">(</span><span class="op" id="4053695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4053700">if</span>&nbsp;<span class="ident" id="4053703">urlStr</span>&nbsp;<span class="op" id="4053710">=</span>&nbsp;<span class="ident" id="4053712">resp</span><span class="op" id="4053716">.</span><span class="ident" id="4053717">Header</span><span class="op" id="4053723">.</span><span class="ident" id="4053724">Get</span><span class="op" id="4053727">(</span><span class="string" id="4053728">&#34;Location&#34;</span><span class="op" id="4053738">)</span><span class="op" id="4053739">;</span>&nbsp;<span class="ident" id="4053741">urlStr</span>&nbsp;<span class="op" id="4053748">==</span>&nbsp;<span class="string" id="4053751">&#34;&#34;</span>&nbsp;<span class="op" id="4053754">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4053760">err</span>&nbsp;<span class="op" id="4053764">=</span>&nbsp;<span class="ident" id="4053766">errors</span><span class="op" id="4053772">.</span><span class="ident" id="4053773">New</span><span class="op" id="4053776">(</span><span class="ident" id="4053777">fmt</span><span class="op" id="4053780">.</span><span class="ident" id="4053781">Sprintf</span><span class="op" id="4053788">(</span><span class="string" id="4053789">&#34;%d&nbsp;response&nbsp;missing&nbsp;Location&nbsp;header&#34;</span><span class="op" id="4053826">,</span>&nbsp;<span class="ident" id="4053828">resp</span><span class="op" id="4053832">.</span><span class="ident" id="4053833">StatusCode</span><span class="op" id="4053843">)</span><span class="op" id="4053844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4053850">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4053859">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4053864">base</span>&nbsp;<span class="op" id="4053869">=</span>&nbsp;<span class="ident" id="4053871">req</span><span class="op" id="4053874">.</span><span class="ident" id="4053875">URL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4053882">via</span>&nbsp;<span class="op" id="4053886">=</span>&nbsp;<span class="builtinfunc" id="4053888">append</span><span class="op" id="4053894">(</span><span class="ident" id="4053895">via</span><span class="op" id="4053898">,</span>&nbsp;<span class="ident" id="4053900">req</span><span class="op" id="4053903">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4053908">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4053919">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4053923">if</span>&nbsp;<span class="ident" id="4053926">timer</span>&nbsp;<span class="op" id="4053932">!=</span>&nbsp;<span class="builtintype" id="4053935">nil</span>&nbsp;<span class="op" id="4053939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4053944">resp</span><span class="op" id="4053948">.</span><span class="ident" id="4053949">Body</span>&nbsp;<span class="op" id="4053954">=</span>&nbsp;<span class="op" id="4053956">&amp;</span><span class="ident" id="4053957">cancelTimerBody</span><span class="op" id="4053972">{</span><span class="ident" id="4053973">timer</span><span class="op" id="4053978">,</span>&nbsp;<span class="ident" id="4053980">resp</span><span class="op" id="4053984">.</span><span class="ident" id="4053985">Body</span><span class="op" id="4053989">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4053993">}</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4053997">return</span>&nbsp;<span class="ident" id="4054004">resp</span><span class="op" id="4054008">,</span>&nbsp;<span class="builtintype" id="4054010">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4054015">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4054019">method</span>&nbsp;<span class="op" id="4054026">:=</span>&nbsp;<span class="ident" id="4054029">ireq</span><span class="op" id="4054033">.</span><span class="ident" id="4054034">Method</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4054042">urlErr</span>&nbsp;<span class="op" id="4054049">:=</span>&nbsp;<span class="op" id="4054052">&amp;</span><span class="ident" id="4054053">url</span><span class="op" id="4054056">.</span><span class="ident" id="4054057">Error</span><span class="op" id="4054062">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4054066">Op</span><span class="op" id="4054068">:</span>&nbsp;&nbsp;<span class="ident" id="4054071">method</span><span class="op" id="4054077">[</span><span class="num" id="4054078">0</span><span class="op" id="4054079">:</span><span class="num" id="4054080">1</span><span class="op" id="4054081">]</span>&nbsp;<span class="op" id="4054083">+</span>&nbsp;<span class="ident" id="4054085">strings</span><span class="op" id="4054092">.</span><span class="ident" id="4054093">ToLower</span><span class="op" id="4054100">(</span><span class="ident" id="4054101">method</span><span class="op" id="4054107">[</span><span class="num" id="4054108">1</span><span class="op" id="4054109">:</span><span class="op" id="4054110">]</span><span class="op" id="4054111">)</span><span class="op" id="4054112">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4054116">URL</span><span class="op" id="4054119">:</span>&nbsp;<span class="ident" id="4054121">urlStr</span><span class="op" id="4054127">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4054131">Err</span><span class="op" id="4054134">:</span>&nbsp;<span class="ident" id="4054136">err</span><span class="op" id="4054139">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4054142">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4054146">if</span>&nbsp;<span class="ident" id="4054149">redirectFailed</span>&nbsp;<span class="op" id="4054164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4054168">//&nbsp;Special&nbsp;case&nbsp;for&nbsp;Go&nbsp;1&nbsp;compatibility:&nbsp;return&nbsp;both&nbsp;the&nbsp;response</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4054235">//&nbsp;and&nbsp;an&nbsp;error&nbsp;if&nbsp;the&nbsp;CheckRedirect&nbsp;function&nbsp;failed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4054291">//&nbsp;See&nbsp;http://golang.org/issue/3795</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4054329">return</span>&nbsp;<span class="ident" id="4054336">resp</span><span class="op" id="4054340">,</span>&nbsp;<span class="ident" id="4054342">urlErr</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4054350">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4054354">if</span>&nbsp;<span class="ident" id="4054357">resp</span>&nbsp;<span class="op" id="4054362">!=</span>&nbsp;<span class="builtintype" id="4054365">nil</span>&nbsp;<span class="op" id="4054369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4054373">resp</span><span class="op" id="4054377">.</span><span class="ident" id="4054378">Body</span><span class="op" id="4054382">.</span><span class="ident" id="4054383">Close</span><span class="op" id="4054388">(</span><span class="op" id="4054389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4054392">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4054395">return</span>&nbsp;<span class="builtintype" id="4054402">nil</span><span class="op" id="4054405">,</span>&nbsp;<span class="ident" id="4054407">urlErr</span><br>
<span class="lineno"></span><span class="op" id="4054414">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4054417">func</span>&nbsp;<span class="ident" id="4054422">defaultCheckRedirect</span><span class="op" id="4054442">(</span><span class="ident" id="4054443">req</span>&nbsp;<span class="op" id="4054447">*</span><span class="ident" id="4054448">Request</span><span class="op" id="4054455">,</span>&nbsp;<span class="ident" id="4054457">via</span>&nbsp;<span class="op" id="4054461">[</span><span class="op" id="4054462">]</span><span class="op" id="4054463">*</span><span class="ident" id="4054464">Request</span><span class="op" id="4054471">)</span>&nbsp;<span class="builtintype" id="4054473">error</span>&nbsp;<span class="op" id="4054479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4054482">if</span>&nbsp;<span class="builtinfunc" id="4054485">len</span><span class="op" id="4054488">(</span><span class="ident" id="4054489">via</span><span class="op" id="4054492">)</span>&nbsp;<span class="op" id="4054494">&gt;=</span>&nbsp;<span class="num" id="4054497">10</span>&nbsp;<span class="op" id="4054500">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4054504">return</span>&nbsp;<span class="ident" id="4054511">errors</span><span class="op" id="4054517">.</span><span class="ident" id="4054518">New</span><span class="op" id="4054521">(</span><span class="string" id="4054522">&#34;stopped&nbsp;after&nbsp;10&nbsp;redirects&#34;</span><span class="op" id="4054550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4054553">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4054556">return</span>&nbsp;<span class="builtintype" id="4054563">nil</span><br>
<span class="lineno"></span><span class="op" id="4054567">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">420</span><span class="comment" id="4054570">//&nbsp;Post&nbsp;issues&nbsp;a&nbsp;POST&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL.</span><br>
<span class="lineno"></span><span class="comment" id="4054614">//</span><br>
<span class="lineno"></span><span class="comment" id="4054617">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="4054677">//</span><br>
<span class="lineno"></span><span class="comment" id="4054680">//&nbsp;Post&nbsp;is&nbsp;a&nbsp;wrapper&nbsp;around&nbsp;DefaultClient.Post</span><br>
<span class="lineno">425</span><span class="keyword" id="4054727">func</span>&nbsp;<span class="ident" id="4054732">Post</span><span class="op" id="4054736">(</span><span class="ident" id="4054737">url</span>&nbsp;<span class="builtintype" id="4054741">string</span><span class="op" id="4054747">,</span>&nbsp;<span class="ident" id="4054749">bodyType</span>&nbsp;<span class="builtintype" id="4054758">string</span><span class="op" id="4054764">,</span>&nbsp;<span class="ident" id="4054766">body</span>&nbsp;<span class="ident" id="4054771">io</span><span class="op" id="4054773">.</span><span class="ident" id="4054774">Reader</span><span class="op" id="4054780">)</span>&nbsp;<span class="op" id="4054782">(</span><span class="ident" id="4054783">resp</span>&nbsp;<span class="op" id="4054788">*</span><span class="ident" id="4054789">Response</span><span class="op" id="4054797">,</span>&nbsp;<span class="ident" id="4054799">err</span>&nbsp;<span class="builtintype" id="4054803">error</span><span class="op" id="4054808">)</span>&nbsp;<span class="op" id="4054810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4054813">return</span>&nbsp;<span class="ident" id="4054820">DefaultClient</span><span class="op" id="4054833">.</span><span class="ident" id="4054834">Post</span><span class="op" id="4054838">(</span><span class="ident" id="4054839">url</span><span class="op" id="4054842">,</span>&nbsp;<span class="ident" id="4054844">bodyType</span><span class="op" id="4054852">,</span>&nbsp;<span class="ident" id="4054854">body</span><span class="op" id="4054858">)</span><br>
<span class="lineno"></span><span class="op" id="4054860">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4054863">//&nbsp;Post&nbsp;issues&nbsp;a&nbsp;POST&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL.</span><br>
<span class="lineno">430</span><span class="comment" id="4054907">//</span><br>
<span class="lineno"></span><span class="comment" id="4054910">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="4054970">//</span><br>
<span class="lineno"></span><span class="comment" id="4054973">//&nbsp;If&nbsp;the&nbsp;provided&nbsp;body&nbsp;is&nbsp;also&nbsp;an&nbsp;io.Closer,&nbsp;it&nbsp;is&nbsp;closed&nbsp;after&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4055042">//&nbsp;request.</span><br>
<span class="lineno">435</span><span class="keyword" id="4055054">func</span>&nbsp;<span class="op" id="4055059">(</span><span class="ident" id="4055060">c</span>&nbsp;<span class="op" id="4055062">*</span><span class="ident" id="4055063">Client</span><span class="op" id="4055069">)</span>&nbsp;<span class="ident" id="4055071">Post</span><span class="op" id="4055075">(</span><span class="ident" id="4055076">url</span>&nbsp;<span class="builtintype" id="4055080">string</span><span class="op" id="4055086">,</span>&nbsp;<span class="ident" id="4055088">bodyType</span>&nbsp;<span class="builtintype" id="4055097">string</span><span class="op" id="4055103">,</span>&nbsp;<span class="ident" id="4055105">body</span>&nbsp;<span class="ident" id="4055110">io</span><span class="op" id="4055112">.</span><span class="ident" id="4055113">Reader</span><span class="op" id="4055119">)</span>&nbsp;<span class="op" id="4055121">(</span><span class="ident" id="4055122">resp</span>&nbsp;<span class="op" id="4055127">*</span><span class="ident" id="4055128">Response</span><span class="op" id="4055136">,</span>&nbsp;<span class="ident" id="4055138">err</span>&nbsp;<span class="builtintype" id="4055142">error</span><span class="op" id="4055147">)</span>&nbsp;<span class="op" id="4055149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4055152">req</span><span class="op" id="4055155">,</span>&nbsp;<span class="ident" id="4055157">err</span>&nbsp;<span class="op" id="4055161">:=</span>&nbsp;<span class="ident" id="4055164">NewRequest</span><span class="op" id="4055174">(</span><span class="string" id="4055175">&#34;POST&#34;</span><span class="op" id="4055181">,</span>&nbsp;<span class="ident" id="4055183">url</span><span class="op" id="4055186">,</span>&nbsp;<span class="ident" id="4055188">body</span><span class="op" id="4055192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4055195">if</span>&nbsp;<span class="ident" id="4055198">err</span>&nbsp;<span class="op" id="4055202">!=</span>&nbsp;<span class="builtintype" id="4055205">nil</span>&nbsp;<span class="op" id="4055209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4055213">return</span>&nbsp;<span class="builtintype" id="4055220">nil</span><span class="op" id="4055223">,</span>&nbsp;<span class="ident" id="4055225">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4055230">}</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4055233">req</span><span class="op" id="4055236">.</span><span class="ident" id="4055237">Header</span><span class="op" id="4055243">.</span><span class="ident" id="4055244">Set</span><span class="op" id="4055247">(</span><span class="string" id="4055248">&#34;Content-Type&#34;</span><span class="op" id="4055262">,</span>&nbsp;<span class="ident" id="4055264">bodyType</span><span class="op" id="4055272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4055275">return</span>&nbsp;<span class="ident" id="4055282">c</span><span class="op" id="4055283">.</span><span class="ident" id="4055284">doFollowingRedirects</span><span class="op" id="4055304">(</span><span class="ident" id="4055305">req</span><span class="op" id="4055308">,</span>&nbsp;<span class="ident" id="4055310">shouldRedirectPost</span><span class="op" id="4055328">)</span><br>
<span class="lineno"></span><span class="op" id="4055330">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4055333">//&nbsp;PostForm&nbsp;issues&nbsp;a&nbsp;POST&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL,&nbsp;with&nbsp;data&#39;s&nbsp;keys&nbsp;and</span><br>
<span class="lineno">445</span><span class="comment" id="4055402">//&nbsp;values&nbsp;URL-encoded&nbsp;as&nbsp;the&nbsp;request&nbsp;body.</span><br>
<span class="lineno"></span><span class="comment" id="4055445">//</span><br>
<span class="lineno"></span><span class="comment" id="4055448">//&nbsp;When&nbsp;err&nbsp;is&nbsp;nil,&nbsp;resp&nbsp;always&nbsp;contains&nbsp;a&nbsp;non-nil&nbsp;resp.Body.</span><br>
<span class="lineno"></span><span class="comment" id="4055510">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="4055570">//</span><br>
<span class="lineno">450</span><span class="comment" id="4055573">//&nbsp;PostForm&nbsp;is&nbsp;a&nbsp;wrapper&nbsp;around&nbsp;DefaultClient.PostForm</span><br>
<span class="lineno"></span><span class="keyword" id="4055628">func</span>&nbsp;<span class="ident" id="4055633">PostForm</span><span class="op" id="4055641">(</span><span class="ident" id="4055642">url</span>&nbsp;<span class="builtintype" id="4055646">string</span><span class="op" id="4055652">,</span>&nbsp;<span class="ident" id="4055654">data</span>&nbsp;<span class="ident" id="4055659">url</span><span class="op" id="4055662">.</span><span class="ident" id="4055663">Values</span><span class="op" id="4055669">)</span>&nbsp;<span class="op" id="4055671">(</span><span class="ident" id="4055672">resp</span>&nbsp;<span class="op" id="4055677">*</span><span class="ident" id="4055678">Response</span><span class="op" id="4055686">,</span>&nbsp;<span class="ident" id="4055688">err</span>&nbsp;<span class="builtintype" id="4055692">error</span><span class="op" id="4055697">)</span>&nbsp;<span class="op" id="4055699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4055702">return</span>&nbsp;<span class="ident" id="4055709">DefaultClient</span><span class="op" id="4055722">.</span><span class="ident" id="4055723">PostForm</span><span class="op" id="4055731">(</span><span class="ident" id="4055732">url</span><span class="op" id="4055735">,</span>&nbsp;<span class="ident" id="4055737">data</span><span class="op" id="4055741">)</span><br>
<span class="lineno"></span><span class="op" id="4055743">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">455</span><span class="comment" id="4055746">//&nbsp;PostForm&nbsp;issues&nbsp;a&nbsp;POST&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL,</span><br>
<span class="lineno"></span><span class="comment" id="4055794">//&nbsp;with&nbsp;data&#39;s&nbsp;keys&nbsp;and&nbsp;values&nbsp;urlencoded&nbsp;as&nbsp;the&nbsp;request&nbsp;body.</span><br>
<span class="lineno"></span><span class="comment" id="4055857">//</span><br>
<span class="lineno"></span><span class="comment" id="4055860">//&nbsp;When&nbsp;err&nbsp;is&nbsp;nil,&nbsp;resp&nbsp;always&nbsp;contains&nbsp;a&nbsp;non-nil&nbsp;resp.Body.</span><br>
<span class="lineno"></span><span class="comment" id="4055922">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno">460</span><span class="keyword" id="4055982">func</span>&nbsp;<span class="op" id="4055987">(</span><span class="ident" id="4055988">c</span>&nbsp;<span class="op" id="4055990">*</span><span class="ident" id="4055991">Client</span><span class="op" id="4055997">)</span>&nbsp;<span class="ident" id="4055999">PostForm</span><span class="op" id="4056007">(</span><span class="ident" id="4056008">url</span>&nbsp;<span class="builtintype" id="4056012">string</span><span class="op" id="4056018">,</span>&nbsp;<span class="ident" id="4056020">data</span>&nbsp;<span class="ident" id="4056025">url</span><span class="op" id="4056028">.</span><span class="ident" id="4056029">Values</span><span class="op" id="4056035">)</span>&nbsp;<span class="op" id="4056037">(</span><span class="ident" id="4056038">resp</span>&nbsp;<span class="op" id="4056043">*</span><span class="ident" id="4056044">Response</span><span class="op" id="4056052">,</span>&nbsp;<span class="ident" id="4056054">err</span>&nbsp;<span class="builtintype" id="4056058">error</span><span class="op" id="4056063">)</span>&nbsp;<span class="op" id="4056065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4056068">return</span>&nbsp;<span class="ident" id="4056075">c</span><span class="op" id="4056076">.</span><span class="ident" id="4056077">Post</span><span class="op" id="4056081">(</span><span class="ident" id="4056082">url</span><span class="op" id="4056085">,</span>&nbsp;<span class="string" id="4056087">&#34;application/x-www-form-urlencoded&#34;</span><span class="op" id="4056122">,</span>&nbsp;<span class="ident" id="4056124">strings</span><span class="op" id="4056131">.</span><span class="ident" id="4056132">NewReader</span><span class="op" id="4056141">(</span><span class="ident" id="4056142">data</span><span class="op" id="4056146">.</span><span class="ident" id="4056147">Encode</span><span class="op" id="4056153">(</span><span class="op" id="4056154">)</span><span class="op" id="4056155">)</span><span class="op" id="4056156">)</span><br>
<span class="lineno"></span><span class="op" id="4056158">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4056161">//&nbsp;Head&nbsp;issues&nbsp;a&nbsp;HEAD&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL.&nbsp;&nbsp;If&nbsp;the&nbsp;response&nbsp;is&nbsp;one&nbsp;of&nbsp;the</span><br>
<span class="lineno">465</span><span class="comment" id="4056236">//&nbsp;following&nbsp;redirect&nbsp;codes,&nbsp;Head&nbsp;follows&nbsp;the&nbsp;redirect&nbsp;after&nbsp;calling&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4056309">//&nbsp;Client&#39;s&nbsp;CheckRedirect&nbsp;function.</span><br>
<span class="lineno"></span><span class="comment" id="4056345">//</span><br>
<span class="lineno"></span><span class="comment" id="4056348">//&nbsp;&nbsp;&nbsp;&nbsp;301&nbsp;(Moved&nbsp;Permanently)</span><br>
<span class="lineno"></span><span class="comment" id="4056378">//&nbsp;&nbsp;&nbsp;&nbsp;302&nbsp;(Found)</span><br>
<span class="lineno">470</span><span class="comment" id="4056396">//&nbsp;&nbsp;&nbsp;&nbsp;303&nbsp;(See&nbsp;Other)</span><br>
<span class="lineno"></span><span class="comment" id="4056418">//&nbsp;&nbsp;&nbsp;&nbsp;307&nbsp;(Temporary&nbsp;Redirect)</span><br>
<span class="lineno"></span><span class="comment" id="4056449">//</span><br>
<span class="lineno"></span><span class="comment" id="4056452">//&nbsp;Head&nbsp;is&nbsp;a&nbsp;wrapper&nbsp;around&nbsp;DefaultClient.Head</span><br>
<span class="lineno"></span><span class="keyword" id="4056499">func</span>&nbsp;<span class="ident" id="4056504">Head</span><span class="op" id="4056508">(</span><span class="ident" id="4056509">url</span>&nbsp;<span class="builtintype" id="4056513">string</span><span class="op" id="4056519">)</span>&nbsp;<span class="op" id="4056521">(</span><span class="ident" id="4056522">resp</span>&nbsp;<span class="op" id="4056527">*</span><span class="ident" id="4056528">Response</span><span class="op" id="4056536">,</span>&nbsp;<span class="ident" id="4056538">err</span>&nbsp;<span class="builtintype" id="4056542">error</span><span class="op" id="4056547">)</span>&nbsp;<span class="op" id="4056549">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4056552">return</span>&nbsp;<span class="ident" id="4056559">DefaultClient</span><span class="op" id="4056572">.</span><span class="ident" id="4056573">Head</span><span class="op" id="4056577">(</span><span class="ident" id="4056578">url</span><span class="op" id="4056581">)</span><br>
<span class="lineno"></span><span class="op" id="4056583">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4056586">//&nbsp;Head&nbsp;issues&nbsp;a&nbsp;HEAD&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL.&nbsp;&nbsp;If&nbsp;the&nbsp;response&nbsp;is&nbsp;one&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4056661">//&nbsp;following&nbsp;redirect&nbsp;codes,&nbsp;Head&nbsp;follows&nbsp;the&nbsp;redirect&nbsp;after&nbsp;calling&nbsp;the</span><br>
<span class="lineno">480</span><span class="comment" id="4056734">//&nbsp;Client&#39;s&nbsp;CheckRedirect&nbsp;function.</span><br>
<span class="lineno"></span><span class="comment" id="4056770">//</span><br>
<span class="lineno"></span><span class="comment" id="4056773">//&nbsp;&nbsp;&nbsp;&nbsp;301&nbsp;(Moved&nbsp;Permanently)</span><br>
<span class="lineno"></span><span class="comment" id="4056803">//&nbsp;&nbsp;&nbsp;&nbsp;302&nbsp;(Found)</span><br>
<span class="lineno"></span><span class="comment" id="4056821">//&nbsp;&nbsp;&nbsp;&nbsp;303&nbsp;(See&nbsp;Other)</span><br>
<span class="lineno">485</span><span class="comment" id="4056843">//&nbsp;&nbsp;&nbsp;&nbsp;307&nbsp;(Temporary&nbsp;Redirect)</span><br>
<span class="lineno"></span><span class="keyword" id="4056874">func</span>&nbsp;<span class="op" id="4056879">(</span><span class="ident" id="4056880">c</span>&nbsp;<span class="op" id="4056882">*</span><span class="ident" id="4056883">Client</span><span class="op" id="4056889">)</span>&nbsp;<span class="ident" id="4056891">Head</span><span class="op" id="4056895">(</span><span class="ident" id="4056896">url</span>&nbsp;<span class="builtintype" id="4056900">string</span><span class="op" id="4056906">)</span>&nbsp;<span class="op" id="4056908">(</span><span class="ident" id="4056909">resp</span>&nbsp;<span class="op" id="4056914">*</span><span class="ident" id="4056915">Response</span><span class="op" id="4056923">,</span>&nbsp;<span class="ident" id="4056925">err</span>&nbsp;<span class="builtintype" id="4056929">error</span><span class="op" id="4056934">)</span>&nbsp;<span class="op" id="4056936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4056939">req</span><span class="op" id="4056942">,</span>&nbsp;<span class="ident" id="4056944">err</span>&nbsp;<span class="op" id="4056948">:=</span>&nbsp;<span class="ident" id="4056951">NewRequest</span><span class="op" id="4056961">(</span><span class="string" id="4056962">&#34;HEAD&#34;</span><span class="op" id="4056968">,</span>&nbsp;<span class="ident" id="4056970">url</span><span class="op" id="4056973">,</span>&nbsp;<span class="builtintype" id="4056975">nil</span><span class="op" id="4056978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4056981">if</span>&nbsp;<span class="ident" id="4056984">err</span>&nbsp;<span class="op" id="4056988">!=</span>&nbsp;<span class="builtintype" id="4056991">nil</span>&nbsp;<span class="op" id="4056995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4056999">return</span>&nbsp;<span class="builtintype" id="4057006">nil</span><span class="op" id="4057009">,</span>&nbsp;<span class="ident" id="4057011">err</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4057016">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4057019">return</span>&nbsp;<span class="ident" id="4057026">c</span><span class="op" id="4057027">.</span><span class="ident" id="4057028">doFollowingRedirects</span><span class="op" id="4057048">(</span><span class="ident" id="4057049">req</span><span class="op" id="4057052">,</span>&nbsp;<span class="ident" id="4057054">shouldRedirectGet</span><span class="op" id="4057071">)</span><br>
<span class="lineno"></span><span class="op" id="4057073">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4057076">type</span>&nbsp;<span class="ident" id="4057081">cancelTimerBody</span>&nbsp;<span class="keyword" id="4057097">struct</span>&nbsp;<span class="op" id="4057104">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4057107">t</span>&nbsp;&nbsp;<span class="op" id="4057110">*</span><span class="ident" id="4057111">time</span><span class="op" id="4057115">.</span><span class="ident" id="4057116">Timer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4057123">rc</span>&nbsp;<span class="ident" id="4057126">io</span><span class="op" id="4057128">.</span><span class="ident" id="4057129">ReadCloser</span><br>
<span class="lineno"></span><span class="op" id="4057140">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4057143">func</span>&nbsp;<span class="op" id="4057148">(</span><span class="ident" id="4057149">b</span>&nbsp;<span class="op" id="4057151">*</span><span class="ident" id="4057152">cancelTimerBody</span><span class="op" id="4057167">)</span>&nbsp;<span class="ident" id="4057169">Read</span><span class="op" id="4057173">(</span><span class="ident" id="4057174">p</span>&nbsp;<span class="op" id="4057176">[</span><span class="op" id="4057177">]</span><span class="builtintype" id="4057178">byte</span><span class="op" id="4057182">)</span>&nbsp;<span class="op" id="4057184">(</span><span class="ident" id="4057185">n</span>&nbsp;<span class="builtintype" id="4057187">int</span><span class="op" id="4057190">,</span>&nbsp;<span class="ident" id="4057192">err</span>&nbsp;<span class="builtintype" id="4057196">error</span><span class="op" id="4057201">)</span>&nbsp;<span class="op" id="4057203">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4057206">n</span><span class="op" id="4057207">,</span>&nbsp;<span class="ident" id="4057209">err</span>&nbsp;<span class="op" id="4057213">=</span>&nbsp;<span class="ident" id="4057215">b</span><span class="op" id="4057216">.</span><span class="ident" id="4057217">rc</span><span class="op" id="4057219">.</span><span class="ident" id="4057220">Read</span><span class="op" id="4057224">(</span><span class="ident" id="4057225">p</span><span class="op" id="4057226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4057229">if</span>&nbsp;<span class="ident" id="4057232">err</span>&nbsp;<span class="op" id="4057236">==</span>&nbsp;<span class="ident" id="4057239">io</span><span class="op" id="4057241">.</span><span class="ident" id="4057242">EOF</span>&nbsp;<span class="op" id="4057246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4057250">b</span><span class="op" id="4057251">.</span><span class="ident" id="4057252">t</span><span class="op" id="4057253">.</span><span class="ident" id="4057254">Stop</span><span class="op" id="4057258">(</span><span class="op" id="4057259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4057262">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4057265">return</span><br>
<span class="lineno">505</span><span class="op" id="4057272">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4057275">func</span>&nbsp;<span class="op" id="4057280">(</span><span class="ident" id="4057281">b</span>&nbsp;<span class="op" id="4057283">*</span><span class="ident" id="4057284">cancelTimerBody</span><span class="op" id="4057299">)</span>&nbsp;<span class="ident" id="4057301">Close</span><span class="op" id="4057306">(</span><span class="op" id="4057307">)</span>&nbsp;<span class="builtintype" id="4057309">error</span>&nbsp;<span class="op" id="4057315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4057318">err</span>&nbsp;<span class="op" id="4057322">:=</span>&nbsp;<span class="ident" id="4057325">b</span><span class="op" id="4057326">.</span><span class="ident" id="4057327">rc</span><span class="op" id="4057329">.</span><span class="ident" id="4057330">Close</span><span class="op" id="4057335">(</span><span class="op" id="4057336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4057339">b</span><span class="op" id="4057340">.</span><span class="ident" id="4057341">t</span><span class="op" id="4057342">.</span><span class="ident" id="4057343">Stop</span><span class="op" id="4057347">(</span><span class="op" id="4057348">)</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4057351">return</span>&nbsp;<span class="ident" id="4057358">err</span><br>
<span class="lineno"></span><span class="op" id="4057362">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
