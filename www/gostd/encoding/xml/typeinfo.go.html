<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/xml</h2>
<ul>
<li><a href="/gostd/encoding/xml/atom_test.go.html">atom_test.go</a></li>
<li><a href="/gostd/encoding/xml/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/xml/marshal.go.html">marshal.go</a></li>
<li><a href="/gostd/encoding/xml/marshal_test.go.html">marshal_test.go</a></li>
<li><a href="/gostd/encoding/xml/read.go.html">read.go</a></li>
<li><a href="/gostd/encoding/xml/read_test.go.html">read_test.go</a></li>
<li><a href="/gostd/encoding/xml/typeinfo.go.html">typeinfo.go</a></li>
<li><a href="/gostd/encoding/xml/xml.go.html">xml.go</a></li>
<li><a href="/gostd/encoding/xml/xml_test.go.html">xml_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6081947">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6082003">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6082057">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6082108">package</span>&nbsp;<span class="ident" id="6082116">xml</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6082121">import</span>&nbsp;<span class="op" id="6082128">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6082131">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6082138">&#34;reflect&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6082149">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6082160">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="6082167">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6082170">//&nbsp;typeInfo&nbsp;holds&nbsp;details&nbsp;for&nbsp;the&nbsp;xml&nbsp;representation&nbsp;of&nbsp;a&nbsp;type.</span><br>
<span class="lineno">15</span><span class="keyword" id="6082234">type</span>&nbsp;<span class="ident" id="6082239">typeInfo</span>&nbsp;<span class="keyword" id="6082248">struct</span>&nbsp;<span class="op" id="6082255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082258">xmlname</span>&nbsp;<span class="op" id="6082266">*</span><span class="ident" id="6082267">fieldInfo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082278">fields</span>&nbsp;&nbsp;<span class="op" id="6082286">[</span><span class="op" id="6082287">]</span><span class="ident" id="6082288">fieldInfo</span><br>
<span class="lineno"></span><span class="op" id="6082298">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="6082301">//&nbsp;fieldInfo&nbsp;holds&nbsp;details&nbsp;for&nbsp;the&nbsp;xml&nbsp;representation&nbsp;of&nbsp;a&nbsp;single&nbsp;field.</span><br>
<span class="lineno"></span><span class="keyword" id="6082374">type</span>&nbsp;<span class="ident" id="6082379">fieldInfo</span>&nbsp;<span class="keyword" id="6082389">struct</span>&nbsp;<span class="op" id="6082396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082399">idx</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6082407">[</span><span class="op" id="6082408">]</span><span class="builtintype" id="6082409">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082414">name</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6082422">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082430">xmlns</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6082438">string</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082446">flags</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6082454">fieldFlags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082466">parents</span>&nbsp;<span class="op" id="6082474">[</span><span class="op" id="6082475">]</span><span class="builtintype" id="6082476">string</span><br>
<span class="lineno"></span><span class="op" id="6082483">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6082486">type</span>&nbsp;<span class="ident" id="6082491">fieldFlags</span>&nbsp;<span class="builtintype" id="6082502">int</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="keyword" id="6082507">const</span>&nbsp;<span class="op" id="6082513">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082516">fElement</span>&nbsp;<span class="ident" id="6082525">fieldFlags</span>&nbsp;<span class="op" id="6082536">=</span>&nbsp;<span class="num" id="6082538">1</span>&nbsp;<span class="op" id="6082540">&lt;&lt;</span>&nbsp;<span class="ident" id="6082543">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082549">fAttr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082556">fCharData</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082567">fInnerXml</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082578">fComment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082588">fAny</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082595">fOmitEmpty</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082608">fMode</span>&nbsp;<span class="op" id="6082614">=</span>&nbsp;<span class="ident" id="6082616">fElement</span>&nbsp;<span class="op" id="6082625">|</span>&nbsp;<span class="ident" id="6082627">fAttr</span>&nbsp;<span class="op" id="6082633">|</span>&nbsp;<span class="ident" id="6082635">fCharData</span>&nbsp;<span class="op" id="6082645">|</span>&nbsp;<span class="ident" id="6082647">fInnerXml</span>&nbsp;<span class="op" id="6082657">|</span>&nbsp;<span class="ident" id="6082659">fComment</span>&nbsp;<span class="op" id="6082668">|</span>&nbsp;<span class="ident" id="6082670">fAny</span><br>
<span class="lineno"></span><span class="op" id="6082675">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6082678">var</span>&nbsp;<span class="ident" id="6082682">tinfoMap</span>&nbsp;<span class="op" id="6082691">=</span>&nbsp;<span class="builtinfunc" id="6082693">make</span><span class="op" id="6082697">(</span><span class="keyword" id="6082698">map</span><span class="op" id="6082701">[</span><span class="ident" id="6082702">reflect</span><span class="op" id="6082709">.</span><span class="ident" id="6082710">Type</span><span class="op" id="6082714">]</span><span class="op" id="6082715">*</span><span class="ident" id="6082716">typeInfo</span><span class="op" id="6082724">)</span><br>
<span class="lineno">45</span><span class="keyword" id="6082726">var</span>&nbsp;<span class="ident" id="6082730">tinfoLock</span>&nbsp;<span class="ident" id="6082740">sync</span><span class="op" id="6082744">.</span><span class="ident" id="6082745">RWMutex</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6082754">var</span>&nbsp;<span class="ident" id="6082758">nameType</span>&nbsp;<span class="op" id="6082767">=</span>&nbsp;<span class="ident" id="6082769">reflect</span><span class="op" id="6082776">.</span><span class="ident" id="6082777">TypeOf</span><span class="op" id="6082783">(</span><span class="ident" id="6082784">Name</span><span class="op" id="6082788">{</span><span class="op" id="6082789">}</span><span class="op" id="6082790">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6082793">//&nbsp;getTypeInfo&nbsp;returns&nbsp;the&nbsp;typeInfo&nbsp;structure&nbsp;with&nbsp;details&nbsp;necessary</span><br>
<span class="lineno">50</span><span class="comment" id="6082862">//&nbsp;for&nbsp;marshalling&nbsp;and&nbsp;unmarshalling&nbsp;typ.</span><br>
<span class="lineno"></span><span class="keyword" id="6082904">func</span>&nbsp;<span class="ident" id="6082909">getTypeInfo</span><span class="op" id="6082920">(</span><span class="ident" id="6082921">typ</span>&nbsp;<span class="ident" id="6082925">reflect</span><span class="op" id="6082932">.</span><span class="ident" id="6082933">Type</span><span class="op" id="6082937">)</span>&nbsp;<span class="op" id="6082939">(</span><span class="op" id="6082940">*</span><span class="ident" id="6082941">typeInfo</span><span class="op" id="6082949">,</span>&nbsp;<span class="builtintype" id="6082951">error</span><span class="op" id="6082956">)</span>&nbsp;<span class="op" id="6082958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082961">tinfoLock</span><span class="op" id="6082970">.</span><span class="ident" id="6082971">RLock</span><span class="op" id="6082976">(</span><span class="op" id="6082977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082980">tinfo</span><span class="op" id="6082985">,</span>&nbsp;<span class="ident" id="6082987">ok</span>&nbsp;<span class="op" id="6082990">:=</span>&nbsp;<span class="ident" id="6082993">tinfoMap</span><span class="op" id="6083001">[</span><span class="ident" id="6083002">typ</span><span class="op" id="6083005">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083008">tinfoLock</span><span class="op" id="6083017">.</span><span class="ident" id="6083018">RUnlock</span><span class="op" id="6083025">(</span><span class="op" id="6083026">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6083029">if</span>&nbsp;<span class="ident" id="6083032">ok</span>&nbsp;<span class="op" id="6083035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6083039">return</span>&nbsp;<span class="ident" id="6083046">tinfo</span><span class="op" id="6083051">,</span>&nbsp;<span class="ident" id="6083053">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6083058">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083061">tinfo</span>&nbsp;<span class="op" id="6083067">=</span>&nbsp;<span class="op" id="6083069">&amp;</span><span class="ident" id="6083070">typeInfo</span><span class="op" id="6083078">{</span><span class="op" id="6083079">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6083082">if</span>&nbsp;<span class="ident" id="6083085">typ</span><span class="op" id="6083088">.</span><span class="ident" id="6083089">Kind</span><span class="op" id="6083093">(</span><span class="op" id="6083094">)</span>&nbsp;<span class="op" id="6083096">==</span>&nbsp;<span class="ident" id="6083099">reflect</span><span class="op" id="6083106">.</span><span class="ident" id="6083107">Struct</span>&nbsp;<span class="op" id="6083114">&amp;&amp;</span>&nbsp;<span class="ident" id="6083117">typ</span>&nbsp;<span class="op" id="6083121">!=</span>&nbsp;<span class="ident" id="6083124">nameType</span>&nbsp;<span class="op" id="6083133">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083137">n</span>&nbsp;<span class="op" id="6083139">:=</span>&nbsp;<span class="ident" id="6083142">typ</span><span class="op" id="6083145">.</span><span class="ident" id="6083146">NumField</span><span class="op" id="6083154">(</span><span class="op" id="6083155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6083159">for</span>&nbsp;<span class="ident" id="6083163">i</span>&nbsp;<span class="op" id="6083165">:=</span>&nbsp;<span class="num" id="6083168">0</span><span class="op" id="6083169">;</span>&nbsp;<span class="ident" id="6083171">i</span>&nbsp;<span class="op" id="6083173">&lt;</span>&nbsp;<span class="ident" id="6083175">n</span><span class="op" id="6083176">;</span>&nbsp;<span class="ident" id="6083178">i</span><span class="op" id="6083179">++</span>&nbsp;<span class="op" id="6083182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083187">f</span>&nbsp;<span class="op" id="6083189">:=</span>&nbsp;<span class="ident" id="6083192">typ</span><span class="op" id="6083195">.</span><span class="ident" id="6083196">Field</span><span class="op" id="6083201">(</span><span class="ident" id="6083202">i</span><span class="op" id="6083203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6083208">if</span>&nbsp;<span class="ident" id="6083211">f</span><span class="op" id="6083212">.</span><span class="ident" id="6083213">PkgPath</span>&nbsp;<span class="op" id="6083221">!=</span>&nbsp;<span class="string" id="6083224">&#34;&#34;</span>&nbsp;<span class="op" id="6083227">||</span>&nbsp;<span class="ident" id="6083230">f</span><span class="op" id="6083231">.</span><span class="ident" id="6083232">Tag</span><span class="op" id="6083235">.</span><span class="ident" id="6083236">Get</span><span class="op" id="6083239">(</span><span class="string" id="6083240">&#34;xml&#34;</span><span class="op" id="6083245">)</span>&nbsp;<span class="op" id="6083247">==</span>&nbsp;<span class="string" id="6083250">&#34;-&#34;</span>&nbsp;<span class="op" id="6083254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6083260">continue</span>&nbsp;<span class="comment" id="6083269">//&nbsp;Private&nbsp;field</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6083289">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6083295">//&nbsp;For&nbsp;embedded&nbsp;structs,&nbsp;embed&nbsp;its&nbsp;fields.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6083341">if</span>&nbsp;<span class="ident" id="6083344">f</span><span class="op" id="6083345">.</span><span class="ident" id="6083346">Anonymous</span>&nbsp;<span class="op" id="6083356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083362">t</span>&nbsp;<span class="op" id="6083364">:=</span>&nbsp;<span class="ident" id="6083367">f</span><span class="op" id="6083368">.</span><span class="ident" id="6083369">Type</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6083378">if</span>&nbsp;<span class="ident" id="6083381">t</span><span class="op" id="6083382">.</span><span class="ident" id="6083383">Kind</span><span class="op" id="6083387">(</span><span class="op" id="6083388">)</span>&nbsp;<span class="op" id="6083390">==</span>&nbsp;<span class="ident" id="6083393">reflect</span><span class="op" id="6083400">.</span><span class="ident" id="6083401">Ptr</span>&nbsp;<span class="op" id="6083405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083412">t</span>&nbsp;<span class="op" id="6083414">=</span>&nbsp;<span class="ident" id="6083416">t</span><span class="op" id="6083417">.</span><span class="ident" id="6083418">Elem</span><span class="op" id="6083422">(</span><span class="op" id="6083423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6083429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6083435">if</span>&nbsp;<span class="ident" id="6083438">t</span><span class="op" id="6083439">.</span><span class="ident" id="6083440">Kind</span><span class="op" id="6083444">(</span><span class="op" id="6083445">)</span>&nbsp;<span class="op" id="6083447">==</span>&nbsp;<span class="ident" id="6083450">reflect</span><span class="op" id="6083457">.</span><span class="ident" id="6083458">Struct</span>&nbsp;<span class="op" id="6083465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083472">inner</span><span class="op" id="6083477">,</span>&nbsp;<span class="ident" id="6083479">err</span>&nbsp;<span class="op" id="6083483">:=</span>&nbsp;<span class="ident" id="6083486">getTypeInfo</span><span class="op" id="6083497">(</span><span class="ident" id="6083498">t</span><span class="op" id="6083499">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6083506">if</span>&nbsp;<span class="ident" id="6083509">err</span>&nbsp;<span class="op" id="6083513">!=</span>&nbsp;<span class="ident" id="6083516">nil</span>&nbsp;<span class="op" id="6083520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6083528">return</span>&nbsp;<span class="ident" id="6083535">nil</span><span class="op" id="6083538">,</span>&nbsp;<span class="ident" id="6083540">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6083549">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6083556">if</span>&nbsp;<span class="ident" id="6083559">tinfo</span><span class="op" id="6083564">.</span><span class="ident" id="6083565">xmlname</span>&nbsp;<span class="op" id="6083573">==</span>&nbsp;<span class="ident" id="6083576">nil</span>&nbsp;<span class="op" id="6083580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083588">tinfo</span><span class="op" id="6083593">.</span><span class="ident" id="6083594">xmlname</span>&nbsp;<span class="op" id="6083602">=</span>&nbsp;<span class="ident" id="6083604">inner</span><span class="op" id="6083609">.</span><span class="ident" id="6083610">xmlname</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6083623">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6083630">for</span>&nbsp;<span class="ident" id="6083634">_</span><span class="op" id="6083635">,</span>&nbsp;<span class="ident" id="6083637">finfo</span>&nbsp;<span class="op" id="6083643">:=</span>&nbsp;<span class="keyword" id="6083646">range</span>&nbsp;<span class="ident" id="6083652">inner</span><span class="op" id="6083657">.</span><span class="ident" id="6083658">fields</span>&nbsp;<span class="op" id="6083665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083673">finfo</span><span class="op" id="6083678">.</span><span class="ident" id="6083679">idx</span>&nbsp;<span class="op" id="6083683">=</span>&nbsp;<span class="builtinfunc" id="6083685">append</span><span class="op" id="6083691">(</span><span class="op" id="6083692">[</span><span class="op" id="6083693">]</span><span class="builtintype" id="6083694">int</span><span class="op" id="6083697">{</span><span class="ident" id="6083698">i</span><span class="op" id="6083699">}</span><span class="op" id="6083700">,</span>&nbsp;<span class="ident" id="6083702">finfo</span><span class="op" id="6083707">.</span><span class="ident" id="6083708">idx</span><span class="op" id="6083711">...</span><span class="op" id="6083714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6083722">if</span>&nbsp;<span class="ident" id="6083725">err</span>&nbsp;<span class="op" id="6083729">:=</span>&nbsp;<span class="ident" id="6083732">addFieldInfo</span><span class="op" id="6083744">(</span><span class="ident" id="6083745">typ</span><span class="op" id="6083748">,</span>&nbsp;<span class="ident" id="6083750">tinfo</span><span class="op" id="6083755">,</span>&nbsp;<span class="op" id="6083757">&amp;</span><span class="ident" id="6083758">finfo</span><span class="op" id="6083763">)</span><span class="op" id="6083764">;</span>&nbsp;<span class="ident" id="6083766">err</span>&nbsp;<span class="op" id="6083770">!=</span>&nbsp;<span class="ident" id="6083773">nil</span>&nbsp;<span class="op" id="6083777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6083786">return</span>&nbsp;<span class="ident" id="6083793">nil</span><span class="op" id="6083796">,</span>&nbsp;<span class="ident" id="6083798">err</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6083808">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6083815">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6083822">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6083835">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6083840">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083846">finfo</span><span class="op" id="6083851">,</span>&nbsp;<span class="ident" id="6083853">err</span>&nbsp;<span class="op" id="6083857">:=</span>&nbsp;<span class="ident" id="6083860">structFieldInfo</span><span class="op" id="6083875">(</span><span class="ident" id="6083876">typ</span><span class="op" id="6083879">,</span>&nbsp;<span class="op" id="6083881">&amp;</span><span class="ident" id="6083882">f</span><span class="op" id="6083883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6083888">if</span>&nbsp;<span class="ident" id="6083891">err</span>&nbsp;<span class="op" id="6083895">!=</span>&nbsp;<span class="ident" id="6083898">nil</span>&nbsp;<span class="op" id="6083902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6083908">return</span>&nbsp;<span class="ident" id="6083915">nil</span><span class="op" id="6083918">,</span>&nbsp;<span class="ident" id="6083920">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6083927">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6083933">if</span>&nbsp;<span class="ident" id="6083936">f</span><span class="op" id="6083937">.</span><span class="ident" id="6083938">Name</span>&nbsp;<span class="op" id="6083943">==</span>&nbsp;<span class="string" id="6083946">&#34;XMLName&#34;</span>&nbsp;<span class="op" id="6083956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083962">tinfo</span><span class="op" id="6083967">.</span><span class="ident" id="6083968">xmlname</span>&nbsp;<span class="op" id="6083976">=</span>&nbsp;<span class="ident" id="6083978">finfo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6083988">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6084000">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6084006">//&nbsp;Add&nbsp;the&nbsp;field&nbsp;if&nbsp;it&nbsp;doesn&#39;t&nbsp;conflict&nbsp;with&nbsp;other&nbsp;fields.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6084068">if</span>&nbsp;<span class="ident" id="6084071">err</span>&nbsp;<span class="op" id="6084075">:=</span>&nbsp;<span class="ident" id="6084078">addFieldInfo</span><span class="op" id="6084090">(</span><span class="ident" id="6084091">typ</span><span class="op" id="6084094">,</span>&nbsp;<span class="ident" id="6084096">tinfo</span><span class="op" id="6084101">,</span>&nbsp;<span class="ident" id="6084103">finfo</span><span class="op" id="6084108">)</span><span class="op" id="6084109">;</span>&nbsp;<span class="ident" id="6084111">err</span>&nbsp;<span class="op" id="6084115">!=</span>&nbsp;<span class="ident" id="6084118">nil</span>&nbsp;<span class="op" id="6084122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6084128">return</span>&nbsp;<span class="ident" id="6084135">nil</span><span class="op" id="6084138">,</span>&nbsp;<span class="ident" id="6084140">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6084147">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6084151">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6084154">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084157">tinfoLock</span><span class="op" id="6084166">.</span><span class="ident" id="6084167">Lock</span><span class="op" id="6084171">(</span><span class="op" id="6084172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084175">tinfoMap</span><span class="op" id="6084183">[</span><span class="ident" id="6084184">typ</span><span class="op" id="6084187">]</span>&nbsp;<span class="op" id="6084189">=</span>&nbsp;<span class="ident" id="6084191">tinfo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084198">tinfoLock</span><span class="op" id="6084207">.</span><span class="ident" id="6084208">Unlock</span><span class="op" id="6084214">(</span><span class="op" id="6084215">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6084218">return</span>&nbsp;<span class="ident" id="6084225">tinfo</span><span class="op" id="6084230">,</span>&nbsp;<span class="ident" id="6084232">nil</span><br>
<span class="lineno"></span><span class="op" id="6084236">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6084239">//&nbsp;structFieldInfo&nbsp;builds&nbsp;and&nbsp;returns&nbsp;a&nbsp;fieldInfo&nbsp;for&nbsp;f.</span><br>
<span class="lineno"></span><span class="keyword" id="6084296">func</span>&nbsp;<span class="ident" id="6084301">structFieldInfo</span><span class="op" id="6084316">(</span><span class="ident" id="6084317">typ</span>&nbsp;<span class="ident" id="6084321">reflect</span><span class="op" id="6084328">.</span><span class="ident" id="6084329">Type</span><span class="op" id="6084333">,</span>&nbsp;<span class="ident" id="6084335">f</span>&nbsp;<span class="op" id="6084337">*</span><span class="ident" id="6084338">reflect</span><span class="op" id="6084345">.</span><span class="ident" id="6084346">StructField</span><span class="op" id="6084357">)</span>&nbsp;<span class="op" id="6084359">(</span><span class="op" id="6084360">*</span><span class="ident" id="6084361">fieldInfo</span><span class="op" id="6084370">,</span>&nbsp;<span class="builtintype" id="6084372">error</span><span class="op" id="6084377">)</span>&nbsp;<span class="op" id="6084379">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084382">finfo</span>&nbsp;<span class="op" id="6084388">:=</span>&nbsp;<span class="op" id="6084391">&amp;</span><span class="ident" id="6084392">fieldInfo</span><span class="op" id="6084401">{</span><span class="ident" id="6084402">idx</span><span class="op" id="6084405">:</span>&nbsp;<span class="ident" id="6084407">f</span><span class="op" id="6084408">.</span><span class="ident" id="6084409">Index</span><span class="op" id="6084414">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6084418">//&nbsp;Split&nbsp;the&nbsp;tag&nbsp;from&nbsp;the&nbsp;xml&nbsp;namespace&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084473">tag</span>&nbsp;<span class="op" id="6084477">:=</span>&nbsp;<span class="ident" id="6084480">f</span><span class="op" id="6084481">.</span><span class="ident" id="6084482">Tag</span><span class="op" id="6084485">.</span><span class="ident" id="6084486">Get</span><span class="op" id="6084489">(</span><span class="string" id="6084490">&#34;xml&#34;</span><span class="op" id="6084495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6084498">if</span>&nbsp;<span class="ident" id="6084501">i</span>&nbsp;<span class="op" id="6084503">:=</span>&nbsp;<span class="ident" id="6084506">strings</span><span class="op" id="6084513">.</span><span class="ident" id="6084514">Index</span><span class="op" id="6084519">(</span><span class="ident" id="6084520">tag</span><span class="op" id="6084523">,</span>&nbsp;<span class="string" id="6084525">&#34;&nbsp;&#34;</span><span class="op" id="6084528">)</span><span class="op" id="6084529">;</span>&nbsp;<span class="ident" id="6084531">i</span>&nbsp;<span class="op" id="6084533">&gt;=</span>&nbsp;<span class="num" id="6084536">0</span>&nbsp;<span class="op" id="6084538">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084542">finfo</span><span class="op" id="6084547">.</span><span class="ident" id="6084548">xmlns</span><span class="op" id="6084553">,</span>&nbsp;<span class="ident" id="6084555">tag</span>&nbsp;<span class="op" id="6084559">=</span>&nbsp;<span class="ident" id="6084561">tag</span><span class="op" id="6084564">[</span><span class="op" id="6084565">:</span><span class="ident" id="6084566">i</span><span class="op" id="6084567">]</span><span class="op" id="6084568">,</span>&nbsp;<span class="ident" id="6084570">tag</span><span class="op" id="6084573">[</span><span class="ident" id="6084574">i</span><span class="op" id="6084575">+</span><span class="num" id="6084576">1</span><span class="op" id="6084577">:</span><span class="op" id="6084578">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6084581">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6084585">//&nbsp;Parse&nbsp;flags.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084602">tokens</span>&nbsp;<span class="op" id="6084609">:=</span>&nbsp;<span class="ident" id="6084612">strings</span><span class="op" id="6084619">.</span><span class="ident" id="6084620">Split</span><span class="op" id="6084625">(</span><span class="ident" id="6084626">tag</span><span class="op" id="6084629">,</span>&nbsp;<span class="string" id="6084631">&#34;,&#34;</span><span class="op" id="6084634">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6084637">if</span>&nbsp;<span class="builtinfunc" id="6084640">len</span><span class="op" id="6084643">(</span><span class="ident" id="6084644">tokens</span><span class="op" id="6084650">)</span>&nbsp;<span class="op" id="6084652">==</span>&nbsp;<span class="num" id="6084655">1</span>&nbsp;<span class="op" id="6084657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084661">finfo</span><span class="op" id="6084666">.</span><span class="ident" id="6084667">flags</span>&nbsp;<span class="op" id="6084673">=</span>&nbsp;<span class="ident" id="6084675">fElement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6084685">}</span>&nbsp;<span class="keyword" id="6084687">else</span>&nbsp;<span class="op" id="6084692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084696">tag</span>&nbsp;<span class="op" id="6084700">=</span>&nbsp;<span class="ident" id="6084702">tokens</span><span class="op" id="6084708">[</span><span class="num" id="6084709">0</span><span class="op" id="6084710">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6084714">for</span>&nbsp;<span class="ident" id="6084718">_</span><span class="op" id="6084719">,</span>&nbsp;<span class="ident" id="6084721">flag</span>&nbsp;<span class="op" id="6084726">:=</span>&nbsp;<span class="keyword" id="6084729">range</span>&nbsp;<span class="ident" id="6084735">tokens</span><span class="op" id="6084741">[</span><span class="num" id="6084742">1</span><span class="op" id="6084743">:</span><span class="op" id="6084744">]</span>&nbsp;<span class="op" id="6084746">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6084751">switch</span>&nbsp;<span class="ident" id="6084758">flag</span>&nbsp;<span class="op" id="6084763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6084768">case</span>&nbsp;<span class="string" id="6084773">&#34;attr&#34;</span><span class="op" id="6084779">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084785">finfo</span><span class="op" id="6084790">.</span><span class="ident" id="6084791">flags</span>&nbsp;<span class="op" id="6084797">|=</span>&nbsp;<span class="ident" id="6084800">fAttr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6084809">case</span>&nbsp;<span class="string" id="6084814">&#34;chardata&#34;</span><span class="op" id="6084824">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084830">finfo</span><span class="op" id="6084835">.</span><span class="ident" id="6084836">flags</span>&nbsp;<span class="op" id="6084842">|=</span>&nbsp;<span class="ident" id="6084845">fCharData</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6084858">case</span>&nbsp;<span class="string" id="6084863">&#34;innerxml&#34;</span><span class="op" id="6084873">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084879">finfo</span><span class="op" id="6084884">.</span><span class="ident" id="6084885">flags</span>&nbsp;<span class="op" id="6084891">|=</span>&nbsp;<span class="ident" id="6084894">fInnerXml</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6084907">case</span>&nbsp;<span class="string" id="6084912">&#34;comment&#34;</span><span class="op" id="6084921">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084927">finfo</span><span class="op" id="6084932">.</span><span class="ident" id="6084933">flags</span>&nbsp;<span class="op" id="6084939">|=</span>&nbsp;<span class="ident" id="6084942">fComment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6084954">case</span>&nbsp;<span class="string" id="6084959">&#34;any&#34;</span><span class="op" id="6084964">:</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084970">finfo</span><span class="op" id="6084975">.</span><span class="ident" id="6084976">flags</span>&nbsp;<span class="op" id="6084982">|=</span>&nbsp;<span class="ident" id="6084985">fAny</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6084993">case</span>&nbsp;<span class="string" id="6084998">&#34;omitempty&#34;</span><span class="op" id="6085009">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6085015">finfo</span><span class="op" id="6085020">.</span><span class="ident" id="6085021">flags</span>&nbsp;<span class="op" id="6085027">|=</span>&nbsp;<span class="ident" id="6085030">fOmitEmpty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6085044">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6085048">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6085053">//&nbsp;Validate&nbsp;the&nbsp;flags&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6085083">valid</span>&nbsp;<span class="op" id="6085089">:=</span>&nbsp;<span class="builtintype" id="6085092">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6085099">switch</span>&nbsp;<span class="ident" id="6085106">mode</span>&nbsp;<span class="op" id="6085111">:=</span>&nbsp;<span class="ident" id="6085114">finfo</span><span class="op" id="6085119">.</span><span class="ident" id="6085120">flags</span>&nbsp;<span class="op" id="6085126">&amp;</span>&nbsp;<span class="ident" id="6085128">fMode</span><span class="op" id="6085133">;</span>&nbsp;<span class="ident" id="6085135">mode</span>&nbsp;<span class="op" id="6085140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6085144">case</span>&nbsp;<span class="num" id="6085149">0</span><span class="op" id="6085150">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6085155">finfo</span><span class="op" id="6085160">.</span><span class="ident" id="6085161">flags</span>&nbsp;<span class="op" id="6085167">|=</span>&nbsp;<span class="ident" id="6085170">fElement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6085181">case</span>&nbsp;<span class="ident" id="6085186">fAttr</span><span class="op" id="6085191">,</span>&nbsp;<span class="ident" id="6085193">fCharData</span><span class="op" id="6085202">,</span>&nbsp;<span class="ident" id="6085204">fInnerXml</span><span class="op" id="6085213">,</span>&nbsp;<span class="ident" id="6085215">fComment</span><span class="op" id="6085223">,</span>&nbsp;<span class="ident" id="6085225">fAny</span><span class="op" id="6085229">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6085234">if</span>&nbsp;<span class="ident" id="6085237">f</span><span class="op" id="6085238">.</span><span class="ident" id="6085239">Name</span>&nbsp;<span class="op" id="6085244">==</span>&nbsp;<span class="string" id="6085247">&#34;XMLName&#34;</span>&nbsp;<span class="op" id="6085257">||</span>&nbsp;<span class="ident" id="6085260">tag</span>&nbsp;<span class="op" id="6085264">!=</span>&nbsp;<span class="string" id="6085267">&#34;&#34;</span>&nbsp;<span class="op" id="6085270">&amp;&amp;</span>&nbsp;<span class="ident" id="6085273">mode</span>&nbsp;<span class="op" id="6085278">!=</span>&nbsp;<span class="ident" id="6085281">fAttr</span>&nbsp;<span class="op" id="6085287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6085293">valid</span>&nbsp;<span class="op" id="6085299">=</span>&nbsp;<span class="builtintype" id="6085301">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6085310">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6085314">default</span><span class="op" id="6085321">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6085326">//&nbsp;This&nbsp;will&nbsp;also&nbsp;catch&nbsp;multiple&nbsp;modes&nbsp;in&nbsp;a&nbsp;single&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6085387">valid</span>&nbsp;<span class="op" id="6085393">=</span>&nbsp;<span class="builtintype" id="6085395">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6085403">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6085407">if</span>&nbsp;<span class="ident" id="6085410">finfo</span><span class="op" id="6085415">.</span><span class="ident" id="6085416">flags</span><span class="op" id="6085421">&amp;</span><span class="ident" id="6085422">fMode</span>&nbsp;<span class="op" id="6085428">==</span>&nbsp;<span class="ident" id="6085431">fAny</span>&nbsp;<span class="op" id="6085436">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6085441">finfo</span><span class="op" id="6085446">.</span><span class="ident" id="6085447">flags</span>&nbsp;<span class="op" id="6085453">|=</span>&nbsp;<span class="ident" id="6085456">fElement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6085467">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6085471">if</span>&nbsp;<span class="ident" id="6085474">finfo</span><span class="op" id="6085479">.</span><span class="ident" id="6085480">flags</span><span class="op" id="6085485">&amp;</span><span class="ident" id="6085486">fOmitEmpty</span>&nbsp;<span class="op" id="6085497">!=</span>&nbsp;<span class="num" id="6085500">0</span>&nbsp;<span class="op" id="6085502">&amp;&amp;</span>&nbsp;<span class="ident" id="6085505">finfo</span><span class="op" id="6085510">.</span><span class="ident" id="6085511">flags</span><span class="op" id="6085516">&amp;</span><span class="op" id="6085517">(</span><span class="ident" id="6085518">fElement</span><span class="op" id="6085526">|</span><span class="ident" id="6085527">fAttr</span><span class="op" id="6085532">)</span>&nbsp;<span class="op" id="6085534">==</span>&nbsp;<span class="num" id="6085537">0</span>&nbsp;<span class="op" id="6085539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6085544">valid</span>&nbsp;<span class="op" id="6085550">=</span>&nbsp;<span class="builtintype" id="6085552">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6085560">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6085564">if</span>&nbsp;<span class="op" id="6085567">!</span><span class="ident" id="6085568">valid</span>&nbsp;<span class="op" id="6085574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6085579">return</span>&nbsp;<span class="ident" id="6085586">nil</span><span class="op" id="6085589">,</span>&nbsp;<span class="ident" id="6085591">fmt</span><span class="op" id="6085594">.</span><span class="ident" id="6085595">Errorf</span><span class="op" id="6085601">(</span><span class="string" id="6085602">&#34;xml:&nbsp;invalid&nbsp;tag&nbsp;in&nbsp;field&nbsp;%s&nbsp;of&nbsp;type&nbsp;%s:&nbsp;%q&#34;</span><span class="op" id="6085647">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6085653">f</span><span class="op" id="6085654">.</span><span class="ident" id="6085655">Name</span><span class="op" id="6085659">,</span>&nbsp;<span class="ident" id="6085661">typ</span><span class="op" id="6085664">,</span>&nbsp;<span class="ident" id="6085666">f</span><span class="op" id="6085667">.</span><span class="ident" id="6085668">Tag</span><span class="op" id="6085671">.</span><span class="ident" id="6085672">Get</span><span class="op" id="6085675">(</span><span class="string" id="6085676">&#34;xml&#34;</span><span class="op" id="6085681">)</span><span class="op" id="6085682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6085686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6085689">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6085693">//&nbsp;Use&nbsp;of&nbsp;xmlns&nbsp;without&nbsp;a&nbsp;name&nbsp;is&nbsp;not&nbsp;allowed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6085741">if</span>&nbsp;<span class="ident" id="6085744">finfo</span><span class="op" id="6085749">.</span><span class="ident" id="6085750">xmlns</span>&nbsp;<span class="op" id="6085756">!=</span>&nbsp;<span class="string" id="6085759">&#34;&#34;</span>&nbsp;<span class="op" id="6085762">&amp;&amp;</span>&nbsp;<span class="ident" id="6085765">tag</span>&nbsp;<span class="op" id="6085769">==</span>&nbsp;<span class="string" id="6085772">&#34;&#34;</span>&nbsp;<span class="op" id="6085775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6085779">return</span>&nbsp;<span class="ident" id="6085786">nil</span><span class="op" id="6085789">,</span>&nbsp;<span class="ident" id="6085791">fmt</span><span class="op" id="6085794">.</span><span class="ident" id="6085795">Errorf</span><span class="op" id="6085801">(</span><span class="string" id="6085802">&#34;xml:&nbsp;namespace&nbsp;without&nbsp;name&nbsp;in&nbsp;field&nbsp;%s&nbsp;of&nbsp;type&nbsp;%s:&nbsp;%q&#34;</span><span class="op" id="6085858">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6085863">f</span><span class="op" id="6085864">.</span><span class="ident" id="6085865">Name</span><span class="op" id="6085869">,</span>&nbsp;<span class="ident" id="6085871">typ</span><span class="op" id="6085874">,</span>&nbsp;<span class="ident" id="6085876">f</span><span class="op" id="6085877">.</span><span class="ident" id="6085878">Tag</span><span class="op" id="6085881">.</span><span class="ident" id="6085882">Get</span><span class="op" id="6085885">(</span><span class="string" id="6085886">&#34;xml&#34;</span><span class="op" id="6085891">)</span><span class="op" id="6085892">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6085895">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6085899">if</span>&nbsp;<span class="ident" id="6085902">f</span><span class="op" id="6085903">.</span><span class="ident" id="6085904">Name</span>&nbsp;<span class="op" id="6085909">==</span>&nbsp;<span class="string" id="6085912">&#34;XMLName&#34;</span>&nbsp;<span class="op" id="6085922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6085926">//&nbsp;The&nbsp;XMLName&nbsp;field&nbsp;records&nbsp;the&nbsp;XML&nbsp;element&nbsp;name.&nbsp;Don&#39;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6085985">//&nbsp;process&nbsp;it&nbsp;as&nbsp;usual&nbsp;because&nbsp;its&nbsp;name&nbsp;should&nbsp;default&nbsp;to</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6086045">//&nbsp;empty&nbsp;rather&nbsp;than&nbsp;to&nbsp;the&nbsp;field&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6086087">finfo</span><span class="op" id="6086092">.</span><span class="ident" id="6086093">name</span>&nbsp;<span class="op" id="6086098">=</span>&nbsp;<span class="ident" id="6086100">tag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6086106">return</span>&nbsp;<span class="ident" id="6086113">finfo</span><span class="op" id="6086118">,</span>&nbsp;<span class="ident" id="6086120">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6086125">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6086129">if</span>&nbsp;<span class="ident" id="6086132">tag</span>&nbsp;<span class="op" id="6086136">==</span>&nbsp;<span class="string" id="6086139">&#34;&#34;</span>&nbsp;<span class="op" id="6086142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6086146">//&nbsp;If&nbsp;the&nbsp;name&nbsp;part&nbsp;of&nbsp;the&nbsp;tag&nbsp;is&nbsp;completely&nbsp;empty,&nbsp;get</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6086204">//&nbsp;default&nbsp;from&nbsp;XMLName&nbsp;of&nbsp;underlying&nbsp;struct&nbsp;if&nbsp;feasible,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6086264">//&nbsp;or&nbsp;field&nbsp;name&nbsp;otherwise.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6086294">if</span>&nbsp;<span class="ident" id="6086297">xmlname</span>&nbsp;<span class="op" id="6086305">:=</span>&nbsp;<span class="ident" id="6086308">lookupXMLName</span><span class="op" id="6086321">(</span><span class="ident" id="6086322">f</span><span class="op" id="6086323">.</span><span class="ident" id="6086324">Type</span><span class="op" id="6086328">)</span><span class="op" id="6086329">;</span>&nbsp;<span class="ident" id="6086331">xmlname</span>&nbsp;<span class="op" id="6086339">!=</span>&nbsp;<span class="ident" id="6086342">nil</span>&nbsp;<span class="op" id="6086346">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6086351">finfo</span><span class="op" id="6086356">.</span><span class="ident" id="6086357">xmlns</span><span class="op" id="6086362">,</span>&nbsp;<span class="ident" id="6086364">finfo</span><span class="op" id="6086369">.</span><span class="ident" id="6086370">name</span>&nbsp;<span class="op" id="6086375">=</span>&nbsp;<span class="ident" id="6086377">xmlname</span><span class="op" id="6086384">.</span><span class="ident" id="6086385">xmlns</span><span class="op" id="6086390">,</span>&nbsp;<span class="ident" id="6086392">xmlname</span><span class="op" id="6086399">.</span><span class="ident" id="6086400">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6086407">}</span>&nbsp;<span class="keyword" id="6086409">else</span>&nbsp;<span class="op" id="6086414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6086419">finfo</span><span class="op" id="6086424">.</span><span class="ident" id="6086425">name</span>&nbsp;<span class="op" id="6086430">=</span>&nbsp;<span class="ident" id="6086432">f</span><span class="op" id="6086433">.</span><span class="ident" id="6086434">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6086441">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6086445">return</span>&nbsp;<span class="ident" id="6086452">finfo</span><span class="op" id="6086457">,</span>&nbsp;<span class="ident" id="6086459">nil</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6086464">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6086468">//&nbsp;Prepare&nbsp;field&nbsp;name&nbsp;and&nbsp;parents.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6086504">parents</span>&nbsp;<span class="op" id="6086512">:=</span>&nbsp;<span class="ident" id="6086515">strings</span><span class="op" id="6086522">.</span><span class="ident" id="6086523">Split</span><span class="op" id="6086528">(</span><span class="ident" id="6086529">tag</span><span class="op" id="6086532">,</span>&nbsp;<span class="string" id="6086534">&#34;&gt;&#34;</span><span class="op" id="6086537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6086540">if</span>&nbsp;<span class="ident" id="6086543">parents</span><span class="op" id="6086550">[</span><span class="num" id="6086551">0</span><span class="op" id="6086552">]</span>&nbsp;<span class="op" id="6086554">==</span>&nbsp;<span class="string" id="6086557">&#34;&#34;</span>&nbsp;<span class="op" id="6086560">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6086564">parents</span><span class="op" id="6086571">[</span><span class="num" id="6086572">0</span><span class="op" id="6086573">]</span>&nbsp;<span class="op" id="6086575">=</span>&nbsp;<span class="ident" id="6086577">f</span><span class="op" id="6086578">.</span><span class="ident" id="6086579">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6086585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6086588">if</span>&nbsp;<span class="ident" id="6086591">parents</span><span class="op" id="6086598">[</span><span class="builtinfunc" id="6086599">len</span><span class="op" id="6086602">(</span><span class="ident" id="6086603">parents</span><span class="op" id="6086610">)</span><span class="op" id="6086611">-</span><span class="num" id="6086612">1</span><span class="op" id="6086613">]</span>&nbsp;<span class="op" id="6086615">==</span>&nbsp;<span class="string" id="6086618">&#34;&#34;</span>&nbsp;<span class="op" id="6086621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6086625">return</span>&nbsp;<span class="ident" id="6086632">nil</span><span class="op" id="6086635">,</span>&nbsp;<span class="ident" id="6086637">fmt</span><span class="op" id="6086640">.</span><span class="ident" id="6086641">Errorf</span><span class="op" id="6086647">(</span><span class="string" id="6086648">&#34;xml:&nbsp;trailing&nbsp;&#39;&gt;&#39;&nbsp;in&nbsp;field&nbsp;%s&nbsp;of&nbsp;type&nbsp;%s&#34;</span><span class="op" id="6086690">,</span>&nbsp;<span class="ident" id="6086692">f</span><span class="op" id="6086693">.</span><span class="ident" id="6086694">Name</span><span class="op" id="6086698">,</span>&nbsp;<span class="ident" id="6086700">typ</span><span class="op" id="6086703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6086706">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6086709">finfo</span><span class="op" id="6086714">.</span><span class="ident" id="6086715">name</span>&nbsp;<span class="op" id="6086720">=</span>&nbsp;<span class="ident" id="6086722">parents</span><span class="op" id="6086729">[</span><span class="builtinfunc" id="6086730">len</span><span class="op" id="6086733">(</span><span class="ident" id="6086734">parents</span><span class="op" id="6086741">)</span><span class="op" id="6086742">-</span><span class="num" id="6086743">1</span><span class="op" id="6086744">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6086747">if</span>&nbsp;<span class="builtinfunc" id="6086750">len</span><span class="op" id="6086753">(</span><span class="ident" id="6086754">parents</span><span class="op" id="6086761">)</span>&nbsp;<span class="op" id="6086763">&gt;</span>&nbsp;<span class="num" id="6086765">1</span>&nbsp;<span class="op" id="6086767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6086771">if</span>&nbsp;<span class="op" id="6086774">(</span><span class="ident" id="6086775">finfo</span><span class="op" id="6086780">.</span><span class="ident" id="6086781">flags</span>&nbsp;<span class="op" id="6086787">&amp;</span>&nbsp;<span class="ident" id="6086789">fElement</span><span class="op" id="6086797">)</span>&nbsp;<span class="op" id="6086799">==</span>&nbsp;<span class="num" id="6086802">0</span>&nbsp;<span class="op" id="6086804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6086809">return</span>&nbsp;<span class="ident" id="6086816">nil</span><span class="op" id="6086819">,</span>&nbsp;<span class="ident" id="6086821">fmt</span><span class="op" id="6086824">.</span><span class="ident" id="6086825">Errorf</span><span class="op" id="6086831">(</span><span class="string" id="6086832">&#34;xml:&nbsp;%s&nbsp;chain&nbsp;not&nbsp;valid&nbsp;with&nbsp;%s&nbsp;flag&#34;</span><span class="op" id="6086870">,</span>&nbsp;<span class="ident" id="6086872">tag</span><span class="op" id="6086875">,</span>&nbsp;<span class="ident" id="6086877">strings</span><span class="op" id="6086884">.</span><span class="ident" id="6086885">Join</span><span class="op" id="6086889">(</span><span class="ident" id="6086890">tokens</span><span class="op" id="6086896">[</span><span class="num" id="6086897">1</span><span class="op" id="6086898">:</span><span class="op" id="6086899">]</span><span class="op" id="6086900">,</span>&nbsp;<span class="string" id="6086902">&#34;,&#34;</span><span class="op" id="6086905">)</span><span class="op" id="6086906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6086910">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6086914">finfo</span><span class="op" id="6086919">.</span><span class="ident" id="6086920">parents</span>&nbsp;<span class="op" id="6086928">=</span>&nbsp;<span class="ident" id="6086930">parents</span><span class="op" id="6086937">[</span><span class="op" id="6086938">:</span><span class="builtinfunc" id="6086939">len</span><span class="op" id="6086942">(</span><span class="ident" id="6086943">parents</span><span class="op" id="6086950">)</span><span class="op" id="6086951">-</span><span class="num" id="6086952">1</span><span class="op" id="6086953">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6086956">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6086960">//&nbsp;If&nbsp;the&nbsp;field&nbsp;type&nbsp;has&nbsp;an&nbsp;XMLName&nbsp;field,&nbsp;the&nbsp;names&nbsp;must&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6087025">//&nbsp;so&nbsp;that&nbsp;the&nbsp;behavior&nbsp;of&nbsp;both&nbsp;marshalling&nbsp;and&nbsp;unmarshalling</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6087088">//&nbsp;is&nbsp;straightforward&nbsp;and&nbsp;unambiguous.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6087128">if</span>&nbsp;<span class="ident" id="6087131">finfo</span><span class="op" id="6087136">.</span><span class="ident" id="6087137">flags</span><span class="op" id="6087142">&amp;</span><span class="ident" id="6087143">fElement</span>&nbsp;<span class="op" id="6087152">!=</span>&nbsp;<span class="num" id="6087155">0</span>&nbsp;<span class="op" id="6087157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6087161">ftyp</span>&nbsp;<span class="op" id="6087166">:=</span>&nbsp;<span class="ident" id="6087169">f</span><span class="op" id="6087170">.</span><span class="ident" id="6087171">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6087178">xmlname</span>&nbsp;<span class="op" id="6087186">:=</span>&nbsp;<span class="ident" id="6087189">lookupXMLName</span><span class="op" id="6087202">(</span><span class="ident" id="6087203">ftyp</span><span class="op" id="6087207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6087211">if</span>&nbsp;<span class="ident" id="6087214">xmlname</span>&nbsp;<span class="op" id="6087222">!=</span>&nbsp;<span class="ident" id="6087225">nil</span>&nbsp;<span class="op" id="6087229">&amp;&amp;</span>&nbsp;<span class="ident" id="6087232">xmlname</span><span class="op" id="6087239">.</span><span class="ident" id="6087240">name</span>&nbsp;<span class="op" id="6087245">!=</span>&nbsp;<span class="ident" id="6087248">finfo</span><span class="op" id="6087253">.</span><span class="ident" id="6087254">name</span>&nbsp;<span class="op" id="6087259">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6087264">return</span>&nbsp;<span class="ident" id="6087271">nil</span><span class="op" id="6087274">,</span>&nbsp;<span class="ident" id="6087276">fmt</span><span class="op" id="6087279">.</span><span class="ident" id="6087280">Errorf</span><span class="op" id="6087286">(</span><span class="string" id="6087287">&#34;xml:&nbsp;name&nbsp;%q&nbsp;in&nbsp;tag&nbsp;of&nbsp;%s.%s&nbsp;conflicts&nbsp;with&nbsp;name&nbsp;%q&nbsp;in&nbsp;%s.XMLName&#34;</span><span class="op" id="6087354">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6087360">finfo</span><span class="op" id="6087365">.</span><span class="ident" id="6087366">name</span><span class="op" id="6087370">,</span>&nbsp;<span class="ident" id="6087372">typ</span><span class="op" id="6087375">,</span>&nbsp;<span class="ident" id="6087377">f</span><span class="op" id="6087378">.</span><span class="ident" id="6087379">Name</span><span class="op" id="6087383">,</span>&nbsp;<span class="ident" id="6087385">xmlname</span><span class="op" id="6087392">.</span><span class="ident" id="6087393">name</span><span class="op" id="6087397">,</span>&nbsp;<span class="ident" id="6087399">ftyp</span><span class="op" id="6087403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6087407">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6087410">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6087413">return</span>&nbsp;<span class="ident" id="6087420">finfo</span><span class="op" id="6087425">,</span>&nbsp;<span class="ident" id="6087427">nil</span><br>
<span class="lineno">225</span><span class="op" id="6087431">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6087434">//&nbsp;lookupXMLName&nbsp;returns&nbsp;the&nbsp;fieldInfo&nbsp;for&nbsp;typ&#39;s&nbsp;XMLName&nbsp;field</span><br>
<span class="lineno"></span><span class="comment" id="6087497">//&nbsp;in&nbsp;case&nbsp;it&nbsp;exists&nbsp;and&nbsp;has&nbsp;a&nbsp;valid&nbsp;xml&nbsp;field&nbsp;tag,&nbsp;otherwise</span><br>
<span class="lineno"></span><span class="comment" id="6087559">//&nbsp;it&nbsp;returns&nbsp;nil.</span><br>
<span class="lineno">230</span><span class="keyword" id="6087578">func</span>&nbsp;<span class="ident" id="6087583">lookupXMLName</span><span class="op" id="6087596">(</span><span class="ident" id="6087597">typ</span>&nbsp;<span class="ident" id="6087601">reflect</span><span class="op" id="6087608">.</span><span class="ident" id="6087609">Type</span><span class="op" id="6087613">)</span>&nbsp;<span class="op" id="6087615">(</span><span class="ident" id="6087616">xmlname</span>&nbsp;<span class="op" id="6087624">*</span><span class="ident" id="6087625">fieldInfo</span><span class="op" id="6087634">)</span>&nbsp;<span class="op" id="6087636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6087639">for</span>&nbsp;<span class="ident" id="6087643">typ</span><span class="op" id="6087646">.</span><span class="ident" id="6087647">Kind</span><span class="op" id="6087651">(</span><span class="op" id="6087652">)</span>&nbsp;<span class="op" id="6087654">==</span>&nbsp;<span class="ident" id="6087657">reflect</span><span class="op" id="6087664">.</span><span class="ident" id="6087665">Ptr</span>&nbsp;<span class="op" id="6087669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6087673">typ</span>&nbsp;<span class="op" id="6087677">=</span>&nbsp;<span class="ident" id="6087679">typ</span><span class="op" id="6087682">.</span><span class="ident" id="6087683">Elem</span><span class="op" id="6087687">(</span><span class="op" id="6087688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6087691">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6087694">if</span>&nbsp;<span class="ident" id="6087697">typ</span><span class="op" id="6087700">.</span><span class="ident" id="6087701">Kind</span><span class="op" id="6087705">(</span><span class="op" id="6087706">)</span>&nbsp;<span class="op" id="6087708">!=</span>&nbsp;<span class="ident" id="6087711">reflect</span><span class="op" id="6087718">.</span><span class="ident" id="6087719">Struct</span>&nbsp;<span class="op" id="6087726">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6087730">return</span>&nbsp;<span class="ident" id="6087737">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6087742">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6087745">for</span>&nbsp;<span class="ident" id="6087749">i</span><span class="op" id="6087750">,</span>&nbsp;<span class="ident" id="6087752">n</span>&nbsp;<span class="op" id="6087754">:=</span>&nbsp;<span class="num" id="6087757">0</span><span class="op" id="6087758">,</span>&nbsp;<span class="ident" id="6087760">typ</span><span class="op" id="6087763">.</span><span class="ident" id="6087764">NumField</span><span class="op" id="6087772">(</span><span class="op" id="6087773">)</span><span class="op" id="6087774">;</span>&nbsp;<span class="ident" id="6087776">i</span>&nbsp;<span class="op" id="6087778">&lt;</span>&nbsp;<span class="ident" id="6087780">n</span><span class="op" id="6087781">;</span>&nbsp;<span class="ident" id="6087783">i</span><span class="op" id="6087784">++</span>&nbsp;<span class="op" id="6087787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6087791">f</span>&nbsp;<span class="op" id="6087793">:=</span>&nbsp;<span class="ident" id="6087796">typ</span><span class="op" id="6087799">.</span><span class="ident" id="6087800">Field</span><span class="op" id="6087805">(</span><span class="ident" id="6087806">i</span><span class="op" id="6087807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6087811">if</span>&nbsp;<span class="ident" id="6087814">f</span><span class="op" id="6087815">.</span><span class="ident" id="6087816">Name</span>&nbsp;<span class="op" id="6087821">!=</span>&nbsp;<span class="string" id="6087824">&#34;XMLName&#34;</span>&nbsp;<span class="op" id="6087834">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6087839">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6087850">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6087854">finfo</span><span class="op" id="6087859">,</span>&nbsp;<span class="ident" id="6087861">err</span>&nbsp;<span class="op" id="6087865">:=</span>&nbsp;<span class="ident" id="6087868">structFieldInfo</span><span class="op" id="6087883">(</span><span class="ident" id="6087884">typ</span><span class="op" id="6087887">,</span>&nbsp;<span class="op" id="6087889">&amp;</span><span class="ident" id="6087890">f</span><span class="op" id="6087891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6087895">if</span>&nbsp;<span class="ident" id="6087898">finfo</span><span class="op" id="6087903">.</span><span class="ident" id="6087904">name</span>&nbsp;<span class="op" id="6087909">!=</span>&nbsp;<span class="string" id="6087912">&#34;&#34;</span>&nbsp;<span class="op" id="6087915">&amp;&amp;</span>&nbsp;<span class="ident" id="6087918">err</span>&nbsp;<span class="op" id="6087922">==</span>&nbsp;<span class="ident" id="6087925">nil</span>&nbsp;<span class="op" id="6087929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6087934">return</span>&nbsp;<span class="ident" id="6087941">finfo</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6087949">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6087953">//&nbsp;Also&nbsp;consider&nbsp;errors&nbsp;as&nbsp;a&nbsp;non-existent&nbsp;field&nbsp;tag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6088007">//&nbsp;and&nbsp;let&nbsp;getTypeInfo&nbsp;itself&nbsp;report&nbsp;the&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6088057">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6088064">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6088067">return</span>&nbsp;<span class="ident" id="6088074">nil</span><br>
<span class="lineno"></span><span class="op" id="6088078">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6088081">func</span>&nbsp;<span class="ident" id="6088086">min</span><span class="op" id="6088089">(</span><span class="ident" id="6088090">a</span><span class="op" id="6088091">,</span>&nbsp;<span class="ident" id="6088093">b</span>&nbsp;<span class="builtintype" id="6088095">int</span><span class="op" id="6088098">)</span>&nbsp;<span class="builtintype" id="6088100">int</span>&nbsp;<span class="op" id="6088104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6088107">if</span>&nbsp;<span class="ident" id="6088110">a</span>&nbsp;<span class="op" id="6088112">&lt;=</span>&nbsp;<span class="ident" id="6088115">b</span>&nbsp;<span class="op" id="6088117">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6088121">return</span>&nbsp;<span class="ident" id="6088128">a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6088131">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6088134">return</span>&nbsp;<span class="ident" id="6088141">b</span><br>
<span class="lineno"></span><span class="op" id="6088143">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="comment" id="6088146">//&nbsp;addFieldInfo&nbsp;adds&nbsp;finfo&nbsp;to&nbsp;tinfo.fields&nbsp;if&nbsp;there&nbsp;are&nbsp;no</span><br>
<span class="lineno"></span><span class="comment" id="6088205">//&nbsp;conflicts,&nbsp;or&nbsp;if&nbsp;conflicts&nbsp;arise&nbsp;from&nbsp;previous&nbsp;fields&nbsp;that&nbsp;were</span><br>
<span class="lineno"></span><span class="comment" id="6088272">//&nbsp;obtained&nbsp;from&nbsp;deeper&nbsp;embedded&nbsp;structures&nbsp;than&nbsp;finfo.&nbsp;In&nbsp;the&nbsp;latter</span><br>
<span class="lineno"></span><span class="comment" id="6088342">//&nbsp;case,&nbsp;the&nbsp;conflicting&nbsp;entries&nbsp;are&nbsp;dropped.</span><br>
<span class="lineno"></span><span class="comment" id="6088388">//&nbsp;A&nbsp;conflict&nbsp;occurs&nbsp;when&nbsp;the&nbsp;path&nbsp;(parent&nbsp;+&nbsp;name)&nbsp;to&nbsp;a&nbsp;field&nbsp;is</span><br>
<span class="lineno">265</span><span class="comment" id="6088453">//&nbsp;itself&nbsp;a&nbsp;prefix&nbsp;of&nbsp;another&nbsp;path,&nbsp;or&nbsp;when&nbsp;two&nbsp;paths&nbsp;match&nbsp;exactly.</span><br>
<span class="lineno"></span><span class="comment" id="6088522">//&nbsp;It&nbsp;is&nbsp;okay&nbsp;for&nbsp;field&nbsp;paths&nbsp;to&nbsp;share&nbsp;a&nbsp;common,&nbsp;shorter&nbsp;prefix.</span><br>
<span class="lineno"></span><span class="keyword" id="6088587">func</span>&nbsp;<span class="ident" id="6088592">addFieldInfo</span><span class="op" id="6088604">(</span><span class="ident" id="6088605">typ</span>&nbsp;<span class="ident" id="6088609">reflect</span><span class="op" id="6088616">.</span><span class="ident" id="6088617">Type</span><span class="op" id="6088621">,</span>&nbsp;<span class="ident" id="6088623">tinfo</span>&nbsp;<span class="op" id="6088629">*</span><span class="ident" id="6088630">typeInfo</span><span class="op" id="6088638">,</span>&nbsp;<span class="ident" id="6088640">newf</span>&nbsp;<span class="op" id="6088645">*</span><span class="ident" id="6088646">fieldInfo</span><span class="op" id="6088655">)</span>&nbsp;<span class="builtintype" id="6088657">error</span>&nbsp;<span class="op" id="6088663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6088666">var</span>&nbsp;<span class="ident" id="6088670">conflicts</span>&nbsp;<span class="op" id="6088680">[</span><span class="op" id="6088681">]</span><span class="builtintype" id="6088682">int</span><br>
<span class="lineno"></span><span class="ident" id="6088686">Loop</span><span class="op" id="6088690">:</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6088693">//&nbsp;First,&nbsp;figure&nbsp;all&nbsp;conflicts.&nbsp;Most&nbsp;working&nbsp;code&nbsp;will&nbsp;have&nbsp;none.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6088760">for</span>&nbsp;<span class="ident" id="6088764">i</span>&nbsp;<span class="op" id="6088766">:=</span>&nbsp;<span class="keyword" id="6088769">range</span>&nbsp;<span class="ident" id="6088775">tinfo</span><span class="op" id="6088780">.</span><span class="ident" id="6088781">fields</span>&nbsp;<span class="op" id="6088788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6088792">oldf</span>&nbsp;<span class="op" id="6088797">:=</span>&nbsp;<span class="op" id="6088800">&amp;</span><span class="ident" id="6088801">tinfo</span><span class="op" id="6088806">.</span><span class="ident" id="6088807">fields</span><span class="op" id="6088813">[</span><span class="ident" id="6088814">i</span><span class="op" id="6088815">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6088819">if</span>&nbsp;<span class="ident" id="6088822">oldf</span><span class="op" id="6088826">.</span><span class="ident" id="6088827">flags</span><span class="op" id="6088832">&amp;</span><span class="ident" id="6088833">fMode</span>&nbsp;<span class="op" id="6088839">!=</span>&nbsp;<span class="ident" id="6088842">newf</span><span class="op" id="6088846">.</span><span class="ident" id="6088847">flags</span><span class="op" id="6088852">&amp;</span><span class="ident" id="6088853">fMode</span>&nbsp;<span class="op" id="6088859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6088864">continue</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6088875">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6088879">if</span>&nbsp;<span class="ident" id="6088882">oldf</span><span class="op" id="6088886">.</span><span class="ident" id="6088887">xmlns</span>&nbsp;<span class="op" id="6088893">!=</span>&nbsp;<span class="string" id="6088896">&#34;&#34;</span>&nbsp;<span class="op" id="6088899">&amp;&amp;</span>&nbsp;<span class="ident" id="6088902">newf</span><span class="op" id="6088906">.</span><span class="ident" id="6088907">xmlns</span>&nbsp;<span class="op" id="6088913">!=</span>&nbsp;<span class="string" id="6088916">&#34;&#34;</span>&nbsp;<span class="op" id="6088919">&amp;&amp;</span>&nbsp;<span class="ident" id="6088922">oldf</span><span class="op" id="6088926">.</span><span class="ident" id="6088927">xmlns</span>&nbsp;<span class="op" id="6088933">!=</span>&nbsp;<span class="ident" id="6088936">newf</span><span class="op" id="6088940">.</span><span class="ident" id="6088941">xmlns</span>&nbsp;<span class="op" id="6088947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6088952">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6088963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6088967">minl</span>&nbsp;<span class="op" id="6088972">:=</span>&nbsp;<span class="ident" id="6088975">min</span><span class="op" id="6088978">(</span><span class="builtinfunc" id="6088979">len</span><span class="op" id="6088982">(</span><span class="ident" id="6088983">newf</span><span class="op" id="6088987">.</span><span class="ident" id="6088988">parents</span><span class="op" id="6088995">)</span><span class="op" id="6088996">,</span>&nbsp;<span class="builtinfunc" id="6088998">len</span><span class="op" id="6089001">(</span><span class="ident" id="6089002">oldf</span><span class="op" id="6089006">.</span><span class="ident" id="6089007">parents</span><span class="op" id="6089014">)</span><span class="op" id="6089015">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6089019">for</span>&nbsp;<span class="ident" id="6089023">p</span>&nbsp;<span class="op" id="6089025">:=</span>&nbsp;<span class="num" id="6089028">0</span><span class="op" id="6089029">;</span>&nbsp;<span class="ident" id="6089031">p</span>&nbsp;<span class="op" id="6089033">&lt;</span>&nbsp;<span class="ident" id="6089035">minl</span><span class="op" id="6089039">;</span>&nbsp;<span class="ident" id="6089041">p</span><span class="op" id="6089042">++</span>&nbsp;<span class="op" id="6089045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6089050">if</span>&nbsp;<span class="ident" id="6089053">oldf</span><span class="op" id="6089057">.</span><span class="ident" id="6089058">parents</span><span class="op" id="6089065">[</span><span class="ident" id="6089066">p</span><span class="op" id="6089067">]</span>&nbsp;<span class="op" id="6089069">!=</span>&nbsp;<span class="ident" id="6089072">newf</span><span class="op" id="6089076">.</span><span class="ident" id="6089077">parents</span><span class="op" id="6089084">[</span><span class="ident" id="6089085">p</span><span class="op" id="6089086">]</span>&nbsp;<span class="op" id="6089088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6089094">continue</span>&nbsp;<span class="ident" id="6089103">Loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6089111">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6089115">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6089119">if</span>&nbsp;<span class="builtinfunc" id="6089122">len</span><span class="op" id="6089125">(</span><span class="ident" id="6089126">oldf</span><span class="op" id="6089130">.</span><span class="ident" id="6089131">parents</span><span class="op" id="6089138">)</span>&nbsp;<span class="op" id="6089140">&gt;</span>&nbsp;<span class="builtinfunc" id="6089142">len</span><span class="op" id="6089145">(</span><span class="ident" id="6089146">newf</span><span class="op" id="6089150">.</span><span class="ident" id="6089151">parents</span><span class="op" id="6089158">)</span>&nbsp;<span class="op" id="6089160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6089165">if</span>&nbsp;<span class="ident" id="6089168">oldf</span><span class="op" id="6089172">.</span><span class="ident" id="6089173">parents</span><span class="op" id="6089180">[</span><span class="builtinfunc" id="6089181">len</span><span class="op" id="6089184">(</span><span class="ident" id="6089185">newf</span><span class="op" id="6089189">.</span><span class="ident" id="6089190">parents</span><span class="op" id="6089197">)</span><span class="op" id="6089198">]</span>&nbsp;<span class="op" id="6089200">==</span>&nbsp;<span class="ident" id="6089203">newf</span><span class="op" id="6089207">.</span><span class="ident" id="6089208">name</span>&nbsp;<span class="op" id="6089213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6089219">conflicts</span>&nbsp;<span class="op" id="6089229">=</span>&nbsp;<span class="builtinfunc" id="6089231">append</span><span class="op" id="6089237">(</span><span class="ident" id="6089238">conflicts</span><span class="op" id="6089247">,</span>&nbsp;<span class="ident" id="6089249">i</span><span class="op" id="6089250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6089255">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6089259">}</span>&nbsp;<span class="keyword" id="6089261">else</span>&nbsp;<span class="keyword" id="6089266">if</span>&nbsp;<span class="builtinfunc" id="6089269">len</span><span class="op" id="6089272">(</span><span class="ident" id="6089273">oldf</span><span class="op" id="6089277">.</span><span class="ident" id="6089278">parents</span><span class="op" id="6089285">)</span>&nbsp;<span class="op" id="6089287">&lt;</span>&nbsp;<span class="builtinfunc" id="6089289">len</span><span class="op" id="6089292">(</span><span class="ident" id="6089293">newf</span><span class="op" id="6089297">.</span><span class="ident" id="6089298">parents</span><span class="op" id="6089305">)</span>&nbsp;<span class="op" id="6089307">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6089312">if</span>&nbsp;<span class="ident" id="6089315">newf</span><span class="op" id="6089319">.</span><span class="ident" id="6089320">parents</span><span class="op" id="6089327">[</span><span class="builtinfunc" id="6089328">len</span><span class="op" id="6089331">(</span><span class="ident" id="6089332">oldf</span><span class="op" id="6089336">.</span><span class="ident" id="6089337">parents</span><span class="op" id="6089344">)</span><span class="op" id="6089345">]</span>&nbsp;<span class="op" id="6089347">==</span>&nbsp;<span class="ident" id="6089350">oldf</span><span class="op" id="6089354">.</span><span class="ident" id="6089355">name</span>&nbsp;<span class="op" id="6089360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6089366">conflicts</span>&nbsp;<span class="op" id="6089376">=</span>&nbsp;<span class="builtinfunc" id="6089378">append</span><span class="op" id="6089384">(</span><span class="ident" id="6089385">conflicts</span><span class="op" id="6089394">,</span>&nbsp;<span class="ident" id="6089396">i</span><span class="op" id="6089397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6089402">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6089406">}</span>&nbsp;<span class="keyword" id="6089408">else</span>&nbsp;<span class="op" id="6089413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6089418">if</span>&nbsp;<span class="ident" id="6089421">newf</span><span class="op" id="6089425">.</span><span class="ident" id="6089426">name</span>&nbsp;<span class="op" id="6089431">==</span>&nbsp;<span class="ident" id="6089434">oldf</span><span class="op" id="6089438">.</span><span class="ident" id="6089439">name</span>&nbsp;<span class="op" id="6089444">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6089450">conflicts</span>&nbsp;<span class="op" id="6089460">=</span>&nbsp;<span class="builtinfunc" id="6089462">append</span><span class="op" id="6089468">(</span><span class="ident" id="6089469">conflicts</span><span class="op" id="6089478">,</span>&nbsp;<span class="ident" id="6089480">i</span><span class="op" id="6089481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6089486">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6089490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6089493">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6089496">//&nbsp;Without&nbsp;conflicts,&nbsp;add&nbsp;the&nbsp;new&nbsp;field&nbsp;and&nbsp;return.</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6089549">if</span>&nbsp;<span class="ident" id="6089552">conflicts</span>&nbsp;<span class="op" id="6089562">==</span>&nbsp;<span class="ident" id="6089565">nil</span>&nbsp;<span class="op" id="6089569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6089573">tinfo</span><span class="op" id="6089578">.</span><span class="ident" id="6089579">fields</span>&nbsp;<span class="op" id="6089586">=</span>&nbsp;<span class="builtinfunc" id="6089588">append</span><span class="op" id="6089594">(</span><span class="ident" id="6089595">tinfo</span><span class="op" id="6089600">.</span><span class="ident" id="6089601">fields</span><span class="op" id="6089607">,</span>&nbsp;<span class="op" id="6089609">*</span><span class="ident" id="6089610">newf</span><span class="op" id="6089614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6089618">return</span>&nbsp;<span class="ident" id="6089625">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6089630">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6089634">//&nbsp;If&nbsp;any&nbsp;conflict&nbsp;is&nbsp;shallower,&nbsp;ignore&nbsp;the&nbsp;new&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6089690">//&nbsp;This&nbsp;matches&nbsp;the&nbsp;Go&nbsp;field&nbsp;resolution&nbsp;on&nbsp;embedding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6089745">for</span>&nbsp;<span class="ident" id="6089749">_</span><span class="op" id="6089750">,</span>&nbsp;<span class="ident" id="6089752">i</span>&nbsp;<span class="op" id="6089754">:=</span>&nbsp;<span class="keyword" id="6089757">range</span>&nbsp;<span class="ident" id="6089763">conflicts</span>&nbsp;<span class="op" id="6089773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6089777">if</span>&nbsp;<span class="builtinfunc" id="6089780">len</span><span class="op" id="6089783">(</span><span class="ident" id="6089784">tinfo</span><span class="op" id="6089789">.</span><span class="ident" id="6089790">fields</span><span class="op" id="6089796">[</span><span class="ident" id="6089797">i</span><span class="op" id="6089798">]</span><span class="op" id="6089799">.</span><span class="ident" id="6089800">idx</span><span class="op" id="6089803">)</span>&nbsp;<span class="op" id="6089805">&lt;</span>&nbsp;<span class="builtinfunc" id="6089807">len</span><span class="op" id="6089810">(</span><span class="ident" id="6089811">newf</span><span class="op" id="6089815">.</span><span class="ident" id="6089816">idx</span><span class="op" id="6089819">)</span>&nbsp;<span class="op" id="6089821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6089826">return</span>&nbsp;<span class="ident" id="6089833">nil</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6089839">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6089842">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6089846">//&nbsp;Otherwise,&nbsp;if&nbsp;any&nbsp;of&nbsp;them&nbsp;is&nbsp;at&nbsp;the&nbsp;same&nbsp;depth&nbsp;level,&nbsp;it&#39;s&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6089919">for</span>&nbsp;<span class="ident" id="6089923">_</span><span class="op" id="6089924">,</span>&nbsp;<span class="ident" id="6089926">i</span>&nbsp;<span class="op" id="6089928">:=</span>&nbsp;<span class="keyword" id="6089931">range</span>&nbsp;<span class="ident" id="6089937">conflicts</span>&nbsp;<span class="op" id="6089947">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6089951">oldf</span>&nbsp;<span class="op" id="6089956">:=</span>&nbsp;<span class="op" id="6089959">&amp;</span><span class="ident" id="6089960">tinfo</span><span class="op" id="6089965">.</span><span class="ident" id="6089966">fields</span><span class="op" id="6089972">[</span><span class="ident" id="6089973">i</span><span class="op" id="6089974">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6089978">if</span>&nbsp;<span class="builtinfunc" id="6089981">len</span><span class="op" id="6089984">(</span><span class="ident" id="6089985">oldf</span><span class="op" id="6089989">.</span><span class="ident" id="6089990">idx</span><span class="op" id="6089993">)</span>&nbsp;<span class="op" id="6089995">==</span>&nbsp;<span class="builtinfunc" id="6089998">len</span><span class="op" id="6090001">(</span><span class="ident" id="6090002">newf</span><span class="op" id="6090006">.</span><span class="ident" id="6090007">idx</span><span class="op" id="6090010">)</span>&nbsp;<span class="op" id="6090012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6090017">f1</span>&nbsp;<span class="op" id="6090020">:=</span>&nbsp;<span class="ident" id="6090023">typ</span><span class="op" id="6090026">.</span><span class="ident" id="6090027">FieldByIndex</span><span class="op" id="6090039">(</span><span class="ident" id="6090040">oldf</span><span class="op" id="6090044">.</span><span class="ident" id="6090045">idx</span><span class="op" id="6090048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6090053">f2</span>&nbsp;<span class="op" id="6090056">:=</span>&nbsp;<span class="ident" id="6090059">typ</span><span class="op" id="6090062">.</span><span class="ident" id="6090063">FieldByIndex</span><span class="op" id="6090075">(</span><span class="ident" id="6090076">newf</span><span class="op" id="6090080">.</span><span class="ident" id="6090081">idx</span><span class="op" id="6090084">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6090089">return</span>&nbsp;<span class="op" id="6090096">&amp;</span><span class="ident" id="6090097">TagPathError</span><span class="op" id="6090109">{</span><span class="ident" id="6090110">typ</span><span class="op" id="6090113">,</span>&nbsp;<span class="ident" id="6090115">f1</span><span class="op" id="6090117">.</span><span class="ident" id="6090118">Name</span><span class="op" id="6090122">,</span>&nbsp;<span class="ident" id="6090124">f1</span><span class="op" id="6090126">.</span><span class="ident" id="6090127">Tag</span><span class="op" id="6090130">.</span><span class="ident" id="6090131">Get</span><span class="op" id="6090134">(</span><span class="string" id="6090135">&#34;xml&#34;</span><span class="op" id="6090140">)</span><span class="op" id="6090141">,</span>&nbsp;<span class="ident" id="6090143">f2</span><span class="op" id="6090145">.</span><span class="ident" id="6090146">Name</span><span class="op" id="6090150">,</span>&nbsp;<span class="ident" id="6090152">f2</span><span class="op" id="6090154">.</span><span class="ident" id="6090155">Tag</span><span class="op" id="6090158">.</span><span class="ident" id="6090159">Get</span><span class="op" id="6090162">(</span><span class="string" id="6090163">&#34;xml&#34;</span><span class="op" id="6090168">)</span><span class="op" id="6090169">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6090173">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6090176">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6090180">//&nbsp;Otherwise,&nbsp;the&nbsp;new&nbsp;field&nbsp;is&nbsp;shallower,&nbsp;and&nbsp;thus&nbsp;takes&nbsp;precedence,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6090250">//&nbsp;so&nbsp;drop&nbsp;the&nbsp;conflicting&nbsp;fields&nbsp;from&nbsp;tinfo&nbsp;and&nbsp;append&nbsp;the&nbsp;new&nbsp;one.</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6090320">for</span>&nbsp;<span class="ident" id="6090324">c</span>&nbsp;<span class="op" id="6090326">:=</span>&nbsp;<span class="builtinfunc" id="6090329">len</span><span class="op" id="6090332">(</span><span class="ident" id="6090333">conflicts</span><span class="op" id="6090342">)</span>&nbsp;<span class="op" id="6090344">-</span>&nbsp;<span class="num" id="6090346">1</span><span class="op" id="6090347">;</span>&nbsp;<span class="ident" id="6090349">c</span>&nbsp;<span class="op" id="6090351">&gt;=</span>&nbsp;<span class="num" id="6090354">0</span><span class="op" id="6090355">;</span>&nbsp;<span class="ident" id="6090357">c</span><span class="op" id="6090358">--</span>&nbsp;<span class="op" id="6090361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6090365">i</span>&nbsp;<span class="op" id="6090367">:=</span>&nbsp;<span class="ident" id="6090370">conflicts</span><span class="op" id="6090379">[</span><span class="ident" id="6090380">c</span><span class="op" id="6090381">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6090385">copy</span><span class="op" id="6090389">(</span><span class="ident" id="6090390">tinfo</span><span class="op" id="6090395">.</span><span class="ident" id="6090396">fields</span><span class="op" id="6090402">[</span><span class="ident" id="6090403">i</span><span class="op" id="6090404">:</span><span class="op" id="6090405">]</span><span class="op" id="6090406">,</span>&nbsp;<span class="ident" id="6090408">tinfo</span><span class="op" id="6090413">.</span><span class="ident" id="6090414">fields</span><span class="op" id="6090420">[</span><span class="ident" id="6090421">i</span><span class="op" id="6090422">+</span><span class="num" id="6090423">1</span><span class="op" id="6090424">:</span><span class="op" id="6090425">]</span><span class="op" id="6090426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6090430">tinfo</span><span class="op" id="6090435">.</span><span class="ident" id="6090436">fields</span>&nbsp;<span class="op" id="6090443">=</span>&nbsp;<span class="ident" id="6090445">tinfo</span><span class="op" id="6090450">.</span><span class="ident" id="6090451">fields</span><span class="op" id="6090457">[</span><span class="op" id="6090458">:</span><span class="builtinfunc" id="6090459">len</span><span class="op" id="6090462">(</span><span class="ident" id="6090463">tinfo</span><span class="op" id="6090468">.</span><span class="ident" id="6090469">fields</span><span class="op" id="6090475">)</span><span class="op" id="6090476">-</span><span class="num" id="6090477">1</span><span class="op" id="6090478">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6090481">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6090484">tinfo</span><span class="op" id="6090489">.</span><span class="ident" id="6090490">fields</span>&nbsp;<span class="op" id="6090497">=</span>&nbsp;<span class="builtinfunc" id="6090499">append</span><span class="op" id="6090505">(</span><span class="ident" id="6090506">tinfo</span><span class="op" id="6090511">.</span><span class="ident" id="6090512">fields</span><span class="op" id="6090518">,</span>&nbsp;<span class="op" id="6090520">*</span><span class="ident" id="6090521">newf</span><span class="op" id="6090525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6090528">return</span>&nbsp;<span class="ident" id="6090535">nil</span><br>
<span class="lineno"></span><span class="op" id="6090539">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6090542">//&nbsp;A&nbsp;TagPathError&nbsp;represents&nbsp;an&nbsp;error&nbsp;in&nbsp;the&nbsp;unmarshalling&nbsp;process</span><br>
<span class="lineno">335</span><span class="comment" id="6090609">//&nbsp;caused&nbsp;by&nbsp;the&nbsp;use&nbsp;of&nbsp;field&nbsp;tags&nbsp;with&nbsp;conflicting&nbsp;paths.</span><br>
<span class="lineno"></span><span class="keyword" id="6090668">type</span>&nbsp;<span class="ident" id="6090673">TagPathError</span>&nbsp;<span class="keyword" id="6090686">struct</span>&nbsp;<span class="op" id="6090693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6090696">Struct</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6090709">reflect</span><span class="op" id="6090716">.</span><span class="ident" id="6090717">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6090723">Field1</span><span class="op" id="6090729">,</span>&nbsp;<span class="ident" id="6090731">Tag1</span>&nbsp;<span class="builtintype" id="6090736">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6090744">Field2</span><span class="op" id="6090750">,</span>&nbsp;<span class="ident" id="6090752">Tag2</span>&nbsp;<span class="builtintype" id="6090757">string</span><br>
<span class="lineno">340</span><span class="op" id="6090764">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6090767">func</span>&nbsp;<span class="op" id="6090772">(</span><span class="ident" id="6090773">e</span>&nbsp;<span class="op" id="6090775">*</span><span class="ident" id="6090776">TagPathError</span><span class="op" id="6090788">)</span>&nbsp;<span class="ident" id="6090790">Error</span><span class="op" id="6090795">(</span><span class="op" id="6090796">)</span>&nbsp;<span class="builtintype" id="6090798">string</span>&nbsp;<span class="op" id="6090805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6090808">return</span>&nbsp;<span class="ident" id="6090815">fmt</span><span class="op" id="6090818">.</span><span class="ident" id="6090819">Sprintf</span><span class="op" id="6090826">(</span><span class="string" id="6090827">&#34;%s&nbsp;field&nbsp;%q&nbsp;with&nbsp;tag&nbsp;%q&nbsp;conflicts&nbsp;with&nbsp;field&nbsp;%q&nbsp;with&nbsp;tag&nbsp;%q&#34;</span><span class="op" id="6090888">,</span>&nbsp;<span class="ident" id="6090890">e</span><span class="op" id="6090891">.</span><span class="ident" id="6090892">Struct</span><span class="op" id="6090898">,</span>&nbsp;<span class="ident" id="6090900">e</span><span class="op" id="6090901">.</span><span class="ident" id="6090902">Field1</span><span class="op" id="6090908">,</span>&nbsp;<span class="ident" id="6090910">e</span><span class="op" id="6090911">.</span><span class="ident" id="6090912">Tag1</span><span class="op" id="6090916">,</span>&nbsp;<span class="ident" id="6090918">e</span><span class="op" id="6090919">.</span><span class="ident" id="6090920">Field2</span><span class="op" id="6090926">,</span>&nbsp;<span class="ident" id="6090928">e</span><span class="op" id="6090929">.</span><span class="ident" id="6090930">Tag2</span><span class="op" id="6090934">)</span><br>
<span class="lineno"></span><span class="op" id="6090936">}</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span><span class="comment" id="6090939">//&nbsp;value&nbsp;returns&nbsp;v&#39;s&nbsp;field&nbsp;value&nbsp;corresponding&nbsp;to&nbsp;finfo.</span><br>
<span class="lineno"></span><span class="comment" id="6090996">//&nbsp;It&#39;s&nbsp;equivalent&nbsp;to&nbsp;v.FieldByIndex(finfo.idx),&nbsp;but&nbsp;initializes</span><br>
<span class="lineno"></span><span class="comment" id="6091061">//&nbsp;and&nbsp;dereferences&nbsp;pointers&nbsp;as&nbsp;necessary.</span><br>
<span class="lineno"></span><span class="keyword" id="6091104">func</span>&nbsp;<span class="op" id="6091109">(</span><span class="ident" id="6091110">finfo</span>&nbsp;<span class="op" id="6091116">*</span><span class="ident" id="6091117">fieldInfo</span><span class="op" id="6091126">)</span>&nbsp;<span class="ident" id="6091128">value</span><span class="op" id="6091133">(</span><span class="ident" id="6091134">v</span>&nbsp;<span class="ident" id="6091136">reflect</span><span class="op" id="6091143">.</span><span class="ident" id="6091144">Value</span><span class="op" id="6091149">)</span>&nbsp;<span class="ident" id="6091151">reflect</span><span class="op" id="6091158">.</span><span class="ident" id="6091159">Value</span>&nbsp;<span class="op" id="6091165">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6091168">for</span>&nbsp;<span class="ident" id="6091172">i</span><span class="op" id="6091173">,</span>&nbsp;<span class="ident" id="6091175">x</span>&nbsp;<span class="op" id="6091177">:=</span>&nbsp;<span class="keyword" id="6091180">range</span>&nbsp;<span class="ident" id="6091186">finfo</span><span class="op" id="6091191">.</span><span class="ident" id="6091192">idx</span>&nbsp;<span class="op" id="6091196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6091200">if</span>&nbsp;<span class="ident" id="6091203">i</span>&nbsp;<span class="op" id="6091205">&gt;</span>&nbsp;<span class="num" id="6091207">0</span>&nbsp;<span class="op" id="6091209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6091214">t</span>&nbsp;<span class="op" id="6091216">:=</span>&nbsp;<span class="ident" id="6091219">v</span><span class="op" id="6091220">.</span><span class="ident" id="6091221">Type</span><span class="op" id="6091225">(</span><span class="op" id="6091226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6091231">if</span>&nbsp;<span class="ident" id="6091234">t</span><span class="op" id="6091235">.</span><span class="ident" id="6091236">Kind</span><span class="op" id="6091240">(</span><span class="op" id="6091241">)</span>&nbsp;<span class="op" id="6091243">==</span>&nbsp;<span class="ident" id="6091246">reflect</span><span class="op" id="6091253">.</span><span class="ident" id="6091254">Ptr</span>&nbsp;<span class="op" id="6091258">&amp;&amp;</span>&nbsp;<span class="ident" id="6091261">t</span><span class="op" id="6091262">.</span><span class="ident" id="6091263">Elem</span><span class="op" id="6091267">(</span><span class="op" id="6091268">)</span><span class="op" id="6091269">.</span><span class="ident" id="6091270">Kind</span><span class="op" id="6091274">(</span><span class="op" id="6091275">)</span>&nbsp;<span class="op" id="6091277">==</span>&nbsp;<span class="ident" id="6091280">reflect</span><span class="op" id="6091287">.</span><span class="ident" id="6091288">Struct</span>&nbsp;<span class="op" id="6091295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6091301">if</span>&nbsp;<span class="ident" id="6091304">v</span><span class="op" id="6091305">.</span><span class="ident" id="6091306">IsNil</span><span class="op" id="6091311">(</span><span class="op" id="6091312">)</span>&nbsp;<span class="op" id="6091314">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6091321">v</span><span class="op" id="6091322">.</span><span class="ident" id="6091323">Set</span><span class="op" id="6091326">(</span><span class="ident" id="6091327">reflect</span><span class="op" id="6091334">.</span><span class="ident" id="6091335">New</span><span class="op" id="6091338">(</span><span class="ident" id="6091339">v</span><span class="op" id="6091340">.</span><span class="ident" id="6091341">Type</span><span class="op" id="6091345">(</span><span class="op" id="6091346">)</span><span class="op" id="6091347">.</span><span class="ident" id="6091348">Elem</span><span class="op" id="6091352">(</span><span class="op" id="6091353">)</span><span class="op" id="6091354">)</span><span class="op" id="6091355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6091361">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6091367">v</span>&nbsp;<span class="op" id="6091369">=</span>&nbsp;<span class="ident" id="6091371">v</span><span class="op" id="6091372">.</span><span class="ident" id="6091373">Elem</span><span class="op" id="6091377">(</span><span class="op" id="6091378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6091383">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6091387">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6091391">v</span>&nbsp;<span class="op" id="6091393">=</span>&nbsp;<span class="ident" id="6091395">v</span><span class="op" id="6091396">.</span><span class="ident" id="6091397">Field</span><span class="op" id="6091402">(</span><span class="ident" id="6091403">x</span><span class="op" id="6091404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6091407">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6091410">return</span>&nbsp;<span class="ident" id="6091417">v</span><br>
<span class="lineno"></span><span class="op" id="6091419">}</span>
</div>
</body>
</html>
