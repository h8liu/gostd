<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/gif</h2>
<ul>
<li><a href="/gostd/image/gif/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/gif/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/gif/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/gif/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7024348">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7024403">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7024457">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7024508">package</span>&nbsp;<span class="ident" id="7024516">gif</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7024521">import</span>&nbsp;<span class="op" id="7024528">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7024531">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7024540">&#34;image&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7024549">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7024564">_</span>&nbsp;<span class="string" id="7024566">&#34;image/png&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7024579">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7024592">&#34;math/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7024605">&#34;os&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7024611">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7024621">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7024624">func</span>&nbsp;<span class="ident" id="7024629">readImg</span><span class="op" id="7024636">(</span><span class="ident" id="7024637">filename</span>&nbsp;<span class="builtintype" id="7024646">string</span><span class="op" id="7024652">)</span>&nbsp;<span class="op" id="7024654">(</span><span class="ident" id="7024655">image</span><span class="op" id="7024660">.</span><span class="ident" id="7024661">Image</span><span class="op" id="7024666">,</span>&nbsp;<span class="builtintype" id="7024668">error</span><span class="op" id="7024673">)</span>&nbsp;<span class="op" id="7024675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7024678">f</span><span class="op" id="7024679">,</span>&nbsp;<span class="ident" id="7024681">err</span>&nbsp;<span class="op" id="7024685">:=</span>&nbsp;<span class="ident" id="7024688">os</span><span class="op" id="7024690">.</span><span class="ident" id="7024691">Open</span><span class="op" id="7024695">(</span><span class="ident" id="7024696">filename</span><span class="op" id="7024704">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7024707">if</span>&nbsp;<span class="ident" id="7024710">err</span>&nbsp;<span class="op" id="7024714">!=</span>&nbsp;<span class="ident" id="7024717">nil</span>&nbsp;<span class="op" id="7024721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7024725">return</span>&nbsp;<span class="ident" id="7024732">nil</span><span class="op" id="7024735">,</span>&nbsp;<span class="ident" id="7024737">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7024742">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7024745">defer</span>&nbsp;<span class="ident" id="7024751">f</span><span class="op" id="7024752">.</span><span class="ident" id="7024753">Close</span><span class="op" id="7024758">(</span><span class="op" id="7024759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7024762">m</span><span class="op" id="7024763">,</span>&nbsp;<span class="ident" id="7024765">_</span><span class="op" id="7024766">,</span>&nbsp;<span class="ident" id="7024768">err</span>&nbsp;<span class="op" id="7024772">:=</span>&nbsp;<span class="ident" id="7024775">image</span><span class="op" id="7024780">.</span><span class="ident" id="7024781">Decode</span><span class="op" id="7024787">(</span><span class="ident" id="7024788">f</span><span class="op" id="7024789">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7024792">return</span>&nbsp;<span class="ident" id="7024799">m</span><span class="op" id="7024800">,</span>&nbsp;<span class="ident" id="7024802">err</span><br>
<span class="lineno"></span><span class="op" id="7024806">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7024809">func</span>&nbsp;<span class="ident" id="7024814">readGIF</span><span class="op" id="7024821">(</span><span class="ident" id="7024822">filename</span>&nbsp;<span class="builtintype" id="7024831">string</span><span class="op" id="7024837">)</span>&nbsp;<span class="op" id="7024839">(</span><span class="op" id="7024840">*</span><span class="ident" id="7024841">GIF</span><span class="op" id="7024844">,</span>&nbsp;<span class="builtintype" id="7024846">error</span><span class="op" id="7024851">)</span>&nbsp;<span class="op" id="7024853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7024856">f</span><span class="op" id="7024857">,</span>&nbsp;<span class="ident" id="7024859">err</span>&nbsp;<span class="op" id="7024863">:=</span>&nbsp;<span class="ident" id="7024866">os</span><span class="op" id="7024868">.</span><span class="ident" id="7024869">Open</span><span class="op" id="7024873">(</span><span class="ident" id="7024874">filename</span><span class="op" id="7024882">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7024885">if</span>&nbsp;<span class="ident" id="7024888">err</span>&nbsp;<span class="op" id="7024892">!=</span>&nbsp;<span class="ident" id="7024895">nil</span>&nbsp;<span class="op" id="7024899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7024903">return</span>&nbsp;<span class="ident" id="7024910">nil</span><span class="op" id="7024913">,</span>&nbsp;<span class="ident" id="7024915">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7024920">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7024923">defer</span>&nbsp;<span class="ident" id="7024929">f</span><span class="op" id="7024930">.</span><span class="ident" id="7024931">Close</span><span class="op" id="7024936">(</span><span class="op" id="7024937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7024940">return</span>&nbsp;<span class="ident" id="7024947">DecodeAll</span><span class="op" id="7024956">(</span><span class="ident" id="7024957">f</span><span class="op" id="7024958">)</span><br>
<span class="lineno">35</span><span class="op" id="7024960">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7024963">func</span>&nbsp;<span class="ident" id="7024968">delta</span><span class="op" id="7024973">(</span><span class="ident" id="7024974">u0</span><span class="op" id="7024976">,</span>&nbsp;<span class="ident" id="7024978">u1</span>&nbsp;<span class="builtintype" id="7024981">uint32</span><span class="op" id="7024987">)</span>&nbsp;<span class="ident" id="7024989">int64</span>&nbsp;<span class="op" id="7024995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7024998">d</span>&nbsp;<span class="op" id="7025000">:=</span>&nbsp;<span class="ident" id="7025003">int64</span><span class="op" id="7025008">(</span><span class="ident" id="7025009">u0</span><span class="op" id="7025011">)</span>&nbsp;<span class="op" id="7025013">-</span>&nbsp;<span class="ident" id="7025015">int64</span><span class="op" id="7025020">(</span><span class="ident" id="7025021">u1</span><span class="op" id="7025023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7025026">if</span>&nbsp;<span class="ident" id="7025029">d</span>&nbsp;<span class="op" id="7025031">&lt;</span>&nbsp;<span class="num" id="7025033">0</span>&nbsp;<span class="op" id="7025035">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7025039">return</span>&nbsp;<span class="op" id="7025046">-</span><span class="ident" id="7025047">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7025050">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7025053">return</span>&nbsp;<span class="ident" id="7025060">d</span><br>
<span class="lineno"></span><span class="op" id="7025062">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="7025065">//&nbsp;averageDelta&nbsp;returns&nbsp;the&nbsp;average&nbsp;delta&nbsp;in&nbsp;RGB&nbsp;space.&nbsp;The&nbsp;two&nbsp;images&nbsp;must</span><br>
<span class="lineno"></span><span class="comment" id="7025141">//&nbsp;have&nbsp;the&nbsp;same&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="7025166">func</span>&nbsp;<span class="ident" id="7025171">averageDelta</span><span class="op" id="7025183">(</span><span class="ident" id="7025184">m0</span><span class="op" id="7025186">,</span>&nbsp;<span class="ident" id="7025188">m1</span>&nbsp;<span class="ident" id="7025191">image</span><span class="op" id="7025196">.</span><span class="ident" id="7025197">Image</span><span class="op" id="7025202">)</span>&nbsp;<span class="ident" id="7025204">int64</span>&nbsp;<span class="op" id="7025210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7025213">b</span>&nbsp;<span class="op" id="7025215">:=</span>&nbsp;<span class="ident" id="7025218">m0</span><span class="op" id="7025220">.</span><span class="ident" id="7025221">Bounds</span><span class="op" id="7025227">(</span><span class="op" id="7025228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7025231">var</span>&nbsp;<span class="ident" id="7025235">sum</span><span class="op" id="7025238">,</span>&nbsp;<span class="ident" id="7025240">n</span>&nbsp;<span class="ident" id="7025242">int64</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7025249">for</span>&nbsp;<span class="ident" id="7025253">y</span>&nbsp;<span class="op" id="7025255">:=</span>&nbsp;<span class="ident" id="7025258">b</span><span class="op" id="7025259">.</span><span class="ident" id="7025260">Min</span><span class="op" id="7025263">.</span><span class="ident" id="7025264">Y</span><span class="op" id="7025265">;</span>&nbsp;<span class="ident" id="7025267">y</span>&nbsp;<span class="op" id="7025269">&lt;</span>&nbsp;<span class="ident" id="7025271">b</span><span class="op" id="7025272">.</span><span class="ident" id="7025273">Max</span><span class="op" id="7025276">.</span><span class="ident" id="7025277">Y</span><span class="op" id="7025278">;</span>&nbsp;<span class="ident" id="7025280">y</span><span class="op" id="7025281">++</span>&nbsp;<span class="op" id="7025284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7025288">for</span>&nbsp;<span class="ident" id="7025292">x</span>&nbsp;<span class="op" id="7025294">:=</span>&nbsp;<span class="ident" id="7025297">b</span><span class="op" id="7025298">.</span><span class="ident" id="7025299">Min</span><span class="op" id="7025302">.</span><span class="ident" id="7025303">X</span><span class="op" id="7025304">;</span>&nbsp;<span class="ident" id="7025306">x</span>&nbsp;<span class="op" id="7025308">&lt;</span>&nbsp;<span class="ident" id="7025310">b</span><span class="op" id="7025311">.</span><span class="ident" id="7025312">Max</span><span class="op" id="7025315">.</span><span class="ident" id="7025316">X</span><span class="op" id="7025317">;</span>&nbsp;<span class="ident" id="7025319">x</span><span class="op" id="7025320">++</span>&nbsp;<span class="op" id="7025323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7025328">c0</span>&nbsp;<span class="op" id="7025331">:=</span>&nbsp;<span class="ident" id="7025334">m0</span><span class="op" id="7025336">.</span><span class="ident" id="7025337">At</span><span class="op" id="7025339">(</span><span class="ident" id="7025340">x</span><span class="op" id="7025341">,</span>&nbsp;<span class="ident" id="7025343">y</span><span class="op" id="7025344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7025349">c1</span>&nbsp;<span class="op" id="7025352">:=</span>&nbsp;<span class="ident" id="7025355">m1</span><span class="op" id="7025357">.</span><span class="ident" id="7025358">At</span><span class="op" id="7025360">(</span><span class="ident" id="7025361">x</span><span class="op" id="7025362">,</span>&nbsp;<span class="ident" id="7025364">y</span><span class="op" id="7025365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7025370">r0</span><span class="op" id="7025372">,</span>&nbsp;<span class="ident" id="7025374">g0</span><span class="op" id="7025376">,</span>&nbsp;<span class="ident" id="7025378">b0</span><span class="op" id="7025380">,</span>&nbsp;<span class="ident" id="7025382">_</span>&nbsp;<span class="op" id="7025384">:=</span>&nbsp;<span class="ident" id="7025387">c0</span><span class="op" id="7025389">.</span><span class="ident" id="7025390">RGBA</span><span class="op" id="7025394">(</span><span class="op" id="7025395">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7025400">r1</span><span class="op" id="7025402">,</span>&nbsp;<span class="ident" id="7025404">g1</span><span class="op" id="7025406">,</span>&nbsp;<span class="ident" id="7025408">b1</span><span class="op" id="7025410">,</span>&nbsp;<span class="ident" id="7025412">_</span>&nbsp;<span class="op" id="7025414">:=</span>&nbsp;<span class="ident" id="7025417">c1</span><span class="op" id="7025419">.</span><span class="ident" id="7025420">RGBA</span><span class="op" id="7025424">(</span><span class="op" id="7025425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7025430">sum</span>&nbsp;<span class="op" id="7025434">+=</span>&nbsp;<span class="ident" id="7025437">delta</span><span class="op" id="7025442">(</span><span class="ident" id="7025443">r0</span><span class="op" id="7025445">,</span>&nbsp;<span class="ident" id="7025447">r1</span><span class="op" id="7025449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7025454">sum</span>&nbsp;<span class="op" id="7025458">+=</span>&nbsp;<span class="ident" id="7025461">delta</span><span class="op" id="7025466">(</span><span class="ident" id="7025467">g0</span><span class="op" id="7025469">,</span>&nbsp;<span class="ident" id="7025471">g1</span><span class="op" id="7025473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7025478">sum</span>&nbsp;<span class="op" id="7025482">+=</span>&nbsp;<span class="ident" id="7025485">delta</span><span class="op" id="7025490">(</span><span class="ident" id="7025491">b0</span><span class="op" id="7025493">,</span>&nbsp;<span class="ident" id="7025495">b1</span><span class="op" id="7025497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7025502">n</span>&nbsp;<span class="op" id="7025504">+=</span>&nbsp;<span class="num" id="7025507">3</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7025511">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7025514">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7025517">return</span>&nbsp;<span class="ident" id="7025524">sum</span>&nbsp;<span class="op" id="7025528">/</span>&nbsp;<span class="ident" id="7025530">n</span><br>
<span class="lineno"></span><span class="op" id="7025532">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="keyword" id="7025535">var</span>&nbsp;<span class="ident" id="7025539">testCase</span>&nbsp;<span class="op" id="7025548">=</span>&nbsp;<span class="op" id="7025550">[</span><span class="op" id="7025551">]</span><span class="keyword" id="7025552">struct</span>&nbsp;<span class="op" id="7025559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7025562">filename</span>&nbsp;&nbsp;<span class="builtintype" id="7025572">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7025580">tolerance</span>&nbsp;<span class="ident" id="7025590">int64</span><br>
<span class="lineno"></span><span class="op" id="7025596">}</span><span class="op" id="7025597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7025600">{</span><span class="string" id="7025601">&#34;../testdata/video-001.png&#34;</span><span class="op" id="7025628">,</span>&nbsp;<span class="num" id="7025630">1</span>&nbsp;<span class="op" id="7025632">&lt;&lt;</span>&nbsp;<span class="num" id="7025635">12</span><span class="op" id="7025637">}</span><span class="op" id="7025638">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7025641">{</span><span class="string" id="7025642">&#34;../testdata/video-001.gif&#34;</span><span class="op" id="7025669">,</span>&nbsp;<span class="num" id="7025671">0</span><span class="op" id="7025672">}</span><span class="op" id="7025673">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7025676">{</span><span class="string" id="7025677">&#34;../testdata/video-001.interlaced.gif&#34;</span><span class="op" id="7025715">,</span>&nbsp;<span class="num" id="7025717">0</span><span class="op" id="7025718">}</span><span class="op" id="7025719">,</span><br>
<span class="lineno"></span><span class="op" id="7025721">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7025724">func</span>&nbsp;<span class="ident" id="7025729">TestWriter</span><span class="op" id="7025739">(</span><span class="ident" id="7025740">t</span>&nbsp;<span class="op" id="7025742">*</span><span class="ident" id="7025743">testing</span><span class="op" id="7025750">.</span><span class="ident" id="7025751">T</span><span class="op" id="7025752">)</span>&nbsp;<span class="op" id="7025754">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7025757">for</span>&nbsp;<span class="ident" id="7025761">_</span><span class="op" id="7025762">,</span>&nbsp;<span class="ident" id="7025764">tc</span>&nbsp;<span class="op" id="7025767">:=</span>&nbsp;<span class="keyword" id="7025770">range</span>&nbsp;<span class="ident" id="7025776">testCase</span>&nbsp;<span class="op" id="7025785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7025789">m0</span><span class="op" id="7025791">,</span>&nbsp;<span class="ident" id="7025793">err</span>&nbsp;<span class="op" id="7025797">:=</span>&nbsp;<span class="ident" id="7025800">readImg</span><span class="op" id="7025807">(</span><span class="ident" id="7025808">tc</span><span class="op" id="7025810">.</span><span class="ident" id="7025811">filename</span><span class="op" id="7025819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7025823">if</span>&nbsp;<span class="ident" id="7025826">err</span>&nbsp;<span class="op" id="7025830">!=</span>&nbsp;<span class="ident" id="7025833">nil</span>&nbsp;<span class="op" id="7025837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7025842">t</span><span class="op" id="7025843">.</span><span class="ident" id="7025844">Error</span><span class="op" id="7025849">(</span><span class="ident" id="7025850">tc</span><span class="op" id="7025852">.</span><span class="ident" id="7025853">filename</span><span class="op" id="7025861">,</span>&nbsp;<span class="ident" id="7025863">err</span><span class="op" id="7025866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7025871">continue</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7025882">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7025886">var</span>&nbsp;<span class="ident" id="7025890">buf</span>&nbsp;<span class="ident" id="7025894">bytes</span><span class="op" id="7025899">.</span><span class="ident" id="7025900">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7025909">err</span>&nbsp;<span class="op" id="7025913">=</span>&nbsp;<span class="ident" id="7025915">Encode</span><span class="op" id="7025921">(</span><span class="op" id="7025922">&amp;</span><span class="ident" id="7025923">buf</span><span class="op" id="7025926">,</span>&nbsp;<span class="ident" id="7025928">m0</span><span class="op" id="7025930">,</span>&nbsp;<span class="ident" id="7025932">nil</span><span class="op" id="7025935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7025939">if</span>&nbsp;<span class="ident" id="7025942">err</span>&nbsp;<span class="op" id="7025946">!=</span>&nbsp;<span class="ident" id="7025949">nil</span>&nbsp;<span class="op" id="7025953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7025958">t</span><span class="op" id="7025959">.</span><span class="ident" id="7025960">Error</span><span class="op" id="7025965">(</span><span class="ident" id="7025966">tc</span><span class="op" id="7025968">.</span><span class="ident" id="7025969">filename</span><span class="op" id="7025977">,</span>&nbsp;<span class="ident" id="7025979">err</span><span class="op" id="7025982">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7025987">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7025998">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7026002">m1</span><span class="op" id="7026004">,</span>&nbsp;<span class="ident" id="7026006">err</span>&nbsp;<span class="op" id="7026010">:=</span>&nbsp;<span class="ident" id="7026013">Decode</span><span class="op" id="7026019">(</span><span class="op" id="7026020">&amp;</span><span class="ident" id="7026021">buf</span><span class="op" id="7026024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7026028">if</span>&nbsp;<span class="ident" id="7026031">err</span>&nbsp;<span class="op" id="7026035">!=</span>&nbsp;<span class="ident" id="7026038">nil</span>&nbsp;<span class="op" id="7026042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7026047">t</span><span class="op" id="7026048">.</span><span class="ident" id="7026049">Error</span><span class="op" id="7026054">(</span><span class="ident" id="7026055">tc</span><span class="op" id="7026057">.</span><span class="ident" id="7026058">filename</span><span class="op" id="7026066">,</span>&nbsp;<span class="ident" id="7026068">err</span><span class="op" id="7026071">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7026076">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7026087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7026091">if</span>&nbsp;<span class="ident" id="7026094">m0</span><span class="op" id="7026096">.</span><span class="ident" id="7026097">Bounds</span><span class="op" id="7026103">(</span><span class="op" id="7026104">)</span>&nbsp;<span class="op" id="7026106">!=</span>&nbsp;<span class="ident" id="7026109">m1</span><span class="op" id="7026111">.</span><span class="ident" id="7026112">Bounds</span><span class="op" id="7026118">(</span><span class="op" id="7026119">)</span>&nbsp;<span class="op" id="7026121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7026126">t</span><span class="op" id="7026127">.</span><span class="ident" id="7026128">Errorf</span><span class="op" id="7026134">(</span><span class="string" id="7026135">&#34;%s,&nbsp;bounds&nbsp;differ:&nbsp;%v&nbsp;and&nbsp;%v&#34;</span><span class="op" id="7026165">,</span>&nbsp;<span class="ident" id="7026167">tc</span><span class="op" id="7026169">.</span><span class="ident" id="7026170">filename</span><span class="op" id="7026178">,</span>&nbsp;<span class="ident" id="7026180">m0</span><span class="op" id="7026182">.</span><span class="ident" id="7026183">Bounds</span><span class="op" id="7026189">(</span><span class="op" id="7026190">)</span><span class="op" id="7026191">,</span>&nbsp;<span class="ident" id="7026193">m1</span><span class="op" id="7026195">.</span><span class="ident" id="7026196">Bounds</span><span class="op" id="7026202">(</span><span class="op" id="7026203">)</span><span class="op" id="7026204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7026209">continue</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7026220">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7026224">//&nbsp;Compare&nbsp;the&nbsp;average&nbsp;delta&nbsp;to&nbsp;the&nbsp;tolerance&nbsp;level.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7026279">avgDelta</span>&nbsp;<span class="op" id="7026288">:=</span>&nbsp;<span class="ident" id="7026291">averageDelta</span><span class="op" id="7026303">(</span><span class="ident" id="7026304">m0</span><span class="op" id="7026306">,</span>&nbsp;<span class="ident" id="7026308">m1</span><span class="op" id="7026310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7026314">if</span>&nbsp;<span class="ident" id="7026317">avgDelta</span>&nbsp;<span class="op" id="7026326">&gt;</span>&nbsp;<span class="ident" id="7026328">tc</span><span class="op" id="7026330">.</span><span class="ident" id="7026331">tolerance</span>&nbsp;<span class="op" id="7026341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7026346">t</span><span class="op" id="7026347">.</span><span class="ident" id="7026348">Errorf</span><span class="op" id="7026354">(</span><span class="string" id="7026355">&#34;%s:&nbsp;average&nbsp;delta&nbsp;is&nbsp;too&nbsp;high.&nbsp;expected:&nbsp;%d,&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7026408">,</span>&nbsp;<span class="ident" id="7026410">tc</span><span class="op" id="7026412">.</span><span class="ident" id="7026413">filename</span><span class="op" id="7026421">,</span>&nbsp;<span class="ident" id="7026423">tc</span><span class="op" id="7026425">.</span><span class="ident" id="7026426">tolerance</span><span class="op" id="7026435">,</span>&nbsp;<span class="ident" id="7026437">avgDelta</span><span class="op" id="7026445">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7026450">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7026461">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7026464">}</span><br>
<span class="lineno"></span><span class="op" id="7026466">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="keyword" id="7026469">func</span>&nbsp;<span class="ident" id="7026474">TestSubImage</span><span class="op" id="7026486">(</span><span class="ident" id="7026487">t</span>&nbsp;<span class="op" id="7026489">*</span><span class="ident" id="7026490">testing</span><span class="op" id="7026497">.</span><span class="ident" id="7026498">T</span><span class="op" id="7026499">)</span>&nbsp;<span class="op" id="7026501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7026504">m0</span><span class="op" id="7026506">,</span>&nbsp;<span class="ident" id="7026508">err</span>&nbsp;<span class="op" id="7026512">:=</span>&nbsp;<span class="ident" id="7026515">readImg</span><span class="op" id="7026522">(</span><span class="string" id="7026523">&#34;../testdata/video-001.gif&#34;</span><span class="op" id="7026550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7026553">if</span>&nbsp;<span class="ident" id="7026556">err</span>&nbsp;<span class="op" id="7026560">!=</span>&nbsp;<span class="ident" id="7026563">nil</span>&nbsp;<span class="op" id="7026567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7026571">t</span><span class="op" id="7026572">.</span><span class="ident" id="7026573">Fatalf</span><span class="op" id="7026579">(</span><span class="string" id="7026580">&#34;readImg:&nbsp;%v&#34;</span><span class="op" id="7026593">,</span>&nbsp;<span class="ident" id="7026595">err</span><span class="op" id="7026598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7026601">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7026604">m0</span>&nbsp;<span class="op" id="7026607">=</span>&nbsp;<span class="ident" id="7026609">m0</span><span class="op" id="7026611">.</span><span class="op" id="7026612">(</span><span class="op" id="7026613">*</span><span class="ident" id="7026614">image</span><span class="op" id="7026619">.</span><span class="ident" id="7026620">Paletted</span><span class="op" id="7026628">)</span><span class="op" id="7026629">.</span><span class="ident" id="7026630">SubImage</span><span class="op" id="7026638">(</span><span class="ident" id="7026639">image</span><span class="op" id="7026644">.</span><span class="ident" id="7026645">Rect</span><span class="op" id="7026649">(</span><span class="num" id="7026650">0</span><span class="op" id="7026651">,</span>&nbsp;<span class="num" id="7026653">0</span><span class="op" id="7026654">,</span>&nbsp;<span class="num" id="7026656">50</span><span class="op" id="7026658">,</span>&nbsp;<span class="num" id="7026660">30</span><span class="op" id="7026662">)</span><span class="op" id="7026663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7026666">var</span>&nbsp;<span class="ident" id="7026670">buf</span>&nbsp;<span class="ident" id="7026674">bytes</span><span class="op" id="7026679">.</span><span class="ident" id="7026680">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7026688">err</span>&nbsp;<span class="op" id="7026692">=</span>&nbsp;<span class="ident" id="7026694">Encode</span><span class="op" id="7026700">(</span><span class="op" id="7026701">&amp;</span><span class="ident" id="7026702">buf</span><span class="op" id="7026705">,</span>&nbsp;<span class="ident" id="7026707">m0</span><span class="op" id="7026709">,</span>&nbsp;<span class="ident" id="7026711">nil</span><span class="op" id="7026714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7026717">if</span>&nbsp;<span class="ident" id="7026720">err</span>&nbsp;<span class="op" id="7026724">!=</span>&nbsp;<span class="ident" id="7026727">nil</span>&nbsp;<span class="op" id="7026731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7026735">t</span><span class="op" id="7026736">.</span><span class="ident" id="7026737">Fatalf</span><span class="op" id="7026743">(</span><span class="string" id="7026744">&#34;Encode:&nbsp;%v&#34;</span><span class="op" id="7026756">,</span>&nbsp;<span class="ident" id="7026758">err</span><span class="op" id="7026761">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7026764">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7026767">m1</span><span class="op" id="7026769">,</span>&nbsp;<span class="ident" id="7026771">err</span>&nbsp;<span class="op" id="7026775">:=</span>&nbsp;<span class="ident" id="7026778">Decode</span><span class="op" id="7026784">(</span><span class="op" id="7026785">&amp;</span><span class="ident" id="7026786">buf</span><span class="op" id="7026789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7026792">if</span>&nbsp;<span class="ident" id="7026795">err</span>&nbsp;<span class="op" id="7026799">!=</span>&nbsp;<span class="ident" id="7026802">nil</span>&nbsp;<span class="op" id="7026806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7026810">t</span><span class="op" id="7026811">.</span><span class="ident" id="7026812">Fatalf</span><span class="op" id="7026818">(</span><span class="string" id="7026819">&#34;Decode:&nbsp;%v&#34;</span><span class="op" id="7026831">,</span>&nbsp;<span class="ident" id="7026833">err</span><span class="op" id="7026836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7026839">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7026842">if</span>&nbsp;<span class="ident" id="7026845">m0</span><span class="op" id="7026847">.</span><span class="ident" id="7026848">Bounds</span><span class="op" id="7026854">(</span><span class="op" id="7026855">)</span>&nbsp;<span class="op" id="7026857">!=</span>&nbsp;<span class="ident" id="7026860">m1</span><span class="op" id="7026862">.</span><span class="ident" id="7026863">Bounds</span><span class="op" id="7026869">(</span><span class="op" id="7026870">)</span>&nbsp;<span class="op" id="7026872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7026876">t</span><span class="op" id="7026877">.</span><span class="ident" id="7026878">Fatalf</span><span class="op" id="7026884">(</span><span class="string" id="7026885">&#34;bounds&nbsp;differ:&nbsp;%v&nbsp;and&nbsp;%v&#34;</span><span class="op" id="7026911">,</span>&nbsp;<span class="ident" id="7026913">m0</span><span class="op" id="7026915">.</span><span class="ident" id="7026916">Bounds</span><span class="op" id="7026922">(</span><span class="op" id="7026923">)</span><span class="op" id="7026924">,</span>&nbsp;<span class="ident" id="7026926">m1</span><span class="op" id="7026928">.</span><span class="ident" id="7026929">Bounds</span><span class="op" id="7026935">(</span><span class="op" id="7026936">)</span><span class="op" id="7026937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7026940">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7026943">if</span>&nbsp;<span class="ident" id="7026946">averageDelta</span><span class="op" id="7026958">(</span><span class="ident" id="7026959">m0</span><span class="op" id="7026961">,</span>&nbsp;<span class="ident" id="7026963">m1</span><span class="op" id="7026965">)</span>&nbsp;<span class="op" id="7026967">!=</span>&nbsp;<span class="num" id="7026970">0</span>&nbsp;<span class="op" id="7026972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7026976">t</span><span class="op" id="7026977">.</span><span class="ident" id="7026978">Fatalf</span><span class="op" id="7026984">(</span><span class="string" id="7026985">&#34;images&nbsp;differ&#34;</span><span class="op" id="7027000">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7027003">}</span><br>
<span class="lineno"></span><span class="op" id="7027005">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7027008">var</span>&nbsp;<span class="ident" id="7027012">frames</span>&nbsp;<span class="op" id="7027019">=</span>&nbsp;<span class="op" id="7027021">[</span><span class="op" id="7027022">]</span><span class="builtintype" id="7027023">string</span><span class="op" id="7027029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7027032">&#34;../testdata/video-001.gif&#34;</span><span class="op" id="7027059">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7027062">&#34;../testdata/video-005.gray.gif&#34;</span><span class="op" id="7027094">,</span><br>
<span class="lineno"></span><span class="op" id="7027096">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7027099">func</span>&nbsp;<span class="ident" id="7027104">TestEncodeAll</span><span class="op" id="7027117">(</span><span class="ident" id="7027118">t</span>&nbsp;<span class="op" id="7027120">*</span><span class="ident" id="7027121">testing</span><span class="op" id="7027128">.</span><span class="ident" id="7027129">T</span><span class="op" id="7027130">)</span>&nbsp;<span class="op" id="7027132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7027135">g0</span>&nbsp;<span class="op" id="7027138">:=</span>&nbsp;<span class="op" id="7027141">&amp;</span><span class="ident" id="7027142">GIF</span><span class="op" id="7027145">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7027149">Image</span><span class="op" id="7027154">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7027160">make</span><span class="op" id="7027164">(</span><span class="op" id="7027165">[</span><span class="op" id="7027166">]</span><span class="op" id="7027167">*</span><span class="ident" id="7027168">image</span><span class="op" id="7027173">.</span><span class="ident" id="7027174">Paletted</span><span class="op" id="7027182">,</span>&nbsp;<span class="builtinfunc" id="7027184">len</span><span class="op" id="7027187">(</span><span class="ident" id="7027188">frames</span><span class="op" id="7027194">)</span><span class="op" id="7027195">)</span><span class="op" id="7027196">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7027200">Delay</span><span class="op" id="7027205">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7027211">make</span><span class="op" id="7027215">(</span><span class="op" id="7027216">[</span><span class="op" id="7027217">]</span><span class="builtintype" id="7027218">int</span><span class="op" id="7027221">,</span>&nbsp;<span class="builtinfunc" id="7027223">len</span><span class="op" id="7027226">(</span><span class="ident" id="7027227">frames</span><span class="op" id="7027233">)</span><span class="op" id="7027234">)</span><span class="op" id="7027235">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7027239">LoopCount</span><span class="op" id="7027248">:</span>&nbsp;<span class="num" id="7027250">5</span><span class="op" id="7027251">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7027254">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7027257">for</span>&nbsp;<span class="ident" id="7027261">i</span><span class="op" id="7027262">,</span>&nbsp;<span class="ident" id="7027264">f</span>&nbsp;<span class="op" id="7027266">:=</span>&nbsp;<span class="keyword" id="7027269">range</span>&nbsp;<span class="ident" id="7027275">frames</span>&nbsp;<span class="op" id="7027282">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7027286">m</span><span class="op" id="7027287">,</span>&nbsp;<span class="ident" id="7027289">err</span>&nbsp;<span class="op" id="7027293">:=</span>&nbsp;<span class="ident" id="7027296">readGIF</span><span class="op" id="7027303">(</span><span class="ident" id="7027304">f</span><span class="op" id="7027305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7027309">if</span>&nbsp;<span class="ident" id="7027312">err</span>&nbsp;<span class="op" id="7027316">!=</span>&nbsp;<span class="ident" id="7027319">nil</span>&nbsp;<span class="op" id="7027323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7027328">t</span><span class="op" id="7027329">.</span><span class="ident" id="7027330">Fatal</span><span class="op" id="7027335">(</span><span class="ident" id="7027336">f</span><span class="op" id="7027337">,</span>&nbsp;<span class="ident" id="7027339">err</span><span class="op" id="7027342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7027346">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7027350">g0</span><span class="op" id="7027352">.</span><span class="ident" id="7027353">Image</span><span class="op" id="7027358">[</span><span class="ident" id="7027359">i</span><span class="op" id="7027360">]</span>&nbsp;<span class="op" id="7027362">=</span>&nbsp;<span class="ident" id="7027364">m</span><span class="op" id="7027365">.</span><span class="ident" id="7027366">Image</span><span class="op" id="7027371">[</span><span class="num" id="7027372">0</span><span class="op" id="7027373">]</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7027376">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7027379">var</span>&nbsp;<span class="ident" id="7027383">buf</span>&nbsp;<span class="ident" id="7027387">bytes</span><span class="op" id="7027392">.</span><span class="ident" id="7027393">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7027401">if</span>&nbsp;<span class="ident" id="7027404">err</span>&nbsp;<span class="op" id="7027408">:=</span>&nbsp;<span class="ident" id="7027411">EncodeAll</span><span class="op" id="7027420">(</span><span class="op" id="7027421">&amp;</span><span class="ident" id="7027422">buf</span><span class="op" id="7027425">,</span>&nbsp;<span class="ident" id="7027427">g0</span><span class="op" id="7027429">)</span><span class="op" id="7027430">;</span>&nbsp;<span class="ident" id="7027432">err</span>&nbsp;<span class="op" id="7027436">!=</span>&nbsp;<span class="ident" id="7027439">nil</span>&nbsp;<span class="op" id="7027443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7027447">t</span><span class="op" id="7027448">.</span><span class="ident" id="7027449">Fatal</span><span class="op" id="7027454">(</span><span class="string" id="7027455">&#34;EncodeAll:&#34;</span><span class="op" id="7027467">,</span>&nbsp;<span class="ident" id="7027469">err</span><span class="op" id="7027472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7027475">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7027478">g1</span><span class="op" id="7027480">,</span>&nbsp;<span class="ident" id="7027482">err</span>&nbsp;<span class="op" id="7027486">:=</span>&nbsp;<span class="ident" id="7027489">DecodeAll</span><span class="op" id="7027498">(</span><span class="op" id="7027499">&amp;</span><span class="ident" id="7027500">buf</span><span class="op" id="7027503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7027506">if</span>&nbsp;<span class="ident" id="7027509">err</span>&nbsp;<span class="op" id="7027513">!=</span>&nbsp;<span class="ident" id="7027516">nil</span>&nbsp;<span class="op" id="7027520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7027524">t</span><span class="op" id="7027525">.</span><span class="ident" id="7027526">Fatal</span><span class="op" id="7027531">(</span><span class="string" id="7027532">&#34;DecodeAll:&#34;</span><span class="op" id="7027544">,</span>&nbsp;<span class="ident" id="7027546">err</span><span class="op" id="7027549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7027552">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7027555">if</span>&nbsp;<span class="ident" id="7027558">g0</span><span class="op" id="7027560">.</span><span class="ident" id="7027561">LoopCount</span>&nbsp;<span class="op" id="7027571">!=</span>&nbsp;<span class="ident" id="7027574">g1</span><span class="op" id="7027576">.</span><span class="ident" id="7027577">LoopCount</span>&nbsp;<span class="op" id="7027587">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7027591">t</span><span class="op" id="7027592">.</span><span class="ident" id="7027593">Errorf</span><span class="op" id="7027599">(</span><span class="string" id="7027600">&#34;loop&nbsp;counts&nbsp;differ:&nbsp;%d&nbsp;and&nbsp;%d&#34;</span><span class="op" id="7027631">,</span>&nbsp;<span class="ident" id="7027633">g0</span><span class="op" id="7027635">.</span><span class="ident" id="7027636">LoopCount</span><span class="op" id="7027645">,</span>&nbsp;<span class="ident" id="7027647">g1</span><span class="op" id="7027649">.</span><span class="ident" id="7027650">LoopCount</span><span class="op" id="7027659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7027662">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7027665">for</span>&nbsp;<span class="ident" id="7027669">i</span>&nbsp;<span class="op" id="7027671">:=</span>&nbsp;<span class="keyword" id="7027674">range</span>&nbsp;<span class="ident" id="7027680">g0</span><span class="op" id="7027682">.</span><span class="ident" id="7027683">Image</span>&nbsp;<span class="op" id="7027689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7027693">m0</span><span class="op" id="7027695">,</span>&nbsp;<span class="ident" id="7027697">m1</span>&nbsp;<span class="op" id="7027700">:=</span>&nbsp;<span class="ident" id="7027703">g0</span><span class="op" id="7027705">.</span><span class="ident" id="7027706">Image</span><span class="op" id="7027711">[</span><span class="ident" id="7027712">i</span><span class="op" id="7027713">]</span><span class="op" id="7027714">,</span>&nbsp;<span class="ident" id="7027716">g1</span><span class="op" id="7027718">.</span><span class="ident" id="7027719">Image</span><span class="op" id="7027724">[</span><span class="ident" id="7027725">i</span><span class="op" id="7027726">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7027730">if</span>&nbsp;<span class="ident" id="7027733">m0</span><span class="op" id="7027735">.</span><span class="ident" id="7027736">Bounds</span><span class="op" id="7027742">(</span><span class="op" id="7027743">)</span>&nbsp;<span class="op" id="7027745">!=</span>&nbsp;<span class="ident" id="7027748">m1</span><span class="op" id="7027750">.</span><span class="ident" id="7027751">Bounds</span><span class="op" id="7027757">(</span><span class="op" id="7027758">)</span>&nbsp;<span class="op" id="7027760">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7027765">t</span><span class="op" id="7027766">.</span><span class="ident" id="7027767">Errorf</span><span class="op" id="7027773">(</span><span class="string" id="7027774">&#34;%s,&nbsp;bounds&nbsp;differ:&nbsp;%v&nbsp;and&nbsp;%v&#34;</span><span class="op" id="7027804">,</span>&nbsp;<span class="ident" id="7027806">frames</span><span class="op" id="7027812">[</span><span class="ident" id="7027813">i</span><span class="op" id="7027814">]</span><span class="op" id="7027815">,</span>&nbsp;<span class="ident" id="7027817">m0</span><span class="op" id="7027819">.</span><span class="ident" id="7027820">Bounds</span><span class="op" id="7027826">(</span><span class="op" id="7027827">)</span><span class="op" id="7027828">,</span>&nbsp;<span class="ident" id="7027830">m1</span><span class="op" id="7027832">.</span><span class="ident" id="7027833">Bounds</span><span class="op" id="7027839">(</span><span class="op" id="7027840">)</span><span class="op" id="7027841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7027845">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7027849">d0</span><span class="op" id="7027851">,</span>&nbsp;<span class="ident" id="7027853">d1</span>&nbsp;<span class="op" id="7027856">:=</span>&nbsp;<span class="ident" id="7027859">g0</span><span class="op" id="7027861">.</span><span class="ident" id="7027862">Delay</span><span class="op" id="7027867">[</span><span class="ident" id="7027868">i</span><span class="op" id="7027869">]</span><span class="op" id="7027870">,</span>&nbsp;<span class="ident" id="7027872">g1</span><span class="op" id="7027874">.</span><span class="ident" id="7027875">Delay</span><span class="op" id="7027880">[</span><span class="ident" id="7027881">i</span><span class="op" id="7027882">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7027886">if</span>&nbsp;<span class="ident" id="7027889">d0</span>&nbsp;<span class="op" id="7027892">!=</span>&nbsp;<span class="ident" id="7027895">d1</span>&nbsp;<span class="op" id="7027898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7027903">t</span><span class="op" id="7027904">.</span><span class="ident" id="7027905">Errorf</span><span class="op" id="7027911">(</span><span class="string" id="7027912">&#34;%s:&nbsp;delay&nbsp;values&nbsp;differ:&nbsp;%d&nbsp;and&nbsp;%d&#34;</span><span class="op" id="7027948">,</span>&nbsp;<span class="ident" id="7027950">frames</span><span class="op" id="7027956">[</span><span class="ident" id="7027957">i</span><span class="op" id="7027958">]</span><span class="op" id="7027959">,</span>&nbsp;<span class="ident" id="7027961">d0</span><span class="op" id="7027963">,</span>&nbsp;<span class="ident" id="7027965">d1</span><span class="op" id="7027967">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7027971">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7027974">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7027978">g1</span><span class="op" id="7027980">.</span><span class="ident" id="7027981">Delay</span>&nbsp;<span class="op" id="7027987">=</span>&nbsp;<span class="builtinfunc" id="7027989">make</span><span class="op" id="7027993">(</span><span class="op" id="7027994">[</span><span class="op" id="7027995">]</span><span class="builtintype" id="7027996">int</span><span class="op" id="7027999">,</span>&nbsp;<span class="num" id="7028001">1</span><span class="op" id="7028002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7028005">if</span>&nbsp;<span class="ident" id="7028008">err</span>&nbsp;<span class="op" id="7028012">:=</span>&nbsp;<span class="ident" id="7028015">EncodeAll</span><span class="op" id="7028024">(</span><span class="ident" id="7028025">ioutil</span><span class="op" id="7028031">.</span><span class="ident" id="7028032">Discard</span><span class="op" id="7028039">,</span>&nbsp;<span class="ident" id="7028041">g1</span><span class="op" id="7028043">)</span><span class="op" id="7028044">;</span>&nbsp;<span class="ident" id="7028046">err</span>&nbsp;<span class="op" id="7028050">==</span>&nbsp;<span class="ident" id="7028053">nil</span>&nbsp;<span class="op" id="7028057">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7028061">t</span><span class="op" id="7028062">.</span><span class="ident" id="7028063">Error</span><span class="op" id="7028068">(</span><span class="string" id="7028069">&#34;expected&nbsp;error&nbsp;from&nbsp;mismatched&nbsp;delay&nbsp;and&nbsp;image&nbsp;slice&nbsp;lengths&#34;</span><span class="op" id="7028131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7028134">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7028137">if</span>&nbsp;<span class="ident" id="7028140">err</span>&nbsp;<span class="op" id="7028144">:=</span>&nbsp;<span class="ident" id="7028147">EncodeAll</span><span class="op" id="7028156">(</span><span class="ident" id="7028157">ioutil</span><span class="op" id="7028163">.</span><span class="ident" id="7028164">Discard</span><span class="op" id="7028171">,</span>&nbsp;<span class="op" id="7028173">&amp;</span><span class="ident" id="7028174">GIF</span><span class="op" id="7028177">{</span><span class="op" id="7028178">}</span><span class="op" id="7028179">)</span><span class="op" id="7028180">;</span>&nbsp;<span class="ident" id="7028182">err</span>&nbsp;<span class="op" id="7028186">==</span>&nbsp;<span class="ident" id="7028189">nil</span>&nbsp;<span class="op" id="7028193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7028197">t</span><span class="op" id="7028198">.</span><span class="ident" id="7028199">Error</span><span class="op" id="7028204">(</span><span class="string" id="7028205">&#34;expected&nbsp;error&nbsp;from&nbsp;providing&nbsp;empty&nbsp;gif&#34;</span><span class="op" id="7028246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7028249">}</span><br>
<span class="lineno">175</span><span class="op" id="7028251">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7028254">func</span>&nbsp;<span class="ident" id="7028259">BenchmarkEncode</span><span class="op" id="7028274">(</span><span class="ident" id="7028275">b</span>&nbsp;<span class="op" id="7028277">*</span><span class="ident" id="7028278">testing</span><span class="op" id="7028285">.</span><span class="ident" id="7028286">B</span><span class="op" id="7028287">)</span>&nbsp;<span class="op" id="7028289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7028292">b</span><span class="op" id="7028293">.</span><span class="ident" id="7028294">StopTimer</span><span class="op" id="7028303">(</span><span class="op" id="7028304">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7028308">bo</span>&nbsp;<span class="op" id="7028311">:=</span>&nbsp;<span class="ident" id="7028314">image</span><span class="op" id="7028319">.</span><span class="ident" id="7028320">Rect</span><span class="op" id="7028324">(</span><span class="num" id="7028325">0</span><span class="op" id="7028326">,</span>&nbsp;<span class="num" id="7028328">0</span><span class="op" id="7028329">,</span>&nbsp;<span class="num" id="7028331">640</span><span class="op" id="7028334">,</span>&nbsp;<span class="num" id="7028336">480</span><span class="op" id="7028339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7028342">rnd</span>&nbsp;<span class="op" id="7028346">:=</span>&nbsp;<span class="ident" id="7028349">rand</span><span class="op" id="7028353">.</span><span class="ident" id="7028354">New</span><span class="op" id="7028357">(</span><span class="ident" id="7028358">rand</span><span class="op" id="7028362">.</span><span class="ident" id="7028363">NewSource</span><span class="op" id="7028372">(</span><span class="num" id="7028373">123</span><span class="op" id="7028376">)</span><span class="op" id="7028377">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7028381">//&nbsp;Restrict&nbsp;to&nbsp;a&nbsp;256-color&nbsp;paletted&nbsp;image&nbsp;to&nbsp;avoid&nbsp;quantization&nbsp;path.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7028452">palette</span>&nbsp;<span class="op" id="7028460">:=</span>&nbsp;<span class="builtinfunc" id="7028463">make</span><span class="op" id="7028467">(</span><span class="ident" id="7028468">color</span><span class="op" id="7028473">.</span><span class="ident" id="7028474">Palette</span><span class="op" id="7028481">,</span>&nbsp;<span class="num" id="7028483">256</span><span class="op" id="7028486">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7028489">for</span>&nbsp;<span class="ident" id="7028493">i</span>&nbsp;<span class="op" id="7028495">:=</span>&nbsp;<span class="keyword" id="7028498">range</span>&nbsp;<span class="ident" id="7028504">palette</span>&nbsp;<span class="op" id="7028512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7028516">palette</span><span class="op" id="7028523">[</span><span class="ident" id="7028524">i</span><span class="op" id="7028525">]</span>&nbsp;<span class="op" id="7028527">=</span>&nbsp;<span class="ident" id="7028529">color</span><span class="op" id="7028534">.</span><span class="ident" id="7028535">RGBA</span><span class="op" id="7028539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7028544">uint8</span><span class="op" id="7028549">(</span><span class="ident" id="7028550">rnd</span><span class="op" id="7028553">.</span><span class="ident" id="7028554">Intn</span><span class="op" id="7028558">(</span><span class="num" id="7028559">256</span><span class="op" id="7028562">)</span><span class="op" id="7028563">)</span><span class="op" id="7028564">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7028569">uint8</span><span class="op" id="7028574">(</span><span class="ident" id="7028575">rnd</span><span class="op" id="7028578">.</span><span class="ident" id="7028579">Intn</span><span class="op" id="7028583">(</span><span class="num" id="7028584">256</span><span class="op" id="7028587">)</span><span class="op" id="7028588">)</span><span class="op" id="7028589">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7028594">uint8</span><span class="op" id="7028599">(</span><span class="ident" id="7028600">rnd</span><span class="op" id="7028603">.</span><span class="ident" id="7028604">Intn</span><span class="op" id="7028608">(</span><span class="num" id="7028609">256</span><span class="op" id="7028612">)</span><span class="op" id="7028613">)</span><span class="op" id="7028614">,</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7028619">255</span><span class="op" id="7028622">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7028626">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7028629">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7028632">img</span>&nbsp;<span class="op" id="7028636">:=</span>&nbsp;<span class="ident" id="7028639">image</span><span class="op" id="7028644">.</span><span class="ident" id="7028645">NewPaletted</span><span class="op" id="7028656">(</span><span class="ident" id="7028657">image</span><span class="op" id="7028662">.</span><span class="ident" id="7028663">Rect</span><span class="op" id="7028667">(</span><span class="num" id="7028668">0</span><span class="op" id="7028669">,</span>&nbsp;<span class="num" id="7028671">0</span><span class="op" id="7028672">,</span>&nbsp;<span class="num" id="7028674">640</span><span class="op" id="7028677">,</span>&nbsp;<span class="num" id="7028679">480</span><span class="op" id="7028682">)</span><span class="op" id="7028683">,</span>&nbsp;<span class="ident" id="7028685">palette</span><span class="op" id="7028692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7028695">for</span>&nbsp;<span class="ident" id="7028699">y</span>&nbsp;<span class="op" id="7028701">:=</span>&nbsp;<span class="ident" id="7028704">bo</span><span class="op" id="7028706">.</span><span class="ident" id="7028707">Min</span><span class="op" id="7028710">.</span><span class="ident" id="7028711">Y</span><span class="op" id="7028712">;</span>&nbsp;<span class="ident" id="7028714">y</span>&nbsp;<span class="op" id="7028716">&lt;</span>&nbsp;<span class="ident" id="7028718">bo</span><span class="op" id="7028720">.</span><span class="ident" id="7028721">Max</span><span class="op" id="7028724">.</span><span class="ident" id="7028725">Y</span><span class="op" id="7028726">;</span>&nbsp;<span class="ident" id="7028728">y</span><span class="op" id="7028729">++</span>&nbsp;<span class="op" id="7028732">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7028736">for</span>&nbsp;<span class="ident" id="7028740">x</span>&nbsp;<span class="op" id="7028742">:=</span>&nbsp;<span class="ident" id="7028745">bo</span><span class="op" id="7028747">.</span><span class="ident" id="7028748">Min</span><span class="op" id="7028751">.</span><span class="ident" id="7028752">X</span><span class="op" id="7028753">;</span>&nbsp;<span class="ident" id="7028755">x</span>&nbsp;<span class="op" id="7028757">&lt;</span>&nbsp;<span class="ident" id="7028759">bo</span><span class="op" id="7028761">.</span><span class="ident" id="7028762">Max</span><span class="op" id="7028765">.</span><span class="ident" id="7028766">X</span><span class="op" id="7028767">;</span>&nbsp;<span class="ident" id="7028769">x</span><span class="op" id="7028770">++</span>&nbsp;<span class="op" id="7028773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7028778">img</span><span class="op" id="7028781">.</span><span class="ident" id="7028782">Set</span><span class="op" id="7028785">(</span><span class="ident" id="7028786">x</span><span class="op" id="7028787">,</span>&nbsp;<span class="ident" id="7028789">y</span><span class="op" id="7028790">,</span>&nbsp;<span class="ident" id="7028792">palette</span><span class="op" id="7028799">[</span><span class="ident" id="7028800">rnd</span><span class="op" id="7028803">.</span><span class="ident" id="7028804">Intn</span><span class="op" id="7028808">(</span><span class="num" id="7028809">256</span><span class="op" id="7028812">)</span><span class="op" id="7028813">]</span><span class="op" id="7028814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7028818">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7028821">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7028825">b</span><span class="op" id="7028826">.</span><span class="ident" id="7028827">SetBytes</span><span class="op" id="7028835">(</span><span class="num" id="7028836">640</span>&nbsp;<span class="op" id="7028840">*</span>&nbsp;<span class="num" id="7028842">480</span>&nbsp;<span class="op" id="7028846">*</span>&nbsp;<span class="num" id="7028848">4</span><span class="op" id="7028849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7028852">b</span><span class="op" id="7028853">.</span><span class="ident" id="7028854">StartTimer</span><span class="op" id="7028864">(</span><span class="op" id="7028865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7028868">for</span>&nbsp;<span class="ident" id="7028872">i</span>&nbsp;<span class="op" id="7028874">:=</span>&nbsp;<span class="num" id="7028877">0</span><span class="op" id="7028878">;</span>&nbsp;<span class="ident" id="7028880">i</span>&nbsp;<span class="op" id="7028882">&lt;</span>&nbsp;<span class="ident" id="7028884">b</span><span class="op" id="7028885">.</span><span class="ident" id="7028886">N</span><span class="op" id="7028887">;</span>&nbsp;<span class="ident" id="7028889">i</span><span class="op" id="7028890">++</span>&nbsp;<span class="op" id="7028893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7028897">Encode</span><span class="op" id="7028903">(</span><span class="ident" id="7028904">ioutil</span><span class="op" id="7028910">.</span><span class="ident" id="7028911">Discard</span><span class="op" id="7028918">,</span>&nbsp;<span class="ident" id="7028920">img</span><span class="op" id="7028923">,</span>&nbsp;<span class="ident" id="7028925">nil</span><span class="op" id="7028928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7028931">}</span><br>
<span class="lineno">205</span><span class="op" id="7028933">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7028936">func</span>&nbsp;<span class="ident" id="7028941">BenchmarkQuantizedEncode</span><span class="op" id="7028965">(</span><span class="ident" id="7028966">b</span>&nbsp;<span class="op" id="7028968">*</span><span class="ident" id="7028969">testing</span><span class="op" id="7028976">.</span><span class="ident" id="7028977">B</span><span class="op" id="7028978">)</span>&nbsp;<span class="op" id="7028980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7028983">b</span><span class="op" id="7028984">.</span><span class="ident" id="7028985">StopTimer</span><span class="op" id="7028994">(</span><span class="op" id="7028995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7028998">img</span>&nbsp;<span class="op" id="7029002">:=</span>&nbsp;<span class="ident" id="7029005">image</span><span class="op" id="7029010">.</span><span class="ident" id="7029011">NewRGBA</span><span class="op" id="7029018">(</span><span class="ident" id="7029019">image</span><span class="op" id="7029024">.</span><span class="ident" id="7029025">Rect</span><span class="op" id="7029029">(</span><span class="num" id="7029030">0</span><span class="op" id="7029031">,</span>&nbsp;<span class="num" id="7029033">0</span><span class="op" id="7029034">,</span>&nbsp;<span class="num" id="7029036">640</span><span class="op" id="7029039">,</span>&nbsp;<span class="num" id="7029041">480</span><span class="op" id="7029044">)</span><span class="op" id="7029045">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7029048">bo</span>&nbsp;<span class="op" id="7029051">:=</span>&nbsp;<span class="ident" id="7029054">img</span><span class="op" id="7029057">.</span><span class="ident" id="7029058">Bounds</span><span class="op" id="7029064">(</span><span class="op" id="7029065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7029068">rnd</span>&nbsp;<span class="op" id="7029072">:=</span>&nbsp;<span class="ident" id="7029075">rand</span><span class="op" id="7029079">.</span><span class="ident" id="7029080">New</span><span class="op" id="7029083">(</span><span class="ident" id="7029084">rand</span><span class="op" id="7029088">.</span><span class="ident" id="7029089">NewSource</span><span class="op" id="7029098">(</span><span class="num" id="7029099">123</span><span class="op" id="7029102">)</span><span class="op" id="7029103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7029106">for</span>&nbsp;<span class="ident" id="7029110">y</span>&nbsp;<span class="op" id="7029112">:=</span>&nbsp;<span class="ident" id="7029115">bo</span><span class="op" id="7029117">.</span><span class="ident" id="7029118">Min</span><span class="op" id="7029121">.</span><span class="ident" id="7029122">Y</span><span class="op" id="7029123">;</span>&nbsp;<span class="ident" id="7029125">y</span>&nbsp;<span class="op" id="7029127">&lt;</span>&nbsp;<span class="ident" id="7029129">bo</span><span class="op" id="7029131">.</span><span class="ident" id="7029132">Max</span><span class="op" id="7029135">.</span><span class="ident" id="7029136">Y</span><span class="op" id="7029137">;</span>&nbsp;<span class="ident" id="7029139">y</span><span class="op" id="7029140">++</span>&nbsp;<span class="op" id="7029143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7029147">for</span>&nbsp;<span class="ident" id="7029151">x</span>&nbsp;<span class="op" id="7029153">:=</span>&nbsp;<span class="ident" id="7029156">bo</span><span class="op" id="7029158">.</span><span class="ident" id="7029159">Min</span><span class="op" id="7029162">.</span><span class="ident" id="7029163">X</span><span class="op" id="7029164">;</span>&nbsp;<span class="ident" id="7029166">x</span>&nbsp;<span class="op" id="7029168">&lt;</span>&nbsp;<span class="ident" id="7029170">bo</span><span class="op" id="7029172">.</span><span class="ident" id="7029173">Max</span><span class="op" id="7029176">.</span><span class="ident" id="7029177">X</span><span class="op" id="7029178">;</span>&nbsp;<span class="ident" id="7029180">x</span><span class="op" id="7029181">++</span>&nbsp;<span class="op" id="7029184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7029189">img</span><span class="op" id="7029192">.</span><span class="ident" id="7029193">SetRGBA</span><span class="op" id="7029200">(</span><span class="ident" id="7029201">x</span><span class="op" id="7029202">,</span>&nbsp;<span class="ident" id="7029204">y</span><span class="op" id="7029205">,</span>&nbsp;<span class="ident" id="7029207">color</span><span class="op" id="7029212">.</span><span class="ident" id="7029213">RGBA</span><span class="op" id="7029217">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7029223">uint8</span><span class="op" id="7029228">(</span><span class="ident" id="7029229">rnd</span><span class="op" id="7029232">.</span><span class="ident" id="7029233">Intn</span><span class="op" id="7029237">(</span><span class="num" id="7029238">256</span><span class="op" id="7029241">)</span><span class="op" id="7029242">)</span><span class="op" id="7029243">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7029249">uint8</span><span class="op" id="7029254">(</span><span class="ident" id="7029255">rnd</span><span class="op" id="7029258">.</span><span class="ident" id="7029259">Intn</span><span class="op" id="7029263">(</span><span class="num" id="7029264">256</span><span class="op" id="7029267">)</span><span class="op" id="7029268">)</span><span class="op" id="7029269">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7029275">uint8</span><span class="op" id="7029280">(</span><span class="ident" id="7029281">rnd</span><span class="op" id="7029284">.</span><span class="ident" id="7029285">Intn</span><span class="op" id="7029289">(</span><span class="num" id="7029290">256</span><span class="op" id="7029293">)</span><span class="op" id="7029294">)</span><span class="op" id="7029295">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7029301">255</span><span class="op" id="7029304">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7029309">}</span><span class="op" id="7029310">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7029314">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7029317">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7029320">b</span><span class="op" id="7029321">.</span><span class="ident" id="7029322">SetBytes</span><span class="op" id="7029330">(</span><span class="num" id="7029331">640</span>&nbsp;<span class="op" id="7029335">*</span>&nbsp;<span class="num" id="7029337">480</span>&nbsp;<span class="op" id="7029341">*</span>&nbsp;<span class="num" id="7029343">4</span><span class="op" id="7029344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7029347">b</span><span class="op" id="7029348">.</span><span class="ident" id="7029349">StartTimer</span><span class="op" id="7029359">(</span><span class="op" id="7029360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7029363">for</span>&nbsp;<span class="ident" id="7029367">i</span>&nbsp;<span class="op" id="7029369">:=</span>&nbsp;<span class="num" id="7029372">0</span><span class="op" id="7029373">;</span>&nbsp;<span class="ident" id="7029375">i</span>&nbsp;<span class="op" id="7029377">&lt;</span>&nbsp;<span class="ident" id="7029379">b</span><span class="op" id="7029380">.</span><span class="ident" id="7029381">N</span><span class="op" id="7029382">;</span>&nbsp;<span class="ident" id="7029384">i</span><span class="op" id="7029385">++</span>&nbsp;<span class="op" id="7029388">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7029392">Encode</span><span class="op" id="7029398">(</span><span class="ident" id="7029399">ioutil</span><span class="op" id="7029405">.</span><span class="ident" id="7029406">Discard</span><span class="op" id="7029413">,</span>&nbsp;<span class="ident" id="7029415">img</span><span class="op" id="7029418">,</span>&nbsp;<span class="ident" id="7029420">nil</span><span class="op" id="7029423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7029426">}</span><br>
<span class="lineno"></span><span class="op" id="7029428">}</span>
</div>
</body>
</html>
