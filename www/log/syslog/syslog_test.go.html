<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="7369817">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7369872">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7369926">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="7369977">//&nbsp;+build&nbsp;!windows,!nacl,!plan9</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7370010">package</span>&nbsp;<span class="ident" id="7370018">syslog</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7370026">import</span>&nbsp;<span class="op" id="7370033">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7370036">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7370045">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7370052">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7370058">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7370071">&#34;log&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7370078">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7370085">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7370091">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7370099">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7370110">&#34;time&#34;</span><br>
<span class="lineno">20</span><span class="op" id="7370117">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7370120">func</span>&nbsp;<span class="ident" id="7370125">runPktSyslog</span><span class="op" id="7370137">(</span><span class="ident" id="7370138">c</span>&nbsp;<span class="ident" id="7370140"><a href="/log/syslog/syslog_test.go.html#7370078">net</a></span><span class="op" id="7370143">.</span><span class="ident" id="7370144">PacketConn</span><span class="op" id="7370154">,</span>&nbsp;<span class="ident" id="7370156">done</span>&nbsp;<span class="keyword" id="7370161">chan</span><span class="op" id="7370165">&lt;-</span>&nbsp;<span class="builtintype" id="7370168">string</span><span class="op" id="7370174">)</span>&nbsp;<span class="op" id="7370176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7370179">var</span>&nbsp;<span class="ident" id="7370183">buf</span>&nbsp;<span class="op" id="7370187">[</span><span class="num" id="7370188">4096</span><span class="op" id="7370192">]</span><span class="builtintype" id="7370193">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7370199">var</span>&nbsp;<span class="ident" id="7370203">rcvd</span>&nbsp;<span class="builtintype" id="7370208">string</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7370216">ct</span>&nbsp;<span class="op" id="7370219">:=</span>&nbsp;<span class="num" id="7370222">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7370225">for</span>&nbsp;<span class="op" id="7370229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7370233">var</span>&nbsp;<span class="ident" id="7370237">n</span>&nbsp;<span class="builtintype" id="7370239">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7370245">var</span>&nbsp;<span class="ident" id="7370249">err</span>&nbsp;<span class="builtintype" id="7370253">error</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7370262"><a href="/log/syslog/syslog_test.go.html#7370138">c</a></span><span class="op" id="7370263">.</span><span class="ident" id="7370264">SetReadDeadline</span><span class="op" id="7370279">(</span><span class="ident" id="7370280"><a href="/log/syslog/syslog_test.go.html#7370110">time</a></span><span class="op" id="7370284">.</span><span class="ident" id="7370285">Now</span><span class="op" id="7370288">(</span><span class="op" id="7370289">)</span><span class="op" id="7370290">.</span><span class="ident" id="7370291">Add</span><span class="op" id="7370294">(</span><span class="num" id="7370295">100</span>&nbsp;<span class="op" id="7370299">*</span>&nbsp;<span class="ident" id="7370301"><a href="/log/syslog/syslog_test.go.html#7370110">time</a></span><span class="op" id="7370305">.</span><span class="ident" id="7370306">Millisecond</span><span class="op" id="7370317">)</span><span class="op" id="7370318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7370322"><a href="/log/syslog/syslog_test.go.html#7370237">n</a></span><span class="op" id="7370323">,</span>&nbsp;<span class="ident" id="7370325">_</span><span class="op" id="7370326">,</span>&nbsp;<span class="ident" id="7370328"><a href="/log/syslog/syslog_test.go.html#7370249">err</a></span>&nbsp;<span class="op" id="7370332">=</span>&nbsp;<span class="ident" id="7370334"><a href="/log/syslog/syslog_test.go.html#7370138">c</a></span><span class="op" id="7370335">.</span><span class="ident" id="7370336">ReadFrom</span><span class="op" id="7370344">(</span><span class="ident" id="7370345"><a href="/log/syslog/syslog_test.go.html#7370183">buf</a></span><span class="op" id="7370348">[</span><span class="op" id="7370349">:</span><span class="op" id="7370350">]</span><span class="op" id="7370351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7370355"><a href="/log/syslog/syslog_test.go.html#7370203">rcvd</a></span>&nbsp;<span class="op" id="7370360">+=</span>&nbsp;<span class="builtintype" id="7370363">string</span><span class="op" id="7370369">(</span><span class="ident" id="7370370"><a href="/log/syslog/syslog_test.go.html#7370183">buf</a></span><span class="op" id="7370373">[</span><span class="op" id="7370374">:</span><span class="ident" id="7370375"><a href="/log/syslog/syslog_test.go.html#7370237">n</a></span><span class="op" id="7370376">]</span><span class="op" id="7370377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7370381">if</span>&nbsp;<span class="ident" id="7370384"><a href="/log/syslog/syslog_test.go.html#7370249">err</a></span>&nbsp;<span class="op" id="7370388">!=</span>&nbsp;<span class="ident" id="7370391">nil</span>&nbsp;<span class="op" id="7370395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7370400">if</span>&nbsp;<span class="ident" id="7370403">oe</span><span class="op" id="7370405">,</span>&nbsp;<span class="ident" id="7370407">ok</span>&nbsp;<span class="op" id="7370410">:=</span>&nbsp;<span class="ident" id="7370413"><a href="/log/syslog/syslog_test.go.html#7370249">err</a></span><span class="op" id="7370416">.</span><span class="op" id="7370417">(</span><span class="op" id="7370418">*</span><span class="ident" id="7370419"><a href="/log/syslog/syslog_test.go.html#7370078">net</a></span><span class="op" id="7370422">.</span><span class="ident" id="7370423">OpError</span><span class="op" id="7370430">)</span><span class="op" id="7370431">;</span>&nbsp;<span class="ident" id="7370433"><a href="/log/syslog/syslog_test.go.html#7370407">ok</a></span>&nbsp;<span class="op" id="7370436">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7370442">if</span>&nbsp;<span class="ident" id="7370445"><a href="/log/syslog/syslog_test.go.html#7370216">ct</a></span>&nbsp;<span class="op" id="7370448">&lt;</span>&nbsp;<span class="num" id="7370450">3</span>&nbsp;<span class="op" id="7370452">&amp;&amp;</span>&nbsp;<span class="ident" id="7370455"><a href="/log/syslog/syslog_test.go.html#7370403">oe</a></span><span class="op" id="7370457">.</span><span class="ident" id="7370458">Temporary</span><span class="op" id="7370467">(</span><span class="op" id="7370468">)</span>&nbsp;<span class="op" id="7370470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7370477"><a href="/log/syslog/syslog_test.go.html#7370216">ct</a></span><span class="op" id="7370479">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7370487">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7370500">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7370505">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7370510">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7370518">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7370521">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7370524"><a href="/log/syslog/syslog_test.go.html#7370138">c</a></span><span class="op" id="7370525">.</span><span class="ident" id="7370526">Close</span><span class="op" id="7370531">(</span><span class="op" id="7370532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7370535"><a href="/log/syslog/syslog_test.go.html#7370156">done</a></span>&nbsp;<span class="op" id="7370540">&lt;-</span>&nbsp;<span class="ident" id="7370543"><a href="/log/syslog/syslog_test.go.html#7370203">rcvd</a></span><br>
<span class="lineno">45</span><span class="op" id="7370548">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7370551">var</span>&nbsp;<span class="ident" id="7370555">crashy</span>&nbsp;<span class="op" id="7370562">=</span>&nbsp;<span class="ident" id="7370564">false</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7370571">func</span>&nbsp;<span class="ident" id="7370576">runStreamSyslog</span><span class="op" id="7370591">(</span><span class="ident" id="7370592">l</span>&nbsp;<span class="ident" id="7370594"><a href="/log/syslog/syslog_test.go.html#7370078">net</a></span><span class="op" id="7370597">.</span><span class="ident" id="7370598">Listener</span><span class="op" id="7370606">,</span>&nbsp;<span class="ident" id="7370608">done</span>&nbsp;<span class="keyword" id="7370613">chan</span><span class="op" id="7370617">&lt;-</span>&nbsp;<span class="builtintype" id="7370620">string</span><span class="op" id="7370626">,</span>&nbsp;<span class="ident" id="7370628">wg</span>&nbsp;<span class="op" id="7370631">*</span><span class="ident" id="7370632"><a href="/log/syslog/syslog_test.go.html#7370091">sync</a></span><span class="op" id="7370636">.</span><span class="ident" id="7370637">WaitGroup</span><span class="op" id="7370646">)</span>&nbsp;<span class="op" id="7370648">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7370651">for</span>&nbsp;<span class="op" id="7370655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7370659">var</span>&nbsp;<span class="ident" id="7370663">c</span>&nbsp;<span class="ident" id="7370665"><a href="/log/syslog/syslog_test.go.html#7370078">net</a></span><span class="op" id="7370668">.</span><span class="ident" id="7370669">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7370676">var</span>&nbsp;<span class="ident" id="7370680">err</span>&nbsp;<span class="builtintype" id="7370684">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7370692">if</span>&nbsp;<span class="ident" id="7370695"><a href="/log/syslog/syslog_test.go.html#7370663">c</a></span><span class="op" id="7370696">,</span>&nbsp;<span class="ident" id="7370698"><a href="/log/syslog/syslog_test.go.html#7370680">err</a></span>&nbsp;<span class="op" id="7370702">=</span>&nbsp;<span class="ident" id="7370704"><a href="/log/syslog/syslog_test.go.html#7370592">l</a></span><span class="op" id="7370705">.</span><span class="ident" id="7370706">Accept</span><span class="op" id="7370712">(</span><span class="op" id="7370713">)</span><span class="op" id="7370714">;</span>&nbsp;<span class="ident" id="7370716"><a href="/log/syslog/syslog_test.go.html#7370680">err</a></span>&nbsp;<span class="op" id="7370720">!=</span>&nbsp;<span class="ident" id="7370723">nil</span>&nbsp;<span class="op" id="7370727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7370732">return</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7370741">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7370745"><a href="/log/syslog/syslog_test.go.html#7370628">wg</a></span><span class="op" id="7370747">.</span><span class="ident" id="7370748">Add</span><span class="op" id="7370751">(</span><span class="num" id="7370752">1</span><span class="op" id="7370753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7370757">go</span>&nbsp;<span class="keyword" id="7370760">func</span><span class="op" id="7370764">(</span><span class="ident" id="7370765">c</span>&nbsp;<span class="ident" id="7370767"><a href="/log/syslog/syslog_test.go.html#7370078">net</a></span><span class="op" id="7370770">.</span><span class="ident" id="7370771">Conn</span><span class="op" id="7370775">)</span>&nbsp;<span class="op" id="7370777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7370782">defer</span>&nbsp;<span class="ident" id="7370788"><a href="/log/syslog/syslog_test.go.html#7370628">wg</a></span><span class="op" id="7370790">.</span><span class="ident" id="7370791">Done</span><span class="op" id="7370795">(</span><span class="op" id="7370796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7370801"><a href="/log/syslog/syslog_test.go.html#7370765">c</a></span><span class="op" id="7370802">.</span><span class="ident" id="7370803">SetReadDeadline</span><span class="op" id="7370818">(</span><span class="ident" id="7370819"><a href="/log/syslog/syslog_test.go.html#7370110">time</a></span><span class="op" id="7370823">.</span><span class="ident" id="7370824">Now</span><span class="op" id="7370827">(</span><span class="op" id="7370828">)</span><span class="op" id="7370829">.</span><span class="ident" id="7370830">Add</span><span class="op" id="7370833">(</span><span class="num" id="7370834">5</span>&nbsp;<span class="op" id="7370836">*</span>&nbsp;<span class="ident" id="7370838"><a href="/log/syslog/syslog_test.go.html#7370110">time</a></span><span class="op" id="7370842">.</span><span class="ident" id="7370843">Second</span><span class="op" id="7370849">)</span><span class="op" id="7370850">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7370855">b</span>&nbsp;<span class="op" id="7370857">:=</span>&nbsp;<span class="ident" id="7370860"><a href="/log/syslog/syslog_test.go.html#7370036">bufio</a></span><span class="op" id="7370865">.</span><span class="ident" id="7370866">NewReader</span><span class="op" id="7370875">(</span><span class="ident" id="7370876"><a href="/log/syslog/syslog_test.go.html#7370765">c</a></span><span class="op" id="7370877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7370882">for</span>&nbsp;<span class="ident" id="7370886">ct</span>&nbsp;<span class="op" id="7370889">:=</span>&nbsp;<span class="num" id="7370892">1</span><span class="op" id="7370893">;</span>&nbsp;<span class="op" id="7370895">!</span><span class="ident" id="7370896"><a href="/log/syslog/syslog_test.go.html#7370555">crashy</a></span>&nbsp;<span class="op" id="7370903">||</span>&nbsp;<span class="ident" id="7370906"><a href="/log/syslog/syslog_test.go.html#7370886">ct</a></span><span class="op" id="7370908">&amp;</span><span class="num" id="7370909">7</span>&nbsp;<span class="op" id="7370911">!=</span>&nbsp;<span class="num" id="7370914">0</span><span class="op" id="7370915">;</span>&nbsp;<span class="ident" id="7370917"><a href="/log/syslog/syslog_test.go.html#7370886">ct</a></span><span class="op" id="7370919">++</span>&nbsp;<span class="op" id="7370922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7370928">s</span><span class="op" id="7370929">,</span>&nbsp;<span class="ident" id="7370931">err</span>&nbsp;<span class="op" id="7370935">:=</span>&nbsp;<span class="ident" id="7370938"><a href="/log/syslog/syslog_test.go.html#7370855">b</a></span><span class="op" id="7370939">.</span><span class="ident" id="7370940">ReadString</span><span class="op" id="7370950">(</span><span class="string" id="7370951">&#39;\n&#39;</span><span class="op" id="7370955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7370961">if</span>&nbsp;<span class="ident" id="7370964"><a href="/log/syslog/syslog_test.go.html#7370931">err</a></span>&nbsp;<span class="op" id="7370968">!=</span>&nbsp;<span class="ident" id="7370971">nil</span>&nbsp;<span class="op" id="7370975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7370982">break</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7370992">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7370998"><a href="/log/syslog/syslog_test.go.html#7370608">done</a></span>&nbsp;<span class="op" id="7371003">&lt;-</span>&nbsp;<span class="ident" id="7371006"><a href="/log/syslog/syslog_test.go.html#7370928">s</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7371011">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7371016"><a href="/log/syslog/syslog_test.go.html#7370765">c</a></span><span class="op" id="7371017">.</span><span class="ident" id="7371018">Close</span><span class="op" id="7371023">(</span><span class="op" id="7371024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7371028">}</span><span class="op" id="7371029">(</span><span class="ident" id="7371030"><a href="/log/syslog/syslog_test.go.html#7370663">c</a></span><span class="op" id="7371031">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7371034">}</span><br>
<span class="lineno"></span><span class="op" id="7371036">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7371039">func</span>&nbsp;<span class="ident" id="7371044">startServer</span><span class="op" id="7371055">(</span><span class="ident" id="7371056">n</span><span class="op" id="7371057">,</span>&nbsp;<span class="ident" id="7371059">la</span>&nbsp;<span class="builtintype" id="7371062">string</span><span class="op" id="7371068">,</span>&nbsp;<span class="ident" id="7371070">done</span>&nbsp;<span class="keyword" id="7371075">chan</span><span class="op" id="7371079">&lt;-</span>&nbsp;<span class="builtintype" id="7371082">string</span><span class="op" id="7371088">)</span>&nbsp;<span class="op" id="7371090">(</span><span class="ident" id="7371091">addr</span>&nbsp;<span class="builtintype" id="7371096">string</span><span class="op" id="7371102">,</span>&nbsp;<span class="ident" id="7371104">sock</span>&nbsp;<span class="ident" id="7371109"><a href="/log/syslog/syslog_test.go.html#7370052">io</a></span><span class="op" id="7371111">.</span><span class="ident" id="7371112">Closer</span><span class="op" id="7371118">,</span>&nbsp;<span class="ident" id="7371120">wg</span>&nbsp;<span class="op" id="7371123">*</span><span class="ident" id="7371124"><a href="/log/syslog/syslog_test.go.html#7370091">sync</a></span><span class="op" id="7371128">.</span><span class="ident" id="7371129">WaitGroup</span><span class="op" id="7371138">)</span>&nbsp;<span class="op" id="7371140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7371143">if</span>&nbsp;<span class="ident" id="7371146"><a href="/log/syslog/syslog_test.go.html#7371056">n</a></span>&nbsp;<span class="op" id="7371148">==</span>&nbsp;<span class="string" id="7371151">&#34;udp&#34;</span>&nbsp;<span class="op" id="7371157">||</span>&nbsp;<span class="ident" id="7371160"><a href="/log/syslog/syslog_test.go.html#7371056">n</a></span>&nbsp;<span class="op" id="7371162">==</span>&nbsp;<span class="string" id="7371165">&#34;tcp&#34;</span>&nbsp;<span class="op" id="7371171">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7371175"><a href="/log/syslog/syslog_test.go.html#7371059">la</a></span>&nbsp;<span class="op" id="7371178">=</span>&nbsp;<span class="string" id="7371180">&#34;127.0.0.1:0&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7371195">}</span>&nbsp;<span class="keyword" id="7371197">else</span>&nbsp;<span class="op" id="7371202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7371206">//&nbsp;unix&nbsp;and&nbsp;unixgram:&nbsp;choose&nbsp;an&nbsp;address&nbsp;if&nbsp;none&nbsp;given</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7371262">if</span>&nbsp;<span class="ident" id="7371265"><a href="/log/syslog/syslog_test.go.html#7371059">la</a></span>&nbsp;<span class="op" id="7371268">==</span>&nbsp;<span class="string" id="7371271">&#34;&#34;</span>&nbsp;<span class="op" id="7371274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7371279">//&nbsp;use&nbsp;ioutil.TempFile&nbsp;to&nbsp;get&nbsp;a&nbsp;name&nbsp;that&nbsp;is&nbsp;unique</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7371334">f</span><span class="op" id="7371335">,</span>&nbsp;<span class="ident" id="7371337">err</span>&nbsp;<span class="op" id="7371341">:=</span>&nbsp;<span class="ident" id="7371344"><a href="/log/syslog/syslog_test.go.html#7370058">ioutil</a></span><span class="op" id="7371350">.</span><span class="ident" id="7371351">TempFile</span><span class="op" id="7371359">(</span><span class="string" id="7371360">&#34;&#34;</span><span class="op" id="7371362">,</span>&nbsp;<span class="string" id="7371364">&#34;syslogtest&#34;</span><span class="op" id="7371376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7371381">if</span>&nbsp;<span class="ident" id="7371384"><a href="/log/syslog/syslog_test.go.html#7371337">err</a></span>&nbsp;<span class="op" id="7371388">!=</span>&nbsp;<span class="ident" id="7371391">nil</span>&nbsp;<span class="op" id="7371395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7371401"><a href="/log/syslog/syslog_test.go.html#7370071">log</a></span><span class="op" id="7371404">.</span><span class="ident" id="7371405">Fatal</span><span class="op" id="7371410">(</span><span class="string" id="7371411">&#34;TempFile:&nbsp;&#34;</span><span class="op" id="7371423">,</span>&nbsp;<span class="ident" id="7371425"><a href="/log/syslog/syslog_test.go.html#7371337">err</a></span><span class="op" id="7371428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7371433">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7371438"><a href="/log/syslog/syslog_test.go.html#7371334">f</a></span><span class="op" id="7371439">.</span><span class="ident" id="7371440">Close</span><span class="op" id="7371445">(</span><span class="op" id="7371446">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7371451"><a href="/log/syslog/syslog_test.go.html#7371059">la</a></span>&nbsp;<span class="op" id="7371454">=</span>&nbsp;<span class="ident" id="7371456"><a href="/log/syslog/syslog_test.go.html#7371334">f</a></span><span class="op" id="7371457">.</span><span class="ident" id="7371458">Name</span><span class="op" id="7371462">(</span><span class="op" id="7371463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7371467">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7371471"><a href="/log/syslog/syslog_test.go.html#7370085">os</a></span><span class="op" id="7371473">.</span><span class="ident" id="7371474">Remove</span><span class="op" id="7371480">(</span><span class="ident" id="7371481"><a href="/log/syslog/syslog_test.go.html#7371059">la</a></span><span class="op" id="7371483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7371486">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7371490"><a href="/log/syslog/syslog_test.go.html#7371120">wg</a></span>&nbsp;<span class="op" id="7371493">=</span>&nbsp;<span class="builtinfunc" id="7371495">new</span><span class="op" id="7371498">(</span><span class="ident" id="7371499"><a href="/log/syslog/syslog_test.go.html#7370091">sync</a></span><span class="op" id="7371503">.</span><span class="ident" id="7371504">WaitGroup</span><span class="op" id="7371513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7371516">if</span>&nbsp;<span class="ident" id="7371519"><a href="/log/syslog/syslog_test.go.html#7371056">n</a></span>&nbsp;<span class="op" id="7371521">==</span>&nbsp;<span class="string" id="7371524">&#34;udp&#34;</span>&nbsp;<span class="op" id="7371530">||</span>&nbsp;<span class="ident" id="7371533"><a href="/log/syslog/syslog_test.go.html#7371056">n</a></span>&nbsp;<span class="op" id="7371535">==</span>&nbsp;<span class="string" id="7371538">&#34;unixgram&#34;</span>&nbsp;<span class="op" id="7371549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7371553">l</span><span class="op" id="7371554">,</span>&nbsp;<span class="ident" id="7371556">e</span>&nbsp;<span class="op" id="7371558">:=</span>&nbsp;<span class="ident" id="7371561"><a href="/log/syslog/syslog_test.go.html#7370078">net</a></span><span class="op" id="7371564">.</span><span class="ident" id="7371565">ListenPacket</span><span class="op" id="7371577">(</span><span class="ident" id="7371578"><a href="/log/syslog/syslog_test.go.html#7371056">n</a></span><span class="op" id="7371579">,</span>&nbsp;<span class="ident" id="7371581"><a href="/log/syslog/syslog_test.go.html#7371059">la</a></span><span class="op" id="7371583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7371587">if</span>&nbsp;<span class="ident" id="7371590"><a href="/log/syslog/syslog_test.go.html#7371556">e</a></span>&nbsp;<span class="op" id="7371592">!=</span>&nbsp;<span class="ident" id="7371595">nil</span>&nbsp;<span class="op" id="7371599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7371604"><a href="/log/syslog/syslog_test.go.html#7370071">log</a></span><span class="op" id="7371607">.</span><span class="ident" id="7371608">Fatalf</span><span class="op" id="7371614">(</span><span class="string" id="7371615">&#34;startServer&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7371639">,</span>&nbsp;<span class="ident" id="7371641"><a href="/log/syslog/syslog_test.go.html#7371556">e</a></span><span class="op" id="7371642">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7371646">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7371650"><a href="/log/syslog/syslog_test.go.html#7371091">addr</a></span>&nbsp;<span class="op" id="7371655">=</span>&nbsp;<span class="ident" id="7371657"><a href="/log/syslog/syslog_test.go.html#7371553">l</a></span><span class="op" id="7371658">.</span><span class="ident" id="7371659">LocalAddr</span><span class="op" id="7371668">(</span><span class="op" id="7371669">)</span><span class="op" id="7371670">.</span><span class="ident" id="7371671">String</span><span class="op" id="7371677">(</span><span class="op" id="7371678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7371682"><a href="/log/syslog/syslog_test.go.html#7371104">sock</a></span>&nbsp;<span class="op" id="7371687">=</span>&nbsp;<span class="ident" id="7371689"><a href="/log/syslog/syslog_test.go.html#7371553">l</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7371693"><a href="/log/syslog/syslog_test.go.html#7371120">wg</a></span><span class="op" id="7371695">.</span><span class="ident" id="7371696">Add</span><span class="op" id="7371699">(</span><span class="num" id="7371700">1</span><span class="op" id="7371701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7371705">go</span>&nbsp;<span class="keyword" id="7371708">func</span><span class="op" id="7371712">(</span><span class="op" id="7371713">)</span>&nbsp;<span class="op" id="7371715">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7371720">defer</span>&nbsp;<span class="ident" id="7371726"><a href="/log/syslog/syslog_test.go.html#7371120">wg</a></span><span class="op" id="7371728">.</span><span class="ident" id="7371729">Done</span><span class="op" id="7371733">(</span><span class="op" id="7371734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7371739"><a href="/log/syslog/syslog_test.go.html#7370125">runPktSyslog</a></span><span class="op" id="7371751">(</span><span class="ident" id="7371752"><a href="/log/syslog/syslog_test.go.html#7371553">l</a></span><span class="op" id="7371753">,</span>&nbsp;<span class="ident" id="7371755"><a href="/log/syslog/syslog_test.go.html#7371070">done</a></span><span class="op" id="7371759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7371763">}</span><span class="op" id="7371764">(</span><span class="op" id="7371765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7371768">}</span>&nbsp;<span class="keyword" id="7371770">else</span>&nbsp;<span class="op" id="7371775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7371779">l</span><span class="op" id="7371780">,</span>&nbsp;<span class="ident" id="7371782">e</span>&nbsp;<span class="op" id="7371784">:=</span>&nbsp;<span class="ident" id="7371787"><a href="/log/syslog/syslog_test.go.html#7370078">net</a></span><span class="op" id="7371790">.</span><span class="ident" id="7371791">Listen</span><span class="op" id="7371797">(</span><span class="ident" id="7371798"><a href="/log/syslog/syslog_test.go.html#7371056">n</a></span><span class="op" id="7371799">,</span>&nbsp;<span class="ident" id="7371801"><a href="/log/syslog/syslog_test.go.html#7371059">la</a></span><span class="op" id="7371803">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7371807">if</span>&nbsp;<span class="ident" id="7371810"><a href="/log/syslog/syslog_test.go.html#7371782">e</a></span>&nbsp;<span class="op" id="7371812">!=</span>&nbsp;<span class="ident" id="7371815">nil</span>&nbsp;<span class="op" id="7371819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7371824"><a href="/log/syslog/syslog_test.go.html#7370071">log</a></span><span class="op" id="7371827">.</span><span class="ident" id="7371828">Fatalf</span><span class="op" id="7371834">(</span><span class="string" id="7371835">&#34;startServer&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7371859">,</span>&nbsp;<span class="ident" id="7371861"><a href="/log/syslog/syslog_test.go.html#7371782">e</a></span><span class="op" id="7371862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7371866">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7371870"><a href="/log/syslog/syslog_test.go.html#7371091">addr</a></span>&nbsp;<span class="op" id="7371875">=</span>&nbsp;<span class="ident" id="7371877"><a href="/log/syslog/syslog_test.go.html#7371779">l</a></span><span class="op" id="7371878">.</span><span class="ident" id="7371879">Addr</span><span class="op" id="7371883">(</span><span class="op" id="7371884">)</span><span class="op" id="7371885">.</span><span class="ident" id="7371886">String</span><span class="op" id="7371892">(</span><span class="op" id="7371893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7371897"><a href="/log/syslog/syslog_test.go.html#7371104">sock</a></span>&nbsp;<span class="op" id="7371902">=</span>&nbsp;<span class="ident" id="7371904"><a href="/log/syslog/syslog_test.go.html#7371779">l</a></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7371908"><a href="/log/syslog/syslog_test.go.html#7371120">wg</a></span><span class="op" id="7371910">.</span><span class="ident" id="7371911">Add</span><span class="op" id="7371914">(</span><span class="num" id="7371915">1</span><span class="op" id="7371916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7371920">go</span>&nbsp;<span class="keyword" id="7371923">func</span><span class="op" id="7371927">(</span><span class="op" id="7371928">)</span>&nbsp;<span class="op" id="7371930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7371935">defer</span>&nbsp;<span class="ident" id="7371941"><a href="/log/syslog/syslog_test.go.html#7371120">wg</a></span><span class="op" id="7371943">.</span><span class="ident" id="7371944">Done</span><span class="op" id="7371948">(</span><span class="op" id="7371949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7371954"><a href="/log/syslog/syslog_test.go.html#7370576">runStreamSyslog</a></span><span class="op" id="7371969">(</span><span class="ident" id="7371970"><a href="/log/syslog/syslog_test.go.html#7371779">l</a></span><span class="op" id="7371971">,</span>&nbsp;<span class="ident" id="7371973"><a href="/log/syslog/syslog_test.go.html#7371070">done</a></span><span class="op" id="7371977">,</span>&nbsp;<span class="ident" id="7371979"><a href="/log/syslog/syslog_test.go.html#7371120">wg</a></span><span class="op" id="7371981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7371985">}</span><span class="op" id="7371986">(</span><span class="op" id="7371987">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7371990">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7371993">return</span><br>
<span class="lineno"></span><span class="op" id="7372000">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7372003">func</span>&nbsp;<span class="ident" id="7372008">TestWithSimulated</span><span class="op" id="7372025">(</span><span class="ident" id="7372026">t</span>&nbsp;<span class="op" id="7372028">*</span><span class="ident" id="7372029"><a href="/log/syslog/syslog_test.go.html#7370099">testing</a></span><span class="op" id="7372036">.</span><span class="ident" id="7372037">T</span><span class="op" id="7372038">)</span>&nbsp;<span class="op" id="7372040">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7372043">msg</span>&nbsp;<span class="op" id="7372047">:=</span>&nbsp;<span class="string" id="7372050">&#34;Test&nbsp;123&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7372062">transport</span>&nbsp;<span class="op" id="7372072">:=</span>&nbsp;<span class="op" id="7372075">[</span><span class="op" id="7372076">]</span><span class="builtintype" id="7372077">string</span><span class="op" id="7372083">{</span><span class="string" id="7372084">&#34;unix&#34;</span><span class="op" id="7372090">,</span>&nbsp;<span class="string" id="7372092">&#34;unixgram&#34;</span><span class="op" id="7372102">,</span>&nbsp;<span class="string" id="7372104">&#34;udp&#34;</span><span class="op" id="7372109">,</span>&nbsp;<span class="string" id="7372111">&#34;tcp&#34;</span><span class="op" id="7372116">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7372120">for</span>&nbsp;<span class="ident" id="7372124">_</span><span class="op" id="7372125">,</span>&nbsp;<span class="ident" id="7372127">tr</span>&nbsp;<span class="op" id="7372130">:=</span>&nbsp;<span class="keyword" id="7372133">range</span>&nbsp;<span class="ident" id="7372139"><a href="/log/syslog/syslog_test.go.html#7372062">transport</a></span>&nbsp;<span class="op" id="7372149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7372153">done</span>&nbsp;<span class="op" id="7372158">:=</span>&nbsp;<span class="builtinfunc" id="7372161">make</span><span class="op" id="7372165">(</span><span class="keyword" id="7372166">chan</span>&nbsp;<span class="builtintype" id="7372171">string</span><span class="op" id="7372177">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7372181">addr</span><span class="op" id="7372185">,</span>&nbsp;<span class="ident" id="7372187">sock</span><span class="op" id="7372191">,</span>&nbsp;<span class="ident" id="7372193">srvWG</span>&nbsp;<span class="op" id="7372199">:=</span>&nbsp;<span class="ident" id="7372202"><a href="/log/syslog/syslog_test.go.html#7371044">startServer</a></span><span class="op" id="7372213">(</span><span class="ident" id="7372214"><a href="/log/syslog/syslog_test.go.html#7372127">tr</a></span><span class="op" id="7372216">,</span>&nbsp;<span class="string" id="7372218">&#34;&#34;</span><span class="op" id="7372220">,</span>&nbsp;<span class="ident" id="7372222"><a href="/log/syslog/syslog_test.go.html#7372153">done</a></span><span class="op" id="7372226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7372230">defer</span>&nbsp;<span class="ident" id="7372236"><a href="/log/syslog/syslog_test.go.html#7372193">srvWG</a></span><span class="op" id="7372241">.</span><span class="ident" id="7372242">Wait</span><span class="op" id="7372246">(</span><span class="op" id="7372247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7372251">defer</span>&nbsp;<span class="ident" id="7372257"><a href="/log/syslog/syslog_test.go.html#7372187">sock</a></span><span class="op" id="7372261">.</span><span class="ident" id="7372262">Close</span><span class="op" id="7372267">(</span><span class="op" id="7372268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7372272">if</span>&nbsp;<span class="ident" id="7372275"><a href="/log/syslog/syslog_test.go.html#7372127">tr</a></span>&nbsp;<span class="op" id="7372278">==</span>&nbsp;<span class="string" id="7372281">&#34;unix&#34;</span>&nbsp;<span class="op" id="7372288">||</span>&nbsp;<span class="ident" id="7372291"><a href="/log/syslog/syslog_test.go.html#7372127">tr</a></span>&nbsp;<span class="op" id="7372294">==</span>&nbsp;<span class="string" id="7372297">&#34;unixgram&#34;</span>&nbsp;<span class="op" id="7372308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7372313">defer</span>&nbsp;<span class="ident" id="7372319"><a href="/log/syslog/syslog_test.go.html#7370085">os</a></span><span class="op" id="7372321">.</span><span class="ident" id="7372322">Remove</span><span class="op" id="7372328">(</span><span class="ident" id="7372329"><a href="/log/syslog/syslog_test.go.html#7372181">addr</a></span><span class="op" id="7372333">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7372337">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7372341">s</span><span class="op" id="7372342">,</span>&nbsp;<span class="ident" id="7372344">err</span>&nbsp;<span class="op" id="7372348">:=</span>&nbsp;<span class="ident" id="7372351"><a href="/log/syslog/syslog.go.html#5277478">Dial</a></span><span class="op" id="7372355">(</span><span class="ident" id="7372356"><a href="/log/syslog/syslog_test.go.html#7372127">tr</a></span><span class="op" id="7372358">,</span>&nbsp;<span class="ident" id="7372360"><a href="/log/syslog/syslog_test.go.html#7372181">addr</a></span><span class="op" id="7372364">,</span>&nbsp;<span class="ident" id="7372366"><a href="/log/syslog/syslog.go.html#5275750">LOG_INFO</a></span><span class="op" id="7372374">|</span><span class="ident" id="7372375"><a href="/log/syslog/syslog.go.html#5275926">LOG_USER</a></span><span class="op" id="7372383">,</span>&nbsp;<span class="string" id="7372385">&#34;syslog_test&#34;</span><span class="op" id="7372398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7372402">if</span>&nbsp;<span class="ident" id="7372405"><a href="/log/syslog/syslog_test.go.html#7372344">err</a></span>&nbsp;<span class="op" id="7372409">!=</span>&nbsp;<span class="ident" id="7372412">nil</span>&nbsp;<span class="op" id="7372416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7372421"><a href="/log/syslog/syslog_test.go.html#7372026">t</a></span><span class="op" id="7372422">.</span><span class="ident" id="7372423">Fatalf</span><span class="op" id="7372429">(</span><span class="string" id="7372430">&#34;Dial()&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7372449">,</span>&nbsp;<span class="ident" id="7372451"><a href="/log/syslog/syslog_test.go.html#7372344">err</a></span><span class="op" id="7372454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7372458">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7372462"><a href="/log/syslog/syslog_test.go.html#7372344">err</a></span>&nbsp;<span class="op" id="7372466">=</span>&nbsp;<span class="ident" id="7372468"><a href="/log/syslog/syslog_test.go.html#7372341">s</a></span><span class="op" id="7372469">.</span><span class="ident" id="7372470">Info</span><span class="op" id="7372474">(</span><span class="ident" id="7372475"><a href="/log/syslog/syslog_test.go.html#7372043">msg</a></span><span class="op" id="7372478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7372482">if</span>&nbsp;<span class="ident" id="7372485"><a href="/log/syslog/syslog_test.go.html#7372344">err</a></span>&nbsp;<span class="op" id="7372489">!=</span>&nbsp;<span class="ident" id="7372492">nil</span>&nbsp;<span class="op" id="7372496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7372501"><a href="/log/syslog/syslog_test.go.html#7372026">t</a></span><span class="op" id="7372502">.</span><span class="ident" id="7372503">Fatalf</span><span class="op" id="7372509">(</span><span class="string" id="7372510">&#34;log&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7372526">,</span>&nbsp;<span class="ident" id="7372528"><a href="/log/syslog/syslog_test.go.html#7372344">err</a></span><span class="op" id="7372531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7372535">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7372539"><a href="/log/syslog/syslog_test.go.html#7374301">check</a></span><span class="op" id="7372544">(</span><span class="ident" id="7372545"><a href="/log/syslog/syslog_test.go.html#7372026">t</a></span><span class="op" id="7372546">,</span>&nbsp;<span class="ident" id="7372548"><a href="/log/syslog/syslog_test.go.html#7372043">msg</a></span><span class="op" id="7372551">,</span>&nbsp;<span class="op" id="7372553">&lt;-</span><span class="ident" id="7372555"><a href="/log/syslog/syslog_test.go.html#7372153">done</a></span><span class="op" id="7372559">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7372563"><a href="/log/syslog/syslog_test.go.html#7372341">s</a></span><span class="op" id="7372564">.</span><span class="ident" id="7372565">Close</span><span class="op" id="7372570">(</span><span class="op" id="7372571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7372574">}</span><br>
<span class="lineno"></span><span class="op" id="7372576">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7372579">func</span>&nbsp;<span class="ident" id="7372584">TestFlap</span><span class="op" id="7372592">(</span><span class="ident" id="7372593">t</span>&nbsp;<span class="op" id="7372595">*</span><span class="ident" id="7372596"><a href="/log/syslog/syslog_test.go.html#7370099">testing</a></span><span class="op" id="7372603">.</span><span class="ident" id="7372604">T</span><span class="op" id="7372605">)</span>&nbsp;<span class="op" id="7372607">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7372610">net</span>&nbsp;<span class="op" id="7372614">:=</span>&nbsp;<span class="string" id="7372617">&#34;unix&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7372625">done</span>&nbsp;<span class="op" id="7372630">:=</span>&nbsp;<span class="builtinfunc" id="7372633">make</span><span class="op" id="7372637">(</span><span class="keyword" id="7372638">chan</span>&nbsp;<span class="builtintype" id="7372643">string</span><span class="op" id="7372649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7372652">addr</span><span class="op" id="7372656">,</span>&nbsp;<span class="ident" id="7372658">sock</span><span class="op" id="7372662">,</span>&nbsp;<span class="ident" id="7372664">srvWG</span>&nbsp;<span class="op" id="7372670">:=</span>&nbsp;<span class="ident" id="7372673"><a href="/log/syslog/syslog_test.go.html#7371044">startServer</a></span><span class="op" id="7372684">(</span><span class="ident" id="7372685"><a href="/log/syslog/syslog_test.go.html#7372610">net</a></span><span class="op" id="7372688">,</span>&nbsp;<span class="string" id="7372690">&#34;&#34;</span><span class="op" id="7372692">,</span>&nbsp;<span class="ident" id="7372694"><a href="/log/syslog/syslog_test.go.html#7372625">done</a></span><span class="op" id="7372698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7372701">defer</span>&nbsp;<span class="ident" id="7372707"><a href="/log/syslog/syslog_test.go.html#7372664">srvWG</a></span><span class="op" id="7372712">.</span><span class="ident" id="7372713">Wait</span><span class="op" id="7372717">(</span><span class="op" id="7372718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7372721">defer</span>&nbsp;<span class="ident" id="7372727"><a href="/log/syslog/syslog_test.go.html#7370085">os</a></span><span class="op" id="7372729">.</span><span class="ident" id="7372730">Remove</span><span class="op" id="7372736">(</span><span class="ident" id="7372737"><a href="/log/syslog/syslog_test.go.html#7372652">addr</a></span><span class="op" id="7372741">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7372744">defer</span>&nbsp;<span class="ident" id="7372750"><a href="/log/syslog/syslog_test.go.html#7372658">sock</a></span><span class="op" id="7372754">.</span><span class="ident" id="7372755">Close</span><span class="op" id="7372760">(</span><span class="op" id="7372761">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7372765">s</span><span class="op" id="7372766">,</span>&nbsp;<span class="ident" id="7372768">err</span>&nbsp;<span class="op" id="7372772">:=</span>&nbsp;<span class="ident" id="7372775"><a href="/log/syslog/syslog.go.html#5277478">Dial</a></span><span class="op" id="7372779">(</span><span class="ident" id="7372780"><a href="/log/syslog/syslog_test.go.html#7372610">net</a></span><span class="op" id="7372783">,</span>&nbsp;<span class="ident" id="7372785"><a href="/log/syslog/syslog_test.go.html#7372652">addr</a></span><span class="op" id="7372789">,</span>&nbsp;<span class="ident" id="7372791"><a href="/log/syslog/syslog.go.html#5275750">LOG_INFO</a></span><span class="op" id="7372799">|</span><span class="ident" id="7372800"><a href="/log/syslog/syslog.go.html#5275926">LOG_USER</a></span><span class="op" id="7372808">,</span>&nbsp;<span class="string" id="7372810">&#34;syslog_test&#34;</span><span class="op" id="7372823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7372826">if</span>&nbsp;<span class="ident" id="7372829"><a href="/log/syslog/syslog_test.go.html#7372768">err</a></span>&nbsp;<span class="op" id="7372833">!=</span>&nbsp;<span class="ident" id="7372836">nil</span>&nbsp;<span class="op" id="7372840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7372844"><a href="/log/syslog/syslog_test.go.html#7372593">t</a></span><span class="op" id="7372845">.</span><span class="ident" id="7372846">Fatalf</span><span class="op" id="7372852">(</span><span class="string" id="7372853">&#34;Dial()&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7372872">,</span>&nbsp;<span class="ident" id="7372874"><a href="/log/syslog/syslog_test.go.html#7372768">err</a></span><span class="op" id="7372877">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7372880">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7372883">msg</span>&nbsp;<span class="op" id="7372887">:=</span>&nbsp;<span class="string" id="7372890">&#34;Moo&nbsp;2&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7372899"><a href="/log/syslog/syslog_test.go.html#7372768">err</a></span>&nbsp;<span class="op" id="7372903">=</span>&nbsp;<span class="ident" id="7372905"><a href="/log/syslog/syslog_test.go.html#7372765">s</a></span><span class="op" id="7372906">.</span><span class="ident" id="7372907">Info</span><span class="op" id="7372911">(</span><span class="ident" id="7372912"><a href="/log/syslog/syslog_test.go.html#7372883">msg</a></span><span class="op" id="7372915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7372918">if</span>&nbsp;<span class="ident" id="7372921"><a href="/log/syslog/syslog_test.go.html#7372768">err</a></span>&nbsp;<span class="op" id="7372925">!=</span>&nbsp;<span class="ident" id="7372928">nil</span>&nbsp;<span class="op" id="7372932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7372936"><a href="/log/syslog/syslog_test.go.html#7372593">t</a></span><span class="op" id="7372937">.</span><span class="ident" id="7372938">Fatalf</span><span class="op" id="7372944">(</span><span class="string" id="7372945">&#34;log&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7372961">,</span>&nbsp;<span class="ident" id="7372963"><a href="/log/syslog/syslog_test.go.html#7372768">err</a></span><span class="op" id="7372966">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7372969">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7372972"><a href="/log/syslog/syslog_test.go.html#7374301">check</a></span><span class="op" id="7372977">(</span><span class="ident" id="7372978"><a href="/log/syslog/syslog_test.go.html#7372593">t</a></span><span class="op" id="7372979">,</span>&nbsp;<span class="ident" id="7372981"><a href="/log/syslog/syslog_test.go.html#7372883">msg</a></span><span class="op" id="7372984">,</span>&nbsp;<span class="op" id="7372986">&lt;-</span><span class="ident" id="7372988"><a href="/log/syslog/syslog_test.go.html#7372625">done</a></span><span class="op" id="7372992">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7372996">//&nbsp;restart&nbsp;the&nbsp;server</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7373019">_</span><span class="op" id="7373020">,</span>&nbsp;<span class="ident" id="7373022">sock2</span><span class="op" id="7373027">,</span>&nbsp;<span class="ident" id="7373029">srvWG2</span>&nbsp;<span class="op" id="7373036">:=</span>&nbsp;<span class="ident" id="7373039"><a href="/log/syslog/syslog_test.go.html#7371044">startServer</a></span><span class="op" id="7373050">(</span><span class="ident" id="7373051"><a href="/log/syslog/syslog_test.go.html#7372610">net</a></span><span class="op" id="7373054">,</span>&nbsp;<span class="ident" id="7373056"><a href="/log/syslog/syslog_test.go.html#7372652">addr</a></span><span class="op" id="7373060">,</span>&nbsp;<span class="ident" id="7373062"><a href="/log/syslog/syslog_test.go.html#7372625">done</a></span><span class="op" id="7373066">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7373069">defer</span>&nbsp;<span class="ident" id="7373075"><a href="/log/syslog/syslog_test.go.html#7373029">srvWG2</a></span><span class="op" id="7373081">.</span><span class="ident" id="7373082">Wait</span><span class="op" id="7373086">(</span><span class="op" id="7373087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7373090">defer</span>&nbsp;<span class="ident" id="7373096"><a href="/log/syslog/syslog_test.go.html#7373022">sock2</a></span><span class="op" id="7373101">.</span><span class="ident" id="7373102">Close</span><span class="op" id="7373107">(</span><span class="op" id="7373108">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7373112">//&nbsp;and&nbsp;try&nbsp;retransmitting</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7373139"><a href="/log/syslog/syslog_test.go.html#7372883">msg</a></span>&nbsp;<span class="op" id="7373143">=</span>&nbsp;<span class="string" id="7373145">&#34;Moo&nbsp;3&#34;</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7373154"><a href="/log/syslog/syslog_test.go.html#7372768">err</a></span>&nbsp;<span class="op" id="7373158">=</span>&nbsp;<span class="ident" id="7373160"><a href="/log/syslog/syslog_test.go.html#7372765">s</a></span><span class="op" id="7373161">.</span><span class="ident" id="7373162">Info</span><span class="op" id="7373166">(</span><span class="ident" id="7373167"><a href="/log/syslog/syslog_test.go.html#7372883">msg</a></span><span class="op" id="7373170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7373173">if</span>&nbsp;<span class="ident" id="7373176"><a href="/log/syslog/syslog_test.go.html#7372768">err</a></span>&nbsp;<span class="op" id="7373180">!=</span>&nbsp;<span class="ident" id="7373183">nil</span>&nbsp;<span class="op" id="7373187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7373191"><a href="/log/syslog/syslog_test.go.html#7372593">t</a></span><span class="op" id="7373192">.</span><span class="ident" id="7373193">Fatalf</span><span class="op" id="7373199">(</span><span class="string" id="7373200">&#34;log&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7373216">,</span>&nbsp;<span class="ident" id="7373218"><a href="/log/syslog/syslog_test.go.html#7372768">err</a></span><span class="op" id="7373221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7373224">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7373227"><a href="/log/syslog/syslog_test.go.html#7374301">check</a></span><span class="op" id="7373232">(</span><span class="ident" id="7373233"><a href="/log/syslog/syslog_test.go.html#7372593">t</a></span><span class="op" id="7373234">,</span>&nbsp;<span class="ident" id="7373236"><a href="/log/syslog/syslog_test.go.html#7372883">msg</a></span><span class="op" id="7373239">,</span>&nbsp;<span class="op" id="7373241">&lt;-</span><span class="ident" id="7373243"><a href="/log/syslog/syslog_test.go.html#7372625">done</a></span><span class="op" id="7373247">)</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7373251"><a href="/log/syslog/syslog_test.go.html#7372765">s</a></span><span class="op" id="7373252">.</span><span class="ident" id="7373253">Close</span><span class="op" id="7373258">(</span><span class="op" id="7373259">)</span><br>
<span class="lineno"></span><span class="op" id="7373261">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7373264">func</span>&nbsp;<span class="ident" id="7373269">TestNew</span><span class="op" id="7373276">(</span><span class="ident" id="7373277">t</span>&nbsp;<span class="op" id="7373279">*</span><span class="ident" id="7373280"><a href="/log/syslog/syslog_test.go.html#7370099">testing</a></span><span class="op" id="7373287">.</span><span class="ident" id="7373288">T</span><span class="op" id="7373289">)</span>&nbsp;<span class="op" id="7373291">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7373294">if</span>&nbsp;<span class="ident" id="7373297"><a href="/log/syslog/syslog.go.html#5276178">LOG_LOCAL7</a></span>&nbsp;<span class="op" id="7373308">!=</span>&nbsp;<span class="num" id="7373311">23</span><span class="op" id="7373313">&lt;&lt;</span><span class="num" id="7373315">3</span>&nbsp;<span class="op" id="7373317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7373321"><a href="/log/syslog/syslog_test.go.html#7373277">t</a></span><span class="op" id="7373322">.</span><span class="ident" id="7373323">Fatalf</span><span class="op" id="7373329">(</span><span class="string" id="7373330">&#34;LOG_LOCAL7&nbsp;has&nbsp;wrong&nbsp;value&#34;</span><span class="op" id="7373358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7373361">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7373364">if</span>&nbsp;<span class="ident" id="7373367"><a href="/log/syslog/syslog_test.go.html#7370099">testing</a></span><span class="op" id="7373374">.</span><span class="ident" id="7373375">Short</span><span class="op" id="7373380">(</span><span class="op" id="7373381">)</span>&nbsp;<span class="op" id="7373383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7373387">//&nbsp;Depends&nbsp;on&nbsp;syslog&nbsp;daemon&nbsp;running,&nbsp;and&nbsp;sometimes&nbsp;it&#39;s&nbsp;not.</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7373450"><a href="/log/syslog/syslog_test.go.html#7373277">t</a></span><span class="op" id="7373451">.</span><span class="ident" id="7373452">Skip</span><span class="op" id="7373456">(</span><span class="string" id="7373457">&#34;skipping&nbsp;syslog&nbsp;test&nbsp;during&nbsp;-short&#34;</span><span class="op" id="7373493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7373496">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7373500">s</span><span class="op" id="7373501">,</span>&nbsp;<span class="ident" id="7373503">err</span>&nbsp;<span class="op" id="7373507">:=</span>&nbsp;<span class="ident" id="7373510"><a href="/log/syslog/syslog.go.html#5277091">New</a></span><span class="op" id="7373513">(</span><span class="ident" id="7373514"><a href="/log/syslog/syslog.go.html#5275750">LOG_INFO</a></span><span class="op" id="7373522">|</span><span class="ident" id="7373523"><a href="/log/syslog/syslog.go.html#5275926">LOG_USER</a></span><span class="op" id="7373531">,</span>&nbsp;<span class="string" id="7373533">&#34;the_tag&#34;</span><span class="op" id="7373542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7373545">if</span>&nbsp;<span class="ident" id="7373548"><a href="/log/syslog/syslog_test.go.html#7373503">err</a></span>&nbsp;<span class="op" id="7373552">!=</span>&nbsp;<span class="ident" id="7373555">nil</span>&nbsp;<span class="op" id="7373559">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7373563"><a href="/log/syslog/syslog_test.go.html#7373277">t</a></span><span class="op" id="7373564">.</span><span class="ident" id="7373565">Fatalf</span><span class="op" id="7373571">(</span><span class="string" id="7373572">&#34;New()&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7373590">,</span>&nbsp;<span class="ident" id="7373592"><a href="/log/syslog/syslog_test.go.html#7373503">err</a></span><span class="op" id="7373595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7373598">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7373601">//&nbsp;Don&#39;t&nbsp;send&nbsp;any&nbsp;messages.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7373630"><a href="/log/syslog/syslog_test.go.html#7373500">s</a></span><span class="op" id="7373631">.</span><span class="ident" id="7373632">Close</span><span class="op" id="7373637">(</span><span class="op" id="7373638">)</span><br>
<span class="lineno"></span><span class="op" id="7373640">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="keyword" id="7373643">func</span>&nbsp;<span class="ident" id="7373648">TestNewLogger</span><span class="op" id="7373661">(</span><span class="ident" id="7373662">t</span>&nbsp;<span class="op" id="7373664">*</span><span class="ident" id="7373665"><a href="/log/syslog/syslog_test.go.html#7370099">testing</a></span><span class="op" id="7373672">.</span><span class="ident" id="7373673">T</span><span class="op" id="7373674">)</span>&nbsp;<span class="op" id="7373676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7373679">if</span>&nbsp;<span class="ident" id="7373682"><a href="/log/syslog/syslog_test.go.html#7370099">testing</a></span><span class="op" id="7373689">.</span><span class="ident" id="7373690">Short</span><span class="op" id="7373695">(</span><span class="op" id="7373696">)</span>&nbsp;<span class="op" id="7373698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7373702"><a href="/log/syslog/syslog_test.go.html#7373662">t</a></span><span class="op" id="7373703">.</span><span class="ident" id="7373704">Skip</span><span class="op" id="7373708">(</span><span class="string" id="7373709">&#34;skipping&nbsp;syslog&nbsp;test&nbsp;during&nbsp;-short&#34;</span><span class="op" id="7373745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7373748">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7373751">f</span><span class="op" id="7373752">,</span>&nbsp;<span class="ident" id="7373754">err</span>&nbsp;<span class="op" id="7373758">:=</span>&nbsp;<span class="ident" id="7373761"><a href="/log/syslog/syslog.go.html#5282132">NewLogger</a></span><span class="op" id="7373770">(</span><span class="ident" id="7373771"><a href="/log/syslog/syslog.go.html#5275926">LOG_USER</a></span><span class="op" id="7373779">|</span><span class="ident" id="7373780"><a href="/log/syslog/syslog.go.html#5275750">LOG_INFO</a></span><span class="op" id="7373788">,</span>&nbsp;<span class="num" id="7373790">0</span><span class="op" id="7373791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7373794">if</span>&nbsp;<span class="ident" id="7373797"><a href="/log/syslog/syslog_test.go.html#7373751">f</a></span>&nbsp;<span class="op" id="7373799">==</span>&nbsp;<span class="ident" id="7373802">nil</span>&nbsp;<span class="op" id="7373806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7373810"><a href="/log/syslog/syslog_test.go.html#7373662">t</a></span><span class="op" id="7373811">.</span><span class="ident" id="7373812">Error</span><span class="op" id="7373817">(</span><span class="ident" id="7373818"><a href="/log/syslog/syslog_test.go.html#7373754">err</a></span><span class="op" id="7373821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7373824">}</span><br>
<span class="lineno"></span><span class="op" id="7373826">}</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span><span class="keyword" id="7373829">func</span>&nbsp;<span class="ident" id="7373834">TestDial</span><span class="op" id="7373842">(</span><span class="ident" id="7373843">t</span>&nbsp;<span class="op" id="7373845">*</span><span class="ident" id="7373846"><a href="/log/syslog/syslog_test.go.html#7370099">testing</a></span><span class="op" id="7373853">.</span><span class="ident" id="7373854">T</span><span class="op" id="7373855">)</span>&nbsp;<span class="op" id="7373857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7373860">if</span>&nbsp;<span class="ident" id="7373863"><a href="/log/syslog/syslog_test.go.html#7370099">testing</a></span><span class="op" id="7373870">.</span><span class="ident" id="7373871">Short</span><span class="op" id="7373876">(</span><span class="op" id="7373877">)</span>&nbsp;<span class="op" id="7373879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7373883"><a href="/log/syslog/syslog_test.go.html#7373843">t</a></span><span class="op" id="7373884">.</span><span class="ident" id="7373885">Skip</span><span class="op" id="7373889">(</span><span class="string" id="7373890">&#34;skipping&nbsp;syslog&nbsp;test&nbsp;during&nbsp;-short&#34;</span><span class="op" id="7373926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7373929">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7373932">f</span><span class="op" id="7373933">,</span>&nbsp;<span class="ident" id="7373935">err</span>&nbsp;<span class="op" id="7373939">:=</span>&nbsp;<span class="ident" id="7373942"><a href="/log/syslog/syslog.go.html#5277478">Dial</a></span><span class="op" id="7373946">(</span><span class="string" id="7373947">&#34;&#34;</span><span class="op" id="7373949">,</span>&nbsp;<span class="string" id="7373951">&#34;&#34;</span><span class="op" id="7373953">,</span>&nbsp;<span class="op" id="7373955">(</span><span class="ident" id="7373956"><a href="/log/syslog/syslog.go.html#5276178">LOG_LOCAL7</a></span><span class="op" id="7373966">|</span><span class="ident" id="7373967"><a href="/log/syslog/syslog.go.html#5275760">LOG_DEBUG</a></span><span class="op" id="7373976">)</span><span class="op" id="7373977">+</span><span class="num" id="7373978">1</span><span class="op" id="7373979">,</span>&nbsp;<span class="string" id="7373981">&#34;syslog_test&#34;</span><span class="op" id="7373994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7373997">if</span>&nbsp;<span class="ident" id="7374000"><a href="/log/syslog/syslog_test.go.html#7373932">f</a></span>&nbsp;<span class="op" id="7374002">!=</span>&nbsp;<span class="ident" id="7374005">nil</span>&nbsp;<span class="op" id="7374009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7374013"><a href="/log/syslog/syslog_test.go.html#7373843">t</a></span><span class="op" id="7374014">.</span><span class="ident" id="7374015">Fatalf</span><span class="op" id="7374021">(</span><span class="string" id="7374022">&#34;Should&nbsp;have&nbsp;trapped&nbsp;bad&nbsp;priority&#34;</span><span class="op" id="7374056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7374059">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7374062"><a href="/log/syslog/syslog_test.go.html#7373932">f</a></span><span class="op" id="7374063">,</span>&nbsp;<span class="ident" id="7374065"><a href="/log/syslog/syslog_test.go.html#7373935">err</a></span>&nbsp;<span class="op" id="7374069">=</span>&nbsp;<span class="ident" id="7374071"><a href="/log/syslog/syslog.go.html#5277478">Dial</a></span><span class="op" id="7374075">(</span><span class="string" id="7374076">&#34;&#34;</span><span class="op" id="7374078">,</span>&nbsp;<span class="string" id="7374080">&#34;&#34;</span><span class="op" id="7374082">,</span>&nbsp;<span class="op" id="7374084">-</span><span class="num" id="7374085">1</span><span class="op" id="7374086">,</span>&nbsp;<span class="string" id="7374088">&#34;syslog_test&#34;</span><span class="op" id="7374101">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7374104">if</span>&nbsp;<span class="ident" id="7374107"><a href="/log/syslog/syslog_test.go.html#7373932">f</a></span>&nbsp;<span class="op" id="7374109">!=</span>&nbsp;<span class="ident" id="7374112">nil</span>&nbsp;<span class="op" id="7374116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7374120"><a href="/log/syslog/syslog_test.go.html#7373843">t</a></span><span class="op" id="7374121">.</span><span class="ident" id="7374122">Fatalf</span><span class="op" id="7374128">(</span><span class="string" id="7374129">&#34;Should&nbsp;have&nbsp;trapped&nbsp;bad&nbsp;priority&#34;</span><span class="op" id="7374163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7374166">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7374169">l</span><span class="op" id="7374170">,</span>&nbsp;<span class="ident" id="7374172"><a href="/log/syslog/syslog_test.go.html#7373935">err</a></span>&nbsp;<span class="op" id="7374176">:=</span>&nbsp;<span class="ident" id="7374179"><a href="/log/syslog/syslog.go.html#5277478">Dial</a></span><span class="op" id="7374183">(</span><span class="string" id="7374184">&#34;&#34;</span><span class="op" id="7374186">,</span>&nbsp;<span class="string" id="7374188">&#34;&#34;</span><span class="op" id="7374190">,</span>&nbsp;<span class="ident" id="7374192"><a href="/log/syslog/syslog.go.html#5275926">LOG_USER</a></span><span class="op" id="7374200">|</span><span class="ident" id="7374201"><a href="/log/syslog/syslog.go.html#5275716">LOG_ERR</a></span><span class="op" id="7374208">,</span>&nbsp;<span class="string" id="7374210">&#34;syslog_test&#34;</span><span class="op" id="7374223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7374226">if</span>&nbsp;<span class="ident" id="7374229"><a href="/log/syslog/syslog_test.go.html#7373935">err</a></span>&nbsp;<span class="op" id="7374233">!=</span>&nbsp;<span class="ident" id="7374236">nil</span>&nbsp;<span class="op" id="7374240">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7374244"><a href="/log/syslog/syslog_test.go.html#7373843">t</a></span><span class="op" id="7374245">.</span><span class="ident" id="7374246">Fatalf</span><span class="op" id="7374252">(</span><span class="string" id="7374253">&#34;Dial()&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7374272">,</span>&nbsp;<span class="ident" id="7374274"><a href="/log/syslog/syslog_test.go.html#7373935">err</a></span><span class="op" id="7374277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7374280">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7374283"><a href="/log/syslog/syslog_test.go.html#7374169">l</a></span><span class="op" id="7374284">.</span><span class="ident" id="7374285">Close</span><span class="op" id="7374290">(</span><span class="op" id="7374291">)</span><br>
<span class="lineno"></span><span class="op" id="7374293">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span><span class="keyword" id="7374296">func</span>&nbsp;<span class="ident" id="7374301">check</span><span class="op" id="7374306">(</span><span class="ident" id="7374307">t</span>&nbsp;<span class="op" id="7374309">*</span><span class="ident" id="7374310"><a href="/log/syslog/syslog_test.go.html#7370099">testing</a></span><span class="op" id="7374317">.</span><span class="ident" id="7374318">T</span><span class="op" id="7374319">,</span>&nbsp;<span class="ident" id="7374321">in</span><span class="op" id="7374323">,</span>&nbsp;<span class="ident" id="7374325">out</span>&nbsp;<span class="builtintype" id="7374329">string</span><span class="op" id="7374335">)</span>&nbsp;<span class="op" id="7374337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7374340">tmpl</span>&nbsp;<span class="op" id="7374345">:=</span>&nbsp;<span class="ident" id="7374348"><a href="/log/syslog/syslog_test.go.html#7370045">fmt</a></span><span class="op" id="7374351">.</span><span class="ident" id="7374352">Sprintf</span><span class="op" id="7374359">(</span><span class="string" id="7374360">&#34;&lt;%d&gt;%%s&nbsp;%%s&nbsp;syslog_test[%%d]:&nbsp;%s\n&#34;</span><span class="op" id="7374396">,</span>&nbsp;<span class="ident" id="7374398"><a href="/log/syslog/syslog.go.html#5275926">LOG_USER</a></span><span class="op" id="7374406">+</span><span class="ident" id="7374407"><a href="/log/syslog/syslog.go.html#5275750">LOG_INFO</a></span><span class="op" id="7374415">,</span>&nbsp;<span class="ident" id="7374417"><a href="/log/syslog/syslog_test.go.html#7374321">in</a></span><span class="op" id="7374419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7374422">if</span>&nbsp;<span class="ident" id="7374425">hostname</span><span class="op" id="7374433">,</span>&nbsp;<span class="ident" id="7374435">err</span>&nbsp;<span class="op" id="7374439">:=</span>&nbsp;<span class="ident" id="7374442"><a href="/log/syslog/syslog_test.go.html#7370085">os</a></span><span class="op" id="7374444">.</span><span class="ident" id="7374445">Hostname</span><span class="op" id="7374453">(</span><span class="op" id="7374454">)</span><span class="op" id="7374455">;</span>&nbsp;<span class="ident" id="7374457"><a href="/log/syslog/syslog_test.go.html#7374435">err</a></span>&nbsp;<span class="op" id="7374461">!=</span>&nbsp;<span class="ident" id="7374464">nil</span>&nbsp;<span class="op" id="7374468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7374472"><a href="/log/syslog/syslog_test.go.html#7374307">t</a></span><span class="op" id="7374473">.</span><span class="ident" id="7374474">Error</span><span class="op" id="7374479">(</span><span class="string" id="7374480">&#34;Error&nbsp;retrieving&nbsp;hostname&#34;</span><span class="op" id="7374507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7374510">}</span>&nbsp;<span class="keyword" id="7374512">else</span>&nbsp;<span class="op" id="7374517">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7374521">var</span>&nbsp;<span class="ident" id="7374525">parsedHostname</span><span class="op" id="7374539">,</span>&nbsp;<span class="ident" id="7374541">timestamp</span>&nbsp;<span class="builtintype" id="7374551">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7374560">var</span>&nbsp;<span class="ident" id="7374564">pid</span>&nbsp;<span class="builtintype" id="7374568">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7374574">if</span>&nbsp;<span class="ident" id="7374577">n</span><span class="op" id="7374578">,</span>&nbsp;<span class="ident" id="7374580">err</span>&nbsp;<span class="op" id="7374584">:=</span>&nbsp;<span class="ident" id="7374587"><a href="/log/syslog/syslog_test.go.html#7370045">fmt</a></span><span class="op" id="7374590">.</span><span class="ident" id="7374591">Sscanf</span><span class="op" id="7374597">(</span><span class="ident" id="7374598"><a href="/log/syslog/syslog_test.go.html#7374325">out</a></span><span class="op" id="7374601">,</span>&nbsp;<span class="ident" id="7374603"><a href="/log/syslog/syslog_test.go.html#7374340">tmpl</a></span><span class="op" id="7374607">,</span>&nbsp;<span class="op" id="7374609">&amp;</span><span class="ident" id="7374610"><a href="/log/syslog/syslog_test.go.html#7374541">timestamp</a></span><span class="op" id="7374619">,</span>&nbsp;<span class="op" id="7374621">&amp;</span><span class="ident" id="7374622"><a href="/log/syslog/syslog_test.go.html#7374525">parsedHostname</a></span><span class="op" id="7374636">,</span>&nbsp;<span class="op" id="7374638">&amp;</span><span class="ident" id="7374639"><a href="/log/syslog/syslog_test.go.html#7374564">pid</a></span><span class="op" id="7374642">)</span><span class="op" id="7374643">;</span>&nbsp;<span class="ident" id="7374645"><a href="/log/syslog/syslog_test.go.html#7374577">n</a></span>&nbsp;<span class="op" id="7374647">!=</span>&nbsp;<span class="num" id="7374650">3</span>&nbsp;<span class="op" id="7374652">||</span>&nbsp;<span class="ident" id="7374655"><a href="/log/syslog/syslog_test.go.html#7374580">err</a></span>&nbsp;<span class="op" id="7374659">!=</span>&nbsp;<span class="ident" id="7374662">nil</span>&nbsp;<span class="op" id="7374666">||</span>&nbsp;<span class="ident" id="7374669"><a href="/log/syslog/syslog_test.go.html#7374425">hostname</a></span>&nbsp;<span class="op" id="7374678">!=</span>&nbsp;<span class="ident" id="7374681"><a href="/log/syslog/syslog_test.go.html#7374525">parsedHostname</a></span>&nbsp;<span class="op" id="7374696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7374701"><a href="/log/syslog/syslog_test.go.html#7374307">t</a></span><span class="op" id="7374702">.</span><span class="ident" id="7374703">Errorf</span><span class="op" id="7374709">(</span><span class="string" id="7374710">&#34;Got&nbsp;%q,&nbsp;does&nbsp;not&nbsp;match&nbsp;template&nbsp;%q&nbsp;(%d&nbsp;%s)&#34;</span><span class="op" id="7374754">,</span>&nbsp;<span class="ident" id="7374756"><a href="/log/syslog/syslog_test.go.html#7374325">out</a></span><span class="op" id="7374759">,</span>&nbsp;<span class="ident" id="7374761"><a href="/log/syslog/syslog_test.go.html#7374340">tmpl</a></span><span class="op" id="7374765">,</span>&nbsp;<span class="ident" id="7374767"><a href="/log/syslog/syslog_test.go.html#7374577">n</a></span><span class="op" id="7374768">,</span>&nbsp;<span class="ident" id="7374770"><a href="/log/syslog/syslog_test.go.html#7374580">err</a></span><span class="op" id="7374773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7374777">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7374780">}</span><br>
<span class="lineno"></span><span class="op" id="7374782">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7374785">func</span>&nbsp;<span class="ident" id="7374790">TestWrite</span><span class="op" id="7374799">(</span><span class="ident" id="7374800">t</span>&nbsp;<span class="op" id="7374802">*</span><span class="ident" id="7374803"><a href="/log/syslog/syslog_test.go.html#7370099">testing</a></span><span class="op" id="7374810">.</span><span class="ident" id="7374811">T</span><span class="op" id="7374812">)</span>&nbsp;<span class="op" id="7374814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7374817">tests</span>&nbsp;<span class="op" id="7374823">:=</span>&nbsp;<span class="op" id="7374826">[</span><span class="op" id="7374827">]</span><span class="keyword" id="7374828">struct</span>&nbsp;<span class="op" id="7374835">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7374839">pri</span>&nbsp;<span class="ident" id="7374843"><a href="/log/syslog/syslog.go.html#5275493">Priority</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7374854">pre</span>&nbsp;<span class="builtintype" id="7374858">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7374867">msg</span>&nbsp;<span class="builtintype" id="7374871">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7374880">exp</span>&nbsp;<span class="builtintype" id="7374884">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7374892">}</span><span class="op" id="7374893">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7374897">{</span><span class="ident" id="7374898"><a href="/log/syslog/syslog.go.html#5275926">LOG_USER</a></span>&nbsp;<span class="op" id="7374907">|</span>&nbsp;<span class="ident" id="7374909"><a href="/log/syslog/syslog.go.html#5275716">LOG_ERR</a></span><span class="op" id="7374916">,</span>&nbsp;<span class="string" id="7374918">&#34;syslog_test&#34;</span><span class="op" id="7374931">,</span>&nbsp;<span class="string" id="7374933">&#34;&#34;</span><span class="op" id="7374935">,</span>&nbsp;<span class="string" id="7374937">&#34;%s&nbsp;%s&nbsp;syslog_test[%d]:&nbsp;\n&#34;</span><span class="op" id="7374964">}</span><span class="op" id="7374965">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7374969">{</span><span class="ident" id="7374970"><a href="/log/syslog/syslog.go.html#5275926">LOG_USER</a></span>&nbsp;<span class="op" id="7374979">|</span>&nbsp;<span class="ident" id="7374981"><a href="/log/syslog/syslog.go.html#5275716">LOG_ERR</a></span><span class="op" id="7374988">,</span>&nbsp;<span class="string" id="7374990">&#34;syslog_test&#34;</span><span class="op" id="7375003">,</span>&nbsp;<span class="string" id="7375005">&#34;write&nbsp;test&#34;</span><span class="op" id="7375017">,</span>&nbsp;<span class="string" id="7375019">&#34;%s&nbsp;%s&nbsp;syslog_test[%d]:&nbsp;write&nbsp;test\n&#34;</span><span class="op" id="7375056">}</span><span class="op" id="7375057">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7375061">//&nbsp;Write&nbsp;should&nbsp;not&nbsp;add&nbsp;\n&nbsp;if&nbsp;there&nbsp;already&nbsp;is&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7375114">{</span><span class="ident" id="7375115"><a href="/log/syslog/syslog.go.html#5275926">LOG_USER</a></span>&nbsp;<span class="op" id="7375124">|</span>&nbsp;<span class="ident" id="7375126"><a href="/log/syslog/syslog.go.html#5275716">LOG_ERR</a></span><span class="op" id="7375133">,</span>&nbsp;<span class="string" id="7375135">&#34;syslog_test&#34;</span><span class="op" id="7375148">,</span>&nbsp;<span class="string" id="7375150">&#34;write&nbsp;test&nbsp;2\n&#34;</span><span class="op" id="7375166">,</span>&nbsp;<span class="string" id="7375168">&#34;%s&nbsp;%s&nbsp;syslog_test[%d]:&nbsp;write&nbsp;test&nbsp;2\n&#34;</span><span class="op" id="7375207">}</span><span class="op" id="7375208">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7375211">}</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7375215">if</span>&nbsp;<span class="ident" id="7375218">hostname</span><span class="op" id="7375226">,</span>&nbsp;<span class="ident" id="7375228">err</span>&nbsp;<span class="op" id="7375232">:=</span>&nbsp;<span class="ident" id="7375235"><a href="/log/syslog/syslog_test.go.html#7370085">os</a></span><span class="op" id="7375237">.</span><span class="ident" id="7375238">Hostname</span><span class="op" id="7375246">(</span><span class="op" id="7375247">)</span><span class="op" id="7375248">;</span>&nbsp;<span class="ident" id="7375250"><a href="/log/syslog/syslog_test.go.html#7375228">err</a></span>&nbsp;<span class="op" id="7375254">!=</span>&nbsp;<span class="ident" id="7375257">nil</span>&nbsp;<span class="op" id="7375261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7375265"><a href="/log/syslog/syslog_test.go.html#7374800">t</a></span><span class="op" id="7375266">.</span><span class="ident" id="7375267">Fatalf</span><span class="op" id="7375273">(</span><span class="string" id="7375274">&#34;Error&nbsp;retrieving&nbsp;hostname&#34;</span><span class="op" id="7375301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7375304">}</span>&nbsp;<span class="keyword" id="7375306">else</span>&nbsp;<span class="op" id="7375311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7375315">for</span>&nbsp;<span class="ident" id="7375319">_</span><span class="op" id="7375320">,</span>&nbsp;<span class="ident" id="7375322">test</span>&nbsp;<span class="op" id="7375327">:=</span>&nbsp;<span class="keyword" id="7375330">range</span>&nbsp;<span class="ident" id="7375336"><a href="/log/syslog/syslog_test.go.html#7374817">tests</a></span>&nbsp;<span class="op" id="7375342">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7375347">done</span>&nbsp;<span class="op" id="7375352">:=</span>&nbsp;<span class="builtinfunc" id="7375355">make</span><span class="op" id="7375359">(</span><span class="keyword" id="7375360">chan</span>&nbsp;<span class="builtintype" id="7375365">string</span><span class="op" id="7375371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7375376">addr</span><span class="op" id="7375380">,</span>&nbsp;<span class="ident" id="7375382">sock</span><span class="op" id="7375386">,</span>&nbsp;<span class="ident" id="7375388">srvWG</span>&nbsp;<span class="op" id="7375394">:=</span>&nbsp;<span class="ident" id="7375397"><a href="/log/syslog/syslog_test.go.html#7371044">startServer</a></span><span class="op" id="7375408">(</span><span class="string" id="7375409">&#34;udp&#34;</span><span class="op" id="7375414">,</span>&nbsp;<span class="string" id="7375416">&#34;&#34;</span><span class="op" id="7375418">,</span>&nbsp;<span class="ident" id="7375420"><a href="/log/syslog/syslog_test.go.html#7375347">done</a></span><span class="op" id="7375424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7375429">defer</span>&nbsp;<span class="ident" id="7375435"><a href="/log/syslog/syslog_test.go.html#7375388">srvWG</a></span><span class="op" id="7375440">.</span><span class="ident" id="7375441">Wait</span><span class="op" id="7375445">(</span><span class="op" id="7375446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7375451">defer</span>&nbsp;<span class="ident" id="7375457"><a href="/log/syslog/syslog_test.go.html#7375382">sock</a></span><span class="op" id="7375461">.</span><span class="ident" id="7375462">Close</span><span class="op" id="7375467">(</span><span class="op" id="7375468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7375473">l</span><span class="op" id="7375474">,</span>&nbsp;<span class="ident" id="7375476">err</span>&nbsp;<span class="op" id="7375480">:=</span>&nbsp;<span class="ident" id="7375483"><a href="/log/syslog/syslog.go.html#5277478">Dial</a></span><span class="op" id="7375487">(</span><span class="string" id="7375488">&#34;udp&#34;</span><span class="op" id="7375493">,</span>&nbsp;<span class="ident" id="7375495"><a href="/log/syslog/syslog_test.go.html#7375376">addr</a></span><span class="op" id="7375499">,</span>&nbsp;<span class="ident" id="7375501"><a href="/log/syslog/syslog_test.go.html#7375322">test</a></span><span class="op" id="7375505">.</span><span class="ident" id="7375506">pri</span><span class="op" id="7375509">,</span>&nbsp;<span class="ident" id="7375511"><a href="/log/syslog/syslog_test.go.html#7375322">test</a></span><span class="op" id="7375515">.</span><span class="ident" id="7375516">pre</span><span class="op" id="7375519">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7375524">if</span>&nbsp;<span class="ident" id="7375527"><a href="/log/syslog/syslog_test.go.html#7375476">err</a></span>&nbsp;<span class="op" id="7375531">!=</span>&nbsp;<span class="ident" id="7375534">nil</span>&nbsp;<span class="op" id="7375538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7375544"><a href="/log/syslog/syslog_test.go.html#7374800">t</a></span><span class="op" id="7375545">.</span><span class="ident" id="7375546">Fatalf</span><span class="op" id="7375552">(</span><span class="string" id="7375553">&#34;syslog.Dial()&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7375579">,</span>&nbsp;<span class="ident" id="7375581"><a href="/log/syslog/syslog_test.go.html#7375476">err</a></span><span class="op" id="7375584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7375589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7375594">defer</span>&nbsp;<span class="ident" id="7375600"><a href="/log/syslog/syslog_test.go.html#7375473">l</a></span><span class="op" id="7375601">.</span><span class="ident" id="7375602">Close</span><span class="op" id="7375607">(</span><span class="op" id="7375608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7375613">_</span><span class="op" id="7375614">,</span>&nbsp;<span class="ident" id="7375616"><a href="/log/syslog/syslog_test.go.html#7375476">err</a></span>&nbsp;<span class="op" id="7375620">=</span>&nbsp;<span class="ident" id="7375622"><a href="/log/syslog/syslog_test.go.html#7370052">io</a></span><span class="op" id="7375624">.</span><span class="ident" id="7375625">WriteString</span><span class="op" id="7375636">(</span><span class="ident" id="7375637"><a href="/log/syslog/syslog_test.go.html#7375473">l</a></span><span class="op" id="7375638">,</span>&nbsp;<span class="ident" id="7375640"><a href="/log/syslog/syslog_test.go.html#7375322">test</a></span><span class="op" id="7375644">.</span><span class="ident" id="7375645">msg</span><span class="op" id="7375648">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7375653">if</span>&nbsp;<span class="ident" id="7375656"><a href="/log/syslog/syslog_test.go.html#7375476">err</a></span>&nbsp;<span class="op" id="7375660">!=</span>&nbsp;<span class="ident" id="7375663">nil</span>&nbsp;<span class="op" id="7375667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7375673"><a href="/log/syslog/syslog_test.go.html#7374800">t</a></span><span class="op" id="7375674">.</span><span class="ident" id="7375675">Fatalf</span><span class="op" id="7375681">(</span><span class="string" id="7375682">&#34;WriteString()&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7375708">,</span>&nbsp;<span class="ident" id="7375710"><a href="/log/syslog/syslog_test.go.html#7375476">err</a></span><span class="op" id="7375713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7375718">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7375723">rcvd</span>&nbsp;<span class="op" id="7375728">:=</span>&nbsp;<span class="op" id="7375731">&lt;-</span><span class="ident" id="7375733"><a href="/log/syslog/syslog_test.go.html#7375347">done</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7375741"><a href="/log/syslog/syslog_test.go.html#7375322">test</a></span><span class="op" id="7375745">.</span><span class="ident" id="7375746">exp</span>&nbsp;<span class="op" id="7375750">=</span>&nbsp;<span class="ident" id="7375752"><a href="/log/syslog/syslog_test.go.html#7370045">fmt</a></span><span class="op" id="7375755">.</span><span class="ident" id="7375756">Sprintf</span><span class="op" id="7375763">(</span><span class="string" id="7375764">&#34;&lt;%d&gt;&#34;</span><span class="op" id="7375770">,</span>&nbsp;<span class="ident" id="7375772"><a href="/log/syslog/syslog_test.go.html#7375322">test</a></span><span class="op" id="7375776">.</span><span class="ident" id="7375777">pri</span><span class="op" id="7375780">)</span>&nbsp;<span class="op" id="7375782">+</span>&nbsp;<span class="ident" id="7375784"><a href="/log/syslog/syslog_test.go.html#7375322">test</a></span><span class="op" id="7375788">.</span><span class="ident" id="7375789">exp</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7375796">var</span>&nbsp;<span class="ident" id="7375800">parsedHostname</span><span class="op" id="7375814">,</span>&nbsp;<span class="ident" id="7375816">timestamp</span>&nbsp;<span class="builtintype" id="7375826">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7375836">var</span>&nbsp;<span class="ident" id="7375840">pid</span>&nbsp;<span class="builtintype" id="7375844">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7375851">if</span>&nbsp;<span class="ident" id="7375854">n</span><span class="op" id="7375855">,</span>&nbsp;<span class="ident" id="7375857">err</span>&nbsp;<span class="op" id="7375861">:=</span>&nbsp;<span class="ident" id="7375864"><a href="/log/syslog/syslog_test.go.html#7370045">fmt</a></span><span class="op" id="7375867">.</span><span class="ident" id="7375868">Sscanf</span><span class="op" id="7375874">(</span><span class="ident" id="7375875"><a href="/log/syslog/syslog_test.go.html#7375723">rcvd</a></span><span class="op" id="7375879">,</span>&nbsp;<span class="ident" id="7375881"><a href="/log/syslog/syslog_test.go.html#7375322">test</a></span><span class="op" id="7375885">.</span><span class="ident" id="7375886">exp</span><span class="op" id="7375889">,</span>&nbsp;<span class="op" id="7375891">&amp;</span><span class="ident" id="7375892"><a href="/log/syslog/syslog_test.go.html#7375816">timestamp</a></span><span class="op" id="7375901">,</span>&nbsp;<span class="op" id="7375903">&amp;</span><span class="ident" id="7375904"><a href="/log/syslog/syslog_test.go.html#7375800">parsedHostname</a></span><span class="op" id="7375918">,</span>&nbsp;<span class="op" id="7375920">&amp;</span><span class="ident" id="7375921"><a href="/log/syslog/syslog_test.go.html#7375840">pid</a></span><span class="op" id="7375924">)</span><span class="op" id="7375925">;</span>&nbsp;<span class="ident" id="7375927"><a href="/log/syslog/syslog_test.go.html#7375854">n</a></span>&nbsp;<span class="op" id="7375929">!=</span>&nbsp;<span class="num" id="7375932">3</span>&nbsp;<span class="op" id="7375934">||</span>&nbsp;<span class="ident" id="7375937"><a href="/log/syslog/syslog_test.go.html#7375857">err</a></span>&nbsp;<span class="op" id="7375941">!=</span>&nbsp;<span class="ident" id="7375944">nil</span>&nbsp;<span class="op" id="7375948">||</span>&nbsp;<span class="ident" id="7375951"><a href="/log/syslog/syslog_test.go.html#7375218">hostname</a></span>&nbsp;<span class="op" id="7375960">!=</span>&nbsp;<span class="ident" id="7375963"><a href="/log/syslog/syslog_test.go.html#7375800">parsedHostname</a></span>&nbsp;<span class="op" id="7375978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7375984"><a href="/log/syslog/syslog_test.go.html#7374800">t</a></span><span class="op" id="7375985">.</span><span class="ident" id="7375986">Errorf</span><span class="op" id="7375992">(</span><span class="string" id="7375993">&#34;s.Info()&nbsp;=&nbsp;&#39;%q&#39;,&nbsp;didn&#39;t&nbsp;match&nbsp;&#39;%q&#39;&nbsp;(%d&nbsp;%s)&#34;</span><span class="op" id="7376037">,</span>&nbsp;<span class="ident" id="7376039"><a href="/log/syslog/syslog_test.go.html#7375723">rcvd</a></span><span class="op" id="7376043">,</span>&nbsp;<span class="ident" id="7376045"><a href="/log/syslog/syslog_test.go.html#7375322">test</a></span><span class="op" id="7376049">.</span><span class="ident" id="7376050">exp</span><span class="op" id="7376053">,</span>&nbsp;<span class="ident" id="7376055"><a href="/log/syslog/syslog_test.go.html#7375854">n</a></span><span class="op" id="7376056">,</span>&nbsp;<span class="ident" id="7376058"><a href="/log/syslog/syslog_test.go.html#7375857">err</a></span><span class="op" id="7376061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7376066">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7376070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7376073">}</span><br>
<span class="lineno"></span><span class="op" id="7376075">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7376078">func</span>&nbsp;<span class="ident" id="7376083">TestConcurrentWrite</span><span class="op" id="7376102">(</span><span class="ident" id="7376103">t</span>&nbsp;<span class="op" id="7376105">*</span><span class="ident" id="7376106"><a href="/log/syslog/syslog_test.go.html#7370099">testing</a></span><span class="op" id="7376113">.</span><span class="ident" id="7376114">T</span><span class="op" id="7376115">)</span>&nbsp;<span class="op" id="7376117">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7376120">addr</span><span class="op" id="7376124">,</span>&nbsp;<span class="ident" id="7376126">sock</span><span class="op" id="7376130">,</span>&nbsp;<span class="ident" id="7376132">srvWG</span>&nbsp;<span class="op" id="7376138">:=</span>&nbsp;<span class="ident" id="7376141"><a href="/log/syslog/syslog_test.go.html#7371044">startServer</a></span><span class="op" id="7376152">(</span><span class="string" id="7376153">&#34;udp&#34;</span><span class="op" id="7376158">,</span>&nbsp;<span class="string" id="7376160">&#34;&#34;</span><span class="op" id="7376162">,</span>&nbsp;<span class="builtinfunc" id="7376164">make</span><span class="op" id="7376168">(</span><span class="keyword" id="7376169">chan</span>&nbsp;<span class="builtintype" id="7376174">string</span><span class="op" id="7376180">,</span>&nbsp;<span class="num" id="7376182">1</span><span class="op" id="7376183">)</span><span class="op" id="7376184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7376187">defer</span>&nbsp;<span class="ident" id="7376193"><a href="/log/syslog/syslog_test.go.html#7376132">srvWG</a></span><span class="op" id="7376198">.</span><span class="ident" id="7376199">Wait</span><span class="op" id="7376203">(</span><span class="op" id="7376204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7376207">defer</span>&nbsp;<span class="ident" id="7376213"><a href="/log/syslog/syslog_test.go.html#7376126">sock</a></span><span class="op" id="7376217">.</span><span class="ident" id="7376218">Close</span><span class="op" id="7376223">(</span><span class="op" id="7376224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7376227">w</span><span class="op" id="7376228">,</span>&nbsp;<span class="ident" id="7376230">err</span>&nbsp;<span class="op" id="7376234">:=</span>&nbsp;<span class="ident" id="7376237"><a href="/log/syslog/syslog.go.html#5277478">Dial</a></span><span class="op" id="7376241">(</span><span class="string" id="7376242">&#34;udp&#34;</span><span class="op" id="7376247">,</span>&nbsp;<span class="ident" id="7376249"><a href="/log/syslog/syslog_test.go.html#7376120">addr</a></span><span class="op" id="7376253">,</span>&nbsp;<span class="ident" id="7376255"><a href="/log/syslog/syslog.go.html#5275926">LOG_USER</a></span><span class="op" id="7376263">|</span><span class="ident" id="7376264"><a href="/log/syslog/syslog.go.html#5275716">LOG_ERR</a></span><span class="op" id="7376271">,</span>&nbsp;<span class="string" id="7376273">&#34;how&#39;s&nbsp;it&nbsp;going?&#34;</span><span class="op" id="7376290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7376293">if</span>&nbsp;<span class="ident" id="7376296"><a href="/log/syslog/syslog_test.go.html#7376230">err</a></span>&nbsp;<span class="op" id="7376300">!=</span>&nbsp;<span class="ident" id="7376303">nil</span>&nbsp;<span class="op" id="7376307">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7376311"><a href="/log/syslog/syslog_test.go.html#7376103">t</a></span><span class="op" id="7376312">.</span><span class="ident" id="7376313">Fatalf</span><span class="op" id="7376319">(</span><span class="string" id="7376320">&#34;syslog.Dial()&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7376346">,</span>&nbsp;<span class="ident" id="7376348"><a href="/log/syslog/syslog_test.go.html#7376230">err</a></span><span class="op" id="7376351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7376354">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7376357">var</span>&nbsp;<span class="ident" id="7376361">wg</span>&nbsp;<span class="ident" id="7376364"><a href="/log/syslog/syslog_test.go.html#7370091">sync</a></span><span class="op" id="7376368">.</span><span class="ident" id="7376369">WaitGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7376380">for</span>&nbsp;<span class="ident" id="7376384">i</span>&nbsp;<span class="op" id="7376386">:=</span>&nbsp;<span class="num" id="7376389">0</span><span class="op" id="7376390">;</span>&nbsp;<span class="ident" id="7376392"><a href="/log/syslog/syslog_test.go.html#7376384">i</a></span>&nbsp;<span class="op" id="7376394">&lt;</span>&nbsp;<span class="num" id="7376396">10</span><span class="op" id="7376398">;</span>&nbsp;<span class="ident" id="7376400"><a href="/log/syslog/syslog_test.go.html#7376384">i</a></span><span class="op" id="7376401">++</span>&nbsp;<span class="op" id="7376404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7376408"><a href="/log/syslog/syslog_test.go.html#7376361">wg</a></span><span class="op" id="7376410">.</span><span class="ident" id="7376411">Add</span><span class="op" id="7376414">(</span><span class="num" id="7376415">1</span><span class="op" id="7376416">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7376420">go</span>&nbsp;<span class="keyword" id="7376423">func</span><span class="op" id="7376427">(</span><span class="op" id="7376428">)</span>&nbsp;<span class="op" id="7376430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7376435">defer</span>&nbsp;<span class="ident" id="7376441"><a href="/log/syslog/syslog_test.go.html#7376361">wg</a></span><span class="op" id="7376443">.</span><span class="ident" id="7376444">Done</span><span class="op" id="7376448">(</span><span class="op" id="7376449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7376454">err</span>&nbsp;<span class="op" id="7376458">:=</span>&nbsp;<span class="ident" id="7376461"><a href="/log/syslog/syslog_test.go.html#7376227">w</a></span><span class="op" id="7376462">.</span><span class="ident" id="7376463">Info</span><span class="op" id="7376467">(</span><span class="string" id="7376468">&#34;test&#34;</span><span class="op" id="7376474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7376479">if</span>&nbsp;<span class="ident" id="7376482"><a href="/log/syslog/syslog_test.go.html#7376454">err</a></span>&nbsp;<span class="op" id="7376486">!=</span>&nbsp;<span class="ident" id="7376489">nil</span>&nbsp;<span class="op" id="7376493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7376499"><a href="/log/syslog/syslog_test.go.html#7376103">t</a></span><span class="op" id="7376500">.</span><span class="ident" id="7376501">Errorf</span><span class="op" id="7376507">(</span><span class="string" id="7376508">&#34;Info()&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7376527">,</span>&nbsp;<span class="ident" id="7376529"><a href="/log/syslog/syslog_test.go.html#7376454">err</a></span><span class="op" id="7376532">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7376538">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7376548">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7376552">}</span><span class="op" id="7376553">(</span><span class="op" id="7376554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7376557">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7376560"><a href="/log/syslog/syslog_test.go.html#7376361">wg</a></span><span class="op" id="7376562">.</span><span class="ident" id="7376563">Wait</span><span class="op" id="7376567">(</span><span class="op" id="7376568">)</span><br>
<span class="lineno">300</span><span class="op" id="7376570">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7376573">func</span>&nbsp;<span class="ident" id="7376578">TestConcurrentReconnect</span><span class="op" id="7376601">(</span><span class="ident" id="7376602">t</span>&nbsp;<span class="op" id="7376604">*</span><span class="ident" id="7376605"><a href="/log/syslog/syslog_test.go.html#7370099">testing</a></span><span class="op" id="7376612">.</span><span class="ident" id="7376613">T</span><span class="op" id="7376614">)</span>&nbsp;<span class="op" id="7376616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7376619"><a href="/log/syslog/syslog_test.go.html#7370555">crashy</a></span>&nbsp;<span class="op" id="7376626">=</span>&nbsp;<span class="ident" id="7376628">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7376634">defer</span>&nbsp;<span class="keyword" id="7376640">func</span><span class="op" id="7376644">(</span><span class="op" id="7376645">)</span>&nbsp;<span class="op" id="7376647">{</span>&nbsp;<span class="ident" id="7376649"><a href="/log/syslog/syslog_test.go.html#7370555">crashy</a></span>&nbsp;<span class="op" id="7376656">=</span>&nbsp;<span class="ident" id="7376658">false</span>&nbsp;<span class="op" id="7376664">}</span><span class="op" id="7376665">(</span><span class="op" id="7376666">)</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7376670">const</span>&nbsp;<span class="ident" id="7376676">N</span>&nbsp;<span class="op" id="7376678">=</span>&nbsp;<span class="num" id="7376680">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7376684">const</span>&nbsp;<span class="ident" id="7376690">M</span>&nbsp;<span class="op" id="7376692">=</span>&nbsp;<span class="num" id="7376694">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7376699">net</span>&nbsp;<span class="op" id="7376703">:=</span>&nbsp;<span class="string" id="7376706">&#34;unix&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7376714">done</span>&nbsp;<span class="op" id="7376719">:=</span>&nbsp;<span class="builtinfunc" id="7376722">make</span><span class="op" id="7376726">(</span><span class="keyword" id="7376727">chan</span>&nbsp;<span class="builtintype" id="7376732">string</span><span class="op" id="7376738">,</span>&nbsp;<span class="ident" id="7376740"><a href="/log/syslog/syslog_test.go.html#7376676">N</a></span><span class="op" id="7376741">*</span><span class="ident" id="7376742"><a href="/log/syslog/syslog_test.go.html#7376690">M</a></span><span class="op" id="7376743">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7376746">addr</span><span class="op" id="7376750">,</span>&nbsp;<span class="ident" id="7376752">sock</span><span class="op" id="7376756">,</span>&nbsp;<span class="ident" id="7376758">srvWG</span>&nbsp;<span class="op" id="7376764">:=</span>&nbsp;<span class="ident" id="7376767"><a href="/log/syslog/syslog_test.go.html#7371044">startServer</a></span><span class="op" id="7376778">(</span><span class="ident" id="7376779"><a href="/log/syslog/syslog_test.go.html#7376699">net</a></span><span class="op" id="7376782">,</span>&nbsp;<span class="string" id="7376784">&#34;&#34;</span><span class="op" id="7376786">,</span>&nbsp;<span class="ident" id="7376788"><a href="/log/syslog/syslog_test.go.html#7376714">done</a></span><span class="op" id="7376792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7376795">defer</span>&nbsp;<span class="ident" id="7376801"><a href="/log/syslog/syslog_test.go.html#7370085">os</a></span><span class="op" id="7376803">.</span><span class="ident" id="7376804">Remove</span><span class="op" id="7376810">(</span><span class="ident" id="7376811"><a href="/log/syslog/syslog_test.go.html#7376746">addr</a></span><span class="op" id="7376815">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7376819">//&nbsp;count&nbsp;all&nbsp;the&nbsp;messages&nbsp;arriving</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7376855">count</span>&nbsp;<span class="op" id="7376861">:=</span>&nbsp;<span class="builtinfunc" id="7376864">make</span><span class="op" id="7376868">(</span><span class="keyword" id="7376869">chan</span>&nbsp;<span class="builtintype" id="7376874">int</span><span class="op" id="7376877">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7376880">go</span>&nbsp;<span class="keyword" id="7376883">func</span><span class="op" id="7376887">(</span><span class="op" id="7376888">)</span>&nbsp;<span class="op" id="7376890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7376894">ct</span>&nbsp;<span class="op" id="7376897">:=</span>&nbsp;<span class="num" id="7376900">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7376904">for</span>&nbsp;<span class="keyword" id="7376908">range</span>&nbsp;<span class="ident" id="7376914"><a href="/log/syslog/syslog_test.go.html#7376714">done</a></span>&nbsp;<span class="op" id="7376919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7376924"><a href="/log/syslog/syslog_test.go.html#7376894">ct</a></span><span class="op" id="7376926">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7376932">//&nbsp;we&nbsp;are&nbsp;looking&nbsp;for&nbsp;500&nbsp;out&nbsp;of&nbsp;1000&nbsp;events</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7376980">//&nbsp;here&nbsp;because&nbsp;lots&nbsp;of&nbsp;log&nbsp;messages&nbsp;are&nbsp;lost</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7377029">//&nbsp;in&nbsp;buffers&nbsp;(kernel&nbsp;and/or&nbsp;bufio)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7377068">if</span>&nbsp;<span class="ident" id="7377071"><a href="/log/syslog/syslog_test.go.html#7376894">ct</a></span>&nbsp;<span class="op" id="7377074">&gt;</span>&nbsp;<span class="ident" id="7377076"><a href="/log/syslog/syslog_test.go.html#7376676">N</a></span><span class="op" id="7377077">*</span><span class="ident" id="7377078"><a href="/log/syslog/syslog_test.go.html#7376690">M</a></span><span class="op" id="7377079">/</span><span class="num" id="7377080">2</span>&nbsp;<span class="op" id="7377082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7377088">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7377097">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7377101">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7377105"><a href="/log/syslog/syslog_test.go.html#7376855">count</a></span>&nbsp;<span class="op" id="7377111">&lt;-</span>&nbsp;<span class="ident" id="7377114"><a href="/log/syslog/syslog_test.go.html#7376894">ct</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7377118">}</span><span class="op" id="7377119">(</span><span class="op" id="7377120">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7377124">var</span>&nbsp;<span class="ident" id="7377128">wg</span>&nbsp;<span class="ident" id="7377131"><a href="/log/syslog/syslog_test.go.html#7370091">sync</a></span><span class="op" id="7377135">.</span><span class="ident" id="7377136">WaitGroup</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7377147"><a href="/log/syslog/syslog_test.go.html#7377128">wg</a></span><span class="op" id="7377149">.</span><span class="ident" id="7377150">Add</span><span class="op" id="7377153">(</span><span class="ident" id="7377154"><a href="/log/syslog/syslog_test.go.html#7376676">N</a></span><span class="op" id="7377155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7377158">for</span>&nbsp;<span class="ident" id="7377162">i</span>&nbsp;<span class="op" id="7377164">:=</span>&nbsp;<span class="num" id="7377167">0</span><span class="op" id="7377168">;</span>&nbsp;<span class="ident" id="7377170"><a href="/log/syslog/syslog_test.go.html#7377162">i</a></span>&nbsp;<span class="op" id="7377172">&lt;</span>&nbsp;<span class="ident" id="7377174"><a href="/log/syslog/syslog_test.go.html#7376676">N</a></span><span class="op" id="7377175">;</span>&nbsp;<span class="ident" id="7377177"><a href="/log/syslog/syslog_test.go.html#7377162">i</a></span><span class="op" id="7377178">++</span>&nbsp;<span class="op" id="7377181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7377185">go</span>&nbsp;<span class="keyword" id="7377188">func</span><span class="op" id="7377192">(</span><span class="op" id="7377193">)</span>&nbsp;<span class="op" id="7377195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7377200">defer</span>&nbsp;<span class="ident" id="7377206"><a href="/log/syslog/syslog_test.go.html#7377128">wg</a></span><span class="op" id="7377208">.</span><span class="ident" id="7377209">Done</span><span class="op" id="7377213">(</span><span class="op" id="7377214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7377219">w</span><span class="op" id="7377220">,</span>&nbsp;<span class="ident" id="7377222">err</span>&nbsp;<span class="op" id="7377226">:=</span>&nbsp;<span class="ident" id="7377229"><a href="/log/syslog/syslog.go.html#5277478">Dial</a></span><span class="op" id="7377233">(</span><span class="ident" id="7377234"><a href="/log/syslog/syslog_test.go.html#7376699">net</a></span><span class="op" id="7377237">,</span>&nbsp;<span class="ident" id="7377239"><a href="/log/syslog/syslog_test.go.html#7376746">addr</a></span><span class="op" id="7377243">,</span>&nbsp;<span class="ident" id="7377245"><a href="/log/syslog/syslog.go.html#5275926">LOG_USER</a></span><span class="op" id="7377253">|</span><span class="ident" id="7377254"><a href="/log/syslog/syslog.go.html#5275716">LOG_ERR</a></span><span class="op" id="7377261">,</span>&nbsp;<span class="string" id="7377263">&#34;tag&#34;</span><span class="op" id="7377268">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7377273">if</span>&nbsp;<span class="ident" id="7377276"><a href="/log/syslog/syslog_test.go.html#7377222">err</a></span>&nbsp;<span class="op" id="7377280">!=</span>&nbsp;<span class="ident" id="7377283">nil</span>&nbsp;<span class="op" id="7377287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7377293"><a href="/log/syslog/syslog_test.go.html#7376602">t</a></span><span class="op" id="7377294">.</span><span class="ident" id="7377295">Fatalf</span><span class="op" id="7377301">(</span><span class="string" id="7377302">&#34;syslog.Dial()&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7377328">,</span>&nbsp;<span class="ident" id="7377330"><a href="/log/syslog/syslog_test.go.html#7377222">err</a></span><span class="op" id="7377333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7377338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7377343">defer</span>&nbsp;<span class="ident" id="7377349"><a href="/log/syslog/syslog_test.go.html#7377219">w</a></span><span class="op" id="7377350">.</span><span class="ident" id="7377351">Close</span><span class="op" id="7377356">(</span><span class="op" id="7377357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7377362">for</span>&nbsp;<span class="ident" id="7377366">i</span>&nbsp;<span class="op" id="7377368">:=</span>&nbsp;<span class="num" id="7377371">0</span><span class="op" id="7377372">;</span>&nbsp;<span class="ident" id="7377374"><a href="/log/syslog/syslog_test.go.html#7377366">i</a></span>&nbsp;<span class="op" id="7377376">&lt;</span>&nbsp;<span class="ident" id="7377378"><a href="/log/syslog/syslog_test.go.html#7376690">M</a></span><span class="op" id="7377379">;</span>&nbsp;<span class="ident" id="7377381"><a href="/log/syslog/syslog_test.go.html#7377366">i</a></span><span class="op" id="7377382">++</span>&nbsp;<span class="op" id="7377385">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7377391">err</span>&nbsp;<span class="op" id="7377395">:=</span>&nbsp;<span class="ident" id="7377398"><a href="/log/syslog/syslog_test.go.html#7377219">w</a></span><span class="op" id="7377399">.</span><span class="ident" id="7377400">Info</span><span class="op" id="7377404">(</span><span class="string" id="7377405">&#34;test&#34;</span><span class="op" id="7377411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7377417">if</span>&nbsp;<span class="ident" id="7377420"><a href="/log/syslog/syslog_test.go.html#7377391">err</a></span>&nbsp;<span class="op" id="7377424">!=</span>&nbsp;<span class="ident" id="7377427">nil</span>&nbsp;<span class="op" id="7377431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7377438"><a href="/log/syslog/syslog_test.go.html#7376602">t</a></span><span class="op" id="7377439">.</span><span class="ident" id="7377440">Errorf</span><span class="op" id="7377446">(</span><span class="string" id="7377447">&#34;Info()&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7377466">,</span>&nbsp;<span class="ident" id="7377468"><a href="/log/syslog/syslog_test.go.html#7377391">err</a></span><span class="op" id="7377471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7377478">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7377489">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7377494">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7377498">}</span><span class="op" id="7377499">(</span><span class="op" id="7377500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7377503">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7377506"><a href="/log/syslog/syslog_test.go.html#7377128">wg</a></span><span class="op" id="7377508">.</span><span class="ident" id="7377509">Wait</span><span class="op" id="7377513">(</span><span class="op" id="7377514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7377517"><a href="/log/syslog/syslog_test.go.html#7376752">sock</a></span><span class="op" id="7377521">.</span><span class="ident" id="7377522">Close</span><span class="op" id="7377527">(</span><span class="op" id="7377528">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7377531"><a href="/log/syslog/syslog_test.go.html#7376758">srvWG</a></span><span class="op" id="7377536">.</span><span class="ident" id="7377537">Wait</span><span class="op" id="7377541">(</span><span class="op" id="7377542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7377545">close</span><span class="op" id="7377550">(</span><span class="ident" id="7377551"><a href="/log/syslog/syslog_test.go.html#7376714">done</a></span><span class="op" id="7377555">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7377559">select</span>&nbsp;<span class="op" id="7377566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7377569">case</span>&nbsp;<span class="op" id="7377574">&lt;-</span><span class="ident" id="7377576"><a href="/log/syslog/syslog_test.go.html#7376855">count</a></span><span class="op" id="7377581">:</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7377584">case</span>&nbsp;<span class="op" id="7377589">&lt;-</span><span class="ident" id="7377591"><a href="/log/syslog/syslog_test.go.html#7370110">time</a></span><span class="op" id="7377595">.</span><span class="ident" id="7377596">After</span><span class="op" id="7377601">(</span><span class="num" id="7377602">100</span>&nbsp;<span class="op" id="7377606">*</span>&nbsp;<span class="ident" id="7377608"><a href="/log/syslog/syslog_test.go.html#7370110">time</a></span><span class="op" id="7377612">.</span><span class="ident" id="7377613">Millisecond</span><span class="op" id="7377624">)</span><span class="op" id="7377625">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7377629"><a href="/log/syslog/syslog_test.go.html#7376602">t</a></span><span class="op" id="7377630">.</span><span class="ident" id="7377631">Error</span><span class="op" id="7377636">(</span><span class="string" id="7377637">&#34;timeout&nbsp;in&nbsp;concurrent&nbsp;reconnect&#34;</span><span class="op" id="7377670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7377673">}</span><br>
<span class="lineno"></span><span class="op" id="7377675">}</span>
</div>
</body>
</html>
