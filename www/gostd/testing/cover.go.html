<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>testing</h2>
<ul>
<li><a href="/gostd/testing/allocs.go.html">allocs.go</a></li>
<li><a href="/gostd/testing/allocs_test.go.html">allocs_test.go</a></li>
<li><a href="/gostd/testing/benchmark.go.html">benchmark.go</a></li>
<li><a href="/gostd/testing/benchmark_test.go.html">benchmark_test.go</a></li>
<li><a href="/gostd/testing/cover.go.html" class="current">cover.go</a></li>
<li><a href="/gostd/testing/example.go.html">example.go</a></li>
<li><a href="/gostd/testing/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/testing/testing.go.html">testing.go</a></li>
<li><a href="/gostd/testing/testing_test.go.html">testing_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6092248">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6092303">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6092357">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6092408">//&nbsp;Support&nbsp;for&nbsp;test&nbsp;coverage.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6092439">package</span>&nbsp;<span class="ident" id="6092447">testing</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6092456">import</span>&nbsp;<span class="op" id="6092463">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6092466">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6092473">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6092479">&#34;sync/atomic&#34;</span><br>
<span class="lineno"></span><span class="op" id="6092493">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="6092496">//&nbsp;CoverBlock&nbsp;records&nbsp;the&nbsp;coverage&nbsp;data&nbsp;for&nbsp;a&nbsp;single&nbsp;basic&nbsp;block.</span><br>
<span class="lineno"></span><span class="comment" id="6092562">//&nbsp;NOTE:&nbsp;This&nbsp;struct&nbsp;is&nbsp;internal&nbsp;to&nbsp;the&nbsp;testing&nbsp;infrastructure&nbsp;and&nbsp;may&nbsp;change.</span><br>
<span class="lineno"></span><span class="comment" id="6092641">//&nbsp;It&nbsp;is&nbsp;not&nbsp;covered&nbsp;(yet)&nbsp;by&nbsp;the&nbsp;Go&nbsp;1&nbsp;compatibility&nbsp;guidelines.</span><br>
<span class="lineno"></span><span class="keyword" id="6092706">type</span>&nbsp;<span class="ident" id="6092711">CoverBlock</span>&nbsp;<span class="keyword" id="6092722">struct</span>&nbsp;<span class="op" id="6092729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6092732">Line0</span>&nbsp;<span class="builtintype" id="6092738">uint32</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6092746">Col0</span>&nbsp;&nbsp;<span class="builtintype" id="6092752">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6092760">Line1</span>&nbsp;<span class="builtintype" id="6092766">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6092774">Col1</span>&nbsp;&nbsp;<span class="builtintype" id="6092780">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6092788">Stmts</span>&nbsp;<span class="builtintype" id="6092794">uint16</span><br>
<span class="lineno"></span><span class="op" id="6092801">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="6092804">var</span>&nbsp;<span class="ident" id="6092808">cover</span>&nbsp;<span class="ident" id="6092814">Cover</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6092821">//&nbsp;Cover&nbsp;records&nbsp;information&nbsp;about&nbsp;test&nbsp;coverage&nbsp;checking.</span><br>
<span class="lineno"></span><span class="comment" id="6092880">//&nbsp;NOTE:&nbsp;This&nbsp;struct&nbsp;is&nbsp;internal&nbsp;to&nbsp;the&nbsp;testing&nbsp;infrastructure&nbsp;and&nbsp;may&nbsp;change.</span><br>
<span class="lineno">30</span><span class="comment" id="6092959">//&nbsp;It&nbsp;is&nbsp;not&nbsp;covered&nbsp;(yet)&nbsp;by&nbsp;the&nbsp;Go&nbsp;1&nbsp;compatibility&nbsp;guidelines.</span><br>
<span class="lineno"></span><span class="keyword" id="6093024">type</span>&nbsp;<span class="ident" id="6093029">Cover</span>&nbsp;<span class="keyword" id="6093035">struct</span>&nbsp;<span class="op" id="6093042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6093045">Mode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6093061">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6093069">Counters</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6093085">map</span><span class="op" id="6093088">[</span><span class="builtintype" id="6093089">string</span><span class="op" id="6093095">]</span><span class="op" id="6093096">[</span><span class="op" id="6093097">]</span><span class="builtintype" id="6093098">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6093106">Blocks</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6093122">map</span><span class="op" id="6093125">[</span><span class="builtintype" id="6093126">string</span><span class="op" id="6093132">]</span><span class="op" id="6093133">[</span><span class="op" id="6093134">]</span><span class="ident" id="6093135">CoverBlock</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6093147">CoveredPackages</span>&nbsp;<span class="builtintype" id="6093163">string</span><br>
<span class="lineno"></span><span class="op" id="6093170">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6093173">//&nbsp;Coverage&nbsp;reports&nbsp;the&nbsp;current&nbsp;code&nbsp;coverage&nbsp;as&nbsp;a&nbsp;fraction&nbsp;in&nbsp;the&nbsp;range&nbsp;[0,&nbsp;1].</span><br>
<span class="lineno"></span><span class="comment" id="6093254">//&nbsp;If&nbsp;coverage&nbsp;is&nbsp;not&nbsp;enabled,&nbsp;Coverage&nbsp;returns&nbsp;0.</span><br>
<span class="lineno">40</span><span class="comment" id="6093305">//</span><br>
<span class="lineno"></span><span class="comment" id="6093308">//&nbsp;When&nbsp;running&nbsp;a&nbsp;large&nbsp;set&nbsp;of&nbsp;sequential&nbsp;test&nbsp;cases,&nbsp;checking&nbsp;Coverage&nbsp;after&nbsp;each&nbsp;one</span><br>
<span class="lineno"></span><span class="comment" id="6093395">//&nbsp;can&nbsp;be&nbsp;useful&nbsp;for&nbsp;identifying&nbsp;which&nbsp;test&nbsp;cases&nbsp;exercise&nbsp;new&nbsp;code&nbsp;paths.</span><br>
<span class="lineno"></span><span class="comment" id="6093470">//&nbsp;It&nbsp;is&nbsp;not&nbsp;a&nbsp;replacement&nbsp;for&nbsp;the&nbsp;reports&nbsp;generated&nbsp;by&nbsp;&#39;go&nbsp;test&nbsp;-cover&#39;&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="6093547">//&nbsp;&#39;go&nbsp;tool&nbsp;cover&#39;.</span><br>
<span class="lineno">45</span><span class="keyword" id="6093567">func</span>&nbsp;<span class="ident" id="6093572">Coverage</span><span class="op" id="6093580">(</span><span class="op" id="6093581">)</span>&nbsp;<span class="builtintype" id="6093583">float64</span>&nbsp;<span class="op" id="6093591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6093594">var</span>&nbsp;<span class="ident" id="6093598">n</span><span class="op" id="6093599">,</span>&nbsp;<span class="ident" id="6093601">d</span>&nbsp;<span class="ident" id="6093603">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6093610">for</span>&nbsp;<span class="ident" id="6093614">_</span><span class="op" id="6093615">,</span>&nbsp;<span class="ident" id="6093617">counters</span>&nbsp;<span class="op" id="6093626">:=</span>&nbsp;<span class="keyword" id="6093629">range</span>&nbsp;<span class="ident" id="6093635">cover</span><span class="op" id="6093640">.</span><span class="ident" id="6093641">Counters</span>&nbsp;<span class="op" id="6093650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6093654">for</span>&nbsp;<span class="ident" id="6093658">i</span>&nbsp;<span class="op" id="6093660">:=</span>&nbsp;<span class="keyword" id="6093663">range</span>&nbsp;<span class="ident" id="6093669">counters</span>&nbsp;<span class="op" id="6093678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6093683">if</span>&nbsp;<span class="ident" id="6093686">atomic</span><span class="op" id="6093692">.</span><span class="ident" id="6093693">LoadUint32</span><span class="op" id="6093703">(</span><span class="op" id="6093704">&amp;</span><span class="ident" id="6093705">counters</span><span class="op" id="6093713">[</span><span class="ident" id="6093714">i</span><span class="op" id="6093715">]</span><span class="op" id="6093716">)</span>&nbsp;<span class="op" id="6093718">&gt;</span>&nbsp;<span class="num" id="6093720">0</span>&nbsp;<span class="op" id="6093722">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6093728">n</span><span class="op" id="6093729">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6093735">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6093740">d</span><span class="op" id="6093741">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6093746">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6093749">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6093752">if</span>&nbsp;<span class="ident" id="6093755">d</span>&nbsp;<span class="op" id="6093757">==</span>&nbsp;<span class="num" id="6093760">0</span>&nbsp;<span class="op" id="6093762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6093766">return</span>&nbsp;<span class="num" id="6093773">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6093776">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6093779">return</span>&nbsp;<span class="builtintype" id="6093786">float64</span><span class="op" id="6093793">(</span><span class="ident" id="6093794">n</span><span class="op" id="6093795">)</span>&nbsp;<span class="op" id="6093797">/</span>&nbsp;<span class="builtintype" id="6093799">float64</span><span class="op" id="6093806">(</span><span class="ident" id="6093807">d</span><span class="op" id="6093808">)</span><br>
<span class="lineno"></span><span class="op" id="6093810">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="comment" id="6093813">//&nbsp;RegisterCover&nbsp;records&nbsp;the&nbsp;coverage&nbsp;data&nbsp;accumulators&nbsp;for&nbsp;the&nbsp;tests.</span><br>
<span class="lineno"></span><span class="comment" id="6093884">//&nbsp;NOTE:&nbsp;This&nbsp;function&nbsp;is&nbsp;internal&nbsp;to&nbsp;the&nbsp;testing&nbsp;infrastructure&nbsp;and&nbsp;may&nbsp;change.</span><br>
<span class="lineno"></span><span class="comment" id="6093965">//&nbsp;It&nbsp;is&nbsp;not&nbsp;covered&nbsp;(yet)&nbsp;by&nbsp;the&nbsp;Go&nbsp;1&nbsp;compatibility&nbsp;guidelines.</span><br>
<span class="lineno"></span><span class="keyword" id="6094030">func</span>&nbsp;<span class="ident" id="6094035">RegisterCover</span><span class="op" id="6094048">(</span><span class="ident" id="6094049">c</span>&nbsp;<span class="ident" id="6094051">Cover</span><span class="op" id="6094056">)</span>&nbsp;<span class="op" id="6094058">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6094061">cover</span>&nbsp;<span class="op" id="6094067">=</span>&nbsp;<span class="ident" id="6094069">c</span><br>
<span class="lineno"></span><span class="op" id="6094071">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6094074">//&nbsp;mustBeNil&nbsp;checks&nbsp;the&nbsp;error&nbsp;and,&nbsp;if&nbsp;present,&nbsp;reports&nbsp;it&nbsp;and&nbsp;exits.</span><br>
<span class="lineno"></span><span class="keyword" id="6094143">func</span>&nbsp;<span class="ident" id="6094148">mustBeNil</span><span class="op" id="6094157">(</span><span class="ident" id="6094158">err</span>&nbsp;<span class="builtintype" id="6094162">error</span><span class="op" id="6094167">)</span>&nbsp;<span class="op" id="6094169">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6094172">if</span>&nbsp;<span class="ident" id="6094175">err</span>&nbsp;<span class="op" id="6094179">!=</span>&nbsp;<span class="ident" id="6094182">nil</span>&nbsp;<span class="op" id="6094186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6094190">fmt</span><span class="op" id="6094193">.</span><span class="ident" id="6094194">Fprintf</span><span class="op" id="6094201">(</span><span class="ident" id="6094202">os</span><span class="op" id="6094204">.</span><span class="ident" id="6094205">Stderr</span><span class="op" id="6094211">,</span>&nbsp;<span class="string" id="6094213">&#34;testing:&nbsp;%s\n&#34;</span><span class="op" id="6094228">,</span>&nbsp;<span class="ident" id="6094230">err</span><span class="op" id="6094233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6094237">os</span><span class="op" id="6094239">.</span><span class="ident" id="6094240">Exit</span><span class="op" id="6094244">(</span><span class="num" id="6094245">2</span><span class="op" id="6094246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6094249">}</span><br>
<span class="lineno"></span><span class="op" id="6094251">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="comment" id="6094254">//&nbsp;coverReport&nbsp;reports&nbsp;the&nbsp;coverage&nbsp;percentage&nbsp;and&nbsp;writes&nbsp;a&nbsp;coverage&nbsp;profile&nbsp;if&nbsp;requested.</span><br>
<span class="lineno"></span><span class="keyword" id="6094345">func</span>&nbsp;<span class="ident" id="6094350">coverReport</span><span class="op" id="6094361">(</span><span class="op" id="6094362">)</span>&nbsp;<span class="op" id="6094364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6094367">var</span>&nbsp;<span class="ident" id="6094371">f</span>&nbsp;<span class="op" id="6094373">*</span><span class="ident" id="6094374">os</span><span class="op" id="6094376">.</span><span class="ident" id="6094377">File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6094383">var</span>&nbsp;<span class="ident" id="6094387">err</span>&nbsp;<span class="builtintype" id="6094391">error</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6094398">if</span>&nbsp;<span class="op" id="6094401">*</span><span class="ident" id="6094402">coverProfile</span>&nbsp;<span class="op" id="6094415">!=</span>&nbsp;<span class="string" id="6094418">&#34;&#34;</span>&nbsp;<span class="op" id="6094421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6094425">f</span><span class="op" id="6094426">,</span>&nbsp;<span class="ident" id="6094428">err</span>&nbsp;<span class="op" id="6094432">=</span>&nbsp;<span class="ident" id="6094434">os</span><span class="op" id="6094436">.</span><span class="ident" id="6094437">Create</span><span class="op" id="6094443">(</span><span class="ident" id="6094444">toOutputDir</span><span class="op" id="6094455">(</span><span class="op" id="6094456">*</span><span class="ident" id="6094457">coverProfile</span><span class="op" id="6094469">)</span><span class="op" id="6094470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6094474">mustBeNil</span><span class="op" id="6094483">(</span><span class="ident" id="6094484">err</span><span class="op" id="6094487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6094491">fmt</span><span class="op" id="6094494">.</span><span class="ident" id="6094495">Fprintf</span><span class="op" id="6094502">(</span><span class="ident" id="6094503">f</span><span class="op" id="6094504">,</span>&nbsp;<span class="string" id="6094506">&#34;mode:&nbsp;%s\n&#34;</span><span class="op" id="6094518">,</span>&nbsp;<span class="ident" id="6094520">cover</span><span class="op" id="6094525">.</span><span class="ident" id="6094526">Mode</span><span class="op" id="6094530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6094534">defer</span>&nbsp;<span class="keyword" id="6094540">func</span><span class="op" id="6094544">(</span><span class="op" id="6094545">)</span>&nbsp;<span class="op" id="6094547">{</span>&nbsp;<span class="ident" id="6094549">mustBeNil</span><span class="op" id="6094558">(</span><span class="ident" id="6094559">f</span><span class="op" id="6094560">.</span><span class="ident" id="6094561">Close</span><span class="op" id="6094566">(</span><span class="op" id="6094567">)</span><span class="op" id="6094568">)</span>&nbsp;<span class="op" id="6094570">}</span><span class="op" id="6094571">(</span><span class="op" id="6094572">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6094575">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6094579">var</span>&nbsp;<span class="ident" id="6094583">active</span><span class="op" id="6094589">,</span>&nbsp;<span class="ident" id="6094591">total</span>&nbsp;<span class="ident" id="6094597">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6094604">var</span>&nbsp;<span class="ident" id="6094608">count</span>&nbsp;<span class="builtintype" id="6094614">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6094622">for</span>&nbsp;<span class="ident" id="6094626">name</span><span class="op" id="6094630">,</span>&nbsp;<span class="ident" id="6094632">counts</span>&nbsp;<span class="op" id="6094639">:=</span>&nbsp;<span class="keyword" id="6094642">range</span>&nbsp;<span class="ident" id="6094648">cover</span><span class="op" id="6094653">.</span><span class="ident" id="6094654">Counters</span>&nbsp;<span class="op" id="6094663">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6094667">blocks</span>&nbsp;<span class="op" id="6094674">:=</span>&nbsp;<span class="ident" id="6094677">cover</span><span class="op" id="6094682">.</span><span class="ident" id="6094683">Blocks</span><span class="op" id="6094689">[</span><span class="ident" id="6094690">name</span><span class="op" id="6094694">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6094698">for</span>&nbsp;<span class="ident" id="6094702">i</span>&nbsp;<span class="op" id="6094704">:=</span>&nbsp;<span class="keyword" id="6094707">range</span>&nbsp;<span class="ident" id="6094713">counts</span>&nbsp;<span class="op" id="6094720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6094725">stmts</span>&nbsp;<span class="op" id="6094731">:=</span>&nbsp;<span class="ident" id="6094734">int64</span><span class="op" id="6094739">(</span><span class="ident" id="6094740">blocks</span><span class="op" id="6094746">[</span><span class="ident" id="6094747">i</span><span class="op" id="6094748">]</span><span class="op" id="6094749">.</span><span class="ident" id="6094750">Stmts</span><span class="op" id="6094755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6094760">total</span>&nbsp;<span class="op" id="6094766">+=</span>&nbsp;<span class="ident" id="6094769">stmts</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6094778">count</span>&nbsp;<span class="op" id="6094784">=</span>&nbsp;<span class="ident" id="6094786">atomic</span><span class="op" id="6094792">.</span><span class="ident" id="6094793">LoadUint32</span><span class="op" id="6094803">(</span><span class="op" id="6094804">&amp;</span><span class="ident" id="6094805">counts</span><span class="op" id="6094811">[</span><span class="ident" id="6094812">i</span><span class="op" id="6094813">]</span><span class="op" id="6094814">)</span>&nbsp;<span class="comment" id="6094816">//&nbsp;For&nbsp;-mode=atomic.</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6094840">if</span>&nbsp;<span class="ident" id="6094843">count</span>&nbsp;<span class="op" id="6094849">&gt;</span>&nbsp;<span class="num" id="6094851">0</span>&nbsp;<span class="op" id="6094853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6094859">active</span>&nbsp;<span class="op" id="6094866">+=</span>&nbsp;<span class="ident" id="6094869">stmts</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6094878">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6094883">if</span>&nbsp;<span class="ident" id="6094886">f</span>&nbsp;<span class="op" id="6094888">!=</span>&nbsp;<span class="ident" id="6094891">nil</span>&nbsp;<span class="op" id="6094895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6094901">_</span><span class="op" id="6094902">,</span>&nbsp;<span class="ident" id="6094904">err</span>&nbsp;<span class="op" id="6094908">:=</span>&nbsp;<span class="ident" id="6094911">fmt</span><span class="op" id="6094914">.</span><span class="ident" id="6094915">Fprintf</span><span class="op" id="6094922">(</span><span class="ident" id="6094923">f</span><span class="op" id="6094924">,</span>&nbsp;<span class="string" id="6094926">&#34;%s:%d.%d,%d.%d&nbsp;%d&nbsp;%d\n&#34;</span><span class="op" id="6094950">,</span>&nbsp;<span class="ident" id="6094952">name</span><span class="op" id="6094956">,</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6094963">blocks</span><span class="op" id="6094969">[</span><span class="ident" id="6094970">i</span><span class="op" id="6094971">]</span><span class="op" id="6094972">.</span><span class="ident" id="6094973">Line0</span><span class="op" id="6094978">,</span>&nbsp;<span class="ident" id="6094980">blocks</span><span class="op" id="6094986">[</span><span class="ident" id="6094987">i</span><span class="op" id="6094988">]</span><span class="op" id="6094989">.</span><span class="ident" id="6094990">Col0</span><span class="op" id="6094994">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6095001">blocks</span><span class="op" id="6095007">[</span><span class="ident" id="6095008">i</span><span class="op" id="6095009">]</span><span class="op" id="6095010">.</span><span class="ident" id="6095011">Line1</span><span class="op" id="6095016">,</span>&nbsp;<span class="ident" id="6095018">blocks</span><span class="op" id="6095024">[</span><span class="ident" id="6095025">i</span><span class="op" id="6095026">]</span><span class="op" id="6095027">.</span><span class="ident" id="6095028">Col1</span><span class="op" id="6095032">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6095039">stmts</span><span class="op" id="6095044">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6095051">count</span><span class="op" id="6095056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6095062">mustBeNil</span><span class="op" id="6095071">(</span><span class="ident" id="6095072">err</span><span class="op" id="6095075">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6095080">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6095084">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6095087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6095090">if</span>&nbsp;<span class="ident" id="6095093">total</span>&nbsp;<span class="op" id="6095099">==</span>&nbsp;<span class="num" id="6095102">0</span>&nbsp;<span class="op" id="6095104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6095108">total</span>&nbsp;<span class="op" id="6095114">=</span>&nbsp;<span class="num" id="6095116">1</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6095119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6095122">fmt</span><span class="op" id="6095125">.</span><span class="ident" id="6095126">Printf</span><span class="op" id="6095132">(</span><span class="string" id="6095133">&#34;coverage:&nbsp;%.1f%%&nbsp;of&nbsp;statements%s\n&#34;</span><span class="op" id="6095169">,</span>&nbsp;<span class="num" id="6095171">100</span><span class="op" id="6095174">*</span><span class="builtintype" id="6095175">float64</span><span class="op" id="6095182">(</span><span class="ident" id="6095183">active</span><span class="op" id="6095189">)</span><span class="op" id="6095190">/</span><span class="builtintype" id="6095191">float64</span><span class="op" id="6095198">(</span><span class="ident" id="6095199">total</span><span class="op" id="6095204">)</span><span class="op" id="6095205">,</span>&nbsp;<span class="ident" id="6095207">cover</span><span class="op" id="6095212">.</span><span class="ident" id="6095213">CoveredPackages</span><span class="op" id="6095228">)</span><br>
<span class="lineno"></span><span class="op" id="6095230">}</span>
</div>
</body>
</html>
