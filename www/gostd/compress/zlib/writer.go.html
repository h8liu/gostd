<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/zlib</h2>
<ul>
<li><a href="/gostd/compress/zlib/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/compress/zlib/reader.go.html">reader.go</a></li>
<li><a href="/gostd/compress/zlib/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/compress/zlib/writer.go.html">writer.go</a></li>
<li><a href="/gostd/compress/zlib/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5545796">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5545851">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5545905">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5545956">package</span>&nbsp;<span class="ident" id="5545964">zlib</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5545970">import</span>&nbsp;<span class="op" id="5545977">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5545980">&#34;compress/flate&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5545998">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5546005">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5546013">&#34;hash/adler32&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5546029">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="5546034">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="5546037">//&nbsp;These&nbsp;constants&nbsp;are&nbsp;copied&nbsp;from&nbsp;the&nbsp;flate&nbsp;package,&nbsp;so&nbsp;that&nbsp;code&nbsp;that&nbsp;imports</span><br>
<span class="lineno"></span><span class="comment" id="5546117">//&nbsp;&#34;compress/zlib&#34;&nbsp;does&nbsp;not&nbsp;also&nbsp;have&nbsp;to&nbsp;import&nbsp;&#34;compress/flate&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="5546183">const</span>&nbsp;<span class="op" id="5546189">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5546192">NoCompression</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5546211">=</span>&nbsp;<span class="ident" id="5546213">flate</span><span class="op" id="5546218">.</span><span class="ident" id="5546219">NoCompression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5546234">BestSpeed</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5546253">=</span>&nbsp;<span class="ident" id="5546255">flate</span><span class="op" id="5546260">.</span><span class="ident" id="5546261">BestSpeed</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5546272">BestCompression</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5546291">=</span>&nbsp;<span class="ident" id="5546293">flate</span><span class="op" id="5546298">.</span><span class="ident" id="5546299">BestCompression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5546316">DefaultCompression</span>&nbsp;<span class="op" id="5546335">=</span>&nbsp;<span class="ident" id="5546337">flate</span><span class="op" id="5546342">.</span><span class="ident" id="5546343">DefaultCompression</span><br>
<span class="lineno"></span><span class="op" id="5546362">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5546365">//&nbsp;A&nbsp;Writer&nbsp;takes&nbsp;data&nbsp;written&nbsp;to&nbsp;it&nbsp;and&nbsp;writes&nbsp;the&nbsp;compressed</span><br>
<span class="lineno">25</span><span class="comment" id="5546428">//&nbsp;form&nbsp;of&nbsp;that&nbsp;data&nbsp;to&nbsp;an&nbsp;underlying&nbsp;writer&nbsp;(see&nbsp;NewWriter).</span><br>
<span class="lineno"></span><span class="keyword" id="5546490">type</span>&nbsp;<span class="ident" id="5546495">Writer</span>&nbsp;<span class="keyword" id="5546502">struct</span>&nbsp;<span class="op" id="5546509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5546512">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5546524">io</span><span class="op" id="5546526">.</span><span class="ident" id="5546527">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5546535">level</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5546547">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5546552">dict</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5546564">[</span><span class="op" id="5546565">]</span><span class="builtintype" id="5546566">byte</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5546572">compressor</span>&nbsp;&nbsp;<span class="op" id="5546584">*</span><span class="ident" id="5546585">flate</span><span class="op" id="5546590">.</span><span class="ident" id="5546591">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5546599">digest</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5546611">hash</span><span class="op" id="5546615">.</span><span class="ident" id="5546616">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5546624">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5546636">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5546643">scratch</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5546655">[</span><span class="num" id="5546656">4</span><span class="op" id="5546657">]</span><span class="builtintype" id="5546658">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5546664">wroteHeader</span>&nbsp;<span class="builtintype" id="5546676">bool</span><br>
<span class="lineno">35</span><span class="op" id="5546681">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5546684">//&nbsp;NewWriter&nbsp;creates&nbsp;a&nbsp;new&nbsp;Writer.</span><br>
<span class="lineno"></span><span class="comment" id="5546719">//&nbsp;Writes&nbsp;to&nbsp;the&nbsp;returned&nbsp;Writer&nbsp;are&nbsp;compressed&nbsp;and&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="comment" id="5546785">//</span><br>
<span class="lineno">40</span><span class="comment" id="5546788">//&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;call&nbsp;Close&nbsp;on&nbsp;the&nbsp;WriteCloser&nbsp;when&nbsp;done.</span><br>
<span class="lineno"></span><span class="comment" id="5546869">//&nbsp;Writes&nbsp;may&nbsp;be&nbsp;buffered&nbsp;and&nbsp;not&nbsp;flushed&nbsp;until&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="5546924">func</span>&nbsp;<span class="ident" id="5546929">NewWriter</span><span class="op" id="5546938">(</span><span class="ident" id="5546939">w</span>&nbsp;<span class="ident" id="5546941">io</span><span class="op" id="5546943">.</span><span class="ident" id="5546944">Writer</span><span class="op" id="5546950">)</span>&nbsp;<span class="op" id="5546952">*</span><span class="ident" id="5546953">Writer</span>&nbsp;<span class="op" id="5546960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5546963">z</span><span class="op" id="5546964">,</span>&nbsp;<span class="ident" id="5546966">_</span>&nbsp;<span class="op" id="5546968">:=</span>&nbsp;<span class="ident" id="5546971">NewWriterLevelDict</span><span class="op" id="5546989">(</span><span class="ident" id="5546990">w</span><span class="op" id="5546991">,</span>&nbsp;<span class="ident" id="5546993">DefaultCompression</span><span class="op" id="5547011">,</span>&nbsp;<span class="ident" id="5547013">nil</span><span class="op" id="5547016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5547019">return</span>&nbsp;<span class="ident" id="5547026">z</span><br>
<span class="lineno">45</span><span class="op" id="5547028">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5547031">//&nbsp;NewWriterLevel&nbsp;is&nbsp;like&nbsp;NewWriter&nbsp;but&nbsp;specifies&nbsp;the&nbsp;compression&nbsp;level&nbsp;instead</span><br>
<span class="lineno"></span><span class="comment" id="5547111">//&nbsp;of&nbsp;assuming&nbsp;DefaultCompression.</span><br>
<span class="lineno"></span><span class="comment" id="5547146">//</span><br>
<span class="lineno">50</span><span class="comment" id="5547149">//&nbsp;The&nbsp;compression&nbsp;level&nbsp;can&nbsp;be&nbsp;DefaultCompression,&nbsp;NoCompression,&nbsp;or&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="5547223">//&nbsp;integer&nbsp;value&nbsp;between&nbsp;BestSpeed&nbsp;and&nbsp;BestCompression&nbsp;inclusive.&nbsp;The&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="5547299">//&nbsp;returned&nbsp;will&nbsp;be&nbsp;nil&nbsp;if&nbsp;the&nbsp;level&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="keyword" id="5547346">func</span>&nbsp;<span class="ident" id="5547351">NewWriterLevel</span><span class="op" id="5547365">(</span><span class="ident" id="5547366">w</span>&nbsp;<span class="ident" id="5547368">io</span><span class="op" id="5547370">.</span><span class="ident" id="5547371">Writer</span><span class="op" id="5547377">,</span>&nbsp;<span class="ident" id="5547379">level</span>&nbsp;<span class="builtintype" id="5547385">int</span><span class="op" id="5547388">)</span>&nbsp;<span class="op" id="5547390">(</span><span class="op" id="5547391">*</span><span class="ident" id="5547392">Writer</span><span class="op" id="5547398">,</span>&nbsp;<span class="builtintype" id="5547400">error</span><span class="op" id="5547405">)</span>&nbsp;<span class="op" id="5547407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5547410">return</span>&nbsp;<span class="ident" id="5547417">NewWriterLevelDict</span><span class="op" id="5547435">(</span><span class="ident" id="5547436">w</span><span class="op" id="5547437">,</span>&nbsp;<span class="ident" id="5547439">level</span><span class="op" id="5547444">,</span>&nbsp;<span class="ident" id="5547446">nil</span><span class="op" id="5547449">)</span><br>
<span class="lineno">55</span><span class="op" id="5547451">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5547454">//&nbsp;NewWriterLevelDict&nbsp;is&nbsp;like&nbsp;NewWriterLevel&nbsp;but&nbsp;specifies&nbsp;a&nbsp;dictionary&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5547529">//&nbsp;compress&nbsp;with.</span><br>
<span class="lineno"></span><span class="comment" id="5547547">//</span><br>
<span class="lineno">60</span><span class="comment" id="5547550">//&nbsp;The&nbsp;dictionary&nbsp;may&nbsp;be&nbsp;nil.&nbsp;If&nbsp;not,&nbsp;its&nbsp;contents&nbsp;should&nbsp;not&nbsp;be&nbsp;modified&nbsp;until</span><br>
<span class="lineno"></span><span class="comment" id="5547630">//&nbsp;the&nbsp;Writer&nbsp;is&nbsp;closed.</span><br>
<span class="lineno"></span><span class="keyword" id="5547655">func</span>&nbsp;<span class="ident" id="5547660">NewWriterLevelDict</span><span class="op" id="5547678">(</span><span class="ident" id="5547679">w</span>&nbsp;<span class="ident" id="5547681">io</span><span class="op" id="5547683">.</span><span class="ident" id="5547684">Writer</span><span class="op" id="5547690">,</span>&nbsp;<span class="ident" id="5547692">level</span>&nbsp;<span class="builtintype" id="5547698">int</span><span class="op" id="5547701">,</span>&nbsp;<span class="ident" id="5547703">dict</span>&nbsp;<span class="op" id="5547708">[</span><span class="op" id="5547709">]</span><span class="builtintype" id="5547710">byte</span><span class="op" id="5547714">)</span>&nbsp;<span class="op" id="5547716">(</span><span class="op" id="5547717">*</span><span class="ident" id="5547718">Writer</span><span class="op" id="5547724">,</span>&nbsp;<span class="builtintype" id="5547726">error</span><span class="op" id="5547731">)</span>&nbsp;<span class="op" id="5547733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5547736">if</span>&nbsp;<span class="ident" id="5547739">level</span>&nbsp;<span class="op" id="5547745">&lt;</span>&nbsp;<span class="ident" id="5547747">DefaultCompression</span>&nbsp;<span class="op" id="5547766">||</span>&nbsp;<span class="ident" id="5547769">level</span>&nbsp;<span class="op" id="5547775">&gt;</span>&nbsp;<span class="ident" id="5547777">BestCompression</span>&nbsp;<span class="op" id="5547793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5547797">return</span>&nbsp;<span class="ident" id="5547804">nil</span><span class="op" id="5547807">,</span>&nbsp;<span class="ident" id="5547809">fmt</span><span class="op" id="5547812">.</span><span class="ident" id="5547813">Errorf</span><span class="op" id="5547819">(</span><span class="string" id="5547820">&#34;zlib:&nbsp;invalid&nbsp;compression&nbsp;level:&nbsp;%d&#34;</span><span class="op" id="5547857">,</span>&nbsp;<span class="ident" id="5547859">level</span><span class="op" id="5547864">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5547867">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5547870">return</span>&nbsp;<span class="op" id="5547877">&amp;</span><span class="ident" id="5547878">Writer</span><span class="op" id="5547884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5547888">w</span><span class="op" id="5547889">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5547895">w</span><span class="op" id="5547896">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5547900">level</span><span class="op" id="5547905">:</span>&nbsp;<span class="ident" id="5547907">level</span><span class="op" id="5547912">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5547916">dict</span><span class="op" id="5547920">:</span>&nbsp;&nbsp;<span class="ident" id="5547923">dict</span><span class="op" id="5547927">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5547930">}</span><span class="op" id="5547931">,</span>&nbsp;<span class="ident" id="5547933">nil</span><br>
<span class="lineno"></span><span class="op" id="5547937">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5547940">//&nbsp;Reset&nbsp;clears&nbsp;the&nbsp;state&nbsp;of&nbsp;the&nbsp;Writer&nbsp;z&nbsp;such&nbsp;that&nbsp;it&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="5548016">//&nbsp;initial&nbsp;state&nbsp;from&nbsp;NewWriterLevel&nbsp;or&nbsp;NewWriterLevelDict,&nbsp;but&nbsp;instead&nbsp;writing</span><br>
<span class="lineno">75</span><span class="comment" id="5548096">//&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="5548105">func</span>&nbsp;<span class="op" id="5548110">(</span><span class="ident" id="5548111">z</span>&nbsp;<span class="op" id="5548113">*</span><span class="ident" id="5548114">Writer</span><span class="op" id="5548120">)</span>&nbsp;<span class="ident" id="5548122">Reset</span><span class="op" id="5548127">(</span><span class="ident" id="5548128">w</span>&nbsp;<span class="ident" id="5548130">io</span><span class="op" id="5548132">.</span><span class="ident" id="5548133">Writer</span><span class="op" id="5548139">)</span>&nbsp;<span class="op" id="5548141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5548144">z</span><span class="op" id="5548145">.</span><span class="ident" id="5548146">w</span>&nbsp;<span class="op" id="5548148">=</span>&nbsp;<span class="ident" id="5548150">w</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5548153">//&nbsp;z.level&nbsp;and&nbsp;z.dict&nbsp;left&nbsp;unchanged.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5548192">if</span>&nbsp;<span class="ident" id="5548195">z</span><span class="op" id="5548196">.</span><span class="ident" id="5548197">compressor</span>&nbsp;<span class="op" id="5548208">!=</span>&nbsp;<span class="ident" id="5548211">nil</span>&nbsp;<span class="op" id="5548215">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5548219">z</span><span class="op" id="5548220">.</span><span class="ident" id="5548221">compressor</span><span class="op" id="5548231">.</span><span class="ident" id="5548232">Reset</span><span class="op" id="5548237">(</span><span class="ident" id="5548238">w</span><span class="op" id="5548239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5548242">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5548245">if</span>&nbsp;<span class="ident" id="5548248">z</span><span class="op" id="5548249">.</span><span class="ident" id="5548250">digest</span>&nbsp;<span class="op" id="5548257">!=</span>&nbsp;<span class="ident" id="5548260">nil</span>&nbsp;<span class="op" id="5548264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5548268">z</span><span class="op" id="5548269">.</span><span class="ident" id="5548270">digest</span><span class="op" id="5548276">.</span><span class="ident" id="5548277">Reset</span><span class="op" id="5548282">(</span><span class="op" id="5548283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5548286">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5548289">z</span><span class="op" id="5548290">.</span><span class="ident" id="5548291">err</span>&nbsp;<span class="op" id="5548295">=</span>&nbsp;<span class="ident" id="5548297">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5548302">z</span><span class="op" id="5548303">.</span><span class="ident" id="5548304">scratch</span>&nbsp;<span class="op" id="5548312">=</span>&nbsp;<span class="op" id="5548314">[</span><span class="num" id="5548315">4</span><span class="op" id="5548316">]</span><span class="builtintype" id="5548317">byte</span><span class="op" id="5548321">{</span><span class="op" id="5548322">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5548325">z</span><span class="op" id="5548326">.</span><span class="ident" id="5548327">wroteHeader</span>&nbsp;<span class="op" id="5548339">=</span>&nbsp;<span class="builtintype" id="5548341">false</span><br>
<span class="lineno"></span><span class="op" id="5548347">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="5548350">//&nbsp;writeHeader&nbsp;writes&nbsp;the&nbsp;ZLIB&nbsp;header.</span><br>
<span class="lineno"></span><span class="keyword" id="5548389">func</span>&nbsp;<span class="op" id="5548394">(</span><span class="ident" id="5548395">z</span>&nbsp;<span class="op" id="5548397">*</span><span class="ident" id="5548398">Writer</span><span class="op" id="5548404">)</span>&nbsp;<span class="ident" id="5548406">writeHeader</span><span class="op" id="5548417">(</span><span class="op" id="5548418">)</span>&nbsp;<span class="op" id="5548420">(</span><span class="ident" id="5548421">err</span>&nbsp;<span class="builtintype" id="5548425">error</span><span class="op" id="5548430">)</span>&nbsp;<span class="op" id="5548432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5548435">z</span><span class="op" id="5548436">.</span><span class="ident" id="5548437">wroteHeader</span>&nbsp;<span class="op" id="5548449">=</span>&nbsp;<span class="builtintype" id="5548451">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5548457">//&nbsp;ZLIB&nbsp;has&nbsp;a&nbsp;two-byte&nbsp;header&nbsp;(as&nbsp;documented&nbsp;in&nbsp;RFC&nbsp;1950).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5548517">//&nbsp;The&nbsp;first&nbsp;four&nbsp;bits&nbsp;is&nbsp;the&nbsp;CINFO&nbsp;(compression&nbsp;info),&nbsp;which&nbsp;is&nbsp;7&nbsp;for&nbsp;the&nbsp;default&nbsp;deflate&nbsp;window&nbsp;size.</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5548622">//&nbsp;The&nbsp;next&nbsp;four&nbsp;bits&nbsp;is&nbsp;the&nbsp;CM&nbsp;(compression&nbsp;method),&nbsp;which&nbsp;is&nbsp;8&nbsp;for&nbsp;deflate.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5548701">z</span><span class="op" id="5548702">.</span><span class="ident" id="5548703">scratch</span><span class="op" id="5548710">[</span><span class="num" id="5548711">0</span><span class="op" id="5548712">]</span>&nbsp;<span class="op" id="5548714">=</span>&nbsp;<span class="num" id="5548716">0x78</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5548722">//&nbsp;The&nbsp;next&nbsp;two&nbsp;bits&nbsp;is&nbsp;the&nbsp;FLEVEL&nbsp;(compression&nbsp;level).&nbsp;The&nbsp;four&nbsp;values&nbsp;are:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5548800">//&nbsp;0=fastest,&nbsp;1=fast,&nbsp;2=default,&nbsp;3=best.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5548842">//&nbsp;The&nbsp;next&nbsp;bit,&nbsp;FDICT,&nbsp;is&nbsp;set&nbsp;if&nbsp;a&nbsp;dictionary&nbsp;is&nbsp;given.</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5548900">//&nbsp;The&nbsp;final&nbsp;five&nbsp;FCHECK&nbsp;bits&nbsp;form&nbsp;a&nbsp;mod-31&nbsp;checksum.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5548955">switch</span>&nbsp;<span class="ident" id="5548962">z</span><span class="op" id="5548963">.</span><span class="ident" id="5548964">level</span>&nbsp;<span class="op" id="5548970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5548973">case</span>&nbsp;<span class="num" id="5548978">0</span><span class="op" id="5548979">,</span>&nbsp;<span class="num" id="5548981">1</span><span class="op" id="5548982">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5548986">z</span><span class="op" id="5548987">.</span><span class="ident" id="5548988">scratch</span><span class="op" id="5548995">[</span><span class="num" id="5548996">1</span><span class="op" id="5548997">]</span>&nbsp;<span class="op" id="5548999">=</span>&nbsp;<span class="num" id="5549001">0</span>&nbsp;<span class="op" id="5549003">&lt;&lt;</span>&nbsp;<span class="num" id="5549006">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5549009">case</span>&nbsp;<span class="num" id="5549014">2</span><span class="op" id="5549015">,</span>&nbsp;<span class="num" id="5549017">3</span><span class="op" id="5549018">,</span>&nbsp;<span class="num" id="5549020">4</span><span class="op" id="5549021">,</span>&nbsp;<span class="num" id="5549023">5</span><span class="op" id="5549024">:</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5549028">z</span><span class="op" id="5549029">.</span><span class="ident" id="5549030">scratch</span><span class="op" id="5549037">[</span><span class="num" id="5549038">1</span><span class="op" id="5549039">]</span>&nbsp;<span class="op" id="5549041">=</span>&nbsp;<span class="num" id="5549043">1</span>&nbsp;<span class="op" id="5549045">&lt;&lt;</span>&nbsp;<span class="num" id="5549048">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5549051">case</span>&nbsp;<span class="num" id="5549056">6</span><span class="op" id="5549057">,</span>&nbsp;<span class="op" id="5549059">-</span><span class="num" id="5549060">1</span><span class="op" id="5549061">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5549065">z</span><span class="op" id="5549066">.</span><span class="ident" id="5549067">scratch</span><span class="op" id="5549074">[</span><span class="num" id="5549075">1</span><span class="op" id="5549076">]</span>&nbsp;<span class="op" id="5549078">=</span>&nbsp;<span class="num" id="5549080">2</span>&nbsp;<span class="op" id="5549082">&lt;&lt;</span>&nbsp;<span class="num" id="5549085">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5549088">case</span>&nbsp;<span class="num" id="5549093">7</span><span class="op" id="5549094">,</span>&nbsp;<span class="num" id="5549096">8</span><span class="op" id="5549097">,</span>&nbsp;<span class="num" id="5549099">9</span><span class="op" id="5549100">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5549104">z</span><span class="op" id="5549105">.</span><span class="ident" id="5549106">scratch</span><span class="op" id="5549113">[</span><span class="num" id="5549114">1</span><span class="op" id="5549115">]</span>&nbsp;<span class="op" id="5549117">=</span>&nbsp;<span class="num" id="5549119">3</span>&nbsp;<span class="op" id="5549121">&lt;&lt;</span>&nbsp;<span class="num" id="5549124">6</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5549127">default</span><span class="op" id="5549134">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5549138">panic</span><span class="op" id="5549143">(</span><span class="string" id="5549144">&#34;unreachable&#34;</span><span class="op" id="5549157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5549160">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5549163">if</span>&nbsp;<span class="ident" id="5549166">z</span><span class="op" id="5549167">.</span><span class="ident" id="5549168">dict</span>&nbsp;<span class="op" id="5549173">!=</span>&nbsp;<span class="ident" id="5549176">nil</span>&nbsp;<span class="op" id="5549180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5549184">z</span><span class="op" id="5549185">.</span><span class="ident" id="5549186">scratch</span><span class="op" id="5549193">[</span><span class="num" id="5549194">1</span><span class="op" id="5549195">]</span>&nbsp;<span class="op" id="5549197">|=</span>&nbsp;<span class="num" id="5549200">1</span>&nbsp;<span class="op" id="5549202">&lt;&lt;</span>&nbsp;<span class="num" id="5549205">5</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5549208">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5549211">z</span><span class="op" id="5549212">.</span><span class="ident" id="5549213">scratch</span><span class="op" id="5549220">[</span><span class="num" id="5549221">1</span><span class="op" id="5549222">]</span>&nbsp;<span class="op" id="5549224">+=</span>&nbsp;<span class="builtintype" id="5549227">uint8</span><span class="op" id="5549232">(</span><span class="num" id="5549233">31</span>&nbsp;<span class="op" id="5549236">-</span>&nbsp;<span class="op" id="5549238">(</span><span class="builtintype" id="5549239">uint16</span><span class="op" id="5549245">(</span><span class="ident" id="5549246">z</span><span class="op" id="5549247">.</span><span class="ident" id="5549248">scratch</span><span class="op" id="5549255">[</span><span class="num" id="5549256">0</span><span class="op" id="5549257">]</span><span class="op" id="5549258">)</span><span class="op" id="5549259">&lt;&lt;</span><span class="num" id="5549261">8</span><span class="op" id="5549262">+</span><span class="builtintype" id="5549263">uint16</span><span class="op" id="5549269">(</span><span class="ident" id="5549270">z</span><span class="op" id="5549271">.</span><span class="ident" id="5549272">scratch</span><span class="op" id="5549279">[</span><span class="num" id="5549280">1</span><span class="op" id="5549281">]</span><span class="op" id="5549282">)</span><span class="op" id="5549283">)</span><span class="op" id="5549284">%</span><span class="num" id="5549285">31</span><span class="op" id="5549287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5549290">if</span>&nbsp;<span class="ident" id="5549293">_</span><span class="op" id="5549294">,</span>&nbsp;<span class="ident" id="5549296">err</span>&nbsp;<span class="op" id="5549300">=</span>&nbsp;<span class="ident" id="5549302">z</span><span class="op" id="5549303">.</span><span class="ident" id="5549304">w</span><span class="op" id="5549305">.</span><span class="ident" id="5549306">Write</span><span class="op" id="5549311">(</span><span class="ident" id="5549312">z</span><span class="op" id="5549313">.</span><span class="ident" id="5549314">scratch</span><span class="op" id="5549321">[</span><span class="num" id="5549322">0</span><span class="op" id="5549323">:</span><span class="num" id="5549324">2</span><span class="op" id="5549325">]</span><span class="op" id="5549326">)</span><span class="op" id="5549327">;</span>&nbsp;<span class="ident" id="5549329">err</span>&nbsp;<span class="op" id="5549333">!=</span>&nbsp;<span class="ident" id="5549336">nil</span>&nbsp;<span class="op" id="5549340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5549344">return</span>&nbsp;<span class="ident" id="5549351">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5549356">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5549359">if</span>&nbsp;<span class="ident" id="5549362">z</span><span class="op" id="5549363">.</span><span class="ident" id="5549364">dict</span>&nbsp;<span class="op" id="5549369">!=</span>&nbsp;<span class="ident" id="5549372">nil</span>&nbsp;<span class="op" id="5549376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5549380">//&nbsp;The&nbsp;next&nbsp;four&nbsp;bytes&nbsp;are&nbsp;the&nbsp;Adler-32&nbsp;checksum&nbsp;of&nbsp;the&nbsp;dictionary.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5549450">checksum</span>&nbsp;<span class="op" id="5549459">:=</span>&nbsp;<span class="ident" id="5549462">adler32</span><span class="op" id="5549469">.</span><span class="ident" id="5549470">Checksum</span><span class="op" id="5549478">(</span><span class="ident" id="5549479">z</span><span class="op" id="5549480">.</span><span class="ident" id="5549481">dict</span><span class="op" id="5549485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5549489">z</span><span class="op" id="5549490">.</span><span class="ident" id="5549491">scratch</span><span class="op" id="5549498">[</span><span class="num" id="5549499">0</span><span class="op" id="5549500">]</span>&nbsp;<span class="op" id="5549502">=</span>&nbsp;<span class="builtintype" id="5549504">uint8</span><span class="op" id="5549509">(</span><span class="ident" id="5549510">checksum</span>&nbsp;<span class="op" id="5549519">&gt;&gt;</span>&nbsp;<span class="num" id="5549522">24</span><span class="op" id="5549524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5549528">z</span><span class="op" id="5549529">.</span><span class="ident" id="5549530">scratch</span><span class="op" id="5549537">[</span><span class="num" id="5549538">1</span><span class="op" id="5549539">]</span>&nbsp;<span class="op" id="5549541">=</span>&nbsp;<span class="builtintype" id="5549543">uint8</span><span class="op" id="5549548">(</span><span class="ident" id="5549549">checksum</span>&nbsp;<span class="op" id="5549558">&gt;&gt;</span>&nbsp;<span class="num" id="5549561">16</span><span class="op" id="5549563">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5549567">z</span><span class="op" id="5549568">.</span><span class="ident" id="5549569">scratch</span><span class="op" id="5549576">[</span><span class="num" id="5549577">2</span><span class="op" id="5549578">]</span>&nbsp;<span class="op" id="5549580">=</span>&nbsp;<span class="builtintype" id="5549582">uint8</span><span class="op" id="5549587">(</span><span class="ident" id="5549588">checksum</span>&nbsp;<span class="op" id="5549597">&gt;&gt;</span>&nbsp;<span class="num" id="5549600">8</span><span class="op" id="5549601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5549605">z</span><span class="op" id="5549606">.</span><span class="ident" id="5549607">scratch</span><span class="op" id="5549614">[</span><span class="num" id="5549615">3</span><span class="op" id="5549616">]</span>&nbsp;<span class="op" id="5549618">=</span>&nbsp;<span class="builtintype" id="5549620">uint8</span><span class="op" id="5549625">(</span><span class="ident" id="5549626">checksum</span>&nbsp;<span class="op" id="5549635">&gt;&gt;</span>&nbsp;<span class="num" id="5549638">0</span><span class="op" id="5549639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5549643">if</span>&nbsp;<span class="ident" id="5549646">_</span><span class="op" id="5549647">,</span>&nbsp;<span class="ident" id="5549649">err</span>&nbsp;<span class="op" id="5549653">=</span>&nbsp;<span class="ident" id="5549655">z</span><span class="op" id="5549656">.</span><span class="ident" id="5549657">w</span><span class="op" id="5549658">.</span><span class="ident" id="5549659">Write</span><span class="op" id="5549664">(</span><span class="ident" id="5549665">z</span><span class="op" id="5549666">.</span><span class="ident" id="5549667">scratch</span><span class="op" id="5549674">[</span><span class="num" id="5549675">0</span><span class="op" id="5549676">:</span><span class="num" id="5549677">4</span><span class="op" id="5549678">]</span><span class="op" id="5549679">)</span><span class="op" id="5549680">;</span>&nbsp;<span class="ident" id="5549682">err</span>&nbsp;<span class="op" id="5549686">!=</span>&nbsp;<span class="ident" id="5549689">nil</span>&nbsp;<span class="op" id="5549693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5549698">return</span>&nbsp;<span class="ident" id="5549705">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5549711">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5549714">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5549717">if</span>&nbsp;<span class="ident" id="5549720">z</span><span class="op" id="5549721">.</span><span class="ident" id="5549722">compressor</span>&nbsp;<span class="op" id="5549733">==</span>&nbsp;<span class="ident" id="5549736">nil</span>&nbsp;<span class="op" id="5549740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5549744">//&nbsp;Initialize&nbsp;deflater&nbsp;unless&nbsp;the&nbsp;Writer&nbsp;is&nbsp;being&nbsp;reused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5549803">//&nbsp;after&nbsp;a&nbsp;Reset&nbsp;call.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5549828">z</span><span class="op" id="5549829">.</span><span class="ident" id="5549830">compressor</span><span class="op" id="5549840">,</span>&nbsp;<span class="ident" id="5549842">err</span>&nbsp;<span class="op" id="5549846">=</span>&nbsp;<span class="ident" id="5549848">flate</span><span class="op" id="5549853">.</span><span class="ident" id="5549854">NewWriterDict</span><span class="op" id="5549867">(</span><span class="ident" id="5549868">z</span><span class="op" id="5549869">.</span><span class="ident" id="5549870">w</span><span class="op" id="5549871">,</span>&nbsp;<span class="ident" id="5549873">z</span><span class="op" id="5549874">.</span><span class="ident" id="5549875">level</span><span class="op" id="5549880">,</span>&nbsp;<span class="ident" id="5549882">z</span><span class="op" id="5549883">.</span><span class="ident" id="5549884">dict</span><span class="op" id="5549888">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5549892">if</span>&nbsp;<span class="ident" id="5549895">err</span>&nbsp;<span class="op" id="5549899">!=</span>&nbsp;<span class="ident" id="5549902">nil</span>&nbsp;<span class="op" id="5549906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5549911">return</span>&nbsp;<span class="ident" id="5549918">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5549924">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5549928">z</span><span class="op" id="5549929">.</span><span class="ident" id="5549930">digest</span>&nbsp;<span class="op" id="5549937">=</span>&nbsp;<span class="ident" id="5549939">adler32</span><span class="op" id="5549946">.</span><span class="ident" id="5549947">New</span><span class="op" id="5549950">(</span><span class="op" id="5549951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5549954">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5549957">return</span>&nbsp;<span class="ident" id="5549964">nil</span><br>
<span class="lineno"></span><span class="op" id="5549968">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5549971">//&nbsp;Write&nbsp;writes&nbsp;a&nbsp;compressed&nbsp;form&nbsp;of&nbsp;p&nbsp;to&nbsp;the&nbsp;underlying&nbsp;io.Writer.&nbsp;The</span><br>
<span class="lineno"></span><span class="comment" id="5550043">//&nbsp;compressed&nbsp;bytes&nbsp;are&nbsp;not&nbsp;necessarily&nbsp;flushed&nbsp;until&nbsp;the&nbsp;Writer&nbsp;is&nbsp;closed&nbsp;or</span><br>
<span class="lineno">145</span><span class="comment" id="5550121">//&nbsp;explicitly&nbsp;flushed.</span><br>
<span class="lineno"></span><span class="keyword" id="5550144">func</span>&nbsp;<span class="op" id="5550149">(</span><span class="ident" id="5550150">z</span>&nbsp;<span class="op" id="5550152">*</span><span class="ident" id="5550153">Writer</span><span class="op" id="5550159">)</span>&nbsp;<span class="ident" id="5550161">Write</span><span class="op" id="5550166">(</span><span class="ident" id="5550167">p</span>&nbsp;<span class="op" id="5550169">[</span><span class="op" id="5550170">]</span><span class="builtintype" id="5550171">byte</span><span class="op" id="5550175">)</span>&nbsp;<span class="op" id="5550177">(</span><span class="ident" id="5550178">n</span>&nbsp;<span class="builtintype" id="5550180">int</span><span class="op" id="5550183">,</span>&nbsp;<span class="ident" id="5550185">err</span>&nbsp;<span class="builtintype" id="5550189">error</span><span class="op" id="5550194">)</span>&nbsp;<span class="op" id="5550196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5550199">if</span>&nbsp;<span class="op" id="5550202">!</span><span class="ident" id="5550203">z</span><span class="op" id="5550204">.</span><span class="ident" id="5550205">wroteHeader</span>&nbsp;<span class="op" id="5550217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5550221">z</span><span class="op" id="5550222">.</span><span class="ident" id="5550223">err</span>&nbsp;<span class="op" id="5550227">=</span>&nbsp;<span class="ident" id="5550229">z</span><span class="op" id="5550230">.</span><span class="ident" id="5550231">writeHeader</span><span class="op" id="5550242">(</span><span class="op" id="5550243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5550246">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5550249">if</span>&nbsp;<span class="ident" id="5550252">z</span><span class="op" id="5550253">.</span><span class="ident" id="5550254">err</span>&nbsp;<span class="op" id="5550258">!=</span>&nbsp;<span class="ident" id="5550261">nil</span>&nbsp;<span class="op" id="5550265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5550269">return</span>&nbsp;<span class="num" id="5550276">0</span><span class="op" id="5550277">,</span>&nbsp;<span class="ident" id="5550279">z</span><span class="op" id="5550280">.</span><span class="ident" id="5550281">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5550286">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5550289">if</span>&nbsp;<span class="builtinfunc" id="5550292">len</span><span class="op" id="5550295">(</span><span class="ident" id="5550296">p</span><span class="op" id="5550297">)</span>&nbsp;<span class="op" id="5550299">==</span>&nbsp;<span class="num" id="5550302">0</span>&nbsp;<span class="op" id="5550304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5550308">return</span>&nbsp;<span class="num" id="5550315">0</span><span class="op" id="5550316">,</span>&nbsp;<span class="ident" id="5550318">nil</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5550323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5550326">n</span><span class="op" id="5550327">,</span>&nbsp;<span class="ident" id="5550329">err</span>&nbsp;<span class="op" id="5550333">=</span>&nbsp;<span class="ident" id="5550335">z</span><span class="op" id="5550336">.</span><span class="ident" id="5550337">compressor</span><span class="op" id="5550347">.</span><span class="ident" id="5550348">Write</span><span class="op" id="5550353">(</span><span class="ident" id="5550354">p</span><span class="op" id="5550355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5550358">if</span>&nbsp;<span class="ident" id="5550361">err</span>&nbsp;<span class="op" id="5550365">!=</span>&nbsp;<span class="ident" id="5550368">nil</span>&nbsp;<span class="op" id="5550372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5550376">z</span><span class="op" id="5550377">.</span><span class="ident" id="5550378">err</span>&nbsp;<span class="op" id="5550382">=</span>&nbsp;<span class="ident" id="5550384">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5550390">return</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5550398">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5550401">z</span><span class="op" id="5550402">.</span><span class="ident" id="5550403">digest</span><span class="op" id="5550409">.</span><span class="ident" id="5550410">Write</span><span class="op" id="5550415">(</span><span class="ident" id="5550416">p</span><span class="op" id="5550417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5550420">return</span><br>
<span class="lineno"></span><span class="op" id="5550427">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="comment" id="5550430">//&nbsp;Flush&nbsp;flushes&nbsp;the&nbsp;Writer&nbsp;to&nbsp;its&nbsp;underlying&nbsp;io.Writer.</span><br>
<span class="lineno"></span><span class="keyword" id="5550487">func</span>&nbsp;<span class="op" id="5550492">(</span><span class="ident" id="5550493">z</span>&nbsp;<span class="op" id="5550495">*</span><span class="ident" id="5550496">Writer</span><span class="op" id="5550502">)</span>&nbsp;<span class="ident" id="5550504">Flush</span><span class="op" id="5550509">(</span><span class="op" id="5550510">)</span>&nbsp;<span class="builtintype" id="5550512">error</span>&nbsp;<span class="op" id="5550518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5550521">if</span>&nbsp;<span class="op" id="5550524">!</span><span class="ident" id="5550525">z</span><span class="op" id="5550526">.</span><span class="ident" id="5550527">wroteHeader</span>&nbsp;<span class="op" id="5550539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5550543">z</span><span class="op" id="5550544">.</span><span class="ident" id="5550545">err</span>&nbsp;<span class="op" id="5550549">=</span>&nbsp;<span class="ident" id="5550551">z</span><span class="op" id="5550552">.</span><span class="ident" id="5550553">writeHeader</span><span class="op" id="5550564">(</span><span class="op" id="5550565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5550568">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5550571">if</span>&nbsp;<span class="ident" id="5550574">z</span><span class="op" id="5550575">.</span><span class="ident" id="5550576">err</span>&nbsp;<span class="op" id="5550580">!=</span>&nbsp;<span class="ident" id="5550583">nil</span>&nbsp;<span class="op" id="5550587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5550591">return</span>&nbsp;<span class="ident" id="5550598">z</span><span class="op" id="5550599">.</span><span class="ident" id="5550600">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5550605">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5550608">z</span><span class="op" id="5550609">.</span><span class="ident" id="5550610">err</span>&nbsp;<span class="op" id="5550614">=</span>&nbsp;<span class="ident" id="5550616">z</span><span class="op" id="5550617">.</span><span class="ident" id="5550618">compressor</span><span class="op" id="5550628">.</span><span class="ident" id="5550629">Flush</span><span class="op" id="5550634">(</span><span class="op" id="5550635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5550638">return</span>&nbsp;<span class="ident" id="5550645">z</span><span class="op" id="5550646">.</span><span class="ident" id="5550647">err</span><br>
<span class="lineno">175</span><span class="op" id="5550651">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5550654">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;Writer,&nbsp;flushing&nbsp;any&nbsp;unwritten&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying</span><br>
<span class="lineno"></span><span class="comment" id="5550728">//&nbsp;io.Writer,&nbsp;but&nbsp;does&nbsp;not&nbsp;close&nbsp;the&nbsp;underlying&nbsp;io.Writer.</span><br>
<span class="lineno"></span><span class="keyword" id="5550787">func</span>&nbsp;<span class="op" id="5550792">(</span><span class="ident" id="5550793">z</span>&nbsp;<span class="op" id="5550795">*</span><span class="ident" id="5550796">Writer</span><span class="op" id="5550802">)</span>&nbsp;<span class="ident" id="5550804">Close</span><span class="op" id="5550809">(</span><span class="op" id="5550810">)</span>&nbsp;<span class="builtintype" id="5550812">error</span>&nbsp;<span class="op" id="5550818">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5550821">if</span>&nbsp;<span class="op" id="5550824">!</span><span class="ident" id="5550825">z</span><span class="op" id="5550826">.</span><span class="ident" id="5550827">wroteHeader</span>&nbsp;<span class="op" id="5550839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5550843">z</span><span class="op" id="5550844">.</span><span class="ident" id="5550845">err</span>&nbsp;<span class="op" id="5550849">=</span>&nbsp;<span class="ident" id="5550851">z</span><span class="op" id="5550852">.</span><span class="ident" id="5550853">writeHeader</span><span class="op" id="5550864">(</span><span class="op" id="5550865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5550868">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5550871">if</span>&nbsp;<span class="ident" id="5550874">z</span><span class="op" id="5550875">.</span><span class="ident" id="5550876">err</span>&nbsp;<span class="op" id="5550880">!=</span>&nbsp;<span class="ident" id="5550883">nil</span>&nbsp;<span class="op" id="5550887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5550891">return</span>&nbsp;<span class="ident" id="5550898">z</span><span class="op" id="5550899">.</span><span class="ident" id="5550900">err</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5550905">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5550908">z</span><span class="op" id="5550909">.</span><span class="ident" id="5550910">err</span>&nbsp;<span class="op" id="5550914">=</span>&nbsp;<span class="ident" id="5550916">z</span><span class="op" id="5550917">.</span><span class="ident" id="5550918">compressor</span><span class="op" id="5550928">.</span><span class="ident" id="5550929">Close</span><span class="op" id="5550934">(</span><span class="op" id="5550935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5550938">if</span>&nbsp;<span class="ident" id="5550941">z</span><span class="op" id="5550942">.</span><span class="ident" id="5550943">err</span>&nbsp;<span class="op" id="5550947">!=</span>&nbsp;<span class="ident" id="5550950">nil</span>&nbsp;<span class="op" id="5550954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5550958">return</span>&nbsp;<span class="ident" id="5550965">z</span><span class="op" id="5550966">.</span><span class="ident" id="5550967">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5550972">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5550975">checksum</span>&nbsp;<span class="op" id="5550984">:=</span>&nbsp;<span class="ident" id="5550987">z</span><span class="op" id="5550988">.</span><span class="ident" id="5550989">digest</span><span class="op" id="5550995">.</span><span class="ident" id="5550996">Sum32</span><span class="op" id="5551001">(</span><span class="op" id="5551002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5551005">//&nbsp;ZLIB&nbsp;(RFC&nbsp;1950)&nbsp;is&nbsp;big-endian,&nbsp;unlike&nbsp;GZIP&nbsp;(RFC&nbsp;1952).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5551064">z</span><span class="op" id="5551065">.</span><span class="ident" id="5551066">scratch</span><span class="op" id="5551073">[</span><span class="num" id="5551074">0</span><span class="op" id="5551075">]</span>&nbsp;<span class="op" id="5551077">=</span>&nbsp;<span class="builtintype" id="5551079">uint8</span><span class="op" id="5551084">(</span><span class="ident" id="5551085">checksum</span>&nbsp;<span class="op" id="5551094">&gt;&gt;</span>&nbsp;<span class="num" id="5551097">24</span><span class="op" id="5551099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5551102">z</span><span class="op" id="5551103">.</span><span class="ident" id="5551104">scratch</span><span class="op" id="5551111">[</span><span class="num" id="5551112">1</span><span class="op" id="5551113">]</span>&nbsp;<span class="op" id="5551115">=</span>&nbsp;<span class="builtintype" id="5551117">uint8</span><span class="op" id="5551122">(</span><span class="ident" id="5551123">checksum</span>&nbsp;<span class="op" id="5551132">&gt;&gt;</span>&nbsp;<span class="num" id="5551135">16</span><span class="op" id="5551137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5551140">z</span><span class="op" id="5551141">.</span><span class="ident" id="5551142">scratch</span><span class="op" id="5551149">[</span><span class="num" id="5551150">2</span><span class="op" id="5551151">]</span>&nbsp;<span class="op" id="5551153">=</span>&nbsp;<span class="builtintype" id="5551155">uint8</span><span class="op" id="5551160">(</span><span class="ident" id="5551161">checksum</span>&nbsp;<span class="op" id="5551170">&gt;&gt;</span>&nbsp;<span class="num" id="5551173">8</span><span class="op" id="5551174">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5551177">z</span><span class="op" id="5551178">.</span><span class="ident" id="5551179">scratch</span><span class="op" id="5551186">[</span><span class="num" id="5551187">3</span><span class="op" id="5551188">]</span>&nbsp;<span class="op" id="5551190">=</span>&nbsp;<span class="builtintype" id="5551192">uint8</span><span class="op" id="5551197">(</span><span class="ident" id="5551198">checksum</span>&nbsp;<span class="op" id="5551207">&gt;&gt;</span>&nbsp;<span class="num" id="5551210">0</span><span class="op" id="5551211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5551214">_</span><span class="op" id="5551215">,</span>&nbsp;<span class="ident" id="5551217">z</span><span class="op" id="5551218">.</span><span class="ident" id="5551219">err</span>&nbsp;<span class="op" id="5551223">=</span>&nbsp;<span class="ident" id="5551225">z</span><span class="op" id="5551226">.</span><span class="ident" id="5551227">w</span><span class="op" id="5551228">.</span><span class="ident" id="5551229">Write</span><span class="op" id="5551234">(</span><span class="ident" id="5551235">z</span><span class="op" id="5551236">.</span><span class="ident" id="5551237">scratch</span><span class="op" id="5551244">[</span><span class="num" id="5551245">0</span><span class="op" id="5551246">:</span><span class="num" id="5551247">4</span><span class="op" id="5551248">]</span><span class="op" id="5551249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5551252">return</span>&nbsp;<span class="ident" id="5551259">z</span><span class="op" id="5551260">.</span><span class="ident" id="5551261">err</span><br>
<span class="lineno"></span><span class="op" id="5551265">}</span>
</div>
</body>
</html>
