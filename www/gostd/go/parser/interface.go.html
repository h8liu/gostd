<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/parser</h2>
<ul>
<li><a href="/gostd/go/parser/error_test.go.html">error_test.go</a></li>
<li><a href="/gostd/go/parser/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/parser/interface.go.html" class="current">interface.go</a></li>
<li><a href="/gostd/go/parser/parser.go.html">parser.go</a></li>
<li><a href="/gostd/go/parser/parser_test.go.html">parser_test.go</a></li>
<li><a href="/gostd/go/parser/performance_test.go.html">performance_test.go</a></li>
<li><a href="/gostd/go/parser/short_test.go.html">short_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4825768">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4825823">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4825877">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4825928">//&nbsp;This&nbsp;file&nbsp;contains&nbsp;the&nbsp;exported&nbsp;entry&nbsp;points&nbsp;for&nbsp;invoking&nbsp;the&nbsp;parser.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4826002">package</span>&nbsp;<span class="ident" id="4826010">parser</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4826018">import</span>&nbsp;<span class="op" id="4826025">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4826028">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4826037">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4826047">&#34;go/ast&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4826057">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4826069">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4826075">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4826088">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4826094">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4826111">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="4826121">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="4826124">//&nbsp;If&nbsp;src&nbsp;!=&nbsp;nil,&nbsp;readSource&nbsp;converts&nbsp;src&nbsp;to&nbsp;a&nbsp;[]byte&nbsp;if&nbsp;possible;</span><br>
<span class="lineno"></span><span class="comment" id="4826191">//&nbsp;otherwise&nbsp;it&nbsp;returns&nbsp;an&nbsp;error.&nbsp;If&nbsp;src&nbsp;==&nbsp;nil,&nbsp;readSource&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="4826259">//&nbsp;the&nbsp;result&nbsp;of&nbsp;reading&nbsp;the&nbsp;file&nbsp;specified&nbsp;by&nbsp;filename.</span><br>
<span class="lineno"></span><span class="comment" id="4826316">//</span><br>
<span class="lineno">25</span><span class="keyword" id="4826319">func</span>&nbsp;<span class="ident" id="4826324">readSource</span><span class="op" id="4826334">(</span><span class="ident" id="4826335">filename</span>&nbsp;<span class="builtintype" id="4826344">string</span><span class="op" id="4826350">,</span>&nbsp;<span class="ident" id="4826352">src</span>&nbsp;<span class="keyword" id="4826356">interface</span><span class="op" id="4826365">{</span><span class="op" id="4826366">}</span><span class="op" id="4826367">)</span>&nbsp;<span class="op" id="4826369">(</span><span class="op" id="4826370">[</span><span class="op" id="4826371">]</span><span class="builtintype" id="4826372">byte</span><span class="op" id="4826376">,</span>&nbsp;<span class="builtintype" id="4826378">error</span><span class="op" id="4826383">)</span>&nbsp;<span class="op" id="4826385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4826388">if</span>&nbsp;<span class="ident" id="4826391">src</span>&nbsp;<span class="op" id="4826395">!=</span>&nbsp;<span class="builtintype" id="4826398">nil</span>&nbsp;<span class="op" id="4826402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4826406">switch</span>&nbsp;<span class="ident" id="4826413">s</span>&nbsp;<span class="op" id="4826415">:=</span>&nbsp;<span class="ident" id="4826418">src</span><span class="op" id="4826421">.</span><span class="op" id="4826422">(</span><span class="keyword" id="4826423">type</span><span class="op" id="4826427">)</span>&nbsp;<span class="op" id="4826429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4826433">case</span>&nbsp;<span class="builtintype" id="4826438">string</span><span class="op" id="4826444">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4826449">return</span>&nbsp;<span class="op" id="4826456">[</span><span class="op" id="4826457">]</span><span class="builtintype" id="4826458">byte</span><span class="op" id="4826462">(</span><span class="ident" id="4826463">s</span><span class="op" id="4826464">)</span><span class="op" id="4826465">,</span>&nbsp;<span class="builtintype" id="4826467">nil</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4826473">case</span>&nbsp;<span class="op" id="4826478">[</span><span class="op" id="4826479">]</span><span class="builtintype" id="4826480">byte</span><span class="op" id="4826484">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4826489">return</span>&nbsp;<span class="ident" id="4826496">s</span><span class="op" id="4826497">,</span>&nbsp;<span class="builtintype" id="4826499">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4826505">case</span>&nbsp;<span class="op" id="4826510">*</span><span class="ident" id="4826511">bytes</span><span class="op" id="4826516">.</span><span class="ident" id="4826517">Buffer</span><span class="op" id="4826523">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4826528">//&nbsp;is&nbsp;io.Reader,&nbsp;but&nbsp;src&nbsp;is&nbsp;already&nbsp;available&nbsp;in&nbsp;[]byte&nbsp;form</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4826592">if</span>&nbsp;<span class="ident" id="4826595">s</span>&nbsp;<span class="op" id="4826597">!=</span>&nbsp;<span class="builtintype" id="4826600">nil</span>&nbsp;<span class="op" id="4826604">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4826610">return</span>&nbsp;<span class="ident" id="4826617">s</span><span class="op" id="4826618">.</span><span class="ident" id="4826619">Bytes</span><span class="op" id="4826624">(</span><span class="op" id="4826625">)</span><span class="op" id="4826626">,</span>&nbsp;<span class="builtintype" id="4826628">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4826635">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4826639">case</span>&nbsp;<span class="ident" id="4826644">io</span><span class="op" id="4826646">.</span><span class="ident" id="4826647">Reader</span><span class="op" id="4826653">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4826658">var</span>&nbsp;<span class="ident" id="4826662">buf</span>&nbsp;<span class="ident" id="4826666">bytes</span><span class="op" id="4826671">.</span><span class="ident" id="4826672">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4826682">if</span>&nbsp;<span class="ident" id="4826685">_</span><span class="op" id="4826686">,</span>&nbsp;<span class="ident" id="4826688">err</span>&nbsp;<span class="op" id="4826692">:=</span>&nbsp;<span class="ident" id="4826695">io</span><span class="op" id="4826697">.</span><span class="ident" id="4826698">Copy</span><span class="op" id="4826702">(</span><span class="op" id="4826703">&amp;</span><span class="ident" id="4826704">buf</span><span class="op" id="4826707">,</span>&nbsp;<span class="ident" id="4826709">s</span><span class="op" id="4826710">)</span><span class="op" id="4826711">;</span>&nbsp;<span class="ident" id="4826713">err</span>&nbsp;<span class="op" id="4826717">!=</span>&nbsp;<span class="builtintype" id="4826720">nil</span>&nbsp;<span class="op" id="4826724">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4826730">return</span>&nbsp;<span class="builtintype" id="4826737">nil</span><span class="op" id="4826740">,</span>&nbsp;<span class="ident" id="4826742">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4826749">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4826754">return</span>&nbsp;<span class="ident" id="4826761">buf</span><span class="op" id="4826764">.</span><span class="ident" id="4826765">Bytes</span><span class="op" id="4826770">(</span><span class="op" id="4826771">)</span><span class="op" id="4826772">,</span>&nbsp;<span class="builtintype" id="4826774">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4826780">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4826784">return</span>&nbsp;<span class="builtintype" id="4826791">nil</span><span class="op" id="4826794">,</span>&nbsp;<span class="ident" id="4826796">errors</span><span class="op" id="4826802">.</span><span class="ident" id="4826803">New</span><span class="op" id="4826806">(</span><span class="string" id="4826807">&#34;invalid&nbsp;source&#34;</span><span class="op" id="4826823">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4826826">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4826829">return</span>&nbsp;<span class="ident" id="4826836">ioutil</span><span class="op" id="4826842">.</span><span class="ident" id="4826843">ReadFile</span><span class="op" id="4826851">(</span><span class="ident" id="4826852">filename</span><span class="op" id="4826860">)</span><br>
<span class="lineno"></span><span class="op" id="4826862">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4826865">//&nbsp;A&nbsp;Mode&nbsp;value&nbsp;is&nbsp;a&nbsp;set&nbsp;of&nbsp;flags&nbsp;(or&nbsp;0).</span><br>
<span class="lineno">50</span><span class="comment" id="4826907">//&nbsp;They&nbsp;control&nbsp;the&nbsp;amount&nbsp;of&nbsp;source&nbsp;code&nbsp;parsed&nbsp;and&nbsp;other&nbsp;optional</span><br>
<span class="lineno"></span><span class="comment" id="4826975">//&nbsp;parser&nbsp;functionality.</span><br>
<span class="lineno"></span><span class="comment" id="4827000">//</span><br>
<span class="lineno"></span><span class="keyword" id="4827003">type</span>&nbsp;<span class="ident" id="4827008">Mode</span>&nbsp;<span class="builtintype" id="4827013">uint</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="4827019">const</span>&nbsp;<span class="op" id="4827025">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4827028">PackageClauseOnly</span>&nbsp;<span class="ident" id="4827046">Mode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4827063">=</span>&nbsp;<span class="num" id="4827065">1</span>&nbsp;<span class="op" id="4827067">&lt;&lt;</span>&nbsp;<span class="ident" id="4827070">iota</span>&nbsp;<span class="comment" id="4827075">//&nbsp;stop&nbsp;parsing&nbsp;after&nbsp;package&nbsp;clause</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4827113">ImportsOnly</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4827160">//&nbsp;stop&nbsp;parsing&nbsp;after&nbsp;import&nbsp;declarations</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4827203">ParseComments</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4827250">//&nbsp;parse&nbsp;comments&nbsp;and&nbsp;add&nbsp;them&nbsp;to&nbsp;AST</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4827289">Trace</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4827336">//&nbsp;print&nbsp;a&nbsp;trace&nbsp;of&nbsp;parsed&nbsp;productions</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4827376">DeclarationErrors</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4827423">//&nbsp;report&nbsp;declaration&nbsp;errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4827453">SpuriousErrors</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4827500">//&nbsp;same&nbsp;as&nbsp;AllErrors,&nbsp;for&nbsp;backward-compatibility</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4827550">AllErrors</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4827568">=</span>&nbsp;<span class="ident" id="4827570">SpuriousErrors</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4827597">//&nbsp;report&nbsp;all&nbsp;errors&nbsp;(not&nbsp;just&nbsp;the&nbsp;first&nbsp;10&nbsp;on&nbsp;different&nbsp;lines)</span><br>
<span class="lineno"></span><span class="op" id="4827661">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="4827664">//&nbsp;ParseFile&nbsp;parses&nbsp;the&nbsp;source&nbsp;code&nbsp;of&nbsp;a&nbsp;single&nbsp;Go&nbsp;source&nbsp;file&nbsp;and&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="4827739">//&nbsp;the&nbsp;corresponding&nbsp;ast.File&nbsp;node.&nbsp;The&nbsp;source&nbsp;code&nbsp;may&nbsp;be&nbsp;provided&nbsp;via</span><br>
<span class="lineno"></span><span class="comment" id="4827811">//&nbsp;the&nbsp;filename&nbsp;of&nbsp;the&nbsp;source&nbsp;file,&nbsp;or&nbsp;via&nbsp;the&nbsp;src&nbsp;parameter.</span><br>
<span class="lineno"></span><span class="comment" id="4827873">//</span><br>
<span class="lineno"></span><span class="comment" id="4827876">//&nbsp;If&nbsp;src&nbsp;!=&nbsp;nil,&nbsp;ParseFile&nbsp;parses&nbsp;the&nbsp;source&nbsp;from&nbsp;src&nbsp;and&nbsp;the&nbsp;filename&nbsp;is</span><br>
<span class="lineno">70</span><span class="comment" id="4827951">//&nbsp;only&nbsp;used&nbsp;when&nbsp;recording&nbsp;position&nbsp;information.&nbsp;The&nbsp;type&nbsp;of&nbsp;the&nbsp;argument</span><br>
<span class="lineno"></span><span class="comment" id="4828026">//&nbsp;for&nbsp;the&nbsp;src&nbsp;parameter&nbsp;must&nbsp;be&nbsp;string,&nbsp;[]byte,&nbsp;or&nbsp;io.Reader.</span><br>
<span class="lineno"></span><span class="comment" id="4828089">//&nbsp;If&nbsp;src&nbsp;==&nbsp;nil,&nbsp;ParseFile&nbsp;parses&nbsp;the&nbsp;file&nbsp;specified&nbsp;by&nbsp;filename.</span><br>
<span class="lineno"></span><span class="comment" id="4828156">//</span><br>
<span class="lineno"></span><span class="comment" id="4828159">//&nbsp;The&nbsp;mode&nbsp;parameter&nbsp;controls&nbsp;the&nbsp;amount&nbsp;of&nbsp;source&nbsp;text&nbsp;parsed&nbsp;and&nbsp;other</span><br>
<span class="lineno">75</span><span class="comment" id="4828233">//&nbsp;optional&nbsp;parser&nbsp;functionality.&nbsp;Position&nbsp;information&nbsp;is&nbsp;recorded&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4828307">//&nbsp;file&nbsp;set&nbsp;fset.</span><br>
<span class="lineno"></span><span class="comment" id="4828325">//</span><br>
<span class="lineno"></span><span class="comment" id="4828328">//&nbsp;If&nbsp;the&nbsp;source&nbsp;couldn&#39;t&nbsp;be&nbsp;read,&nbsp;the&nbsp;returned&nbsp;AST&nbsp;is&nbsp;nil&nbsp;and&nbsp;the&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="4828401">//&nbsp;indicates&nbsp;the&nbsp;specific&nbsp;failure.&nbsp;If&nbsp;the&nbsp;source&nbsp;was&nbsp;read&nbsp;but&nbsp;syntax</span><br>
<span class="lineno">80</span><span class="comment" id="4828470">//&nbsp;errors&nbsp;were&nbsp;found,&nbsp;the&nbsp;result&nbsp;is&nbsp;a&nbsp;partial&nbsp;AST&nbsp;(with&nbsp;ast.Bad*&nbsp;nodes</span><br>
<span class="lineno"></span><span class="comment" id="4828541">//&nbsp;representing&nbsp;the&nbsp;fragments&nbsp;of&nbsp;erroneous&nbsp;source&nbsp;code).&nbsp;Multiple&nbsp;errors</span><br>
<span class="lineno"></span><span class="comment" id="4828614">//&nbsp;are&nbsp;returned&nbsp;via&nbsp;a&nbsp;scanner.ErrorList&nbsp;which&nbsp;is&nbsp;sorted&nbsp;by&nbsp;file&nbsp;position.</span><br>
<span class="lineno"></span><span class="comment" id="4828688">//</span><br>
<span class="lineno"></span><span class="keyword" id="4828691">func</span>&nbsp;<span class="ident" id="4828696">ParseFile</span><span class="op" id="4828705">(</span><span class="ident" id="4828706">fset</span>&nbsp;<span class="op" id="4828711">*</span><span class="ident" id="4828712">token</span><span class="op" id="4828717">.</span><span class="ident" id="4828718">FileSet</span><span class="op" id="4828725">,</span>&nbsp;<span class="ident" id="4828727">filename</span>&nbsp;<span class="builtintype" id="4828736">string</span><span class="op" id="4828742">,</span>&nbsp;<span class="ident" id="4828744">src</span>&nbsp;<span class="keyword" id="4828748">interface</span><span class="op" id="4828757">{</span><span class="op" id="4828758">}</span><span class="op" id="4828759">,</span>&nbsp;<span class="ident" id="4828761">mode</span>&nbsp;<span class="ident" id="4828766">Mode</span><span class="op" id="4828770">)</span>&nbsp;<span class="op" id="4828772">(</span><span class="ident" id="4828773">f</span>&nbsp;<span class="op" id="4828775">*</span><span class="ident" id="4828776">ast</span><span class="op" id="4828779">.</span><span class="ident" id="4828780">File</span><span class="op" id="4828784">,</span>&nbsp;<span class="ident" id="4828786">err</span>&nbsp;<span class="builtintype" id="4828790">error</span><span class="op" id="4828795">)</span>&nbsp;<span class="op" id="4828797">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4828800">//&nbsp;get&nbsp;source</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4828815">text</span><span class="op" id="4828819">,</span>&nbsp;<span class="ident" id="4828821">err</span>&nbsp;<span class="op" id="4828825">:=</span>&nbsp;<span class="ident" id="4828828">readSource</span><span class="op" id="4828838">(</span><span class="ident" id="4828839">filename</span><span class="op" id="4828847">,</span>&nbsp;<span class="ident" id="4828849">src</span><span class="op" id="4828852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4828855">if</span>&nbsp;<span class="ident" id="4828858">err</span>&nbsp;<span class="op" id="4828862">!=</span>&nbsp;<span class="builtintype" id="4828865">nil</span>&nbsp;<span class="op" id="4828869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4828873">return</span>&nbsp;<span class="builtintype" id="4828880">nil</span><span class="op" id="4828883">,</span>&nbsp;<span class="ident" id="4828885">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4828890">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4828894">var</span>&nbsp;<span class="ident" id="4828898">p</span>&nbsp;<span class="ident" id="4828900">parser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4828908">defer</span>&nbsp;<span class="keyword" id="4828914">func</span><span class="op" id="4828918">(</span><span class="op" id="4828919">)</span>&nbsp;<span class="op" id="4828921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4828925">if</span>&nbsp;<span class="ident" id="4828928">e</span>&nbsp;<span class="op" id="4828930">:=</span>&nbsp;<span class="builtinfunc" id="4828933">recover</span><span class="op" id="4828940">(</span><span class="op" id="4828941">)</span><span class="op" id="4828942">;</span>&nbsp;<span class="ident" id="4828944">e</span>&nbsp;<span class="op" id="4828946">!=</span>&nbsp;<span class="builtintype" id="4828949">nil</span>&nbsp;<span class="op" id="4828953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4828958">_</span>&nbsp;<span class="op" id="4828960">=</span>&nbsp;<span class="ident" id="4828962">e</span><span class="op" id="4828963">.</span><span class="op" id="4828964">(</span><span class="ident" id="4828965">bailout</span><span class="op" id="4828972">)</span>&nbsp;<span class="comment" id="4828974">//&nbsp;re-panics&nbsp;if&nbsp;it&#39;s&nbsp;not&nbsp;a&nbsp;bailout</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4829011">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4829016">//&nbsp;set&nbsp;result&nbsp;values</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4829039">if</span>&nbsp;<span class="ident" id="4829042">f</span>&nbsp;<span class="op" id="4829044">==</span>&nbsp;<span class="builtintype" id="4829047">nil</span>&nbsp;<span class="op" id="4829051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4829056">//&nbsp;source&nbsp;is&nbsp;not&nbsp;a&nbsp;valid&nbsp;Go&nbsp;source&nbsp;file&nbsp;-&nbsp;satisfy</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4829109">//&nbsp;ParseFile&nbsp;API&nbsp;and&nbsp;return&nbsp;a&nbsp;valid&nbsp;(but)&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4829160">//&nbsp;*ast.File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4829176">f</span>&nbsp;<span class="op" id="4829178">=</span>&nbsp;<span class="op" id="4829180">&amp;</span><span class="ident" id="4829181">ast</span><span class="op" id="4829184">.</span><span class="ident" id="4829185">File</span><span class="op" id="4829189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4829195">Name</span><span class="op" id="4829199">:</span>&nbsp;&nbsp;<span class="builtinfunc" id="4829202">new</span><span class="op" id="4829205">(</span><span class="ident" id="4829206">ast</span><span class="op" id="4829209">.</span><span class="ident" id="4829210">Ident</span><span class="op" id="4829215">)</span><span class="op" id="4829216">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4829222">Scope</span><span class="op" id="4829227">:</span>&nbsp;<span class="ident" id="4829229">ast</span><span class="op" id="4829232">.</span><span class="ident" id="4829233">NewScope</span><span class="op" id="4829241">(</span><span class="builtintype" id="4829242">nil</span><span class="op" id="4829245">)</span><span class="op" id="4829246">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4829251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4829255">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4829260">p</span><span class="op" id="4829261">.</span><span class="ident" id="4829262">errors</span><span class="op" id="4829268">.</span><span class="ident" id="4829269">Sort</span><span class="op" id="4829273">(</span><span class="op" id="4829274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4829278">err</span>&nbsp;<span class="op" id="4829282">=</span>&nbsp;<span class="ident" id="4829284">p</span><span class="op" id="4829285">.</span><span class="ident" id="4829286">errors</span><span class="op" id="4829292">.</span><span class="ident" id="4829293">Err</span><span class="op" id="4829296">(</span><span class="op" id="4829297">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4829300">}</span><span class="op" id="4829301">(</span><span class="op" id="4829302">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4829306">//&nbsp;parse&nbsp;source</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4829323">p</span><span class="op" id="4829324">.</span><span class="ident" id="4829325">init</span><span class="op" id="4829329">(</span><span class="ident" id="4829330">fset</span><span class="op" id="4829334">,</span>&nbsp;<span class="ident" id="4829336">filename</span><span class="op" id="4829344">,</span>&nbsp;<span class="ident" id="4829346">text</span><span class="op" id="4829350">,</span>&nbsp;<span class="ident" id="4829352">mode</span><span class="op" id="4829356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4829359">f</span>&nbsp;<span class="op" id="4829361">=</span>&nbsp;<span class="ident" id="4829363">p</span><span class="op" id="4829364">.</span><span class="ident" id="4829365">parseFile</span><span class="op" id="4829374">(</span><span class="op" id="4829375">)</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4829379">return</span><br>
<span class="lineno"></span><span class="op" id="4829386">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4829389">//&nbsp;ParseDir&nbsp;calls&nbsp;ParseFile&nbsp;for&nbsp;all&nbsp;files&nbsp;with&nbsp;names&nbsp;ending&nbsp;in&nbsp;&#34;.go&#34;&nbsp;in&nbsp;the</span><br>
<span class="lineno">120</span><span class="comment" id="4829465">//&nbsp;directory&nbsp;specified&nbsp;by&nbsp;path&nbsp;and&nbsp;returns&nbsp;a&nbsp;map&nbsp;of&nbsp;package&nbsp;name&nbsp;-&gt;&nbsp;package</span><br>
<span class="lineno"></span><span class="comment" id="4829541">//&nbsp;AST&nbsp;with&nbsp;all&nbsp;the&nbsp;packages&nbsp;found.</span><br>
<span class="lineno"></span><span class="comment" id="4829577">//</span><br>
<span class="lineno"></span><span class="comment" id="4829580">//&nbsp;If&nbsp;filter&nbsp;!=&nbsp;nil,&nbsp;only&nbsp;the&nbsp;files&nbsp;with&nbsp;os.FileInfo&nbsp;entries&nbsp;passing&nbsp;through</span><br>
<span class="lineno"></span><span class="comment" id="4829657">//&nbsp;the&nbsp;filter&nbsp;(and&nbsp;ending&nbsp;in&nbsp;&#34;.go&#34;)&nbsp;are&nbsp;considered.&nbsp;The&nbsp;mode&nbsp;bits&nbsp;are&nbsp;passed</span><br>
<span class="lineno">125</span><span class="comment" id="4829734">//&nbsp;to&nbsp;ParseFile&nbsp;unchanged.&nbsp;Position&nbsp;information&nbsp;is&nbsp;recorded&nbsp;in&nbsp;fset.</span><br>
<span class="lineno"></span><span class="comment" id="4829803">//</span><br>
<span class="lineno"></span><span class="comment" id="4829806">//&nbsp;If&nbsp;the&nbsp;directory&nbsp;couldn&#39;t&nbsp;be&nbsp;read,&nbsp;a&nbsp;nil&nbsp;map&nbsp;and&nbsp;the&nbsp;respective&nbsp;error&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="4829883">//&nbsp;returned.&nbsp;If&nbsp;a&nbsp;parse&nbsp;error&nbsp;occurred,&nbsp;a&nbsp;non-nil&nbsp;but&nbsp;incomplete&nbsp;map&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4829960">//&nbsp;first&nbsp;error&nbsp;encountered&nbsp;are&nbsp;returned.</span><br>
<span class="lineno">130</span><span class="comment" id="4830001">//</span><br>
<span class="lineno"></span><span class="keyword" id="4830004">func</span>&nbsp;<span class="ident" id="4830009">ParseDir</span><span class="op" id="4830017">(</span><span class="ident" id="4830018">fset</span>&nbsp;<span class="op" id="4830023">*</span><span class="ident" id="4830024">token</span><span class="op" id="4830029">.</span><span class="ident" id="4830030">FileSet</span><span class="op" id="4830037">,</span>&nbsp;<span class="ident" id="4830039">path</span>&nbsp;<span class="builtintype" id="4830044">string</span><span class="op" id="4830050">,</span>&nbsp;<span class="ident" id="4830052">filter</span>&nbsp;<span class="keyword" id="4830059">func</span><span class="op" id="4830063">(</span><span class="ident" id="4830064">os</span><span class="op" id="4830066">.</span><span class="ident" id="4830067">FileInfo</span><span class="op" id="4830075">)</span>&nbsp;<span class="builtintype" id="4830077">bool</span><span class="op" id="4830081">,</span>&nbsp;<span class="ident" id="4830083">mode</span>&nbsp;<span class="ident" id="4830088">Mode</span><span class="op" id="4830092">)</span>&nbsp;<span class="op" id="4830094">(</span><span class="ident" id="4830095">pkgs</span>&nbsp;<span class="keyword" id="4830100">map</span><span class="op" id="4830103">[</span><span class="builtintype" id="4830104">string</span><span class="op" id="4830110">]</span><span class="op" id="4830111">*</span><span class="ident" id="4830112">ast</span><span class="op" id="4830115">.</span><span class="ident" id="4830116">Package</span><span class="op" id="4830123">,</span>&nbsp;<span class="ident" id="4830125">first</span>&nbsp;<span class="builtintype" id="4830131">error</span><span class="op" id="4830136">)</span>&nbsp;<span class="op" id="4830138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4830141">fd</span><span class="op" id="4830143">,</span>&nbsp;<span class="ident" id="4830145">err</span>&nbsp;<span class="op" id="4830149">:=</span>&nbsp;<span class="ident" id="4830152">os</span><span class="op" id="4830154">.</span><span class="ident" id="4830155">Open</span><span class="op" id="4830159">(</span><span class="ident" id="4830160">path</span><span class="op" id="4830164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4830167">if</span>&nbsp;<span class="ident" id="4830170">err</span>&nbsp;<span class="op" id="4830174">!=</span>&nbsp;<span class="builtintype" id="4830177">nil</span>&nbsp;<span class="op" id="4830181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4830185">return</span>&nbsp;<span class="builtintype" id="4830192">nil</span><span class="op" id="4830195">,</span>&nbsp;<span class="ident" id="4830197">err</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4830202">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4830205">defer</span>&nbsp;<span class="ident" id="4830211">fd</span><span class="op" id="4830213">.</span><span class="ident" id="4830214">Close</span><span class="op" id="4830219">(</span><span class="op" id="4830220">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4830224">list</span><span class="op" id="4830228">,</span>&nbsp;<span class="ident" id="4830230">err</span>&nbsp;<span class="op" id="4830234">:=</span>&nbsp;<span class="ident" id="4830237">fd</span><span class="op" id="4830239">.</span><span class="ident" id="4830240">Readdir</span><span class="op" id="4830247">(</span><span class="op" id="4830248">-</span><span class="num" id="4830249">1</span><span class="op" id="4830250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4830253">if</span>&nbsp;<span class="ident" id="4830256">err</span>&nbsp;<span class="op" id="4830260">!=</span>&nbsp;<span class="builtintype" id="4830263">nil</span>&nbsp;<span class="op" id="4830267">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4830271">return</span>&nbsp;<span class="builtintype" id="4830278">nil</span><span class="op" id="4830281">,</span>&nbsp;<span class="ident" id="4830283">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4830288">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4830292">pkgs</span>&nbsp;<span class="op" id="4830297">=</span>&nbsp;<span class="builtinfunc" id="4830299">make</span><span class="op" id="4830303">(</span><span class="keyword" id="4830304">map</span><span class="op" id="4830307">[</span><span class="builtintype" id="4830308">string</span><span class="op" id="4830314">]</span><span class="op" id="4830315">*</span><span class="ident" id="4830316">ast</span><span class="op" id="4830319">.</span><span class="ident" id="4830320">Package</span><span class="op" id="4830327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4830330">for</span>&nbsp;<span class="ident" id="4830334">_</span><span class="op" id="4830335">,</span>&nbsp;<span class="ident" id="4830337">d</span>&nbsp;<span class="op" id="4830339">:=</span>&nbsp;<span class="keyword" id="4830342">range</span>&nbsp;<span class="ident" id="4830348">list</span>&nbsp;<span class="op" id="4830353">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4830357">if</span>&nbsp;<span class="ident" id="4830360">strings</span><span class="op" id="4830367">.</span><span class="ident" id="4830368">HasSuffix</span><span class="op" id="4830377">(</span><span class="ident" id="4830378">d</span><span class="op" id="4830379">.</span><span class="ident" id="4830380">Name</span><span class="op" id="4830384">(</span><span class="op" id="4830385">)</span><span class="op" id="4830386">,</span>&nbsp;<span class="string" id="4830388">&#34;.go&#34;</span><span class="op" id="4830393">)</span>&nbsp;<span class="op" id="4830395">&amp;&amp;</span>&nbsp;<span class="op" id="4830398">(</span><span class="ident" id="4830399">filter</span>&nbsp;<span class="op" id="4830406">==</span>&nbsp;<span class="builtintype" id="4830409">nil</span>&nbsp;<span class="op" id="4830413">||</span>&nbsp;<span class="ident" id="4830416">filter</span><span class="op" id="4830422">(</span><span class="ident" id="4830423">d</span><span class="op" id="4830424">)</span><span class="op" id="4830425">)</span>&nbsp;<span class="op" id="4830427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4830432">filename</span>&nbsp;<span class="op" id="4830441">:=</span>&nbsp;<span class="ident" id="4830444">filepath</span><span class="op" id="4830452">.</span><span class="ident" id="4830453">Join</span><span class="op" id="4830457">(</span><span class="ident" id="4830458">path</span><span class="op" id="4830462">,</span>&nbsp;<span class="ident" id="4830464">d</span><span class="op" id="4830465">.</span><span class="ident" id="4830466">Name</span><span class="op" id="4830470">(</span><span class="op" id="4830471">)</span><span class="op" id="4830472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4830477">if</span>&nbsp;<span class="ident" id="4830480">src</span><span class="op" id="4830483">,</span>&nbsp;<span class="ident" id="4830485">err</span>&nbsp;<span class="op" id="4830489">:=</span>&nbsp;<span class="ident" id="4830492">ParseFile</span><span class="op" id="4830501">(</span><span class="ident" id="4830502">fset</span><span class="op" id="4830506">,</span>&nbsp;<span class="ident" id="4830508">filename</span><span class="op" id="4830516">,</span>&nbsp;<span class="builtintype" id="4830518">nil</span><span class="op" id="4830521">,</span>&nbsp;<span class="ident" id="4830523">mode</span><span class="op" id="4830527">)</span><span class="op" id="4830528">;</span>&nbsp;<span class="ident" id="4830530">err</span>&nbsp;<span class="op" id="4830534">==</span>&nbsp;<span class="builtintype" id="4830537">nil</span>&nbsp;<span class="op" id="4830541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4830547">name</span>&nbsp;<span class="op" id="4830552">:=</span>&nbsp;<span class="ident" id="4830555">src</span><span class="op" id="4830558">.</span><span class="ident" id="4830559">Name</span><span class="op" id="4830563">.</span><span class="ident" id="4830564">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4830573">pkg</span><span class="op" id="4830576">,</span>&nbsp;<span class="ident" id="4830578">found</span>&nbsp;<span class="op" id="4830584">:=</span>&nbsp;<span class="ident" id="4830587">pkgs</span><span class="op" id="4830591">[</span><span class="ident" id="4830592">name</span><span class="op" id="4830596">]</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4830602">if</span>&nbsp;<span class="op" id="4830605">!</span><span class="ident" id="4830606">found</span>&nbsp;<span class="op" id="4830612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4830619">pkg</span>&nbsp;<span class="op" id="4830623">=</span>&nbsp;<span class="op" id="4830625">&amp;</span><span class="ident" id="4830626">ast</span><span class="op" id="4830629">.</span><span class="ident" id="4830630">Package</span><span class="op" id="4830637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4830645">Name</span><span class="op" id="4830649">:</span>&nbsp;&nbsp;<span class="ident" id="4830652">name</span><span class="op" id="4830656">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4830664">Files</span><span class="op" id="4830669">:</span>&nbsp;<span class="builtinfunc" id="4830671">make</span><span class="op" id="4830675">(</span><span class="keyword" id="4830676">map</span><span class="op" id="4830679">[</span><span class="builtintype" id="4830680">string</span><span class="op" id="4830686">]</span><span class="op" id="4830687">*</span><span class="ident" id="4830688">ast</span><span class="op" id="4830691">.</span><span class="ident" id="4830692">File</span><span class="op" id="4830696">)</span><span class="op" id="4830697">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4830704">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4830711">pkgs</span><span class="op" id="4830715">[</span><span class="ident" id="4830716">name</span><span class="op" id="4830720">]</span>&nbsp;<span class="op" id="4830722">=</span>&nbsp;<span class="ident" id="4830724">pkg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4830732">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4830738">pkg</span><span class="op" id="4830741">.</span><span class="ident" id="4830742">Files</span><span class="op" id="4830747">[</span><span class="ident" id="4830748">filename</span><span class="op" id="4830756">]</span>&nbsp;<span class="op" id="4830758">=</span>&nbsp;<span class="ident" id="4830760">src</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4830767">}</span>&nbsp;<span class="keyword" id="4830769">else</span>&nbsp;<span class="keyword" id="4830774">if</span>&nbsp;<span class="ident" id="4830777">first</span>&nbsp;<span class="op" id="4830783">==</span>&nbsp;<span class="builtintype" id="4830786">nil</span>&nbsp;<span class="op" id="4830790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4830796">first</span>&nbsp;<span class="op" id="4830802">=</span>&nbsp;<span class="ident" id="4830804">err</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4830811">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4830815">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4830818">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4830822">return</span><br>
<span class="lineno">165</span><span class="op" id="4830829">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4830832">//&nbsp;ParseExpr&nbsp;is&nbsp;a&nbsp;convenience&nbsp;function&nbsp;for&nbsp;obtaining&nbsp;the&nbsp;AST&nbsp;of&nbsp;an&nbsp;expression&nbsp;x.</span><br>
<span class="lineno"></span><span class="comment" id="4830913">//&nbsp;The&nbsp;position&nbsp;information&nbsp;recorded&nbsp;in&nbsp;the&nbsp;AST&nbsp;is&nbsp;undefined.&nbsp;The&nbsp;filename&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="4830993">//&nbsp;in&nbsp;error&nbsp;messages&nbsp;is&nbsp;the&nbsp;empty&nbsp;string.</span><br>
<span class="lineno">170</span><span class="comment" id="4831035">//</span><br>
<span class="lineno"></span><span class="keyword" id="4831038">func</span>&nbsp;<span class="ident" id="4831043">ParseExpr</span><span class="op" id="4831052">(</span><span class="ident" id="4831053">x</span>&nbsp;<span class="builtintype" id="4831055">string</span><span class="op" id="4831061">)</span>&nbsp;<span class="op" id="4831063">(</span><span class="ident" id="4831064">ast</span><span class="op" id="4831067">.</span><span class="ident" id="4831068">Expr</span><span class="op" id="4831072">,</span>&nbsp;<span class="builtintype" id="4831074">error</span><span class="op" id="4831079">)</span>&nbsp;<span class="op" id="4831081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4831084">var</span>&nbsp;<span class="ident" id="4831088">p</span>&nbsp;<span class="ident" id="4831090">parser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4831098">p</span><span class="op" id="4831099">.</span><span class="ident" id="4831100">init</span><span class="op" id="4831104">(</span><span class="ident" id="4831105">token</span><span class="op" id="4831110">.</span><span class="ident" id="4831111">NewFileSet</span><span class="op" id="4831121">(</span><span class="op" id="4831122">)</span><span class="op" id="4831123">,</span>&nbsp;<span class="string" id="4831125">&#34;&#34;</span><span class="op" id="4831127">,</span>&nbsp;<span class="op" id="4831129">[</span><span class="op" id="4831130">]</span><span class="builtintype" id="4831131">byte</span><span class="op" id="4831135">(</span><span class="ident" id="4831136">x</span><span class="op" id="4831137">)</span><span class="op" id="4831138">,</span>&nbsp;<span class="num" id="4831140">0</span><span class="op" id="4831141">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4831145">//&nbsp;Set&nbsp;up&nbsp;pkg-level&nbsp;scopes&nbsp;to&nbsp;avoid&nbsp;nil-pointer&nbsp;errors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4831202">//&nbsp;This&nbsp;is&nbsp;not&nbsp;needed&nbsp;for&nbsp;a&nbsp;correct&nbsp;expression&nbsp;x&nbsp;as&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4831259">//&nbsp;parser&nbsp;will&nbsp;be&nbsp;ok&nbsp;with&nbsp;a&nbsp;nil&nbsp;topScope,&nbsp;but&nbsp;be&nbsp;cautious</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4831318">//&nbsp;in&nbsp;case&nbsp;of&nbsp;an&nbsp;erroneous&nbsp;x.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4831349">p</span><span class="op" id="4831350">.</span><span class="ident" id="4831351">openScope</span><span class="op" id="4831360">(</span><span class="op" id="4831361">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4831364">p</span><span class="op" id="4831365">.</span><span class="ident" id="4831366">pkgScope</span>&nbsp;<span class="op" id="4831375">=</span>&nbsp;<span class="ident" id="4831377">p</span><span class="op" id="4831378">.</span><span class="ident" id="4831379">topScope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4831389">e</span>&nbsp;<span class="op" id="4831391">:=</span>&nbsp;<span class="ident" id="4831394">p</span><span class="op" id="4831395">.</span><span class="ident" id="4831396">parseRhsOrType</span><span class="op" id="4831410">(</span><span class="op" id="4831411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4831414">p</span><span class="op" id="4831415">.</span><span class="ident" id="4831416">closeScope</span><span class="op" id="4831426">(</span><span class="op" id="4831427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4831430">assert</span><span class="op" id="4831436">(</span><span class="ident" id="4831437">p</span><span class="op" id="4831438">.</span><span class="ident" id="4831439">topScope</span>&nbsp;<span class="op" id="4831448">==</span>&nbsp;<span class="builtintype" id="4831451">nil</span><span class="op" id="4831454">,</span>&nbsp;<span class="string" id="4831456">&#34;unbalanced&nbsp;scopes&#34;</span><span class="op" id="4831475">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4831479">//&nbsp;If&nbsp;a&nbsp;semicolon&nbsp;was&nbsp;inserted,&nbsp;consume&nbsp;it;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4831524">//&nbsp;report&nbsp;an&nbsp;error&nbsp;if&nbsp;there&#39;s&nbsp;more&nbsp;tokens.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4831568">if</span>&nbsp;<span class="ident" id="4831571">p</span><span class="op" id="4831572">.</span><span class="ident" id="4831573">tok</span>&nbsp;<span class="op" id="4831577">==</span>&nbsp;<span class="ident" id="4831580">token</span><span class="op" id="4831585">.</span><span class="ident" id="4831586">SEMICOLON</span>&nbsp;<span class="op" id="4831596">&amp;&amp;</span>&nbsp;<span class="ident" id="4831599">p</span><span class="op" id="4831600">.</span><span class="ident" id="4831601">lit</span>&nbsp;<span class="op" id="4831605">==</span>&nbsp;<span class="string" id="4831608">&#34;\n&#34;</span>&nbsp;<span class="op" id="4831613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4831617">p</span><span class="op" id="4831618">.</span><span class="ident" id="4831619">next</span><span class="op" id="4831623">(</span><span class="op" id="4831624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4831627">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4831630">p</span><span class="op" id="4831631">.</span><span class="ident" id="4831632">expect</span><span class="op" id="4831638">(</span><span class="ident" id="4831639">token</span><span class="op" id="4831644">.</span><span class="ident" id="4831645">EOF</span><span class="op" id="4831648">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4831652">if</span>&nbsp;<span class="ident" id="4831655">p</span><span class="op" id="4831656">.</span><span class="ident" id="4831657">errors</span><span class="op" id="4831663">.</span><span class="ident" id="4831664">Len</span><span class="op" id="4831667">(</span><span class="op" id="4831668">)</span>&nbsp;<span class="op" id="4831670">&gt;</span>&nbsp;<span class="num" id="4831672">0</span>&nbsp;<span class="op" id="4831674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4831678">p</span><span class="op" id="4831679">.</span><span class="ident" id="4831680">errors</span><span class="op" id="4831686">.</span><span class="ident" id="4831687">Sort</span><span class="op" id="4831691">(</span><span class="op" id="4831692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4831696">return</span>&nbsp;<span class="builtintype" id="4831703">nil</span><span class="op" id="4831706">,</span>&nbsp;<span class="ident" id="4831708">p</span><span class="op" id="4831709">.</span><span class="ident" id="4831710">errors</span><span class="op" id="4831716">.</span><span class="ident" id="4831717">Err</span><span class="op" id="4831720">(</span><span class="op" id="4831721">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4831724">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4831728">return</span>&nbsp;<span class="ident" id="4831735">e</span><span class="op" id="4831736">,</span>&nbsp;<span class="builtintype" id="4831738">nil</span><br>
<span class="lineno"></span><span class="op" id="4831742">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
