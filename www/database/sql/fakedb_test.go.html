<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="7896003">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7896058">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7896112">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7896163">package</span>&nbsp;<span class="ident" id="7896171">sql</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7896176">import</span>&nbsp;<span class="op" id="7896183">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7896186">&#34;database/sql/driver&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7896209">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7896219">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7896226">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7896232">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7896239">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7896247">&#34;strconv&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7896258">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7896269">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7896277">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7896288">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7896295">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="7896298">var</span>&nbsp;<span class="ident" id="7896302">_</span>&nbsp;<span class="op" id="7896304">=</span>&nbsp;<span class="ident" id="7896306"><a href="/database/sql/fakedb_test.go.html#7896232">log</a></span><span class="op" id="7896309">.</span><span class="ident" id="7896310">Printf</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7896318">//&nbsp;fakeDriver&nbsp;is&nbsp;a&nbsp;fake&nbsp;database&nbsp;that&nbsp;implements&nbsp;Go&#39;s&nbsp;driver.Driver</span><br>
<span class="lineno"></span><span class="comment" id="7896386">//&nbsp;interface,&nbsp;just&nbsp;for&nbsp;testing.</span><br>
<span class="lineno">25</span><span class="comment" id="7896418">//</span><br>
<span class="lineno"></span><span class="comment" id="7896421">//&nbsp;It&nbsp;speaks&nbsp;a&nbsp;query&nbsp;language&nbsp;that&#39;s&nbsp;semantically&nbsp;similar&nbsp;to&nbsp;but</span><br>
<span class="lineno"></span><span class="comment" id="7896486">//&nbsp;syntactically&nbsp;different&nbsp;and&nbsp;simpler&nbsp;than&nbsp;SQL.&nbsp;&nbsp;The&nbsp;syntax&nbsp;is&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="7896553">//&nbsp;follows:</span><br>
<span class="lineno"></span><span class="comment" id="7896565">//</span><br>
<span class="lineno">30</span><span class="comment" id="7896568">//&nbsp;&nbsp;&nbsp;WIPE</span><br>
<span class="lineno"></span><span class="comment" id="7896578">//&nbsp;&nbsp;&nbsp;CREATE|&lt;tablename&gt;|&lt;col&gt;=&lt;type&gt;,&lt;col&gt;=&lt;type&gt;,...</span><br>
<span class="lineno"></span><span class="comment" id="7896632">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;where&nbsp;types&nbsp;are:&nbsp;&#34;string&#34;,&nbsp;[u]int{8,16,32,64},&nbsp;&#34;bool&#34;</span><br>
<span class="lineno"></span><span class="comment" id="7896693">//&nbsp;&nbsp;&nbsp;INSERT|&lt;tablename&gt;|col=val,col2=val2,col3=?</span><br>
<span class="lineno"></span><span class="comment" id="7896742">//&nbsp;&nbsp;&nbsp;SELECT|&lt;tablename&gt;|projectcol1,projectcol2|filtercol=?,filtercol2=?</span><br>
<span class="lineno">35</span><span class="comment" id="7896815">//</span><br>
<span class="lineno"></span><span class="comment" id="7896818">//&nbsp;When&nbsp;opening&nbsp;a&nbsp;fakeDriver&#39;s&nbsp;database,&nbsp;it&nbsp;starts&nbsp;empty&nbsp;with&nbsp;no</span><br>
<span class="lineno"></span><span class="comment" id="7896883">//&nbsp;tables.&nbsp;&nbsp;All&nbsp;tables&nbsp;and&nbsp;data&nbsp;are&nbsp;stored&nbsp;in&nbsp;memory&nbsp;only.</span><br>
<span class="lineno"></span><span class="keyword" id="7896942">type</span>&nbsp;<span class="ident" id="7896947">fakeDriver</span>&nbsp;<span class="keyword" id="7896958">struct</span>&nbsp;<span class="op" id="7896965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7896968">mu</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7896979"><a href="/database/sql/fakedb_test.go.html#7896269">sync</a></span><span class="op" id="7896983">.</span><span class="ident" id="7896984">Mutex</span>&nbsp;<span class="comment" id="7896990">//&nbsp;guards&nbsp;3&nbsp;following&nbsp;fields</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7897020">openCount</span>&nbsp;&nbsp;<span class="builtintype" id="7897031">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7897042">//&nbsp;conn&nbsp;opens</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7897057">closeCount</span>&nbsp;<span class="builtintype" id="7897068">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7897079">//&nbsp;conn&nbsp;closes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7897095">waitCh</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7897106">chan</span>&nbsp;<span class="keyword" id="7897111">struct</span><span class="op" id="7897117">{</span><span class="op" id="7897118">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7897121">waitingCh</span>&nbsp;&nbsp;<span class="keyword" id="7897132">chan</span>&nbsp;<span class="keyword" id="7897137">struct</span><span class="op" id="7897143">{</span><span class="op" id="7897144">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7897147">dbs</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7897158">map</span><span class="op" id="7897161">[</span><span class="builtintype" id="7897162">string</span><span class="op" id="7897168">]</span><span class="op" id="7897169">*</span><span class="ident" id="7897170"><a href="/database/sql/fakedb_test.go.html#7897185">fakeDB</a></span><br>
<span class="lineno">45</span><span class="op" id="7897177">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7897180">type</span>&nbsp;<span class="ident" id="7897185">fakeDB</span>&nbsp;<span class="keyword" id="7897192">struct</span>&nbsp;<span class="op" id="7897199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7897202">name</span>&nbsp;<span class="builtintype" id="7897207">string</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7897216">mu</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7897224"><a href="/database/sql/fakedb_test.go.html#7896269">sync</a></span><span class="op" id="7897228">.</span><span class="ident" id="7897229">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7897236">free</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7897244">[</span><span class="op" id="7897245">]</span><span class="op" id="7897246">*</span><span class="ident" id="7897247"><a href="/database/sql/fakedb_test.go.html#7897753">fakeConn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7897257">tables</span>&nbsp;&nbsp;<span class="keyword" id="7897265">map</span><span class="op" id="7897268">[</span><span class="builtintype" id="7897269">string</span><span class="op" id="7897275">]</span><span class="op" id="7897276">*</span><span class="ident" id="7897277"><a href="/database/sql/fakedb_test.go.html#7897305">table</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7897284">badConn</span>&nbsp;<span class="builtintype" id="7897292">bool</span><br>
<span class="lineno"></span><span class="op" id="7897297">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="keyword" id="7897300">type</span>&nbsp;<span class="ident" id="7897305">table</span>&nbsp;<span class="keyword" id="7897311">struct</span>&nbsp;<span class="op" id="7897318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7897321">mu</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7897329"><a href="/database/sql/fakedb_test.go.html#7896269">sync</a></span><span class="op" id="7897333">.</span><span class="ident" id="7897334">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7897341">colname</span>&nbsp;<span class="op" id="7897349">[</span><span class="op" id="7897350">]</span><span class="builtintype" id="7897351">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7897359">coltype</span>&nbsp;<span class="op" id="7897367">[</span><span class="op" id="7897368">]</span><span class="builtintype" id="7897369">string</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7897377">rows</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7897385">[</span><span class="op" id="7897386">]</span><span class="op" id="7897387">*</span><span class="ident" id="7897388"><a href="/database/sql/fakedb_test.go.html#7897536">row</a></span><br>
<span class="lineno"></span><span class="op" id="7897392">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7897395">func</span>&nbsp;<span class="op" id="7897400">(</span><span class="ident" id="7897401">t</span>&nbsp;<span class="op" id="7897403">*</span><span class="ident" id="7897404"><a href="/database/sql/fakedb_test.go.html#7897305">table</a></span><span class="op" id="7897409">)</span>&nbsp;<span class="ident" id="7897411">columnIndex</span><span class="op" id="7897422">(</span><span class="ident" id="7897423">name</span>&nbsp;<span class="builtintype" id="7897428">string</span><span class="op" id="7897434">)</span>&nbsp;<span class="builtintype" id="7897436">int</span>&nbsp;<span class="op" id="7897440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7897443">for</span>&nbsp;<span class="ident" id="7897447">n</span><span class="op" id="7897448">,</span>&nbsp;<span class="ident" id="7897450">nname</span>&nbsp;<span class="op" id="7897456">:=</span>&nbsp;<span class="keyword" id="7897459">range</span>&nbsp;<span class="ident" id="7897465"><a href="/database/sql/fakedb_test.go.html#7897401">t</a></span><span class="op" id="7897466">.</span><span class="ident" id="7897467">colname</span>&nbsp;<span class="op" id="7897475">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7897479">if</span>&nbsp;<span class="ident" id="7897482"><a href="/database/sql/fakedb_test.go.html#7897423">name</a></span>&nbsp;<span class="op" id="7897487">==</span>&nbsp;<span class="ident" id="7897490"><a href="/database/sql/fakedb_test.go.html#7897450">nname</a></span>&nbsp;<span class="op" id="7897496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7897501">return</span>&nbsp;<span class="ident" id="7897508"><a href="/database/sql/fakedb_test.go.html#7897447">n</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7897512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7897515">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7897518">return</span>&nbsp;<span class="op" id="7897525">-</span><span class="num" id="7897526">1</span><br>
<span class="lineno">70</span><span class="op" id="7897528">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7897531">type</span>&nbsp;<span class="ident" id="7897536">row</span>&nbsp;<span class="keyword" id="7897540">struct</span>&nbsp;<span class="op" id="7897547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7897550">cols</span>&nbsp;<span class="op" id="7897555">[</span><span class="op" id="7897556">]</span><span class="keyword" id="7897557">interface</span><span class="op" id="7897566">{</span><span class="op" id="7897567">}</span>&nbsp;<span class="comment" id="7897569">//&nbsp;must&nbsp;be&nbsp;same&nbsp;size&nbsp;as&nbsp;its&nbsp;table&nbsp;colname&nbsp;+&nbsp;coltype</span><br>
<span class="lineno"></span><span class="op" id="7897621">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="keyword" id="7897624">func</span>&nbsp;<span class="op" id="7897629">(</span><span class="ident" id="7897630">r</span>&nbsp;<span class="op" id="7897632">*</span><span class="ident" id="7897633"><a href="/database/sql/fakedb_test.go.html#7897536">row</a></span><span class="op" id="7897636">)</span>&nbsp;<span class="ident" id="7897638">clone</span><span class="op" id="7897643">(</span><span class="op" id="7897644">)</span>&nbsp;<span class="op" id="7897646">*</span><span class="ident" id="7897647"><a href="/database/sql/fakedb_test.go.html#7897536">row</a></span>&nbsp;<span class="op" id="7897651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7897654">nrow</span>&nbsp;<span class="op" id="7897659">:=</span>&nbsp;<span class="op" id="7897662">&amp;</span><span class="ident" id="7897663"><a href="/database/sql/fakedb_test.go.html#7897536">row</a></span><span class="op" id="7897666">{</span><span class="ident" id="7897667">cols</span><span class="op" id="7897671">:</span>&nbsp;<span class="builtinfunc" id="7897673">make</span><span class="op" id="7897677">(</span><span class="op" id="7897678">[</span><span class="op" id="7897679">]</span><span class="keyword" id="7897680">interface</span><span class="op" id="7897689">{</span><span class="op" id="7897690">}</span><span class="op" id="7897691">,</span>&nbsp;<span class="builtinfunc" id="7897693">len</span><span class="op" id="7897696">(</span><span class="ident" id="7897697"><a href="/database/sql/fakedb_test.go.html#7897630">r</a></span><span class="op" id="7897698">.</span><span class="ident" id="7897699">cols</span><span class="op" id="7897703">)</span><span class="op" id="7897704">)</span><span class="op" id="7897705">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7897708">copy</span><span class="op" id="7897712">(</span><span class="ident" id="7897713"><a href="/database/sql/fakedb_test.go.html#7897654">nrow</a></span><span class="op" id="7897717">.</span><span class="ident" id="7897718">cols</span><span class="op" id="7897722">,</span>&nbsp;<span class="ident" id="7897724"><a href="/database/sql/fakedb_test.go.html#7897630">r</a></span><span class="op" id="7897725">.</span><span class="ident" id="7897726">cols</span><span class="op" id="7897730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7897733">return</span>&nbsp;<span class="ident" id="7897740"><a href="/database/sql/fakedb_test.go.html#7897654">nrow</a></span><br>
<span class="lineno">80</span><span class="op" id="7897745">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7897748">type</span>&nbsp;<span class="ident" id="7897753">fakeConn</span>&nbsp;<span class="keyword" id="7897762">struct</span>&nbsp;<span class="op" id="7897769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7897772">db</span>&nbsp;<span class="op" id="7897775">*</span><span class="ident" id="7897776"><a href="/database/sql/fakedb_test.go.html#7897185">fakeDB</a></span>&nbsp;<span class="comment" id="7897783">//&nbsp;where&nbsp;to&nbsp;return&nbsp;ourselves&nbsp;to</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7897817">currTx</span>&nbsp;<span class="op" id="7897824">*</span><span class="ident" id="7897825"><a href="/database/sql/fakedb_test.go.html#7898030">fakeTx</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7897834">//&nbsp;Stats&nbsp;for&nbsp;tests:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7897855">mu</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7897867"><a href="/database/sql/fakedb_test.go.html#7896269">sync</a></span><span class="op" id="7897871">.</span><span class="ident" id="7897872">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7897879">stmtsMade</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7897891">int</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7897896">stmtsClosed</span>&nbsp;<span class="builtintype" id="7897908">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7897913">numPrepare</span>&nbsp;&nbsp;<span class="builtintype" id="7897925">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7897930">bad</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7897942">bool</span><br>
<span class="lineno"></span><span class="op" id="7897947">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="7897950">func</span>&nbsp;<span class="op" id="7897955">(</span><span class="ident" id="7897956">c</span>&nbsp;<span class="op" id="7897958">*</span><span class="ident" id="7897959"><a href="/database/sql/fakedb_test.go.html#7897753">fakeConn</a></span><span class="op" id="7897967">)</span>&nbsp;<span class="ident" id="7897969">incrStat</span><span class="op" id="7897977">(</span><span class="ident" id="7897978">v</span>&nbsp;<span class="op" id="7897980">*</span><span class="builtintype" id="7897981">int</span><span class="op" id="7897984">)</span>&nbsp;<span class="op" id="7897986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7897989"><a href="/database/sql/fakedb_test.go.html#7897956">c</a></span><span class="op" id="7897990">.</span><span class="ident" id="7897991">mu</span><span class="op" id="7897993">.</span><span class="ident" id="7897994">Lock</span><span class="op" id="7897998">(</span><span class="op" id="7897999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7898002">*</span><span class="ident" id="7898003"><a href="/database/sql/fakedb_test.go.html#7897978">v</a></span><span class="op" id="7898004">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7898008"><a href="/database/sql/fakedb_test.go.html#7897956">c</a></span><span class="op" id="7898009">.</span><span class="ident" id="7898010">mu</span><span class="op" id="7898012">.</span><span class="ident" id="7898013">Unlock</span><span class="op" id="7898019">(</span><span class="op" id="7898020">)</span><br>
<span class="lineno"></span><span class="op" id="7898022">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="keyword" id="7898025">type</span>&nbsp;<span class="ident" id="7898030">fakeTx</span>&nbsp;<span class="keyword" id="7898037">struct</span>&nbsp;<span class="op" id="7898044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7898047">c</span>&nbsp;<span class="op" id="7898049">*</span><span class="ident" id="7898050"><a href="/database/sql/fakedb_test.go.html#7897753">fakeConn</a></span><br>
<span class="lineno"></span><span class="op" id="7898059">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="keyword" id="7898062">type</span>&nbsp;<span class="ident" id="7898067">fakeStmt</span>&nbsp;<span class="keyword" id="7898076">struct</span>&nbsp;<span class="op" id="7898083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7898086">c</span>&nbsp;<span class="op" id="7898088">*</span><span class="ident" id="7898089"><a href="/database/sql/fakedb_test.go.html#7897753">fakeConn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7898099">q</span>&nbsp;<span class="builtintype" id="7898101">string</span>&nbsp;<span class="comment" id="7898108">//&nbsp;just&nbsp;for&nbsp;debugging</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7898132">cmd</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7898138">string</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7898146">table</span>&nbsp;<span class="builtintype" id="7898152">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7898161">closed</span>&nbsp;<span class="builtintype" id="7898168">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7898175">colName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7898188">[</span><span class="op" id="7898189">]</span><span class="builtintype" id="7898190">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7898202">//&nbsp;used&nbsp;by&nbsp;CREATE,&nbsp;INSERT,&nbsp;SELECT&nbsp;(selected&nbsp;columns)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7898256">colType</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7898269">[</span><span class="op" id="7898270">]</span><span class="builtintype" id="7898271">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7898283">//&nbsp;used&nbsp;by&nbsp;CREATE</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7898302">colValue</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7898315">[</span><span class="op" id="7898316">]</span><span class="keyword" id="7898317">interface</span><span class="op" id="7898326">{</span><span class="op" id="7898327">}</span>&nbsp;<span class="comment" id="7898329">//&nbsp;used&nbsp;by&nbsp;INSERT&nbsp;(mix&nbsp;of&nbsp;strings&nbsp;and&nbsp;&#34;?&#34;&nbsp;for&nbsp;bound&nbsp;params)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7898390">placeholders</span>&nbsp;<span class="builtintype" id="7898403">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7898417">//&nbsp;used&nbsp;by&nbsp;INSERT/SELECT:&nbsp;number&nbsp;of&nbsp;?&nbsp;params</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7898464">whereCol</span>&nbsp;<span class="op" id="7898473">[</span><span class="op" id="7898474">]</span><span class="builtintype" id="7898475">string</span>&nbsp;<span class="comment" id="7898482">//&nbsp;used&nbsp;by&nbsp;SELECT&nbsp;(all&nbsp;placeholders)</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7898521">placeholderConverter</span>&nbsp;<span class="op" id="7898542">[</span><span class="op" id="7898543">]</span><span class="ident" id="7898544"><a href="/database/sql/fakedb_test.go.html#7896186">driver</a></span><span class="op" id="7898550">.</span><span class="ident" id="7898551">ValueConverter</span>&nbsp;<span class="comment" id="7898566">//&nbsp;used&nbsp;by&nbsp;INSERT</span><br>
<span class="lineno"></span><span class="op" id="7898584">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7898587">var</span>&nbsp;<span class="ident" id="7898591">fdriver</span>&nbsp;<span class="ident" id="7898599"><a href="/database/sql/fakedb_test.go.html#7896186">driver</a></span><span class="op" id="7898605">.</span><span class="ident" id="7898606">Driver</span>&nbsp;<span class="op" id="7898613">=</span>&nbsp;<span class="op" id="7898615">&amp;</span><span class="ident" id="7898616"><a href="/database/sql/fakedb_test.go.html#7896947">fakeDriver</a></span><span class="op" id="7898626">{</span><span class="op" id="7898627">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="keyword" id="7898630">func</span>&nbsp;<span class="ident" id="7898635">init</span><span class="op" id="7898639">(</span><span class="op" id="7898640">)</span>&nbsp;<span class="op" id="7898642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7898645"><a href="/database/sql/sql.go.html#5743491">Register</a></span><span class="op" id="7898653">(</span><span class="string" id="7898654">&#34;test&#34;</span><span class="op" id="7898660">,</span>&nbsp;<span class="ident" id="7898662"><a href="/database/sql/fakedb_test.go.html#7898591">fdriver</a></span><span class="op" id="7898669">)</span><br>
<span class="lineno"></span><span class="op" id="7898671">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="7898674">func</span>&nbsp;<span class="ident" id="7898679">contains</span><span class="op" id="7898687">(</span><span class="ident" id="7898688">list</span>&nbsp;<span class="op" id="7898693">[</span><span class="op" id="7898694">]</span><span class="builtintype" id="7898695">string</span><span class="op" id="7898701">,</span>&nbsp;<span class="ident" id="7898703">y</span>&nbsp;<span class="builtintype" id="7898705">string</span><span class="op" id="7898711">)</span>&nbsp;<span class="builtintype" id="7898713">bool</span>&nbsp;<span class="op" id="7898718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7898721">for</span>&nbsp;<span class="ident" id="7898725">_</span><span class="op" id="7898726">,</span>&nbsp;<span class="ident" id="7898728">x</span>&nbsp;<span class="op" id="7898730">:=</span>&nbsp;<span class="keyword" id="7898733">range</span>&nbsp;<span class="ident" id="7898739"><a href="/database/sql/fakedb_test.go.html#7898688">list</a></span>&nbsp;<span class="op" id="7898744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7898748">if</span>&nbsp;<span class="ident" id="7898751"><a href="/database/sql/fakedb_test.go.html#7898728">x</a></span>&nbsp;<span class="op" id="7898753">==</span>&nbsp;<span class="ident" id="7898756"><a href="/database/sql/fakedb_test.go.html#7898703">y</a></span>&nbsp;<span class="op" id="7898758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7898763">return</span>&nbsp;<span class="ident" id="7898770">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7898777">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7898780">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7898783">return</span>&nbsp;<span class="ident" id="7898790">false</span><br>
<span class="lineno"></span><span class="op" id="7898796">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7898799">type</span>&nbsp;<span class="ident" id="7898804">Dummy</span>&nbsp;<span class="keyword" id="7898810">struct</span>&nbsp;<span class="op" id="7898817">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7898820"><a href="/database/sql/fakedb_test.go.html#7896186">driver</a></span><span class="op" id="7898826">.</span><span class="ident" id="7898827">Driver</span><br>
<span class="lineno"></span><span class="op" id="7898834">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7898837">func</span>&nbsp;<span class="ident" id="7898842">TestDrivers</span><span class="op" id="7898853">(</span><span class="ident" id="7898854">t</span>&nbsp;<span class="op" id="7898856">*</span><span class="ident" id="7898857"><a href="/database/sql/fakedb_test.go.html#7896277">testing</a></span><span class="op" id="7898864">.</span><span class="ident" id="7898865">T</span><span class="op" id="7898866">)</span>&nbsp;<span class="op" id="7898868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7898871"><a href="/database/sql/sql.go.html#5743726">unregisterAllDrivers</a></span><span class="op" id="7898891">(</span><span class="op" id="7898892">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7898895"><a href="/database/sql/sql.go.html#5743491">Register</a></span><span class="op" id="7898903">(</span><span class="string" id="7898904">&#34;test&#34;</span><span class="op" id="7898910">,</span>&nbsp;<span class="ident" id="7898912"><a href="/database/sql/fakedb_test.go.html#7898591">fdriver</a></span><span class="op" id="7898919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7898922"><a href="/database/sql/sql.go.html#5743491">Register</a></span><span class="op" id="7898930">(</span><span class="string" id="7898931">&#34;invalid&#34;</span><span class="op" id="7898940">,</span>&nbsp;<span class="ident" id="7898942"><a href="/database/sql/fakedb_test.go.html#7898804">Dummy</a></span><span class="op" id="7898947">{</span><span class="op" id="7898948">}</span><span class="op" id="7898949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7898952">all</span>&nbsp;<span class="op" id="7898956">:=</span>&nbsp;<span class="ident" id="7898959"><a href="/database/sql/sql.go.html#5743889">Drivers</a></span><span class="op" id="7898966">(</span><span class="op" id="7898967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7898970">if</span>&nbsp;<span class="builtinfunc" id="7898973">len</span><span class="op" id="7898976">(</span><span class="ident" id="7898977"><a href="/database/sql/fakedb_test.go.html#7898952">all</a></span><span class="op" id="7898980">)</span>&nbsp;<span class="op" id="7898982">&lt;</span>&nbsp;<span class="num" id="7898984">2</span>&nbsp;<span class="op" id="7898986">||</span>&nbsp;<span class="op" id="7898989">!</span><span class="ident" id="7898990"><a href="/database/sql/fakedb_test.go.html#7896239">sort</a></span><span class="op" id="7898994">.</span><span class="ident" id="7898995">StringsAreSorted</span><span class="op" id="7899011">(</span><span class="ident" id="7899012"><a href="/database/sql/fakedb_test.go.html#7898952">all</a></span><span class="op" id="7899015">)</span>&nbsp;<span class="op" id="7899017">||</span>&nbsp;<span class="op" id="7899020">!</span><span class="ident" id="7899021"><a href="/database/sql/fakedb_test.go.html#7898679">contains</a></span><span class="op" id="7899029">(</span><span class="ident" id="7899030"><a href="/database/sql/fakedb_test.go.html#7898952">all</a></span><span class="op" id="7899033">,</span>&nbsp;<span class="string" id="7899035">&#34;test&#34;</span><span class="op" id="7899041">)</span>&nbsp;<span class="op" id="7899043">||</span>&nbsp;<span class="op" id="7899046">!</span><span class="ident" id="7899047"><a href="/database/sql/fakedb_test.go.html#7898679">contains</a></span><span class="op" id="7899055">(</span><span class="ident" id="7899056"><a href="/database/sql/fakedb_test.go.html#7898952">all</a></span><span class="op" id="7899059">,</span>&nbsp;<span class="string" id="7899061">&#34;invalid&#34;</span><span class="op" id="7899070">)</span>&nbsp;<span class="op" id="7899072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7899076"><a href="/database/sql/fakedb_test.go.html#7898854">t</a></span><span class="op" id="7899077">.</span><span class="ident" id="7899078">Fatalf</span><span class="op" id="7899084">(</span><span class="string" id="7899085">&#34;Drivers&nbsp;=&nbsp;%v,&nbsp;want&nbsp;sorted&nbsp;list&nbsp;with&nbsp;at&nbsp;least&nbsp;[invalid,&nbsp;test]&#34;</span><span class="op" id="7899147">,</span>&nbsp;<span class="ident" id="7899149"><a href="/database/sql/fakedb_test.go.html#7898952">all</a></span><span class="op" id="7899152">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7899155">}</span><br>
<span class="lineno"></span><span class="op" id="7899157">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7899160">//&nbsp;Supports&nbsp;dsn&nbsp;forms:</span><br>
<span class="lineno"></span><span class="comment" id="7899183">//&nbsp;&nbsp;&nbsp;&nbsp;&lt;dbname&gt;</span><br>
<span class="lineno">155</span><span class="comment" id="7899198">//&nbsp;&nbsp;&nbsp;&nbsp;&lt;dbname&gt;;&lt;opts&gt;&nbsp;&nbsp;(only&nbsp;currently&nbsp;supported&nbsp;option&nbsp;is&nbsp;`badConn`,</span><br>
<span class="lineno"></span><span class="comment" id="7899268">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;which&nbsp;causes&nbsp;driver.ErrBadConn&nbsp;to&nbsp;be&nbsp;returned&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="7899341">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;every&nbsp;other&nbsp;conn.Begin())</span><br>
<span class="lineno"></span><span class="keyword" id="7899391">func</span>&nbsp;<span class="op" id="7899396">(</span><span class="ident" id="7899397">d</span>&nbsp;<span class="op" id="7899399">*</span><span class="ident" id="7899400"><a href="/database/sql/fakedb_test.go.html#7896947">fakeDriver</a></span><span class="op" id="7899410">)</span>&nbsp;<span class="ident" id="7899412">Open</span><span class="op" id="7899416">(</span><span class="ident" id="7899417">dsn</span>&nbsp;<span class="builtintype" id="7899421">string</span><span class="op" id="7899427">)</span>&nbsp;<span class="op" id="7899429">(</span><span class="ident" id="7899430"><a href="/database/sql/fakedb_test.go.html#7896186">driver</a></span><span class="op" id="7899436">.</span><span class="ident" id="7899437">Conn</span><span class="op" id="7899441">,</span>&nbsp;<span class="builtintype" id="7899443">error</span><span class="op" id="7899448">)</span>&nbsp;<span class="op" id="7899450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7899453">parts</span>&nbsp;<span class="op" id="7899459">:=</span>&nbsp;<span class="ident" id="7899462"><a href="/database/sql/fakedb_test.go.html#7896258">strings</a></span><span class="op" id="7899469">.</span><span class="ident" id="7899470">Split</span><span class="op" id="7899475">(</span><span class="ident" id="7899476"><a href="/database/sql/fakedb_test.go.html#7899417">dsn</a></span><span class="op" id="7899479">,</span>&nbsp;<span class="string" id="7899481">&#34;;&#34;</span><span class="op" id="7899484">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7899487">if</span>&nbsp;<span class="builtinfunc" id="7899490">len</span><span class="op" id="7899493">(</span><span class="ident" id="7899494"><a href="/database/sql/fakedb_test.go.html#7899453">parts</a></span><span class="op" id="7899499">)</span>&nbsp;<span class="op" id="7899501">&lt;</span>&nbsp;<span class="num" id="7899503">1</span>&nbsp;<span class="op" id="7899505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7899509">return</span>&nbsp;<span class="ident" id="7899516">nil</span><span class="op" id="7899519">,</span>&nbsp;<span class="ident" id="7899521"><a href="/database/sql/fakedb_test.go.html#7896209">errors</a></span><span class="op" id="7899527">.</span><span class="ident" id="7899528">New</span><span class="op" id="7899531">(</span><span class="string" id="7899532">&#34;fakedb:&nbsp;no&nbsp;database&nbsp;name&#34;</span><span class="op" id="7899558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7899561">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7899564">name</span>&nbsp;<span class="op" id="7899569">:=</span>&nbsp;<span class="ident" id="7899572"><a href="/database/sql/fakedb_test.go.html#7899453">parts</a></span><span class="op" id="7899577">[</span><span class="num" id="7899578">0</span><span class="op" id="7899579">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7899583">db</span>&nbsp;<span class="op" id="7899586">:=</span>&nbsp;<span class="ident" id="7899589"><a href="/database/sql/fakedb_test.go.html#7899397">d</a></span><span class="op" id="7899590">.</span><span class="ident" id="7899591">getDB</span><span class="op" id="7899596">(</span><span class="ident" id="7899597"><a href="/database/sql/fakedb_test.go.html#7899564">name</a></span><span class="op" id="7899601">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7899605"><a href="/database/sql/fakedb_test.go.html#7899397">d</a></span><span class="op" id="7899606">.</span><span class="ident" id="7899607">mu</span><span class="op" id="7899609">.</span><span class="ident" id="7899610">Lock</span><span class="op" id="7899614">(</span><span class="op" id="7899615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7899618"><a href="/database/sql/fakedb_test.go.html#7899397">d</a></span><span class="op" id="7899619">.</span><span class="ident" id="7899620">openCount</span><span class="op" id="7899629">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7899633"><a href="/database/sql/fakedb_test.go.html#7899397">d</a></span><span class="op" id="7899634">.</span><span class="ident" id="7899635">mu</span><span class="op" id="7899637">.</span><span class="ident" id="7899638">Unlock</span><span class="op" id="7899644">(</span><span class="op" id="7899645">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7899648">conn</span>&nbsp;<span class="op" id="7899653">:=</span>&nbsp;<span class="op" id="7899656">&amp;</span><span class="ident" id="7899657"><a href="/database/sql/fakedb_test.go.html#7897753">fakeConn</a></span><span class="op" id="7899665">{</span><span class="ident" id="7899666">db</span><span class="op" id="7899668">:</span>&nbsp;<span class="ident" id="7899670"><a href="/database/sql/fakedb_test.go.html#7899583">db</a></span><span class="op" id="7899672">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7899676">if</span>&nbsp;<span class="builtinfunc" id="7899679">len</span><span class="op" id="7899682">(</span><span class="ident" id="7899683"><a href="/database/sql/fakedb_test.go.html#7899453">parts</a></span><span class="op" id="7899688">)</span>&nbsp;<span class="op" id="7899690">&gt;=</span>&nbsp;<span class="num" id="7899693">2</span>&nbsp;<span class="op" id="7899695">&amp;&amp;</span>&nbsp;<span class="ident" id="7899698"><a href="/database/sql/fakedb_test.go.html#7899453">parts</a></span><span class="op" id="7899703">[</span><span class="num" id="7899704">1</span><span class="op" id="7899705">]</span>&nbsp;<span class="op" id="7899707">==</span>&nbsp;<span class="string" id="7899710">&#34;badConn&#34;</span>&nbsp;<span class="op" id="7899720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7899724"><a href="/database/sql/fakedb_test.go.html#7899648">conn</a></span><span class="op" id="7899728">.</span><span class="ident" id="7899729">bad</span>&nbsp;<span class="op" id="7899733">=</span>&nbsp;<span class="ident" id="7899735">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7899741">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7899744">if</span>&nbsp;<span class="ident" id="7899747"><a href="/database/sql/fakedb_test.go.html#7899397">d</a></span><span class="op" id="7899748">.</span><span class="ident" id="7899749">waitCh</span>&nbsp;<span class="op" id="7899756">!=</span>&nbsp;<span class="ident" id="7899759">nil</span>&nbsp;<span class="op" id="7899763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7899767"><a href="/database/sql/fakedb_test.go.html#7899397">d</a></span><span class="op" id="7899768">.</span><span class="ident" id="7899769">waitingCh</span>&nbsp;<span class="op" id="7899779">&lt;-</span>&nbsp;<span class="keyword" id="7899782">struct</span><span class="op" id="7899788">{</span><span class="op" id="7899789">}</span><span class="op" id="7899790">{</span><span class="op" id="7899791">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7899795">&lt;-</span><span class="ident" id="7899797"><a href="/database/sql/fakedb_test.go.html#7899397">d</a></span><span class="op" id="7899798">.</span><span class="ident" id="7899799">waitCh</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7899808"><a href="/database/sql/fakedb_test.go.html#7899397">d</a></span><span class="op" id="7899809">.</span><span class="ident" id="7899810">waitCh</span>&nbsp;<span class="op" id="7899817">=</span>&nbsp;<span class="ident" id="7899819">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7899825"><a href="/database/sql/fakedb_test.go.html#7899397">d</a></span><span class="op" id="7899826">.</span><span class="ident" id="7899827">waitingCh</span>&nbsp;<span class="op" id="7899837">=</span>&nbsp;<span class="ident" id="7899839">nil</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7899844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7899847">return</span>&nbsp;<span class="ident" id="7899854"><a href="/database/sql/fakedb_test.go.html#7899648">conn</a></span><span class="op" id="7899858">,</span>&nbsp;<span class="ident" id="7899860">nil</span><br>
<span class="lineno"></span><span class="op" id="7899864">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7899867">func</span>&nbsp;<span class="op" id="7899872">(</span><span class="ident" id="7899873">d</span>&nbsp;<span class="op" id="7899875">*</span><span class="ident" id="7899876"><a href="/database/sql/fakedb_test.go.html#7896947">fakeDriver</a></span><span class="op" id="7899886">)</span>&nbsp;<span class="ident" id="7899888">getDB</span><span class="op" id="7899893">(</span><span class="ident" id="7899894">name</span>&nbsp;<span class="builtintype" id="7899899">string</span><span class="op" id="7899905">)</span>&nbsp;<span class="op" id="7899907">*</span><span class="ident" id="7899908"><a href="/database/sql/fakedb_test.go.html#7897185">fakeDB</a></span>&nbsp;<span class="op" id="7899915">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7899918"><a href="/database/sql/fakedb_test.go.html#7899873">d</a></span><span class="op" id="7899919">.</span><span class="ident" id="7899920">mu</span><span class="op" id="7899922">.</span><span class="ident" id="7899923">Lock</span><span class="op" id="7899927">(</span><span class="op" id="7899928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7899931">defer</span>&nbsp;<span class="ident" id="7899937"><a href="/database/sql/fakedb_test.go.html#7899873">d</a></span><span class="op" id="7899938">.</span><span class="ident" id="7899939">mu</span><span class="op" id="7899941">.</span><span class="ident" id="7899942">Unlock</span><span class="op" id="7899948">(</span><span class="op" id="7899949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7899952">if</span>&nbsp;<span class="ident" id="7899955"><a href="/database/sql/fakedb_test.go.html#7899873">d</a></span><span class="op" id="7899956">.</span><span class="ident" id="7899957">dbs</span>&nbsp;<span class="op" id="7899961">==</span>&nbsp;<span class="ident" id="7899964">nil</span>&nbsp;<span class="op" id="7899968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7899972"><a href="/database/sql/fakedb_test.go.html#7899873">d</a></span><span class="op" id="7899973">.</span><span class="ident" id="7899974">dbs</span>&nbsp;<span class="op" id="7899978">=</span>&nbsp;<span class="builtinfunc" id="7899980">make</span><span class="op" id="7899984">(</span><span class="keyword" id="7899985">map</span><span class="op" id="7899988">[</span><span class="builtintype" id="7899989">string</span><span class="op" id="7899995">]</span><span class="op" id="7899996">*</span><span class="ident" id="7899997"><a href="/database/sql/fakedb_test.go.html#7897185">fakeDB</a></span><span class="op" id="7900003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7900006">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7900009">db</span><span class="op" id="7900011">,</span>&nbsp;<span class="ident" id="7900013">ok</span>&nbsp;<span class="op" id="7900016">:=</span>&nbsp;<span class="ident" id="7900019"><a href="/database/sql/fakedb_test.go.html#7899873">d</a></span><span class="op" id="7900020">.</span><span class="ident" id="7900021">dbs</span><span class="op" id="7900024">[</span><span class="ident" id="7900025"><a href="/database/sql/fakedb_test.go.html#7899894">name</a></span><span class="op" id="7900029">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7900032">if</span>&nbsp;<span class="op" id="7900035">!</span><span class="ident" id="7900036"><a href="/database/sql/fakedb_test.go.html#7900013">ok</a></span>&nbsp;<span class="op" id="7900039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7900043"><a href="/database/sql/fakedb_test.go.html#7900009">db</a></span>&nbsp;<span class="op" id="7900046">=</span>&nbsp;<span class="op" id="7900048">&amp;</span><span class="ident" id="7900049"><a href="/database/sql/fakedb_test.go.html#7897185">fakeDB</a></span><span class="op" id="7900055">{</span><span class="ident" id="7900056">name</span><span class="op" id="7900060">:</span>&nbsp;<span class="ident" id="7900062"><a href="/database/sql/fakedb_test.go.html#7899894">name</a></span><span class="op" id="7900066">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7900070"><a href="/database/sql/fakedb_test.go.html#7899873">d</a></span><span class="op" id="7900071">.</span><span class="ident" id="7900072">dbs</span><span class="op" id="7900075">[</span><span class="ident" id="7900076"><a href="/database/sql/fakedb_test.go.html#7899894">name</a></span><span class="op" id="7900080">]</span>&nbsp;<span class="op" id="7900082">=</span>&nbsp;<span class="ident" id="7900084"><a href="/database/sql/fakedb_test.go.html#7900009">db</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7900088">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7900091">return</span>&nbsp;<span class="ident" id="7900098"><a href="/database/sql/fakedb_test.go.html#7900009">db</a></span><br>
<span class="lineno"></span><span class="op" id="7900101">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7900104">func</span>&nbsp;<span class="op" id="7900109">(</span><span class="ident" id="7900110">db</span>&nbsp;<span class="op" id="7900113">*</span><span class="ident" id="7900114"><a href="/database/sql/fakedb_test.go.html#7897185">fakeDB</a></span><span class="op" id="7900120">)</span>&nbsp;<span class="ident" id="7900122">wipe</span><span class="op" id="7900126">(</span><span class="op" id="7900127">)</span>&nbsp;<span class="op" id="7900129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7900132"><a href="/database/sql/fakedb_test.go.html#7900110">db</a></span><span class="op" id="7900134">.</span><span class="ident" id="7900135">mu</span><span class="op" id="7900137">.</span><span class="ident" id="7900138">Lock</span><span class="op" id="7900142">(</span><span class="op" id="7900143">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7900146">defer</span>&nbsp;<span class="ident" id="7900152"><a href="/database/sql/fakedb_test.go.html#7900110">db</a></span><span class="op" id="7900154">.</span><span class="ident" id="7900155">mu</span><span class="op" id="7900157">.</span><span class="ident" id="7900158">Unlock</span><span class="op" id="7900164">(</span><span class="op" id="7900165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7900168"><a href="/database/sql/fakedb_test.go.html#7900110">db</a></span><span class="op" id="7900170">.</span><span class="ident" id="7900171">tables</span>&nbsp;<span class="op" id="7900178">=</span>&nbsp;<span class="ident" id="7900180">nil</span><br>
<span class="lineno"></span><span class="op" id="7900184">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7900187">func</span>&nbsp;<span class="op" id="7900192">(</span><span class="ident" id="7900193">db</span>&nbsp;<span class="op" id="7900196">*</span><span class="ident" id="7900197"><a href="/database/sql/fakedb_test.go.html#7897185">fakeDB</a></span><span class="op" id="7900203">)</span>&nbsp;<span class="ident" id="7900205">createTable</span><span class="op" id="7900216">(</span><span class="ident" id="7900217">name</span>&nbsp;<span class="builtintype" id="7900222">string</span><span class="op" id="7900228">,</span>&nbsp;<span class="ident" id="7900230">columnNames</span><span class="op" id="7900241">,</span>&nbsp;<span class="ident" id="7900243">columnTypes</span>&nbsp;<span class="op" id="7900255">[</span><span class="op" id="7900256">]</span><span class="builtintype" id="7900257">string</span><span class="op" id="7900263">)</span>&nbsp;<span class="builtintype" id="7900265">error</span>&nbsp;<span class="op" id="7900271">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7900274"><a href="/database/sql/fakedb_test.go.html#7900193">db</a></span><span class="op" id="7900276">.</span><span class="ident" id="7900277">mu</span><span class="op" id="7900279">.</span><span class="ident" id="7900280">Lock</span><span class="op" id="7900284">(</span><span class="op" id="7900285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7900288">defer</span>&nbsp;<span class="ident" id="7900294"><a href="/database/sql/fakedb_test.go.html#7900193">db</a></span><span class="op" id="7900296">.</span><span class="ident" id="7900297">mu</span><span class="op" id="7900299">.</span><span class="ident" id="7900300">Unlock</span><span class="op" id="7900306">(</span><span class="op" id="7900307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7900310">if</span>&nbsp;<span class="ident" id="7900313"><a href="/database/sql/fakedb_test.go.html#7900193">db</a></span><span class="op" id="7900315">.</span><span class="ident" id="7900316">tables</span>&nbsp;<span class="op" id="7900323">==</span>&nbsp;<span class="ident" id="7900326">nil</span>&nbsp;<span class="op" id="7900330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7900334"><a href="/database/sql/fakedb_test.go.html#7900193">db</a></span><span class="op" id="7900336">.</span><span class="ident" id="7900337">tables</span>&nbsp;<span class="op" id="7900344">=</span>&nbsp;<span class="builtinfunc" id="7900346">make</span><span class="op" id="7900350">(</span><span class="keyword" id="7900351">map</span><span class="op" id="7900354">[</span><span class="builtintype" id="7900355">string</span><span class="op" id="7900361">]</span><span class="op" id="7900362">*</span><span class="ident" id="7900363"><a href="/database/sql/fakedb_test.go.html#7897305">table</a></span><span class="op" id="7900368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7900371">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7900374">if</span>&nbsp;<span class="ident" id="7900377">_</span><span class="op" id="7900378">,</span>&nbsp;<span class="ident" id="7900380">exist</span>&nbsp;<span class="op" id="7900386">:=</span>&nbsp;<span class="ident" id="7900389"><a href="/database/sql/fakedb_test.go.html#7900193">db</a></span><span class="op" id="7900391">.</span><span class="ident" id="7900392">tables</span><span class="op" id="7900398">[</span><span class="ident" id="7900399"><a href="/database/sql/fakedb_test.go.html#7900217">name</a></span><span class="op" id="7900403">]</span><span class="op" id="7900404">;</span>&nbsp;<span class="ident" id="7900406"><a href="/database/sql/fakedb_test.go.html#7900380">exist</a></span>&nbsp;<span class="op" id="7900412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7900416">return</span>&nbsp;<span class="ident" id="7900423"><a href="/database/sql/fakedb_test.go.html#7896219">fmt</a></span><span class="op" id="7900426">.</span><span class="ident" id="7900427">Errorf</span><span class="op" id="7900433">(</span><span class="string" id="7900434">&#34;table&nbsp;%q&nbsp;already&nbsp;exists&#34;</span><span class="op" id="7900459">,</span>&nbsp;<span class="ident" id="7900461"><a href="/database/sql/fakedb_test.go.html#7900217">name</a></span><span class="op" id="7900465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7900468">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7900471">if</span>&nbsp;<span class="builtinfunc" id="7900474">len</span><span class="op" id="7900477">(</span><span class="ident" id="7900478"><a href="/database/sql/fakedb_test.go.html#7900230">columnNames</a></span><span class="op" id="7900489">)</span>&nbsp;<span class="op" id="7900491">!=</span>&nbsp;<span class="builtinfunc" id="7900494">len</span><span class="op" id="7900497">(</span><span class="ident" id="7900498"><a href="/database/sql/fakedb_test.go.html#7900243">columnTypes</a></span><span class="op" id="7900509">)</span>&nbsp;<span class="op" id="7900511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7900515">return</span>&nbsp;<span class="ident" id="7900522"><a href="/database/sql/fakedb_test.go.html#7896219">fmt</a></span><span class="op" id="7900525">.</span><span class="ident" id="7900526">Errorf</span><span class="op" id="7900532">(</span><span class="string" id="7900533">&#34;create&nbsp;table&nbsp;of&nbsp;%q&nbsp;len(names)&nbsp;!=&nbsp;len(types):&nbsp;%d&nbsp;vs&nbsp;%d&#34;</span><span class="op" id="7900588">,</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7900593"><a href="/database/sql/fakedb_test.go.html#7900217">name</a></span><span class="op" id="7900597">,</span>&nbsp;<span class="builtinfunc" id="7900599">len</span><span class="op" id="7900602">(</span><span class="ident" id="7900603"><a href="/database/sql/fakedb_test.go.html#7900230">columnNames</a></span><span class="op" id="7900614">)</span><span class="op" id="7900615">,</span>&nbsp;<span class="builtinfunc" id="7900617">len</span><span class="op" id="7900620">(</span><span class="ident" id="7900621"><a href="/database/sql/fakedb_test.go.html#7900243">columnTypes</a></span><span class="op" id="7900632">)</span><span class="op" id="7900633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7900636">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7900639"><a href="/database/sql/fakedb_test.go.html#7900193">db</a></span><span class="op" id="7900641">.</span><span class="ident" id="7900642">tables</span><span class="op" id="7900648">[</span><span class="ident" id="7900649"><a href="/database/sql/fakedb_test.go.html#7900217">name</a></span><span class="op" id="7900653">]</span>&nbsp;<span class="op" id="7900655">=</span>&nbsp;<span class="op" id="7900657">&amp;</span><span class="ident" id="7900658"><a href="/database/sql/fakedb_test.go.html#7897305">table</a></span><span class="op" id="7900663">{</span><span class="ident" id="7900664">colname</span><span class="op" id="7900671">:</span>&nbsp;<span class="ident" id="7900673"><a href="/database/sql/fakedb_test.go.html#7900230">columnNames</a></span><span class="op" id="7900684">,</span>&nbsp;<span class="ident" id="7900686">coltype</span><span class="op" id="7900693">:</span>&nbsp;<span class="ident" id="7900695"><a href="/database/sql/fakedb_test.go.html#7900243">columnTypes</a></span><span class="op" id="7900706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7900709">return</span>&nbsp;<span class="ident" id="7900716">nil</span><br>
<span class="lineno"></span><span class="op" id="7900720">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="7900723">//&nbsp;must&nbsp;be&nbsp;called&nbsp;with&nbsp;db.mu&nbsp;lock&nbsp;held</span><br>
<span class="lineno"></span><span class="keyword" id="7900762">func</span>&nbsp;<span class="op" id="7900767">(</span><span class="ident" id="7900768">db</span>&nbsp;<span class="op" id="7900771">*</span><span class="ident" id="7900772"><a href="/database/sql/fakedb_test.go.html#7897185">fakeDB</a></span><span class="op" id="7900778">)</span>&nbsp;<span class="ident" id="7900780">table</span><span class="op" id="7900785">(</span><span class="ident" id="7900786">table</span>&nbsp;<span class="builtintype" id="7900792">string</span><span class="op" id="7900798">)</span>&nbsp;<span class="op" id="7900800">(</span><span class="op" id="7900801">*</span><span class="ident" id="7900802"><a href="/database/sql/fakedb_test.go.html#7897305">table</a></span><span class="op" id="7900807">,</span>&nbsp;<span class="builtintype" id="7900809">bool</span><span class="op" id="7900813">)</span>&nbsp;<span class="op" id="7900815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7900818">if</span>&nbsp;<span class="ident" id="7900821"><a href="/database/sql/fakedb_test.go.html#7900768">db</a></span><span class="op" id="7900823">.</span><span class="ident" id="7900824">tables</span>&nbsp;<span class="op" id="7900831">==</span>&nbsp;<span class="ident" id="7900834">nil</span>&nbsp;<span class="op" id="7900838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7900842">return</span>&nbsp;<span class="ident" id="7900849">nil</span><span class="op" id="7900852">,</span>&nbsp;<span class="ident" id="7900854">false</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7900861">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7900864">t</span><span class="op" id="7900865">,</span>&nbsp;<span class="ident" id="7900867">ok</span>&nbsp;<span class="op" id="7900870">:=</span>&nbsp;<span class="ident" id="7900873"><a href="/database/sql/fakedb_test.go.html#7900768">db</a></span><span class="op" id="7900875">.</span><span class="ident" id="7900876">tables</span><span class="op" id="7900882">[</span><span class="ident" id="7900883"><a href="/database/sql/fakedb_test.go.html#7900786">table</a></span><span class="op" id="7900888">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7900891">return</span>&nbsp;<span class="ident" id="7900898"><a href="/database/sql/fakedb_test.go.html#7900864">t</a></span><span class="op" id="7900899">,</span>&nbsp;<span class="ident" id="7900901"><a href="/database/sql/fakedb_test.go.html#7900867">ok</a></span><br>
<span class="lineno"></span><span class="op" id="7900904">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="keyword" id="7900907">func</span>&nbsp;<span class="op" id="7900912">(</span><span class="ident" id="7900913">db</span>&nbsp;<span class="op" id="7900916">*</span><span class="ident" id="7900917"><a href="/database/sql/fakedb_test.go.html#7897185">fakeDB</a></span><span class="op" id="7900923">)</span>&nbsp;<span class="ident" id="7900925">columnType</span><span class="op" id="7900935">(</span><span class="ident" id="7900936">table</span><span class="op" id="7900941">,</span>&nbsp;<span class="ident" id="7900943">column</span>&nbsp;<span class="builtintype" id="7900950">string</span><span class="op" id="7900956">)</span>&nbsp;<span class="op" id="7900958">(</span><span class="ident" id="7900959">typ</span>&nbsp;<span class="builtintype" id="7900963">string</span><span class="op" id="7900969">,</span>&nbsp;<span class="ident" id="7900971">ok</span>&nbsp;<span class="builtintype" id="7900974">bool</span><span class="op" id="7900978">)</span>&nbsp;<span class="op" id="7900980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7900983"><a href="/database/sql/fakedb_test.go.html#7900913">db</a></span><span class="op" id="7900985">.</span><span class="ident" id="7900986">mu</span><span class="op" id="7900988">.</span><span class="ident" id="7900989">Lock</span><span class="op" id="7900993">(</span><span class="op" id="7900994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7900997">defer</span>&nbsp;<span class="ident" id="7901003"><a href="/database/sql/fakedb_test.go.html#7900913">db</a></span><span class="op" id="7901005">.</span><span class="ident" id="7901006">mu</span><span class="op" id="7901008">.</span><span class="ident" id="7901009">Unlock</span><span class="op" id="7901015">(</span><span class="op" id="7901016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7901019">t</span><span class="op" id="7901020">,</span>&nbsp;<span class="ident" id="7901022"><a href="/database/sql/fakedb_test.go.html#7900971">ok</a></span>&nbsp;<span class="op" id="7901025">:=</span>&nbsp;<span class="ident" id="7901028"><a href="/database/sql/fakedb_test.go.html#7900913">db</a></span><span class="op" id="7901030">.</span><span class="ident" id="7901031">table</span><span class="op" id="7901036">(</span><span class="ident" id="7901037"><a href="/database/sql/fakedb_test.go.html#7900936">table</a></span><span class="op" id="7901042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7901045">if</span>&nbsp;<span class="op" id="7901048">!</span><span class="ident" id="7901049"><a href="/database/sql/fakedb_test.go.html#7900971">ok</a></span>&nbsp;<span class="op" id="7901052">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7901056">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7901064">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7901067">for</span>&nbsp;<span class="ident" id="7901071">n</span><span class="op" id="7901072">,</span>&nbsp;<span class="ident" id="7901074">cname</span>&nbsp;<span class="op" id="7901080">:=</span>&nbsp;<span class="keyword" id="7901083">range</span>&nbsp;<span class="ident" id="7901089"><a href="/database/sql/fakedb_test.go.html#7901019">t</a></span><span class="op" id="7901090">.</span><span class="ident" id="7901091">colname</span>&nbsp;<span class="op" id="7901099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7901103">if</span>&nbsp;<span class="ident" id="7901106"><a href="/database/sql/fakedb_test.go.html#7901074">cname</a></span>&nbsp;<span class="op" id="7901112">==</span>&nbsp;<span class="ident" id="7901115"><a href="/database/sql/fakedb_test.go.html#7900943">column</a></span>&nbsp;<span class="op" id="7901122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7901127">return</span>&nbsp;<span class="ident" id="7901134"><a href="/database/sql/fakedb_test.go.html#7901019">t</a></span><span class="op" id="7901135">.</span><span class="ident" id="7901136">coltype</span><span class="op" id="7901143">[</span><span class="ident" id="7901144"><a href="/database/sql/fakedb_test.go.html#7901071">n</a></span><span class="op" id="7901145">]</span><span class="op" id="7901146">,</span>&nbsp;<span class="ident" id="7901148">true</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7901155">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7901158">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7901161">return</span>&nbsp;<span class="string" id="7901168">&#34;&#34;</span><span class="op" id="7901170">,</span>&nbsp;<span class="ident" id="7901172">false</span><br>
<span class="lineno"></span><span class="op" id="7901178">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span><span class="keyword" id="7901181">func</span>&nbsp;<span class="op" id="7901186">(</span><span class="ident" id="7901187">c</span>&nbsp;<span class="op" id="7901189">*</span><span class="ident" id="7901190"><a href="/database/sql/fakedb_test.go.html#7897753">fakeConn</a></span><span class="op" id="7901198">)</span>&nbsp;<span class="ident" id="7901200">isBad</span><span class="op" id="7901205">(</span><span class="op" id="7901206">)</span>&nbsp;<span class="builtintype" id="7901208">bool</span>&nbsp;<span class="op" id="7901213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7901216">//&nbsp;if&nbsp;not&nbsp;simulating&nbsp;bad&nbsp;conn,&nbsp;do&nbsp;nothing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7901259">if</span>&nbsp;<span class="op" id="7901262">!</span><span class="ident" id="7901263"><a href="/database/sql/fakedb_test.go.html#7901187">c</a></span><span class="op" id="7901264">.</span><span class="ident" id="7901265">bad</span>&nbsp;<span class="op" id="7901269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7901273">return</span>&nbsp;<span class="ident" id="7901280">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7901287">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7901290">//&nbsp;alternate&nbsp;between&nbsp;bad&nbsp;conn&nbsp;and&nbsp;not&nbsp;bad&nbsp;conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7901338"><a href="/database/sql/fakedb_test.go.html#7901187">c</a></span><span class="op" id="7901339">.</span><span class="ident" id="7901340">db</span><span class="op" id="7901342">.</span><span class="ident" id="7901343">badConn</span>&nbsp;<span class="op" id="7901351">=</span>&nbsp;<span class="op" id="7901353">!</span><span class="ident" id="7901354"><a href="/database/sql/fakedb_test.go.html#7901187">c</a></span><span class="op" id="7901355">.</span><span class="ident" id="7901356">db</span><span class="op" id="7901358">.</span><span class="ident" id="7901359">badConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7901368">return</span>&nbsp;<span class="ident" id="7901375"><a href="/database/sql/fakedb_test.go.html#7901187">c</a></span><span class="op" id="7901376">.</span><span class="ident" id="7901377">db</span><span class="op" id="7901379">.</span><span class="ident" id="7901380">badConn</span><br>
<span class="lineno"></span><span class="op" id="7901388">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="keyword" id="7901391">func</span>&nbsp;<span class="op" id="7901396">(</span><span class="ident" id="7901397">c</span>&nbsp;<span class="op" id="7901399">*</span><span class="ident" id="7901400"><a href="/database/sql/fakedb_test.go.html#7897753">fakeConn</a></span><span class="op" id="7901408">)</span>&nbsp;<span class="ident" id="7901410">Begin</span><span class="op" id="7901415">(</span><span class="op" id="7901416">)</span>&nbsp;<span class="op" id="7901418">(</span><span class="ident" id="7901419"><a href="/database/sql/fakedb_test.go.html#7896186">driver</a></span><span class="op" id="7901425">.</span><span class="ident" id="7901426">Tx</span><span class="op" id="7901428">,</span>&nbsp;<span class="builtintype" id="7901430">error</span><span class="op" id="7901435">)</span>&nbsp;<span class="op" id="7901437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7901440">if</span>&nbsp;<span class="ident" id="7901443"><a href="/database/sql/fakedb_test.go.html#7901397">c</a></span><span class="op" id="7901444">.</span><span class="ident" id="7901445">isBad</span><span class="op" id="7901450">(</span><span class="op" id="7901451">)</span>&nbsp;<span class="op" id="7901453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7901457">return</span>&nbsp;<span class="ident" id="7901464">nil</span><span class="op" id="7901467">,</span>&nbsp;<span class="ident" id="7901469"><a href="/database/sql/fakedb_test.go.html#7896186">driver</a></span><span class="op" id="7901475">.</span><span class="ident" id="7901476">ErrBadConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7901488">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7901491">if</span>&nbsp;<span class="ident" id="7901494"><a href="/database/sql/fakedb_test.go.html#7901397">c</a></span><span class="op" id="7901495">.</span><span class="ident" id="7901496">currTx</span>&nbsp;<span class="op" id="7901503">!=</span>&nbsp;<span class="ident" id="7901506">nil</span>&nbsp;<span class="op" id="7901510">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7901514">return</span>&nbsp;<span class="ident" id="7901521">nil</span><span class="op" id="7901524">,</span>&nbsp;<span class="ident" id="7901526"><a href="/database/sql/fakedb_test.go.html#7896209">errors</a></span><span class="op" id="7901532">.</span><span class="ident" id="7901533">New</span><span class="op" id="7901536">(</span><span class="string" id="7901537">&#34;already&nbsp;in&nbsp;a&nbsp;transaction&#34;</span><span class="op" id="7901563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7901566">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7901569"><a href="/database/sql/fakedb_test.go.html#7901397">c</a></span><span class="op" id="7901570">.</span><span class="ident" id="7901571">currTx</span>&nbsp;<span class="op" id="7901578">=</span>&nbsp;<span class="op" id="7901580">&amp;</span><span class="ident" id="7901581"><a href="/database/sql/fakedb_test.go.html#7898030">fakeTx</a></span><span class="op" id="7901587">{</span><span class="ident" id="7901588">c</span><span class="op" id="7901589">:</span>&nbsp;<span class="ident" id="7901591"><a href="/database/sql/fakedb_test.go.html#7901397">c</a></span><span class="op" id="7901592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7901595">return</span>&nbsp;<span class="ident" id="7901602"><a href="/database/sql/fakedb_test.go.html#7901397">c</a></span><span class="op" id="7901603">.</span><span class="ident" id="7901604">currTx</span><span class="op" id="7901610">,</span>&nbsp;<span class="ident" id="7901612">nil</span><br>
<span class="lineno"></span><span class="op" id="7901616">}</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span><span class="keyword" id="7901619">var</span>&nbsp;<span class="ident" id="7901623">hookPostCloseConn</span>&nbsp;<span class="keyword" id="7901641">struct</span>&nbsp;<span class="op" id="7901648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7901651"><a href="/database/sql/fakedb_test.go.html#7896269">sync</a></span><span class="op" id="7901655">.</span><span class="ident" id="7901656">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7901663">fn</span>&nbsp;<span class="keyword" id="7901666">func</span><span class="op" id="7901670">(</span><span class="op" id="7901671">*</span><span class="ident" id="7901672"><a href="/database/sql/fakedb_test.go.html#7897753">fakeConn</a></span><span class="op" id="7901680">,</span>&nbsp;<span class="builtintype" id="7901682">error</span><span class="op" id="7901687">)</span><br>
<span class="lineno"></span><span class="op" id="7901689">}</span><br>
<span class="lineno">270</span><br>
<span class="lineno"></span><span class="keyword" id="7901692">func</span>&nbsp;<span class="ident" id="7901697">setHookpostCloseConn</span><span class="op" id="7901717">(</span><span class="ident" id="7901718">fn</span>&nbsp;<span class="keyword" id="7901721">func</span><span class="op" id="7901725">(</span><span class="op" id="7901726">*</span><span class="ident" id="7901727"><a href="/database/sql/fakedb_test.go.html#7897753">fakeConn</a></span><span class="op" id="7901735">,</span>&nbsp;<span class="builtintype" id="7901737">error</span><span class="op" id="7901742">)</span><span class="op" id="7901743">)</span>&nbsp;<span class="op" id="7901745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7901748"><a href="/database/sql/fakedb_test.go.html#7901623">hookPostCloseConn</a></span><span class="op" id="7901765">.</span><span class="ident" id="7901766">Lock</span><span class="op" id="7901770">(</span><span class="op" id="7901771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7901774">defer</span>&nbsp;<span class="ident" id="7901780"><a href="/database/sql/fakedb_test.go.html#7901623">hookPostCloseConn</a></span><span class="op" id="7901797">.</span><span class="ident" id="7901798">Unlock</span><span class="op" id="7901804">(</span><span class="op" id="7901805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7901808"><a href="/database/sql/fakedb_test.go.html#7901623">hookPostCloseConn</a></span><span class="op" id="7901825">.</span><span class="ident" id="7901826">fn</span>&nbsp;<span class="op" id="7901829">=</span>&nbsp;<span class="ident" id="7901831"><a href="/database/sql/fakedb_test.go.html#7901718">fn</a></span><br>
<span class="lineno">275</span><span class="op" id="7901834">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7901837">var</span>&nbsp;<span class="ident" id="7901841">testStrictClose</span>&nbsp;<span class="op" id="7901857">*</span><span class="ident" id="7901858"><a href="/database/sql/fakedb_test.go.html#7896277">testing</a></span><span class="op" id="7901865">.</span><span class="ident" id="7901866">T</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7901869">//&nbsp;setStrictFakeConnClose&nbsp;sets&nbsp;the&nbsp;t&nbsp;to&nbsp;Errorf&nbsp;on&nbsp;when&nbsp;fakeConn.Close</span><br>
<span class="lineno">280</span><span class="comment" id="7901939">//&nbsp;fails&nbsp;to&nbsp;close.&nbsp;If&nbsp;nil,&nbsp;the&nbsp;check&nbsp;is&nbsp;disabled.</span><br>
<span class="lineno"></span><span class="keyword" id="7901989">func</span>&nbsp;<span class="ident" id="7901994">setStrictFakeConnClose</span><span class="op" id="7902016">(</span><span class="ident" id="7902017">t</span>&nbsp;<span class="op" id="7902019">*</span><span class="ident" id="7902020"><a href="/database/sql/fakedb_test.go.html#7896277">testing</a></span><span class="op" id="7902027">.</span><span class="ident" id="7902028">T</span><span class="op" id="7902029">)</span>&nbsp;<span class="op" id="7902031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902034"><a href="/database/sql/fakedb_test.go.html#7901841">testStrictClose</a></span>&nbsp;<span class="op" id="7902050">=</span>&nbsp;<span class="ident" id="7902052"><a href="/database/sql/fakedb_test.go.html#7902017">t</a></span><br>
<span class="lineno"></span><span class="op" id="7902054">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span><span class="keyword" id="7902057">func</span>&nbsp;<span class="op" id="7902062">(</span><span class="ident" id="7902063">c</span>&nbsp;<span class="op" id="7902065">*</span><span class="ident" id="7902066"><a href="/database/sql/fakedb_test.go.html#7897753">fakeConn</a></span><span class="op" id="7902074">)</span>&nbsp;<span class="ident" id="7902076">Close</span><span class="op" id="7902081">(</span><span class="op" id="7902082">)</span>&nbsp;<span class="op" id="7902084">(</span><span class="ident" id="7902085">err</span>&nbsp;<span class="builtintype" id="7902089">error</span><span class="op" id="7902094">)</span>&nbsp;<span class="op" id="7902096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902099">drv</span>&nbsp;<span class="op" id="7902103">:=</span>&nbsp;<span class="ident" id="7902106"><a href="/database/sql/fakedb_test.go.html#7898591">fdriver</a></span><span class="op" id="7902113">.</span><span class="op" id="7902114">(</span><span class="op" id="7902115">*</span><span class="ident" id="7902116"><a href="/database/sql/fakedb_test.go.html#7896947">fakeDriver</a></span><span class="op" id="7902126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7902129">defer</span>&nbsp;<span class="keyword" id="7902135">func</span><span class="op" id="7902139">(</span><span class="op" id="7902140">)</span>&nbsp;<span class="op" id="7902142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7902146">if</span>&nbsp;<span class="ident" id="7902149"><a href="/database/sql/fakedb_test.go.html#7902085">err</a></span>&nbsp;<span class="op" id="7902153">!=</span>&nbsp;<span class="ident" id="7902156">nil</span>&nbsp;<span class="op" id="7902160">&amp;&amp;</span>&nbsp;<span class="ident" id="7902163"><a href="/database/sql/fakedb_test.go.html#7901841">testStrictClose</a></span>&nbsp;<span class="op" id="7902179">!=</span>&nbsp;<span class="ident" id="7902182">nil</span>&nbsp;<span class="op" id="7902186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902191"><a href="/database/sql/fakedb_test.go.html#7901841">testStrictClose</a></span><span class="op" id="7902206">.</span><span class="ident" id="7902207">Errorf</span><span class="op" id="7902213">(</span><span class="string" id="7902214">&#34;failed&nbsp;to&nbsp;close&nbsp;a&nbsp;test&nbsp;fakeConn:&nbsp;%v&#34;</span><span class="op" id="7902251">,</span>&nbsp;<span class="ident" id="7902253"><a href="/database/sql/fakedb_test.go.html#7902085">err</a></span><span class="op" id="7902256">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7902260">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902264"><a href="/database/sql/fakedb_test.go.html#7901623">hookPostCloseConn</a></span><span class="op" id="7902281">.</span><span class="ident" id="7902282">Lock</span><span class="op" id="7902286">(</span><span class="op" id="7902287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902291">fn</span>&nbsp;<span class="op" id="7902294">:=</span>&nbsp;<span class="ident" id="7902297"><a href="/database/sql/fakedb_test.go.html#7901623">hookPostCloseConn</a></span><span class="op" id="7902314">.</span><span class="ident" id="7902315">fn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902320"><a href="/database/sql/fakedb_test.go.html#7901623">hookPostCloseConn</a></span><span class="op" id="7902337">.</span><span class="ident" id="7902338">Unlock</span><span class="op" id="7902344">(</span><span class="op" id="7902345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7902349">if</span>&nbsp;<span class="ident" id="7902352"><a href="/database/sql/fakedb_test.go.html#7902291">fn</a></span>&nbsp;<span class="op" id="7902355">!=</span>&nbsp;<span class="ident" id="7902358">nil</span>&nbsp;<span class="op" id="7902362">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902367"><a href="/database/sql/fakedb_test.go.html#7902291">fn</a></span><span class="op" id="7902369">(</span><span class="ident" id="7902370"><a href="/database/sql/fakedb_test.go.html#7902063">c</a></span><span class="op" id="7902371">,</span>&nbsp;<span class="ident" id="7902373"><a href="/database/sql/fakedb_test.go.html#7902085">err</a></span><span class="op" id="7902376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7902380">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7902384">if</span>&nbsp;<span class="ident" id="7902387"><a href="/database/sql/fakedb_test.go.html#7902085">err</a></span>&nbsp;<span class="op" id="7902391">==</span>&nbsp;<span class="ident" id="7902394">nil</span>&nbsp;<span class="op" id="7902398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902403"><a href="/database/sql/fakedb_test.go.html#7902099">drv</a></span><span class="op" id="7902406">.</span><span class="ident" id="7902407">mu</span><span class="op" id="7902409">.</span><span class="ident" id="7902410">Lock</span><span class="op" id="7902414">(</span><span class="op" id="7902415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902420"><a href="/database/sql/fakedb_test.go.html#7902099">drv</a></span><span class="op" id="7902423">.</span><span class="ident" id="7902424">closeCount</span><span class="op" id="7902434">++</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902440"><a href="/database/sql/fakedb_test.go.html#7902099">drv</a></span><span class="op" id="7902443">.</span><span class="ident" id="7902444">mu</span><span class="op" id="7902446">.</span><span class="ident" id="7902447">Unlock</span><span class="op" id="7902453">(</span><span class="op" id="7902454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7902458">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7902461">}</span><span class="op" id="7902462">(</span><span class="op" id="7902463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7902466">if</span>&nbsp;<span class="ident" id="7902469"><a href="/database/sql/fakedb_test.go.html#7902063">c</a></span><span class="op" id="7902470">.</span><span class="ident" id="7902471">currTx</span>&nbsp;<span class="op" id="7902478">!=</span>&nbsp;<span class="ident" id="7902481">nil</span>&nbsp;<span class="op" id="7902485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7902489">return</span>&nbsp;<span class="ident" id="7902496"><a href="/database/sql/fakedb_test.go.html#7896209">errors</a></span><span class="op" id="7902502">.</span><span class="ident" id="7902503">New</span><span class="op" id="7902506">(</span><span class="string" id="7902507">&#34;can&#39;t&nbsp;close&nbsp;fakeConn;&nbsp;in&nbsp;a&nbsp;Transaction&#34;</span><span class="op" id="7902547">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7902550">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7902553">if</span>&nbsp;<span class="ident" id="7902556"><a href="/database/sql/fakedb_test.go.html#7902063">c</a></span><span class="op" id="7902557">.</span><span class="ident" id="7902558">db</span>&nbsp;<span class="op" id="7902561">==</span>&nbsp;<span class="ident" id="7902564">nil</span>&nbsp;<span class="op" id="7902568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7902572">return</span>&nbsp;<span class="ident" id="7902579"><a href="/database/sql/fakedb_test.go.html#7896209">errors</a></span><span class="op" id="7902585">.</span><span class="ident" id="7902586">New</span><span class="op" id="7902589">(</span><span class="string" id="7902590">&#34;can&#39;t&nbsp;close&nbsp;fakeConn;&nbsp;already&nbsp;closed&#34;</span><span class="op" id="7902628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7902631">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7902634">if</span>&nbsp;<span class="ident" id="7902637"><a href="/database/sql/fakedb_test.go.html#7902063">c</a></span><span class="op" id="7902638">.</span><span class="ident" id="7902639">stmtsMade</span>&nbsp;<span class="op" id="7902649">&gt;</span>&nbsp;<span class="ident" id="7902651"><a href="/database/sql/fakedb_test.go.html#7902063">c</a></span><span class="op" id="7902652">.</span><span class="ident" id="7902653">stmtsClosed</span>&nbsp;<span class="op" id="7902665">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7902669">return</span>&nbsp;<span class="ident" id="7902676"><a href="/database/sql/fakedb_test.go.html#7896209">errors</a></span><span class="op" id="7902682">.</span><span class="ident" id="7902683">New</span><span class="op" id="7902686">(</span><span class="string" id="7902687">&#34;can&#39;t&nbsp;close;&nbsp;dangling&nbsp;statement(s)&#34;</span><span class="op" id="7902723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7902726">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902729"><a href="/database/sql/fakedb_test.go.html#7902063">c</a></span><span class="op" id="7902730">.</span><span class="ident" id="7902731">db</span>&nbsp;<span class="op" id="7902734">=</span>&nbsp;<span class="ident" id="7902736">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7902741">return</span>&nbsp;<span class="ident" id="7902748">nil</span><br>
<span class="lineno"></span><span class="op" id="7902752">}</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span><span class="keyword" id="7902755">func</span>&nbsp;<span class="ident" id="7902760">checkSubsetTypes</span><span class="op" id="7902776">(</span><span class="ident" id="7902777">args</span>&nbsp;<span class="op" id="7902782">[</span><span class="op" id="7902783">]</span><span class="ident" id="7902784"><a href="/database/sql/fakedb_test.go.html#7896186">driver</a></span><span class="op" id="7902790">.</span><span class="ident" id="7902791">Value</span><span class="op" id="7902796">)</span>&nbsp;<span class="builtintype" id="7902798">error</span>&nbsp;<span class="op" id="7902804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7902807">for</span>&nbsp;<span class="ident" id="7902811">n</span><span class="op" id="7902812">,</span>&nbsp;<span class="ident" id="7902814">arg</span>&nbsp;<span class="op" id="7902818">:=</span>&nbsp;<span class="keyword" id="7902821">range</span>&nbsp;<span class="ident" id="7902827"><a href="/database/sql/fakedb_test.go.html#7902777">args</a></span>&nbsp;<span class="op" id="7902832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7902836">switch</span>&nbsp;<span class="ident" id="7902843"><a href="/database/sql/fakedb_test.go.html#7902814">arg</a></span><span class="op" id="7902846">.</span><span class="op" id="7902847">(</span><span class="keyword" id="7902848">type</span><span class="op" id="7902852">)</span>&nbsp;<span class="op" id="7902854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7902858">case</span>&nbsp;<span class="ident" id="7902863">int64</span><span class="op" id="7902868">,</span>&nbsp;<span class="builtintype" id="7902870">float64</span><span class="op" id="7902877">,</span>&nbsp;<span class="builtintype" id="7902879">bool</span><span class="op" id="7902883">,</span>&nbsp;<span class="ident" id="7902885">nil</span><span class="op" id="7902888">,</span>&nbsp;<span class="op" id="7902890">[</span><span class="op" id="7902891">]</span><span class="builtintype" id="7902892">byte</span><span class="op" id="7902896">,</span>&nbsp;<span class="builtintype" id="7902898">string</span><span class="op" id="7902904">,</span>&nbsp;<span class="ident" id="7902906"><a href="/database/sql/fakedb_test.go.html#7896288">time</a></span><span class="op" id="7902910">.</span><span class="ident" id="7902911">Time</span><span class="op" id="7902915">:</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7902919">default</span><span class="op" id="7902926">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7902931">return</span>&nbsp;<span class="ident" id="7902938"><a href="/database/sql/fakedb_test.go.html#7896219">fmt</a></span><span class="op" id="7902941">.</span><span class="ident" id="7902942">Errorf</span><span class="op" id="7902948">(</span><span class="string" id="7902949">&#34;fakedb_test:&nbsp;invalid&nbsp;argument&nbsp;#%d:&nbsp;%v,&nbsp;type&nbsp;%T&#34;</span><span class="op" id="7902997">,</span>&nbsp;<span class="ident" id="7902999"><a href="/database/sql/fakedb_test.go.html#7902811">n</a></span><span class="op" id="7903000">+</span><span class="num" id="7903001">1</span><span class="op" id="7903002">,</span>&nbsp;<span class="ident" id="7903004"><a href="/database/sql/fakedb_test.go.html#7902814">arg</a></span><span class="op" id="7903007">,</span>&nbsp;<span class="ident" id="7903009"><a href="/database/sql/fakedb_test.go.html#7902814">arg</a></span><span class="op" id="7903012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7903016">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7903019">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7903022">return</span>&nbsp;<span class="ident" id="7903029">nil</span><br>
<span class="lineno">325</span><span class="op" id="7903033">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7903036">func</span>&nbsp;<span class="op" id="7903041">(</span><span class="ident" id="7903042">c</span>&nbsp;<span class="op" id="7903044">*</span><span class="ident" id="7903045"><a href="/database/sql/fakedb_test.go.html#7897753">fakeConn</a></span><span class="op" id="7903053">)</span>&nbsp;<span class="ident" id="7903055">Exec</span><span class="op" id="7903059">(</span><span class="ident" id="7903060">query</span>&nbsp;<span class="builtintype" id="7903066">string</span><span class="op" id="7903072">,</span>&nbsp;<span class="ident" id="7903074">args</span>&nbsp;<span class="op" id="7903079">[</span><span class="op" id="7903080">]</span><span class="ident" id="7903081"><a href="/database/sql/fakedb_test.go.html#7896186">driver</a></span><span class="op" id="7903087">.</span><span class="ident" id="7903088">Value</span><span class="op" id="7903093">)</span>&nbsp;<span class="op" id="7903095">(</span><span class="ident" id="7903096"><a href="/database/sql/fakedb_test.go.html#7896186">driver</a></span><span class="op" id="7903102">.</span><span class="ident" id="7903103">Result</span><span class="op" id="7903109">,</span>&nbsp;<span class="builtintype" id="7903111">error</span><span class="op" id="7903116">)</span>&nbsp;<span class="op" id="7903118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7903121">//&nbsp;This&nbsp;is&nbsp;an&nbsp;optional&nbsp;interface,&nbsp;but&nbsp;it&#39;s&nbsp;implemented&nbsp;here</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7903182">//&nbsp;just&nbsp;to&nbsp;check&nbsp;that&nbsp;all&nbsp;the&nbsp;args&nbsp;are&nbsp;of&nbsp;the&nbsp;proper&nbsp;types.</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7903243">//&nbsp;ErrSkip&nbsp;is&nbsp;returned&nbsp;so&nbsp;the&nbsp;caller&nbsp;acts&nbsp;as&nbsp;if&nbsp;we&nbsp;didn&#39;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7903302">//&nbsp;implement&nbsp;this&nbsp;at&nbsp;all.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903329">err</span>&nbsp;<span class="op" id="7903333">:=</span>&nbsp;<span class="ident" id="7903336"><a href="/database/sql/fakedb_test.go.html#7902760">checkSubsetTypes</a></span><span class="op" id="7903352">(</span><span class="ident" id="7903353"><a href="/database/sql/fakedb_test.go.html#7903074">args</a></span><span class="op" id="7903357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7903360">if</span>&nbsp;<span class="ident" id="7903363"><a href="/database/sql/fakedb_test.go.html#7903329">err</a></span>&nbsp;<span class="op" id="7903367">!=</span>&nbsp;<span class="ident" id="7903370">nil</span>&nbsp;<span class="op" id="7903374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7903378">return</span>&nbsp;<span class="ident" id="7903385">nil</span><span class="op" id="7903388">,</span>&nbsp;<span class="ident" id="7903390"><a href="/database/sql/fakedb_test.go.html#7903329">err</a></span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7903395">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7903398">return</span>&nbsp;<span class="ident" id="7903405">nil</span><span class="op" id="7903408">,</span>&nbsp;<span class="ident" id="7903410"><a href="/database/sql/fakedb_test.go.html#7896186">driver</a></span><span class="op" id="7903416">.</span><span class="ident" id="7903417">ErrSkip</span><br>
<span class="lineno"></span><span class="op" id="7903425">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7903428">func</span>&nbsp;<span class="op" id="7903433">(</span><span class="ident" id="7903434">c</span>&nbsp;<span class="op" id="7903436">*</span><span class="ident" id="7903437"><a href="/database/sql/fakedb_test.go.html#7897753">fakeConn</a></span><span class="op" id="7903445">)</span>&nbsp;<span class="ident" id="7903447">Query</span><span class="op" id="7903452">(</span><span class="ident" id="7903453">query</span>&nbsp;<span class="builtintype" id="7903459">string</span><span class="op" id="7903465">,</span>&nbsp;<span class="ident" id="7903467">args</span>&nbsp;<span class="op" id="7903472">[</span><span class="op" id="7903473">]</span><span class="ident" id="7903474"><a href="/database/sql/fakedb_test.go.html#7896186">driver</a></span><span class="op" id="7903480">.</span><span class="ident" id="7903481">Value</span><span class="op" id="7903486">)</span>&nbsp;<span class="op" id="7903488">(</span><span class="ident" id="7903489"><a href="/database/sql/fakedb_test.go.html#7896186">driver</a></span><span class="op" id="7903495">.</span><span class="ident" id="7903496">Rows</span><span class="op" id="7903500">,</span>&nbsp;<span class="builtintype" id="7903502">error</span><span class="op" id="7903507">)</span>&nbsp;<span class="op" id="7903509">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7903512">//&nbsp;This&nbsp;is&nbsp;an&nbsp;optional&nbsp;interface,&nbsp;but&nbsp;it&#39;s&nbsp;implemented&nbsp;here</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7903573">//&nbsp;just&nbsp;to&nbsp;check&nbsp;that&nbsp;all&nbsp;the&nbsp;args&nbsp;are&nbsp;of&nbsp;the&nbsp;proper&nbsp;types.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7903634">//&nbsp;ErrSkip&nbsp;is&nbsp;returned&nbsp;so&nbsp;the&nbsp;caller&nbsp;acts&nbsp;as&nbsp;if&nbsp;we&nbsp;didn&#39;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7903693">//&nbsp;implement&nbsp;this&nbsp;at&nbsp;all.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903720">err</span>&nbsp;<span class="op" id="7903724">:=</span>&nbsp;<span class="ident" id="7903727"><a href="/database/sql/fakedb_test.go.html#7902760">checkSubsetTypes</a></span><span class="op" id="7903743">(</span><span class="ident" id="7903744"><a href="/database/sql/fakedb_test.go.html#7903467">args</a></span><span class="op" id="7903748">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7903751">if</span>&nbsp;<span class="ident" id="7903754"><a href="/database/sql/fakedb_test.go.html#7903720">err</a></span>&nbsp;<span class="op" id="7903758">!=</span>&nbsp;<span class="ident" id="7903761">nil</span>&nbsp;<span class="op" id="7903765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7903769">return</span>&nbsp;<span class="ident" id="7903776">nil</span><span class="op" id="7903779">,</span>&nbsp;<span class="ident" id="7903781"><a href="/database/sql/fakedb_test.go.html#7903720">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7903786">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7903789">return</span>&nbsp;<span class="ident" id="7903796">nil</span><span class="op" id="7903799">,</span>&nbsp;<span class="ident" id="7903801"><a href="/database/sql/fakedb_test.go.html#7896186">driver</a></span><span class="op" id="7903807">.</span><span class="ident" id="7903808">ErrSkip</span><br>
<span class="lineno"></span><span class="op" id="7903816">}</span><br>
<span class="lineno">350</span><br>
<span class="lineno"></span><span class="keyword" id="7903819">func</span>&nbsp;<span class="ident" id="7903824">errf</span><span class="op" id="7903828">(</span><span class="ident" id="7903829">msg</span>&nbsp;<span class="builtintype" id="7903833">string</span><span class="op" id="7903839">,</span>&nbsp;<span class="ident" id="7903841">args</span>&nbsp;<span class="op" id="7903846">...</span><span class="keyword" id="7903849">interface</span><span class="op" id="7903858">{</span><span class="op" id="7903859">}</span><span class="op" id="7903860">)</span>&nbsp;<span class="builtintype" id="7903862">error</span>&nbsp;<span class="op" id="7903868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7903871">return</span>&nbsp;<span class="ident" id="7903878"><a href="/database/sql/fakedb_test.go.html#7896209">errors</a></span><span class="op" id="7903884">.</span><span class="ident" id="7903885">New</span><span class="op" id="7903888">(</span><span class="string" id="7903889">&#34;fakedb:&nbsp;&#34;</span>&nbsp;<span class="op" id="7903900">+</span>&nbsp;<span class="ident" id="7903902"><a href="/database/sql/fakedb_test.go.html#7896219">fmt</a></span><span class="op" id="7903905">.</span><span class="ident" id="7903906">Sprintf</span><span class="op" id="7903913">(</span><span class="ident" id="7903914"><a href="/database/sql/fakedb_test.go.html#7903829">msg</a></span><span class="op" id="7903917">,</span>&nbsp;<span class="ident" id="7903919"><a href="/database/sql/fakedb_test.go.html#7903841">args</a></span><span class="op" id="7903923">...</span><span class="op" id="7903926">)</span><span class="op" id="7903927">)</span><br>
<span class="lineno"></span><span class="op" id="7903929">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="comment" id="7903932">//&nbsp;parts&nbsp;are&nbsp;table|selectCol1,selectCol2|whereCol=?,whereCol2=?</span><br>
<span class="lineno"></span><span class="comment" id="7903996">//&nbsp;(note&nbsp;that&nbsp;where&nbsp;columns&nbsp;must&nbsp;always&nbsp;contain&nbsp;?&nbsp;marks,</span><br>
<span class="lineno"></span><span class="comment" id="7904053">//&nbsp;&nbsp;just&nbsp;a&nbsp;limitation&nbsp;for&nbsp;fakedb)</span><br>
<span class="lineno"></span><span class="keyword" id="7904087">func</span>&nbsp;<span class="op" id="7904092">(</span><span class="ident" id="7904093">c</span>&nbsp;<span class="op" id="7904095">*</span><span class="ident" id="7904096"><a href="/database/sql/fakedb_test.go.html#7897753">fakeConn</a></span><span class="op" id="7904104">)</span>&nbsp;<span class="ident" id="7904106">prepareSelect</span><span class="op" id="7904119">(</span><span class="ident" id="7904120">stmt</span>&nbsp;<span class="op" id="7904125">*</span><span class="ident" id="7904126"><a href="/database/sql/fakedb_test.go.html#7898067">fakeStmt</a></span><span class="op" id="7904134">,</span>&nbsp;<span class="ident" id="7904136">parts</span>&nbsp;<span class="op" id="7904142">[</span><span class="op" id="7904143">]</span><span class="builtintype" id="7904144">string</span><span class="op" id="7904150">)</span>&nbsp;<span class="op" id="7904152">(</span><span class="ident" id="7904153"><a href="/database/sql/fakedb_test.go.html#7896186">driver</a></span><span class="op" id="7904159">.</span><span class="ident" id="7904160">Stmt</span><span class="op" id="7904164">,</span>&nbsp;<span class="builtintype" id="7904166">error</span><span class="op" id="7904171">)</span>&nbsp;<span class="op" id="7904173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7904176">if</span>&nbsp;<span class="builtinfunc" id="7904179">len</span><span class="op" id="7904182">(</span><span class="ident" id="7904183"><a href="/database/sql/fakedb_test.go.html#7904136">parts</a></span><span class="op" id="7904188">)</span>&nbsp;<span class="op" id="7904190">!=</span>&nbsp;<span class="num" id="7904193">3</span>&nbsp;<span class="op" id="7904195">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7904199"><a href="/database/sql/fakedb_test.go.html#7904120">stmt</a></span><span class="op" id="7904203">.</span><span class="ident" id="7904204">Close</span><span class="op" id="7904209">(</span><span class="op" id="7904210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7904214">return</span>&nbsp;<span class="ident" id="7904221">nil</span><span class="op" id="7904224">,</span>&nbsp;<span class="ident" id="7904226"><a href="/database/sql/fakedb_test.go.html#7903824">errf</a></span><span class="op" id="7904230">(</span><span class="string" id="7904231">&#34;invalid&nbsp;SELECT&nbsp;syntax&nbsp;with&nbsp;%d&nbsp;parts;&nbsp;want&nbsp;3&#34;</span><span class="op" id="7904276">,</span>&nbsp;<span class="builtinfunc" id="7904278">len</span><span class="op" id="7904281">(</span><span class="ident" id="7904282"><a href="/database/sql/fakedb_test.go.html#7904136">parts</a></span><span class="op" id="7904287">)</span><span class="op" id="7904288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7904291">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7904294"><a href="/database/sql/fakedb_test.go.html#7904120">stmt</a></span><span class="op" id="7904298">.</span><span class="ident" id="7904299">table</span>&nbsp;<span class="op" id="7904305">=</span>&nbsp;<span class="ident" id="7904307"><a href="/database/sql/fakedb_test.go.html#7904136">parts</a></span><span class="op" id="7904312">[</span><span class="num" id="7904313">0</span><span class="op" id="7904314">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7904317"><a href="/database/sql/fakedb_test.go.html#7904120">stmt</a></span><span class="op" id="7904321">.</span><span class="ident" id="7904322">colName</span>&nbsp;<span class="op" id="7904330">=</span>&nbsp;<span class="ident" id="7904332"><a href="/database/sql/fakedb_test.go.html#7896258">strings</a></span><span class="op" id="7904339">.</span><span class="ident" id="7904340">Split</span><span class="op" id="7904345">(</span><span class="ident" id="7904346"><a href="/database/sql/fakedb_test.go.html#7904136">parts</a></span><span class="op" id="7904351">[</span><span class="num" id="7904352">1</span><span class="op" id="7904353">]</span><span class="op" id="7904354">,</span>&nbsp;<span class="string" id="7904356">&#34;,&#34;</span><span class="op" id="7904359">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7904362">for</span>&nbsp;<span class="ident" id="7904366">n</span><span class="op" id="7904367">,</span>&nbsp;<span class="ident" id="7904369">colspec</span>&nbsp;<span class="op" id="7904377">:=</span>&nbsp;<span class="keyword" id="7904380">range</span>&nbsp;<span class="ident" id="7904386"><a href="/database/sql/fakedb_test.go.html#7896258">strings</a></span><span class="op" id="7904393">.</span><span class="ident" id="7904394">Split</span><span class="op" id="7904399">(</span><span class="ident" id="7904400"><a href="/database/sql/fakedb_test.go.html#7904136">parts</a></span><span class="op" id="7904405">[</span><span class="num" id="7904406">2</span><span class="op" id="7904407">]</span><span class="op" id="7904408">,</span>&nbsp;<span class="string" id="7904410">&#34;,&#34;</span><span class="op" id="7904413">)</span>&nbsp;<span class="op" id="7904415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7904419">if</span>&nbsp;<span class="ident" id="7904422"><a href="/database/sql/fakedb_test.go.html#7904369">colspec</a></span>&nbsp;<span class="op" id="7904430">==</span>&nbsp;<span class="string" id="7904433">&#34;&#34;</span>&nbsp;<span class="op" id="7904436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7904441">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7904452">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7904456">nameVal</span>&nbsp;<span class="op" id="7904464">:=</span>&nbsp;<span class="ident" id="7904467"><a href="/database/sql/fakedb_test.go.html#7896258">strings</a></span><span class="op" id="7904474">.</span><span class="ident" id="7904475">Split</span><span class="op" id="7904480">(</span><span class="ident" id="7904481"><a href="/database/sql/fakedb_test.go.html#7904369">colspec</a></span><span class="op" id="7904488">,</span>&nbsp;<span class="string" id="7904490">&#34;=&#34;</span><span class="op" id="7904493">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7904497">if</span>&nbsp;<span class="builtinfunc" id="7904500">len</span><span class="op" id="7904503">(</span><span class="ident" id="7904504"><a href="/database/sql/fakedb_test.go.html#7904456">nameVal</a></span><span class="op" id="7904511">)</span>&nbsp;<span class="op" id="7904513">!=</span>&nbsp;<span class="num" id="7904516">2</span>&nbsp;<span class="op" id="7904518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7904523"><a href="/database/sql/fakedb_test.go.html#7904120">stmt</a></span><span class="op" id="7904527">.</span><span class="ident" id="7904528">Close</span><span class="op" id="7904533">(</span><span class="op" id="7904534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7904539">return</span>&nbsp;<span class="ident" id="7904546">nil</span><span class="op" id="7904549">,</span>&nbsp;<span class="ident" id="7904551"><a href="/database/sql/fakedb_test.go.html#7903824">errf</a></span><span class="op" id="7904555">(</span><span class="string" id="7904556">&#34;SELECT&nbsp;on&nbsp;table&nbsp;%q&nbsp;has&nbsp;invalid&nbsp;column&nbsp;spec&nbsp;of&nbsp;%q&nbsp;(index&nbsp;%d)&#34;</span><span class="op" id="7904617">,</span>&nbsp;<span class="ident" id="7904619"><a href="/database/sql/fakedb_test.go.html#7904120">stmt</a></span><span class="op" id="7904623">.</span><span class="ident" id="7904624">table</span><span class="op" id="7904629">,</span>&nbsp;<span class="ident" id="7904631"><a href="/database/sql/fakedb_test.go.html#7904369">colspec</a></span><span class="op" id="7904638">,</span>&nbsp;<span class="ident" id="7904640"><a href="/database/sql/fakedb_test.go.html#7904366">n</a></span><span class="op" id="7904641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7904645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7904649">column</span><span class="op" id="7904655">,</span>&nbsp;<span class="ident" id="7904657">value</span>&nbsp;<span class="op" id="7904663">:=</span>&nbsp;<span class="ident" id="7904666"><a href="/database/sql/fakedb_test.go.html#7904456">nameVal</a></span><span class="op" id="7904673">[</span><span class="num" id="7904674">0</span><span class="op" id="7904675">]</span><span class="op" id="7904676">,</span>&nbsp;<span class="ident" id="7904678"><a href="/database/sql/fakedb_test.go.html#7904456">nameVal</a></span><span class="op" id="7904685">[</span><span class="num" id="7904686">1</span><span class="op" id="7904687">]</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7904691">_</span><span class="op" id="7904692">,</span>&nbsp;<span class="ident" id="7904694">ok</span>&nbsp;<span class="op" id="7904697">:=</span>&nbsp;<span class="ident" id="7904700"><a href="/database/sql/fakedb_test.go.html#7904093">c</a></span><span class="op" id="7904701">.</span><span class="ident" id="7904702">db</span><span class="op" id="7904704">.</span><span class="ident" id="7904705">columnType</span><span class="op" id="7904715">(</span><span class="ident" id="7904716"><a href="/database/sql/fakedb_test.go.html#7904120">stmt</a></span><span class="op" id="7904720">.</span><span class="ident" id="7904721">table</span><span class="op" id="7904726">,</span>&nbsp;<span class="ident" id="7904728"><a href="/database/sql/fakedb_test.go.html#7904649">column</a></span><span class="op" id="7904734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7904738">if</span>&nbsp;<span class="op" id="7904741">!</span><span class="ident" id="7904742"><a href="/database/sql/fakedb_test.go.html#7904694">ok</a></span>&nbsp;<span class="op" id="7904745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7904750"><a href="/database/sql/fakedb_test.go.html#7904120">stmt</a></span><span class="op" id="7904754">.</span><span class="ident" id="7904755">Close</span><span class="op" id="7904760">(</span><span class="op" id="7904761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7904766">return</span>&nbsp;<span class="ident" id="7904773">nil</span><span class="op" id="7904776">,</span>&nbsp;<span class="ident" id="7904778"><a href="/database/sql/fakedb_test.go.html#7903824">errf</a></span><span class="op" id="7904782">(</span><span class="string" id="7904783">&#34;SELECT&nbsp;on&nbsp;table&nbsp;%q&nbsp;references&nbsp;non-existent&nbsp;column&nbsp;%q&#34;</span><span class="op" id="7904837">,</span>&nbsp;<span class="ident" id="7904839"><a href="/database/sql/fakedb_test.go.html#7904120">stmt</a></span><span class="op" id="7904843">.</span><span class="ident" id="7904844">table</span><span class="op" id="7904849">,</span>&nbsp;<span class="ident" id="7904851"><a href="/database/sql/fakedb_test.go.html#7904649">column</a></span><span class="op" id="7904857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7904861">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7904865">if</span>&nbsp;<span class="ident" id="7904868"><a href="/database/sql/fakedb_test.go.html#7904657">value</a></span>&nbsp;<span class="op" id="7904874">!=</span>&nbsp;<span class="string" id="7904877">&#34;?&#34;</span>&nbsp;<span class="op" id="7904881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7904886"><a href="/database/sql/fakedb_test.go.html#7904120">stmt</a></span><span class="op" id="7904890">.</span><span class="ident" id="7904891">Close</span><span class="op" id="7904896">(</span><span class="op" id="7904897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7904902">return</span>&nbsp;<span class="ident" id="7904909">nil</span><span class="op" id="7904912">,</span>&nbsp;<span class="ident" id="7904914"><a href="/database/sql/fakedb_test.go.html#7903824">errf</a></span><span class="op" id="7904918">(</span><span class="string" id="7904919">&#34;SELECT&nbsp;on&nbsp;table&nbsp;%q&nbsp;has&nbsp;pre-bound&nbsp;value&nbsp;for&nbsp;where&nbsp;column&nbsp;%q;&nbsp;need&nbsp;a&nbsp;question&nbsp;mark&#34;</span><span class="op" id="7905001">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905007"><a href="/database/sql/fakedb_test.go.html#7904120">stmt</a></span><span class="op" id="7905011">.</span><span class="ident" id="7905012">table</span><span class="op" id="7905017">,</span>&nbsp;<span class="ident" id="7905019"><a href="/database/sql/fakedb_test.go.html#7904649">column</a></span><span class="op" id="7905025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7905029">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905033"><a href="/database/sql/fakedb_test.go.html#7904120">stmt</a></span><span class="op" id="7905037">.</span><span class="ident" id="7905038">whereCol</span>&nbsp;<span class="op" id="7905047">=</span>&nbsp;<span class="builtinfunc" id="7905049">append</span><span class="op" id="7905055">(</span><span class="ident" id="7905056"><a href="/database/sql/fakedb_test.go.html#7904120">stmt</a></span><span class="op" id="7905060">.</span><span class="ident" id="7905061">whereCol</span><span class="op" id="7905069">,</span>&nbsp;<span class="ident" id="7905071"><a href="/database/sql/fakedb_test.go.html#7904649">column</a></span><span class="op" id="7905077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905081"><a href="/database/sql/fakedb_test.go.html#7904120">stmt</a></span><span class="op" id="7905085">.</span><span class="ident" id="7905086">placeholders</span><span class="op" id="7905098">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7905102">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7905105">return</span>&nbsp;<span class="ident" id="7905112"><a href="/database/sql/fakedb_test.go.html#7904120">stmt</a></span><span class="op" id="7905116">,</span>&nbsp;<span class="ident" id="7905118">nil</span><br>
<span class="lineno"></span><span class="op" id="7905122">}</span><br>
<span class="lineno">390</span><br>
<span class="lineno"></span><span class="comment" id="7905125">//&nbsp;parts&nbsp;are&nbsp;table|col=type,col2=type2</span><br>
<span class="lineno"></span><span class="keyword" id="7905164">func</span>&nbsp;<span class="op" id="7905169">(</span><span class="ident" id="7905170">c</span>&nbsp;<span class="op" id="7905172">*</span><span class="ident" id="7905173"><a href="/database/sql/fakedb_test.go.html#7897753">fakeConn</a></span><span class="op" id="7905181">)</span>&nbsp;<span class="ident" id="7905183">prepareCreate</span><span class="op" id="7905196">(</span><span class="ident" id="7905197">stmt</span>&nbsp;<span class="op" id="7905202">*</span><span class="ident" id="7905203"><a href="/database/sql/fakedb_test.go.html#7898067">fakeStmt</a></span><span class="op" id="7905211">,</span>&nbsp;<span class="ident" id="7905213">parts</span>&nbsp;<span class="op" id="7905219">[</span><span class="op" id="7905220">]</span><span class="builtintype" id="7905221">string</span><span class="op" id="7905227">)</span>&nbsp;<span class="op" id="7905229">(</span><span class="ident" id="7905230"><a href="/database/sql/fakedb_test.go.html#7896186">driver</a></span><span class="op" id="7905236">.</span><span class="ident" id="7905237">Stmt</span><span class="op" id="7905241">,</span>&nbsp;<span class="builtintype" id="7905243">error</span><span class="op" id="7905248">)</span>&nbsp;<span class="op" id="7905250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7905253">if</span>&nbsp;<span class="builtinfunc" id="7905256">len</span><span class="op" id="7905259">(</span><span class="ident" id="7905260"><a href="/database/sql/fakedb_test.go.html#7905213">parts</a></span><span class="op" id="7905265">)</span>&nbsp;<span class="op" id="7905267">!=</span>&nbsp;<span class="num" id="7905270">2</span>&nbsp;<span class="op" id="7905272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905276"><a href="/database/sql/fakedb_test.go.html#7905197">stmt</a></span><span class="op" id="7905280">.</span><span class="ident" id="7905281">Close</span><span class="op" id="7905286">(</span><span class="op" id="7905287">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7905291">return</span>&nbsp;<span class="ident" id="7905298">nil</span><span class="op" id="7905301">,</span>&nbsp;<span class="ident" id="7905303"><a href="/database/sql/fakedb_test.go.html#7903824">errf</a></span><span class="op" id="7905307">(</span><span class="string" id="7905308">&#34;invalid&nbsp;CREATE&nbsp;syntax&nbsp;with&nbsp;%d&nbsp;parts;&nbsp;want&nbsp;2&#34;</span><span class="op" id="7905353">,</span>&nbsp;<span class="builtinfunc" id="7905355">len</span><span class="op" id="7905358">(</span><span class="ident" id="7905359"><a href="/database/sql/fakedb_test.go.html#7905213">parts</a></span><span class="op" id="7905364">)</span><span class="op" id="7905365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7905368">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905371"><a href="/database/sql/fakedb_test.go.html#7905197">stmt</a></span><span class="op" id="7905375">.</span><span class="ident" id="7905376">table</span>&nbsp;<span class="op" id="7905382">=</span>&nbsp;<span class="ident" id="7905384"><a href="/database/sql/fakedb_test.go.html#7905213">parts</a></span><span class="op" id="7905389">[</span><span class="num" id="7905390">0</span><span class="op" id="7905391">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7905394">for</span>&nbsp;<span class="ident" id="7905398">n</span><span class="op" id="7905399">,</span>&nbsp;<span class="ident" id="7905401">colspec</span>&nbsp;<span class="op" id="7905409">:=</span>&nbsp;<span class="keyword" id="7905412">range</span>&nbsp;<span class="ident" id="7905418"><a href="/database/sql/fakedb_test.go.html#7896258">strings</a></span><span class="op" id="7905425">.</span><span class="ident" id="7905426">Split</span><span class="op" id="7905431">(</span><span class="ident" id="7905432"><a href="/database/sql/fakedb_test.go.html#7905213">parts</a></span><span class="op" id="7905437">[</span><span class="num" id="7905438">1</span><span class="op" id="7905439">]</span><span class="op" id="7905440">,</span>&nbsp;<span class="string" id="7905442">&#34;,&#34;</span><span class="op" id="7905445">)</span>&nbsp;<span class="op" id="7905447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905451">nameType</span>&nbsp;<span class="op" id="7905460">:=</span>&nbsp;<span class="ident" id="7905463"><a href="/database/sql/fakedb_test.go.html#7896258">strings</a></span><span class="op" id="7905470">.</span><span class="ident" id="7905471">Split</span><span class="op" id="7905476">(</span><span class="ident" id="7905477"><a href="/database/sql/fakedb_test.go.html#7905401">colspec</a></span><span class="op" id="7905484">,</span>&nbsp;<span class="string" id="7905486">&#34;=&#34;</span><span class="op" id="7905489">)</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7905493">if</span>&nbsp;<span class="builtinfunc" id="7905496">len</span><span class="op" id="7905499">(</span><span class="ident" id="7905500"><a href="/database/sql/fakedb_test.go.html#7905451">nameType</a></span><span class="op" id="7905508">)</span>&nbsp;<span class="op" id="7905510">!=</span>&nbsp;<span class="num" id="7905513">2</span>&nbsp;<span class="op" id="7905515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905520"><a href="/database/sql/fakedb_test.go.html#7905197">stmt</a></span><span class="op" id="7905524">.</span><span class="ident" id="7905525">Close</span><span class="op" id="7905530">(</span><span class="op" id="7905531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7905536">return</span>&nbsp;<span class="ident" id="7905543">nil</span><span class="op" id="7905546">,</span>&nbsp;<span class="ident" id="7905548"><a href="/database/sql/fakedb_test.go.html#7903824">errf</a></span><span class="op" id="7905552">(</span><span class="string" id="7905553">&#34;CREATE&nbsp;table&nbsp;%q&nbsp;has&nbsp;invalid&nbsp;column&nbsp;spec&nbsp;of&nbsp;%q&nbsp;(index&nbsp;%d)&#34;</span><span class="op" id="7905611">,</span>&nbsp;<span class="ident" id="7905613"><a href="/database/sql/fakedb_test.go.html#7905197">stmt</a></span><span class="op" id="7905617">.</span><span class="ident" id="7905618">table</span><span class="op" id="7905623">,</span>&nbsp;<span class="ident" id="7905625"><a href="/database/sql/fakedb_test.go.html#7905401">colspec</a></span><span class="op" id="7905632">,</span>&nbsp;<span class="ident" id="7905634"><a href="/database/sql/fakedb_test.go.html#7905398">n</a></span><span class="op" id="7905635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7905639">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905643"><a href="/database/sql/fakedb_test.go.html#7905197">stmt</a></span><span class="op" id="7905647">.</span><span class="ident" id="7905648">colName</span>&nbsp;<span class="op" id="7905656">=</span>&nbsp;<span class="builtinfunc" id="7905658">append</span><span class="op" id="7905664">(</span><span class="ident" id="7905665"><a href="/database/sql/fakedb_test.go.html#7905197">stmt</a></span><span class="op" id="7905669">.</span><span class="ident" id="7905670">colName</span><span class="op" id="7905677">,</span>&nbsp;<span class="ident" id="7905679"><a href="/database/sql/fakedb_test.go.html#7905451">nameType</a></span><span class="op" id="7905687">[</span><span class="num" id="7905688">0</span><span class="op" id="7905689">]</span><span class="op" id="7905690">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905694"><a href="/database/sql/fakedb_test.go.html#7905197">stmt</a></span><span class="op" id="7905698">.</span><span class="ident" id="7905699">colType</span>&nbsp;<span class="op" id="7905707">=</span>&nbsp;<span class="builtinfunc" id="7905709">append</span><span class="op" id="7905715">(</span><span class="ident" id="7905716"><a href="/database/sql/fakedb_test.go.html#7905197">stmt</a></span><span class="op" id="7905720">.</span><span class="ident" id="7905721">colType</span><span class="op" id="7905728">,</span>&nbsp;<span class="ident" id="7905730"><a href="/database/sql/fakedb_test.go.html#7905451">nameType</a></span><span class="op" id="7905738">[</span><span class="num" id="7905739">1</span><span class="op" id="7905740">]</span><span class="op" id="7905741">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7905744">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7905747">return</span>&nbsp;<span class="ident" id="7905754"><a href="/database/sql/fakedb_test.go.html#7905197">stmt</a></span><span class="op" id="7905758">,</span>&nbsp;<span class="ident" id="7905760">nil</span><br>
<span class="lineno"></span><span class="op" id="7905764">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">410</span><span class="comment" id="7905767">//&nbsp;parts&nbsp;are&nbsp;table|col=?,col2=val</span><br>
<span class="lineno"></span><span class="keyword" id="7905801">func</span>&nbsp;<span class="op" id="7905806">(</span><span class="ident" id="7905807">c</span>&nbsp;<span class="op" id="7905809">*</span><span class="ident" id="7905810"><a href="/database/sql/fakedb_test.go.html#7897753">fakeConn</a></span><span class="op" id="7905818">)</span>&nbsp;<span class="ident" id="7905820">prepareInsert</span><span class="op" id="7905833">(</span><span class="ident" id="7905834">stmt</span>&nbsp;<span class="op" id="7905839">*</span><span class="ident" id="7905840"><a href="/database/sql/fakedb_test.go.html#7898067">fakeStmt</a></span><span class="op" id="7905848">,</span>&nbsp;<span class="ident" id="7905850">parts</span>&nbsp;<span class="op" id="7905856">[</span><span class="op" id="7905857">]</span><span class="builtintype" id="7905858">string</span><span class="op" id="7905864">)</span>&nbsp;<span class="op" id="7905866">(</span><span class="ident" id="7905867"><a href="/database/sql/fakedb_test.go.html#7896186">driver</a></span><span class="op" id="7905873">.</span><span class="ident" id="7905874">Stmt</span><span class="op" id="7905878">,</span>&nbsp;<span class="builtintype" id="7905880">error</span><span class="op" id="7905885">)</span>&nbsp;<span class="op" id="7905887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7905890">if</span>&nbsp;<span class="builtinfunc" id="7905893">len</span><span class="op" id="7905896">(</span><span class="ident" id="7905897"><a href="/database/sql/fakedb_test.go.html#7905850">parts</a></span><span class="op" id="7905902">)</span>&nbsp;<span class="op" id="7905904">!=</span>&nbsp;<span class="num" id="7905907">2</span>&nbsp;<span class="op" id="7905909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905913"><a href="/database/sql/fakedb_test.go.html#7905834">stmt</a></span><span class="op" id="7905917">.</span><span class="ident" id="7905918">Close</span><span class="op" id="7905923">(</span><span class="op" id="7905924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7905928">return</span>&nbsp;<span class="ident" id="7905935">nil</span><span class="op" id="7905938">,</span>&nbsp;<span class="ident" id="7905940"><a href="/database/sql/fakedb_test.go.html#7903824">errf</a></span><span class="op" id="7905944">(</span><span class="string" id="7905945">&#34;invalid&nbsp;INSERT&nbsp;syntax&nbsp;with&nbsp;%d&nbsp;parts;&nbsp;want&nbsp;2&#34;</span><span class="op" id="7905990">,</span>&nbsp;<span class="builtinfunc" id="7905992">len</span><span class="op" id="7905995">(</span><span class="ident" id="7905996"><a href="/database/sql/fakedb_test.go.html#7905850">parts</a></span><span class="op" id="7906001">)</span><span class="op" id="7906002">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7906005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7906008"><a href="/database/sql/fakedb_test.go.html#7905834">stmt</a></span><span class="op" id="7906012">.</span><span class="ident" id="7906013">table</span>&nbsp;<span class="op" id="7906019">=</span>&nbsp;<span class="ident" id="7906021"><a href="/database/sql/fakedb_test.go.html#7905850">parts</a></span><span class="op" id="7906026">[</span><span class="num" id="7906027">0</span><span class="op" id="7906028">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7906031">for</span>&nbsp;<span class="ident" id="7906035">n</span><span class="op" id="7906036">,</span>&nbsp;<span class="ident" id="7906038">colspec</span>&nbsp;<span class="op" id="7906046">:=</span>&nbsp;<span class="keyword" id="7906049">range</span>&nbsp;<span class="ident" id="7906055"><a href="/database/sql/fakedb_test.go.html#7896258">strings</a></span><span class="op" id="7906062">.</span><span class="ident" id="7906063">Split</span><span class="op" id="7906068">(</span><span class="ident" id="7906069"><a href="/database/sql/fakedb_test.go.html#7905850">parts</a></span><span class="op" id="7906074">[</span><span class="num" id="7906075">1</span><span class="op" id="7906076">]</span><span class="op" id="7906077">,</span>&nbsp;<span class="string" id="7906079">&#34;,&#34;</span><span class="op" id="7906082">)</span>&nbsp;<span class="op" id="7906084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7906088">nameVal</span>&nbsp;<span class="op" id="7906096">:=</span>&nbsp;<span class="ident" id="7906099"><a href="/database/sql/fakedb_test.go.html#7896258">strings</a></span><span class="op" id="7906106">.</span><span class="ident" id="7906107">Split</span><span class="op" id="7906112">(</span><span class="ident" id="7906113"><a href="/database/sql/fakedb_test.go.html#7906038">colspec</a></span><span class="op" id="7906120">,</span>&nbsp;<span class="string" id="7906122">&#34;=&#34;</span><span class="op" id="7906125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7906129">if</span>&nbsp;<span class="builtinfunc" id="7906132">len</span><span class="op" id="7906135">(</span><span class="ident" id="7906136"><a href="/database/sql/fakedb_test.go.html#7906088">nameVal</a></span><span class="op" id="7906143">)</span>&nbsp;<span class="op" id="7906145">!=</span>&nbsp;<span class="num" id="7906148">2</span>&nbsp;<span class="op" id="7906150">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7906155"><a href="/database/sql/fakedb_test.go.html#7905834">stmt</a></span><span class="op" id="7906159">.</span><span class="ident" id="7906160">Close</span><span class="op" id="7906165">(</span><span class="op" id="7906166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7906171">return</span>&nbsp;<span class="ident" id="7906178">nil</span><span class="op" id="7906181">,</span>&nbsp;<span class="ident" id="7906183"><a href="/database/sql/fakedb_test.go.html#7903824">errf</a></span><span class="op" id="7906187">(</span><span class="string" id="7906188">&#34;INSERT&nbsp;table&nbsp;%q&nbsp;has&nbsp;invalid&nbsp;column&nbsp;spec&nbsp;of&nbsp;%q&nbsp;(index&nbsp;%d)&#34;</span><span class="op" id="7906246">,</span>&nbsp;<span class="ident" id="7906248"><a href="/database/sql/fakedb_test.go.html#7905834">stmt</a></span><span class="op" id="7906252">.</span><span class="ident" id="7906253">table</span><span class="op" id="7906258">,</span>&nbsp;<span class="ident" id="7906260"><a href="/database/sql/fakedb_test.go.html#7906038">colspec</a></span><span class="op" id="7906267">,</span>&nbsp;<span class="ident" id="7906269"><a href="/database/sql/fakedb_test.go.html#7906035">n</a></span><span class="op" id="7906270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7906274">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7906278">column</span><span class="op" id="7906284">,</span>&nbsp;<span class="ident" id="7906286">value</span>&nbsp;<span class="op" id="7906292">:=</span>&nbsp;<span class="ident" id="7906295"><a href="/database/sql/fakedb_test.go.html#7906088">nameVal</a></span><span class="op" id="7906302">[</span><span class="num" id="7906303">0</span><span class="op" id="7906304">]</span><span class="op" id="7906305">,</span>&nbsp;<span class="ident" id="7906307"><a href="/database/sql/fakedb_test.go.html#7906088">nameVal</a></span><span class="op" id="7906314">[</span><span class="num" id="7906315">1</span><span class="op" id="7906316">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7906320">ctype</span><span class="op" id="7906325">,</span>&nbsp;<span class="ident" id="7906327">ok</span>&nbsp;<span class="op" id="7906330">:=</span>&nbsp;<span class="ident" id="7906333"><a href="/database/sql/fakedb_test.go.html#7905807">c</a></span><span class="op" id="7906334">.</span><span class="ident" id="7906335">db</span><span class="op" id="7906337">.</span><span class="ident" id="7906338">columnType</span><span class="op" id="7906348">(</span><span class="ident" id="7906349"><a href="/database/sql/fakedb_test.go.html#7905834">stmt</a></span><span class="op" id="7906353">.</span><span class="ident" id="7906354">table</span><span class="op" id="7906359">,</span>&nbsp;<span class="ident" id="7906361"><a href="/database/sql/fakedb_test.go.html#7906278">column</a></span><span class="op" id="7906367">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7906371">if</span>&nbsp;<span class="op" id="7906374">!</span><span class="ident" id="7906375"><a href="/database/sql/fakedb_test.go.html#7906327">ok</a></span>&nbsp;<span class="op" id="7906378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7906383"><a href="/database/sql/fakedb_test.go.html#7905834">stmt</a></span><span class="op" id="7906387">.</span><span class="ident" id="7906388">Close</span><span class="op" id="7906393">(</span><span class="op" id="7906394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7906399">return</span>&nbsp;<span class="ident" id="7906406">nil</span><span class="op" id="7906409">,</span>&nbsp;<span class="ident" id="7906411"><a href="/database/sql/fakedb_test.go.html#7903824">errf</a></span><span class="op" id="7906415">(</span><span class="string" id="7906416">&#34;INSERT&nbsp;table&nbsp;%q&nbsp;references&nbsp;non-existent&nbsp;column&nbsp;%q&#34;</span><span class="op" id="7906467">,</span>&nbsp;<span class="ident" id="7906469"><a href="/database/sql/fakedb_test.go.html#7905834">stmt</a></span><span class="op" id="7906473">.</span><span class="ident" id="7906474">table</span><span class="op" id="7906479">,</span>&nbsp;<span class="ident" id="7906481"><a href="/database/sql/fakedb_test.go.html#7906278">column</a></span><span class="op" id="7906487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7906491">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7906495"><a href="/database/sql/fakedb_test.go.html#7905834">stmt</a></span><span class="op" id="7906499">.</span><span class="ident" id="7906500">colName</span>&nbsp;<span class="op" id="7906508">=</span>&nbsp;<span class="builtinfunc" id="7906510">append</span><span class="op" id="7906516">(</span><span class="ident" id="7906517"><a href="/database/sql/fakedb_test.go.html#7905834">stmt</a></span><span class="op" id="7906521">.</span><span class="ident" id="7906522">colName</span><span class="op" id="7906529">,</span>&nbsp;<span class="ident" id="7906531"><a href="/database/sql/fakedb_test.go.html#7906278">column</a></span><span class="op" id="7906537">)</span><br>
<span class="lineno">430</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7906542">if</span>&nbsp;<span class="ident" id="7906545"><a href="/database/sql/fakedb_test.go.html#7906286">value</a></span>&nbsp;<span class="op" id="7906551">!=</span>&nbsp;<span class="string" id="7906554">&#34;?&#34;</span>&nbsp;<span class="op" id="7906558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7906563">var</span>&nbsp;<span class="ident" id="7906567">subsetVal</span>&nbsp;<span class="keyword" id="7906577">interface</span><span class="op" id="7906586">{</span><span class="op" id="7906587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7906592">//&nbsp;Convert&nbsp;to&nbsp;driver&nbsp;subset&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7906628">switch</span>&nbsp;<span class="ident" id="7906635"><a href="/database/sql/fakedb_test.go.html#7906320">ctype</a></span>&nbsp;<span class="op" id="7906641">{</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7906646">case</span>&nbsp;<span class="string" id="7906651">&#34;string&#34;</span><span class="op" id="7906659">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7906665"><a href="/database/sql/fakedb_test.go.html#7906567">subsetVal</a></span>&nbsp;<span class="op" id="7906675">=</span>&nbsp;<span class="op" id="7906677">[</span><span class="op" id="7906678">]</span><span class="builtintype" id="7906679">byte</span><span class="op" id="7906683">(</span><span class="ident" id="7906684"><a href="/database/sql/fakedb_test.go.html#7906286">value</a></span><span class="op" id="7906689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7906694">case</span>&nbsp;<span class="string" id="7906699">&#34;blob&#34;</span><span class="op" id="7906705">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7906711"><a href="/database/sql/fakedb_test.go.html#7906567">subsetVal</a></span>&nbsp;<span class="op" id="7906721">=</span>&nbsp;<span class="op" id="7906723">[</span><span class="op" id="7906724">]</span><span class="builtintype" id="7906725">byte</span><span class="op" id="7906729">(</span><span class="ident" id="7906730"><a href="/database/sql/fakedb_test.go.html#7906286">value</a></span><span class="op" id="7906735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7906740">case</span>&nbsp;<span class="string" id="7906745">&#34;int32&#34;</span><span class="op" id="7906752">:</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7906758">i</span><span class="op" id="7906759">,</span>&nbsp;<span class="ident" id="7906761">err</span>&nbsp;<span class="op" id="7906765">:=</span>&nbsp;<span class="ident" id="7906768"><a href="/database/sql/fakedb_test.go.html#7896247">strconv</a></span><span class="op" id="7906775">.</span><span class="ident" id="7906776">Atoi</span><span class="op" id="7906780">(</span><span class="ident" id="7906781"><a href="/database/sql/fakedb_test.go.html#7906286">value</a></span><span class="op" id="7906786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7906792">if</span>&nbsp;<span class="ident" id="7906795"><a href="/database/sql/fakedb_test.go.html#7906761">err</a></span>&nbsp;<span class="op" id="7906799">!=</span>&nbsp;<span class="ident" id="7906802">nil</span>&nbsp;<span class="op" id="7906806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7906813"><a href="/database/sql/fakedb_test.go.html#7905834">stmt</a></span><span class="op" id="7906817">.</span><span class="ident" id="7906818">Close</span><span class="op" id="7906823">(</span><span class="op" id="7906824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7906831">return</span>&nbsp;<span class="ident" id="7906838">nil</span><span class="op" id="7906841">,</span>&nbsp;<span class="ident" id="7906843"><a href="/database/sql/fakedb_test.go.html#7903824">errf</a></span><span class="op" id="7906847">(</span><span class="string" id="7906848">&#34;invalid&nbsp;conversion&nbsp;to&nbsp;int32&nbsp;from&nbsp;%q&#34;</span><span class="op" id="7906885">,</span>&nbsp;<span class="ident" id="7906887"><a href="/database/sql/fakedb_test.go.html#7906286">value</a></span><span class="op" id="7906892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7906898">}</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7906904"><a href="/database/sql/fakedb_test.go.html#7906567">subsetVal</a></span>&nbsp;<span class="op" id="7906914">=</span>&nbsp;<span class="ident" id="7906916">int64</span><span class="op" id="7906921">(</span><span class="ident" id="7906922"><a href="/database/sql/fakedb_test.go.html#7906758">i</a></span><span class="op" id="7906923">)</span>&nbsp;<span class="comment" id="7906925">//&nbsp;int64&nbsp;is&nbsp;a&nbsp;subset&nbsp;type,&nbsp;but&nbsp;not&nbsp;int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7906969">default</span><span class="op" id="7906976">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7906982"><a href="/database/sql/fakedb_test.go.html#7905834">stmt</a></span><span class="op" id="7906986">.</span><span class="ident" id="7906987">Close</span><span class="op" id="7906992">(</span><span class="op" id="7906993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7906999">return</span>&nbsp;<span class="ident" id="7907006">nil</span><span class="op" id="7907009">,</span>&nbsp;<span class="ident" id="7907011"><a href="/database/sql/fakedb_test.go.html#7903824">errf</a></span><span class="op" id="7907015">(</span><span class="string" id="7907016">&#34;unsupported&nbsp;conversion&nbsp;for&nbsp;pre-bound&nbsp;parameter&nbsp;%q&nbsp;to&nbsp;type&nbsp;%q&#34;</span><span class="op" id="7907078">,</span>&nbsp;<span class="ident" id="7907080"><a href="/database/sql/fakedb_test.go.html#7906286">value</a></span><span class="op" id="7907085">,</span>&nbsp;<span class="ident" id="7907087"><a href="/database/sql/fakedb_test.go.html#7906320">ctype</a></span><span class="op" id="7907092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7907097">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7907102"><a href="/database/sql/fakedb_test.go.html#7905834">stmt</a></span><span class="op" id="7907106">.</span><span class="ident" id="7907107">colValue</span>&nbsp;<span class="op" id="7907116">=</span>&nbsp;<span class="builtinfunc" id="7907118">append</span><span class="op" id="7907124">(</span><span class="ident" id="7907125"><a href="/database/sql/fakedb_test.go.html#7905834">stmt</a></span><span class="op" id="7907129">.</span><span class="ident" id="7907130">colValue</span><span class="op" id="7907138">,</span>&nbsp;<span class="ident" id="7907140"><a href="/database/sql/fakedb_test.go.html#7906567">subsetVal</a></span><span class="op" id="7907149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7907153">}</span>&nbsp;<span class="keyword" id="7907155">else</span>&nbsp;<span class="op" id="7907160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7907165"><a href="/database/sql/fakedb_test.go.html#7905834">stmt</a></span><span class="op" id="7907169">.</span><span class="ident" id="7907170">placeholders</span><span class="op" id="7907182">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7907188"><a href="/database/sql/fakedb_test.go.html#7905834">stmt</a></span><span class="op" id="7907192">.</span><span class="ident" id="7907193">placeholderConverter</span>&nbsp;<span class="op" id="7907214">=</span>&nbsp;<span class="builtinfunc" id="7907216">append</span><span class="op" id="7907222">(</span><span class="ident" id="7907223"><a href="/database/sql/fakedb_test.go.html#7905834">stmt</a></span><span class="op" id="7907227">.</span><span class="ident" id="7907228">placeholderConverter</span><span class="op" id="7907248">,</span>&nbsp;<span class="ident" id="7907250"><a href="/database/sql/fakedb_test.go.html#7915415">converterForType</a></span><span class="op" id="7907266">(</span><span class="ident" id="7907267"><a href="/database/sql/fakedb_test.go.html#7906320">ctype</a></span><span class="op" id="7907272">)</span><span class="op" id="7907273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7907278"><a href="/database/sql/fakedb_test.go.html#7905834">stmt</a></span><span class="op" id="7907282">.</span><span class="ident" id="7907283">colValue</span>&nbsp;<span class="op" id="7907292">=</span>&nbsp;<span class="builtinfunc" id="7907294">append</span><span class="op" id="7907300">(</span><span class="ident" id="7907301"><a href="/database/sql/fakedb_test.go.html#7905834">stmt</a></span><span class="op" id="7907305">.</span><span class="ident" id="7907306">colValue</span><span class="op" id="7907314">,</span>&nbsp;<span class="string" id="7907316">&#34;?&#34;</span><span class="op" id="7907319">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7907323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7907326">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7907329">return</span>&nbsp;<span class="ident" id="7907336"><a href="/database/sql/fakedb_test.go.html#7905834">stmt</a></span><span class="op" id="7907340">,</span>&nbsp;<span class="ident" id="7907342">nil</span><br>
<span class="lineno"></span><span class="op" id="7907346">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">460</span><span class="comment" id="7907349">//&nbsp;hook&nbsp;to&nbsp;simulate&nbsp;broken&nbsp;connections</span><br>
<span class="lineno"></span><span class="keyword" id="7907388">var</span>&nbsp;<span class="ident" id="7907392">hookPrepareBadConn</span>&nbsp;<span class="keyword" id="7907411">func</span><span class="op" id="7907415">(</span><span class="op" id="7907416">)</span>&nbsp;<span class="builtintype" id="7907418">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7907424">func</span>&nbsp;<span class="op" id="7907429">(</span><span class="ident" id="7907430">c</span>&nbsp;<span class="op" id="7907432">*</span><span class="ident" id="7907433"><a href="/database/sql/fakedb_test.go.html#7897753">fakeConn</a></span><span class="op" id="7907441">)</span>&nbsp;<span class="ident" id="7907443">Prepare</span><span class="op" id="7907450">(</span><span class="ident" id="7907451">query</span>&nbsp;<span class="builtintype" id="7907457">string</span><span class="op" id="7907463">)</span>&nbsp;<span class="op" id="7907465">(</span><span class="ident" id="7907466"><a href="/database/sql/fakedb_test.go.html#7896186">driver</a></span><span class="op" id="7907472">.</span><span class="ident" id="7907473">Stmt</span><span class="op" id="7907477">,</span>&nbsp;<span class="builtintype" id="7907479">error</span><span class="op" id="7907484">)</span>&nbsp;<span class="op" id="7907486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7907489"><a href="/database/sql/fakedb_test.go.html#7907430">c</a></span><span class="op" id="7907490">.</span><span class="ident" id="7907491">numPrepare</span><span class="op" id="7907501">++</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7907505">if</span>&nbsp;<span class="ident" id="7907508"><a href="/database/sql/fakedb_test.go.html#7907430">c</a></span><span class="op" id="7907509">.</span><span class="ident" id="7907510">db</span>&nbsp;<span class="op" id="7907513">==</span>&nbsp;<span class="ident" id="7907516">nil</span>&nbsp;<span class="op" id="7907520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7907524">panic</span><span class="op" id="7907529">(</span><span class="string" id="7907530">&#34;nil&nbsp;c.db;&nbsp;conn&nbsp;=&nbsp;&#34;</span>&nbsp;<span class="op" id="7907550">+</span>&nbsp;<span class="ident" id="7907552"><a href="/database/sql/fakedb_test.go.html#7896219">fmt</a></span><span class="op" id="7907555">.</span><span class="ident" id="7907556">Sprintf</span><span class="op" id="7907563">(</span><span class="string" id="7907564">&#34;%#v&#34;</span><span class="op" id="7907569">,</span>&nbsp;<span class="ident" id="7907571"><a href="/database/sql/fakedb_test.go.html#7907430">c</a></span><span class="op" id="7907572">)</span><span class="op" id="7907573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7907576">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7907580">if</span>&nbsp;<span class="ident" id="7907583"><a href="/database/sql/fakedb_test.go.html#7907392">hookPrepareBadConn</a></span>&nbsp;<span class="op" id="7907602">!=</span>&nbsp;<span class="ident" id="7907605">nil</span>&nbsp;<span class="op" id="7907609">&amp;&amp;</span>&nbsp;<span class="ident" id="7907612"><a href="/database/sql/fakedb_test.go.html#7907392">hookPrepareBadConn</a></span><span class="op" id="7907630">(</span><span class="op" id="7907631">)</span>&nbsp;<span class="op" id="7907633">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7907637">return</span>&nbsp;<span class="ident" id="7907644">nil</span><span class="op" id="7907647">,</span>&nbsp;<span class="ident" id="7907649"><a href="/database/sql/fakedb_test.go.html#7896186">driver</a></span><span class="op" id="7907655">.</span><span class="ident" id="7907656">ErrBadConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7907668">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7907672">parts</span>&nbsp;<span class="op" id="7907678">:=</span>&nbsp;<span class="ident" id="7907681"><a href="/database/sql/fakedb_test.go.html#7896258">strings</a></span><span class="op" id="7907688">.</span><span class="ident" id="7907689">Split</span><span class="op" id="7907694">(</span><span class="ident" id="7907695"><a href="/database/sql/fakedb_test.go.html#7907451">query</a></span><span class="op" id="7907700">,</span>&nbsp;<span class="string" id="7907702">&#34;|&#34;</span><span class="op" id="7907705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7907708">if</span>&nbsp;<span class="builtinfunc" id="7907711">len</span><span class="op" id="7907714">(</span><span class="ident" id="7907715"><a href="/database/sql/fakedb_test.go.html#7907672">parts</a></span><span class="op" id="7907720">)</span>&nbsp;<span class="op" id="7907722">&lt;</span>&nbsp;<span class="num" id="7907724">1</span>&nbsp;<span class="op" id="7907726">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7907730">return</span>&nbsp;<span class="ident" id="7907737">nil</span><span class="op" id="7907740">,</span>&nbsp;<span class="ident" id="7907742"><a href="/database/sql/fakedb_test.go.html#7903824">errf</a></span><span class="op" id="7907746">(</span><span class="string" id="7907747">&#34;empty&nbsp;query&#34;</span><span class="op" id="7907760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7907763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7907766">cmd</span>&nbsp;<span class="op" id="7907770">:=</span>&nbsp;<span class="ident" id="7907773"><a href="/database/sql/fakedb_test.go.html#7907672">parts</a></span><span class="op" id="7907778">[</span><span class="num" id="7907779">0</span><span class="op" id="7907780">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7907783"><a href="/database/sql/fakedb_test.go.html#7907672">parts</a></span>&nbsp;<span class="op" id="7907789">=</span>&nbsp;<span class="ident" id="7907791"><a href="/database/sql/fakedb_test.go.html#7907672">parts</a></span><span class="op" id="7907796">[</span><span class="num" id="7907797">1</span><span class="op" id="7907798">:</span><span class="op" id="7907799">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7907802">stmt</span>&nbsp;<span class="op" id="7907807">:=</span>&nbsp;<span class="op" id="7907810">&amp;</span><span class="ident" id="7907811"><a href="/database/sql/fakedb_test.go.html#7898067">fakeStmt</a></span><span class="op" id="7907819">{</span><span class="ident" id="7907820">q</span><span class="op" id="7907821">:</span>&nbsp;<span class="ident" id="7907823"><a href="/database/sql/fakedb_test.go.html#7907451">query</a></span><span class="op" id="7907828">,</span>&nbsp;<span class="ident" id="7907830">c</span><span class="op" id="7907831">:</span>&nbsp;<span class="ident" id="7907833"><a href="/database/sql/fakedb_test.go.html#7907430">c</a></span><span class="op" id="7907834">,</span>&nbsp;<span class="ident" id="7907836">cmd</span><span class="op" id="7907839">:</span>&nbsp;<span class="ident" id="7907841"><a href="/database/sql/fakedb_test.go.html#7907766">cmd</a></span><span class="op" id="7907844">}</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7907847"><a href="/database/sql/fakedb_test.go.html#7907430">c</a></span><span class="op" id="7907848">.</span><span class="ident" id="7907849">incrStat</span><span class="op" id="7907857">(</span><span class="op" id="7907858">&amp;</span><span class="ident" id="7907859"><a href="/database/sql/fakedb_test.go.html#7907430">c</a></span><span class="op" id="7907860">.</span><span class="ident" id="7907861">stmtsMade</span><span class="op" id="7907870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7907873">switch</span>&nbsp;<span class="ident" id="7907880"><a href="/database/sql/fakedb_test.go.html#7907766">cmd</a></span>&nbsp;<span class="op" id="7907884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7907887">case</span>&nbsp;<span class="string" id="7907892">&#34;WIPE&#34;</span><span class="op" id="7907898">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7907902">//&nbsp;Nothing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7907914">case</span>&nbsp;<span class="string" id="7907919">&#34;SELECT&#34;</span><span class="op" id="7907927">:</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7907931">return</span>&nbsp;<span class="ident" id="7907938"><a href="/database/sql/fakedb_test.go.html#7907430">c</a></span><span class="op" id="7907939">.</span><span class="ident" id="7907940">prepareSelect</span><span class="op" id="7907953">(</span><span class="ident" id="7907954"><a href="/database/sql/fakedb_test.go.html#7907802">stmt</a></span><span class="op" id="7907958">,</span>&nbsp;<span class="ident" id="7907960"><a href="/database/sql/fakedb_test.go.html#7907672">parts</a></span><span class="op" id="7907965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7907968">case</span>&nbsp;<span class="string" id="7907973">&#34;CREATE&#34;</span><span class="op" id="7907981">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7907985">return</span>&nbsp;<span class="ident" id="7907992"><a href="/database/sql/fakedb_test.go.html#7907430">c</a></span><span class="op" id="7907993">.</span><span class="ident" id="7907994">prepareCreate</span><span class="op" id="7908007">(</span><span class="ident" id="7908008"><a href="/database/sql/fakedb_test.go.html#7907802">stmt</a></span><span class="op" id="7908012">,</span>&nbsp;<span class="ident" id="7908014"><a href="/database/sql/fakedb_test.go.html#7907672">parts</a></span><span class="op" id="7908019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7908022">case</span>&nbsp;<span class="string" id="7908027">&#34;INSERT&#34;</span><span class="op" id="7908035">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7908039">return</span>&nbsp;<span class="ident" id="7908046"><a href="/database/sql/fakedb_test.go.html#7907430">c</a></span><span class="op" id="7908047">.</span><span class="ident" id="7908048">prepareInsert</span><span class="op" id="7908061">(</span><span class="ident" id="7908062"><a href="/database/sql/fakedb_test.go.html#7907802">stmt</a></span><span class="op" id="7908066">,</span>&nbsp;<span class="ident" id="7908068"><a href="/database/sql/fakedb_test.go.html#7907672">parts</a></span><span class="op" id="7908073">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7908076">case</span>&nbsp;<span class="string" id="7908081">&#34;NOSERT&#34;</span><span class="op" id="7908089">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7908093">//&nbsp;Do&nbsp;all&nbsp;the&nbsp;prep-work&nbsp;like&nbsp;for&nbsp;an&nbsp;INSERT&nbsp;but&nbsp;don&#39;t&nbsp;actually&nbsp;insert&nbsp;the&nbsp;row.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7908173">//&nbsp;Used&nbsp;for&nbsp;some&nbsp;of&nbsp;the&nbsp;concurrent&nbsp;tests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7908217">return</span>&nbsp;<span class="ident" id="7908224"><a href="/database/sql/fakedb_test.go.html#7907430">c</a></span><span class="op" id="7908225">.</span><span class="ident" id="7908226">prepareInsert</span><span class="op" id="7908239">(</span><span class="ident" id="7908240"><a href="/database/sql/fakedb_test.go.html#7907802">stmt</a></span><span class="op" id="7908244">,</span>&nbsp;<span class="ident" id="7908246"><a href="/database/sql/fakedb_test.go.html#7907672">parts</a></span><span class="op" id="7908251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7908254">default</span><span class="op" id="7908261">:</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7908265"><a href="/database/sql/fakedb_test.go.html#7907802">stmt</a></span><span class="op" id="7908269">.</span><span class="ident" id="7908270">Close</span><span class="op" id="7908275">(</span><span class="op" id="7908276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7908280">return</span>&nbsp;<span class="ident" id="7908287">nil</span><span class="op" id="7908290">,</span>&nbsp;<span class="ident" id="7908292"><a href="/database/sql/fakedb_test.go.html#7903824">errf</a></span><span class="op" id="7908296">(</span><span class="string" id="7908297">&#34;unsupported&nbsp;command&nbsp;type&nbsp;%q&#34;</span><span class="op" id="7908326">,</span>&nbsp;<span class="ident" id="7908328"><a href="/database/sql/fakedb_test.go.html#7907766">cmd</a></span><span class="op" id="7908331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7908334">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7908337">return</span>&nbsp;<span class="ident" id="7908344"><a href="/database/sql/fakedb_test.go.html#7907802">stmt</a></span><span class="op" id="7908348">,</span>&nbsp;<span class="ident" id="7908350">nil</span><br>
<span class="lineno"></span><span class="op" id="7908354">}</span><br>
<span class="lineno">500</span><br>
<span class="lineno"></span><span class="keyword" id="7908357">func</span>&nbsp;<span class="op" id="7908362">(</span><span class="ident" id="7908363">s</span>&nbsp;<span class="op" id="7908365">*</span><span class="ident" id="7908366"><a href="/database/sql/fakedb_test.go.html#7898067">fakeStmt</a></span><span class="op" id="7908374">)</span>&nbsp;<span class="ident" id="7908376">ColumnConverter</span><span class="op" id="7908391">(</span><span class="ident" id="7908392">idx</span>&nbsp;<span class="builtintype" id="7908396">int</span><span class="op" id="7908399">)</span>&nbsp;<span class="ident" id="7908401"><a href="/database/sql/fakedb_test.go.html#7896186">driver</a></span><span class="op" id="7908407">.</span><span class="ident" id="7908408">ValueConverter</span>&nbsp;<span class="op" id="7908423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7908426">if</span>&nbsp;<span class="builtinfunc" id="7908429">len</span><span class="op" id="7908432">(</span><span class="ident" id="7908433"><a href="/database/sql/fakedb_test.go.html#7908363">s</a></span><span class="op" id="7908434">.</span><span class="ident" id="7908435">placeholderConverter</span><span class="op" id="7908455">)</span>&nbsp;<span class="op" id="7908457">==</span>&nbsp;<span class="num" id="7908460">0</span>&nbsp;<span class="op" id="7908462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7908466">return</span>&nbsp;<span class="ident" id="7908473"><a href="/database/sql/fakedb_test.go.html#7896186">driver</a></span><span class="op" id="7908479">.</span><span class="ident" id="7908480">DefaultParameterConverter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7908507">}</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7908510">return</span>&nbsp;<span class="ident" id="7908517"><a href="/database/sql/fakedb_test.go.html#7908363">s</a></span><span class="op" id="7908518">.</span><span class="ident" id="7908519">placeholderConverter</span><span class="op" id="7908539">[</span><span class="ident" id="7908540"><a href="/database/sql/fakedb_test.go.html#7908392">idx</a></span><span class="op" id="7908543">]</span><br>
<span class="lineno"></span><span class="op" id="7908545">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7908548">func</span>&nbsp;<span class="op" id="7908553">(</span><span class="ident" id="7908554">s</span>&nbsp;<span class="op" id="7908556">*</span><span class="ident" id="7908557"><a href="/database/sql/fakedb_test.go.html#7898067">fakeStmt</a></span><span class="op" id="7908565">)</span>&nbsp;<span class="ident" id="7908567">Close</span><span class="op" id="7908572">(</span><span class="op" id="7908573">)</span>&nbsp;<span class="builtintype" id="7908575">error</span>&nbsp;<span class="op" id="7908581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7908584">if</span>&nbsp;<span class="ident" id="7908587"><a href="/database/sql/fakedb_test.go.html#7908554">s</a></span><span class="op" id="7908588">.</span><span class="ident" id="7908589">c</span>&nbsp;<span class="op" id="7908591">==</span>&nbsp;<span class="ident" id="7908594">nil</span>&nbsp;<span class="op" id="7908598">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7908602">panic</span><span class="op" id="7908607">(</span><span class="string" id="7908608">&#34;nil&nbsp;conn&nbsp;in&nbsp;fakeStmt.Close&#34;</span><span class="op" id="7908636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7908639">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7908642">if</span>&nbsp;<span class="ident" id="7908645"><a href="/database/sql/fakedb_test.go.html#7908554">s</a></span><span class="op" id="7908646">.</span><span class="ident" id="7908647">c</span><span class="op" id="7908648">.</span><span class="ident" id="7908649">db</span>&nbsp;<span class="op" id="7908652">==</span>&nbsp;<span class="ident" id="7908655">nil</span>&nbsp;<span class="op" id="7908659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7908663">panic</span><span class="op" id="7908668">(</span><span class="string" id="7908669">&#34;in&nbsp;fakeStmt.Close,&nbsp;conn&#39;s&nbsp;db&nbsp;is&nbsp;nil&nbsp;(already&nbsp;closed)&#34;</span><span class="op" id="7908723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7908726">}</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7908729">if</span>&nbsp;<span class="op" id="7908732">!</span><span class="ident" id="7908733"><a href="/database/sql/fakedb_test.go.html#7908554">s</a></span><span class="op" id="7908734">.</span><span class="ident" id="7908735">closed</span>&nbsp;<span class="op" id="7908742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7908746"><a href="/database/sql/fakedb_test.go.html#7908554">s</a></span><span class="op" id="7908747">.</span><span class="ident" id="7908748">c</span><span class="op" id="7908749">.</span><span class="ident" id="7908750">incrStat</span><span class="op" id="7908758">(</span><span class="op" id="7908759">&amp;</span><span class="ident" id="7908760"><a href="/database/sql/fakedb_test.go.html#7908554">s</a></span><span class="op" id="7908761">.</span><span class="ident" id="7908762">c</span><span class="op" id="7908763">.</span><span class="ident" id="7908764">stmtsClosed</span><span class="op" id="7908775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7908779"><a href="/database/sql/fakedb_test.go.html#7908554">s</a></span><span class="op" id="7908780">.</span><span class="ident" id="7908781">closed</span>&nbsp;<span class="op" id="7908788">=</span>&nbsp;<span class="ident" id="7908790">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7908796">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7908799">return</span>&nbsp;<span class="ident" id="7908806">nil</span><br>
<span class="lineno">520</span><span class="op" id="7908810">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7908813">var</span>&nbsp;<span class="ident" id="7908817">errClosed</span>&nbsp;<span class="op" id="7908827">=</span>&nbsp;<span class="ident" id="7908829"><a href="/database/sql/fakedb_test.go.html#7896209">errors</a></span><span class="op" id="7908835">.</span><span class="ident" id="7908836">New</span><span class="op" id="7908839">(</span><span class="string" id="7908840">&#34;fakedb:&nbsp;statement&nbsp;has&nbsp;been&nbsp;closed&#34;</span><span class="op" id="7908875">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7908878">//&nbsp;hook&nbsp;to&nbsp;simulate&nbsp;broken&nbsp;connections</span><br>
<span class="lineno">525</span><span class="keyword" id="7908917">var</span>&nbsp;<span class="ident" id="7908921">hookExecBadConn</span>&nbsp;<span class="keyword" id="7908937">func</span><span class="op" id="7908941">(</span><span class="op" id="7908942">)</span>&nbsp;<span class="builtintype" id="7908944">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7908950">func</span>&nbsp;<span class="op" id="7908955">(</span><span class="ident" id="7908956">s</span>&nbsp;<span class="op" id="7908958">*</span><span class="ident" id="7908959"><a href="/database/sql/fakedb_test.go.html#7898067">fakeStmt</a></span><span class="op" id="7908967">)</span>&nbsp;<span class="ident" id="7908969">Exec</span><span class="op" id="7908973">(</span><span class="ident" id="7908974">args</span>&nbsp;<span class="op" id="7908979">[</span><span class="op" id="7908980">]</span><span class="ident" id="7908981"><a href="/database/sql/fakedb_test.go.html#7896186">driver</a></span><span class="op" id="7908987">.</span><span class="ident" id="7908988">Value</span><span class="op" id="7908993">)</span>&nbsp;<span class="op" id="7908995">(</span><span class="ident" id="7908996"><a href="/database/sql/fakedb_test.go.html#7896186">driver</a></span><span class="op" id="7909002">.</span><span class="ident" id="7909003">Result</span><span class="op" id="7909009">,</span>&nbsp;<span class="builtintype" id="7909011">error</span><span class="op" id="7909016">)</span>&nbsp;<span class="op" id="7909018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7909021">if</span>&nbsp;<span class="ident" id="7909024"><a href="/database/sql/fakedb_test.go.html#7908956">s</a></span><span class="op" id="7909025">.</span><span class="ident" id="7909026">closed</span>&nbsp;<span class="op" id="7909033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7909037">return</span>&nbsp;<span class="ident" id="7909044">nil</span><span class="op" id="7909047">,</span>&nbsp;<span class="ident" id="7909049"><a href="/database/sql/fakedb_test.go.html#7908817">errClosed</a></span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7909060">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7909064">if</span>&nbsp;<span class="ident" id="7909067"><a href="/database/sql/fakedb_test.go.html#7908921">hookExecBadConn</a></span>&nbsp;<span class="op" id="7909083">!=</span>&nbsp;<span class="ident" id="7909086">nil</span>&nbsp;<span class="op" id="7909090">&amp;&amp;</span>&nbsp;<span class="ident" id="7909093"><a href="/database/sql/fakedb_test.go.html#7908921">hookExecBadConn</a></span><span class="op" id="7909108">(</span><span class="op" id="7909109">)</span>&nbsp;<span class="op" id="7909111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7909115">return</span>&nbsp;<span class="ident" id="7909122">nil</span><span class="op" id="7909125">,</span>&nbsp;<span class="ident" id="7909127"><a href="/database/sql/fakedb_test.go.html#7896186">driver</a></span><span class="op" id="7909133">.</span><span class="ident" id="7909134">ErrBadConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7909146">}</span><br>
<span class="lineno">535</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7909150">err</span>&nbsp;<span class="op" id="7909154">:=</span>&nbsp;<span class="ident" id="7909157"><a href="/database/sql/fakedb_test.go.html#7902760">checkSubsetTypes</a></span><span class="op" id="7909173">(</span><span class="ident" id="7909174"><a href="/database/sql/fakedb_test.go.html#7908974">args</a></span><span class="op" id="7909178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7909181">if</span>&nbsp;<span class="ident" id="7909184"><a href="/database/sql/fakedb_test.go.html#7909150">err</a></span>&nbsp;<span class="op" id="7909188">!=</span>&nbsp;<span class="ident" id="7909191">nil</span>&nbsp;<span class="op" id="7909195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7909199">return</span>&nbsp;<span class="ident" id="7909206">nil</span><span class="op" id="7909209">,</span>&nbsp;<span class="ident" id="7909211"><a href="/database/sql/fakedb_test.go.html#7909150">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7909216">}</span><br>
<span class="lineno">540</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7909220">db</span>&nbsp;<span class="op" id="7909223">:=</span>&nbsp;<span class="ident" id="7909226"><a href="/database/sql/fakedb_test.go.html#7908956">s</a></span><span class="op" id="7909227">.</span><span class="ident" id="7909228">c</span><span class="op" id="7909229">.</span><span class="ident" id="7909230">db</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7909234">switch</span>&nbsp;<span class="ident" id="7909241"><a href="/database/sql/fakedb_test.go.html#7908956">s</a></span><span class="op" id="7909242">.</span><span class="ident" id="7909243">cmd</span>&nbsp;<span class="op" id="7909247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7909250">case</span>&nbsp;<span class="string" id="7909255">&#34;WIPE&#34;</span><span class="op" id="7909261">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7909265"><a href="/database/sql/fakedb_test.go.html#7909220">db</a></span><span class="op" id="7909267">.</span><span class="ident" id="7909268">wipe</span><span class="op" id="7909272">(</span><span class="op" id="7909273">)</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7909277">return</span>&nbsp;<span class="ident" id="7909284"><a href="/database/sql/fakedb_test.go.html#7896186">driver</a></span><span class="op" id="7909290">.</span><span class="ident" id="7909291">ResultNoRows</span><span class="op" id="7909303">,</span>&nbsp;<span class="ident" id="7909305">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7909310">case</span>&nbsp;<span class="string" id="7909315">&#34;CREATE&#34;</span><span class="op" id="7909323">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7909327">if</span>&nbsp;<span class="ident" id="7909330">err</span>&nbsp;<span class="op" id="7909334">:=</span>&nbsp;<span class="ident" id="7909337"><a href="/database/sql/fakedb_test.go.html#7909220">db</a></span><span class="op" id="7909339">.</span><span class="ident" id="7909340">createTable</span><span class="op" id="7909351">(</span><span class="ident" id="7909352"><a href="/database/sql/fakedb_test.go.html#7908956">s</a></span><span class="op" id="7909353">.</span><span class="ident" id="7909354">table</span><span class="op" id="7909359">,</span>&nbsp;<span class="ident" id="7909361"><a href="/database/sql/fakedb_test.go.html#7908956">s</a></span><span class="op" id="7909362">.</span><span class="ident" id="7909363">colName</span><span class="op" id="7909370">,</span>&nbsp;<span class="ident" id="7909372"><a href="/database/sql/fakedb_test.go.html#7908956">s</a></span><span class="op" id="7909373">.</span><span class="ident" id="7909374">colType</span><span class="op" id="7909381">)</span><span class="op" id="7909382">;</span>&nbsp;<span class="ident" id="7909384"><a href="/database/sql/fakedb_test.go.html#7909330">err</a></span>&nbsp;<span class="op" id="7909388">!=</span>&nbsp;<span class="ident" id="7909391">nil</span>&nbsp;<span class="op" id="7909395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7909400">return</span>&nbsp;<span class="ident" id="7909407">nil</span><span class="op" id="7909410">,</span>&nbsp;<span class="ident" id="7909412"><a href="/database/sql/fakedb_test.go.html#7909330">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7909418">}</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7909422">return</span>&nbsp;<span class="ident" id="7909429"><a href="/database/sql/fakedb_test.go.html#7896186">driver</a></span><span class="op" id="7909435">.</span><span class="ident" id="7909436">ResultNoRows</span><span class="op" id="7909448">,</span>&nbsp;<span class="ident" id="7909450">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7909455">case</span>&nbsp;<span class="string" id="7909460">&#34;INSERT&#34;</span><span class="op" id="7909468">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7909472">return</span>&nbsp;<span class="ident" id="7909479"><a href="/database/sql/fakedb_test.go.html#7908956">s</a></span><span class="op" id="7909480">.</span><span class="ident" id="7909481">execInsert</span><span class="op" id="7909491">(</span><span class="ident" id="7909492"><a href="/database/sql/fakedb_test.go.html#7908974">args</a></span><span class="op" id="7909496">,</span>&nbsp;<span class="ident" id="7909498">true</span><span class="op" id="7909502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7909505">case</span>&nbsp;<span class="string" id="7909510">&#34;NOSERT&#34;</span><span class="op" id="7909518">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7909522">//&nbsp;Do&nbsp;all&nbsp;the&nbsp;prep-work&nbsp;like&nbsp;for&nbsp;an&nbsp;INSERT&nbsp;but&nbsp;don&#39;t&nbsp;actually&nbsp;insert&nbsp;the&nbsp;row.</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7909602">//&nbsp;Used&nbsp;for&nbsp;some&nbsp;of&nbsp;the&nbsp;concurrent&nbsp;tests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7909646">return</span>&nbsp;<span class="ident" id="7909653"><a href="/database/sql/fakedb_test.go.html#7908956">s</a></span><span class="op" id="7909654">.</span><span class="ident" id="7909655">execInsert</span><span class="op" id="7909665">(</span><span class="ident" id="7909666"><a href="/database/sql/fakedb_test.go.html#7908974">args</a></span><span class="op" id="7909670">,</span>&nbsp;<span class="ident" id="7909672">false</span><span class="op" id="7909677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7909680">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7909683"><a href="/database/sql/fakedb_test.go.html#7896219">fmt</a></span><span class="op" id="7909686">.</span><span class="ident" id="7909687">Printf</span><span class="op" id="7909693">(</span><span class="string" id="7909694">&#34;EXEC&nbsp;statement,&nbsp;cmd=%q:&nbsp;%#v\n&#34;</span><span class="op" id="7909725">,</span>&nbsp;<span class="ident" id="7909727"><a href="/database/sql/fakedb_test.go.html#7908956">s</a></span><span class="op" id="7909728">.</span><span class="ident" id="7909729">cmd</span><span class="op" id="7909732">,</span>&nbsp;<span class="ident" id="7909734"><a href="/database/sql/fakedb_test.go.html#7908956">s</a></span><span class="op" id="7909735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7909738">return</span>&nbsp;<span class="ident" id="7909745">nil</span><span class="op" id="7909748">,</span>&nbsp;<span class="ident" id="7909750"><a href="/database/sql/fakedb_test.go.html#7896219">fmt</a></span><span class="op" id="7909753">.</span><span class="ident" id="7909754">Errorf</span><span class="op" id="7909760">(</span><span class="string" id="7909761">&#34;unimplemented&nbsp;statement&nbsp;Exec&nbsp;command&nbsp;type&nbsp;of&nbsp;%q&#34;</span><span class="op" id="7909810">,</span>&nbsp;<span class="ident" id="7909812"><a href="/database/sql/fakedb_test.go.html#7908956">s</a></span><span class="op" id="7909813">.</span><span class="ident" id="7909814">cmd</span><span class="op" id="7909817">)</span><br>
<span class="lineno">560</span><span class="op" id="7909819">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7909822">//&nbsp;When&nbsp;doInsert&nbsp;is&nbsp;true,&nbsp;add&nbsp;the&nbsp;row&nbsp;to&nbsp;the&nbsp;table.</span><br>
<span class="lineno"></span><span class="comment" id="7909874">//&nbsp;When&nbsp;doInsert&nbsp;is&nbsp;false&nbsp;do&nbsp;prep-work&nbsp;and&nbsp;error&nbsp;checking,&nbsp;but&nbsp;don&#39;t</span><br>
<span class="lineno"></span><span class="comment" id="7909943">//&nbsp;actually&nbsp;add&nbsp;the&nbsp;row&nbsp;to&nbsp;the&nbsp;table.</span><br>
<span class="lineno">565</span><span class="keyword" id="7909981">func</span>&nbsp;<span class="op" id="7909986">(</span><span class="ident" id="7909987">s</span>&nbsp;<span class="op" id="7909989">*</span><span class="ident" id="7909990"><a href="/database/sql/fakedb_test.go.html#7898067">fakeStmt</a></span><span class="op" id="7909998">)</span>&nbsp;<span class="ident" id="7910000">execInsert</span><span class="op" id="7910010">(</span><span class="ident" id="7910011">args</span>&nbsp;<span class="op" id="7910016">[</span><span class="op" id="7910017">]</span><span class="ident" id="7910018"><a href="/database/sql/fakedb_test.go.html#7896186">driver</a></span><span class="op" id="7910024">.</span><span class="ident" id="7910025">Value</span><span class="op" id="7910030">,</span>&nbsp;<span class="ident" id="7910032">doInsert</span>&nbsp;<span class="builtintype" id="7910041">bool</span><span class="op" id="7910045">)</span>&nbsp;<span class="op" id="7910047">(</span><span class="ident" id="7910048"><a href="/database/sql/fakedb_test.go.html#7896186">driver</a></span><span class="op" id="7910054">.</span><span class="ident" id="7910055">Result</span><span class="op" id="7910061">,</span>&nbsp;<span class="builtintype" id="7910063">error</span><span class="op" id="7910068">)</span>&nbsp;<span class="op" id="7910070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7910073">db</span>&nbsp;<span class="op" id="7910076">:=</span>&nbsp;<span class="ident" id="7910079"><a href="/database/sql/fakedb_test.go.html#7909987">s</a></span><span class="op" id="7910080">.</span><span class="ident" id="7910081">c</span><span class="op" id="7910082">.</span><span class="ident" id="7910083">db</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7910087">if</span>&nbsp;<span class="builtinfunc" id="7910090">len</span><span class="op" id="7910093">(</span><span class="ident" id="7910094"><a href="/database/sql/fakedb_test.go.html#7910011">args</a></span><span class="op" id="7910098">)</span>&nbsp;<span class="op" id="7910100">!=</span>&nbsp;<span class="ident" id="7910103"><a href="/database/sql/fakedb_test.go.html#7909987">s</a></span><span class="op" id="7910104">.</span><span class="ident" id="7910105">placeholders</span>&nbsp;<span class="op" id="7910118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7910122">panic</span><span class="op" id="7910127">(</span><span class="string" id="7910128">&#34;error&nbsp;in&nbsp;pkg&nbsp;db;&nbsp;should&nbsp;only&nbsp;get&nbsp;here&nbsp;if&nbsp;size&nbsp;is&nbsp;correct&#34;</span><span class="op" id="7910186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7910189">}</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7910192"><a href="/database/sql/fakedb_test.go.html#7910073">db</a></span><span class="op" id="7910194">.</span><span class="ident" id="7910195">mu</span><span class="op" id="7910197">.</span><span class="ident" id="7910198">Lock</span><span class="op" id="7910202">(</span><span class="op" id="7910203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7910206">t</span><span class="op" id="7910207">,</span>&nbsp;<span class="ident" id="7910209">ok</span>&nbsp;<span class="op" id="7910212">:=</span>&nbsp;<span class="ident" id="7910215"><a href="/database/sql/fakedb_test.go.html#7910073">db</a></span><span class="op" id="7910217">.</span><span class="ident" id="7910218">table</span><span class="op" id="7910223">(</span><span class="ident" id="7910224"><a href="/database/sql/fakedb_test.go.html#7909987">s</a></span><span class="op" id="7910225">.</span><span class="ident" id="7910226">table</span><span class="op" id="7910231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7910234"><a href="/database/sql/fakedb_test.go.html#7910073">db</a></span><span class="op" id="7910236">.</span><span class="ident" id="7910237">mu</span><span class="op" id="7910239">.</span><span class="ident" id="7910240">Unlock</span><span class="op" id="7910246">(</span><span class="op" id="7910247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7910250">if</span>&nbsp;<span class="op" id="7910253">!</span><span class="ident" id="7910254"><a href="/database/sql/fakedb_test.go.html#7910209">ok</a></span>&nbsp;<span class="op" id="7910257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7910261">return</span>&nbsp;<span class="ident" id="7910268">nil</span><span class="op" id="7910271">,</span>&nbsp;<span class="ident" id="7910273"><a href="/database/sql/fakedb_test.go.html#7896219">fmt</a></span><span class="op" id="7910276">.</span><span class="ident" id="7910277">Errorf</span><span class="op" id="7910283">(</span><span class="string" id="7910284">&#34;fakedb:&nbsp;table&nbsp;%q&nbsp;doesn&#39;t&nbsp;exist&#34;</span><span class="op" id="7910316">,</span>&nbsp;<span class="ident" id="7910318"><a href="/database/sql/fakedb_test.go.html#7909987">s</a></span><span class="op" id="7910319">.</span><span class="ident" id="7910320">table</span><span class="op" id="7910325">)</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7910328">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7910332"><a href="/database/sql/fakedb_test.go.html#7910206">t</a></span><span class="op" id="7910333">.</span><span class="ident" id="7910334">mu</span><span class="op" id="7910336">.</span><span class="ident" id="7910337">Lock</span><span class="op" id="7910341">(</span><span class="op" id="7910342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7910345">defer</span>&nbsp;<span class="ident" id="7910351"><a href="/database/sql/fakedb_test.go.html#7910206">t</a></span><span class="op" id="7910352">.</span><span class="ident" id="7910353">mu</span><span class="op" id="7910355">.</span><span class="ident" id="7910356">Unlock</span><span class="op" id="7910362">(</span><span class="op" id="7910363">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7910367">var</span>&nbsp;<span class="ident" id="7910371">cols</span>&nbsp;<span class="op" id="7910376">[</span><span class="op" id="7910377">]</span><span class="keyword" id="7910378">interface</span><span class="op" id="7910387">{</span><span class="op" id="7910388">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7910391">if</span>&nbsp;<span class="ident" id="7910394"><a href="/database/sql/fakedb_test.go.html#7910032">doInsert</a></span>&nbsp;<span class="op" id="7910403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7910407"><a href="/database/sql/fakedb_test.go.html#7910371">cols</a></span>&nbsp;<span class="op" id="7910412">=</span>&nbsp;<span class="builtinfunc" id="7910414">make</span><span class="op" id="7910418">(</span><span class="op" id="7910419">[</span><span class="op" id="7910420">]</span><span class="keyword" id="7910421">interface</span><span class="op" id="7910430">{</span><span class="op" id="7910431">}</span><span class="op" id="7910432">,</span>&nbsp;<span class="builtinfunc" id="7910434">len</span><span class="op" id="7910437">(</span><span class="ident" id="7910438"><a href="/database/sql/fakedb_test.go.html#7910206">t</a></span><span class="op" id="7910439">.</span><span class="ident" id="7910440">colname</span><span class="op" id="7910447">)</span><span class="op" id="7910448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7910451">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7910454">argPos</span>&nbsp;<span class="op" id="7910461">:=</span>&nbsp;<span class="num" id="7910464">0</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7910467">for</span>&nbsp;<span class="ident" id="7910471">n</span><span class="op" id="7910472">,</span>&nbsp;<span class="ident" id="7910474">colname</span>&nbsp;<span class="op" id="7910482">:=</span>&nbsp;<span class="keyword" id="7910485">range</span>&nbsp;<span class="ident" id="7910491"><a href="/database/sql/fakedb_test.go.html#7909987">s</a></span><span class="op" id="7910492">.</span><span class="ident" id="7910493">colName</span>&nbsp;<span class="op" id="7910501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7910505">colidx</span>&nbsp;<span class="op" id="7910512">:=</span>&nbsp;<span class="ident" id="7910515"><a href="/database/sql/fakedb_test.go.html#7910206">t</a></span><span class="op" id="7910516">.</span><span class="ident" id="7910517">columnIndex</span><span class="op" id="7910528">(</span><span class="ident" id="7910529"><a href="/database/sql/fakedb_test.go.html#7910474">colname</a></span><span class="op" id="7910536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7910540">if</span>&nbsp;<span class="ident" id="7910543"><a href="/database/sql/fakedb_test.go.html#7910505">colidx</a></span>&nbsp;<span class="op" id="7910550">==</span>&nbsp;<span class="op" id="7910553">-</span><span class="num" id="7910554">1</span>&nbsp;<span class="op" id="7910556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7910561">return</span>&nbsp;<span class="ident" id="7910568">nil</span><span class="op" id="7910571">,</span>&nbsp;<span class="ident" id="7910573"><a href="/database/sql/fakedb_test.go.html#7896219">fmt</a></span><span class="op" id="7910576">.</span><span class="ident" id="7910577">Errorf</span><span class="op" id="7910583">(</span><span class="string" id="7910584">&#34;fakedb:&nbsp;column&nbsp;%q&nbsp;doesn&#39;t&nbsp;exist&nbsp;or&nbsp;dropped&nbsp;since&nbsp;prepared&nbsp;statement&nbsp;was&nbsp;created&#34;</span><span class="op" id="7910665">,</span>&nbsp;<span class="ident" id="7910667"><a href="/database/sql/fakedb_test.go.html#7910474">colname</a></span><span class="op" id="7910674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7910678">}</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7910682">var</span>&nbsp;<span class="ident" id="7910686">val</span>&nbsp;<span class="keyword" id="7910690">interface</span><span class="op" id="7910699">{</span><span class="op" id="7910700">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7910704">if</span>&nbsp;<span class="ident" id="7910707">strvalue</span><span class="op" id="7910715">,</span>&nbsp;<span class="ident" id="7910717">ok</span>&nbsp;<span class="op" id="7910720">:=</span>&nbsp;<span class="ident" id="7910723"><a href="/database/sql/fakedb_test.go.html#7909987">s</a></span><span class="op" id="7910724">.</span><span class="ident" id="7910725">colValue</span><span class="op" id="7910733">[</span><span class="ident" id="7910734"><a href="/database/sql/fakedb_test.go.html#7910471">n</a></span><span class="op" id="7910735">]</span><span class="op" id="7910736">.</span><span class="op" id="7910737">(</span><span class="builtintype" id="7910738">string</span><span class="op" id="7910744">)</span><span class="op" id="7910745">;</span>&nbsp;<span class="ident" id="7910747"><a href="/database/sql/fakedb_test.go.html#7910717">ok</a></span>&nbsp;<span class="op" id="7910750">&amp;&amp;</span>&nbsp;<span class="ident" id="7910753"><a href="/database/sql/fakedb_test.go.html#7910707">strvalue</a></span>&nbsp;<span class="op" id="7910762">==</span>&nbsp;<span class="string" id="7910765">&#34;?&#34;</span>&nbsp;<span class="op" id="7910769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7910774"><a href="/database/sql/fakedb_test.go.html#7910686">val</a></span>&nbsp;<span class="op" id="7910778">=</span>&nbsp;<span class="ident" id="7910780"><a href="/database/sql/fakedb_test.go.html#7910011">args</a></span><span class="op" id="7910784">[</span><span class="ident" id="7910785"><a href="/database/sql/fakedb_test.go.html#7910454">argPos</a></span><span class="op" id="7910791">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7910796"><a href="/database/sql/fakedb_test.go.html#7910454">argPos</a></span><span class="op" id="7910802">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7910807">}</span>&nbsp;<span class="keyword" id="7910809">else</span>&nbsp;<span class="op" id="7910814">{</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7910819"><a href="/database/sql/fakedb_test.go.html#7910686">val</a></span>&nbsp;<span class="op" id="7910823">=</span>&nbsp;<span class="ident" id="7910825"><a href="/database/sql/fakedb_test.go.html#7909987">s</a></span><span class="op" id="7910826">.</span><span class="ident" id="7910827">colValue</span><span class="op" id="7910835">[</span><span class="ident" id="7910836"><a href="/database/sql/fakedb_test.go.html#7910471">n</a></span><span class="op" id="7910837">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7910841">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7910845">if</span>&nbsp;<span class="ident" id="7910848"><a href="/database/sql/fakedb_test.go.html#7910032">doInsert</a></span>&nbsp;<span class="op" id="7910857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7910862"><a href="/database/sql/fakedb_test.go.html#7910371">cols</a></span><span class="op" id="7910866">[</span><span class="ident" id="7910867"><a href="/database/sql/fakedb_test.go.html#7910505">colidx</a></span><span class="op" id="7910873">]</span>&nbsp;<span class="op" id="7910875">=</span>&nbsp;<span class="ident" id="7910877"><a href="/database/sql/fakedb_test.go.html#7910686">val</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7910883">}</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7910886">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7910890">if</span>&nbsp;<span class="ident" id="7910893"><a href="/database/sql/fakedb_test.go.html#7910032">doInsert</a></span>&nbsp;<span class="op" id="7910902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7910906"><a href="/database/sql/fakedb_test.go.html#7910206">t</a></span><span class="op" id="7910907">.</span><span class="ident" id="7910908">rows</span>&nbsp;<span class="op" id="7910913">=</span>&nbsp;<span class="builtinfunc" id="7910915">append</span><span class="op" id="7910921">(</span><span class="ident" id="7910922"><a href="/database/sql/fakedb_test.go.html#7910206">t</a></span><span class="op" id="7910923">.</span><span class="ident" id="7910924">rows</span><span class="op" id="7910928">,</span>&nbsp;<span class="op" id="7910930">&amp;</span><span class="ident" id="7910931"><a href="/database/sql/fakedb_test.go.html#7897536">row</a></span><span class="op" id="7910934">{</span><span class="ident" id="7910935">cols</span><span class="op" id="7910939">:</span>&nbsp;<span class="ident" id="7910941"><a href="/database/sql/fakedb_test.go.html#7910371">cols</a></span><span class="op" id="7910945">}</span><span class="op" id="7910946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7910949">}</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7910952">return</span>&nbsp;<span class="ident" id="7910959"><a href="/database/sql/fakedb_test.go.html#7896186">driver</a></span><span class="op" id="7910965">.</span><span class="ident" id="7910966">RowsAffected</span><span class="op" id="7910978">(</span><span class="num" id="7910979">1</span><span class="op" id="7910980">)</span><span class="op" id="7910981">,</span>&nbsp;<span class="ident" id="7910983">nil</span><br>
<span class="lineno"></span><span class="op" id="7910987">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7910990">//&nbsp;hook&nbsp;to&nbsp;simulate&nbsp;broken&nbsp;connections</span><br>
<span class="lineno"></span><span class="keyword" id="7911029">var</span>&nbsp;<span class="ident" id="7911033">hookQueryBadConn</span>&nbsp;<span class="keyword" id="7911050">func</span><span class="op" id="7911054">(</span><span class="op" id="7911055">)</span>&nbsp;<span class="builtintype" id="7911057">bool</span><br>
<span class="lineno">610</span><br>
<span class="lineno"></span><span class="keyword" id="7911063">func</span>&nbsp;<span class="op" id="7911068">(</span><span class="ident" id="7911069">s</span>&nbsp;<span class="op" id="7911071">*</span><span class="ident" id="7911072"><a href="/database/sql/fakedb_test.go.html#7898067">fakeStmt</a></span><span class="op" id="7911080">)</span>&nbsp;<span class="ident" id="7911082">Query</span><span class="op" id="7911087">(</span><span class="ident" id="7911088">args</span>&nbsp;<span class="op" id="7911093">[</span><span class="op" id="7911094">]</span><span class="ident" id="7911095"><a href="/database/sql/fakedb_test.go.html#7896186">driver</a></span><span class="op" id="7911101">.</span><span class="ident" id="7911102">Value</span><span class="op" id="7911107">)</span>&nbsp;<span class="op" id="7911109">(</span><span class="ident" id="7911110"><a href="/database/sql/fakedb_test.go.html#7896186">driver</a></span><span class="op" id="7911116">.</span><span class="ident" id="7911117">Rows</span><span class="op" id="7911121">,</span>&nbsp;<span class="builtintype" id="7911123">error</span><span class="op" id="7911128">)</span>&nbsp;<span class="op" id="7911130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7911133">if</span>&nbsp;<span class="ident" id="7911136"><a href="/database/sql/fakedb_test.go.html#7911069">s</a></span><span class="op" id="7911137">.</span><span class="ident" id="7911138">closed</span>&nbsp;<span class="op" id="7911145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7911149">return</span>&nbsp;<span class="ident" id="7911156">nil</span><span class="op" id="7911159">,</span>&nbsp;<span class="ident" id="7911161"><a href="/database/sql/fakedb_test.go.html#7908817">errClosed</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7911172">}</span><br>
<span class="lineno">615</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7911176">if</span>&nbsp;<span class="ident" id="7911179"><a href="/database/sql/fakedb_test.go.html#7911033">hookQueryBadConn</a></span>&nbsp;<span class="op" id="7911196">!=</span>&nbsp;<span class="ident" id="7911199">nil</span>&nbsp;<span class="op" id="7911203">&amp;&amp;</span>&nbsp;<span class="ident" id="7911206"><a href="/database/sql/fakedb_test.go.html#7911033">hookQueryBadConn</a></span><span class="op" id="7911222">(</span><span class="op" id="7911223">)</span>&nbsp;<span class="op" id="7911225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7911229">return</span>&nbsp;<span class="ident" id="7911236">nil</span><span class="op" id="7911239">,</span>&nbsp;<span class="ident" id="7911241"><a href="/database/sql/fakedb_test.go.html#7896186">driver</a></span><span class="op" id="7911247">.</span><span class="ident" id="7911248">ErrBadConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7911260">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7911264">err</span>&nbsp;<span class="op" id="7911268">:=</span>&nbsp;<span class="ident" id="7911271"><a href="/database/sql/fakedb_test.go.html#7902760">checkSubsetTypes</a></span><span class="op" id="7911287">(</span><span class="ident" id="7911288"><a href="/database/sql/fakedb_test.go.html#7911088">args</a></span><span class="op" id="7911292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7911295">if</span>&nbsp;<span class="ident" id="7911298"><a href="/database/sql/fakedb_test.go.html#7911264">err</a></span>&nbsp;<span class="op" id="7911302">!=</span>&nbsp;<span class="ident" id="7911305">nil</span>&nbsp;<span class="op" id="7911309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7911313">return</span>&nbsp;<span class="ident" id="7911320">nil</span><span class="op" id="7911323">,</span>&nbsp;<span class="ident" id="7911325"><a href="/database/sql/fakedb_test.go.html#7911264">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7911330">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7911334">db</span>&nbsp;<span class="op" id="7911337">:=</span>&nbsp;<span class="ident" id="7911340"><a href="/database/sql/fakedb_test.go.html#7911069">s</a></span><span class="op" id="7911341">.</span><span class="ident" id="7911342">c</span><span class="op" id="7911343">.</span><span class="ident" id="7911344">db</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7911348">if</span>&nbsp;<span class="builtinfunc" id="7911351">len</span><span class="op" id="7911354">(</span><span class="ident" id="7911355"><a href="/database/sql/fakedb_test.go.html#7911088">args</a></span><span class="op" id="7911359">)</span>&nbsp;<span class="op" id="7911361">!=</span>&nbsp;<span class="ident" id="7911364"><a href="/database/sql/fakedb_test.go.html#7911069">s</a></span><span class="op" id="7911365">.</span><span class="ident" id="7911366">placeholders</span>&nbsp;<span class="op" id="7911379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7911383">panic</span><span class="op" id="7911388">(</span><span class="string" id="7911389">&#34;error&nbsp;in&nbsp;pkg&nbsp;db;&nbsp;should&nbsp;only&nbsp;get&nbsp;here&nbsp;if&nbsp;size&nbsp;is&nbsp;correct&#34;</span><span class="op" id="7911447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7911450">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7911454"><a href="/database/sql/fakedb_test.go.html#7911334">db</a></span><span class="op" id="7911456">.</span><span class="ident" id="7911457">mu</span><span class="op" id="7911459">.</span><span class="ident" id="7911460">Lock</span><span class="op" id="7911464">(</span><span class="op" id="7911465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7911468">t</span><span class="op" id="7911469">,</span>&nbsp;<span class="ident" id="7911471">ok</span>&nbsp;<span class="op" id="7911474">:=</span>&nbsp;<span class="ident" id="7911477"><a href="/database/sql/fakedb_test.go.html#7911334">db</a></span><span class="op" id="7911479">.</span><span class="ident" id="7911480">table</span><span class="op" id="7911485">(</span><span class="ident" id="7911486"><a href="/database/sql/fakedb_test.go.html#7911069">s</a></span><span class="op" id="7911487">.</span><span class="ident" id="7911488">table</span><span class="op" id="7911493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7911496"><a href="/database/sql/fakedb_test.go.html#7911334">db</a></span><span class="op" id="7911498">.</span><span class="ident" id="7911499">mu</span><span class="op" id="7911501">.</span><span class="ident" id="7911502">Unlock</span><span class="op" id="7911508">(</span><span class="op" id="7911509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7911512">if</span>&nbsp;<span class="op" id="7911515">!</span><span class="ident" id="7911516"><a href="/database/sql/fakedb_test.go.html#7911471">ok</a></span>&nbsp;<span class="op" id="7911519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7911523">return</span>&nbsp;<span class="ident" id="7911530">nil</span><span class="op" id="7911533">,</span>&nbsp;<span class="ident" id="7911535"><a href="/database/sql/fakedb_test.go.html#7896219">fmt</a></span><span class="op" id="7911538">.</span><span class="ident" id="7911539">Errorf</span><span class="op" id="7911545">(</span><span class="string" id="7911546">&#34;fakedb:&nbsp;table&nbsp;%q&nbsp;doesn&#39;t&nbsp;exist&#34;</span><span class="op" id="7911578">,</span>&nbsp;<span class="ident" id="7911580"><a href="/database/sql/fakedb_test.go.html#7911069">s</a></span><span class="op" id="7911581">.</span><span class="ident" id="7911582">table</span><span class="op" id="7911587">)</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7911590">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7911594">if</span>&nbsp;<span class="ident" id="7911597"><a href="/database/sql/fakedb_test.go.html#7911069">s</a></span><span class="op" id="7911598">.</span><span class="ident" id="7911599">table</span>&nbsp;<span class="op" id="7911605">==</span>&nbsp;<span class="string" id="7911608">&#34;magicquery&#34;</span>&nbsp;<span class="op" id="7911621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7911625">if</span>&nbsp;<span class="builtinfunc" id="7911628">len</span><span class="op" id="7911631">(</span><span class="ident" id="7911632"><a href="/database/sql/fakedb_test.go.html#7911069">s</a></span><span class="op" id="7911633">.</span><span class="ident" id="7911634">whereCol</span><span class="op" id="7911642">)</span>&nbsp;<span class="op" id="7911644">==</span>&nbsp;<span class="num" id="7911647">2</span>&nbsp;<span class="op" id="7911649">&amp;&amp;</span>&nbsp;<span class="ident" id="7911652"><a href="/database/sql/fakedb_test.go.html#7911069">s</a></span><span class="op" id="7911653">.</span><span class="ident" id="7911654">whereCol</span><span class="op" id="7911662">[</span><span class="num" id="7911663">0</span><span class="op" id="7911664">]</span>&nbsp;<span class="op" id="7911666">==</span>&nbsp;<span class="string" id="7911669">&#34;op&#34;</span>&nbsp;<span class="op" id="7911674">&amp;&amp;</span>&nbsp;<span class="ident" id="7911677"><a href="/database/sql/fakedb_test.go.html#7911069">s</a></span><span class="op" id="7911678">.</span><span class="ident" id="7911679">whereCol</span><span class="op" id="7911687">[</span><span class="num" id="7911688">1</span><span class="op" id="7911689">]</span>&nbsp;<span class="op" id="7911691">==</span>&nbsp;<span class="string" id="7911694">&#34;millis&#34;</span>&nbsp;<span class="op" id="7911703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7911708">if</span>&nbsp;<span class="ident" id="7911711"><a href="/database/sql/fakedb_test.go.html#7911088">args</a></span><span class="op" id="7911715">[</span><span class="num" id="7911716">0</span><span class="op" id="7911717">]</span>&nbsp;<span class="op" id="7911719">==</span>&nbsp;<span class="string" id="7911722">&#34;sleep&#34;</span>&nbsp;<span class="op" id="7911730">{</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7911736"><a href="/database/sql/fakedb_test.go.html#7896288">time</a></span><span class="op" id="7911740">.</span><span class="ident" id="7911741">Sleep</span><span class="op" id="7911746">(</span><span class="ident" id="7911747"><a href="/database/sql/fakedb_test.go.html#7896288">time</a></span><span class="op" id="7911751">.</span><span class="ident" id="7911752">Duration</span><span class="op" id="7911760">(</span><span class="ident" id="7911761"><a href="/database/sql/fakedb_test.go.html#7911088">args</a></span><span class="op" id="7911765">[</span><span class="num" id="7911766">1</span><span class="op" id="7911767">]</span><span class="op" id="7911768">.</span><span class="op" id="7911769">(</span><span class="ident" id="7911770">int64</span><span class="op" id="7911775">)</span><span class="op" id="7911776">)</span>&nbsp;<span class="op" id="7911778">*</span>&nbsp;<span class="ident" id="7911780"><a href="/database/sql/fakedb_test.go.html#7896288">time</a></span><span class="op" id="7911784">.</span><span class="ident" id="7911785">Millisecond</span><span class="op" id="7911796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7911801">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7911805">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7911808">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7911812"><a href="/database/sql/fakedb_test.go.html#7911468">t</a></span><span class="op" id="7911813">.</span><span class="ident" id="7911814">mu</span><span class="op" id="7911816">.</span><span class="ident" id="7911817">Lock</span><span class="op" id="7911821">(</span><span class="op" id="7911822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7911825">defer</span>&nbsp;<span class="ident" id="7911831"><a href="/database/sql/fakedb_test.go.html#7911468">t</a></span><span class="op" id="7911832">.</span><span class="ident" id="7911833">mu</span><span class="op" id="7911835">.</span><span class="ident" id="7911836">Unlock</span><span class="op" id="7911842">(</span><span class="op" id="7911843">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7911847">colIdx</span>&nbsp;<span class="op" id="7911854">:=</span>&nbsp;<span class="builtinfunc" id="7911857">make</span><span class="op" id="7911861">(</span><span class="keyword" id="7911862">map</span><span class="op" id="7911865">[</span><span class="builtintype" id="7911866">string</span><span class="op" id="7911872">]</span><span class="builtintype" id="7911873">int</span><span class="op" id="7911876">)</span>&nbsp;<span class="comment" id="7911878">//&nbsp;select&nbsp;column&nbsp;name&nbsp;-&gt;&nbsp;column&nbsp;index&nbsp;in&nbsp;table</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7911926">for</span>&nbsp;<span class="ident" id="7911930">_</span><span class="op" id="7911931">,</span>&nbsp;<span class="ident" id="7911933">name</span>&nbsp;<span class="op" id="7911938">:=</span>&nbsp;<span class="keyword" id="7911941">range</span>&nbsp;<span class="ident" id="7911947"><a href="/database/sql/fakedb_test.go.html#7911069">s</a></span><span class="op" id="7911948">.</span><span class="ident" id="7911949">colName</span>&nbsp;<span class="op" id="7911957">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7911961">idx</span>&nbsp;<span class="op" id="7911965">:=</span>&nbsp;<span class="ident" id="7911968"><a href="/database/sql/fakedb_test.go.html#7911468">t</a></span><span class="op" id="7911969">.</span><span class="ident" id="7911970">columnIndex</span><span class="op" id="7911981">(</span><span class="ident" id="7911982"><a href="/database/sql/fakedb_test.go.html#7911933">name</a></span><span class="op" id="7911986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7911990">if</span>&nbsp;<span class="ident" id="7911993"><a href="/database/sql/fakedb_test.go.html#7911961">idx</a></span>&nbsp;<span class="op" id="7911997">==</span>&nbsp;<span class="op" id="7912000">-</span><span class="num" id="7912001">1</span>&nbsp;<span class="op" id="7912003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7912008">return</span>&nbsp;<span class="ident" id="7912015">nil</span><span class="op" id="7912018">,</span>&nbsp;<span class="ident" id="7912020"><a href="/database/sql/fakedb_test.go.html#7896219">fmt</a></span><span class="op" id="7912023">.</span><span class="ident" id="7912024">Errorf</span><span class="op" id="7912030">(</span><span class="string" id="7912031">&#34;fakedb:&nbsp;unknown&nbsp;column&nbsp;name&nbsp;%q&#34;</span><span class="op" id="7912063">,</span>&nbsp;<span class="ident" id="7912065"><a href="/database/sql/fakedb_test.go.html#7911933">name</a></span><span class="op" id="7912069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7912073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7912077"><a href="/database/sql/fakedb_test.go.html#7911847">colIdx</a></span><span class="op" id="7912083">[</span><span class="ident" id="7912084"><a href="/database/sql/fakedb_test.go.html#7911933">name</a></span><span class="op" id="7912088">]</span>&nbsp;<span class="op" id="7912090">=</span>&nbsp;<span class="ident" id="7912092"><a href="/database/sql/fakedb_test.go.html#7911961">idx</a></span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7912097">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7912101">mrows</span>&nbsp;<span class="op" id="7912107">:=</span>&nbsp;<span class="op" id="7912110">[</span><span class="op" id="7912111">]</span><span class="op" id="7912112">*</span><span class="ident" id="7912113"><a href="/database/sql/fakedb_test.go.html#7897536">row</a></span><span class="op" id="7912116">{</span><span class="op" id="7912117">}</span><br>
<span class="lineno"></span><span class="ident" id="7912119">rows</span><span class="op" id="7912123">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7912126">for</span>&nbsp;<span class="ident" id="7912130">_</span><span class="op" id="7912131">,</span>&nbsp;<span class="ident" id="7912133">trow</span>&nbsp;<span class="op" id="7912138">:=</span>&nbsp;<span class="keyword" id="7912141">range</span>&nbsp;<span class="ident" id="7912147"><a href="/database/sql/fakedb_test.go.html#7911468">t</a></span><span class="op" id="7912148">.</span><span class="ident" id="7912149">rows</span>&nbsp;<span class="op" id="7912154">{</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7912158">//&nbsp;Process&nbsp;the&nbsp;where&nbsp;clause,&nbsp;skipping&nbsp;non-match&nbsp;rows.&nbsp;This&nbsp;is&nbsp;lazy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7912227">//&nbsp;and&nbsp;just&nbsp;uses&nbsp;fmt.Sprintf(&#34;%v&#34;)&nbsp;to&nbsp;test&nbsp;equality.&nbsp;&nbsp;Good&nbsp;enough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7912295">//&nbsp;for&nbsp;test&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7912315">for</span>&nbsp;<span class="ident" id="7912319">widx</span><span class="op" id="7912323">,</span>&nbsp;<span class="ident" id="7912325">wcol</span>&nbsp;<span class="op" id="7912330">:=</span>&nbsp;<span class="keyword" id="7912333">range</span>&nbsp;<span class="ident" id="7912339"><a href="/database/sql/fakedb_test.go.html#7911069">s</a></span><span class="op" id="7912340">.</span><span class="ident" id="7912341">whereCol</span>&nbsp;<span class="op" id="7912350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7912355">idx</span>&nbsp;<span class="op" id="7912359">:=</span>&nbsp;<span class="ident" id="7912362"><a href="/database/sql/fakedb_test.go.html#7911468">t</a></span><span class="op" id="7912363">.</span><span class="ident" id="7912364">columnIndex</span><span class="op" id="7912375">(</span><span class="ident" id="7912376"><a href="/database/sql/fakedb_test.go.html#7912325">wcol</a></span><span class="op" id="7912380">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7912385">if</span>&nbsp;<span class="ident" id="7912388"><a href="/database/sql/fakedb_test.go.html#7912355">idx</a></span>&nbsp;<span class="op" id="7912392">==</span>&nbsp;<span class="op" id="7912395">-</span><span class="num" id="7912396">1</span>&nbsp;<span class="op" id="7912398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7912404">return</span>&nbsp;<span class="ident" id="7912411">nil</span><span class="op" id="7912414">,</span>&nbsp;<span class="ident" id="7912416"><a href="/database/sql/fakedb_test.go.html#7896219">fmt</a></span><span class="op" id="7912419">.</span><span class="ident" id="7912420">Errorf</span><span class="op" id="7912426">(</span><span class="string" id="7912427">&#34;db:&nbsp;invalid&nbsp;where&nbsp;clause&nbsp;column&nbsp;%q&#34;</span><span class="op" id="7912463">,</span>&nbsp;<span class="ident" id="7912465"><a href="/database/sql/fakedb_test.go.html#7912325">wcol</a></span><span class="op" id="7912469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7912474">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7912479">tcol</span>&nbsp;<span class="op" id="7912484">:=</span>&nbsp;<span class="ident" id="7912487"><a href="/database/sql/fakedb_test.go.html#7912133">trow</a></span><span class="op" id="7912491">.</span><span class="ident" id="7912492">cols</span><span class="op" id="7912496">[</span><span class="ident" id="7912497"><a href="/database/sql/fakedb_test.go.html#7912355">idx</a></span><span class="op" id="7912500">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7912505">if</span>&nbsp;<span class="ident" id="7912508">bs</span><span class="op" id="7912510">,</span>&nbsp;<span class="ident" id="7912512">ok</span>&nbsp;<span class="op" id="7912515">:=</span>&nbsp;<span class="ident" id="7912518"><a href="/database/sql/fakedb_test.go.html#7912479">tcol</a></span><span class="op" id="7912522">.</span><span class="op" id="7912523">(</span><span class="op" id="7912524">[</span><span class="op" id="7912525">]</span><span class="builtintype" id="7912526">byte</span><span class="op" id="7912530">)</span><span class="op" id="7912531">;</span>&nbsp;<span class="ident" id="7912533"><a href="/database/sql/fakedb_test.go.html#7912512">ok</a></span>&nbsp;<span class="op" id="7912536">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7912542">//&nbsp;lazy&nbsp;hack&nbsp;to&nbsp;avoid&nbsp;sprintf&nbsp;%v&nbsp;on&nbsp;a&nbsp;[]byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7912591"><a href="/database/sql/fakedb_test.go.html#7912479">tcol</a></span>&nbsp;<span class="op" id="7912596">=</span>&nbsp;<span class="builtintype" id="7912598">string</span><span class="op" id="7912604">(</span><span class="ident" id="7912605"><a href="/database/sql/fakedb_test.go.html#7912508">bs</a></span><span class="op" id="7912607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7912612">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7912617">if</span>&nbsp;<span class="ident" id="7912620"><a href="/database/sql/fakedb_test.go.html#7896219">fmt</a></span><span class="op" id="7912623">.</span><span class="ident" id="7912624">Sprintf</span><span class="op" id="7912631">(</span><span class="string" id="7912632">&#34;%v&#34;</span><span class="op" id="7912636">,</span>&nbsp;<span class="ident" id="7912638"><a href="/database/sql/fakedb_test.go.html#7912479">tcol</a></span><span class="op" id="7912642">)</span>&nbsp;<span class="op" id="7912644">!=</span>&nbsp;<span class="ident" id="7912647"><a href="/database/sql/fakedb_test.go.html#7896219">fmt</a></span><span class="op" id="7912650">.</span><span class="ident" id="7912651">Sprintf</span><span class="op" id="7912658">(</span><span class="string" id="7912659">&#34;%v&#34;</span><span class="op" id="7912663">,</span>&nbsp;<span class="ident" id="7912665"><a href="/database/sql/fakedb_test.go.html#7911088">args</a></span><span class="op" id="7912669">[</span><span class="ident" id="7912670"><a href="/database/sql/fakedb_test.go.html#7912319">widx</a></span><span class="op" id="7912674">]</span><span class="op" id="7912675">)</span>&nbsp;<span class="op" id="7912677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7912683">continue</span>&nbsp;<span class="ident" id="7912692">rows</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7912700">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7912704">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7912708">mrow</span>&nbsp;<span class="op" id="7912713">:=</span>&nbsp;<span class="op" id="7912716">&amp;</span><span class="ident" id="7912717"><a href="/database/sql/fakedb_test.go.html#7897536">row</a></span><span class="op" id="7912720">{</span><span class="ident" id="7912721">cols</span><span class="op" id="7912725">:</span>&nbsp;<span class="builtinfunc" id="7912727">make</span><span class="op" id="7912731">(</span><span class="op" id="7912732">[</span><span class="op" id="7912733">]</span><span class="keyword" id="7912734">interface</span><span class="op" id="7912743">{</span><span class="op" id="7912744">}</span><span class="op" id="7912745">,</span>&nbsp;<span class="builtinfunc" id="7912747">len</span><span class="op" id="7912750">(</span><span class="ident" id="7912751"><a href="/database/sql/fakedb_test.go.html#7911069">s</a></span><span class="op" id="7912752">.</span><span class="ident" id="7912753">colName</span><span class="op" id="7912760">)</span><span class="op" id="7912761">)</span><span class="op" id="7912762">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7912766">for</span>&nbsp;<span class="ident" id="7912770">seli</span><span class="op" id="7912774">,</span>&nbsp;<span class="ident" id="7912776">name</span>&nbsp;<span class="op" id="7912781">:=</span>&nbsp;<span class="keyword" id="7912784">range</span>&nbsp;<span class="ident" id="7912790"><a href="/database/sql/fakedb_test.go.html#7911069">s</a></span><span class="op" id="7912791">.</span><span class="ident" id="7912792">colName</span>&nbsp;<span class="op" id="7912800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7912805"><a href="/database/sql/fakedb_test.go.html#7912708">mrow</a></span><span class="op" id="7912809">.</span><span class="ident" id="7912810">cols</span><span class="op" id="7912814">[</span><span class="ident" id="7912815"><a href="/database/sql/fakedb_test.go.html#7912770">seli</a></span><span class="op" id="7912819">]</span>&nbsp;<span class="op" id="7912821">=</span>&nbsp;<span class="ident" id="7912823"><a href="/database/sql/fakedb_test.go.html#7912133">trow</a></span><span class="op" id="7912827">.</span><span class="ident" id="7912828">cols</span><span class="op" id="7912832">[</span><span class="ident" id="7912833"><a href="/database/sql/fakedb_test.go.html#7911847">colIdx</a></span><span class="op" id="7912839">[</span><span class="ident" id="7912840"><a href="/database/sql/fakedb_test.go.html#7912776">name</a></span><span class="op" id="7912844">]</span><span class="op" id="7912845">]</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7912849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7912853"><a href="/database/sql/fakedb_test.go.html#7912101">mrows</a></span>&nbsp;<span class="op" id="7912859">=</span>&nbsp;<span class="builtinfunc" id="7912861">append</span><span class="op" id="7912867">(</span><span class="ident" id="7912868"><a href="/database/sql/fakedb_test.go.html#7912101">mrows</a></span><span class="op" id="7912873">,</span>&nbsp;<span class="ident" id="7912875"><a href="/database/sql/fakedb_test.go.html#7912708">mrow</a></span><span class="op" id="7912879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7912882">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7912886">cursor</span>&nbsp;<span class="op" id="7912893">:=</span>&nbsp;<span class="op" id="7912896">&amp;</span><span class="ident" id="7912897"><a href="/database/sql/fakedb_test.go.html#7913208">rowsCursor</a></span><span class="op" id="7912907">{</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7912911">pos</span><span class="op" id="7912914">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7912919">-</span><span class="num" id="7912920">1</span><span class="op" id="7912921">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7912925">rows</span><span class="op" id="7912929">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7912933"><a href="/database/sql/fakedb_test.go.html#7912101">mrows</a></span><span class="op" id="7912938">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7912942">cols</span><span class="op" id="7912946">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7912950"><a href="/database/sql/fakedb_test.go.html#7911069">s</a></span><span class="op" id="7912951">.</span><span class="ident" id="7912952">colName</span><span class="op" id="7912959">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7912963">errPos</span><span class="op" id="7912969">:</span>&nbsp;<span class="op" id="7912971">-</span><span class="num" id="7912972">1</span><span class="op" id="7912973">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7912976">}</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7912979">return</span>&nbsp;<span class="ident" id="7912986"><a href="/database/sql/fakedb_test.go.html#7912886">cursor</a></span><span class="op" id="7912992">,</span>&nbsp;<span class="ident" id="7912994">nil</span><br>
<span class="lineno"></span><span class="op" id="7912998">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7913001">func</span>&nbsp;<span class="op" id="7913006">(</span><span class="ident" id="7913007">s</span>&nbsp;<span class="op" id="7913009">*</span><span class="ident" id="7913010"><a href="/database/sql/fakedb_test.go.html#7898067">fakeStmt</a></span><span class="op" id="7913018">)</span>&nbsp;<span class="ident" id="7913020">NumInput</span><span class="op" id="7913028">(</span><span class="op" id="7913029">)</span>&nbsp;<span class="builtintype" id="7913031">int</span>&nbsp;<span class="op" id="7913035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7913038">return</span>&nbsp;<span class="ident" id="7913045"><a href="/database/sql/fakedb_test.go.html#7913007">s</a></span><span class="op" id="7913046">.</span><span class="ident" id="7913047">placeholders</span><br>
<span class="lineno">695</span><span class="op" id="7913060">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7913063">func</span>&nbsp;<span class="op" id="7913068">(</span><span class="ident" id="7913069">tx</span>&nbsp;<span class="op" id="7913072">*</span><span class="ident" id="7913073"><a href="/database/sql/fakedb_test.go.html#7898030">fakeTx</a></span><span class="op" id="7913079">)</span>&nbsp;<span class="ident" id="7913081">Commit</span><span class="op" id="7913087">(</span><span class="op" id="7913088">)</span>&nbsp;<span class="builtintype" id="7913090">error</span>&nbsp;<span class="op" id="7913096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7913099"><a href="/database/sql/fakedb_test.go.html#7913069">tx</a></span><span class="op" id="7913101">.</span><span class="ident" id="7913102">c</span><span class="op" id="7913103">.</span><span class="ident" id="7913104">currTx</span>&nbsp;<span class="op" id="7913111">=</span>&nbsp;<span class="ident" id="7913113">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7913118">return</span>&nbsp;<span class="ident" id="7913125">nil</span><br>
<span class="lineno">700</span><span class="op" id="7913129">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7913132">func</span>&nbsp;<span class="op" id="7913137">(</span><span class="ident" id="7913138">tx</span>&nbsp;<span class="op" id="7913141">*</span><span class="ident" id="7913142"><a href="/database/sql/fakedb_test.go.html#7898030">fakeTx</a></span><span class="op" id="7913148">)</span>&nbsp;<span class="ident" id="7913150">Rollback</span><span class="op" id="7913158">(</span><span class="op" id="7913159">)</span>&nbsp;<span class="builtintype" id="7913161">error</span>&nbsp;<span class="op" id="7913167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7913170"><a href="/database/sql/fakedb_test.go.html#7913138">tx</a></span><span class="op" id="7913172">.</span><span class="ident" id="7913173">c</span><span class="op" id="7913174">.</span><span class="ident" id="7913175">currTx</span>&nbsp;<span class="op" id="7913182">=</span>&nbsp;<span class="ident" id="7913184">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7913189">return</span>&nbsp;<span class="ident" id="7913196">nil</span><br>
<span class="lineno">705</span><span class="op" id="7913200">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7913203">type</span>&nbsp;<span class="ident" id="7913208">rowsCursor</span>&nbsp;<span class="keyword" id="7913219">struct</span>&nbsp;<span class="op" id="7913226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7913229">cols</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7913236">[</span><span class="op" id="7913237">]</span><span class="builtintype" id="7913238">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7913246">pos</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7913253">int</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7913258">rows</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7913265">[</span><span class="op" id="7913266">]</span><span class="op" id="7913267">*</span><span class="ident" id="7913268"><a href="/database/sql/fakedb_test.go.html#7897536">row</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7913273">closed</span>&nbsp;<span class="builtintype" id="7913280">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7913287">//&nbsp;errPos&nbsp;and&nbsp;err&nbsp;are&nbsp;for&nbsp;making&nbsp;Next&nbsp;return&nbsp;early&nbsp;with&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7913351">errPos</span>&nbsp;<span class="builtintype" id="7913358">int</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7913363">err</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7913370">error</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7913378">//&nbsp;a&nbsp;clone&nbsp;of&nbsp;slices&nbsp;to&nbsp;give&nbsp;out&nbsp;to&nbsp;clients,&nbsp;indexed&nbsp;by&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7913439">//&nbsp;the&nbsp;original&nbsp;slice&#39;s&nbsp;first&nbsp;byte&nbsp;address.&nbsp;&nbsp;we&nbsp;clone&nbsp;them</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7913499">//&nbsp;just&nbsp;so&nbsp;we&#39;re&nbsp;able&nbsp;to&nbsp;corrupt&nbsp;them&nbsp;on&nbsp;close.</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7913548">bytesClone</span>&nbsp;<span class="keyword" id="7913559">map</span><span class="op" id="7913562">[</span><span class="op" id="7913563">*</span><span class="builtintype" id="7913564">byte</span><span class="op" id="7913568">]</span><span class="op" id="7913569">[</span><span class="op" id="7913570">]</span><span class="builtintype" id="7913571">byte</span><br>
<span class="lineno"></span><span class="op" id="7913576">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7913579">func</span>&nbsp;<span class="op" id="7913584">(</span><span class="ident" id="7913585">rc</span>&nbsp;<span class="op" id="7913588">*</span><span class="ident" id="7913589"><a href="/database/sql/fakedb_test.go.html#7913208">rowsCursor</a></span><span class="op" id="7913599">)</span>&nbsp;<span class="ident" id="7913601">Close</span><span class="op" id="7913606">(</span><span class="op" id="7913607">)</span>&nbsp;<span class="builtintype" id="7913609">error</span>&nbsp;<span class="op" id="7913615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7913618">if</span>&nbsp;<span class="op" id="7913621">!</span><span class="ident" id="7913622"><a href="/database/sql/fakedb_test.go.html#7913585">rc</a></span><span class="op" id="7913624">.</span><span class="ident" id="7913625">closed</span>&nbsp;<span class="op" id="7913632">{</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7913636">for</span>&nbsp;<span class="ident" id="7913640">_</span><span class="op" id="7913641">,</span>&nbsp;<span class="ident" id="7913643">bs</span>&nbsp;<span class="op" id="7913646">:=</span>&nbsp;<span class="keyword" id="7913649">range</span>&nbsp;<span class="ident" id="7913655"><a href="/database/sql/fakedb_test.go.html#7913585">rc</a></span><span class="op" id="7913657">.</span><span class="ident" id="7913658">bytesClone</span>&nbsp;<span class="op" id="7913669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7913674"><a href="/database/sql/fakedb_test.go.html#7913643">bs</a></span><span class="op" id="7913676">[</span><span class="num" id="7913677">0</span><span class="op" id="7913678">]</span>&nbsp;<span class="op" id="7913680">=</span>&nbsp;<span class="num" id="7913682">255</span>&nbsp;<span class="comment" id="7913686">//&nbsp;first&nbsp;byte&nbsp;corrupted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7913712">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7913715">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7913718"><a href="/database/sql/fakedb_test.go.html#7913585">rc</a></span><span class="op" id="7913720">.</span><span class="ident" id="7913721">closed</span>&nbsp;<span class="op" id="7913728">=</span>&nbsp;<span class="ident" id="7913730">true</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7913736">return</span>&nbsp;<span class="ident" id="7913743">nil</span><br>
<span class="lineno"></span><span class="op" id="7913747">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7913750">func</span>&nbsp;<span class="op" id="7913755">(</span><span class="ident" id="7913756">rc</span>&nbsp;<span class="op" id="7913759">*</span><span class="ident" id="7913760"><a href="/database/sql/fakedb_test.go.html#7913208">rowsCursor</a></span><span class="op" id="7913770">)</span>&nbsp;<span class="ident" id="7913772">Columns</span><span class="op" id="7913779">(</span><span class="op" id="7913780">)</span>&nbsp;<span class="op" id="7913782">[</span><span class="op" id="7913783">]</span><span class="builtintype" id="7913784">string</span>&nbsp;<span class="op" id="7913791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7913794">return</span>&nbsp;<span class="ident" id="7913801"><a href="/database/sql/fakedb_test.go.html#7913756">rc</a></span><span class="op" id="7913803">.</span><span class="ident" id="7913804">cols</span><br>
<span class="lineno">735</span><span class="op" id="7913809">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7913812">var</span>&nbsp;<span class="ident" id="7913816">rowsCursorNextHook</span>&nbsp;<span class="keyword" id="7913835">func</span><span class="op" id="7913839">(</span><span class="ident" id="7913840">dest</span>&nbsp;<span class="op" id="7913845">[</span><span class="op" id="7913846">]</span><span class="ident" id="7913847"><a href="/database/sql/fakedb_test.go.html#7896186">driver</a></span><span class="op" id="7913853">.</span><span class="ident" id="7913854">Value</span><span class="op" id="7913859">)</span>&nbsp;<span class="builtintype" id="7913861">error</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7913868">func</span>&nbsp;<span class="op" id="7913873">(</span><span class="ident" id="7913874">rc</span>&nbsp;<span class="op" id="7913877">*</span><span class="ident" id="7913878"><a href="/database/sql/fakedb_test.go.html#7913208">rowsCursor</a></span><span class="op" id="7913888">)</span>&nbsp;<span class="ident" id="7913890">Next</span><span class="op" id="7913894">(</span><span class="ident" id="7913895">dest</span>&nbsp;<span class="op" id="7913900">[</span><span class="op" id="7913901">]</span><span class="ident" id="7913902"><a href="/database/sql/fakedb_test.go.html#7896186">driver</a></span><span class="op" id="7913908">.</span><span class="ident" id="7913909">Value</span><span class="op" id="7913914">)</span>&nbsp;<span class="builtintype" id="7913916">error</span>&nbsp;<span class="op" id="7913922">{</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7913925">if</span>&nbsp;<span class="ident" id="7913928"><a href="/database/sql/fakedb_test.go.html#7913816">rowsCursorNextHook</a></span>&nbsp;<span class="op" id="7913947">!=</span>&nbsp;<span class="ident" id="7913950">nil</span>&nbsp;<span class="op" id="7913954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7913958">return</span>&nbsp;<span class="ident" id="7913965"><a href="/database/sql/fakedb_test.go.html#7913816">rowsCursorNextHook</a></span><span class="op" id="7913983">(</span><span class="ident" id="7913984"><a href="/database/sql/fakedb_test.go.html#7913895">dest</a></span><span class="op" id="7913988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7913991">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7913995">if</span>&nbsp;<span class="ident" id="7913998"><a href="/database/sql/fakedb_test.go.html#7913874">rc</a></span><span class="op" id="7914000">.</span><span class="ident" id="7914001">closed</span>&nbsp;<span class="op" id="7914008">{</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7914012">return</span>&nbsp;<span class="ident" id="7914019"><a href="/database/sql/fakedb_test.go.html#7896209">errors</a></span><span class="op" id="7914025">.</span><span class="ident" id="7914026">New</span><span class="op" id="7914029">(</span><span class="string" id="7914030">&#34;fakedb:&nbsp;cursor&nbsp;is&nbsp;closed&#34;</span><span class="op" id="7914056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7914059">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7914062"><a href="/database/sql/fakedb_test.go.html#7913874">rc</a></span><span class="op" id="7914064">.</span><span class="ident" id="7914065">pos</span><span class="op" id="7914068">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7914072">if</span>&nbsp;<span class="ident" id="7914075"><a href="/database/sql/fakedb_test.go.html#7913874">rc</a></span><span class="op" id="7914077">.</span><span class="ident" id="7914078">pos</span>&nbsp;<span class="op" id="7914082">==</span>&nbsp;<span class="ident" id="7914085"><a href="/database/sql/fakedb_test.go.html#7913874">rc</a></span><span class="op" id="7914087">.</span><span class="ident" id="7914088">errPos</span>&nbsp;<span class="op" id="7914095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7914099">return</span>&nbsp;<span class="ident" id="7914106"><a href="/database/sql/fakedb_test.go.html#7913874">rc</a></span><span class="op" id="7914108">.</span><span class="ident" id="7914109">err</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7914114">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7914117">if</span>&nbsp;<span class="ident" id="7914120"><a href="/database/sql/fakedb_test.go.html#7913874">rc</a></span><span class="op" id="7914122">.</span><span class="ident" id="7914123">pos</span>&nbsp;<span class="op" id="7914127">&gt;=</span>&nbsp;<span class="builtinfunc" id="7914130">len</span><span class="op" id="7914133">(</span><span class="ident" id="7914134"><a href="/database/sql/fakedb_test.go.html#7913874">rc</a></span><span class="op" id="7914136">.</span><span class="ident" id="7914137">rows</span><span class="op" id="7914141">)</span>&nbsp;<span class="op" id="7914143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7914147">return</span>&nbsp;<span class="ident" id="7914154"><a href="/database/sql/fakedb_test.go.html#7896226">io</a></span><span class="op" id="7914156">.</span><span class="ident" id="7914157">EOF</span>&nbsp;<span class="comment" id="7914161">//&nbsp;per&nbsp;interface&nbsp;spec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7914184">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7914187">for</span>&nbsp;<span class="ident" id="7914191">i</span><span class="op" id="7914192">,</span>&nbsp;<span class="ident" id="7914194">v</span>&nbsp;<span class="op" id="7914196">:=</span>&nbsp;<span class="keyword" id="7914199">range</span>&nbsp;<span class="ident" id="7914205"><a href="/database/sql/fakedb_test.go.html#7913874">rc</a></span><span class="op" id="7914207">.</span><span class="ident" id="7914208">rows</span><span class="op" id="7914212">[</span><span class="ident" id="7914213"><a href="/database/sql/fakedb_test.go.html#7913874">rc</a></span><span class="op" id="7914215">.</span><span class="ident" id="7914216">pos</span><span class="op" id="7914219">]</span><span class="op" id="7914220">.</span><span class="ident" id="7914221">cols</span>&nbsp;<span class="op" id="7914226">{</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7914230">//&nbsp;TODO(bradfitz):&nbsp;convert&nbsp;to&nbsp;subset&nbsp;types?&nbsp;naah,&nbsp;I</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7914284">//&nbsp;think&nbsp;the&nbsp;subset&nbsp;types&nbsp;should&nbsp;only&nbsp;be&nbsp;input&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7914336">//&nbsp;driver,&nbsp;but&nbsp;the&nbsp;sql&nbsp;package&nbsp;should&nbsp;be&nbsp;able&nbsp;to&nbsp;handle</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7914394">//&nbsp;a&nbsp;wider&nbsp;range&nbsp;of&nbsp;types&nbsp;coming&nbsp;out&nbsp;of&nbsp;drivers.&nbsp;all</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7914449">//&nbsp;for&nbsp;ease&nbsp;of&nbsp;drivers,&nbsp;and&nbsp;to&nbsp;prevent&nbsp;drivers&nbsp;from</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7914503">//&nbsp;messing&nbsp;up&nbsp;conversions&nbsp;or&nbsp;doing&nbsp;them&nbsp;differently.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7914558"><a href="/database/sql/fakedb_test.go.html#7913895">dest</a></span><span class="op" id="7914562">[</span><span class="ident" id="7914563"><a href="/database/sql/fakedb_test.go.html#7914191">i</a></span><span class="op" id="7914564">]</span>&nbsp;<span class="op" id="7914566">=</span>&nbsp;<span class="ident" id="7914568"><a href="/database/sql/fakedb_test.go.html#7914194">v</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7914573">if</span>&nbsp;<span class="ident" id="7914576">bs</span><span class="op" id="7914578">,</span>&nbsp;<span class="ident" id="7914580">ok</span>&nbsp;<span class="op" id="7914583">:=</span>&nbsp;<span class="ident" id="7914586"><a href="/database/sql/fakedb_test.go.html#7914194">v</a></span><span class="op" id="7914587">.</span><span class="op" id="7914588">(</span><span class="op" id="7914589">[</span><span class="op" id="7914590">]</span><span class="builtintype" id="7914591">byte</span><span class="op" id="7914595">)</span><span class="op" id="7914596">;</span>&nbsp;<span class="ident" id="7914598"><a href="/database/sql/fakedb_test.go.html#7914580">ok</a></span>&nbsp;<span class="op" id="7914601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7914606">if</span>&nbsp;<span class="ident" id="7914609"><a href="/database/sql/fakedb_test.go.html#7913874">rc</a></span><span class="op" id="7914611">.</span><span class="ident" id="7914612">bytesClone</span>&nbsp;<span class="op" id="7914623">==</span>&nbsp;<span class="ident" id="7914626">nil</span>&nbsp;<span class="op" id="7914630">{</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7914636"><a href="/database/sql/fakedb_test.go.html#7913874">rc</a></span><span class="op" id="7914638">.</span><span class="ident" id="7914639">bytesClone</span>&nbsp;<span class="op" id="7914650">=</span>&nbsp;<span class="builtinfunc" id="7914652">make</span><span class="op" id="7914656">(</span><span class="keyword" id="7914657">map</span><span class="op" id="7914660">[</span><span class="op" id="7914661">*</span><span class="builtintype" id="7914662">byte</span><span class="op" id="7914666">]</span><span class="op" id="7914667">[</span><span class="op" id="7914668">]</span><span class="builtintype" id="7914669">byte</span><span class="op" id="7914673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7914678">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7914683">clone</span><span class="op" id="7914688">,</span>&nbsp;<span class="ident" id="7914690">ok</span>&nbsp;<span class="op" id="7914693">:=</span>&nbsp;<span class="ident" id="7914696"><a href="/database/sql/fakedb_test.go.html#7913874">rc</a></span><span class="op" id="7914698">.</span><span class="ident" id="7914699">bytesClone</span><span class="op" id="7914709">[</span><span class="op" id="7914710">&amp;</span><span class="ident" id="7914711"><a href="/database/sql/fakedb_test.go.html#7914576">bs</a></span><span class="op" id="7914713">[</span><span class="num" id="7914714">0</span><span class="op" id="7914715">]</span><span class="op" id="7914716">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7914721">if</span>&nbsp;<span class="op" id="7914724">!</span><span class="ident" id="7914725"><a href="/database/sql/fakedb_test.go.html#7914690">ok</a></span>&nbsp;<span class="op" id="7914728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7914734"><a href="/database/sql/fakedb_test.go.html#7914683">clone</a></span>&nbsp;<span class="op" id="7914740">=</span>&nbsp;<span class="builtinfunc" id="7914742">make</span><span class="op" id="7914746">(</span><span class="op" id="7914747">[</span><span class="op" id="7914748">]</span><span class="builtintype" id="7914749">byte</span><span class="op" id="7914753">,</span>&nbsp;<span class="builtinfunc" id="7914755">len</span><span class="op" id="7914758">(</span><span class="ident" id="7914759"><a href="/database/sql/fakedb_test.go.html#7914576">bs</a></span><span class="op" id="7914761">)</span><span class="op" id="7914762">)</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7914768">copy</span><span class="op" id="7914772">(</span><span class="ident" id="7914773"><a href="/database/sql/fakedb_test.go.html#7914683">clone</a></span><span class="op" id="7914778">,</span>&nbsp;<span class="ident" id="7914780"><a href="/database/sql/fakedb_test.go.html#7914576">bs</a></span><span class="op" id="7914782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7914788"><a href="/database/sql/fakedb_test.go.html#7913874">rc</a></span><span class="op" id="7914790">.</span><span class="ident" id="7914791">bytesClone</span><span class="op" id="7914801">[</span><span class="op" id="7914802">&amp;</span><span class="ident" id="7914803"><a href="/database/sql/fakedb_test.go.html#7914576">bs</a></span><span class="op" id="7914805">[</span><span class="num" id="7914806">0</span><span class="op" id="7914807">]</span><span class="op" id="7914808">]</span>&nbsp;<span class="op" id="7914810">=</span>&nbsp;<span class="ident" id="7914812"><a href="/database/sql/fakedb_test.go.html#7914683">clone</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7914821">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7914826"><a href="/database/sql/fakedb_test.go.html#7913895">dest</a></span><span class="op" id="7914830">[</span><span class="ident" id="7914831"><a href="/database/sql/fakedb_test.go.html#7914191">i</a></span><span class="op" id="7914832">]</span>&nbsp;<span class="op" id="7914834">=</span>&nbsp;<span class="ident" id="7914836"><a href="/database/sql/fakedb_test.go.html#7914683">clone</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7914844">}</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7914847">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7914850">return</span>&nbsp;<span class="ident" id="7914857">nil</span><br>
<span class="lineno"></span><span class="op" id="7914861">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7914864">//&nbsp;fakeDriverString&nbsp;is&nbsp;like&nbsp;driver.String,&nbsp;but&nbsp;indirects&nbsp;pointers&nbsp;like</span><br>
<span class="lineno">780</span><span class="comment" id="7914935">//&nbsp;DefaultValueConverter.</span><br>
<span class="lineno"></span><span class="comment" id="7914961">//</span><br>
<span class="lineno"></span><span class="comment" id="7914964">//&nbsp;This&nbsp;could&nbsp;be&nbsp;surprising&nbsp;behavior&nbsp;to&nbsp;retroactively&nbsp;apply&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="7915027">//&nbsp;driver.String&nbsp;now&nbsp;that&nbsp;Go1&nbsp;is&nbsp;out,&nbsp;but&nbsp;this&nbsp;is&nbsp;convenient&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="7915092">//&nbsp;our&nbsp;TestPointerParamsAndScans.</span><br>
<span class="lineno">785</span><span class="comment" id="7915126">//</span><br>
<span class="lineno"></span><span class="keyword" id="7915129">type</span>&nbsp;<span class="ident" id="7915134">fakeDriverString</span>&nbsp;<span class="keyword" id="7915151">struct</span><span class="op" id="7915157">{</span><span class="op" id="7915158">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7915161">func</span>&nbsp;<span class="op" id="7915166">(</span><span class="ident" id="7915167"><a href="/database/sql/fakedb_test.go.html#7915134">fakeDriverString</a></span><span class="op" id="7915183">)</span>&nbsp;<span class="ident" id="7915185">ConvertValue</span><span class="op" id="7915197">(</span><span class="ident" id="7915198">v</span>&nbsp;<span class="keyword" id="7915200">interface</span><span class="op" id="7915209">{</span><span class="op" id="7915210">}</span><span class="op" id="7915211">)</span>&nbsp;<span class="op" id="7915213">(</span><span class="ident" id="7915214"><a href="/database/sql/fakedb_test.go.html#7896186">driver</a></span><span class="op" id="7915220">.</span><span class="ident" id="7915221">Value</span><span class="op" id="7915226">,</span>&nbsp;<span class="builtintype" id="7915228">error</span><span class="op" id="7915233">)</span>&nbsp;<span class="op" id="7915235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7915238">switch</span>&nbsp;<span class="ident" id="7915245">c</span>&nbsp;<span class="op" id="7915247">:=</span>&nbsp;<span class="ident" id="7915250"><a href="/database/sql/fakedb_test.go.html#7915198">v</a></span><span class="op" id="7915251">.</span><span class="op" id="7915252">(</span><span class="keyword" id="7915253">type</span><span class="op" id="7915257">)</span>&nbsp;<span class="op" id="7915259">{</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7915262">case</span>&nbsp;<span class="builtintype" id="7915267">string</span><span class="op" id="7915273">,</span>&nbsp;<span class="op" id="7915275">[</span><span class="op" id="7915276">]</span><span class="builtintype" id="7915277">byte</span><span class="op" id="7915281">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7915285">return</span>&nbsp;<span class="ident" id="7915292"><a href="/database/sql/fakedb_test.go.html#7915198">v</a></span><span class="op" id="7915293">,</span>&nbsp;<span class="ident" id="7915295">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7915300">case</span>&nbsp;<span class="op" id="7915305">*</span><span class="builtintype" id="7915306">string</span><span class="op" id="7915312">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7915316">if</span>&nbsp;<span class="ident" id="7915319"><a href="/database/sql/fakedb_test.go.html#7915245">c</a></span>&nbsp;<span class="op" id="7915321">==</span>&nbsp;<span class="ident" id="7915324">nil</span>&nbsp;<span class="op" id="7915328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7915333">return</span>&nbsp;<span class="ident" id="7915340">nil</span><span class="op" id="7915343">,</span>&nbsp;<span class="ident" id="7915345">nil</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7915351">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7915355">return</span>&nbsp;<span class="op" id="7915362">*</span><span class="ident" id="7915363"><a href="/database/sql/fakedb_test.go.html#7915245">c</a></span><span class="op" id="7915364">,</span>&nbsp;<span class="ident" id="7915366">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7915371">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7915374">return</span>&nbsp;<span class="ident" id="7915381"><a href="/database/sql/fakedb_test.go.html#7896219">fmt</a></span><span class="op" id="7915384">.</span><span class="ident" id="7915385">Sprintf</span><span class="op" id="7915392">(</span><span class="string" id="7915393">&#34;%v&#34;</span><span class="op" id="7915397">,</span>&nbsp;<span class="ident" id="7915399"><a href="/database/sql/fakedb_test.go.html#7915198">v</a></span><span class="op" id="7915400">)</span><span class="op" id="7915401">,</span>&nbsp;<span class="ident" id="7915403">nil</span><br>
<span class="lineno"></span><span class="op" id="7915407">}</span><br>
<span class="lineno">800</span><br>
<span class="lineno"></span><span class="keyword" id="7915410">func</span>&nbsp;<span class="ident" id="7915415">converterForType</span><span class="op" id="7915431">(</span><span class="ident" id="7915432">typ</span>&nbsp;<span class="builtintype" id="7915436">string</span><span class="op" id="7915442">)</span>&nbsp;<span class="ident" id="7915444"><a href="/database/sql/fakedb_test.go.html#7896186">driver</a></span><span class="op" id="7915450">.</span><span class="ident" id="7915451">ValueConverter</span>&nbsp;<span class="op" id="7915466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7915469">switch</span>&nbsp;<span class="ident" id="7915476"><a href="/database/sql/fakedb_test.go.html#7915432">typ</a></span>&nbsp;<span class="op" id="7915480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7915483">case</span>&nbsp;<span class="string" id="7915488">&#34;bool&#34;</span><span class="op" id="7915494">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7915498">return</span>&nbsp;<span class="ident" id="7915505"><a href="/database/sql/fakedb_test.go.html#7896186">driver</a></span><span class="op" id="7915511">.</span><span class="ident" id="7915512">Bool</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7915518">case</span>&nbsp;<span class="string" id="7915523">&#34;nullbool&#34;</span><span class="op" id="7915533">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7915537">return</span>&nbsp;<span class="ident" id="7915544"><a href="/database/sql/fakedb_test.go.html#7896186">driver</a></span><span class="op" id="7915550">.</span><span class="ident" id="7915551">Null</span><span class="op" id="7915555">{</span><span class="ident" id="7915556">Converter</span><span class="op" id="7915565">:</span>&nbsp;<span class="ident" id="7915567"><a href="/database/sql/fakedb_test.go.html#7896186">driver</a></span><span class="op" id="7915573">.</span><span class="ident" id="7915574">Bool</span><span class="op" id="7915578">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7915581">case</span>&nbsp;<span class="string" id="7915586">&#34;int32&#34;</span><span class="op" id="7915593">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7915597">return</span>&nbsp;<span class="ident" id="7915604"><a href="/database/sql/fakedb_test.go.html#7896186">driver</a></span><span class="op" id="7915610">.</span><span class="ident" id="7915611">Int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7915618">case</span>&nbsp;<span class="string" id="7915623">&#34;string&#34;</span><span class="op" id="7915631">:</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7915635">return</span>&nbsp;<span class="ident" id="7915642"><a href="/database/sql/fakedb_test.go.html#7896186">driver</a></span><span class="op" id="7915648">.</span><span class="ident" id="7915649">NotNull</span><span class="op" id="7915656">{</span><span class="ident" id="7915657">Converter</span><span class="op" id="7915666">:</span>&nbsp;<span class="ident" id="7915668"><a href="/database/sql/fakedb_test.go.html#7915134">fakeDriverString</a></span><span class="op" id="7915684">{</span><span class="op" id="7915685">}</span><span class="op" id="7915686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7915689">case</span>&nbsp;<span class="string" id="7915694">&#34;nullstring&#34;</span><span class="op" id="7915706">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7915710">return</span>&nbsp;<span class="ident" id="7915717"><a href="/database/sql/fakedb_test.go.html#7896186">driver</a></span><span class="op" id="7915723">.</span><span class="ident" id="7915724">Null</span><span class="op" id="7915728">{</span><span class="ident" id="7915729">Converter</span><span class="op" id="7915738">:</span>&nbsp;<span class="ident" id="7915740"><a href="/database/sql/fakedb_test.go.html#7915134">fakeDriverString</a></span><span class="op" id="7915756">{</span><span class="op" id="7915757">}</span><span class="op" id="7915758">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7915761">case</span>&nbsp;<span class="string" id="7915766">&#34;int64&#34;</span><span class="op" id="7915773">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7915777">//&nbsp;TODO(coopernurse):&nbsp;add&nbsp;type-specific&nbsp;converter</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7915829">return</span>&nbsp;<span class="ident" id="7915836"><a href="/database/sql/fakedb_test.go.html#7896186">driver</a></span><span class="op" id="7915842">.</span><span class="ident" id="7915843">NotNull</span><span class="op" id="7915850">{</span><span class="ident" id="7915851">Converter</span><span class="op" id="7915860">:</span>&nbsp;<span class="ident" id="7915862"><a href="/database/sql/fakedb_test.go.html#7896186">driver</a></span><span class="op" id="7915868">.</span><span class="ident" id="7915869">DefaultParameterConverter</span><span class="op" id="7915894">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7915897">case</span>&nbsp;<span class="string" id="7915902">&#34;nullint64&#34;</span><span class="op" id="7915913">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7915917">//&nbsp;TODO(coopernurse):&nbsp;add&nbsp;type-specific&nbsp;converter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7915969">return</span>&nbsp;<span class="ident" id="7915976"><a href="/database/sql/fakedb_test.go.html#7896186">driver</a></span><span class="op" id="7915982">.</span><span class="ident" id="7915983">Null</span><span class="op" id="7915987">{</span><span class="ident" id="7915988">Converter</span><span class="op" id="7915997">:</span>&nbsp;<span class="ident" id="7915999"><a href="/database/sql/fakedb_test.go.html#7896186">driver</a></span><span class="op" id="7916005">.</span><span class="ident" id="7916006">DefaultParameterConverter</span><span class="op" id="7916031">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7916034">case</span>&nbsp;<span class="string" id="7916039">&#34;float64&#34;</span><span class="op" id="7916048">:</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7916052">//&nbsp;TODO(coopernurse):&nbsp;add&nbsp;type-specific&nbsp;converter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7916104">return</span>&nbsp;<span class="ident" id="7916111"><a href="/database/sql/fakedb_test.go.html#7896186">driver</a></span><span class="op" id="7916117">.</span><span class="ident" id="7916118">NotNull</span><span class="op" id="7916125">{</span><span class="ident" id="7916126">Converter</span><span class="op" id="7916135">:</span>&nbsp;<span class="ident" id="7916137"><a href="/database/sql/fakedb_test.go.html#7896186">driver</a></span><span class="op" id="7916143">.</span><span class="ident" id="7916144">DefaultParameterConverter</span><span class="op" id="7916169">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7916172">case</span>&nbsp;<span class="string" id="7916177">&#34;nullfloat64&#34;</span><span class="op" id="7916190">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7916194">//&nbsp;TODO(coopernurse):&nbsp;add&nbsp;type-specific&nbsp;converter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7916246">return</span>&nbsp;<span class="ident" id="7916253"><a href="/database/sql/fakedb_test.go.html#7896186">driver</a></span><span class="op" id="7916259">.</span><span class="ident" id="7916260">Null</span><span class="op" id="7916264">{</span><span class="ident" id="7916265">Converter</span><span class="op" id="7916274">:</span>&nbsp;<span class="ident" id="7916276"><a href="/database/sql/fakedb_test.go.html#7896186">driver</a></span><span class="op" id="7916282">.</span><span class="ident" id="7916283">DefaultParameterConverter</span><span class="op" id="7916308">}</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7916311">case</span>&nbsp;<span class="string" id="7916316">&#34;datetime&#34;</span><span class="op" id="7916326">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7916330">return</span>&nbsp;<span class="ident" id="7916337"><a href="/database/sql/fakedb_test.go.html#7896186">driver</a></span><span class="op" id="7916343">.</span><span class="ident" id="7916344">DefaultParameterConverter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7916371">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7916374">panic</span><span class="op" id="7916379">(</span><span class="string" id="7916380">&#34;invalid&nbsp;fakedb&nbsp;column&nbsp;type&nbsp;of&nbsp;&#34;</span>&nbsp;<span class="op" id="7916413">+</span>&nbsp;<span class="ident" id="7916415"><a href="/database/sql/fakedb_test.go.html#7915432">typ</a></span><span class="op" id="7916418">)</span><br>
<span class="lineno"></span><span class="op" id="7916420">}</span>
</div>
</body>
</html>
