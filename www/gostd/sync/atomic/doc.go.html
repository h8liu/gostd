<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="1796169">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1796225">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1796279">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1796330">//&nbsp;Package&nbsp;atomic&nbsp;provides&nbsp;low-level&nbsp;atomic&nbsp;memory&nbsp;primitives</span><br>
<span class="lineno"></span><span class="comment" id="1796392">//&nbsp;useful&nbsp;for&nbsp;implementing&nbsp;synchronization&nbsp;algorithms.</span><br>
<span class="lineno"></span><span class="comment" id="1796447">//</span><br>
<span class="lineno"></span><span class="comment" id="1796450">//&nbsp;These&nbsp;functions&nbsp;require&nbsp;great&nbsp;care&nbsp;to&nbsp;be&nbsp;used&nbsp;correctly.</span><br>
<span class="lineno"></span><span class="comment" id="1796510">//&nbsp;Except&nbsp;for&nbsp;special,&nbsp;low-level&nbsp;applications,&nbsp;synchronization&nbsp;is&nbsp;better</span><br>
<span class="lineno">10</span><span class="comment" id="1796583">//&nbsp;done&nbsp;with&nbsp;channels&nbsp;or&nbsp;the&nbsp;facilities&nbsp;of&nbsp;the&nbsp;sync&nbsp;package.</span><br>
<span class="lineno"></span><span class="comment" id="1796644">//&nbsp;Share&nbsp;memory&nbsp;by&nbsp;communicating;</span><br>
<span class="lineno"></span><span class="comment" id="1796678">//&nbsp;don&#39;t&nbsp;communicate&nbsp;by&nbsp;sharing&nbsp;memory.</span><br>
<span class="lineno"></span><span class="comment" id="1796718">//</span><br>
<span class="lineno"></span><span class="comment" id="1796721">//&nbsp;The&nbsp;swap&nbsp;operation,&nbsp;implemented&nbsp;by&nbsp;the&nbsp;SwapT&nbsp;functions,&nbsp;is&nbsp;the&nbsp;atomic</span><br>
<span class="lineno">15</span><span class="comment" id="1796794">//&nbsp;equivalent&nbsp;of:</span><br>
<span class="lineno"></span><span class="comment" id="1796812">//</span><br>
<span class="lineno"></span><span class="comment" id="1796815">//&nbsp;&nbsp;&nbsp;&nbspold&nbsp;=&nbsp;*addr</span><br>
<span class="lineno"></span><span class="comment" id="1796830">//&nbsp;&nbsp;&nbsp;&nbsp*addr&nbsp;=&nbsp;new</span><br>
<span class="lineno"></span><span class="comment" id="1796845">//&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;old</span><br>
<span class="lineno">20</span><span class="comment" id="1796859">//</span><br>
<span class="lineno"></span><span class="comment" id="1796862">//&nbsp;The&nbsp;compare-and-swap&nbsp;operation,&nbsp;implemented&nbsp;by&nbsp;the&nbsp;CompareAndSwapT</span><br>
<span class="lineno"></span><span class="comment" id="1796932">//&nbsp;functions,&nbsp;is&nbsp;the&nbsp;atomic&nbsp;equivalent&nbsp;of:</span><br>
<span class="lineno"></span><span class="comment" id="1796975">//</span><br>
<span class="lineno"></span><span class="comment" id="1796978">//&nbsp;&nbsp;&nbsp;&nbspif&nbsp;*addr&nbsp;==&nbsp;old&nbsp;{</span><br>
<span class="lineno">25</span><span class="comment" id="1796999">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp*addr&nbsp;=&nbsp;new</span><br>
<span class="lineno"></span><span class="comment" id="1797015">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;true</span><br>
<span class="lineno"></span><span class="comment" id="1797031">//&nbsp;&nbsp;&nbsp;&nbsp}</span><br>
<span class="lineno"></span><span class="comment" id="1797036">//&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;false</span><br>
<span class="lineno"></span><span class="comment" id="1797052">//</span><br>
<span class="lineno">30</span><span class="comment" id="1797055">//&nbsp;The&nbsp;add&nbsp;operation,&nbsp;implemented&nbsp;by&nbsp;the&nbsp;AddT&nbsp;functions,&nbsp;is&nbsp;the&nbsp;atomic</span><br>
<span class="lineno"></span><span class="comment" id="1797126">//&nbsp;equivalent&nbsp;of:</span><br>
<span class="lineno"></span><span class="comment" id="1797144">//</span><br>
<span class="lineno"></span><span class="comment" id="1797147">//&nbsp;&nbsp;&nbsp;&nbsp*addr&nbsp;+=&nbsp;delta</span><br>
<span class="lineno"></span><span class="comment" id="1797165">//&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;*addr</span><br>
<span class="lineno">35</span><span class="comment" id="1797181">//</span><br>
<span class="lineno"></span><span class="comment" id="1797184">//&nbsp;The&nbsp;load&nbsp;and&nbsp;store&nbsp;operations,&nbsp;implemented&nbsp;by&nbsp;the&nbsp;LoadT&nbsp;and&nbsp;StoreT</span><br>
<span class="lineno"></span><span class="comment" id="1797254">//&nbsp;functions,&nbsp;are&nbsp;the&nbsp;atomic&nbsp;equivalents&nbsp;of&nbsp;&#34;return&nbsp;*addr&#34;&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="1797317">//&nbsp;&#34;*addr&nbsp;=&nbsp;val&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="1797335">//</span><br>
<span class="lineno">40</span><span class="keyword" id="1797338">package</span>&nbsp;<span class="ident" id="1797346">atomic</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1797354">import</span>&nbsp;<span class="op" id="1797361">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1797364">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="1797373">)</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="1797376">//&nbsp;BUG(rsc):&nbsp;On&nbsp;x86-32,&nbsp;the&nbsp;64-bit&nbsp;functions&nbsp;use&nbsp;instructions&nbsp;unavailable&nbsp;before&nbsp;the&nbsp;Pentium&nbsp;MMX.</span><br>
<span class="lineno"></span><span class="comment" id="1797474">//</span><br>
<span class="lineno"></span><span class="comment" id="1797477">//&nbsp;On&nbsp;non-Linux&nbsp;ARM,&nbsp;the&nbsp;64-bit&nbsp;functions&nbsp;use&nbsp;instructions&nbsp;unavailable&nbsp;before&nbsp;the&nbsp;ARMv6k&nbsp;core.</span><br>
<span class="lineno"></span><span class="comment" id="1797572">//</span><br>
<span class="lineno">50</span><span class="comment" id="1797575">//&nbsp;On&nbsp;both&nbsp;ARM&nbsp;and&nbsp;x86-32,&nbsp;it&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;arrange&nbsp;for&nbsp;64-bit</span><br>
<span class="lineno"></span><span class="comment" id="1797658">//&nbsp;alignment&nbsp;of&nbsp;64-bit&nbsp;words&nbsp;accessed&nbsp;atomically.&nbsp;The&nbsp;first&nbsp;word&nbsp;in&nbsp;a&nbsp;global</span><br>
<span class="lineno"></span><span class="comment" id="1797735">//&nbsp;variable&nbsp;or&nbsp;in&nbsp;an&nbsp;allocated&nbsp;struct&nbsp;or&nbsp;slice&nbsp;can&nbsp;be&nbsp;relied&nbsp;upon&nbsp;to&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="1797807">//&nbsp;64-bit&nbsp;aligned.</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="1797827">//&nbsp;SwapInt32&nbsp;atomically&nbsp;stores&nbsp;new&nbsp;into&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;previous&nbsp;*addr&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1797911">func</span>&nbsp;<span class="ident" id="1797916">SwapInt32</span><span class="op" id="1797925">(</span><span class="ident" id="1797926">addr</span>&nbsp;<span class="op" id="1797931">*</span><span class="builtintype" id="1797932">int32</span><span class="op" id="1797937">,</span>&nbsp;<span class="builtinfunc" id="1797939">new</span>&nbsp;<span class="builtintype" id="1797943">int32</span><span class="op" id="1797948">)</span>&nbsp;<span class="op" id="1797950">(</span><span class="ident" id="1797951">old</span>&nbsp;<span class="builtintype" id="1797955">int32</span><span class="op" id="1797960">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1797963">//&nbsp;SwapInt64&nbsp;atomically&nbsp;stores&nbsp;new&nbsp;into&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;previous&nbsp;*addr&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1798047">func</span>&nbsp;<span class="ident" id="1798052">SwapInt64</span><span class="op" id="1798061">(</span><span class="ident" id="1798062">addr</span>&nbsp;<span class="op" id="1798067">*</span><span class="ident" id="1798068">int64</span><span class="op" id="1798073">,</span>&nbsp;<span class="builtinfunc" id="1798075">new</span>&nbsp;<span class="ident" id="1798079">int64</span><span class="op" id="1798084">)</span>&nbsp;<span class="op" id="1798086">(</span><span class="ident" id="1798087">old</span>&nbsp;<span class="ident" id="1798091">int64</span><span class="op" id="1798096">)</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="comment" id="1798099">//&nbsp;SwapUint32&nbsp;atomically&nbsp;stores&nbsp;new&nbsp;into&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;previous&nbsp;*addr&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1798184">func</span>&nbsp;<span class="ident" id="1798189">SwapUint32</span><span class="op" id="1798199">(</span><span class="ident" id="1798200">addr</span>&nbsp;<span class="op" id="1798205">*</span><span class="builtintype" id="1798206">uint32</span><span class="op" id="1798212">,</span>&nbsp;<span class="builtinfunc" id="1798214">new</span>&nbsp;<span class="builtintype" id="1798218">uint32</span><span class="op" id="1798224">)</span>&nbsp;<span class="op" id="1798226">(</span><span class="ident" id="1798227">old</span>&nbsp;<span class="builtintype" id="1798231">uint32</span><span class="op" id="1798237">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1798240">//&nbsp;SwapUint64&nbsp;atomically&nbsp;stores&nbsp;new&nbsp;into&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;previous&nbsp;*addr&nbsp;value.</span><br>
<span class="lineno">65</span><span class="keyword" id="1798325">func</span>&nbsp;<span class="ident" id="1798330">SwapUint64</span><span class="op" id="1798340">(</span><span class="ident" id="1798341">addr</span>&nbsp;<span class="op" id="1798346">*</span><span class="ident" id="1798347">uint64</span><span class="op" id="1798353">,</span>&nbsp;<span class="builtinfunc" id="1798355">new</span>&nbsp;<span class="ident" id="1798359">uint64</span><span class="op" id="1798365">)</span>&nbsp;<span class="op" id="1798367">(</span><span class="ident" id="1798368">old</span>&nbsp;<span class="ident" id="1798372">uint64</span><span class="op" id="1798378">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1798381">//&nbsp;SwapUintptr&nbsp;atomically&nbsp;stores&nbsp;new&nbsp;into&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;previous&nbsp;*addr&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1798467">func</span>&nbsp;<span class="ident" id="1798472">SwapUintptr</span><span class="op" id="1798483">(</span><span class="ident" id="1798484">addr</span>&nbsp;<span class="op" id="1798489">*</span><span class="builtintype" id="1798490">uintptr</span><span class="op" id="1798497">,</span>&nbsp;<span class="builtinfunc" id="1798499">new</span>&nbsp;<span class="builtintype" id="1798503">uintptr</span><span class="op" id="1798510">)</span>&nbsp;<span class="op" id="1798512">(</span><span class="ident" id="1798513">old</span>&nbsp;<span class="builtintype" id="1798517">uintptr</span><span class="op" id="1798524">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="comment" id="1798527">//&nbsp;SwapPointer&nbsp;atomically&nbsp;stores&nbsp;new&nbsp;into&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;previous&nbsp;*addr&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1798613">func</span>&nbsp;<span class="ident" id="1798618">SwapPointer</span><span class="op" id="1798629">(</span><span class="ident" id="1798630">addr</span>&nbsp;<span class="op" id="1798635">*</span><span class="ident" id="1798636">unsafe</span><span class="op" id="1798642">.</span><span class="ident" id="1798643">Pointer</span><span class="op" id="1798650">,</span>&nbsp;<span class="builtinfunc" id="1798652">new</span>&nbsp;<span class="ident" id="1798656">unsafe</span><span class="op" id="1798662">.</span><span class="ident" id="1798663">Pointer</span><span class="op" id="1798670">)</span>&nbsp;<span class="op" id="1798672">(</span><span class="ident" id="1798673">old</span>&nbsp;<span class="ident" id="1798677">unsafe</span><span class="op" id="1798683">.</span><span class="ident" id="1798684">Pointer</span><span class="op" id="1798691">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1798694">//&nbsp;CompareAndSwapInt32&nbsp;executes&nbsp;the&nbsp;compare-and-swap&nbsp;operation&nbsp;for&nbsp;an&nbsp;int32&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1798777">func</span>&nbsp;<span class="ident" id="1798782">CompareAndSwapInt32</span><span class="op" id="1798801">(</span><span class="ident" id="1798802">addr</span>&nbsp;<span class="op" id="1798807">*</span><span class="builtintype" id="1798808">int32</span><span class="op" id="1798813">,</span>&nbsp;<span class="ident" id="1798815">old</span><span class="op" id="1798818">,</span>&nbsp;<span class="builtinfunc" id="1798820">new</span>&nbsp;<span class="builtintype" id="1798824">int32</span><span class="op" id="1798829">)</span>&nbsp;<span class="op" id="1798831">(</span><span class="ident" id="1798832">swapped</span>&nbsp;<span class="builtintype" id="1798840">bool</span><span class="op" id="1798844">)</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="comment" id="1798847">//&nbsp;CompareAndSwapInt64&nbsp;executes&nbsp;the&nbsp;compare-and-swap&nbsp;operation&nbsp;for&nbsp;an&nbsp;int64&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1798930">func</span>&nbsp;<span class="ident" id="1798935">CompareAndSwapInt64</span><span class="op" id="1798954">(</span><span class="ident" id="1798955">addr</span>&nbsp;<span class="op" id="1798960">*</span><span class="ident" id="1798961">int64</span><span class="op" id="1798966">,</span>&nbsp;<span class="ident" id="1798968">old</span><span class="op" id="1798971">,</span>&nbsp;<span class="builtinfunc" id="1798973">new</span>&nbsp;<span class="ident" id="1798977">int64</span><span class="op" id="1798982">)</span>&nbsp;<span class="op" id="1798984">(</span><span class="ident" id="1798985">swapped</span>&nbsp;<span class="builtintype" id="1798993">bool</span><span class="op" id="1798997">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1799000">//&nbsp;CompareAndSwapUint32&nbsp;executes&nbsp;the&nbsp;compare-and-swap&nbsp;operation&nbsp;for&nbsp;a&nbsp;uint32&nbsp;value.</span><br>
<span class="lineno">80</span><span class="keyword" id="1799084">func</span>&nbsp;<span class="ident" id="1799089">CompareAndSwapUint32</span><span class="op" id="1799109">(</span><span class="ident" id="1799110">addr</span>&nbsp;<span class="op" id="1799115">*</span><span class="builtintype" id="1799116">uint32</span><span class="op" id="1799122">,</span>&nbsp;<span class="ident" id="1799124">old</span><span class="op" id="1799127">,</span>&nbsp;<span class="builtinfunc" id="1799129">new</span>&nbsp;<span class="builtintype" id="1799133">uint32</span><span class="op" id="1799139">)</span>&nbsp;<span class="op" id="1799141">(</span><span class="ident" id="1799142">swapped</span>&nbsp;<span class="builtintype" id="1799150">bool</span><span class="op" id="1799154">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1799157">//&nbsp;CompareAndSwapUint64&nbsp;executes&nbsp;the&nbsp;compare-and-swap&nbsp;operation&nbsp;for&nbsp;a&nbsp;uint64&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1799241">func</span>&nbsp;<span class="ident" id="1799246">CompareAndSwapUint64</span><span class="op" id="1799266">(</span><span class="ident" id="1799267">addr</span>&nbsp;<span class="op" id="1799272">*</span><span class="ident" id="1799273">uint64</span><span class="op" id="1799279">,</span>&nbsp;<span class="ident" id="1799281">old</span><span class="op" id="1799284">,</span>&nbsp;<span class="builtinfunc" id="1799286">new</span>&nbsp;<span class="ident" id="1799290">uint64</span><span class="op" id="1799296">)</span>&nbsp;<span class="op" id="1799298">(</span><span class="ident" id="1799299">swapped</span>&nbsp;<span class="builtintype" id="1799307">bool</span><span class="op" id="1799311">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="comment" id="1799314">//&nbsp;CompareAndSwapUintptr&nbsp;executes&nbsp;the&nbsp;compare-and-swap&nbsp;operation&nbsp;for&nbsp;a&nbsp;uintptr&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1799400">func</span>&nbsp;<span class="ident" id="1799405">CompareAndSwapUintptr</span><span class="op" id="1799426">(</span><span class="ident" id="1799427">addr</span>&nbsp;<span class="op" id="1799432">*</span><span class="builtintype" id="1799433">uintptr</span><span class="op" id="1799440">,</span>&nbsp;<span class="ident" id="1799442">old</span><span class="op" id="1799445">,</span>&nbsp;<span class="builtinfunc" id="1799447">new</span>&nbsp;<span class="builtintype" id="1799451">uintptr</span><span class="op" id="1799458">)</span>&nbsp;<span class="op" id="1799460">(</span><span class="ident" id="1799461">swapped</span>&nbsp;<span class="builtintype" id="1799469">bool</span><span class="op" id="1799473">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1799476">//&nbsp;CompareAndSwapPointer&nbsp;executes&nbsp;the&nbsp;compare-and-swap&nbsp;operation&nbsp;for&nbsp;a&nbsp;unsafe.Pointer&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1799569">func</span>&nbsp;<span class="ident" id="1799574">CompareAndSwapPointer</span><span class="op" id="1799595">(</span><span class="ident" id="1799596">addr</span>&nbsp;<span class="op" id="1799601">*</span><span class="ident" id="1799602">unsafe</span><span class="op" id="1799608">.</span><span class="ident" id="1799609">Pointer</span><span class="op" id="1799616">,</span>&nbsp;<span class="ident" id="1799618">old</span><span class="op" id="1799621">,</span>&nbsp;<span class="builtinfunc" id="1799623">new</span>&nbsp;<span class="ident" id="1799627">unsafe</span><span class="op" id="1799633">.</span><span class="ident" id="1799634">Pointer</span><span class="op" id="1799641">)</span>&nbsp;<span class="op" id="1799643">(</span><span class="ident" id="1799644">swapped</span>&nbsp;<span class="builtintype" id="1799652">bool</span><span class="op" id="1799656">)</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="comment" id="1799659">//&nbsp;AddInt32&nbsp;atomically&nbsp;adds&nbsp;delta&nbsp;to&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1799729">func</span>&nbsp;<span class="ident" id="1799734">AddInt32</span><span class="op" id="1799742">(</span><span class="ident" id="1799743">addr</span>&nbsp;<span class="op" id="1799748">*</span><span class="builtintype" id="1799749">int32</span><span class="op" id="1799754">,</span>&nbsp;<span class="ident" id="1799756">delta</span>&nbsp;<span class="builtintype" id="1799762">int32</span><span class="op" id="1799767">)</span>&nbsp;<span class="op" id="1799769">(</span><span class="builtinfunc" id="1799770">new</span>&nbsp;<span class="builtintype" id="1799774">int32</span><span class="op" id="1799779">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1799782">//&nbsp;AddUint32&nbsp;atomically&nbsp;adds&nbsp;delta&nbsp;to&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;value.</span><br>
<span class="lineno">95</span><span class="comment" id="1799853">//&nbsp;To&nbsp;subtract&nbsp;a&nbsp;signed&nbsp;positive&nbsp;constant&nbsp;value&nbsp;c&nbsp;from&nbsp;x,&nbsp;do&nbsp;AddUint32(&amp;x,&nbsp;^uint32(c-1)).</span><br>
<span class="lineno"></span><span class="comment" id="1799943">//&nbsp;In&nbsp;particular,&nbsp;to&nbsp;decrement&nbsp;x,&nbsp;do&nbsp;AddUint32(&amp;x,&nbsp;^uint32(0)).</span><br>
<span class="lineno"></span><span class="keyword" id="1800007">func</span>&nbsp;<span class="ident" id="1800012">AddUint32</span><span class="op" id="1800021">(</span><span class="ident" id="1800022">addr</span>&nbsp;<span class="op" id="1800027">*</span><span class="builtintype" id="1800028">uint32</span><span class="op" id="1800034">,</span>&nbsp;<span class="ident" id="1800036">delta</span>&nbsp;<span class="builtintype" id="1800042">uint32</span><span class="op" id="1800048">)</span>&nbsp;<span class="op" id="1800050">(</span><span class="builtinfunc" id="1800051">new</span>&nbsp;<span class="builtintype" id="1800055">uint32</span><span class="op" id="1800061">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1800064">//&nbsp;AddInt64&nbsp;atomically&nbsp;adds&nbsp;delta&nbsp;to&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;value.</span><br>
<span class="lineno">100</span><span class="keyword" id="1800134">func</span>&nbsp;<span class="ident" id="1800139">AddInt64</span><span class="op" id="1800147">(</span><span class="ident" id="1800148">addr</span>&nbsp;<span class="op" id="1800153">*</span><span class="ident" id="1800154">int64</span><span class="op" id="1800159">,</span>&nbsp;<span class="ident" id="1800161">delta</span>&nbsp;<span class="ident" id="1800167">int64</span><span class="op" id="1800172">)</span>&nbsp;<span class="op" id="1800174">(</span><span class="builtinfunc" id="1800175">new</span>&nbsp;<span class="ident" id="1800179">int64</span><span class="op" id="1800184">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1800187">//&nbsp;AddUint64&nbsp;atomically&nbsp;adds&nbsp;delta&nbsp;to&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="1800258">//&nbsp;To&nbsp;subtract&nbsp;a&nbsp;signed&nbsp;positive&nbsp;constant&nbsp;value&nbsp;c&nbsp;from&nbsp;x,&nbsp;do&nbsp;AddUint64(&amp;x,&nbsp;^uint64(c-1)).</span><br>
<span class="lineno"></span><span class="comment" id="1800348">//&nbsp;In&nbsp;particular,&nbsp;to&nbsp;decrement&nbsp;x,&nbsp;do&nbsp;AddUint64(&amp;x,&nbsp;^uint64(0)).</span><br>
<span class="lineno">105</span><span class="keyword" id="1800412">func</span>&nbsp;<span class="ident" id="1800417">AddUint64</span><span class="op" id="1800426">(</span><span class="ident" id="1800427">addr</span>&nbsp;<span class="op" id="1800432">*</span><span class="ident" id="1800433">uint64</span><span class="op" id="1800439">,</span>&nbsp;<span class="ident" id="1800441">delta</span>&nbsp;<span class="ident" id="1800447">uint64</span><span class="op" id="1800453">)</span>&nbsp;<span class="op" id="1800455">(</span><span class="builtinfunc" id="1800456">new</span>&nbsp;<span class="ident" id="1800460">uint64</span><span class="op" id="1800466">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1800469">//&nbsp;AddUintptr&nbsp;atomically&nbsp;adds&nbsp;delta&nbsp;to&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1800541">func</span>&nbsp;<span class="ident" id="1800546">AddUintptr</span><span class="op" id="1800556">(</span><span class="ident" id="1800557">addr</span>&nbsp;<span class="op" id="1800562">*</span><span class="builtintype" id="1800563">uintptr</span><span class="op" id="1800570">,</span>&nbsp;<span class="ident" id="1800572">delta</span>&nbsp;<span class="builtintype" id="1800578">uintptr</span><span class="op" id="1800585">)</span>&nbsp;<span class="op" id="1800587">(</span><span class="builtinfunc" id="1800588">new</span>&nbsp;<span class="builtintype" id="1800592">uintptr</span><span class="op" id="1800599">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="1800602">//&nbsp;LoadInt32&nbsp;atomically&nbsp;loads&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1800639">func</span>&nbsp;<span class="ident" id="1800644">LoadInt32</span><span class="op" id="1800653">(</span><span class="ident" id="1800654">addr</span>&nbsp;<span class="op" id="1800659">*</span><span class="builtintype" id="1800660">int32</span><span class="op" id="1800665">)</span>&nbsp;<span class="op" id="1800667">(</span><span class="ident" id="1800668">val</span>&nbsp;<span class="builtintype" id="1800672">int32</span><span class="op" id="1800677">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1800680">//&nbsp;LoadInt64&nbsp;atomically&nbsp;loads&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1800717">func</span>&nbsp;<span class="ident" id="1800722">LoadInt64</span><span class="op" id="1800731">(</span><span class="ident" id="1800732">addr</span>&nbsp;<span class="op" id="1800737">*</span><span class="ident" id="1800738">int64</span><span class="op" id="1800743">)</span>&nbsp;<span class="op" id="1800745">(</span><span class="ident" id="1800746">val</span>&nbsp;<span class="ident" id="1800750">int64</span><span class="op" id="1800755">)</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="1800758">//&nbsp;LoadUint32&nbsp;atomically&nbsp;loads&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1800796">func</span>&nbsp;<span class="ident" id="1800801">LoadUint32</span><span class="op" id="1800811">(</span><span class="ident" id="1800812">addr</span>&nbsp;<span class="op" id="1800817">*</span><span class="builtintype" id="1800818">uint32</span><span class="op" id="1800824">)</span>&nbsp;<span class="op" id="1800826">(</span><span class="ident" id="1800827">val</span>&nbsp;<span class="builtintype" id="1800831">uint32</span><span class="op" id="1800837">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1800840">//&nbsp;LoadUint64&nbsp;atomically&nbsp;loads&nbsp;*addr.</span><br>
<span class="lineno">120</span><span class="keyword" id="1800878">func</span>&nbsp;<span class="ident" id="1800883">LoadUint64</span><span class="op" id="1800893">(</span><span class="ident" id="1800894">addr</span>&nbsp;<span class="op" id="1800899">*</span><span class="ident" id="1800900">uint64</span><span class="op" id="1800906">)</span>&nbsp;<span class="op" id="1800908">(</span><span class="ident" id="1800909">val</span>&nbsp;<span class="ident" id="1800913">uint64</span><span class="op" id="1800919">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1800922">//&nbsp;LoadUintptr&nbsp;atomically&nbsp;loads&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1800961">func</span>&nbsp;<span class="ident" id="1800966">LoadUintptr</span><span class="op" id="1800977">(</span><span class="ident" id="1800978">addr</span>&nbsp;<span class="op" id="1800983">*</span><span class="builtintype" id="1800984">uintptr</span><span class="op" id="1800991">)</span>&nbsp;<span class="op" id="1800993">(</span><span class="ident" id="1800994">val</span>&nbsp;<span class="builtintype" id="1800998">uintptr</span><span class="op" id="1801005">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment" id="1801008">//&nbsp;LoadPointer&nbsp;atomically&nbsp;loads&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1801047">func</span>&nbsp;<span class="ident" id="1801052">LoadPointer</span><span class="op" id="1801063">(</span><span class="ident" id="1801064">addr</span>&nbsp;<span class="op" id="1801069">*</span><span class="ident" id="1801070">unsafe</span><span class="op" id="1801076">.</span><span class="ident" id="1801077">Pointer</span><span class="op" id="1801084">)</span>&nbsp;<span class="op" id="1801086">(</span><span class="ident" id="1801087">val</span>&nbsp;<span class="ident" id="1801091">unsafe</span><span class="op" id="1801097">.</span><span class="ident" id="1801098">Pointer</span><span class="op" id="1801105">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1801108">//&nbsp;StoreInt32&nbsp;atomically&nbsp;stores&nbsp;val&nbsp;into&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1801156">func</span>&nbsp;<span class="ident" id="1801161">StoreInt32</span><span class="op" id="1801171">(</span><span class="ident" id="1801172">addr</span>&nbsp;<span class="op" id="1801177">*</span><span class="builtintype" id="1801178">int32</span><span class="op" id="1801183">,</span>&nbsp;<span class="ident" id="1801185">val</span>&nbsp;<span class="builtintype" id="1801189">int32</span><span class="op" id="1801194">)</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="1801197">//&nbsp;StoreInt64&nbsp;atomically&nbsp;stores&nbsp;val&nbsp;into&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1801245">func</span>&nbsp;<span class="ident" id="1801250">StoreInt64</span><span class="op" id="1801260">(</span><span class="ident" id="1801261">addr</span>&nbsp;<span class="op" id="1801266">*</span><span class="ident" id="1801267">int64</span><span class="op" id="1801272">,</span>&nbsp;<span class="ident" id="1801274">val</span>&nbsp;<span class="ident" id="1801278">int64</span><span class="op" id="1801283">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1801286">//&nbsp;StoreUint32&nbsp;atomically&nbsp;stores&nbsp;val&nbsp;into&nbsp;*addr.</span><br>
<span class="lineno">135</span><span class="keyword" id="1801335">func</span>&nbsp;<span class="ident" id="1801340">StoreUint32</span><span class="op" id="1801351">(</span><span class="ident" id="1801352">addr</span>&nbsp;<span class="op" id="1801357">*</span><span class="builtintype" id="1801358">uint32</span><span class="op" id="1801364">,</span>&nbsp;<span class="ident" id="1801366">val</span>&nbsp;<span class="builtintype" id="1801370">uint32</span><span class="op" id="1801376">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1801379">//&nbsp;StoreUint64&nbsp;atomically&nbsp;stores&nbsp;val&nbsp;into&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1801428">func</span>&nbsp;<span class="ident" id="1801433">StoreUint64</span><span class="op" id="1801444">(</span><span class="ident" id="1801445">addr</span>&nbsp;<span class="op" id="1801450">*</span><span class="ident" id="1801451">uint64</span><span class="op" id="1801457">,</span>&nbsp;<span class="ident" id="1801459">val</span>&nbsp;<span class="ident" id="1801463">uint64</span><span class="op" id="1801469">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span><span class="comment" id="1801472">//&nbsp;StoreUintptr&nbsp;atomically&nbsp;stores&nbsp;val&nbsp;into&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1801522">func</span>&nbsp;<span class="ident" id="1801527">StoreUintptr</span><span class="op" id="1801539">(</span><span class="ident" id="1801540">addr</span>&nbsp;<span class="op" id="1801545">*</span><span class="builtintype" id="1801546">uintptr</span><span class="op" id="1801553">,</span>&nbsp;<span class="ident" id="1801555">val</span>&nbsp;<span class="builtintype" id="1801559">uintptr</span><span class="op" id="1801566">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1801569">//&nbsp;StorePointer&nbsp;atomically&nbsp;stores&nbsp;val&nbsp;into&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1801619">func</span>&nbsp;<span class="ident" id="1801624">StorePointer</span><span class="op" id="1801636">(</span><span class="ident" id="1801637">addr</span>&nbsp;<span class="op" id="1801642">*</span><span class="ident" id="1801643">unsafe</span><span class="op" id="1801649">.</span><span class="ident" id="1801650">Pointer</span><span class="op" id="1801657">,</span>&nbsp;<span class="ident" id="1801659">val</span>&nbsp;<span class="ident" id="1801663">unsafe</span><span class="op" id="1801669">.</span><span class="ident" id="1801670">Pointer</span><span class="op" id="1801677">)</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="comment" id="1801680">//&nbsp;Helper&nbsp;for&nbsp;ARM.&nbsp;&nbsp;Linker&nbsp;will&nbsp;discard&nbsp;on&nbsp;other&nbsp;systems</span><br>
<span class="lineno"></span><span class="keyword" id="1801737">func</span>&nbsp;<span class="ident" id="1801742">panic64</span><span class="op" id="1801749">(</span><span class="op" id="1801750">)</span>&nbsp;<span class="op" id="1801752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1801755">panic</span><span class="op" id="1801760">(</span><span class="string" id="1801761">&#34;sync/atomic:&nbsp;broken&nbsp;64-bit&nbsp;atomic&nbsp;operations&nbsp;(buggy&nbsp;QEMU)&#34;</span><span class="op" id="1801820">)</span><br>
<span class="lineno"></span><span class="op" id="1801822">}</span>
</div>
</body>
</html>
