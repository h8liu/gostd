<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/cookiejar</h2>
<ul>
<li><a href="/gostd/net/http/cookiejar/jar.go.html" class="current">jar.go</a></li>
<li><a href="/gostd/net/http/cookiejar/jar_test.go.html">jar_test.go</a></li>
<li><a href="/gostd/net/http/cookiejar/punycode.go.html">punycode.go</a></li>
<li><a href="/gostd/net/http/cookiejar/punycode_test.go.html">punycode_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5910407">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5910462">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5910516">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5910567">//&nbsp;Package&nbsp;cookiejar&nbsp;implements&nbsp;an&nbsp;in-memory&nbsp;RFC&nbsp;6265-compliant&nbsp;http.CookieJar.</span><br>
<span class="lineno"></span><span class="keyword" id="5910647">package</span>&nbsp;<span class="ident" id="5910655">cookiejar</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5910666">import</span>&nbsp;<span class="op" id="5910673">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5910676">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5910686">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5910693">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5910700">&#34;net/http&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5910712">&#34;net/url&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5910723">&#34;sort&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5910731">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5910742">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5910750">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="5910757">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="5910760">//&nbsp;PublicSuffixList&nbsp;provides&nbsp;the&nbsp;public&nbsp;suffix&nbsp;of&nbsp;a&nbsp;domain.&nbsp;For&nbsp;example:</span><br>
<span class="lineno"></span><span class="comment" id="5910833">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;public&nbsp;suffix&nbsp;of&nbsp;&#34;example.com&#34;&nbsp;is&nbsp;&#34;com&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="5910888">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;public&nbsp;suffix&nbsp;of&nbsp;&#34;foo1.foo2.foo3.co.uk&#34;&nbsp;is&nbsp;&#34;co.uk&#34;,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5910958">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;public&nbsp;suffix&nbsp;of&nbsp;&#34;bar.pvt.k12.ma.us&#34;&nbsp;is&nbsp;&#34;pvt.k12.ma.us&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="5911029">//</span><br>
<span class="lineno">25</span><span class="comment" id="5911032">//&nbsp;Implementations&nbsp;of&nbsp;PublicSuffixList&nbsp;must&nbsp;be&nbsp;safe&nbsp;for&nbsp;concurrent&nbsp;use&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="5911106">//&nbsp;multiple&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="comment" id="5911130">//</span><br>
<span class="lineno"></span><span class="comment" id="5911133">//&nbsp;An&nbsp;implementation&nbsp;that&nbsp;always&nbsp;returns&nbsp;&#34;&#34;&nbsp;is&nbsp;valid&nbsp;and&nbsp;may&nbsp;be&nbsp;useful&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="5911208">//&nbsp;testing&nbsp;but&nbsp;it&nbsp;is&nbsp;not&nbsp;secure:&nbsp;it&nbsp;means&nbsp;that&nbsp;the&nbsp;HTTP&nbsp;server&nbsp;for&nbsp;foo.com&nbsp;can</span><br>
<span class="lineno">30</span><span class="comment" id="5911287">//&nbsp;set&nbsp;a&nbsp;cookie&nbsp;for&nbsp;bar.com.</span><br>
<span class="lineno"></span><span class="comment" id="5911316">//</span><br>
<span class="lineno"></span><span class="comment" id="5911319">//&nbsp;A&nbsp;public&nbsp;suffix&nbsp;list&nbsp;implementation&nbsp;is&nbsp;in&nbsp;the&nbsp;package</span><br>
<span class="lineno"></span><span class="comment" id="5911376">//&nbsp;golang.org/x/net/publicsuffix.</span><br>
<span class="lineno"></span><span class="keyword" id="5911410">type</span>&nbsp;<span class="ident" id="5911415">PublicSuffixList</span>&nbsp;<span class="keyword" id="5911432">interface</span>&nbsp;<span class="op" id="5911442">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5911445">//&nbsp;PublicSuffix&nbsp;returns&nbsp;the&nbsp;public&nbsp;suffix&nbsp;of&nbsp;domain.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5911499">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5911503">//&nbsp;TODO:&nbsp;specify&nbsp;which&nbsp;of&nbsp;the&nbsp;caller&nbsp;and&nbsp;callee&nbsp;is&nbsp;responsible&nbsp;for&nbsp;IP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5911574">//&nbsp;addresses,&nbsp;for&nbsp;leading&nbsp;and&nbsp;trailing&nbsp;dots,&nbsp;for&nbsp;case&nbsp;sensitivity,&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5911646">//&nbsp;for&nbsp;IDN/Punycode.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5911668">PublicSuffix</span><span class="op" id="5911680">(</span><span class="ident" id="5911681">domain</span>&nbsp;<span class="builtintype" id="5911688">string</span><span class="op" id="5911694">)</span>&nbsp;<span class="builtintype" id="5911696">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5911705">//&nbsp;String&nbsp;returns&nbsp;a&nbsp;description&nbsp;of&nbsp;the&nbsp;source&nbsp;of&nbsp;this&nbsp;public&nbsp;suffix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5911774">//&nbsp;list.&nbsp;The&nbsp;description&nbsp;will&nbsp;typically&nbsp;contain&nbsp;something&nbsp;like&nbsp;a&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5911845">//&nbsp;stamp&nbsp;or&nbsp;version&nbsp;number.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5911874">String</span><span class="op" id="5911880">(</span><span class="op" id="5911881">)</span>&nbsp;<span class="builtintype" id="5911883">string</span><br>
<span class="lineno"></span><span class="op" id="5911890">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5911893">//&nbsp;Options&nbsp;are&nbsp;the&nbsp;options&nbsp;for&nbsp;creating&nbsp;a&nbsp;new&nbsp;Jar.</span><br>
<span class="lineno"></span><span class="keyword" id="5911944">type</span>&nbsp;<span class="ident" id="5911949">Options</span>&nbsp;<span class="keyword" id="5911957">struct</span>&nbsp;<span class="op" id="5911964">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5911967">//&nbsp;PublicSuffixList&nbsp;is&nbsp;the&nbsp;public&nbsp;suffix&nbsp;list&nbsp;that&nbsp;determines&nbsp;whether</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5912038">//&nbsp;an&nbsp;HTTP&nbsp;server&nbsp;can&nbsp;set&nbsp;a&nbsp;cookie&nbsp;for&nbsp;a&nbsp;domain.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5912088">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5912092">//&nbsp;A&nbsp;nil&nbsp;value&nbsp;is&nbsp;valid&nbsp;and&nbsp;may&nbsp;be&nbsp;useful&nbsp;for&nbsp;testing&nbsp;but&nbsp;it&nbsp;is&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5912161">//&nbsp;secure:&nbsp;it&nbsp;means&nbsp;that&nbsp;the&nbsp;HTTP&nbsp;server&nbsp;for&nbsp;foo.co.uk&nbsp;can&nbsp;set&nbsp;a&nbsp;cookie</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5912234">//&nbsp;for&nbsp;bar.co.uk.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5912253">PublicSuffixList</span>&nbsp;<span class="ident" id="5912270">PublicSuffixList</span><br>
<span class="lineno"></span><span class="op" id="5912287">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5912290">//&nbsp;Jar&nbsp;implements&nbsp;the&nbsp;http.CookieJar&nbsp;interface&nbsp;from&nbsp;the&nbsp;net/http&nbsp;package.</span><br>
<span class="lineno">60</span><span class="keyword" id="5912364">type</span>&nbsp;<span class="ident" id="5912369">Jar</span>&nbsp;<span class="keyword" id="5912373">struct</span>&nbsp;<span class="op" id="5912380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5912383">psList</span>&nbsp;<span class="ident" id="5912390">PublicSuffixList</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5912409">//&nbsp;mu&nbsp;locks&nbsp;the&nbsp;remaining&nbsp;fields.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5912444">mu</span>&nbsp;<span class="ident" id="5912447">sync</span><span class="op" id="5912451">.</span><span class="ident" id="5912452">Mutex</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5912460">//&nbsp;entries&nbsp;is&nbsp;a&nbsp;set&nbsp;of&nbsp;entries,&nbsp;keyed&nbsp;by&nbsp;their&nbsp;eTLD+1&nbsp;and&nbsp;subkeyed&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5912531">//&nbsp;their&nbsp;name/domain/path.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5912559">entries</span>&nbsp;<span class="keyword" id="5912567">map</span><span class="op" id="5912570">[</span><span class="builtintype" id="5912571">string</span><span class="op" id="5912577">]</span><span class="keyword" id="5912578">map</span><span class="op" id="5912581">[</span><span class="builtintype" id="5912582">string</span><span class="op" id="5912588">]</span><span class="ident" id="5912589">entry</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5912597">//&nbsp;nextSeqNum&nbsp;is&nbsp;the&nbsp;next&nbsp;sequence&nbsp;number&nbsp;assigned&nbsp;to&nbsp;a&nbsp;new&nbsp;cookie</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5912665">//&nbsp;created&nbsp;SetCookies.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5912689">nextSeqNum</span>&nbsp;<span class="ident" id="5912700">uint64</span><br>
<span class="lineno"></span><span class="op" id="5912707">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="comment" id="5912710">//&nbsp;New&nbsp;returns&nbsp;a&nbsp;new&nbsp;cookie&nbsp;jar.&nbsp;A&nbsp;nil&nbsp;*Options&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;a&nbsp;zero</span><br>
<span class="lineno"></span><span class="comment" id="5912782">//&nbsp;Options.</span><br>
<span class="lineno"></span><span class="keyword" id="5912794">func</span>&nbsp;<span class="ident" id="5912799">New</span><span class="op" id="5912802">(</span><span class="ident" id="5912803">o</span>&nbsp;<span class="op" id="5912805">*</span><span class="ident" id="5912806">Options</span><span class="op" id="5912813">)</span>&nbsp;<span class="op" id="5912815">(</span><span class="op" id="5912816">*</span><span class="ident" id="5912817">Jar</span><span class="op" id="5912820">,</span>&nbsp;<span class="builtintype" id="5912822">error</span><span class="op" id="5912827">)</span>&nbsp;<span class="op" id="5912829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5912832">jar</span>&nbsp;<span class="op" id="5912836">:=</span>&nbsp;<span class="op" id="5912839">&amp;</span><span class="ident" id="5912840">Jar</span><span class="op" id="5912843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5912847">entries</span><span class="op" id="5912854">:</span>&nbsp;<span class="builtinfunc" id="5912856">make</span><span class="op" id="5912860">(</span><span class="keyword" id="5912861">map</span><span class="op" id="5912864">[</span><span class="builtintype" id="5912865">string</span><span class="op" id="5912871">]</span><span class="keyword" id="5912872">map</span><span class="op" id="5912875">[</span><span class="builtintype" id="5912876">string</span><span class="op" id="5912882">]</span><span class="ident" id="5912883">entry</span><span class="op" id="5912888">)</span><span class="op" id="5912889">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5912892">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5912895">if</span>&nbsp;<span class="ident" id="5912898">o</span>&nbsp;<span class="op" id="5912900">!=</span>&nbsp;<span class="builtintype" id="5912903">nil</span>&nbsp;<span class="op" id="5912907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5912911">jar</span><span class="op" id="5912914">.</span><span class="ident" id="5912915">psList</span>&nbsp;<span class="op" id="5912922">=</span>&nbsp;<span class="ident" id="5912924">o</span><span class="op" id="5912925">.</span><span class="ident" id="5912926">PublicSuffixList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5912944">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5912947">return</span>&nbsp;<span class="ident" id="5912954">jar</span><span class="op" id="5912957">,</span>&nbsp;<span class="builtintype" id="5912959">nil</span><br>
<span class="lineno">85</span><span class="op" id="5912963">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5912966">//&nbsp;entry&nbsp;is&nbsp;the&nbsp;internal&nbsp;representation&nbsp;of&nbsp;a&nbsp;cookie.</span><br>
<span class="lineno"></span><span class="comment" id="5913019">//</span><br>
<span class="lineno"></span><span class="comment" id="5913022">//&nbsp;This&nbsp;struct&nbsp;type&nbsp;is&nbsp;not&nbsp;used&nbsp;outside&nbsp;of&nbsp;this&nbsp;package&nbsp;per&nbsp;se,&nbsp;but&nbsp;the&nbsp;exported</span><br>
<span class="lineno">90</span><span class="comment" id="5913103">//&nbsp;fields&nbsp;are&nbsp;those&nbsp;of&nbsp;RFC&nbsp;6265.</span><br>
<span class="lineno"></span><span class="keyword" id="5913136">type</span>&nbsp;<span class="ident" id="5913141">entry</span>&nbsp;<span class="keyword" id="5913147">struct</span>&nbsp;<span class="op" id="5913154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5913157">Name</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5913168">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5913176">Value</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5913187">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5913195">Domain</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5913206">string</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5913214">Path</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5913225">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5913233">Secure</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5913244">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5913250">HttpOnly</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5913261">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5913267">Persistent</span>&nbsp;<span class="builtintype" id="5913278">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5913284">HostOnly</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5913295">bool</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5913301">Expires</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5913312">time</span><span class="op" id="5913316">.</span><span class="ident" id="5913317">Time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5913323">Creation</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5913334">time</span><span class="op" id="5913338">.</span><span class="ident" id="5913339">Time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5913345">LastAccess</span>&nbsp;<span class="ident" id="5913356">time</span><span class="op" id="5913360">.</span><span class="ident" id="5913361">Time</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5913368">//&nbsp;seqNum&nbsp;is&nbsp;a&nbsp;sequence&nbsp;number&nbsp;so&nbsp;that&nbsp;Cookies&nbsp;returns&nbsp;cookies&nbsp;in&nbsp;a</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5913437">//&nbsp;deterministic&nbsp;order,&nbsp;even&nbsp;for&nbsp;cookies&nbsp;that&nbsp;have&nbsp;equal&nbsp;Path&nbsp;length&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5913511">//&nbsp;equal&nbsp;Creation&nbsp;time.&nbsp;This&nbsp;simplifies&nbsp;testing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5913561">seqNum</span>&nbsp;<span class="ident" id="5913568">uint64</span><br>
<span class="lineno"></span><span class="op" id="5913575">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="5913578">//&nbsp;Id&nbsp;returns&nbsp;the&nbsp;domain;path;name&nbsp;triple&nbsp;of&nbsp;e&nbsp;as&nbsp;an&nbsp;id.</span><br>
<span class="lineno"></span><span class="keyword" id="5913635">func</span>&nbsp;<span class="op" id="5913640">(</span><span class="ident" id="5913641">e</span>&nbsp;<span class="op" id="5913643">*</span><span class="ident" id="5913644">entry</span><span class="op" id="5913649">)</span>&nbsp;<span class="ident" id="5913651">id</span><span class="op" id="5913653">(</span><span class="op" id="5913654">)</span>&nbsp;<span class="builtintype" id="5913656">string</span>&nbsp;<span class="op" id="5913663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5913666">return</span>&nbsp;<span class="ident" id="5913673">fmt</span><span class="op" id="5913676">.</span><span class="ident" id="5913677">Sprintf</span><span class="op" id="5913684">(</span><span class="string" id="5913685">&#34;%s;%s;%s&#34;</span><span class="op" id="5913695">,</span>&nbsp;<span class="ident" id="5913697">e</span><span class="op" id="5913698">.</span><span class="ident" id="5913699">Domain</span><span class="op" id="5913705">,</span>&nbsp;<span class="ident" id="5913707">e</span><span class="op" id="5913708">.</span><span class="ident" id="5913709">Path</span><span class="op" id="5913713">,</span>&nbsp;<span class="ident" id="5913715">e</span><span class="op" id="5913716">.</span><span class="ident" id="5913717">Name</span><span class="op" id="5913721">)</span><br>
<span class="lineno"></span><span class="op" id="5913723">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="comment" id="5913726">//&nbsp;shouldSend&nbsp;determines&nbsp;whether&nbsp;e&#39;s&nbsp;cookie&nbsp;qualifies&nbsp;to&nbsp;be&nbsp;included&nbsp;in&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5913800">//&nbsp;request&nbsp;to&nbsp;host/path.&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;check&nbsp;if&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5913875">//&nbsp;cookie&nbsp;is&nbsp;expired.</span><br>
<span class="lineno"></span><span class="keyword" id="5913897">func</span>&nbsp;<span class="op" id="5913902">(</span><span class="ident" id="5913903">e</span>&nbsp;<span class="op" id="5913905">*</span><span class="ident" id="5913906">entry</span><span class="op" id="5913911">)</span>&nbsp;<span class="ident" id="5913913">shouldSend</span><span class="op" id="5913923">(</span><span class="ident" id="5913924">https</span>&nbsp;<span class="builtintype" id="5913930">bool</span><span class="op" id="5913934">,</span>&nbsp;<span class="ident" id="5913936">host</span><span class="op" id="5913940">,</span>&nbsp;<span class="ident" id="5913942">path</span>&nbsp;<span class="builtintype" id="5913947">string</span><span class="op" id="5913953">)</span>&nbsp;<span class="builtintype" id="5913955">bool</span>&nbsp;<span class="op" id="5913960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5913963">return</span>&nbsp;<span class="ident" id="5913970">e</span><span class="op" id="5913971">.</span><span class="ident" id="5913972">domainMatch</span><span class="op" id="5913983">(</span><span class="ident" id="5913984">host</span><span class="op" id="5913988">)</span>&nbsp;<span class="op" id="5913990">&amp;&amp;</span>&nbsp;<span class="ident" id="5913993">e</span><span class="op" id="5913994">.</span><span class="ident" id="5913995">pathMatch</span><span class="op" id="5914004">(</span><span class="ident" id="5914005">path</span><span class="op" id="5914009">)</span>&nbsp;<span class="op" id="5914011">&amp;&amp;</span>&nbsp;<span class="op" id="5914014">(</span><span class="ident" id="5914015">https</span>&nbsp;<span class="op" id="5914021">||</span>&nbsp;<span class="op" id="5914024">!</span><span class="ident" id="5914025">e</span><span class="op" id="5914026">.</span><span class="ident" id="5914027">Secure</span><span class="op" id="5914033">)</span><br>
<span class="lineno">120</span><span class="op" id="5914035">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5914038">//&nbsp;domainMatch&nbsp;implements&nbsp;&#34;domain-match&#34;&nbsp;of&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.1.3.</span><br>
<span class="lineno"></span><span class="keyword" id="5914106">func</span>&nbsp;<span class="op" id="5914111">(</span><span class="ident" id="5914112">e</span>&nbsp;<span class="op" id="5914114">*</span><span class="ident" id="5914115">entry</span><span class="op" id="5914120">)</span>&nbsp;<span class="ident" id="5914122">domainMatch</span><span class="op" id="5914133">(</span><span class="ident" id="5914134">host</span>&nbsp;<span class="builtintype" id="5914139">string</span><span class="op" id="5914145">)</span>&nbsp;<span class="builtintype" id="5914147">bool</span>&nbsp;<span class="op" id="5914152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5914155">if</span>&nbsp;<span class="ident" id="5914158">e</span><span class="op" id="5914159">.</span><span class="ident" id="5914160">Domain</span>&nbsp;<span class="op" id="5914167">==</span>&nbsp;<span class="ident" id="5914170">host</span>&nbsp;<span class="op" id="5914175">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5914179">return</span>&nbsp;<span class="builtintype" id="5914186">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5914192">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5914195">return</span>&nbsp;<span class="op" id="5914202">!</span><span class="ident" id="5914203">e</span><span class="op" id="5914204">.</span><span class="ident" id="5914205">HostOnly</span>&nbsp;<span class="op" id="5914214">&amp;&amp;</span>&nbsp;<span class="ident" id="5914217">hasDotSuffix</span><span class="op" id="5914229">(</span><span class="ident" id="5914230">host</span><span class="op" id="5914234">,</span>&nbsp;<span class="ident" id="5914236">e</span><span class="op" id="5914237">.</span><span class="ident" id="5914238">Domain</span><span class="op" id="5914244">)</span><br>
<span class="lineno"></span><span class="op" id="5914246">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="5914249">//&nbsp;pathMatch&nbsp;implements&nbsp;&#34;path-match&#34;&nbsp;according&nbsp;to&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.1.4.</span><br>
<span class="lineno"></span><span class="keyword" id="5914323">func</span>&nbsp;<span class="op" id="5914328">(</span><span class="ident" id="5914329">e</span>&nbsp;<span class="op" id="5914331">*</span><span class="ident" id="5914332">entry</span><span class="op" id="5914337">)</span>&nbsp;<span class="ident" id="5914339">pathMatch</span><span class="op" id="5914348">(</span><span class="ident" id="5914349">requestPath</span>&nbsp;<span class="builtintype" id="5914361">string</span><span class="op" id="5914367">)</span>&nbsp;<span class="builtintype" id="5914369">bool</span>&nbsp;<span class="op" id="5914374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5914377">if</span>&nbsp;<span class="ident" id="5914380">requestPath</span>&nbsp;<span class="op" id="5914392">==</span>&nbsp;<span class="ident" id="5914395">e</span><span class="op" id="5914396">.</span><span class="ident" id="5914397">Path</span>&nbsp;<span class="op" id="5914402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5914406">return</span>&nbsp;<span class="builtintype" id="5914413">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5914419">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5914422">if</span>&nbsp;<span class="ident" id="5914425">strings</span><span class="op" id="5914432">.</span><span class="ident" id="5914433">HasPrefix</span><span class="op" id="5914442">(</span><span class="ident" id="5914443">requestPath</span><span class="op" id="5914454">,</span>&nbsp;<span class="ident" id="5914456">e</span><span class="op" id="5914457">.</span><span class="ident" id="5914458">Path</span><span class="op" id="5914462">)</span>&nbsp;<span class="op" id="5914464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5914468">if</span>&nbsp;<span class="ident" id="5914471">e</span><span class="op" id="5914472">.</span><span class="ident" id="5914473">Path</span><span class="op" id="5914477">[</span><span class="builtinfunc" id="5914478">len</span><span class="op" id="5914481">(</span><span class="ident" id="5914482">e</span><span class="op" id="5914483">.</span><span class="ident" id="5914484">Path</span><span class="op" id="5914488">)</span><span class="op" id="5914489">-</span><span class="num" id="5914490">1</span><span class="op" id="5914491">]</span>&nbsp;<span class="op" id="5914493">==</span>&nbsp;<span class="string" id="5914496">&#39;/&#39;</span>&nbsp;<span class="op" id="5914500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5914505">return</span>&nbsp;<span class="builtintype" id="5914512">true</span>&nbsp;<span class="comment" id="5914517">//&nbsp;The&nbsp;&#34;/any/&#34;&nbsp;matches&nbsp;&#34;/any/path&#34;&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5914560">}</span>&nbsp;<span class="keyword" id="5914562">else</span>&nbsp;<span class="keyword" id="5914567">if</span>&nbsp;<span class="ident" id="5914570">requestPath</span><span class="op" id="5914581">[</span><span class="builtinfunc" id="5914582">len</span><span class="op" id="5914585">(</span><span class="ident" id="5914586">e</span><span class="op" id="5914587">.</span><span class="ident" id="5914588">Path</span><span class="op" id="5914592">)</span><span class="op" id="5914593">]</span>&nbsp;<span class="op" id="5914595">==</span>&nbsp;<span class="string" id="5914598">&#39;/&#39;</span>&nbsp;<span class="op" id="5914602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5914607">return</span>&nbsp;<span class="builtintype" id="5914614">true</span>&nbsp;<span class="comment" id="5914619">//&nbsp;The&nbsp;&#34;/any&#34;&nbsp;matches&nbsp;&#34;/any/path&#34;&nbsp;case.</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5914661">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5914664">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5914667">return</span>&nbsp;<span class="builtintype" id="5914674">false</span><br>
<span class="lineno"></span><span class="op" id="5914680">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="comment" id="5914683">//&nbsp;hasDotSuffix&nbsp;reports&nbsp;whether&nbsp;s&nbsp;ends&nbsp;in&nbsp;&#34;.&#34;+suffix.</span><br>
<span class="lineno"></span><span class="keyword" id="5914737">func</span>&nbsp;<span class="ident" id="5914742">hasDotSuffix</span><span class="op" id="5914754">(</span><span class="ident" id="5914755">s</span><span class="op" id="5914756">,</span>&nbsp;<span class="ident" id="5914758">suffix</span>&nbsp;<span class="builtintype" id="5914765">string</span><span class="op" id="5914771">)</span>&nbsp;<span class="builtintype" id="5914773">bool</span>&nbsp;<span class="op" id="5914778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5914781">return</span>&nbsp;<span class="builtinfunc" id="5914788">len</span><span class="op" id="5914791">(</span><span class="ident" id="5914792">s</span><span class="op" id="5914793">)</span>&nbsp;<span class="op" id="5914795">&gt;</span>&nbsp;<span class="builtinfunc" id="5914797">len</span><span class="op" id="5914800">(</span><span class="ident" id="5914801">suffix</span><span class="op" id="5914807">)</span>&nbsp;<span class="op" id="5914809">&amp;&amp;</span>&nbsp;<span class="ident" id="5914812">s</span><span class="op" id="5914813">[</span><span class="builtinfunc" id="5914814">len</span><span class="op" id="5914817">(</span><span class="ident" id="5914818">s</span><span class="op" id="5914819">)</span><span class="op" id="5914820">-</span><span class="builtinfunc" id="5914821">len</span><span class="op" id="5914824">(</span><span class="ident" id="5914825">suffix</span><span class="op" id="5914831">)</span><span class="op" id="5914832">-</span><span class="num" id="5914833">1</span><span class="op" id="5914834">]</span>&nbsp;<span class="op" id="5914836">==</span>&nbsp;<span class="string" id="5914839">&#39;.&#39;</span>&nbsp;<span class="op" id="5914843">&amp;&amp;</span>&nbsp;<span class="ident" id="5914846">s</span><span class="op" id="5914847">[</span><span class="builtinfunc" id="5914848">len</span><span class="op" id="5914851">(</span><span class="ident" id="5914852">s</span><span class="op" id="5914853">)</span><span class="op" id="5914854">-</span><span class="builtinfunc" id="5914855">len</span><span class="op" id="5914858">(</span><span class="ident" id="5914859">suffix</span><span class="op" id="5914865">)</span><span class="op" id="5914866">:</span><span class="op" id="5914867">]</span>&nbsp;<span class="op" id="5914869">==</span>&nbsp;<span class="ident" id="5914872">suffix</span><br>
<span class="lineno"></span><span class="op" id="5914879">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span><span class="comment" id="5914882">//&nbsp;byPathLength&nbsp;is&nbsp;a&nbsp;[]entry&nbsp;sort.Interface&nbsp;that&nbsp;sorts&nbsp;according&nbsp;to&nbsp;RFC&nbsp;6265</span><br>
<span class="lineno"></span><span class="comment" id="5914959">//&nbsp;section&nbsp;5.4&nbsp;point&nbsp;2:&nbsp;by&nbsp;longest&nbsp;path&nbsp;and&nbsp;then&nbsp;by&nbsp;earliest&nbsp;creation&nbsp;time.</span><br>
<span class="lineno"></span><span class="keyword" id="5915035">type</span>&nbsp;<span class="ident" id="5915040">byPathLength</span>&nbsp;<span class="op" id="5915053">[</span><span class="op" id="5915054">]</span><span class="ident" id="5915055">entry</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5915062">func</span>&nbsp;<span class="op" id="5915067">(</span><span class="ident" id="5915068">s</span>&nbsp;<span class="ident" id="5915070">byPathLength</span><span class="op" id="5915082">)</span>&nbsp;<span class="ident" id="5915084">Len</span><span class="op" id="5915087">(</span><span class="op" id="5915088">)</span>&nbsp;<span class="builtintype" id="5915090">int</span>&nbsp;<span class="op" id="5915094">{</span>&nbsp;<span class="keyword" id="5915096">return</span>&nbsp;<span class="builtinfunc" id="5915103">len</span><span class="op" id="5915106">(</span><span class="ident" id="5915107">s</span><span class="op" id="5915108">)</span>&nbsp;<span class="op" id="5915110">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="keyword" id="5915113">func</span>&nbsp;<span class="op" id="5915118">(</span><span class="ident" id="5915119">s</span>&nbsp;<span class="ident" id="5915121">byPathLength</span><span class="op" id="5915133">)</span>&nbsp;<span class="ident" id="5915135">Less</span><span class="op" id="5915139">(</span><span class="ident" id="5915140">i</span><span class="op" id="5915141">,</span>&nbsp;<span class="ident" id="5915143">j</span>&nbsp;<span class="builtintype" id="5915145">int</span><span class="op" id="5915148">)</span>&nbsp;<span class="builtintype" id="5915150">bool</span>&nbsp;<span class="op" id="5915155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5915158">if</span>&nbsp;<span class="builtinfunc" id="5915161">len</span><span class="op" id="5915164">(</span><span class="ident" id="5915165">s</span><span class="op" id="5915166">[</span><span class="ident" id="5915167">i</span><span class="op" id="5915168">]</span><span class="op" id="5915169">.</span><span class="ident" id="5915170">Path</span><span class="op" id="5915174">)</span>&nbsp;<span class="op" id="5915176">!=</span>&nbsp;<span class="builtinfunc" id="5915179">len</span><span class="op" id="5915182">(</span><span class="ident" id="5915183">s</span><span class="op" id="5915184">[</span><span class="ident" id="5915185">j</span><span class="op" id="5915186">]</span><span class="op" id="5915187">.</span><span class="ident" id="5915188">Path</span><span class="op" id="5915192">)</span>&nbsp;<span class="op" id="5915194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5915198">return</span>&nbsp;<span class="builtinfunc" id="5915205">len</span><span class="op" id="5915208">(</span><span class="ident" id="5915209">s</span><span class="op" id="5915210">[</span><span class="ident" id="5915211">i</span><span class="op" id="5915212">]</span><span class="op" id="5915213">.</span><span class="ident" id="5915214">Path</span><span class="op" id="5915218">)</span>&nbsp;<span class="op" id="5915220">&gt;</span>&nbsp;<span class="builtinfunc" id="5915222">len</span><span class="op" id="5915225">(</span><span class="ident" id="5915226">s</span><span class="op" id="5915227">[</span><span class="ident" id="5915228">j</span><span class="op" id="5915229">]</span><span class="op" id="5915230">.</span><span class="ident" id="5915231">Path</span><span class="op" id="5915235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5915238">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5915241">if</span>&nbsp;<span class="op" id="5915244">!</span><span class="ident" id="5915245">s</span><span class="op" id="5915246">[</span><span class="ident" id="5915247">i</span><span class="op" id="5915248">]</span><span class="op" id="5915249">.</span><span class="ident" id="5915250">Creation</span><span class="op" id="5915258">.</span><span class="ident" id="5915259">Equal</span><span class="op" id="5915264">(</span><span class="ident" id="5915265">s</span><span class="op" id="5915266">[</span><span class="ident" id="5915267">j</span><span class="op" id="5915268">]</span><span class="op" id="5915269">.</span><span class="ident" id="5915270">Creation</span><span class="op" id="5915278">)</span>&nbsp;<span class="op" id="5915280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5915284">return</span>&nbsp;<span class="ident" id="5915291">s</span><span class="op" id="5915292">[</span><span class="ident" id="5915293">i</span><span class="op" id="5915294">]</span><span class="op" id="5915295">.</span><span class="ident" id="5915296">Creation</span><span class="op" id="5915304">.</span><span class="ident" id="5915305">Before</span><span class="op" id="5915311">(</span><span class="ident" id="5915312">s</span><span class="op" id="5915313">[</span><span class="ident" id="5915314">j</span><span class="op" id="5915315">]</span><span class="op" id="5915316">.</span><span class="ident" id="5915317">Creation</span><span class="op" id="5915325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5915328">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5915331">return</span>&nbsp;<span class="ident" id="5915338">s</span><span class="op" id="5915339">[</span><span class="ident" id="5915340">i</span><span class="op" id="5915341">]</span><span class="op" id="5915342">.</span><span class="ident" id="5915343">seqNum</span>&nbsp;<span class="op" id="5915350">&lt;</span>&nbsp;<span class="ident" id="5915352">s</span><span class="op" id="5915353">[</span><span class="ident" id="5915354">j</span><span class="op" id="5915355">]</span><span class="op" id="5915356">.</span><span class="ident" id="5915357">seqNum</span><br>
<span class="lineno"></span><span class="op" id="5915364">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="keyword" id="5915367">func</span>&nbsp;<span class="op" id="5915372">(</span><span class="ident" id="5915373">s</span>&nbsp;<span class="ident" id="5915375">byPathLength</span><span class="op" id="5915387">)</span>&nbsp;<span class="ident" id="5915389">Swap</span><span class="op" id="5915393">(</span><span class="ident" id="5915394">i</span><span class="op" id="5915395">,</span>&nbsp;<span class="ident" id="5915397">j</span>&nbsp;<span class="builtintype" id="5915399">int</span><span class="op" id="5915402">)</span>&nbsp;<span class="op" id="5915404">{</span>&nbsp;<span class="ident" id="5915406">s</span><span class="op" id="5915407">[</span><span class="ident" id="5915408">i</span><span class="op" id="5915409">]</span><span class="op" id="5915410">,</span>&nbsp;<span class="ident" id="5915412">s</span><span class="op" id="5915413">[</span><span class="ident" id="5915414">j</span><span class="op" id="5915415">]</span>&nbsp;<span class="op" id="5915417">=</span>&nbsp;<span class="ident" id="5915419">s</span><span class="op" id="5915420">[</span><span class="ident" id="5915421">j</span><span class="op" id="5915422">]</span><span class="op" id="5915423">,</span>&nbsp;<span class="ident" id="5915425">s</span><span class="op" id="5915426">[</span><span class="ident" id="5915427">i</span><span class="op" id="5915428">]</span>&nbsp;<span class="op" id="5915430">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5915433">//&nbsp;Cookies&nbsp;implements&nbsp;the&nbsp;Cookies&nbsp;method&nbsp;of&nbsp;the&nbsp;http.CookieJar&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment" id="5915507">//</span><br>
<span class="lineno">170</span><span class="comment" id="5915510">//&nbsp;It&nbsp;returns&nbsp;an&nbsp;empty&nbsp;slice&nbsp;if&nbsp;the&nbsp;URL&#39;s&nbsp;scheme&nbsp;is&nbsp;not&nbsp;HTTP&nbsp;or&nbsp;HTTPS.</span><br>
<span class="lineno"></span><span class="keyword" id="5915581">func</span>&nbsp;<span class="op" id="5915586">(</span><span class="ident" id="5915587">j</span>&nbsp;<span class="op" id="5915589">*</span><span class="ident" id="5915590">Jar</span><span class="op" id="5915593">)</span>&nbsp;<span class="ident" id="5915595">Cookies</span><span class="op" id="5915602">(</span><span class="ident" id="5915603">u</span>&nbsp;<span class="op" id="5915605">*</span><span class="ident" id="5915606">url</span><span class="op" id="5915609">.</span><span class="ident" id="5915610">URL</span><span class="op" id="5915613">)</span>&nbsp;<span class="op" id="5915615">(</span><span class="ident" id="5915616">cookies</span>&nbsp;<span class="op" id="5915624">[</span><span class="op" id="5915625">]</span><span class="op" id="5915626">*</span><span class="ident" id="5915627">http</span><span class="op" id="5915631">.</span><span class="ident" id="5915632">Cookie</span><span class="op" id="5915638">)</span>&nbsp;<span class="op" id="5915640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5915643">return</span>&nbsp;<span class="ident" id="5915650">j</span><span class="op" id="5915651">.</span><span class="ident" id="5915652">cookies</span><span class="op" id="5915659">(</span><span class="ident" id="5915660">u</span><span class="op" id="5915661">,</span>&nbsp;<span class="ident" id="5915663">time</span><span class="op" id="5915667">.</span><span class="ident" id="5915668">Now</span><span class="op" id="5915671">(</span><span class="op" id="5915672">)</span><span class="op" id="5915673">)</span><br>
<span class="lineno"></span><span class="op" id="5915675">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="comment" id="5915678">//&nbsp;cookies&nbsp;is&nbsp;like&nbsp;Cookies&nbsp;but&nbsp;takes&nbsp;the&nbsp;current&nbsp;time&nbsp;as&nbsp;a&nbsp;parameter.</span><br>
<span class="lineno"></span><span class="keyword" id="5915748">func</span>&nbsp;<span class="op" id="5915753">(</span><span class="ident" id="5915754">j</span>&nbsp;<span class="op" id="5915756">*</span><span class="ident" id="5915757">Jar</span><span class="op" id="5915760">)</span>&nbsp;<span class="ident" id="5915762">cookies</span><span class="op" id="5915769">(</span><span class="ident" id="5915770">u</span>&nbsp;<span class="op" id="5915772">*</span><span class="ident" id="5915773">url</span><span class="op" id="5915776">.</span><span class="ident" id="5915777">URL</span><span class="op" id="5915780">,</span>&nbsp;<span class="ident" id="5915782">now</span>&nbsp;<span class="ident" id="5915786">time</span><span class="op" id="5915790">.</span><span class="ident" id="5915791">Time</span><span class="op" id="5915795">)</span>&nbsp;<span class="op" id="5915797">(</span><span class="ident" id="5915798">cookies</span>&nbsp;<span class="op" id="5915806">[</span><span class="op" id="5915807">]</span><span class="op" id="5915808">*</span><span class="ident" id="5915809">http</span><span class="op" id="5915813">.</span><span class="ident" id="5915814">Cookie</span><span class="op" id="5915820">)</span>&nbsp;<span class="op" id="5915822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5915825">if</span>&nbsp;<span class="ident" id="5915828">u</span><span class="op" id="5915829">.</span><span class="ident" id="5915830">Scheme</span>&nbsp;<span class="op" id="5915837">!=</span>&nbsp;<span class="string" id="5915840">&#34;http&#34;</span>&nbsp;<span class="op" id="5915847">&amp;&amp;</span>&nbsp;<span class="ident" id="5915850">u</span><span class="op" id="5915851">.</span><span class="ident" id="5915852">Scheme</span>&nbsp;<span class="op" id="5915859">!=</span>&nbsp;<span class="string" id="5915862">&#34;https&#34;</span>&nbsp;<span class="op" id="5915870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5915874">return</span>&nbsp;<span class="ident" id="5915881">cookies</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5915890">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5915893">host</span><span class="op" id="5915897">,</span>&nbsp;<span class="ident" id="5915899">err</span>&nbsp;<span class="op" id="5915903">:=</span>&nbsp;<span class="ident" id="5915906">canonicalHost</span><span class="op" id="5915919">(</span><span class="ident" id="5915920">u</span><span class="op" id="5915921">.</span><span class="ident" id="5915922">Host</span><span class="op" id="5915926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5915929">if</span>&nbsp;<span class="ident" id="5915932">err</span>&nbsp;<span class="op" id="5915936">!=</span>&nbsp;<span class="builtintype" id="5915939">nil</span>&nbsp;<span class="op" id="5915943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5915947">return</span>&nbsp;<span class="ident" id="5915954">cookies</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5915963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5915966">key</span>&nbsp;<span class="op" id="5915970">:=</span>&nbsp;<span class="ident" id="5915973">jarKey</span><span class="op" id="5915979">(</span><span class="ident" id="5915980">host</span><span class="op" id="5915984">,</span>&nbsp;<span class="ident" id="5915986">j</span><span class="op" id="5915987">.</span><span class="ident" id="5915988">psList</span><span class="op" id="5915994">)</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5915998">j</span><span class="op" id="5915999">.</span><span class="ident" id="5916000">mu</span><span class="op" id="5916002">.</span><span class="ident" id="5916003">Lock</span><span class="op" id="5916007">(</span><span class="op" id="5916008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5916011">defer</span>&nbsp;<span class="ident" id="5916017">j</span><span class="op" id="5916018">.</span><span class="ident" id="5916019">mu</span><span class="op" id="5916021">.</span><span class="ident" id="5916022">Unlock</span><span class="op" id="5916028">(</span><span class="op" id="5916029">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5916033">submap</span>&nbsp;<span class="op" id="5916040">:=</span>&nbsp;<span class="ident" id="5916043">j</span><span class="op" id="5916044">.</span><span class="ident" id="5916045">entries</span><span class="op" id="5916052">[</span><span class="ident" id="5916053">key</span><span class="op" id="5916056">]</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5916059">if</span>&nbsp;<span class="ident" id="5916062">submap</span>&nbsp;<span class="op" id="5916069">==</span>&nbsp;<span class="builtintype" id="5916072">nil</span>&nbsp;<span class="op" id="5916076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5916080">return</span>&nbsp;<span class="ident" id="5916087">cookies</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5916096">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5916100">https</span>&nbsp;<span class="op" id="5916106">:=</span>&nbsp;<span class="ident" id="5916109">u</span><span class="op" id="5916110">.</span><span class="ident" id="5916111">Scheme</span>&nbsp;<span class="op" id="5916118">==</span>&nbsp;<span class="string" id="5916121">&#34;https&#34;</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5916130">path</span>&nbsp;<span class="op" id="5916135">:=</span>&nbsp;<span class="ident" id="5916138">u</span><span class="op" id="5916139">.</span><span class="ident" id="5916140">Path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5916146">if</span>&nbsp;<span class="ident" id="5916149">path</span>&nbsp;<span class="op" id="5916154">==</span>&nbsp;<span class="string" id="5916157">&#34;&#34;</span>&nbsp;<span class="op" id="5916160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5916164">path</span>&nbsp;<span class="op" id="5916169">=</span>&nbsp;<span class="string" id="5916171">&#34;/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5916176">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5916180">modified</span>&nbsp;<span class="op" id="5916189">:=</span>&nbsp;<span class="builtintype" id="5916192">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5916199">var</span>&nbsp;<span class="ident" id="5916203">selected</span>&nbsp;<span class="op" id="5916212">[</span><span class="op" id="5916213">]</span><span class="ident" id="5916214">entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5916221">for</span>&nbsp;<span class="ident" id="5916225">id</span><span class="op" id="5916227">,</span>&nbsp;<span class="ident" id="5916229">e</span>&nbsp;<span class="op" id="5916231">:=</span>&nbsp;<span class="keyword" id="5916234">range</span>&nbsp;<span class="ident" id="5916240">submap</span>&nbsp;<span class="op" id="5916247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5916251">if</span>&nbsp;<span class="ident" id="5916254">e</span><span class="op" id="5916255">.</span><span class="ident" id="5916256">Persistent</span>&nbsp;<span class="op" id="5916267">&amp;&amp;</span>&nbsp;<span class="op" id="5916270">!</span><span class="ident" id="5916271">e</span><span class="op" id="5916272">.</span><span class="ident" id="5916273">Expires</span><span class="op" id="5916280">.</span><span class="ident" id="5916281">After</span><span class="op" id="5916286">(</span><span class="ident" id="5916287">now</span><span class="op" id="5916290">)</span>&nbsp;<span class="op" id="5916292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5916297">delete</span><span class="op" id="5916303">(</span><span class="ident" id="5916304">submap</span><span class="op" id="5916310">,</span>&nbsp;<span class="ident" id="5916312">id</span><span class="op" id="5916314">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5916319">modified</span>&nbsp;<span class="op" id="5916328">=</span>&nbsp;<span class="builtintype" id="5916330">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5916338">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5916349">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5916353">if</span>&nbsp;<span class="op" id="5916356">!</span><span class="ident" id="5916357">e</span><span class="op" id="5916358">.</span><span class="ident" id="5916359">shouldSend</span><span class="op" id="5916369">(</span><span class="ident" id="5916370">https</span><span class="op" id="5916375">,</span>&nbsp;<span class="ident" id="5916377">host</span><span class="op" id="5916381">,</span>&nbsp;<span class="ident" id="5916383">path</span><span class="op" id="5916387">)</span>&nbsp;<span class="op" id="5916389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5916394">continue</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5916405">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5916409">e</span><span class="op" id="5916410">.</span><span class="ident" id="5916411">LastAccess</span>&nbsp;<span class="op" id="5916422">=</span>&nbsp;<span class="ident" id="5916424">now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5916430">submap</span><span class="op" id="5916436">[</span><span class="ident" id="5916437">id</span><span class="op" id="5916439">]</span>&nbsp;<span class="op" id="5916441">=</span>&nbsp;<span class="ident" id="5916443">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5916447">selected</span>&nbsp;<span class="op" id="5916456">=</span>&nbsp;<span class="builtinfunc" id="5916458">append</span><span class="op" id="5916464">(</span><span class="ident" id="5916465">selected</span><span class="op" id="5916473">,</span>&nbsp;<span class="ident" id="5916475">e</span><span class="op" id="5916476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5916480">modified</span>&nbsp;<span class="op" id="5916489">=</span>&nbsp;<span class="builtintype" id="5916491">true</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5916497">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5916500">if</span>&nbsp;<span class="ident" id="5916503">modified</span>&nbsp;<span class="op" id="5916512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5916516">if</span>&nbsp;<span class="builtinfunc" id="5916519">len</span><span class="op" id="5916522">(</span><span class="ident" id="5916523">submap</span><span class="op" id="5916529">)</span>&nbsp;<span class="op" id="5916531">==</span>&nbsp;<span class="num" id="5916534">0</span>&nbsp;<span class="op" id="5916536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5916541">delete</span><span class="op" id="5916547">(</span><span class="ident" id="5916548">j</span><span class="op" id="5916549">.</span><span class="ident" id="5916550">entries</span><span class="op" id="5916557">,</span>&nbsp;<span class="ident" id="5916559">key</span><span class="op" id="5916562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5916566">}</span>&nbsp;<span class="keyword" id="5916568">else</span>&nbsp;<span class="op" id="5916573">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5916578">j</span><span class="op" id="5916579">.</span><span class="ident" id="5916580">entries</span><span class="op" id="5916587">[</span><span class="ident" id="5916588">key</span><span class="op" id="5916591">]</span>&nbsp;<span class="op" id="5916593">=</span>&nbsp;<span class="ident" id="5916595">submap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5916604">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5916607">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5916611">sort</span><span class="op" id="5916615">.</span><span class="ident" id="5916616">Sort</span><span class="op" id="5916620">(</span><span class="ident" id="5916621">byPathLength</span><span class="op" id="5916633">(</span><span class="ident" id="5916634">selected</span><span class="op" id="5916642">)</span><span class="op" id="5916643">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5916646">for</span>&nbsp;<span class="ident" id="5916650">_</span><span class="op" id="5916651">,</span>&nbsp;<span class="ident" id="5916653">e</span>&nbsp;<span class="op" id="5916655">:=</span>&nbsp;<span class="keyword" id="5916658">range</span>&nbsp;<span class="ident" id="5916664">selected</span>&nbsp;<span class="op" id="5916673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5916677">cookies</span>&nbsp;<span class="op" id="5916685">=</span>&nbsp;<span class="builtinfunc" id="5916687">append</span><span class="op" id="5916693">(</span><span class="ident" id="5916694">cookies</span><span class="op" id="5916701">,</span>&nbsp;<span class="op" id="5916703">&amp;</span><span class="ident" id="5916704">http</span><span class="op" id="5916708">.</span><span class="ident" id="5916709">Cookie</span><span class="op" id="5916715">{</span><span class="ident" id="5916716">Name</span><span class="op" id="5916720">:</span>&nbsp;<span class="ident" id="5916722">e</span><span class="op" id="5916723">.</span><span class="ident" id="5916724">Name</span><span class="op" id="5916728">,</span>&nbsp;<span class="ident" id="5916730">Value</span><span class="op" id="5916735">:</span>&nbsp;<span class="ident" id="5916737">e</span><span class="op" id="5916738">.</span><span class="ident" id="5916739">Value</span><span class="op" id="5916744">}</span><span class="op" id="5916745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5916748">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5916752">return</span>&nbsp;<span class="ident" id="5916759">cookies</span><br>
<span class="lineno">230</span><span class="op" id="5916767">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5916770">//&nbsp;SetCookies&nbsp;implements&nbsp;the&nbsp;SetCookies&nbsp;method&nbsp;of&nbsp;the&nbsp;http.CookieJar&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment" id="5916850">//</span><br>
<span class="lineno"></span><span class="comment" id="5916853">//&nbsp;It&nbsp;does&nbsp;nothing&nbsp;if&nbsp;the&nbsp;URL&#39;s&nbsp;scheme&nbsp;is&nbsp;not&nbsp;HTTP&nbsp;or&nbsp;HTTPS.</span><br>
<span class="lineno">235</span><span class="keyword" id="5916914">func</span>&nbsp;<span class="op" id="5916919">(</span><span class="ident" id="5916920">j</span>&nbsp;<span class="op" id="5916922">*</span><span class="ident" id="5916923">Jar</span><span class="op" id="5916926">)</span>&nbsp;<span class="ident" id="5916928">SetCookies</span><span class="op" id="5916938">(</span><span class="ident" id="5916939">u</span>&nbsp;<span class="op" id="5916941">*</span><span class="ident" id="5916942">url</span><span class="op" id="5916945">.</span><span class="ident" id="5916946">URL</span><span class="op" id="5916949">,</span>&nbsp;<span class="ident" id="5916951">cookies</span>&nbsp;<span class="op" id="5916959">[</span><span class="op" id="5916960">]</span><span class="op" id="5916961">*</span><span class="ident" id="5916962">http</span><span class="op" id="5916966">.</span><span class="ident" id="5916967">Cookie</span><span class="op" id="5916973">)</span>&nbsp;<span class="op" id="5916975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5916978">j</span><span class="op" id="5916979">.</span><span class="ident" id="5916980">setCookies</span><span class="op" id="5916990">(</span><span class="ident" id="5916991">u</span><span class="op" id="5916992">,</span>&nbsp;<span class="ident" id="5916994">cookies</span><span class="op" id="5917001">,</span>&nbsp;<span class="ident" id="5917003">time</span><span class="op" id="5917007">.</span><span class="ident" id="5917008">Now</span><span class="op" id="5917011">(</span><span class="op" id="5917012">)</span><span class="op" id="5917013">)</span><br>
<span class="lineno"></span><span class="op" id="5917015">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5917018">//&nbsp;setCookies&nbsp;is&nbsp;like&nbsp;SetCookies&nbsp;but&nbsp;takes&nbsp;the&nbsp;current&nbsp;time&nbsp;as&nbsp;parameter.</span><br>
<span class="lineno">240</span><span class="keyword" id="5917092">func</span>&nbsp;<span class="op" id="5917097">(</span><span class="ident" id="5917098">j</span>&nbsp;<span class="op" id="5917100">*</span><span class="ident" id="5917101">Jar</span><span class="op" id="5917104">)</span>&nbsp;<span class="ident" id="5917106">setCookies</span><span class="op" id="5917116">(</span><span class="ident" id="5917117">u</span>&nbsp;<span class="op" id="5917119">*</span><span class="ident" id="5917120">url</span><span class="op" id="5917123">.</span><span class="ident" id="5917124">URL</span><span class="op" id="5917127">,</span>&nbsp;<span class="ident" id="5917129">cookies</span>&nbsp;<span class="op" id="5917137">[</span><span class="op" id="5917138">]</span><span class="op" id="5917139">*</span><span class="ident" id="5917140">http</span><span class="op" id="5917144">.</span><span class="ident" id="5917145">Cookie</span><span class="op" id="5917151">,</span>&nbsp;<span class="ident" id="5917153">now</span>&nbsp;<span class="ident" id="5917157">time</span><span class="op" id="5917161">.</span><span class="ident" id="5917162">Time</span><span class="op" id="5917166">)</span>&nbsp;<span class="op" id="5917168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5917171">if</span>&nbsp;<span class="builtinfunc" id="5917174">len</span><span class="op" id="5917177">(</span><span class="ident" id="5917178">cookies</span><span class="op" id="5917185">)</span>&nbsp;<span class="op" id="5917187">==</span>&nbsp;<span class="num" id="5917190">0</span>&nbsp;<span class="op" id="5917192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5917196">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5917204">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5917207">if</span>&nbsp;<span class="ident" id="5917210">u</span><span class="op" id="5917211">.</span><span class="ident" id="5917212">Scheme</span>&nbsp;<span class="op" id="5917219">!=</span>&nbsp;<span class="string" id="5917222">&#34;http&#34;</span>&nbsp;<span class="op" id="5917229">&amp;&amp;</span>&nbsp;<span class="ident" id="5917232">u</span><span class="op" id="5917233">.</span><span class="ident" id="5917234">Scheme</span>&nbsp;<span class="op" id="5917241">!=</span>&nbsp;<span class="string" id="5917244">&#34;https&#34;</span>&nbsp;<span class="op" id="5917252">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5917256">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5917264">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5917267">host</span><span class="op" id="5917271">,</span>&nbsp;<span class="ident" id="5917273">err</span>&nbsp;<span class="op" id="5917277">:=</span>&nbsp;<span class="ident" id="5917280">canonicalHost</span><span class="op" id="5917293">(</span><span class="ident" id="5917294">u</span><span class="op" id="5917295">.</span><span class="ident" id="5917296">Host</span><span class="op" id="5917300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5917303">if</span>&nbsp;<span class="ident" id="5917306">err</span>&nbsp;<span class="op" id="5917310">!=</span>&nbsp;<span class="builtintype" id="5917313">nil</span>&nbsp;<span class="op" id="5917317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5917321">return</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5917329">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5917332">key</span>&nbsp;<span class="op" id="5917336">:=</span>&nbsp;<span class="ident" id="5917339">jarKey</span><span class="op" id="5917345">(</span><span class="ident" id="5917346">host</span><span class="op" id="5917350">,</span>&nbsp;<span class="ident" id="5917352">j</span><span class="op" id="5917353">.</span><span class="ident" id="5917354">psList</span><span class="op" id="5917360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5917363">defPath</span>&nbsp;<span class="op" id="5917371">:=</span>&nbsp;<span class="ident" id="5917374">defaultPath</span><span class="op" id="5917385">(</span><span class="ident" id="5917386">u</span><span class="op" id="5917387">.</span><span class="ident" id="5917388">Path</span><span class="op" id="5917392">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5917396">j</span><span class="op" id="5917397">.</span><span class="ident" id="5917398">mu</span><span class="op" id="5917400">.</span><span class="ident" id="5917401">Lock</span><span class="op" id="5917405">(</span><span class="op" id="5917406">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5917409">defer</span>&nbsp;<span class="ident" id="5917415">j</span><span class="op" id="5917416">.</span><span class="ident" id="5917417">mu</span><span class="op" id="5917419">.</span><span class="ident" id="5917420">Unlock</span><span class="op" id="5917426">(</span><span class="op" id="5917427">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5917431">submap</span>&nbsp;<span class="op" id="5917438">:=</span>&nbsp;<span class="ident" id="5917441">j</span><span class="op" id="5917442">.</span><span class="ident" id="5917443">entries</span><span class="op" id="5917450">[</span><span class="ident" id="5917451">key</span><span class="op" id="5917454">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5917458">modified</span>&nbsp;<span class="op" id="5917467">:=</span>&nbsp;<span class="builtintype" id="5917470">false</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5917477">for</span>&nbsp;<span class="ident" id="5917481">_</span><span class="op" id="5917482">,</span>&nbsp;<span class="ident" id="5917484">cookie</span>&nbsp;<span class="op" id="5917491">:=</span>&nbsp;<span class="keyword" id="5917494">range</span>&nbsp;<span class="ident" id="5917500">cookies</span>&nbsp;<span class="op" id="5917508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5917512">e</span><span class="op" id="5917513">,</span>&nbsp;<span class="ident" id="5917515">remove</span><span class="op" id="5917521">,</span>&nbsp;<span class="ident" id="5917523">err</span>&nbsp;<span class="op" id="5917527">:=</span>&nbsp;<span class="ident" id="5917530">j</span><span class="op" id="5917531">.</span><span class="ident" id="5917532">newEntry</span><span class="op" id="5917540">(</span><span class="ident" id="5917541">cookie</span><span class="op" id="5917547">,</span>&nbsp;<span class="ident" id="5917549">now</span><span class="op" id="5917552">,</span>&nbsp;<span class="ident" id="5917554">defPath</span><span class="op" id="5917561">,</span>&nbsp;<span class="ident" id="5917563">host</span><span class="op" id="5917567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5917571">if</span>&nbsp;<span class="ident" id="5917574">err</span>&nbsp;<span class="op" id="5917578">!=</span>&nbsp;<span class="builtintype" id="5917581">nil</span>&nbsp;<span class="op" id="5917585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5917590">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5917601">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5917605">id</span>&nbsp;<span class="op" id="5917608">:=</span>&nbsp;<span class="ident" id="5917611">e</span><span class="op" id="5917612">.</span><span class="ident" id="5917613">id</span><span class="op" id="5917615">(</span><span class="op" id="5917616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5917620">if</span>&nbsp;<span class="ident" id="5917623">remove</span>&nbsp;<span class="op" id="5917630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5917635">if</span>&nbsp;<span class="ident" id="5917638">submap</span>&nbsp;<span class="op" id="5917645">!=</span>&nbsp;<span class="builtintype" id="5917648">nil</span>&nbsp;<span class="op" id="5917652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5917658">if</span>&nbsp;<span class="ident" id="5917661">_</span><span class="op" id="5917662">,</span>&nbsp;<span class="ident" id="5917664">ok</span>&nbsp;<span class="op" id="5917667">:=</span>&nbsp;<span class="ident" id="5917670">submap</span><span class="op" id="5917676">[</span><span class="ident" id="5917677">id</span><span class="op" id="5917679">]</span><span class="op" id="5917680">;</span>&nbsp;<span class="ident" id="5917682">ok</span>&nbsp;<span class="op" id="5917685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5917692">delete</span><span class="op" id="5917698">(</span><span class="ident" id="5917699">submap</span><span class="op" id="5917705">,</span>&nbsp;<span class="ident" id="5917707">id</span><span class="op" id="5917709">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5917716">modified</span>&nbsp;<span class="op" id="5917725">=</span>&nbsp;<span class="builtintype" id="5917727">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5917736">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5917741">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5917746">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5917757">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5917761">if</span>&nbsp;<span class="ident" id="5917764">submap</span>&nbsp;<span class="op" id="5917771">==</span>&nbsp;<span class="builtintype" id="5917774">nil</span>&nbsp;<span class="op" id="5917778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5917783">submap</span>&nbsp;<span class="op" id="5917790">=</span>&nbsp;<span class="builtinfunc" id="5917792">make</span><span class="op" id="5917796">(</span><span class="keyword" id="5917797">map</span><span class="op" id="5917800">[</span><span class="builtintype" id="5917801">string</span><span class="op" id="5917807">]</span><span class="ident" id="5917808">entry</span><span class="op" id="5917813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5917817">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5917822">if</span>&nbsp;<span class="ident" id="5917825">old</span><span class="op" id="5917828">,</span>&nbsp;<span class="ident" id="5917830">ok</span>&nbsp;<span class="op" id="5917833">:=</span>&nbsp;<span class="ident" id="5917836">submap</span><span class="op" id="5917842">[</span><span class="ident" id="5917843">id</span><span class="op" id="5917845">]</span><span class="op" id="5917846">;</span>&nbsp;<span class="ident" id="5917848">ok</span>&nbsp;<span class="op" id="5917851">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5917856">e</span><span class="op" id="5917857">.</span><span class="ident" id="5917858">Creation</span>&nbsp;<span class="op" id="5917867">=</span>&nbsp;<span class="ident" id="5917869">old</span><span class="op" id="5917872">.</span><span class="ident" id="5917873">Creation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5917885">e</span><span class="op" id="5917886">.</span><span class="ident" id="5917887">seqNum</span>&nbsp;<span class="op" id="5917894">=</span>&nbsp;<span class="ident" id="5917896">old</span><span class="op" id="5917899">.</span><span class="ident" id="5917900">seqNum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5917909">}</span>&nbsp;<span class="keyword" id="5917911">else</span>&nbsp;<span class="op" id="5917916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5917921">e</span><span class="op" id="5917922">.</span><span class="ident" id="5917923">Creation</span>&nbsp;<span class="op" id="5917932">=</span>&nbsp;<span class="ident" id="5917934">now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5917941">e</span><span class="op" id="5917942">.</span><span class="ident" id="5917943">seqNum</span>&nbsp;<span class="op" id="5917950">=</span>&nbsp;<span class="ident" id="5917952">j</span><span class="op" id="5917953">.</span><span class="ident" id="5917954">nextSeqNum</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5917968">j</span><span class="op" id="5917969">.</span><span class="ident" id="5917970">nextSeqNum</span><span class="op" id="5917980">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5917985">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5917989">e</span><span class="op" id="5917990">.</span><span class="ident" id="5917991">LastAccess</span>&nbsp;<span class="op" id="5918002">=</span>&nbsp;<span class="ident" id="5918004">now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5918010">submap</span><span class="op" id="5918016">[</span><span class="ident" id="5918017">id</span><span class="op" id="5918019">]</span>&nbsp;<span class="op" id="5918021">=</span>&nbsp;<span class="ident" id="5918023">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5918027">modified</span>&nbsp;<span class="op" id="5918036">=</span>&nbsp;<span class="builtintype" id="5918038">true</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5918044">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5918048">if</span>&nbsp;<span class="ident" id="5918051">modified</span>&nbsp;<span class="op" id="5918060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5918064">if</span>&nbsp;<span class="builtinfunc" id="5918067">len</span><span class="op" id="5918070">(</span><span class="ident" id="5918071">submap</span><span class="op" id="5918077">)</span>&nbsp;<span class="op" id="5918079">==</span>&nbsp;<span class="num" id="5918082">0</span>&nbsp;<span class="op" id="5918084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5918089">delete</span><span class="op" id="5918095">(</span><span class="ident" id="5918096">j</span><span class="op" id="5918097">.</span><span class="ident" id="5918098">entries</span><span class="op" id="5918105">,</span>&nbsp;<span class="ident" id="5918107">key</span><span class="op" id="5918110">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5918114">}</span>&nbsp;<span class="keyword" id="5918116">else</span>&nbsp;<span class="op" id="5918121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5918126">j</span><span class="op" id="5918127">.</span><span class="ident" id="5918128">entries</span><span class="op" id="5918135">[</span><span class="ident" id="5918136">key</span><span class="op" id="5918139">]</span>&nbsp;<span class="op" id="5918141">=</span>&nbsp;<span class="ident" id="5918143">submap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5918152">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5918155">}</span><br>
<span class="lineno"></span><span class="op" id="5918157">}</span><br>
<span class="lineno">300</span><br>
<span class="lineno"></span><span class="comment" id="5918160">//&nbsp;canonicalHost&nbsp;strips&nbsp;port&nbsp;from&nbsp;host&nbsp;if&nbsp;present&nbsp;and&nbsp;returns&nbsp;the&nbsp;canonicalized</span><br>
<span class="lineno"></span><span class="comment" id="5918240">//&nbsp;host&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="5918254">func</span>&nbsp;<span class="ident" id="5918259">canonicalHost</span><span class="op" id="5918272">(</span><span class="ident" id="5918273">host</span>&nbsp;<span class="builtintype" id="5918278">string</span><span class="op" id="5918284">)</span>&nbsp;<span class="op" id="5918286">(</span><span class="builtintype" id="5918287">string</span><span class="op" id="5918293">,</span>&nbsp;<span class="builtintype" id="5918295">error</span><span class="op" id="5918300">)</span>&nbsp;<span class="op" id="5918302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5918305">var</span>&nbsp;<span class="ident" id="5918309">err</span>&nbsp;<span class="builtintype" id="5918313">error</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5918320">host</span>&nbsp;<span class="op" id="5918325">=</span>&nbsp;<span class="ident" id="5918327">strings</span><span class="op" id="5918334">.</span><span class="ident" id="5918335">ToLower</span><span class="op" id="5918342">(</span><span class="ident" id="5918343">host</span><span class="op" id="5918347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5918350">if</span>&nbsp;<span class="ident" id="5918353">hasPort</span><span class="op" id="5918360">(</span><span class="ident" id="5918361">host</span><span class="op" id="5918365">)</span>&nbsp;<span class="op" id="5918367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5918371">host</span><span class="op" id="5918375">,</span>&nbsp;<span class="ident" id="5918377">_</span><span class="op" id="5918378">,</span>&nbsp;<span class="ident" id="5918380">err</span>&nbsp;<span class="op" id="5918384">=</span>&nbsp;<span class="ident" id="5918386">net</span><span class="op" id="5918389">.</span><span class="ident" id="5918390">SplitHostPort</span><span class="op" id="5918403">(</span><span class="ident" id="5918404">host</span><span class="op" id="5918408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5918412">if</span>&nbsp;<span class="ident" id="5918415">err</span>&nbsp;<span class="op" id="5918419">!=</span>&nbsp;<span class="builtintype" id="5918422">nil</span>&nbsp;<span class="op" id="5918426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5918431">return</span>&nbsp;<span class="string" id="5918438">&#34;&#34;</span><span class="op" id="5918440">,</span>&nbsp;<span class="ident" id="5918442">err</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5918448">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5918451">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5918454">if</span>&nbsp;<span class="ident" id="5918457">strings</span><span class="op" id="5918464">.</span><span class="ident" id="5918465">HasSuffix</span><span class="op" id="5918474">(</span><span class="ident" id="5918475">host</span><span class="op" id="5918479">,</span>&nbsp;<span class="string" id="5918481">&#34;.&#34;</span><span class="op" id="5918484">)</span>&nbsp;<span class="op" id="5918486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5918490">//&nbsp;Strip&nbsp;trailing&nbsp;dot&nbsp;from&nbsp;fully&nbsp;qualified&nbsp;domain&nbsp;names.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5918549">host</span>&nbsp;<span class="op" id="5918554">=</span>&nbsp;<span class="ident" id="5918556">host</span><span class="op" id="5918560">[</span><span class="op" id="5918561">:</span><span class="builtinfunc" id="5918562">len</span><span class="op" id="5918565">(</span><span class="ident" id="5918566">host</span><span class="op" id="5918570">)</span><span class="op" id="5918571">-</span><span class="num" id="5918572">1</span><span class="op" id="5918573">]</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5918576">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5918579">return</span>&nbsp;<span class="ident" id="5918586">toASCII</span><span class="op" id="5918593">(</span><span class="ident" id="5918594">host</span><span class="op" id="5918598">)</span><br>
<span class="lineno"></span><span class="op" id="5918600">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5918603">//&nbsp;hasPort&nbsp;reports&nbsp;whether&nbsp;host&nbsp;contains&nbsp;a&nbsp;port&nbsp;number.&nbsp;host&nbsp;may&nbsp;be&nbsp;a&nbsp;host</span><br>
<span class="lineno">320</span><span class="comment" id="5918678">//&nbsp;name,&nbsp;an&nbsp;IPv4&nbsp;or&nbsp;an&nbsp;IPv6&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="5918715">func</span>&nbsp;<span class="ident" id="5918720">hasPort</span><span class="op" id="5918727">(</span><span class="ident" id="5918728">host</span>&nbsp;<span class="builtintype" id="5918733">string</span><span class="op" id="5918739">)</span>&nbsp;<span class="builtintype" id="5918741">bool</span>&nbsp;<span class="op" id="5918746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5918749">colons</span>&nbsp;<span class="op" id="5918756">:=</span>&nbsp;<span class="ident" id="5918759">strings</span><span class="op" id="5918766">.</span><span class="ident" id="5918767">Count</span><span class="op" id="5918772">(</span><span class="ident" id="5918773">host</span><span class="op" id="5918777">,</span>&nbsp;<span class="string" id="5918779">&#34;:&#34;</span><span class="op" id="5918782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5918785">if</span>&nbsp;<span class="ident" id="5918788">colons</span>&nbsp;<span class="op" id="5918795">==</span>&nbsp;<span class="num" id="5918798">0</span>&nbsp;<span class="op" id="5918800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5918804">return</span>&nbsp;<span class="builtintype" id="5918811">false</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5918818">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5918821">if</span>&nbsp;<span class="ident" id="5918824">colons</span>&nbsp;<span class="op" id="5918831">==</span>&nbsp;<span class="num" id="5918834">1</span>&nbsp;<span class="op" id="5918836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5918840">return</span>&nbsp;<span class="builtintype" id="5918847">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5918853">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5918856">return</span>&nbsp;<span class="ident" id="5918863">host</span><span class="op" id="5918867">[</span><span class="num" id="5918868">0</span><span class="op" id="5918869">]</span>&nbsp;<span class="op" id="5918871">==</span>&nbsp;<span class="string" id="5918874">&#39;[&#39;</span>&nbsp;<span class="op" id="5918878">&amp;&amp;</span>&nbsp;<span class="ident" id="5918881">strings</span><span class="op" id="5918888">.</span><span class="ident" id="5918889">Contains</span><span class="op" id="5918897">(</span><span class="ident" id="5918898">host</span><span class="op" id="5918902">,</span>&nbsp;<span class="string" id="5918904">&#34;]:&#34;</span><span class="op" id="5918908">)</span><br>
<span class="lineno">330</span><span class="op" id="5918910">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5918913">//&nbsp;jarKey&nbsp;returns&nbsp;the&nbsp;key&nbsp;to&nbsp;use&nbsp;for&nbsp;a&nbsp;jar.</span><br>
<span class="lineno"></span><span class="keyword" id="5918957">func</span>&nbsp;<span class="ident" id="5918962">jarKey</span><span class="op" id="5918968">(</span><span class="ident" id="5918969">host</span>&nbsp;<span class="builtintype" id="5918974">string</span><span class="op" id="5918980">,</span>&nbsp;<span class="ident" id="5918982">psl</span>&nbsp;<span class="ident" id="5918986">PublicSuffixList</span><span class="op" id="5919002">)</span>&nbsp;<span class="builtintype" id="5919004">string</span>&nbsp;<span class="op" id="5919011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5919014">if</span>&nbsp;<span class="ident" id="5919017">isIP</span><span class="op" id="5919021">(</span><span class="ident" id="5919022">host</span><span class="op" id="5919026">)</span>&nbsp;<span class="op" id="5919028">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5919032">return</span>&nbsp;<span class="ident" id="5919039">host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5919045">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5919049">var</span>&nbsp;<span class="ident" id="5919053">i</span>&nbsp;<span class="builtintype" id="5919055">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5919060">if</span>&nbsp;<span class="ident" id="5919063">psl</span>&nbsp;<span class="op" id="5919067">==</span>&nbsp;<span class="builtintype" id="5919070">nil</span>&nbsp;<span class="op" id="5919074">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5919078">i</span>&nbsp;<span class="op" id="5919080">=</span>&nbsp;<span class="ident" id="5919082">strings</span><span class="op" id="5919089">.</span><span class="ident" id="5919090">LastIndex</span><span class="op" id="5919099">(</span><span class="ident" id="5919100">host</span><span class="op" id="5919104">,</span>&nbsp;<span class="string" id="5919106">&#34;.&#34;</span><span class="op" id="5919109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5919113">if</span>&nbsp;<span class="ident" id="5919116">i</span>&nbsp;<span class="op" id="5919118">==</span>&nbsp;<span class="op" id="5919121">-</span><span class="num" id="5919122">1</span>&nbsp;<span class="op" id="5919124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5919129">return</span>&nbsp;<span class="ident" id="5919136">host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5919143">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5919146">}</span>&nbsp;<span class="keyword" id="5919148">else</span>&nbsp;<span class="op" id="5919153">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5919157">suffix</span>&nbsp;<span class="op" id="5919164">:=</span>&nbsp;<span class="ident" id="5919167">psl</span><span class="op" id="5919170">.</span><span class="ident" id="5919171">PublicSuffix</span><span class="op" id="5919183">(</span><span class="ident" id="5919184">host</span><span class="op" id="5919188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5919192">if</span>&nbsp;<span class="ident" id="5919195">suffix</span>&nbsp;<span class="op" id="5919202">==</span>&nbsp;<span class="ident" id="5919205">host</span>&nbsp;<span class="op" id="5919210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5919215">return</span>&nbsp;<span class="ident" id="5919222">host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5919229">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5919233">i</span>&nbsp;<span class="op" id="5919235">=</span>&nbsp;<span class="builtinfunc" id="5919237">len</span><span class="op" id="5919240">(</span><span class="ident" id="5919241">host</span><span class="op" id="5919245">)</span>&nbsp;<span class="op" id="5919247">-</span>&nbsp;<span class="builtinfunc" id="5919249">len</span><span class="op" id="5919252">(</span><span class="ident" id="5919253">suffix</span><span class="op" id="5919259">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5919263">if</span>&nbsp;<span class="ident" id="5919266">i</span>&nbsp;<span class="op" id="5919268">&lt;=</span>&nbsp;<span class="num" id="5919271">0</span>&nbsp;<span class="op" id="5919273">||</span>&nbsp;<span class="ident" id="5919276">host</span><span class="op" id="5919280">[</span><span class="ident" id="5919281">i</span><span class="op" id="5919282">-</span><span class="num" id="5919283">1</span><span class="op" id="5919284">]</span>&nbsp;<span class="op" id="5919286">!=</span>&nbsp;<span class="string" id="5919289">&#39;.&#39;</span>&nbsp;<span class="op" id="5919293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5919298">//&nbsp;The&nbsp;provided&nbsp;public&nbsp;suffix&nbsp;list&nbsp;psl&nbsp;is&nbsp;broken.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5919351">//&nbsp;Storing&nbsp;cookies&nbsp;under&nbsp;host&nbsp;is&nbsp;a&nbsp;safe&nbsp;stopgap.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5919403">return</span>&nbsp;<span class="ident" id="5919410">host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5919417">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5919420">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5919423">prevDot</span>&nbsp;<span class="op" id="5919431">:=</span>&nbsp;<span class="ident" id="5919434">strings</span><span class="op" id="5919441">.</span><span class="ident" id="5919442">LastIndex</span><span class="op" id="5919451">(</span><span class="ident" id="5919452">host</span><span class="op" id="5919456">[</span><span class="op" id="5919457">:</span><span class="ident" id="5919458">i</span><span class="op" id="5919459">-</span><span class="num" id="5919460">1</span><span class="op" id="5919461">]</span><span class="op" id="5919462">,</span>&nbsp;<span class="string" id="5919464">&#34;.&#34;</span><span class="op" id="5919467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5919470">return</span>&nbsp;<span class="ident" id="5919477">host</span><span class="op" id="5919481">[</span><span class="ident" id="5919482">prevDot</span><span class="op" id="5919489">+</span><span class="num" id="5919490">1</span><span class="op" id="5919491">:</span><span class="op" id="5919492">]</span><br>
<span class="lineno"></span><span class="op" id="5919494">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">360</span><span class="comment" id="5919497">//&nbsp;isIP&nbsp;reports&nbsp;whether&nbsp;host&nbsp;is&nbsp;an&nbsp;IP&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="5919544">func</span>&nbsp;<span class="ident" id="5919549">isIP</span><span class="op" id="5919553">(</span><span class="ident" id="5919554">host</span>&nbsp;<span class="builtintype" id="5919559">string</span><span class="op" id="5919565">)</span>&nbsp;<span class="builtintype" id="5919567">bool</span>&nbsp;<span class="op" id="5919572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5919575">return</span>&nbsp;<span class="ident" id="5919582">net</span><span class="op" id="5919585">.</span><span class="ident" id="5919586">ParseIP</span><span class="op" id="5919593">(</span><span class="ident" id="5919594">host</span><span class="op" id="5919598">)</span>&nbsp;<span class="op" id="5919600">!=</span>&nbsp;<span class="builtintype" id="5919603">nil</span><br>
<span class="lineno"></span><span class="op" id="5919607">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="comment" id="5919610">//&nbsp;defaultPath&nbsp;returns&nbsp;the&nbsp;directory&nbsp;part&nbsp;of&nbsp;an&nbsp;URL&#39;s&nbsp;path&nbsp;according&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5919682">//&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.1.4.</span><br>
<span class="lineno"></span><span class="keyword" id="5919709">func</span>&nbsp;<span class="ident" id="5919714">defaultPath</span><span class="op" id="5919725">(</span><span class="ident" id="5919726">path</span>&nbsp;<span class="builtintype" id="5919731">string</span><span class="op" id="5919737">)</span>&nbsp;<span class="builtintype" id="5919739">string</span>&nbsp;<span class="op" id="5919746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5919749">if</span>&nbsp;<span class="builtinfunc" id="5919752">len</span><span class="op" id="5919755">(</span><span class="ident" id="5919756">path</span><span class="op" id="5919760">)</span>&nbsp;<span class="op" id="5919762">==</span>&nbsp;<span class="num" id="5919765">0</span>&nbsp;<span class="op" id="5919767">||</span>&nbsp;<span class="ident" id="5919770">path</span><span class="op" id="5919774">[</span><span class="num" id="5919775">0</span><span class="op" id="5919776">]</span>&nbsp;<span class="op" id="5919778">!=</span>&nbsp;<span class="string" id="5919781">&#39;/&#39;</span>&nbsp;<span class="op" id="5919785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5919789">return</span>&nbsp;<span class="string" id="5919796">&#34;/&#34;</span>&nbsp;<span class="comment" id="5919800">//&nbsp;Path&nbsp;is&nbsp;empty&nbsp;or&nbsp;malformed.</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5919832">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5919836">i</span>&nbsp;<span class="op" id="5919838">:=</span>&nbsp;<span class="ident" id="5919841">strings</span><span class="op" id="5919848">.</span><span class="ident" id="5919849">LastIndex</span><span class="op" id="5919858">(</span><span class="ident" id="5919859">path</span><span class="op" id="5919863">,</span>&nbsp;<span class="string" id="5919865">&#34;/&#34;</span><span class="op" id="5919868">)</span>&nbsp;<span class="comment" id="5919870">//&nbsp;Path&nbsp;starts&nbsp;with&nbsp;&#34;/&#34;,&nbsp;so&nbsp;i&nbsp;!=&nbsp;-1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5919908">if</span>&nbsp;<span class="ident" id="5919911">i</span>&nbsp;<span class="op" id="5919913">==</span>&nbsp;<span class="num" id="5919916">0</span>&nbsp;<span class="op" id="5919918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5919922">return</span>&nbsp;<span class="string" id="5919929">&#34;/&#34;</span>&nbsp;<span class="comment" id="5919933">//&nbsp;Path&nbsp;has&nbsp;the&nbsp;form&nbsp;&#34;/abc&#34;.</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5919963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5919966">return</span>&nbsp;<span class="ident" id="5919973">path</span><span class="op" id="5919977">[</span><span class="op" id="5919978">:</span><span class="ident" id="5919979">i</span><span class="op" id="5919980">]</span>&nbsp;<span class="comment" id="5919982">//&nbsp;Path&nbsp;is&nbsp;either&nbsp;of&nbsp;form&nbsp;&#34;/abc/xyz&#34;&nbsp;or&nbsp;&#34;/abc/xyz/&#34;.</span><br>
<span class="lineno"></span><span class="op" id="5920035">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5920038">//&nbsp;newEntry&nbsp;creates&nbsp;an&nbsp;entry&nbsp;from&nbsp;a&nbsp;http.Cookie&nbsp;c.&nbsp;now&nbsp;is&nbsp;the&nbsp;current&nbsp;time&nbsp;and</span><br>
<span class="lineno">380</span><span class="comment" id="5920117">//&nbsp;is&nbsp;compared&nbsp;to&nbsp;c.Expires&nbsp;to&nbsp;determine&nbsp;deletion&nbsp;of&nbsp;c.&nbsp;defPath&nbsp;and&nbsp;host&nbsp;are&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5920198">//&nbsp;default-path&nbsp;and&nbsp;the&nbsp;canonical&nbsp;host&nbsp;name&nbsp;of&nbsp;the&nbsp;URL&nbsp;c&nbsp;was&nbsp;received&nbsp;from.</span><br>
<span class="lineno"></span><span class="comment" id="5920274">//</span><br>
<span class="lineno"></span><span class="comment" id="5920277">//&nbsp;remove&nbsp;records&nbsp;whether&nbsp;the&nbsp;jar&nbsp;should&nbsp;delete&nbsp;this&nbsp;cookie,&nbsp;as&nbsp;it&nbsp;has&nbsp;already</span><br>
<span class="lineno"></span><span class="comment" id="5920356">//&nbsp;expired&nbsp;with&nbsp;respect&nbsp;to&nbsp;now.&nbsp;In&nbsp;this&nbsp;case,&nbsp;e&nbsp;may&nbsp;be&nbsp;incomplete,&nbsp;but&nbsp;it&nbsp;will</span><br>
<span class="lineno">385</span><span class="comment" id="5920435">//&nbsp;be&nbsp;valid&nbsp;to&nbsp;call&nbsp;e.id&nbsp;(which&nbsp;depends&nbsp;on&nbsp;e&#39;s&nbsp;Name,&nbsp;Domain&nbsp;and&nbsp;Path).</span><br>
<span class="lineno"></span><span class="comment" id="5920506">//</span><br>
<span class="lineno"></span><span class="comment" id="5920509">//&nbsp;A&nbsp;malformed&nbsp;c.Domain&nbsp;will&nbsp;result&nbsp;in&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="keyword" id="5920558">func</span>&nbsp;<span class="op" id="5920563">(</span><span class="ident" id="5920564">j</span>&nbsp;<span class="op" id="5920566">*</span><span class="ident" id="5920567">Jar</span><span class="op" id="5920570">)</span>&nbsp;<span class="ident" id="5920572">newEntry</span><span class="op" id="5920580">(</span><span class="ident" id="5920581">c</span>&nbsp;<span class="op" id="5920583">*</span><span class="ident" id="5920584">http</span><span class="op" id="5920588">.</span><span class="ident" id="5920589">Cookie</span><span class="op" id="5920595">,</span>&nbsp;<span class="ident" id="5920597">now</span>&nbsp;<span class="ident" id="5920601">time</span><span class="op" id="5920605">.</span><span class="ident" id="5920606">Time</span><span class="op" id="5920610">,</span>&nbsp;<span class="ident" id="5920612">defPath</span><span class="op" id="5920619">,</span>&nbsp;<span class="ident" id="5920621">host</span>&nbsp;<span class="builtintype" id="5920626">string</span><span class="op" id="5920632">)</span>&nbsp;<span class="op" id="5920634">(</span><span class="ident" id="5920635">e</span>&nbsp;<span class="ident" id="5920637">entry</span><span class="op" id="5920642">,</span>&nbsp;<span class="ident" id="5920644">remove</span>&nbsp;<span class="builtintype" id="5920651">bool</span><span class="op" id="5920655">,</span>&nbsp;<span class="ident" id="5920657">err</span>&nbsp;<span class="builtintype" id="5920661">error</span><span class="op" id="5920666">)</span>&nbsp;<span class="op" id="5920668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5920671">e</span><span class="op" id="5920672">.</span><span class="ident" id="5920673">Name</span>&nbsp;<span class="op" id="5920678">=</span>&nbsp;<span class="ident" id="5920680">c</span><span class="op" id="5920681">.</span><span class="ident" id="5920682">Name</span><br>
<span class="lineno">390</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5920689">if</span>&nbsp;<span class="ident" id="5920692">c</span><span class="op" id="5920693">.</span><span class="ident" id="5920694">Path</span>&nbsp;<span class="op" id="5920699">==</span>&nbsp;<span class="string" id="5920702">&#34;&#34;</span>&nbsp;<span class="op" id="5920705">||</span>&nbsp;<span class="ident" id="5920708">c</span><span class="op" id="5920709">.</span><span class="ident" id="5920710">Path</span><span class="op" id="5920714">[</span><span class="num" id="5920715">0</span><span class="op" id="5920716">]</span>&nbsp;<span class="op" id="5920718">!=</span>&nbsp;<span class="string" id="5920721">&#39;/&#39;</span>&nbsp;<span class="op" id="5920725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5920729">e</span><span class="op" id="5920730">.</span><span class="ident" id="5920731">Path</span>&nbsp;<span class="op" id="5920736">=</span>&nbsp;<span class="ident" id="5920738">defPath</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5920747">}</span>&nbsp;<span class="keyword" id="5920749">else</span>&nbsp;<span class="op" id="5920754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5920758">e</span><span class="op" id="5920759">.</span><span class="ident" id="5920760">Path</span>&nbsp;<span class="op" id="5920765">=</span>&nbsp;<span class="ident" id="5920767">c</span><span class="op" id="5920768">.</span><span class="ident" id="5920769">Path</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5920775">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5920779">e</span><span class="op" id="5920780">.</span><span class="ident" id="5920781">Domain</span><span class="op" id="5920787">,</span>&nbsp;<span class="ident" id="5920789">e</span><span class="op" id="5920790">.</span><span class="ident" id="5920791">HostOnly</span><span class="op" id="5920799">,</span>&nbsp;<span class="ident" id="5920801">err</span>&nbsp;<span class="op" id="5920805">=</span>&nbsp;<span class="ident" id="5920807">j</span><span class="op" id="5920808">.</span><span class="ident" id="5920809">domainAndType</span><span class="op" id="5920822">(</span><span class="ident" id="5920823">host</span><span class="op" id="5920827">,</span>&nbsp;<span class="ident" id="5920829">c</span><span class="op" id="5920830">.</span><span class="ident" id="5920831">Domain</span><span class="op" id="5920837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5920840">if</span>&nbsp;<span class="ident" id="5920843">err</span>&nbsp;<span class="op" id="5920847">!=</span>&nbsp;<span class="builtintype" id="5920850">nil</span>&nbsp;<span class="op" id="5920854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5920858">return</span>&nbsp;<span class="ident" id="5920865">e</span><span class="op" id="5920866">,</span>&nbsp;<span class="builtintype" id="5920868">false</span><span class="op" id="5920873">,</span>&nbsp;<span class="ident" id="5920875">err</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5920880">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5920884">//&nbsp;MaxAge&nbsp;takes&nbsp;precedence&nbsp;over&nbsp;Expires.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5920926">if</span>&nbsp;<span class="ident" id="5920929">c</span><span class="op" id="5920930">.</span><span class="ident" id="5920931">MaxAge</span>&nbsp;<span class="op" id="5920938">&lt;</span>&nbsp;<span class="num" id="5920940">0</span>&nbsp;<span class="op" id="5920942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5920946">return</span>&nbsp;<span class="ident" id="5920953">e</span><span class="op" id="5920954">,</span>&nbsp;<span class="builtintype" id="5920956">true</span><span class="op" id="5920960">,</span>&nbsp;<span class="builtintype" id="5920962">nil</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5920967">}</span>&nbsp;<span class="keyword" id="5920969">else</span>&nbsp;<span class="keyword" id="5920974">if</span>&nbsp;<span class="ident" id="5920977">c</span><span class="op" id="5920978">.</span><span class="ident" id="5920979">MaxAge</span>&nbsp;<span class="op" id="5920986">&gt;</span>&nbsp;<span class="num" id="5920988">0</span>&nbsp;<span class="op" id="5920990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5920994">e</span><span class="op" id="5920995">.</span><span class="ident" id="5920996">Expires</span>&nbsp;<span class="op" id="5921004">=</span>&nbsp;<span class="ident" id="5921006">now</span><span class="op" id="5921009">.</span><span class="ident" id="5921010">Add</span><span class="op" id="5921013">(</span><span class="ident" id="5921014">time</span><span class="op" id="5921018">.</span><span class="ident" id="5921019">Duration</span><span class="op" id="5921027">(</span><span class="ident" id="5921028">c</span><span class="op" id="5921029">.</span><span class="ident" id="5921030">MaxAge</span><span class="op" id="5921036">)</span>&nbsp;<span class="op" id="5921038">*</span>&nbsp;<span class="ident" id="5921040">time</span><span class="op" id="5921044">.</span><span class="ident" id="5921045">Second</span><span class="op" id="5921051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5921055">e</span><span class="op" id="5921056">.</span><span class="ident" id="5921057">Persistent</span>&nbsp;<span class="op" id="5921068">=</span>&nbsp;<span class="builtintype" id="5921070">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5921076">}</span>&nbsp;<span class="keyword" id="5921078">else</span>&nbsp;<span class="op" id="5921083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5921087">if</span>&nbsp;<span class="ident" id="5921090">c</span><span class="op" id="5921091">.</span><span class="ident" id="5921092">Expires</span><span class="op" id="5921099">.</span><span class="ident" id="5921100">IsZero</span><span class="op" id="5921106">(</span><span class="op" id="5921107">)</span>&nbsp;<span class="op" id="5921109">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5921114">e</span><span class="op" id="5921115">.</span><span class="ident" id="5921116">Expires</span>&nbsp;<span class="op" id="5921124">=</span>&nbsp;<span class="ident" id="5921126">endOfTime</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5921139">e</span><span class="op" id="5921140">.</span><span class="ident" id="5921141">Persistent</span>&nbsp;<span class="op" id="5921152">=</span>&nbsp;<span class="builtintype" id="5921154">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5921162">}</span>&nbsp;<span class="keyword" id="5921164">else</span>&nbsp;<span class="op" id="5921169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5921174">if</span>&nbsp;<span class="op" id="5921177">!</span><span class="ident" id="5921178">c</span><span class="op" id="5921179">.</span><span class="ident" id="5921180">Expires</span><span class="op" id="5921187">.</span><span class="ident" id="5921188">After</span><span class="op" id="5921193">(</span><span class="ident" id="5921194">now</span><span class="op" id="5921197">)</span>&nbsp;<span class="op" id="5921199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5921205">return</span>&nbsp;<span class="ident" id="5921212">e</span><span class="op" id="5921213">,</span>&nbsp;<span class="builtintype" id="5921215">true</span><span class="op" id="5921219">,</span>&nbsp;<span class="builtintype" id="5921221">nil</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5921228">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5921233">e</span><span class="op" id="5921234">.</span><span class="ident" id="5921235">Expires</span>&nbsp;<span class="op" id="5921243">=</span>&nbsp;<span class="ident" id="5921245">c</span><span class="op" id="5921246">.</span><span class="ident" id="5921247">Expires</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5921258">e</span><span class="op" id="5921259">.</span><span class="ident" id="5921260">Persistent</span>&nbsp;<span class="op" id="5921271">=</span>&nbsp;<span class="builtintype" id="5921273">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5921280">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5921283">}</span><br>
<span class="lineno">420</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5921287">e</span><span class="op" id="5921288">.</span><span class="ident" id="5921289">Value</span>&nbsp;<span class="op" id="5921295">=</span>&nbsp;<span class="ident" id="5921297">c</span><span class="op" id="5921298">.</span><span class="ident" id="5921299">Value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5921306">e</span><span class="op" id="5921307">.</span><span class="ident" id="5921308">Secure</span>&nbsp;<span class="op" id="5921315">=</span>&nbsp;<span class="ident" id="5921317">c</span><span class="op" id="5921318">.</span><span class="ident" id="5921319">Secure</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5921327">e</span><span class="op" id="5921328">.</span><span class="ident" id="5921329">HttpOnly</span>&nbsp;<span class="op" id="5921338">=</span>&nbsp;<span class="ident" id="5921340">c</span><span class="op" id="5921341">.</span><span class="ident" id="5921342">HttpOnly</span><br>
<span class="lineno"></span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5921353">return</span>&nbsp;<span class="ident" id="5921360">e</span><span class="op" id="5921361">,</span>&nbsp;<span class="builtintype" id="5921363">false</span><span class="op" id="5921368">,</span>&nbsp;<span class="builtintype" id="5921370">nil</span><br>
<span class="lineno"></span><span class="op" id="5921374">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5921377">var</span>&nbsp;<span class="op" id="5921381">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5921384">errIllegalDomain</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5921403">=</span>&nbsp;<span class="ident" id="5921405">errors</span><span class="op" id="5921411">.</span><span class="ident" id="5921412">New</span><span class="op" id="5921415">(</span><span class="string" id="5921416">&#34;cookiejar:&nbsp;illegal&nbsp;cookie&nbsp;domain&nbsp;attribute&#34;</span><span class="op" id="5921460">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5921463">errMalformedDomain</span>&nbsp;<span class="op" id="5921482">=</span>&nbsp;<span class="ident" id="5921484">errors</span><span class="op" id="5921490">.</span><span class="ident" id="5921491">New</span><span class="op" id="5921494">(</span><span class="string" id="5921495">&#34;cookiejar:&nbsp;malformed&nbsp;cookie&nbsp;domain&nbsp;attribute&#34;</span><span class="op" id="5921541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5921544">errNoHostname</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5921563">=</span>&nbsp;<span class="ident" id="5921565">errors</span><span class="op" id="5921571">.</span><span class="ident" id="5921572">New</span><span class="op" id="5921575">(</span><span class="string" id="5921576">&#34;cookiejar:&nbsp;no&nbsp;host&nbsp;name&nbsp;available&nbsp;(IP&nbsp;only)&#34;</span><span class="op" id="5921621">)</span><br>
<span class="lineno"></span><span class="op" id="5921623">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5921626">//&nbsp;endOfTime&nbsp;is&nbsp;the&nbsp;time&nbsp;when&nbsp;session&nbsp;(non-persistent)&nbsp;cookies&nbsp;expire.</span><br>
<span class="lineno">435</span><span class="comment" id="5921697">//&nbsp;This&nbsp;instant&nbsp;is&nbsp;representable&nbsp;in&nbsp;most&nbsp;date/time&nbsp;formats&nbsp;(not&nbsp;just</span><br>
<span class="lineno"></span><span class="comment" id="5921766">//&nbsp;Go&#39;s&nbsp;time.Time)&nbsp;and&nbsp;should&nbsp;be&nbsp;far&nbsp;enough&nbsp;in&nbsp;the&nbsp;future.</span><br>
<span class="lineno"></span><span class="keyword" id="5921825">var</span>&nbsp;<span class="ident" id="5921829">endOfTime</span>&nbsp;<span class="op" id="5921839">=</span>&nbsp;<span class="ident" id="5921841">time</span><span class="op" id="5921845">.</span><span class="ident" id="5921846">Date</span><span class="op" id="5921850">(</span><span class="num" id="5921851">9999</span><span class="op" id="5921855">,</span>&nbsp;<span class="num" id="5921857">12</span><span class="op" id="5921859">,</span>&nbsp;<span class="num" id="5921861">31</span><span class="op" id="5921863">,</span>&nbsp;<span class="num" id="5921865">23</span><span class="op" id="5921867">,</span>&nbsp;<span class="num" id="5921869">59</span><span class="op" id="5921871">,</span>&nbsp;<span class="num" id="5921873">59</span><span class="op" id="5921875">,</span>&nbsp;<span class="num" id="5921877">0</span><span class="op" id="5921878">,</span>&nbsp;<span class="ident" id="5921880">time</span><span class="op" id="5921884">.</span><span class="ident" id="5921885">UTC</span><span class="op" id="5921888">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5921891">//&nbsp;domainAndType&nbsp;determines&nbsp;the&nbsp;cookie&#39;s&nbsp;domain&nbsp;and&nbsp;hostOnly&nbsp;attribute.</span><br>
<span class="lineno">440</span><span class="keyword" id="5921963">func</span>&nbsp;<span class="op" id="5921968">(</span><span class="ident" id="5921969">j</span>&nbsp;<span class="op" id="5921971">*</span><span class="ident" id="5921972">Jar</span><span class="op" id="5921975">)</span>&nbsp;<span class="ident" id="5921977">domainAndType</span><span class="op" id="5921990">(</span><span class="ident" id="5921991">host</span><span class="op" id="5921995">,</span>&nbsp;<span class="ident" id="5921997">domain</span>&nbsp;<span class="builtintype" id="5922004">string</span><span class="op" id="5922010">)</span>&nbsp;<span class="op" id="5922012">(</span><span class="builtintype" id="5922013">string</span><span class="op" id="5922019">,</span>&nbsp;<span class="builtintype" id="5922021">bool</span><span class="op" id="5922025">,</span>&nbsp;<span class="builtintype" id="5922027">error</span><span class="op" id="5922032">)</span>&nbsp;<span class="op" id="5922034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5922037">if</span>&nbsp;<span class="ident" id="5922040">domain</span>&nbsp;<span class="op" id="5922047">==</span>&nbsp;<span class="string" id="5922050">&#34;&#34;</span>&nbsp;<span class="op" id="5922053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5922057">//&nbsp;No&nbsp;domain&nbsp;attribute&nbsp;in&nbsp;the&nbsp;SetCookie&nbsp;header&nbsp;indicates&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5922118">//&nbsp;host&nbsp;cookie.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5922136">return</span>&nbsp;<span class="ident" id="5922143">host</span><span class="op" id="5922147">,</span>&nbsp;<span class="builtintype" id="5922149">true</span><span class="op" id="5922153">,</span>&nbsp;<span class="builtintype" id="5922155">nil</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5922160">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5922164">if</span>&nbsp;<span class="ident" id="5922167">isIP</span><span class="op" id="5922171">(</span><span class="ident" id="5922172">host</span><span class="op" id="5922176">)</span>&nbsp;<span class="op" id="5922178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5922182">//&nbsp;According&nbsp;to&nbsp;RFC&nbsp;6265&nbsp;domain-matching&nbsp;includes&nbsp;not&nbsp;being</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5922244">//&nbsp;an&nbsp;IP&nbsp;address.</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5922264">//&nbsp;TODO:&nbsp;This&nbsp;might&nbsp;be&nbsp;relaxed&nbsp;as&nbsp;in&nbsp;common&nbsp;browsers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5922320">return</span>&nbsp;<span class="string" id="5922327">&#34;&#34;</span><span class="op" id="5922329">,</span>&nbsp;<span class="builtintype" id="5922331">false</span><span class="op" id="5922336">,</span>&nbsp;<span class="ident" id="5922338">errNoHostname</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5922353">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5922357">//&nbsp;From&nbsp;here&nbsp;on:&nbsp;If&nbsp;the&nbsp;cookie&nbsp;is&nbsp;valid,&nbsp;it&nbsp;is&nbsp;a&nbsp;domain&nbsp;cookie&nbsp;(with</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5922427">//&nbsp;the&nbsp;one&nbsp;exception&nbsp;of&nbsp;a&nbsp;public&nbsp;suffix&nbsp;below).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5922476">//&nbsp;See&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.2.3.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5922508">if</span>&nbsp;<span class="ident" id="5922511">domain</span><span class="op" id="5922517">[</span><span class="num" id="5922518">0</span><span class="op" id="5922519">]</span>&nbsp;<span class="op" id="5922521">==</span>&nbsp;<span class="string" id="5922524">&#39;.&#39;</span>&nbsp;<span class="op" id="5922528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5922532">domain</span>&nbsp;<span class="op" id="5922539">=</span>&nbsp;<span class="ident" id="5922541">domain</span><span class="op" id="5922547">[</span><span class="num" id="5922548">1</span><span class="op" id="5922549">:</span><span class="op" id="5922550">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5922553">}</span><br>
<span class="lineno">460</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5922557">if</span>&nbsp;<span class="builtinfunc" id="5922560">len</span><span class="op" id="5922563">(</span><span class="ident" id="5922564">domain</span><span class="op" id="5922570">)</span>&nbsp;<span class="op" id="5922572">==</span>&nbsp;<span class="num" id="5922575">0</span>&nbsp;<span class="op" id="5922577">||</span>&nbsp;<span class="ident" id="5922580">domain</span><span class="op" id="5922586">[</span><span class="num" id="5922587">0</span><span class="op" id="5922588">]</span>&nbsp;<span class="op" id="5922590">==</span>&nbsp;<span class="string" id="5922593">&#39;.&#39;</span>&nbsp;<span class="op" id="5922597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5922601">//&nbsp;Received&nbsp;either&nbsp;&#34;Domain=.&#34;&nbsp;or&nbsp;&#34;Domain=..some.thing&#34;,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5922659">//&nbsp;both&nbsp;are&nbsp;illegal.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5922682">return</span>&nbsp;<span class="string" id="5922689">&#34;&#34;</span><span class="op" id="5922691">,</span>&nbsp;<span class="builtintype" id="5922693">false</span><span class="op" id="5922698">,</span>&nbsp;<span class="ident" id="5922700">errMalformedDomain</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5922720">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5922723">domain</span>&nbsp;<span class="op" id="5922730">=</span>&nbsp;<span class="ident" id="5922732">strings</span><span class="op" id="5922739">.</span><span class="ident" id="5922740">ToLower</span><span class="op" id="5922747">(</span><span class="ident" id="5922748">domain</span><span class="op" id="5922754">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5922758">if</span>&nbsp;<span class="ident" id="5922761">domain</span><span class="op" id="5922767">[</span><span class="builtinfunc" id="5922768">len</span><span class="op" id="5922771">(</span><span class="ident" id="5922772">domain</span><span class="op" id="5922778">)</span><span class="op" id="5922779">-</span><span class="num" id="5922780">1</span><span class="op" id="5922781">]</span>&nbsp;<span class="op" id="5922783">==</span>&nbsp;<span class="string" id="5922786">&#39;.&#39;</span>&nbsp;<span class="op" id="5922790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5922794">//&nbsp;We&nbsp;received&nbsp;stuff&nbsp;like&nbsp;&#34;Domain=www.example.com.&#34;.</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5922849">//&nbsp;Browsers&nbsp;do&nbsp;handle&nbsp;such&nbsp;stuff&nbsp;(actually&nbsp;differently)&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5922911">//&nbsp;RFC&nbsp;6265&nbsp;seems&nbsp;to&nbsp;be&nbsp;clear&nbsp;here&nbsp;(e.g.&nbsp;section&nbsp;4.1.2.3)&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5922974">//&nbsp;requiring&nbsp;a&nbsp;reject.&nbsp;&nbsp;4.1.2.3&nbsp;is&nbsp;not&nbsp;normative,&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5923030">//&nbsp;&#34;Domain&nbsp;Matching&#34;&nbsp;(5.1.3)&nbsp;and&nbsp;&#34;Canonicalized&nbsp;Host&nbsp;Names&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5923092">//&nbsp;(5.1.2)&nbsp;are.</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5923110">return</span>&nbsp;<span class="string" id="5923117">&#34;&#34;</span><span class="op" id="5923119">,</span>&nbsp;<span class="builtintype" id="5923121">false</span><span class="op" id="5923126">,</span>&nbsp;<span class="ident" id="5923128">errMalformedDomain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5923148">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5923152">//&nbsp;See&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.3&nbsp;#5.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5923185">if</span>&nbsp;<span class="ident" id="5923188">j</span><span class="op" id="5923189">.</span><span class="ident" id="5923190">psList</span>&nbsp;<span class="op" id="5923197">!=</span>&nbsp;<span class="builtintype" id="5923200">nil</span>&nbsp;<span class="op" id="5923204">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5923208">if</span>&nbsp;<span class="ident" id="5923211">ps</span>&nbsp;<span class="op" id="5923214">:=</span>&nbsp;<span class="ident" id="5923217">j</span><span class="op" id="5923218">.</span><span class="ident" id="5923219">psList</span><span class="op" id="5923225">.</span><span class="ident" id="5923226">PublicSuffix</span><span class="op" id="5923238">(</span><span class="ident" id="5923239">domain</span><span class="op" id="5923245">)</span><span class="op" id="5923246">;</span>&nbsp;<span class="ident" id="5923248">ps</span>&nbsp;<span class="op" id="5923251">!=</span>&nbsp;<span class="string" id="5923254">&#34;&#34;</span>&nbsp;<span class="op" id="5923257">&amp;&amp;</span>&nbsp;<span class="op" id="5923260">!</span><span class="ident" id="5923261">hasDotSuffix</span><span class="op" id="5923273">(</span><span class="ident" id="5923274">domain</span><span class="op" id="5923280">,</span>&nbsp;<span class="ident" id="5923282">ps</span><span class="op" id="5923284">)</span>&nbsp;<span class="op" id="5923286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5923291">if</span>&nbsp;<span class="ident" id="5923294">host</span>&nbsp;<span class="op" id="5923299">==</span>&nbsp;<span class="ident" id="5923302">domain</span>&nbsp;<span class="op" id="5923309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5923315">//&nbsp;This&nbsp;is&nbsp;the&nbsp;one&nbsp;exception&nbsp;in&nbsp;which&nbsp;a&nbsp;cookie</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5923366">//&nbsp;with&nbsp;a&nbsp;domain&nbsp;attribute&nbsp;is&nbsp;a&nbsp;host&nbsp;cookie.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5923415">return</span>&nbsp;<span class="ident" id="5923422">host</span><span class="op" id="5923426">,</span>&nbsp;<span class="builtintype" id="5923428">true</span><span class="op" id="5923432">,</span>&nbsp;<span class="builtintype" id="5923434">nil</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5923441">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5923446">return</span>&nbsp;<span class="string" id="5923453">&#34;&#34;</span><span class="op" id="5923455">,</span>&nbsp;<span class="builtintype" id="5923457">false</span><span class="op" id="5923462">,</span>&nbsp;<span class="ident" id="5923464">errIllegalDomain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5923483">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5923486">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5923490">//&nbsp;The&nbsp;domain&nbsp;must&nbsp;domain-match&nbsp;host:&nbsp;www.mycompany.com&nbsp;cannot</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5923554">//&nbsp;set&nbsp;cookies&nbsp;for&nbsp;.ourcompetitors.com.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5923595">if</span>&nbsp;<span class="ident" id="5923598">host</span>&nbsp;<span class="op" id="5923603">!=</span>&nbsp;<span class="ident" id="5923606">domain</span>&nbsp;<span class="op" id="5923613">&amp;&amp;</span>&nbsp;<span class="op" id="5923616">!</span><span class="ident" id="5923617">hasDotSuffix</span><span class="op" id="5923629">(</span><span class="ident" id="5923630">host</span><span class="op" id="5923634">,</span>&nbsp;<span class="ident" id="5923636">domain</span><span class="op" id="5923642">)</span>&nbsp;<span class="op" id="5923644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5923648">return</span>&nbsp;<span class="string" id="5923655">&#34;&#34;</span><span class="op" id="5923657">,</span>&nbsp;<span class="builtintype" id="5923659">false</span><span class="op" id="5923664">,</span>&nbsp;<span class="ident" id="5923666">errIllegalDomain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5923684">}</span><br>
<span class="lineno">495</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5923688">return</span>&nbsp;<span class="ident" id="5923695">domain</span><span class="op" id="5923701">,</span>&nbsp;<span class="builtintype" id="5923703">false</span><span class="op" id="5923708">,</span>&nbsp;<span class="builtintype" id="5923710">nil</span><br>
<span class="lineno"></span><span class="op" id="5923714">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
