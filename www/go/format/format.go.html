<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6150640">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6150695">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6150749">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6150800">//&nbsp;Package&nbsp;format&nbsp;implements&nbsp;standard&nbsp;formatting&nbsp;of&nbsp;Go&nbsp;source.</span><br>
<span class="lineno"></span><span class="keyword" id="6150863">package</span>&nbsp;<span class="ident" id="6150871">format</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6150879">import</span>&nbsp;<span class="op" id="6150886">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6150889">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6150898">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6150905">&#34;go/ast&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6150915">&#34;go/parser&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6150928">&#34;go/printer&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6150942">&#34;go/token&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6150954">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6150960">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="6150970">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6150973">var</span>&nbsp;<span class="ident" id="6150977">config</span>&nbsp;<span class="op" id="6150984">=</span>&nbsp;<span class="ident" id="6150986">printer</span><span class="op" id="6150993">.</span><span class="ident" id="6150994">Config</span><span class="op" id="6151000">{</span><span class="ident" id="6151001">Mode</span><span class="op" id="6151005">:</span>&nbsp;<span class="ident" id="6151007">printer</span><span class="op" id="6151014">.</span><span class="ident" id="6151015">UseSpaces</span>&nbsp;<span class="op" id="6151025">|</span>&nbsp;<span class="ident" id="6151027">printer</span><span class="op" id="6151034">.</span><span class="ident" id="6151035">TabIndent</span><span class="op" id="6151044">,</span>&nbsp;<span class="ident" id="6151046">Tabwidth</span><span class="op" id="6151054">:</span>&nbsp;<span class="num" id="6151056">8</span><span class="op" id="6151057">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="6151060">const</span>&nbsp;<span class="ident" id="6151066">parserMode</span>&nbsp;<span class="op" id="6151077">=</span>&nbsp;<span class="ident" id="6151079">parser</span><span class="op" id="6151085">.</span><span class="ident" id="6151086">ParseComments</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6151101">//&nbsp;Node&nbsp;formats&nbsp;node&nbsp;in&nbsp;canonical&nbsp;gofmt&nbsp;style&nbsp;and&nbsp;writes&nbsp;the&nbsp;result&nbsp;to&nbsp;dst.</span><br>
<span class="lineno"></span><span class="comment" id="6151177">//</span><br>
<span class="lineno">25</span><span class="comment" id="6151180">//&nbsp;The&nbsp;node&nbsp;type&nbsp;must&nbsp;be&nbsp;*ast.File,&nbsp;*printer.CommentedNode,&nbsp;[]ast.Decl,</span><br>
<span class="lineno"></span><span class="comment" id="6151252">//&nbsp;[]ast.Stmt,&nbsp;or&nbsp;assignment-compatible&nbsp;to&nbsp;ast.Expr,&nbsp;ast.Decl,&nbsp;ast.Spec,</span><br>
<span class="lineno"></span><span class="comment" id="6151325">//&nbsp;or&nbsp;ast.Stmt.&nbsp;Node&nbsp;does&nbsp;not&nbsp;modify&nbsp;node.&nbsp;Imports&nbsp;are&nbsp;not&nbsp;sorted&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="6151395">//&nbsp;nodes&nbsp;representing&nbsp;partial&nbsp;source&nbsp;files&nbsp;(i.e.,&nbsp;if&nbsp;the&nbsp;node&nbsp;is&nbsp;not&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="6151467">//&nbsp;*ast.File&nbsp;or&nbsp;a&nbsp;*printer.CommentedNode&nbsp;not&nbsp;wrapping&nbsp;an&nbsp;*ast.File).</span><br>
<span class="lineno">30</span><span class="comment" id="6151536">//</span><br>
<span class="lineno"></span><span class="comment" id="6151539">//&nbsp;The&nbsp;function&nbsp;may&nbsp;return&nbsp;early&nbsp;(before&nbsp;the&nbsp;entire&nbsp;result&nbsp;is&nbsp;written)</span><br>
<span class="lineno"></span><span class="comment" id="6151610">//&nbsp;and&nbsp;return&nbsp;a&nbsp;formatting&nbsp;error,&nbsp;for&nbsp;instance&nbsp;due&nbsp;to&nbsp;an&nbsp;incorrect&nbsp;AST.</span><br>
<span class="lineno"></span><span class="comment" id="6151682">//</span><br>
<span class="lineno"></span><span class="keyword" id="6151685">func</span>&nbsp;<span class="ident" id="6151690">Node</span><span class="op" id="6151694">(</span><span class="ident" id="6151695">dst</span>&nbsp;<span class="ident" id="6151699">io</span><span class="op" id="6151701">.</span><span class="ident" id="6151702">Writer</span><span class="op" id="6151708">,</span>&nbsp;<span class="ident" id="6151710">fset</span>&nbsp;<span class="op" id="6151715">*</span><span class="ident" id="6151716">token</span><span class="op" id="6151721">.</span><span class="ident" id="6151722">FileSet</span><span class="op" id="6151729">,</span>&nbsp;<span class="ident" id="6151731">node</span>&nbsp;<span class="keyword" id="6151736">interface</span><span class="op" id="6151745">{</span><span class="op" id="6151746">}</span><span class="op" id="6151747">)</span>&nbsp;<span class="builtintype" id="6151749">error</span>&nbsp;<span class="op" id="6151755">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6151758">//&nbsp;Determine&nbsp;if&nbsp;we&nbsp;have&nbsp;a&nbsp;complete&nbsp;source&nbsp;file&nbsp;(file&nbsp;!=&nbsp;nil).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6151821">var</span>&nbsp;<span class="ident" id="6151825">file</span>&nbsp;<span class="op" id="6151830">*</span><span class="ident" id="6151831">ast</span><span class="op" id="6151834">.</span><span class="ident" id="6151835">File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6151841">var</span>&nbsp;<span class="ident" id="6151845">cnode</span>&nbsp;<span class="op" id="6151851">*</span><span class="ident" id="6151852">printer</span><span class="op" id="6151859">.</span><span class="ident" id="6151860">CommentedNode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6151875">switch</span>&nbsp;<span class="ident" id="6151882">n</span>&nbsp;<span class="op" id="6151884">:=</span>&nbsp;<span class="ident" id="6151887">node</span><span class="op" id="6151891">.</span><span class="op" id="6151892">(</span><span class="keyword" id="6151893">type</span><span class="op" id="6151897">)</span>&nbsp;<span class="op" id="6151899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6151902">case</span>&nbsp;<span class="op" id="6151907">*</span><span class="ident" id="6151908">ast</span><span class="op" id="6151911">.</span><span class="ident" id="6151912">File</span><span class="op" id="6151916">:</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6151920">file</span>&nbsp;<span class="op" id="6151925">=</span>&nbsp;<span class="ident" id="6151927">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6151930">case</span>&nbsp;<span class="op" id="6151935">*</span><span class="ident" id="6151936">printer</span><span class="op" id="6151943">.</span><span class="ident" id="6151944">CommentedNode</span><span class="op" id="6151957">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6151961">if</span>&nbsp;<span class="ident" id="6151964">f</span><span class="op" id="6151965">,</span>&nbsp;<span class="ident" id="6151967">ok</span>&nbsp;<span class="op" id="6151970">:=</span>&nbsp;<span class="ident" id="6151973">n</span><span class="op" id="6151974">.</span><span class="ident" id="6151975">Node</span><span class="op" id="6151979">.</span><span class="op" id="6151980">(</span><span class="op" id="6151981">*</span><span class="ident" id="6151982">ast</span><span class="op" id="6151985">.</span><span class="ident" id="6151986">File</span><span class="op" id="6151990">)</span><span class="op" id="6151991">;</span>&nbsp;<span class="ident" id="6151993">ok</span>&nbsp;<span class="op" id="6151996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6152001">file</span>&nbsp;<span class="op" id="6152006">=</span>&nbsp;<span class="ident" id="6152008">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6152013">cnode</span>&nbsp;<span class="op" id="6152019">=</span>&nbsp;<span class="ident" id="6152021">n</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6152025">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6152028">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6152032">//&nbsp;Sort&nbsp;imports&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6152063">if</span>&nbsp;<span class="ident" id="6152066">file</span>&nbsp;<span class="op" id="6152071">!=</span>&nbsp;<span class="ident" id="6152074">nil</span>&nbsp;<span class="op" id="6152078">&amp;&amp;</span>&nbsp;<span class="ident" id="6152081">hasUnsortedImports</span><span class="op" id="6152099">(</span><span class="ident" id="6152100">file</span><span class="op" id="6152104">)</span>&nbsp;<span class="op" id="6152106">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6152110">//&nbsp;Make&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;AST&nbsp;because&nbsp;ast.SortImports&nbsp;is&nbsp;destructive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6152178">//&nbsp;TODO(gri)&nbsp;Do&nbsp;this&nbsp;more&nbsp;efficiently.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6152219">var</span>&nbsp;<span class="ident" id="6152223">buf</span>&nbsp;<span class="ident" id="6152227">bytes</span><span class="op" id="6152232">.</span><span class="ident" id="6152233">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6152242">err</span>&nbsp;<span class="op" id="6152246">:=</span>&nbsp;<span class="ident" id="6152249">config</span><span class="op" id="6152255">.</span><span class="ident" id="6152256">Fprint</span><span class="op" id="6152262">(</span><span class="op" id="6152263">&amp;</span><span class="ident" id="6152264">buf</span><span class="op" id="6152267">,</span>&nbsp;<span class="ident" id="6152269">fset</span><span class="op" id="6152273">,</span>&nbsp;<span class="ident" id="6152275">file</span><span class="op" id="6152279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6152283">if</span>&nbsp;<span class="ident" id="6152286">err</span>&nbsp;<span class="op" id="6152290">!=</span>&nbsp;<span class="ident" id="6152293">nil</span>&nbsp;<span class="op" id="6152297">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6152302">return</span>&nbsp;<span class="ident" id="6152309">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6152315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6152319">file</span><span class="op" id="6152323">,</span>&nbsp;<span class="ident" id="6152325">err</span>&nbsp;<span class="op" id="6152329">=</span>&nbsp;<span class="ident" id="6152331">parser</span><span class="op" id="6152337">.</span><span class="ident" id="6152338">ParseFile</span><span class="op" id="6152347">(</span><span class="ident" id="6152348">fset</span><span class="op" id="6152352">,</span>&nbsp;<span class="string" id="6152354">&#34;&#34;</span><span class="op" id="6152356">,</span>&nbsp;<span class="ident" id="6152358">buf</span><span class="op" id="6152361">.</span><span class="ident" id="6152362">Bytes</span><span class="op" id="6152367">(</span><span class="op" id="6152368">)</span><span class="op" id="6152369">,</span>&nbsp;<span class="ident" id="6152371">parserMode</span><span class="op" id="6152381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6152385">if</span>&nbsp;<span class="ident" id="6152388">err</span>&nbsp;<span class="op" id="6152392">!=</span>&nbsp;<span class="ident" id="6152395">nil</span>&nbsp;<span class="op" id="6152399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6152404">//&nbsp;We&nbsp;should&nbsp;never&nbsp;get&nbsp;here.&nbsp;If&nbsp;we&nbsp;do,&nbsp;provide&nbsp;good&nbsp;diagnostic.</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6152471">return</span>&nbsp;<span class="ident" id="6152478">fmt</span><span class="op" id="6152481">.</span><span class="ident" id="6152482">Errorf</span><span class="op" id="6152488">(</span><span class="string" id="6152489">&#34;format.Node&nbsp;internal&nbsp;error&nbsp;(%s)&#34;</span><span class="op" id="6152522">,</span>&nbsp;<span class="ident" id="6152524">err</span><span class="op" id="6152527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6152531">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6152535">ast</span><span class="op" id="6152538">.</span><span class="ident" id="6152539">SortImports</span><span class="op" id="6152550">(</span><span class="ident" id="6152551">fset</span><span class="op" id="6152555">,</span>&nbsp;<span class="ident" id="6152557">file</span><span class="op" id="6152561">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6152566">//&nbsp;Use&nbsp;new&nbsp;file&nbsp;with&nbsp;sorted&nbsp;imports.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6152605">node</span>&nbsp;<span class="op" id="6152610">=</span>&nbsp;<span class="ident" id="6152612">file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6152619">if</span>&nbsp;<span class="ident" id="6152622">cnode</span>&nbsp;<span class="op" id="6152628">!=</span>&nbsp;<span class="ident" id="6152631">nil</span>&nbsp;<span class="op" id="6152635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6152640">node</span>&nbsp;<span class="op" id="6152645">=</span>&nbsp;<span class="op" id="6152647">&amp;</span><span class="ident" id="6152648">printer</span><span class="op" id="6152655">.</span><span class="ident" id="6152656">CommentedNode</span><span class="op" id="6152669">{</span><span class="ident" id="6152670">Node</span><span class="op" id="6152674">:</span>&nbsp;<span class="ident" id="6152676">file</span><span class="op" id="6152680">,</span>&nbsp;<span class="ident" id="6152682">Comments</span><span class="op" id="6152690">:</span>&nbsp;<span class="ident" id="6152692">cnode</span><span class="op" id="6152697">.</span><span class="ident" id="6152698">Comments</span><span class="op" id="6152706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6152710">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6152713">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6152717">return</span>&nbsp;<span class="ident" id="6152724">config</span><span class="op" id="6152730">.</span><span class="ident" id="6152731">Fprint</span><span class="op" id="6152737">(</span><span class="ident" id="6152738">dst</span><span class="op" id="6152741">,</span>&nbsp;<span class="ident" id="6152743">fset</span><span class="op" id="6152747">,</span>&nbsp;<span class="ident" id="6152749">node</span><span class="op" id="6152753">)</span><br>
<span class="lineno"></span><span class="op" id="6152755">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6152758">//&nbsp;Source&nbsp;formats&nbsp;src&nbsp;in&nbsp;canonical&nbsp;gofmt&nbsp;style&nbsp;and&nbsp;returns&nbsp;the&nbsp;result</span><br>
<span class="lineno">75</span><span class="comment" id="6152828">//&nbsp;or&nbsp;an&nbsp;(I/O&nbsp;or&nbsp;syntax)&nbsp;error.&nbsp;src&nbsp;is&nbsp;expected&nbsp;to&nbsp;be&nbsp;a&nbsp;syntactically</span><br>
<span class="lineno"></span><span class="comment" id="6152898">//&nbsp;correct&nbsp;Go&nbsp;source&nbsp;file,&nbsp;or&nbsp;a&nbsp;list&nbsp;of&nbsp;Go&nbsp;declarations&nbsp;or&nbsp;statements.</span><br>
<span class="lineno"></span><span class="comment" id="6152969">//</span><br>
<span class="lineno"></span><span class="comment" id="6152972">//&nbsp;If&nbsp;src&nbsp;is&nbsp;a&nbsp;partial&nbsp;source&nbsp;file,&nbsp;the&nbsp;leading&nbsp;and&nbsp;trailing&nbsp;space&nbsp;of&nbsp;src</span><br>
<span class="lineno"></span><span class="comment" id="6153046">//&nbsp;is&nbsp;applied&nbsp;to&nbsp;the&nbsp;result&nbsp;(such&nbsp;that&nbsp;it&nbsp;has&nbsp;the&nbsp;same&nbsp;leading&nbsp;and&nbsp;trailing</span><br>
<span class="lineno">80</span><span class="comment" id="6153122">//&nbsp;space&nbsp;as&nbsp;src),&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;indented&nbsp;by&nbsp;the&nbsp;same&nbsp;amount&nbsp;as&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span><span class="comment" id="6153199">//&nbsp;line&nbsp;of&nbsp;src&nbsp;containing&nbsp;code.&nbsp;Imports&nbsp;are&nbsp;not&nbsp;sorted&nbsp;for&nbsp;partial&nbsp;source&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="6153280">//</span><br>
<span class="lineno"></span><span class="keyword" id="6153283">func</span>&nbsp;<span class="ident" id="6153288">Source</span><span class="op" id="6153294">(</span><span class="ident" id="6153295">src</span>&nbsp;<span class="op" id="6153299">[</span><span class="op" id="6153300">]</span><span class="builtintype" id="6153301">byte</span><span class="op" id="6153305">)</span>&nbsp;<span class="op" id="6153307">(</span><span class="op" id="6153308">[</span><span class="op" id="6153309">]</span><span class="builtintype" id="6153310">byte</span><span class="op" id="6153314">,</span>&nbsp;<span class="builtintype" id="6153316">error</span><span class="op" id="6153321">)</span>&nbsp;<span class="op" id="6153323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6153326">fset</span>&nbsp;<span class="op" id="6153331">:=</span>&nbsp;<span class="ident" id="6153334">token</span><span class="op" id="6153339">.</span><span class="ident" id="6153340">NewFileSet</span><span class="op" id="6153350">(</span><span class="op" id="6153351">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6153354">file</span><span class="op" id="6153358">,</span>&nbsp;<span class="ident" id="6153360">sourceAdj</span><span class="op" id="6153369">,</span>&nbsp;<span class="ident" id="6153371">indentAdj</span><span class="op" id="6153380">,</span>&nbsp;<span class="ident" id="6153382">err</span>&nbsp;<span class="op" id="6153386">:=</span>&nbsp;<span class="ident" id="6153389">parse</span><span class="op" id="6153394">(</span><span class="ident" id="6153395">fset</span><span class="op" id="6153399">,</span>&nbsp;<span class="string" id="6153401">&#34;&#34;</span><span class="op" id="6153403">,</span>&nbsp;<span class="ident" id="6153405">src</span><span class="op" id="6153408">,</span>&nbsp;<span class="ident" id="6153410">true</span><span class="op" id="6153414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6153417">if</span>&nbsp;<span class="ident" id="6153420">err</span>&nbsp;<span class="op" id="6153424">!=</span>&nbsp;<span class="ident" id="6153427">nil</span>&nbsp;<span class="op" id="6153431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6153435">return</span>&nbsp;<span class="ident" id="6153442">nil</span><span class="op" id="6153445">,</span>&nbsp;<span class="ident" id="6153447">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6153452">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6153456">if</span>&nbsp;<span class="ident" id="6153459">sourceAdj</span>&nbsp;<span class="op" id="6153469">==</span>&nbsp;<span class="ident" id="6153472">nil</span>&nbsp;<span class="op" id="6153476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6153480">//&nbsp;Complete&nbsp;source&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6153507">//&nbsp;TODO(gri)&nbsp;consider&nbsp;doing&nbsp;this&nbsp;always.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6153550">ast</span><span class="op" id="6153553">.</span><span class="ident" id="6153554">SortImports</span><span class="op" id="6153565">(</span><span class="ident" id="6153566">fset</span><span class="op" id="6153570">,</span>&nbsp;<span class="ident" id="6153572">file</span><span class="op" id="6153576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6153579">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6153583">return</span>&nbsp;<span class="ident" id="6153590">format</span><span class="op" id="6153596">(</span><span class="ident" id="6153597">fset</span><span class="op" id="6153601">,</span>&nbsp;<span class="ident" id="6153603">file</span><span class="op" id="6153607">,</span>&nbsp;<span class="ident" id="6153609">sourceAdj</span><span class="op" id="6153618">,</span>&nbsp;<span class="ident" id="6153620">indentAdj</span><span class="op" id="6153629">,</span>&nbsp;<span class="ident" id="6153631">src</span><span class="op" id="6153634">,</span>&nbsp;<span class="ident" id="6153636">config</span><span class="op" id="6153642">)</span><br>
<span class="lineno"></span><span class="op" id="6153644">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6153647">func</span>&nbsp;<span class="ident" id="6153652">hasUnsortedImports</span><span class="op" id="6153670">(</span><span class="ident" id="6153671">file</span>&nbsp;<span class="op" id="6153676">*</span><span class="ident" id="6153677">ast</span><span class="op" id="6153680">.</span><span class="ident" id="6153681">File</span><span class="op" id="6153685">)</span>&nbsp;<span class="builtintype" id="6153687">bool</span>&nbsp;<span class="op" id="6153692">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6153695">for</span>&nbsp;<span class="ident" id="6153699">_</span><span class="op" id="6153700">,</span>&nbsp;<span class="ident" id="6153702">d</span>&nbsp;<span class="op" id="6153704">:=</span>&nbsp;<span class="keyword" id="6153707">range</span>&nbsp;<span class="ident" id="6153713">file</span><span class="op" id="6153717">.</span><span class="ident" id="6153718">Decls</span>&nbsp;<span class="op" id="6153724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6153728">d</span><span class="op" id="6153729">,</span>&nbsp;<span class="ident" id="6153731">ok</span>&nbsp;<span class="op" id="6153734">:=</span>&nbsp;<span class="ident" id="6153737">d</span><span class="op" id="6153738">.</span><span class="op" id="6153739">(</span><span class="op" id="6153740">*</span><span class="ident" id="6153741">ast</span><span class="op" id="6153744">.</span><span class="ident" id="6153745">GenDecl</span><span class="op" id="6153752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6153756">if</span>&nbsp;<span class="op" id="6153759">!</span><span class="ident" id="6153760">ok</span>&nbsp;<span class="op" id="6153763">||</span>&nbsp;<span class="ident" id="6153766">d</span><span class="op" id="6153767">.</span><span class="ident" id="6153768">Tok</span>&nbsp;<span class="op" id="6153772">!=</span>&nbsp;<span class="ident" id="6153775">token</span><span class="op" id="6153780">.</span><span class="ident" id="6153781">IMPORT</span>&nbsp;<span class="op" id="6153788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6153793">//&nbsp;Not&nbsp;an&nbsp;import&nbsp;declaration,&nbsp;so&nbsp;we&#39;re&nbsp;done.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6153841">//&nbsp;Imports&nbsp;are&nbsp;always&nbsp;first.</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6153873">return</span>&nbsp;<span class="ident" id="6153880">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6153888">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6153892">if</span>&nbsp;<span class="ident" id="6153895">d</span><span class="op" id="6153896">.</span><span class="ident" id="6153897">Lparen</span><span class="op" id="6153903">.</span><span class="ident" id="6153904">IsValid</span><span class="op" id="6153911">(</span><span class="op" id="6153912">)</span>&nbsp;<span class="op" id="6153914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6153919">//&nbsp;For&nbsp;now&nbsp;assume&nbsp;all&nbsp;grouped&nbsp;imports&nbsp;are&nbsp;unsorted.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6153974">//&nbsp;TODO(gri)&nbsp;Should&nbsp;check&nbsp;if&nbsp;they&nbsp;are&nbsp;sorted&nbsp;already.</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6154031">return</span>&nbsp;<span class="ident" id="6154038">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6154045">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6154049">//&nbsp;Ungrouped&nbsp;imports&nbsp;are&nbsp;sorted&nbsp;by&nbsp;default.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6154094">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6154097">return</span>&nbsp;<span class="ident" id="6154104">false</span><br>
<span class="lineno">115</span><span class="op" id="6154110">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6154113">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="6154193">//&nbsp;Support&nbsp;functions</span><br>
<span class="lineno"></span><span class="comment" id="6154214">//</span><br>
<span class="lineno">120</span><span class="comment" id="6154217">//&nbsp;The&nbsp;functions&nbsp;parse,&nbsp;format,&nbsp;and&nbsp;isSpace&nbsp;below&nbsp;are&nbsp;identical&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6154288">//&nbsp;respective&nbsp;functions&nbsp;in&nbsp;cmd/gofmt/gofmt.go&nbsp;-&nbsp;keep&nbsp;them&nbsp;in&nbsp;sync!</span><br>
<span class="lineno"></span><span class="comment" id="6154355">//</span><br>
<span class="lineno"></span><span class="comment" id="6154358">//&nbsp;TODO(gri)&nbsp;Factor&nbsp;out&nbsp;this&nbsp;functionality,&nbsp;eventually.</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment" id="6154415">//&nbsp;parse&nbsp;parses&nbsp;src,&nbsp;which&nbsp;was&nbsp;read&nbsp;from&nbsp;the&nbsp;named&nbsp;file,</span><br>
<span class="lineno"></span><span class="comment" id="6154472">//&nbsp;as&nbsp;a&nbsp;Go&nbsp;source&nbsp;file,&nbsp;declaration,&nbsp;or&nbsp;statement&nbsp;list.</span><br>
<span class="lineno"></span><span class="keyword" id="6154528">func</span>&nbsp;<span class="ident" id="6154533">parse</span><span class="op" id="6154538">(</span><span class="ident" id="6154539">fset</span>&nbsp;<span class="op" id="6154544">*</span><span class="ident" id="6154545">token</span><span class="op" id="6154550">.</span><span class="ident" id="6154551">FileSet</span><span class="op" id="6154558">,</span>&nbsp;<span class="ident" id="6154560">filename</span>&nbsp;<span class="builtintype" id="6154569">string</span><span class="op" id="6154575">,</span>&nbsp;<span class="ident" id="6154577">src</span>&nbsp;<span class="op" id="6154581">[</span><span class="op" id="6154582">]</span><span class="builtintype" id="6154583">byte</span><span class="op" id="6154587">,</span>&nbsp;<span class="ident" id="6154589">fragmentOk</span>&nbsp;<span class="builtintype" id="6154600">bool</span><span class="op" id="6154604">)</span>&nbsp;<span class="op" id="6154606">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6154609">file</span>&nbsp;<span class="op" id="6154614">*</span><span class="ident" id="6154615">ast</span><span class="op" id="6154618">.</span><span class="ident" id="6154619">File</span><span class="op" id="6154623">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6154626">sourceAdj</span>&nbsp;<span class="keyword" id="6154636">func</span><span class="op" id="6154640">(</span><span class="ident" id="6154641">src</span>&nbsp;<span class="op" id="6154645">[</span><span class="op" id="6154646">]</span><span class="builtintype" id="6154647">byte</span><span class="op" id="6154651">,</span>&nbsp;<span class="ident" id="6154653">indent</span>&nbsp;<span class="builtintype" id="6154660">int</span><span class="op" id="6154663">)</span>&nbsp;<span class="op" id="6154665">[</span><span class="op" id="6154666">]</span><span class="builtintype" id="6154667">byte</span><span class="op" id="6154671">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6154674">indentAdj</span>&nbsp;<span class="builtintype" id="6154684">int</span><span class="op" id="6154687">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6154690">err</span>&nbsp;<span class="builtintype" id="6154694">error</span><span class="op" id="6154699">,</span><br>
<span class="lineno"></span><span class="op" id="6154701">)</span>&nbsp;<span class="op" id="6154703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6154706">//&nbsp;Try&nbsp;as&nbsp;whole&nbsp;source&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6154736">file</span><span class="op" id="6154740">,</span>&nbsp;<span class="ident" id="6154742">err</span>&nbsp;<span class="op" id="6154746">=</span>&nbsp;<span class="ident" id="6154748">parser</span><span class="op" id="6154754">.</span><span class="ident" id="6154755">ParseFile</span><span class="op" id="6154764">(</span><span class="ident" id="6154765">fset</span><span class="op" id="6154769">,</span>&nbsp;<span class="ident" id="6154771">filename</span><span class="op" id="6154779">,</span>&nbsp;<span class="ident" id="6154781">src</span><span class="op" id="6154784">,</span>&nbsp;<span class="ident" id="6154786">parserMode</span><span class="op" id="6154796">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6154799">//&nbsp;If&nbsp;there&#39;s&nbsp;no&nbsp;error,&nbsp;return.&nbsp;&nbsp;If&nbsp;the&nbsp;error&nbsp;is&nbsp;that&nbsp;the&nbsp;source&nbsp;file&nbsp;didn&#39;t&nbsp;begin&nbsp;with&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6154890">//&nbsp;package&nbsp;line&nbsp;and&nbsp;source&nbsp;fragments&nbsp;are&nbsp;ok,&nbsp;fall&nbsp;through&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6154952">//&nbsp;try&nbsp;as&nbsp;a&nbsp;source&nbsp;fragment.&nbsp;&nbsp;Stop&nbsp;and&nbsp;return&nbsp;on&nbsp;any&nbsp;other&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6155019">if</span>&nbsp;<span class="ident" id="6155022">err</span>&nbsp;<span class="op" id="6155026">==</span>&nbsp;<span class="ident" id="6155029">nil</span>&nbsp;<span class="op" id="6155033">||</span>&nbsp;<span class="op" id="6155036">!</span><span class="ident" id="6155037">fragmentOk</span>&nbsp;<span class="op" id="6155048">||</span>&nbsp;<span class="op" id="6155051">!</span><span class="ident" id="6155052">strings</span><span class="op" id="6155059">.</span><span class="ident" id="6155060">Contains</span><span class="op" id="6155068">(</span><span class="ident" id="6155069">err</span><span class="op" id="6155072">.</span><span class="ident" id="6155073">Error</span><span class="op" id="6155078">(</span><span class="op" id="6155079">)</span><span class="op" id="6155080">,</span>&nbsp;<span class="string" id="6155082">&#34;expected&nbsp;&#39;package&#39;&#34;</span><span class="op" id="6155102">)</span>&nbsp;<span class="op" id="6155104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6155108">return</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6155116">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6155120">//&nbsp;If&nbsp;this&nbsp;is&nbsp;a&nbsp;declaration&nbsp;list,&nbsp;make&nbsp;it&nbsp;a&nbsp;source&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6155177">//&nbsp;by&nbsp;inserting&nbsp;a&nbsp;package&nbsp;clause.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6155212">//&nbsp;Insert&nbsp;using&nbsp;a&nbsp;;,&nbsp;not&nbsp;a&nbsp;newline,&nbsp;so&nbsp;that&nbsp;the&nbsp;line&nbsp;numbers</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6155274">//&nbsp;in&nbsp;psrc&nbsp;match&nbsp;the&nbsp;ones&nbsp;in&nbsp;src.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6155309">psrc</span>&nbsp;<span class="op" id="6155314">:=</span>&nbsp;<span class="builtinfunc" id="6155317">append</span><span class="op" id="6155323">(</span><span class="op" id="6155324">[</span><span class="op" id="6155325">]</span><span class="builtintype" id="6155326">byte</span><span class="op" id="6155330">(</span><span class="string" id="6155331">&#34;package&nbsp;p;&#34;</span><span class="op" id="6155343">)</span><span class="op" id="6155344">,</span>&nbsp;<span class="ident" id="6155346">src</span><span class="op" id="6155349">...</span><span class="op" id="6155352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6155355">file</span><span class="op" id="6155359">,</span>&nbsp;<span class="ident" id="6155361">err</span>&nbsp;<span class="op" id="6155365">=</span>&nbsp;<span class="ident" id="6155367">parser</span><span class="op" id="6155373">.</span><span class="ident" id="6155374">ParseFile</span><span class="op" id="6155383">(</span><span class="ident" id="6155384">fset</span><span class="op" id="6155388">,</span>&nbsp;<span class="ident" id="6155390">filename</span><span class="op" id="6155398">,</span>&nbsp;<span class="ident" id="6155400">psrc</span><span class="op" id="6155404">,</span>&nbsp;<span class="ident" id="6155406">parserMode</span><span class="op" id="6155416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6155419">if</span>&nbsp;<span class="ident" id="6155422">err</span>&nbsp;<span class="op" id="6155426">==</span>&nbsp;<span class="ident" id="6155429">nil</span>&nbsp;<span class="op" id="6155433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6155437">sourceAdj</span>&nbsp;<span class="op" id="6155447">=</span>&nbsp;<span class="keyword" id="6155449">func</span><span class="op" id="6155453">(</span><span class="ident" id="6155454">src</span>&nbsp;<span class="op" id="6155458">[</span><span class="op" id="6155459">]</span><span class="builtintype" id="6155460">byte</span><span class="op" id="6155464">,</span>&nbsp;<span class="ident" id="6155466">indent</span>&nbsp;<span class="builtintype" id="6155473">int</span><span class="op" id="6155476">)</span>&nbsp;<span class="op" id="6155478">[</span><span class="op" id="6155479">]</span><span class="builtintype" id="6155480">byte</span>&nbsp;<span class="op" id="6155485">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6155490">//&nbsp;Remove&nbsp;the&nbsp;package&nbsp;clause.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6155523">//&nbsp;Gofmt&nbsp;has&nbsp;turned&nbsp;the&nbsp;;&nbsp;into&nbsp;a&nbsp;\n.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6155563">src</span>&nbsp;<span class="op" id="6155567">=</span>&nbsp;<span class="ident" id="6155569">src</span><span class="op" id="6155572">[</span><span class="ident" id="6155573">indent</span><span class="op" id="6155579">+</span><span class="builtinfunc" id="6155580">len</span><span class="op" id="6155583">(</span><span class="string" id="6155584">&#34;package&nbsp;p\n&#34;</span><span class="op" id="6155597">)</span><span class="op" id="6155598">:</span><span class="op" id="6155599">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6155604">return</span>&nbsp;<span class="ident" id="6155611">bytes</span><span class="op" id="6155616">.</span><span class="ident" id="6155617">TrimSpace</span><span class="op" id="6155626">(</span><span class="ident" id="6155627">src</span><span class="op" id="6155630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6155634">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6155638">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6155646">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6155649">//&nbsp;If&nbsp;the&nbsp;error&nbsp;is&nbsp;that&nbsp;the&nbsp;source&nbsp;file&nbsp;didn&#39;t&nbsp;begin&nbsp;with&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6155710">//&nbsp;declaration,&nbsp;fall&nbsp;through&nbsp;to&nbsp;try&nbsp;as&nbsp;a&nbsp;statement&nbsp;list.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6155768">//&nbsp;Stop&nbsp;and&nbsp;return&nbsp;on&nbsp;any&nbsp;other&nbsp;error.</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6155808">if</span>&nbsp;<span class="op" id="6155811">!</span><span class="ident" id="6155812">strings</span><span class="op" id="6155819">.</span><span class="ident" id="6155820">Contains</span><span class="op" id="6155828">(</span><span class="ident" id="6155829">err</span><span class="op" id="6155832">.</span><span class="ident" id="6155833">Error</span><span class="op" id="6155838">(</span><span class="op" id="6155839">)</span><span class="op" id="6155840">,</span>&nbsp;<span class="string" id="6155842">&#34;expected&nbsp;declaration&#34;</span><span class="op" id="6155864">)</span>&nbsp;<span class="op" id="6155866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6155870">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6155878">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6155882">//&nbsp;If&nbsp;this&nbsp;is&nbsp;a&nbsp;statement&nbsp;list,&nbsp;make&nbsp;it&nbsp;a&nbsp;source&nbsp;file</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6155937">//&nbsp;by&nbsp;inserting&nbsp;a&nbsp;package&nbsp;clause&nbsp;and&nbsp;turning&nbsp;the&nbsp;list</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6155992">//&nbsp;into&nbsp;a&nbsp;function&nbsp;body.&nbsp;&nbsp;This&nbsp;handles&nbsp;expressions&nbsp;too.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6156049">//&nbsp;Insert&nbsp;using&nbsp;a&nbsp;;,&nbsp;not&nbsp;a&nbsp;newline,&nbsp;so&nbsp;that&nbsp;the&nbsp;line&nbsp;numbers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6156111">//&nbsp;in&nbsp;fsrc&nbsp;match&nbsp;the&nbsp;ones&nbsp;in&nbsp;src.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6156146">fsrc</span>&nbsp;<span class="op" id="6156151">:=</span>&nbsp;<span class="builtinfunc" id="6156154">append</span><span class="op" id="6156160">(</span><span class="builtinfunc" id="6156161">append</span><span class="op" id="6156167">(</span><span class="op" id="6156168">[</span><span class="op" id="6156169">]</span><span class="builtintype" id="6156170">byte</span><span class="op" id="6156174">(</span><span class="string" id="6156175">&#34;package&nbsp;p;&nbsp;func&nbsp;_()&nbsp;{&#34;</span><span class="op" id="6156198">)</span><span class="op" id="6156199">,</span>&nbsp;<span class="ident" id="6156201">src</span><span class="op" id="6156204">...</span><span class="op" id="6156207">)</span><span class="op" id="6156208">,</span>&nbsp;<span class="string" id="6156210">&#39;\n&#39;</span><span class="op" id="6156214">,</span>&nbsp;<span class="string" id="6156216">&#39;}&#39;</span><span class="op" id="6156219">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6156222">file</span><span class="op" id="6156226">,</span>&nbsp;<span class="ident" id="6156228">err</span>&nbsp;<span class="op" id="6156232">=</span>&nbsp;<span class="ident" id="6156234">parser</span><span class="op" id="6156240">.</span><span class="ident" id="6156241">ParseFile</span><span class="op" id="6156250">(</span><span class="ident" id="6156251">fset</span><span class="op" id="6156255">,</span>&nbsp;<span class="ident" id="6156257">filename</span><span class="op" id="6156265">,</span>&nbsp;<span class="ident" id="6156267">fsrc</span><span class="op" id="6156271">,</span>&nbsp;<span class="ident" id="6156273">parserMode</span><span class="op" id="6156283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6156286">if</span>&nbsp;<span class="ident" id="6156289">err</span>&nbsp;<span class="op" id="6156293">==</span>&nbsp;<span class="ident" id="6156296">nil</span>&nbsp;<span class="op" id="6156300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6156304">sourceAdj</span>&nbsp;<span class="op" id="6156314">=</span>&nbsp;<span class="keyword" id="6156316">func</span><span class="op" id="6156320">(</span><span class="ident" id="6156321">src</span>&nbsp;<span class="op" id="6156325">[</span><span class="op" id="6156326">]</span><span class="builtintype" id="6156327">byte</span><span class="op" id="6156331">,</span>&nbsp;<span class="ident" id="6156333">indent</span>&nbsp;<span class="builtintype" id="6156340">int</span><span class="op" id="6156343">)</span>&nbsp;<span class="op" id="6156345">[</span><span class="op" id="6156346">]</span><span class="builtintype" id="6156347">byte</span>&nbsp;<span class="op" id="6156352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6156357">//&nbsp;Cap&nbsp;adjusted&nbsp;indent&nbsp;to&nbsp;zero.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6156392">if</span>&nbsp;<span class="ident" id="6156395">indent</span>&nbsp;<span class="op" id="6156402">&lt;</span>&nbsp;<span class="num" id="6156404">0</span>&nbsp;<span class="op" id="6156406">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6156412">indent</span>&nbsp;<span class="op" id="6156419">=</span>&nbsp;<span class="num" id="6156421">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6156426">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6156431">//&nbsp;Remove&nbsp;the&nbsp;wrapping.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6156458">//&nbsp;Gofmt&nbsp;has&nbsp;turned&nbsp;the&nbsp;;&nbsp;into&nbsp;a&nbsp;\n\n.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6156500">//&nbsp;There&nbsp;will&nbsp;be&nbsp;two&nbsp;non-blank&nbsp;lines&nbsp;with&nbsp;indent,&nbsp;hence&nbsp;2*indent.</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6156569">src</span>&nbsp;<span class="op" id="6156573">=</span>&nbsp;<span class="ident" id="6156575">src</span><span class="op" id="6156578">[</span><span class="num" id="6156579">2</span><span class="op" id="6156580">*</span><span class="ident" id="6156581">indent</span><span class="op" id="6156587">+</span><span class="builtinfunc" id="6156588">len</span><span class="op" id="6156591">(</span><span class="string" id="6156592">&#34;package&nbsp;p\n\nfunc&nbsp;_()&nbsp;{&#34;</span><span class="op" id="6156617">)</span><span class="op" id="6156618">:</span><span class="op" id="6156619">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6156624">src</span>&nbsp;<span class="op" id="6156628">=</span>&nbsp;<span class="ident" id="6156630">src</span><span class="op" id="6156633">[</span><span class="op" id="6156634">:</span><span class="builtinfunc" id="6156635">len</span><span class="op" id="6156638">(</span><span class="ident" id="6156639">src</span><span class="op" id="6156642">)</span><span class="op" id="6156643">-</span><span class="op" id="6156644">(</span><span class="ident" id="6156645">indent</span><span class="op" id="6156651">+</span><span class="builtinfunc" id="6156652">len</span><span class="op" id="6156655">(</span><span class="string" id="6156656">&#34;\n}\n&#34;</span><span class="op" id="6156663">)</span><span class="op" id="6156664">)</span><span class="op" id="6156665">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6156670">return</span>&nbsp;<span class="ident" id="6156677">bytes</span><span class="op" id="6156682">.</span><span class="ident" id="6156683">TrimSpace</span><span class="op" id="6156692">(</span><span class="ident" id="6156693">src</span><span class="op" id="6156696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6156700">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6156704">//&nbsp;Gofmt&nbsp;has&nbsp;also&nbsp;indented&nbsp;the&nbsp;function&nbsp;body&nbsp;one&nbsp;level.</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6156762">//&nbsp;Adjust&nbsp;that&nbsp;with&nbsp;indentAdj.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6156795">indentAdj</span>&nbsp;<span class="op" id="6156805">=</span>&nbsp;<span class="op" id="6156807">-</span><span class="num" id="6156808">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6156811">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6156815">//&nbsp;Succeeded,&nbsp;or&nbsp;out&nbsp;of&nbsp;options.</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6156849">return</span><br>
<span class="lineno"></span><span class="op" id="6156856">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6156859">//&nbsp;format&nbsp;formats&nbsp;the&nbsp;given&nbsp;package&nbsp;file&nbsp;originally&nbsp;obtained&nbsp;from&nbsp;src</span><br>
<span class="lineno"></span><span class="comment" id="6156929">//&nbsp;and&nbsp;adjusts&nbsp;the&nbsp;result&nbsp;based&nbsp;on&nbsp;the&nbsp;original&nbsp;source&nbsp;via&nbsp;sourceAdj</span><br>
<span class="lineno">195</span><span class="comment" id="6156998">//&nbsp;and&nbsp;indentAdj.</span><br>
<span class="lineno"></span><span class="keyword" id="6157016">func</span>&nbsp;<span class="ident" id="6157021">format</span><span class="op" id="6157027">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6157030">fset</span>&nbsp;<span class="op" id="6157035">*</span><span class="ident" id="6157036">token</span><span class="op" id="6157041">.</span><span class="ident" id="6157042">FileSet</span><span class="op" id="6157049">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6157052">file</span>&nbsp;<span class="op" id="6157057">*</span><span class="ident" id="6157058">ast</span><span class="op" id="6157061">.</span><span class="ident" id="6157062">File</span><span class="op" id="6157066">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6157069">sourceAdj</span>&nbsp;<span class="keyword" id="6157079">func</span><span class="op" id="6157083">(</span><span class="ident" id="6157084">src</span>&nbsp;<span class="op" id="6157088">[</span><span class="op" id="6157089">]</span><span class="builtintype" id="6157090">byte</span><span class="op" id="6157094">,</span>&nbsp;<span class="ident" id="6157096">indent</span>&nbsp;<span class="builtintype" id="6157103">int</span><span class="op" id="6157106">)</span>&nbsp;<span class="op" id="6157108">[</span><span class="op" id="6157109">]</span><span class="builtintype" id="6157110">byte</span><span class="op" id="6157114">,</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6157117">indentAdj</span>&nbsp;<span class="builtintype" id="6157127">int</span><span class="op" id="6157130">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6157133">src</span>&nbsp;<span class="op" id="6157137">[</span><span class="op" id="6157138">]</span><span class="builtintype" id="6157139">byte</span><span class="op" id="6157143">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6157146">cfg</span>&nbsp;<span class="ident" id="6157150">printer</span><span class="op" id="6157157">.</span><span class="ident" id="6157158">Config</span><span class="op" id="6157164">,</span><br>
<span class="lineno"></span><span class="op" id="6157166">)</span>&nbsp;<span class="op" id="6157168">(</span><span class="op" id="6157169">[</span><span class="op" id="6157170">]</span><span class="builtintype" id="6157171">byte</span><span class="op" id="6157175">,</span>&nbsp;<span class="builtintype" id="6157177">error</span><span class="op" id="6157182">)</span>&nbsp;<span class="op" id="6157184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6157187">if</span>&nbsp;<span class="ident" id="6157190">sourceAdj</span>&nbsp;<span class="op" id="6157200">==</span>&nbsp;<span class="ident" id="6157203">nil</span>&nbsp;<span class="op" id="6157207">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6157211">//&nbsp;Complete&nbsp;source&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6157238">var</span>&nbsp;<span class="ident" id="6157242">buf</span>&nbsp;<span class="ident" id="6157246">bytes</span><span class="op" id="6157251">.</span><span class="ident" id="6157252">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6157261">err</span>&nbsp;<span class="op" id="6157265">:=</span>&nbsp;<span class="ident" id="6157268">cfg</span><span class="op" id="6157271">.</span><span class="ident" id="6157272">Fprint</span><span class="op" id="6157278">(</span><span class="op" id="6157279">&amp;</span><span class="ident" id="6157280">buf</span><span class="op" id="6157283">,</span>&nbsp;<span class="ident" id="6157285">fset</span><span class="op" id="6157289">,</span>&nbsp;<span class="ident" id="6157291">file</span><span class="op" id="6157295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6157299">if</span>&nbsp;<span class="ident" id="6157302">err</span>&nbsp;<span class="op" id="6157306">!=</span>&nbsp;<span class="ident" id="6157309">nil</span>&nbsp;<span class="op" id="6157313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6157318">return</span>&nbsp;<span class="ident" id="6157325">nil</span><span class="op" id="6157328">,</span>&nbsp;<span class="ident" id="6157330">err</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6157336">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6157340">return</span>&nbsp;<span class="ident" id="6157347">buf</span><span class="op" id="6157350">.</span><span class="ident" id="6157351">Bytes</span><span class="op" id="6157356">(</span><span class="op" id="6157357">)</span><span class="op" id="6157358">,</span>&nbsp;<span class="ident" id="6157360">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6157365">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6157369">//&nbsp;Partial&nbsp;source&nbsp;file.</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6157394">//&nbsp;Determine&nbsp;and&nbsp;prepend&nbsp;leading&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6157435">i</span><span class="op" id="6157436">,</span>&nbsp;<span class="ident" id="6157438">j</span>&nbsp;<span class="op" id="6157440">:=</span>&nbsp;<span class="num" id="6157443">0</span><span class="op" id="6157444">,</span>&nbsp;<span class="num" id="6157446">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6157449">for</span>&nbsp;<span class="ident" id="6157453">j</span>&nbsp;<span class="op" id="6157455">&lt;</span>&nbsp;<span class="builtinfunc" id="6157457">len</span><span class="op" id="6157460">(</span><span class="ident" id="6157461">src</span><span class="op" id="6157464">)</span>&nbsp;<span class="op" id="6157466">&amp;&amp;</span>&nbsp;<span class="ident" id="6157469">isSpace</span><span class="op" id="6157476">(</span><span class="ident" id="6157477">src</span><span class="op" id="6157480">[</span><span class="ident" id="6157481">j</span><span class="op" id="6157482">]</span><span class="op" id="6157483">)</span>&nbsp;<span class="op" id="6157485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6157489">if</span>&nbsp;<span class="ident" id="6157492">src</span><span class="op" id="6157495">[</span><span class="ident" id="6157496">j</span><span class="op" id="6157497">]</span>&nbsp;<span class="op" id="6157499">==</span>&nbsp;<span class="string" id="6157502">&#39;\n&#39;</span>&nbsp;<span class="op" id="6157507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6157512">i</span>&nbsp;<span class="op" id="6157514">=</span>&nbsp;<span class="ident" id="6157516">j</span>&nbsp;<span class="op" id="6157518">+</span>&nbsp;<span class="num" id="6157520">1</span>&nbsp;<span class="comment" id="6157522">//&nbsp;byte&nbsp;offset&nbsp;of&nbsp;last&nbsp;line&nbsp;in&nbsp;leading&nbsp;space</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6157569">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6157573">j</span><span class="op" id="6157574">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6157578">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6157581">var</span>&nbsp;<span class="ident" id="6157585">res</span>&nbsp;<span class="op" id="6157589">[</span><span class="op" id="6157590">]</span><span class="builtintype" id="6157591">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6157597">res</span>&nbsp;<span class="op" id="6157601">=</span>&nbsp;<span class="builtinfunc" id="6157603">append</span><span class="op" id="6157609">(</span><span class="ident" id="6157610">res</span><span class="op" id="6157613">,</span>&nbsp;<span class="ident" id="6157615">src</span><span class="op" id="6157618">[</span><span class="op" id="6157619">:</span><span class="ident" id="6157620">i</span><span class="op" id="6157621">]</span><span class="op" id="6157622">...</span><span class="op" id="6157625">)</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6157629">//&nbsp;Determine&nbsp;and&nbsp;prepend&nbsp;indentation&nbsp;of&nbsp;first&nbsp;code&nbsp;line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6157687">//&nbsp;Spaces&nbsp;are&nbsp;ignored&nbsp;unless&nbsp;there&nbsp;are&nbsp;no&nbsp;tabs,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6157736">//&nbsp;in&nbsp;which&nbsp;case&nbsp;spaces&nbsp;count&nbsp;as&nbsp;one&nbsp;tab.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6157779">indent</span>&nbsp;<span class="op" id="6157786">:=</span>&nbsp;<span class="num" id="6157789">0</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6157792">hasSpace</span>&nbsp;<span class="op" id="6157801">:=</span>&nbsp;<span class="ident" id="6157804">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6157811">for</span>&nbsp;<span class="ident" id="6157815">_</span><span class="op" id="6157816">,</span>&nbsp;<span class="ident" id="6157818">b</span>&nbsp;<span class="op" id="6157820">:=</span>&nbsp;<span class="keyword" id="6157823">range</span>&nbsp;<span class="ident" id="6157829">src</span><span class="op" id="6157832">[</span><span class="ident" id="6157833">i</span><span class="op" id="6157834">:</span><span class="ident" id="6157835">j</span><span class="op" id="6157836">]</span>&nbsp;<span class="op" id="6157838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6157842">switch</span>&nbsp;<span class="ident" id="6157849">b</span>&nbsp;<span class="op" id="6157851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6157855">case</span>&nbsp;<span class="string" id="6157860">&#39;&nbsp;&#39;</span><span class="op" id="6157863">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6157868">hasSpace</span>&nbsp;<span class="op" id="6157877">=</span>&nbsp;<span class="ident" id="6157879">true</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6157886">case</span>&nbsp;<span class="string" id="6157891">&#39;\t&#39;</span><span class="op" id="6157895">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6157900">indent</span><span class="op" id="6157906">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6157911">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6157914">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6157917">if</span>&nbsp;<span class="ident" id="6157920">indent</span>&nbsp;<span class="op" id="6157927">==</span>&nbsp;<span class="num" id="6157930">0</span>&nbsp;<span class="op" id="6157932">&amp;&amp;</span>&nbsp;<span class="ident" id="6157935">hasSpace</span>&nbsp;<span class="op" id="6157944">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6157948">indent</span>&nbsp;<span class="op" id="6157955">=</span>&nbsp;<span class="num" id="6157957">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6157960">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6157963">for</span>&nbsp;<span class="ident" id="6157967">i</span>&nbsp;<span class="op" id="6157969">:=</span>&nbsp;<span class="num" id="6157972">0</span><span class="op" id="6157973">;</span>&nbsp;<span class="ident" id="6157975">i</span>&nbsp;<span class="op" id="6157977">&lt;</span>&nbsp;<span class="ident" id="6157979">indent</span><span class="op" id="6157985">;</span>&nbsp;<span class="ident" id="6157987">i</span><span class="op" id="6157988">++</span>&nbsp;<span class="op" id="6157991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6157995">res</span>&nbsp;<span class="op" id="6157999">=</span>&nbsp;<span class="builtinfunc" id="6158001">append</span><span class="op" id="6158007">(</span><span class="ident" id="6158008">res</span><span class="op" id="6158011">,</span>&nbsp;<span class="string" id="6158013">&#39;\t&#39;</span><span class="op" id="6158017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6158020">}</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6158024">//&nbsp;Format&nbsp;the&nbsp;source.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6158047">//&nbsp;Write&nbsp;it&nbsp;without&nbsp;any&nbsp;leading&nbsp;and&nbsp;trailing&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6158100">cfg</span><span class="op" id="6158103">.</span><span class="ident" id="6158104">Indent</span>&nbsp;<span class="op" id="6158111">=</span>&nbsp;<span class="ident" id="6158113">indent</span>&nbsp;<span class="op" id="6158120">+</span>&nbsp;<span class="ident" id="6158122">indentAdj</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6158133">var</span>&nbsp;<span class="ident" id="6158137">buf</span>&nbsp;<span class="ident" id="6158141">bytes</span><span class="op" id="6158146">.</span><span class="ident" id="6158147">Buffer</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6158155">err</span>&nbsp;<span class="op" id="6158159">:=</span>&nbsp;<span class="ident" id="6158162">cfg</span><span class="op" id="6158165">.</span><span class="ident" id="6158166">Fprint</span><span class="op" id="6158172">(</span><span class="op" id="6158173">&amp;</span><span class="ident" id="6158174">buf</span><span class="op" id="6158177">,</span>&nbsp;<span class="ident" id="6158179">fset</span><span class="op" id="6158183">,</span>&nbsp;<span class="ident" id="6158185">file</span><span class="op" id="6158189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6158192">if</span>&nbsp;<span class="ident" id="6158195">err</span>&nbsp;<span class="op" id="6158199">!=</span>&nbsp;<span class="ident" id="6158202">nil</span>&nbsp;<span class="op" id="6158206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6158210">return</span>&nbsp;<span class="ident" id="6158217">nil</span><span class="op" id="6158220">,</span>&nbsp;<span class="ident" id="6158222">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6158227">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6158230">res</span>&nbsp;<span class="op" id="6158234">=</span>&nbsp;<span class="builtinfunc" id="6158236">append</span><span class="op" id="6158242">(</span><span class="ident" id="6158243">res</span><span class="op" id="6158246">,</span>&nbsp;<span class="ident" id="6158248">sourceAdj</span><span class="op" id="6158257">(</span><span class="ident" id="6158258">buf</span><span class="op" id="6158261">.</span><span class="ident" id="6158262">Bytes</span><span class="op" id="6158267">(</span><span class="op" id="6158268">)</span><span class="op" id="6158269">,</span>&nbsp;<span class="ident" id="6158271">cfg</span><span class="op" id="6158274">.</span><span class="ident" id="6158275">Indent</span><span class="op" id="6158281">)</span><span class="op" id="6158282">...</span><span class="op" id="6158285">)</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6158289">//&nbsp;Determine&nbsp;and&nbsp;append&nbsp;trailing&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6158330">i</span>&nbsp;<span class="op" id="6158332">=</span>&nbsp;<span class="builtinfunc" id="6158334">len</span><span class="op" id="6158337">(</span><span class="ident" id="6158338">src</span><span class="op" id="6158341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6158344">for</span>&nbsp;<span class="ident" id="6158348">i</span>&nbsp;<span class="op" id="6158350">&gt;</span>&nbsp;<span class="num" id="6158352">0</span>&nbsp;<span class="op" id="6158354">&amp;&amp;</span>&nbsp;<span class="ident" id="6158357">isSpace</span><span class="op" id="6158364">(</span><span class="ident" id="6158365">src</span><span class="op" id="6158368">[</span><span class="ident" id="6158369">i</span><span class="op" id="6158370">-</span><span class="num" id="6158371">1</span><span class="op" id="6158372">]</span><span class="op" id="6158373">)</span>&nbsp;<span class="op" id="6158375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6158379">i</span><span class="op" id="6158380">--</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6158384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6158387">return</span>&nbsp;<span class="builtinfunc" id="6158394">append</span><span class="op" id="6158400">(</span><span class="ident" id="6158401">res</span><span class="op" id="6158404">,</span>&nbsp;<span class="ident" id="6158406">src</span><span class="op" id="6158409">[</span><span class="ident" id="6158410">i</span><span class="op" id="6158411">:</span><span class="op" id="6158412">]</span><span class="op" id="6158413">...</span><span class="op" id="6158416">)</span><span class="op" id="6158417">,</span>&nbsp;<span class="ident" id="6158419">nil</span><br>
<span class="lineno"></span><span class="op" id="6158423">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6158426">func</span>&nbsp;<span class="ident" id="6158431">isSpace</span><span class="op" id="6158438">(</span><span class="ident" id="6158439">b</span>&nbsp;<span class="builtintype" id="6158441">byte</span><span class="op" id="6158445">)</span>&nbsp;<span class="builtintype" id="6158447">bool</span>&nbsp;<span class="op" id="6158452">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6158455">return</span>&nbsp;<span class="ident" id="6158462">b</span>&nbsp;<span class="op" id="6158464">==</span>&nbsp;<span class="string" id="6158467">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="6158471">||</span>&nbsp;<span class="ident" id="6158474">b</span>&nbsp;<span class="op" id="6158476">==</span>&nbsp;<span class="string" id="6158479">&#39;\t&#39;</span>&nbsp;<span class="op" id="6158484">||</span>&nbsp;<span class="ident" id="6158487">b</span>&nbsp;<span class="op" id="6158489">==</span>&nbsp;<span class="string" id="6158492">&#39;\n&#39;</span>&nbsp;<span class="op" id="6158497">||</span>&nbsp;<span class="ident" id="6158500">b</span>&nbsp;<span class="op" id="6158502">==</span>&nbsp;<span class="string" id="6158505">&#39;\r&#39;</span><br>
<span class="lineno"></span><span class="op" id="6158510">}</span>
</div>
</body>
</html>
