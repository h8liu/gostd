<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="7103989">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7104045">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7104099">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7104150">package</span>&nbsp;<span class="ident" id="7104158">textproto</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7104169">import</span>&nbsp;<span class="op" id="7104176">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7104179">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7104188">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7104197">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7104203">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7104214">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7104225">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7104235">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="7104238">type</span>&nbsp;<span class="ident" id="7104243">canonicalHeaderKeyTest</span>&nbsp;<span class="keyword" id="7104266">struct</span>&nbsp;<span class="op" id="7104273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7104276">in</span><span class="op" id="7104278">,</span>&nbsp;<span class="ident" id="7104280">out</span>&nbsp;<span class="builtintype" id="7104284">string</span><br>
<span class="lineno"></span><span class="op" id="7104291">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="7104294">var</span>&nbsp;<span class="ident" id="7104298">canonicalHeaderKeyTests</span>&nbsp;<span class="op" id="7104322">=</span>&nbsp;<span class="op" id="7104324">[</span><span class="op" id="7104325">]</span><span class="ident" id="7104326">canonicalHeaderKeyTest</span><span class="op" id="7104348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7104351">{</span><span class="string" id="7104352">&#34;a-b-c&#34;</span><span class="op" id="7104359">,</span>&nbsp;<span class="string" id="7104361">&#34;A-B-C&#34;</span><span class="op" id="7104368">}</span><span class="op" id="7104369">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7104372">{</span><span class="string" id="7104373">&#34;a-1-c&#34;</span><span class="op" id="7104380">,</span>&nbsp;<span class="string" id="7104382">&#34;A-1-C&#34;</span><span class="op" id="7104389">}</span><span class="op" id="7104390">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7104393">{</span><span class="string" id="7104394">&#34;User-Agent&#34;</span><span class="op" id="7104406">,</span>&nbsp;<span class="string" id="7104408">&#34;User-Agent&#34;</span><span class="op" id="7104420">}</span><span class="op" id="7104421">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7104424">{</span><span class="string" id="7104425">&#34;uSER-aGENT&#34;</span><span class="op" id="7104437">,</span>&nbsp;<span class="string" id="7104439">&#34;User-Agent&#34;</span><span class="op" id="7104451">}</span><span class="op" id="7104452">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7104455">{</span><span class="string" id="7104456">&#34;user-agent&#34;</span><span class="op" id="7104468">,</span>&nbsp;<span class="string" id="7104470">&#34;User-Agent&#34;</span><span class="op" id="7104482">}</span><span class="op" id="7104483">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7104486">{</span><span class="string" id="7104487">&#34;USER-AGENT&#34;</span><span class="op" id="7104499">,</span>&nbsp;<span class="string" id="7104501">&#34;User-Agent&#34;</span><span class="op" id="7104513">}</span><span class="op" id="7104514">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7104517">{</span><span class="string" id="7104518">&#34;üser-agenT&#34;</span><span class="op" id="7104531">,</span>&nbsp;<span class="string" id="7104533">&#34;üser-Agent&#34;</span><span class="op" id="7104546">}</span><span class="op" id="7104547">,</span>&nbsp;<span class="comment" id="7104549">//&nbsp;non-ASCII&nbsp;unchanged</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7104574">//&nbsp;This&nbsp;caused&nbsp;a&nbsp;panic&nbsp;due&nbsp;to&nbsp;mishandling&nbsp;of&nbsp;a&nbsp;space:</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7104629">{</span><span class="string" id="7104630">&#34;C&nbsp;Ontent-Transfer-Encoding&#34;</span><span class="op" id="7104658">,</span>&nbsp;<span class="string" id="7104660">&#34;C-Ontent-Transfer-Encoding&#34;</span><span class="op" id="7104688">}</span><span class="op" id="7104689">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7104692">{</span><span class="string" id="7104693">&#34;foo&nbsp;bar&#34;</span><span class="op" id="7104702">,</span>&nbsp;<span class="string" id="7104704">&#34;Foo-Bar&#34;</span><span class="op" id="7104713">}</span><span class="op" id="7104714">,</span><br>
<span class="lineno"></span><span class="op" id="7104716">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7104719">func</span>&nbsp;<span class="ident" id="7104724">TestCanonicalMIMEHeaderKey</span><span class="op" id="7104750">(</span><span class="ident" id="7104751">t</span>&nbsp;<span class="op" id="7104753">*</span><span class="ident" id="7104754">testing</span><span class="op" id="7104761">.</span><span class="ident" id="7104762">T</span><span class="op" id="7104763">)</span>&nbsp;<span class="op" id="7104765">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7104768">for</span>&nbsp;<span class="ident" id="7104772">_</span><span class="op" id="7104773">,</span>&nbsp;<span class="ident" id="7104775">tt</span>&nbsp;<span class="op" id="7104778">:=</span>&nbsp;<span class="keyword" id="7104781">range</span>&nbsp;<span class="ident" id="7104787">canonicalHeaderKeyTests</span>&nbsp;<span class="op" id="7104811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7104815">if</span>&nbsp;<span class="ident" id="7104818">s</span>&nbsp;<span class="op" id="7104820">:=</span>&nbsp;<span class="ident" id="7104823">CanonicalMIMEHeaderKey</span><span class="op" id="7104845">(</span><span class="ident" id="7104846">tt</span><span class="op" id="7104848">.</span><span class="ident" id="7104849">in</span><span class="op" id="7104851">)</span><span class="op" id="7104852">;</span>&nbsp;<span class="ident" id="7104854">s</span>&nbsp;<span class="op" id="7104856">!=</span>&nbsp;<span class="ident" id="7104859">tt</span><span class="op" id="7104861">.</span><span class="ident" id="7104862">out</span>&nbsp;<span class="op" id="7104866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7104871">t</span><span class="op" id="7104872">.</span><span class="ident" id="7104873">Errorf</span><span class="op" id="7104879">(</span><span class="string" id="7104880">&#34;CanonicalMIMEHeaderKey(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7104922">,</span>&nbsp;<span class="ident" id="7104924">tt</span><span class="op" id="7104926">.</span><span class="ident" id="7104927">in</span><span class="op" id="7104929">,</span>&nbsp;<span class="ident" id="7104931">s</span><span class="op" id="7104932">,</span>&nbsp;<span class="ident" id="7104934">tt</span><span class="op" id="7104936">.</span><span class="ident" id="7104937">out</span><span class="op" id="7104940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7104944">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7104947">}</span><br>
<span class="lineno">40</span><span class="op" id="7104949">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7104952">func</span>&nbsp;<span class="ident" id="7104957">reader</span><span class="op" id="7104963">(</span><span class="ident" id="7104964">s</span>&nbsp;<span class="builtintype" id="7104966">string</span><span class="op" id="7104972">)</span>&nbsp;<span class="op" id="7104974">*</span><span class="ident" id="7104975">Reader</span>&nbsp;<span class="op" id="7104982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7104985">return</span>&nbsp;<span class="ident" id="7104992">NewReader</span><span class="op" id="7105001">(</span><span class="ident" id="7105002">bufio</span><span class="op" id="7105007">.</span><span class="ident" id="7105008">NewReader</span><span class="op" id="7105017">(</span><span class="ident" id="7105018">strings</span><span class="op" id="7105025">.</span><span class="ident" id="7105026">NewReader</span><span class="op" id="7105035">(</span><span class="ident" id="7105036">s</span><span class="op" id="7105037">)</span><span class="op" id="7105038">)</span><span class="op" id="7105039">)</span><br>
<span class="lineno"></span><span class="op" id="7105041">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="7105044">func</span>&nbsp;<span class="ident" id="7105049">TestReadLine</span><span class="op" id="7105061">(</span><span class="ident" id="7105062">t</span>&nbsp;<span class="op" id="7105064">*</span><span class="ident" id="7105065">testing</span><span class="op" id="7105072">.</span><span class="ident" id="7105073">T</span><span class="op" id="7105074">)</span>&nbsp;<span class="op" id="7105076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7105079">r</span>&nbsp;<span class="op" id="7105081">:=</span>&nbsp;<span class="ident" id="7105084">reader</span><span class="op" id="7105090">(</span><span class="string" id="7105091">&#34;line1\nline2\n&#34;</span><span class="op" id="7105107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7105110">s</span><span class="op" id="7105111">,</span>&nbsp;<span class="ident" id="7105113">err</span>&nbsp;<span class="op" id="7105117">:=</span>&nbsp;<span class="ident" id="7105120">r</span><span class="op" id="7105121">.</span><span class="ident" id="7105122">ReadLine</span><span class="op" id="7105130">(</span><span class="op" id="7105131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7105134">if</span>&nbsp;<span class="ident" id="7105137">s</span>&nbsp;<span class="op" id="7105139">!=</span>&nbsp;<span class="string" id="7105142">&#34;line1&#34;</span>&nbsp;<span class="op" id="7105150">||</span>&nbsp;<span class="ident" id="7105153">err</span>&nbsp;<span class="op" id="7105157">!=</span>&nbsp;<span class="ident" id="7105160">nil</span>&nbsp;<span class="op" id="7105164">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7105168">t</span><span class="op" id="7105169">.</span><span class="ident" id="7105170">Fatalf</span><span class="op" id="7105176">(</span><span class="string" id="7105177">&#34;Line&nbsp;1:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="7105193">,</span>&nbsp;<span class="ident" id="7105195">s</span><span class="op" id="7105196">,</span>&nbsp;<span class="ident" id="7105198">err</span><span class="op" id="7105201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7105204">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7105207">s</span><span class="op" id="7105208">,</span>&nbsp;<span class="ident" id="7105210">err</span>&nbsp;<span class="op" id="7105214">=</span>&nbsp;<span class="ident" id="7105216">r</span><span class="op" id="7105217">.</span><span class="ident" id="7105218">ReadLine</span><span class="op" id="7105226">(</span><span class="op" id="7105227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7105230">if</span>&nbsp;<span class="ident" id="7105233">s</span>&nbsp;<span class="op" id="7105235">!=</span>&nbsp;<span class="string" id="7105238">&#34;line2&#34;</span>&nbsp;<span class="op" id="7105246">||</span>&nbsp;<span class="ident" id="7105249">err</span>&nbsp;<span class="op" id="7105253">!=</span>&nbsp;<span class="ident" id="7105256">nil</span>&nbsp;<span class="op" id="7105260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7105264">t</span><span class="op" id="7105265">.</span><span class="ident" id="7105266">Fatalf</span><span class="op" id="7105272">(</span><span class="string" id="7105273">&#34;Line&nbsp;2:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="7105289">,</span>&nbsp;<span class="ident" id="7105291">s</span><span class="op" id="7105292">,</span>&nbsp;<span class="ident" id="7105294">err</span><span class="op" id="7105297">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7105300">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7105303">s</span><span class="op" id="7105304">,</span>&nbsp;<span class="ident" id="7105306">err</span>&nbsp;<span class="op" id="7105310">=</span>&nbsp;<span class="ident" id="7105312">r</span><span class="op" id="7105313">.</span><span class="ident" id="7105314">ReadLine</span><span class="op" id="7105322">(</span><span class="op" id="7105323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7105326">if</span>&nbsp;<span class="ident" id="7105329">s</span>&nbsp;<span class="op" id="7105331">!=</span>&nbsp;<span class="string" id="7105334">&#34;&#34;</span>&nbsp;<span class="op" id="7105337">||</span>&nbsp;<span class="ident" id="7105340">err</span>&nbsp;<span class="op" id="7105344">!=</span>&nbsp;<span class="ident" id="7105347">io</span><span class="op" id="7105349">.</span><span class="ident" id="7105350">EOF</span>&nbsp;<span class="op" id="7105354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7105358">t</span><span class="op" id="7105359">.</span><span class="ident" id="7105360">Fatalf</span><span class="op" id="7105366">(</span><span class="string" id="7105367">&#34;EOF:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="7105380">,</span>&nbsp;<span class="ident" id="7105382">s</span><span class="op" id="7105383">,</span>&nbsp;<span class="ident" id="7105385">err</span><span class="op" id="7105388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7105391">}</span><br>
<span class="lineno">60</span><span class="op" id="7105393">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7105396">func</span>&nbsp;<span class="ident" id="7105401">TestReadContinuedLine</span><span class="op" id="7105422">(</span><span class="ident" id="7105423">t</span>&nbsp;<span class="op" id="7105425">*</span><span class="ident" id="7105426">testing</span><span class="op" id="7105433">.</span><span class="ident" id="7105434">T</span><span class="op" id="7105435">)</span>&nbsp;<span class="op" id="7105437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7105440">r</span>&nbsp;<span class="op" id="7105442">:=</span>&nbsp;<span class="ident" id="7105445">reader</span><span class="op" id="7105451">(</span><span class="string" id="7105452">&#34;line1\nline\n&nbsp;2\nline3\n&#34;</span><span class="op" id="7105478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7105481">s</span><span class="op" id="7105482">,</span>&nbsp;<span class="ident" id="7105484">err</span>&nbsp;<span class="op" id="7105488">:=</span>&nbsp;<span class="ident" id="7105491">r</span><span class="op" id="7105492">.</span><span class="ident" id="7105493">ReadContinuedLine</span><span class="op" id="7105510">(</span><span class="op" id="7105511">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7105514">if</span>&nbsp;<span class="ident" id="7105517">s</span>&nbsp;<span class="op" id="7105519">!=</span>&nbsp;<span class="string" id="7105522">&#34;line1&#34;</span>&nbsp;<span class="op" id="7105530">||</span>&nbsp;<span class="ident" id="7105533">err</span>&nbsp;<span class="op" id="7105537">!=</span>&nbsp;<span class="ident" id="7105540">nil</span>&nbsp;<span class="op" id="7105544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7105548">t</span><span class="op" id="7105549">.</span><span class="ident" id="7105550">Fatalf</span><span class="op" id="7105556">(</span><span class="string" id="7105557">&#34;Line&nbsp;1:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="7105573">,</span>&nbsp;<span class="ident" id="7105575">s</span><span class="op" id="7105576">,</span>&nbsp;<span class="ident" id="7105578">err</span><span class="op" id="7105581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7105584">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7105587">s</span><span class="op" id="7105588">,</span>&nbsp;<span class="ident" id="7105590">err</span>&nbsp;<span class="op" id="7105594">=</span>&nbsp;<span class="ident" id="7105596">r</span><span class="op" id="7105597">.</span><span class="ident" id="7105598">ReadContinuedLine</span><span class="op" id="7105615">(</span><span class="op" id="7105616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7105619">if</span>&nbsp;<span class="ident" id="7105622">s</span>&nbsp;<span class="op" id="7105624">!=</span>&nbsp;<span class="string" id="7105627">&#34;line&nbsp;2&#34;</span>&nbsp;<span class="op" id="7105636">||</span>&nbsp;<span class="ident" id="7105639">err</span>&nbsp;<span class="op" id="7105643">!=</span>&nbsp;<span class="ident" id="7105646">nil</span>&nbsp;<span class="op" id="7105650">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7105654">t</span><span class="op" id="7105655">.</span><span class="ident" id="7105656">Fatalf</span><span class="op" id="7105662">(</span><span class="string" id="7105663">&#34;Line&nbsp;2:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="7105679">,</span>&nbsp;<span class="ident" id="7105681">s</span><span class="op" id="7105682">,</span>&nbsp;<span class="ident" id="7105684">err</span><span class="op" id="7105687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7105690">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7105693">s</span><span class="op" id="7105694">,</span>&nbsp;<span class="ident" id="7105696">err</span>&nbsp;<span class="op" id="7105700">=</span>&nbsp;<span class="ident" id="7105702">r</span><span class="op" id="7105703">.</span><span class="ident" id="7105704">ReadContinuedLine</span><span class="op" id="7105721">(</span><span class="op" id="7105722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7105725">if</span>&nbsp;<span class="ident" id="7105728">s</span>&nbsp;<span class="op" id="7105730">!=</span>&nbsp;<span class="string" id="7105733">&#34;line3&#34;</span>&nbsp;<span class="op" id="7105741">||</span>&nbsp;<span class="ident" id="7105744">err</span>&nbsp;<span class="op" id="7105748">!=</span>&nbsp;<span class="ident" id="7105751">nil</span>&nbsp;<span class="op" id="7105755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7105759">t</span><span class="op" id="7105760">.</span><span class="ident" id="7105761">Fatalf</span><span class="op" id="7105767">(</span><span class="string" id="7105768">&#34;Line&nbsp;3:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="7105784">,</span>&nbsp;<span class="ident" id="7105786">s</span><span class="op" id="7105787">,</span>&nbsp;<span class="ident" id="7105789">err</span><span class="op" id="7105792">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7105795">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7105798">s</span><span class="op" id="7105799">,</span>&nbsp;<span class="ident" id="7105801">err</span>&nbsp;<span class="op" id="7105805">=</span>&nbsp;<span class="ident" id="7105807">r</span><span class="op" id="7105808">.</span><span class="ident" id="7105809">ReadContinuedLine</span><span class="op" id="7105826">(</span><span class="op" id="7105827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7105830">if</span>&nbsp;<span class="ident" id="7105833">s</span>&nbsp;<span class="op" id="7105835">!=</span>&nbsp;<span class="string" id="7105838">&#34;&#34;</span>&nbsp;<span class="op" id="7105841">||</span>&nbsp;<span class="ident" id="7105844">err</span>&nbsp;<span class="op" id="7105848">!=</span>&nbsp;<span class="ident" id="7105851">io</span><span class="op" id="7105853">.</span><span class="ident" id="7105854">EOF</span>&nbsp;<span class="op" id="7105858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7105862">t</span><span class="op" id="7105863">.</span><span class="ident" id="7105864">Fatalf</span><span class="op" id="7105870">(</span><span class="string" id="7105871">&#34;EOF:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="7105884">,</span>&nbsp;<span class="ident" id="7105886">s</span><span class="op" id="7105887">,</span>&nbsp;<span class="ident" id="7105889">err</span><span class="op" id="7105892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7105895">}</span><br>
<span class="lineno">80</span><span class="op" id="7105897">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7105900">func</span>&nbsp;<span class="ident" id="7105905">TestReadCodeLine</span><span class="op" id="7105921">(</span><span class="ident" id="7105922">t</span>&nbsp;<span class="op" id="7105924">*</span><span class="ident" id="7105925">testing</span><span class="op" id="7105932">.</span><span class="ident" id="7105933">T</span><span class="op" id="7105934">)</span>&nbsp;<span class="op" id="7105936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7105939">r</span>&nbsp;<span class="op" id="7105941">:=</span>&nbsp;<span class="ident" id="7105944">reader</span><span class="op" id="7105950">(</span><span class="string" id="7105951">&#34;123&nbsp;hi\n234&nbsp;bye\n345&nbsp;no&nbsp;way\n&#34;</span><span class="op" id="7105982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7105985">code</span><span class="op" id="7105989">,</span>&nbsp;<span class="ident" id="7105991">msg</span><span class="op" id="7105994">,</span>&nbsp;<span class="ident" id="7105996">err</span>&nbsp;<span class="op" id="7106000">:=</span>&nbsp;<span class="ident" id="7106003">r</span><span class="op" id="7106004">.</span><span class="ident" id="7106005">ReadCodeLine</span><span class="op" id="7106017">(</span><span class="num" id="7106018">0</span><span class="op" id="7106019">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7106022">if</span>&nbsp;<span class="ident" id="7106025">code</span>&nbsp;<span class="op" id="7106030">!=</span>&nbsp;<span class="num" id="7106033">123</span>&nbsp;<span class="op" id="7106037">||</span>&nbsp;<span class="ident" id="7106040">msg</span>&nbsp;<span class="op" id="7106044">!=</span>&nbsp;<span class="string" id="7106047">&#34;hi&#34;</span>&nbsp;<span class="op" id="7106052">||</span>&nbsp;<span class="ident" id="7106055">err</span>&nbsp;<span class="op" id="7106059">!=</span>&nbsp;<span class="ident" id="7106062">nil</span>&nbsp;<span class="op" id="7106066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7106070">t</span><span class="op" id="7106071">.</span><span class="ident" id="7106072">Fatalf</span><span class="op" id="7106078">(</span><span class="string" id="7106079">&#34;Line&nbsp;1:&nbsp;%d,&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="7106099">,</span>&nbsp;<span class="ident" id="7106101">code</span><span class="op" id="7106105">,</span>&nbsp;<span class="ident" id="7106107">msg</span><span class="op" id="7106110">,</span>&nbsp;<span class="ident" id="7106112">err</span><span class="op" id="7106115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7106118">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7106121">code</span><span class="op" id="7106125">,</span>&nbsp;<span class="ident" id="7106127">msg</span><span class="op" id="7106130">,</span>&nbsp;<span class="ident" id="7106132">err</span>&nbsp;<span class="op" id="7106136">=</span>&nbsp;<span class="ident" id="7106138">r</span><span class="op" id="7106139">.</span><span class="ident" id="7106140">ReadCodeLine</span><span class="op" id="7106152">(</span><span class="num" id="7106153">23</span><span class="op" id="7106155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7106158">if</span>&nbsp;<span class="ident" id="7106161">code</span>&nbsp;<span class="op" id="7106166">!=</span>&nbsp;<span class="num" id="7106169">234</span>&nbsp;<span class="op" id="7106173">||</span>&nbsp;<span class="ident" id="7106176">msg</span>&nbsp;<span class="op" id="7106180">!=</span>&nbsp;<span class="string" id="7106183">&#34;bye&#34;</span>&nbsp;<span class="op" id="7106189">||</span>&nbsp;<span class="ident" id="7106192">err</span>&nbsp;<span class="op" id="7106196">!=</span>&nbsp;<span class="ident" id="7106199">nil</span>&nbsp;<span class="op" id="7106203">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7106207">t</span><span class="op" id="7106208">.</span><span class="ident" id="7106209">Fatalf</span><span class="op" id="7106215">(</span><span class="string" id="7106216">&#34;Line&nbsp;2:&nbsp;%d,&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="7106236">,</span>&nbsp;<span class="ident" id="7106238">code</span><span class="op" id="7106242">,</span>&nbsp;<span class="ident" id="7106244">msg</span><span class="op" id="7106247">,</span>&nbsp;<span class="ident" id="7106249">err</span><span class="op" id="7106252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7106255">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7106258">code</span><span class="op" id="7106262">,</span>&nbsp;<span class="ident" id="7106264">msg</span><span class="op" id="7106267">,</span>&nbsp;<span class="ident" id="7106269">err</span>&nbsp;<span class="op" id="7106273">=</span>&nbsp;<span class="ident" id="7106275">r</span><span class="op" id="7106276">.</span><span class="ident" id="7106277">ReadCodeLine</span><span class="op" id="7106289">(</span><span class="num" id="7106290">346</span><span class="op" id="7106293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7106296">if</span>&nbsp;<span class="ident" id="7106299">code</span>&nbsp;<span class="op" id="7106304">!=</span>&nbsp;<span class="num" id="7106307">345</span>&nbsp;<span class="op" id="7106311">||</span>&nbsp;<span class="ident" id="7106314">msg</span>&nbsp;<span class="op" id="7106318">!=</span>&nbsp;<span class="string" id="7106321">&#34;no&nbsp;way&#34;</span>&nbsp;<span class="op" id="7106330">||</span>&nbsp;<span class="ident" id="7106333">err</span>&nbsp;<span class="op" id="7106337">==</span>&nbsp;<span class="ident" id="7106340">nil</span>&nbsp;<span class="op" id="7106344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7106348">t</span><span class="op" id="7106349">.</span><span class="ident" id="7106350">Fatalf</span><span class="op" id="7106356">(</span><span class="string" id="7106357">&#34;Line&nbsp;3:&nbsp;%d,&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="7106377">,</span>&nbsp;<span class="ident" id="7106379">code</span><span class="op" id="7106383">,</span>&nbsp;<span class="ident" id="7106385">msg</span><span class="op" id="7106388">,</span>&nbsp;<span class="ident" id="7106390">err</span><span class="op" id="7106393">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7106396">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7106399">if</span>&nbsp;<span class="ident" id="7106402">e</span><span class="op" id="7106403">,</span>&nbsp;<span class="ident" id="7106405">ok</span>&nbsp;<span class="op" id="7106408">:=</span>&nbsp;<span class="ident" id="7106411">err</span><span class="op" id="7106414">.</span><span class="op" id="7106415">(</span><span class="op" id="7106416">*</span><span class="ident" id="7106417">Error</span><span class="op" id="7106422">)</span><span class="op" id="7106423">;</span>&nbsp;<span class="op" id="7106425">!</span><span class="ident" id="7106426">ok</span>&nbsp;<span class="op" id="7106429">||</span>&nbsp;<span class="ident" id="7106432">e</span><span class="op" id="7106433">.</span><span class="ident" id="7106434">Code</span>&nbsp;<span class="op" id="7106439">!=</span>&nbsp;<span class="ident" id="7106442">code</span>&nbsp;<span class="op" id="7106447">||</span>&nbsp;<span class="ident" id="7106450">e</span><span class="op" id="7106451">.</span><span class="ident" id="7106452">Msg</span>&nbsp;<span class="op" id="7106456">!=</span>&nbsp;<span class="ident" id="7106459">msg</span>&nbsp;<span class="op" id="7106463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7106467">t</span><span class="op" id="7106468">.</span><span class="ident" id="7106469">Fatalf</span><span class="op" id="7106475">(</span><span class="string" id="7106476">&#34;Line&nbsp;3:&nbsp;wrong&nbsp;error&nbsp;%v\n&#34;</span><span class="op" id="7106502">,</span>&nbsp;<span class="ident" id="7106504">err</span><span class="op" id="7106507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7106510">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7106513">code</span><span class="op" id="7106517">,</span>&nbsp;<span class="ident" id="7106519">msg</span><span class="op" id="7106522">,</span>&nbsp;<span class="ident" id="7106524">err</span>&nbsp;<span class="op" id="7106528">=</span>&nbsp;<span class="ident" id="7106530">r</span><span class="op" id="7106531">.</span><span class="ident" id="7106532">ReadCodeLine</span><span class="op" id="7106544">(</span><span class="num" id="7106545">1</span><span class="op" id="7106546">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7106549">if</span>&nbsp;<span class="ident" id="7106552">code</span>&nbsp;<span class="op" id="7106557">!=</span>&nbsp;<span class="num" id="7106560">0</span>&nbsp;<span class="op" id="7106562">||</span>&nbsp;<span class="ident" id="7106565">msg</span>&nbsp;<span class="op" id="7106569">!=</span>&nbsp;<span class="string" id="7106572">&#34;&#34;</span>&nbsp;<span class="op" id="7106575">||</span>&nbsp;<span class="ident" id="7106578">err</span>&nbsp;<span class="op" id="7106582">!=</span>&nbsp;<span class="ident" id="7106585">io</span><span class="op" id="7106587">.</span><span class="ident" id="7106588">EOF</span>&nbsp;<span class="op" id="7106592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7106596">t</span><span class="op" id="7106597">.</span><span class="ident" id="7106598">Fatalf</span><span class="op" id="7106604">(</span><span class="string" id="7106605">&#34;EOF:&nbsp;%d,&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="7106622">,</span>&nbsp;<span class="ident" id="7106624">code</span><span class="op" id="7106628">,</span>&nbsp;<span class="ident" id="7106630">msg</span><span class="op" id="7106633">,</span>&nbsp;<span class="ident" id="7106635">err</span><span class="op" id="7106638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7106641">}</span><br>
<span class="lineno"></span><span class="op" id="7106643">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="keyword" id="7106646">func</span>&nbsp;<span class="ident" id="7106651">TestReadDotLines</span><span class="op" id="7106667">(</span><span class="ident" id="7106668">t</span>&nbsp;<span class="op" id="7106670">*</span><span class="ident" id="7106671">testing</span><span class="op" id="7106678">.</span><span class="ident" id="7106679">T</span><span class="op" id="7106680">)</span>&nbsp;<span class="op" id="7106682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7106685">r</span>&nbsp;<span class="op" id="7106687">:=</span>&nbsp;<span class="ident" id="7106690">reader</span><span class="op" id="7106696">(</span><span class="string" id="7106697">&#34;dotlines\r\n.foo\r\n..bar\n...baz\nquux\r\n\r\n.\r\nanother\n&#34;</span><span class="op" id="7106760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7106763">s</span><span class="op" id="7106764">,</span>&nbsp;<span class="ident" id="7106766">err</span>&nbsp;<span class="op" id="7106770">:=</span>&nbsp;<span class="ident" id="7106773">r</span><span class="op" id="7106774">.</span><span class="ident" id="7106775">ReadDotLines</span><span class="op" id="7106787">(</span><span class="op" id="7106788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7106791">want</span>&nbsp;<span class="op" id="7106796">:=</span>&nbsp;<span class="op" id="7106799">[</span><span class="op" id="7106800">]</span><span class="builtintype" id="7106801">string</span><span class="op" id="7106807">{</span><span class="string" id="7106808">&#34;dotlines&#34;</span><span class="op" id="7106818">,</span>&nbsp;<span class="string" id="7106820">&#34;foo&#34;</span><span class="op" id="7106825">,</span>&nbsp;<span class="string" id="7106827">&#34;.bar&#34;</span><span class="op" id="7106833">,</span>&nbsp;<span class="string" id="7106835">&#34;..baz&#34;</span><span class="op" id="7106842">,</span>&nbsp;<span class="string" id="7106844">&#34;quux&#34;</span><span class="op" id="7106850">,</span>&nbsp;<span class="string" id="7106852">&#34;&#34;</span><span class="op" id="7106854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7106857">if</span>&nbsp;<span class="op" id="7106860">!</span><span class="ident" id="7106861">reflect</span><span class="op" id="7106868">.</span><span class="ident" id="7106869">DeepEqual</span><span class="op" id="7106878">(</span><span class="ident" id="7106879">s</span><span class="op" id="7106880">,</span>&nbsp;<span class="ident" id="7106882">want</span><span class="op" id="7106886">)</span>&nbsp;<span class="op" id="7106888">||</span>&nbsp;<span class="ident" id="7106891">err</span>&nbsp;<span class="op" id="7106895">!=</span>&nbsp;<span class="ident" id="7106898">nil</span>&nbsp;<span class="op" id="7106902">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7106906">t</span><span class="op" id="7106907">.</span><span class="ident" id="7106908">Fatalf</span><span class="op" id="7106914">(</span><span class="string" id="7106915">&#34;ReadDotLines:&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="7106937">,</span>&nbsp;<span class="ident" id="7106939">s</span><span class="op" id="7106940">,</span>&nbsp;<span class="ident" id="7106942">err</span><span class="op" id="7106945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7106948">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7106952">s</span><span class="op" id="7106953">,</span>&nbsp;<span class="ident" id="7106955">err</span>&nbsp;<span class="op" id="7106959">=</span>&nbsp;<span class="ident" id="7106961">r</span><span class="op" id="7106962">.</span><span class="ident" id="7106963">ReadDotLines</span><span class="op" id="7106975">(</span><span class="op" id="7106976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7106979">want</span>&nbsp;<span class="op" id="7106984">=</span>&nbsp;<span class="op" id="7106986">[</span><span class="op" id="7106987">]</span><span class="builtintype" id="7106988">string</span><span class="op" id="7106994">{</span><span class="string" id="7106995">&#34;another&#34;</span><span class="op" id="7107004">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7107007">if</span>&nbsp;<span class="op" id="7107010">!</span><span class="ident" id="7107011">reflect</span><span class="op" id="7107018">.</span><span class="ident" id="7107019">DeepEqual</span><span class="op" id="7107028">(</span><span class="ident" id="7107029">s</span><span class="op" id="7107030">,</span>&nbsp;<span class="ident" id="7107032">want</span><span class="op" id="7107036">)</span>&nbsp;<span class="op" id="7107038">||</span>&nbsp;<span class="ident" id="7107041">err</span>&nbsp;<span class="op" id="7107045">!=</span>&nbsp;<span class="ident" id="7107048">io</span><span class="op" id="7107050">.</span><span class="ident" id="7107051">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="7107068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7107072">t</span><span class="op" id="7107073">.</span><span class="ident" id="7107074">Fatalf</span><span class="op" id="7107080">(</span><span class="string" id="7107081">&#34;ReadDotLines2:&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="7107104">,</span>&nbsp;<span class="ident" id="7107106">s</span><span class="op" id="7107107">,</span>&nbsp;<span class="ident" id="7107109">err</span><span class="op" id="7107112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7107115">}</span><br>
<span class="lineno"></span><span class="op" id="7107117">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="keyword" id="7107120">func</span>&nbsp;<span class="ident" id="7107125">TestReadDotBytes</span><span class="op" id="7107141">(</span><span class="ident" id="7107142">t</span>&nbsp;<span class="op" id="7107144">*</span><span class="ident" id="7107145">testing</span><span class="op" id="7107152">.</span><span class="ident" id="7107153">T</span><span class="op" id="7107154">)</span>&nbsp;<span class="op" id="7107156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7107159">r</span>&nbsp;<span class="op" id="7107161">:=</span>&nbsp;<span class="ident" id="7107164">reader</span><span class="op" id="7107170">(</span><span class="string" id="7107171">&#34;dotlines\r\n.foo\r\n..bar\n...baz\nquux\r\n\r\n.\r\nanot.her\r\n&#34;</span><span class="op" id="7107237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7107240">b</span><span class="op" id="7107241">,</span>&nbsp;<span class="ident" id="7107243">err</span>&nbsp;<span class="op" id="7107247">:=</span>&nbsp;<span class="ident" id="7107250">r</span><span class="op" id="7107251">.</span><span class="ident" id="7107252">ReadDotBytes</span><span class="op" id="7107264">(</span><span class="op" id="7107265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7107268">want</span>&nbsp;<span class="op" id="7107273">:=</span>&nbsp;<span class="op" id="7107276">[</span><span class="op" id="7107277">]</span><span class="builtintype" id="7107278">byte</span><span class="op" id="7107282">(</span><span class="string" id="7107283">&#34;dotlines\nfoo\n.bar\n..baz\nquux\n\n&#34;</span><span class="op" id="7107321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7107324">if</span>&nbsp;<span class="op" id="7107327">!</span><span class="ident" id="7107328">reflect</span><span class="op" id="7107335">.</span><span class="ident" id="7107336">DeepEqual</span><span class="op" id="7107345">(</span><span class="ident" id="7107346">b</span><span class="op" id="7107347">,</span>&nbsp;<span class="ident" id="7107349">want</span><span class="op" id="7107353">)</span>&nbsp;<span class="op" id="7107355">||</span>&nbsp;<span class="ident" id="7107358">err</span>&nbsp;<span class="op" id="7107362">!=</span>&nbsp;<span class="ident" id="7107365">nil</span>&nbsp;<span class="op" id="7107369">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7107373">t</span><span class="op" id="7107374">.</span><span class="ident" id="7107375">Fatalf</span><span class="op" id="7107381">(</span><span class="string" id="7107382">&#34;ReadDotBytes:&nbsp;%q,&nbsp;%v&#34;</span><span class="op" id="7107404">,</span>&nbsp;<span class="ident" id="7107406">b</span><span class="op" id="7107407">,</span>&nbsp;<span class="ident" id="7107409">err</span><span class="op" id="7107412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7107415">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7107419">b</span><span class="op" id="7107420">,</span>&nbsp;<span class="ident" id="7107422">err</span>&nbsp;<span class="op" id="7107426">=</span>&nbsp;<span class="ident" id="7107428">r</span><span class="op" id="7107429">.</span><span class="ident" id="7107430">ReadDotBytes</span><span class="op" id="7107442">(</span><span class="op" id="7107443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7107446">want</span>&nbsp;<span class="op" id="7107451">=</span>&nbsp;<span class="op" id="7107453">[</span><span class="op" id="7107454">]</span><span class="builtintype" id="7107455">byte</span><span class="op" id="7107459">(</span><span class="string" id="7107460">&#34;anot.her\n&#34;</span><span class="op" id="7107472">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7107475">if</span>&nbsp;<span class="op" id="7107478">!</span><span class="ident" id="7107479">reflect</span><span class="op" id="7107486">.</span><span class="ident" id="7107487">DeepEqual</span><span class="op" id="7107496">(</span><span class="ident" id="7107497">b</span><span class="op" id="7107498">,</span>&nbsp;<span class="ident" id="7107500">want</span><span class="op" id="7107504">)</span>&nbsp;<span class="op" id="7107506">||</span>&nbsp;<span class="ident" id="7107509">err</span>&nbsp;<span class="op" id="7107513">!=</span>&nbsp;<span class="ident" id="7107516">io</span><span class="op" id="7107518">.</span><span class="ident" id="7107519">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="7107536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7107540">t</span><span class="op" id="7107541">.</span><span class="ident" id="7107542">Fatalf</span><span class="op" id="7107548">(</span><span class="string" id="7107549">&#34;ReadDotBytes2:&nbsp;%q,&nbsp;%v&#34;</span><span class="op" id="7107572">,</span>&nbsp;<span class="ident" id="7107574">b</span><span class="op" id="7107575">,</span>&nbsp;<span class="ident" id="7107577">err</span><span class="op" id="7107580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7107583">}</span><br>
<span class="lineno"></span><span class="op" id="7107585">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="keyword" id="7107588">func</span>&nbsp;<span class="ident" id="7107593">TestReadMIMEHeader</span><span class="op" id="7107611">(</span><span class="ident" id="7107612">t</span>&nbsp;<span class="op" id="7107614">*</span><span class="ident" id="7107615">testing</span><span class="op" id="7107622">.</span><span class="ident" id="7107623">T</span><span class="op" id="7107624">)</span>&nbsp;<span class="op" id="7107626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7107629">r</span>&nbsp;<span class="op" id="7107631">:=</span>&nbsp;<span class="ident" id="7107634">reader</span><span class="op" id="7107640">(</span><span class="string" id="7107641">&#34;my-key:&nbsp;Value&nbsp;1&nbsp;&nbsp;\r\nLong-key:&nbsp;Even&nbsp;\n&nbsp;Longer&nbsp;Value\r\nmy-Key:&nbsp;Value&nbsp;2\r\n\n&#34;</span><span class="op" id="7107719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7107722">m</span><span class="op" id="7107723">,</span>&nbsp;<span class="ident" id="7107725">err</span>&nbsp;<span class="op" id="7107729">:=</span>&nbsp;<span class="ident" id="7107732">r</span><span class="op" id="7107733">.</span><span class="ident" id="7107734">ReadMIMEHeader</span><span class="op" id="7107748">(</span><span class="op" id="7107749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7107752">want</span>&nbsp;<span class="op" id="7107757">:=</span>&nbsp;<span class="ident" id="7107760">MIMEHeader</span><span class="op" id="7107770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7107774">&#34;My-Key&#34;</span><span class="op" id="7107782">:</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7107786">{</span><span class="string" id="7107787">&#34;Value&nbsp;1&#34;</span><span class="op" id="7107796">,</span>&nbsp;<span class="string" id="7107798">&#34;Value&nbsp;2&#34;</span><span class="op" id="7107807">}</span><span class="op" id="7107808">,</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7107812">&#34;Long-Key&#34;</span><span class="op" id="7107822">:</span>&nbsp;<span class="op" id="7107824">{</span><span class="string" id="7107825">&#34;Even&nbsp;Longer&nbsp;Value&#34;</span><span class="op" id="7107844">}</span><span class="op" id="7107845">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7107848">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7107851">if</span>&nbsp;<span class="op" id="7107854">!</span><span class="ident" id="7107855">reflect</span><span class="op" id="7107862">.</span><span class="ident" id="7107863">DeepEqual</span><span class="op" id="7107872">(</span><span class="ident" id="7107873">m</span><span class="op" id="7107874">,</span>&nbsp;<span class="ident" id="7107876">want</span><span class="op" id="7107880">)</span>&nbsp;<span class="op" id="7107882">||</span>&nbsp;<span class="ident" id="7107885">err</span>&nbsp;<span class="op" id="7107889">!=</span>&nbsp;<span class="ident" id="7107892">nil</span>&nbsp;<span class="op" id="7107896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7107900">t</span><span class="op" id="7107901">.</span><span class="ident" id="7107902">Fatalf</span><span class="op" id="7107908">(</span><span class="string" id="7107909">&#34;ReadMIMEHeader:&nbsp;%v,&nbsp;%v;&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7107942">,</span>&nbsp;<span class="ident" id="7107944">m</span><span class="op" id="7107945">,</span>&nbsp;<span class="ident" id="7107947">err</span><span class="op" id="7107950">,</span>&nbsp;<span class="ident" id="7107952">want</span><span class="op" id="7107956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7107959">}</span><br>
<span class="lineno">145</span><span class="op" id="7107961">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7107964">func</span>&nbsp;<span class="ident" id="7107969">TestReadMIMEHeaderSingle</span><span class="op" id="7107993">(</span><span class="ident" id="7107994">t</span>&nbsp;<span class="op" id="7107996">*</span><span class="ident" id="7107997">testing</span><span class="op" id="7108004">.</span><span class="ident" id="7108005">T</span><span class="op" id="7108006">)</span>&nbsp;<span class="op" id="7108008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7108011">r</span>&nbsp;<span class="op" id="7108013">:=</span>&nbsp;<span class="ident" id="7108016">reader</span><span class="op" id="7108022">(</span><span class="string" id="7108023">&#34;Foo:&nbsp;bar\n\n&#34;</span><span class="op" id="7108037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7108040">m</span><span class="op" id="7108041">,</span>&nbsp;<span class="ident" id="7108043">err</span>&nbsp;<span class="op" id="7108047">:=</span>&nbsp;<span class="ident" id="7108050">r</span><span class="op" id="7108051">.</span><span class="ident" id="7108052">ReadMIMEHeader</span><span class="op" id="7108066">(</span><span class="op" id="7108067">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7108070">want</span>&nbsp;<span class="op" id="7108075">:=</span>&nbsp;<span class="ident" id="7108078">MIMEHeader</span><span class="op" id="7108088">{</span><span class="string" id="7108089">&#34;Foo&#34;</span><span class="op" id="7108094">:</span>&nbsp;<span class="op" id="7108096">{</span><span class="string" id="7108097">&#34;bar&#34;</span><span class="op" id="7108102">}</span><span class="op" id="7108103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7108106">if</span>&nbsp;<span class="op" id="7108109">!</span><span class="ident" id="7108110">reflect</span><span class="op" id="7108117">.</span><span class="ident" id="7108118">DeepEqual</span><span class="op" id="7108127">(</span><span class="ident" id="7108128">m</span><span class="op" id="7108129">,</span>&nbsp;<span class="ident" id="7108131">want</span><span class="op" id="7108135">)</span>&nbsp;<span class="op" id="7108137">||</span>&nbsp;<span class="ident" id="7108140">err</span>&nbsp;<span class="op" id="7108144">!=</span>&nbsp;<span class="ident" id="7108147">nil</span>&nbsp;<span class="op" id="7108151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7108155">t</span><span class="op" id="7108156">.</span><span class="ident" id="7108157">Fatalf</span><span class="op" id="7108163">(</span><span class="string" id="7108164">&#34;ReadMIMEHeader:&nbsp;%v,&nbsp;%v;&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7108197">,</span>&nbsp;<span class="ident" id="7108199">m</span><span class="op" id="7108200">,</span>&nbsp;<span class="ident" id="7108202">err</span><span class="op" id="7108205">,</span>&nbsp;<span class="ident" id="7108207">want</span><span class="op" id="7108211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7108214">}</span><br>
<span class="lineno"></span><span class="op" id="7108216">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="keyword" id="7108219">func</span>&nbsp;<span class="ident" id="7108224">TestLargeReadMIMEHeader</span><span class="op" id="7108247">(</span><span class="ident" id="7108248">t</span>&nbsp;<span class="op" id="7108250">*</span><span class="ident" id="7108251">testing</span><span class="op" id="7108258">.</span><span class="ident" id="7108259">T</span><span class="op" id="7108260">)</span>&nbsp;<span class="op" id="7108262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7108265">data</span>&nbsp;<span class="op" id="7108270">:=</span>&nbsp;<span class="builtinfunc" id="7108273">make</span><span class="op" id="7108277">(</span><span class="op" id="7108278">[</span><span class="op" id="7108279">]</span><span class="builtintype" id="7108280">byte</span><span class="op" id="7108284">,</span>&nbsp;<span class="num" id="7108286">16</span><span class="op" id="7108288">*</span><span class="num" id="7108289">1024</span><span class="op" id="7108293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7108296">for</span>&nbsp;<span class="ident" id="7108300">i</span>&nbsp;<span class="op" id="7108302">:=</span>&nbsp;<span class="num" id="7108305">0</span><span class="op" id="7108306">;</span>&nbsp;<span class="ident" id="7108308">i</span>&nbsp;<span class="op" id="7108310">&lt;</span>&nbsp;<span class="builtinfunc" id="7108312">len</span><span class="op" id="7108315">(</span><span class="ident" id="7108316">data</span><span class="op" id="7108320">)</span><span class="op" id="7108321">;</span>&nbsp;<span class="ident" id="7108323">i</span><span class="op" id="7108324">++</span>&nbsp;<span class="op" id="7108327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7108331">data</span><span class="op" id="7108335">[</span><span class="ident" id="7108336">i</span><span class="op" id="7108337">]</span>&nbsp;<span class="op" id="7108339">=</span>&nbsp;<span class="string" id="7108341">&#39;x&#39;</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7108346">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7108349">sdata</span>&nbsp;<span class="op" id="7108355">:=</span>&nbsp;<span class="builtintype" id="7108358">string</span><span class="op" id="7108364">(</span><span class="ident" id="7108365">data</span><span class="op" id="7108369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7108372">r</span>&nbsp;<span class="op" id="7108374">:=</span>&nbsp;<span class="ident" id="7108377">reader</span><span class="op" id="7108383">(</span><span class="string" id="7108384">&#34;Cookie:&nbsp;&#34;</span>&nbsp;<span class="op" id="7108395">+</span>&nbsp;<span class="ident" id="7108397">sdata</span>&nbsp;<span class="op" id="7108403">+</span>&nbsp;<span class="string" id="7108405">&#34;\r\n\n&#34;</span><span class="op" id="7108413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7108416">m</span><span class="op" id="7108417">,</span>&nbsp;<span class="ident" id="7108419">err</span>&nbsp;<span class="op" id="7108423">:=</span>&nbsp;<span class="ident" id="7108426">r</span><span class="op" id="7108427">.</span><span class="ident" id="7108428">ReadMIMEHeader</span><span class="op" id="7108442">(</span><span class="op" id="7108443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7108446">if</span>&nbsp;<span class="ident" id="7108449">err</span>&nbsp;<span class="op" id="7108453">!=</span>&nbsp;<span class="ident" id="7108456">nil</span>&nbsp;<span class="op" id="7108460">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7108464">t</span><span class="op" id="7108465">.</span><span class="ident" id="7108466">Fatalf</span><span class="op" id="7108472">(</span><span class="string" id="7108473">&#34;ReadMIMEHeader:&nbsp;%v&#34;</span><span class="op" id="7108493">,</span>&nbsp;<span class="ident" id="7108495">err</span><span class="op" id="7108498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7108501">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7108504">cookie</span>&nbsp;<span class="op" id="7108511">:=</span>&nbsp;<span class="ident" id="7108514">m</span><span class="op" id="7108515">.</span><span class="ident" id="7108516">Get</span><span class="op" id="7108519">(</span><span class="string" id="7108520">&#34;Cookie&#34;</span><span class="op" id="7108528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7108531">if</span>&nbsp;<span class="ident" id="7108534">cookie</span>&nbsp;<span class="op" id="7108541">!=</span>&nbsp;<span class="ident" id="7108544">sdata</span>&nbsp;<span class="op" id="7108550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7108554">t</span><span class="op" id="7108555">.</span><span class="ident" id="7108556">Fatalf</span><span class="op" id="7108562">(</span><span class="string" id="7108563">&#34;ReadMIMEHeader:&nbsp;%v&nbsp;bytes,&nbsp;want&nbsp;%v&nbsp;bytes&#34;</span><span class="op" id="7108604">,</span>&nbsp;<span class="builtinfunc" id="7108606">len</span><span class="op" id="7108609">(</span><span class="ident" id="7108610">cookie</span><span class="op" id="7108616">)</span><span class="op" id="7108617">,</span>&nbsp;<span class="builtinfunc" id="7108619">len</span><span class="op" id="7108622">(</span><span class="ident" id="7108623">sdata</span><span class="op" id="7108628">)</span><span class="op" id="7108629">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7108632">}</span><br>
<span class="lineno"></span><span class="op" id="7108634">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7108637">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;read&nbsp;slightly-bogus&nbsp;MIME&nbsp;headers&nbsp;seen&nbsp;in&nbsp;the&nbsp;wild,</span><br>
<span class="lineno"></span><span class="comment" id="7108704">//&nbsp;with&nbsp;spaces&nbsp;before&nbsp;colons,&nbsp;and&nbsp;spaces&nbsp;in&nbsp;keys.</span><br>
<span class="lineno">175</span><span class="keyword" id="7108754">func</span>&nbsp;<span class="ident" id="7108759">TestReadMIMEHeaderNonCompliant</span><span class="op" id="7108789">(</span><span class="ident" id="7108790">t</span>&nbsp;<span class="op" id="7108792">*</span><span class="ident" id="7108793">testing</span><span class="op" id="7108800">.</span><span class="ident" id="7108801">T</span><span class="op" id="7108802">)</span>&nbsp;<span class="op" id="7108804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7108807">//&nbsp;Invalid&nbsp;HTTP&nbsp;response&nbsp;header&nbsp;as&nbsp;sent&nbsp;by&nbsp;an&nbsp;Axis&nbsp;security</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7108868">//&nbsp;camera:&nbsp;(this&nbsp;is&nbsp;handled&nbsp;by&nbsp;IE,&nbsp;Firefox,&nbsp;Chrome,&nbsp;curl,&nbsp;etc.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7108933">r</span>&nbsp;<span class="op" id="7108935">:=</span>&nbsp;<span class="ident" id="7108938">reader</span><span class="op" id="7108944">(</span><span class="string" id="7108945">&#34;Foo:&nbsp;bar\r\n&#34;</span>&nbsp;<span class="op" id="7108960">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7108964">&#34;Content-Language:&nbsp;en\r\n&#34;</span>&nbsp;<span class="op" id="7108991">+</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7108995">&#34;SID&nbsp;:&nbsp;0\r\n&#34;</span>&nbsp;<span class="op" id="7109009">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7109013">&#34;Audio&nbsp;Mode&nbsp;:&nbsp;None\r\n&#34;</span>&nbsp;<span class="op" id="7109037">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7109041">&#34;Privilege&nbsp;:&nbsp;127\r\n\r\n&#34;</span><span class="op" id="7109066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7109069">m</span><span class="op" id="7109070">,</span>&nbsp;<span class="ident" id="7109072">err</span>&nbsp;<span class="op" id="7109076">:=</span>&nbsp;<span class="ident" id="7109079">r</span><span class="op" id="7109080">.</span><span class="ident" id="7109081">ReadMIMEHeader</span><span class="op" id="7109095">(</span><span class="op" id="7109096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7109099">want</span>&nbsp;<span class="op" id="7109104">:=</span>&nbsp;<span class="ident" id="7109107">MIMEHeader</span><span class="op" id="7109117">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7109121">&#34;Foo&#34;</span><span class="op" id="7109126">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7109141">{</span><span class="string" id="7109142">&#34;bar&#34;</span><span class="op" id="7109147">}</span><span class="op" id="7109148">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7109152">&#34;Content-Language&#34;</span><span class="op" id="7109170">:</span>&nbsp;<span class="op" id="7109172">{</span><span class="string" id="7109173">&#34;en&#34;</span><span class="op" id="7109177">}</span><span class="op" id="7109178">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7109182">&#34;Sid&#34;</span><span class="op" id="7109187">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7109202">{</span><span class="string" id="7109203">&#34;0&#34;</span><span class="op" id="7109206">}</span><span class="op" id="7109207">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7109211">&#34;Audio-Mode&#34;</span><span class="op" id="7109223">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7109231">{</span><span class="string" id="7109232">&#34;None&#34;</span><span class="op" id="7109238">}</span><span class="op" id="7109239">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7109243">&#34;Privilege&#34;</span><span class="op" id="7109254">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7109263">{</span><span class="string" id="7109264">&#34;127&#34;</span><span class="op" id="7109269">}</span><span class="op" id="7109270">,</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7109273">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7109276">if</span>&nbsp;<span class="op" id="7109279">!</span><span class="ident" id="7109280">reflect</span><span class="op" id="7109287">.</span><span class="ident" id="7109288">DeepEqual</span><span class="op" id="7109297">(</span><span class="ident" id="7109298">m</span><span class="op" id="7109299">,</span>&nbsp;<span class="ident" id="7109301">want</span><span class="op" id="7109305">)</span>&nbsp;<span class="op" id="7109307">||</span>&nbsp;<span class="ident" id="7109310">err</span>&nbsp;<span class="op" id="7109314">!=</span>&nbsp;<span class="ident" id="7109317">nil</span>&nbsp;<span class="op" id="7109321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7109325">t</span><span class="op" id="7109326">.</span><span class="ident" id="7109327">Fatalf</span><span class="op" id="7109333">(</span><span class="string" id="7109334">&#34;ReadMIMEHeader&nbsp;=\n%v,&nbsp;%v;&nbsp;want:\n%v&#34;</span><span class="op" id="7109371">,</span>&nbsp;<span class="ident" id="7109373">m</span><span class="op" id="7109374">,</span>&nbsp;<span class="ident" id="7109376">err</span><span class="op" id="7109379">,</span>&nbsp;<span class="ident" id="7109381">want</span><span class="op" id="7109385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7109388">}</span><br>
<span class="lineno"></span><span class="op" id="7109390">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="keyword" id="7109393">type</span>&nbsp;<span class="ident" id="7109398">readResponseTest</span>&nbsp;<span class="keyword" id="7109415">struct</span>&nbsp;<span class="op" id="7109422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7109425">in</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7109434">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7109442">inCode</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7109451">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7109456">wantCode</span>&nbsp;<span class="builtintype" id="7109465">int</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7109470">wantMsg</span>&nbsp;&nbsp;<span class="builtintype" id="7109479">string</span><br>
<span class="lineno"></span><span class="op" id="7109486">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7109489">var</span>&nbsp;<span class="ident" id="7109493">readResponseTests</span>&nbsp;<span class="op" id="7109511">=</span>&nbsp;<span class="op" id="7109513">[</span><span class="op" id="7109514">]</span><span class="ident" id="7109515">readResponseTest</span><span class="op" id="7109531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7109534">{</span><span class="string" id="7109535">&#34;230-Anonymous&nbsp;access&nbsp;granted,&nbsp;restrictions&nbsp;apply\n&#34;</span>&nbsp;<span class="op" id="7109588">+</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7109592">&#34;Read&nbsp;the&nbsp;file&nbsp;README.txt,\n&#34;</span>&nbsp;<span class="op" id="7109622">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7109626">&#34;230&nbsp;&nbsp;please&#34;</span><span class="op" id="7109639">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7109643">23</span><span class="op" id="7109645">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7109649">230</span><span class="op" id="7109652">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7109656">&#34;Anonymous&nbsp;access&nbsp;granted,&nbsp;restrictions&nbsp;apply\nRead&nbsp;the&nbsp;file&nbsp;README.txt,\n&nbsp;please&#34;</span><span class="op" id="7109738">,</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7109741">}</span><span class="op" id="7109742">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7109746">{</span><span class="string" id="7109747">&#34;230&nbsp;Anonymous&nbsp;access&nbsp;granted,&nbsp;restrictions&nbsp;apply\n&#34;</span><span class="op" id="7109799">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7109803">23</span><span class="op" id="7109805">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7109809">230</span><span class="op" id="7109812">,</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7109816">&#34;Anonymous&nbsp;access&nbsp;granted,&nbsp;restrictions&nbsp;apply&#34;</span><span class="op" id="7109862">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7109865">}</span><span class="op" id="7109866">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7109870">{</span><span class="string" id="7109871">&#34;400-A\n400-B\n400&nbsp;C&#34;</span><span class="op" id="7109892">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7109896">4</span><span class="op" id="7109897">,</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7109901">400</span><span class="op" id="7109904">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7109908">&#34;A\nB\nC&#34;</span><span class="op" id="7109917">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7109920">}</span><span class="op" id="7109921">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7109925">{</span><span class="string" id="7109926">&#34;400-A\r\n400-B\r\n400&nbsp;C\r\n&#34;</span><span class="op" id="7109955">,</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7109959">4</span><span class="op" id="7109960">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7109964">400</span><span class="op" id="7109967">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7109971">&#34;A\nB\nC&#34;</span><span class="op" id="7109980">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7109983">}</span><span class="op" id="7109984">,</span><br>
<span class="lineno"></span><span class="op" id="7109986">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="7109989">//&nbsp;See&nbsp;http://www.ietf.org/rfc/rfc959.txt&nbsp;page&nbsp;36.</span><br>
<span class="lineno"></span><span class="keyword" id="7110040">func</span>&nbsp;<span class="ident" id="7110045">TestRFC959Lines</span><span class="op" id="7110060">(</span><span class="ident" id="7110061">t</span>&nbsp;<span class="op" id="7110063">*</span><span class="ident" id="7110064">testing</span><span class="op" id="7110071">.</span><span class="ident" id="7110072">T</span><span class="op" id="7110073">)</span>&nbsp;<span class="op" id="7110075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7110078">for</span>&nbsp;<span class="ident" id="7110082">i</span><span class="op" id="7110083">,</span>&nbsp;<span class="ident" id="7110085">tt</span>&nbsp;<span class="op" id="7110088">:=</span>&nbsp;<span class="keyword" id="7110091">range</span>&nbsp;<span class="ident" id="7110097">readResponseTests</span>&nbsp;<span class="op" id="7110115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7110119">r</span>&nbsp;<span class="op" id="7110121">:=</span>&nbsp;<span class="ident" id="7110124">reader</span><span class="op" id="7110130">(</span><span class="ident" id="7110131">tt</span><span class="op" id="7110133">.</span><span class="ident" id="7110134">in</span>&nbsp;<span class="op" id="7110137">+</span>&nbsp;<span class="string" id="7110139">&#34;\nFOLLOWING&nbsp;DATA&#34;</span><span class="op" id="7110157">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7110161">code</span><span class="op" id="7110165">,</span>&nbsp;<span class="ident" id="7110167">msg</span><span class="op" id="7110170">,</span>&nbsp;<span class="ident" id="7110172">err</span>&nbsp;<span class="op" id="7110176">:=</span>&nbsp;<span class="ident" id="7110179">r</span><span class="op" id="7110180">.</span><span class="ident" id="7110181">ReadResponse</span><span class="op" id="7110193">(</span><span class="ident" id="7110194">tt</span><span class="op" id="7110196">.</span><span class="ident" id="7110197">inCode</span><span class="op" id="7110203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7110207">if</span>&nbsp;<span class="ident" id="7110210">err</span>&nbsp;<span class="op" id="7110214">!=</span>&nbsp;<span class="ident" id="7110217">nil</span>&nbsp;<span class="op" id="7110221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7110226">t</span><span class="op" id="7110227">.</span><span class="ident" id="7110228">Errorf</span><span class="op" id="7110234">(</span><span class="string" id="7110235">&#34;#%d:&nbsp;ReadResponse:&nbsp;%v&#34;</span><span class="op" id="7110258">,</span>&nbsp;<span class="ident" id="7110260">i</span><span class="op" id="7110261">,</span>&nbsp;<span class="ident" id="7110263">err</span><span class="op" id="7110266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7110271">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7110282">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7110286">if</span>&nbsp;<span class="ident" id="7110289">code</span>&nbsp;<span class="op" id="7110294">!=</span>&nbsp;<span class="ident" id="7110297">tt</span><span class="op" id="7110299">.</span><span class="ident" id="7110300">wantCode</span>&nbsp;<span class="op" id="7110309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7110314">t</span><span class="op" id="7110315">.</span><span class="ident" id="7110316">Errorf</span><span class="op" id="7110322">(</span><span class="string" id="7110323">&#34;#%d:&nbsp;code=%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7110346">,</span>&nbsp;<span class="ident" id="7110348">i</span><span class="op" id="7110349">,</span>&nbsp;<span class="ident" id="7110351">code</span><span class="op" id="7110355">,</span>&nbsp;<span class="ident" id="7110357">tt</span><span class="op" id="7110359">.</span><span class="ident" id="7110360">wantCode</span><span class="op" id="7110368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7110372">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7110376">if</span>&nbsp;<span class="ident" id="7110379">msg</span>&nbsp;<span class="op" id="7110383">!=</span>&nbsp;<span class="ident" id="7110386">tt</span><span class="op" id="7110388">.</span><span class="ident" id="7110389">wantMsg</span>&nbsp;<span class="op" id="7110397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7110402">t</span><span class="op" id="7110403">.</span><span class="ident" id="7110404">Errorf</span><span class="op" id="7110410">(</span><span class="string" id="7110411">&#34;#%d:&nbsp;msg=%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7110433">,</span>&nbsp;<span class="ident" id="7110435">i</span><span class="op" id="7110436">,</span>&nbsp;<span class="ident" id="7110438">msg</span><span class="op" id="7110441">,</span>&nbsp;<span class="ident" id="7110443">tt</span><span class="op" id="7110445">.</span><span class="ident" id="7110446">wantMsg</span><span class="op" id="7110453">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7110457">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7110460">}</span><br>
<span class="lineno"></span><span class="op" id="7110462">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7110465">func</span>&nbsp;<span class="ident" id="7110470">TestCommonHeaders</span><span class="op" id="7110487">(</span><span class="ident" id="7110488">t</span>&nbsp;<span class="op" id="7110490">*</span><span class="ident" id="7110491">testing</span><span class="op" id="7110498">.</span><span class="ident" id="7110499">T</span><span class="op" id="7110500">)</span>&nbsp;<span class="op" id="7110502">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7110505">for</span>&nbsp;<span class="ident" id="7110509">h</span>&nbsp;<span class="op" id="7110511">:=</span>&nbsp;<span class="keyword" id="7110514">range</span>&nbsp;<span class="ident" id="7110520">commonHeader</span>&nbsp;<span class="op" id="7110533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7110537">if</span>&nbsp;<span class="ident" id="7110540">h</span>&nbsp;<span class="op" id="7110542">!=</span>&nbsp;<span class="ident" id="7110545">CanonicalMIMEHeaderKey</span><span class="op" id="7110567">(</span><span class="ident" id="7110568">h</span><span class="op" id="7110569">)</span>&nbsp;<span class="op" id="7110571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7110576">t</span><span class="op" id="7110577">.</span><span class="ident" id="7110578">Errorf</span><span class="op" id="7110584">(</span><span class="string" id="7110585">&#34;Non-canonical&nbsp;header&nbsp;%q&nbsp;in&nbsp;commonHeader&#34;</span><span class="op" id="7110626">,</span>&nbsp;<span class="ident" id="7110628">h</span><span class="op" id="7110629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7110633">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7110636">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7110639">b</span>&nbsp;<span class="op" id="7110641">:=</span>&nbsp;<span class="op" id="7110644">[</span><span class="op" id="7110645">]</span><span class="builtintype" id="7110646">byte</span><span class="op" id="7110650">(</span><span class="string" id="7110651">&#34;content-Length&#34;</span><span class="op" id="7110667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7110670">want</span>&nbsp;<span class="op" id="7110675">:=</span>&nbsp;<span class="string" id="7110678">&#34;Content-Length&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7110696">n</span>&nbsp;<span class="op" id="7110698">:=</span>&nbsp;<span class="ident" id="7110701">testing</span><span class="op" id="7110708">.</span><span class="ident" id="7110709">AllocsPerRun</span><span class="op" id="7110721">(</span><span class="num" id="7110722">200</span><span class="op" id="7110725">,</span>&nbsp;<span class="keyword" id="7110727">func</span><span class="op" id="7110731">(</span><span class="op" id="7110732">)</span>&nbsp;<span class="op" id="7110734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7110738">if</span>&nbsp;<span class="ident" id="7110741">x</span>&nbsp;<span class="op" id="7110743">:=</span>&nbsp;<span class="ident" id="7110746">canonicalMIMEHeaderKey</span><span class="op" id="7110768">(</span><span class="ident" id="7110769">b</span><span class="op" id="7110770">)</span><span class="op" id="7110771">;</span>&nbsp;<span class="ident" id="7110773">x</span>&nbsp;<span class="op" id="7110775">!=</span>&nbsp;<span class="ident" id="7110778">want</span>&nbsp;<span class="op" id="7110783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7110788">t</span><span class="op" id="7110789">.</span><span class="ident" id="7110790">Fatalf</span><span class="op" id="7110796">(</span><span class="string" id="7110797">&#34;canonicalMIMEHeaderKey(%q)&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7110839">,</span>&nbsp;<span class="ident" id="7110841">b</span><span class="op" id="7110842">,</span>&nbsp;<span class="ident" id="7110844">x</span><span class="op" id="7110845">,</span>&nbsp;<span class="ident" id="7110847">want</span><span class="op" id="7110851">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7110855">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7110858">}</span><span class="op" id="7110859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7110862">if</span>&nbsp;<span class="ident" id="7110865">n</span>&nbsp;<span class="op" id="7110867">&gt;</span>&nbsp;<span class="num" id="7110869">0</span>&nbsp;<span class="op" id="7110871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7110875">t</span><span class="op" id="7110876">.</span><span class="ident" id="7110877">Errorf</span><span class="op" id="7110883">(</span><span class="string" id="7110884">&#34;canonicalMIMEHeaderKey&nbsp;allocs&nbsp;=&nbsp;%v;&nbsp;want&nbsp;0&#34;</span><span class="op" id="7110928">,</span>&nbsp;<span class="ident" id="7110930">n</span><span class="op" id="7110931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7110934">}</span><br>
<span class="lineno">265</span><span class="op" id="7110936">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7110939">var</span>&nbsp;<span class="ident" id="7110943">clientHeaders</span>&nbsp;<span class="op" id="7110957">=</span>&nbsp;<span class="ident" id="7110959">strings</span><span class="op" id="7110966">.</span><span class="ident" id="7110967">Replace</span><span class="op" id="7110974">(</span><span class="string" id="7110975">`Host:&nbsp;golang.org<br>
<span class="lineno"></span>Connection:&nbsp;keep-alive<br>
<span class="lineno"></span>Cache-Control:&nbsp;max-age=0<br>
<span class="lineno">270</span>Accept:&nbsp;application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5<br>
<span class="lineno"></span>User-Agent:&nbsp;Mozilla/5.0&nbsp;(X11;&nbsp;U;&nbsp;Linux&nbsp;x86_64;&nbsp;en-US)&nbsp;AppleWebKit/534.3&nbsp;(KHTML,&nbsp;like&nbsp;Gecko)&nbsp;Chrome/6.0.472.63&nbsp;Safari/534.3<br>
<span class="lineno"></span>Accept-Encoding:&nbsp;gzip,deflate,sdch<br>
<span class="lineno"></span>Accept-Language:&nbsp;en-US,en;q=0.8,fr-CH;q=0.6<br>
<span class="lineno"></span>Accept-Charset:&nbsp;ISO-8859-1,utf-8;q=0.7,*;q=0.3<br>
<span class="lineno">275</span>COOKIE:&nbsp;__utma=000000000.0000000000.0000000000.0000000000.0000000000.00;&nbsp;__utmb=000000000.0.00.0000000000;&nbsp;__utmc=000000000;&nbsp;__utmz=000000000.0000000000.00.0.utmcsr=code.google.com|utmccn=(referral)|utmcmd=referral|utmcct=/p/go/issues/detail<br>
<span class="lineno"></span>Non-Interned:&nbsp;test<br>
<span class="lineno"></span><br>
<span class="lineno"></span>`</span><span class="op" id="7111652">,</span>&nbsp;<span class="string" id="7111654">&#34;\n&#34;</span><span class="op" id="7111658">,</span>&nbsp;<span class="string" id="7111660">&#34;\r\n&#34;</span><span class="op" id="7111666">,</span>&nbsp;<span class="op" id="7111668">-</span><span class="num" id="7111669">1</span><span class="op" id="7111670">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span><span class="keyword" id="7111673">var</span>&nbsp;<span class="ident" id="7111677">serverHeaders</span>&nbsp;<span class="op" id="7111691">=</span>&nbsp;<span class="ident" id="7111693">strings</span><span class="op" id="7111700">.</span><span class="ident" id="7111701">Replace</span><span class="op" id="7111708">(</span><span class="string" id="7111709">`Content-Type:&nbsp;text/html;&nbsp;charset=utf-8<br>
<span class="lineno"></span>Content-Encoding:&nbsp;gzip<br>
<span class="lineno"></span>Date:&nbsp;Thu,&nbsp;27&nbsp;Sep&nbsp;2012&nbsp;09:03:33&nbsp;GMT<br>
<span class="lineno"></span>Server:&nbsp;Google&nbsp;Frontend<br>
<span class="lineno"></span>Cache-Control:&nbsp;private<br>
<span class="lineno">285</span>Content-Length:&nbsp;2298<br>
<span class="lineno"></span>VIA:&nbsp;1.1&nbsp;proxy.example.com:80&nbsp;(XXX/n.n.n-nnn)<br>
<span class="lineno"></span>Connection:&nbsp;Close<br>
<span class="lineno"></span>Non-Interned:&nbsp;test<br>
<span class="lineno"></span><br>
<span class="lineno">290</span>`</span><span class="op" id="7111961">,</span>&nbsp;<span class="string" id="7111963">&#34;\n&#34;</span><span class="op" id="7111967">,</span>&nbsp;<span class="string" id="7111969">&#34;\r\n&#34;</span><span class="op" id="7111975">,</span>&nbsp;<span class="op" id="7111977">-</span><span class="num" id="7111978">1</span><span class="op" id="7111979">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7111982">func</span>&nbsp;<span class="ident" id="7111987">BenchmarkReadMIMEHeader</span><span class="op" id="7112010">(</span><span class="ident" id="7112011">b</span>&nbsp;<span class="op" id="7112013">*</span><span class="ident" id="7112014">testing</span><span class="op" id="7112021">.</span><span class="ident" id="7112022">B</span><span class="op" id="7112023">)</span>&nbsp;<span class="op" id="7112025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7112028">b</span><span class="op" id="7112029">.</span><span class="ident" id="7112030">ReportAllocs</span><span class="op" id="7112042">(</span><span class="op" id="7112043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7112046">var</span>&nbsp;<span class="ident" id="7112050">buf</span>&nbsp;<span class="ident" id="7112054">bytes</span><span class="op" id="7112059">.</span><span class="ident" id="7112060">Buffer</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7112068">br</span>&nbsp;<span class="op" id="7112071">:=</span>&nbsp;<span class="ident" id="7112074">bufio</span><span class="op" id="7112079">.</span><span class="ident" id="7112080">NewReader</span><span class="op" id="7112089">(</span><span class="op" id="7112090">&amp;</span><span class="ident" id="7112091">buf</span><span class="op" id="7112094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7112097">r</span>&nbsp;<span class="op" id="7112099">:=</span>&nbsp;<span class="ident" id="7112102">NewReader</span><span class="op" id="7112111">(</span><span class="ident" id="7112112">br</span><span class="op" id="7112114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7112117">for</span>&nbsp;<span class="ident" id="7112121">i</span>&nbsp;<span class="op" id="7112123">:=</span>&nbsp;<span class="num" id="7112126">0</span><span class="op" id="7112127">;</span>&nbsp;<span class="ident" id="7112129">i</span>&nbsp;<span class="op" id="7112131">&lt;</span>&nbsp;<span class="ident" id="7112133">b</span><span class="op" id="7112134">.</span><span class="ident" id="7112135">N</span><span class="op" id="7112136">;</span>&nbsp;<span class="ident" id="7112138">i</span><span class="op" id="7112139">++</span>&nbsp;<span class="op" id="7112142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7112146">var</span>&nbsp;<span class="ident" id="7112150">want</span>&nbsp;<span class="builtintype" id="7112155">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7112161">var</span>&nbsp;<span class="ident" id="7112165">find</span>&nbsp;<span class="builtintype" id="7112170">string</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7112179">if</span>&nbsp;<span class="op" id="7112182">(</span><span class="ident" id="7112183">i</span>&nbsp;<span class="op" id="7112185">&amp;</span>&nbsp;<span class="num" id="7112187">1</span><span class="op" id="7112188">)</span>&nbsp;<span class="op" id="7112190">==</span>&nbsp;<span class="num" id="7112193">1</span>&nbsp;<span class="op" id="7112195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7112200">buf</span><span class="op" id="7112203">.</span><span class="ident" id="7112204">WriteString</span><span class="op" id="7112215">(</span><span class="ident" id="7112216">clientHeaders</span><span class="op" id="7112229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7112234">want</span>&nbsp;<span class="op" id="7112239">=</span>&nbsp;<span class="num" id="7112241">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7112247">find</span>&nbsp;<span class="op" id="7112252">=</span>&nbsp;<span class="string" id="7112254">&#34;Cookie&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7112265">}</span>&nbsp;<span class="keyword" id="7112267">else</span>&nbsp;<span class="op" id="7112272">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7112277">buf</span><span class="op" id="7112280">.</span><span class="ident" id="7112281">WriteString</span><span class="op" id="7112292">(</span><span class="ident" id="7112293">serverHeaders</span><span class="op" id="7112306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7112311">want</span>&nbsp;<span class="op" id="7112316">=</span>&nbsp;<span class="num" id="7112318">9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7112323">find</span>&nbsp;<span class="op" id="7112328">=</span>&nbsp;<span class="string" id="7112330">&#34;Via&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7112338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7112342">h</span><span class="op" id="7112343">,</span>&nbsp;<span class="ident" id="7112345">err</span>&nbsp;<span class="op" id="7112349">:=</span>&nbsp;<span class="ident" id="7112352">r</span><span class="op" id="7112353">.</span><span class="ident" id="7112354">ReadMIMEHeader</span><span class="op" id="7112368">(</span><span class="op" id="7112369">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7112373">if</span>&nbsp;<span class="ident" id="7112376">err</span>&nbsp;<span class="op" id="7112380">!=</span>&nbsp;<span class="ident" id="7112383">nil</span>&nbsp;<span class="op" id="7112387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7112392">b</span><span class="op" id="7112393">.</span><span class="ident" id="7112394">Fatal</span><span class="op" id="7112399">(</span><span class="ident" id="7112400">err</span><span class="op" id="7112403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7112407">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7112411">if</span>&nbsp;<span class="builtinfunc" id="7112414">len</span><span class="op" id="7112417">(</span><span class="ident" id="7112418">h</span><span class="op" id="7112419">)</span>&nbsp;<span class="op" id="7112421">!=</span>&nbsp;<span class="ident" id="7112424">want</span>&nbsp;<span class="op" id="7112429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7112434">b</span><span class="op" id="7112435">.</span><span class="ident" id="7112436">Fatalf</span><span class="op" id="7112442">(</span><span class="string" id="7112443">&#34;wrong&nbsp;number&nbsp;of&nbsp;headers:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7112485">,</span>&nbsp;<span class="builtinfunc" id="7112487">len</span><span class="op" id="7112490">(</span><span class="ident" id="7112491">h</span><span class="op" id="7112492">)</span><span class="op" id="7112493">,</span>&nbsp;<span class="ident" id="7112495">want</span><span class="op" id="7112499">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7112503">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7112507">if</span>&nbsp;<span class="ident" id="7112510">_</span><span class="op" id="7112511">,</span>&nbsp;<span class="ident" id="7112513">ok</span>&nbsp;<span class="op" id="7112516">:=</span>&nbsp;<span class="ident" id="7112519">h</span><span class="op" id="7112520">[</span><span class="ident" id="7112521">find</span><span class="op" id="7112525">]</span><span class="op" id="7112526">;</span>&nbsp;<span class="op" id="7112528">!</span><span class="ident" id="7112529">ok</span>&nbsp;<span class="op" id="7112532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7112537">b</span><span class="op" id="7112538">.</span><span class="ident" id="7112539">Fatalf</span><span class="op" id="7112545">(</span><span class="string" id="7112546">&#34;did&nbsp;not&nbsp;find&nbsp;key&nbsp;%s&#34;</span><span class="op" id="7112567">,</span>&nbsp;<span class="ident" id="7112569">find</span><span class="op" id="7112573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7112577">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7112580">}</span><br>
<span class="lineno">320</span><span class="op" id="7112582">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7112585">func</span>&nbsp;<span class="ident" id="7112590">BenchmarkUncommon</span><span class="op" id="7112607">(</span><span class="ident" id="7112608">b</span>&nbsp;<span class="op" id="7112610">*</span><span class="ident" id="7112611">testing</span><span class="op" id="7112618">.</span><span class="ident" id="7112619">B</span><span class="op" id="7112620">)</span>&nbsp;<span class="op" id="7112622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7112625">b</span><span class="op" id="7112626">.</span><span class="ident" id="7112627">ReportAllocs</span><span class="op" id="7112639">(</span><span class="op" id="7112640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7112643">var</span>&nbsp;<span class="ident" id="7112647">buf</span>&nbsp;<span class="ident" id="7112651">bytes</span><span class="op" id="7112656">.</span><span class="ident" id="7112657">Buffer</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7112665">br</span>&nbsp;<span class="op" id="7112668">:=</span>&nbsp;<span class="ident" id="7112671">bufio</span><span class="op" id="7112676">.</span><span class="ident" id="7112677">NewReader</span><span class="op" id="7112686">(</span><span class="op" id="7112687">&amp;</span><span class="ident" id="7112688">buf</span><span class="op" id="7112691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7112694">r</span>&nbsp;<span class="op" id="7112696">:=</span>&nbsp;<span class="ident" id="7112699">NewReader</span><span class="op" id="7112708">(</span><span class="ident" id="7112709">br</span><span class="op" id="7112711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7112714">for</span>&nbsp;<span class="ident" id="7112718">i</span>&nbsp;<span class="op" id="7112720">:=</span>&nbsp;<span class="num" id="7112723">0</span><span class="op" id="7112724">;</span>&nbsp;<span class="ident" id="7112726">i</span>&nbsp;<span class="op" id="7112728">&lt;</span>&nbsp;<span class="ident" id="7112730">b</span><span class="op" id="7112731">.</span><span class="ident" id="7112732">N</span><span class="op" id="7112733">;</span>&nbsp;<span class="ident" id="7112735">i</span><span class="op" id="7112736">++</span>&nbsp;<span class="op" id="7112739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7112743">buf</span><span class="op" id="7112746">.</span><span class="ident" id="7112747">WriteString</span><span class="op" id="7112758">(</span><span class="string" id="7112759">&#34;uncommon-header-for-benchmark:&nbsp;foo\r\n\r\n&#34;</span><span class="op" id="7112803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7112807">h</span><span class="op" id="7112808">,</span>&nbsp;<span class="ident" id="7112810">err</span>&nbsp;<span class="op" id="7112814">:=</span>&nbsp;<span class="ident" id="7112817">r</span><span class="op" id="7112818">.</span><span class="ident" id="7112819">ReadMIMEHeader</span><span class="op" id="7112833">(</span><span class="op" id="7112834">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7112838">if</span>&nbsp;<span class="ident" id="7112841">err</span>&nbsp;<span class="op" id="7112845">!=</span>&nbsp;<span class="ident" id="7112848">nil</span>&nbsp;<span class="op" id="7112852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7112857">b</span><span class="op" id="7112858">.</span><span class="ident" id="7112859">Fatal</span><span class="op" id="7112864">(</span><span class="ident" id="7112865">err</span><span class="op" id="7112868">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7112872">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7112876">if</span>&nbsp;<span class="ident" id="7112879">_</span><span class="op" id="7112880">,</span>&nbsp;<span class="ident" id="7112882">ok</span>&nbsp;<span class="op" id="7112885">:=</span>&nbsp;<span class="ident" id="7112888">h</span><span class="op" id="7112889">[</span><span class="string" id="7112890">&#34;Uncommon-Header-For-Benchmark&#34;</span><span class="op" id="7112921">]</span><span class="op" id="7112922">;</span>&nbsp;<span class="op" id="7112924">!</span><span class="ident" id="7112925">ok</span>&nbsp;<span class="op" id="7112928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7112933">b</span><span class="op" id="7112934">.</span><span class="ident" id="7112935">Fatal</span><span class="op" id="7112940">(</span><span class="string" id="7112941">&#34;Missing&nbsp;result&nbsp;header.&#34;</span><span class="op" id="7112965">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7112969">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7112972">}</span><br>
<span class="lineno"></span><span class="op" id="7112974">}</span>
</div>
</body>
</html>
