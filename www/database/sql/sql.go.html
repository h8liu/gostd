<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5742727">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5742782">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5742836">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5742887">//&nbsp;Package&nbsp;sql&nbsp;provides&nbsp;a&nbsp;generic&nbsp;interface&nbsp;around&nbsp;SQL&nbsp;(or&nbsp;SQL-like)</span><br>
<span class="lineno"></span><span class="comment" id="5742956">//&nbsp;databases.</span><br>
<span class="lineno"></span><span class="comment" id="5742970">//</span><br>
<span class="lineno"></span><span class="comment" id="5742973">//&nbsp;The&nbsp;sql&nbsp;package&nbsp;must&nbsp;be&nbsp;used&nbsp;in&nbsp;conjunction&nbsp;with&nbsp;a&nbsp;database&nbsp;driver.</span><br>
<span class="lineno"></span><span class="comment" id="5743044">//&nbsp;See&nbsp;http://golang.org/s/sqldrivers&nbsp;for&nbsp;a&nbsp;list&nbsp;of&nbsp;drivers.</span><br>
<span class="lineno">10</span><span class="comment" id="5743105">//</span><br>
<span class="lineno"></span><span class="comment" id="5743108">//&nbsp;For&nbsp;more&nbsp;usage&nbsp;examples,&nbsp;see&nbsp;the&nbsp;wiki&nbsp;page&nbsp;at</span><br>
<span class="lineno"></span><span class="comment" id="5743157">//&nbsp;http://golang.org/s/sqlwiki.</span><br>
<span class="lineno"></span><span class="keyword" id="5743189">package</span>&nbsp;<span class="ident" id="5743197">sql</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="5743202">import</span>&nbsp;<span class="op" id="5743209">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5743212">&#34;database/sql/driver&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5743235">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5743245">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5743252">&#34;io&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5743258">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5743269">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5743277">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="5743284">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="5743287">var</span>&nbsp;<span class="ident" id="5743291">drivers</span>&nbsp;<span class="op" id="5743299">=</span>&nbsp;<span class="builtinfunc" id="5743301">make</span><span class="op" id="5743305">(</span><span class="keyword" id="5743306">map</span><span class="op" id="5743309">[</span><span class="builtintype" id="5743310">string</span><span class="op" id="5743316">]</span><span class="ident" id="5743317"><a href="/database/sql/sql.go.html#5743212">driver</a></span><span class="op" id="5743323">.</span><span class="ident" id="5743324">Driver</span><span class="op" id="5743330">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5743333">//&nbsp;Register&nbsp;makes&nbsp;a&nbsp;database&nbsp;driver&nbsp;available&nbsp;by&nbsp;the&nbsp;provided&nbsp;name.</span><br>
<span class="lineno"></span><span class="comment" id="5743401">//&nbsp;If&nbsp;Register&nbsp;is&nbsp;called&nbsp;twice&nbsp;with&nbsp;the&nbsp;same&nbsp;name&nbsp;or&nbsp;if&nbsp;driver&nbsp;is&nbsp;nil,</span><br>
<span class="lineno"></span><span class="comment" id="5743472">//&nbsp;it&nbsp;panics.</span><br>
<span class="lineno">30</span><span class="keyword" id="5743486">func</span>&nbsp;<span class="ident" id="5743491">Register</span><span class="op" id="5743499">(</span><span class="ident" id="5743500">name</span>&nbsp;<span class="builtintype" id="5743505">string</span><span class="op" id="5743511">,</span>&nbsp;<span class="ident" id="5743513">driver</span>&nbsp;<span class="ident" id="5743520"><a href="/database/sql/sql.go.html#5743212">driver</a></span><span class="op" id="5743526">.</span><span class="ident" id="5743527">Driver</span><span class="op" id="5743533">)</span>&nbsp;<span class="op" id="5743535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5743538">if</span>&nbsp;<span class="ident" id="5743541"><a href="/database/sql/sql.go.html#5743513">driver</a></span>&nbsp;<span class="op" id="5743548">==</span>&nbsp;<span class="ident" id="5743551">nil</span>&nbsp;<span class="op" id="5743555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5743559">panic</span><span class="op" id="5743564">(</span><span class="string" id="5743565">&#34;sql:&nbsp;Register&nbsp;driver&nbsp;is&nbsp;nil&#34;</span><span class="op" id="5743594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5743597">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5743600">if</span>&nbsp;<span class="ident" id="5743603">_</span><span class="op" id="5743604">,</span>&nbsp;<span class="ident" id="5743606">dup</span>&nbsp;<span class="op" id="5743610">:=</span>&nbsp;<span class="ident" id="5743613"><a href="/database/sql/sql.go.html#5743291">drivers</a></span><span class="op" id="5743620">[</span><span class="ident" id="5743621"><a href="/database/sql/sql.go.html#5743500">name</a></span><span class="op" id="5743625">]</span><span class="op" id="5743626">;</span>&nbsp;<span class="ident" id="5743628"><a href="/database/sql/sql.go.html#5743606">dup</a></span>&nbsp;<span class="op" id="5743632">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5743636">panic</span><span class="op" id="5743641">(</span><span class="string" id="5743642">&#34;sql:&nbsp;Register&nbsp;called&nbsp;twice&nbsp;for&nbsp;driver&nbsp;&#34;</span>&nbsp;<span class="op" id="5743683">+</span>&nbsp;<span class="ident" id="5743685"><a href="/database/sql/sql.go.html#5743500">name</a></span><span class="op" id="5743689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5743692">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5743695"><a href="/database/sql/sql.go.html#5743291">drivers</a></span><span class="op" id="5743702">[</span><span class="ident" id="5743703"><a href="/database/sql/sql.go.html#5743500">name</a></span><span class="op" id="5743707">]</span>&nbsp;<span class="op" id="5743709">=</span>&nbsp;<span class="ident" id="5743711"><a href="/database/sql/sql.go.html#5743513">driver</a></span><br>
<span class="lineno"></span><span class="op" id="5743718">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="5743721">func</span>&nbsp;<span class="ident" id="5743726">unregisterAllDrivers</span><span class="op" id="5743746">(</span><span class="op" id="5743747">)</span>&nbsp;<span class="op" id="5743749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5743752">//&nbsp;For&nbsp;tests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5743767"><a href="/database/sql/sql.go.html#5743291">drivers</a></span>&nbsp;<span class="op" id="5743775">=</span>&nbsp;<span class="builtinfunc" id="5743777">make</span><span class="op" id="5743781">(</span><span class="keyword" id="5743782">map</span><span class="op" id="5743785">[</span><span class="builtintype" id="5743786">string</span><span class="op" id="5743792">]</span><span class="ident" id="5743793"><a href="/database/sql/sql.go.html#5743212">driver</a></span><span class="op" id="5743799">.</span><span class="ident" id="5743800">Driver</span><span class="op" id="5743806">)</span><br>
<span class="lineno"></span><span class="op" id="5743808">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="5743811">//&nbsp;Drivers&nbsp;returns&nbsp;a&nbsp;sorted&nbsp;list&nbsp;of&nbsp;the&nbsp;names&nbsp;of&nbsp;the&nbsp;registered&nbsp;drivers.</span><br>
<span class="lineno"></span><span class="keyword" id="5743884">func</span>&nbsp;<span class="ident" id="5743889">Drivers</span><span class="op" id="5743896">(</span><span class="op" id="5743897">)</span>&nbsp;<span class="op" id="5743899">[</span><span class="op" id="5743900">]</span><span class="builtintype" id="5743901">string</span>&nbsp;<span class="op" id="5743908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5743911">var</span>&nbsp;<span class="ident" id="5743915">list</span>&nbsp;<span class="op" id="5743920">[</span><span class="op" id="5743921">]</span><span class="builtintype" id="5743922">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5743930">for</span>&nbsp;<span class="ident" id="5743934">name</span>&nbsp;<span class="op" id="5743939">:=</span>&nbsp;<span class="keyword" id="5743942">range</span>&nbsp;<span class="ident" id="5743948"><a href="/database/sql/sql.go.html#5743291">drivers</a></span>&nbsp;<span class="op" id="5743956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5743960"><a href="/database/sql/sql.go.html#5743915">list</a></span>&nbsp;<span class="op" id="5743965">=</span>&nbsp;<span class="builtinfunc" id="5743967">append</span><span class="op" id="5743973">(</span><span class="ident" id="5743974"><a href="/database/sql/sql.go.html#5743915">list</a></span><span class="op" id="5743978">,</span>&nbsp;<span class="ident" id="5743980"><a href="/database/sql/sql.go.html#5743934">name</a></span><span class="op" id="5743984">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5743987">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5743990"><a href="/database/sql/sql.go.html#5743269">sort</a></span><span class="op" id="5743994">.</span><span class="ident" id="5743995">Strings</span><span class="op" id="5744002">(</span><span class="ident" id="5744003"><a href="/database/sql/sql.go.html#5743915">list</a></span><span class="op" id="5744007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5744010">return</span>&nbsp;<span class="ident" id="5744017"><a href="/database/sql/sql.go.html#5743915">list</a></span><br>
<span class="lineno"></span><span class="op" id="5744022">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="5744025">//&nbsp;RawBytes&nbsp;is&nbsp;a&nbsp;byte&nbsp;slice&nbsp;that&nbsp;holds&nbsp;a&nbsp;reference&nbsp;to&nbsp;memory&nbsp;owned&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="5744095">//&nbsp;the&nbsp;database&nbsp;itself.&nbsp;After&nbsp;a&nbsp;Scan&nbsp;into&nbsp;a&nbsp;RawBytes,&nbsp;the&nbsp;slice&nbsp;is&nbsp;only</span><br>
<span class="lineno"></span><span class="comment" id="5744167">//&nbsp;valid&nbsp;until&nbsp;the&nbsp;next&nbsp;call&nbsp;to&nbsp;Next,&nbsp;Scan,&nbsp;or&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="5744221">type</span>&nbsp;<span class="ident" id="5744226">RawBytes</span>&nbsp;<span class="op" id="5744235">[</span><span class="op" id="5744236">]</span><span class="builtintype" id="5744237">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="5744243">//&nbsp;NullString&nbsp;represents&nbsp;a&nbsp;string&nbsp;that&nbsp;may&nbsp;be&nbsp;null.</span><br>
<span class="lineno"></span><span class="comment" id="5744295">//&nbsp;NullString&nbsp;implements&nbsp;the&nbsp;Scanner&nbsp;interface&nbsp;so</span><br>
<span class="lineno"></span><span class="comment" id="5744345">//&nbsp;it&nbsp;can&nbsp;be&nbsp;used&nbsp;as&nbsp;a&nbsp;scan&nbsp;destination:</span><br>
<span class="lineno"></span><span class="comment" id="5744386">//</span><br>
<span class="lineno"></span><span class="comment" id="5744389">//&nbsp;&nbsp;var&nbsp;s&nbsp;NullString</span><br>
<span class="lineno">65</span><span class="comment" id="5744410">//&nbsp;&nbsp;err&nbsp;:=&nbsp;db.QueryRow(&#34;SELECT&nbsp;name&nbsp;FROM&nbsp;foo&nbsp;WHERE&nbsp;id=?&#34;,&nbsp;id).Scan(&amp;s)</span><br>
<span class="lineno"></span><span class="comment" id="5744481">//&nbsp;&nbsp;...</span><br>
<span class="lineno"></span><span class="comment" id="5744489">//&nbsp;&nbsp;if&nbsp;s.Valid&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="5744506">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;use&nbsp;s.String</span><br>
<span class="lineno"></span><span class="comment" id="5744529">//&nbsp;&nbsp;}&nbsp;else&nbsp;{</span><br>
<span class="lineno">70</span><span class="comment" id="5744542">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;NULL&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="5744563">//&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="5744569">//</span><br>
<span class="lineno"></span><span class="keyword" id="5744572">type</span>&nbsp;<span class="ident" id="5744577">NullString</span>&nbsp;<span class="keyword" id="5744588">struct</span>&nbsp;<span class="op" id="5744595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5744598">String</span>&nbsp;<span class="builtintype" id="5744605">string</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5744613">Valid</span>&nbsp;&nbsp;<span class="builtintype" id="5744620">bool</span>&nbsp;<span class="comment" id="5744625">//&nbsp;Valid&nbsp;is&nbsp;true&nbsp;if&nbsp;String&nbsp;is&nbsp;not&nbsp;NULL</span><br>
<span class="lineno"></span><span class="op" id="5744664">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5744667">//&nbsp;Scan&nbsp;implements&nbsp;the&nbsp;Scanner&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="5744709">func</span>&nbsp;<span class="op" id="5744714">(</span><span class="ident" id="5744715">ns</span>&nbsp;<span class="op" id="5744718">*</span><span class="ident" id="5744719"><a href="/database/sql/sql.go.html#5744577">NullString</a></span><span class="op" id="5744729">)</span>&nbsp;<span class="ident" id="5744731">Scan</span><span class="op" id="5744735">(</span><span class="ident" id="5744736">value</span>&nbsp;<span class="keyword" id="5744742">interface</span><span class="op" id="5744751">{</span><span class="op" id="5744752">}</span><span class="op" id="5744753">)</span>&nbsp;<span class="builtintype" id="5744755">error</span>&nbsp;<span class="op" id="5744761">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5744764">if</span>&nbsp;<span class="ident" id="5744767"><a href="/database/sql/sql.go.html#5744736">value</a></span>&nbsp;<span class="op" id="5744773">==</span>&nbsp;<span class="ident" id="5744776">nil</span>&nbsp;<span class="op" id="5744780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5744784"><a href="/database/sql/sql.go.html#5744715">ns</a></span><span class="op" id="5744786">.</span><span class="ident" id="5744787">String</span><span class="op" id="5744793">,</span>&nbsp;<span class="ident" id="5744795"><a href="/database/sql/sql.go.html#5744715">ns</a></span><span class="op" id="5744797">.</span><span class="ident" id="5744798">Valid</span>&nbsp;<span class="op" id="5744804">=</span>&nbsp;<span class="string" id="5744806">&#34;&#34;</span><span class="op" id="5744808">,</span>&nbsp;<span class="ident" id="5744810">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5744818">return</span>&nbsp;<span class="ident" id="5744825">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5744830">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5744833"><a href="/database/sql/sql.go.html#5744715">ns</a></span><span class="op" id="5744835">.</span><span class="ident" id="5744836">Valid</span>&nbsp;<span class="op" id="5744842">=</span>&nbsp;<span class="ident" id="5744844">true</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5744850">return</span>&nbsp;<span class="ident" id="5744857"><a href="/database/sql/convert.go.html#5737952">convertAssign</a></span><span class="op" id="5744870">(</span><span class="op" id="5744871">&amp;</span><span class="ident" id="5744872"><a href="/database/sql/sql.go.html#5744715">ns</a></span><span class="op" id="5744874">.</span><span class="ident" id="5744875">String</span><span class="op" id="5744881">,</span>&nbsp;<span class="ident" id="5744883"><a href="/database/sql/sql.go.html#5744736">value</a></span><span class="op" id="5744888">)</span><br>
<span class="lineno"></span><span class="op" id="5744890">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5744893">//&nbsp;Value&nbsp;implements&nbsp;the&nbsp;driver&nbsp;Valuer&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="5744942">func</span>&nbsp;<span class="op" id="5744947">(</span><span class="ident" id="5744948">ns</span>&nbsp;<span class="ident" id="5744951"><a href="/database/sql/sql.go.html#5744577">NullString</a></span><span class="op" id="5744961">)</span>&nbsp;<span class="ident" id="5744963">Value</span><span class="op" id="5744968">(</span><span class="op" id="5744969">)</span>&nbsp;<span class="op" id="5744971">(</span><span class="ident" id="5744972"><a href="/database/sql/sql.go.html#5743212">driver</a></span><span class="op" id="5744978">.</span><span class="ident" id="5744979">Value</span><span class="op" id="5744984">,</span>&nbsp;<span class="builtintype" id="5744986">error</span><span class="op" id="5744991">)</span>&nbsp;<span class="op" id="5744993">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5744996">if</span>&nbsp;<span class="op" id="5744999">!</span><span class="ident" id="5745000"><a href="/database/sql/sql.go.html#5744948">ns</a></span><span class="op" id="5745002">.</span><span class="ident" id="5745003">Valid</span>&nbsp;<span class="op" id="5745009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5745013">return</span>&nbsp;<span class="ident" id="5745020">nil</span><span class="op" id="5745023">,</span>&nbsp;<span class="ident" id="5745025">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5745030">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5745033">return</span>&nbsp;<span class="ident" id="5745040"><a href="/database/sql/sql.go.html#5744948">ns</a></span><span class="op" id="5745042">.</span><span class="ident" id="5745043">String</span><span class="op" id="5745049">,</span>&nbsp;<span class="ident" id="5745051">nil</span><br>
<span class="lineno"></span><span class="op" id="5745055">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="comment" id="5745058">//&nbsp;NullInt64&nbsp;represents&nbsp;an&nbsp;int64&nbsp;that&nbsp;may&nbsp;be&nbsp;null.</span><br>
<span class="lineno"></span><span class="comment" id="5745109">//&nbsp;NullInt64&nbsp;implements&nbsp;the&nbsp;Scanner&nbsp;interface&nbsp;so</span><br>
<span class="lineno"></span><span class="comment" id="5745158">//&nbsp;it&nbsp;can&nbsp;be&nbsp;used&nbsp;as&nbsp;a&nbsp;scan&nbsp;destination,&nbsp;similar&nbsp;to&nbsp;NullString.</span><br>
<span class="lineno"></span><span class="keyword" id="5745222">type</span>&nbsp;<span class="ident" id="5745227">NullInt64</span>&nbsp;<span class="keyword" id="5745237">struct</span>&nbsp;<span class="op" id="5745244">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5745247">Int64</span>&nbsp;<span class="ident" id="5745253">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5745260">Valid</span>&nbsp;<span class="builtintype" id="5745266">bool</span>&nbsp;<span class="comment" id="5745271">//&nbsp;Valid&nbsp;is&nbsp;true&nbsp;if&nbsp;Int64&nbsp;is&nbsp;not&nbsp;NULL</span><br>
<span class="lineno"></span><span class="op" id="5745309">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5745312">//&nbsp;Scan&nbsp;implements&nbsp;the&nbsp;Scanner&nbsp;interface.</span><br>
<span class="lineno">105</span><span class="keyword" id="5745354">func</span>&nbsp;<span class="op" id="5745359">(</span><span class="ident" id="5745360">n</span>&nbsp;<span class="op" id="5745362">*</span><span class="ident" id="5745363"><a href="/database/sql/sql.go.html#5745227">NullInt64</a></span><span class="op" id="5745372">)</span>&nbsp;<span class="ident" id="5745374">Scan</span><span class="op" id="5745378">(</span><span class="ident" id="5745379">value</span>&nbsp;<span class="keyword" id="5745385">interface</span><span class="op" id="5745394">{</span><span class="op" id="5745395">}</span><span class="op" id="5745396">)</span>&nbsp;<span class="builtintype" id="5745398">error</span>&nbsp;<span class="op" id="5745404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5745407">if</span>&nbsp;<span class="ident" id="5745410"><a href="/database/sql/sql.go.html#5745379">value</a></span>&nbsp;<span class="op" id="5745416">==</span>&nbsp;<span class="ident" id="5745419">nil</span>&nbsp;<span class="op" id="5745423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5745427"><a href="/database/sql/sql.go.html#5745360">n</a></span><span class="op" id="5745428">.</span><span class="ident" id="5745429">Int64</span><span class="op" id="5745434">,</span>&nbsp;<span class="ident" id="5745436"><a href="/database/sql/sql.go.html#5745360">n</a></span><span class="op" id="5745437">.</span><span class="ident" id="5745438">Valid</span>&nbsp;<span class="op" id="5745444">=</span>&nbsp;<span class="num" id="5745446">0</span><span class="op" id="5745447">,</span>&nbsp;<span class="ident" id="5745449">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5745457">return</span>&nbsp;<span class="ident" id="5745464">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5745469">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5745472"><a href="/database/sql/sql.go.html#5745360">n</a></span><span class="op" id="5745473">.</span><span class="ident" id="5745474">Valid</span>&nbsp;<span class="op" id="5745480">=</span>&nbsp;<span class="ident" id="5745482">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5745488">return</span>&nbsp;<span class="ident" id="5745495"><a href="/database/sql/convert.go.html#5737952">convertAssign</a></span><span class="op" id="5745508">(</span><span class="op" id="5745509">&amp;</span><span class="ident" id="5745510"><a href="/database/sql/sql.go.html#5745360">n</a></span><span class="op" id="5745511">.</span><span class="ident" id="5745512">Int64</span><span class="op" id="5745517">,</span>&nbsp;<span class="ident" id="5745519"><a href="/database/sql/sql.go.html#5745379">value</a></span><span class="op" id="5745524">)</span><br>
<span class="lineno"></span><span class="op" id="5745526">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5745529">//&nbsp;Value&nbsp;implements&nbsp;the&nbsp;driver&nbsp;Valuer&nbsp;interface.</span><br>
<span class="lineno">115</span><span class="keyword" id="5745578">func</span>&nbsp;<span class="op" id="5745583">(</span><span class="ident" id="5745584">n</span>&nbsp;<span class="ident" id="5745586"><a href="/database/sql/sql.go.html#5745227">NullInt64</a></span><span class="op" id="5745595">)</span>&nbsp;<span class="ident" id="5745597">Value</span><span class="op" id="5745602">(</span><span class="op" id="5745603">)</span>&nbsp;<span class="op" id="5745605">(</span><span class="ident" id="5745606"><a href="/database/sql/sql.go.html#5743212">driver</a></span><span class="op" id="5745612">.</span><span class="ident" id="5745613">Value</span><span class="op" id="5745618">,</span>&nbsp;<span class="builtintype" id="5745620">error</span><span class="op" id="5745625">)</span>&nbsp;<span class="op" id="5745627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5745630">if</span>&nbsp;<span class="op" id="5745633">!</span><span class="ident" id="5745634"><a href="/database/sql/sql.go.html#5745584">n</a></span><span class="op" id="5745635">.</span><span class="ident" id="5745636">Valid</span>&nbsp;<span class="op" id="5745642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5745646">return</span>&nbsp;<span class="ident" id="5745653">nil</span><span class="op" id="5745656">,</span>&nbsp;<span class="ident" id="5745658">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5745663">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5745666">return</span>&nbsp;<span class="ident" id="5745673"><a href="/database/sql/sql.go.html#5745584">n</a></span><span class="op" id="5745674">.</span><span class="ident" id="5745675">Int64</span><span class="op" id="5745680">,</span>&nbsp;<span class="ident" id="5745682">nil</span><br>
<span class="lineno">120</span><span class="op" id="5745686">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5745689">//&nbsp;NullFloat64&nbsp;represents&nbsp;a&nbsp;float64&nbsp;that&nbsp;may&nbsp;be&nbsp;null.</span><br>
<span class="lineno"></span><span class="comment" id="5745743">//&nbsp;NullFloat64&nbsp;implements&nbsp;the&nbsp;Scanner&nbsp;interface&nbsp;so</span><br>
<span class="lineno"></span><span class="comment" id="5745794">//&nbsp;it&nbsp;can&nbsp;be&nbsp;used&nbsp;as&nbsp;a&nbsp;scan&nbsp;destination,&nbsp;similar&nbsp;to&nbsp;NullString.</span><br>
<span class="lineno">125</span><span class="keyword" id="5745858">type</span>&nbsp;<span class="ident" id="5745863">NullFloat64</span>&nbsp;<span class="keyword" id="5745875">struct</span>&nbsp;<span class="op" id="5745882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5745885">Float64</span>&nbsp;<span class="builtintype" id="5745893">float64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5745902">Valid</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5745910">bool</span>&nbsp;<span class="comment" id="5745915">//&nbsp;Valid&nbsp;is&nbsp;true&nbsp;if&nbsp;Float64&nbsp;is&nbsp;not&nbsp;NULL</span><br>
<span class="lineno"></span><span class="op" id="5745955">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="5745958">//&nbsp;Scan&nbsp;implements&nbsp;the&nbsp;Scanner&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="5746000">func</span>&nbsp;<span class="op" id="5746005">(</span><span class="ident" id="5746006">n</span>&nbsp;<span class="op" id="5746008">*</span><span class="ident" id="5746009"><a href="/database/sql/sql.go.html#5745863">NullFloat64</a></span><span class="op" id="5746020">)</span>&nbsp;<span class="ident" id="5746022">Scan</span><span class="op" id="5746026">(</span><span class="ident" id="5746027">value</span>&nbsp;<span class="keyword" id="5746033">interface</span><span class="op" id="5746042">{</span><span class="op" id="5746043">}</span><span class="op" id="5746044">)</span>&nbsp;<span class="builtintype" id="5746046">error</span>&nbsp;<span class="op" id="5746052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5746055">if</span>&nbsp;<span class="ident" id="5746058"><a href="/database/sql/sql.go.html#5746027">value</a></span>&nbsp;<span class="op" id="5746064">==</span>&nbsp;<span class="ident" id="5746067">nil</span>&nbsp;<span class="op" id="5746071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5746075"><a href="/database/sql/sql.go.html#5746006">n</a></span><span class="op" id="5746076">.</span><span class="ident" id="5746077">Float64</span><span class="op" id="5746084">,</span>&nbsp;<span class="ident" id="5746086"><a href="/database/sql/sql.go.html#5746006">n</a></span><span class="op" id="5746087">.</span><span class="ident" id="5746088">Valid</span>&nbsp;<span class="op" id="5746094">=</span>&nbsp;<span class="num" id="5746096">0</span><span class="op" id="5746097">,</span>&nbsp;<span class="ident" id="5746099">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5746107">return</span>&nbsp;<span class="ident" id="5746114">nil</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5746119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5746122"><a href="/database/sql/sql.go.html#5746006">n</a></span><span class="op" id="5746123">.</span><span class="ident" id="5746124">Valid</span>&nbsp;<span class="op" id="5746130">=</span>&nbsp;<span class="ident" id="5746132">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5746138">return</span>&nbsp;<span class="ident" id="5746145"><a href="/database/sql/convert.go.html#5737952">convertAssign</a></span><span class="op" id="5746158">(</span><span class="op" id="5746159">&amp;</span><span class="ident" id="5746160"><a href="/database/sql/sql.go.html#5746006">n</a></span><span class="op" id="5746161">.</span><span class="ident" id="5746162">Float64</span><span class="op" id="5746169">,</span>&nbsp;<span class="ident" id="5746171"><a href="/database/sql/sql.go.html#5746027">value</a></span><span class="op" id="5746176">)</span><br>
<span class="lineno"></span><span class="op" id="5746178">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span><span class="comment" id="5746181">//&nbsp;Value&nbsp;implements&nbsp;the&nbsp;driver&nbsp;Valuer&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="5746230">func</span>&nbsp;<span class="op" id="5746235">(</span><span class="ident" id="5746236">n</span>&nbsp;<span class="ident" id="5746238"><a href="/database/sql/sql.go.html#5745863">NullFloat64</a></span><span class="op" id="5746249">)</span>&nbsp;<span class="ident" id="5746251">Value</span><span class="op" id="5746256">(</span><span class="op" id="5746257">)</span>&nbsp;<span class="op" id="5746259">(</span><span class="ident" id="5746260"><a href="/database/sql/sql.go.html#5743212">driver</a></span><span class="op" id="5746266">.</span><span class="ident" id="5746267">Value</span><span class="op" id="5746272">,</span>&nbsp;<span class="builtintype" id="5746274">error</span><span class="op" id="5746279">)</span>&nbsp;<span class="op" id="5746281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5746284">if</span>&nbsp;<span class="op" id="5746287">!</span><span class="ident" id="5746288"><a href="/database/sql/sql.go.html#5746236">n</a></span><span class="op" id="5746289">.</span><span class="ident" id="5746290">Valid</span>&nbsp;<span class="op" id="5746296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5746300">return</span>&nbsp;<span class="ident" id="5746307">nil</span><span class="op" id="5746310">,</span>&nbsp;<span class="ident" id="5746312">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5746317">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5746320">return</span>&nbsp;<span class="ident" id="5746327"><a href="/database/sql/sql.go.html#5746236">n</a></span><span class="op" id="5746328">.</span><span class="ident" id="5746329">Float64</span><span class="op" id="5746336">,</span>&nbsp;<span class="ident" id="5746338">nil</span><br>
<span class="lineno"></span><span class="op" id="5746342">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5746345">//&nbsp;NullBool&nbsp;represents&nbsp;a&nbsp;bool&nbsp;that&nbsp;may&nbsp;be&nbsp;null.</span><br>
<span class="lineno"></span><span class="comment" id="5746393">//&nbsp;NullBool&nbsp;implements&nbsp;the&nbsp;Scanner&nbsp;interface&nbsp;so</span><br>
<span class="lineno">150</span><span class="comment" id="5746441">//&nbsp;it&nbsp;can&nbsp;be&nbsp;used&nbsp;as&nbsp;a&nbsp;scan&nbsp;destination,&nbsp;similar&nbsp;to&nbsp;NullString.</span><br>
<span class="lineno"></span><span class="keyword" id="5746505">type</span>&nbsp;<span class="ident" id="5746510">NullBool</span>&nbsp;<span class="keyword" id="5746519">struct</span>&nbsp;<span class="op" id="5746526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5746529">Bool</span>&nbsp;&nbsp;<span class="builtintype" id="5746535">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5746541">Valid</span>&nbsp;<span class="builtintype" id="5746547">bool</span>&nbsp;<span class="comment" id="5746552">//&nbsp;Valid&nbsp;is&nbsp;true&nbsp;if&nbsp;Bool&nbsp;is&nbsp;not&nbsp;NULL</span><br>
<span class="lineno"></span><span class="op" id="5746589">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="comment" id="5746592">//&nbsp;Scan&nbsp;implements&nbsp;the&nbsp;Scanner&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="5746634">func</span>&nbsp;<span class="op" id="5746639">(</span><span class="ident" id="5746640">n</span>&nbsp;<span class="op" id="5746642">*</span><span class="ident" id="5746643"><a href="/database/sql/sql.go.html#5746510">NullBool</a></span><span class="op" id="5746651">)</span>&nbsp;<span class="ident" id="5746653">Scan</span><span class="op" id="5746657">(</span><span class="ident" id="5746658">value</span>&nbsp;<span class="keyword" id="5746664">interface</span><span class="op" id="5746673">{</span><span class="op" id="5746674">}</span><span class="op" id="5746675">)</span>&nbsp;<span class="builtintype" id="5746677">error</span>&nbsp;<span class="op" id="5746683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5746686">if</span>&nbsp;<span class="ident" id="5746689"><a href="/database/sql/sql.go.html#5746658">value</a></span>&nbsp;<span class="op" id="5746695">==</span>&nbsp;<span class="ident" id="5746698">nil</span>&nbsp;<span class="op" id="5746702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5746706"><a href="/database/sql/sql.go.html#5746640">n</a></span><span class="op" id="5746707">.</span><span class="ident" id="5746708">Bool</span><span class="op" id="5746712">,</span>&nbsp;<span class="ident" id="5746714"><a href="/database/sql/sql.go.html#5746640">n</a></span><span class="op" id="5746715">.</span><span class="ident" id="5746716">Valid</span>&nbsp;<span class="op" id="5746722">=</span>&nbsp;<span class="ident" id="5746724">false</span><span class="op" id="5746729">,</span>&nbsp;<span class="ident" id="5746731">false</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5746739">return</span>&nbsp;<span class="ident" id="5746746">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5746751">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5746754"><a href="/database/sql/sql.go.html#5746640">n</a></span><span class="op" id="5746755">.</span><span class="ident" id="5746756">Valid</span>&nbsp;<span class="op" id="5746762">=</span>&nbsp;<span class="ident" id="5746764">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5746770">return</span>&nbsp;<span class="ident" id="5746777"><a href="/database/sql/convert.go.html#5737952">convertAssign</a></span><span class="op" id="5746790">(</span><span class="op" id="5746791">&amp;</span><span class="ident" id="5746792"><a href="/database/sql/sql.go.html#5746640">n</a></span><span class="op" id="5746793">.</span><span class="ident" id="5746794">Bool</span><span class="op" id="5746798">,</span>&nbsp;<span class="ident" id="5746800"><a href="/database/sql/sql.go.html#5746658">value</a></span><span class="op" id="5746805">)</span><br>
<span class="lineno"></span><span class="op" id="5746807">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="comment" id="5746810">//&nbsp;Value&nbsp;implements&nbsp;the&nbsp;driver&nbsp;Valuer&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="5746859">func</span>&nbsp;<span class="op" id="5746864">(</span><span class="ident" id="5746865">n</span>&nbsp;<span class="ident" id="5746867"><a href="/database/sql/sql.go.html#5746510">NullBool</a></span><span class="op" id="5746875">)</span>&nbsp;<span class="ident" id="5746877">Value</span><span class="op" id="5746882">(</span><span class="op" id="5746883">)</span>&nbsp;<span class="op" id="5746885">(</span><span class="ident" id="5746886"><a href="/database/sql/sql.go.html#5743212">driver</a></span><span class="op" id="5746892">.</span><span class="ident" id="5746893">Value</span><span class="op" id="5746898">,</span>&nbsp;<span class="builtintype" id="5746900">error</span><span class="op" id="5746905">)</span>&nbsp;<span class="op" id="5746907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5746910">if</span>&nbsp;<span class="op" id="5746913">!</span><span class="ident" id="5746914"><a href="/database/sql/sql.go.html#5746865">n</a></span><span class="op" id="5746915">.</span><span class="ident" id="5746916">Valid</span>&nbsp;<span class="op" id="5746922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5746926">return</span>&nbsp;<span class="ident" id="5746933">nil</span><span class="op" id="5746936">,</span>&nbsp;<span class="ident" id="5746938">nil</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5746943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5746946">return</span>&nbsp;<span class="ident" id="5746953"><a href="/database/sql/sql.go.html#5746865">n</a></span><span class="op" id="5746954">.</span><span class="ident" id="5746955">Bool</span><span class="op" id="5746959">,</span>&nbsp;<span class="ident" id="5746961">nil</span><br>
<span class="lineno"></span><span class="op" id="5746965">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5746968">//&nbsp;Scanner&nbsp;is&nbsp;an&nbsp;interface&nbsp;used&nbsp;by&nbsp;Scan.</span><br>
<span class="lineno">175</span><span class="keyword" id="5747009">type</span>&nbsp;<span class="ident" id="5747014">Scanner</span>&nbsp;<span class="keyword" id="5747022">interface</span>&nbsp;<span class="op" id="5747032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5747035">//&nbsp;Scan&nbsp;assigns&nbsp;a&nbsp;value&nbsp;from&nbsp;a&nbsp;database&nbsp;driver.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5747084">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5747088">//&nbsp;The&nbsp;src&nbsp;value&nbsp;will&nbsp;be&nbsp;of&nbsp;one&nbsp;of&nbsp;the&nbsp;following&nbsp;restricted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5747149">//&nbsp;set&nbsp;of&nbsp;types:</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5747167">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5747171">//&nbsp;&nbsp;&nbsp;&nbsp;int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5747184">//&nbsp;&nbsp;&nbsp;&nbsp;float64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5747199">//&nbsp;&nbsp;&nbsp;&nbsp;bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5747211">//&nbsp;&nbsp;&nbsp;&nbsp;[]byte</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5747225">//&nbsp;&nbsp;&nbsp;&nbsp;string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5747239">//&nbsp;&nbsp;&nbsp;&nbsp;time.Time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5747256">//&nbsp;&nbsp;&nbsp;&nbsp;nil&nbsp;-&nbsp;for&nbsp;NULL&nbsp;values</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5747285">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5747289">//&nbsp;An&nbsp;error&nbsp;should&nbsp;be&nbsp;returned&nbsp;if&nbsp;the&nbsp;value&nbsp;can&nbsp;not&nbsp;be&nbsp;stored</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5747352">//&nbsp;without&nbsp;loss&nbsp;of&nbsp;information.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5747385">Scan</span><span class="op" id="5747389">(</span><span class="ident" id="5747390">src</span>&nbsp;<span class="keyword" id="5747394">interface</span><span class="op" id="5747403">{</span><span class="op" id="5747404">}</span><span class="op" id="5747405">)</span>&nbsp;<span class="builtintype" id="5747407">error</span><br>
<span class="lineno"></span><span class="op" id="5747413">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5747416">//&nbsp;ErrNoRows&nbsp;is&nbsp;returned&nbsp;by&nbsp;Scan&nbsp;when&nbsp;QueryRow&nbsp;doesn&#39;t&nbsp;return&nbsp;a</span><br>
<span class="lineno">195</span><span class="comment" id="5747480">//&nbsp;row.&nbsp;In&nbsp;such&nbsp;a&nbsp;case,&nbsp;QueryRow&nbsp;returns&nbsp;a&nbsp;placeholder&nbsp;*Row&nbsp;value&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="5747551">//&nbsp;defers&nbsp;this&nbsp;error&nbsp;until&nbsp;a&nbsp;Scan.</span><br>
<span class="lineno"></span><span class="keyword" id="5747586">var</span>&nbsp;<span class="ident" id="5747590">ErrNoRows</span>&nbsp;<span class="op" id="5747600">=</span>&nbsp;<span class="ident" id="5747602"><a href="/database/sql/sql.go.html#5743235">errors</a></span><span class="op" id="5747608">.</span><span class="ident" id="5747609">New</span><span class="op" id="5747612">(</span><span class="string" id="5747613">&#34;sql:&nbsp;no&nbsp;rows&nbsp;in&nbsp;result&nbsp;set&#34;</span><span class="op" id="5747641">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5747644">//&nbsp;DB&nbsp;is&nbsp;a&nbsp;database&nbsp;handle&nbsp;representing&nbsp;a&nbsp;pool&nbsp;of&nbsp;zero&nbsp;or&nbsp;more</span><br>
<span class="lineno">200</span><span class="comment" id="5747707">//&nbsp;underlying&nbsp;connections.&nbsp;It&#39;s&nbsp;safe&nbsp;for&nbsp;concurrent&nbsp;use&nbsp;by&nbsp;multiple</span><br>
<span class="lineno"></span><span class="comment" id="5747775">//&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="comment" id="5747790">//</span><br>
<span class="lineno"></span><span class="comment" id="5747793">//&nbsp;The&nbsp;sql&nbsp;package&nbsp;creates&nbsp;and&nbsp;frees&nbsp;connections&nbsp;automatically;&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="5747860">//&nbsp;also&nbsp;maintains&nbsp;a&nbsp;free&nbsp;pool&nbsp;of&nbsp;idle&nbsp;connections.&nbsp;If&nbsp;the&nbsp;database&nbsp;has</span><br>
<span class="lineno">205</span><span class="comment" id="5747931">//&nbsp;a&nbsp;concept&nbsp;of&nbsp;per-connection&nbsp;state,&nbsp;such&nbsp;state&nbsp;can&nbsp;only&nbsp;be&nbsp;reliably</span><br>
<span class="lineno"></span><span class="comment" id="5748001">//&nbsp;observed&nbsp;within&nbsp;a&nbsp;transaction.&nbsp;Once&nbsp;DB.Begin&nbsp;is&nbsp;called,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5748064">//&nbsp;returned&nbsp;Tx&nbsp;is&nbsp;bound&nbsp;to&nbsp;a&nbsp;single&nbsp;connection.&nbsp;Once&nbsp;Commit&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="5748127">//&nbsp;Rollback&nbsp;is&nbsp;called&nbsp;on&nbsp;the&nbsp;transaction,&nbsp;that&nbsp;transaction&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="5748188">//&nbsp;connection&nbsp;is&nbsp;returned&nbsp;to&nbsp;DB&#39;s&nbsp;idle&nbsp;connection&nbsp;pool.&nbsp;The&nbsp;pool&nbsp;size</span><br>
<span class="lineno">210</span><span class="comment" id="5748258">//&nbsp;can&nbsp;be&nbsp;controlled&nbsp;with&nbsp;SetMaxIdleConns.</span><br>
<span class="lineno"></span><span class="keyword" id="5748301">type</span>&nbsp;<span class="ident" id="5748306">DB</span>&nbsp;<span class="keyword" id="5748309">struct</span>&nbsp;<span class="op" id="5748316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5748319">driver</span>&nbsp;<span class="ident" id="5748326"><a href="/database/sql/sql.go.html#5743212">driver</a></span><span class="op" id="5748332">.</span><span class="ident" id="5748333">Driver</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5748341">dsn</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5748348">string</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5748357">mu</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5748370"><a href="/database/sql/sql.go.html#5743277">sync</a></span><span class="op" id="5748374">.</span><span class="ident" id="5748375">Mutex</span>&nbsp;<span class="comment" id="5748381">//&nbsp;protects&nbsp;following&nbsp;fields</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5748411">freeConn</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5748424">[</span><span class="op" id="5748425">]</span><span class="op" id="5748426">*</span><span class="ident" id="5748427"><a href="/database/sql/sql.go.html#5749298">driverConn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5748439">connRequests</span>&nbsp;<span class="op" id="5748452">[</span><span class="op" id="5748453">]</span><span class="keyword" id="5748454">chan</span>&nbsp;<span class="ident" id="5748459"><a href="/database/sql/sql.go.html#5759409">connRequest</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5748472">numOpen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5748485">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5748490">pendingOpens</span>&nbsp;<span class="builtintype" id="5748503">int</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5748508">//&nbsp;Used&nbsp;to&nbsp;signal&nbsp;the&nbsp;need&nbsp;for&nbsp;new&nbsp;connections</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5748556">//&nbsp;a&nbsp;goroutine&nbsp;running&nbsp;connectionOpener()&nbsp;reads&nbsp;on&nbsp;this&nbsp;chan&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5748622">//&nbsp;maybeOpenNewConnections&nbsp;sends&nbsp;on&nbsp;the&nbsp;chan&nbsp;(one&nbsp;send&nbsp;per&nbsp;needed&nbsp;connection)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5748701">//&nbsp;It&nbsp;is&nbsp;closed&nbsp;during&nbsp;db.Close().&nbsp;The&nbsp;close&nbsp;tells&nbsp;the&nbsp;connectionOpener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5748774">//&nbsp;goroutine&nbsp;to&nbsp;exit.</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5748797">openerCh</span>&nbsp;<span class="keyword" id="5748806">chan</span>&nbsp;<span class="keyword" id="5748811">struct</span><span class="op" id="5748817">{</span><span class="op" id="5748818">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5748821">closed</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5748830">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5748836">dep</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5748845">map</span><span class="op" id="5748848">[</span><span class="ident" id="5748849"><a href="/database/sql/sql.go.html#5752169">finalCloser</a></span><span class="op" id="5748860">]</span><span class="ident" id="5748861"><a href="/database/sql/sql.go.html#5752015">depSet</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5748869">lastPut</span>&nbsp;&nbsp;<span class="keyword" id="5748878">map</span><span class="op" id="5748881">[</span><span class="op" id="5748882">*</span><span class="ident" id="5748883"><a href="/database/sql/sql.go.html#5749298">driverConn</a></span><span class="op" id="5748893">]</span><span class="builtintype" id="5748894">string</span>&nbsp;<span class="comment" id="5748901">//&nbsp;stacktrace&nbsp;of&nbsp;last&nbsp;conn&#39;s&nbsp;put;&nbsp;debug&nbsp;only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5748947">maxIdle</span>&nbsp;&nbsp;<span class="builtintype" id="5748956">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5748979">//&nbsp;zero&nbsp;means&nbsp;defaultMaxIdleConns;&nbsp;negative&nbsp;means&nbsp;0</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5749032">maxOpen</span>&nbsp;&nbsp;<span class="builtintype" id="5749041">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5749064">//&nbsp;&lt;=&nbsp;0&nbsp;means&nbsp;unlimited</span><br>
<span class="lineno"></span><span class="op" id="5749088">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5749091">//&nbsp;driverConn&nbsp;wraps&nbsp;a&nbsp;driver.Conn&nbsp;with&nbsp;a&nbsp;mutex,&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5749142">//&nbsp;be&nbsp;held&nbsp;during&nbsp;all&nbsp;calls&nbsp;into&nbsp;the&nbsp;Conn.&nbsp;(including&nbsp;any&nbsp;calls&nbsp;onto</span><br>
<span class="lineno">235</span><span class="comment" id="5749211">//&nbsp;interfaces&nbsp;returned&nbsp;via&nbsp;that&nbsp;Conn,&nbsp;such&nbsp;as&nbsp;calls&nbsp;on&nbsp;Tx,&nbsp;Stmt,</span><br>
<span class="lineno"></span><span class="comment" id="5749276">//&nbsp;Result,&nbsp;Rows)</span><br>
<span class="lineno"></span><span class="keyword" id="5749293">type</span>&nbsp;<span class="ident" id="5749298">driverConn</span>&nbsp;<span class="keyword" id="5749309">struct</span>&nbsp;<span class="op" id="5749316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5749319">db</span>&nbsp;<span class="op" id="5749322">*</span><span class="ident" id="5749323"><a href="/database/sql/sql.go.html#5748306">DB</a></span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5749328"><a href="/database/sql/sql.go.html#5743277">sync</a></span><span class="op" id="5749332">.</span><span class="ident" id="5749333">Mutex</span>&nbsp;&nbsp;<span class="comment" id="5749340">//&nbsp;guards&nbsp;following</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5749361">ci</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5749373"><a href="/database/sql/sql.go.html#5743212">driver</a></span><span class="op" id="5749379">.</span><span class="ident" id="5749380">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5749386">closed</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5749398">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5749404">finalClosed</span>&nbsp;<span class="builtintype" id="5749416">bool</span>&nbsp;<span class="comment" id="5749421">//&nbsp;ci.Close&nbsp;has&nbsp;been&nbsp;called</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5749450">openStmt</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5749462">map</span><span class="op" id="5749465">[</span><span class="ident" id="5749466"><a href="/database/sql/sql.go.html#5743212">driver</a></span><span class="op" id="5749472">.</span><span class="ident" id="5749473">Stmt</span><span class="op" id="5749477">]</span><span class="builtintype" id="5749478">bool</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5749485">//&nbsp;guarded&nbsp;by&nbsp;db.mu</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5749506">inUse</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5749517">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5749523">onPut</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5749534">[</span><span class="op" id="5749535">]</span><span class="keyword" id="5749536">func</span><span class="op" id="5749540">(</span><span class="op" id="5749541">)</span>&nbsp;<span class="comment" id="5749543">//&nbsp;code&nbsp;(with&nbsp;db.mu&nbsp;held)&nbsp;run&nbsp;when&nbsp;conn&nbsp;is&nbsp;next&nbsp;returned</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5749601">dbmuClosed</span>&nbsp;<span class="builtintype" id="5749612">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5749621">//&nbsp;same&nbsp;as&nbsp;closed,&nbsp;but&nbsp;guarded&nbsp;by&nbsp;db.mu,&nbsp;for&nbsp;connIfFree</span><br>
<span class="lineno">250</span><span class="op" id="5749677">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5749680">func</span>&nbsp;<span class="op" id="5749685">(</span><span class="ident" id="5749686">dc</span>&nbsp;<span class="op" id="5749689">*</span><span class="ident" id="5749690"><a href="/database/sql/sql.go.html#5749298">driverConn</a></span><span class="op" id="5749700">)</span>&nbsp;<span class="ident" id="5749702">releaseConn</span><span class="op" id="5749713">(</span><span class="ident" id="5749714">err</span>&nbsp;<span class="builtintype" id="5749718">error</span><span class="op" id="5749723">)</span>&nbsp;<span class="op" id="5749725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5749728"><a href="/database/sql/sql.go.html#5749686">dc</a></span><span class="op" id="5749730">.</span><span class="ident" id="5749731">db</span><span class="op" id="5749733">.</span><span class="ident" id="5749734">putConn</span><span class="op" id="5749741">(</span><span class="ident" id="5749742"><a href="/database/sql/sql.go.html#5749686">dc</a></span><span class="op" id="5749744">,</span>&nbsp;<span class="ident" id="5749746"><a href="/database/sql/sql.go.html#5749714">err</a></span><span class="op" id="5749749">)</span><br>
<span class="lineno"></span><span class="op" id="5749751">}</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span><span class="keyword" id="5749754">func</span>&nbsp;<span class="op" id="5749759">(</span><span class="ident" id="5749760">dc</span>&nbsp;<span class="op" id="5749763">*</span><span class="ident" id="5749764"><a href="/database/sql/sql.go.html#5749298">driverConn</a></span><span class="op" id="5749774">)</span>&nbsp;<span class="ident" id="5749776">removeOpenStmt</span><span class="op" id="5749790">(</span><span class="ident" id="5749791">si</span>&nbsp;<span class="ident" id="5749794"><a href="/database/sql/sql.go.html#5743212">driver</a></span><span class="op" id="5749800">.</span><span class="ident" id="5749801">Stmt</span><span class="op" id="5749805">)</span>&nbsp;<span class="op" id="5749807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5749810"><a href="/database/sql/sql.go.html#5749760">dc</a></span><span class="op" id="5749812">.</span><span class="ident" id="5749813">Lock</span><span class="op" id="5749817">(</span><span class="op" id="5749818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5749821">defer</span>&nbsp;<span class="ident" id="5749827"><a href="/database/sql/sql.go.html#5749760">dc</a></span><span class="op" id="5749829">.</span><span class="ident" id="5749830">Unlock</span><span class="op" id="5749836">(</span><span class="op" id="5749837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5749840">delete</span><span class="op" id="5749846">(</span><span class="ident" id="5749847"><a href="/database/sql/sql.go.html#5749760">dc</a></span><span class="op" id="5749849">.</span><span class="ident" id="5749850">openStmt</span><span class="op" id="5749858">,</span>&nbsp;<span class="ident" id="5749860"><a href="/database/sql/sql.go.html#5749791">si</a></span><span class="op" id="5749862">)</span><br>
<span class="lineno">260</span><span class="op" id="5749864">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5749867">func</span>&nbsp;<span class="op" id="5749872">(</span><span class="ident" id="5749873">dc</span>&nbsp;<span class="op" id="5749876">*</span><span class="ident" id="5749877"><a href="/database/sql/sql.go.html#5749298">driverConn</a></span><span class="op" id="5749887">)</span>&nbsp;<span class="ident" id="5749889">prepareLocked</span><span class="op" id="5749902">(</span><span class="ident" id="5749903">query</span>&nbsp;<span class="builtintype" id="5749909">string</span><span class="op" id="5749915">)</span>&nbsp;<span class="op" id="5749917">(</span><span class="ident" id="5749918"><a href="/database/sql/sql.go.html#5743212">driver</a></span><span class="op" id="5749924">.</span><span class="ident" id="5749925">Stmt</span><span class="op" id="5749929">,</span>&nbsp;<span class="builtintype" id="5749931">error</span><span class="op" id="5749936">)</span>&nbsp;<span class="op" id="5749938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5749941">si</span><span class="op" id="5749943">,</span>&nbsp;<span class="ident" id="5749945">err</span>&nbsp;<span class="op" id="5749949">:=</span>&nbsp;<span class="ident" id="5749952"><a href="/database/sql/sql.go.html#5749873">dc</a></span><span class="op" id="5749954">.</span><span class="ident" id="5749955">ci</span><span class="op" id="5749957">.</span><span class="ident" id="5749958">Prepare</span><span class="op" id="5749965">(</span><span class="ident" id="5749966"><a href="/database/sql/sql.go.html#5749903">query</a></span><span class="op" id="5749971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5749974">if</span>&nbsp;<span class="ident" id="5749977"><a href="/database/sql/sql.go.html#5749945">err</a></span>&nbsp;<span class="op" id="5749981">==</span>&nbsp;<span class="ident" id="5749984">nil</span>&nbsp;<span class="op" id="5749988">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5749992">//&nbsp;Track&nbsp;each&nbsp;driverConn&#39;s&nbsp;open&nbsp;statements,&nbsp;so&nbsp;we&nbsp;can&nbsp;close&nbsp;them</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5750059">//&nbsp;before&nbsp;closing&nbsp;the&nbsp;conn.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5750089">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5750094">//&nbsp;TODO(bradfitz):&nbsp;let&nbsp;drivers&nbsp;opt&nbsp;out&nbsp;of&nbsp;caring&nbsp;about</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5750151">//&nbsp;stmt&nbsp;closes&nbsp;if&nbsp;the&nbsp;conn&nbsp;is&nbsp;about&nbsp;to&nbsp;close&nbsp;anyway?&nbsp;For&nbsp;now</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5750214">//&nbsp;do&nbsp;the&nbsp;safe&nbsp;thing,&nbsp;in&nbsp;case&nbsp;stmts&nbsp;need&nbsp;to&nbsp;be&nbsp;closed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5750271">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5750276">//&nbsp;TODO(bradfitz):&nbsp;after&nbsp;Go&nbsp;1.2,&nbsp;closing&nbsp;driver.Stmts</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5750332">//&nbsp;should&nbsp;be&nbsp;moved&nbsp;to&nbsp;driverStmt,&nbsp;using&nbsp;unique</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5750381">//&nbsp;*driverStmts&nbsp;everywhere&nbsp;(including&nbsp;from</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5750426">//&nbsp;*Stmt.connStmt,&nbsp;instead&nbsp;of&nbsp;returning&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5750470">//&nbsp;driver.Stmt),&nbsp;using&nbsp;driverStmt&nbsp;as&nbsp;a&nbsp;pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5750519">//&nbsp;everywhere,&nbsp;and&nbsp;making&nbsp;it&nbsp;a&nbsp;finalCloser.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5750565">if</span>&nbsp;<span class="ident" id="5750568"><a href="/database/sql/sql.go.html#5749873">dc</a></span><span class="op" id="5750570">.</span><span class="ident" id="5750571">openStmt</span>&nbsp;<span class="op" id="5750580">==</span>&nbsp;<span class="ident" id="5750583">nil</span>&nbsp;<span class="op" id="5750587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5750592"><a href="/database/sql/sql.go.html#5749873">dc</a></span><span class="op" id="5750594">.</span><span class="ident" id="5750595">openStmt</span>&nbsp;<span class="op" id="5750604">=</span>&nbsp;<span class="builtinfunc" id="5750606">make</span><span class="op" id="5750610">(</span><span class="keyword" id="5750611">map</span><span class="op" id="5750614">[</span><span class="ident" id="5750615"><a href="/database/sql/sql.go.html#5743212">driver</a></span><span class="op" id="5750621">.</span><span class="ident" id="5750622">Stmt</span><span class="op" id="5750626">]</span><span class="builtintype" id="5750627">bool</span><span class="op" id="5750631">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5750635">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5750639"><a href="/database/sql/sql.go.html#5749873">dc</a></span><span class="op" id="5750641">.</span><span class="ident" id="5750642">openStmt</span><span class="op" id="5750650">[</span><span class="ident" id="5750651"><a href="/database/sql/sql.go.html#5749941">si</a></span><span class="op" id="5750653">]</span>&nbsp;<span class="op" id="5750655">=</span>&nbsp;<span class="ident" id="5750657">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5750663">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5750666">return</span>&nbsp;<span class="ident" id="5750673"><a href="/database/sql/sql.go.html#5749941">si</a></span><span class="op" id="5750675">,</span>&nbsp;<span class="ident" id="5750677"><a href="/database/sql/sql.go.html#5749945">err</a></span><br>
<span class="lineno"></span><span class="op" id="5750681">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span><span class="comment" id="5750684">//&nbsp;the&nbsp;dc.db&#39;s&nbsp;Mutex&nbsp;is&nbsp;held.</span><br>
<span class="lineno"></span><span class="keyword" id="5750714">func</span>&nbsp;<span class="op" id="5750719">(</span><span class="ident" id="5750720">dc</span>&nbsp;<span class="op" id="5750723">*</span><span class="ident" id="5750724"><a href="/database/sql/sql.go.html#5749298">driverConn</a></span><span class="op" id="5750734">)</span>&nbsp;<span class="ident" id="5750736">closeDBLocked</span><span class="op" id="5750749">(</span><span class="op" id="5750750">)</span>&nbsp;<span class="keyword" id="5750752">func</span><span class="op" id="5750756">(</span><span class="op" id="5750757">)</span>&nbsp;<span class="builtintype" id="5750759">error</span>&nbsp;<span class="op" id="5750765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5750768"><a href="/database/sql/sql.go.html#5750720">dc</a></span><span class="op" id="5750770">.</span><span class="ident" id="5750771">Lock</span><span class="op" id="5750775">(</span><span class="op" id="5750776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5750779">defer</span>&nbsp;<span class="ident" id="5750785"><a href="/database/sql/sql.go.html#5750720">dc</a></span><span class="op" id="5750787">.</span><span class="ident" id="5750788">Unlock</span><span class="op" id="5750794">(</span><span class="op" id="5750795">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5750798">if</span>&nbsp;<span class="ident" id="5750801"><a href="/database/sql/sql.go.html#5750720">dc</a></span><span class="op" id="5750803">.</span><span class="ident" id="5750804">closed</span>&nbsp;<span class="op" id="5750811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5750815">return</span>&nbsp;<span class="keyword" id="5750822">func</span><span class="op" id="5750826">(</span><span class="op" id="5750827">)</span>&nbsp;<span class="builtintype" id="5750829">error</span>&nbsp;<span class="op" id="5750835">{</span>&nbsp;<span class="keyword" id="5750837">return</span>&nbsp;<span class="ident" id="5750844"><a href="/database/sql/sql.go.html#5743235">errors</a></span><span class="op" id="5750850">.</span><span class="ident" id="5750851">New</span><span class="op" id="5750854">(</span><span class="string" id="5750855">&#34;sql:&nbsp;duplicate&nbsp;driverConn&nbsp;close&#34;</span><span class="op" id="5750888">)</span>&nbsp;<span class="op" id="5750890">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5750893">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5750896"><a href="/database/sql/sql.go.html#5750720">dc</a></span><span class="op" id="5750898">.</span><span class="ident" id="5750899">closed</span>&nbsp;<span class="op" id="5750906">=</span>&nbsp;<span class="ident" id="5750908">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5750914">return</span>&nbsp;<span class="ident" id="5750921"><a href="/database/sql/sql.go.html#5750720">dc</a></span><span class="op" id="5750923">.</span><span class="ident" id="5750924">db</span><span class="op" id="5750926">.</span><span class="ident" id="5750927">removeDepLocked</span><span class="op" id="5750942">(</span><span class="ident" id="5750943"><a href="/database/sql/sql.go.html#5750720">dc</a></span><span class="op" id="5750945">,</span>&nbsp;<span class="ident" id="5750947"><a href="/database/sql/sql.go.html#5750720">dc</a></span><span class="op" id="5750949">)</span><br>
<span class="lineno">295</span><span class="op" id="5750951">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5750954">func</span>&nbsp;<span class="op" id="5750959">(</span><span class="ident" id="5750960">dc</span>&nbsp;<span class="op" id="5750963">*</span><span class="ident" id="5750964"><a href="/database/sql/sql.go.html#5749298">driverConn</a></span><span class="op" id="5750974">)</span>&nbsp;<span class="ident" id="5750976">Close</span><span class="op" id="5750981">(</span><span class="op" id="5750982">)</span>&nbsp;<span class="builtintype" id="5750984">error</span>&nbsp;<span class="op" id="5750990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5750993"><a href="/database/sql/sql.go.html#5750960">dc</a></span><span class="op" id="5750995">.</span><span class="ident" id="5750996">Lock</span><span class="op" id="5751000">(</span><span class="op" id="5751001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5751004">if</span>&nbsp;<span class="ident" id="5751007"><a href="/database/sql/sql.go.html#5750960">dc</a></span><span class="op" id="5751009">.</span><span class="ident" id="5751010">closed</span>&nbsp;<span class="op" id="5751017">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5751021"><a href="/database/sql/sql.go.html#5750960">dc</a></span><span class="op" id="5751023">.</span><span class="ident" id="5751024">Unlock</span><span class="op" id="5751030">(</span><span class="op" id="5751031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5751035">return</span>&nbsp;<span class="ident" id="5751042"><a href="/database/sql/sql.go.html#5743235">errors</a></span><span class="op" id="5751048">.</span><span class="ident" id="5751049">New</span><span class="op" id="5751052">(</span><span class="string" id="5751053">&#34;sql:&nbsp;duplicate&nbsp;driverConn&nbsp;close&#34;</span><span class="op" id="5751086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5751089">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5751092"><a href="/database/sql/sql.go.html#5750960">dc</a></span><span class="op" id="5751094">.</span><span class="ident" id="5751095">closed</span>&nbsp;<span class="op" id="5751102">=</span>&nbsp;<span class="ident" id="5751104">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5751110"><a href="/database/sql/sql.go.html#5750960">dc</a></span><span class="op" id="5751112">.</span><span class="ident" id="5751113">Unlock</span><span class="op" id="5751119">(</span><span class="op" id="5751120">)</span>&nbsp;<span class="comment" id="5751122">//&nbsp;not&nbsp;defer;&nbsp;removeDep&nbsp;finalClose&nbsp;calls&nbsp;may&nbsp;need&nbsp;to&nbsp;lock</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5751182">//&nbsp;And&nbsp;now&nbsp;updates&nbsp;that&nbsp;require&nbsp;holding&nbsp;dc.mu.Lock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5751235"><a href="/database/sql/sql.go.html#5750960">dc</a></span><span class="op" id="5751237">.</span><span class="ident" id="5751238">db</span><span class="op" id="5751240">.</span><span class="ident" id="5751241">mu</span><span class="op" id="5751243">.</span><span class="ident" id="5751244">Lock</span><span class="op" id="5751248">(</span><span class="op" id="5751249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5751252"><a href="/database/sql/sql.go.html#5750960">dc</a></span><span class="op" id="5751254">.</span><span class="ident" id="5751255">dbmuClosed</span>&nbsp;<span class="op" id="5751266">=</span>&nbsp;<span class="ident" id="5751268">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5751274">fn</span>&nbsp;<span class="op" id="5751277">:=</span>&nbsp;<span class="ident" id="5751280"><a href="/database/sql/sql.go.html#5750960">dc</a></span><span class="op" id="5751282">.</span><span class="ident" id="5751283">db</span><span class="op" id="5751285">.</span><span class="ident" id="5751286">removeDepLocked</span><span class="op" id="5751301">(</span><span class="ident" id="5751302"><a href="/database/sql/sql.go.html#5750960">dc</a></span><span class="op" id="5751304">,</span>&nbsp;<span class="ident" id="5751306"><a href="/database/sql/sql.go.html#5750960">dc</a></span><span class="op" id="5751308">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5751311"><a href="/database/sql/sql.go.html#5750960">dc</a></span><span class="op" id="5751313">.</span><span class="ident" id="5751314">db</span><span class="op" id="5751316">.</span><span class="ident" id="5751317">mu</span><span class="op" id="5751319">.</span><span class="ident" id="5751320">Unlock</span><span class="op" id="5751326">(</span><span class="op" id="5751327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5751330">return</span>&nbsp;<span class="ident" id="5751337"><a href="/database/sql/sql.go.html#5751274">fn</a></span><span class="op" id="5751339">(</span><span class="op" id="5751340">)</span><br>
<span class="lineno"></span><span class="op" id="5751342">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5751345">func</span>&nbsp;<span class="op" id="5751350">(</span><span class="ident" id="5751351">dc</span>&nbsp;<span class="op" id="5751354">*</span><span class="ident" id="5751355"><a href="/database/sql/sql.go.html#5749298">driverConn</a></span><span class="op" id="5751365">)</span>&nbsp;<span class="ident" id="5751367">finalClose</span><span class="op" id="5751377">(</span><span class="op" id="5751378">)</span>&nbsp;<span class="builtintype" id="5751380">error</span>&nbsp;<span class="op" id="5751386">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5751389"><a href="/database/sql/sql.go.html#5751351">dc</a></span><span class="op" id="5751391">.</span><span class="ident" id="5751392">Lock</span><span class="op" id="5751396">(</span><span class="op" id="5751397">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5751401">for</span>&nbsp;<span class="ident" id="5751405">si</span>&nbsp;<span class="op" id="5751408">:=</span>&nbsp;<span class="keyword" id="5751411">range</span>&nbsp;<span class="ident" id="5751417"><a href="/database/sql/sql.go.html#5751351">dc</a></span><span class="op" id="5751419">.</span><span class="ident" id="5751420">openStmt</span>&nbsp;<span class="op" id="5751429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5751433"><a href="/database/sql/sql.go.html#5751405">si</a></span><span class="op" id="5751435">.</span><span class="ident" id="5751436">Close</span><span class="op" id="5751441">(</span><span class="op" id="5751442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5751445">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5751448"><a href="/database/sql/sql.go.html#5751351">dc</a></span><span class="op" id="5751450">.</span><span class="ident" id="5751451">openStmt</span>&nbsp;<span class="op" id="5751460">=</span>&nbsp;<span class="ident" id="5751462">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5751468">err</span>&nbsp;<span class="op" id="5751472">:=</span>&nbsp;<span class="ident" id="5751475"><a href="/database/sql/sql.go.html#5751351">dc</a></span><span class="op" id="5751477">.</span><span class="ident" id="5751478">ci</span><span class="op" id="5751480">.</span><span class="ident" id="5751481">Close</span><span class="op" id="5751486">(</span><span class="op" id="5751487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5751490"><a href="/database/sql/sql.go.html#5751351">dc</a></span><span class="op" id="5751492">.</span><span class="ident" id="5751493">ci</span>&nbsp;<span class="op" id="5751496">=</span>&nbsp;<span class="ident" id="5751498">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5751503"><a href="/database/sql/sql.go.html#5751351">dc</a></span><span class="op" id="5751505">.</span><span class="ident" id="5751506">finalClosed</span>&nbsp;<span class="op" id="5751518">=</span>&nbsp;<span class="ident" id="5751520">true</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5751526"><a href="/database/sql/sql.go.html#5751351">dc</a></span><span class="op" id="5751528">.</span><span class="ident" id="5751529">Unlock</span><span class="op" id="5751535">(</span><span class="op" id="5751536">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5751540"><a href="/database/sql/sql.go.html#5751351">dc</a></span><span class="op" id="5751542">.</span><span class="ident" id="5751543">db</span><span class="op" id="5751545">.</span><span class="ident" id="5751546">mu</span><span class="op" id="5751548">.</span><span class="ident" id="5751549">Lock</span><span class="op" id="5751553">(</span><span class="op" id="5751554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5751557"><a href="/database/sql/sql.go.html#5751351">dc</a></span><span class="op" id="5751559">.</span><span class="ident" id="5751560">db</span><span class="op" id="5751562">.</span><span class="ident" id="5751563">numOpen</span><span class="op" id="5751570">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5751574"><a href="/database/sql/sql.go.html#5751351">dc</a></span><span class="op" id="5751576">.</span><span class="ident" id="5751577">db</span><span class="op" id="5751579">.</span><span class="ident" id="5751580">maybeOpenNewConnections</span><span class="op" id="5751603">(</span><span class="op" id="5751604">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5751607"><a href="/database/sql/sql.go.html#5751351">dc</a></span><span class="op" id="5751609">.</span><span class="ident" id="5751610">db</span><span class="op" id="5751612">.</span><span class="ident" id="5751613">mu</span><span class="op" id="5751615">.</span><span class="ident" id="5751616">Unlock</span><span class="op" id="5751622">(</span><span class="op" id="5751623">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5751627">return</span>&nbsp;<span class="ident" id="5751634"><a href="/database/sql/sql.go.html#5751468">err</a></span><br>
<span class="lineno"></span><span class="op" id="5751638">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span><span class="comment" id="5751641">//&nbsp;driverStmt&nbsp;associates&nbsp;a&nbsp;driver.Stmt&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5751689">//&nbsp;*driverConn&nbsp;from&nbsp;which&nbsp;it&nbsp;came,&nbsp;so&nbsp;the&nbsp;driverConn&#39;s&nbsp;lock&nbsp;can&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="5751756">//&nbsp;held&nbsp;during&nbsp;calls.</span><br>
<span class="lineno"></span><span class="keyword" id="5751778">type</span>&nbsp;<span class="ident" id="5751783">driverStmt</span>&nbsp;<span class="keyword" id="5751794">struct</span>&nbsp;<span class="op" id="5751801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5751804"><a href="/database/sql/sql.go.html#5743277">sync</a></span><span class="op" id="5751808">.</span><span class="ident" id="5751809">Locker</span>&nbsp;<span class="comment" id="5751816">//&nbsp;the&nbsp;*driverConn</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5751836">si</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5751848"><a href="/database/sql/sql.go.html#5743212">driver</a></span><span class="op" id="5751854">.</span><span class="ident" id="5751855">Stmt</span><br>
<span class="lineno"></span><span class="op" id="5751860">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5751863">func</span>&nbsp;<span class="op" id="5751868">(</span><span class="ident" id="5751869">ds</span>&nbsp;<span class="op" id="5751872">*</span><span class="ident" id="5751873"><a href="/database/sql/sql.go.html#5751783">driverStmt</a></span><span class="op" id="5751883">)</span>&nbsp;<span class="ident" id="5751885">Close</span><span class="op" id="5751890">(</span><span class="op" id="5751891">)</span>&nbsp;<span class="builtintype" id="5751893">error</span>&nbsp;<span class="op" id="5751899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5751902"><a href="/database/sql/sql.go.html#5751869">ds</a></span><span class="op" id="5751904">.</span><span class="ident" id="5751905">Lock</span><span class="op" id="5751909">(</span><span class="op" id="5751910">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5751913">defer</span>&nbsp;<span class="ident" id="5751919"><a href="/database/sql/sql.go.html#5751869">ds</a></span><span class="op" id="5751921">.</span><span class="ident" id="5751922">Unlock</span><span class="op" id="5751928">(</span><span class="op" id="5751929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5751932">return</span>&nbsp;<span class="ident" id="5751939"><a href="/database/sql/sql.go.html#5751869">ds</a></span><span class="op" id="5751941">.</span><span class="ident" id="5751942">si</span><span class="op" id="5751944">.</span><span class="ident" id="5751945">Close</span><span class="op" id="5751950">(</span><span class="op" id="5751951">)</span><br>
<span class="lineno"></span><span class="op" id="5751953">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5751956">//&nbsp;depSet&nbsp;is&nbsp;a&nbsp;finalCloser&#39;s&nbsp;outstanding&nbsp;dependencies</span><br>
<span class="lineno">350</span><span class="keyword" id="5752010">type</span>&nbsp;<span class="ident" id="5752015">depSet</span>&nbsp;<span class="keyword" id="5752022">map</span><span class="op" id="5752025">[</span><span class="keyword" id="5752026">interface</span><span class="op" id="5752035">{</span><span class="op" id="5752036">}</span><span class="op" id="5752037">]</span><span class="builtintype" id="5752038">bool</span>&nbsp;<span class="comment" id="5752043">//&nbsp;set&nbsp;of&nbsp;true&nbsp;bools</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5752065">//&nbsp;The&nbsp;finalCloser&nbsp;interface&nbsp;is&nbsp;used&nbsp;by&nbsp;(*DB).addDep&nbsp;and&nbsp;related</span><br>
<span class="lineno"></span><span class="comment" id="5752130">//&nbsp;dependency&nbsp;reference&nbsp;counting.</span><br>
<span class="lineno"></span><span class="keyword" id="5752164">type</span>&nbsp;<span class="ident" id="5752169">finalCloser</span>&nbsp;<span class="keyword" id="5752181">interface</span>&nbsp;<span class="op" id="5752191">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5752194">//&nbsp;finalClose&nbsp;is&nbsp;called&nbsp;when&nbsp;the&nbsp;reference&nbsp;count&nbsp;of&nbsp;an&nbsp;object</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5752257">//&nbsp;goes&nbsp;to&nbsp;zero.&nbsp;(*DB).mu&nbsp;is&nbsp;not&nbsp;held&nbsp;while&nbsp;calling&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5752314">finalClose</span><span class="op" id="5752324">(</span><span class="op" id="5752325">)</span>&nbsp;<span class="builtintype" id="5752327">error</span><br>
<span class="lineno"></span><span class="op" id="5752333">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">360</span><span class="comment" id="5752336">//&nbsp;addDep&nbsp;notes&nbsp;that&nbsp;x&nbsp;now&nbsp;depends&nbsp;on&nbsp;dep,&nbsp;and&nbsp;x&#39;s&nbsp;finalClose&nbsp;won&#39;t&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="5752407">//&nbsp;called&nbsp;until&nbsp;all&nbsp;of&nbsp;x&#39;s&nbsp;dependencies&nbsp;are&nbsp;removed&nbsp;with&nbsp;removeDep.</span><br>
<span class="lineno"></span><span class="keyword" id="5752475">func</span>&nbsp;<span class="op" id="5752480">(</span><span class="ident" id="5752481">db</span>&nbsp;<span class="op" id="5752484">*</span><span class="ident" id="5752485"><a href="/database/sql/sql.go.html#5748306">DB</a></span><span class="op" id="5752487">)</span>&nbsp;<span class="ident" id="5752489">addDep</span><span class="op" id="5752495">(</span><span class="ident" id="5752496">x</span>&nbsp;<span class="ident" id="5752498"><a href="/database/sql/sql.go.html#5752169">finalCloser</a></span><span class="op" id="5752509">,</span>&nbsp;<span class="ident" id="5752511">dep</span>&nbsp;<span class="keyword" id="5752515">interface</span><span class="op" id="5752524">{</span><span class="op" id="5752525">}</span><span class="op" id="5752526">)</span>&nbsp;<span class="op" id="5752528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5752531">//println(fmt.Sprintf(&#34;addDep(%T&nbsp;%p,&nbsp;%T&nbsp;%p)&#34;,&nbsp;x,&nbsp;x,&nbsp;dep,&nbsp;dep))</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5752595"><a href="/database/sql/sql.go.html#5752481">db</a></span><span class="op" id="5752597">.</span><span class="ident" id="5752598">mu</span><span class="op" id="5752600">.</span><span class="ident" id="5752601">Lock</span><span class="op" id="5752605">(</span><span class="op" id="5752606">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5752609">defer</span>&nbsp;<span class="ident" id="5752615"><a href="/database/sql/sql.go.html#5752481">db</a></span><span class="op" id="5752617">.</span><span class="ident" id="5752618">mu</span><span class="op" id="5752620">.</span><span class="ident" id="5752621">Unlock</span><span class="op" id="5752627">(</span><span class="op" id="5752628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5752631"><a href="/database/sql/sql.go.html#5752481">db</a></span><span class="op" id="5752633">.</span><span class="ident" id="5752634">addDepLocked</span><span class="op" id="5752646">(</span><span class="ident" id="5752647"><a href="/database/sql/sql.go.html#5752496">x</a></span><span class="op" id="5752648">,</span>&nbsp;<span class="ident" id="5752650"><a href="/database/sql/sql.go.html#5752511">dep</a></span><span class="op" id="5752653">)</span><br>
<span class="lineno"></span><span class="op" id="5752655">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5752658">func</span>&nbsp;<span class="op" id="5752663">(</span><span class="ident" id="5752664">db</span>&nbsp;<span class="op" id="5752667">*</span><span class="ident" id="5752668"><a href="/database/sql/sql.go.html#5748306">DB</a></span><span class="op" id="5752670">)</span>&nbsp;<span class="ident" id="5752672">addDepLocked</span><span class="op" id="5752684">(</span><span class="ident" id="5752685">x</span>&nbsp;<span class="ident" id="5752687"><a href="/database/sql/sql.go.html#5752169">finalCloser</a></span><span class="op" id="5752698">,</span>&nbsp;<span class="ident" id="5752700">dep</span>&nbsp;<span class="keyword" id="5752704">interface</span><span class="op" id="5752713">{</span><span class="op" id="5752714">}</span><span class="op" id="5752715">)</span>&nbsp;<span class="op" id="5752717">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5752720">if</span>&nbsp;<span class="ident" id="5752723"><a href="/database/sql/sql.go.html#5752664">db</a></span><span class="op" id="5752725">.</span><span class="ident" id="5752726">dep</span>&nbsp;<span class="op" id="5752730">==</span>&nbsp;<span class="ident" id="5752733">nil</span>&nbsp;<span class="op" id="5752737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5752741"><a href="/database/sql/sql.go.html#5752664">db</a></span><span class="op" id="5752743">.</span><span class="ident" id="5752744">dep</span>&nbsp;<span class="op" id="5752748">=</span>&nbsp;<span class="builtinfunc" id="5752750">make</span><span class="op" id="5752754">(</span><span class="keyword" id="5752755">map</span><span class="op" id="5752758">[</span><span class="ident" id="5752759"><a href="/database/sql/sql.go.html#5752169">finalCloser</a></span><span class="op" id="5752770">]</span><span class="ident" id="5752771"><a href="/database/sql/sql.go.html#5752015">depSet</a></span><span class="op" id="5752777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5752780">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5752783">xdep</span>&nbsp;<span class="op" id="5752788">:=</span>&nbsp;<span class="ident" id="5752791"><a href="/database/sql/sql.go.html#5752664">db</a></span><span class="op" id="5752793">.</span><span class="ident" id="5752794">dep</span><span class="op" id="5752797">[</span><span class="ident" id="5752798"><a href="/database/sql/sql.go.html#5752685">x</a></span><span class="op" id="5752799">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5752802">if</span>&nbsp;<span class="ident" id="5752805"><a href="/database/sql/sql.go.html#5752783">xdep</a></span>&nbsp;<span class="op" id="5752810">==</span>&nbsp;<span class="ident" id="5752813">nil</span>&nbsp;<span class="op" id="5752817">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5752821"><a href="/database/sql/sql.go.html#5752783">xdep</a></span>&nbsp;<span class="op" id="5752826">=</span>&nbsp;<span class="builtinfunc" id="5752828">make</span><span class="op" id="5752832">(</span><span class="ident" id="5752833"><a href="/database/sql/sql.go.html#5752015">depSet</a></span><span class="op" id="5752839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5752843"><a href="/database/sql/sql.go.html#5752664">db</a></span><span class="op" id="5752845">.</span><span class="ident" id="5752846">dep</span><span class="op" id="5752849">[</span><span class="ident" id="5752850"><a href="/database/sql/sql.go.html#5752685">x</a></span><span class="op" id="5752851">]</span>&nbsp;<span class="op" id="5752853">=</span>&nbsp;<span class="ident" id="5752855"><a href="/database/sql/sql.go.html#5752783">xdep</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5752861">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5752864"><a href="/database/sql/sql.go.html#5752783">xdep</a></span><span class="op" id="5752868">[</span><span class="ident" id="5752869"><a href="/database/sql/sql.go.html#5752700">dep</a></span><span class="op" id="5752872">]</span>&nbsp;<span class="op" id="5752874">=</span>&nbsp;<span class="ident" id="5752876">true</span><br>
<span class="lineno"></span><span class="op" id="5752881">}</span><br>
<span class="lineno">380</span><br>
<span class="lineno"></span><span class="comment" id="5752884">//&nbsp;removeDep&nbsp;notes&nbsp;that&nbsp;x&nbsp;no&nbsp;longer&nbsp;depends&nbsp;on&nbsp;dep.</span><br>
<span class="lineno"></span><span class="comment" id="5752936">//&nbsp;If&nbsp;x&nbsp;still&nbsp;has&nbsp;dependencies,&nbsp;nil&nbsp;is&nbsp;returned.</span><br>
<span class="lineno"></span><span class="comment" id="5752985">//&nbsp;If&nbsp;x&nbsp;no&nbsp;longer&nbsp;has&nbsp;any&nbsp;dependencies,&nbsp;its&nbsp;finalClose&nbsp;method&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="5753055">//&nbsp;called&nbsp;and&nbsp;its&nbsp;error&nbsp;value&nbsp;will&nbsp;be&nbsp;returned.</span><br>
<span class="lineno">385</span><span class="keyword" id="5753103">func</span>&nbsp;<span class="op" id="5753108">(</span><span class="ident" id="5753109">db</span>&nbsp;<span class="op" id="5753112">*</span><span class="ident" id="5753113"><a href="/database/sql/sql.go.html#5748306">DB</a></span><span class="op" id="5753115">)</span>&nbsp;<span class="ident" id="5753117">removeDep</span><span class="op" id="5753126">(</span><span class="ident" id="5753127">x</span>&nbsp;<span class="ident" id="5753129"><a href="/database/sql/sql.go.html#5752169">finalCloser</a></span><span class="op" id="5753140">,</span>&nbsp;<span class="ident" id="5753142">dep</span>&nbsp;<span class="keyword" id="5753146">interface</span><span class="op" id="5753155">{</span><span class="op" id="5753156">}</span><span class="op" id="5753157">)</span>&nbsp;<span class="builtintype" id="5753159">error</span>&nbsp;<span class="op" id="5753165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5753168"><a href="/database/sql/sql.go.html#5753109">db</a></span><span class="op" id="5753170">.</span><span class="ident" id="5753171">mu</span><span class="op" id="5753173">.</span><span class="ident" id="5753174">Lock</span><span class="op" id="5753178">(</span><span class="op" id="5753179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5753182">fn</span>&nbsp;<span class="op" id="5753185">:=</span>&nbsp;<span class="ident" id="5753188"><a href="/database/sql/sql.go.html#5753109">db</a></span><span class="op" id="5753190">.</span><span class="ident" id="5753191">removeDepLocked</span><span class="op" id="5753206">(</span><span class="ident" id="5753207"><a href="/database/sql/sql.go.html#5753127">x</a></span><span class="op" id="5753208">,</span>&nbsp;<span class="ident" id="5753210"><a href="/database/sql/sql.go.html#5753142">dep</a></span><span class="op" id="5753213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5753216"><a href="/database/sql/sql.go.html#5753109">db</a></span><span class="op" id="5753218">.</span><span class="ident" id="5753219">mu</span><span class="op" id="5753221">.</span><span class="ident" id="5753222">Unlock</span><span class="op" id="5753228">(</span><span class="op" id="5753229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5753232">return</span>&nbsp;<span class="ident" id="5753239"><a href="/database/sql/sql.go.html#5753182">fn</a></span><span class="op" id="5753241">(</span><span class="op" id="5753242">)</span><br>
<span class="lineno">390</span><span class="op" id="5753244">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5753247">func</span>&nbsp;<span class="op" id="5753252">(</span><span class="ident" id="5753253">db</span>&nbsp;<span class="op" id="5753256">*</span><span class="ident" id="5753257"><a href="/database/sql/sql.go.html#5748306">DB</a></span><span class="op" id="5753259">)</span>&nbsp;<span class="ident" id="5753261">removeDepLocked</span><span class="op" id="5753276">(</span><span class="ident" id="5753277">x</span>&nbsp;<span class="ident" id="5753279"><a href="/database/sql/sql.go.html#5752169">finalCloser</a></span><span class="op" id="5753290">,</span>&nbsp;<span class="ident" id="5753292">dep</span>&nbsp;<span class="keyword" id="5753296">interface</span><span class="op" id="5753305">{</span><span class="op" id="5753306">}</span><span class="op" id="5753307">)</span>&nbsp;<span class="keyword" id="5753309">func</span><span class="op" id="5753313">(</span><span class="op" id="5753314">)</span>&nbsp;<span class="builtintype" id="5753316">error</span>&nbsp;<span class="op" id="5753322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5753325">//println(fmt.Sprintf(&#34;removeDep(%T&nbsp;%p,&nbsp;%T&nbsp;%p)&#34;,&nbsp;x,&nbsp;x,&nbsp;dep,&nbsp;dep))</span><br>
<span class="lineno"></span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5753393">xdep</span><span class="op" id="5753397">,</span>&nbsp;<span class="ident" id="5753399">ok</span>&nbsp;<span class="op" id="5753402">:=</span>&nbsp;<span class="ident" id="5753405"><a href="/database/sql/sql.go.html#5753253">db</a></span><span class="op" id="5753407">.</span><span class="ident" id="5753408">dep</span><span class="op" id="5753411">[</span><span class="ident" id="5753412"><a href="/database/sql/sql.go.html#5753277">x</a></span><span class="op" id="5753413">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5753416">if</span>&nbsp;<span class="op" id="5753419">!</span><span class="ident" id="5753420"><a href="/database/sql/sql.go.html#5753399">ok</a></span>&nbsp;<span class="op" id="5753423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5753427">panic</span><span class="op" id="5753432">(</span><span class="ident" id="5753433"><a href="/database/sql/sql.go.html#5743245">fmt</a></span><span class="op" id="5753436">.</span><span class="ident" id="5753437">Sprintf</span><span class="op" id="5753444">(</span><span class="string" id="5753445">&#34;unpaired&nbsp;removeDep:&nbsp;no&nbsp;deps&nbsp;for&nbsp;%T&#34;</span><span class="op" id="5753481">,</span>&nbsp;<span class="ident" id="5753483"><a href="/database/sql/sql.go.html#5753277">x</a></span><span class="op" id="5753484">)</span><span class="op" id="5753485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5753488">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5753492">l0</span>&nbsp;<span class="op" id="5753495">:=</span>&nbsp;<span class="builtinfunc" id="5753498">len</span><span class="op" id="5753501">(</span><span class="ident" id="5753502"><a href="/database/sql/sql.go.html#5753393">xdep</a></span><span class="op" id="5753506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5753509">delete</span><span class="op" id="5753515">(</span><span class="ident" id="5753516"><a href="/database/sql/sql.go.html#5753393">xdep</a></span><span class="op" id="5753520">,</span>&nbsp;<span class="ident" id="5753522"><a href="/database/sql/sql.go.html#5753292">dep</a></span><span class="op" id="5753525">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5753529">switch</span>&nbsp;<span class="builtinfunc" id="5753536">len</span><span class="op" id="5753539">(</span><span class="ident" id="5753540"><a href="/database/sql/sql.go.html#5753393">xdep</a></span><span class="op" id="5753544">)</span>&nbsp;<span class="op" id="5753546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5753549">case</span>&nbsp;<span class="ident" id="5753554"><a href="/database/sql/sql.go.html#5753492">l0</a></span><span class="op" id="5753556">:</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5753560">//&nbsp;Nothing&nbsp;removed.&nbsp;Shouldn&#39;t&nbsp;happen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5753600">panic</span><span class="op" id="5753605">(</span><span class="ident" id="5753606"><a href="/database/sql/sql.go.html#5743245">fmt</a></span><span class="op" id="5753609">.</span><span class="ident" id="5753610">Sprintf</span><span class="op" id="5753617">(</span><span class="string" id="5753618">&#34;unpaired&nbsp;removeDep:&nbsp;no&nbsp;%T&nbsp;dep&nbsp;on&nbsp;%T&#34;</span><span class="op" id="5753655">,</span>&nbsp;<span class="ident" id="5753657"><a href="/database/sql/sql.go.html#5753292">dep</a></span><span class="op" id="5753660">,</span>&nbsp;<span class="ident" id="5753662"><a href="/database/sql/sql.go.html#5753277">x</a></span><span class="op" id="5753663">)</span><span class="op" id="5753664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5753667">case</span>&nbsp;<span class="num" id="5753672">0</span><span class="op" id="5753673">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5753677">//&nbsp;No&nbsp;more&nbsp;dependencies.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5753704">delete</span><span class="op" id="5753710">(</span><span class="ident" id="5753711"><a href="/database/sql/sql.go.html#5753253">db</a></span><span class="op" id="5753713">.</span><span class="ident" id="5753714">dep</span><span class="op" id="5753717">,</span>&nbsp;<span class="ident" id="5753719"><a href="/database/sql/sql.go.html#5753277">x</a></span><span class="op" id="5753720">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5753724">return</span>&nbsp;<span class="ident" id="5753731"><a href="/database/sql/sql.go.html#5753277">x</a></span><span class="op" id="5753732">.</span><span class="ident" id="5753733">finalClose</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5753745">default</span><span class="op" id="5753752">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5753756">//&nbsp;Dependencies&nbsp;remain.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5753782">return</span>&nbsp;<span class="keyword" id="5753789">func</span><span class="op" id="5753793">(</span><span class="op" id="5753794">)</span>&nbsp;<span class="builtintype" id="5753796">error</span>&nbsp;<span class="op" id="5753802">{</span>&nbsp;<span class="keyword" id="5753804">return</span>&nbsp;<span class="ident" id="5753811">nil</span>&nbsp;<span class="op" id="5753815">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5753818">}</span><br>
<span class="lineno">415</span><span class="op" id="5753820">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5753823">//&nbsp;This&nbsp;is&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;connectionOpener&nbsp;request&nbsp;chan&nbsp;(dn.openerCh).</span><br>
<span class="lineno"></span><span class="comment" id="5753895">//&nbsp;This&nbsp;value&nbsp;should&nbsp;be&nbsp;larger&nbsp;than&nbsp;the&nbsp;maximum&nbsp;typical&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="5753957">//&nbsp;used&nbsp;for&nbsp;db.maxOpen.&nbsp;If&nbsp;maxOpen&nbsp;is&nbsp;significantly&nbsp;larger&nbsp;than</span><br>
<span class="lineno">420</span><span class="comment" id="5754021">//&nbsp;connectionRequestQueueSize&nbsp;then&nbsp;it&nbsp;is&nbsp;possible&nbsp;for&nbsp;ALL&nbsp;calls&nbsp;into&nbsp;the&nbsp;*DB</span><br>
<span class="lineno"></span><span class="comment" id="5754098">//&nbsp;to&nbsp;block&nbsp;until&nbsp;the&nbsp;connectionOpener&nbsp;can&nbsp;satisfy&nbsp;the&nbsp;backlog&nbsp;of&nbsp;requests.</span><br>
<span class="lineno"></span><span class="keyword" id="5754174">var</span>&nbsp;<span class="ident" id="5754178">connectionRequestQueueSize</span>&nbsp;<span class="op" id="5754205">=</span>&nbsp;<span class="num" id="5754207">1000000</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5754216">//&nbsp;Open&nbsp;opens&nbsp;a&nbsp;database&nbsp;specified&nbsp;by&nbsp;its&nbsp;database&nbsp;driver&nbsp;name&nbsp;and&nbsp;a</span><br>
<span class="lineno">425</span><span class="comment" id="5754285">//&nbsp;driver-specific&nbsp;data&nbsp;source&nbsp;name,&nbsp;usually&nbsp;consisting&nbsp;of&nbsp;at&nbsp;least&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5754355">//&nbsp;database&nbsp;name&nbsp;and&nbsp;connection&nbsp;information.</span><br>
<span class="lineno"></span><span class="comment" id="5754400">//</span><br>
<span class="lineno"></span><span class="comment" id="5754403">//&nbsp;Most&nbsp;users&nbsp;will&nbsp;open&nbsp;a&nbsp;database&nbsp;via&nbsp;a&nbsp;driver-specific&nbsp;connection</span><br>
<span class="lineno"></span><span class="comment" id="5754471">//&nbsp;helper&nbsp;function&nbsp;that&nbsp;returns&nbsp;a&nbsp;*DB.&nbsp;No&nbsp;database&nbsp;drivers&nbsp;are&nbsp;included</span><br>
<span class="lineno">430</span><span class="comment" id="5754543">//&nbsp;in&nbsp;the&nbsp;Go&nbsp;standard&nbsp;library.&nbsp;See&nbsp;http://golang.org/s/sqldrivers&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="5754613">//&nbsp;a&nbsp;list&nbsp;of&nbsp;third-party&nbsp;drivers.</span><br>
<span class="lineno"></span><span class="comment" id="5754647">//</span><br>
<span class="lineno"></span><span class="comment" id="5754650">//&nbsp;Open&nbsp;may&nbsp;just&nbsp;validate&nbsp;its&nbsp;arguments&nbsp;without&nbsp;creating&nbsp;a&nbsp;connection</span><br>
<span class="lineno"></span><span class="comment" id="5754720">//&nbsp;to&nbsp;the&nbsp;database.&nbsp;To&nbsp;verify&nbsp;that&nbsp;the&nbsp;data&nbsp;source&nbsp;name&nbsp;is&nbsp;valid,&nbsp;call</span><br>
<span class="lineno">435</span><span class="comment" id="5754791">//&nbsp;Ping.</span><br>
<span class="lineno"></span><span class="comment" id="5754800">//</span><br>
<span class="lineno"></span><span class="comment" id="5754803">//&nbsp;The&nbsp;returned&nbsp;DB&nbsp;is&nbsp;safe&nbsp;for&nbsp;concurrent&nbsp;use&nbsp;by&nbsp;multiple&nbsp;goroutines</span><br>
<span class="lineno"></span><span class="comment" id="5754872">//&nbsp;and&nbsp;maintains&nbsp;its&nbsp;own&nbsp;pool&nbsp;of&nbsp;idle&nbsp;connections.&nbsp;Thus,&nbsp;the&nbsp;Open</span><br>
<span class="lineno"></span><span class="comment" id="5754938">//&nbsp;function&nbsp;should&nbsp;be&nbsp;called&nbsp;just&nbsp;once.&nbsp;It&nbsp;is&nbsp;rarely&nbsp;necessary&nbsp;to</span><br>
<span class="lineno">440</span><span class="comment" id="5755004">//&nbsp;close&nbsp;a&nbsp;DB.</span><br>
<span class="lineno"></span><span class="keyword" id="5755019">func</span>&nbsp;<span class="ident" id="5755024">Open</span><span class="op" id="5755028">(</span><span class="ident" id="5755029">driverName</span><span class="op" id="5755039">,</span>&nbsp;<span class="ident" id="5755041">dataSourceName</span>&nbsp;<span class="builtintype" id="5755056">string</span><span class="op" id="5755062">)</span>&nbsp;<span class="op" id="5755064">(</span><span class="op" id="5755065">*</span><span class="ident" id="5755066"><a href="/database/sql/sql.go.html#5748306">DB</a></span><span class="op" id="5755068">,</span>&nbsp;<span class="builtintype" id="5755070">error</span><span class="op" id="5755075">)</span>&nbsp;<span class="op" id="5755077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755080">driveri</span><span class="op" id="5755087">,</span>&nbsp;<span class="ident" id="5755089">ok</span>&nbsp;<span class="op" id="5755092">:=</span>&nbsp;<span class="ident" id="5755095"><a href="/database/sql/sql.go.html#5743291">drivers</a></span><span class="op" id="5755102">[</span><span class="ident" id="5755103"><a href="/database/sql/sql.go.html#5755029">driverName</a></span><span class="op" id="5755113">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5755116">if</span>&nbsp;<span class="op" id="5755119">!</span><span class="ident" id="5755120"><a href="/database/sql/sql.go.html#5755089">ok</a></span>&nbsp;<span class="op" id="5755123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5755127">return</span>&nbsp;<span class="ident" id="5755134">nil</span><span class="op" id="5755137">,</span>&nbsp;<span class="ident" id="5755139"><a href="/database/sql/sql.go.html#5743245">fmt</a></span><span class="op" id="5755142">.</span><span class="ident" id="5755143">Errorf</span><span class="op" id="5755149">(</span><span class="string" id="5755150">&#34;sql:&nbsp;unknown&nbsp;driver&nbsp;%q&nbsp;(forgotten&nbsp;import?)&#34;</span><span class="op" id="5755194">,</span>&nbsp;<span class="ident" id="5755196"><a href="/database/sql/sql.go.html#5755029">driverName</a></span><span class="op" id="5755206">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5755209">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755212">db</span>&nbsp;<span class="op" id="5755215">:=</span>&nbsp;<span class="op" id="5755218">&amp;</span><span class="ident" id="5755219"><a href="/database/sql/sql.go.html#5748306">DB</a></span><span class="op" id="5755221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755225">driver</span><span class="op" id="5755231">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5755235"><a href="/database/sql/sql.go.html#5755080">driveri</a></span><span class="op" id="5755242">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755246">dsn</span><span class="op" id="5755249">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5755256"><a href="/database/sql/sql.go.html#5755041">dataSourceName</a></span><span class="op" id="5755270">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755274">openerCh</span><span class="op" id="5755282">:</span>&nbsp;<span class="builtinfunc" id="5755284">make</span><span class="op" id="5755288">(</span><span class="keyword" id="5755289">chan</span>&nbsp;<span class="keyword" id="5755294">struct</span><span class="op" id="5755300">{</span><span class="op" id="5755301">}</span><span class="op" id="5755302">,</span>&nbsp;<span class="ident" id="5755304"><a href="/database/sql/sql.go.html#5754178">connectionRequestQueueSize</a></span><span class="op" id="5755330">)</span><span class="op" id="5755331">,</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755335">lastPut</span><span class="op" id="5755342">:</span>&nbsp;&nbsp;<span class="builtinfunc" id="5755345">make</span><span class="op" id="5755349">(</span><span class="keyword" id="5755350">map</span><span class="op" id="5755353">[</span><span class="op" id="5755354">*</span><span class="ident" id="5755355"><a href="/database/sql/sql.go.html#5749298">driverConn</a></span><span class="op" id="5755365">]</span><span class="builtintype" id="5755366">string</span><span class="op" id="5755372">)</span><span class="op" id="5755373">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5755376">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5755379">go</span>&nbsp;<span class="ident" id="5755382"><a href="/database/sql/sql.go.html#5755212">db</a></span><span class="op" id="5755384">.</span><span class="ident" id="5755385">connectionOpener</span><span class="op" id="5755401">(</span><span class="op" id="5755402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5755405">return</span>&nbsp;<span class="ident" id="5755412"><a href="/database/sql/sql.go.html#5755212">db</a></span><span class="op" id="5755414">,</span>&nbsp;<span class="ident" id="5755416">nil</span><br>
<span class="lineno"></span><span class="op" id="5755420">}</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span><span class="comment" id="5755423">//&nbsp;Ping&nbsp;verifies&nbsp;a&nbsp;connection&nbsp;to&nbsp;the&nbsp;database&nbsp;is&nbsp;still&nbsp;alive,</span><br>
<span class="lineno"></span><span class="comment" id="5755485">//&nbsp;establishing&nbsp;a&nbsp;connection&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span><span class="keyword" id="5755528">func</span>&nbsp;<span class="op" id="5755533">(</span><span class="ident" id="5755534">db</span>&nbsp;<span class="op" id="5755537">*</span><span class="ident" id="5755538"><a href="/database/sql/sql.go.html#5748306">DB</a></span><span class="op" id="5755540">)</span>&nbsp;<span class="ident" id="5755542">Ping</span><span class="op" id="5755546">(</span><span class="op" id="5755547">)</span>&nbsp;<span class="builtintype" id="5755549">error</span>&nbsp;<span class="op" id="5755555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5755558">//&nbsp;TODO(bradfitz):&nbsp;give&nbsp;drivers&nbsp;an&nbsp;optional&nbsp;hook&nbsp;to&nbsp;implement</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5755621">//&nbsp;this&nbsp;in&nbsp;a&nbsp;more&nbsp;efficient&nbsp;or&nbsp;more&nbsp;reliable&nbsp;way,&nbsp;if&nbsp;they</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5755680">//&nbsp;have&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755694">dc</span><span class="op" id="5755696">,</span>&nbsp;<span class="ident" id="5755698">err</span>&nbsp;<span class="op" id="5755702">:=</span>&nbsp;<span class="ident" id="5755705"><a href="/database/sql/sql.go.html#5755534">db</a></span><span class="op" id="5755707">.</span><span class="ident" id="5755708">conn</span><span class="op" id="5755712">(</span><span class="op" id="5755713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5755716">if</span>&nbsp;<span class="ident" id="5755719"><a href="/database/sql/sql.go.html#5755698">err</a></span>&nbsp;<span class="op" id="5755723">!=</span>&nbsp;<span class="ident" id="5755726">nil</span>&nbsp;<span class="op" id="5755730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5755734">return</span>&nbsp;<span class="ident" id="5755741"><a href="/database/sql/sql.go.html#5755698">err</a></span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5755746">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755749"><a href="/database/sql/sql.go.html#5755534">db</a></span><span class="op" id="5755751">.</span><span class="ident" id="5755752">putConn</span><span class="op" id="5755759">(</span><span class="ident" id="5755760"><a href="/database/sql/sql.go.html#5755694">dc</a></span><span class="op" id="5755762">,</span>&nbsp;<span class="ident" id="5755764">nil</span><span class="op" id="5755767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5755770">return</span>&nbsp;<span class="ident" id="5755777">nil</span><br>
<span class="lineno"></span><span class="op" id="5755781">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">470</span><span class="comment" id="5755784">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;database,&nbsp;releasing&nbsp;any&nbsp;open&nbsp;resources.</span><br>
<span class="lineno"></span><span class="comment" id="5755844">//</span><br>
<span class="lineno"></span><span class="comment" id="5755847">//&nbsp;It&nbsp;is&nbsp;rare&nbsp;to&nbsp;Close&nbsp;a&nbsp;DB,&nbsp;as&nbsp;the&nbsp;DB&nbsp;handle&nbsp;is&nbsp;meant&nbsp;to&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="5755908">//&nbsp;long-lived&nbsp;and&nbsp;shared&nbsp;between&nbsp;many&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="keyword" id="5755958">func</span>&nbsp;<span class="op" id="5755963">(</span><span class="ident" id="5755964">db</span>&nbsp;<span class="op" id="5755967">*</span><span class="ident" id="5755968"><a href="/database/sql/sql.go.html#5748306">DB</a></span><span class="op" id="5755970">)</span>&nbsp;<span class="ident" id="5755972">Close</span><span class="op" id="5755977">(</span><span class="op" id="5755978">)</span>&nbsp;<span class="builtintype" id="5755980">error</span>&nbsp;<span class="op" id="5755986">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755989"><a href="/database/sql/sql.go.html#5755964">db</a></span><span class="op" id="5755991">.</span><span class="ident" id="5755992">mu</span><span class="op" id="5755994">.</span><span class="ident" id="5755995">Lock</span><span class="op" id="5755999">(</span><span class="op" id="5756000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5756003">if</span>&nbsp;<span class="ident" id="5756006"><a href="/database/sql/sql.go.html#5755964">db</a></span><span class="op" id="5756008">.</span><span class="ident" id="5756009">closed</span>&nbsp;<span class="op" id="5756016">{</span>&nbsp;<span class="comment" id="5756018">//&nbsp;Make&nbsp;DB.Close&nbsp;idempotent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5756048"><a href="/database/sql/sql.go.html#5755964">db</a></span><span class="op" id="5756050">.</span><span class="ident" id="5756051">mu</span><span class="op" id="5756053">.</span><span class="ident" id="5756054">Unlock</span><span class="op" id="5756060">(</span><span class="op" id="5756061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5756065">return</span>&nbsp;<span class="ident" id="5756072">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5756077">}</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5756080">close</span><span class="op" id="5756085">(</span><span class="ident" id="5756086"><a href="/database/sql/sql.go.html#5755964">db</a></span><span class="op" id="5756088">.</span><span class="ident" id="5756089">openerCh</span><span class="op" id="5756097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5756100">var</span>&nbsp;<span class="ident" id="5756104">err</span>&nbsp;<span class="builtintype" id="5756108">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5756115">fns</span>&nbsp;<span class="op" id="5756119">:=</span>&nbsp;<span class="builtinfunc" id="5756122">make</span><span class="op" id="5756126">(</span><span class="op" id="5756127">[</span><span class="op" id="5756128">]</span><span class="keyword" id="5756129">func</span><span class="op" id="5756133">(</span><span class="op" id="5756134">)</span>&nbsp;<span class="builtintype" id="5756136">error</span><span class="op" id="5756141">,</span>&nbsp;<span class="num" id="5756143">0</span><span class="op" id="5756144">,</span>&nbsp;<span class="builtinfunc" id="5756146">len</span><span class="op" id="5756149">(</span><span class="ident" id="5756150"><a href="/database/sql/sql.go.html#5755964">db</a></span><span class="op" id="5756152">.</span><span class="ident" id="5756153">freeConn</span><span class="op" id="5756161">)</span><span class="op" id="5756162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5756165">for</span>&nbsp;<span class="ident" id="5756169">_</span><span class="op" id="5756170">,</span>&nbsp;<span class="ident" id="5756172">dc</span>&nbsp;<span class="op" id="5756175">:=</span>&nbsp;<span class="keyword" id="5756178">range</span>&nbsp;<span class="ident" id="5756184"><a href="/database/sql/sql.go.html#5755964">db</a></span><span class="op" id="5756186">.</span><span class="ident" id="5756187">freeConn</span>&nbsp;<span class="op" id="5756196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5756200"><a href="/database/sql/sql.go.html#5756115">fns</a></span>&nbsp;<span class="op" id="5756204">=</span>&nbsp;<span class="builtinfunc" id="5756206">append</span><span class="op" id="5756212">(</span><span class="ident" id="5756213"><a href="/database/sql/sql.go.html#5756115">fns</a></span><span class="op" id="5756216">,</span>&nbsp;<span class="ident" id="5756218"><a href="/database/sql/sql.go.html#5756172">dc</a></span><span class="op" id="5756220">.</span><span class="ident" id="5756221">closeDBLocked</span><span class="op" id="5756234">(</span><span class="op" id="5756235">)</span><span class="op" id="5756236">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5756239">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5756242"><a href="/database/sql/sql.go.html#5755964">db</a></span><span class="op" id="5756244">.</span><span class="ident" id="5756245">freeConn</span>&nbsp;<span class="op" id="5756254">=</span>&nbsp;<span class="ident" id="5756256">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5756261"><a href="/database/sql/sql.go.html#5755964">db</a></span><span class="op" id="5756263">.</span><span class="ident" id="5756264">closed</span>&nbsp;<span class="op" id="5756271">=</span>&nbsp;<span class="ident" id="5756273">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5756279">for</span>&nbsp;<span class="ident" id="5756283">_</span><span class="op" id="5756284">,</span>&nbsp;<span class="ident" id="5756286">req</span>&nbsp;<span class="op" id="5756290">:=</span>&nbsp;<span class="keyword" id="5756293">range</span>&nbsp;<span class="ident" id="5756299"><a href="/database/sql/sql.go.html#5755964">db</a></span><span class="op" id="5756301">.</span><span class="ident" id="5756302">connRequests</span>&nbsp;<span class="op" id="5756315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5756319">close</span><span class="op" id="5756324">(</span><span class="ident" id="5756325"><a href="/database/sql/sql.go.html#5756286">req</a></span><span class="op" id="5756328">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5756331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5756334"><a href="/database/sql/sql.go.html#5755964">db</a></span><span class="op" id="5756336">.</span><span class="ident" id="5756337">mu</span><span class="op" id="5756339">.</span><span class="ident" id="5756340">Unlock</span><span class="op" id="5756346">(</span><span class="op" id="5756347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5756350">for</span>&nbsp;<span class="ident" id="5756354">_</span><span class="op" id="5756355">,</span>&nbsp;<span class="ident" id="5756357">fn</span>&nbsp;<span class="op" id="5756360">:=</span>&nbsp;<span class="keyword" id="5756363">range</span>&nbsp;<span class="ident" id="5756369"><a href="/database/sql/sql.go.html#5756115">fns</a></span>&nbsp;<span class="op" id="5756373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5756377">err1</span>&nbsp;<span class="op" id="5756382">:=</span>&nbsp;<span class="ident" id="5756385"><a href="/database/sql/sql.go.html#5756357">fn</a></span><span class="op" id="5756387">(</span><span class="op" id="5756388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5756392">if</span>&nbsp;<span class="ident" id="5756395"><a href="/database/sql/sql.go.html#5756377">err1</a></span>&nbsp;<span class="op" id="5756400">!=</span>&nbsp;<span class="ident" id="5756403">nil</span>&nbsp;<span class="op" id="5756407">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5756412"><a href="/database/sql/sql.go.html#5756104">err</a></span>&nbsp;<span class="op" id="5756416">=</span>&nbsp;<span class="ident" id="5756418"><a href="/database/sql/sql.go.html#5756377">err1</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5756425">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5756428">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5756431">return</span>&nbsp;<span class="ident" id="5756438"><a href="/database/sql/sql.go.html#5756104">err</a></span><br>
<span class="lineno"></span><span class="op" id="5756442">}</span><br>
<span class="lineno">500</span><br>
<span class="lineno"></span><span class="keyword" id="5756445">const</span>&nbsp;<span class="ident" id="5756451">defaultMaxIdleConns</span>&nbsp;<span class="op" id="5756471">=</span>&nbsp;<span class="num" id="5756473">2</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5756476">func</span>&nbsp;<span class="op" id="5756481">(</span><span class="ident" id="5756482">db</span>&nbsp;<span class="op" id="5756485">*</span><span class="ident" id="5756486"><a href="/database/sql/sql.go.html#5748306">DB</a></span><span class="op" id="5756488">)</span>&nbsp;<span class="ident" id="5756490">maxIdleConnsLocked</span><span class="op" id="5756508">(</span><span class="op" id="5756509">)</span>&nbsp;<span class="builtintype" id="5756511">int</span>&nbsp;<span class="op" id="5756515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5756518">n</span>&nbsp;<span class="op" id="5756520">:=</span>&nbsp;<span class="ident" id="5756523"><a href="/database/sql/sql.go.html#5756482">db</a></span><span class="op" id="5756525">.</span><span class="ident" id="5756526">maxIdle</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5756535">switch</span>&nbsp;<span class="op" id="5756542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5756545">case</span>&nbsp;<span class="ident" id="5756550"><a href="/database/sql/sql.go.html#5756518">n</a></span>&nbsp;<span class="op" id="5756552">==</span>&nbsp;<span class="num" id="5756555">0</span><span class="op" id="5756556">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5756560">//&nbsp;TODO(bradfitz):&nbsp;ask&nbsp;driver,&nbsp;if&nbsp;supported,&nbsp;for&nbsp;its&nbsp;default&nbsp;preference</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5756634">return</span>&nbsp;<span class="ident" id="5756641"><a href="/database/sql/sql.go.html#5756451">defaultMaxIdleConns</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5756662">case</span>&nbsp;<span class="ident" id="5756667"><a href="/database/sql/sql.go.html#5756518">n</a></span>&nbsp;<span class="op" id="5756669">&lt;</span>&nbsp;<span class="num" id="5756671">0</span><span class="op" id="5756672">:</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5756676">return</span>&nbsp;<span class="num" id="5756683">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5756686">default</span><span class="op" id="5756693">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5756697">return</span>&nbsp;<span class="ident" id="5756704"><a href="/database/sql/sql.go.html#5756518">n</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5756707">}</span><br>
<span class="lineno"></span><span class="op" id="5756709">}</span><br>
<span class="lineno">515</span><br>
<span class="lineno"></span><span class="comment" id="5756712">//&nbsp;SetMaxIdleConns&nbsp;sets&nbsp;the&nbsp;maximum&nbsp;number&nbsp;of&nbsp;connections&nbsp;in&nbsp;the&nbsp;idle</span><br>
<span class="lineno"></span><span class="comment" id="5756782">//&nbsp;connection&nbsp;pool.</span><br>
<span class="lineno"></span><span class="comment" id="5756802">//</span><br>
<span class="lineno"></span><span class="comment" id="5756805">//&nbsp;If&nbsp;MaxOpenConns&nbsp;is&nbsp;greater&nbsp;than&nbsp;0&nbsp;but&nbsp;less&nbsp;than&nbsp;the&nbsp;new&nbsp;MaxIdleConns</span><br>
<span class="lineno">520</span><span class="comment" id="5756877">//&nbsp;then&nbsp;the&nbsp;new&nbsp;MaxIdleConns&nbsp;will&nbsp;be&nbsp;reduced&nbsp;to&nbsp;match&nbsp;the&nbsp;MaxOpenConns&nbsp;limit</span><br>
<span class="lineno"></span><span class="comment" id="5756954">//</span><br>
<span class="lineno"></span><span class="comment" id="5756957">//&nbsp;If&nbsp;n&nbsp;&lt;=&nbsp;0,&nbsp;no&nbsp;idle&nbsp;connections&nbsp;are&nbsp;retained.</span><br>
<span class="lineno"></span><span class="keyword" id="5757005">func</span>&nbsp;<span class="op" id="5757010">(</span><span class="ident" id="5757011">db</span>&nbsp;<span class="op" id="5757014">*</span><span class="ident" id="5757015"><a href="/database/sql/sql.go.html#5748306">DB</a></span><span class="op" id="5757017">)</span>&nbsp;<span class="ident" id="5757019">SetMaxIdleConns</span><span class="op" id="5757034">(</span><span class="ident" id="5757035">n</span>&nbsp;<span class="builtintype" id="5757037">int</span><span class="op" id="5757040">)</span>&nbsp;<span class="op" id="5757042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5757045"><a href="/database/sql/sql.go.html#5757011">db</a></span><span class="op" id="5757047">.</span><span class="ident" id="5757048">mu</span><span class="op" id="5757050">.</span><span class="ident" id="5757051">Lock</span><span class="op" id="5757055">(</span><span class="op" id="5757056">)</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5757059">if</span>&nbsp;<span class="ident" id="5757062"><a href="/database/sql/sql.go.html#5757035">n</a></span>&nbsp;<span class="op" id="5757064">&gt;</span>&nbsp;<span class="num" id="5757066">0</span>&nbsp;<span class="op" id="5757068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5757072"><a href="/database/sql/sql.go.html#5757011">db</a></span><span class="op" id="5757074">.</span><span class="ident" id="5757075">maxIdle</span>&nbsp;<span class="op" id="5757083">=</span>&nbsp;<span class="ident" id="5757085"><a href="/database/sql/sql.go.html#5757035">n</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5757088">}</span>&nbsp;<span class="keyword" id="5757090">else</span>&nbsp;<span class="op" id="5757095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5757099">//&nbsp;No&nbsp;idle&nbsp;connections.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5757125"><a href="/database/sql/sql.go.html#5757011">db</a></span><span class="op" id="5757127">.</span><span class="ident" id="5757128">maxIdle</span>&nbsp;<span class="op" id="5757136">=</span>&nbsp;<span class="op" id="5757138">-</span><span class="num" id="5757139">1</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5757142">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5757145">//&nbsp;Make&nbsp;sure&nbsp;maxIdle&nbsp;doesn&#39;t&nbsp;exceed&nbsp;maxOpen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5757190">if</span>&nbsp;<span class="ident" id="5757193"><a href="/database/sql/sql.go.html#5757011">db</a></span><span class="op" id="5757195">.</span><span class="ident" id="5757196">maxOpen</span>&nbsp;<span class="op" id="5757204">&gt;</span>&nbsp;<span class="num" id="5757206">0</span>&nbsp;<span class="op" id="5757208">&amp;&amp;</span>&nbsp;<span class="ident" id="5757211"><a href="/database/sql/sql.go.html#5757011">db</a></span><span class="op" id="5757213">.</span><span class="ident" id="5757214">maxIdleConnsLocked</span><span class="op" id="5757232">(</span><span class="op" id="5757233">)</span>&nbsp;<span class="op" id="5757235">&gt;</span>&nbsp;<span class="ident" id="5757237"><a href="/database/sql/sql.go.html#5757011">db</a></span><span class="op" id="5757239">.</span><span class="ident" id="5757240">maxOpen</span>&nbsp;<span class="op" id="5757248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5757252"><a href="/database/sql/sql.go.html#5757011">db</a></span><span class="op" id="5757254">.</span><span class="ident" id="5757255">maxIdle</span>&nbsp;<span class="op" id="5757263">=</span>&nbsp;<span class="ident" id="5757265"><a href="/database/sql/sql.go.html#5757011">db</a></span><span class="op" id="5757267">.</span><span class="ident" id="5757268">maxOpen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5757277">}</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5757280">var</span>&nbsp;<span class="ident" id="5757284">closing</span>&nbsp;<span class="op" id="5757292">[</span><span class="op" id="5757293">]</span><span class="op" id="5757294">*</span><span class="ident" id="5757295"><a href="/database/sql/sql.go.html#5749298">driverConn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5757307">idleCount</span>&nbsp;<span class="op" id="5757317">:=</span>&nbsp;<span class="builtinfunc" id="5757320">len</span><span class="op" id="5757323">(</span><span class="ident" id="5757324"><a href="/database/sql/sql.go.html#5757011">db</a></span><span class="op" id="5757326">.</span><span class="ident" id="5757327">freeConn</span><span class="op" id="5757335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5757338">maxIdle</span>&nbsp;<span class="op" id="5757346">:=</span>&nbsp;<span class="ident" id="5757349"><a href="/database/sql/sql.go.html#5757011">db</a></span><span class="op" id="5757351">.</span><span class="ident" id="5757352">maxIdleConnsLocked</span><span class="op" id="5757370">(</span><span class="op" id="5757371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5757374">if</span>&nbsp;<span class="ident" id="5757377"><a href="/database/sql/sql.go.html#5757307">idleCount</a></span>&nbsp;<span class="op" id="5757387">&gt;</span>&nbsp;<span class="ident" id="5757389"><a href="/database/sql/sql.go.html#5757338">maxIdle</a></span>&nbsp;<span class="op" id="5757397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5757401"><a href="/database/sql/sql.go.html#5757284">closing</a></span>&nbsp;<span class="op" id="5757409">=</span>&nbsp;<span class="ident" id="5757411"><a href="/database/sql/sql.go.html#5757011">db</a></span><span class="op" id="5757413">.</span><span class="ident" id="5757414">freeConn</span><span class="op" id="5757422">[</span><span class="ident" id="5757423"><a href="/database/sql/sql.go.html#5757338">maxIdle</a></span><span class="op" id="5757430">:</span><span class="op" id="5757431">]</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5757435"><a href="/database/sql/sql.go.html#5757011">db</a></span><span class="op" id="5757437">.</span><span class="ident" id="5757438">freeConn</span>&nbsp;<span class="op" id="5757447">=</span>&nbsp;<span class="ident" id="5757449"><a href="/database/sql/sql.go.html#5757011">db</a></span><span class="op" id="5757451">.</span><span class="ident" id="5757452">freeConn</span><span class="op" id="5757460">[</span><span class="op" id="5757461">:</span><span class="ident" id="5757462"><a href="/database/sql/sql.go.html#5757338">maxIdle</a></span><span class="op" id="5757469">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5757472">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5757475"><a href="/database/sql/sql.go.html#5757011">db</a></span><span class="op" id="5757477">.</span><span class="ident" id="5757478">mu</span><span class="op" id="5757480">.</span><span class="ident" id="5757481">Unlock</span><span class="op" id="5757487">(</span><span class="op" id="5757488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5757491">for</span>&nbsp;<span class="ident" id="5757495">_</span><span class="op" id="5757496">,</span>&nbsp;<span class="ident" id="5757498">c</span>&nbsp;<span class="op" id="5757500">:=</span>&nbsp;<span class="keyword" id="5757503">range</span>&nbsp;<span class="ident" id="5757509"><a href="/database/sql/sql.go.html#5757284">closing</a></span>&nbsp;<span class="op" id="5757517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5757521"><a href="/database/sql/sql.go.html#5757498">c</a></span><span class="op" id="5757522">.</span><span class="ident" id="5757523">Close</span><span class="op" id="5757528">(</span><span class="op" id="5757529">)</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5757532">}</span><br>
<span class="lineno"></span><span class="op" id="5757534">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5757537">//&nbsp;SetMaxOpenConns&nbsp;sets&nbsp;the&nbsp;maximum&nbsp;number&nbsp;of&nbsp;open&nbsp;connections&nbsp;to&nbsp;the&nbsp;database.</span><br>
<span class="lineno"></span><span class="comment" id="5757617">//</span><br>
<span class="lineno">550</span><span class="comment" id="5757620">//&nbsp;If&nbsp;MaxIdleConns&nbsp;is&nbsp;greater&nbsp;than&nbsp;0&nbsp;and&nbsp;the&nbsp;new&nbsp;MaxOpenConns&nbsp;is&nbsp;less&nbsp;than</span><br>
<span class="lineno"></span><span class="comment" id="5757695">//&nbsp;MaxIdleConns,&nbsp;then&nbsp;MaxIdleConns&nbsp;will&nbsp;be&nbsp;reduced&nbsp;to&nbsp;match&nbsp;the&nbsp;new</span><br>
<span class="lineno"></span><span class="comment" id="5757763">//&nbsp;MaxOpenConns&nbsp;limit</span><br>
<span class="lineno"></span><span class="comment" id="5757785">//</span><br>
<span class="lineno"></span><span class="comment" id="5757788">//&nbsp;If&nbsp;n&nbsp;&lt;=&nbsp;0,&nbsp;then&nbsp;there&nbsp;is&nbsp;no&nbsp;limit&nbsp;on&nbsp;the&nbsp;number&nbsp;of&nbsp;open&nbsp;connections.</span><br>
<span class="lineno">555</span><span class="comment" id="5757860">//&nbsp;The&nbsp;default&nbsp;is&nbsp;0&nbsp;(unlimited).</span><br>
<span class="lineno"></span><span class="keyword" id="5757893">func</span>&nbsp;<span class="op" id="5757898">(</span><span class="ident" id="5757899">db</span>&nbsp;<span class="op" id="5757902">*</span><span class="ident" id="5757903"><a href="/database/sql/sql.go.html#5748306">DB</a></span><span class="op" id="5757905">)</span>&nbsp;<span class="ident" id="5757907">SetMaxOpenConns</span><span class="op" id="5757922">(</span><span class="ident" id="5757923">n</span>&nbsp;<span class="builtintype" id="5757925">int</span><span class="op" id="5757928">)</span>&nbsp;<span class="op" id="5757930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5757933"><a href="/database/sql/sql.go.html#5757899">db</a></span><span class="op" id="5757935">.</span><span class="ident" id="5757936">mu</span><span class="op" id="5757938">.</span><span class="ident" id="5757939">Lock</span><span class="op" id="5757943">(</span><span class="op" id="5757944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5757947"><a href="/database/sql/sql.go.html#5757899">db</a></span><span class="op" id="5757949">.</span><span class="ident" id="5757950">maxOpen</span>&nbsp;<span class="op" id="5757958">=</span>&nbsp;<span class="ident" id="5757960"><a href="/database/sql/sql.go.html#5757923">n</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5757963">if</span>&nbsp;<span class="ident" id="5757966"><a href="/database/sql/sql.go.html#5757923">n</a></span>&nbsp;<span class="op" id="5757968">&lt;</span>&nbsp;<span class="num" id="5757970">0</span>&nbsp;<span class="op" id="5757972">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5757976"><a href="/database/sql/sql.go.html#5757899">db</a></span><span class="op" id="5757978">.</span><span class="ident" id="5757979">maxOpen</span>&nbsp;<span class="op" id="5757987">=</span>&nbsp;<span class="num" id="5757989">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5757992">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5757995">syncMaxIdle</span>&nbsp;<span class="op" id="5758007">:=</span>&nbsp;<span class="ident" id="5758010"><a href="/database/sql/sql.go.html#5757899">db</a></span><span class="op" id="5758012">.</span><span class="ident" id="5758013">maxOpen</span>&nbsp;<span class="op" id="5758021">&gt;</span>&nbsp;<span class="num" id="5758023">0</span>&nbsp;<span class="op" id="5758025">&amp;&amp;</span>&nbsp;<span class="ident" id="5758028"><a href="/database/sql/sql.go.html#5757899">db</a></span><span class="op" id="5758030">.</span><span class="ident" id="5758031">maxIdleConnsLocked</span><span class="op" id="5758049">(</span><span class="op" id="5758050">)</span>&nbsp;<span class="op" id="5758052">&gt;</span>&nbsp;<span class="ident" id="5758054"><a href="/database/sql/sql.go.html#5757899">db</a></span><span class="op" id="5758056">.</span><span class="ident" id="5758057">maxOpen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5758066"><a href="/database/sql/sql.go.html#5757899">db</a></span><span class="op" id="5758068">.</span><span class="ident" id="5758069">mu</span><span class="op" id="5758071">.</span><span class="ident" id="5758072">Unlock</span><span class="op" id="5758078">(</span><span class="op" id="5758079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5758082">if</span>&nbsp;<span class="ident" id="5758085"><a href="/database/sql/sql.go.html#5757995">syncMaxIdle</a></span>&nbsp;<span class="op" id="5758097">{</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5758101"><a href="/database/sql/sql.go.html#5757899">db</a></span><span class="op" id="5758103">.</span><span class="ident" id="5758104">SetMaxIdleConns</span><span class="op" id="5758119">(</span><span class="ident" id="5758120"><a href="/database/sql/sql.go.html#5757923">n</a></span><span class="op" id="5758121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5758124">}</span><br>
<span class="lineno"></span><span class="op" id="5758126">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5758129">//&nbsp;Assumes&nbsp;db.mu&nbsp;is&nbsp;locked.</span><br>
<span class="lineno">570</span><span class="comment" id="5758157">//&nbsp;If&nbsp;there&nbsp;are&nbsp;connRequests&nbsp;and&nbsp;the&nbsp;connection&nbsp;limit&nbsp;hasn&#39;t&nbsp;been&nbsp;reached,</span><br>
<span class="lineno"></span><span class="comment" id="5758232">//&nbsp;then&nbsp;tell&nbsp;the&nbsp;connectionOpener&nbsp;to&nbsp;open&nbsp;new&nbsp;connections.</span><br>
<span class="lineno"></span><span class="keyword" id="5758291">func</span>&nbsp;<span class="op" id="5758296">(</span><span class="ident" id="5758297">db</span>&nbsp;<span class="op" id="5758300">*</span><span class="ident" id="5758301"><a href="/database/sql/sql.go.html#5748306">DB</a></span><span class="op" id="5758303">)</span>&nbsp;<span class="ident" id="5758305">maybeOpenNewConnections</span><span class="op" id="5758328">(</span><span class="op" id="5758329">)</span>&nbsp;<span class="op" id="5758331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5758334">numRequests</span>&nbsp;<span class="op" id="5758346">:=</span>&nbsp;<span class="builtinfunc" id="5758349">len</span><span class="op" id="5758352">(</span><span class="ident" id="5758353"><a href="/database/sql/sql.go.html#5758297">db</a></span><span class="op" id="5758355">.</span><span class="ident" id="5758356">connRequests</span><span class="op" id="5758368">)</span>&nbsp;<span class="op" id="5758370">-</span>&nbsp;<span class="ident" id="5758372"><a href="/database/sql/sql.go.html#5758297">db</a></span><span class="op" id="5758374">.</span><span class="ident" id="5758375">pendingOpens</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5758389">if</span>&nbsp;<span class="ident" id="5758392"><a href="/database/sql/sql.go.html#5758297">db</a></span><span class="op" id="5758394">.</span><span class="ident" id="5758395">maxOpen</span>&nbsp;<span class="op" id="5758403">&gt;</span>&nbsp;<span class="num" id="5758405">0</span>&nbsp;<span class="op" id="5758407">{</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5758411">numCanOpen</span>&nbsp;<span class="op" id="5758422">:=</span>&nbsp;<span class="ident" id="5758425"><a href="/database/sql/sql.go.html#5758297">db</a></span><span class="op" id="5758427">.</span><span class="ident" id="5758428">maxOpen</span>&nbsp;<span class="op" id="5758436">-</span>&nbsp;<span class="op" id="5758438">(</span><span class="ident" id="5758439"><a href="/database/sql/sql.go.html#5758297">db</a></span><span class="op" id="5758441">.</span><span class="ident" id="5758442">numOpen</span>&nbsp;<span class="op" id="5758450">+</span>&nbsp;<span class="ident" id="5758452"><a href="/database/sql/sql.go.html#5758297">db</a></span><span class="op" id="5758454">.</span><span class="ident" id="5758455">pendingOpens</span><span class="op" id="5758467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5758471">if</span>&nbsp;<span class="ident" id="5758474"><a href="/database/sql/sql.go.html#5758334">numRequests</a></span>&nbsp;<span class="op" id="5758486">&gt;</span>&nbsp;<span class="ident" id="5758488"><a href="/database/sql/sql.go.html#5758411">numCanOpen</a></span>&nbsp;<span class="op" id="5758499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5758504"><a href="/database/sql/sql.go.html#5758334">numRequests</a></span>&nbsp;<span class="op" id="5758516">=</span>&nbsp;<span class="ident" id="5758518"><a href="/database/sql/sql.go.html#5758411">numCanOpen</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5758531">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5758534">}</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5758537">for</span>&nbsp;<span class="ident" id="5758541"><a href="/database/sql/sql.go.html#5758334">numRequests</a></span>&nbsp;<span class="op" id="5758553">&gt;</span>&nbsp;<span class="num" id="5758555">0</span>&nbsp;<span class="op" id="5758557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5758561"><a href="/database/sql/sql.go.html#5758297">db</a></span><span class="op" id="5758563">.</span><span class="ident" id="5758564">pendingOpens</span><span class="op" id="5758576">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5758581"><a href="/database/sql/sql.go.html#5758334">numRequests</a></span><span class="op" id="5758592">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5758597"><a href="/database/sql/sql.go.html#5758297">db</a></span><span class="op" id="5758599">.</span><span class="ident" id="5758600">openerCh</span>&nbsp;<span class="op" id="5758609">&lt;-</span>&nbsp;<span class="keyword" id="5758612">struct</span><span class="op" id="5758618">{</span><span class="op" id="5758619">}</span><span class="op" id="5758620">{</span><span class="op" id="5758621">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5758624">}</span><br>
<span class="lineno">585</span><span class="op" id="5758626">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5758629">//&nbsp;Runs&nbsp;in&nbsp;a&nbsp;separate&nbsp;goroutine,&nbsp;opens&nbsp;new&nbsp;connections&nbsp;when&nbsp;requested.</span><br>
<span class="lineno"></span><span class="keyword" id="5758700">func</span>&nbsp;<span class="op" id="5758705">(</span><span class="ident" id="5758706">db</span>&nbsp;<span class="op" id="5758709">*</span><span class="ident" id="5758710"><a href="/database/sql/sql.go.html#5748306">DB</a></span><span class="op" id="5758712">)</span>&nbsp;<span class="ident" id="5758714">connectionOpener</span><span class="op" id="5758730">(</span><span class="op" id="5758731">)</span>&nbsp;<span class="op" id="5758733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5758736">for</span>&nbsp;<span class="keyword" id="5758740">range</span>&nbsp;<span class="ident" id="5758746"><a href="/database/sql/sql.go.html#5758706">db</a></span><span class="op" id="5758748">.</span><span class="ident" id="5758749">openerCh</span>&nbsp;<span class="op" id="5758758">{</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5758762"><a href="/database/sql/sql.go.html#5758706">db</a></span><span class="op" id="5758764">.</span><span class="ident" id="5758765">openNewConnection</span><span class="op" id="5758782">(</span><span class="op" id="5758783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5758786">}</span><br>
<span class="lineno"></span><span class="op" id="5758788">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5758791">//&nbsp;Open&nbsp;one&nbsp;new&nbsp;connection</span><br>
<span class="lineno">595</span><span class="keyword" id="5758818">func</span>&nbsp;<span class="op" id="5758823">(</span><span class="ident" id="5758824">db</span>&nbsp;<span class="op" id="5758827">*</span><span class="ident" id="5758828"><a href="/database/sql/sql.go.html#5748306">DB</a></span><span class="op" id="5758830">)</span>&nbsp;<span class="ident" id="5758832">openNewConnection</span><span class="op" id="5758849">(</span><span class="op" id="5758850">)</span>&nbsp;<span class="op" id="5758852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5758855">ci</span><span class="op" id="5758857">,</span>&nbsp;<span class="ident" id="5758859">err</span>&nbsp;<span class="op" id="5758863">:=</span>&nbsp;<span class="ident" id="5758866"><a href="/database/sql/sql.go.html#5758824">db</a></span><span class="op" id="5758868">.</span><span class="ident" id="5758869">driver</span><span class="op" id="5758875">.</span><span class="ident" id="5758876">Open</span><span class="op" id="5758880">(</span><span class="ident" id="5758881"><a href="/database/sql/sql.go.html#5758824">db</a></span><span class="op" id="5758883">.</span><span class="ident" id="5758884">dsn</span><span class="op" id="5758887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5758890"><a href="/database/sql/sql.go.html#5758824">db</a></span><span class="op" id="5758892">.</span><span class="ident" id="5758893">mu</span><span class="op" id="5758895">.</span><span class="ident" id="5758896">Lock</span><span class="op" id="5758900">(</span><span class="op" id="5758901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5758904">defer</span>&nbsp;<span class="ident" id="5758910"><a href="/database/sql/sql.go.html#5758824">db</a></span><span class="op" id="5758912">.</span><span class="ident" id="5758913">mu</span><span class="op" id="5758915">.</span><span class="ident" id="5758916">Unlock</span><span class="op" id="5758922">(</span><span class="op" id="5758923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5758926">if</span>&nbsp;<span class="ident" id="5758929"><a href="/database/sql/sql.go.html#5758824">db</a></span><span class="op" id="5758931">.</span><span class="ident" id="5758932">closed</span>&nbsp;<span class="op" id="5758939">{</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5758943">if</span>&nbsp;<span class="ident" id="5758946"><a href="/database/sql/sql.go.html#5758859">err</a></span>&nbsp;<span class="op" id="5758950">==</span>&nbsp;<span class="ident" id="5758953">nil</span>&nbsp;<span class="op" id="5758957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5758962"><a href="/database/sql/sql.go.html#5758855">ci</a></span><span class="op" id="5758964">.</span><span class="ident" id="5758965">Close</span><span class="op" id="5758970">(</span><span class="op" id="5758971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5758975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5758979">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5758987">}</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5758990"><a href="/database/sql/sql.go.html#5758824">db</a></span><span class="op" id="5758992">.</span><span class="ident" id="5758993">pendingOpens</span><span class="op" id="5759005">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5759009">if</span>&nbsp;<span class="ident" id="5759012"><a href="/database/sql/sql.go.html#5758859">err</a></span>&nbsp;<span class="op" id="5759016">!=</span>&nbsp;<span class="ident" id="5759019">nil</span>&nbsp;<span class="op" id="5759023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5759027"><a href="/database/sql/sql.go.html#5758824">db</a></span><span class="op" id="5759029">.</span><span class="ident" id="5759030">putConnDBLocked</span><span class="op" id="5759045">(</span><span class="ident" id="5759046">nil</span><span class="op" id="5759049">,</span>&nbsp;<span class="ident" id="5759051"><a href="/database/sql/sql.go.html#5758859">err</a></span><span class="op" id="5759054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5759058">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5759066">}</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5759069">dc</span>&nbsp;<span class="op" id="5759072">:=</span>&nbsp;<span class="op" id="5759075">&amp;</span><span class="ident" id="5759076"><a href="/database/sql/sql.go.html#5749298">driverConn</a></span><span class="op" id="5759086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5759090">db</span><span class="op" id="5759092">:</span>&nbsp;<span class="ident" id="5759094"><a href="/database/sql/sql.go.html#5758824">db</a></span><span class="op" id="5759096">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5759100">ci</span><span class="op" id="5759102">:</span>&nbsp;<span class="ident" id="5759104"><a href="/database/sql/sql.go.html#5758855">ci</a></span><span class="op" id="5759106">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5759109">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5759112">if</span>&nbsp;<span class="ident" id="5759115"><a href="/database/sql/sql.go.html#5758824">db</a></span><span class="op" id="5759117">.</span><span class="ident" id="5759118">putConnDBLocked</span><span class="op" id="5759133">(</span><span class="ident" id="5759134"><a href="/database/sql/sql.go.html#5759069">dc</a></span><span class="op" id="5759136">,</span>&nbsp;<span class="ident" id="5759138"><a href="/database/sql/sql.go.html#5758859">err</a></span><span class="op" id="5759141">)</span>&nbsp;<span class="op" id="5759143">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5759147"><a href="/database/sql/sql.go.html#5758824">db</a></span><span class="op" id="5759149">.</span><span class="ident" id="5759150">addDepLocked</span><span class="op" id="5759162">(</span><span class="ident" id="5759163"><a href="/database/sql/sql.go.html#5759069">dc</a></span><span class="op" id="5759165">,</span>&nbsp;<span class="ident" id="5759167"><a href="/database/sql/sql.go.html#5759069">dc</a></span><span class="op" id="5759169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5759173"><a href="/database/sql/sql.go.html#5758824">db</a></span><span class="op" id="5759175">.</span><span class="ident" id="5759176">numOpen</span><span class="op" id="5759183">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5759187">}</span>&nbsp;<span class="keyword" id="5759189">else</span>&nbsp;<span class="op" id="5759194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5759198"><a href="/database/sql/sql.go.html#5758855">ci</a></span><span class="op" id="5759200">.</span><span class="ident" id="5759201">Close</span><span class="op" id="5759206">(</span><span class="op" id="5759207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5759210">}</span><br>
<span class="lineno">620</span><span class="op" id="5759212">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5759215">//&nbsp;connRequest&nbsp;represents&nbsp;one&nbsp;request&nbsp;for&nbsp;a&nbsp;new&nbsp;connection</span><br>
<span class="lineno"></span><span class="comment" id="5759274">//&nbsp;When&nbsp;there&nbsp;are&nbsp;no&nbsp;idle&nbsp;connections&nbsp;available,&nbsp;DB.conn&nbsp;will&nbsp;create</span><br>
<span class="lineno"></span><span class="comment" id="5759343">//&nbsp;a&nbsp;new&nbsp;connRequest&nbsp;and&nbsp;put&nbsp;it&nbsp;on&nbsp;the&nbsp;db.connRequests&nbsp;list.</span><br>
<span class="lineno">625</span><span class="keyword" id="5759404">type</span>&nbsp;<span class="ident" id="5759409">connRequest</span>&nbsp;<span class="keyword" id="5759421">struct</span>&nbsp;<span class="op" id="5759428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5759431">conn</span>&nbsp;<span class="op" id="5759436">*</span><span class="ident" id="5759437"><a href="/database/sql/sql.go.html#5749298">driverConn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5759449">err</span>&nbsp;&nbsp;<span class="builtintype" id="5759454">error</span><br>
<span class="lineno"></span><span class="op" id="5759460">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">630</span><span class="keyword" id="5759463">var</span>&nbsp;<span class="ident" id="5759467">errDBClosed</span>&nbsp;<span class="op" id="5759479">=</span>&nbsp;<span class="ident" id="5759481"><a href="/database/sql/sql.go.html#5743235">errors</a></span><span class="op" id="5759487">.</span><span class="ident" id="5759488">New</span><span class="op" id="5759491">(</span><span class="string" id="5759492">&#34;sql:&nbsp;database&nbsp;is&nbsp;closed&#34;</span><span class="op" id="5759517">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5759520">//&nbsp;conn&nbsp;returns&nbsp;a&nbsp;newly-opened&nbsp;or&nbsp;cached&nbsp;*driverConn</span><br>
<span class="lineno"></span><span class="keyword" id="5759573">func</span>&nbsp;<span class="op" id="5759578">(</span><span class="ident" id="5759579">db</span>&nbsp;<span class="op" id="5759582">*</span><span class="ident" id="5759583"><a href="/database/sql/sql.go.html#5748306">DB</a></span><span class="op" id="5759585">)</span>&nbsp;<span class="ident" id="5759587">conn</span><span class="op" id="5759591">(</span><span class="op" id="5759592">)</span>&nbsp;<span class="op" id="5759594">(</span><span class="op" id="5759595">*</span><span class="ident" id="5759596"><a href="/database/sql/sql.go.html#5749298">driverConn</a></span><span class="op" id="5759606">,</span>&nbsp;<span class="builtintype" id="5759608">error</span><span class="op" id="5759613">)</span>&nbsp;<span class="op" id="5759615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5759618"><a href="/database/sql/sql.go.html#5759579">db</a></span><span class="op" id="5759620">.</span><span class="ident" id="5759621">mu</span><span class="op" id="5759623">.</span><span class="ident" id="5759624">Lock</span><span class="op" id="5759628">(</span><span class="op" id="5759629">)</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5759632">if</span>&nbsp;<span class="ident" id="5759635"><a href="/database/sql/sql.go.html#5759579">db</a></span><span class="op" id="5759637">.</span><span class="ident" id="5759638">closed</span>&nbsp;<span class="op" id="5759645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5759649"><a href="/database/sql/sql.go.html#5759579">db</a></span><span class="op" id="5759651">.</span><span class="ident" id="5759652">mu</span><span class="op" id="5759654">.</span><span class="ident" id="5759655">Unlock</span><span class="op" id="5759661">(</span><span class="op" id="5759662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5759666">return</span>&nbsp;<span class="ident" id="5759673">nil</span><span class="op" id="5759676">,</span>&nbsp;<span class="ident" id="5759678"><a href="/database/sql/sql.go.html#5759467">errDBClosed</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5759691">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5759695">//&nbsp;If&nbsp;db.maxOpen&nbsp;&gt;&nbsp;0&nbsp;and&nbsp;the&nbsp;number&nbsp;of&nbsp;open&nbsp;connections&nbsp;is&nbsp;over&nbsp;the&nbsp;limit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5759770">//&nbsp;and&nbsp;there&nbsp;are&nbsp;no&nbsp;free&nbsp;connection,&nbsp;make&nbsp;a&nbsp;request&nbsp;and&nbsp;wait.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5759833">if</span>&nbsp;<span class="ident" id="5759836"><a href="/database/sql/sql.go.html#5759579">db</a></span><span class="op" id="5759838">.</span><span class="ident" id="5759839">maxOpen</span>&nbsp;<span class="op" id="5759847">&gt;</span>&nbsp;<span class="num" id="5759849">0</span>&nbsp;<span class="op" id="5759851">&amp;&amp;</span>&nbsp;<span class="ident" id="5759854"><a href="/database/sql/sql.go.html#5759579">db</a></span><span class="op" id="5759856">.</span><span class="ident" id="5759857">numOpen</span>&nbsp;<span class="op" id="5759865">&gt;=</span>&nbsp;<span class="ident" id="5759868"><a href="/database/sql/sql.go.html#5759579">db</a></span><span class="op" id="5759870">.</span><span class="ident" id="5759871">maxOpen</span>&nbsp;<span class="op" id="5759879">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5759882">len</span><span class="op" id="5759885">(</span><span class="ident" id="5759886"><a href="/database/sql/sql.go.html#5759579">db</a></span><span class="op" id="5759888">.</span><span class="ident" id="5759889">freeConn</span><span class="op" id="5759897">)</span>&nbsp;<span class="op" id="5759899">==</span>&nbsp;<span class="num" id="5759902">0</span>&nbsp;<span class="op" id="5759904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5759908">//&nbsp;Make&nbsp;the&nbsp;connRequest&nbsp;channel.&nbsp;It&#39;s&nbsp;buffered&nbsp;so&nbsp;that&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5759969">//&nbsp;connectionOpener&nbsp;doesn&#39;t&nbsp;block&nbsp;while&nbsp;waiting&nbsp;for&nbsp;the&nbsp;req&nbsp;to&nbsp;be&nbsp;read.</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5760043">req</span>&nbsp;<span class="op" id="5760047">:=</span>&nbsp;<span class="builtinfunc" id="5760050">make</span><span class="op" id="5760054">(</span><span class="keyword" id="5760055">chan</span>&nbsp;<span class="ident" id="5760060"><a href="/database/sql/sql.go.html#5759409">connRequest</a></span><span class="op" id="5760071">,</span>&nbsp;<span class="num" id="5760073">1</span><span class="op" id="5760074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5760078"><a href="/database/sql/sql.go.html#5759579">db</a></span><span class="op" id="5760080">.</span><span class="ident" id="5760081">connRequests</span>&nbsp;<span class="op" id="5760094">=</span>&nbsp;<span class="builtinfunc" id="5760096">append</span><span class="op" id="5760102">(</span><span class="ident" id="5760103"><a href="/database/sql/sql.go.html#5759579">db</a></span><span class="op" id="5760105">.</span><span class="ident" id="5760106">connRequests</span><span class="op" id="5760118">,</span>&nbsp;<span class="ident" id="5760120"><a href="/database/sql/sql.go.html#5760043">req</a></span><span class="op" id="5760123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5760127"><a href="/database/sql/sql.go.html#5759579">db</a></span><span class="op" id="5760129">.</span><span class="ident" id="5760130">maybeOpenNewConnections</span><span class="op" id="5760153">(</span><span class="op" id="5760154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5760158"><a href="/database/sql/sql.go.html#5759579">db</a></span><span class="op" id="5760160">.</span><span class="ident" id="5760161">mu</span><span class="op" id="5760163">.</span><span class="ident" id="5760164">Unlock</span><span class="op" id="5760170">(</span><span class="op" id="5760171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5760175">ret</span>&nbsp;<span class="op" id="5760179">:=</span>&nbsp;<span class="op" id="5760182">&lt;-</span><span class="ident" id="5760184"><a href="/database/sql/sql.go.html#5760043">req</a></span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5760190">return</span>&nbsp;<span class="ident" id="5760197"><a href="/database/sql/sql.go.html#5760175">ret</a></span><span class="op" id="5760200">.</span><span class="ident" id="5760201">conn</span><span class="op" id="5760205">,</span>&nbsp;<span class="ident" id="5760207"><a href="/database/sql/sql.go.html#5760175">ret</a></span><span class="op" id="5760210">.</span><span class="ident" id="5760211">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5760216">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5760220">if</span>&nbsp;<span class="ident" id="5760223">c</span>&nbsp;<span class="op" id="5760225">:=</span>&nbsp;<span class="builtinfunc" id="5760228">len</span><span class="op" id="5760231">(</span><span class="ident" id="5760232"><a href="/database/sql/sql.go.html#5759579">db</a></span><span class="op" id="5760234">.</span><span class="ident" id="5760235">freeConn</span><span class="op" id="5760243">)</span><span class="op" id="5760244">;</span>&nbsp;<span class="ident" id="5760246"><a href="/database/sql/sql.go.html#5760223">c</a></span>&nbsp;<span class="op" id="5760248">&gt;</span>&nbsp;<span class="num" id="5760250">0</span>&nbsp;<span class="op" id="5760252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5760256">conn</span>&nbsp;<span class="op" id="5760261">:=</span>&nbsp;<span class="ident" id="5760264"><a href="/database/sql/sql.go.html#5759579">db</a></span><span class="op" id="5760266">.</span><span class="ident" id="5760267">freeConn</span><span class="op" id="5760275">[</span><span class="num" id="5760276">0</span><span class="op" id="5760277">]</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5760281">copy</span><span class="op" id="5760285">(</span><span class="ident" id="5760286"><a href="/database/sql/sql.go.html#5759579">db</a></span><span class="op" id="5760288">.</span><span class="ident" id="5760289">freeConn</span><span class="op" id="5760297">,</span>&nbsp;<span class="ident" id="5760299"><a href="/database/sql/sql.go.html#5759579">db</a></span><span class="op" id="5760301">.</span><span class="ident" id="5760302">freeConn</span><span class="op" id="5760310">[</span><span class="num" id="5760311">1</span><span class="op" id="5760312">:</span><span class="op" id="5760313">]</span><span class="op" id="5760314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5760318"><a href="/database/sql/sql.go.html#5759579">db</a></span><span class="op" id="5760320">.</span><span class="ident" id="5760321">freeConn</span>&nbsp;<span class="op" id="5760330">=</span>&nbsp;<span class="ident" id="5760332"><a href="/database/sql/sql.go.html#5759579">db</a></span><span class="op" id="5760334">.</span><span class="ident" id="5760335">freeConn</span><span class="op" id="5760343">[</span><span class="op" id="5760344">:</span><span class="ident" id="5760345"><a href="/database/sql/sql.go.html#5760223">c</a></span><span class="op" id="5760346">-</span><span class="num" id="5760347">1</span><span class="op" id="5760348">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5760352"><a href="/database/sql/sql.go.html#5760256">conn</a></span><span class="op" id="5760356">.</span><span class="ident" id="5760357">inUse</span>&nbsp;<span class="op" id="5760363">=</span>&nbsp;<span class="ident" id="5760365">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5760372"><a href="/database/sql/sql.go.html#5759579">db</a></span><span class="op" id="5760374">.</span><span class="ident" id="5760375">mu</span><span class="op" id="5760377">.</span><span class="ident" id="5760378">Unlock</span><span class="op" id="5760384">(</span><span class="op" id="5760385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5760389">return</span>&nbsp;<span class="ident" id="5760396"><a href="/database/sql/sql.go.html#5760256">conn</a></span><span class="op" id="5760400">,</span>&nbsp;<span class="ident" id="5760402">nil</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5760407">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5760411"><a href="/database/sql/sql.go.html#5759579">db</a></span><span class="op" id="5760413">.</span><span class="ident" id="5760414">numOpen</span><span class="op" id="5760421">++</span>&nbsp;<span class="comment" id="5760424">//&nbsp;optimistically</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5760443"><a href="/database/sql/sql.go.html#5759579">db</a></span><span class="op" id="5760445">.</span><span class="ident" id="5760446">mu</span><span class="op" id="5760448">.</span><span class="ident" id="5760449">Unlock</span><span class="op" id="5760455">(</span><span class="op" id="5760456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5760459">ci</span><span class="op" id="5760461">,</span>&nbsp;<span class="ident" id="5760463">err</span>&nbsp;<span class="op" id="5760467">:=</span>&nbsp;<span class="ident" id="5760470"><a href="/database/sql/sql.go.html#5759579">db</a></span><span class="op" id="5760472">.</span><span class="ident" id="5760473">driver</span><span class="op" id="5760479">.</span><span class="ident" id="5760480">Open</span><span class="op" id="5760484">(</span><span class="ident" id="5760485"><a href="/database/sql/sql.go.html#5759579">db</a></span><span class="op" id="5760487">.</span><span class="ident" id="5760488">dsn</span><span class="op" id="5760491">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5760494">if</span>&nbsp;<span class="ident" id="5760497"><a href="/database/sql/sql.go.html#5760463">err</a></span>&nbsp;<span class="op" id="5760501">!=</span>&nbsp;<span class="ident" id="5760504">nil</span>&nbsp;<span class="op" id="5760508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5760512"><a href="/database/sql/sql.go.html#5759579">db</a></span><span class="op" id="5760514">.</span><span class="ident" id="5760515">mu</span><span class="op" id="5760517">.</span><span class="ident" id="5760518">Lock</span><span class="op" id="5760522">(</span><span class="op" id="5760523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5760527"><a href="/database/sql/sql.go.html#5759579">db</a></span><span class="op" id="5760529">.</span><span class="ident" id="5760530">numOpen</span><span class="op" id="5760537">--</span>&nbsp;<span class="comment" id="5760540">//&nbsp;correct&nbsp;for&nbsp;earlier&nbsp;optimism</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5760574"><a href="/database/sql/sql.go.html#5759579">db</a></span><span class="op" id="5760576">.</span><span class="ident" id="5760577">mu</span><span class="op" id="5760579">.</span><span class="ident" id="5760580">Unlock</span><span class="op" id="5760586">(</span><span class="op" id="5760587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5760591">return</span>&nbsp;<span class="ident" id="5760598">nil</span><span class="op" id="5760601">,</span>&nbsp;<span class="ident" id="5760603"><a href="/database/sql/sql.go.html#5760463">err</a></span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5760608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5760611"><a href="/database/sql/sql.go.html#5759579">db</a></span><span class="op" id="5760613">.</span><span class="ident" id="5760614">mu</span><span class="op" id="5760616">.</span><span class="ident" id="5760617">Lock</span><span class="op" id="5760621">(</span><span class="op" id="5760622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5760625">dc</span>&nbsp;<span class="op" id="5760628">:=</span>&nbsp;<span class="op" id="5760631">&amp;</span><span class="ident" id="5760632"><a href="/database/sql/sql.go.html#5749298">driverConn</a></span><span class="op" id="5760642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5760646">db</span><span class="op" id="5760648">:</span>&nbsp;<span class="ident" id="5760650"><a href="/database/sql/sql.go.html#5759579">db</a></span><span class="op" id="5760652">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5760656">ci</span><span class="op" id="5760658">:</span>&nbsp;<span class="ident" id="5760660"><a href="/database/sql/sql.go.html#5760459">ci</a></span><span class="op" id="5760662">,</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5760665">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5760668"><a href="/database/sql/sql.go.html#5759579">db</a></span><span class="op" id="5760670">.</span><span class="ident" id="5760671">addDepLocked</span><span class="op" id="5760683">(</span><span class="ident" id="5760684"><a href="/database/sql/sql.go.html#5760625">dc</a></span><span class="op" id="5760686">,</span>&nbsp;<span class="ident" id="5760688"><a href="/database/sql/sql.go.html#5760625">dc</a></span><span class="op" id="5760690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5760693"><a href="/database/sql/sql.go.html#5760625">dc</a></span><span class="op" id="5760695">.</span><span class="ident" id="5760696">inUse</span>&nbsp;<span class="op" id="5760702">=</span>&nbsp;<span class="ident" id="5760704">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5760710"><a href="/database/sql/sql.go.html#5759579">db</a></span><span class="op" id="5760712">.</span><span class="ident" id="5760713">mu</span><span class="op" id="5760715">.</span><span class="ident" id="5760716">Unlock</span><span class="op" id="5760722">(</span><span class="op" id="5760723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5760726">return</span>&nbsp;<span class="ident" id="5760733"><a href="/database/sql/sql.go.html#5760625">dc</a></span><span class="op" id="5760735">,</span>&nbsp;<span class="ident" id="5760737">nil</span><br>
<span class="lineno">680</span><span class="op" id="5760741">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5760744">var</span>&nbsp;<span class="op" id="5760748">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5760751">errConnClosed</span>&nbsp;<span class="op" id="5760765">=</span>&nbsp;<span class="ident" id="5760767"><a href="/database/sql/sql.go.html#5743235">errors</a></span><span class="op" id="5760773">.</span><span class="ident" id="5760774">New</span><span class="op" id="5760777">(</span><span class="string" id="5760778">&#34;database/sql:&nbsp;internal&nbsp;sentinel&nbsp;error:&nbsp;conn&nbsp;is&nbsp;closed&#34;</span><span class="op" id="5760833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5760836">errConnBusy</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5760850">=</span>&nbsp;<span class="ident" id="5760852"><a href="/database/sql/sql.go.html#5743235">errors</a></span><span class="op" id="5760858">.</span><span class="ident" id="5760859">New</span><span class="op" id="5760862">(</span><span class="string" id="5760863">&#34;database/sql:&nbsp;internal&nbsp;sentinel&nbsp;error:&nbsp;conn&nbsp;is&nbsp;busy&#34;</span><span class="op" id="5760916">)</span><br>
<span class="lineno">685</span><span class="op" id="5760918">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5760921">//&nbsp;connIfFree&nbsp;returns&nbsp;(wanted,&nbsp;nil)&nbsp;if&nbsp;wanted&nbsp;is&nbsp;still&nbsp;a&nbsp;valid&nbsp;conn&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5760993">//&nbsp;isn&#39;t&nbsp;in&nbsp;use.</span><br>
<span class="lineno"></span><span class="comment" id="5761010">//</span><br>
<span class="lineno">690</span><span class="comment" id="5761013">//&nbsp;The&nbsp;error&nbsp;is&nbsp;errConnClosed&nbsp;if&nbsp;the&nbsp;connection&nbsp;if&nbsp;the&nbsp;requested&nbsp;connection</span><br>
<span class="lineno"></span><span class="comment" id="5761089">//&nbsp;is&nbsp;invalid&nbsp;because&nbsp;it&#39;s&nbsp;been&nbsp;closed.</span><br>
<span class="lineno"></span><span class="comment" id="5761129">//</span><br>
<span class="lineno"></span><span class="comment" id="5761132">//&nbsp;The&nbsp;error&nbsp;is&nbsp;errConnBusy&nbsp;if&nbsp;the&nbsp;connection&nbsp;is&nbsp;in&nbsp;use.</span><br>
<span class="lineno"></span><span class="keyword" id="5761189">func</span>&nbsp;<span class="op" id="5761194">(</span><span class="ident" id="5761195">db</span>&nbsp;<span class="op" id="5761198">*</span><span class="ident" id="5761199"><a href="/database/sql/sql.go.html#5748306">DB</a></span><span class="op" id="5761201">)</span>&nbsp;<span class="ident" id="5761203">connIfFree</span><span class="op" id="5761213">(</span><span class="ident" id="5761214">wanted</span>&nbsp;<span class="op" id="5761221">*</span><span class="ident" id="5761222"><a href="/database/sql/sql.go.html#5749298">driverConn</a></span><span class="op" id="5761232">)</span>&nbsp;<span class="op" id="5761234">(</span><span class="op" id="5761235">*</span><span class="ident" id="5761236"><a href="/database/sql/sql.go.html#5749298">driverConn</a></span><span class="op" id="5761246">,</span>&nbsp;<span class="builtintype" id="5761248">error</span><span class="op" id="5761253">)</span>&nbsp;<span class="op" id="5761255">{</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5761258"><a href="/database/sql/sql.go.html#5761195">db</a></span><span class="op" id="5761260">.</span><span class="ident" id="5761261">mu</span><span class="op" id="5761263">.</span><span class="ident" id="5761264">Lock</span><span class="op" id="5761268">(</span><span class="op" id="5761269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5761272">defer</span>&nbsp;<span class="ident" id="5761278"><a href="/database/sql/sql.go.html#5761195">db</a></span><span class="op" id="5761280">.</span><span class="ident" id="5761281">mu</span><span class="op" id="5761283">.</span><span class="ident" id="5761284">Unlock</span><span class="op" id="5761290">(</span><span class="op" id="5761291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5761294">if</span>&nbsp;<span class="ident" id="5761297"><a href="/database/sql/sql.go.html#5761214">wanted</a></span><span class="op" id="5761303">.</span><span class="ident" id="5761304">dbmuClosed</span>&nbsp;<span class="op" id="5761315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5761319">return</span>&nbsp;<span class="ident" id="5761326">nil</span><span class="op" id="5761329">,</span>&nbsp;<span class="ident" id="5761331"><a href="/database/sql/sql.go.html#5760751">errConnClosed</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5761346">}</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5761349">if</span>&nbsp;<span class="ident" id="5761352"><a href="/database/sql/sql.go.html#5761214">wanted</a></span><span class="op" id="5761358">.</span><span class="ident" id="5761359">inUse</span>&nbsp;<span class="op" id="5761365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5761369">return</span>&nbsp;<span class="ident" id="5761376">nil</span><span class="op" id="5761379">,</span>&nbsp;<span class="ident" id="5761381"><a href="/database/sql/sql.go.html#5760836">errConnBusy</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5761394">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5761397">idx</span>&nbsp;<span class="op" id="5761401">:=</span>&nbsp;<span class="op" id="5761404">-</span><span class="num" id="5761405">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5761408">for</span>&nbsp;<span class="ident" id="5761412">ii</span><span class="op" id="5761414">,</span>&nbsp;<span class="ident" id="5761416">v</span>&nbsp;<span class="op" id="5761418">:=</span>&nbsp;<span class="keyword" id="5761421">range</span>&nbsp;<span class="ident" id="5761427"><a href="/database/sql/sql.go.html#5761195">db</a></span><span class="op" id="5761429">.</span><span class="ident" id="5761430">freeConn</span>&nbsp;<span class="op" id="5761439">{</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5761443">if</span>&nbsp;<span class="ident" id="5761446"><a href="/database/sql/sql.go.html#5761416">v</a></span>&nbsp;<span class="op" id="5761448">==</span>&nbsp;<span class="ident" id="5761451"><a href="/database/sql/sql.go.html#5761214">wanted</a></span>&nbsp;<span class="op" id="5761458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5761463"><a href="/database/sql/sql.go.html#5761397">idx</a></span>&nbsp;<span class="op" id="5761467">=</span>&nbsp;<span class="ident" id="5761469"><a href="/database/sql/sql.go.html#5761412">ii</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5761475">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5761483">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5761486">}</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5761489">if</span>&nbsp;<span class="ident" id="5761492"><a href="/database/sql/sql.go.html#5761397">idx</a></span>&nbsp;<span class="op" id="5761496">&gt;=</span>&nbsp;<span class="num" id="5761499">0</span>&nbsp;<span class="op" id="5761501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5761505"><a href="/database/sql/sql.go.html#5761195">db</a></span><span class="op" id="5761507">.</span><span class="ident" id="5761508">freeConn</span>&nbsp;<span class="op" id="5761517">=</span>&nbsp;<span class="builtinfunc" id="5761519">append</span><span class="op" id="5761525">(</span><span class="ident" id="5761526"><a href="/database/sql/sql.go.html#5761195">db</a></span><span class="op" id="5761528">.</span><span class="ident" id="5761529">freeConn</span><span class="op" id="5761537">[</span><span class="op" id="5761538">:</span><span class="ident" id="5761539"><a href="/database/sql/sql.go.html#5761397">idx</a></span><span class="op" id="5761542">]</span><span class="op" id="5761543">,</span>&nbsp;<span class="ident" id="5761545"><a href="/database/sql/sql.go.html#5761195">db</a></span><span class="op" id="5761547">.</span><span class="ident" id="5761548">freeConn</span><span class="op" id="5761556">[</span><span class="ident" id="5761557"><a href="/database/sql/sql.go.html#5761397">idx</a></span><span class="op" id="5761560">+</span><span class="num" id="5761561">1</span><span class="op" id="5761562">:</span><span class="op" id="5761563">]</span><span class="op" id="5761564">...</span><span class="op" id="5761567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5761571"><a href="/database/sql/sql.go.html#5761214">wanted</a></span><span class="op" id="5761577">.</span><span class="ident" id="5761578">inUse</span>&nbsp;<span class="op" id="5761584">=</span>&nbsp;<span class="ident" id="5761586">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5761593">return</span>&nbsp;<span class="ident" id="5761600"><a href="/database/sql/sql.go.html#5761214">wanted</a></span><span class="op" id="5761606">,</span>&nbsp;<span class="ident" id="5761608">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5761613">}</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5761616">//&nbsp;TODO(bradfitz):&nbsp;shouldn&#39;t&nbsp;get&nbsp;here.&nbsp;After&nbsp;Go&nbsp;1.1,&nbsp;change&nbsp;this&nbsp;to:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5761686">//&nbsp;panic(&#34;connIfFree&nbsp;call&nbsp;requested&nbsp;a&nbsp;non-closed,&nbsp;non-busy,&nbsp;non-free&nbsp;conn&#34;)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5761763">//&nbsp;Which&nbsp;passes&nbsp;all&nbsp;the&nbsp;tests,&nbsp;but&nbsp;I&#39;m&nbsp;too&nbsp;paranoid&nbsp;to&nbsp;include&nbsp;this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5761832">//&nbsp;late&nbsp;in&nbsp;Go&nbsp;1.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5761852">//&nbsp;Instead,&nbsp;treat&nbsp;it&nbsp;like&nbsp;a&nbsp;busy&nbsp;connection:</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5761898">return</span>&nbsp;<span class="ident" id="5761905">nil</span><span class="op" id="5761908">,</span>&nbsp;<span class="ident" id="5761910"><a href="/database/sql/sql.go.html#5760836">errConnBusy</a></span><br>
<span class="lineno"></span><span class="op" id="5761922">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5761925">//&nbsp;putConnHook&nbsp;is&nbsp;a&nbsp;hook&nbsp;for&nbsp;testing.</span><br>
<span class="lineno"></span><span class="keyword" id="5761963">var</span>&nbsp;<span class="ident" id="5761967">putConnHook</span>&nbsp;<span class="keyword" id="5761979">func</span><span class="op" id="5761983">(</span><span class="op" id="5761984">*</span><span class="ident" id="5761985"><a href="/database/sql/sql.go.html#5748306">DB</a></span><span class="op" id="5761987">,</span>&nbsp;<span class="op" id="5761989">*</span><span class="ident" id="5761990"><a href="/database/sql/sql.go.html#5749298">driverConn</a></span><span class="op" id="5762000">)</span><br>
<span class="lineno">725</span><br>
<span class="lineno"></span><span class="comment" id="5762003">//&nbsp;noteUnusedDriverStatement&nbsp;notes&nbsp;that&nbsp;si&nbsp;is&nbsp;no&nbsp;longer&nbsp;used&nbsp;and&nbsp;should</span><br>
<span class="lineno"></span><span class="comment" id="5762075">//&nbsp;be&nbsp;closed&nbsp;whenever&nbsp;possible&nbsp;(when&nbsp;c&nbsp;is&nbsp;next&nbsp;not&nbsp;in&nbsp;use),&nbsp;unless&nbsp;c&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="5762147">//&nbsp;already&nbsp;closed.</span><br>
<span class="lineno"></span><span class="keyword" id="5762166">func</span>&nbsp;<span class="op" id="5762171">(</span><span class="ident" id="5762172">db</span>&nbsp;<span class="op" id="5762175">*</span><span class="ident" id="5762176"><a href="/database/sql/sql.go.html#5748306">DB</a></span><span class="op" id="5762178">)</span>&nbsp;<span class="ident" id="5762180">noteUnusedDriverStatement</span><span class="op" id="5762205">(</span><span class="ident" id="5762206">c</span>&nbsp;<span class="op" id="5762208">*</span><span class="ident" id="5762209"><a href="/database/sql/sql.go.html#5749298">driverConn</a></span><span class="op" id="5762219">,</span>&nbsp;<span class="ident" id="5762221">si</span>&nbsp;<span class="ident" id="5762224"><a href="/database/sql/sql.go.html#5743212">driver</a></span><span class="op" id="5762230">.</span><span class="ident" id="5762231">Stmt</span><span class="op" id="5762235">)</span>&nbsp;<span class="op" id="5762237">{</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5762240"><a href="/database/sql/sql.go.html#5762172">db</a></span><span class="op" id="5762242">.</span><span class="ident" id="5762243">mu</span><span class="op" id="5762245">.</span><span class="ident" id="5762246">Lock</span><span class="op" id="5762250">(</span><span class="op" id="5762251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5762254">defer</span>&nbsp;<span class="ident" id="5762260"><a href="/database/sql/sql.go.html#5762172">db</a></span><span class="op" id="5762262">.</span><span class="ident" id="5762263">mu</span><span class="op" id="5762265">.</span><span class="ident" id="5762266">Unlock</span><span class="op" id="5762272">(</span><span class="op" id="5762273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5762276">if</span>&nbsp;<span class="ident" id="5762279"><a href="/database/sql/sql.go.html#5762206">c</a></span><span class="op" id="5762280">.</span><span class="ident" id="5762281">inUse</span>&nbsp;<span class="op" id="5762287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5762291"><a href="/database/sql/sql.go.html#5762206">c</a></span><span class="op" id="5762292">.</span><span class="ident" id="5762293">onPut</span>&nbsp;<span class="op" id="5762299">=</span>&nbsp;<span class="builtinfunc" id="5762301">append</span><span class="op" id="5762307">(</span><span class="ident" id="5762308"><a href="/database/sql/sql.go.html#5762206">c</a></span><span class="op" id="5762309">.</span><span class="ident" id="5762310">onPut</span><span class="op" id="5762315">,</span>&nbsp;<span class="keyword" id="5762317">func</span><span class="op" id="5762321">(</span><span class="op" id="5762322">)</span>&nbsp;<span class="op" id="5762324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5762329"><a href="/database/sql/sql.go.html#5762221">si</a></span><span class="op" id="5762331">.</span><span class="ident" id="5762332">Close</span><span class="op" id="5762337">(</span><span class="op" id="5762338">)</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5762342">}</span><span class="op" id="5762343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5762346">}</span>&nbsp;<span class="keyword" id="5762348">else</span>&nbsp;<span class="op" id="5762353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5762357"><a href="/database/sql/sql.go.html#5762206">c</a></span><span class="op" id="5762358">.</span><span class="ident" id="5762359">Lock</span><span class="op" id="5762363">(</span><span class="op" id="5762364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5762368">defer</span>&nbsp;<span class="ident" id="5762374"><a href="/database/sql/sql.go.html#5762206">c</a></span><span class="op" id="5762375">.</span><span class="ident" id="5762376">Unlock</span><span class="op" id="5762382">(</span><span class="op" id="5762383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5762387">if</span>&nbsp;<span class="op" id="5762390">!</span><span class="ident" id="5762391"><a href="/database/sql/sql.go.html#5762206">c</a></span><span class="op" id="5762392">.</span><span class="ident" id="5762393">finalClosed</span>&nbsp;<span class="op" id="5762405">{</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5762410"><a href="/database/sql/sql.go.html#5762221">si</a></span><span class="op" id="5762412">.</span><span class="ident" id="5762413">Close</span><span class="op" id="5762418">(</span><span class="op" id="5762419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5762423">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5762426">}</span><br>
<span class="lineno"></span><span class="op" id="5762428">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">745</span><span class="comment" id="5762431">//&nbsp;debugGetPut&nbsp;determines&nbsp;whether&nbsp;getConn&nbsp;&amp;&nbsp;putConn&nbsp;calls&#39;&nbsp;stack&nbsp;traces</span><br>
<span class="lineno"></span><span class="comment" id="5762503">//&nbsp;are&nbsp;returned&nbsp;for&nbsp;more&nbsp;verbose&nbsp;crashes.</span><br>
<span class="lineno"></span><span class="keyword" id="5762545">const</span>&nbsp;<span class="ident" id="5762551">debugGetPut</span>&nbsp;<span class="op" id="5762563">=</span>&nbsp;<span class="ident" id="5762565">false</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5762572">//&nbsp;putConn&nbsp;adds&nbsp;a&nbsp;connection&nbsp;to&nbsp;the&nbsp;db&#39;s&nbsp;free&nbsp;pool.</span><br>
<span class="lineno">750</span><span class="comment" id="5762624">//&nbsp;err&nbsp;is&nbsp;optionally&nbsp;the&nbsp;last&nbsp;error&nbsp;that&nbsp;occurred&nbsp;on&nbsp;this&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="5762694">func</span>&nbsp;<span class="op" id="5762699">(</span><span class="ident" id="5762700">db</span>&nbsp;<span class="op" id="5762703">*</span><span class="ident" id="5762704"><a href="/database/sql/sql.go.html#5748306">DB</a></span><span class="op" id="5762706">)</span>&nbsp;<span class="ident" id="5762708">putConn</span><span class="op" id="5762715">(</span><span class="ident" id="5762716">dc</span>&nbsp;<span class="op" id="5762719">*</span><span class="ident" id="5762720"><a href="/database/sql/sql.go.html#5749298">driverConn</a></span><span class="op" id="5762730">,</span>&nbsp;<span class="ident" id="5762732">err</span>&nbsp;<span class="builtintype" id="5762736">error</span><span class="op" id="5762741">)</span>&nbsp;<span class="op" id="5762743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5762746"><a href="/database/sql/sql.go.html#5762700">db</a></span><span class="op" id="5762748">.</span><span class="ident" id="5762749">mu</span><span class="op" id="5762751">.</span><span class="ident" id="5762752">Lock</span><span class="op" id="5762756">(</span><span class="op" id="5762757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5762760">if</span>&nbsp;<span class="op" id="5762763">!</span><span class="ident" id="5762764"><a href="/database/sql/sql.go.html#5762716">dc</a></span><span class="op" id="5762766">.</span><span class="ident" id="5762767">inUse</span>&nbsp;<span class="op" id="5762773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5762777">if</span>&nbsp;<span class="ident" id="5762780"><a href="/database/sql/sql.go.html#5762551">debugGetPut</a></span>&nbsp;<span class="op" id="5762792">{</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5762797"><a href="/database/sql/sql.go.html#5743245">fmt</a></span><span class="op" id="5762800">.</span><span class="ident" id="5762801">Printf</span><span class="op" id="5762807">(</span><span class="string" id="5762808">&#34;putConn(%v)&nbsp;DUPLICATE&nbsp;was:&nbsp;%s\n\nPREVIOUS&nbsp;was:&nbsp;%s&#34;</span><span class="op" id="5762859">,</span>&nbsp;<span class="ident" id="5762861"><a href="/database/sql/sql.go.html#5762716">dc</a></span><span class="op" id="5762863">,</span>&nbsp;<span class="ident" id="5762865"><a href="/database/sql/sql.go.html#5788422">stack</a></span><span class="op" id="5762870">(</span><span class="op" id="5762871">)</span><span class="op" id="5762872">,</span>&nbsp;<span class="ident" id="5762874"><a href="/database/sql/sql.go.html#5762700">db</a></span><span class="op" id="5762876">.</span><span class="ident" id="5762877">lastPut</span><span class="op" id="5762884">[</span><span class="ident" id="5762885"><a href="/database/sql/sql.go.html#5762716">dc</a></span><span class="op" id="5762887">]</span><span class="op" id="5762888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5762892">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5762896">panic</span><span class="op" id="5762901">(</span><span class="string" id="5762902">&#34;sql:&nbsp;connection&nbsp;returned&nbsp;that&nbsp;was&nbsp;never&nbsp;out&#34;</span><span class="op" id="5762947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5762950">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5762953">if</span>&nbsp;<span class="ident" id="5762956"><a href="/database/sql/sql.go.html#5762551">debugGetPut</a></span>&nbsp;<span class="op" id="5762968">{</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5762972"><a href="/database/sql/sql.go.html#5762700">db</a></span><span class="op" id="5762974">.</span><span class="ident" id="5762975">lastPut</span><span class="op" id="5762982">[</span><span class="ident" id="5762983"><a href="/database/sql/sql.go.html#5762716">dc</a></span><span class="op" id="5762985">]</span>&nbsp;<span class="op" id="5762987">=</span>&nbsp;<span class="ident" id="5762989"><a href="/database/sql/sql.go.html#5788422">stack</a></span><span class="op" id="5762994">(</span><span class="op" id="5762995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5762998">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5763001"><a href="/database/sql/sql.go.html#5762716">dc</a></span><span class="op" id="5763003">.</span><span class="ident" id="5763004">inUse</span>&nbsp;<span class="op" id="5763010">=</span>&nbsp;<span class="ident" id="5763012">false</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5763020">for</span>&nbsp;<span class="ident" id="5763024">_</span><span class="op" id="5763025">,</span>&nbsp;<span class="ident" id="5763027">fn</span>&nbsp;<span class="op" id="5763030">:=</span>&nbsp;<span class="keyword" id="5763033">range</span>&nbsp;<span class="ident" id="5763039"><a href="/database/sql/sql.go.html#5762716">dc</a></span><span class="op" id="5763041">.</span><span class="ident" id="5763042">onPut</span>&nbsp;<span class="op" id="5763048">{</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5763052"><a href="/database/sql/sql.go.html#5763027">fn</a></span><span class="op" id="5763054">(</span><span class="op" id="5763055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5763058">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5763061"><a href="/database/sql/sql.go.html#5762716">dc</a></span><span class="op" id="5763063">.</span><span class="ident" id="5763064">onPut</span>&nbsp;<span class="op" id="5763070">=</span>&nbsp;<span class="ident" id="5763072">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5763078">if</span>&nbsp;<span class="ident" id="5763081"><a href="/database/sql/sql.go.html#5762732">err</a></span>&nbsp;<span class="op" id="5763085">==</span>&nbsp;<span class="ident" id="5763088"><a href="/database/sql/sql.go.html#5743212">driver</a></span><span class="op" id="5763094">.</span><span class="ident" id="5763095">ErrBadConn</span>&nbsp;<span class="op" id="5763106">{</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5763110">//&nbsp;Don&#39;t&nbsp;reuse&nbsp;bad&nbsp;connections.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5763144">//&nbsp;Since&nbsp;the&nbsp;conn&nbsp;is&nbsp;considered&nbsp;bad&nbsp;and&nbsp;is&nbsp;being&nbsp;discarded,&nbsp;treat&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5763215">//&nbsp;as&nbsp;closed.&nbsp;Don&#39;t&nbsp;decrement&nbsp;the&nbsp;open&nbsp;count&nbsp;here,&nbsp;finalClose&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5763284">//&nbsp;take&nbsp;care&nbsp;of&nbsp;that.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5763308"><a href="/database/sql/sql.go.html#5762700">db</a></span><span class="op" id="5763310">.</span><span class="ident" id="5763311">maybeOpenNewConnections</span><span class="op" id="5763334">(</span><span class="op" id="5763335">)</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5763339"><a href="/database/sql/sql.go.html#5762700">db</a></span><span class="op" id="5763341">.</span><span class="ident" id="5763342">mu</span><span class="op" id="5763344">.</span><span class="ident" id="5763345">Unlock</span><span class="op" id="5763351">(</span><span class="op" id="5763352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5763356"><a href="/database/sql/sql.go.html#5762716">dc</a></span><span class="op" id="5763358">.</span><span class="ident" id="5763359">Close</span><span class="op" id="5763364">(</span><span class="op" id="5763365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5763369">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5763377">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5763380">if</span>&nbsp;<span class="ident" id="5763383"><a href="/database/sql/sql.go.html#5761967">putConnHook</a></span>&nbsp;<span class="op" id="5763395">!=</span>&nbsp;<span class="ident" id="5763398">nil</span>&nbsp;<span class="op" id="5763402">{</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5763406"><a href="/database/sql/sql.go.html#5761967">putConnHook</a></span><span class="op" id="5763417">(</span><span class="ident" id="5763418"><a href="/database/sql/sql.go.html#5762700">db</a></span><span class="op" id="5763420">,</span>&nbsp;<span class="ident" id="5763422"><a href="/database/sql/sql.go.html#5762716">dc</a></span><span class="op" id="5763424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5763427">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5763430">added</span>&nbsp;<span class="op" id="5763436">:=</span>&nbsp;<span class="ident" id="5763439"><a href="/database/sql/sql.go.html#5762700">db</a></span><span class="op" id="5763441">.</span><span class="ident" id="5763442">putConnDBLocked</span><span class="op" id="5763457">(</span><span class="ident" id="5763458"><a href="/database/sql/sql.go.html#5762716">dc</a></span><span class="op" id="5763460">,</span>&nbsp;<span class="ident" id="5763462">nil</span><span class="op" id="5763465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5763468"><a href="/database/sql/sql.go.html#5762700">db</a></span><span class="op" id="5763470">.</span><span class="ident" id="5763471">mu</span><span class="op" id="5763473">.</span><span class="ident" id="5763474">Unlock</span><span class="op" id="5763480">(</span><span class="op" id="5763481">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5763485">if</span>&nbsp;<span class="op" id="5763488">!</span><span class="ident" id="5763489"><a href="/database/sql/sql.go.html#5763430">added</a></span>&nbsp;<span class="op" id="5763495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5763499"><a href="/database/sql/sql.go.html#5762716">dc</a></span><span class="op" id="5763501">.</span><span class="ident" id="5763502">Close</span><span class="op" id="5763507">(</span><span class="op" id="5763508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5763511">}</span><br>
<span class="lineno"></span><span class="op" id="5763513">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">790</span><span class="comment" id="5763516">//&nbsp;Satisfy&nbsp;a&nbsp;connRequest&nbsp;or&nbsp;put&nbsp;the&nbsp;driverConn&nbsp;in&nbsp;the&nbsp;idle&nbsp;pool&nbsp;and&nbsp;return&nbsp;true</span><br>
<span class="lineno"></span><span class="comment" id="5763596">//&nbsp;or&nbsp;return&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="5763616">//&nbsp;putConnDBLocked&nbsp;will&nbsp;satisfy&nbsp;a&nbsp;connRequest&nbsp;if&nbsp;there&nbsp;is&nbsp;one,&nbsp;or&nbsp;it&nbsp;will</span><br>
<span class="lineno"></span><span class="comment" id="5763690">//&nbsp;return&nbsp;the&nbsp;*driverConn&nbsp;to&nbsp;the&nbsp;freeConn&nbsp;list&nbsp;if&nbsp;err&nbsp;==&nbsp;nil&nbsp;and&nbsp;the&nbsp;idle</span><br>
<span class="lineno"></span><span class="comment" id="5763764">//&nbsp;connection&nbsp;limit&nbsp;will&nbsp;not&nbsp;be&nbsp;exceeded.</span><br>
<span class="lineno">795</span><span class="comment" id="5763806">//&nbsp;If&nbsp;err&nbsp;!=&nbsp;nil,&nbsp;the&nbsp;value&nbsp;of&nbsp;dc&nbsp;is&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="5763852">//&nbsp;If&nbsp;err&nbsp;==&nbsp;nil,&nbsp;then&nbsp;dc&nbsp;must&nbsp;not&nbsp;equal&nbsp;nil.</span><br>
<span class="lineno"></span><span class="comment" id="5763898">//&nbsp;If&nbsp;a&nbsp;connRequest&nbsp;was&nbsp;fulfilled&nbsp;or&nbsp;the&nbsp;*driverConn&nbsp;was&nbsp;placed&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5763969">//&nbsp;freeConn&nbsp;list,&nbsp;then&nbsp;true&nbsp;is&nbsp;returned,&nbsp;otherwise&nbsp;false&nbsp;is&nbsp;returned.</span><br>
<span class="lineno"></span><span class="keyword" id="5764039">func</span>&nbsp;<span class="op" id="5764044">(</span><span class="ident" id="5764045">db</span>&nbsp;<span class="op" id="5764048">*</span><span class="ident" id="5764049"><a href="/database/sql/sql.go.html#5748306">DB</a></span><span class="op" id="5764051">)</span>&nbsp;<span class="ident" id="5764053">putConnDBLocked</span><span class="op" id="5764068">(</span><span class="ident" id="5764069">dc</span>&nbsp;<span class="op" id="5764072">*</span><span class="ident" id="5764073"><a href="/database/sql/sql.go.html#5749298">driverConn</a></span><span class="op" id="5764083">,</span>&nbsp;<span class="ident" id="5764085">err</span>&nbsp;<span class="builtintype" id="5764089">error</span><span class="op" id="5764094">)</span>&nbsp;<span class="builtintype" id="5764096">bool</span>&nbsp;<span class="op" id="5764101">{</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5764104">if</span>&nbsp;<span class="ident" id="5764107">c</span>&nbsp;<span class="op" id="5764109">:=</span>&nbsp;<span class="builtinfunc" id="5764112">len</span><span class="op" id="5764115">(</span><span class="ident" id="5764116"><a href="/database/sql/sql.go.html#5764045">db</a></span><span class="op" id="5764118">.</span><span class="ident" id="5764119">connRequests</span><span class="op" id="5764131">)</span><span class="op" id="5764132">;</span>&nbsp;<span class="ident" id="5764134"><a href="/database/sql/sql.go.html#5764107">c</a></span>&nbsp;<span class="op" id="5764136">&gt;</span>&nbsp;<span class="num" id="5764138">0</span>&nbsp;<span class="op" id="5764140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5764144">req</span>&nbsp;<span class="op" id="5764148">:=</span>&nbsp;<span class="ident" id="5764151"><a href="/database/sql/sql.go.html#5764045">db</a></span><span class="op" id="5764153">.</span><span class="ident" id="5764154">connRequests</span><span class="op" id="5764166">[</span><span class="num" id="5764167">0</span><span class="op" id="5764168">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5764172">//&nbsp;This&nbsp;copy&nbsp;is&nbsp;O(n)&nbsp;but&nbsp;in&nbsp;practice&nbsp;faster&nbsp;than&nbsp;a&nbsp;linked&nbsp;list.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5764238">//&nbsp;TODO:&nbsp;consider&nbsp;compacting&nbsp;it&nbsp;down&nbsp;less&nbsp;often&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5764292">//&nbsp;moving&nbsp;the&nbsp;base&nbsp;instead?</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5764322">copy</span><span class="op" id="5764326">(</span><span class="ident" id="5764327"><a href="/database/sql/sql.go.html#5764045">db</a></span><span class="op" id="5764329">.</span><span class="ident" id="5764330">connRequests</span><span class="op" id="5764342">,</span>&nbsp;<span class="ident" id="5764344"><a href="/database/sql/sql.go.html#5764045">db</a></span><span class="op" id="5764346">.</span><span class="ident" id="5764347">connRequests</span><span class="op" id="5764359">[</span><span class="num" id="5764360">1</span><span class="op" id="5764361">:</span><span class="op" id="5764362">]</span><span class="op" id="5764363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5764367"><a href="/database/sql/sql.go.html#5764045">db</a></span><span class="op" id="5764369">.</span><span class="ident" id="5764370">connRequests</span>&nbsp;<span class="op" id="5764383">=</span>&nbsp;<span class="ident" id="5764385"><a href="/database/sql/sql.go.html#5764045">db</a></span><span class="op" id="5764387">.</span><span class="ident" id="5764388">connRequests</span><span class="op" id="5764400">[</span><span class="op" id="5764401">:</span><span class="ident" id="5764402"><a href="/database/sql/sql.go.html#5764107">c</a></span><span class="op" id="5764403">-</span><span class="num" id="5764404">1</span><span class="op" id="5764405">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5764409">if</span>&nbsp;<span class="ident" id="5764412"><a href="/database/sql/sql.go.html#5764085">err</a></span>&nbsp;<span class="op" id="5764416">==</span>&nbsp;<span class="ident" id="5764419">nil</span>&nbsp;<span class="op" id="5764423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5764428"><a href="/database/sql/sql.go.html#5764069">dc</a></span><span class="op" id="5764430">.</span><span class="ident" id="5764431">inUse</span>&nbsp;<span class="op" id="5764437">=</span>&nbsp;<span class="ident" id="5764439">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5764446">}</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5764450"><a href="/database/sql/sql.go.html#5764144">req</a></span>&nbsp;<span class="op" id="5764454">&lt;-</span>&nbsp;<span class="ident" id="5764457"><a href="/database/sql/sql.go.html#5759409">connRequest</a></span><span class="op" id="5764468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5764473">conn</span><span class="op" id="5764477">:</span>&nbsp;<span class="ident" id="5764479"><a href="/database/sql/sql.go.html#5764069">dc</a></span><span class="op" id="5764481">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5764486">err</span><span class="op" id="5764489">:</span>&nbsp;&nbsp;<span class="ident" id="5764492"><a href="/database/sql/sql.go.html#5764085">err</a></span><span class="op" id="5764495">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5764499">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5764503">return</span>&nbsp;<span class="ident" id="5764510">true</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5764516">}</span>&nbsp;<span class="keyword" id="5764518">else</span>&nbsp;<span class="keyword" id="5764523">if</span>&nbsp;<span class="ident" id="5764526"><a href="/database/sql/sql.go.html#5764085">err</a></span>&nbsp;<span class="op" id="5764530">==</span>&nbsp;<span class="ident" id="5764533">nil</span>&nbsp;<span class="op" id="5764537">&amp;&amp;</span>&nbsp;<span class="op" id="5764540">!</span><span class="ident" id="5764541"><a href="/database/sql/sql.go.html#5764045">db</a></span><span class="op" id="5764543">.</span><span class="ident" id="5764544">closed</span>&nbsp;<span class="op" id="5764551">&amp;&amp;</span>&nbsp;<span class="ident" id="5764554"><a href="/database/sql/sql.go.html#5764045">db</a></span><span class="op" id="5764556">.</span><span class="ident" id="5764557">maxIdleConnsLocked</span><span class="op" id="5764575">(</span><span class="op" id="5764576">)</span>&nbsp;<span class="op" id="5764578">&gt;</span>&nbsp;<span class="builtinfunc" id="5764580">len</span><span class="op" id="5764583">(</span><span class="ident" id="5764584"><a href="/database/sql/sql.go.html#5764045">db</a></span><span class="op" id="5764586">.</span><span class="ident" id="5764587">freeConn</span><span class="op" id="5764595">)</span>&nbsp;<span class="op" id="5764597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5764601"><a href="/database/sql/sql.go.html#5764045">db</a></span><span class="op" id="5764603">.</span><span class="ident" id="5764604">freeConn</span>&nbsp;<span class="op" id="5764613">=</span>&nbsp;<span class="builtinfunc" id="5764615">append</span><span class="op" id="5764621">(</span><span class="ident" id="5764622"><a href="/database/sql/sql.go.html#5764045">db</a></span><span class="op" id="5764624">.</span><span class="ident" id="5764625">freeConn</span><span class="op" id="5764633">,</span>&nbsp;<span class="ident" id="5764635"><a href="/database/sql/sql.go.html#5764069">dc</a></span><span class="op" id="5764637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5764641">return</span>&nbsp;<span class="ident" id="5764648">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5764654">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5764657">return</span>&nbsp;<span class="ident" id="5764664">false</span><br>
<span class="lineno">820</span><span class="op" id="5764670">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5764673">//&nbsp;maxBadConnRetries&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;maximum&nbsp;retries&nbsp;if&nbsp;the&nbsp;driver&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="5764749">//&nbsp;driver.ErrBadConn&nbsp;to&nbsp;signal&nbsp;a&nbsp;broken&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="5764801">const</span>&nbsp;<span class="ident" id="5764807">maxBadConnRetries</span>&nbsp;<span class="op" id="5764825">=</span>&nbsp;<span class="num" id="5764827">10</span><br>
<span class="lineno">825</span><br>
<span class="lineno"></span><span class="comment" id="5764831">//&nbsp;Prepare&nbsp;creates&nbsp;a&nbsp;prepared&nbsp;statement&nbsp;for&nbsp;later&nbsp;queries&nbsp;or&nbsp;executions.</span><br>
<span class="lineno"></span><span class="comment" id="5764904">//&nbsp;Multiple&nbsp;queries&nbsp;or&nbsp;executions&nbsp;may&nbsp;be&nbsp;run&nbsp;concurrently&nbsp;from&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5764971">//&nbsp;returned&nbsp;statement.</span><br>
<span class="lineno"></span><span class="keyword" id="5764994">func</span>&nbsp;<span class="op" id="5764999">(</span><span class="ident" id="5765000">db</span>&nbsp;<span class="op" id="5765003">*</span><span class="ident" id="5765004"><a href="/database/sql/sql.go.html#5748306">DB</a></span><span class="op" id="5765006">)</span>&nbsp;<span class="ident" id="5765008">Prepare</span><span class="op" id="5765015">(</span><span class="ident" id="5765016">query</span>&nbsp;<span class="builtintype" id="5765022">string</span><span class="op" id="5765028">)</span>&nbsp;<span class="op" id="5765030">(</span><span class="op" id="5765031">*</span><span class="ident" id="5765032"><a href="/database/sql/sql.go.html#5775599">Stmt</a></span><span class="op" id="5765036">,</span>&nbsp;<span class="builtintype" id="5765038">error</span><span class="op" id="5765043">)</span>&nbsp;<span class="op" id="5765045">{</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5765048">var</span>&nbsp;<span class="ident" id="5765052">stmt</span>&nbsp;<span class="op" id="5765057">*</span><span class="ident" id="5765058"><a href="/database/sql/sql.go.html#5775599">Stmt</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5765064">var</span>&nbsp;<span class="ident" id="5765068">err</span>&nbsp;<span class="builtintype" id="5765072">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5765079">for</span>&nbsp;<span class="ident" id="5765083">i</span>&nbsp;<span class="op" id="5765085">:=</span>&nbsp;<span class="num" id="5765088">0</span><span class="op" id="5765089">;</span>&nbsp;<span class="ident" id="5765091"><a href="/database/sql/sql.go.html#5765083">i</a></span>&nbsp;<span class="op" id="5765093">&lt;</span>&nbsp;<span class="ident" id="5765095"><a href="/database/sql/sql.go.html#5764807">maxBadConnRetries</a></span><span class="op" id="5765112">;</span>&nbsp;<span class="ident" id="5765114"><a href="/database/sql/sql.go.html#5765083">i</a></span><span class="op" id="5765115">++</span>&nbsp;<span class="op" id="5765118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5765122"><a href="/database/sql/sql.go.html#5765052">stmt</a></span><span class="op" id="5765126">,</span>&nbsp;<span class="ident" id="5765128"><a href="/database/sql/sql.go.html#5765068">err</a></span>&nbsp;<span class="op" id="5765132">=</span>&nbsp;<span class="ident" id="5765134"><a href="/database/sql/sql.go.html#5765000">db</a></span><span class="op" id="5765136">.</span><span class="ident" id="5765137">prepare</span><span class="op" id="5765144">(</span><span class="ident" id="5765145"><a href="/database/sql/sql.go.html#5765016">query</a></span><span class="op" id="5765150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5765154">if</span>&nbsp;<span class="ident" id="5765157"><a href="/database/sql/sql.go.html#5765068">err</a></span>&nbsp;<span class="op" id="5765161">!=</span>&nbsp;<span class="ident" id="5765164"><a href="/database/sql/sql.go.html#5743212">driver</a></span><span class="op" id="5765170">.</span><span class="ident" id="5765171">ErrBadConn</span>&nbsp;<span class="op" id="5765182">{</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5765187">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5765195">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5765198">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5765201">return</span>&nbsp;<span class="ident" id="5765208"><a href="/database/sql/sql.go.html#5765052">stmt</a></span><span class="op" id="5765212">,</span>&nbsp;<span class="ident" id="5765214"><a href="/database/sql/sql.go.html#5765068">err</a></span><br>
<span class="lineno"></span><span class="op" id="5765218">}</span><br>
<span class="lineno">840</span><br>
<span class="lineno"></span><span class="keyword" id="5765221">func</span>&nbsp;<span class="op" id="5765226">(</span><span class="ident" id="5765227">db</span>&nbsp;<span class="op" id="5765230">*</span><span class="ident" id="5765231"><a href="/database/sql/sql.go.html#5748306">DB</a></span><span class="op" id="5765233">)</span>&nbsp;<span class="ident" id="5765235">prepare</span><span class="op" id="5765242">(</span><span class="ident" id="5765243">query</span>&nbsp;<span class="builtintype" id="5765249">string</span><span class="op" id="5765255">)</span>&nbsp;<span class="op" id="5765257">(</span><span class="op" id="5765258">*</span><span class="ident" id="5765259"><a href="/database/sql/sql.go.html#5775599">Stmt</a></span><span class="op" id="5765263">,</span>&nbsp;<span class="builtintype" id="5765265">error</span><span class="op" id="5765270">)</span>&nbsp;<span class="op" id="5765272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5765275">//&nbsp;TODO:&nbsp;check&nbsp;if&nbsp;db.driver&nbsp;supports&nbsp;an&nbsp;optional</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5765325">//&nbsp;driver.Preparer&nbsp;interface&nbsp;and&nbsp;call&nbsp;that&nbsp;instead,&nbsp;if&nbsp;so,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5765385">//&nbsp;otherwise&nbsp;we&nbsp;make&nbsp;a&nbsp;prepared&nbsp;statement&nbsp;that&#39;s&nbsp;bound</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5765441">//&nbsp;to&nbsp;a&nbsp;connection,&nbsp;and&nbsp;to&nbsp;execute&nbsp;this&nbsp;prepared&nbsp;statement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5765501">//&nbsp;we&nbsp;either&nbsp;need&nbsp;to&nbsp;use&nbsp;this&nbsp;connection&nbsp;(if&nbsp;it&#39;s&nbsp;free),&nbsp;else</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5765564">//&nbsp;get&nbsp;a&nbsp;new&nbsp;connection&nbsp;+&nbsp;re-prepare&nbsp;+&nbsp;execute&nbsp;on&nbsp;that&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5765625">dc</span><span class="op" id="5765627">,</span>&nbsp;<span class="ident" id="5765629">err</span>&nbsp;<span class="op" id="5765633">:=</span>&nbsp;<span class="ident" id="5765636"><a href="/database/sql/sql.go.html#5765227">db</a></span><span class="op" id="5765638">.</span><span class="ident" id="5765639">conn</span><span class="op" id="5765643">(</span><span class="op" id="5765644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5765647">if</span>&nbsp;<span class="ident" id="5765650"><a href="/database/sql/sql.go.html#5765629">err</a></span>&nbsp;<span class="op" id="5765654">!=</span>&nbsp;<span class="ident" id="5765657">nil</span>&nbsp;<span class="op" id="5765661">{</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5765665">return</span>&nbsp;<span class="ident" id="5765672">nil</span><span class="op" id="5765675">,</span>&nbsp;<span class="ident" id="5765677"><a href="/database/sql/sql.go.html#5765629">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5765682">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5765685"><a href="/database/sql/sql.go.html#5765625">dc</a></span><span class="op" id="5765687">.</span><span class="ident" id="5765688">Lock</span><span class="op" id="5765692">(</span><span class="op" id="5765693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5765696">si</span><span class="op" id="5765698">,</span>&nbsp;<span class="ident" id="5765700"><a href="/database/sql/sql.go.html#5765629">err</a></span>&nbsp;<span class="op" id="5765704">:=</span>&nbsp;<span class="ident" id="5765707"><a href="/database/sql/sql.go.html#5765625">dc</a></span><span class="op" id="5765709">.</span><span class="ident" id="5765710">prepareLocked</span><span class="op" id="5765723">(</span><span class="ident" id="5765724"><a href="/database/sql/sql.go.html#5765243">query</a></span><span class="op" id="5765729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5765732"><a href="/database/sql/sql.go.html#5765625">dc</a></span><span class="op" id="5765734">.</span><span class="ident" id="5765735">Unlock</span><span class="op" id="5765741">(</span><span class="op" id="5765742">)</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5765745">if</span>&nbsp;<span class="ident" id="5765748"><a href="/database/sql/sql.go.html#5765629">err</a></span>&nbsp;<span class="op" id="5765752">!=</span>&nbsp;<span class="ident" id="5765755">nil</span>&nbsp;<span class="op" id="5765759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5765763"><a href="/database/sql/sql.go.html#5765227">db</a></span><span class="op" id="5765765">.</span><span class="ident" id="5765766">putConn</span><span class="op" id="5765773">(</span><span class="ident" id="5765774"><a href="/database/sql/sql.go.html#5765625">dc</a></span><span class="op" id="5765776">,</span>&nbsp;<span class="ident" id="5765778"><a href="/database/sql/sql.go.html#5765629">err</a></span><span class="op" id="5765781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5765785">return</span>&nbsp;<span class="ident" id="5765792">nil</span><span class="op" id="5765795">,</span>&nbsp;<span class="ident" id="5765797"><a href="/database/sql/sql.go.html#5765629">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5765802">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5765805">stmt</span>&nbsp;<span class="op" id="5765810">:=</span>&nbsp;<span class="op" id="5765813">&amp;</span><span class="ident" id="5765814"><a href="/database/sql/sql.go.html#5775599">Stmt</a></span><span class="op" id="5765818">{</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5765822">db</span><span class="op" id="5765824">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5765829"><a href="/database/sql/sql.go.html#5765227">db</a></span><span class="op" id="5765831">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5765835">query</span><span class="op" id="5765840">:</span>&nbsp;<span class="ident" id="5765842"><a href="/database/sql/sql.go.html#5765243">query</a></span><span class="op" id="5765847">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5765851">css</span><span class="op" id="5765854">:</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5765858">[</span><span class="op" id="5765859">]</span><span class="ident" id="5765860"><a href="/database/sql/sql.go.html#5775452">connStmt</a></span><span class="op" id="5765868">{</span><span class="op" id="5765869">{</span><span class="ident" id="5765870"><a href="/database/sql/sql.go.html#5765625">dc</a></span><span class="op" id="5765872">,</span>&nbsp;<span class="ident" id="5765874"><a href="/database/sql/sql.go.html#5765696">si</a></span><span class="op" id="5765876">}</span><span class="op" id="5765877">}</span><span class="op" id="5765878">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5765881">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5765884"><a href="/database/sql/sql.go.html#5765227">db</a></span><span class="op" id="5765886">.</span><span class="ident" id="5765887">addDep</span><span class="op" id="5765893">(</span><span class="ident" id="5765894"><a href="/database/sql/sql.go.html#5765805">stmt</a></span><span class="op" id="5765898">,</span>&nbsp;<span class="ident" id="5765900"><a href="/database/sql/sql.go.html#5765805">stmt</a></span><span class="op" id="5765904">)</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5765907"><a href="/database/sql/sql.go.html#5765227">db</a></span><span class="op" id="5765909">.</span><span class="ident" id="5765910">putConn</span><span class="op" id="5765917">(</span><span class="ident" id="5765918"><a href="/database/sql/sql.go.html#5765625">dc</a></span><span class="op" id="5765920">,</span>&nbsp;<span class="ident" id="5765922">nil</span><span class="op" id="5765925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5765928">return</span>&nbsp;<span class="ident" id="5765935"><a href="/database/sql/sql.go.html#5765805">stmt</a></span><span class="op" id="5765939">,</span>&nbsp;<span class="ident" id="5765941">nil</span><br>
<span class="lineno"></span><span class="op" id="5765945">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5765948">//&nbsp;Exec&nbsp;executes&nbsp;a&nbsp;query&nbsp;without&nbsp;returning&nbsp;any&nbsp;rows.</span><br>
<span class="lineno">870</span><span class="comment" id="5766001">//&nbsp;The&nbsp;args&nbsp;are&nbsp;for&nbsp;any&nbsp;placeholder&nbsp;parameters&nbsp;in&nbsp;the&nbsp;query.</span><br>
<span class="lineno"></span><span class="keyword" id="5766062">func</span>&nbsp;<span class="op" id="5766067">(</span><span class="ident" id="5766068">db</span>&nbsp;<span class="op" id="5766071">*</span><span class="ident" id="5766072"><a href="/database/sql/sql.go.html#5748306">DB</a></span><span class="op" id="5766074">)</span>&nbsp;<span class="ident" id="5766076">Exec</span><span class="op" id="5766080">(</span><span class="ident" id="5766081">query</span>&nbsp;<span class="builtintype" id="5766087">string</span><span class="op" id="5766093">,</span>&nbsp;<span class="ident" id="5766095">args</span>&nbsp;<span class="op" id="5766100">...</span><span class="keyword" id="5766103">interface</span><span class="op" id="5766112">{</span><span class="op" id="5766113">}</span><span class="op" id="5766114">)</span>&nbsp;<span class="op" id="5766116">(</span><span class="ident" id="5766117"><a href="/database/sql/sql.go.html#5787587">Result</a></span><span class="op" id="5766123">,</span>&nbsp;<span class="builtintype" id="5766125">error</span><span class="op" id="5766130">)</span>&nbsp;<span class="op" id="5766132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5766135">var</span>&nbsp;<span class="ident" id="5766139">res</span>&nbsp;<span class="ident" id="5766143"><a href="/database/sql/sql.go.html#5787587">Result</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5766151">var</span>&nbsp;<span class="ident" id="5766155">err</span>&nbsp;<span class="builtintype" id="5766159">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5766166">for</span>&nbsp;<span class="ident" id="5766170">i</span>&nbsp;<span class="op" id="5766172">:=</span>&nbsp;<span class="num" id="5766175">0</span><span class="op" id="5766176">;</span>&nbsp;<span class="ident" id="5766178"><a href="/database/sql/sql.go.html#5766170">i</a></span>&nbsp;<span class="op" id="5766180">&lt;</span>&nbsp;<span class="ident" id="5766182"><a href="/database/sql/sql.go.html#5764807">maxBadConnRetries</a></span><span class="op" id="5766199">;</span>&nbsp;<span class="ident" id="5766201"><a href="/database/sql/sql.go.html#5766170">i</a></span><span class="op" id="5766202">++</span>&nbsp;<span class="op" id="5766205">{</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5766209"><a href="/database/sql/sql.go.html#5766139">res</a></span><span class="op" id="5766212">,</span>&nbsp;<span class="ident" id="5766214"><a href="/database/sql/sql.go.html#5766155">err</a></span>&nbsp;<span class="op" id="5766218">=</span>&nbsp;<span class="ident" id="5766220"><a href="/database/sql/sql.go.html#5766068">db</a></span><span class="op" id="5766222">.</span><span class="ident" id="5766223">exec</span><span class="op" id="5766227">(</span><span class="ident" id="5766228"><a href="/database/sql/sql.go.html#5766081">query</a></span><span class="op" id="5766233">,</span>&nbsp;<span class="ident" id="5766235"><a href="/database/sql/sql.go.html#5766095">args</a></span><span class="op" id="5766239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5766243">if</span>&nbsp;<span class="ident" id="5766246"><a href="/database/sql/sql.go.html#5766155">err</a></span>&nbsp;<span class="op" id="5766250">!=</span>&nbsp;<span class="ident" id="5766253"><a href="/database/sql/sql.go.html#5743212">driver</a></span><span class="op" id="5766259">.</span><span class="ident" id="5766260">ErrBadConn</span>&nbsp;<span class="op" id="5766271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5766276">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5766284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5766287">}</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5766290">return</span>&nbsp;<span class="ident" id="5766297"><a href="/database/sql/sql.go.html#5766139">res</a></span><span class="op" id="5766300">,</span>&nbsp;<span class="ident" id="5766302"><a href="/database/sql/sql.go.html#5766155">err</a></span><br>
<span class="lineno"></span><span class="op" id="5766306">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5766309">func</span>&nbsp;<span class="op" id="5766314">(</span><span class="ident" id="5766315">db</span>&nbsp;<span class="op" id="5766318">*</span><span class="ident" id="5766319"><a href="/database/sql/sql.go.html#5748306">DB</a></span><span class="op" id="5766321">)</span>&nbsp;<span class="ident" id="5766323">exec</span><span class="op" id="5766327">(</span><span class="ident" id="5766328">query</span>&nbsp;<span class="builtintype" id="5766334">string</span><span class="op" id="5766340">,</span>&nbsp;<span class="ident" id="5766342">args</span>&nbsp;<span class="op" id="5766347">[</span><span class="op" id="5766348">]</span><span class="keyword" id="5766349">interface</span><span class="op" id="5766358">{</span><span class="op" id="5766359">}</span><span class="op" id="5766360">)</span>&nbsp;<span class="op" id="5766362">(</span><span class="ident" id="5766363">res</span>&nbsp;<span class="ident" id="5766367"><a href="/database/sql/sql.go.html#5787587">Result</a></span><span class="op" id="5766373">,</span>&nbsp;<span class="ident" id="5766375">err</span>&nbsp;<span class="builtintype" id="5766379">error</span><span class="op" id="5766384">)</span>&nbsp;<span class="op" id="5766386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5766389">dc</span><span class="op" id="5766391">,</span>&nbsp;<span class="ident" id="5766393"><a href="/database/sql/sql.go.html#5766375">err</a></span>&nbsp;<span class="op" id="5766397">:=</span>&nbsp;<span class="ident" id="5766400"><a href="/database/sql/sql.go.html#5766315">db</a></span><span class="op" id="5766402">.</span><span class="ident" id="5766403">conn</span><span class="op" id="5766407">(</span><span class="op" id="5766408">)</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5766411">if</span>&nbsp;<span class="ident" id="5766414"><a href="/database/sql/sql.go.html#5766375">err</a></span>&nbsp;<span class="op" id="5766418">!=</span>&nbsp;<span class="ident" id="5766421">nil</span>&nbsp;<span class="op" id="5766425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5766429">return</span>&nbsp;<span class="ident" id="5766436">nil</span><span class="op" id="5766439">,</span>&nbsp;<span class="ident" id="5766441"><a href="/database/sql/sql.go.html#5766375">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5766446">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5766449">defer</span>&nbsp;<span class="keyword" id="5766455">func</span><span class="op" id="5766459">(</span><span class="op" id="5766460">)</span>&nbsp;<span class="op" id="5766462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5766466"><a href="/database/sql/sql.go.html#5766315">db</a></span><span class="op" id="5766468">.</span><span class="ident" id="5766469">putConn</span><span class="op" id="5766476">(</span><span class="ident" id="5766477"><a href="/database/sql/sql.go.html#5766389">dc</a></span><span class="op" id="5766479">,</span>&nbsp;<span class="ident" id="5766481"><a href="/database/sql/sql.go.html#5766375">err</a></span><span class="op" id="5766484">)</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5766487">}</span><span class="op" id="5766488">(</span><span class="op" id="5766489">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5766493">if</span>&nbsp;<span class="ident" id="5766496">execer</span><span class="op" id="5766502">,</span>&nbsp;<span class="ident" id="5766504">ok</span>&nbsp;<span class="op" id="5766507">:=</span>&nbsp;<span class="ident" id="5766510"><a href="/database/sql/sql.go.html#5766389">dc</a></span><span class="op" id="5766512">.</span><span class="ident" id="5766513">ci</span><span class="op" id="5766515">.</span><span class="op" id="5766516">(</span><span class="ident" id="5766517"><a href="/database/sql/sql.go.html#5743212">driver</a></span><span class="op" id="5766523">.</span><span class="ident" id="5766524">Execer</span><span class="op" id="5766530">)</span><span class="op" id="5766531">;</span>&nbsp;<span class="ident" id="5766533"><a href="/database/sql/sql.go.html#5766504">ok</a></span>&nbsp;<span class="op" id="5766536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5766540">dargs</span><span class="op" id="5766545">,</span>&nbsp;<span class="ident" id="5766547">err</span>&nbsp;<span class="op" id="5766551">:=</span>&nbsp;<span class="ident" id="5766554"><a href="/database/sql/convert.go.html#5735966">driverArgs</a></span><span class="op" id="5766564">(</span><span class="ident" id="5766565">nil</span><span class="op" id="5766568">,</span>&nbsp;<span class="ident" id="5766570"><a href="/database/sql/sql.go.html#5766342">args</a></span><span class="op" id="5766574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5766578">if</span>&nbsp;<span class="ident" id="5766581"><a href="/database/sql/sql.go.html#5766547">err</a></span>&nbsp;<span class="op" id="5766585">!=</span>&nbsp;<span class="ident" id="5766588">nil</span>&nbsp;<span class="op" id="5766592">{</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5766597">return</span>&nbsp;<span class="ident" id="5766604">nil</span><span class="op" id="5766607">,</span>&nbsp;<span class="ident" id="5766609"><a href="/database/sql/sql.go.html#5766547">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5766615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5766619"><a href="/database/sql/sql.go.html#5766389">dc</a></span><span class="op" id="5766621">.</span><span class="ident" id="5766622">Lock</span><span class="op" id="5766626">(</span><span class="op" id="5766627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5766631">resi</span><span class="op" id="5766635">,</span>&nbsp;<span class="ident" id="5766637"><a href="/database/sql/sql.go.html#5766547">err</a></span>&nbsp;<span class="op" id="5766641">:=</span>&nbsp;<span class="ident" id="5766644"><a href="/database/sql/sql.go.html#5766496">execer</a></span><span class="op" id="5766650">.</span><span class="ident" id="5766651">Exec</span><span class="op" id="5766655">(</span><span class="ident" id="5766656"><a href="/database/sql/sql.go.html#5766328">query</a></span><span class="op" id="5766661">,</span>&nbsp;<span class="ident" id="5766663"><a href="/database/sql/sql.go.html#5766540">dargs</a></span><span class="op" id="5766668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5766672"><a href="/database/sql/sql.go.html#5766389">dc</a></span><span class="op" id="5766674">.</span><span class="ident" id="5766675">Unlock</span><span class="op" id="5766681">(</span><span class="op" id="5766682">)</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5766686">if</span>&nbsp;<span class="ident" id="5766689"><a href="/database/sql/sql.go.html#5766547">err</a></span>&nbsp;<span class="op" id="5766693">!=</span>&nbsp;<span class="ident" id="5766696"><a href="/database/sql/sql.go.html#5743212">driver</a></span><span class="op" id="5766702">.</span><span class="ident" id="5766703">ErrSkip</span>&nbsp;<span class="op" id="5766711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5766716">if</span>&nbsp;<span class="ident" id="5766719"><a href="/database/sql/sql.go.html#5766547">err</a></span>&nbsp;<span class="op" id="5766723">!=</span>&nbsp;<span class="ident" id="5766726">nil</span>&nbsp;<span class="op" id="5766730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5766736">return</span>&nbsp;<span class="ident" id="5766743">nil</span><span class="op" id="5766746">,</span>&nbsp;<span class="ident" id="5766748"><a href="/database/sql/sql.go.html#5766547">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5766755">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5766760">return</span>&nbsp;<span class="ident" id="5766767"><a href="/database/sql/sql.go.html#5788095">driverResult</a></span><span class="op" id="5766779">{</span><span class="ident" id="5766780"><a href="/database/sql/sql.go.html#5766389">dc</a></span><span class="op" id="5766782">,</span>&nbsp;<span class="ident" id="5766784"><a href="/database/sql/sql.go.html#5766631">resi</a></span><span class="op" id="5766788">}</span><span class="op" id="5766789">,</span>&nbsp;<span class="ident" id="5766791">nil</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5766797">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5766800">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5766804"><a href="/database/sql/sql.go.html#5766389">dc</a></span><span class="op" id="5766806">.</span><span class="ident" id="5766807">Lock</span><span class="op" id="5766811">(</span><span class="op" id="5766812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5766815">si</span><span class="op" id="5766817">,</span>&nbsp;<span class="ident" id="5766819"><a href="/database/sql/sql.go.html#5766375">err</a></span>&nbsp;<span class="op" id="5766823">:=</span>&nbsp;<span class="ident" id="5766826"><a href="/database/sql/sql.go.html#5766389">dc</a></span><span class="op" id="5766828">.</span><span class="ident" id="5766829">ci</span><span class="op" id="5766831">.</span><span class="ident" id="5766832">Prepare</span><span class="op" id="5766839">(</span><span class="ident" id="5766840"><a href="/database/sql/sql.go.html#5766328">query</a></span><span class="op" id="5766845">)</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5766848"><a href="/database/sql/sql.go.html#5766389">dc</a></span><span class="op" id="5766850">.</span><span class="ident" id="5766851">Unlock</span><span class="op" id="5766857">(</span><span class="op" id="5766858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5766861">if</span>&nbsp;<span class="ident" id="5766864"><a href="/database/sql/sql.go.html#5766375">err</a></span>&nbsp;<span class="op" id="5766868">!=</span>&nbsp;<span class="ident" id="5766871">nil</span>&nbsp;<span class="op" id="5766875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5766879">return</span>&nbsp;<span class="ident" id="5766886">nil</span><span class="op" id="5766889">,</span>&nbsp;<span class="ident" id="5766891"><a href="/database/sql/sql.go.html#5766375">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5766896">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5766899">defer</span>&nbsp;<span class="ident" id="5766905"><a href="/database/sql/sql.go.html#5788556">withLock</a></span><span class="op" id="5766913">(</span><span class="ident" id="5766914"><a href="/database/sql/sql.go.html#5766389">dc</a></span><span class="op" id="5766916">,</span>&nbsp;<span class="keyword" id="5766918">func</span><span class="op" id="5766922">(</span><span class="op" id="5766923">)</span>&nbsp;<span class="op" id="5766925">{</span>&nbsp;<span class="ident" id="5766927"><a href="/database/sql/sql.go.html#5766815">si</a></span><span class="op" id="5766929">.</span><span class="ident" id="5766930">Close</span><span class="op" id="5766935">(</span><span class="op" id="5766936">)</span>&nbsp;<span class="op" id="5766938">}</span><span class="op" id="5766939">)</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5766942">return</span>&nbsp;<span class="ident" id="5766949"><a href="/database/sql/sql.go.html#5776852">resultFromStatement</a></span><span class="op" id="5766968">(</span><span class="ident" id="5766969"><a href="/database/sql/sql.go.html#5751783">driverStmt</a></span><span class="op" id="5766979">{</span><span class="ident" id="5766980"><a href="/database/sql/sql.go.html#5766389">dc</a></span><span class="op" id="5766982">,</span>&nbsp;<span class="ident" id="5766984"><a href="/database/sql/sql.go.html#5766815">si</a></span><span class="op" id="5766986">}</span><span class="op" id="5766987">,</span>&nbsp;<span class="ident" id="5766989"><a href="/database/sql/sql.go.html#5766342">args</a></span><span class="op" id="5766993">...</span><span class="op" id="5766996">)</span><br>
<span class="lineno"></span><span class="op" id="5766998">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5767001">//&nbsp;Query&nbsp;executes&nbsp;a&nbsp;query&nbsp;that&nbsp;returns&nbsp;rows,&nbsp;typically&nbsp;a&nbsp;SELECT.</span><br>
<span class="lineno"></span><span class="comment" id="5767066">//&nbsp;The&nbsp;args&nbsp;are&nbsp;for&nbsp;any&nbsp;placeholder&nbsp;parameters&nbsp;in&nbsp;the&nbsp;query.</span><br>
<span class="lineno">920</span><span class="keyword" id="5767127">func</span>&nbsp;<span class="op" id="5767132">(</span><span class="ident" id="5767133">db</span>&nbsp;<span class="op" id="5767136">*</span><span class="ident" id="5767137"><a href="/database/sql/sql.go.html#5748306">DB</a></span><span class="op" id="5767139">)</span>&nbsp;<span class="ident" id="5767141">Query</span><span class="op" id="5767146">(</span><span class="ident" id="5767147">query</span>&nbsp;<span class="builtintype" id="5767153">string</span><span class="op" id="5767159">,</span>&nbsp;<span class="ident" id="5767161">args</span>&nbsp;<span class="op" id="5767166">...</span><span class="keyword" id="5767169">interface</span><span class="op" id="5767178">{</span><span class="op" id="5767179">}</span><span class="op" id="5767180">)</span>&nbsp;<span class="op" id="5767182">(</span><span class="op" id="5767183">*</span><span class="ident" id="5767184"><a href="/database/sql/sql.go.html#5782647">Rows</a></span><span class="op" id="5767188">,</span>&nbsp;<span class="builtintype" id="5767190">error</span><span class="op" id="5767195">)</span>&nbsp;<span class="op" id="5767197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5767200">var</span>&nbsp;<span class="ident" id="5767204">rows</span>&nbsp;<span class="op" id="5767209">*</span><span class="ident" id="5767210"><a href="/database/sql/sql.go.html#5782647">Rows</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5767216">var</span>&nbsp;<span class="ident" id="5767220">err</span>&nbsp;<span class="builtintype" id="5767224">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5767231">for</span>&nbsp;<span class="ident" id="5767235">i</span>&nbsp;<span class="op" id="5767237">:=</span>&nbsp;<span class="num" id="5767240">0</span><span class="op" id="5767241">;</span>&nbsp;<span class="ident" id="5767243"><a href="/database/sql/sql.go.html#5767235">i</a></span>&nbsp;<span class="op" id="5767245">&lt;</span>&nbsp;<span class="ident" id="5767247"><a href="/database/sql/sql.go.html#5764807">maxBadConnRetries</a></span><span class="op" id="5767264">;</span>&nbsp;<span class="ident" id="5767266"><a href="/database/sql/sql.go.html#5767235">i</a></span><span class="op" id="5767267">++</span>&nbsp;<span class="op" id="5767270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5767274"><a href="/database/sql/sql.go.html#5767204">rows</a></span><span class="op" id="5767278">,</span>&nbsp;<span class="ident" id="5767280"><a href="/database/sql/sql.go.html#5767220">err</a></span>&nbsp;<span class="op" id="5767284">=</span>&nbsp;<span class="ident" id="5767286"><a href="/database/sql/sql.go.html#5767133">db</a></span><span class="op" id="5767288">.</span><span class="ident" id="5767289">query</span><span class="op" id="5767294">(</span><span class="ident" id="5767295"><a href="/database/sql/sql.go.html#5767147">query</a></span><span class="op" id="5767300">,</span>&nbsp;<span class="ident" id="5767302"><a href="/database/sql/sql.go.html#5767161">args</a></span><span class="op" id="5767306">)</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5767310">if</span>&nbsp;<span class="ident" id="5767313"><a href="/database/sql/sql.go.html#5767220">err</a></span>&nbsp;<span class="op" id="5767317">!=</span>&nbsp;<span class="ident" id="5767320"><a href="/database/sql/sql.go.html#5743212">driver</a></span><span class="op" id="5767326">.</span><span class="ident" id="5767327">ErrBadConn</span>&nbsp;<span class="op" id="5767338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5767343">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5767351">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5767354">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5767357">return</span>&nbsp;<span class="ident" id="5767364"><a href="/database/sql/sql.go.html#5767204">rows</a></span><span class="op" id="5767368">,</span>&nbsp;<span class="ident" id="5767370"><a href="/database/sql/sql.go.html#5767220">err</a></span><br>
<span class="lineno">930</span><span class="op" id="5767374">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5767377">func</span>&nbsp;<span class="op" id="5767382">(</span><span class="ident" id="5767383">db</span>&nbsp;<span class="op" id="5767386">*</span><span class="ident" id="5767387"><a href="/database/sql/sql.go.html#5748306">DB</a></span><span class="op" id="5767389">)</span>&nbsp;<span class="ident" id="5767391">query</span><span class="op" id="5767396">(</span><span class="ident" id="5767397">query</span>&nbsp;<span class="builtintype" id="5767403">string</span><span class="op" id="5767409">,</span>&nbsp;<span class="ident" id="5767411">args</span>&nbsp;<span class="op" id="5767416">[</span><span class="op" id="5767417">]</span><span class="keyword" id="5767418">interface</span><span class="op" id="5767427">{</span><span class="op" id="5767428">}</span><span class="op" id="5767429">)</span>&nbsp;<span class="op" id="5767431">(</span><span class="op" id="5767432">*</span><span class="ident" id="5767433"><a href="/database/sql/sql.go.html#5782647">Rows</a></span><span class="op" id="5767437">,</span>&nbsp;<span class="builtintype" id="5767439">error</span><span class="op" id="5767444">)</span>&nbsp;<span class="op" id="5767446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5767449">ci</span><span class="op" id="5767451">,</span>&nbsp;<span class="ident" id="5767453">err</span>&nbsp;<span class="op" id="5767457">:=</span>&nbsp;<span class="ident" id="5767460"><a href="/database/sql/sql.go.html#5767383">db</a></span><span class="op" id="5767462">.</span><span class="ident" id="5767463">conn</span><span class="op" id="5767467">(</span><span class="op" id="5767468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5767471">if</span>&nbsp;<span class="ident" id="5767474"><a href="/database/sql/sql.go.html#5767453">err</a></span>&nbsp;<span class="op" id="5767478">!=</span>&nbsp;<span class="ident" id="5767481">nil</span>&nbsp;<span class="op" id="5767485">{</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5767489">return</span>&nbsp;<span class="ident" id="5767496">nil</span><span class="op" id="5767499">,</span>&nbsp;<span class="ident" id="5767501"><a href="/database/sql/sql.go.html#5767453">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5767506">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5767510">return</span>&nbsp;<span class="ident" id="5767517"><a href="/database/sql/sql.go.html#5767383">db</a></span><span class="op" id="5767519">.</span><span class="ident" id="5767520">queryConn</span><span class="op" id="5767529">(</span><span class="ident" id="5767530"><a href="/database/sql/sql.go.html#5767449">ci</a></span><span class="op" id="5767532">,</span>&nbsp;<span class="ident" id="5767534"><a href="/database/sql/sql.go.html#5767449">ci</a></span><span class="op" id="5767536">.</span><span class="ident" id="5767537">releaseConn</span><span class="op" id="5767548">,</span>&nbsp;<span class="ident" id="5767550"><a href="/database/sql/sql.go.html#5767397">query</a></span><span class="op" id="5767555">,</span>&nbsp;<span class="ident" id="5767557"><a href="/database/sql/sql.go.html#5767411">args</a></span><span class="op" id="5767561">)</span><br>
<span class="lineno"></span><span class="op" id="5767563">}</span><br>
<span class="lineno">940</span><br>
<span class="lineno"></span><span class="comment" id="5767566">//&nbsp;queryConn&nbsp;executes&nbsp;a&nbsp;query&nbsp;on&nbsp;the&nbsp;given&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="5767621">//&nbsp;The&nbsp;connection&nbsp;gets&nbsp;released&nbsp;by&nbsp;the&nbsp;releaseConn&nbsp;function.</span><br>
<span class="lineno"></span><span class="keyword" id="5767682">func</span>&nbsp;<span class="op" id="5767687">(</span><span class="ident" id="5767688">db</span>&nbsp;<span class="op" id="5767691">*</span><span class="ident" id="5767692"><a href="/database/sql/sql.go.html#5748306">DB</a></span><span class="op" id="5767694">)</span>&nbsp;<span class="ident" id="5767696">queryConn</span><span class="op" id="5767705">(</span><span class="ident" id="5767706">dc</span>&nbsp;<span class="op" id="5767709">*</span><span class="ident" id="5767710"><a href="/database/sql/sql.go.html#5749298">driverConn</a></span><span class="op" id="5767720">,</span>&nbsp;<span class="ident" id="5767722">releaseConn</span>&nbsp;<span class="keyword" id="5767734">func</span><span class="op" id="5767738">(</span><span class="builtintype" id="5767739">error</span><span class="op" id="5767744">)</span><span class="op" id="5767745">,</span>&nbsp;<span class="ident" id="5767747">query</span>&nbsp;<span class="builtintype" id="5767753">string</span><span class="op" id="5767759">,</span>&nbsp;<span class="ident" id="5767761">args</span>&nbsp;<span class="op" id="5767766">[</span><span class="op" id="5767767">]</span><span class="keyword" id="5767768">interface</span><span class="op" id="5767777">{</span><span class="op" id="5767778">}</span><span class="op" id="5767779">)</span>&nbsp;<span class="op" id="5767781">(</span><span class="op" id="5767782">*</span><span class="ident" id="5767783"><a href="/database/sql/sql.go.html#5782647">Rows</a></span><span class="op" id="5767787">,</span>&nbsp;<span class="builtintype" id="5767789">error</span><span class="op" id="5767794">)</span>&nbsp;<span class="op" id="5767796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5767799">if</span>&nbsp;<span class="ident" id="5767802">queryer</span><span class="op" id="5767809">,</span>&nbsp;<span class="ident" id="5767811">ok</span>&nbsp;<span class="op" id="5767814">:=</span>&nbsp;<span class="ident" id="5767817"><a href="/database/sql/sql.go.html#5767706">dc</a></span><span class="op" id="5767819">.</span><span class="ident" id="5767820">ci</span><span class="op" id="5767822">.</span><span class="op" id="5767823">(</span><span class="ident" id="5767824"><a href="/database/sql/sql.go.html#5743212">driver</a></span><span class="op" id="5767830">.</span><span class="ident" id="5767831">Queryer</span><span class="op" id="5767838">)</span><span class="op" id="5767839">;</span>&nbsp;<span class="ident" id="5767841"><a href="/database/sql/sql.go.html#5767811">ok</a></span>&nbsp;<span class="op" id="5767844">{</span><br>
<span class="lineno">945</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5767848">dargs</span><span class="op" id="5767853">,</span>&nbsp;<span class="ident" id="5767855">err</span>&nbsp;<span class="op" id="5767859">:=</span>&nbsp;<span class="ident" id="5767862"><a href="/database/sql/convert.go.html#5735966">driverArgs</a></span><span class="op" id="5767872">(</span><span class="ident" id="5767873">nil</span><span class="op" id="5767876">,</span>&nbsp;<span class="ident" id="5767878"><a href="/database/sql/sql.go.html#5767761">args</a></span><span class="op" id="5767882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5767886">if</span>&nbsp;<span class="ident" id="5767889"><a href="/database/sql/sql.go.html#5767855">err</a></span>&nbsp;<span class="op" id="5767893">!=</span>&nbsp;<span class="ident" id="5767896">nil</span>&nbsp;<span class="op" id="5767900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5767905"><a href="/database/sql/sql.go.html#5767722">releaseConn</a></span><span class="op" id="5767916">(</span><span class="ident" id="5767917"><a href="/database/sql/sql.go.html#5767855">err</a></span><span class="op" id="5767920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5767925">return</span>&nbsp;<span class="ident" id="5767932">nil</span><span class="op" id="5767935">,</span>&nbsp;<span class="ident" id="5767937"><a href="/database/sql/sql.go.html#5767855">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5767943">}</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5767947"><a href="/database/sql/sql.go.html#5767706">dc</a></span><span class="op" id="5767949">.</span><span class="ident" id="5767950">Lock</span><span class="op" id="5767954">(</span><span class="op" id="5767955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5767959">rowsi</span><span class="op" id="5767964">,</span>&nbsp;<span class="ident" id="5767966"><a href="/database/sql/sql.go.html#5767855">err</a></span>&nbsp;<span class="op" id="5767970">:=</span>&nbsp;<span class="ident" id="5767973"><a href="/database/sql/sql.go.html#5767802">queryer</a></span><span class="op" id="5767980">.</span><span class="ident" id="5767981">Query</span><span class="op" id="5767986">(</span><span class="ident" id="5767987"><a href="/database/sql/sql.go.html#5767747">query</a></span><span class="op" id="5767992">,</span>&nbsp;<span class="ident" id="5767994"><a href="/database/sql/sql.go.html#5767848">dargs</a></span><span class="op" id="5767999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5768003"><a href="/database/sql/sql.go.html#5767706">dc</a></span><span class="op" id="5768005">.</span><span class="ident" id="5768006">Unlock</span><span class="op" id="5768012">(</span><span class="op" id="5768013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5768017">if</span>&nbsp;<span class="ident" id="5768020"><a href="/database/sql/sql.go.html#5767855">err</a></span>&nbsp;<span class="op" id="5768024">!=</span>&nbsp;<span class="ident" id="5768027"><a href="/database/sql/sql.go.html#5743212">driver</a></span><span class="op" id="5768033">.</span><span class="ident" id="5768034">ErrSkip</span>&nbsp;<span class="op" id="5768042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5768047">if</span>&nbsp;<span class="ident" id="5768050"><a href="/database/sql/sql.go.html#5767855">err</a></span>&nbsp;<span class="op" id="5768054">!=</span>&nbsp;<span class="ident" id="5768057">nil</span>&nbsp;<span class="op" id="5768061">{</span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5768067"><a href="/database/sql/sql.go.html#5767722">releaseConn</a></span><span class="op" id="5768078">(</span><span class="ident" id="5768079"><a href="/database/sql/sql.go.html#5767855">err</a></span><span class="op" id="5768082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5768088">return</span>&nbsp;<span class="ident" id="5768095">nil</span><span class="op" id="5768098">,</span>&nbsp;<span class="ident" id="5768100"><a href="/database/sql/sql.go.html#5767855">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5768107">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5768112">//&nbsp;Note:&nbsp;ownership&nbsp;of&nbsp;dc&nbsp;passes&nbsp;to&nbsp;the&nbsp;*Rows,&nbsp;to&nbsp;be&nbsp;freed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5768173">//&nbsp;with&nbsp;releaseConn.</span><br>
<span class="lineno">960</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5768197">rows</span>&nbsp;<span class="op" id="5768202">:=</span>&nbsp;<span class="op" id="5768205">&amp;</span><span class="ident" id="5768206"><a href="/database/sql/sql.go.html#5782647">Rows</a></span><span class="op" id="5768210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5768216">dc</span><span class="op" id="5768218">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5768229"><a href="/database/sql/sql.go.html#5767706">dc</a></span><span class="op" id="5768231">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5768237">releaseConn</span><span class="op" id="5768248">:</span>&nbsp;<span class="ident" id="5768250"><a href="/database/sql/sql.go.html#5767722">releaseConn</a></span><span class="op" id="5768261">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5768267">rowsi</span><span class="op" id="5768272">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5768280"><a href="/database/sql/sql.go.html#5767959">rowsi</a></span><span class="op" id="5768285">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5768290">}</span><br>
<span class="lineno">965</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5768295">return</span>&nbsp;<span class="ident" id="5768302"><a href="/database/sql/sql.go.html#5768197">rows</a></span><span class="op" id="5768306">,</span>&nbsp;<span class="ident" id="5768308">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5768314">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5768317">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5768321"><a href="/database/sql/sql.go.html#5767706">dc</a></span><span class="op" id="5768323">.</span><span class="ident" id="5768324">Lock</span><span class="op" id="5768328">(</span><span class="op" id="5768329">)</span><br>
<span class="lineno">970</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5768332">si</span><span class="op" id="5768334">,</span>&nbsp;<span class="ident" id="5768336">err</span>&nbsp;<span class="op" id="5768340">:=</span>&nbsp;<span class="ident" id="5768343"><a href="/database/sql/sql.go.html#5767706">dc</a></span><span class="op" id="5768345">.</span><span class="ident" id="5768346">ci</span><span class="op" id="5768348">.</span><span class="ident" id="5768349">Prepare</span><span class="op" id="5768356">(</span><span class="ident" id="5768357"><a href="/database/sql/sql.go.html#5767747">query</a></span><span class="op" id="5768362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5768365"><a href="/database/sql/sql.go.html#5767706">dc</a></span><span class="op" id="5768367">.</span><span class="ident" id="5768368">Unlock</span><span class="op" id="5768374">(</span><span class="op" id="5768375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5768378">if</span>&nbsp;<span class="ident" id="5768381"><a href="/database/sql/sql.go.html#5768336">err</a></span>&nbsp;<span class="op" id="5768385">!=</span>&nbsp;<span class="ident" id="5768388">nil</span>&nbsp;<span class="op" id="5768392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5768396"><a href="/database/sql/sql.go.html#5767722">releaseConn</a></span><span class="op" id="5768407">(</span><span class="ident" id="5768408"><a href="/database/sql/sql.go.html#5768336">err</a></span><span class="op" id="5768411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5768415">return</span>&nbsp;<span class="ident" id="5768422">nil</span><span class="op" id="5768425">,</span>&nbsp;<span class="ident" id="5768427"><a href="/database/sql/sql.go.html#5768336">err</a></span><br>
<span class="lineno">975</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5768432">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5768436">ds</span>&nbsp;<span class="op" id="5768439">:=</span>&nbsp;<span class="ident" id="5768442"><a href="/database/sql/sql.go.html#5751783">driverStmt</a></span><span class="op" id="5768452">{</span><span class="ident" id="5768453"><a href="/database/sql/sql.go.html#5767706">dc</a></span><span class="op" id="5768455">,</span>&nbsp;<span class="ident" id="5768457"><a href="/database/sql/sql.go.html#5768332">si</a></span><span class="op" id="5768459">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5768462">rowsi</span><span class="op" id="5768467">,</span>&nbsp;<span class="ident" id="5768469"><a href="/database/sql/sql.go.html#5768336">err</a></span>&nbsp;<span class="op" id="5768473">:=</span>&nbsp;<span class="ident" id="5768476"><a href="/database/sql/sql.go.html#5780373">rowsiFromStatement</a></span><span class="op" id="5768494">(</span><span class="ident" id="5768495"><a href="/database/sql/sql.go.html#5768436">ds</a></span><span class="op" id="5768497">,</span>&nbsp;<span class="ident" id="5768499"><a href="/database/sql/sql.go.html#5767761">args</a></span><span class="op" id="5768503">...</span><span class="op" id="5768506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5768509">if</span>&nbsp;<span class="ident" id="5768512"><a href="/database/sql/sql.go.html#5768336">err</a></span>&nbsp;<span class="op" id="5768516">!=</span>&nbsp;<span class="ident" id="5768519">nil</span>&nbsp;<span class="op" id="5768523">{</span><br>
<span class="lineno">980</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5768527"><a href="/database/sql/sql.go.html#5767706">dc</a></span><span class="op" id="5768529">.</span><span class="ident" id="5768530">Lock</span><span class="op" id="5768534">(</span><span class="op" id="5768535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5768539"><a href="/database/sql/sql.go.html#5768332">si</a></span><span class="op" id="5768541">.</span><span class="ident" id="5768542">Close</span><span class="op" id="5768547">(</span><span class="op" id="5768548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5768552"><a href="/database/sql/sql.go.html#5767706">dc</a></span><span class="op" id="5768554">.</span><span class="ident" id="5768555">Unlock</span><span class="op" id="5768561">(</span><span class="op" id="5768562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5768566"><a href="/database/sql/sql.go.html#5767722">releaseConn</a></span><span class="op" id="5768577">(</span><span class="ident" id="5768578"><a href="/database/sql/sql.go.html#5768336">err</a></span><span class="op" id="5768581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5768585">return</span>&nbsp;<span class="ident" id="5768592">nil</span><span class="op" id="5768595">,</span>&nbsp;<span class="ident" id="5768597"><a href="/database/sql/sql.go.html#5768336">err</a></span><br>
<span class="lineno">985</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5768602">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5768606">//&nbsp;Note:&nbsp;ownership&nbsp;of&nbsp;ci&nbsp;passes&nbsp;to&nbsp;the&nbsp;*Rows,&nbsp;to&nbsp;be&nbsp;freed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5768665">//&nbsp;with&nbsp;releaseConn.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5768687">rows</span>&nbsp;<span class="op" id="5768692">:=</span>&nbsp;<span class="op" id="5768695">&amp;</span><span class="ident" id="5768696"><a href="/database/sql/sql.go.html#5782647">Rows</a></span><span class="op" id="5768700">{</span><br>
<span class="lineno">990</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5768704">dc</span><span class="op" id="5768706">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5768717"><a href="/database/sql/sql.go.html#5767706">dc</a></span><span class="op" id="5768719">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5768723">releaseConn</span><span class="op" id="5768734">:</span>&nbsp;<span class="ident" id="5768736"><a href="/database/sql/sql.go.html#5767722">releaseConn</a></span><span class="op" id="5768747">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5768751">rowsi</span><span class="op" id="5768756">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5768764"><a href="/database/sql/sql.go.html#5768462">rowsi</a></span><span class="op" id="5768769">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5768773">closeStmt</span><span class="op" id="5768782">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5768786"><a href="/database/sql/sql.go.html#5768332">si</a></span><span class="op" id="5768788">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5768791">}</span><br>
<span class="lineno">995</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5768794">return</span>&nbsp;<span class="ident" id="5768801"><a href="/database/sql/sql.go.html#5768687">rows</a></span><span class="op" id="5768805">,</span>&nbsp;<span class="ident" id="5768807">nil</span><br>
<span class="lineno"></span><span class="op" id="5768811">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5768814">//&nbsp;QueryRow&nbsp;executes&nbsp;a&nbsp;query&nbsp;that&nbsp;is&nbsp;expected&nbsp;to&nbsp;return&nbsp;at&nbsp;most&nbsp;one&nbsp;row.</span><br>
<span class="lineno"></span><span class="comment" id="5768887">//&nbsp;QueryRow&nbsp;always&nbsp;return&nbsp;a&nbsp;non-nil&nbsp;value.&nbsp;Errors&nbsp;are&nbsp;deferred&nbsp;until</span><br>
<span class="lineno">1000</span><span class="comment" id="5768956">//&nbsp;Row&#39;s&nbsp;Scan&nbsp;method&nbsp;is&nbsp;called.</span><br>
<span class="lineno"></span><span class="keyword" id="5768988">func</span>&nbsp;<span class="op" id="5768993">(</span><span class="ident" id="5768994">db</span>&nbsp;<span class="op" id="5768997">*</span><span class="ident" id="5768998"><a href="/database/sql/sql.go.html#5748306">DB</a></span><span class="op" id="5769000">)</span>&nbsp;<span class="ident" id="5769002">QueryRow</span><span class="op" id="5769010">(</span><span class="ident" id="5769011">query</span>&nbsp;<span class="builtintype" id="5769017">string</span><span class="op" id="5769023">,</span>&nbsp;<span class="ident" id="5769025">args</span>&nbsp;<span class="op" id="5769030">...</span><span class="keyword" id="5769033">interface</span><span class="op" id="5769042">{</span><span class="op" id="5769043">}</span><span class="op" id="5769044">)</span>&nbsp;<span class="op" id="5769046">*</span><span class="ident" id="5769047"><a href="/database/sql/sql.go.html#5785899">Row</a></span>&nbsp;<span class="op" id="5769051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5769054">rows</span><span class="op" id="5769058">,</span>&nbsp;<span class="ident" id="5769060">err</span>&nbsp;<span class="op" id="5769064">:=</span>&nbsp;<span class="ident" id="5769067"><a href="/database/sql/sql.go.html#5768994">db</a></span><span class="op" id="5769069">.</span><span class="ident" id="5769070">Query</span><span class="op" id="5769075">(</span><span class="ident" id="5769076"><a href="/database/sql/sql.go.html#5769011">query</a></span><span class="op" id="5769081">,</span>&nbsp;<span class="ident" id="5769083"><a href="/database/sql/sql.go.html#5769025">args</a></span><span class="op" id="5769087">...</span><span class="op" id="5769090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5769093">return</span>&nbsp;<span class="op" id="5769100">&amp;</span><span class="ident" id="5769101"><a href="/database/sql/sql.go.html#5785899">Row</a></span><span class="op" id="5769104">{</span><span class="ident" id="5769105">rows</span><span class="op" id="5769109">:</span>&nbsp;<span class="ident" id="5769111"><a href="/database/sql/sql.go.html#5769054">rows</a></span><span class="op" id="5769115">,</span>&nbsp;<span class="ident" id="5769117">err</span><span class="op" id="5769120">:</span>&nbsp;<span class="ident" id="5769122"><a href="/database/sql/sql.go.html#5769060">err</a></span><span class="op" id="5769125">}</span><br>
<span class="lineno"></span><span class="op" id="5769127">}</span><br>
<span class="lineno">1005</span><br>
<span class="lineno"></span><span class="comment" id="5769130">//&nbsp;Begin&nbsp;starts&nbsp;a&nbsp;transaction.&nbsp;The&nbsp;isolation&nbsp;level&nbsp;is&nbsp;dependent&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="5769197">//&nbsp;the&nbsp;driver.</span><br>
<span class="lineno"></span><span class="keyword" id="5769212">func</span>&nbsp;<span class="op" id="5769217">(</span><span class="ident" id="5769218">db</span>&nbsp;<span class="op" id="5769221">*</span><span class="ident" id="5769222"><a href="/database/sql/sql.go.html#5748306">DB</a></span><span class="op" id="5769224">)</span>&nbsp;<span class="ident" id="5769226">Begin</span><span class="op" id="5769231">(</span><span class="op" id="5769232">)</span>&nbsp;<span class="op" id="5769234">(</span><span class="op" id="5769235">*</span><span class="ident" id="5769236"><a href="/database/sql/sql.go.html#5770008">Tx</a></span><span class="op" id="5769238">,</span>&nbsp;<span class="builtintype" id="5769240">error</span><span class="op" id="5769245">)</span>&nbsp;<span class="op" id="5769247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5769250">var</span>&nbsp;<span class="ident" id="5769254">tx</span>&nbsp;<span class="op" id="5769257">*</span><span class="ident" id="5769258"><a href="/database/sql/sql.go.html#5770008">Tx</a></span><br>
<span class="lineno">1010</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5769262">var</span>&nbsp;<span class="ident" id="5769266">err</span>&nbsp;<span class="builtintype" id="5769270">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5769277">for</span>&nbsp;<span class="ident" id="5769281">i</span>&nbsp;<span class="op" id="5769283">:=</span>&nbsp;<span class="num" id="5769286">0</span><span class="op" id="5769287">;</span>&nbsp;<span class="ident" id="5769289"><a href="/database/sql/sql.go.html#5769281">i</a></span>&nbsp;<span class="op" id="5769291">&lt;</span>&nbsp;<span class="ident" id="5769293"><a href="/database/sql/sql.go.html#5764807">maxBadConnRetries</a></span><span class="op" id="5769310">;</span>&nbsp;<span class="ident" id="5769312"><a href="/database/sql/sql.go.html#5769281">i</a></span><span class="op" id="5769313">++</span>&nbsp;<span class="op" id="5769316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5769320"><a href="/database/sql/sql.go.html#5769254">tx</a></span><span class="op" id="5769322">,</span>&nbsp;<span class="ident" id="5769324"><a href="/database/sql/sql.go.html#5769266">err</a></span>&nbsp;<span class="op" id="5769328">=</span>&nbsp;<span class="ident" id="5769330"><a href="/database/sql/sql.go.html#5769218">db</a></span><span class="op" id="5769332">.</span><span class="ident" id="5769333">begin</span><span class="op" id="5769338">(</span><span class="op" id="5769339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5769343">if</span>&nbsp;<span class="ident" id="5769346"><a href="/database/sql/sql.go.html#5769266">err</a></span>&nbsp;<span class="op" id="5769350">!=</span>&nbsp;<span class="ident" id="5769353"><a href="/database/sql/sql.go.html#5743212">driver</a></span><span class="op" id="5769359">.</span><span class="ident" id="5769360">ErrBadConn</span>&nbsp;<span class="op" id="5769371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5769376">break</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5769384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5769387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5769390">return</span>&nbsp;<span class="ident" id="5769397"><a href="/database/sql/sql.go.html#5769254">tx</a></span><span class="op" id="5769399">,</span>&nbsp;<span class="ident" id="5769401"><a href="/database/sql/sql.go.html#5769266">err</a></span><br>
<span class="lineno"></span><span class="op" id="5769405">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1020</span><span class="keyword" id="5769408">func</span>&nbsp;<span class="op" id="5769413">(</span><span class="ident" id="5769414">db</span>&nbsp;<span class="op" id="5769417">*</span><span class="ident" id="5769418"><a href="/database/sql/sql.go.html#5748306">DB</a></span><span class="op" id="5769420">)</span>&nbsp;<span class="ident" id="5769422">begin</span><span class="op" id="5769427">(</span><span class="op" id="5769428">)</span>&nbsp;<span class="op" id="5769430">(</span><span class="ident" id="5769431">tx</span>&nbsp;<span class="op" id="5769434">*</span><span class="ident" id="5769435"><a href="/database/sql/sql.go.html#5770008">Tx</a></span><span class="op" id="5769437">,</span>&nbsp;<span class="ident" id="5769439">err</span>&nbsp;<span class="builtintype" id="5769443">error</span><span class="op" id="5769448">)</span>&nbsp;<span class="op" id="5769450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5769453">dc</span><span class="op" id="5769455">,</span>&nbsp;<span class="ident" id="5769457"><a href="/database/sql/sql.go.html#5769439">err</a></span>&nbsp;<span class="op" id="5769461">:=</span>&nbsp;<span class="ident" id="5769464"><a href="/database/sql/sql.go.html#5769414">db</a></span><span class="op" id="5769466">.</span><span class="ident" id="5769467">conn</span><span class="op" id="5769471">(</span><span class="op" id="5769472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5769475">if</span>&nbsp;<span class="ident" id="5769478"><a href="/database/sql/sql.go.html#5769439">err</a></span>&nbsp;<span class="op" id="5769482">!=</span>&nbsp;<span class="ident" id="5769485">nil</span>&nbsp;<span class="op" id="5769489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5769493">return</span>&nbsp;<span class="ident" id="5769500">nil</span><span class="op" id="5769503">,</span>&nbsp;<span class="ident" id="5769505"><a href="/database/sql/sql.go.html#5769439">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5769510">}</span><br>
<span class="lineno">1025</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5769513"><a href="/database/sql/sql.go.html#5769453">dc</a></span><span class="op" id="5769515">.</span><span class="ident" id="5769516">Lock</span><span class="op" id="5769520">(</span><span class="op" id="5769521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5769524">txi</span><span class="op" id="5769527">,</span>&nbsp;<span class="ident" id="5769529"><a href="/database/sql/sql.go.html#5769439">err</a></span>&nbsp;<span class="op" id="5769533">:=</span>&nbsp;<span class="ident" id="5769536"><a href="/database/sql/sql.go.html#5769453">dc</a></span><span class="op" id="5769538">.</span><span class="ident" id="5769539">ci</span><span class="op" id="5769541">.</span><span class="ident" id="5769542">Begin</span><span class="op" id="5769547">(</span><span class="op" id="5769548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5769551"><a href="/database/sql/sql.go.html#5769453">dc</a></span><span class="op" id="5769553">.</span><span class="ident" id="5769554">Unlock</span><span class="op" id="5769560">(</span><span class="op" id="5769561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5769564">if</span>&nbsp;<span class="ident" id="5769567"><a href="/database/sql/sql.go.html#5769439">err</a></span>&nbsp;<span class="op" id="5769571">!=</span>&nbsp;<span class="ident" id="5769574">nil</span>&nbsp;<span class="op" id="5769578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5769582"><a href="/database/sql/sql.go.html#5769414">db</a></span><span class="op" id="5769584">.</span><span class="ident" id="5769585">putConn</span><span class="op" id="5769592">(</span><span class="ident" id="5769593"><a href="/database/sql/sql.go.html#5769453">dc</a></span><span class="op" id="5769595">,</span>&nbsp;<span class="ident" id="5769597"><a href="/database/sql/sql.go.html#5769439">err</a></span><span class="op" id="5769600">)</span><br>
<span class="lineno">1030</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5769604">return</span>&nbsp;<span class="ident" id="5769611">nil</span><span class="op" id="5769614">,</span>&nbsp;<span class="ident" id="5769616"><a href="/database/sql/sql.go.html#5769439">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5769621">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5769624">return</span>&nbsp;<span class="op" id="5769631">&amp;</span><span class="ident" id="5769632"><a href="/database/sql/sql.go.html#5770008">Tx</a></span><span class="op" id="5769634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5769638">db</span><span class="op" id="5769640">:</span>&nbsp;&nbsp;<span class="ident" id="5769643"><a href="/database/sql/sql.go.html#5769414">db</a></span><span class="op" id="5769645">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5769649">dc</span><span class="op" id="5769651">:</span>&nbsp;&nbsp;<span class="ident" id="5769654"><a href="/database/sql/sql.go.html#5769453">dc</a></span><span class="op" id="5769656">,</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5769660">txi</span><span class="op" id="5769663">:</span>&nbsp;<span class="ident" id="5769665"><a href="/database/sql/sql.go.html#5769524">txi</a></span><span class="op" id="5769668">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5769671">}</span><span class="op" id="5769672">,</span>&nbsp;<span class="ident" id="5769674">nil</span><br>
<span class="lineno"></span><span class="op" id="5769678">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5769681">//&nbsp;Driver&nbsp;returns&nbsp;the&nbsp;database&#39;s&nbsp;underlying&nbsp;driver.</span><br>
<span class="lineno">1040</span><span class="keyword" id="5769733">func</span>&nbsp;<span class="op" id="5769738">(</span><span class="ident" id="5769739">db</span>&nbsp;<span class="op" id="5769742">*</span><span class="ident" id="5769743"><a href="/database/sql/sql.go.html#5748306">DB</a></span><span class="op" id="5769745">)</span>&nbsp;<span class="ident" id="5769747">Driver</span><span class="op" id="5769753">(</span><span class="op" id="5769754">)</span>&nbsp;<span class="ident" id="5769756"><a href="/database/sql/sql.go.html#5743212">driver</a></span><span class="op" id="5769762">.</span><span class="ident" id="5769763">Driver</span>&nbsp;<span class="op" id="5769770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5769773">return</span>&nbsp;<span class="ident" id="5769780"><a href="/database/sql/sql.go.html#5769739">db</a></span><span class="op" id="5769782">.</span><span class="ident" id="5769783">driver</span><br>
<span class="lineno"></span><span class="op" id="5769790">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5769793">//&nbsp;Tx&nbsp;is&nbsp;an&nbsp;in-progress&nbsp;database&nbsp;transaction.</span><br>
<span class="lineno">1045</span><span class="comment" id="5769839">//</span><br>
<span class="lineno"></span><span class="comment" id="5769842">//&nbsp;A&nbsp;transaction&nbsp;must&nbsp;end&nbsp;with&nbsp;a&nbsp;call&nbsp;to&nbsp;Commit&nbsp;or&nbsp;Rollback.</span><br>
<span class="lineno"></span><span class="comment" id="5769903">//</span><br>
<span class="lineno"></span><span class="comment" id="5769906">//&nbsp;After&nbsp;a&nbsp;call&nbsp;to&nbsp;Commit&nbsp;or&nbsp;Rollback,&nbsp;all&nbsp;operations&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5769967">//&nbsp;transaction&nbsp;fail&nbsp;with&nbsp;ErrTxDone.</span><br>
<span class="lineno">1050</span><span class="keyword" id="5770003">type</span>&nbsp;<span class="ident" id="5770008">Tx</span>&nbsp;<span class="keyword" id="5770011">struct</span>&nbsp;<span class="op" id="5770018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5770021">db</span>&nbsp;<span class="op" id="5770024">*</span><span class="ident" id="5770025"><a href="/database/sql/sql.go.html#5748306">DB</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5770030">//&nbsp;dc&nbsp;is&nbsp;owned&nbsp;exclusively&nbsp;until&nbsp;Commit&nbsp;or&nbsp;Rollback,&nbsp;at&nbsp;which&nbsp;point</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5770099">//&nbsp;it&#39;s&nbsp;returned&nbsp;with&nbsp;putConn.</span><br>
<span class="lineno">1055</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5770131">dc</span>&nbsp;&nbsp;<span class="op" id="5770135">*</span><span class="ident" id="5770136"><a href="/database/sql/sql.go.html#5749298">driverConn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5770148">txi</span>&nbsp;<span class="ident" id="5770152"><a href="/database/sql/sql.go.html#5743212">driver</a></span><span class="op" id="5770158">.</span><span class="ident" id="5770159">Tx</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5770164">//&nbsp;done&nbsp;transitions&nbsp;from&nbsp;false&nbsp;to&nbsp;true&nbsp;exactly&nbsp;once,&nbsp;on&nbsp;Commit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5770228">//&nbsp;or&nbsp;Rollback.&nbsp;once&nbsp;done,&nbsp;all&nbsp;operations&nbsp;fail&nbsp;with</span><br>
<span class="lineno">1060</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5770281">//&nbsp;ErrTxDone.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5770296">done</span>&nbsp;<span class="builtintype" id="5770301">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5770308">//&nbsp;All&nbsp;Stmts&nbsp;prepared&nbsp;for&nbsp;this&nbsp;transaction.&nbsp;&nbsp;These&nbsp;will&nbsp;be&nbsp;closed&nbsp;after&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5770385">//&nbsp;transaction&nbsp;has&nbsp;been&nbsp;committed&nbsp;or&nbsp;rolled&nbsp;back.</span><br>
<span class="lineno">1065</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5770436">stmts</span>&nbsp;<span class="keyword" id="5770442">struct</span>&nbsp;<span class="op" id="5770449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5770453"><a href="/database/sql/sql.go.html#5743277">sync</a></span><span class="op" id="5770457">.</span><span class="ident" id="5770458">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5770466">v</span>&nbsp;<span class="op" id="5770468">[</span><span class="op" id="5770469">]</span><span class="op" id="5770470">*</span><span class="ident" id="5770471"><a href="/database/sql/sql.go.html#5775599">Stmt</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5770477">}</span><br>
<span class="lineno"></span><span class="op" id="5770479">}</span><br>
<span class="lineno">1070</span><br>
<span class="lineno"></span><span class="keyword" id="5770482">var</span>&nbsp;<span class="ident" id="5770486">ErrTxDone</span>&nbsp;<span class="op" id="5770496">=</span>&nbsp;<span class="ident" id="5770498"><a href="/database/sql/sql.go.html#5743235">errors</a></span><span class="op" id="5770504">.</span><span class="ident" id="5770505">New</span><span class="op" id="5770508">(</span><span class="string" id="5770509">&#34;sql:&nbsp;Transaction&nbsp;has&nbsp;already&nbsp;been&nbsp;committed&nbsp;or&nbsp;rolled&nbsp;back&#34;</span><span class="op" id="5770569">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5770572">func</span>&nbsp;<span class="op" id="5770577">(</span><span class="ident" id="5770578">tx</span>&nbsp;<span class="op" id="5770581">*</span><span class="ident" id="5770582"><a href="/database/sql/sql.go.html#5770008">Tx</a></span><span class="op" id="5770584">)</span>&nbsp;<span class="builtinfunc" id="5770586">close</span><span class="op" id="5770591">(</span><span class="op" id="5770592">)</span>&nbsp;<span class="op" id="5770594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5770597">if</span>&nbsp;<span class="ident" id="5770600"><a href="/database/sql/sql.go.html#5770578">tx</a></span><span class="op" id="5770602">.</span><span class="ident" id="5770603">done</span>&nbsp;<span class="op" id="5770608">{</span><br>
<span class="lineno">1075</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5770612">panic</span><span class="op" id="5770617">(</span><span class="string" id="5770618">&#34;double&nbsp;close&#34;</span><span class="op" id="5770632">)</span>&nbsp;<span class="comment" id="5770634">//&nbsp;internal&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5770653">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5770656"><a href="/database/sql/sql.go.html#5770578">tx</a></span><span class="op" id="5770658">.</span><span class="ident" id="5770659">done</span>&nbsp;<span class="op" id="5770664">=</span>&nbsp;<span class="ident" id="5770666">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5770672"><a href="/database/sql/sql.go.html#5770578">tx</a></span><span class="op" id="5770674">.</span><span class="ident" id="5770675">db</span><span class="op" id="5770677">.</span><span class="ident" id="5770678">putConn</span><span class="op" id="5770685">(</span><span class="ident" id="5770686"><a href="/database/sql/sql.go.html#5770578">tx</a></span><span class="op" id="5770688">.</span><span class="ident" id="5770689">dc</span><span class="op" id="5770691">,</span>&nbsp;<span class="ident" id="5770693">nil</span><span class="op" id="5770696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5770699"><a href="/database/sql/sql.go.html#5770578">tx</a></span><span class="op" id="5770701">.</span><span class="ident" id="5770702">dc</span>&nbsp;<span class="op" id="5770705">=</span>&nbsp;<span class="ident" id="5770707">nil</span><br>
<span class="lineno">1080</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5770712"><a href="/database/sql/sql.go.html#5770578">tx</a></span><span class="op" id="5770714">.</span><span class="ident" id="5770715">txi</span>&nbsp;<span class="op" id="5770719">=</span>&nbsp;<span class="ident" id="5770721">nil</span><br>
<span class="lineno"></span><span class="op" id="5770725">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5770728">func</span>&nbsp;<span class="op" id="5770733">(</span><span class="ident" id="5770734">tx</span>&nbsp;<span class="op" id="5770737">*</span><span class="ident" id="5770738"><a href="/database/sql/sql.go.html#5770008">Tx</a></span><span class="op" id="5770740">)</span>&nbsp;<span class="ident" id="5770742">grabConn</span><span class="op" id="5770750">(</span><span class="op" id="5770751">)</span>&nbsp;<span class="op" id="5770753">(</span><span class="op" id="5770754">*</span><span class="ident" id="5770755"><a href="/database/sql/sql.go.html#5749298">driverConn</a></span><span class="op" id="5770765">,</span>&nbsp;<span class="builtintype" id="5770767">error</span><span class="op" id="5770772">)</span>&nbsp;<span class="op" id="5770774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5770777">if</span>&nbsp;<span class="ident" id="5770780"><a href="/database/sql/sql.go.html#5770734">tx</a></span><span class="op" id="5770782">.</span><span class="ident" id="5770783">done</span>&nbsp;<span class="op" id="5770788">{</span><br>
<span class="lineno">1085</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5770792">return</span>&nbsp;<span class="ident" id="5770799">nil</span><span class="op" id="5770802">,</span>&nbsp;<span class="ident" id="5770804"><a href="/database/sql/sql.go.html#5770486">ErrTxDone</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5770815">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5770818">return</span>&nbsp;<span class="ident" id="5770825"><a href="/database/sql/sql.go.html#5770734">tx</a></span><span class="op" id="5770827">.</span><span class="ident" id="5770828">dc</span><span class="op" id="5770830">,</span>&nbsp;<span class="ident" id="5770832">nil</span><br>
<span class="lineno"></span><span class="op" id="5770836">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1090</span><span class="comment" id="5770839">//&nbsp;Closes&nbsp;all&nbsp;Stmts&nbsp;prepared&nbsp;for&nbsp;this&nbsp;transaction.</span><br>
<span class="lineno"></span><span class="keyword" id="5770890">func</span>&nbsp;<span class="op" id="5770895">(</span><span class="ident" id="5770896">tx</span>&nbsp;<span class="op" id="5770899">*</span><span class="ident" id="5770900"><a href="/database/sql/sql.go.html#5770008">Tx</a></span><span class="op" id="5770902">)</span>&nbsp;<span class="ident" id="5770904">closePrepared</span><span class="op" id="5770917">(</span><span class="op" id="5770918">)</span>&nbsp;<span class="op" id="5770920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5770923"><a href="/database/sql/sql.go.html#5770896">tx</a></span><span class="op" id="5770925">.</span><span class="ident" id="5770926">stmts</span><span class="op" id="5770931">.</span><span class="ident" id="5770932">Lock</span><span class="op" id="5770936">(</span><span class="op" id="5770937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5770940">for</span>&nbsp;<span class="ident" id="5770944">_</span><span class="op" id="5770945">,</span>&nbsp;<span class="ident" id="5770947">stmt</span>&nbsp;<span class="op" id="5770952">:=</span>&nbsp;<span class="keyword" id="5770955">range</span>&nbsp;<span class="ident" id="5770961"><a href="/database/sql/sql.go.html#5770896">tx</a></span><span class="op" id="5770963">.</span><span class="ident" id="5770964">stmts</span><span class="op" id="5770969">.</span><span class="ident" id="5770970">v</span>&nbsp;<span class="op" id="5770972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5770976"><a href="/database/sql/sql.go.html#5770947">stmt</a></span><span class="op" id="5770980">.</span><span class="ident" id="5770981">Close</span><span class="op" id="5770986">(</span><span class="op" id="5770987">)</span><br>
<span class="lineno">1095</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5770990">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5770993"><a href="/database/sql/sql.go.html#5770896">tx</a></span><span class="op" id="5770995">.</span><span class="ident" id="5770996">stmts</span><span class="op" id="5771001">.</span><span class="ident" id="5771002">Unlock</span><span class="op" id="5771008">(</span><span class="op" id="5771009">)</span><br>
<span class="lineno"></span><span class="op" id="5771011">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5771014">//&nbsp;Commit&nbsp;commits&nbsp;the&nbsp;transaction.</span><br>
<span class="lineno">1100</span><span class="keyword" id="5771049">func</span>&nbsp;<span class="op" id="5771054">(</span><span class="ident" id="5771055">tx</span>&nbsp;<span class="op" id="5771058">*</span><span class="ident" id="5771059"><a href="/database/sql/sql.go.html#5770008">Tx</a></span><span class="op" id="5771061">)</span>&nbsp;<span class="ident" id="5771063">Commit</span><span class="op" id="5771069">(</span><span class="op" id="5771070">)</span>&nbsp;<span class="builtintype" id="5771072">error</span>&nbsp;<span class="op" id="5771078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5771081">if</span>&nbsp;<span class="ident" id="5771084"><a href="/database/sql/sql.go.html#5771055">tx</a></span><span class="op" id="5771086">.</span><span class="ident" id="5771087">done</span>&nbsp;<span class="op" id="5771092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5771096">return</span>&nbsp;<span class="ident" id="5771103"><a href="/database/sql/sql.go.html#5770486">ErrTxDone</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5771114">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5771117">defer</span>&nbsp;<span class="ident" id="5771123"><a href="/database/sql/sql.go.html#5771055">tx</a></span><span class="op" id="5771125">.</span><span class="builtinfunc" id="5771126">close</span><span class="op" id="5771131">(</span><span class="op" id="5771132">)</span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5771135"><a href="/database/sql/sql.go.html#5771055">tx</a></span><span class="op" id="5771137">.</span><span class="ident" id="5771138">dc</span><span class="op" id="5771140">.</span><span class="ident" id="5771141">Lock</span><span class="op" id="5771145">(</span><span class="op" id="5771146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5771149">err</span>&nbsp;<span class="op" id="5771153">:=</span>&nbsp;<span class="ident" id="5771156"><a href="/database/sql/sql.go.html#5771055">tx</a></span><span class="op" id="5771158">.</span><span class="ident" id="5771159">txi</span><span class="op" id="5771162">.</span><span class="ident" id="5771163">Commit</span><span class="op" id="5771169">(</span><span class="op" id="5771170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5771173"><a href="/database/sql/sql.go.html#5771055">tx</a></span><span class="op" id="5771175">.</span><span class="ident" id="5771176">dc</span><span class="op" id="5771178">.</span><span class="ident" id="5771179">Unlock</span><span class="op" id="5771185">(</span><span class="op" id="5771186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5771189">if</span>&nbsp;<span class="ident" id="5771192"><a href="/database/sql/sql.go.html#5771149">err</a></span>&nbsp;<span class="op" id="5771196">!=</span>&nbsp;<span class="ident" id="5771199"><a href="/database/sql/sql.go.html#5743212">driver</a></span><span class="op" id="5771205">.</span><span class="ident" id="5771206">ErrBadConn</span>&nbsp;<span class="op" id="5771217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5771221"><a href="/database/sql/sql.go.html#5771055">tx</a></span><span class="op" id="5771223">.</span><span class="ident" id="5771224">closePrepared</span><span class="op" id="5771237">(</span><span class="op" id="5771238">)</span><br>
<span class="lineno">1110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5771241">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5771244">return</span>&nbsp;<span class="ident" id="5771251"><a href="/database/sql/sql.go.html#5771149">err</a></span><br>
<span class="lineno"></span><span class="op" id="5771255">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5771258">//&nbsp;Rollback&nbsp;aborts&nbsp;the&nbsp;transaction.</span><br>
<span class="lineno">1115</span><span class="keyword" id="5771294">func</span>&nbsp;<span class="op" id="5771299">(</span><span class="ident" id="5771300">tx</span>&nbsp;<span class="op" id="5771303">*</span><span class="ident" id="5771304"><a href="/database/sql/sql.go.html#5770008">Tx</a></span><span class="op" id="5771306">)</span>&nbsp;<span class="ident" id="5771308">Rollback</span><span class="op" id="5771316">(</span><span class="op" id="5771317">)</span>&nbsp;<span class="builtintype" id="5771319">error</span>&nbsp;<span class="op" id="5771325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5771328">if</span>&nbsp;<span class="ident" id="5771331"><a href="/database/sql/sql.go.html#5771300">tx</a></span><span class="op" id="5771333">.</span><span class="ident" id="5771334">done</span>&nbsp;<span class="op" id="5771339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5771343">return</span>&nbsp;<span class="ident" id="5771350"><a href="/database/sql/sql.go.html#5770486">ErrTxDone</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5771361">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5771364">defer</span>&nbsp;<span class="ident" id="5771370"><a href="/database/sql/sql.go.html#5771300">tx</a></span><span class="op" id="5771372">.</span><span class="builtinfunc" id="5771373">close</span><span class="op" id="5771378">(</span><span class="op" id="5771379">)</span><br>
<span class="lineno">1120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5771382"><a href="/database/sql/sql.go.html#5771300">tx</a></span><span class="op" id="5771384">.</span><span class="ident" id="5771385">dc</span><span class="op" id="5771387">.</span><span class="ident" id="5771388">Lock</span><span class="op" id="5771392">(</span><span class="op" id="5771393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5771396">err</span>&nbsp;<span class="op" id="5771400">:=</span>&nbsp;<span class="ident" id="5771403"><a href="/database/sql/sql.go.html#5771300">tx</a></span><span class="op" id="5771405">.</span><span class="ident" id="5771406">txi</span><span class="op" id="5771409">.</span><span class="ident" id="5771410">Rollback</span><span class="op" id="5771418">(</span><span class="op" id="5771419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5771422"><a href="/database/sql/sql.go.html#5771300">tx</a></span><span class="op" id="5771424">.</span><span class="ident" id="5771425">dc</span><span class="op" id="5771427">.</span><span class="ident" id="5771428">Unlock</span><span class="op" id="5771434">(</span><span class="op" id="5771435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5771438">if</span>&nbsp;<span class="ident" id="5771441"><a href="/database/sql/sql.go.html#5771396">err</a></span>&nbsp;<span class="op" id="5771445">!=</span>&nbsp;<span class="ident" id="5771448"><a href="/database/sql/sql.go.html#5743212">driver</a></span><span class="op" id="5771454">.</span><span class="ident" id="5771455">ErrBadConn</span>&nbsp;<span class="op" id="5771466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5771470"><a href="/database/sql/sql.go.html#5771300">tx</a></span><span class="op" id="5771472">.</span><span class="ident" id="5771473">closePrepared</span><span class="op" id="5771486">(</span><span class="op" id="5771487">)</span><br>
<span class="lineno">1125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5771490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5771493">return</span>&nbsp;<span class="ident" id="5771500"><a href="/database/sql/sql.go.html#5771396">err</a></span><br>
<span class="lineno"></span><span class="op" id="5771504">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5771507">//&nbsp;Prepare&nbsp;creates&nbsp;a&nbsp;prepared&nbsp;statement&nbsp;for&nbsp;use&nbsp;within&nbsp;a&nbsp;transaction.</span><br>
<span class="lineno">1130</span><span class="comment" id="5771577">//</span><br>
<span class="lineno"></span><span class="comment" id="5771580">//&nbsp;The&nbsp;returned&nbsp;statement&nbsp;operates&nbsp;within&nbsp;the&nbsp;transaction&nbsp;and&nbsp;can&nbsp;no&nbsp;longer</span><br>
<span class="lineno"></span><span class="comment" id="5771656">//&nbsp;be&nbsp;used&nbsp;once&nbsp;the&nbsp;transaction&nbsp;has&nbsp;been&nbsp;committed&nbsp;or&nbsp;rolled&nbsp;back.</span><br>
<span class="lineno"></span><span class="comment" id="5771723">//</span><br>
<span class="lineno"></span><span class="comment" id="5771726">//&nbsp;To&nbsp;use&nbsp;an&nbsp;existing&nbsp;prepared&nbsp;statement&nbsp;on&nbsp;this&nbsp;transaction,&nbsp;see&nbsp;Tx.Stmt.</span><br>
<span class="lineno">1135</span><span class="keyword" id="5771801">func</span>&nbsp;<span class="op" id="5771806">(</span><span class="ident" id="5771807">tx</span>&nbsp;<span class="op" id="5771810">*</span><span class="ident" id="5771811"><a href="/database/sql/sql.go.html#5770008">Tx</a></span><span class="op" id="5771813">)</span>&nbsp;<span class="ident" id="5771815">Prepare</span><span class="op" id="5771822">(</span><span class="ident" id="5771823">query</span>&nbsp;<span class="builtintype" id="5771829">string</span><span class="op" id="5771835">)</span>&nbsp;<span class="op" id="5771837">(</span><span class="op" id="5771838">*</span><span class="ident" id="5771839"><a href="/database/sql/sql.go.html#5775599">Stmt</a></span><span class="op" id="5771843">,</span>&nbsp;<span class="builtintype" id="5771845">error</span><span class="op" id="5771850">)</span>&nbsp;<span class="op" id="5771852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5771855">//&nbsp;TODO(bradfitz):&nbsp;We&nbsp;could&nbsp;be&nbsp;more&nbsp;efficient&nbsp;here&nbsp;and&nbsp;either</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5771918">//&nbsp;provide&nbsp;a&nbsp;method&nbsp;to&nbsp;take&nbsp;an&nbsp;existing&nbsp;Stmt&nbsp;(created&nbsp;on</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5771976">//&nbsp;perhaps&nbsp;a&nbsp;different&nbsp;Conn),&nbsp;and&nbsp;re-create&nbsp;it&nbsp;on&nbsp;this&nbsp;Conn&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5772040">//&nbsp;necessary.&nbsp;Or,&nbsp;better:&nbsp;keep&nbsp;a&nbsp;map&nbsp;in&nbsp;DB&nbsp;of&nbsp;query&nbsp;string&nbsp;to</span><br>
<span class="lineno">1140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5772103">//&nbsp;Stmts,&nbsp;and&nbsp;have&nbsp;Stmt.Execute&nbsp;do&nbsp;the&nbsp;right&nbsp;thing&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5772159">//&nbsp;re-prepare&nbsp;if&nbsp;the&nbsp;Conn&nbsp;in&nbsp;use&nbsp;doesn&#39;t&nbsp;have&nbsp;that&nbsp;prepared</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5772220">//&nbsp;statement.&nbsp;&nbsp;But&nbsp;we&#39;ll&nbsp;want&nbsp;to&nbsp;avoid&nbsp;caching&nbsp;the&nbsp;statement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5772282">//&nbsp;in&nbsp;the&nbsp;case&nbsp;where&nbsp;we&nbsp;only&nbsp;call&nbsp;conn.Prepare&nbsp;implicitly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5772341">//&nbsp;(such&nbsp;as&nbsp;in&nbsp;db.Exec&nbsp;or&nbsp;tx.Exec),&nbsp;but&nbsp;the&nbsp;caller&nbsp;package</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5772401">//&nbsp;can&#39;t&nbsp;be&nbsp;holding&nbsp;a&nbsp;reference&nbsp;to&nbsp;the&nbsp;returned&nbsp;statement.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5772461">//&nbsp;Perhaps&nbsp;just&nbsp;looking&nbsp;at&nbsp;the&nbsp;reference&nbsp;count&nbsp;(by&nbsp;noting</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5772520">//&nbsp;Stmt.Close)&nbsp;would&nbsp;be&nbsp;enough.&nbsp;We&nbsp;might&nbsp;also&nbsp;want&nbsp;a&nbsp;finalizer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5772584">//&nbsp;on&nbsp;Stmt&nbsp;to&nbsp;drop&nbsp;the&nbsp;reference&nbsp;count.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5772625">dc</span><span class="op" id="5772627">,</span>&nbsp;<span class="ident" id="5772629">err</span>&nbsp;<span class="op" id="5772633">:=</span>&nbsp;<span class="ident" id="5772636"><a href="/database/sql/sql.go.html#5771807">tx</a></span><span class="op" id="5772638">.</span><span class="ident" id="5772639">grabConn</span><span class="op" id="5772647">(</span><span class="op" id="5772648">)</span><br>
<span class="lineno">1150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5772651">if</span>&nbsp;<span class="ident" id="5772654"><a href="/database/sql/sql.go.html#5772629">err</a></span>&nbsp;<span class="op" id="5772658">!=</span>&nbsp;<span class="ident" id="5772661">nil</span>&nbsp;<span class="op" id="5772665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5772669">return</span>&nbsp;<span class="ident" id="5772676">nil</span><span class="op" id="5772679">,</span>&nbsp;<span class="ident" id="5772681"><a href="/database/sql/sql.go.html#5772629">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5772686">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5772690"><a href="/database/sql/sql.go.html#5772625">dc</a></span><span class="op" id="5772692">.</span><span class="ident" id="5772693">Lock</span><span class="op" id="5772697">(</span><span class="op" id="5772698">)</span><br>
<span class="lineno">1155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5772701">si</span><span class="op" id="5772703">,</span>&nbsp;<span class="ident" id="5772705"><a href="/database/sql/sql.go.html#5772629">err</a></span>&nbsp;<span class="op" id="5772709">:=</span>&nbsp;<span class="ident" id="5772712"><a href="/database/sql/sql.go.html#5772625">dc</a></span><span class="op" id="5772714">.</span><span class="ident" id="5772715">ci</span><span class="op" id="5772717">.</span><span class="ident" id="5772718">Prepare</span><span class="op" id="5772725">(</span><span class="ident" id="5772726"><a href="/database/sql/sql.go.html#5771823">query</a></span><span class="op" id="5772731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5772734"><a href="/database/sql/sql.go.html#5772625">dc</a></span><span class="op" id="5772736">.</span><span class="ident" id="5772737">Unlock</span><span class="op" id="5772743">(</span><span class="op" id="5772744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5772747">if</span>&nbsp;<span class="ident" id="5772750"><a href="/database/sql/sql.go.html#5772629">err</a></span>&nbsp;<span class="op" id="5772754">!=</span>&nbsp;<span class="ident" id="5772757">nil</span>&nbsp;<span class="op" id="5772761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5772765">return</span>&nbsp;<span class="ident" id="5772772">nil</span><span class="op" id="5772775">,</span>&nbsp;<span class="ident" id="5772777"><a href="/database/sql/sql.go.html#5772629">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5772782">}</span><br>
<span class="lineno">1160</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5772786">stmt</span>&nbsp;<span class="op" id="5772791">:=</span>&nbsp;<span class="op" id="5772794">&amp;</span><span class="ident" id="5772795"><a href="/database/sql/sql.go.html#5775599">Stmt</a></span><span class="op" id="5772799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5772803">db</span><span class="op" id="5772805">:</span>&nbsp;<span class="ident" id="5772807"><a href="/database/sql/sql.go.html#5771807">tx</a></span><span class="op" id="5772809">.</span><span class="ident" id="5772810">db</span><span class="op" id="5772812">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5772816">tx</span><span class="op" id="5772818">:</span>&nbsp;<span class="ident" id="5772820"><a href="/database/sql/sql.go.html#5771807">tx</a></span><span class="op" id="5772822">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5772826">txsi</span><span class="op" id="5772830">:</span>&nbsp;<span class="op" id="5772832">&amp;</span><span class="ident" id="5772833"><a href="/database/sql/sql.go.html#5751783">driverStmt</a></span><span class="op" id="5772843">{</span><br>
<span class="lineno">1165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5772848">Locker</span><span class="op" id="5772854">:</span>&nbsp;<span class="ident" id="5772856"><a href="/database/sql/sql.go.html#5772625">dc</a></span><span class="op" id="5772858">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5772863">si</span><span class="op" id="5772865">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5772871"><a href="/database/sql/sql.go.html#5772701">si</a></span><span class="op" id="5772873">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5772877">}</span><span class="op" id="5772878">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5772882">query</span><span class="op" id="5772887">:</span>&nbsp;<span class="ident" id="5772889"><a href="/database/sql/sql.go.html#5771823">query</a></span><span class="op" id="5772894">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5772897">}</span><br>
<span class="lineno">1170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5772900"><a href="/database/sql/sql.go.html#5771807">tx</a></span><span class="op" id="5772902">.</span><span class="ident" id="5772903">stmts</span><span class="op" id="5772908">.</span><span class="ident" id="5772909">Lock</span><span class="op" id="5772913">(</span><span class="op" id="5772914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5772917"><a href="/database/sql/sql.go.html#5771807">tx</a></span><span class="op" id="5772919">.</span><span class="ident" id="5772920">stmts</span><span class="op" id="5772925">.</span><span class="ident" id="5772926">v</span>&nbsp;<span class="op" id="5772928">=</span>&nbsp;<span class="builtinfunc" id="5772930">append</span><span class="op" id="5772936">(</span><span class="ident" id="5772937"><a href="/database/sql/sql.go.html#5771807">tx</a></span><span class="op" id="5772939">.</span><span class="ident" id="5772940">stmts</span><span class="op" id="5772945">.</span><span class="ident" id="5772946">v</span><span class="op" id="5772947">,</span>&nbsp;<span class="ident" id="5772949"><a href="/database/sql/sql.go.html#5772786">stmt</a></span><span class="op" id="5772953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5772956"><a href="/database/sql/sql.go.html#5771807">tx</a></span><span class="op" id="5772958">.</span><span class="ident" id="5772959">stmts</span><span class="op" id="5772964">.</span><span class="ident" id="5772965">Unlock</span><span class="op" id="5772971">(</span><span class="op" id="5772972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5772975">return</span>&nbsp;<span class="ident" id="5772982"><a href="/database/sql/sql.go.html#5772786">stmt</a></span><span class="op" id="5772986">,</span>&nbsp;<span class="ident" id="5772988">nil</span><br>
<span class="lineno"></span><span class="op" id="5772992">}</span><br>
<span class="lineno">1175</span><br>
<span class="lineno"></span><span class="comment" id="5772995">//&nbsp;Stmt&nbsp;returns&nbsp;a&nbsp;transaction-specific&nbsp;prepared&nbsp;statement&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="5773058">//&nbsp;an&nbsp;existing&nbsp;statement.</span><br>
<span class="lineno"></span><span class="comment" id="5773084">//</span><br>
<span class="lineno"></span><span class="comment" id="5773087">//&nbsp;Example:</span><br>
<span class="lineno">1180</span><span class="comment" id="5773099">//&nbsp;&nbsp;updateMoney,&nbsp;err&nbsp;:=&nbsp;db.Prepare(&#34;UPDATE&nbsp;balance&nbsp;SET&nbsp;money=money+?&nbsp;WHERE&nbsp;id=?&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="5773181">//&nbsp;&nbsp;...</span><br>
<span class="lineno"></span><span class="comment" id="5773189">//&nbsp;&nbsp;tx,&nbsp;err&nbsp;:=&nbsp;db.Begin()</span><br>
<span class="lineno"></span><span class="comment" id="5773215">//&nbsp;&nbsp;...</span><br>
<span class="lineno"></span><span class="comment" id="5773223">//&nbsp;&nbsp;res,&nbsp;err&nbsp;:=&nbsp;tx.Stmt(updateMoney).Exec(123.45,&nbsp;98293203)</span><br>
<span class="lineno">1185</span><span class="keyword" id="5773283">func</span>&nbsp;<span class="op" id="5773288">(</span><span class="ident" id="5773289">tx</span>&nbsp;<span class="op" id="5773292">*</span><span class="ident" id="5773293"><a href="/database/sql/sql.go.html#5770008">Tx</a></span><span class="op" id="5773295">)</span>&nbsp;<span class="ident" id="5773297">Stmt</span><span class="op" id="5773301">(</span><span class="ident" id="5773302">stmt</span>&nbsp;<span class="op" id="5773307">*</span><span class="ident" id="5773308"><a href="/database/sql/sql.go.html#5775599">Stmt</a></span><span class="op" id="5773312">)</span>&nbsp;<span class="op" id="5773314">*</span><span class="ident" id="5773315"><a href="/database/sql/sql.go.html#5775599">Stmt</a></span>&nbsp;<span class="op" id="5773320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5773323">//&nbsp;TODO(bradfitz):&nbsp;optimize&nbsp;this.&nbsp;Currently&nbsp;this&nbsp;re-prepares</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5773385">//&nbsp;each&nbsp;time.&nbsp;&nbsp;This&nbsp;is&nbsp;fine&nbsp;for&nbsp;now&nbsp;to&nbsp;illustrate&nbsp;the&nbsp;API&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5773448">//&nbsp;we&nbsp;should&nbsp;really&nbsp;cache&nbsp;already-prepared&nbsp;statements</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5773503">//&nbsp;per-Conn.&nbsp;See&nbsp;also&nbsp;the&nbsp;big&nbsp;comment&nbsp;in&nbsp;Tx.Prepare.</span><br>
<span class="lineno">1190</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5773558">if</span>&nbsp;<span class="ident" id="5773561"><a href="/database/sql/sql.go.html#5773289">tx</a></span><span class="op" id="5773563">.</span><span class="ident" id="5773564">db</span>&nbsp;<span class="op" id="5773567">!=</span>&nbsp;<span class="ident" id="5773570"><a href="/database/sql/sql.go.html#5773302">stmt</a></span><span class="op" id="5773574">.</span><span class="ident" id="5773575">db</span>&nbsp;<span class="op" id="5773578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5773582">return</span>&nbsp;<span class="op" id="5773589">&amp;</span><span class="ident" id="5773590"><a href="/database/sql/sql.go.html#5775599">Stmt</a></span><span class="op" id="5773594">{</span><span class="ident" id="5773595">stickyErr</span><span class="op" id="5773604">:</span>&nbsp;<span class="ident" id="5773606"><a href="/database/sql/sql.go.html#5743235">errors</a></span><span class="op" id="5773612">.</span><span class="ident" id="5773613">New</span><span class="op" id="5773616">(</span><span class="string" id="5773617">&#34;sql:&nbsp;Tx.Stmt:&nbsp;statement&nbsp;from&nbsp;different&nbsp;database&nbsp;used&#34;</span><span class="op" id="5773671">)</span><span class="op" id="5773672">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5773675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5773678">dc</span><span class="op" id="5773680">,</span>&nbsp;<span class="ident" id="5773682">err</span>&nbsp;<span class="op" id="5773686">:=</span>&nbsp;<span class="ident" id="5773689"><a href="/database/sql/sql.go.html#5773289">tx</a></span><span class="op" id="5773691">.</span><span class="ident" id="5773692">grabConn</span><span class="op" id="5773700">(</span><span class="op" id="5773701">)</span><br>
<span class="lineno">1195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5773704">if</span>&nbsp;<span class="ident" id="5773707"><a href="/database/sql/sql.go.html#5773682">err</a></span>&nbsp;<span class="op" id="5773711">!=</span>&nbsp;<span class="ident" id="5773714">nil</span>&nbsp;<span class="op" id="5773718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5773722">return</span>&nbsp;<span class="op" id="5773729">&amp;</span><span class="ident" id="5773730"><a href="/database/sql/sql.go.html#5775599">Stmt</a></span><span class="op" id="5773734">{</span><span class="ident" id="5773735">stickyErr</span><span class="op" id="5773744">:</span>&nbsp;<span class="ident" id="5773746"><a href="/database/sql/sql.go.html#5773682">err</a></span><span class="op" id="5773749">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5773752">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5773755"><a href="/database/sql/sql.go.html#5773678">dc</a></span><span class="op" id="5773757">.</span><span class="ident" id="5773758">Lock</span><span class="op" id="5773762">(</span><span class="op" id="5773763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5773766">si</span><span class="op" id="5773768">,</span>&nbsp;<span class="ident" id="5773770"><a href="/database/sql/sql.go.html#5773682">err</a></span>&nbsp;<span class="op" id="5773774">:=</span>&nbsp;<span class="ident" id="5773777"><a href="/database/sql/sql.go.html#5773678">dc</a></span><span class="op" id="5773779">.</span><span class="ident" id="5773780">ci</span><span class="op" id="5773782">.</span><span class="ident" id="5773783">Prepare</span><span class="op" id="5773790">(</span><span class="ident" id="5773791"><a href="/database/sql/sql.go.html#5773302">stmt</a></span><span class="op" id="5773795">.</span><span class="ident" id="5773796">query</span><span class="op" id="5773801">)</span><br>
<span class="lineno">1200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5773804"><a href="/database/sql/sql.go.html#5773678">dc</a></span><span class="op" id="5773806">.</span><span class="ident" id="5773807">Unlock</span><span class="op" id="5773813">(</span><span class="op" id="5773814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5773817">txs</span>&nbsp;<span class="op" id="5773821">:=</span>&nbsp;<span class="op" id="5773824">&amp;</span><span class="ident" id="5773825"><a href="/database/sql/sql.go.html#5775599">Stmt</a></span><span class="op" id="5773829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5773833">db</span><span class="op" id="5773835">:</span>&nbsp;<span class="ident" id="5773837"><a href="/database/sql/sql.go.html#5773289">tx</a></span><span class="op" id="5773839">.</span><span class="ident" id="5773840">db</span><span class="op" id="5773842">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5773846">tx</span><span class="op" id="5773848">:</span>&nbsp;<span class="ident" id="5773850"><a href="/database/sql/sql.go.html#5773289">tx</a></span><span class="op" id="5773852">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5773856">txsi</span><span class="op" id="5773860">:</span>&nbsp;<span class="op" id="5773862">&amp;</span><span class="ident" id="5773863"><a href="/database/sql/sql.go.html#5751783">driverStmt</a></span><span class="op" id="5773873">{</span><br>
<span class="lineno">1205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5773878">Locker</span><span class="op" id="5773884">:</span>&nbsp;<span class="ident" id="5773886"><a href="/database/sql/sql.go.html#5773678">dc</a></span><span class="op" id="5773888">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5773893">si</span><span class="op" id="5773895">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5773901"><a href="/database/sql/sql.go.html#5773766">si</a></span><span class="op" id="5773903">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5773907">}</span><span class="op" id="5773908">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5773912">query</span><span class="op" id="5773917">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5773923"><a href="/database/sql/sql.go.html#5773302">stmt</a></span><span class="op" id="5773927">.</span><span class="ident" id="5773928">query</span><span class="op" id="5773933">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5773937">stickyErr</span><span class="op" id="5773946">:</span>&nbsp;<span class="ident" id="5773948"><a href="/database/sql/sql.go.html#5773682">err</a></span><span class="op" id="5773951">,</span><br>
<span class="lineno">1210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5773954">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5773957"><a href="/database/sql/sql.go.html#5773289">tx</a></span><span class="op" id="5773959">.</span><span class="ident" id="5773960">stmts</span><span class="op" id="5773965">.</span><span class="ident" id="5773966">Lock</span><span class="op" id="5773970">(</span><span class="op" id="5773971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5773974"><a href="/database/sql/sql.go.html#5773289">tx</a></span><span class="op" id="5773976">.</span><span class="ident" id="5773977">stmts</span><span class="op" id="5773982">.</span><span class="ident" id="5773983">v</span>&nbsp;<span class="op" id="5773985">=</span>&nbsp;<span class="builtinfunc" id="5773987">append</span><span class="op" id="5773993">(</span><span class="ident" id="5773994"><a href="/database/sql/sql.go.html#5773289">tx</a></span><span class="op" id="5773996">.</span><span class="ident" id="5773997">stmts</span><span class="op" id="5774002">.</span><span class="ident" id="5774003">v</span><span class="op" id="5774004">,</span>&nbsp;<span class="ident" id="5774006"><a href="/database/sql/sql.go.html#5773817">txs</a></span><span class="op" id="5774009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5774012"><a href="/database/sql/sql.go.html#5773289">tx</a></span><span class="op" id="5774014">.</span><span class="ident" id="5774015">stmts</span><span class="op" id="5774020">.</span><span class="ident" id="5774021">Unlock</span><span class="op" id="5774027">(</span><span class="op" id="5774028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5774031">return</span>&nbsp;<span class="ident" id="5774038"><a href="/database/sql/sql.go.html#5773817">txs</a></span><br>
<span class="lineno">1215</span><span class="op" id="5774042">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5774045">//&nbsp;Exec&nbsp;executes&nbsp;a&nbsp;query&nbsp;that&nbsp;doesn&#39;t&nbsp;return&nbsp;rows.</span><br>
<span class="lineno"></span><span class="comment" id="5774096">//&nbsp;For&nbsp;example:&nbsp;an&nbsp;INSERT&nbsp;and&nbsp;UPDATE.</span><br>
<span class="lineno"></span><span class="keyword" id="5774134">func</span>&nbsp;<span class="op" id="5774139">(</span><span class="ident" id="5774140">tx</span>&nbsp;<span class="op" id="5774143">*</span><span class="ident" id="5774144"><a href="/database/sql/sql.go.html#5770008">Tx</a></span><span class="op" id="5774146">)</span>&nbsp;<span class="ident" id="5774148">Exec</span><span class="op" id="5774152">(</span><span class="ident" id="5774153">query</span>&nbsp;<span class="builtintype" id="5774159">string</span><span class="op" id="5774165">,</span>&nbsp;<span class="ident" id="5774167">args</span>&nbsp;<span class="op" id="5774172">...</span><span class="keyword" id="5774175">interface</span><span class="op" id="5774184">{</span><span class="op" id="5774185">}</span><span class="op" id="5774186">)</span>&nbsp;<span class="op" id="5774188">(</span><span class="ident" id="5774189"><a href="/database/sql/sql.go.html#5787587">Result</a></span><span class="op" id="5774195">,</span>&nbsp;<span class="builtintype" id="5774197">error</span><span class="op" id="5774202">)</span>&nbsp;<span class="op" id="5774204">{</span><br>
<span class="lineno">1220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5774207">dc</span><span class="op" id="5774209">,</span>&nbsp;<span class="ident" id="5774211">err</span>&nbsp;<span class="op" id="5774215">:=</span>&nbsp;<span class="ident" id="5774218"><a href="/database/sql/sql.go.html#5774140">tx</a></span><span class="op" id="5774220">.</span><span class="ident" id="5774221">grabConn</span><span class="op" id="5774229">(</span><span class="op" id="5774230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5774233">if</span>&nbsp;<span class="ident" id="5774236"><a href="/database/sql/sql.go.html#5774211">err</a></span>&nbsp;<span class="op" id="5774240">!=</span>&nbsp;<span class="ident" id="5774243">nil</span>&nbsp;<span class="op" id="5774247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5774251">return</span>&nbsp;<span class="ident" id="5774258">nil</span><span class="op" id="5774261">,</span>&nbsp;<span class="ident" id="5774263"><a href="/database/sql/sql.go.html#5774211">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5774268">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5774272">if</span>&nbsp;<span class="ident" id="5774275">execer</span><span class="op" id="5774281">,</span>&nbsp;<span class="ident" id="5774283">ok</span>&nbsp;<span class="op" id="5774286">:=</span>&nbsp;<span class="ident" id="5774289"><a href="/database/sql/sql.go.html#5774207">dc</a></span><span class="op" id="5774291">.</span><span class="ident" id="5774292">ci</span><span class="op" id="5774294">.</span><span class="op" id="5774295">(</span><span class="ident" id="5774296"><a href="/database/sql/sql.go.html#5743212">driver</a></span><span class="op" id="5774302">.</span><span class="ident" id="5774303">Execer</span><span class="op" id="5774309">)</span><span class="op" id="5774310">;</span>&nbsp;<span class="ident" id="5774312"><a href="/database/sql/sql.go.html#5774283">ok</a></span>&nbsp;<span class="op" id="5774315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5774319">dargs</span><span class="op" id="5774324">,</span>&nbsp;<span class="ident" id="5774326">err</span>&nbsp;<span class="op" id="5774330">:=</span>&nbsp;<span class="ident" id="5774333"><a href="/database/sql/convert.go.html#5735966">driverArgs</a></span><span class="op" id="5774343">(</span><span class="ident" id="5774344">nil</span><span class="op" id="5774347">,</span>&nbsp;<span class="ident" id="5774349"><a href="/database/sql/sql.go.html#5774167">args</a></span><span class="op" id="5774353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5774357">if</span>&nbsp;<span class="ident" id="5774360"><a href="/database/sql/sql.go.html#5774326">err</a></span>&nbsp;<span class="op" id="5774364">!=</span>&nbsp;<span class="ident" id="5774367">nil</span>&nbsp;<span class="op" id="5774371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5774376">return</span>&nbsp;<span class="ident" id="5774383">nil</span><span class="op" id="5774386">,</span>&nbsp;<span class="ident" id="5774388"><a href="/database/sql/sql.go.html#5774326">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5774394">}</span><br>
<span class="lineno">1230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5774398"><a href="/database/sql/sql.go.html#5774207">dc</a></span><span class="op" id="5774400">.</span><span class="ident" id="5774401">Lock</span><span class="op" id="5774405">(</span><span class="op" id="5774406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5774410">resi</span><span class="op" id="5774414">,</span>&nbsp;<span class="ident" id="5774416"><a href="/database/sql/sql.go.html#5774326">err</a></span>&nbsp;<span class="op" id="5774420">:=</span>&nbsp;<span class="ident" id="5774423"><a href="/database/sql/sql.go.html#5774275">execer</a></span><span class="op" id="5774429">.</span><span class="ident" id="5774430">Exec</span><span class="op" id="5774434">(</span><span class="ident" id="5774435"><a href="/database/sql/sql.go.html#5774153">query</a></span><span class="op" id="5774440">,</span>&nbsp;<span class="ident" id="5774442"><a href="/database/sql/sql.go.html#5774319">dargs</a></span><span class="op" id="5774447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5774451"><a href="/database/sql/sql.go.html#5774207">dc</a></span><span class="op" id="5774453">.</span><span class="ident" id="5774454">Unlock</span><span class="op" id="5774460">(</span><span class="op" id="5774461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5774465">if</span>&nbsp;<span class="ident" id="5774468"><a href="/database/sql/sql.go.html#5774326">err</a></span>&nbsp;<span class="op" id="5774472">==</span>&nbsp;<span class="ident" id="5774475">nil</span>&nbsp;<span class="op" id="5774479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5774484">return</span>&nbsp;<span class="ident" id="5774491"><a href="/database/sql/sql.go.html#5788095">driverResult</a></span><span class="op" id="5774503">{</span><span class="ident" id="5774504"><a href="/database/sql/sql.go.html#5774207">dc</a></span><span class="op" id="5774506">,</span>&nbsp;<span class="ident" id="5774508"><a href="/database/sql/sql.go.html#5774410">resi</a></span><span class="op" id="5774512">}</span><span class="op" id="5774513">,</span>&nbsp;<span class="ident" id="5774515">nil</span><br>
<span class="lineno">1235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5774521">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5774525">if</span>&nbsp;<span class="ident" id="5774528"><a href="/database/sql/sql.go.html#5774326">err</a></span>&nbsp;<span class="op" id="5774532">!=</span>&nbsp;<span class="ident" id="5774535"><a href="/database/sql/sql.go.html#5743212">driver</a></span><span class="op" id="5774541">.</span><span class="ident" id="5774542">ErrSkip</span>&nbsp;<span class="op" id="5774550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5774555">return</span>&nbsp;<span class="ident" id="5774562">nil</span><span class="op" id="5774565">,</span>&nbsp;<span class="ident" id="5774567"><a href="/database/sql/sql.go.html#5774326">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5774573">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5774576">}</span><br>
<span class="lineno">1240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5774580"><a href="/database/sql/sql.go.html#5774207">dc</a></span><span class="op" id="5774582">.</span><span class="ident" id="5774583">Lock</span><span class="op" id="5774587">(</span><span class="op" id="5774588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5774591">si</span><span class="op" id="5774593">,</span>&nbsp;<span class="ident" id="5774595"><a href="/database/sql/sql.go.html#5774211">err</a></span>&nbsp;<span class="op" id="5774599">:=</span>&nbsp;<span class="ident" id="5774602"><a href="/database/sql/sql.go.html#5774207">dc</a></span><span class="op" id="5774604">.</span><span class="ident" id="5774605">ci</span><span class="op" id="5774607">.</span><span class="ident" id="5774608">Prepare</span><span class="op" id="5774615">(</span><span class="ident" id="5774616"><a href="/database/sql/sql.go.html#5774153">query</a></span><span class="op" id="5774621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5774624"><a href="/database/sql/sql.go.html#5774207">dc</a></span><span class="op" id="5774626">.</span><span class="ident" id="5774627">Unlock</span><span class="op" id="5774633">(</span><span class="op" id="5774634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5774637">if</span>&nbsp;<span class="ident" id="5774640"><a href="/database/sql/sql.go.html#5774211">err</a></span>&nbsp;<span class="op" id="5774644">!=</span>&nbsp;<span class="ident" id="5774647">nil</span>&nbsp;<span class="op" id="5774651">{</span><br>
<span class="lineno">1245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5774655">return</span>&nbsp;<span class="ident" id="5774662">nil</span><span class="op" id="5774665">,</span>&nbsp;<span class="ident" id="5774667"><a href="/database/sql/sql.go.html#5774211">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5774672">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5774675">defer</span>&nbsp;<span class="ident" id="5774681"><a href="/database/sql/sql.go.html#5788556">withLock</a></span><span class="op" id="5774689">(</span><span class="ident" id="5774690"><a href="/database/sql/sql.go.html#5774207">dc</a></span><span class="op" id="5774692">,</span>&nbsp;<span class="keyword" id="5774694">func</span><span class="op" id="5774698">(</span><span class="op" id="5774699">)</span>&nbsp;<span class="op" id="5774701">{</span>&nbsp;<span class="ident" id="5774703"><a href="/database/sql/sql.go.html#5774591">si</a></span><span class="op" id="5774705">.</span><span class="ident" id="5774706">Close</span><span class="op" id="5774711">(</span><span class="op" id="5774712">)</span>&nbsp;<span class="op" id="5774714">}</span><span class="op" id="5774715">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5774719">return</span>&nbsp;<span class="ident" id="5774726"><a href="/database/sql/sql.go.html#5776852">resultFromStatement</a></span><span class="op" id="5774745">(</span><span class="ident" id="5774746"><a href="/database/sql/sql.go.html#5751783">driverStmt</a></span><span class="op" id="5774756">{</span><span class="ident" id="5774757"><a href="/database/sql/sql.go.html#5774207">dc</a></span><span class="op" id="5774759">,</span>&nbsp;<span class="ident" id="5774761"><a href="/database/sql/sql.go.html#5774591">si</a></span><span class="op" id="5774763">}</span><span class="op" id="5774764">,</span>&nbsp;<span class="ident" id="5774766"><a href="/database/sql/sql.go.html#5774167">args</a></span><span class="op" id="5774770">...</span><span class="op" id="5774773">)</span><br>
<span class="lineno">1250</span><span class="op" id="5774775">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5774778">//&nbsp;Query&nbsp;executes&nbsp;a&nbsp;query&nbsp;that&nbsp;returns&nbsp;rows,&nbsp;typically&nbsp;a&nbsp;SELECT.</span><br>
<span class="lineno"></span><span class="keyword" id="5774843">func</span>&nbsp;<span class="op" id="5774848">(</span><span class="ident" id="5774849">tx</span>&nbsp;<span class="op" id="5774852">*</span><span class="ident" id="5774853"><a href="/database/sql/sql.go.html#5770008">Tx</a></span><span class="op" id="5774855">)</span>&nbsp;<span class="ident" id="5774857">Query</span><span class="op" id="5774862">(</span><span class="ident" id="5774863">query</span>&nbsp;<span class="builtintype" id="5774869">string</span><span class="op" id="5774875">,</span>&nbsp;<span class="ident" id="5774877">args</span>&nbsp;<span class="op" id="5774882">...</span><span class="keyword" id="5774885">interface</span><span class="op" id="5774894">{</span><span class="op" id="5774895">}</span><span class="op" id="5774896">)</span>&nbsp;<span class="op" id="5774898">(</span><span class="op" id="5774899">*</span><span class="ident" id="5774900"><a href="/database/sql/sql.go.html#5782647">Rows</a></span><span class="op" id="5774904">,</span>&nbsp;<span class="builtintype" id="5774906">error</span><span class="op" id="5774911">)</span>&nbsp;<span class="op" id="5774913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5774916">dc</span><span class="op" id="5774918">,</span>&nbsp;<span class="ident" id="5774920">err</span>&nbsp;<span class="op" id="5774924">:=</span>&nbsp;<span class="ident" id="5774927"><a href="/database/sql/sql.go.html#5774849">tx</a></span><span class="op" id="5774929">.</span><span class="ident" id="5774930">grabConn</span><span class="op" id="5774938">(</span><span class="op" id="5774939">)</span><br>
<span class="lineno">1255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5774942">if</span>&nbsp;<span class="ident" id="5774945"><a href="/database/sql/sql.go.html#5774920">err</a></span>&nbsp;<span class="op" id="5774949">!=</span>&nbsp;<span class="ident" id="5774952">nil</span>&nbsp;<span class="op" id="5774956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5774960">return</span>&nbsp;<span class="ident" id="5774967">nil</span><span class="op" id="5774970">,</span>&nbsp;<span class="ident" id="5774972"><a href="/database/sql/sql.go.html#5774920">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5774977">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5774980">releaseConn</span>&nbsp;<span class="op" id="5774992">:=</span>&nbsp;<span class="keyword" id="5774995">func</span><span class="op" id="5774999">(</span><span class="builtintype" id="5775000">error</span><span class="op" id="5775005">)</span>&nbsp;<span class="op" id="5775007">{</span><span class="op" id="5775008">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5775011">return</span>&nbsp;<span class="ident" id="5775018"><a href="/database/sql/sql.go.html#5774849">tx</a></span><span class="op" id="5775020">.</span><span class="ident" id="5775021">db</span><span class="op" id="5775023">.</span><span class="ident" id="5775024">queryConn</span><span class="op" id="5775033">(</span><span class="ident" id="5775034"><a href="/database/sql/sql.go.html#5774916">dc</a></span><span class="op" id="5775036">,</span>&nbsp;<span class="ident" id="5775038"><a href="/database/sql/sql.go.html#5774980">releaseConn</a></span><span class="op" id="5775049">,</span>&nbsp;<span class="ident" id="5775051"><a href="/database/sql/sql.go.html#5774863">query</a></span><span class="op" id="5775056">,</span>&nbsp;<span class="ident" id="5775058"><a href="/database/sql/sql.go.html#5774877">args</a></span><span class="op" id="5775062">)</span><br>
<span class="lineno">1260</span><span class="op" id="5775064">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5775067">//&nbsp;QueryRow&nbsp;executes&nbsp;a&nbsp;query&nbsp;that&nbsp;is&nbsp;expected&nbsp;to&nbsp;return&nbsp;at&nbsp;most&nbsp;one&nbsp;row.</span><br>
<span class="lineno"></span><span class="comment" id="5775140">//&nbsp;QueryRow&nbsp;always&nbsp;return&nbsp;a&nbsp;non-nil&nbsp;value.&nbsp;Errors&nbsp;are&nbsp;deferred&nbsp;until</span><br>
<span class="lineno"></span><span class="comment" id="5775209">//&nbsp;Row&#39;s&nbsp;Scan&nbsp;method&nbsp;is&nbsp;called.</span><br>
<span class="lineno">1265</span><span class="keyword" id="5775241">func</span>&nbsp;<span class="op" id="5775246">(</span><span class="ident" id="5775247">tx</span>&nbsp;<span class="op" id="5775250">*</span><span class="ident" id="5775251"><a href="/database/sql/sql.go.html#5770008">Tx</a></span><span class="op" id="5775253">)</span>&nbsp;<span class="ident" id="5775255">QueryRow</span><span class="op" id="5775263">(</span><span class="ident" id="5775264">query</span>&nbsp;<span class="builtintype" id="5775270">string</span><span class="op" id="5775276">,</span>&nbsp;<span class="ident" id="5775278">args</span>&nbsp;<span class="op" id="5775283">...</span><span class="keyword" id="5775286">interface</span><span class="op" id="5775295">{</span><span class="op" id="5775296">}</span><span class="op" id="5775297">)</span>&nbsp;<span class="op" id="5775299">*</span><span class="ident" id="5775300"><a href="/database/sql/sql.go.html#5785899">Row</a></span>&nbsp;<span class="op" id="5775304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5775307">rows</span><span class="op" id="5775311">,</span>&nbsp;<span class="ident" id="5775313">err</span>&nbsp;<span class="op" id="5775317">:=</span>&nbsp;<span class="ident" id="5775320"><a href="/database/sql/sql.go.html#5775247">tx</a></span><span class="op" id="5775322">.</span><span class="ident" id="5775323">Query</span><span class="op" id="5775328">(</span><span class="ident" id="5775329"><a href="/database/sql/sql.go.html#5775264">query</a></span><span class="op" id="5775334">,</span>&nbsp;<span class="ident" id="5775336"><a href="/database/sql/sql.go.html#5775278">args</a></span><span class="op" id="5775340">...</span><span class="op" id="5775343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5775346">return</span>&nbsp;<span class="op" id="5775353">&amp;</span><span class="ident" id="5775354"><a href="/database/sql/sql.go.html#5785899">Row</a></span><span class="op" id="5775357">{</span><span class="ident" id="5775358">rows</span><span class="op" id="5775362">:</span>&nbsp;<span class="ident" id="5775364"><a href="/database/sql/sql.go.html#5775307">rows</a></span><span class="op" id="5775368">,</span>&nbsp;<span class="ident" id="5775370">err</span><span class="op" id="5775373">:</span>&nbsp;<span class="ident" id="5775375"><a href="/database/sql/sql.go.html#5775313">err</a></span><span class="op" id="5775378">}</span><br>
<span class="lineno"></span><span class="op" id="5775380">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1270</span><span class="comment" id="5775383">//&nbsp;connStmt&nbsp;is&nbsp;a&nbsp;prepared&nbsp;statement&nbsp;on&nbsp;a&nbsp;particular&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="5775447">type</span>&nbsp;<span class="ident" id="5775452">connStmt</span>&nbsp;<span class="keyword" id="5775461">struct</span>&nbsp;<span class="op" id="5775468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5775471">dc</span>&nbsp;<span class="op" id="5775474">*</span><span class="ident" id="5775475"><a href="/database/sql/sql.go.html#5749298">driverConn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5775487">si</span>&nbsp;<span class="ident" id="5775490"><a href="/database/sql/sql.go.html#5743212">driver</a></span><span class="op" id="5775496">.</span><span class="ident" id="5775497">Stmt</span><br>
<span class="lineno"></span><span class="op" id="5775502">}</span><br>
<span class="lineno">1275</span><br>
<span class="lineno"></span><span class="comment" id="5775505">//&nbsp;Stmt&nbsp;is&nbsp;a&nbsp;prepared&nbsp;statement.&nbsp;Stmt&nbsp;is&nbsp;safe&nbsp;for&nbsp;concurrent&nbsp;use&nbsp;by&nbsp;multiple&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="keyword" id="5775594">type</span>&nbsp;<span class="ident" id="5775599">Stmt</span>&nbsp;<span class="keyword" id="5775604">struct</span>&nbsp;<span class="op" id="5775611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5775614">//&nbsp;Immutable:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5775629">db</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5775639">*</span><span class="ident" id="5775640"><a href="/database/sql/sql.go.html#5748306">DB</a></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5775646">//&nbsp;where&nbsp;we&nbsp;came&nbsp;from</span><br>
<span class="lineno">1280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5775669">query</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5775679">string</span>&nbsp;<span class="comment" id="5775686">//&nbsp;that&nbsp;created&nbsp;the&nbsp;Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5775712">stickyErr</span>&nbsp;<span class="builtintype" id="5775722">error</span>&nbsp;&nbsp;<span class="comment" id="5775729">//&nbsp;if&nbsp;non-nil,&nbsp;this&nbsp;error&nbsp;is&nbsp;returned&nbsp;for&nbsp;all&nbsp;operations</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5775788">closemu</span>&nbsp;<span class="ident" id="5775796"><a href="/database/sql/sql.go.html#5743277">sync</a></span><span class="op" id="5775800">.</span><span class="ident" id="5775801">RWMutex</span>&nbsp;<span class="comment" id="5775809">//&nbsp;held&nbsp;exclusively&nbsp;during&nbsp;close,&nbsp;for&nbsp;read&nbsp;otherwise.</span><br>
<span class="lineno"></span><br>
<span class="lineno">1285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5775865">//&nbsp;If&nbsp;in&nbsp;a&nbsp;transaction,&nbsp;else&nbsp;both&nbsp;nil:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5775905">tx</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5775910">*</span><span class="ident" id="5775911"><a href="/database/sql/sql.go.html#5770008">Tx</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5775915">txsi</span>&nbsp;<span class="op" id="5775920">*</span><span class="ident" id="5775921"><a href="/database/sql/sql.go.html#5751783">driverStmt</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5775934">mu</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5775941"><a href="/database/sql/sql.go.html#5743277">sync</a></span><span class="op" id="5775945">.</span><span class="ident" id="5775946">Mutex</span>&nbsp;<span class="comment" id="5775952">//&nbsp;protects&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;fields</span><br>
<span class="lineno">1290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5775988">closed</span>&nbsp;<span class="builtintype" id="5775995">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5776002">//&nbsp;css&nbsp;is&nbsp;a&nbsp;list&nbsp;of&nbsp;underlying&nbsp;driver&nbsp;statement&nbsp;interfaces</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5776062">//&nbsp;that&nbsp;are&nbsp;valid&nbsp;on&nbsp;particular&nbsp;connections.&nbsp;&nbsp;This&nbsp;is&nbsp;only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5776122">//&nbsp;used&nbsp;if&nbsp;tx&nbsp;==&nbsp;nil&nbsp;and&nbsp;one&nbsp;is&nbsp;found&nbsp;that&nbsp;has&nbsp;idle</span><br>
<span class="lineno">1295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5776175">//&nbsp;connections.&nbsp;&nbsp;If&nbsp;tx&nbsp;!=&nbsp;nil,&nbsp;txsi&nbsp;is&nbsp;always&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5776228">css</span>&nbsp;<span class="op" id="5776232">[</span><span class="op" id="5776233">]</span><span class="ident" id="5776234"><a href="/database/sql/sql.go.html#5775452">connStmt</a></span><br>
<span class="lineno"></span><span class="op" id="5776243">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5776246">//&nbsp;Exec&nbsp;executes&nbsp;a&nbsp;prepared&nbsp;statement&nbsp;with&nbsp;the&nbsp;given&nbsp;arguments&nbsp;and</span><br>
<span class="lineno">1300</span><span class="comment" id="5776313">//&nbsp;returns&nbsp;a&nbsp;Result&nbsp;summarizing&nbsp;the&nbsp;effect&nbsp;of&nbsp;the&nbsp;statement.</span><br>
<span class="lineno"></span><span class="keyword" id="5776374">func</span>&nbsp;<span class="op" id="5776379">(</span><span class="ident" id="5776380">s</span>&nbsp;<span class="op" id="5776382">*</span><span class="ident" id="5776383"><a href="/database/sql/sql.go.html#5775599">Stmt</a></span><span class="op" id="5776387">)</span>&nbsp;<span class="ident" id="5776389">Exec</span><span class="op" id="5776393">(</span><span class="ident" id="5776394">args</span>&nbsp;<span class="op" id="5776399">...</span><span class="keyword" id="5776402">interface</span><span class="op" id="5776411">{</span><span class="op" id="5776412">}</span><span class="op" id="5776413">)</span>&nbsp;<span class="op" id="5776415">(</span><span class="ident" id="5776416"><a href="/database/sql/sql.go.html#5787587">Result</a></span><span class="op" id="5776422">,</span>&nbsp;<span class="builtintype" id="5776424">error</span><span class="op" id="5776429">)</span>&nbsp;<span class="op" id="5776431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5776434"><a href="/database/sql/sql.go.html#5776380">s</a></span><span class="op" id="5776435">.</span><span class="ident" id="5776436">closemu</span><span class="op" id="5776443">.</span><span class="ident" id="5776444">RLock</span><span class="op" id="5776449">(</span><span class="op" id="5776450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5776453">defer</span>&nbsp;<span class="ident" id="5776459"><a href="/database/sql/sql.go.html#5776380">s</a></span><span class="op" id="5776460">.</span><span class="ident" id="5776461">closemu</span><span class="op" id="5776468">.</span><span class="ident" id="5776469">RUnlock</span><span class="op" id="5776476">(</span><span class="op" id="5776477">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5776481">var</span>&nbsp;<span class="ident" id="5776485">res</span>&nbsp;<span class="ident" id="5776489"><a href="/database/sql/sql.go.html#5787587">Result</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5776497">for</span>&nbsp;<span class="ident" id="5776501">i</span>&nbsp;<span class="op" id="5776503">:=</span>&nbsp;<span class="num" id="5776506">0</span><span class="op" id="5776507">;</span>&nbsp;<span class="ident" id="5776509"><a href="/database/sql/sql.go.html#5776501">i</a></span>&nbsp;<span class="op" id="5776511">&lt;</span>&nbsp;<span class="ident" id="5776513"><a href="/database/sql/sql.go.html#5764807">maxBadConnRetries</a></span><span class="op" id="5776530">;</span>&nbsp;<span class="ident" id="5776532"><a href="/database/sql/sql.go.html#5776501">i</a></span><span class="op" id="5776533">++</span>&nbsp;<span class="op" id="5776536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5776540">dc</span><span class="op" id="5776542">,</span>&nbsp;<span class="ident" id="5776544">releaseConn</span><span class="op" id="5776555">,</span>&nbsp;<span class="ident" id="5776557">si</span><span class="op" id="5776559">,</span>&nbsp;<span class="ident" id="5776561">err</span>&nbsp;<span class="op" id="5776565">:=</span>&nbsp;<span class="ident" id="5776568"><a href="/database/sql/sql.go.html#5776380">s</a></span><span class="op" id="5776569">.</span><span class="ident" id="5776570">connStmt</span><span class="op" id="5776578">(</span><span class="op" id="5776579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5776583">if</span>&nbsp;<span class="ident" id="5776586"><a href="/database/sql/sql.go.html#5776561">err</a></span>&nbsp;<span class="op" id="5776590">!=</span>&nbsp;<span class="ident" id="5776593">nil</span>&nbsp;<span class="op" id="5776597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5776602">if</span>&nbsp;<span class="ident" id="5776605"><a href="/database/sql/sql.go.html#5776561">err</a></span>&nbsp;<span class="op" id="5776609">==</span>&nbsp;<span class="ident" id="5776612"><a href="/database/sql/sql.go.html#5743212">driver</a></span><span class="op" id="5776618">.</span><span class="ident" id="5776619">ErrBadConn</span>&nbsp;<span class="op" id="5776630">{</span><br>
<span class="lineno">1310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5776636">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5776648">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5776653">return</span>&nbsp;<span class="ident" id="5776660">nil</span><span class="op" id="5776663">,</span>&nbsp;<span class="ident" id="5776665"><a href="/database/sql/sql.go.html#5776561">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5776671">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5776676"><a href="/database/sql/sql.go.html#5776485">res</a></span><span class="op" id="5776679">,</span>&nbsp;<span class="ident" id="5776681"><a href="/database/sql/sql.go.html#5776561">err</a></span>&nbsp;<span class="op" id="5776685">=</span>&nbsp;<span class="ident" id="5776687"><a href="/database/sql/sql.go.html#5776852">resultFromStatement</a></span><span class="op" id="5776706">(</span><span class="ident" id="5776707"><a href="/database/sql/sql.go.html#5751783">driverStmt</a></span><span class="op" id="5776717">{</span><span class="ident" id="5776718"><a href="/database/sql/sql.go.html#5776540">dc</a></span><span class="op" id="5776720">,</span>&nbsp;<span class="ident" id="5776722"><a href="/database/sql/sql.go.html#5776557">si</a></span><span class="op" id="5776724">}</span><span class="op" id="5776725">,</span>&nbsp;<span class="ident" id="5776727"><a href="/database/sql/sql.go.html#5776394">args</a></span><span class="op" id="5776731">...</span><span class="op" id="5776734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5776738"><a href="/database/sql/sql.go.html#5776544">releaseConn</a></span><span class="op" id="5776749">(</span><span class="ident" id="5776750"><a href="/database/sql/sql.go.html#5776561">err</a></span><span class="op" id="5776753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5776757">if</span>&nbsp;<span class="ident" id="5776760"><a href="/database/sql/sql.go.html#5776561">err</a></span>&nbsp;<span class="op" id="5776764">!=</span>&nbsp;<span class="ident" id="5776767"><a href="/database/sql/sql.go.html#5743212">driver</a></span><span class="op" id="5776773">.</span><span class="ident" id="5776774">ErrBadConn</span>&nbsp;<span class="op" id="5776785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5776790">return</span>&nbsp;<span class="ident" id="5776797"><a href="/database/sql/sql.go.html#5776485">res</a></span><span class="op" id="5776800">,</span>&nbsp;<span class="ident" id="5776802"><a href="/database/sql/sql.go.html#5776561">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5776808">}</span><br>
<span class="lineno">1320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5776811">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5776814">return</span>&nbsp;<span class="ident" id="5776821">nil</span><span class="op" id="5776824">,</span>&nbsp;<span class="ident" id="5776826"><a href="/database/sql/sql.go.html#5743212">driver</a></span><span class="op" id="5776832">.</span><span class="ident" id="5776833">ErrBadConn</span><br>
<span class="lineno"></span><span class="op" id="5776844">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5776847">func</span>&nbsp;<span class="ident" id="5776852">resultFromStatement</span><span class="op" id="5776871">(</span><span class="ident" id="5776872">ds</span>&nbsp;<span class="ident" id="5776875"><a href="/database/sql/sql.go.html#5751783">driverStmt</a></span><span class="op" id="5776885">,</span>&nbsp;<span class="ident" id="5776887">args</span>&nbsp;<span class="op" id="5776892">...</span><span class="keyword" id="5776895">interface</span><span class="op" id="5776904">{</span><span class="op" id="5776905">}</span><span class="op" id="5776906">)</span>&nbsp;<span class="op" id="5776908">(</span><span class="ident" id="5776909"><a href="/database/sql/sql.go.html#5787587">Result</a></span><span class="op" id="5776915">,</span>&nbsp;<span class="builtintype" id="5776917">error</span><span class="op" id="5776922">)</span>&nbsp;<span class="op" id="5776924">{</span><br>
<span class="lineno">1325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5776927"><a href="/database/sql/sql.go.html#5776872">ds</a></span><span class="op" id="5776929">.</span><span class="ident" id="5776930">Lock</span><span class="op" id="5776934">(</span><span class="op" id="5776935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5776938">want</span>&nbsp;<span class="op" id="5776943">:=</span>&nbsp;<span class="ident" id="5776946"><a href="/database/sql/sql.go.html#5776872">ds</a></span><span class="op" id="5776948">.</span><span class="ident" id="5776949">si</span><span class="op" id="5776951">.</span><span class="ident" id="5776952">NumInput</span><span class="op" id="5776960">(</span><span class="op" id="5776961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5776964"><a href="/database/sql/sql.go.html#5776872">ds</a></span><span class="op" id="5776966">.</span><span class="ident" id="5776967">Unlock</span><span class="op" id="5776973">(</span><span class="op" id="5776974">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5776978">//&nbsp;-1&nbsp;means&nbsp;the&nbsp;driver&nbsp;doesn&#39;t&nbsp;know&nbsp;how&nbsp;to&nbsp;count&nbsp;the&nbsp;number&nbsp;of</span><br>
<span class="lineno">1330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5777042">//&nbsp;placeholders,&nbsp;so&nbsp;we&nbsp;won&#39;t&nbsp;sanity&nbsp;check&nbsp;input&nbsp;here&nbsp;and&nbsp;instead&nbsp;let&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5777116">//&nbsp;driver&nbsp;deal&nbsp;with&nbsp;errors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5777145">if</span>&nbsp;<span class="ident" id="5777148"><a href="/database/sql/sql.go.html#5776938">want</a></span>&nbsp;<span class="op" id="5777153">!=</span>&nbsp;<span class="op" id="5777156">-</span><span class="num" id="5777157">1</span>&nbsp;<span class="op" id="5777159">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5777162">len</span><span class="op" id="5777165">(</span><span class="ident" id="5777166"><a href="/database/sql/sql.go.html#5776887">args</a></span><span class="op" id="5777170">)</span>&nbsp;<span class="op" id="5777172">!=</span>&nbsp;<span class="ident" id="5777175"><a href="/database/sql/sql.go.html#5776938">want</a></span>&nbsp;<span class="op" id="5777180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5777184">return</span>&nbsp;<span class="ident" id="5777191">nil</span><span class="op" id="5777194">,</span>&nbsp;<span class="ident" id="5777196"><a href="/database/sql/sql.go.html#5743245">fmt</a></span><span class="op" id="5777199">.</span><span class="ident" id="5777200">Errorf</span><span class="op" id="5777206">(</span><span class="string" id="5777207">&#34;sql:&nbsp;expected&nbsp;%d&nbsp;arguments,&nbsp;got&nbsp;%d&#34;</span><span class="op" id="5777243">,</span>&nbsp;<span class="ident" id="5777245"><a href="/database/sql/sql.go.html#5776938">want</a></span><span class="op" id="5777249">,</span>&nbsp;<span class="builtinfunc" id="5777251">len</span><span class="op" id="5777254">(</span><span class="ident" id="5777255"><a href="/database/sql/sql.go.html#5776887">args</a></span><span class="op" id="5777259">)</span><span class="op" id="5777260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5777263">}</span><br>
<span class="lineno">1335</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5777267">dargs</span><span class="op" id="5777272">,</span>&nbsp;<span class="ident" id="5777274">err</span>&nbsp;<span class="op" id="5777278">:=</span>&nbsp;<span class="ident" id="5777281"><a href="/database/sql/convert.go.html#5735966">driverArgs</a></span><span class="op" id="5777291">(</span><span class="op" id="5777292">&amp;</span><span class="ident" id="5777293"><a href="/database/sql/sql.go.html#5776872">ds</a></span><span class="op" id="5777295">,</span>&nbsp;<span class="ident" id="5777297"><a href="/database/sql/sql.go.html#5776887">args</a></span><span class="op" id="5777301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5777304">if</span>&nbsp;<span class="ident" id="5777307"><a href="/database/sql/sql.go.html#5777274">err</a></span>&nbsp;<span class="op" id="5777311">!=</span>&nbsp;<span class="ident" id="5777314">nil</span>&nbsp;<span class="op" id="5777318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5777322">return</span>&nbsp;<span class="ident" id="5777329">nil</span><span class="op" id="5777332">,</span>&nbsp;<span class="ident" id="5777334"><a href="/database/sql/sql.go.html#5777274">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5777339">}</span><br>
<span class="lineno">1340</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5777343"><a href="/database/sql/sql.go.html#5776872">ds</a></span><span class="op" id="5777345">.</span><span class="ident" id="5777346">Lock</span><span class="op" id="5777350">(</span><span class="op" id="5777351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5777354">resi</span><span class="op" id="5777358">,</span>&nbsp;<span class="ident" id="5777360"><a href="/database/sql/sql.go.html#5777274">err</a></span>&nbsp;<span class="op" id="5777364">:=</span>&nbsp;<span class="ident" id="5777367"><a href="/database/sql/sql.go.html#5776872">ds</a></span><span class="op" id="5777369">.</span><span class="ident" id="5777370">si</span><span class="op" id="5777372">.</span><span class="ident" id="5777373">Exec</span><span class="op" id="5777377">(</span><span class="ident" id="5777378"><a href="/database/sql/sql.go.html#5777267">dargs</a></span><span class="op" id="5777383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5777386"><a href="/database/sql/sql.go.html#5776872">ds</a></span><span class="op" id="5777388">.</span><span class="ident" id="5777389">Unlock</span><span class="op" id="5777395">(</span><span class="op" id="5777396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5777399">if</span>&nbsp;<span class="ident" id="5777402"><a href="/database/sql/sql.go.html#5777274">err</a></span>&nbsp;<span class="op" id="5777406">!=</span>&nbsp;<span class="ident" id="5777409">nil</span>&nbsp;<span class="op" id="5777413">{</span><br>
<span class="lineno">1345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5777417">return</span>&nbsp;<span class="ident" id="5777424">nil</span><span class="op" id="5777427">,</span>&nbsp;<span class="ident" id="5777429"><a href="/database/sql/sql.go.html#5777274">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5777434">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5777437">return</span>&nbsp;<span class="ident" id="5777444"><a href="/database/sql/sql.go.html#5788095">driverResult</a></span><span class="op" id="5777456">{</span><span class="ident" id="5777457"><a href="/database/sql/sql.go.html#5776872">ds</a></span><span class="op" id="5777459">.</span><span class="ident" id="5777460">Locker</span><span class="op" id="5777466">,</span>&nbsp;<span class="ident" id="5777468"><a href="/database/sql/sql.go.html#5777354">resi</a></span><span class="op" id="5777472">}</span><span class="op" id="5777473">,</span>&nbsp;<span class="ident" id="5777475">nil</span><br>
<span class="lineno"></span><span class="op" id="5777479">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1350</span><span class="comment" id="5777482">//&nbsp;connStmt&nbsp;returns&nbsp;a&nbsp;free&nbsp;driver&nbsp;connection&nbsp;on&nbsp;which&nbsp;to&nbsp;execute&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5777551">//&nbsp;statement,&nbsp;a&nbsp;function&nbsp;to&nbsp;call&nbsp;to&nbsp;release&nbsp;the&nbsp;connection,&nbsp;and&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5777617">//&nbsp;statement&nbsp;bound&nbsp;to&nbsp;that&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="5777656">func</span>&nbsp;<span class="op" id="5777661">(</span><span class="ident" id="5777662">s</span>&nbsp;<span class="op" id="5777664">*</span><span class="ident" id="5777665"><a href="/database/sql/sql.go.html#5775599">Stmt</a></span><span class="op" id="5777669">)</span>&nbsp;<span class="ident" id="5777671">connStmt</span><span class="op" id="5777679">(</span><span class="op" id="5777680">)</span>&nbsp;<span class="op" id="5777682">(</span><span class="ident" id="5777683">ci</span>&nbsp;<span class="op" id="5777686">*</span><span class="ident" id="5777687"><a href="/database/sql/sql.go.html#5749298">driverConn</a></span><span class="op" id="5777697">,</span>&nbsp;<span class="ident" id="5777699">releaseConn</span>&nbsp;<span class="keyword" id="5777711">func</span><span class="op" id="5777715">(</span><span class="builtintype" id="5777716">error</span><span class="op" id="5777721">)</span><span class="op" id="5777722">,</span>&nbsp;<span class="ident" id="5777724">si</span>&nbsp;<span class="ident" id="5777727"><a href="/database/sql/sql.go.html#5743212">driver</a></span><span class="op" id="5777733">.</span><span class="ident" id="5777734">Stmt</span><span class="op" id="5777738">,</span>&nbsp;<span class="ident" id="5777740">err</span>&nbsp;<span class="builtintype" id="5777744">error</span><span class="op" id="5777749">)</span>&nbsp;<span class="op" id="5777751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5777754">if</span>&nbsp;<span class="ident" id="5777757"><a href="/database/sql/sql.go.html#5777740">err</a></span>&nbsp;<span class="op" id="5777761">=</span>&nbsp;<span class="ident" id="5777763"><a href="/database/sql/sql.go.html#5777662">s</a></span><span class="op" id="5777764">.</span><span class="ident" id="5777765">stickyErr</span><span class="op" id="5777774">;</span>&nbsp;<span class="ident" id="5777776"><a href="/database/sql/sql.go.html#5777740">err</a></span>&nbsp;<span class="op" id="5777780">!=</span>&nbsp;<span class="ident" id="5777783">nil</span>&nbsp;<span class="op" id="5777787">{</span><br>
<span class="lineno">1355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5777791">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5777799">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5777802"><a href="/database/sql/sql.go.html#5777662">s</a></span><span class="op" id="5777803">.</span><span class="ident" id="5777804">mu</span><span class="op" id="5777806">.</span><span class="ident" id="5777807">Lock</span><span class="op" id="5777811">(</span><span class="op" id="5777812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5777815">if</span>&nbsp;<span class="ident" id="5777818"><a href="/database/sql/sql.go.html#5777662">s</a></span><span class="op" id="5777819">.</span><span class="ident" id="5777820">closed</span>&nbsp;<span class="op" id="5777827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5777831"><a href="/database/sql/sql.go.html#5777662">s</a></span><span class="op" id="5777832">.</span><span class="ident" id="5777833">mu</span><span class="op" id="5777835">.</span><span class="ident" id="5777836">Unlock</span><span class="op" id="5777842">(</span><span class="op" id="5777843">)</span><br>
<span class="lineno">1360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5777847"><a href="/database/sql/sql.go.html#5777740">err</a></span>&nbsp;<span class="op" id="5777851">=</span>&nbsp;<span class="ident" id="5777853"><a href="/database/sql/sql.go.html#5743235">errors</a></span><span class="op" id="5777859">.</span><span class="ident" id="5777860">New</span><span class="op" id="5777863">(</span><span class="string" id="5777864">&#34;sql:&nbsp;statement&nbsp;is&nbsp;closed&#34;</span><span class="op" id="5777890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5777894">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5777902">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5777906">//&nbsp;In&nbsp;a&nbsp;transaction,&nbsp;we&nbsp;always&nbsp;use&nbsp;the&nbsp;connection&nbsp;that&nbsp;the</span><br>
<span class="lineno">1365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5777966">//&nbsp;transaction&nbsp;was&nbsp;created&nbsp;on.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5777998">if</span>&nbsp;<span class="ident" id="5778001"><a href="/database/sql/sql.go.html#5777662">s</a></span><span class="op" id="5778002">.</span><span class="ident" id="5778003">tx</span>&nbsp;<span class="op" id="5778006">!=</span>&nbsp;<span class="ident" id="5778009">nil</span>&nbsp;<span class="op" id="5778013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5778017"><a href="/database/sql/sql.go.html#5777662">s</a></span><span class="op" id="5778018">.</span><span class="ident" id="5778019">mu</span><span class="op" id="5778021">.</span><span class="ident" id="5778022">Unlock</span><span class="op" id="5778028">(</span><span class="op" id="5778029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5778033"><a href="/database/sql/sql.go.html#5777683">ci</a></span><span class="op" id="5778035">,</span>&nbsp;<span class="ident" id="5778037"><a href="/database/sql/sql.go.html#5777740">err</a></span>&nbsp;<span class="op" id="5778041">=</span>&nbsp;<span class="ident" id="5778043"><a href="/database/sql/sql.go.html#5777662">s</a></span><span class="op" id="5778044">.</span><span class="ident" id="5778045">tx</span><span class="op" id="5778047">.</span><span class="ident" id="5778048">grabConn</span><span class="op" id="5778056">(</span><span class="op" id="5778057">)</span>&nbsp;<span class="comment" id="5778059">//&nbsp;blocks,&nbsp;waiting&nbsp;for&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5778100">if</span>&nbsp;<span class="ident" id="5778103"><a href="/database/sql/sql.go.html#5777740">err</a></span>&nbsp;<span class="op" id="5778107">!=</span>&nbsp;<span class="ident" id="5778110">nil</span>&nbsp;<span class="op" id="5778114">{</span><br>
<span class="lineno">1370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5778119">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5778128">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5778132"><a href="/database/sql/sql.go.html#5777699">releaseConn</a></span>&nbsp;<span class="op" id="5778144">=</span>&nbsp;<span class="keyword" id="5778146">func</span><span class="op" id="5778150">(</span><span class="builtintype" id="5778151">error</span><span class="op" id="5778156">)</span>&nbsp;<span class="op" id="5778158">{</span><span class="op" id="5778159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5778163">return</span>&nbsp;<span class="ident" id="5778170"><a href="/database/sql/sql.go.html#5777683">ci</a></span><span class="op" id="5778172">,</span>&nbsp;<span class="ident" id="5778174"><a href="/database/sql/sql.go.html#5777699">releaseConn</a></span><span class="op" id="5778185">,</span>&nbsp;<span class="ident" id="5778187"><a href="/database/sql/sql.go.html#5777662">s</a></span><span class="op" id="5778188">.</span><span class="ident" id="5778189">txsi</span><span class="op" id="5778193">.</span><span class="ident" id="5778194">si</span><span class="op" id="5778196">,</span>&nbsp;<span class="ident" id="5778198">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5778203">}</span><br>
<span class="lineno">1375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5778207">for</span>&nbsp;<span class="ident" id="5778211">i</span>&nbsp;<span class="op" id="5778213">:=</span>&nbsp;<span class="num" id="5778216">0</span><span class="op" id="5778217">;</span>&nbsp;<span class="ident" id="5778219"><a href="/database/sql/sql.go.html#5778211">i</a></span>&nbsp;<span class="op" id="5778221">&lt;</span>&nbsp;<span class="builtinfunc" id="5778223">len</span><span class="op" id="5778226">(</span><span class="ident" id="5778227"><a href="/database/sql/sql.go.html#5777662">s</a></span><span class="op" id="5778228">.</span><span class="ident" id="5778229">css</span><span class="op" id="5778232">)</span><span class="op" id="5778233">;</span>&nbsp;<span class="ident" id="5778235"><a href="/database/sql/sql.go.html#5778211">i</a></span><span class="op" id="5778236">++</span>&nbsp;<span class="op" id="5778239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5778243">v</span>&nbsp;<span class="op" id="5778245">:=</span>&nbsp;<span class="ident" id="5778248"><a href="/database/sql/sql.go.html#5777662">s</a></span><span class="op" id="5778249">.</span><span class="ident" id="5778250">css</span><span class="op" id="5778253">[</span><span class="ident" id="5778254"><a href="/database/sql/sql.go.html#5778211">i</a></span><span class="op" id="5778255">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5778259">_</span><span class="op" id="5778260">,</span>&nbsp;<span class="ident" id="5778262">err</span>&nbsp;<span class="op" id="5778266">:=</span>&nbsp;<span class="ident" id="5778269"><a href="/database/sql/sql.go.html#5777662">s</a></span><span class="op" id="5778270">.</span><span class="ident" id="5778271">db</span><span class="op" id="5778273">.</span><span class="ident" id="5778274">connIfFree</span><span class="op" id="5778284">(</span><span class="ident" id="5778285"><a href="/database/sql/sql.go.html#5778243">v</a></span><span class="op" id="5778286">.</span><span class="ident" id="5778287">dc</span><span class="op" id="5778289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5778293">if</span>&nbsp;<span class="ident" id="5778296"><a href="/database/sql/sql.go.html#5778262">err</a></span>&nbsp;<span class="op" id="5778300">==</span>&nbsp;<span class="ident" id="5778303">nil</span>&nbsp;<span class="op" id="5778307">{</span><br>
<span class="lineno">1380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5778312"><a href="/database/sql/sql.go.html#5777662">s</a></span><span class="op" id="5778313">.</span><span class="ident" id="5778314">mu</span><span class="op" id="5778316">.</span><span class="ident" id="5778317">Unlock</span><span class="op" id="5778323">(</span><span class="op" id="5778324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5778329">return</span>&nbsp;<span class="ident" id="5778336"><a href="/database/sql/sql.go.html#5778243">v</a></span><span class="op" id="5778337">.</span><span class="ident" id="5778338">dc</span><span class="op" id="5778340">,</span>&nbsp;<span class="ident" id="5778342"><a href="/database/sql/sql.go.html#5778243">v</a></span><span class="op" id="5778343">.</span><span class="ident" id="5778344">dc</span><span class="op" id="5778346">.</span><span class="ident" id="5778347">releaseConn</span><span class="op" id="5778358">,</span>&nbsp;<span class="ident" id="5778360"><a href="/database/sql/sql.go.html#5778243">v</a></span><span class="op" id="5778361">.</span><span class="ident" id="5778362">si</span><span class="op" id="5778364">,</span>&nbsp;<span class="ident" id="5778366">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5778372">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5778376">if</span>&nbsp;<span class="ident" id="5778379"><a href="/database/sql/sql.go.html#5778262">err</a></span>&nbsp;<span class="op" id="5778383">==</span>&nbsp;<span class="ident" id="5778386"><a href="/database/sql/sql.go.html#5760751">errConnClosed</a></span>&nbsp;<span class="op" id="5778400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5778405">//&nbsp;Lazily&nbsp;remove&nbsp;dead&nbsp;conn&nbsp;from&nbsp;our&nbsp;freelist.</span><br>
<span class="lineno">1385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5778454"><a href="/database/sql/sql.go.html#5777662">s</a></span><span class="op" id="5778455">.</span><span class="ident" id="5778456">css</span><span class="op" id="5778459">[</span><span class="ident" id="5778460"><a href="/database/sql/sql.go.html#5778211">i</a></span><span class="op" id="5778461">]</span>&nbsp;<span class="op" id="5778463">=</span>&nbsp;<span class="ident" id="5778465"><a href="/database/sql/sql.go.html#5777662">s</a></span><span class="op" id="5778466">.</span><span class="ident" id="5778467">css</span><span class="op" id="5778470">[</span><span class="builtinfunc" id="5778471">len</span><span class="op" id="5778474">(</span><span class="ident" id="5778475"><a href="/database/sql/sql.go.html#5777662">s</a></span><span class="op" id="5778476">.</span><span class="ident" id="5778477">css</span><span class="op" id="5778480">)</span><span class="op" id="5778481">-</span><span class="num" id="5778482">1</span><span class="op" id="5778483">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5778488"><a href="/database/sql/sql.go.html#5777662">s</a></span><span class="op" id="5778489">.</span><span class="ident" id="5778490">css</span>&nbsp;<span class="op" id="5778494">=</span>&nbsp;<span class="ident" id="5778496"><a href="/database/sql/sql.go.html#5777662">s</a></span><span class="op" id="5778497">.</span><span class="ident" id="5778498">css</span><span class="op" id="5778501">[</span><span class="op" id="5778502">:</span><span class="builtinfunc" id="5778503">len</span><span class="op" id="5778506">(</span><span class="ident" id="5778507"><a href="/database/sql/sql.go.html#5777662">s</a></span><span class="op" id="5778508">.</span><span class="ident" id="5778509">css</span><span class="op" id="5778512">)</span><span class="op" id="5778513">-</span><span class="num" id="5778514">1</span><span class="op" id="5778515">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5778520"><a href="/database/sql/sql.go.html#5778211">i</a></span><span class="op" id="5778521">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5778526">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5778530">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5778533"><a href="/database/sql/sql.go.html#5777662">s</a></span><span class="op" id="5778534">.</span><span class="ident" id="5778535">mu</span><span class="op" id="5778537">.</span><span class="ident" id="5778538">Unlock</span><span class="op" id="5778544">(</span><span class="op" id="5778545">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5778549">//&nbsp;If&nbsp;all&nbsp;connections&nbsp;are&nbsp;busy,&nbsp;either&nbsp;wait&nbsp;for&nbsp;one&nbsp;to&nbsp;become&nbsp;available&nbsp;(if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5778626">//&nbsp;we&#39;ve&nbsp;already&nbsp;hit&nbsp;the&nbsp;maximum&nbsp;number&nbsp;of&nbsp;open&nbsp;connections)&nbsp;or&nbsp;create&nbsp;a</span><br>
<span class="lineno">1395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5778700">//&nbsp;new&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5778713">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5778717">//&nbsp;TODO(bradfitz):&nbsp;or&nbsp;always&nbsp;wait&nbsp;for&nbsp;one?&nbsp;make&nbsp;configurable&nbsp;later?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5778786">dc</span><span class="op" id="5778788">,</span>&nbsp;<span class="ident" id="5778790"><a href="/database/sql/sql.go.html#5777740">err</a></span>&nbsp;<span class="op" id="5778794">:=</span>&nbsp;<span class="ident" id="5778797"><a href="/database/sql/sql.go.html#5777662">s</a></span><span class="op" id="5778798">.</span><span class="ident" id="5778799">db</span><span class="op" id="5778801">.</span><span class="ident" id="5778802">conn</span><span class="op" id="5778806">(</span><span class="op" id="5778807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5778810">if</span>&nbsp;<span class="ident" id="5778813"><a href="/database/sql/sql.go.html#5777740">err</a></span>&nbsp;<span class="op" id="5778817">!=</span>&nbsp;<span class="ident" id="5778820">nil</span>&nbsp;<span class="op" id="5778824">{</span><br>
<span class="lineno">1400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5778828">return</span>&nbsp;<span class="ident" id="5778835">nil</span><span class="op" id="5778838">,</span>&nbsp;<span class="ident" id="5778840">nil</span><span class="op" id="5778843">,</span>&nbsp;<span class="ident" id="5778845">nil</span><span class="op" id="5778848">,</span>&nbsp;<span class="ident" id="5778850"><a href="/database/sql/sql.go.html#5777740">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5778855">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5778859">//&nbsp;Do&nbsp;another&nbsp;pass&nbsp;over&nbsp;the&nbsp;list&nbsp;to&nbsp;see&nbsp;whether&nbsp;this&nbsp;statement&nbsp;has</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5778927">//&nbsp;already&nbsp;been&nbsp;prepared&nbsp;on&nbsp;the&nbsp;connection&nbsp;assigned&nbsp;to&nbsp;us.</span><br>
<span class="lineno">1405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5778987"><a href="/database/sql/sql.go.html#5777662">s</a></span><span class="op" id="5778988">.</span><span class="ident" id="5778989">mu</span><span class="op" id="5778991">.</span><span class="ident" id="5778992">Lock</span><span class="op" id="5778996">(</span><span class="op" id="5778997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5779000">for</span>&nbsp;<span class="ident" id="5779004">_</span><span class="op" id="5779005">,</span>&nbsp;<span class="ident" id="5779007">v</span>&nbsp;<span class="op" id="5779009">:=</span>&nbsp;<span class="keyword" id="5779012">range</span>&nbsp;<span class="ident" id="5779018"><a href="/database/sql/sql.go.html#5777662">s</a></span><span class="op" id="5779019">.</span><span class="ident" id="5779020">css</span>&nbsp;<span class="op" id="5779024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5779028">if</span>&nbsp;<span class="ident" id="5779031"><a href="/database/sql/sql.go.html#5779007">v</a></span><span class="op" id="5779032">.</span><span class="ident" id="5779033">dc</span>&nbsp;<span class="op" id="5779036">==</span>&nbsp;<span class="ident" id="5779039"><a href="/database/sql/sql.go.html#5778786">dc</a></span>&nbsp;<span class="op" id="5779042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5779047"><a href="/database/sql/sql.go.html#5777662">s</a></span><span class="op" id="5779048">.</span><span class="ident" id="5779049">mu</span><span class="op" id="5779051">.</span><span class="ident" id="5779052">Unlock</span><span class="op" id="5779058">(</span><span class="op" id="5779059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5779064">return</span>&nbsp;<span class="ident" id="5779071"><a href="/database/sql/sql.go.html#5778786">dc</a></span><span class="op" id="5779073">,</span>&nbsp;<span class="ident" id="5779075"><a href="/database/sql/sql.go.html#5778786">dc</a></span><span class="op" id="5779077">.</span><span class="ident" id="5779078">releaseConn</span><span class="op" id="5779089">,</span>&nbsp;<span class="ident" id="5779091"><a href="/database/sql/sql.go.html#5779007">v</a></span><span class="op" id="5779092">.</span><span class="ident" id="5779093">si</span><span class="op" id="5779095">,</span>&nbsp;<span class="ident" id="5779097">nil</span><br>
<span class="lineno">1410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5779103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5779106">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5779109"><a href="/database/sql/sql.go.html#5777662">s</a></span><span class="op" id="5779110">.</span><span class="ident" id="5779111">mu</span><span class="op" id="5779113">.</span><span class="ident" id="5779114">Unlock</span><span class="op" id="5779120">(</span><span class="op" id="5779121">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5779125">//&nbsp;No&nbsp;luck;&nbsp;we&nbsp;need&nbsp;to&nbsp;prepare&nbsp;the&nbsp;statement&nbsp;on&nbsp;this&nbsp;connection</span><br>
<span class="lineno">1415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5779190"><a href="/database/sql/sql.go.html#5778786">dc</a></span><span class="op" id="5779192">.</span><span class="ident" id="5779193">Lock</span><span class="op" id="5779197">(</span><span class="op" id="5779198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5779201"><a href="/database/sql/sql.go.html#5777724">si</a></span><span class="op" id="5779203">,</span>&nbsp;<span class="ident" id="5779205"><a href="/database/sql/sql.go.html#5777740">err</a></span>&nbsp;<span class="op" id="5779209">=</span>&nbsp;<span class="ident" id="5779211"><a href="/database/sql/sql.go.html#5778786">dc</a></span><span class="op" id="5779213">.</span><span class="ident" id="5779214">prepareLocked</span><span class="op" id="5779227">(</span><span class="ident" id="5779228"><a href="/database/sql/sql.go.html#5777662">s</a></span><span class="op" id="5779229">.</span><span class="ident" id="5779230">query</span><span class="op" id="5779235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5779238"><a href="/database/sql/sql.go.html#5778786">dc</a></span><span class="op" id="5779240">.</span><span class="ident" id="5779241">Unlock</span><span class="op" id="5779247">(</span><span class="op" id="5779248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5779251">if</span>&nbsp;<span class="ident" id="5779254"><a href="/database/sql/sql.go.html#5777740">err</a></span>&nbsp;<span class="op" id="5779258">!=</span>&nbsp;<span class="ident" id="5779261">nil</span>&nbsp;<span class="op" id="5779265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5779269"><a href="/database/sql/sql.go.html#5777662">s</a></span><span class="op" id="5779270">.</span><span class="ident" id="5779271">db</span><span class="op" id="5779273">.</span><span class="ident" id="5779274">putConn</span><span class="op" id="5779281">(</span><span class="ident" id="5779282"><a href="/database/sql/sql.go.html#5778786">dc</a></span><span class="op" id="5779284">,</span>&nbsp;<span class="ident" id="5779286"><a href="/database/sql/sql.go.html#5777740">err</a></span><span class="op" id="5779289">)</span><br>
<span class="lineno">1420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5779293">return</span>&nbsp;<span class="ident" id="5779300">nil</span><span class="op" id="5779303">,</span>&nbsp;<span class="ident" id="5779305">nil</span><span class="op" id="5779308">,</span>&nbsp;<span class="ident" id="5779310">nil</span><span class="op" id="5779313">,</span>&nbsp;<span class="ident" id="5779315"><a href="/database/sql/sql.go.html#5777740">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5779320">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5779323"><a href="/database/sql/sql.go.html#5777662">s</a></span><span class="op" id="5779324">.</span><span class="ident" id="5779325">mu</span><span class="op" id="5779327">.</span><span class="ident" id="5779328">Lock</span><span class="op" id="5779332">(</span><span class="op" id="5779333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5779336">cs</span>&nbsp;<span class="op" id="5779339">:=</span>&nbsp;<span class="ident" id="5779342"><a href="/database/sql/sql.go.html#5775452">connStmt</a></span><span class="op" id="5779350">{</span><span class="ident" id="5779351"><a href="/database/sql/sql.go.html#5778786">dc</a></span><span class="op" id="5779353">,</span>&nbsp;<span class="ident" id="5779355"><a href="/database/sql/sql.go.html#5777724">si</a></span><span class="op" id="5779357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5779360"><a href="/database/sql/sql.go.html#5777662">s</a></span><span class="op" id="5779361">.</span><span class="ident" id="5779362">css</span>&nbsp;<span class="op" id="5779366">=</span>&nbsp;<span class="builtinfunc" id="5779368">append</span><span class="op" id="5779374">(</span><span class="ident" id="5779375"><a href="/database/sql/sql.go.html#5777662">s</a></span><span class="op" id="5779376">.</span><span class="ident" id="5779377">css</span><span class="op" id="5779380">,</span>&nbsp;<span class="ident" id="5779382"><a href="/database/sql/sql.go.html#5779336">cs</a></span><span class="op" id="5779384">)</span><br>
<span class="lineno">1425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5779387"><a href="/database/sql/sql.go.html#5777662">s</a></span><span class="op" id="5779388">.</span><span class="ident" id="5779389">mu</span><span class="op" id="5779391">.</span><span class="ident" id="5779392">Unlock</span><span class="op" id="5779398">(</span><span class="op" id="5779399">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5779403">return</span>&nbsp;<span class="ident" id="5779410"><a href="/database/sql/sql.go.html#5778786">dc</a></span><span class="op" id="5779412">,</span>&nbsp;<span class="ident" id="5779414"><a href="/database/sql/sql.go.html#5778786">dc</a></span><span class="op" id="5779416">.</span><span class="ident" id="5779417">releaseConn</span><span class="op" id="5779428">,</span>&nbsp;<span class="ident" id="5779430"><a href="/database/sql/sql.go.html#5777724">si</a></span><span class="op" id="5779432">,</span>&nbsp;<span class="ident" id="5779434">nil</span><br>
<span class="lineno"></span><span class="op" id="5779438">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1430</span><span class="comment" id="5779441">//&nbsp;Query&nbsp;executes&nbsp;a&nbsp;prepared&nbsp;query&nbsp;statement&nbsp;with&nbsp;the&nbsp;given&nbsp;arguments</span><br>
<span class="lineno"></span><span class="comment" id="5779511">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;query&nbsp;results&nbsp;as&nbsp;a&nbsp;*Rows.</span><br>
<span class="lineno"></span><span class="keyword" id="5779556">func</span>&nbsp;<span class="op" id="5779561">(</span><span class="ident" id="5779562">s</span>&nbsp;<span class="op" id="5779564">*</span><span class="ident" id="5779565"><a href="/database/sql/sql.go.html#5775599">Stmt</a></span><span class="op" id="5779569">)</span>&nbsp;<span class="ident" id="5779571">Query</span><span class="op" id="5779576">(</span><span class="ident" id="5779577">args</span>&nbsp;<span class="op" id="5779582">...</span><span class="keyword" id="5779585">interface</span><span class="op" id="5779594">{</span><span class="op" id="5779595">}</span><span class="op" id="5779596">)</span>&nbsp;<span class="op" id="5779598">(</span><span class="op" id="5779599">*</span><span class="ident" id="5779600"><a href="/database/sql/sql.go.html#5782647">Rows</a></span><span class="op" id="5779604">,</span>&nbsp;<span class="builtintype" id="5779606">error</span><span class="op" id="5779611">)</span>&nbsp;<span class="op" id="5779613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5779616"><a href="/database/sql/sql.go.html#5779562">s</a></span><span class="op" id="5779617">.</span><span class="ident" id="5779618">closemu</span><span class="op" id="5779625">.</span><span class="ident" id="5779626">RLock</span><span class="op" id="5779631">(</span><span class="op" id="5779632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5779635">defer</span>&nbsp;<span class="ident" id="5779641"><a href="/database/sql/sql.go.html#5779562">s</a></span><span class="op" id="5779642">.</span><span class="ident" id="5779643">closemu</span><span class="op" id="5779650">.</span><span class="ident" id="5779651">RUnlock</span><span class="op" id="5779658">(</span><span class="op" id="5779659">)</span><br>
<span class="lineno">1435</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5779663">var</span>&nbsp;<span class="ident" id="5779667">rowsi</span>&nbsp;<span class="ident" id="5779673"><a href="/database/sql/sql.go.html#5743212">driver</a></span><span class="op" id="5779679">.</span><span class="ident" id="5779680">Rows</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5779686">for</span>&nbsp;<span class="ident" id="5779690">i</span>&nbsp;<span class="op" id="5779692">:=</span>&nbsp;<span class="num" id="5779695">0</span><span class="op" id="5779696">;</span>&nbsp;<span class="ident" id="5779698"><a href="/database/sql/sql.go.html#5779690">i</a></span>&nbsp;<span class="op" id="5779700">&lt;</span>&nbsp;<span class="ident" id="5779702"><a href="/database/sql/sql.go.html#5764807">maxBadConnRetries</a></span><span class="op" id="5779719">;</span>&nbsp;<span class="ident" id="5779721"><a href="/database/sql/sql.go.html#5779690">i</a></span><span class="op" id="5779722">++</span>&nbsp;<span class="op" id="5779725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5779729">dc</span><span class="op" id="5779731">,</span>&nbsp;<span class="ident" id="5779733">releaseConn</span><span class="op" id="5779744">,</span>&nbsp;<span class="ident" id="5779746">si</span><span class="op" id="5779748">,</span>&nbsp;<span class="ident" id="5779750">err</span>&nbsp;<span class="op" id="5779754">:=</span>&nbsp;<span class="ident" id="5779757"><a href="/database/sql/sql.go.html#5779562">s</a></span><span class="op" id="5779758">.</span><span class="ident" id="5779759">connStmt</span><span class="op" id="5779767">(</span><span class="op" id="5779768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5779772">if</span>&nbsp;<span class="ident" id="5779775"><a href="/database/sql/sql.go.html#5779750">err</a></span>&nbsp;<span class="op" id="5779779">!=</span>&nbsp;<span class="ident" id="5779782">nil</span>&nbsp;<span class="op" id="5779786">{</span><br>
<span class="lineno">1440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5779791">if</span>&nbsp;<span class="ident" id="5779794"><a href="/database/sql/sql.go.html#5779750">err</a></span>&nbsp;<span class="op" id="5779798">==</span>&nbsp;<span class="ident" id="5779801"><a href="/database/sql/sql.go.html#5743212">driver</a></span><span class="op" id="5779807">.</span><span class="ident" id="5779808">ErrBadConn</span>&nbsp;<span class="op" id="5779819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5779825">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5779837">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5779842">return</span>&nbsp;<span class="ident" id="5779849">nil</span><span class="op" id="5779852">,</span>&nbsp;<span class="ident" id="5779854"><a href="/database/sql/sql.go.html#5779750">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5779860">}</span><br>
<span class="lineno">1445</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5779865"><a href="/database/sql/sql.go.html#5779667">rowsi</a></span><span class="op" id="5779870">,</span>&nbsp;<span class="ident" id="5779872"><a href="/database/sql/sql.go.html#5779750">err</a></span>&nbsp;<span class="op" id="5779876">=</span>&nbsp;<span class="ident" id="5779878"><a href="/database/sql/sql.go.html#5780373">rowsiFromStatement</a></span><span class="op" id="5779896">(</span><span class="ident" id="5779897"><a href="/database/sql/sql.go.html#5751783">driverStmt</a></span><span class="op" id="5779907">{</span><span class="ident" id="5779908"><a href="/database/sql/sql.go.html#5779729">dc</a></span><span class="op" id="5779910">,</span>&nbsp;<span class="ident" id="5779912"><a href="/database/sql/sql.go.html#5779746">si</a></span><span class="op" id="5779914">}</span><span class="op" id="5779915">,</span>&nbsp;<span class="ident" id="5779917"><a href="/database/sql/sql.go.html#5779577">args</a></span><span class="op" id="5779921">...</span><span class="op" id="5779924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5779928">if</span>&nbsp;<span class="ident" id="5779931"><a href="/database/sql/sql.go.html#5779750">err</a></span>&nbsp;<span class="op" id="5779935">==</span>&nbsp;<span class="ident" id="5779938">nil</span>&nbsp;<span class="op" id="5779942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5779947">//&nbsp;Note:&nbsp;ownership&nbsp;of&nbsp;ci&nbsp;passes&nbsp;to&nbsp;the&nbsp;*Rows,&nbsp;to&nbsp;be&nbsp;freed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5780008">//&nbsp;with&nbsp;releaseConn.</span><br>
<span class="lineno">1450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5780032">rows</span>&nbsp;<span class="op" id="5780037">:=</span>&nbsp;<span class="op" id="5780040">&amp;</span><span class="ident" id="5780041"><a href="/database/sql/sql.go.html#5782647">Rows</a></span><span class="op" id="5780045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5780051">dc</span><span class="op" id="5780053">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5780058"><a href="/database/sql/sql.go.html#5779729">dc</a></span><span class="op" id="5780060">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5780066">rowsi</span><span class="op" id="5780071">:</span>&nbsp;<span class="ident" id="5780073"><a href="/database/sql/sql.go.html#5779667">rowsi</a></span><span class="op" id="5780078">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5780084">//&nbsp;releaseConn&nbsp;set&nbsp;below</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5780112">}</span><br>
<span class="lineno">1455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5780117"><a href="/database/sql/sql.go.html#5779562">s</a></span><span class="op" id="5780118">.</span><span class="ident" id="5780119">db</span><span class="op" id="5780121">.</span><span class="ident" id="5780122">addDep</span><span class="op" id="5780128">(</span><span class="ident" id="5780129"><a href="/database/sql/sql.go.html#5779562">s</a></span><span class="op" id="5780130">,</span>&nbsp;<span class="ident" id="5780132"><a href="/database/sql/sql.go.html#5780032">rows</a></span><span class="op" id="5780136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5780141"><a href="/database/sql/sql.go.html#5780032">rows</a></span><span class="op" id="5780145">.</span><span class="ident" id="5780146">releaseConn</span>&nbsp;<span class="op" id="5780158">=</span>&nbsp;<span class="keyword" id="5780160">func</span><span class="op" id="5780164">(</span><span class="ident" id="5780165">err</span>&nbsp;<span class="builtintype" id="5780169">error</span><span class="op" id="5780174">)</span>&nbsp;<span class="op" id="5780176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5780182"><a href="/database/sql/sql.go.html#5779733">releaseConn</a></span><span class="op" id="5780193">(</span><span class="ident" id="5780194"><a href="/database/sql/sql.go.html#5780165">err</a></span><span class="op" id="5780197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5780203"><a href="/database/sql/sql.go.html#5779562">s</a></span><span class="op" id="5780204">.</span><span class="ident" id="5780205">db</span><span class="op" id="5780207">.</span><span class="ident" id="5780208">removeDep</span><span class="op" id="5780217">(</span><span class="ident" id="5780218"><a href="/database/sql/sql.go.html#5779562">s</a></span><span class="op" id="5780219">,</span>&nbsp;<span class="ident" id="5780221"><a href="/database/sql/sql.go.html#5780032">rows</a></span><span class="op" id="5780225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5780230">}</span><br>
<span class="lineno">1460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5780235">return</span>&nbsp;<span class="ident" id="5780242"><a href="/database/sql/sql.go.html#5780032">rows</a></span><span class="op" id="5780246">,</span>&nbsp;<span class="ident" id="5780248">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5780254">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5780259"><a href="/database/sql/sql.go.html#5779733">releaseConn</a></span><span class="op" id="5780270">(</span><span class="ident" id="5780271"><a href="/database/sql/sql.go.html#5779750">err</a></span><span class="op" id="5780274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5780278">if</span>&nbsp;<span class="ident" id="5780281"><a href="/database/sql/sql.go.html#5779750">err</a></span>&nbsp;<span class="op" id="5780285">!=</span>&nbsp;<span class="ident" id="5780288"><a href="/database/sql/sql.go.html#5743212">driver</a></span><span class="op" id="5780294">.</span><span class="ident" id="5780295">ErrBadConn</span>&nbsp;<span class="op" id="5780306">{</span><br>
<span class="lineno">1465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5780311">return</span>&nbsp;<span class="ident" id="5780318">nil</span><span class="op" id="5780321">,</span>&nbsp;<span class="ident" id="5780323"><a href="/database/sql/sql.go.html#5779750">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5780329">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5780332">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5780335">return</span>&nbsp;<span class="ident" id="5780342">nil</span><span class="op" id="5780345">,</span>&nbsp;<span class="ident" id="5780347"><a href="/database/sql/sql.go.html#5743212">driver</a></span><span class="op" id="5780353">.</span><span class="ident" id="5780354">ErrBadConn</span><br>
<span class="lineno"></span><span class="op" id="5780365">}</span><br>
<span class="lineno">1470</span><br>
<span class="lineno"></span><span class="keyword" id="5780368">func</span>&nbsp;<span class="ident" id="5780373">rowsiFromStatement</span><span class="op" id="5780391">(</span><span class="ident" id="5780392">ds</span>&nbsp;<span class="ident" id="5780395"><a href="/database/sql/sql.go.html#5751783">driverStmt</a></span><span class="op" id="5780405">,</span>&nbsp;<span class="ident" id="5780407">args</span>&nbsp;<span class="op" id="5780412">...</span><span class="keyword" id="5780415">interface</span><span class="op" id="5780424">{</span><span class="op" id="5780425">}</span><span class="op" id="5780426">)</span>&nbsp;<span class="op" id="5780428">(</span><span class="ident" id="5780429"><a href="/database/sql/sql.go.html#5743212">driver</a></span><span class="op" id="5780435">.</span><span class="ident" id="5780436">Rows</span><span class="op" id="5780440">,</span>&nbsp;<span class="builtintype" id="5780442">error</span><span class="op" id="5780447">)</span>&nbsp;<span class="op" id="5780449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5780452"><a href="/database/sql/sql.go.html#5780392">ds</a></span><span class="op" id="5780454">.</span><span class="ident" id="5780455">Lock</span><span class="op" id="5780459">(</span><span class="op" id="5780460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5780463">want</span>&nbsp;<span class="op" id="5780468">:=</span>&nbsp;<span class="ident" id="5780471"><a href="/database/sql/sql.go.html#5780392">ds</a></span><span class="op" id="5780473">.</span><span class="ident" id="5780474">si</span><span class="op" id="5780476">.</span><span class="ident" id="5780477">NumInput</span><span class="op" id="5780485">(</span><span class="op" id="5780486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5780489"><a href="/database/sql/sql.go.html#5780392">ds</a></span><span class="op" id="5780491">.</span><span class="ident" id="5780492">Unlock</span><span class="op" id="5780498">(</span><span class="op" id="5780499">)</span><br>
<span class="lineno">1475</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5780503">//&nbsp;-1&nbsp;means&nbsp;the&nbsp;driver&nbsp;doesn&#39;t&nbsp;know&nbsp;how&nbsp;to&nbsp;count&nbsp;the&nbsp;number&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5780567">//&nbsp;placeholders,&nbsp;so&nbsp;we&nbsp;won&#39;t&nbsp;sanity&nbsp;check&nbsp;input&nbsp;here&nbsp;and&nbsp;instead&nbsp;let&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5780641">//&nbsp;driver&nbsp;deal&nbsp;with&nbsp;errors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5780670">if</span>&nbsp;<span class="ident" id="5780673"><a href="/database/sql/sql.go.html#5780463">want</a></span>&nbsp;<span class="op" id="5780678">!=</span>&nbsp;<span class="op" id="5780681">-</span><span class="num" id="5780682">1</span>&nbsp;<span class="op" id="5780684">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5780687">len</span><span class="op" id="5780690">(</span><span class="ident" id="5780691"><a href="/database/sql/sql.go.html#5780407">args</a></span><span class="op" id="5780695">)</span>&nbsp;<span class="op" id="5780697">!=</span>&nbsp;<span class="ident" id="5780700"><a href="/database/sql/sql.go.html#5780463">want</a></span>&nbsp;<span class="op" id="5780705">{</span><br>
<span class="lineno">1480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5780709">return</span>&nbsp;<span class="ident" id="5780716">nil</span><span class="op" id="5780719">,</span>&nbsp;<span class="ident" id="5780721"><a href="/database/sql/sql.go.html#5743245">fmt</a></span><span class="op" id="5780724">.</span><span class="ident" id="5780725">Errorf</span><span class="op" id="5780731">(</span><span class="string" id="5780732">&#34;sql:&nbsp;statement&nbsp;expects&nbsp;%d&nbsp;inputs;&nbsp;got&nbsp;%d&#34;</span><span class="op" id="5780774">,</span>&nbsp;<span class="ident" id="5780776"><a href="/database/sql/sql.go.html#5780463">want</a></span><span class="op" id="5780780">,</span>&nbsp;<span class="builtinfunc" id="5780782">len</span><span class="op" id="5780785">(</span><span class="ident" id="5780786"><a href="/database/sql/sql.go.html#5780407">args</a></span><span class="op" id="5780790">)</span><span class="op" id="5780791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5780794">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5780798">dargs</span><span class="op" id="5780803">,</span>&nbsp;<span class="ident" id="5780805">err</span>&nbsp;<span class="op" id="5780809">:=</span>&nbsp;<span class="ident" id="5780812"><a href="/database/sql/convert.go.html#5735966">driverArgs</a></span><span class="op" id="5780822">(</span><span class="op" id="5780823">&amp;</span><span class="ident" id="5780824"><a href="/database/sql/sql.go.html#5780392">ds</a></span><span class="op" id="5780826">,</span>&nbsp;<span class="ident" id="5780828"><a href="/database/sql/sql.go.html#5780407">args</a></span><span class="op" id="5780832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5780835">if</span>&nbsp;<span class="ident" id="5780838"><a href="/database/sql/sql.go.html#5780805">err</a></span>&nbsp;<span class="op" id="5780842">!=</span>&nbsp;<span class="ident" id="5780845">nil</span>&nbsp;<span class="op" id="5780849">{</span><br>
<span class="lineno">1485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5780853">return</span>&nbsp;<span class="ident" id="5780860">nil</span><span class="op" id="5780863">,</span>&nbsp;<span class="ident" id="5780865"><a href="/database/sql/sql.go.html#5780805">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5780870">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5780874"><a href="/database/sql/sql.go.html#5780392">ds</a></span><span class="op" id="5780876">.</span><span class="ident" id="5780877">Lock</span><span class="op" id="5780881">(</span><span class="op" id="5780882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5780885">rowsi</span><span class="op" id="5780890">,</span>&nbsp;<span class="ident" id="5780892"><a href="/database/sql/sql.go.html#5780805">err</a></span>&nbsp;<span class="op" id="5780896">:=</span>&nbsp;<span class="ident" id="5780899"><a href="/database/sql/sql.go.html#5780392">ds</a></span><span class="op" id="5780901">.</span><span class="ident" id="5780902">si</span><span class="op" id="5780904">.</span><span class="ident" id="5780905">Query</span><span class="op" id="5780910">(</span><span class="ident" id="5780911"><a href="/database/sql/sql.go.html#5780798">dargs</a></span><span class="op" id="5780916">)</span><br>
<span class="lineno">1490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5780919"><a href="/database/sql/sql.go.html#5780392">ds</a></span><span class="op" id="5780921">.</span><span class="ident" id="5780922">Unlock</span><span class="op" id="5780928">(</span><span class="op" id="5780929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5780932">if</span>&nbsp;<span class="ident" id="5780935"><a href="/database/sql/sql.go.html#5780805">err</a></span>&nbsp;<span class="op" id="5780939">!=</span>&nbsp;<span class="ident" id="5780942">nil</span>&nbsp;<span class="op" id="5780946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5780950">return</span>&nbsp;<span class="ident" id="5780957">nil</span><span class="op" id="5780960">,</span>&nbsp;<span class="ident" id="5780962"><a href="/database/sql/sql.go.html#5780805">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5780967">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5780970">return</span>&nbsp;<span class="ident" id="5780977"><a href="/database/sql/sql.go.html#5780885">rowsi</a></span><span class="op" id="5780982">,</span>&nbsp;<span class="ident" id="5780984">nil</span><br>
<span class="lineno">1495</span><span class="op" id="5780988">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5780991">//&nbsp;QueryRow&nbsp;executes&nbsp;a&nbsp;prepared&nbsp;query&nbsp;statement&nbsp;with&nbsp;the&nbsp;given&nbsp;arguments.</span><br>
<span class="lineno"></span><span class="comment" id="5781065">//&nbsp;If&nbsp;an&nbsp;error&nbsp;occurs&nbsp;during&nbsp;the&nbsp;execution&nbsp;of&nbsp;the&nbsp;statement,&nbsp;that&nbsp;error&nbsp;will</span><br>
<span class="lineno"></span><span class="comment" id="5781142">//&nbsp;be&nbsp;returned&nbsp;by&nbsp;a&nbsp;call&nbsp;to&nbsp;Scan&nbsp;on&nbsp;the&nbsp;returned&nbsp;*Row,&nbsp;which&nbsp;is&nbsp;always&nbsp;non-nil.</span><br>
<span class="lineno">1500</span><span class="comment" id="5781222">//&nbsp;If&nbsp;the&nbsp;query&nbsp;selects&nbsp;no&nbsp;rows,&nbsp;the&nbsp;*Row&#39;s&nbsp;Scan&nbsp;will&nbsp;return&nbsp;ErrNoRows.</span><br>
<span class="lineno"></span><span class="comment" id="5781294">//&nbsp;Otherwise,&nbsp;the&nbsp;*Row&#39;s&nbsp;Scan&nbsp;scans&nbsp;the&nbsp;first&nbsp;selected&nbsp;row&nbsp;and&nbsp;discards</span><br>
<span class="lineno"></span><span class="comment" id="5781366">//&nbsp;the&nbsp;rest.</span><br>
<span class="lineno"></span><span class="comment" id="5781379">//</span><br>
<span class="lineno"></span><span class="comment" id="5781382">//&nbsp;Example&nbsp;usage:</span><br>
<span class="lineno">1505</span><span class="comment" id="5781400">//</span><br>
<span class="lineno"></span><span class="comment" id="5781403">//&nbsp;&nbsp;var&nbsp;name&nbsp;string</span><br>
<span class="lineno"></span><span class="comment" id="5781423">//&nbsp;&nbsp;err&nbsp;:=&nbsp;nameByUseridStmt.QueryRow(id).Scan(&amp;name)</span><br>
<span class="lineno"></span><span class="keyword" id="5781476">func</span>&nbsp;<span class="op" id="5781481">(</span><span class="ident" id="5781482">s</span>&nbsp;<span class="op" id="5781484">*</span><span class="ident" id="5781485"><a href="/database/sql/sql.go.html#5775599">Stmt</a></span><span class="op" id="5781489">)</span>&nbsp;<span class="ident" id="5781491">QueryRow</span><span class="op" id="5781499">(</span><span class="ident" id="5781500">args</span>&nbsp;<span class="op" id="5781505">...</span><span class="keyword" id="5781508">interface</span><span class="op" id="5781517">{</span><span class="op" id="5781518">}</span><span class="op" id="5781519">)</span>&nbsp;<span class="op" id="5781521">*</span><span class="ident" id="5781522"><a href="/database/sql/sql.go.html#5785899">Row</a></span>&nbsp;<span class="op" id="5781526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5781529">rows</span><span class="op" id="5781533">,</span>&nbsp;<span class="ident" id="5781535">err</span>&nbsp;<span class="op" id="5781539">:=</span>&nbsp;<span class="ident" id="5781542"><a href="/database/sql/sql.go.html#5781482">s</a></span><span class="op" id="5781543">.</span><span class="ident" id="5781544">Query</span><span class="op" id="5781549">(</span><span class="ident" id="5781550"><a href="/database/sql/sql.go.html#5781500">args</a></span><span class="op" id="5781554">...</span><span class="op" id="5781557">)</span><br>
<span class="lineno">1510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5781560">if</span>&nbsp;<span class="ident" id="5781563"><a href="/database/sql/sql.go.html#5781535">err</a></span>&nbsp;<span class="op" id="5781567">!=</span>&nbsp;<span class="ident" id="5781570">nil</span>&nbsp;<span class="op" id="5781574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5781578">return</span>&nbsp;<span class="op" id="5781585">&amp;</span><span class="ident" id="5781586"><a href="/database/sql/sql.go.html#5785899">Row</a></span><span class="op" id="5781589">{</span><span class="ident" id="5781590">err</span><span class="op" id="5781593">:</span>&nbsp;<span class="ident" id="5781595"><a href="/database/sql/sql.go.html#5781535">err</a></span><span class="op" id="5781598">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5781601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5781604">return</span>&nbsp;<span class="op" id="5781611">&amp;</span><span class="ident" id="5781612"><a href="/database/sql/sql.go.html#5785899">Row</a></span><span class="op" id="5781615">{</span><span class="ident" id="5781616">rows</span><span class="op" id="5781620">:</span>&nbsp;<span class="ident" id="5781622"><a href="/database/sql/sql.go.html#5781529">rows</a></span><span class="op" id="5781626">}</span><br>
<span class="lineno"></span><span class="op" id="5781628">}</span><br>
<span class="lineno">1515</span><br>
<span class="lineno"></span><span class="comment" id="5781631">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;statement.</span><br>
<span class="lineno"></span><span class="keyword" id="5781662">func</span>&nbsp;<span class="op" id="5781667">(</span><span class="ident" id="5781668">s</span>&nbsp;<span class="op" id="5781670">*</span><span class="ident" id="5781671"><a href="/database/sql/sql.go.html#5775599">Stmt</a></span><span class="op" id="5781675">)</span>&nbsp;<span class="ident" id="5781677">Close</span><span class="op" id="5781682">(</span><span class="op" id="5781683">)</span>&nbsp;<span class="builtintype" id="5781685">error</span>&nbsp;<span class="op" id="5781691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5781694"><a href="/database/sql/sql.go.html#5781668">s</a></span><span class="op" id="5781695">.</span><span class="ident" id="5781696">closemu</span><span class="op" id="5781703">.</span><span class="ident" id="5781704">Lock</span><span class="op" id="5781708">(</span><span class="op" id="5781709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5781712">defer</span>&nbsp;<span class="ident" id="5781718"><a href="/database/sql/sql.go.html#5781668">s</a></span><span class="op" id="5781719">.</span><span class="ident" id="5781720">closemu</span><span class="op" id="5781727">.</span><span class="ident" id="5781728">Unlock</span><span class="op" id="5781734">(</span><span class="op" id="5781735">)</span><br>
<span class="lineno">1520</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5781739">if</span>&nbsp;<span class="ident" id="5781742"><a href="/database/sql/sql.go.html#5781668">s</a></span><span class="op" id="5781743">.</span><span class="ident" id="5781744">stickyErr</span>&nbsp;<span class="op" id="5781754">!=</span>&nbsp;<span class="ident" id="5781757">nil</span>&nbsp;<span class="op" id="5781761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5781765">return</span>&nbsp;<span class="ident" id="5781772"><a href="/database/sql/sql.go.html#5781668">s</a></span><span class="op" id="5781773">.</span><span class="ident" id="5781774">stickyErr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5781785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5781788"><a href="/database/sql/sql.go.html#5781668">s</a></span><span class="op" id="5781789">.</span><span class="ident" id="5781790">mu</span><span class="op" id="5781792">.</span><span class="ident" id="5781793">Lock</span><span class="op" id="5781797">(</span><span class="op" id="5781798">)</span><br>
<span class="lineno">1525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5781801">if</span>&nbsp;<span class="ident" id="5781804"><a href="/database/sql/sql.go.html#5781668">s</a></span><span class="op" id="5781805">.</span><span class="ident" id="5781806">closed</span>&nbsp;<span class="op" id="5781813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5781817"><a href="/database/sql/sql.go.html#5781668">s</a></span><span class="op" id="5781818">.</span><span class="ident" id="5781819">mu</span><span class="op" id="5781821">.</span><span class="ident" id="5781822">Unlock</span><span class="op" id="5781828">(</span><span class="op" id="5781829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5781833">return</span>&nbsp;<span class="ident" id="5781840">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5781845">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5781848"><a href="/database/sql/sql.go.html#5781668">s</a></span><span class="op" id="5781849">.</span><span class="ident" id="5781850">closed</span>&nbsp;<span class="op" id="5781857">=</span>&nbsp;<span class="ident" id="5781859">true</span><br>
<span class="lineno">1530</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5781866">if</span>&nbsp;<span class="ident" id="5781869"><a href="/database/sql/sql.go.html#5781668">s</a></span><span class="op" id="5781870">.</span><span class="ident" id="5781871">tx</span>&nbsp;<span class="op" id="5781874">!=</span>&nbsp;<span class="ident" id="5781877">nil</span>&nbsp;<span class="op" id="5781881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5781885"><a href="/database/sql/sql.go.html#5781668">s</a></span><span class="op" id="5781886">.</span><span class="ident" id="5781887">txsi</span><span class="op" id="5781891">.</span><span class="ident" id="5781892">Close</span><span class="op" id="5781897">(</span><span class="op" id="5781898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5781902"><a href="/database/sql/sql.go.html#5781668">s</a></span><span class="op" id="5781903">.</span><span class="ident" id="5781904">mu</span><span class="op" id="5781906">.</span><span class="ident" id="5781907">Unlock</span><span class="op" id="5781913">(</span><span class="op" id="5781914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5781918">return</span>&nbsp;<span class="ident" id="5781925">nil</span><br>
<span class="lineno">1535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5781930">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5781933"><a href="/database/sql/sql.go.html#5781668">s</a></span><span class="op" id="5781934">.</span><span class="ident" id="5781935">mu</span><span class="op" id="5781937">.</span><span class="ident" id="5781938">Unlock</span><span class="op" id="5781944">(</span><span class="op" id="5781945">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5781949">return</span>&nbsp;<span class="ident" id="5781956"><a href="/database/sql/sql.go.html#5781668">s</a></span><span class="op" id="5781957">.</span><span class="ident" id="5781958">db</span><span class="op" id="5781960">.</span><span class="ident" id="5781961">removeDep</span><span class="op" id="5781970">(</span><span class="ident" id="5781971"><a href="/database/sql/sql.go.html#5781668">s</a></span><span class="op" id="5781972">,</span>&nbsp;<span class="ident" id="5781974"><a href="/database/sql/sql.go.html#5781668">s</a></span><span class="op" id="5781975">)</span><br>
<span class="lineno"></span><span class="op" id="5781977">}</span><br>
<span class="lineno">1540</span><br>
<span class="lineno"></span><span class="keyword" id="5781980">func</span>&nbsp;<span class="op" id="5781985">(</span><span class="ident" id="5781986">s</span>&nbsp;<span class="op" id="5781988">*</span><span class="ident" id="5781989"><a href="/database/sql/sql.go.html#5775599">Stmt</a></span><span class="op" id="5781993">)</span>&nbsp;<span class="ident" id="5781995">finalClose</span><span class="op" id="5782005">(</span><span class="op" id="5782006">)</span>&nbsp;<span class="builtintype" id="5782008">error</span>&nbsp;<span class="op" id="5782014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5782017"><a href="/database/sql/sql.go.html#5781986">s</a></span><span class="op" id="5782018">.</span><span class="ident" id="5782019">mu</span><span class="op" id="5782021">.</span><span class="ident" id="5782022">Lock</span><span class="op" id="5782026">(</span><span class="op" id="5782027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5782030">defer</span>&nbsp;<span class="ident" id="5782036"><a href="/database/sql/sql.go.html#5781986">s</a></span><span class="op" id="5782037">.</span><span class="ident" id="5782038">mu</span><span class="op" id="5782040">.</span><span class="ident" id="5782041">Unlock</span><span class="op" id="5782047">(</span><span class="op" id="5782048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5782051">if</span>&nbsp;<span class="ident" id="5782054"><a href="/database/sql/sql.go.html#5781986">s</a></span><span class="op" id="5782055">.</span><span class="ident" id="5782056">css</span>&nbsp;<span class="op" id="5782060">!=</span>&nbsp;<span class="ident" id="5782063">nil</span>&nbsp;<span class="op" id="5782067">{</span><br>
<span class="lineno">1545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5782071">for</span>&nbsp;<span class="ident" id="5782075">_</span><span class="op" id="5782076">,</span>&nbsp;<span class="ident" id="5782078">v</span>&nbsp;<span class="op" id="5782080">:=</span>&nbsp;<span class="keyword" id="5782083">range</span>&nbsp;<span class="ident" id="5782089"><a href="/database/sql/sql.go.html#5781986">s</a></span><span class="op" id="5782090">.</span><span class="ident" id="5782091">css</span>&nbsp;<span class="op" id="5782095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5782100"><a href="/database/sql/sql.go.html#5781986">s</a></span><span class="op" id="5782101">.</span><span class="ident" id="5782102">db</span><span class="op" id="5782104">.</span><span class="ident" id="5782105">noteUnusedDriverStatement</span><span class="op" id="5782130">(</span><span class="ident" id="5782131"><a href="/database/sql/sql.go.html#5782078">v</a></span><span class="op" id="5782132">.</span><span class="ident" id="5782133">dc</span><span class="op" id="5782135">,</span>&nbsp;<span class="ident" id="5782137"><a href="/database/sql/sql.go.html#5782078">v</a></span><span class="op" id="5782138">.</span><span class="ident" id="5782139">si</span><span class="op" id="5782141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5782146"><a href="/database/sql/sql.go.html#5782078">v</a></span><span class="op" id="5782147">.</span><span class="ident" id="5782148">dc</span><span class="op" id="5782150">.</span><span class="ident" id="5782151">removeOpenStmt</span><span class="op" id="5782165">(</span><span class="ident" id="5782166"><a href="/database/sql/sql.go.html#5782078">v</a></span><span class="op" id="5782167">.</span><span class="ident" id="5782168">si</span><span class="op" id="5782170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5782174">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5782178"><a href="/database/sql/sql.go.html#5781986">s</a></span><span class="op" id="5782179">.</span><span class="ident" id="5782180">css</span>&nbsp;<span class="op" id="5782184">=</span>&nbsp;<span class="ident" id="5782186">nil</span><br>
<span class="lineno">1550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5782191">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5782194">return</span>&nbsp;<span class="ident" id="5782201">nil</span><br>
<span class="lineno"></span><span class="op" id="5782205">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5782208">//&nbsp;Rows&nbsp;is&nbsp;the&nbsp;result&nbsp;of&nbsp;a&nbsp;query.&nbsp;Its&nbsp;cursor&nbsp;starts&nbsp;before&nbsp;the&nbsp;first&nbsp;row</span><br>
<span class="lineno">1555</span><span class="comment" id="5782281">//&nbsp;of&nbsp;the&nbsp;result&nbsp;set.&nbsp;Use&nbsp;Next&nbsp;to&nbsp;advance&nbsp;through&nbsp;the&nbsp;rows:</span><br>
<span class="lineno"></span><span class="comment" id="5782341">//</span><br>
<span class="lineno"></span><span class="comment" id="5782344">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rows,&nbsp;err&nbsp;:=&nbsp;db.Query(&#34;SELECT&nbsp;...&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="5782387">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...</span><br>
<span class="lineno"></span><span class="comment" id="5782398">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;defer&nbsp;rows.Close()</span><br>
<span class="lineno">1560</span><span class="comment" id="5782424">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;rows.Next()&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="5782449">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;id&nbsp;int</span><br>
<span class="lineno"></span><span class="comment" id="5782471">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;name&nbsp;string</span><br>
<span class="lineno"></span><span class="comment" id="5782498">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;err&nbsp;=&nbsp;rows.Scan(&amp;id,&nbsp;&amp;name)</span><br>
<span class="lineno"></span><span class="comment" id="5782537">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...</span><br>
<span class="lineno">1565</span><span class="comment" id="5782552">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="5782561">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;err&nbsp;=&nbsp;rows.Err()&nbsp;//&nbsp;get&nbsp;any&nbsp;error&nbsp;encountered&nbsp;during&nbsp;iteration</span><br>
<span class="lineno"></span><span class="comment" id="5782631">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...</span><br>
<span class="lineno"></span><span class="keyword" id="5782642">type</span>&nbsp;<span class="ident" id="5782647">Rows</span>&nbsp;<span class="keyword" id="5782652">struct</span>&nbsp;<span class="op" id="5782659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5782662">dc</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5782674">*</span><span class="ident" id="5782675"><a href="/database/sql/sql.go.html#5749298">driverConn</a></span>&nbsp;<span class="comment" id="5782686">//&nbsp;owned;&nbsp;must&nbsp;call&nbsp;releaseConn&nbsp;when&nbsp;closed&nbsp;to&nbsp;release</span><br>
<span class="lineno">1570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5782742">releaseConn</span>&nbsp;<span class="keyword" id="5782754">func</span><span class="op" id="5782758">(</span><span class="builtintype" id="5782759">error</span><span class="op" id="5782764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5782767">rowsi</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5782779"><a href="/database/sql/sql.go.html#5743212">driver</a></span><span class="op" id="5782785">.</span><span class="ident" id="5782786">Rows</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5782793">closed</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5782803">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5782809">lastcols</span>&nbsp;&nbsp;<span class="op" id="5782819">[</span><span class="op" id="5782820">]</span><span class="ident" id="5782821"><a href="/database/sql/sql.go.html#5743212">driver</a></span><span class="op" id="5782827">.</span><span class="ident" id="5782828">Value</span><br>
<span class="lineno">1575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5782835">lasterr</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5782845">error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5782857">//&nbsp;non-nil&nbsp;only&nbsp;if&nbsp;closed&nbsp;is&nbsp;true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5782892">closeStmt</span>&nbsp;<span class="ident" id="5782902"><a href="/database/sql/sql.go.html#5743212">driver</a></span><span class="op" id="5782908">.</span><span class="ident" id="5782909">Stmt</span>&nbsp;<span class="comment" id="5782914">//&nbsp;if&nbsp;non-nil,&nbsp;statement&nbsp;to&nbsp;Close&nbsp;on&nbsp;close</span><br>
<span class="lineno"></span><span class="op" id="5782957">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5782960">//&nbsp;Next&nbsp;prepares&nbsp;the&nbsp;next&nbsp;result&nbsp;row&nbsp;for&nbsp;reading&nbsp;with&nbsp;the&nbsp;Scan&nbsp;method.&nbsp;&nbsp;It</span><br>
<span class="lineno">1580</span><span class="comment" id="5783035">//&nbsp;returns&nbsp;true&nbsp;on&nbsp;success,&nbsp;or&nbsp;false&nbsp;if&nbsp;there&nbsp;is&nbsp;no&nbsp;next&nbsp;result&nbsp;row&nbsp;or&nbsp;an&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="5783115">//&nbsp;happened&nbsp;while&nbsp;preparing&nbsp;it.&nbsp;&nbsp;Err&nbsp;should&nbsp;be&nbsp;consulted&nbsp;to&nbsp;distinguish&nbsp;between</span><br>
<span class="lineno"></span><span class="comment" id="5783195">//&nbsp;the&nbsp;two&nbsp;cases.</span><br>
<span class="lineno"></span><span class="comment" id="5783213">//</span><br>
<span class="lineno"></span><span class="comment" id="5783216">//&nbsp;Every&nbsp;call&nbsp;to&nbsp;Scan,&nbsp;even&nbsp;the&nbsp;first&nbsp;one,&nbsp;must&nbsp;be&nbsp;preceded&nbsp;by&nbsp;a&nbsp;call&nbsp;to&nbsp;Next.</span><br>
<span class="lineno">1585</span><span class="keyword" id="5783295">func</span>&nbsp;<span class="op" id="5783300">(</span><span class="ident" id="5783301">rs</span>&nbsp;<span class="op" id="5783304">*</span><span class="ident" id="5783305"><a href="/database/sql/sql.go.html#5782647">Rows</a></span><span class="op" id="5783309">)</span>&nbsp;<span class="ident" id="5783311">Next</span><span class="op" id="5783315">(</span><span class="op" id="5783316">)</span>&nbsp;<span class="builtintype" id="5783318">bool</span>&nbsp;<span class="op" id="5783323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5783326">if</span>&nbsp;<span class="ident" id="5783329"><a href="/database/sql/sql.go.html#5783301">rs</a></span><span class="op" id="5783331">.</span><span class="ident" id="5783332">closed</span>&nbsp;<span class="op" id="5783339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5783343">return</span>&nbsp;<span class="ident" id="5783350">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5783357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5783360">if</span>&nbsp;<span class="ident" id="5783363"><a href="/database/sql/sql.go.html#5783301">rs</a></span><span class="op" id="5783365">.</span><span class="ident" id="5783366">lastcols</span>&nbsp;<span class="op" id="5783375">==</span>&nbsp;<span class="ident" id="5783378">nil</span>&nbsp;<span class="op" id="5783382">{</span><br>
<span class="lineno">1590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5783386"><a href="/database/sql/sql.go.html#5783301">rs</a></span><span class="op" id="5783388">.</span><span class="ident" id="5783389">lastcols</span>&nbsp;<span class="op" id="5783398">=</span>&nbsp;<span class="builtinfunc" id="5783400">make</span><span class="op" id="5783404">(</span><span class="op" id="5783405">[</span><span class="op" id="5783406">]</span><span class="ident" id="5783407"><a href="/database/sql/sql.go.html#5743212">driver</a></span><span class="op" id="5783413">.</span><span class="ident" id="5783414">Value</span><span class="op" id="5783419">,</span>&nbsp;<span class="builtinfunc" id="5783421">len</span><span class="op" id="5783424">(</span><span class="ident" id="5783425"><a href="/database/sql/sql.go.html#5783301">rs</a></span><span class="op" id="5783427">.</span><span class="ident" id="5783428">rowsi</span><span class="op" id="5783433">.</span><span class="ident" id="5783434">Columns</span><span class="op" id="5783441">(</span><span class="op" id="5783442">)</span><span class="op" id="5783443">)</span><span class="op" id="5783444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5783447">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5783450"><a href="/database/sql/sql.go.html#5783301">rs</a></span><span class="op" id="5783452">.</span><span class="ident" id="5783453">lasterr</span>&nbsp;<span class="op" id="5783461">=</span>&nbsp;<span class="ident" id="5783463"><a href="/database/sql/sql.go.html#5783301">rs</a></span><span class="op" id="5783465">.</span><span class="ident" id="5783466">rowsi</span><span class="op" id="5783471">.</span><span class="ident" id="5783472">Next</span><span class="op" id="5783476">(</span><span class="ident" id="5783477"><a href="/database/sql/sql.go.html#5783301">rs</a></span><span class="op" id="5783479">.</span><span class="ident" id="5783480">lastcols</span><span class="op" id="5783488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5783491">if</span>&nbsp;<span class="ident" id="5783494"><a href="/database/sql/sql.go.html#5783301">rs</a></span><span class="op" id="5783496">.</span><span class="ident" id="5783497">lasterr</span>&nbsp;<span class="op" id="5783505">!=</span>&nbsp;<span class="ident" id="5783508">nil</span>&nbsp;<span class="op" id="5783512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5783516"><a href="/database/sql/sql.go.html#5783301">rs</a></span><span class="op" id="5783518">.</span><span class="ident" id="5783519">Close</span><span class="op" id="5783524">(</span><span class="op" id="5783525">)</span><br>
<span class="lineno">1595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5783529">return</span>&nbsp;<span class="ident" id="5783536">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5783543">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5783546">return</span>&nbsp;<span class="ident" id="5783553">true</span><br>
<span class="lineno"></span><span class="op" id="5783558">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1600</span><span class="comment" id="5783561">//&nbsp;Err&nbsp;returns&nbsp;the&nbsp;error,&nbsp;if&nbsp;any,&nbsp;that&nbsp;was&nbsp;encountered&nbsp;during&nbsp;iteration.</span><br>
<span class="lineno"></span><span class="comment" id="5783634">//&nbsp;Err&nbsp;may&nbsp;be&nbsp;called&nbsp;after&nbsp;an&nbsp;explicit&nbsp;or&nbsp;implicit&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="5783692">func</span>&nbsp;<span class="op" id="5783697">(</span><span class="ident" id="5783698">rs</span>&nbsp;<span class="op" id="5783701">*</span><span class="ident" id="5783702"><a href="/database/sql/sql.go.html#5782647">Rows</a></span><span class="op" id="5783706">)</span>&nbsp;<span class="ident" id="5783708">Err</span><span class="op" id="5783711">(</span><span class="op" id="5783712">)</span>&nbsp;<span class="builtintype" id="5783714">error</span>&nbsp;<span class="op" id="5783720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5783723">if</span>&nbsp;<span class="ident" id="5783726"><a href="/database/sql/sql.go.html#5783698">rs</a></span><span class="op" id="5783728">.</span><span class="ident" id="5783729">lasterr</span>&nbsp;<span class="op" id="5783737">==</span>&nbsp;<span class="ident" id="5783740"><a href="/database/sql/sql.go.html#5743252">io</a></span><span class="op" id="5783742">.</span><span class="ident" id="5783743">EOF</span>&nbsp;<span class="op" id="5783747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5783751">return</span>&nbsp;<span class="ident" id="5783758">nil</span><br>
<span class="lineno">1605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5783763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5783766">return</span>&nbsp;<span class="ident" id="5783773"><a href="/database/sql/sql.go.html#5783698">rs</a></span><span class="op" id="5783775">.</span><span class="ident" id="5783776">lasterr</span><br>
<span class="lineno"></span><span class="op" id="5783784">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5783787">//&nbsp;Columns&nbsp;returns&nbsp;the&nbsp;column&nbsp;names.</span><br>
<span class="lineno">1610</span><span class="comment" id="5783824">//&nbsp;Columns&nbsp;returns&nbsp;an&nbsp;error&nbsp;if&nbsp;the&nbsp;rows&nbsp;are&nbsp;closed,&nbsp;or&nbsp;if&nbsp;the&nbsp;rows</span><br>
<span class="lineno"></span><span class="comment" id="5783891">//&nbsp;are&nbsp;from&nbsp;QueryRow&nbsp;and&nbsp;there&nbsp;was&nbsp;a&nbsp;deferred&nbsp;error.</span><br>
<span class="lineno"></span><span class="keyword" id="5783944">func</span>&nbsp;<span class="op" id="5783949">(</span><span class="ident" id="5783950">rs</span>&nbsp;<span class="op" id="5783953">*</span><span class="ident" id="5783954"><a href="/database/sql/sql.go.html#5782647">Rows</a></span><span class="op" id="5783958">)</span>&nbsp;<span class="ident" id="5783960">Columns</span><span class="op" id="5783967">(</span><span class="op" id="5783968">)</span>&nbsp;<span class="op" id="5783970">(</span><span class="op" id="5783971">[</span><span class="op" id="5783972">]</span><span class="builtintype" id="5783973">string</span><span class="op" id="5783979">,</span>&nbsp;<span class="builtintype" id="5783981">error</span><span class="op" id="5783986">)</span>&nbsp;<span class="op" id="5783988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5783991">if</span>&nbsp;<span class="ident" id="5783994"><a href="/database/sql/sql.go.html#5783950">rs</a></span><span class="op" id="5783996">.</span><span class="ident" id="5783997">closed</span>&nbsp;<span class="op" id="5784004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5784008">return</span>&nbsp;<span class="ident" id="5784015">nil</span><span class="op" id="5784018">,</span>&nbsp;<span class="ident" id="5784020"><a href="/database/sql/sql.go.html#5743235">errors</a></span><span class="op" id="5784026">.</span><span class="ident" id="5784027">New</span><span class="op" id="5784030">(</span><span class="string" id="5784031">&#34;sql:&nbsp;Rows&nbsp;are&nbsp;closed&#34;</span><span class="op" id="5784053">)</span><br>
<span class="lineno">1615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5784056">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5784059">if</span>&nbsp;<span class="ident" id="5784062"><a href="/database/sql/sql.go.html#5783950">rs</a></span><span class="op" id="5784064">.</span><span class="ident" id="5784065">rowsi</span>&nbsp;<span class="op" id="5784071">==</span>&nbsp;<span class="ident" id="5784074">nil</span>&nbsp;<span class="op" id="5784078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5784082">return</span>&nbsp;<span class="ident" id="5784089">nil</span><span class="op" id="5784092">,</span>&nbsp;<span class="ident" id="5784094"><a href="/database/sql/sql.go.html#5743235">errors</a></span><span class="op" id="5784100">.</span><span class="ident" id="5784101">New</span><span class="op" id="5784104">(</span><span class="string" id="5784105">&#34;sql:&nbsp;no&nbsp;Rows&nbsp;available&#34;</span><span class="op" id="5784129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5784132">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5784135">return</span>&nbsp;<span class="ident" id="5784142"><a href="/database/sql/sql.go.html#5783950">rs</a></span><span class="op" id="5784144">.</span><span class="ident" id="5784145">rowsi</span><span class="op" id="5784150">.</span><span class="ident" id="5784151">Columns</span><span class="op" id="5784158">(</span><span class="op" id="5784159">)</span><span class="op" id="5784160">,</span>&nbsp;<span class="ident" id="5784162">nil</span><br>
<span class="lineno">1620</span><span class="op" id="5784166">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5784169">//&nbsp;Scan&nbsp;copies&nbsp;the&nbsp;columns&nbsp;in&nbsp;the&nbsp;current&nbsp;row&nbsp;into&nbsp;the&nbsp;values&nbsp;pointed</span><br>
<span class="lineno"></span><span class="comment" id="5784239">//&nbsp;at&nbsp;by&nbsp;dest.</span><br>
<span class="lineno"></span><span class="comment" id="5784254">//</span><br>
<span class="lineno">1625</span><span class="comment" id="5784257">//&nbsp;If&nbsp;an&nbsp;argument&nbsp;has&nbsp;type&nbsp;*[]byte,&nbsp;Scan&nbsp;saves&nbsp;in&nbsp;that&nbsp;argument&nbsp;a&nbsp;copy</span><br>
<span class="lineno"></span><span class="comment" id="5784328">//&nbsp;of&nbsp;the&nbsp;corresponding&nbsp;data.&nbsp;The&nbsp;copy&nbsp;is&nbsp;owned&nbsp;by&nbsp;the&nbsp;caller&nbsp;and&nbsp;can</span><br>
<span class="lineno"></span><span class="comment" id="5784398">//&nbsp;be&nbsp;modified&nbsp;and&nbsp;held&nbsp;indefinitely.&nbsp;The&nbsp;copy&nbsp;can&nbsp;be&nbsp;avoided&nbsp;by&nbsp;using</span><br>
<span class="lineno"></span><span class="comment" id="5784469">//&nbsp;an&nbsp;argument&nbsp;of&nbsp;type&nbsp;*RawBytes&nbsp;instead;&nbsp;see&nbsp;the&nbsp;documentation&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="5784537">//&nbsp;RawBytes&nbsp;for&nbsp;restrictions&nbsp;on&nbsp;its&nbsp;use.</span><br>
<span class="lineno">1630</span><span class="comment" id="5784578">//</span><br>
<span class="lineno"></span><span class="comment" id="5784581">//&nbsp;If&nbsp;an&nbsp;argument&nbsp;has&nbsp;type&nbsp;*interface{},&nbsp;Scan&nbsp;copies&nbsp;the&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="5784644">//&nbsp;provided&nbsp;by&nbsp;the&nbsp;underlying&nbsp;driver&nbsp;without&nbsp;conversion.&nbsp;If&nbsp;the&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="5784714">//&nbsp;is&nbsp;of&nbsp;type&nbsp;[]byte,&nbsp;a&nbsp;copy&nbsp;is&nbsp;made&nbsp;and&nbsp;the&nbsp;caller&nbsp;owns&nbsp;the&nbsp;result.</span><br>
<span class="lineno"></span><span class="keyword" id="5784783">func</span>&nbsp;<span class="op" id="5784788">(</span><span class="ident" id="5784789">rs</span>&nbsp;<span class="op" id="5784792">*</span><span class="ident" id="5784793"><a href="/database/sql/sql.go.html#5782647">Rows</a></span><span class="op" id="5784797">)</span>&nbsp;<span class="ident" id="5784799">Scan</span><span class="op" id="5784803">(</span><span class="ident" id="5784804">dest</span>&nbsp;<span class="op" id="5784809">...</span><span class="keyword" id="5784812">interface</span><span class="op" id="5784821">{</span><span class="op" id="5784822">}</span><span class="op" id="5784823">)</span>&nbsp;<span class="builtintype" id="5784825">error</span>&nbsp;<span class="op" id="5784831">{</span><br>
<span class="lineno">1635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5784834">if</span>&nbsp;<span class="ident" id="5784837"><a href="/database/sql/sql.go.html#5784789">rs</a></span><span class="op" id="5784839">.</span><span class="ident" id="5784840">closed</span>&nbsp;<span class="op" id="5784847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5784851">return</span>&nbsp;<span class="ident" id="5784858"><a href="/database/sql/sql.go.html#5743235">errors</a></span><span class="op" id="5784864">.</span><span class="ident" id="5784865">New</span><span class="op" id="5784868">(</span><span class="string" id="5784869">&#34;sql:&nbsp;Rows&nbsp;are&nbsp;closed&#34;</span><span class="op" id="5784891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5784894">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5784897">if</span>&nbsp;<span class="ident" id="5784900"><a href="/database/sql/sql.go.html#5784789">rs</a></span><span class="op" id="5784902">.</span><span class="ident" id="5784903">lastcols</span>&nbsp;<span class="op" id="5784912">==</span>&nbsp;<span class="ident" id="5784915">nil</span>&nbsp;<span class="op" id="5784919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5784923">return</span>&nbsp;<span class="ident" id="5784930"><a href="/database/sql/sql.go.html#5743235">errors</a></span><span class="op" id="5784936">.</span><span class="ident" id="5784937">New</span><span class="op" id="5784940">(</span><span class="string" id="5784941">&#34;sql:&nbsp;Scan&nbsp;called&nbsp;without&nbsp;calling&nbsp;Next&#34;</span><span class="op" id="5784980">)</span><br>
<span class="lineno">1640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5784983">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5784986">if</span>&nbsp;<span class="builtinfunc" id="5784989">len</span><span class="op" id="5784992">(</span><span class="ident" id="5784993"><a href="/database/sql/sql.go.html#5784804">dest</a></span><span class="op" id="5784997">)</span>&nbsp;<span class="op" id="5784999">!=</span>&nbsp;<span class="builtinfunc" id="5785002">len</span><span class="op" id="5785005">(</span><span class="ident" id="5785006"><a href="/database/sql/sql.go.html#5784789">rs</a></span><span class="op" id="5785008">.</span><span class="ident" id="5785009">lastcols</span><span class="op" id="5785017">)</span>&nbsp;<span class="op" id="5785019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5785023">return</span>&nbsp;<span class="ident" id="5785030"><a href="/database/sql/sql.go.html#5743245">fmt</a></span><span class="op" id="5785033">.</span><span class="ident" id="5785034">Errorf</span><span class="op" id="5785040">(</span><span class="string" id="5785041">&#34;sql:&nbsp;expected&nbsp;%d&nbsp;destination&nbsp;arguments&nbsp;in&nbsp;Scan,&nbsp;not&nbsp;%d&#34;</span><span class="op" id="5785097">,</span>&nbsp;<span class="builtinfunc" id="5785099">len</span><span class="op" id="5785102">(</span><span class="ident" id="5785103"><a href="/database/sql/sql.go.html#5784789">rs</a></span><span class="op" id="5785105">.</span><span class="ident" id="5785106">lastcols</span><span class="op" id="5785114">)</span><span class="op" id="5785115">,</span>&nbsp;<span class="builtinfunc" id="5785117">len</span><span class="op" id="5785120">(</span><span class="ident" id="5785121"><a href="/database/sql/sql.go.html#5784804">dest</a></span><span class="op" id="5785125">)</span><span class="op" id="5785126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5785129">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5785132">for</span>&nbsp;<span class="ident" id="5785136">i</span><span class="op" id="5785137">,</span>&nbsp;<span class="ident" id="5785139">sv</span>&nbsp;<span class="op" id="5785142">:=</span>&nbsp;<span class="keyword" id="5785145">range</span>&nbsp;<span class="ident" id="5785151"><a href="/database/sql/sql.go.html#5784789">rs</a></span><span class="op" id="5785153">.</span><span class="ident" id="5785154">lastcols</span>&nbsp;<span class="op" id="5785163">{</span><br>
<span class="lineno">1645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5785167">err</span>&nbsp;<span class="op" id="5785171">:=</span>&nbsp;<span class="ident" id="5785174"><a href="/database/sql/convert.go.html#5737952">convertAssign</a></span><span class="op" id="5785187">(</span><span class="ident" id="5785188"><a href="/database/sql/sql.go.html#5784804">dest</a></span><span class="op" id="5785192">[</span><span class="ident" id="5785193"><a href="/database/sql/sql.go.html#5785136">i</a></span><span class="op" id="5785194">]</span><span class="op" id="5785195">,</span>&nbsp;<span class="ident" id="5785197"><a href="/database/sql/sql.go.html#5785139">sv</a></span><span class="op" id="5785199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5785203">if</span>&nbsp;<span class="ident" id="5785206"><a href="/database/sql/sql.go.html#5785167">err</a></span>&nbsp;<span class="op" id="5785210">!=</span>&nbsp;<span class="ident" id="5785213">nil</span>&nbsp;<span class="op" id="5785217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5785222">return</span>&nbsp;<span class="ident" id="5785229"><a href="/database/sql/sql.go.html#5743245">fmt</a></span><span class="op" id="5785232">.</span><span class="ident" id="5785233">Errorf</span><span class="op" id="5785239">(</span><span class="string" id="5785240">&#34;sql:&nbsp;Scan&nbsp;error&nbsp;on&nbsp;column&nbsp;index&nbsp;%d:&nbsp;%v&#34;</span><span class="op" id="5785280">,</span>&nbsp;<span class="ident" id="5785282"><a href="/database/sql/sql.go.html#5785136">i</a></span><span class="op" id="5785283">,</span>&nbsp;<span class="ident" id="5785285"><a href="/database/sql/sql.go.html#5785167">err</a></span><span class="op" id="5785288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5785292">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5785295">}</span><br>
<span class="lineno">1650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5785298">return</span>&nbsp;<span class="ident" id="5785305">nil</span><br>
<span class="lineno"></span><span class="op" id="5785309">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5785312">var</span>&nbsp;<span class="ident" id="5785316">rowsCloseHook</span>&nbsp;<span class="keyword" id="5785330">func</span><span class="op" id="5785334">(</span><span class="op" id="5785335">*</span><span class="ident" id="5785336"><a href="/database/sql/sql.go.html#5782647">Rows</a></span><span class="op" id="5785340">,</span>&nbsp;<span class="op" id="5785342">*</span><span class="builtintype" id="5785343">error</span><span class="op" id="5785348">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1655</span><span class="comment" id="5785351">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;Rows,&nbsp;preventing&nbsp;further&nbsp;enumeration.&nbsp;If&nbsp;Next&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="5785425">//&nbsp;false,&nbsp;the&nbsp;Rows&nbsp;are&nbsp;closed&nbsp;automatically&nbsp;and&nbsp;it&nbsp;will&nbsp;suffice&nbsp;to&nbsp;check&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5785502">//&nbsp;result&nbsp;of&nbsp;Err.&nbsp;Close&nbsp;is&nbsp;idempotent&nbsp;and&nbsp;does&nbsp;not&nbsp;affect&nbsp;the&nbsp;result&nbsp;of&nbsp;Err.</span><br>
<span class="lineno"></span><span class="keyword" id="5785579">func</span>&nbsp;<span class="op" id="5785584">(</span><span class="ident" id="5785585">rs</span>&nbsp;<span class="op" id="5785588">*</span><span class="ident" id="5785589"><a href="/database/sql/sql.go.html#5782647">Rows</a></span><span class="op" id="5785593">)</span>&nbsp;<span class="ident" id="5785595">Close</span><span class="op" id="5785600">(</span><span class="op" id="5785601">)</span>&nbsp;<span class="builtintype" id="5785603">error</span>&nbsp;<span class="op" id="5785609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5785612">if</span>&nbsp;<span class="ident" id="5785615"><a href="/database/sql/sql.go.html#5785585">rs</a></span><span class="op" id="5785617">.</span><span class="ident" id="5785618">closed</span>&nbsp;<span class="op" id="5785625">{</span><br>
<span class="lineno">1660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5785629">return</span>&nbsp;<span class="ident" id="5785636">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5785641">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5785644"><a href="/database/sql/sql.go.html#5785585">rs</a></span><span class="op" id="5785646">.</span><span class="ident" id="5785647">closed</span>&nbsp;<span class="op" id="5785654">=</span>&nbsp;<span class="ident" id="5785656">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5785662">err</span>&nbsp;<span class="op" id="5785666">:=</span>&nbsp;<span class="ident" id="5785669"><a href="/database/sql/sql.go.html#5785585">rs</a></span><span class="op" id="5785671">.</span><span class="ident" id="5785672">rowsi</span><span class="op" id="5785677">.</span><span class="ident" id="5785678">Close</span><span class="op" id="5785683">(</span><span class="op" id="5785684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5785687">if</span>&nbsp;<span class="ident" id="5785690">fn</span>&nbsp;<span class="op" id="5785693">:=</span>&nbsp;<span class="ident" id="5785696"><a href="/database/sql/sql.go.html#5785316">rowsCloseHook</a></span><span class="op" id="5785709">;</span>&nbsp;<span class="ident" id="5785711"><a href="/database/sql/sql.go.html#5785690">fn</a></span>&nbsp;<span class="op" id="5785714">!=</span>&nbsp;<span class="ident" id="5785717">nil</span>&nbsp;<span class="op" id="5785721">{</span><br>
<span class="lineno">1665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5785725"><a href="/database/sql/sql.go.html#5785690">fn</a></span><span class="op" id="5785727">(</span><span class="ident" id="5785728"><a href="/database/sql/sql.go.html#5785585">rs</a></span><span class="op" id="5785730">,</span>&nbsp;<span class="op" id="5785732">&amp;</span><span class="ident" id="5785733"><a href="/database/sql/sql.go.html#5785662">err</a></span><span class="op" id="5785736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5785739">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5785742">if</span>&nbsp;<span class="ident" id="5785745"><a href="/database/sql/sql.go.html#5785585">rs</a></span><span class="op" id="5785747">.</span><span class="ident" id="5785748">closeStmt</span>&nbsp;<span class="op" id="5785758">!=</span>&nbsp;<span class="ident" id="5785761">nil</span>&nbsp;<span class="op" id="5785765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5785769"><a href="/database/sql/sql.go.html#5785585">rs</a></span><span class="op" id="5785771">.</span><span class="ident" id="5785772">closeStmt</span><span class="op" id="5785781">.</span><span class="ident" id="5785782">Close</span><span class="op" id="5785787">(</span><span class="op" id="5785788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5785791">}</span><br>
<span class="lineno">1670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5785794"><a href="/database/sql/sql.go.html#5785585">rs</a></span><span class="op" id="5785796">.</span><span class="ident" id="5785797">releaseConn</span><span class="op" id="5785808">(</span><span class="ident" id="5785809"><a href="/database/sql/sql.go.html#5785662">err</a></span><span class="op" id="5785812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5785815">return</span>&nbsp;<span class="ident" id="5785822"><a href="/database/sql/sql.go.html#5785662">err</a></span><br>
<span class="lineno"></span><span class="op" id="5785826">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5785829">//&nbsp;Row&nbsp;is&nbsp;the&nbsp;result&nbsp;of&nbsp;calling&nbsp;QueryRow&nbsp;to&nbsp;select&nbsp;a&nbsp;single&nbsp;row.</span><br>
<span class="lineno">1675</span><span class="keyword" id="5785894">type</span>&nbsp;<span class="ident" id="5785899">Row</span>&nbsp;<span class="keyword" id="5785903">struct</span>&nbsp;<span class="op" id="5785910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5785913">//&nbsp;One&nbsp;of&nbsp;these&nbsp;two&nbsp;will&nbsp;be&nbsp;non-nil:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5785951">err</span>&nbsp;&nbsp;<span class="builtintype" id="5785956">error</span>&nbsp;<span class="comment" id="5785962">//&nbsp;deferred&nbsp;error&nbsp;for&nbsp;easy&nbsp;chaining</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5785999">rows</span>&nbsp;<span class="op" id="5786004">*</span><span class="ident" id="5786005"><a href="/database/sql/sql.go.html#5782647">Rows</a></span><br>
<span class="lineno"></span><span class="op" id="5786010">}</span><br>
<span class="lineno">1680</span><br>
<span class="lineno"></span><span class="comment" id="5786013">//&nbsp;Scan&nbsp;copies&nbsp;the&nbsp;columns&nbsp;from&nbsp;the&nbsp;matched&nbsp;row&nbsp;into&nbsp;the&nbsp;values</span><br>
<span class="lineno"></span><span class="comment" id="5786077">//&nbsp;pointed&nbsp;at&nbsp;by&nbsp;dest.&nbsp;&nbsp;If&nbsp;more&nbsp;than&nbsp;one&nbsp;row&nbsp;matches&nbsp;the&nbsp;query,</span><br>
<span class="lineno"></span><span class="comment" id="5786141">//&nbsp;Scan&nbsp;uses&nbsp;the&nbsp;first&nbsp;row&nbsp;and&nbsp;discards&nbsp;the&nbsp;rest.&nbsp;&nbsp;If&nbsp;no&nbsp;row&nbsp;matches</span><br>
<span class="lineno"></span><span class="comment" id="5786210">//&nbsp;the&nbsp;query,&nbsp;Scan&nbsp;returns&nbsp;ErrNoRows.</span><br>
<span class="lineno">1685</span><span class="keyword" id="5786248">func</span>&nbsp;<span class="op" id="5786253">(</span><span class="ident" id="5786254">r</span>&nbsp;<span class="op" id="5786256">*</span><span class="ident" id="5786257"><a href="/database/sql/sql.go.html#5785899">Row</a></span><span class="op" id="5786260">)</span>&nbsp;<span class="ident" id="5786262">Scan</span><span class="op" id="5786266">(</span><span class="ident" id="5786267">dest</span>&nbsp;<span class="op" id="5786272">...</span><span class="keyword" id="5786275">interface</span><span class="op" id="5786284">{</span><span class="op" id="5786285">}</span><span class="op" id="5786286">)</span>&nbsp;<span class="builtintype" id="5786288">error</span>&nbsp;<span class="op" id="5786294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5786297">if</span>&nbsp;<span class="ident" id="5786300"><a href="/database/sql/sql.go.html#5786254">r</a></span><span class="op" id="5786301">.</span><span class="ident" id="5786302">err</span>&nbsp;<span class="op" id="5786306">!=</span>&nbsp;<span class="ident" id="5786309">nil</span>&nbsp;<span class="op" id="5786313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5786317">return</span>&nbsp;<span class="ident" id="5786324"><a href="/database/sql/sql.go.html#5786254">r</a></span><span class="op" id="5786325">.</span><span class="ident" id="5786326">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5786331">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1690</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5786335">//&nbsp;TODO(bradfitz):&nbsp;for&nbsp;now&nbsp;we&nbsp;need&nbsp;to&nbsp;defensively&nbsp;clone&nbsp;all</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5786396">//&nbsp;[]byte&nbsp;that&nbsp;the&nbsp;driver&nbsp;returned&nbsp;(not&nbsp;permitting</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5786448">//&nbsp;*RawBytes&nbsp;in&nbsp;Rows.Scan),&nbsp;since&nbsp;we&#39;re&nbsp;about&nbsp;to&nbsp;close</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5786504">//&nbsp;the&nbsp;Rows&nbsp;in&nbsp;our&nbsp;defer,&nbsp;when&nbsp;we&nbsp;return&nbsp;from&nbsp;this&nbsp;function.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5786566">//&nbsp;the&nbsp;contract&nbsp;with&nbsp;the&nbsp;driver.Next(...)&nbsp;interface&nbsp;is&nbsp;that&nbsp;it</span><br>
<span class="lineno">1695</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5786630">//&nbsp;can&nbsp;return&nbsp;slices&nbsp;into&nbsp;read-only&nbsp;temporary&nbsp;memory&nbsp;that&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5786691">//&nbsp;only&nbsp;valid&nbsp;until&nbsp;the&nbsp;next&nbsp;Scan/Close.&nbsp;&nbsp;But&nbsp;the&nbsp;TODO&nbsp;is&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5786755">//&nbsp;for&nbsp;a&nbsp;lot&nbsp;of&nbsp;drivers,&nbsp;this&nbsp;copy&nbsp;will&nbsp;be&nbsp;unnecessary.&nbsp;&nbsp;We</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5786816">//&nbsp;should&nbsp;provide&nbsp;an&nbsp;optional&nbsp;interface&nbsp;for&nbsp;drivers&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5786872">//&nbsp;implement&nbsp;to&nbsp;say,&nbsp;&#34;don&#39;t&nbsp;worry,&nbsp;the&nbsp;[]bytes&nbsp;that&nbsp;I&nbsp;return</span><br>
<span class="lineno">1700</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5786934">//&nbsp;from&nbsp;Next&nbsp;will&nbsp;not&nbsp;be&nbsp;modified&nbsp;again.&#34;&nbsp;(for&nbsp;instance,&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5786995">//&nbsp;they&nbsp;were&nbsp;obtained&nbsp;from&nbsp;the&nbsp;network&nbsp;anyway)&nbsp;But&nbsp;for&nbsp;now&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5787058">//&nbsp;don&#39;t&nbsp;care.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5787074">defer</span>&nbsp;<span class="ident" id="5787080"><a href="/database/sql/sql.go.html#5786254">r</a></span><span class="op" id="5787081">.</span><span class="ident" id="5787082">rows</span><span class="op" id="5787086">.</span><span class="ident" id="5787087">Close</span><span class="op" id="5787092">(</span><span class="op" id="5787093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5787096">for</span>&nbsp;<span class="ident" id="5787100">_</span><span class="op" id="5787101">,</span>&nbsp;<span class="ident" id="5787103">dp</span>&nbsp;<span class="op" id="5787106">:=</span>&nbsp;<span class="keyword" id="5787109">range</span>&nbsp;<span class="ident" id="5787115"><a href="/database/sql/sql.go.html#5786267">dest</a></span>&nbsp;<span class="op" id="5787120">{</span><br>
<span class="lineno">1705</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5787124">if</span>&nbsp;<span class="ident" id="5787127">_</span><span class="op" id="5787128">,</span>&nbsp;<span class="ident" id="5787130">ok</span>&nbsp;<span class="op" id="5787133">:=</span>&nbsp;<span class="ident" id="5787136"><a href="/database/sql/sql.go.html#5787103">dp</a></span><span class="op" id="5787138">.</span><span class="op" id="5787139">(</span><span class="op" id="5787140">*</span><span class="ident" id="5787141"><a href="/database/sql/sql.go.html#5744226">RawBytes</a></span><span class="op" id="5787149">)</span><span class="op" id="5787150">;</span>&nbsp;<span class="ident" id="5787152"><a href="/database/sql/sql.go.html#5787130">ok</a></span>&nbsp;<span class="op" id="5787155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5787160">return</span>&nbsp;<span class="ident" id="5787167"><a href="/database/sql/sql.go.html#5743235">errors</a></span><span class="op" id="5787173">.</span><span class="ident" id="5787174">New</span><span class="op" id="5787177">(</span><span class="string" id="5787178">&#34;sql:&nbsp;RawBytes&nbsp;isn&#39;t&nbsp;allowed&nbsp;on&nbsp;Row.Scan&#34;</span><span class="op" id="5787219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5787223">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5787226">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1710</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5787230">if</span>&nbsp;<span class="op" id="5787233">!</span><span class="ident" id="5787234"><a href="/database/sql/sql.go.html#5786254">r</a></span><span class="op" id="5787235">.</span><span class="ident" id="5787236">rows</span><span class="op" id="5787240">.</span><span class="ident" id="5787241">Next</span><span class="op" id="5787245">(</span><span class="op" id="5787246">)</span>&nbsp;<span class="op" id="5787248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5787252">if</span>&nbsp;<span class="ident" id="5787255">err</span>&nbsp;<span class="op" id="5787259">:=</span>&nbsp;<span class="ident" id="5787262"><a href="/database/sql/sql.go.html#5786254">r</a></span><span class="op" id="5787263">.</span><span class="ident" id="5787264">rows</span><span class="op" id="5787268">.</span><span class="ident" id="5787269">Err</span><span class="op" id="5787272">(</span><span class="op" id="5787273">)</span><span class="op" id="5787274">;</span>&nbsp;<span class="ident" id="5787276"><a href="/database/sql/sql.go.html#5787255">err</a></span>&nbsp;<span class="op" id="5787280">!=</span>&nbsp;<span class="ident" id="5787283">nil</span>&nbsp;<span class="op" id="5787287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5787292">return</span>&nbsp;<span class="ident" id="5787299"><a href="/database/sql/sql.go.html#5787255">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5787305">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5787309">return</span>&nbsp;<span class="ident" id="5787316"><a href="/database/sql/sql.go.html#5747590">ErrNoRows</a></span><br>
<span class="lineno">1715</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5787327">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5787330">err</span>&nbsp;<span class="op" id="5787334">:=</span>&nbsp;<span class="ident" id="5787337"><a href="/database/sql/sql.go.html#5786254">r</a></span><span class="op" id="5787338">.</span><span class="ident" id="5787339">rows</span><span class="op" id="5787343">.</span><span class="ident" id="5787344">Scan</span><span class="op" id="5787348">(</span><span class="ident" id="5787349"><a href="/database/sql/sql.go.html#5786267">dest</a></span><span class="op" id="5787353">...</span><span class="op" id="5787356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5787359">if</span>&nbsp;<span class="ident" id="5787362"><a href="/database/sql/sql.go.html#5787330">err</a></span>&nbsp;<span class="op" id="5787366">!=</span>&nbsp;<span class="ident" id="5787369">nil</span>&nbsp;<span class="op" id="5787373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5787377">return</span>&nbsp;<span class="ident" id="5787384"><a href="/database/sql/sql.go.html#5787330">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5787389">}</span><br>
<span class="lineno">1720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5787392">//&nbsp;Make&nbsp;sure&nbsp;the&nbsp;query&nbsp;can&nbsp;be&nbsp;processed&nbsp;to&nbsp;completion&nbsp;with&nbsp;no&nbsp;errors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5787463">if</span>&nbsp;<span class="ident" id="5787466">err</span>&nbsp;<span class="op" id="5787470">:=</span>&nbsp;<span class="ident" id="5787473"><a href="/database/sql/sql.go.html#5786254">r</a></span><span class="op" id="5787474">.</span><span class="ident" id="5787475">rows</span><span class="op" id="5787479">.</span><span class="ident" id="5787480">Close</span><span class="op" id="5787485">(</span><span class="op" id="5787486">)</span><span class="op" id="5787487">;</span>&nbsp;<span class="ident" id="5787489"><a href="/database/sql/sql.go.html#5787466">err</a></span>&nbsp;<span class="op" id="5787493">!=</span>&nbsp;<span class="ident" id="5787496">nil</span>&nbsp;<span class="op" id="5787500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5787504">return</span>&nbsp;<span class="ident" id="5787511"><a href="/database/sql/sql.go.html#5787466">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5787516">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5787520">return</span>&nbsp;<span class="ident" id="5787527">nil</span><br>
<span class="lineno"></span><span class="op" id="5787531">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5787534">//&nbsp;A&nbsp;Result&nbsp;summarizes&nbsp;an&nbsp;executed&nbsp;SQL&nbsp;command.</span><br>
<span class="lineno"></span><span class="keyword" id="5787582">type</span>&nbsp;<span class="ident" id="5787587">Result</span>&nbsp;<span class="keyword" id="5787594">interface</span>&nbsp;<span class="op" id="5787604">{</span><br>
<span class="lineno">1730</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5787607">//&nbsp;LastInsertId&nbsp;returns&nbsp;the&nbsp;integer&nbsp;generated&nbsp;by&nbsp;the&nbsp;database</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5787670">//&nbsp;in&nbsp;response&nbsp;to&nbsp;a&nbsp;command.&nbsp;Typically&nbsp;this&nbsp;will&nbsp;be&nbsp;from&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5787731">//&nbsp;&#34;auto&nbsp;increment&#34;&nbsp;column&nbsp;when&nbsp;inserting&nbsp;a&nbsp;new&nbsp;row.&nbsp;Not&nbsp;all</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5787793">//&nbsp;databases&nbsp;support&nbsp;this&nbsp;feature,&nbsp;and&nbsp;the&nbsp;syntax&nbsp;of&nbsp;such</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5787852">//&nbsp;statements&nbsp;varies.</span><br>
<span class="lineno">1735</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5787875">LastInsertId</span><span class="op" id="5787887">(</span><span class="op" id="5787888">)</span>&nbsp;<span class="op" id="5787890">(</span><span class="ident" id="5787891">int64</span><span class="op" id="5787896">,</span>&nbsp;<span class="builtintype" id="5787898">error</span><span class="op" id="5787903">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5787907">//&nbsp;RowsAffected&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;rows&nbsp;affected&nbsp;by&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5787966">//&nbsp;update,&nbsp;insert,&nbsp;or&nbsp;delete.&nbsp;Not&nbsp;every&nbsp;database&nbsp;or&nbsp;database</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5788028">//&nbsp;driver&nbsp;may&nbsp;support&nbsp;this.</span><br>
<span class="lineno">1740</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5788057">RowsAffected</span><span class="op" id="5788069">(</span><span class="op" id="5788070">)</span>&nbsp;<span class="op" id="5788072">(</span><span class="ident" id="5788073">int64</span><span class="op" id="5788078">,</span>&nbsp;<span class="builtintype" id="5788080">error</span><span class="op" id="5788085">)</span><br>
<span class="lineno"></span><span class="op" id="5788087">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5788090">type</span>&nbsp;<span class="ident" id="5788095">driverResult</span>&nbsp;<span class="keyword" id="5788108">struct</span>&nbsp;<span class="op" id="5788115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5788118"><a href="/database/sql/sql.go.html#5743277">sync</a></span><span class="op" id="5788122">.</span><span class="ident" id="5788123">Locker</span>&nbsp;<span class="comment" id="5788130">//&nbsp;the&nbsp;*driverConn</span><br>
<span class="lineno">1745</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5788150">resi</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5788162"><a href="/database/sql/sql.go.html#5743212">driver</a></span><span class="op" id="5788168">.</span><span class="ident" id="5788169">Result</span><br>
<span class="lineno"></span><span class="op" id="5788176">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5788179">func</span>&nbsp;<span class="op" id="5788184">(</span><span class="ident" id="5788185">dr</span>&nbsp;<span class="ident" id="5788188"><a href="/database/sql/sql.go.html#5788095">driverResult</a></span><span class="op" id="5788200">)</span>&nbsp;<span class="ident" id="5788202">LastInsertId</span><span class="op" id="5788214">(</span><span class="op" id="5788215">)</span>&nbsp;<span class="op" id="5788217">(</span><span class="ident" id="5788218">int64</span><span class="op" id="5788223">,</span>&nbsp;<span class="builtintype" id="5788225">error</span><span class="op" id="5788230">)</span>&nbsp;<span class="op" id="5788232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5788235"><a href="/database/sql/sql.go.html#5788185">dr</a></span><span class="op" id="5788237">.</span><span class="ident" id="5788238">Lock</span><span class="op" id="5788242">(</span><span class="op" id="5788243">)</span><br>
<span class="lineno">1750</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5788246">defer</span>&nbsp;<span class="ident" id="5788252"><a href="/database/sql/sql.go.html#5788185">dr</a></span><span class="op" id="5788254">.</span><span class="ident" id="5788255">Unlock</span><span class="op" id="5788261">(</span><span class="op" id="5788262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5788265">return</span>&nbsp;<span class="ident" id="5788272"><a href="/database/sql/sql.go.html#5788185">dr</a></span><span class="op" id="5788274">.</span><span class="ident" id="5788275">resi</span><span class="op" id="5788279">.</span><span class="ident" id="5788280">LastInsertId</span><span class="op" id="5788292">(</span><span class="op" id="5788293">)</span><br>
<span class="lineno"></span><span class="op" id="5788295">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5788298">func</span>&nbsp;<span class="op" id="5788303">(</span><span class="ident" id="5788304">dr</span>&nbsp;<span class="ident" id="5788307"><a href="/database/sql/sql.go.html#5788095">driverResult</a></span><span class="op" id="5788319">)</span>&nbsp;<span class="ident" id="5788321">RowsAffected</span><span class="op" id="5788333">(</span><span class="op" id="5788334">)</span>&nbsp;<span class="op" id="5788336">(</span><span class="ident" id="5788337">int64</span><span class="op" id="5788342">,</span>&nbsp;<span class="builtintype" id="5788344">error</span><span class="op" id="5788349">)</span>&nbsp;<span class="op" id="5788351">{</span><br>
<span class="lineno">1755</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5788354"><a href="/database/sql/sql.go.html#5788304">dr</a></span><span class="op" id="5788356">.</span><span class="ident" id="5788357">Lock</span><span class="op" id="5788361">(</span><span class="op" id="5788362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5788365">defer</span>&nbsp;<span class="ident" id="5788371"><a href="/database/sql/sql.go.html#5788304">dr</a></span><span class="op" id="5788373">.</span><span class="ident" id="5788374">Unlock</span><span class="op" id="5788380">(</span><span class="op" id="5788381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5788384">return</span>&nbsp;<span class="ident" id="5788391"><a href="/database/sql/sql.go.html#5788304">dr</a></span><span class="op" id="5788393">.</span><span class="ident" id="5788394">resi</span><span class="op" id="5788398">.</span><span class="ident" id="5788399">RowsAffected</span><span class="op" id="5788411">(</span><span class="op" id="5788412">)</span><br>
<span class="lineno"></span><span class="op" id="5788414">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1760</span><span class="keyword" id="5788417">func</span>&nbsp;<span class="ident" id="5788422">stack</span><span class="op" id="5788427">(</span><span class="op" id="5788428">)</span>&nbsp;<span class="builtintype" id="5788430">string</span>&nbsp;<span class="op" id="5788437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5788440">var</span>&nbsp;<span class="ident" id="5788444">buf</span>&nbsp;<span class="op" id="5788448">[</span><span class="num" id="5788449">2</span>&nbsp;<span class="op" id="5788451">&lt;&lt;</span>&nbsp;<span class="num" id="5788454">10</span><span class="op" id="5788456">]</span><span class="builtintype" id="5788457">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5788463">return</span>&nbsp;<span class="builtintype" id="5788470">string</span><span class="op" id="5788476">(</span><span class="ident" id="5788477"><a href="/database/sql/sql.go.html#5788444">buf</a></span><span class="op" id="5788480">[</span><span class="op" id="5788481">:</span><span class="ident" id="5788482"><a href="/database/sql/sql.go.html#5743258">runtime</a></span><span class="op" id="5788489">.</span><span class="ident" id="5788490">Stack</span><span class="op" id="5788495">(</span><span class="ident" id="5788496"><a href="/database/sql/sql.go.html#5788444">buf</a></span><span class="op" id="5788499">[</span><span class="op" id="5788500">:</span><span class="op" id="5788501">]</span><span class="op" id="5788502">,</span>&nbsp;<span class="ident" id="5788504">false</span><span class="op" id="5788509">)</span><span class="op" id="5788510">]</span><span class="op" id="5788511">)</span><br>
<span class="lineno"></span><span class="op" id="5788513">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1765</span><span class="comment" id="5788516">//&nbsp;withLock&nbsp;runs&nbsp;while&nbsp;holding&nbsp;lk.</span><br>
<span class="lineno"></span><span class="keyword" id="5788551">func</span>&nbsp;<span class="ident" id="5788556">withLock</span><span class="op" id="5788564">(</span><span class="ident" id="5788565">lk</span>&nbsp;<span class="ident" id="5788568"><a href="/database/sql/sql.go.html#5743277">sync</a></span><span class="op" id="5788572">.</span><span class="ident" id="5788573">Locker</span><span class="op" id="5788579">,</span>&nbsp;<span class="ident" id="5788581">fn</span>&nbsp;<span class="keyword" id="5788584">func</span><span class="op" id="5788588">(</span><span class="op" id="5788589">)</span><span class="op" id="5788590">)</span>&nbsp;<span class="op" id="5788592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5788595"><a href="/database/sql/sql.go.html#5788565">lk</a></span><span class="op" id="5788597">.</span><span class="ident" id="5788598">Lock</span><span class="op" id="5788602">(</span><span class="op" id="5788603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5788606"><a href="/database/sql/sql.go.html#5788581">fn</a></span><span class="op" id="5788608">(</span><span class="op" id="5788609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5788612"><a href="/database/sql/sql.go.html#5788565">lk</a></span><span class="op" id="5788614">.</span><span class="ident" id="5788615">Unlock</span><span class="op" id="5788621">(</span><span class="op" id="5788622">)</span><br>
<span class="lineno">1770</span><span class="op" id="5788624">}</span>
</div>
</body>
</html>
