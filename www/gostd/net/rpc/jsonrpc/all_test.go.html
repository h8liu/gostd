<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/rpc/jsonrpc</h2>
<ul>
<li><a href="/gostd/net/rpc/jsonrpc/all_test.go.html" class="current">all_test.go</a></li>
<li><a href="/gostd/net/rpc/jsonrpc/client.go.html">client.go</a></li>
<li><a href="/gostd/net/rpc/jsonrpc/server.go.html">server.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6955706">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6955762">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6955816">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6955867">package</span>&nbsp;<span class="ident" id="6955875">jsonrpc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6955884">import</span>&nbsp;<span class="op" id="6955891">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6955894">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6955903">&#34;encoding/json&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6955920">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6955930">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6955937">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6955943">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6955956">&#34;net&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6955963">&#34;net/rpc&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6955974">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6955985">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="6955995">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="6955998">type</span>&nbsp;<span class="ident" id="6956003">Args</span>&nbsp;<span class="keyword" id="6956008">struct</span>&nbsp;<span class="op" id="6956015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6956018">A</span><span class="op" id="6956019">,</span>&nbsp;<span class="ident" id="6956021">B</span>&nbsp;<span class="builtintype" id="6956023">int</span><br>
<span class="lineno"></span><span class="op" id="6956027">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6956030">type</span>&nbsp;<span class="ident" id="6956035">Reply</span>&nbsp;<span class="keyword" id="6956041">struct</span>&nbsp;<span class="op" id="6956048">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6956051">C</span>&nbsp;<span class="builtintype" id="6956053">int</span><br>
<span class="lineno"></span><span class="op" id="6956057">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6956060">type</span>&nbsp;<span class="ident" id="6956065">Arith</span>&nbsp;<span class="builtintype" id="6956071">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="6956076">type</span>&nbsp;<span class="ident" id="6956081">ArithAddResp</span>&nbsp;<span class="keyword" id="6956094">struct</span>&nbsp;<span class="op" id="6956101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6956104">Id</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6956111">interface</span><span class="op" id="6956120">{</span><span class="op" id="6956121">}</span>&nbsp;<span class="string" id="6956123">`json:&#34;id&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6956136">Result</span>&nbsp;<span class="ident" id="6956143">Reply</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6956155">`json:&#34;result&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6956172">Error</span>&nbsp;&nbsp;<span class="keyword" id="6956179">interface</span><span class="op" id="6956188">{</span><span class="op" id="6956189">}</span>&nbsp;<span class="string" id="6956191">`json:&#34;error&#34;`</span><br>
<span class="lineno"></span><span class="op" id="6956206">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="6956209">func</span>&nbsp;<span class="op" id="6956214">(</span><span class="ident" id="6956215">t</span>&nbsp;<span class="op" id="6956217">*</span><span class="ident" id="6956218">Arith</span><span class="op" id="6956223">)</span>&nbsp;<span class="ident" id="6956225">Add</span><span class="op" id="6956228">(</span><span class="ident" id="6956229">args</span>&nbsp;<span class="op" id="6956234">*</span><span class="ident" id="6956235">Args</span><span class="op" id="6956239">,</span>&nbsp;<span class="ident" id="6956241">reply</span>&nbsp;<span class="op" id="6956247">*</span><span class="ident" id="6956248">Reply</span><span class="op" id="6956253">)</span>&nbsp;<span class="builtintype" id="6956255">error</span>&nbsp;<span class="op" id="6956261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6956264">reply</span><span class="op" id="6956269">.</span><span class="ident" id="6956270">C</span>&nbsp;<span class="op" id="6956272">=</span>&nbsp;<span class="ident" id="6956274">args</span><span class="op" id="6956278">.</span><span class="ident" id="6956279">A</span>&nbsp;<span class="op" id="6956281">+</span>&nbsp;<span class="ident" id="6956283">args</span><span class="op" id="6956287">.</span><span class="ident" id="6956288">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6956291">return</span>&nbsp;<span class="ident" id="6956298">nil</span><br>
<span class="lineno"></span><span class="op" id="6956302">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="6956305">func</span>&nbsp;<span class="op" id="6956310">(</span><span class="ident" id="6956311">t</span>&nbsp;<span class="op" id="6956313">*</span><span class="ident" id="6956314">Arith</span><span class="op" id="6956319">)</span>&nbsp;<span class="ident" id="6956321">Mul</span><span class="op" id="6956324">(</span><span class="ident" id="6956325">args</span>&nbsp;<span class="op" id="6956330">*</span><span class="ident" id="6956331">Args</span><span class="op" id="6956335">,</span>&nbsp;<span class="ident" id="6956337">reply</span>&nbsp;<span class="op" id="6956343">*</span><span class="ident" id="6956344">Reply</span><span class="op" id="6956349">)</span>&nbsp;<span class="builtintype" id="6956351">error</span>&nbsp;<span class="op" id="6956357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6956360">reply</span><span class="op" id="6956365">.</span><span class="ident" id="6956366">C</span>&nbsp;<span class="op" id="6956368">=</span>&nbsp;<span class="ident" id="6956370">args</span><span class="op" id="6956374">.</span><span class="ident" id="6956375">A</span>&nbsp;<span class="op" id="6956377">*</span>&nbsp;<span class="ident" id="6956379">args</span><span class="op" id="6956383">.</span><span class="ident" id="6956384">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6956387">return</span>&nbsp;<span class="ident" id="6956394">nil</span><br>
<span class="lineno"></span><span class="op" id="6956398">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="6956401">func</span>&nbsp;<span class="op" id="6956406">(</span><span class="ident" id="6956407">t</span>&nbsp;<span class="op" id="6956409">*</span><span class="ident" id="6956410">Arith</span><span class="op" id="6956415">)</span>&nbsp;<span class="ident" id="6956417">Div</span><span class="op" id="6956420">(</span><span class="ident" id="6956421">args</span>&nbsp;<span class="op" id="6956426">*</span><span class="ident" id="6956427">Args</span><span class="op" id="6956431">,</span>&nbsp;<span class="ident" id="6956433">reply</span>&nbsp;<span class="op" id="6956439">*</span><span class="ident" id="6956440">Reply</span><span class="op" id="6956445">)</span>&nbsp;<span class="builtintype" id="6956447">error</span>&nbsp;<span class="op" id="6956453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6956456">if</span>&nbsp;<span class="ident" id="6956459">args</span><span class="op" id="6956463">.</span><span class="ident" id="6956464">B</span>&nbsp;<span class="op" id="6956466">==</span>&nbsp;<span class="num" id="6956469">0</span>&nbsp;<span class="op" id="6956471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6956475">return</span>&nbsp;<span class="ident" id="6956482">errors</span><span class="op" id="6956488">.</span><span class="ident" id="6956489">New</span><span class="op" id="6956492">(</span><span class="string" id="6956493">&#34;divide&nbsp;by&nbsp;zero&#34;</span><span class="op" id="6956509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6956512">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6956515">reply</span><span class="op" id="6956520">.</span><span class="ident" id="6956521">C</span>&nbsp;<span class="op" id="6956523">=</span>&nbsp;<span class="ident" id="6956525">args</span><span class="op" id="6956529">.</span><span class="ident" id="6956530">A</span>&nbsp;<span class="op" id="6956532">/</span>&nbsp;<span class="ident" id="6956534">args</span><span class="op" id="6956538">.</span><span class="ident" id="6956539">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6956542">return</span>&nbsp;<span class="ident" id="6956549">nil</span><br>
<span class="lineno"></span><span class="op" id="6956553">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6956556">func</span>&nbsp;<span class="op" id="6956561">(</span><span class="ident" id="6956562">t</span>&nbsp;<span class="op" id="6956564">*</span><span class="ident" id="6956565">Arith</span><span class="op" id="6956570">)</span>&nbsp;<span class="ident" id="6956572">Error</span><span class="op" id="6956577">(</span><span class="ident" id="6956578">args</span>&nbsp;<span class="op" id="6956583">*</span><span class="ident" id="6956584">Args</span><span class="op" id="6956588">,</span>&nbsp;<span class="ident" id="6956590">reply</span>&nbsp;<span class="op" id="6956596">*</span><span class="ident" id="6956597">Reply</span><span class="op" id="6956602">)</span>&nbsp;<span class="builtintype" id="6956604">error</span>&nbsp;<span class="op" id="6956610">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6956613">panic</span><span class="op" id="6956618">(</span><span class="string" id="6956619">&#34;ERROR&#34;</span><span class="op" id="6956626">)</span><br>
<span class="lineno"></span><span class="op" id="6956628">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6956631">func</span>&nbsp;<span class="ident" id="6956636">init</span><span class="op" id="6956640">(</span><span class="op" id="6956641">)</span>&nbsp;<span class="op" id="6956643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6956646">rpc</span><span class="op" id="6956649">.</span><span class="ident" id="6956650">Register</span><span class="op" id="6956658">(</span><span class="builtinfunc" id="6956659">new</span><span class="op" id="6956662">(</span><span class="ident" id="6956663">Arith</span><span class="op" id="6956668">)</span><span class="op" id="6956669">)</span><br>
<span class="lineno">60</span><span class="op" id="6956671">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6956674">func</span>&nbsp;<span class="ident" id="6956679">TestServerNoParams</span><span class="op" id="6956697">(</span><span class="ident" id="6956698">t</span>&nbsp;<span class="op" id="6956700">*</span><span class="ident" id="6956701">testing</span><span class="op" id="6956708">.</span><span class="ident" id="6956709">T</span><span class="op" id="6956710">)</span>&nbsp;<span class="op" id="6956712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6956715">cli</span><span class="op" id="6956718">,</span>&nbsp;<span class="ident" id="6956720">srv</span>&nbsp;<span class="op" id="6956724">:=</span>&nbsp;<span class="ident" id="6956727">net</span><span class="op" id="6956730">.</span><span class="ident" id="6956731">Pipe</span><span class="op" id="6956735">(</span><span class="op" id="6956736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6956739">defer</span>&nbsp;<span class="ident" id="6956745">cli</span><span class="op" id="6956748">.</span><span class="ident" id="6956749">Close</span><span class="op" id="6956754">(</span><span class="op" id="6956755">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6956758">go</span>&nbsp;<span class="ident" id="6956761">ServeConn</span><span class="op" id="6956770">(</span><span class="ident" id="6956771">srv</span><span class="op" id="6956774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6956777">dec</span>&nbsp;<span class="op" id="6956781">:=</span>&nbsp;<span class="ident" id="6956784">json</span><span class="op" id="6956788">.</span><span class="ident" id="6956789">NewDecoder</span><span class="op" id="6956799">(</span><span class="ident" id="6956800">cli</span><span class="op" id="6956803">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6956807">fmt</span><span class="op" id="6956810">.</span><span class="ident" id="6956811">Fprintf</span><span class="op" id="6956818">(</span><span class="ident" id="6956819">cli</span><span class="op" id="6956822">,</span>&nbsp;<span class="string" id="6956824">`{&#34;method&#34;:&nbsp;&#34;Arith.Add&#34;,&nbsp;&#34;id&#34;:&nbsp;&#34;123&#34;}`</span><span class="op" id="6956862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6956865">var</span>&nbsp;<span class="ident" id="6956869">resp</span>&nbsp;<span class="ident" id="6956874">ArithAddResp</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6956888">if</span>&nbsp;<span class="ident" id="6956891">err</span>&nbsp;<span class="op" id="6956895">:=</span>&nbsp;<span class="ident" id="6956898">dec</span><span class="op" id="6956901">.</span><span class="ident" id="6956902">Decode</span><span class="op" id="6956908">(</span><span class="op" id="6956909">&amp;</span><span class="ident" id="6956910">resp</span><span class="op" id="6956914">)</span><span class="op" id="6956915">;</span>&nbsp;<span class="ident" id="6956917">err</span>&nbsp;<span class="op" id="6956921">!=</span>&nbsp;<span class="ident" id="6956924">nil</span>&nbsp;<span class="op" id="6956928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6956932">t</span><span class="op" id="6956933">.</span><span class="ident" id="6956934">Fatalf</span><span class="op" id="6956940">(</span><span class="string" id="6956941">&#34;Decode&nbsp;after&nbsp;no&nbsp;params:&nbsp;%s&#34;</span><span class="op" id="6956969">,</span>&nbsp;<span class="ident" id="6956971">err</span><span class="op" id="6956974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6956977">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6956980">if</span>&nbsp;<span class="ident" id="6956983">resp</span><span class="op" id="6956987">.</span><span class="ident" id="6956988">Error</span>&nbsp;<span class="op" id="6956994">==</span>&nbsp;<span class="ident" id="6956997">nil</span>&nbsp;<span class="op" id="6957001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6957005">t</span><span class="op" id="6957006">.</span><span class="ident" id="6957007">Fatalf</span><span class="op" id="6957013">(</span><span class="string" id="6957014">&#34;Expected&nbsp;error,&nbsp;got&nbsp;nil&#34;</span><span class="op" id="6957039">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6957042">}</span><br>
<span class="lineno"></span><span class="op" id="6957044">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6957047">func</span>&nbsp;<span class="ident" id="6957052">TestServerEmptyMessage</span><span class="op" id="6957074">(</span><span class="ident" id="6957075">t</span>&nbsp;<span class="op" id="6957077">*</span><span class="ident" id="6957078">testing</span><span class="op" id="6957085">.</span><span class="ident" id="6957086">T</span><span class="op" id="6957087">)</span>&nbsp;<span class="op" id="6957089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6957092">cli</span><span class="op" id="6957095">,</span>&nbsp;<span class="ident" id="6957097">srv</span>&nbsp;<span class="op" id="6957101">:=</span>&nbsp;<span class="ident" id="6957104">net</span><span class="op" id="6957107">.</span><span class="ident" id="6957108">Pipe</span><span class="op" id="6957112">(</span><span class="op" id="6957113">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6957116">defer</span>&nbsp;<span class="ident" id="6957122">cli</span><span class="op" id="6957125">.</span><span class="ident" id="6957126">Close</span><span class="op" id="6957131">(</span><span class="op" id="6957132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6957135">go</span>&nbsp;<span class="ident" id="6957138">ServeConn</span><span class="op" id="6957147">(</span><span class="ident" id="6957148">srv</span><span class="op" id="6957151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6957154">dec</span>&nbsp;<span class="op" id="6957158">:=</span>&nbsp;<span class="ident" id="6957161">json</span><span class="op" id="6957165">.</span><span class="ident" id="6957166">NewDecoder</span><span class="op" id="6957176">(</span><span class="ident" id="6957177">cli</span><span class="op" id="6957180">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6957184">fmt</span><span class="op" id="6957187">.</span><span class="ident" id="6957188">Fprintf</span><span class="op" id="6957195">(</span><span class="ident" id="6957196">cli</span><span class="op" id="6957199">,</span>&nbsp;<span class="string" id="6957201">&#34;{}&#34;</span><span class="op" id="6957205">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6957208">var</span>&nbsp;<span class="ident" id="6957212">resp</span>&nbsp;<span class="ident" id="6957217">ArithAddResp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6957231">if</span>&nbsp;<span class="ident" id="6957234">err</span>&nbsp;<span class="op" id="6957238">:=</span>&nbsp;<span class="ident" id="6957241">dec</span><span class="op" id="6957244">.</span><span class="ident" id="6957245">Decode</span><span class="op" id="6957251">(</span><span class="op" id="6957252">&amp;</span><span class="ident" id="6957253">resp</span><span class="op" id="6957257">)</span><span class="op" id="6957258">;</span>&nbsp;<span class="ident" id="6957260">err</span>&nbsp;<span class="op" id="6957264">!=</span>&nbsp;<span class="ident" id="6957267">nil</span>&nbsp;<span class="op" id="6957271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6957275">t</span><span class="op" id="6957276">.</span><span class="ident" id="6957277">Fatalf</span><span class="op" id="6957283">(</span><span class="string" id="6957284">&#34;Decode&nbsp;after&nbsp;empty:&nbsp;%s&#34;</span><span class="op" id="6957308">,</span>&nbsp;<span class="ident" id="6957310">err</span><span class="op" id="6957313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6957316">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6957319">if</span>&nbsp;<span class="ident" id="6957322">resp</span><span class="op" id="6957326">.</span><span class="ident" id="6957327">Error</span>&nbsp;<span class="op" id="6957333">==</span>&nbsp;<span class="ident" id="6957336">nil</span>&nbsp;<span class="op" id="6957340">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6957344">t</span><span class="op" id="6957345">.</span><span class="ident" id="6957346">Fatalf</span><span class="op" id="6957352">(</span><span class="string" id="6957353">&#34;Expected&nbsp;error,&nbsp;got&nbsp;nil&#34;</span><span class="op" id="6957378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6957381">}</span><br>
<span class="lineno"></span><span class="op" id="6957383">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6957386">func</span>&nbsp;<span class="ident" id="6957391">TestServer</span><span class="op" id="6957401">(</span><span class="ident" id="6957402">t</span>&nbsp;<span class="op" id="6957404">*</span><span class="ident" id="6957405">testing</span><span class="op" id="6957412">.</span><span class="ident" id="6957413">T</span><span class="op" id="6957414">)</span>&nbsp;<span class="op" id="6957416">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6957419">cli</span><span class="op" id="6957422">,</span>&nbsp;<span class="ident" id="6957424">srv</span>&nbsp;<span class="op" id="6957428">:=</span>&nbsp;<span class="ident" id="6957431">net</span><span class="op" id="6957434">.</span><span class="ident" id="6957435">Pipe</span><span class="op" id="6957439">(</span><span class="op" id="6957440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6957443">defer</span>&nbsp;<span class="ident" id="6957449">cli</span><span class="op" id="6957452">.</span><span class="ident" id="6957453">Close</span><span class="op" id="6957458">(</span><span class="op" id="6957459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6957462">go</span>&nbsp;<span class="ident" id="6957465">ServeConn</span><span class="op" id="6957474">(</span><span class="ident" id="6957475">srv</span><span class="op" id="6957478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6957481">dec</span>&nbsp;<span class="op" id="6957485">:=</span>&nbsp;<span class="ident" id="6957488">json</span><span class="op" id="6957492">.</span><span class="ident" id="6957493">NewDecoder</span><span class="op" id="6957503">(</span><span class="ident" id="6957504">cli</span><span class="op" id="6957507">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6957511">//&nbsp;Send&nbsp;hand-coded&nbsp;requests&nbsp;to&nbsp;server,&nbsp;parse&nbsp;responses.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6957568">for</span>&nbsp;<span class="ident" id="6957572">i</span>&nbsp;<span class="op" id="6957574">:=</span>&nbsp;<span class="num" id="6957577">0</span><span class="op" id="6957578">;</span>&nbsp;<span class="ident" id="6957580">i</span>&nbsp;<span class="op" id="6957582">&lt;</span>&nbsp;<span class="num" id="6957584">10</span><span class="op" id="6957586">;</span>&nbsp;<span class="ident" id="6957588">i</span><span class="op" id="6957589">++</span>&nbsp;<span class="op" id="6957592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6957596">fmt</span><span class="op" id="6957599">.</span><span class="ident" id="6957600">Fprintf</span><span class="op" id="6957607">(</span><span class="ident" id="6957608">cli</span><span class="op" id="6957611">,</span>&nbsp;<span class="string" id="6957613">`{&#34;method&#34;:&nbsp;&#34;Arith.Add&#34;,&nbsp;&#34;id&#34;:&nbsp;&#34;\u%04d&#34;,&nbsp;&#34;params&#34;:&nbsp;[{&#34;A&#34;:&nbsp;%d,&nbsp;&#34;B&#34;:&nbsp;%d}]}`</span><span class="op" id="6957686">,</span>&nbsp;<span class="ident" id="6957688">i</span><span class="op" id="6957689">,</span>&nbsp;<span class="ident" id="6957691">i</span><span class="op" id="6957692">,</span>&nbsp;<span class="ident" id="6957694">i</span><span class="op" id="6957695">+</span><span class="num" id="6957696">1</span><span class="op" id="6957697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6957701">var</span>&nbsp;<span class="ident" id="6957705">resp</span>&nbsp;<span class="ident" id="6957710">ArithAddResp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6957725">err</span>&nbsp;<span class="op" id="6957729">:=</span>&nbsp;<span class="ident" id="6957732">dec</span><span class="op" id="6957735">.</span><span class="ident" id="6957736">Decode</span><span class="op" id="6957742">(</span><span class="op" id="6957743">&amp;</span><span class="ident" id="6957744">resp</span><span class="op" id="6957748">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6957752">if</span>&nbsp;<span class="ident" id="6957755">err</span>&nbsp;<span class="op" id="6957759">!=</span>&nbsp;<span class="ident" id="6957762">nil</span>&nbsp;<span class="op" id="6957766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6957771">t</span><span class="op" id="6957772">.</span><span class="ident" id="6957773">Fatalf</span><span class="op" id="6957779">(</span><span class="string" id="6957780">&#34;Decode:&nbsp;%s&#34;</span><span class="op" id="6957792">,</span>&nbsp;<span class="ident" id="6957794">err</span><span class="op" id="6957797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6957801">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6957805">if</span>&nbsp;<span class="ident" id="6957808">resp</span><span class="op" id="6957812">.</span><span class="ident" id="6957813">Error</span>&nbsp;<span class="op" id="6957819">!=</span>&nbsp;<span class="ident" id="6957822">nil</span>&nbsp;<span class="op" id="6957826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6957831">t</span><span class="op" id="6957832">.</span><span class="ident" id="6957833">Fatalf</span><span class="op" id="6957839">(</span><span class="string" id="6957840">&#34;resp.Error:&nbsp;%s&#34;</span><span class="op" id="6957856">,</span>&nbsp;<span class="ident" id="6957858">resp</span><span class="op" id="6957862">.</span><span class="ident" id="6957863">Error</span><span class="op" id="6957868">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6957872">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6957876">if</span>&nbsp;<span class="ident" id="6957879">resp</span><span class="op" id="6957883">.</span><span class="ident" id="6957884">Id</span><span class="op" id="6957886">.</span><span class="op" id="6957887">(</span><span class="builtintype" id="6957888">string</span><span class="op" id="6957894">)</span>&nbsp;<span class="op" id="6957896">!=</span>&nbsp;<span class="builtintype" id="6957899">string</span><span class="op" id="6957905">(</span><span class="ident" id="6957906">i</span><span class="op" id="6957907">)</span>&nbsp;<span class="op" id="6957909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6957914">t</span><span class="op" id="6957915">.</span><span class="ident" id="6957916">Fatalf</span><span class="op" id="6957922">(</span><span class="string" id="6957923">&#34;resp:&nbsp;bad&nbsp;id&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6957948">,</span>&nbsp;<span class="ident" id="6957950">resp</span><span class="op" id="6957954">.</span><span class="ident" id="6957955">Id</span><span class="op" id="6957957">.</span><span class="op" id="6957958">(</span><span class="builtintype" id="6957959">string</span><span class="op" id="6957965">)</span><span class="op" id="6957966">,</span>&nbsp;<span class="builtintype" id="6957968">string</span><span class="op" id="6957974">(</span><span class="ident" id="6957975">i</span><span class="op" id="6957976">)</span><span class="op" id="6957977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6957981">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6957985">if</span>&nbsp;<span class="ident" id="6957988">resp</span><span class="op" id="6957992">.</span><span class="ident" id="6957993">Result</span><span class="op" id="6957999">.</span><span class="ident" id="6958000">C</span>&nbsp;<span class="op" id="6958002">!=</span>&nbsp;<span class="num" id="6958005">2</span><span class="op" id="6958006">*</span><span class="ident" id="6958007">i</span><span class="op" id="6958008">+</span><span class="num" id="6958009">1</span>&nbsp;<span class="op" id="6958011">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6958016">t</span><span class="op" id="6958017">.</span><span class="ident" id="6958018">Fatalf</span><span class="op" id="6958024">(</span><span class="string" id="6958025">&#34;resp:&nbsp;bad&nbsp;result:&nbsp;%d+%d=%d&#34;</span><span class="op" id="6958053">,</span>&nbsp;<span class="ident" id="6958055">i</span><span class="op" id="6958056">,</span>&nbsp;<span class="ident" id="6958058">i</span><span class="op" id="6958059">+</span><span class="num" id="6958060">1</span><span class="op" id="6958061">,</span>&nbsp;<span class="ident" id="6958063">resp</span><span class="op" id="6958067">.</span><span class="ident" id="6958068">Result</span><span class="op" id="6958074">.</span><span class="ident" id="6958075">C</span><span class="op" id="6958076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6958080">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6958083">}</span><br>
<span class="lineno"></span><span class="op" id="6958085">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="keyword" id="6958088">func</span>&nbsp;<span class="ident" id="6958093">TestClient</span><span class="op" id="6958103">(</span><span class="ident" id="6958104">t</span>&nbsp;<span class="op" id="6958106">*</span><span class="ident" id="6958107">testing</span><span class="op" id="6958114">.</span><span class="ident" id="6958115">T</span><span class="op" id="6958116">)</span>&nbsp;<span class="op" id="6958118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6958121">//&nbsp;Assume&nbsp;server&nbsp;is&nbsp;okay&nbsp;(TestServer&nbsp;is&nbsp;above).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6958170">//&nbsp;Test&nbsp;client&nbsp;against&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6958202">cli</span><span class="op" id="6958205">,</span>&nbsp;<span class="ident" id="6958207">srv</span>&nbsp;<span class="op" id="6958211">:=</span>&nbsp;<span class="ident" id="6958214">net</span><span class="op" id="6958217">.</span><span class="ident" id="6958218">Pipe</span><span class="op" id="6958222">(</span><span class="op" id="6958223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6958226">go</span>&nbsp;<span class="ident" id="6958229">ServeConn</span><span class="op" id="6958238">(</span><span class="ident" id="6958239">srv</span><span class="op" id="6958242">)</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6958246">client</span>&nbsp;<span class="op" id="6958253">:=</span>&nbsp;<span class="ident" id="6958256">NewClient</span><span class="op" id="6958265">(</span><span class="ident" id="6958266">cli</span><span class="op" id="6958269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6958272">defer</span>&nbsp;<span class="ident" id="6958278">client</span><span class="op" id="6958284">.</span><span class="ident" id="6958285">Close</span><span class="op" id="6958290">(</span><span class="op" id="6958291">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6958295">//&nbsp;Synchronous&nbsp;calls</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6958317">args</span>&nbsp;<span class="op" id="6958322">:=</span>&nbsp;<span class="op" id="6958325">&amp;</span><span class="ident" id="6958326">Args</span><span class="op" id="6958330">{</span><span class="num" id="6958331">7</span><span class="op" id="6958332">,</span>&nbsp;<span class="num" id="6958334">8</span><span class="op" id="6958335">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6958338">reply</span>&nbsp;<span class="op" id="6958344">:=</span>&nbsp;<span class="builtinfunc" id="6958347">new</span><span class="op" id="6958350">(</span><span class="ident" id="6958351">Reply</span><span class="op" id="6958356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6958359">err</span>&nbsp;<span class="op" id="6958363">:=</span>&nbsp;<span class="ident" id="6958366">client</span><span class="op" id="6958372">.</span><span class="ident" id="6958373">Call</span><span class="op" id="6958377">(</span><span class="string" id="6958378">&#34;Arith.Add&#34;</span><span class="op" id="6958389">,</span>&nbsp;<span class="ident" id="6958391">args</span><span class="op" id="6958395">,</span>&nbsp;<span class="ident" id="6958397">reply</span><span class="op" id="6958402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6958405">if</span>&nbsp;<span class="ident" id="6958408">err</span>&nbsp;<span class="op" id="6958412">!=</span>&nbsp;<span class="ident" id="6958415">nil</span>&nbsp;<span class="op" id="6958419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6958423">t</span><span class="op" id="6958424">.</span><span class="ident" id="6958425">Errorf</span><span class="op" id="6958431">(</span><span class="string" id="6958432">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6958474">,</span>&nbsp;<span class="ident" id="6958476">err</span><span class="op" id="6958479">.</span><span class="ident" id="6958480">Error</span><span class="op" id="6958485">(</span><span class="op" id="6958486">)</span><span class="op" id="6958487">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6958490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6958493">if</span>&nbsp;<span class="ident" id="6958496">reply</span><span class="op" id="6958501">.</span><span class="ident" id="6958502">C</span>&nbsp;<span class="op" id="6958504">!=</span>&nbsp;<span class="ident" id="6958507">args</span><span class="op" id="6958511">.</span><span class="ident" id="6958512">A</span><span class="op" id="6958513">+</span><span class="ident" id="6958514">args</span><span class="op" id="6958518">.</span><span class="ident" id="6958519">B</span>&nbsp;<span class="op" id="6958521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6958525">t</span><span class="op" id="6958526">.</span><span class="ident" id="6958527">Errorf</span><span class="op" id="6958533">(</span><span class="string" id="6958534">&#34;Add:&nbsp;got&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="6958559">,</span>&nbsp;<span class="ident" id="6958561">reply</span><span class="op" id="6958566">.</span><span class="ident" id="6958567">C</span><span class="op" id="6958568">,</span>&nbsp;<span class="ident" id="6958570">args</span><span class="op" id="6958574">.</span><span class="ident" id="6958575">A</span><span class="op" id="6958576">+</span><span class="ident" id="6958577">args</span><span class="op" id="6958581">.</span><span class="ident" id="6958582">B</span><span class="op" id="6958583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6958586">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6958590">args</span>&nbsp;<span class="op" id="6958595">=</span>&nbsp;<span class="op" id="6958597">&amp;</span><span class="ident" id="6958598">Args</span><span class="op" id="6958602">{</span><span class="num" id="6958603">7</span><span class="op" id="6958604">,</span>&nbsp;<span class="num" id="6958606">8</span><span class="op" id="6958607">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6958610">reply</span>&nbsp;<span class="op" id="6958616">=</span>&nbsp;<span class="builtinfunc" id="6958618">new</span><span class="op" id="6958621">(</span><span class="ident" id="6958622">Reply</span><span class="op" id="6958627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6958630">err</span>&nbsp;<span class="op" id="6958634">=</span>&nbsp;<span class="ident" id="6958636">client</span><span class="op" id="6958642">.</span><span class="ident" id="6958643">Call</span><span class="op" id="6958647">(</span><span class="string" id="6958648">&#34;Arith.Mul&#34;</span><span class="op" id="6958659">,</span>&nbsp;<span class="ident" id="6958661">args</span><span class="op" id="6958665">,</span>&nbsp;<span class="ident" id="6958667">reply</span><span class="op" id="6958672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6958675">if</span>&nbsp;<span class="ident" id="6958678">err</span>&nbsp;<span class="op" id="6958682">!=</span>&nbsp;<span class="ident" id="6958685">nil</span>&nbsp;<span class="op" id="6958689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6958693">t</span><span class="op" id="6958694">.</span><span class="ident" id="6958695">Errorf</span><span class="op" id="6958701">(</span><span class="string" id="6958702">&#34;Mul:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6958744">,</span>&nbsp;<span class="ident" id="6958746">err</span><span class="op" id="6958749">.</span><span class="ident" id="6958750">Error</span><span class="op" id="6958755">(</span><span class="op" id="6958756">)</span><span class="op" id="6958757">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6958760">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6958763">if</span>&nbsp;<span class="ident" id="6958766">reply</span><span class="op" id="6958771">.</span><span class="ident" id="6958772">C</span>&nbsp;<span class="op" id="6958774">!=</span>&nbsp;<span class="ident" id="6958777">args</span><span class="op" id="6958781">.</span><span class="ident" id="6958782">A</span><span class="op" id="6958783">*</span><span class="ident" id="6958784">args</span><span class="op" id="6958788">.</span><span class="ident" id="6958789">B</span>&nbsp;<span class="op" id="6958791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6958795">t</span><span class="op" id="6958796">.</span><span class="ident" id="6958797">Errorf</span><span class="op" id="6958803">(</span><span class="string" id="6958804">&#34;Mul:&nbsp;got&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="6958829">,</span>&nbsp;<span class="ident" id="6958831">reply</span><span class="op" id="6958836">.</span><span class="ident" id="6958837">C</span><span class="op" id="6958838">,</span>&nbsp;<span class="ident" id="6958840">args</span><span class="op" id="6958844">.</span><span class="ident" id="6958845">A</span><span class="op" id="6958846">*</span><span class="ident" id="6958847">args</span><span class="op" id="6958851">.</span><span class="ident" id="6958852">B</span><span class="op" id="6958853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6958856">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6958860">//&nbsp;Out&nbsp;of&nbsp;order.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6958878">args</span>&nbsp;<span class="op" id="6958883">=</span>&nbsp;<span class="op" id="6958885">&amp;</span><span class="ident" id="6958886">Args</span><span class="op" id="6958890">{</span><span class="num" id="6958891">7</span><span class="op" id="6958892">,</span>&nbsp;<span class="num" id="6958894">8</span><span class="op" id="6958895">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6958898">mulReply</span>&nbsp;<span class="op" id="6958907">:=</span>&nbsp;<span class="builtinfunc" id="6958910">new</span><span class="op" id="6958913">(</span><span class="ident" id="6958914">Reply</span><span class="op" id="6958919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6958922">mulCall</span>&nbsp;<span class="op" id="6958930">:=</span>&nbsp;<span class="ident" id="6958933">client</span><span class="op" id="6958939">.</span><span class="ident" id="6958940">Go</span><span class="op" id="6958942">(</span><span class="string" id="6958943">&#34;Arith.Mul&#34;</span><span class="op" id="6958954">,</span>&nbsp;<span class="ident" id="6958956">args</span><span class="op" id="6958960">,</span>&nbsp;<span class="ident" id="6958962">mulReply</span><span class="op" id="6958970">,</span>&nbsp;<span class="ident" id="6958972">nil</span><span class="op" id="6958975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6958978">addReply</span>&nbsp;<span class="op" id="6958987">:=</span>&nbsp;<span class="builtinfunc" id="6958990">new</span><span class="op" id="6958993">(</span><span class="ident" id="6958994">Reply</span><span class="op" id="6958999">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6959002">addCall</span>&nbsp;<span class="op" id="6959010">:=</span>&nbsp;<span class="ident" id="6959013">client</span><span class="op" id="6959019">.</span><span class="ident" id="6959020">Go</span><span class="op" id="6959022">(</span><span class="string" id="6959023">&#34;Arith.Add&#34;</span><span class="op" id="6959034">,</span>&nbsp;<span class="ident" id="6959036">args</span><span class="op" id="6959040">,</span>&nbsp;<span class="ident" id="6959042">addReply</span><span class="op" id="6959050">,</span>&nbsp;<span class="ident" id="6959052">nil</span><span class="op" id="6959055">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6959059">addCall</span>&nbsp;<span class="op" id="6959067">=</span>&nbsp;<span class="op" id="6959069">&lt;-</span><span class="ident" id="6959071">addCall</span><span class="op" id="6959078">.</span><span class="ident" id="6959079">Done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6959085">if</span>&nbsp;<span class="ident" id="6959088">addCall</span><span class="op" id="6959095">.</span><span class="ident" id="6959096">Error</span>&nbsp;<span class="op" id="6959102">!=</span>&nbsp;<span class="ident" id="6959105">nil</span>&nbsp;<span class="op" id="6959109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6959113">t</span><span class="op" id="6959114">.</span><span class="ident" id="6959115">Errorf</span><span class="op" id="6959121">(</span><span class="string" id="6959122">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6959164">,</span>&nbsp;<span class="ident" id="6959166">addCall</span><span class="op" id="6959173">.</span><span class="ident" id="6959174">Error</span><span class="op" id="6959179">.</span><span class="ident" id="6959180">Error</span><span class="op" id="6959185">(</span><span class="op" id="6959186">)</span><span class="op" id="6959187">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6959190">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6959193">if</span>&nbsp;<span class="ident" id="6959196">addReply</span><span class="op" id="6959204">.</span><span class="ident" id="6959205">C</span>&nbsp;<span class="op" id="6959207">!=</span>&nbsp;<span class="ident" id="6959210">args</span><span class="op" id="6959214">.</span><span class="ident" id="6959215">A</span><span class="op" id="6959216">+</span><span class="ident" id="6959217">args</span><span class="op" id="6959221">.</span><span class="ident" id="6959222">B</span>&nbsp;<span class="op" id="6959224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6959228">t</span><span class="op" id="6959229">.</span><span class="ident" id="6959230">Errorf</span><span class="op" id="6959236">(</span><span class="string" id="6959237">&#34;Add:&nbsp;got&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="6959262">,</span>&nbsp;<span class="ident" id="6959264">addReply</span><span class="op" id="6959272">.</span><span class="ident" id="6959273">C</span><span class="op" id="6959274">,</span>&nbsp;<span class="ident" id="6959276">args</span><span class="op" id="6959280">.</span><span class="ident" id="6959281">A</span><span class="op" id="6959282">+</span><span class="ident" id="6959283">args</span><span class="op" id="6959287">.</span><span class="ident" id="6959288">B</span><span class="op" id="6959289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6959292">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6959296">mulCall</span>&nbsp;<span class="op" id="6959304">=</span>&nbsp;<span class="op" id="6959306">&lt;-</span><span class="ident" id="6959308">mulCall</span><span class="op" id="6959315">.</span><span class="ident" id="6959316">Done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6959322">if</span>&nbsp;<span class="ident" id="6959325">mulCall</span><span class="op" id="6959332">.</span><span class="ident" id="6959333">Error</span>&nbsp;<span class="op" id="6959339">!=</span>&nbsp;<span class="ident" id="6959342">nil</span>&nbsp;<span class="op" id="6959346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6959350">t</span><span class="op" id="6959351">.</span><span class="ident" id="6959352">Errorf</span><span class="op" id="6959358">(</span><span class="string" id="6959359">&#34;Mul:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="6959401">,</span>&nbsp;<span class="ident" id="6959403">mulCall</span><span class="op" id="6959410">.</span><span class="ident" id="6959411">Error</span><span class="op" id="6959416">.</span><span class="ident" id="6959417">Error</span><span class="op" id="6959422">(</span><span class="op" id="6959423">)</span><span class="op" id="6959424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6959427">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6959430">if</span>&nbsp;<span class="ident" id="6959433">mulReply</span><span class="op" id="6959441">.</span><span class="ident" id="6959442">C</span>&nbsp;<span class="op" id="6959444">!=</span>&nbsp;<span class="ident" id="6959447">args</span><span class="op" id="6959451">.</span><span class="ident" id="6959452">A</span><span class="op" id="6959453">*</span><span class="ident" id="6959454">args</span><span class="op" id="6959458">.</span><span class="ident" id="6959459">B</span>&nbsp;<span class="op" id="6959461">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6959465">t</span><span class="op" id="6959466">.</span><span class="ident" id="6959467">Errorf</span><span class="op" id="6959473">(</span><span class="string" id="6959474">&#34;Mul:&nbsp;got&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="6959499">,</span>&nbsp;<span class="ident" id="6959501">mulReply</span><span class="op" id="6959509">.</span><span class="ident" id="6959510">C</span><span class="op" id="6959511">,</span>&nbsp;<span class="ident" id="6959513">args</span><span class="op" id="6959517">.</span><span class="ident" id="6959518">A</span><span class="op" id="6959519">*</span><span class="ident" id="6959520">args</span><span class="op" id="6959524">.</span><span class="ident" id="6959525">B</span><span class="op" id="6959526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6959529">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6959533">//&nbsp;Error&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6959548">args</span>&nbsp;<span class="op" id="6959553">=</span>&nbsp;<span class="op" id="6959555">&amp;</span><span class="ident" id="6959556">Args</span><span class="op" id="6959560">{</span><span class="num" id="6959561">7</span><span class="op" id="6959562">,</span>&nbsp;<span class="num" id="6959564">0</span><span class="op" id="6959565">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6959568">reply</span>&nbsp;<span class="op" id="6959574">=</span>&nbsp;<span class="builtinfunc" id="6959576">new</span><span class="op" id="6959579">(</span><span class="ident" id="6959580">Reply</span><span class="op" id="6959585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6959588">err</span>&nbsp;<span class="op" id="6959592">=</span>&nbsp;<span class="ident" id="6959594">client</span><span class="op" id="6959600">.</span><span class="ident" id="6959601">Call</span><span class="op" id="6959605">(</span><span class="string" id="6959606">&#34;Arith.Div&#34;</span><span class="op" id="6959617">,</span>&nbsp;<span class="ident" id="6959619">args</span><span class="op" id="6959623">,</span>&nbsp;<span class="ident" id="6959625">reply</span><span class="op" id="6959630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6959633">//&nbsp;expect&nbsp;an&nbsp;error:&nbsp;zero&nbsp;divide</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6959666">if</span>&nbsp;<span class="ident" id="6959669">err</span>&nbsp;<span class="op" id="6959673">==</span>&nbsp;<span class="ident" id="6959676">nil</span>&nbsp;<span class="op" id="6959680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6959684">t</span><span class="op" id="6959685">.</span><span class="ident" id="6959686">Error</span><span class="op" id="6959691">(</span><span class="string" id="6959692">&#34;Div:&nbsp;expected&nbsp;error&#34;</span><span class="op" id="6959713">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6959716">}</span>&nbsp;<span class="keyword" id="6959718">else</span>&nbsp;<span class="keyword" id="6959723">if</span>&nbsp;<span class="ident" id="6959726">err</span><span class="op" id="6959729">.</span><span class="ident" id="6959730">Error</span><span class="op" id="6959735">(</span><span class="op" id="6959736">)</span>&nbsp;<span class="op" id="6959738">!=</span>&nbsp;<span class="string" id="6959741">&#34;divide&nbsp;by&nbsp;zero&#34;</span>&nbsp;<span class="op" id="6959758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6959762">t</span><span class="op" id="6959763">.</span><span class="ident" id="6959764">Error</span><span class="op" id="6959769">(</span><span class="string" id="6959770">&#34;Div:&nbsp;expected&nbsp;divide&nbsp;by&nbsp;zero&nbsp;error;&nbsp;got&#34;</span><span class="op" id="6959811">,</span>&nbsp;<span class="ident" id="6959813">err</span><span class="op" id="6959816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6959819">}</span><br>
<span class="lineno"></span><span class="op" id="6959821">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="keyword" id="6959824">func</span>&nbsp;<span class="ident" id="6959829">TestMalformedInput</span><span class="op" id="6959847">(</span><span class="ident" id="6959848">t</span>&nbsp;<span class="op" id="6959850">*</span><span class="ident" id="6959851">testing</span><span class="op" id="6959858">.</span><span class="ident" id="6959859">T</span><span class="op" id="6959860">)</span>&nbsp;<span class="op" id="6959862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6959865">cli</span><span class="op" id="6959868">,</span>&nbsp;<span class="ident" id="6959870">srv</span>&nbsp;<span class="op" id="6959874">:=</span>&nbsp;<span class="ident" id="6959877">net</span><span class="op" id="6959880">.</span><span class="ident" id="6959881">Pipe</span><span class="op" id="6959885">(</span><span class="op" id="6959886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6959889">go</span>&nbsp;<span class="ident" id="6959892">cli</span><span class="op" id="6959895">.</span><span class="ident" id="6959896">Write</span><span class="op" id="6959901">(</span><span class="op" id="6959902">[</span><span class="op" id="6959903">]</span><span class="builtintype" id="6959904">byte</span><span class="op" id="6959908">(</span><span class="string" id="6959909">`{id:1}`</span><span class="op" id="6959917">)</span><span class="op" id="6959918">)</span>&nbsp;<span class="comment" id="6959920">//&nbsp;invalid&nbsp;json</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6959937">ServeConn</span><span class="op" id="6959946">(</span><span class="ident" id="6959947">srv</span><span class="op" id="6959950">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6959968">//&nbsp;must&nbsp;return,&nbsp;not&nbsp;loop</span><br>
<span class="lineno"></span><span class="op" id="6959993">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="keyword" id="6959996">func</span>&nbsp;<span class="ident" id="6960001">TestMalformedOutput</span><span class="op" id="6960020">(</span><span class="ident" id="6960021">t</span>&nbsp;<span class="op" id="6960023">*</span><span class="ident" id="6960024">testing</span><span class="op" id="6960031">.</span><span class="ident" id="6960032">T</span><span class="op" id="6960033">)</span>&nbsp;<span class="op" id="6960035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6960038">cli</span><span class="op" id="6960041">,</span>&nbsp;<span class="ident" id="6960043">srv</span>&nbsp;<span class="op" id="6960047">:=</span>&nbsp;<span class="ident" id="6960050">net</span><span class="op" id="6960053">.</span><span class="ident" id="6960054">Pipe</span><span class="op" id="6960058">(</span><span class="op" id="6960059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6960062">go</span>&nbsp;<span class="ident" id="6960065">srv</span><span class="op" id="6960068">.</span><span class="ident" id="6960069">Write</span><span class="op" id="6960074">(</span><span class="op" id="6960075">[</span><span class="op" id="6960076">]</span><span class="builtintype" id="6960077">byte</span><span class="op" id="6960081">(</span><span class="string" id="6960082">`{&#34;id&#34;:0,&#34;result&#34;:null,&#34;error&#34;:null}`</span><span class="op" id="6960119">)</span><span class="op" id="6960120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6960123">go</span>&nbsp;<span class="ident" id="6960126">ioutil</span><span class="op" id="6960132">.</span><span class="ident" id="6960133">ReadAll</span><span class="op" id="6960140">(</span><span class="ident" id="6960141">srv</span><span class="op" id="6960144">)</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6960148">client</span>&nbsp;<span class="op" id="6960155">:=</span>&nbsp;<span class="ident" id="6960158">NewClient</span><span class="op" id="6960167">(</span><span class="ident" id="6960168">cli</span><span class="op" id="6960171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6960174">defer</span>&nbsp;<span class="ident" id="6960180">client</span><span class="op" id="6960186">.</span><span class="ident" id="6960187">Close</span><span class="op" id="6960192">(</span><span class="op" id="6960193">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6960197">args</span>&nbsp;<span class="op" id="6960202">:=</span>&nbsp;<span class="op" id="6960205">&amp;</span><span class="ident" id="6960206">Args</span><span class="op" id="6960210">{</span><span class="num" id="6960211">7</span><span class="op" id="6960212">,</span>&nbsp;<span class="num" id="6960214">8</span><span class="op" id="6960215">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6960218">reply</span>&nbsp;<span class="op" id="6960224">:=</span>&nbsp;<span class="builtinfunc" id="6960227">new</span><span class="op" id="6960230">(</span><span class="ident" id="6960231">Reply</span><span class="op" id="6960236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6960239">err</span>&nbsp;<span class="op" id="6960243">:=</span>&nbsp;<span class="ident" id="6960246">client</span><span class="op" id="6960252">.</span><span class="ident" id="6960253">Call</span><span class="op" id="6960257">(</span><span class="string" id="6960258">&#34;Arith.Add&#34;</span><span class="op" id="6960269">,</span>&nbsp;<span class="ident" id="6960271">args</span><span class="op" id="6960275">,</span>&nbsp;<span class="ident" id="6960277">reply</span><span class="op" id="6960282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6960285">if</span>&nbsp;<span class="ident" id="6960288">err</span>&nbsp;<span class="op" id="6960292">==</span>&nbsp;<span class="ident" id="6960295">nil</span>&nbsp;<span class="op" id="6960299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6960303">t</span><span class="op" id="6960304">.</span><span class="ident" id="6960305">Error</span><span class="op" id="6960310">(</span><span class="string" id="6960311">&#34;expected&nbsp;error&#34;</span><span class="op" id="6960327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6960330">}</span><br>
<span class="lineno">205</span><span class="op" id="6960332">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6960335">func</span>&nbsp;<span class="ident" id="6960340">TestServerErrorHasNullResult</span><span class="op" id="6960368">(</span><span class="ident" id="6960369">t</span>&nbsp;<span class="op" id="6960371">*</span><span class="ident" id="6960372">testing</span><span class="op" id="6960379">.</span><span class="ident" id="6960380">T</span><span class="op" id="6960381">)</span>&nbsp;<span class="op" id="6960383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6960386">var</span>&nbsp;<span class="ident" id="6960390">out</span>&nbsp;<span class="ident" id="6960394">bytes</span><span class="op" id="6960399">.</span><span class="ident" id="6960400">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6960408">sc</span>&nbsp;<span class="op" id="6960411">:=</span>&nbsp;<span class="ident" id="6960414">NewServerCodec</span><span class="op" id="6960428">(</span><span class="keyword" id="6960429">struct</span>&nbsp;<span class="op" id="6960436">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6960440">io</span><span class="op" id="6960442">.</span><span class="ident" id="6960443">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6960452">io</span><span class="op" id="6960454">.</span><span class="ident" id="6960455">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6960464">io</span><span class="op" id="6960466">.</span><span class="ident" id="6960467">Closer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6960475">}</span><span class="op" id="6960476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6960480">Reader</span><span class="op" id="6960486">:</span>&nbsp;<span class="ident" id="6960488">strings</span><span class="op" id="6960495">.</span><span class="ident" id="6960496">NewReader</span><span class="op" id="6960505">(</span><span class="string" id="6960506">`{&#34;method&#34;:&nbsp;&#34;Arith.Add&#34;,&nbsp;&#34;id&#34;:&nbsp;&#34;123&#34;,&nbsp;&#34;params&#34;:&nbsp;[]}`</span><span class="op" id="6960558">)</span><span class="op" id="6960559">,</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6960563">Writer</span><span class="op" id="6960569">:</span>&nbsp;<span class="op" id="6960571">&amp;</span><span class="ident" id="6960572">out</span><span class="op" id="6960575">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6960579">Closer</span><span class="op" id="6960585">:</span>&nbsp;<span class="ident" id="6960587">ioutil</span><span class="op" id="6960593">.</span><span class="ident" id="6960594">NopCloser</span><span class="op" id="6960603">(</span><span class="ident" id="6960604">nil</span><span class="op" id="6960607">)</span><span class="op" id="6960608">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6960611">}</span><span class="op" id="6960612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6960615">r</span>&nbsp;<span class="op" id="6960617">:=</span>&nbsp;<span class="builtinfunc" id="6960620">new</span><span class="op" id="6960623">(</span><span class="ident" id="6960624">rpc</span><span class="op" id="6960627">.</span><span class="ident" id="6960628">Request</span><span class="op" id="6960635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6960638">if</span>&nbsp;<span class="ident" id="6960641">err</span>&nbsp;<span class="op" id="6960645">:=</span>&nbsp;<span class="ident" id="6960648">sc</span><span class="op" id="6960650">.</span><span class="ident" id="6960651">ReadRequestHeader</span><span class="op" id="6960668">(</span><span class="ident" id="6960669">r</span><span class="op" id="6960670">)</span><span class="op" id="6960671">;</span>&nbsp;<span class="ident" id="6960673">err</span>&nbsp;<span class="op" id="6960677">!=</span>&nbsp;<span class="ident" id="6960680">nil</span>&nbsp;<span class="op" id="6960684">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6960688">t</span><span class="op" id="6960689">.</span><span class="ident" id="6960690">Fatal</span><span class="op" id="6960695">(</span><span class="ident" id="6960696">err</span><span class="op" id="6960699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6960702">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6960705">const</span>&nbsp;<span class="ident" id="6960711">valueText</span>&nbsp;<span class="op" id="6960721">=</span>&nbsp;<span class="string" id="6960723">&#34;the&nbsp;value&nbsp;we&nbsp;don&#39;t&nbsp;want&nbsp;to&nbsp;see&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6960757">const</span>&nbsp;<span class="ident" id="6960763">errorText</span>&nbsp;<span class="op" id="6960773">=</span>&nbsp;<span class="string" id="6960775">&#34;some&nbsp;error&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6960789">err</span>&nbsp;<span class="op" id="6960793">:=</span>&nbsp;<span class="ident" id="6960796">sc</span><span class="op" id="6960798">.</span><span class="ident" id="6960799">WriteResponse</span><span class="op" id="6960812">(</span><span class="op" id="6960813">&amp;</span><span class="ident" id="6960814">rpc</span><span class="op" id="6960817">.</span><span class="ident" id="6960818">Response</span><span class="op" id="6960826">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6960830">ServiceMethod</span><span class="op" id="6960843">:</span>&nbsp;<span class="string" id="6960845">&#34;Method&#34;</span><span class="op" id="6960853">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6960857">Seq</span><span class="op" id="6960860">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6960872">1</span><span class="op" id="6960873">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6960877">Error</span><span class="op" id="6960882">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6960892">errorText</span><span class="op" id="6960901">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6960904">}</span><span class="op" id="6960905">,</span>&nbsp;<span class="ident" id="6960907">valueText</span><span class="op" id="6960916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6960919">if</span>&nbsp;<span class="ident" id="6960922">err</span>&nbsp;<span class="op" id="6960926">!=</span>&nbsp;<span class="ident" id="6960929">nil</span>&nbsp;<span class="op" id="6960933">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6960937">t</span><span class="op" id="6960938">.</span><span class="ident" id="6960939">Fatal</span><span class="op" id="6960944">(</span><span class="ident" id="6960945">err</span><span class="op" id="6960948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6960951">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6960954">if</span>&nbsp;<span class="op" id="6960957">!</span><span class="ident" id="6960958">strings</span><span class="op" id="6960965">.</span><span class="ident" id="6960966">Contains</span><span class="op" id="6960974">(</span><span class="ident" id="6960975">out</span><span class="op" id="6960978">.</span><span class="ident" id="6960979">String</span><span class="op" id="6960985">(</span><span class="op" id="6960986">)</span><span class="op" id="6960987">,</span>&nbsp;<span class="ident" id="6960989">errorText</span><span class="op" id="6960998">)</span>&nbsp;<span class="op" id="6961000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6961004">t</span><span class="op" id="6961005">.</span><span class="ident" id="6961006">Fatalf</span><span class="op" id="6961012">(</span><span class="string" id="6961013">&#34;Response&nbsp;didn&#39;t&nbsp;contain&nbsp;expected&nbsp;error&nbsp;%q:&nbsp;%s&#34;</span><span class="op" id="6961060">,</span>&nbsp;<span class="ident" id="6961062">errorText</span><span class="op" id="6961071">,</span>&nbsp;<span class="op" id="6961073">&amp;</span><span class="ident" id="6961074">out</span><span class="op" id="6961077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6961080">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6961083">if</span>&nbsp;<span class="ident" id="6961086">strings</span><span class="op" id="6961093">.</span><span class="ident" id="6961094">Contains</span><span class="op" id="6961102">(</span><span class="ident" id="6961103">out</span><span class="op" id="6961106">.</span><span class="ident" id="6961107">String</span><span class="op" id="6961113">(</span><span class="op" id="6961114">)</span><span class="op" id="6961115">,</span>&nbsp;<span class="ident" id="6961117">valueText</span><span class="op" id="6961126">)</span>&nbsp;<span class="op" id="6961128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6961132">t</span><span class="op" id="6961133">.</span><span class="ident" id="6961134">Errorf</span><span class="op" id="6961140">(</span><span class="string" id="6961141">&#34;Response&nbsp;contains&nbsp;both&nbsp;an&nbsp;error&nbsp;and&nbsp;value:&nbsp;%s&#34;</span><span class="op" id="6961188">,</span>&nbsp;<span class="op" id="6961190">&amp;</span><span class="ident" id="6961191">out</span><span class="op" id="6961194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6961197">}</span><br>
<span class="lineno"></span><span class="op" id="6961199">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="keyword" id="6961202">func</span>&nbsp;<span class="ident" id="6961207">TestUnexpectedError</span><span class="op" id="6961226">(</span><span class="ident" id="6961227">t</span>&nbsp;<span class="op" id="6961229">*</span><span class="ident" id="6961230">testing</span><span class="op" id="6961237">.</span><span class="ident" id="6961238">T</span><span class="op" id="6961239">)</span>&nbsp;<span class="op" id="6961241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6961244">cli</span><span class="op" id="6961247">,</span>&nbsp;<span class="ident" id="6961249">srv</span>&nbsp;<span class="op" id="6961253">:=</span>&nbsp;<span class="ident" id="6961256">myPipe</span><span class="op" id="6961262">(</span><span class="op" id="6961263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6961266">go</span>&nbsp;<span class="ident" id="6961269">cli</span><span class="op" id="6961272">.</span><span class="ident" id="6961273">PipeWriter</span><span class="op" id="6961283">.</span><span class="ident" id="6961284">CloseWithError</span><span class="op" id="6961298">(</span><span class="ident" id="6961299">errors</span><span class="op" id="6961305">.</span><span class="ident" id="6961306">New</span><span class="op" id="6961309">(</span><span class="string" id="6961310">&#34;unexpected&nbsp;error!&#34;</span><span class="op" id="6961329">)</span><span class="op" id="6961330">)</span>&nbsp;<span class="comment" id="6961332">//&nbsp;reader&nbsp;will&nbsp;get&nbsp;this&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6961363">ServeConn</span><span class="op" id="6961372">(</span><span class="ident" id="6961373">srv</span><span class="op" id="6961376">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6961429">//&nbsp;must&nbsp;return,&nbsp;not&nbsp;loop</span><br>
<span class="lineno"></span><span class="op" id="6961454">}</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="comment" id="6961457">//&nbsp;Copied&nbsp;from&nbsp;package&nbsp;net.</span><br>
<span class="lineno"></span><span class="keyword" id="6961485">func</span>&nbsp;<span class="ident" id="6961490">myPipe</span><span class="op" id="6961496">(</span><span class="op" id="6961497">)</span>&nbsp;<span class="op" id="6961499">(</span><span class="op" id="6961500">*</span><span class="ident" id="6961501">pipe</span><span class="op" id="6961505">,</span>&nbsp;<span class="op" id="6961507">*</span><span class="ident" id="6961508">pipe</span><span class="op" id="6961512">)</span>&nbsp;<span class="op" id="6961514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6961517">r1</span><span class="op" id="6961519">,</span>&nbsp;<span class="ident" id="6961521">w1</span>&nbsp;<span class="op" id="6961524">:=</span>&nbsp;<span class="ident" id="6961527">io</span><span class="op" id="6961529">.</span><span class="ident" id="6961530">Pipe</span><span class="op" id="6961534">(</span><span class="op" id="6961535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6961538">r2</span><span class="op" id="6961540">,</span>&nbsp;<span class="ident" id="6961542">w2</span>&nbsp;<span class="op" id="6961545">:=</span>&nbsp;<span class="ident" id="6961548">io</span><span class="op" id="6961550">.</span><span class="ident" id="6961551">Pipe</span><span class="op" id="6961555">(</span><span class="op" id="6961556">)</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6961560">return</span>&nbsp;<span class="op" id="6961567">&amp;</span><span class="ident" id="6961568">pipe</span><span class="op" id="6961572">{</span><span class="ident" id="6961573">r1</span><span class="op" id="6961575">,</span>&nbsp;<span class="ident" id="6961577">w2</span><span class="op" id="6961579">}</span><span class="op" id="6961580">,</span>&nbsp;<span class="op" id="6961582">&amp;</span><span class="ident" id="6961583">pipe</span><span class="op" id="6961587">{</span><span class="ident" id="6961588">r2</span><span class="op" id="6961590">,</span>&nbsp;<span class="ident" id="6961592">w1</span><span class="op" id="6961594">}</span><br>
<span class="lineno"></span><span class="op" id="6961596">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6961599">type</span>&nbsp;<span class="ident" id="6961604">pipe</span>&nbsp;<span class="keyword" id="6961609">struct</span>&nbsp;<span class="op" id="6961616">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6961619">*</span><span class="ident" id="6961620">io</span><span class="op" id="6961622">.</span><span class="ident" id="6961623">PipeReader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6961635">*</span><span class="ident" id="6961636">io</span><span class="op" id="6961638">.</span><span class="ident" id="6961639">PipeWriter</span><br>
<span class="lineno"></span><span class="op" id="6961650">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6961653">type</span>&nbsp;<span class="ident" id="6961658">pipeAddr</span>&nbsp;<span class="builtintype" id="6961667">int</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span><span class="keyword" id="6961672">func</span>&nbsp;<span class="op" id="6961677">(</span><span class="ident" id="6961678">pipeAddr</span><span class="op" id="6961686">)</span>&nbsp;<span class="ident" id="6961688">Network</span><span class="op" id="6961695">(</span><span class="op" id="6961696">)</span>&nbsp;<span class="builtintype" id="6961698">string</span>&nbsp;<span class="op" id="6961705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6961708">return</span>&nbsp;<span class="string" id="6961715">&#34;pipe&#34;</span><br>
<span class="lineno"></span><span class="op" id="6961722">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">265</span><span class="keyword" id="6961725">func</span>&nbsp;<span class="op" id="6961730">(</span><span class="ident" id="6961731">pipeAddr</span><span class="op" id="6961739">)</span>&nbsp;<span class="ident" id="6961741">String</span><span class="op" id="6961747">(</span><span class="op" id="6961748">)</span>&nbsp;<span class="builtintype" id="6961750">string</span>&nbsp;<span class="op" id="6961757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6961760">return</span>&nbsp;<span class="string" id="6961767">&#34;pipe&#34;</span><br>
<span class="lineno"></span><span class="op" id="6961774">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6961777">func</span>&nbsp;<span class="op" id="6961782">(</span><span class="ident" id="6961783">p</span>&nbsp;<span class="op" id="6961785">*</span><span class="ident" id="6961786">pipe</span><span class="op" id="6961790">)</span>&nbsp;<span class="ident" id="6961792">Close</span><span class="op" id="6961797">(</span><span class="op" id="6961798">)</span>&nbsp;<span class="builtintype" id="6961800">error</span>&nbsp;<span class="op" id="6961806">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6961809">err</span>&nbsp;<span class="op" id="6961813">:=</span>&nbsp;<span class="ident" id="6961816">p</span><span class="op" id="6961817">.</span><span class="ident" id="6961818">PipeReader</span><span class="op" id="6961828">.</span><span class="ident" id="6961829">Close</span><span class="op" id="6961834">(</span><span class="op" id="6961835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6961838">err1</span>&nbsp;<span class="op" id="6961843">:=</span>&nbsp;<span class="ident" id="6961846">p</span><span class="op" id="6961847">.</span><span class="ident" id="6961848">PipeWriter</span><span class="op" id="6961858">.</span><span class="ident" id="6961859">Close</span><span class="op" id="6961864">(</span><span class="op" id="6961865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6961868">if</span>&nbsp;<span class="ident" id="6961871">err</span>&nbsp;<span class="op" id="6961875">==</span>&nbsp;<span class="ident" id="6961878">nil</span>&nbsp;<span class="op" id="6961882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6961886">err</span>&nbsp;<span class="op" id="6961890">=</span>&nbsp;<span class="ident" id="6961892">err1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6961898">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6961901">return</span>&nbsp;<span class="ident" id="6961908">err</span><br>
<span class="lineno"></span><span class="op" id="6961912">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6961915">func</span>&nbsp;<span class="op" id="6961920">(</span><span class="ident" id="6961921">p</span>&nbsp;<span class="op" id="6961923">*</span><span class="ident" id="6961924">pipe</span><span class="op" id="6961928">)</span>&nbsp;<span class="ident" id="6961930">LocalAddr</span><span class="op" id="6961939">(</span><span class="op" id="6961940">)</span>&nbsp;<span class="ident" id="6961942">net</span><span class="op" id="6961945">.</span><span class="ident" id="6961946">Addr</span>&nbsp;<span class="op" id="6961951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6961954">return</span>&nbsp;<span class="ident" id="6961961">pipeAddr</span><span class="op" id="6961969">(</span><span class="num" id="6961970">0</span><span class="op" id="6961971">)</span><br>
<span class="lineno">280</span><span class="op" id="6961973">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6961976">func</span>&nbsp;<span class="op" id="6961981">(</span><span class="ident" id="6961982">p</span>&nbsp;<span class="op" id="6961984">*</span><span class="ident" id="6961985">pipe</span><span class="op" id="6961989">)</span>&nbsp;<span class="ident" id="6961991">RemoteAddr</span><span class="op" id="6962001">(</span><span class="op" id="6962002">)</span>&nbsp;<span class="ident" id="6962004">net</span><span class="op" id="6962007">.</span><span class="ident" id="6962008">Addr</span>&nbsp;<span class="op" id="6962013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6962016">return</span>&nbsp;<span class="ident" id="6962023">pipeAddr</span><span class="op" id="6962031">(</span><span class="num" id="6962032">0</span><span class="op" id="6962033">)</span><br>
<span class="lineno"></span><span class="op" id="6962035">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span><span class="keyword" id="6962038">func</span>&nbsp;<span class="op" id="6962043">(</span><span class="ident" id="6962044">p</span>&nbsp;<span class="op" id="6962046">*</span><span class="ident" id="6962047">pipe</span><span class="op" id="6962051">)</span>&nbsp;<span class="ident" id="6962053">SetTimeout</span><span class="op" id="6962063">(</span><span class="ident" id="6962064">nsec</span>&nbsp;<span class="ident" id="6962069">int64</span><span class="op" id="6962074">)</span>&nbsp;<span class="builtintype" id="6962076">error</span>&nbsp;<span class="op" id="6962082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6962085">return</span>&nbsp;<span class="ident" id="6962092">errors</span><span class="op" id="6962098">.</span><span class="ident" id="6962099">New</span><span class="op" id="6962102">(</span><span class="string" id="6962103">&#34;net.Pipe&nbsp;does&nbsp;not&nbsp;support&nbsp;timeouts&#34;</span><span class="op" id="6962139">)</span><br>
<span class="lineno"></span><span class="op" id="6962141">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">290</span><span class="keyword" id="6962144">func</span>&nbsp;<span class="op" id="6962149">(</span><span class="ident" id="6962150">p</span>&nbsp;<span class="op" id="6962152">*</span><span class="ident" id="6962153">pipe</span><span class="op" id="6962157">)</span>&nbsp;<span class="ident" id="6962159">SetReadTimeout</span><span class="op" id="6962173">(</span><span class="ident" id="6962174">nsec</span>&nbsp;<span class="ident" id="6962179">int64</span><span class="op" id="6962184">)</span>&nbsp;<span class="builtintype" id="6962186">error</span>&nbsp;<span class="op" id="6962192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6962195">return</span>&nbsp;<span class="ident" id="6962202">errors</span><span class="op" id="6962208">.</span><span class="ident" id="6962209">New</span><span class="op" id="6962212">(</span><span class="string" id="6962213">&#34;net.Pipe&nbsp;does&nbsp;not&nbsp;support&nbsp;timeouts&#34;</span><span class="op" id="6962249">)</span><br>
<span class="lineno"></span><span class="op" id="6962251">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6962254">func</span>&nbsp;<span class="op" id="6962259">(</span><span class="ident" id="6962260">p</span>&nbsp;<span class="op" id="6962262">*</span><span class="ident" id="6962263">pipe</span><span class="op" id="6962267">)</span>&nbsp;<span class="ident" id="6962269">SetWriteTimeout</span><span class="op" id="6962284">(</span><span class="ident" id="6962285">nsec</span>&nbsp;<span class="ident" id="6962290">int64</span><span class="op" id="6962295">)</span>&nbsp;<span class="builtintype" id="6962297">error</span>&nbsp;<span class="op" id="6962303">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6962306">return</span>&nbsp;<span class="ident" id="6962313">errors</span><span class="op" id="6962319">.</span><span class="ident" id="6962320">New</span><span class="op" id="6962323">(</span><span class="string" id="6962324">&#34;net.Pipe&nbsp;does&nbsp;not&nbsp;support&nbsp;timeouts&#34;</span><span class="op" id="6962360">)</span><br>
<span class="lineno"></span><span class="op" id="6962362">}</span>
</div>
</body>
</html>
