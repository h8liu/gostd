<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/jpeg</h2>
<ul>
<li><a href="/gostd/image/jpeg/dct_test.go.html">dct_test.go</a></li>
<li><a href="/gostd/image/jpeg/fdct.go.html">fdct.go</a></li>
<li><a href="/gostd/image/jpeg/huffman.go.html">huffman.go</a></li>
<li><a href="/gostd/image/jpeg/idct.go.html">idct.go</a></li>
<li><a href="/gostd/image/jpeg/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/jpeg/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/jpeg/scan.go.html">scan.go</a></li>
<li><a href="/gostd/image/jpeg/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/jpeg/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5953327">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5953382">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5953436">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5953487">package</span>&nbsp;<span class="ident" id="5953495">jpeg</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5953501">import</span>&nbsp;<span class="op" id="5953508">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5953511">&#34;image&#34;</span><br>
<span class="lineno"></span><span class="op" id="5953519">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="5953522">//&nbsp;makeImg&nbsp;allocates&nbsp;and&nbsp;initializes&nbsp;the&nbsp;destination&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5953582">func</span>&nbsp;<span class="op" id="5953587">(</span><span class="ident" id="5953588">d</span>&nbsp;<span class="op" id="5953590">*</span><span class="ident" id="5953591">decoder</span><span class="op" id="5953598">)</span>&nbsp;<span class="ident" id="5953600">makeImg</span><span class="op" id="5953607">(</span><span class="ident" id="5953608">h0</span><span class="op" id="5953610">,</span>&nbsp;<span class="ident" id="5953612">v0</span><span class="op" id="5953614">,</span>&nbsp;<span class="ident" id="5953616">mxx</span><span class="op" id="5953619">,</span>&nbsp;<span class="ident" id="5953621">myy</span>&nbsp;<span class="builtintype" id="5953625">int</span><span class="op" id="5953628">)</span>&nbsp;<span class="op" id="5953630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5953633">if</span>&nbsp;<span class="ident" id="5953636">d</span><span class="op" id="5953637">.</span><span class="ident" id="5953638">nComp</span>&nbsp;<span class="op" id="5953644">==</span>&nbsp;<span class="ident" id="5953647">nGrayComponent</span>&nbsp;<span class="op" id="5953662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5953666">m</span>&nbsp;<span class="op" id="5953668">:=</span>&nbsp;<span class="ident" id="5953671">image</span><span class="op" id="5953676">.</span><span class="ident" id="5953677">NewGray</span><span class="op" id="5953684">(</span><span class="ident" id="5953685">image</span><span class="op" id="5953690">.</span><span class="ident" id="5953691">Rect</span><span class="op" id="5953695">(</span><span class="num" id="5953696">0</span><span class="op" id="5953697">,</span>&nbsp;<span class="num" id="5953699">0</span><span class="op" id="5953700">,</span>&nbsp;<span class="num" id="5953702">8</span><span class="op" id="5953703">*</span><span class="ident" id="5953704">mxx</span><span class="op" id="5953707">,</span>&nbsp;<span class="num" id="5953709">8</span><span class="op" id="5953710">*</span><span class="ident" id="5953711">myy</span><span class="op" id="5953714">)</span><span class="op" id="5953715">)</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5953719">d</span><span class="op" id="5953720">.</span><span class="ident" id="5953721">img1</span>&nbsp;<span class="op" id="5953726">=</span>&nbsp;<span class="ident" id="5953728">m</span><span class="op" id="5953729">.</span><span class="ident" id="5953730">SubImage</span><span class="op" id="5953738">(</span><span class="ident" id="5953739">image</span><span class="op" id="5953744">.</span><span class="ident" id="5953745">Rect</span><span class="op" id="5953749">(</span><span class="num" id="5953750">0</span><span class="op" id="5953751">,</span>&nbsp;<span class="num" id="5953753">0</span><span class="op" id="5953754">,</span>&nbsp;<span class="ident" id="5953756">d</span><span class="op" id="5953757">.</span><span class="ident" id="5953758">width</span><span class="op" id="5953763">,</span>&nbsp;<span class="ident" id="5953765">d</span><span class="op" id="5953766">.</span><span class="ident" id="5953767">height</span><span class="op" id="5953773">)</span><span class="op" id="5953774">)</span><span class="op" id="5953775">.</span><span class="op" id="5953776">(</span><span class="op" id="5953777">*</span><span class="ident" id="5953778">image</span><span class="op" id="5953783">.</span><span class="ident" id="5953784">Gray</span><span class="op" id="5953788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5953792">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5953800">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5953803">var</span>&nbsp;<span class="ident" id="5953807">subsampleRatio</span>&nbsp;<span class="ident" id="5953822">image</span><span class="op" id="5953827">.</span><span class="ident" id="5953828">YCbCrSubsampleRatio</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5953849">switch</span>&nbsp;<span class="op" id="5953856">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5953859">case</span>&nbsp;<span class="ident" id="5953864">h0</span>&nbsp;<span class="op" id="5953867">==</span>&nbsp;<span class="num" id="5953870">1</span>&nbsp;<span class="op" id="5953872">&amp;&amp;</span>&nbsp;<span class="ident" id="5953875">v0</span>&nbsp;<span class="op" id="5953878">==</span>&nbsp;<span class="num" id="5953881">1</span><span class="op" id="5953882">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5953886">subsampleRatio</span>&nbsp;<span class="op" id="5953901">=</span>&nbsp;<span class="ident" id="5953903">image</span><span class="op" id="5953908">.</span><span class="ident" id="5953909">YCbCrSubsampleRatio444</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5953933">case</span>&nbsp;<span class="ident" id="5953938">h0</span>&nbsp;<span class="op" id="5953941">==</span>&nbsp;<span class="num" id="5953944">1</span>&nbsp;<span class="op" id="5953946">&amp;&amp;</span>&nbsp;<span class="ident" id="5953949">v0</span>&nbsp;<span class="op" id="5953952">==</span>&nbsp;<span class="num" id="5953955">2</span><span class="op" id="5953956">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5953960">subsampleRatio</span>&nbsp;<span class="op" id="5953975">=</span>&nbsp;<span class="ident" id="5953977">image</span><span class="op" id="5953982">.</span><span class="ident" id="5953983">YCbCrSubsampleRatio440</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5954007">case</span>&nbsp;<span class="ident" id="5954012">h0</span>&nbsp;<span class="op" id="5954015">==</span>&nbsp;<span class="num" id="5954018">2</span>&nbsp;<span class="op" id="5954020">&amp;&amp;</span>&nbsp;<span class="ident" id="5954023">v0</span>&nbsp;<span class="op" id="5954026">==</span>&nbsp;<span class="num" id="5954029">1</span><span class="op" id="5954030">:</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5954034">subsampleRatio</span>&nbsp;<span class="op" id="5954049">=</span>&nbsp;<span class="ident" id="5954051">image</span><span class="op" id="5954056">.</span><span class="ident" id="5954057">YCbCrSubsampleRatio422</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5954081">case</span>&nbsp;<span class="ident" id="5954086">h0</span>&nbsp;<span class="op" id="5954089">==</span>&nbsp;<span class="num" id="5954092">2</span>&nbsp;<span class="op" id="5954094">&amp;&amp;</span>&nbsp;<span class="ident" id="5954097">v0</span>&nbsp;<span class="op" id="5954100">==</span>&nbsp;<span class="num" id="5954103">2</span><span class="op" id="5954104">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5954108">subsampleRatio</span>&nbsp;<span class="op" id="5954123">=</span>&nbsp;<span class="ident" id="5954125">image</span><span class="op" id="5954130">.</span><span class="ident" id="5954131">YCbCrSubsampleRatio420</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5954155">default</span><span class="op" id="5954162">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5954166">panic</span><span class="op" id="5954171">(</span><span class="string" id="5954172">&#34;unreachable&#34;</span><span class="op" id="5954185">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5954188">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5954191">m</span>&nbsp;<span class="op" id="5954193">:=</span>&nbsp;<span class="ident" id="5954196">image</span><span class="op" id="5954201">.</span><span class="ident" id="5954202">NewYCbCr</span><span class="op" id="5954210">(</span><span class="ident" id="5954211">image</span><span class="op" id="5954216">.</span><span class="ident" id="5954217">Rect</span><span class="op" id="5954221">(</span><span class="num" id="5954222">0</span><span class="op" id="5954223">,</span>&nbsp;<span class="num" id="5954225">0</span><span class="op" id="5954226">,</span>&nbsp;<span class="num" id="5954228">8</span><span class="op" id="5954229">*</span><span class="ident" id="5954230">h0</span><span class="op" id="5954232">*</span><span class="ident" id="5954233">mxx</span><span class="op" id="5954236">,</span>&nbsp;<span class="num" id="5954238">8</span><span class="op" id="5954239">*</span><span class="ident" id="5954240">v0</span><span class="op" id="5954242">*</span><span class="ident" id="5954243">myy</span><span class="op" id="5954246">)</span><span class="op" id="5954247">,</span>&nbsp;<span class="ident" id="5954249">subsampleRatio</span><span class="op" id="5954263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5954266">d</span><span class="op" id="5954267">.</span><span class="ident" id="5954268">img3</span>&nbsp;<span class="op" id="5954273">=</span>&nbsp;<span class="ident" id="5954275">m</span><span class="op" id="5954276">.</span><span class="ident" id="5954277">SubImage</span><span class="op" id="5954285">(</span><span class="ident" id="5954286">image</span><span class="op" id="5954291">.</span><span class="ident" id="5954292">Rect</span><span class="op" id="5954296">(</span><span class="num" id="5954297">0</span><span class="op" id="5954298">,</span>&nbsp;<span class="num" id="5954300">0</span><span class="op" id="5954301">,</span>&nbsp;<span class="ident" id="5954303">d</span><span class="op" id="5954304">.</span><span class="ident" id="5954305">width</span><span class="op" id="5954310">,</span>&nbsp;<span class="ident" id="5954312">d</span><span class="op" id="5954313">.</span><span class="ident" id="5954314">height</span><span class="op" id="5954320">)</span><span class="op" id="5954321">)</span><span class="op" id="5954322">.</span><span class="op" id="5954323">(</span><span class="op" id="5954324">*</span><span class="ident" id="5954325">image</span><span class="op" id="5954330">.</span><span class="ident" id="5954331">YCbCr</span><span class="op" id="5954336">)</span><br>
<span class="lineno"></span><span class="op" id="5954338">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="5954341">//&nbsp;Specified&nbsp;in&nbsp;section&nbsp;B.2.3.</span><br>
<span class="lineno"></span><span class="keyword" id="5954372">func</span>&nbsp;<span class="op" id="5954377">(</span><span class="ident" id="5954378">d</span>&nbsp;<span class="op" id="5954380">*</span><span class="ident" id="5954381">decoder</span><span class="op" id="5954388">)</span>&nbsp;<span class="ident" id="5954390">processSOS</span><span class="op" id="5954400">(</span><span class="ident" id="5954401">n</span>&nbsp;<span class="builtintype" id="5954403">int</span><span class="op" id="5954406">)</span>&nbsp;<span class="builtintype" id="5954408">error</span>&nbsp;<span class="op" id="5954414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5954417">if</span>&nbsp;<span class="ident" id="5954420">d</span><span class="op" id="5954421">.</span><span class="ident" id="5954422">nComp</span>&nbsp;<span class="op" id="5954428">==</span>&nbsp;<span class="num" id="5954431">0</span>&nbsp;<span class="op" id="5954433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5954437">return</span>&nbsp;<span class="ident" id="5954444">FormatError</span><span class="op" id="5954455">(</span><span class="string" id="5954456">&#34;missing&nbsp;SOF&nbsp;marker&#34;</span><span class="op" id="5954476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5954479">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5954482">if</span>&nbsp;<span class="ident" id="5954485">n</span>&nbsp;<span class="op" id="5954487">&lt;</span>&nbsp;<span class="num" id="5954489">6</span>&nbsp;<span class="op" id="5954491">||</span>&nbsp;<span class="num" id="5954494">4</span><span class="op" id="5954495">+</span><span class="num" id="5954496">2</span><span class="op" id="5954497">*</span><span class="ident" id="5954498">d</span><span class="op" id="5954499">.</span><span class="ident" id="5954500">nComp</span>&nbsp;<span class="op" id="5954506">&lt;</span>&nbsp;<span class="ident" id="5954508">n</span>&nbsp;<span class="op" id="5954510">||</span>&nbsp;<span class="ident" id="5954513">n</span><span class="op" id="5954514">%</span><span class="num" id="5954515">2</span>&nbsp;<span class="op" id="5954517">!=</span>&nbsp;<span class="num" id="5954520">0</span>&nbsp;<span class="op" id="5954522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5954526">return</span>&nbsp;<span class="ident" id="5954533">FormatError</span><span class="op" id="5954544">(</span><span class="string" id="5954545">&#34;SOS&nbsp;has&nbsp;wrong&nbsp;length&#34;</span><span class="op" id="5954567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5954570">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5954573">if</span>&nbsp;<span class="ident" id="5954576">err</span>&nbsp;<span class="op" id="5954580">:=</span>&nbsp;<span class="ident" id="5954583">d</span><span class="op" id="5954584">.</span><span class="ident" id="5954585">readFull</span><span class="op" id="5954593">(</span><span class="ident" id="5954594">d</span><span class="op" id="5954595">.</span><span class="ident" id="5954596">tmp</span><span class="op" id="5954599">[</span><span class="op" id="5954600">:</span><span class="ident" id="5954601">n</span><span class="op" id="5954602">]</span><span class="op" id="5954603">)</span><span class="op" id="5954604">;</span>&nbsp;<span class="ident" id="5954606">err</span>&nbsp;<span class="op" id="5954610">!=</span>&nbsp;<span class="ident" id="5954613">nil</span>&nbsp;<span class="op" id="5954617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5954621">return</span>&nbsp;<span class="ident" id="5954628">err</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5954633">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5954636">nComp</span>&nbsp;<span class="op" id="5954642">:=</span>&nbsp;<span class="builtintype" id="5954645">int</span><span class="op" id="5954648">(</span><span class="ident" id="5954649">d</span><span class="op" id="5954650">.</span><span class="ident" id="5954651">tmp</span><span class="op" id="5954654">[</span><span class="num" id="5954655">0</span><span class="op" id="5954656">]</span><span class="op" id="5954657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5954660">if</span>&nbsp;<span class="ident" id="5954663">n</span>&nbsp;<span class="op" id="5954665">!=</span>&nbsp;<span class="num" id="5954668">4</span><span class="op" id="5954669">+</span><span class="num" id="5954670">2</span><span class="op" id="5954671">*</span><span class="ident" id="5954672">nComp</span>&nbsp;<span class="op" id="5954678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5954682">return</span>&nbsp;<span class="ident" id="5954689">FormatError</span><span class="op" id="5954700">(</span><span class="string" id="5954701">&#34;SOS&nbsp;length&nbsp;inconsistent&nbsp;with&nbsp;number&nbsp;of&nbsp;components&#34;</span><span class="op" id="5954752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5954755">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5954758">var</span>&nbsp;<span class="ident" id="5954762">scan</span>&nbsp;<span class="op" id="5954767">[</span><span class="ident" id="5954768">nColorComponent</span><span class="op" id="5954783">]</span><span class="keyword" id="5954784">struct</span>&nbsp;<span class="op" id="5954791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5954795">compIndex</span>&nbsp;<span class="builtintype" id="5954805">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5954813">td</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5954823">uint8</span>&nbsp;<span class="comment" id="5954829">//&nbsp;DC&nbsp;table&nbsp;selector.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5954853">ta</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5954863">uint8</span>&nbsp;<span class="comment" id="5954869">//&nbsp;AC&nbsp;table&nbsp;selector.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5954892">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5954895">for</span>&nbsp;<span class="ident" id="5954899">i</span>&nbsp;<span class="op" id="5954901">:=</span>&nbsp;<span class="num" id="5954904">0</span><span class="op" id="5954905">;</span>&nbsp;<span class="ident" id="5954907">i</span>&nbsp;<span class="op" id="5954909">&lt;</span>&nbsp;<span class="ident" id="5954911">nComp</span><span class="op" id="5954916">;</span>&nbsp;<span class="ident" id="5954918">i</span><span class="op" id="5954919">++</span>&nbsp;<span class="op" id="5954922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5954926">cs</span>&nbsp;<span class="op" id="5954929">:=</span>&nbsp;<span class="ident" id="5954932">d</span><span class="op" id="5954933">.</span><span class="ident" id="5954934">tmp</span><span class="op" id="5954937">[</span><span class="num" id="5954938">1</span><span class="op" id="5954939">+</span><span class="num" id="5954940">2</span><span class="op" id="5954941">*</span><span class="ident" id="5954942">i</span><span class="op" id="5954943">]</span>&nbsp;<span class="comment" id="5954945">//&nbsp;Component&nbsp;selector.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5954970">compIndex</span>&nbsp;<span class="op" id="5954980">:=</span>&nbsp;<span class="op" id="5954983">-</span><span class="num" id="5954984">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5954988">for</span>&nbsp;<span class="ident" id="5954992">j</span><span class="op" id="5954993">,</span>&nbsp;<span class="ident" id="5954995">comp</span>&nbsp;<span class="op" id="5955000">:=</span>&nbsp;<span class="keyword" id="5955003">range</span>&nbsp;<span class="ident" id="5955009">d</span><span class="op" id="5955010">.</span><span class="ident" id="5955011">comp</span>&nbsp;<span class="op" id="5955016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5955021">if</span>&nbsp;<span class="ident" id="5955024">cs</span>&nbsp;<span class="op" id="5955027">==</span>&nbsp;<span class="ident" id="5955030">comp</span><span class="op" id="5955034">.</span><span class="ident" id="5955035">c</span>&nbsp;<span class="op" id="5955037">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5955043">compIndex</span>&nbsp;<span class="op" id="5955053">=</span>&nbsp;<span class="ident" id="5955055">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5955060">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5955064">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5955068">if</span>&nbsp;<span class="ident" id="5955071">compIndex</span>&nbsp;<span class="op" id="5955081">&lt;</span>&nbsp;<span class="num" id="5955083">0</span>&nbsp;<span class="op" id="5955085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5955090">return</span>&nbsp;<span class="ident" id="5955097">FormatError</span><span class="op" id="5955108">(</span><span class="string" id="5955109">&#34;unknown&nbsp;component&nbsp;selector&#34;</span><span class="op" id="5955137">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5955141">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5955145">scan</span><span class="op" id="5955149">[</span><span class="ident" id="5955150">i</span><span class="op" id="5955151">]</span><span class="op" id="5955152">.</span><span class="ident" id="5955153">compIndex</span>&nbsp;<span class="op" id="5955163">=</span>&nbsp;<span class="builtintype" id="5955165">uint8</span><span class="op" id="5955170">(</span><span class="ident" id="5955171">compIndex</span><span class="op" id="5955180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5955184">scan</span><span class="op" id="5955188">[</span><span class="ident" id="5955189">i</span><span class="op" id="5955190">]</span><span class="op" id="5955191">.</span><span class="ident" id="5955192">td</span>&nbsp;<span class="op" id="5955195">=</span>&nbsp;<span class="ident" id="5955197">d</span><span class="op" id="5955198">.</span><span class="ident" id="5955199">tmp</span><span class="op" id="5955202">[</span><span class="num" id="5955203">2</span><span class="op" id="5955204">+</span><span class="num" id="5955205">2</span><span class="op" id="5955206">*</span><span class="ident" id="5955207">i</span><span class="op" id="5955208">]</span>&nbsp;<span class="op" id="5955210">&gt;&gt;</span>&nbsp;<span class="num" id="5955213">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5955217">if</span>&nbsp;<span class="ident" id="5955220">scan</span><span class="op" id="5955224">[</span><span class="ident" id="5955225">i</span><span class="op" id="5955226">]</span><span class="op" id="5955227">.</span><span class="ident" id="5955228">td</span>&nbsp;<span class="op" id="5955231">&gt;</span>&nbsp;<span class="ident" id="5955233">maxTh</span>&nbsp;<span class="op" id="5955239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5955244">return</span>&nbsp;<span class="ident" id="5955251">FormatError</span><span class="op" id="5955262">(</span><span class="string" id="5955263">&#34;bad&nbsp;Td&nbsp;value&#34;</span><span class="op" id="5955277">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5955281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5955285">scan</span><span class="op" id="5955289">[</span><span class="ident" id="5955290">i</span><span class="op" id="5955291">]</span><span class="op" id="5955292">.</span><span class="ident" id="5955293">ta</span>&nbsp;<span class="op" id="5955296">=</span>&nbsp;<span class="ident" id="5955298">d</span><span class="op" id="5955299">.</span><span class="ident" id="5955300">tmp</span><span class="op" id="5955303">[</span><span class="num" id="5955304">2</span><span class="op" id="5955305">+</span><span class="num" id="5955306">2</span><span class="op" id="5955307">*</span><span class="ident" id="5955308">i</span><span class="op" id="5955309">]</span>&nbsp;<span class="op" id="5955311">&amp;</span>&nbsp;<span class="num" id="5955313">0x0f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5955320">if</span>&nbsp;<span class="ident" id="5955323">scan</span><span class="op" id="5955327">[</span><span class="ident" id="5955328">i</span><span class="op" id="5955329">]</span><span class="op" id="5955330">.</span><span class="ident" id="5955331">ta</span>&nbsp;<span class="op" id="5955334">&gt;</span>&nbsp;<span class="ident" id="5955336">maxTh</span>&nbsp;<span class="op" id="5955342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5955347">return</span>&nbsp;<span class="ident" id="5955354">FormatError</span><span class="op" id="5955365">(</span><span class="string" id="5955366">&#34;bad&nbsp;Ta&nbsp;value&#34;</span><span class="op" id="5955380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5955384">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5955387">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5955391">//&nbsp;zigStart&nbsp;and&nbsp;zigEnd&nbsp;are&nbsp;the&nbsp;spectral&nbsp;selection&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5955450">//&nbsp;ah&nbsp;and&nbsp;al&nbsp;are&nbsp;the&nbsp;successive&nbsp;approximation&nbsp;high&nbsp;and&nbsp;low&nbsp;values.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5955518">//&nbsp;The&nbsp;spec&nbsp;calls&nbsp;these&nbsp;values&nbsp;Ss,&nbsp;Se,&nbsp;Ah&nbsp;and&nbsp;Al.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5955569">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5955573">//&nbsp;For&nbsp;progressive&nbsp;JPEGs,&nbsp;these&nbsp;are&nbsp;the&nbsp;two&nbsp;more-or-less&nbsp;independent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5955643">//&nbsp;aspects&nbsp;of&nbsp;progression.&nbsp;Spectral&nbsp;selection&nbsp;progression&nbsp;is&nbsp;when&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5955714">//&nbsp;all&nbsp;of&nbsp;a&nbsp;block&#39;s&nbsp;64&nbsp;DCT&nbsp;coefficients&nbsp;are&nbsp;transmitted&nbsp;in&nbsp;one&nbsp;pass.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5955784">//&nbsp;For&nbsp;example,&nbsp;three&nbsp;passes&nbsp;could&nbsp;transmit&nbsp;coefficient&nbsp;0&nbsp;(the&nbsp;DC</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5955851">//&nbsp;component),&nbsp;coefficients&nbsp;1-5,&nbsp;and&nbsp;coefficients&nbsp;6-63,&nbsp;in&nbsp;zig-zag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5955919">//&nbsp;order.&nbsp;Successive&nbsp;approximation&nbsp;is&nbsp;when&nbsp;not&nbsp;all&nbsp;of&nbsp;the&nbsp;bits&nbsp;of&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5955988">//&nbsp;band&nbsp;of&nbsp;coefficients&nbsp;are&nbsp;transmitted&nbsp;in&nbsp;one&nbsp;pass.&nbsp;For&nbsp;example,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5956055">//&nbsp;three&nbsp;passes&nbsp;could&nbsp;transmit&nbsp;the&nbsp;6&nbsp;most&nbsp;significant&nbsp;bits,&nbsp;followed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5956125">//&nbsp;by&nbsp;the&nbsp;second-least&nbsp;significant&nbsp;bit,&nbsp;followed&nbsp;by&nbsp;the&nbsp;least</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5956188">//&nbsp;significant&nbsp;bit.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5956209">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5956213">//&nbsp;For&nbsp;baseline&nbsp;JPEGs,&nbsp;these&nbsp;parameters&nbsp;are&nbsp;hard-coded&nbsp;to&nbsp;0/63/0/0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5956282">zigStart</span><span class="op" id="5956290">,</span>&nbsp;<span class="ident" id="5956292">zigEnd</span><span class="op" id="5956298">,</span>&nbsp;<span class="ident" id="5956300">ah</span><span class="op" id="5956302">,</span>&nbsp;<span class="ident" id="5956304">al</span>&nbsp;<span class="op" id="5956307">:=</span>&nbsp;<span class="builtintype" id="5956310">int32</span><span class="op" id="5956315">(</span><span class="num" id="5956316">0</span><span class="op" id="5956317">)</span><span class="op" id="5956318">,</span>&nbsp;<span class="builtintype" id="5956320">int32</span><span class="op" id="5956325">(</span><span class="ident" id="5956326">blockSize</span><span class="op" id="5956335">-</span><span class="num" id="5956336">1</span><span class="op" id="5956337">)</span><span class="op" id="5956338">,</span>&nbsp;<span class="builtintype" id="5956340">uint32</span><span class="op" id="5956346">(</span><span class="num" id="5956347">0</span><span class="op" id="5956348">)</span><span class="op" id="5956349">,</span>&nbsp;<span class="builtintype" id="5956351">uint32</span><span class="op" id="5956357">(</span><span class="num" id="5956358">0</span><span class="op" id="5956359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5956362">if</span>&nbsp;<span class="ident" id="5956365">d</span><span class="op" id="5956366">.</span><span class="ident" id="5956367">progressive</span>&nbsp;<span class="op" id="5956379">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5956383">zigStart</span>&nbsp;<span class="op" id="5956392">=</span>&nbsp;<span class="builtintype" id="5956394">int32</span><span class="op" id="5956399">(</span><span class="ident" id="5956400">d</span><span class="op" id="5956401">.</span><span class="ident" id="5956402">tmp</span><span class="op" id="5956405">[</span><span class="num" id="5956406">1</span><span class="op" id="5956407">+</span><span class="num" id="5956408">2</span><span class="op" id="5956409">*</span><span class="ident" id="5956410">nComp</span><span class="op" id="5956415">]</span><span class="op" id="5956416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5956420">zigEnd</span>&nbsp;<span class="op" id="5956427">=</span>&nbsp;<span class="builtintype" id="5956429">int32</span><span class="op" id="5956434">(</span><span class="ident" id="5956435">d</span><span class="op" id="5956436">.</span><span class="ident" id="5956437">tmp</span><span class="op" id="5956440">[</span><span class="num" id="5956441">2</span><span class="op" id="5956442">+</span><span class="num" id="5956443">2</span><span class="op" id="5956444">*</span><span class="ident" id="5956445">nComp</span><span class="op" id="5956450">]</span><span class="op" id="5956451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5956455">ah</span>&nbsp;<span class="op" id="5956458">=</span>&nbsp;<span class="builtintype" id="5956460">uint32</span><span class="op" id="5956466">(</span><span class="ident" id="5956467">d</span><span class="op" id="5956468">.</span><span class="ident" id="5956469">tmp</span><span class="op" id="5956472">[</span><span class="num" id="5956473">3</span><span class="op" id="5956474">+</span><span class="num" id="5956475">2</span><span class="op" id="5956476">*</span><span class="ident" id="5956477">nComp</span><span class="op" id="5956482">]</span>&nbsp;<span class="op" id="5956484">&gt;&gt;</span>&nbsp;<span class="num" id="5956487">4</span><span class="op" id="5956488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5956492">al</span>&nbsp;<span class="op" id="5956495">=</span>&nbsp;<span class="builtintype" id="5956497">uint32</span><span class="op" id="5956503">(</span><span class="ident" id="5956504">d</span><span class="op" id="5956505">.</span><span class="ident" id="5956506">tmp</span><span class="op" id="5956509">[</span><span class="num" id="5956510">3</span><span class="op" id="5956511">+</span><span class="num" id="5956512">2</span><span class="op" id="5956513">*</span><span class="ident" id="5956514">nComp</span><span class="op" id="5956519">]</span>&nbsp;<span class="op" id="5956521">&amp;</span>&nbsp;<span class="num" id="5956523">0x0f</span><span class="op" id="5956527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5956531">if</span>&nbsp;<span class="op" id="5956534">(</span><span class="ident" id="5956535">zigStart</span>&nbsp;<span class="op" id="5956544">==</span>&nbsp;<span class="num" id="5956547">0</span>&nbsp;<span class="op" id="5956549">&amp;&amp;</span>&nbsp;<span class="ident" id="5956552">zigEnd</span>&nbsp;<span class="op" id="5956559">!=</span>&nbsp;<span class="num" id="5956562">0</span><span class="op" id="5956563">)</span>&nbsp;<span class="op" id="5956565">||</span>&nbsp;<span class="ident" id="5956568">zigStart</span>&nbsp;<span class="op" id="5956577">&gt;</span>&nbsp;<span class="ident" id="5956579">zigEnd</span>&nbsp;<span class="op" id="5956586">||</span>&nbsp;<span class="ident" id="5956589">blockSize</span>&nbsp;<span class="op" id="5956599">&lt;=</span>&nbsp;<span class="ident" id="5956602">zigEnd</span>&nbsp;<span class="op" id="5956609">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5956614">return</span>&nbsp;<span class="ident" id="5956621">FormatError</span><span class="op" id="5956632">(</span><span class="string" id="5956633">&#34;bad&nbsp;spectral&nbsp;selection&nbsp;bounds&#34;</span><span class="op" id="5956664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5956668">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5956672">if</span>&nbsp;<span class="ident" id="5956675">zigStart</span>&nbsp;<span class="op" id="5956684">!=</span>&nbsp;<span class="num" id="5956687">0</span>&nbsp;<span class="op" id="5956689">&amp;&amp;</span>&nbsp;<span class="ident" id="5956692">nComp</span>&nbsp;<span class="op" id="5956698">!=</span>&nbsp;<span class="num" id="5956701">1</span>&nbsp;<span class="op" id="5956703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5956708">return</span>&nbsp;<span class="ident" id="5956715">FormatError</span><span class="op" id="5956726">(</span><span class="string" id="5956727">&#34;progressive&nbsp;AC&nbsp;coefficients&nbsp;for&nbsp;more&nbsp;than&nbsp;one&nbsp;component&#34;</span><span class="op" id="5956784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5956788">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5956792">if</span>&nbsp;<span class="ident" id="5956795">ah</span>&nbsp;<span class="op" id="5956798">!=</span>&nbsp;<span class="num" id="5956801">0</span>&nbsp;<span class="op" id="5956803">&amp;&amp;</span>&nbsp;<span class="ident" id="5956806">ah</span>&nbsp;<span class="op" id="5956809">!=</span>&nbsp;<span class="ident" id="5956812">al</span><span class="op" id="5956814">+</span><span class="num" id="5956815">1</span>&nbsp;<span class="op" id="5956817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5956822">return</span>&nbsp;<span class="ident" id="5956829">FormatError</span><span class="op" id="5956840">(</span><span class="string" id="5956841">&#34;bad&nbsp;successive&nbsp;approximation&nbsp;values&#34;</span><span class="op" id="5956878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5956882">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5956885">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5956889">//&nbsp;mxx&nbsp;and&nbsp;myy&nbsp;are&nbsp;the&nbsp;number&nbsp;of&nbsp;MCUs&nbsp;(Minimum&nbsp;Coded&nbsp;Units)&nbsp;in&nbsp;the&nbsp;image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5956964">h0</span><span class="op" id="5956966">,</span>&nbsp;<span class="ident" id="5956968">v0</span>&nbsp;<span class="op" id="5956971">:=</span>&nbsp;<span class="ident" id="5956974">d</span><span class="op" id="5956975">.</span><span class="ident" id="5956976">comp</span><span class="op" id="5956980">[</span><span class="num" id="5956981">0</span><span class="op" id="5956982">]</span><span class="op" id="5956983">.</span><span class="ident" id="5956984">h</span><span class="op" id="5956985">,</span>&nbsp;<span class="ident" id="5956987">d</span><span class="op" id="5956988">.</span><span class="ident" id="5956989">comp</span><span class="op" id="5956993">[</span><span class="num" id="5956994">0</span><span class="op" id="5956995">]</span><span class="op" id="5956996">.</span><span class="ident" id="5956997">v</span>&nbsp;<span class="comment" id="5956999">//&nbsp;The&nbsp;h&nbsp;and&nbsp;v&nbsp;values&nbsp;from&nbsp;the&nbsp;Y&nbsp;components.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5957045">mxx</span>&nbsp;<span class="op" id="5957049">:=</span>&nbsp;<span class="op" id="5957052">(</span><span class="ident" id="5957053">d</span><span class="op" id="5957054">.</span><span class="ident" id="5957055">width</span>&nbsp;<span class="op" id="5957061">+</span>&nbsp;<span class="num" id="5957063">8</span><span class="op" id="5957064">*</span><span class="ident" id="5957065">h0</span>&nbsp;<span class="op" id="5957068">-</span>&nbsp;<span class="num" id="5957070">1</span><span class="op" id="5957071">)</span>&nbsp;<span class="op" id="5957073">/</span>&nbsp;<span class="op" id="5957075">(</span><span class="num" id="5957076">8</span>&nbsp;<span class="op" id="5957078">*</span>&nbsp;<span class="ident" id="5957080">h0</span><span class="op" id="5957082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5957085">myy</span>&nbsp;<span class="op" id="5957089">:=</span>&nbsp;<span class="op" id="5957092">(</span><span class="ident" id="5957093">d</span><span class="op" id="5957094">.</span><span class="ident" id="5957095">height</span>&nbsp;<span class="op" id="5957102">+</span>&nbsp;<span class="num" id="5957104">8</span><span class="op" id="5957105">*</span><span class="ident" id="5957106">v0</span>&nbsp;<span class="op" id="5957109">-</span>&nbsp;<span class="num" id="5957111">1</span><span class="op" id="5957112">)</span>&nbsp;<span class="op" id="5957114">/</span>&nbsp;<span class="op" id="5957116">(</span><span class="num" id="5957117">8</span>&nbsp;<span class="op" id="5957119">*</span>&nbsp;<span class="ident" id="5957121">v0</span><span class="op" id="5957123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5957126">if</span>&nbsp;<span class="ident" id="5957129">d</span><span class="op" id="5957130">.</span><span class="ident" id="5957131">img1</span>&nbsp;<span class="op" id="5957136">==</span>&nbsp;<span class="ident" id="5957139">nil</span>&nbsp;<span class="op" id="5957143">&amp;&amp;</span>&nbsp;<span class="ident" id="5957146">d</span><span class="op" id="5957147">.</span><span class="ident" id="5957148">img3</span>&nbsp;<span class="op" id="5957153">==</span>&nbsp;<span class="ident" id="5957156">nil</span>&nbsp;<span class="op" id="5957160">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5957164">d</span><span class="op" id="5957165">.</span><span class="ident" id="5957166">makeImg</span><span class="op" id="5957173">(</span><span class="ident" id="5957174">h0</span><span class="op" id="5957176">,</span>&nbsp;<span class="ident" id="5957178">v0</span><span class="op" id="5957180">,</span>&nbsp;<span class="ident" id="5957182">mxx</span><span class="op" id="5957185">,</span>&nbsp;<span class="ident" id="5957187">myy</span><span class="op" id="5957190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5957193">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5957196">if</span>&nbsp;<span class="ident" id="5957199">d</span><span class="op" id="5957200">.</span><span class="ident" id="5957201">progressive</span>&nbsp;<span class="op" id="5957213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5957217">for</span>&nbsp;<span class="ident" id="5957221">i</span>&nbsp;<span class="op" id="5957223">:=</span>&nbsp;<span class="num" id="5957226">0</span><span class="op" id="5957227">;</span>&nbsp;<span class="ident" id="5957229">i</span>&nbsp;<span class="op" id="5957231">&lt;</span>&nbsp;<span class="ident" id="5957233">nComp</span><span class="op" id="5957238">;</span>&nbsp;<span class="ident" id="5957240">i</span><span class="op" id="5957241">++</span>&nbsp;<span class="op" id="5957244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5957249">compIndex</span>&nbsp;<span class="op" id="5957259">:=</span>&nbsp;<span class="ident" id="5957262">scan</span><span class="op" id="5957266">[</span><span class="ident" id="5957267">i</span><span class="op" id="5957268">]</span><span class="op" id="5957269">.</span><span class="ident" id="5957270">compIndex</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5957283">if</span>&nbsp;<span class="ident" id="5957286">d</span><span class="op" id="5957287">.</span><span class="ident" id="5957288">progCoeffs</span><span class="op" id="5957298">[</span><span class="ident" id="5957299">compIndex</span><span class="op" id="5957308">]</span>&nbsp;<span class="op" id="5957310">==</span>&nbsp;<span class="ident" id="5957313">nil</span>&nbsp;<span class="op" id="5957317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5957323">d</span><span class="op" id="5957324">.</span><span class="ident" id="5957325">progCoeffs</span><span class="op" id="5957335">[</span><span class="ident" id="5957336">compIndex</span><span class="op" id="5957345">]</span>&nbsp;<span class="op" id="5957347">=</span>&nbsp;<span class="builtinfunc" id="5957349">make</span><span class="op" id="5957353">(</span><span class="op" id="5957354">[</span><span class="op" id="5957355">]</span><span class="ident" id="5957356">block</span><span class="op" id="5957361">,</span>&nbsp;<span class="ident" id="5957363">mxx</span><span class="op" id="5957366">*</span><span class="ident" id="5957367">myy</span><span class="op" id="5957370">*</span><span class="ident" id="5957371">d</span><span class="op" id="5957372">.</span><span class="ident" id="5957373">comp</span><span class="op" id="5957377">[</span><span class="ident" id="5957378">compIndex</span><span class="op" id="5957387">]</span><span class="op" id="5957388">.</span><span class="ident" id="5957389">h</span><span class="op" id="5957390">*</span><span class="ident" id="5957391">d</span><span class="op" id="5957392">.</span><span class="ident" id="5957393">comp</span><span class="op" id="5957397">[</span><span class="ident" id="5957398">compIndex</span><span class="op" id="5957407">]</span><span class="op" id="5957408">.</span><span class="ident" id="5957409">v</span><span class="op" id="5957410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5957415">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5957419">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5957422">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5957426">d</span><span class="op" id="5957427">.</span><span class="ident" id="5957428">bits</span>&nbsp;<span class="op" id="5957433">=</span>&nbsp;<span class="ident" id="5957435">bits</span><span class="op" id="5957439">{</span><span class="op" id="5957440">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5957443">mcu</span><span class="op" id="5957446">,</span>&nbsp;<span class="ident" id="5957448">expectedRST</span>&nbsp;<span class="op" id="5957460">:=</span>&nbsp;<span class="num" id="5957463">0</span><span class="op" id="5957464">,</span>&nbsp;<span class="builtintype" id="5957466">uint8</span><span class="op" id="5957471">(</span><span class="ident" id="5957472">rst0Marker</span><span class="op" id="5957482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5957485">var</span>&nbsp;<span class="op" id="5957489">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5957493">//&nbsp;b&nbsp;is&nbsp;the&nbsp;decoded&nbsp;coefficients,&nbsp;in&nbsp;natural&nbsp;(not&nbsp;zig-zag)&nbsp;order.</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5957561">b</span>&nbsp;&nbsp;<span class="ident" id="5957564">block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5957572">dc</span>&nbsp;<span class="op" id="5957575">[</span><span class="ident" id="5957576">nColorComponent</span><span class="op" id="5957591">]</span><span class="builtintype" id="5957592">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5957600">//&nbsp;bx&nbsp;and&nbsp;by&nbsp;are&nbsp;the&nbsp;location&nbsp;of&nbsp;the&nbsp;current&nbsp;(in&nbsp;terms&nbsp;of&nbsp;8x8&nbsp;blocks).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5957673">//&nbsp;For&nbsp;example,&nbsp;with&nbsp;4:2:0&nbsp;chroma&nbsp;subsampling,&nbsp;the&nbsp;block&nbsp;whose&nbsp;top&nbsp;left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5957747">//&nbsp;pixel&nbsp;co-ordinates&nbsp;are&nbsp;(16,&nbsp;8)&nbsp;is&nbsp;the&nbsp;third&nbsp;block&nbsp;in&nbsp;the&nbsp;first&nbsp;row:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5957820">//&nbsp;bx&nbsp;is&nbsp;2&nbsp;and&nbsp;by&nbsp;is&nbsp;0,&nbsp;even&nbsp;though&nbsp;the&nbsp;pixel&nbsp;is&nbsp;in&nbsp;the&nbsp;second&nbsp;MCU.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5957890">bx</span><span class="op" id="5957892">,</span>&nbsp;<span class="ident" id="5957894">by</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5957901">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5957907">blockCount</span>&nbsp;<span class="builtintype" id="5957918">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5957923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5957926">for</span>&nbsp;<span class="ident" id="5957930">my</span>&nbsp;<span class="op" id="5957933">:=</span>&nbsp;<span class="num" id="5957936">0</span><span class="op" id="5957937">;</span>&nbsp;<span class="ident" id="5957939">my</span>&nbsp;<span class="op" id="5957942">&lt;</span>&nbsp;<span class="ident" id="5957944">myy</span><span class="op" id="5957947">;</span>&nbsp;<span class="ident" id="5957949">my</span><span class="op" id="5957951">++</span>&nbsp;<span class="op" id="5957954">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5957958">for</span>&nbsp;<span class="ident" id="5957962">mx</span>&nbsp;<span class="op" id="5957965">:=</span>&nbsp;<span class="num" id="5957968">0</span><span class="op" id="5957969">;</span>&nbsp;<span class="ident" id="5957971">mx</span>&nbsp;<span class="op" id="5957974">&lt;</span>&nbsp;<span class="ident" id="5957976">mxx</span><span class="op" id="5957979">;</span>&nbsp;<span class="ident" id="5957981">mx</span><span class="op" id="5957983">++</span>&nbsp;<span class="op" id="5957986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5957991">for</span>&nbsp;<span class="ident" id="5957995">i</span>&nbsp;<span class="op" id="5957997">:=</span>&nbsp;<span class="num" id="5958000">0</span><span class="op" id="5958001">;</span>&nbsp;<span class="ident" id="5958003">i</span>&nbsp;<span class="op" id="5958005">&lt;</span>&nbsp;<span class="ident" id="5958007">nComp</span><span class="op" id="5958012">;</span>&nbsp;<span class="ident" id="5958014">i</span><span class="op" id="5958015">++</span>&nbsp;<span class="op" id="5958018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5958024">compIndex</span>&nbsp;<span class="op" id="5958034">:=</span>&nbsp;<span class="ident" id="5958037">scan</span><span class="op" id="5958041">[</span><span class="ident" id="5958042">i</span><span class="op" id="5958043">]</span><span class="op" id="5958044">.</span><span class="ident" id="5958045">compIndex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5958059">qt</span>&nbsp;<span class="op" id="5958062">:=</span>&nbsp;<span class="op" id="5958065">&amp;</span><span class="ident" id="5958066">d</span><span class="op" id="5958067">.</span><span class="ident" id="5958068">quant</span><span class="op" id="5958073">[</span><span class="ident" id="5958074">d</span><span class="op" id="5958075">.</span><span class="ident" id="5958076">comp</span><span class="op" id="5958080">[</span><span class="ident" id="5958081">compIndex</span><span class="op" id="5958090">]</span><span class="op" id="5958091">.</span><span class="ident" id="5958092">tq</span><span class="op" id="5958094">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5958100">for</span>&nbsp;<span class="ident" id="5958104">j</span>&nbsp;<span class="op" id="5958106">:=</span>&nbsp;<span class="num" id="5958109">0</span><span class="op" id="5958110">;</span>&nbsp;<span class="ident" id="5958112">j</span>&nbsp;<span class="op" id="5958114">&lt;</span>&nbsp;<span class="ident" id="5958116">d</span><span class="op" id="5958117">.</span><span class="ident" id="5958118">comp</span><span class="op" id="5958122">[</span><span class="ident" id="5958123">compIndex</span><span class="op" id="5958132">]</span><span class="op" id="5958133">.</span><span class="ident" id="5958134">h</span><span class="op" id="5958135">*</span><span class="ident" id="5958136">d</span><span class="op" id="5958137">.</span><span class="ident" id="5958138">comp</span><span class="op" id="5958142">[</span><span class="ident" id="5958143">compIndex</span><span class="op" id="5958152">]</span><span class="op" id="5958153">.</span><span class="ident" id="5958154">v</span><span class="op" id="5958155">;</span>&nbsp;<span class="ident" id="5958157">j</span><span class="op" id="5958158">++</span>&nbsp;<span class="op" id="5958161">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5958168">//&nbsp;The&nbsp;blocks&nbsp;are&nbsp;traversed&nbsp;one&nbsp;MCU&nbsp;at&nbsp;a&nbsp;time.&nbsp;For&nbsp;4:2:0&nbsp;chroma</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5958237">//&nbsp;subsampling,&nbsp;there&nbsp;are&nbsp;four&nbsp;Y&nbsp;8x8&nbsp;blocks&nbsp;in&nbsp;every&nbsp;16x16&nbsp;MCU.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5958306">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5958314">//&nbsp;For&nbsp;a&nbsp;baseline&nbsp;32x16&nbsp;pixel&nbsp;image,&nbsp;the&nbsp;Y&nbsp;blocks&nbsp;visiting&nbsp;order&nbsp;is:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5958388">//&nbsp;&nbsp;&nbsp;&nbsp0&nbsp;1&nbsp;4&nbsp;5</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5958404">//&nbsp;&nbsp;&nbsp;&nbsp2&nbsp;3&nbsp;6&nbsp;7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5958420">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5958428">//&nbsp;For&nbsp;progressive&nbsp;images,&nbsp;the&nbsp;interleaved&nbsp;scans&nbsp;(those&nbsp;with&nbsp;nComp&nbsp;&gt;&nbsp;1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5958505">//&nbsp;are&nbsp;traversed&nbsp;as&nbsp;above,&nbsp;but&nbsp;non-interleaved&nbsp;scans&nbsp;are&nbsp;traversed&nbsp;left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5958582">//&nbsp;to&nbsp;right,&nbsp;top&nbsp;to&nbsp;bottom:</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5958615">//&nbsp;&nbsp;&nbsp;&nbsp0&nbsp;1&nbsp;2&nbsp;3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5958631">//&nbsp;&nbsp;&nbsp;&nbsp4&nbsp;5&nbsp;6&nbsp;7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5958647">//&nbsp;Only&nbsp;DC&nbsp;scans&nbsp;(zigStart&nbsp;==&nbsp;0)&nbsp;can&nbsp;be&nbsp;interleaved.&nbsp;AC&nbsp;scans&nbsp;must&nbsp;have</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5958724">//&nbsp;only&nbsp;one&nbsp;component.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5958752">//</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5958760">//&nbsp;To&nbsp;further&nbsp;complicate&nbsp;matters,&nbsp;for&nbsp;non-interleaved&nbsp;scans,&nbsp;there&nbsp;is&nbsp;no</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5958838">//&nbsp;data&nbsp;for&nbsp;any&nbsp;blocks&nbsp;that&nbsp;are&nbsp;inside&nbsp;the&nbsp;image&nbsp;at&nbsp;the&nbsp;MCU&nbsp;level&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5958913">//&nbsp;outside&nbsp;the&nbsp;image&nbsp;at&nbsp;the&nbsp;pixel&nbsp;level.&nbsp;For&nbsp;example,&nbsp;a&nbsp;24x16&nbsp;pixel&nbsp;4:2:0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5958992">//&nbsp;progressive&nbsp;image&nbsp;consists&nbsp;of&nbsp;two&nbsp;16x16&nbsp;MCUs.&nbsp;The&nbsp;interleaved&nbsp;scans</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5959068">//&nbsp;will&nbsp;process&nbsp;8&nbsp;Y&nbsp;blocks:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5959101">//&nbsp;&nbsp;&nbsp;&nbsp0&nbsp;1&nbsp;4&nbsp;5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5959117">//&nbsp;&nbsp;&nbsp;&nbsp2&nbsp;3&nbsp;6&nbsp;7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5959133">//&nbsp;The&nbsp;non-interleaved&nbsp;scans&nbsp;will&nbsp;process&nbsp;only&nbsp;6&nbsp;Y&nbsp;blocks:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5959197">//&nbsp;&nbsp;&nbsp;&nbsp0&nbsp;1&nbsp;2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5959211">//&nbsp;&nbsp;&nbsp;&nbsp3&nbsp;4&nbsp;5</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5959225">if</span>&nbsp;<span class="ident" id="5959228">nComp</span>&nbsp;<span class="op" id="5959234">!=</span>&nbsp;<span class="num" id="5959237">1</span>&nbsp;<span class="op" id="5959239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5959247">bx</span><span class="op" id="5959249">,</span>&nbsp;<span class="ident" id="5959251">by</span>&nbsp;<span class="op" id="5959254">=</span>&nbsp;<span class="ident" id="5959256">d</span><span class="op" id="5959257">.</span><span class="ident" id="5959258">comp</span><span class="op" id="5959262">[</span><span class="ident" id="5959263">compIndex</span><span class="op" id="5959272">]</span><span class="op" id="5959273">.</span><span class="ident" id="5959274">h</span><span class="op" id="5959275">*</span><span class="ident" id="5959276">mx</span><span class="op" id="5959278">,</span>&nbsp;<span class="ident" id="5959280">d</span><span class="op" id="5959281">.</span><span class="ident" id="5959282">comp</span><span class="op" id="5959286">[</span><span class="ident" id="5959287">compIndex</span><span class="op" id="5959296">]</span><span class="op" id="5959297">.</span><span class="ident" id="5959298">v</span><span class="op" id="5959299">*</span><span class="ident" id="5959300">my</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5959309">if</span>&nbsp;<span class="ident" id="5959312">h0</span>&nbsp;<span class="op" id="5959315">==</span>&nbsp;<span class="num" id="5959318">1</span>&nbsp;<span class="op" id="5959320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5959329">by</span>&nbsp;<span class="op" id="5959332">+=</span>&nbsp;<span class="ident" id="5959335">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5959343">}</span>&nbsp;<span class="keyword" id="5959345">else</span>&nbsp;<span class="op" id="5959350">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5959359">bx</span>&nbsp;<span class="op" id="5959362">+=</span>&nbsp;<span class="ident" id="5959365">j</span>&nbsp;<span class="op" id="5959367">%</span>&nbsp;<span class="num" id="5959369">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5959378">by</span>&nbsp;<span class="op" id="5959381">+=</span>&nbsp;<span class="ident" id="5959384">j</span>&nbsp;<span class="op" id="5959386">/</span>&nbsp;<span class="num" id="5959388">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5959396">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5959403">}</span>&nbsp;<span class="keyword" id="5959405">else</span>&nbsp;<span class="op" id="5959410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5959418">q</span>&nbsp;<span class="op" id="5959420">:=</span>&nbsp;<span class="ident" id="5959423">mxx</span>&nbsp;<span class="op" id="5959427">*</span>&nbsp;<span class="ident" id="5959429">d</span><span class="op" id="5959430">.</span><span class="ident" id="5959431">comp</span><span class="op" id="5959435">[</span><span class="ident" id="5959436">compIndex</span><span class="op" id="5959445">]</span><span class="op" id="5959446">.</span><span class="ident" id="5959447">h</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5959455">bx</span>&nbsp;<span class="op" id="5959458">=</span>&nbsp;<span class="ident" id="5959460">blockCount</span>&nbsp;<span class="op" id="5959471">%</span>&nbsp;<span class="ident" id="5959473">q</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5959481">by</span>&nbsp;<span class="op" id="5959484">=</span>&nbsp;<span class="ident" id="5959486">blockCount</span>&nbsp;<span class="op" id="5959497">/</span>&nbsp;<span class="ident" id="5959499">q</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5959507">blockCount</span><span class="op" id="5959517">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5959526">if</span>&nbsp;<span class="ident" id="5959529">bx</span><span class="op" id="5959531">*</span><span class="num" id="5959532">8</span>&nbsp;<span class="op" id="5959534">&gt;=</span>&nbsp;<span class="ident" id="5959537">d</span><span class="op" id="5959538">.</span><span class="ident" id="5959539">width</span>&nbsp;<span class="op" id="5959545">||</span>&nbsp;<span class="ident" id="5959548">by</span><span class="op" id="5959550">*</span><span class="num" id="5959551">8</span>&nbsp;<span class="op" id="5959553">&gt;=</span>&nbsp;<span class="ident" id="5959556">d</span><span class="op" id="5959557">.</span><span class="ident" id="5959558">height</span>&nbsp;<span class="op" id="5959565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5959574">continue</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5959589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5959596">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5959604">//&nbsp;Load&nbsp;the&nbsp;previous&nbsp;partially&nbsp;decoded&nbsp;coefficients,&nbsp;if&nbsp;applicable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5959677">if</span>&nbsp;<span class="ident" id="5959680">d</span><span class="op" id="5959681">.</span><span class="ident" id="5959682">progressive</span>&nbsp;<span class="op" id="5959694">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5959702">b</span>&nbsp;<span class="op" id="5959704">=</span>&nbsp;<span class="ident" id="5959706">d</span><span class="op" id="5959707">.</span><span class="ident" id="5959708">progCoeffs</span><span class="op" id="5959718">[</span><span class="ident" id="5959719">compIndex</span><span class="op" id="5959728">]</span><span class="op" id="5959729">[</span><span class="ident" id="5959730">by</span><span class="op" id="5959732">*</span><span class="ident" id="5959733">mxx</span><span class="op" id="5959736">*</span><span class="ident" id="5959737">d</span><span class="op" id="5959738">.</span><span class="ident" id="5959739">comp</span><span class="op" id="5959743">[</span><span class="ident" id="5959744">compIndex</span><span class="op" id="5959753">]</span><span class="op" id="5959754">.</span><span class="ident" id="5959755">h</span><span class="op" id="5959756">+</span><span class="ident" id="5959757">bx</span><span class="op" id="5959759">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5959766">}</span>&nbsp;<span class="keyword" id="5959768">else</span>&nbsp;<span class="op" id="5959773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5959781">b</span>&nbsp;<span class="op" id="5959783">=</span>&nbsp;<span class="ident" id="5959785">block</span><span class="op" id="5959790">{</span><span class="op" id="5959791">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5959798">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5959806">if</span>&nbsp;<span class="ident" id="5959809">ah</span>&nbsp;<span class="op" id="5959812">!=</span>&nbsp;<span class="num" id="5959815">0</span>&nbsp;<span class="op" id="5959817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5959825">if</span>&nbsp;<span class="ident" id="5959828">err</span>&nbsp;<span class="op" id="5959832">:=</span>&nbsp;<span class="ident" id="5959835">d</span><span class="op" id="5959836">.</span><span class="ident" id="5959837">refine</span><span class="op" id="5959843">(</span><span class="op" id="5959844">&amp;</span><span class="ident" id="5959845">b</span><span class="op" id="5959846">,</span>&nbsp;<span class="op" id="5959848">&amp;</span><span class="ident" id="5959849">d</span><span class="op" id="5959850">.</span><span class="ident" id="5959851">huff</span><span class="op" id="5959855">[</span><span class="ident" id="5959856">acTable</span><span class="op" id="5959863">]</span><span class="op" id="5959864">[</span><span class="ident" id="5959865">scan</span><span class="op" id="5959869">[</span><span class="ident" id="5959870">i</span><span class="op" id="5959871">]</span><span class="op" id="5959872">.</span><span class="ident" id="5959873">ta</span><span class="op" id="5959875">]</span><span class="op" id="5959876">,</span>&nbsp;<span class="ident" id="5959878">zigStart</span><span class="op" id="5959886">,</span>&nbsp;<span class="ident" id="5959888">zigEnd</span><span class="op" id="5959894">,</span>&nbsp;<span class="num" id="5959896">1</span><span class="op" id="5959897">&lt;&lt;</span><span class="ident" id="5959899">al</span><span class="op" id="5959901">)</span><span class="op" id="5959902">;</span>&nbsp;<span class="ident" id="5959904">err</span>&nbsp;<span class="op" id="5959908">!=</span>&nbsp;<span class="ident" id="5959911">nil</span>&nbsp;<span class="op" id="5959915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5959924">return</span>&nbsp;<span class="ident" id="5959931">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5959941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5959948">}</span>&nbsp;<span class="keyword" id="5959950">else</span>&nbsp;<span class="op" id="5959955">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5959963">zig</span>&nbsp;<span class="op" id="5959967">:=</span>&nbsp;<span class="ident" id="5959970">zigStart</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5959985">if</span>&nbsp;<span class="ident" id="5959988">zig</span>&nbsp;<span class="op" id="5959992">==</span>&nbsp;<span class="num" id="5959995">0</span>&nbsp;<span class="op" id="5959997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5960006">zig</span><span class="op" id="5960009">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5960019">//&nbsp;Decode&nbsp;the&nbsp;DC&nbsp;coefficient,&nbsp;as&nbsp;specified&nbsp;in&nbsp;section&nbsp;F.2.2.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5960089">value</span><span class="op" id="5960094">,</span>&nbsp;<span class="ident" id="5960096">err</span>&nbsp;<span class="op" id="5960100">:=</span>&nbsp;<span class="ident" id="5960103">d</span><span class="op" id="5960104">.</span><span class="ident" id="5960105">decodeHuffman</span><span class="op" id="5960118">(</span><span class="op" id="5960119">&amp;</span><span class="ident" id="5960120">d</span><span class="op" id="5960121">.</span><span class="ident" id="5960122">huff</span><span class="op" id="5960126">[</span><span class="ident" id="5960127">dcTable</span><span class="op" id="5960134">]</span><span class="op" id="5960135">[</span><span class="ident" id="5960136">scan</span><span class="op" id="5960140">[</span><span class="ident" id="5960141">i</span><span class="op" id="5960142">]</span><span class="op" id="5960143">.</span><span class="ident" id="5960144">td</span><span class="op" id="5960146">]</span><span class="op" id="5960147">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5960156">if</span>&nbsp;<span class="ident" id="5960159">err</span>&nbsp;<span class="op" id="5960163">!=</span>&nbsp;<span class="ident" id="5960166">nil</span>&nbsp;<span class="op" id="5960170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5960180">return</span>&nbsp;<span class="ident" id="5960187">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5960198">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5960207">if</span>&nbsp;<span class="ident" id="5960210">value</span>&nbsp;<span class="op" id="5960216">&gt;</span>&nbsp;<span class="num" id="5960218">16</span>&nbsp;<span class="op" id="5960221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5960231">return</span>&nbsp;<span class="ident" id="5960238">UnsupportedError</span><span class="op" id="5960254">(</span><span class="string" id="5960255">&#34;excessive&nbsp;DC&nbsp;component&#34;</span><span class="op" id="5960279">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5960288">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5960297">dcDelta</span><span class="op" id="5960304">,</span>&nbsp;<span class="ident" id="5960306">err</span>&nbsp;<span class="op" id="5960310">:=</span>&nbsp;<span class="ident" id="5960313">d</span><span class="op" id="5960314">.</span><span class="ident" id="5960315">receiveExtend</span><span class="op" id="5960328">(</span><span class="ident" id="5960329">value</span><span class="op" id="5960334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5960343">if</span>&nbsp;<span class="ident" id="5960346">err</span>&nbsp;<span class="op" id="5960350">!=</span>&nbsp;<span class="ident" id="5960353">nil</span>&nbsp;<span class="op" id="5960357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5960367">return</span>&nbsp;<span class="ident" id="5960374">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5960385">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5960394">dc</span><span class="op" id="5960396">[</span><span class="ident" id="5960397">compIndex</span><span class="op" id="5960406">]</span>&nbsp;<span class="op" id="5960408">+=</span>&nbsp;<span class="ident" id="5960411">dcDelta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5960426">b</span><span class="op" id="5960427">[</span><span class="num" id="5960428">0</span><span class="op" id="5960429">]</span>&nbsp;<span class="op" id="5960431">=</span>&nbsp;<span class="ident" id="5960433">dc</span><span class="op" id="5960435">[</span><span class="ident" id="5960436">compIndex</span><span class="op" id="5960445">]</span>&nbsp;<span class="op" id="5960447">&lt;&lt;</span>&nbsp;<span class="ident" id="5960450">al</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5960459">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5960468">if</span>&nbsp;<span class="ident" id="5960471">zig</span>&nbsp;<span class="op" id="5960475">&lt;=</span>&nbsp;<span class="ident" id="5960478">zigEnd</span>&nbsp;<span class="op" id="5960485">&amp;&amp;</span>&nbsp;<span class="ident" id="5960488">d</span><span class="op" id="5960489">.</span><span class="ident" id="5960490">eobRun</span>&nbsp;<span class="op" id="5960497">&gt;</span>&nbsp;<span class="num" id="5960499">0</span>&nbsp;<span class="op" id="5960501">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5960510">d</span><span class="op" id="5960511">.</span><span class="ident" id="5960512">eobRun</span><span class="op" id="5960518">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5960527">}</span>&nbsp;<span class="keyword" id="5960529">else</span>&nbsp;<span class="op" id="5960534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5960543">//&nbsp;Decode&nbsp;the&nbsp;AC&nbsp;coefficients,&nbsp;as&nbsp;specified&nbsp;in&nbsp;section&nbsp;F.2.2.2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5960614">huff</span>&nbsp;<span class="op" id="5960619">:=</span>&nbsp;<span class="op" id="5960622">&amp;</span><span class="ident" id="5960623">d</span><span class="op" id="5960624">.</span><span class="ident" id="5960625">huff</span><span class="op" id="5960629">[</span><span class="ident" id="5960630">acTable</span><span class="op" id="5960637">]</span><span class="op" id="5960638">[</span><span class="ident" id="5960639">scan</span><span class="op" id="5960643">[</span><span class="ident" id="5960644">i</span><span class="op" id="5960645">]</span><span class="op" id="5960646">.</span><span class="ident" id="5960647">ta</span><span class="op" id="5960649">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5960658">for</span>&nbsp;<span class="op" id="5960662">;</span>&nbsp;<span class="ident" id="5960664">zig</span>&nbsp;<span class="op" id="5960668">&lt;=</span>&nbsp;<span class="ident" id="5960671">zigEnd</span><span class="op" id="5960677">;</span>&nbsp;<span class="ident" id="5960679">zig</span><span class="op" id="5960682">++</span>&nbsp;<span class="op" id="5960685">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5960695">value</span><span class="op" id="5960700">,</span>&nbsp;<span class="ident" id="5960702">err</span>&nbsp;<span class="op" id="5960706">:=</span>&nbsp;<span class="ident" id="5960709">d</span><span class="op" id="5960710">.</span><span class="ident" id="5960711">decodeHuffman</span><span class="op" id="5960724">(</span><span class="ident" id="5960725">huff</span><span class="op" id="5960729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5960739">if</span>&nbsp;<span class="ident" id="5960742">err</span>&nbsp;<span class="op" id="5960746">!=</span>&nbsp;<span class="ident" id="5960749">nil</span>&nbsp;<span class="op" id="5960753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5960764">return</span>&nbsp;<span class="ident" id="5960771">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5960783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5960793">val0</span>&nbsp;<span class="op" id="5960798">:=</span>&nbsp;<span class="ident" id="5960801">value</span>&nbsp;<span class="op" id="5960807">&gt;&gt;</span>&nbsp;<span class="num" id="5960810">4</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5960820">val1</span>&nbsp;<span class="op" id="5960825">:=</span>&nbsp;<span class="ident" id="5960828">value</span>&nbsp;<span class="op" id="5960834">&amp;</span>&nbsp;<span class="num" id="5960836">0x0f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5960849">if</span>&nbsp;<span class="ident" id="5960852">val1</span>&nbsp;<span class="op" id="5960857">!=</span>&nbsp;<span class="num" id="5960860">0</span>&nbsp;<span class="op" id="5960862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5960873">zig</span>&nbsp;<span class="op" id="5960877">+=</span>&nbsp;<span class="builtintype" id="5960880">int32</span><span class="op" id="5960885">(</span><span class="ident" id="5960886">val0</span><span class="op" id="5960890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5960901">if</span>&nbsp;<span class="ident" id="5960904">zig</span>&nbsp;<span class="op" id="5960908">&gt;</span>&nbsp;<span class="ident" id="5960910">zigEnd</span>&nbsp;<span class="op" id="5960917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5960929">break</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5960944">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5960955">ac</span><span class="op" id="5960957">,</span>&nbsp;<span class="ident" id="5960959">err</span>&nbsp;<span class="op" id="5960963">:=</span>&nbsp;<span class="ident" id="5960966">d</span><span class="op" id="5960967">.</span><span class="ident" id="5960968">receiveExtend</span><span class="op" id="5960981">(</span><span class="ident" id="5960982">val1</span><span class="op" id="5960986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5960997">if</span>&nbsp;<span class="ident" id="5961000">err</span>&nbsp;<span class="op" id="5961004">!=</span>&nbsp;<span class="ident" id="5961007">nil</span>&nbsp;<span class="op" id="5961011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5961023">return</span>&nbsp;<span class="ident" id="5961030">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5961043">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961054">b</span><span class="op" id="5961055">[</span><span class="ident" id="5961056">unzig</span><span class="op" id="5961061">[</span><span class="ident" id="5961062">zig</span><span class="op" id="5961065">]</span><span class="op" id="5961066">]</span>&nbsp;<span class="op" id="5961068">=</span>&nbsp;<span class="ident" id="5961070">ac</span>&nbsp;<span class="op" id="5961073">&lt;&lt;</span>&nbsp;<span class="ident" id="5961076">al</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5961087">}</span>&nbsp;<span class="keyword" id="5961089">else</span>&nbsp;<span class="op" id="5961094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5961105">if</span>&nbsp;<span class="ident" id="5961108">val0</span>&nbsp;<span class="op" id="5961113">!=</span>&nbsp;<span class="num" id="5961116">0x0f</span>&nbsp;<span class="op" id="5961121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961133">d</span><span class="op" id="5961134">.</span><span class="ident" id="5961135">eobRun</span>&nbsp;<span class="op" id="5961142">=</span>&nbsp;<span class="builtintype" id="5961144">uint16</span><span class="op" id="5961150">(</span><span class="num" id="5961151">1</span>&nbsp;<span class="op" id="5961153">&lt;&lt;</span>&nbsp;<span class="ident" id="5961156">val0</span><span class="op" id="5961160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5961172">if</span>&nbsp;<span class="ident" id="5961175">val0</span>&nbsp;<span class="op" id="5961180">!=</span>&nbsp;<span class="num" id="5961183">0</span>&nbsp;<span class="op" id="5961185">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961198">bits</span><span class="op" id="5961202">,</span>&nbsp;<span class="ident" id="5961204">err</span>&nbsp;<span class="op" id="5961208">:=</span>&nbsp;<span class="ident" id="5961211">d</span><span class="op" id="5961212">.</span><span class="ident" id="5961213">decodeBits</span><span class="op" id="5961223">(</span><span class="builtintype" id="5961224">int32</span><span class="op" id="5961229">(</span><span class="ident" id="5961230">val0</span><span class="op" id="5961234">)</span><span class="op" id="5961235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5961248">if</span>&nbsp;<span class="ident" id="5961251">err</span>&nbsp;<span class="op" id="5961255">!=</span>&nbsp;<span class="ident" id="5961258">nil</span>&nbsp;<span class="op" id="5961262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5961276">return</span>&nbsp;<span class="ident" id="5961283">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5961298">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961311">d</span><span class="op" id="5961312">.</span><span class="ident" id="5961313">eobRun</span>&nbsp;<span class="op" id="5961320">|=</span>&nbsp;<span class="builtintype" id="5961323">uint16</span><span class="op" id="5961329">(</span><span class="ident" id="5961330">bits</span><span class="op" id="5961334">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5961346">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961358">d</span><span class="op" id="5961359">.</span><span class="ident" id="5961360">eobRun</span><span class="op" id="5961366">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5961379">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5961394">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961405">zig</span>&nbsp;<span class="op" id="5961409">+=</span>&nbsp;<span class="num" id="5961412">0x0f</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5961425">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5961434">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5961442">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5961449">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5961457">if</span>&nbsp;<span class="ident" id="5961460">d</span><span class="op" id="5961461">.</span><span class="ident" id="5961462">progressive</span>&nbsp;<span class="op" id="5961474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5961482">if</span>&nbsp;<span class="ident" id="5961485">zigEnd</span>&nbsp;<span class="op" id="5961492">!=</span>&nbsp;<span class="ident" id="5961495">blockSize</span><span class="op" id="5961504">-</span><span class="num" id="5961505">1</span>&nbsp;<span class="op" id="5961507">||</span>&nbsp;<span class="ident" id="5961510">al</span>&nbsp;<span class="op" id="5961513">!=</span>&nbsp;<span class="num" id="5961516">0</span>&nbsp;<span class="op" id="5961518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5961527">//&nbsp;We&nbsp;haven&#39;t&nbsp;completely&nbsp;decoded&nbsp;this&nbsp;8x8&nbsp;block.&nbsp;Save&nbsp;the&nbsp;coefficients.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961606">d</span><span class="op" id="5961607">.</span><span class="ident" id="5961608">progCoeffs</span><span class="op" id="5961618">[</span><span class="ident" id="5961619">compIndex</span><span class="op" id="5961628">]</span><span class="op" id="5961629">[</span><span class="ident" id="5961630">by</span><span class="op" id="5961632">*</span><span class="ident" id="5961633">mxx</span><span class="op" id="5961636">*</span><span class="ident" id="5961637">d</span><span class="op" id="5961638">.</span><span class="ident" id="5961639">comp</span><span class="op" id="5961643">[</span><span class="ident" id="5961644">compIndex</span><span class="op" id="5961653">]</span><span class="op" id="5961654">.</span><span class="ident" id="5961655">h</span><span class="op" id="5961656">+</span><span class="ident" id="5961657">bx</span><span class="op" id="5961659">]</span>&nbsp;<span class="op" id="5961661">=</span>&nbsp;<span class="ident" id="5961663">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5961672">//&nbsp;At&nbsp;this&nbsp;point,&nbsp;we&nbsp;could&nbsp;execute&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;loop&nbsp;body&nbsp;to&nbsp;dequantize&nbsp;and</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5961758">//&nbsp;perform&nbsp;the&nbsp;inverse&nbsp;DCT,&nbsp;to&nbsp;save&nbsp;early&nbsp;stages&nbsp;of&nbsp;a&nbsp;progressive&nbsp;image&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5961844">//&nbsp;*image.YCbCr&nbsp;buffers&nbsp;(the&nbsp;whole&nbsp;point&nbsp;of&nbsp;progressive&nbsp;encoding),&nbsp;but&nbsp;in&nbsp;Go,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5961929">//&nbsp;the&nbsp;jpeg.Decode&nbsp;function&nbsp;does&nbsp;not&nbsp;return&nbsp;until&nbsp;the&nbsp;entire&nbsp;image&nbsp;is&nbsp;decoded,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5962015">//&nbsp;so&nbsp;we&nbsp;&#34;continue&#34;&nbsp;here&nbsp;to&nbsp;avoid&nbsp;wasted&nbsp;computation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5962076">continue</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5962091">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5962098">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5962106">//&nbsp;Dequantize,&nbsp;perform&nbsp;the&nbsp;inverse&nbsp;DCT&nbsp;and&nbsp;store&nbsp;the&nbsp;block&nbsp;to&nbsp;the&nbsp;image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5962184">for</span>&nbsp;<span class="ident" id="5962188">zig</span>&nbsp;<span class="op" id="5962192">:=</span>&nbsp;<span class="num" id="5962195">0</span><span class="op" id="5962196">;</span>&nbsp;<span class="ident" id="5962198">zig</span>&nbsp;<span class="op" id="5962202">&lt;</span>&nbsp;<span class="ident" id="5962204">blockSize</span><span class="op" id="5962213">;</span>&nbsp;<span class="ident" id="5962215">zig</span><span class="op" id="5962218">++</span>&nbsp;<span class="op" id="5962221">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962229">b</span><span class="op" id="5962230">[</span><span class="ident" id="5962231">unzig</span><span class="op" id="5962236">[</span><span class="ident" id="5962237">zig</span><span class="op" id="5962240">]</span><span class="op" id="5962241">]</span>&nbsp;<span class="op" id="5962243">*=</span>&nbsp;<span class="ident" id="5962246">qt</span><span class="op" id="5962248">[</span><span class="ident" id="5962249">zig</span><span class="op" id="5962252">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5962259">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962266">idct</span><span class="op" id="5962270">(</span><span class="op" id="5962271">&amp;</span><span class="ident" id="5962272">b</span><span class="op" id="5962273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962280">dst</span><span class="op" id="5962283">,</span>&nbsp;<span class="ident" id="5962285">stride</span>&nbsp;<span class="op" id="5962292">:=</span>&nbsp;<span class="op" id="5962295">[</span><span class="op" id="5962296">]</span><span class="builtintype" id="5962297">byte</span><span class="op" id="5962301">(</span><span class="ident" id="5962302">nil</span><span class="op" id="5962305">)</span><span class="op" id="5962306">,</span>&nbsp;<span class="num" id="5962308">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5962315">if</span>&nbsp;<span class="ident" id="5962318">d</span><span class="op" id="5962319">.</span><span class="ident" id="5962320">nComp</span>&nbsp;<span class="op" id="5962326">==</span>&nbsp;<span class="ident" id="5962329">nGrayComponent</span>&nbsp;<span class="op" id="5962344">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962352">dst</span><span class="op" id="5962355">,</span>&nbsp;<span class="ident" id="5962357">stride</span>&nbsp;<span class="op" id="5962364">=</span>&nbsp;<span class="ident" id="5962366">d</span><span class="op" id="5962367">.</span><span class="ident" id="5962368">img1</span><span class="op" id="5962372">.</span><span class="ident" id="5962373">Pix</span><span class="op" id="5962376">[</span><span class="num" id="5962377">8</span><span class="op" id="5962378">*</span><span class="op" id="5962379">(</span><span class="ident" id="5962380">by</span><span class="op" id="5962382">*</span><span class="ident" id="5962383">d</span><span class="op" id="5962384">.</span><span class="ident" id="5962385">img1</span><span class="op" id="5962389">.</span><span class="ident" id="5962390">Stride</span><span class="op" id="5962396">+</span><span class="ident" id="5962397">bx</span><span class="op" id="5962399">)</span><span class="op" id="5962400">:</span><span class="op" id="5962401">]</span><span class="op" id="5962402">,</span>&nbsp;<span class="ident" id="5962404">d</span><span class="op" id="5962405">.</span><span class="ident" id="5962406">img1</span><span class="op" id="5962410">.</span><span class="ident" id="5962411">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5962423">}</span>&nbsp;<span class="keyword" id="5962425">else</span>&nbsp;<span class="op" id="5962430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5962438">switch</span>&nbsp;<span class="ident" id="5962445">compIndex</span>&nbsp;<span class="op" id="5962455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5962463">case</span>&nbsp;<span class="num" id="5962468">0</span><span class="op" id="5962469">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962478">dst</span><span class="op" id="5962481">,</span>&nbsp;<span class="ident" id="5962483">stride</span>&nbsp;<span class="op" id="5962490">=</span>&nbsp;<span class="ident" id="5962492">d</span><span class="op" id="5962493">.</span><span class="ident" id="5962494">img3</span><span class="op" id="5962498">.</span><span class="ident" id="5962499">Y</span><span class="op" id="5962500">[</span><span class="num" id="5962501">8</span><span class="op" id="5962502">*</span><span class="op" id="5962503">(</span><span class="ident" id="5962504">by</span><span class="op" id="5962506">*</span><span class="ident" id="5962507">d</span><span class="op" id="5962508">.</span><span class="ident" id="5962509">img3</span><span class="op" id="5962513">.</span><span class="ident" id="5962514">YStride</span><span class="op" id="5962521">+</span><span class="ident" id="5962522">bx</span><span class="op" id="5962524">)</span><span class="op" id="5962525">:</span><span class="op" id="5962526">]</span><span class="op" id="5962527">,</span>&nbsp;<span class="ident" id="5962529">d</span><span class="op" id="5962530">.</span><span class="ident" id="5962531">img3</span><span class="op" id="5962535">.</span><span class="ident" id="5962536">YStride</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5962550">case</span>&nbsp;<span class="num" id="5962555">1</span><span class="op" id="5962556">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962565">dst</span><span class="op" id="5962568">,</span>&nbsp;<span class="ident" id="5962570">stride</span>&nbsp;<span class="op" id="5962577">=</span>&nbsp;<span class="ident" id="5962579">d</span><span class="op" id="5962580">.</span><span class="ident" id="5962581">img3</span><span class="op" id="5962585">.</span><span class="ident" id="5962586">Cb</span><span class="op" id="5962588">[</span><span class="num" id="5962589">8</span><span class="op" id="5962590">*</span><span class="op" id="5962591">(</span><span class="ident" id="5962592">by</span><span class="op" id="5962594">*</span><span class="ident" id="5962595">d</span><span class="op" id="5962596">.</span><span class="ident" id="5962597">img3</span><span class="op" id="5962601">.</span><span class="ident" id="5962602">CStride</span><span class="op" id="5962609">+</span><span class="ident" id="5962610">bx</span><span class="op" id="5962612">)</span><span class="op" id="5962613">:</span><span class="op" id="5962614">]</span><span class="op" id="5962615">,</span>&nbsp;<span class="ident" id="5962617">d</span><span class="op" id="5962618">.</span><span class="ident" id="5962619">img3</span><span class="op" id="5962623">.</span><span class="ident" id="5962624">CStride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5962638">case</span>&nbsp;<span class="num" id="5962643">2</span><span class="op" id="5962644">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962653">dst</span><span class="op" id="5962656">,</span>&nbsp;<span class="ident" id="5962658">stride</span>&nbsp;<span class="op" id="5962665">=</span>&nbsp;<span class="ident" id="5962667">d</span><span class="op" id="5962668">.</span><span class="ident" id="5962669">img3</span><span class="op" id="5962673">.</span><span class="ident" id="5962674">Cr</span><span class="op" id="5962676">[</span><span class="num" id="5962677">8</span><span class="op" id="5962678">*</span><span class="op" id="5962679">(</span><span class="ident" id="5962680">by</span><span class="op" id="5962682">*</span><span class="ident" id="5962683">d</span><span class="op" id="5962684">.</span><span class="ident" id="5962685">img3</span><span class="op" id="5962689">.</span><span class="ident" id="5962690">CStride</span><span class="op" id="5962697">+</span><span class="ident" id="5962698">bx</span><span class="op" id="5962700">)</span><span class="op" id="5962701">:</span><span class="op" id="5962702">]</span><span class="op" id="5962703">,</span>&nbsp;<span class="ident" id="5962705">d</span><span class="op" id="5962706">.</span><span class="ident" id="5962707">img3</span><span class="op" id="5962711">.</span><span class="ident" id="5962712">CStride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5962726">default</span><span class="op" id="5962733">:</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5962742">return</span>&nbsp;<span class="ident" id="5962749">UnsupportedError</span><span class="op" id="5962765">(</span><span class="string" id="5962766">&#34;too&nbsp;many&nbsp;components&#34;</span><span class="op" id="5962787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5962795">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5962802">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5962809">//&nbsp;Level&nbsp;shift&nbsp;by&nbsp;+128,&nbsp;clip&nbsp;to&nbsp;[0,&nbsp;255],&nbsp;and&nbsp;write&nbsp;to&nbsp;dst.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5962874">for</span>&nbsp;<span class="ident" id="5962878">y</span>&nbsp;<span class="op" id="5962880">:=</span>&nbsp;<span class="num" id="5962883">0</span><span class="op" id="5962884">;</span>&nbsp;<span class="ident" id="5962886">y</span>&nbsp;<span class="op" id="5962888">&lt;</span>&nbsp;<span class="num" id="5962890">8</span><span class="op" id="5962891">;</span>&nbsp;<span class="ident" id="5962893">y</span><span class="op" id="5962894">++</span>&nbsp;<span class="op" id="5962897">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962905">y8</span>&nbsp;<span class="op" id="5962908">:=</span>&nbsp;<span class="ident" id="5962911">y</span>&nbsp;<span class="op" id="5962913">*</span>&nbsp;<span class="num" id="5962915">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962923">yStride</span>&nbsp;<span class="op" id="5962931">:=</span>&nbsp;<span class="ident" id="5962934">y</span>&nbsp;<span class="op" id="5962936">*</span>&nbsp;<span class="ident" id="5962938">stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5962951">for</span>&nbsp;<span class="ident" id="5962955">x</span>&nbsp;<span class="op" id="5962957">:=</span>&nbsp;<span class="num" id="5962960">0</span><span class="op" id="5962961">;</span>&nbsp;<span class="ident" id="5962963">x</span>&nbsp;<span class="op" id="5962965">&lt;</span>&nbsp;<span class="num" id="5962967">8</span><span class="op" id="5962968">;</span>&nbsp;<span class="ident" id="5962970">x</span><span class="op" id="5962971">++</span>&nbsp;<span class="op" id="5962974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962983">c</span>&nbsp;<span class="op" id="5962985">:=</span>&nbsp;<span class="ident" id="5962988">b</span><span class="op" id="5962989">[</span><span class="ident" id="5962990">y8</span><span class="op" id="5962992">+</span><span class="ident" id="5962993">x</span><span class="op" id="5962994">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5963003">if</span>&nbsp;<span class="ident" id="5963006">c</span>&nbsp;<span class="op" id="5963008">&lt;</span>&nbsp;<span class="op" id="5963010">-</span><span class="num" id="5963011">128</span>&nbsp;<span class="op" id="5963015">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963025">c</span>&nbsp;<span class="op" id="5963027">=</span>&nbsp;<span class="num" id="5963029">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5963038">}</span>&nbsp;<span class="keyword" id="5963040">else</span>&nbsp;<span class="keyword" id="5963045">if</span>&nbsp;<span class="ident" id="5963048">c</span>&nbsp;<span class="op" id="5963050">&gt;</span>&nbsp;<span class="num" id="5963052">127</span>&nbsp;<span class="op" id="5963056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963066">c</span>&nbsp;<span class="op" id="5963068">=</span>&nbsp;<span class="num" id="5963070">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5963081">}</span>&nbsp;<span class="keyword" id="5963083">else</span>&nbsp;<span class="op" id="5963088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963098">c</span>&nbsp;<span class="op" id="5963100">+=</span>&nbsp;<span class="num" id="5963103">128</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5963114">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963123">dst</span><span class="op" id="5963126">[</span><span class="ident" id="5963127">yStride</span><span class="op" id="5963134">+</span><span class="ident" id="5963135">x</span><span class="op" id="5963136">]</span>&nbsp;<span class="op" id="5963138">=</span>&nbsp;<span class="builtintype" id="5963140">uint8</span><span class="op" id="5963145">(</span><span class="ident" id="5963146">c</span><span class="op" id="5963147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5963155">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5963162">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5963168">}</span>&nbsp;<span class="comment" id="5963170">//&nbsp;for&nbsp;j</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5963182">}</span>&nbsp;<span class="comment" id="5963184">//&nbsp;for&nbsp;i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963196">mcu</span><span class="op" id="5963199">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5963205">if</span>&nbsp;<span class="ident" id="5963208">d</span><span class="op" id="5963209">.</span><span class="ident" id="5963210">ri</span>&nbsp;<span class="op" id="5963213">&gt;</span>&nbsp;<span class="num" id="5963215">0</span>&nbsp;<span class="op" id="5963217">&amp;&amp;</span>&nbsp;<span class="ident" id="5963220">mcu</span><span class="op" id="5963223">%</span><span class="ident" id="5963224">d</span><span class="op" id="5963225">.</span><span class="ident" id="5963226">ri</span>&nbsp;<span class="op" id="5963229">==</span>&nbsp;<span class="num" id="5963232">0</span>&nbsp;<span class="op" id="5963234">&amp;&amp;</span>&nbsp;<span class="ident" id="5963237">mcu</span>&nbsp;<span class="op" id="5963241">&lt;</span>&nbsp;<span class="ident" id="5963243">mxx</span><span class="op" id="5963246">*</span><span class="ident" id="5963247">myy</span>&nbsp;<span class="op" id="5963251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5963257">//&nbsp;A&nbsp;more&nbsp;sophisticated&nbsp;decoder&nbsp;could&nbsp;use&nbsp;RST[0-7]&nbsp;markers&nbsp;to&nbsp;resynchronize&nbsp;from&nbsp;corrupt&nbsp;input,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5963357">//&nbsp;but&nbsp;this&nbsp;one&nbsp;assumes&nbsp;well-formed&nbsp;input,&nbsp;and&nbsp;hence&nbsp;the&nbsp;restart&nbsp;marker&nbsp;follows&nbsp;immediately.</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5963454">if</span>&nbsp;<span class="ident" id="5963457">err</span>&nbsp;<span class="op" id="5963461">:=</span>&nbsp;<span class="ident" id="5963464">d</span><span class="op" id="5963465">.</span><span class="ident" id="5963466">readFull</span><span class="op" id="5963474">(</span><span class="ident" id="5963475">d</span><span class="op" id="5963476">.</span><span class="ident" id="5963477">tmp</span><span class="op" id="5963480">[</span><span class="op" id="5963481">:</span><span class="num" id="5963482">2</span><span class="op" id="5963483">]</span><span class="op" id="5963484">)</span><span class="op" id="5963485">;</span>&nbsp;<span class="ident" id="5963487">err</span>&nbsp;<span class="op" id="5963491">!=</span>&nbsp;<span class="ident" id="5963494">nil</span>&nbsp;<span class="op" id="5963498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5963505">return</span>&nbsp;<span class="ident" id="5963512">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5963520">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5963526">if</span>&nbsp;<span class="ident" id="5963529">d</span><span class="op" id="5963530">.</span><span class="ident" id="5963531">tmp</span><span class="op" id="5963534">[</span><span class="num" id="5963535">0</span><span class="op" id="5963536">]</span>&nbsp;<span class="op" id="5963538">!=</span>&nbsp;<span class="num" id="5963541">0xff</span>&nbsp;<span class="op" id="5963546">||</span>&nbsp;<span class="ident" id="5963549">d</span><span class="op" id="5963550">.</span><span class="ident" id="5963551">tmp</span><span class="op" id="5963554">[</span><span class="num" id="5963555">1</span><span class="op" id="5963556">]</span>&nbsp;<span class="op" id="5963558">!=</span>&nbsp;<span class="ident" id="5963561">expectedRST</span>&nbsp;<span class="op" id="5963573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5963580">return</span>&nbsp;<span class="ident" id="5963587">FormatError</span><span class="op" id="5963598">(</span><span class="string" id="5963599">&#34;bad&nbsp;RST&nbsp;marker&#34;</span><span class="op" id="5963615">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5963621">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963627">expectedRST</span><span class="op" id="5963638">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5963645">if</span>&nbsp;<span class="ident" id="5963648">expectedRST</span>&nbsp;<span class="op" id="5963660">==</span>&nbsp;<span class="ident" id="5963663">rst7Marker</span><span class="op" id="5963673">+</span><span class="num" id="5963674">1</span>&nbsp;<span class="op" id="5963676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963683">expectedRST</span>&nbsp;<span class="op" id="5963695">=</span>&nbsp;<span class="ident" id="5963697">rst0Marker</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5963712">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5963718">//&nbsp;Reset&nbsp;the&nbsp;Huffman&nbsp;decoder.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963752">d</span><span class="op" id="5963753">.</span><span class="ident" id="5963754">bits</span>&nbsp;<span class="op" id="5963759">=</span>&nbsp;<span class="ident" id="5963761">bits</span><span class="op" id="5963765">{</span><span class="op" id="5963766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5963772">//&nbsp;Reset&nbsp;the&nbsp;DC&nbsp;components,&nbsp;as&nbsp;per&nbsp;section&nbsp;F.2.1.3.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963830">dc</span>&nbsp;<span class="op" id="5963833">=</span>&nbsp;<span class="op" id="5963835">[</span><span class="ident" id="5963836">nColorComponent</span><span class="op" id="5963851">]</span><span class="builtintype" id="5963852">int32</span><span class="op" id="5963857">{</span><span class="op" id="5963858">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5963864">//&nbsp;Reset&nbsp;the&nbsp;progressive&nbsp;decoder&nbsp;state,&nbsp;as&nbsp;per&nbsp;section&nbsp;G.1.2.2.</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963932">d</span><span class="op" id="5963933">.</span><span class="ident" id="5963934">eobRun</span>&nbsp;<span class="op" id="5963941">=</span>&nbsp;<span class="num" id="5963943">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5963948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5963952">}</span>&nbsp;<span class="comment" id="5963954">//&nbsp;for&nbsp;mx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5963965">}</span>&nbsp;<span class="comment" id="5963967">//&nbsp;for&nbsp;my</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5963979">return</span>&nbsp;<span class="ident" id="5963986">nil</span><br>
<span class="lineno"></span><span class="op" id="5963990">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5963993">//&nbsp;refine&nbsp;decodes&nbsp;a&nbsp;successive&nbsp;approximation&nbsp;refinement&nbsp;block,&nbsp;as&nbsp;specified&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="5964072">//&nbsp;section&nbsp;G.1.2.</span><br>
<span class="lineno">340</span><span class="keyword" id="5964090">func</span>&nbsp;<span class="op" id="5964095">(</span><span class="ident" id="5964096">d</span>&nbsp;<span class="op" id="5964098">*</span><span class="ident" id="5964099">decoder</span><span class="op" id="5964106">)</span>&nbsp;<span class="ident" id="5964108">refine</span><span class="op" id="5964114">(</span><span class="ident" id="5964115">b</span>&nbsp;<span class="op" id="5964117">*</span><span class="ident" id="5964118">block</span><span class="op" id="5964123">,</span>&nbsp;<span class="ident" id="5964125">h</span>&nbsp;<span class="op" id="5964127">*</span><span class="ident" id="5964128">huffman</span><span class="op" id="5964135">,</span>&nbsp;<span class="ident" id="5964137">zigStart</span><span class="op" id="5964145">,</span>&nbsp;<span class="ident" id="5964147">zigEnd</span><span class="op" id="5964153">,</span>&nbsp;<span class="ident" id="5964155">delta</span>&nbsp;<span class="builtintype" id="5964161">int32</span><span class="op" id="5964166">)</span>&nbsp;<span class="builtintype" id="5964168">error</span>&nbsp;<span class="op" id="5964174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5964177">//&nbsp;Refining&nbsp;a&nbsp;DC&nbsp;component&nbsp;is&nbsp;trivial.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964217">if</span>&nbsp;<span class="ident" id="5964220">zigStart</span>&nbsp;<span class="op" id="5964229">==</span>&nbsp;<span class="num" id="5964232">0</span>&nbsp;<span class="op" id="5964234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964238">if</span>&nbsp;<span class="ident" id="5964241">zigEnd</span>&nbsp;<span class="op" id="5964248">!=</span>&nbsp;<span class="num" id="5964251">0</span>&nbsp;<span class="op" id="5964253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5964258">panic</span><span class="op" id="5964263">(</span><span class="string" id="5964264">&#34;unreachable&#34;</span><span class="op" id="5964277">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5964281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964285">bit</span><span class="op" id="5964288">,</span>&nbsp;<span class="ident" id="5964290">err</span>&nbsp;<span class="op" id="5964294">:=</span>&nbsp;<span class="ident" id="5964297">d</span><span class="op" id="5964298">.</span><span class="ident" id="5964299">decodeBit</span><span class="op" id="5964308">(</span><span class="op" id="5964309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964313">if</span>&nbsp;<span class="ident" id="5964316">err</span>&nbsp;<span class="op" id="5964320">!=</span>&nbsp;<span class="ident" id="5964323">nil</span>&nbsp;<span class="op" id="5964327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964332">return</span>&nbsp;<span class="ident" id="5964339">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5964345">}</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964349">if</span>&nbsp;<span class="ident" id="5964352">bit</span>&nbsp;<span class="op" id="5964356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964361">b</span><span class="op" id="5964362">[</span><span class="num" id="5964363">0</span><span class="op" id="5964364">]</span>&nbsp;<span class="op" id="5964366">|=</span>&nbsp;<span class="ident" id="5964369">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5964377">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964381">return</span>&nbsp;<span class="ident" id="5964388">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5964393">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5964397">//&nbsp;Refining&nbsp;AC&nbsp;components&nbsp;is&nbsp;more&nbsp;complicated;&nbsp;see&nbsp;sections&nbsp;G.1.2.2&nbsp;and&nbsp;G.1.2.3.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964479">zig</span>&nbsp;<span class="op" id="5964483">:=</span>&nbsp;<span class="ident" id="5964486">zigStart</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964496">if</span>&nbsp;<span class="ident" id="5964499">d</span><span class="op" id="5964500">.</span><span class="ident" id="5964501">eobRun</span>&nbsp;<span class="op" id="5964508">==</span>&nbsp;<span class="num" id="5964511">0</span>&nbsp;<span class="op" id="5964513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964516">loop</span><span class="op" id="5964520">:</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964524">for</span>&nbsp;<span class="op" id="5964528">;</span>&nbsp;<span class="ident" id="5964530">zig</span>&nbsp;<span class="op" id="5964534">&lt;=</span>&nbsp;<span class="ident" id="5964537">zigEnd</span><span class="op" id="5964543">;</span>&nbsp;<span class="ident" id="5964545">zig</span><span class="op" id="5964548">++</span>&nbsp;<span class="op" id="5964551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964556">z</span>&nbsp;<span class="op" id="5964558">:=</span>&nbsp;<span class="builtintype" id="5964561">int32</span><span class="op" id="5964566">(</span><span class="num" id="5964567">0</span><span class="op" id="5964568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964573">value</span><span class="op" id="5964578">,</span>&nbsp;<span class="ident" id="5964580">err</span>&nbsp;<span class="op" id="5964584">:=</span>&nbsp;<span class="ident" id="5964587">d</span><span class="op" id="5964588">.</span><span class="ident" id="5964589">decodeHuffman</span><span class="op" id="5964602">(</span><span class="ident" id="5964603">h</span><span class="op" id="5964604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964609">if</span>&nbsp;<span class="ident" id="5964612">err</span>&nbsp;<span class="op" id="5964616">!=</span>&nbsp;<span class="ident" id="5964619">nil</span>&nbsp;<span class="op" id="5964623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964629">return</span>&nbsp;<span class="ident" id="5964636">err</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5964643">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964648">val0</span>&nbsp;<span class="op" id="5964653">:=</span>&nbsp;<span class="ident" id="5964656">value</span>&nbsp;<span class="op" id="5964662">&gt;&gt;</span>&nbsp;<span class="num" id="5964665">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964670">val1</span>&nbsp;<span class="op" id="5964675">:=</span>&nbsp;<span class="ident" id="5964678">value</span>&nbsp;<span class="op" id="5964684">&amp;</span>&nbsp;<span class="num" id="5964686">0x0f</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964695">switch</span>&nbsp;<span class="ident" id="5964702">val1</span>&nbsp;<span class="op" id="5964707">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964712">case</span>&nbsp;<span class="num" id="5964717">0</span><span class="op" id="5964718">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964724">if</span>&nbsp;<span class="ident" id="5964727">val0</span>&nbsp;<span class="op" id="5964732">!=</span>&nbsp;<span class="num" id="5964735">0x0f</span>&nbsp;<span class="op" id="5964740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964747">d</span><span class="op" id="5964748">.</span><span class="ident" id="5964749">eobRun</span>&nbsp;<span class="op" id="5964756">=</span>&nbsp;<span class="builtintype" id="5964758">uint16</span><span class="op" id="5964764">(</span><span class="num" id="5964765">1</span>&nbsp;<span class="op" id="5964767">&lt;&lt;</span>&nbsp;<span class="ident" id="5964770">val0</span><span class="op" id="5964774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964781">if</span>&nbsp;<span class="ident" id="5964784">val0</span>&nbsp;<span class="op" id="5964789">!=</span>&nbsp;<span class="num" id="5964792">0</span>&nbsp;<span class="op" id="5964794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964802">bits</span><span class="op" id="5964806">,</span>&nbsp;<span class="ident" id="5964808">err</span>&nbsp;<span class="op" id="5964812">:=</span>&nbsp;<span class="ident" id="5964815">d</span><span class="op" id="5964816">.</span><span class="ident" id="5964817">decodeBits</span><span class="op" id="5964827">(</span><span class="builtintype" id="5964828">int32</span><span class="op" id="5964833">(</span><span class="ident" id="5964834">val0</span><span class="op" id="5964838">)</span><span class="op" id="5964839">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964847">if</span>&nbsp;<span class="ident" id="5964850">err</span>&nbsp;<span class="op" id="5964854">!=</span>&nbsp;<span class="ident" id="5964857">nil</span>&nbsp;<span class="op" id="5964861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964870">return</span>&nbsp;<span class="ident" id="5964877">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5964887">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964895">d</span><span class="op" id="5964896">.</span><span class="ident" id="5964897">eobRun</span>&nbsp;<span class="op" id="5964904">|=</span>&nbsp;<span class="builtintype" id="5964907">uint16</span><span class="op" id="5964913">(</span><span class="ident" id="5964914">bits</span><span class="op" id="5964918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5964925">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964932">break</span>&nbsp;<span class="ident" id="5964938">loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5964947">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964952">case</span>&nbsp;<span class="num" id="5964957">1</span><span class="op" id="5964958">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964964">z</span>&nbsp;<span class="op" id="5964966">=</span>&nbsp;<span class="ident" id="5964968">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964978">bit</span><span class="op" id="5964981">,</span>&nbsp;<span class="ident" id="5964983">err</span>&nbsp;<span class="op" id="5964987">:=</span>&nbsp;<span class="ident" id="5964990">d</span><span class="op" id="5964991">.</span><span class="ident" id="5964992">decodeBit</span><span class="op" id="5965001">(</span><span class="op" id="5965002">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965008">if</span>&nbsp;<span class="ident" id="5965011">err</span>&nbsp;<span class="op" id="5965015">!=</span>&nbsp;<span class="ident" id="5965018">nil</span>&nbsp;<span class="op" id="5965022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965029">return</span>&nbsp;<span class="ident" id="5965036">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5965044">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965050">if</span>&nbsp;<span class="op" id="5965053">!</span><span class="ident" id="5965054">bit</span>&nbsp;<span class="op" id="5965058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5965065">z</span>&nbsp;<span class="op" id="5965067">=</span>&nbsp;<span class="op" id="5965069">-</span><span class="ident" id="5965070">z</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5965076">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965081">default</span><span class="op" id="5965088">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965094">return</span>&nbsp;<span class="ident" id="5965101">FormatError</span><span class="op" id="5965112">(</span><span class="string" id="5965113">&#34;unexpected&nbsp;Huffman&nbsp;code&#34;</span><span class="op" id="5965138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5965143">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5965149">zig</span><span class="op" id="5965152">,</span>&nbsp;<span class="ident" id="5965154">err</span>&nbsp;<span class="op" id="5965158">=</span>&nbsp;<span class="ident" id="5965160">d</span><span class="op" id="5965161">.</span><span class="ident" id="5965162">refineNonZeroes</span><span class="op" id="5965177">(</span><span class="ident" id="5965178">b</span><span class="op" id="5965179">,</span>&nbsp;<span class="ident" id="5965181">zig</span><span class="op" id="5965184">,</span>&nbsp;<span class="ident" id="5965186">zigEnd</span><span class="op" id="5965192">,</span>&nbsp;<span class="builtintype" id="5965194">int32</span><span class="op" id="5965199">(</span><span class="ident" id="5965200">val0</span><span class="op" id="5965204">)</span><span class="op" id="5965205">,</span>&nbsp;<span class="ident" id="5965207">delta</span><span class="op" id="5965212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965217">if</span>&nbsp;<span class="ident" id="5965220">err</span>&nbsp;<span class="op" id="5965224">!=</span>&nbsp;<span class="ident" id="5965227">nil</span>&nbsp;<span class="op" id="5965231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965237">return</span>&nbsp;<span class="ident" id="5965244">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5965251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965256">if</span>&nbsp;<span class="ident" id="5965259">zig</span>&nbsp;<span class="op" id="5965263">&gt;</span>&nbsp;<span class="ident" id="5965265">zigEnd</span>&nbsp;<span class="op" id="5965272">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965278">return</span>&nbsp;<span class="ident" id="5965285">FormatError</span><span class="op" id="5965296">(</span><span class="string" id="5965297">&#34;too&nbsp;many&nbsp;coefficients&#34;</span><span class="op" id="5965320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5965325">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965330">if</span>&nbsp;<span class="ident" id="5965333">z</span>&nbsp;<span class="op" id="5965335">!=</span>&nbsp;<span class="num" id="5965338">0</span>&nbsp;<span class="op" id="5965340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5965346">b</span><span class="op" id="5965347">[</span><span class="ident" id="5965348">unzig</span><span class="op" id="5965353">[</span><span class="ident" id="5965354">zig</span><span class="op" id="5965357">]</span><span class="op" id="5965358">]</span>&nbsp;<span class="op" id="5965360">=</span>&nbsp;<span class="ident" id="5965362">z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5965367">}</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5965371">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5965374">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965377">if</span>&nbsp;<span class="ident" id="5965380">d</span><span class="op" id="5965381">.</span><span class="ident" id="5965382">eobRun</span>&nbsp;<span class="op" id="5965389">&gt;</span>&nbsp;<span class="num" id="5965391">0</span>&nbsp;<span class="op" id="5965393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5965397">d</span><span class="op" id="5965398">.</span><span class="ident" id="5965399">eobRun</span><span class="op" id="5965405">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965410">if</span>&nbsp;<span class="ident" id="5965413">_</span><span class="op" id="5965414">,</span>&nbsp;<span class="ident" id="5965416">err</span>&nbsp;<span class="op" id="5965420">:=</span>&nbsp;<span class="ident" id="5965423">d</span><span class="op" id="5965424">.</span><span class="ident" id="5965425">refineNonZeroes</span><span class="op" id="5965440">(</span><span class="ident" id="5965441">b</span><span class="op" id="5965442">,</span>&nbsp;<span class="ident" id="5965444">zig</span><span class="op" id="5965447">,</span>&nbsp;<span class="ident" id="5965449">zigEnd</span><span class="op" id="5965455">,</span>&nbsp;<span class="op" id="5965457">-</span><span class="num" id="5965458">1</span><span class="op" id="5965459">,</span>&nbsp;<span class="ident" id="5965461">delta</span><span class="op" id="5965466">)</span><span class="op" id="5965467">;</span>&nbsp;<span class="ident" id="5965469">err</span>&nbsp;<span class="op" id="5965473">!=</span>&nbsp;<span class="ident" id="5965476">nil</span>&nbsp;<span class="op" id="5965480">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965485">return</span>&nbsp;<span class="ident" id="5965492">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5965498">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5965501">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965504">return</span>&nbsp;<span class="ident" id="5965511">nil</span><br>
<span class="lineno"></span><span class="op" id="5965515">}</span><br>
<span class="lineno">415</span><br>
<span class="lineno"></span><span class="comment" id="5965518">//&nbsp;refineNonZeroes&nbsp;refines&nbsp;non-zero&nbsp;entries&nbsp;of&nbsp;b&nbsp;in&nbsp;zig-zag&nbsp;order.&nbsp;If&nbsp;nz&nbsp;&gt;=&nbsp;0,</span><br>
<span class="lineno"></span><span class="comment" id="5965597">//&nbsp;the&nbsp;first&nbsp;nz&nbsp;zero&nbsp;entries&nbsp;are&nbsp;skipped&nbsp;over.</span><br>
<span class="lineno"></span><span class="keyword" id="5965644">func</span>&nbsp;<span class="op" id="5965649">(</span><span class="ident" id="5965650">d</span>&nbsp;<span class="op" id="5965652">*</span><span class="ident" id="5965653">decoder</span><span class="op" id="5965660">)</span>&nbsp;<span class="ident" id="5965662">refineNonZeroes</span><span class="op" id="5965677">(</span><span class="ident" id="5965678">b</span>&nbsp;<span class="op" id="5965680">*</span><span class="ident" id="5965681">block</span><span class="op" id="5965686">,</span>&nbsp;<span class="ident" id="5965688">zig</span><span class="op" id="5965691">,</span>&nbsp;<span class="ident" id="5965693">zigEnd</span><span class="op" id="5965699">,</span>&nbsp;<span class="ident" id="5965701">nz</span><span class="op" id="5965703">,</span>&nbsp;<span class="ident" id="5965705">delta</span>&nbsp;<span class="builtintype" id="5965711">int32</span><span class="op" id="5965716">)</span>&nbsp;<span class="op" id="5965718">(</span><span class="builtintype" id="5965719">int32</span><span class="op" id="5965724">,</span>&nbsp;<span class="builtintype" id="5965726">error</span><span class="op" id="5965731">)</span>&nbsp;<span class="op" id="5965733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965736">for</span>&nbsp;<span class="op" id="5965740">;</span>&nbsp;<span class="ident" id="5965742">zig</span>&nbsp;<span class="op" id="5965746">&lt;=</span>&nbsp;<span class="ident" id="5965749">zigEnd</span><span class="op" id="5965755">;</span>&nbsp;<span class="ident" id="5965757">zig</span><span class="op" id="5965760">++</span>&nbsp;<span class="op" id="5965763">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5965767">u</span>&nbsp;<span class="op" id="5965769">:=</span>&nbsp;<span class="ident" id="5965772">unzig</span><span class="op" id="5965777">[</span><span class="ident" id="5965778">zig</span><span class="op" id="5965781">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965785">if</span>&nbsp;<span class="ident" id="5965788">b</span><span class="op" id="5965789">[</span><span class="ident" id="5965790">u</span><span class="op" id="5965791">]</span>&nbsp;<span class="op" id="5965793">==</span>&nbsp;<span class="num" id="5965796">0</span>&nbsp;<span class="op" id="5965798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965803">if</span>&nbsp;<span class="ident" id="5965806">nz</span>&nbsp;<span class="op" id="5965809">==</span>&nbsp;<span class="num" id="5965812">0</span>&nbsp;<span class="op" id="5965814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965820">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5965829">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5965834">nz</span><span class="op" id="5965836">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965842">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5965853">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5965857">bit</span><span class="op" id="5965860">,</span>&nbsp;<span class="ident" id="5965862">err</span>&nbsp;<span class="op" id="5965866">:=</span>&nbsp;<span class="ident" id="5965869">d</span><span class="op" id="5965870">.</span><span class="ident" id="5965871">decodeBit</span><span class="op" id="5965880">(</span><span class="op" id="5965881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965885">if</span>&nbsp;<span class="ident" id="5965888">err</span>&nbsp;<span class="op" id="5965892">!=</span>&nbsp;<span class="ident" id="5965895">nil</span>&nbsp;<span class="op" id="5965899">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965904">return</span>&nbsp;<span class="num" id="5965911">0</span><span class="op" id="5965912">,</span>&nbsp;<span class="ident" id="5965914">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5965920">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965924">if</span>&nbsp;<span class="op" id="5965927">!</span><span class="ident" id="5965928">bit</span>&nbsp;<span class="op" id="5965932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965937">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5965948">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965952">if</span>&nbsp;<span class="ident" id="5965955">b</span><span class="op" id="5965956">[</span><span class="ident" id="5965957">u</span><span class="op" id="5965958">]</span>&nbsp;<span class="op" id="5965960">&gt;=</span>&nbsp;<span class="num" id="5965963">0</span>&nbsp;<span class="op" id="5965965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5965970">b</span><span class="op" id="5965971">[</span><span class="ident" id="5965972">u</span><span class="op" id="5965973">]</span>&nbsp;<span class="op" id="5965975">+=</span>&nbsp;<span class="ident" id="5965978">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5965986">}</span>&nbsp;<span class="keyword" id="5965988">else</span>&nbsp;<span class="op" id="5965993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5965998">b</span><span class="op" id="5965999">[</span><span class="ident" id="5966000">u</span><span class="op" id="5966001">]</span>&nbsp;<span class="op" id="5966003">-=</span>&nbsp;<span class="ident" id="5966006">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5966014">}</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5966017">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5966020">return</span>&nbsp;<span class="ident" id="5966027">zig</span><span class="op" id="5966030">,</span>&nbsp;<span class="ident" id="5966032">nil</span><br>
<span class="lineno"></span><span class="op" id="5966036">}</span>
</div>
</body>
</html>
