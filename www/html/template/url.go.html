<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4480106">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4480161">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4480215">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4480266">package</span>&nbsp;<span class="ident" id="4480274">template</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4480284">import</span>&nbsp;<span class="op" id="4480291">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4480294">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4480303">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4480310">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="4480320">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4480323">//&nbsp;urlFilter&nbsp;returns&nbsp;its&nbsp;input&nbsp;unless&nbsp;it&nbsp;contains&nbsp;an&nbsp;unsafe&nbsp;protocol&nbsp;in&nbsp;which</span><br>
<span class="lineno"></span><span class="comment" id="4480401">//&nbsp;case&nbsp;it&nbsp;defangs&nbsp;the&nbsp;entire&nbsp;URL.</span><br>
<span class="lineno">15</span><span class="keyword" id="4480436">func</span>&nbsp;<span class="ident" id="4480441">urlFilter</span><span class="op" id="4480450">(</span><span class="ident" id="4480451">args</span>&nbsp;<span class="op" id="4480456">...</span><span class="keyword" id="4480459">interface</span><span class="op" id="4480468">{</span><span class="op" id="4480469">}</span><span class="op" id="4480470">)</span>&nbsp;<span class="builtintype" id="4480472">string</span>&nbsp;<span class="op" id="4480479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4480482">s</span><span class="op" id="4480483">,</span>&nbsp;<span class="ident" id="4480485">t</span>&nbsp;<span class="op" id="4480487">:=</span>&nbsp;<span class="ident" id="4480490">stringify</span><span class="op" id="4480499">(</span><span class="ident" id="4480500">args</span><span class="op" id="4480504">...</span><span class="op" id="4480507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4480510">if</span>&nbsp;<span class="ident" id="4480513">t</span>&nbsp;<span class="op" id="4480515">==</span>&nbsp;<span class="ident" id="4480518">contentTypeURL</span>&nbsp;<span class="op" id="4480533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4480537">return</span>&nbsp;<span class="ident" id="4480544">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4480547">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4480550">if</span>&nbsp;<span class="ident" id="4480553">i</span>&nbsp;<span class="op" id="4480555">:=</span>&nbsp;<span class="ident" id="4480558">strings</span><span class="op" id="4480565">.</span><span class="ident" id="4480566">IndexRune</span><span class="op" id="4480575">(</span><span class="ident" id="4480576">s</span><span class="op" id="4480577">,</span>&nbsp;<span class="string" id="4480579">&#39;:&#39;</span><span class="op" id="4480582">)</span><span class="op" id="4480583">;</span>&nbsp;<span class="ident" id="4480585">i</span>&nbsp;<span class="op" id="4480587">&gt;=</span>&nbsp;<span class="num" id="4480590">0</span>&nbsp;<span class="op" id="4480592">&amp;&amp;</span>&nbsp;<span class="ident" id="4480595">strings</span><span class="op" id="4480602">.</span><span class="ident" id="4480603">IndexRune</span><span class="op" id="4480612">(</span><span class="ident" id="4480613">s</span><span class="op" id="4480614">[</span><span class="op" id="4480615">:</span><span class="ident" id="4480616">i</span><span class="op" id="4480617">]</span><span class="op" id="4480618">,</span>&nbsp;<span class="string" id="4480620">&#39;/&#39;</span><span class="op" id="4480623">)</span>&nbsp;<span class="op" id="4480625">&lt;</span>&nbsp;<span class="num" id="4480627">0</span>&nbsp;<span class="op" id="4480629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4480633">protocol</span>&nbsp;<span class="op" id="4480642">:=</span>&nbsp;<span class="ident" id="4480645">strings</span><span class="op" id="4480652">.</span><span class="ident" id="4480653">ToLower</span><span class="op" id="4480660">(</span><span class="ident" id="4480661">s</span><span class="op" id="4480662">[</span><span class="op" id="4480663">:</span><span class="ident" id="4480664">i</span><span class="op" id="4480665">]</span><span class="op" id="4480666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4480670">if</span>&nbsp;<span class="ident" id="4480673">protocol</span>&nbsp;<span class="op" id="4480682">!=</span>&nbsp;<span class="string" id="4480685">&#34;http&#34;</span>&nbsp;<span class="op" id="4480692">&amp;&amp;</span>&nbsp;<span class="ident" id="4480695">protocol</span>&nbsp;<span class="op" id="4480704">!=</span>&nbsp;<span class="string" id="4480707">&#34;https&#34;</span>&nbsp;<span class="op" id="4480715">&amp;&amp;</span>&nbsp;<span class="ident" id="4480718">protocol</span>&nbsp;<span class="op" id="4480727">!=</span>&nbsp;<span class="string" id="4480730">&#34;mailto&#34;</span>&nbsp;<span class="op" id="4480739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4480744">return</span>&nbsp;<span class="string" id="4480751">&#34;#&#34;</span>&nbsp;<span class="op" id="4480755">+</span>&nbsp;<span class="ident" id="4480757">filterFailsafe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4480774">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4480777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4480780">return</span>&nbsp;<span class="ident" id="4480787">s</span><br>
<span class="lineno"></span><span class="op" id="4480789">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4480792">//&nbsp;urlEscaper&nbsp;produces&nbsp;an&nbsp;output&nbsp;that&nbsp;can&nbsp;be&nbsp;embedded&nbsp;in&nbsp;a&nbsp;URL&nbsp;query.</span><br>
<span class="lineno">30</span><span class="comment" id="4480862">//&nbsp;The&nbsp;output&nbsp;can&nbsp;be&nbsp;embedded&nbsp;in&nbsp;an&nbsp;HTML&nbsp;attribute&nbsp;without&nbsp;further&nbsp;escaping.</span><br>
<span class="lineno"></span><span class="keyword" id="4480939">func</span>&nbsp;<span class="ident" id="4480944">urlEscaper</span><span class="op" id="4480954">(</span><span class="ident" id="4480955">args</span>&nbsp;<span class="op" id="4480960">...</span><span class="keyword" id="4480963">interface</span><span class="op" id="4480972">{</span><span class="op" id="4480973">}</span><span class="op" id="4480974">)</span>&nbsp;<span class="builtintype" id="4480976">string</span>&nbsp;<span class="op" id="4480983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4480986">return</span>&nbsp;<span class="ident" id="4480993">urlProcessor</span><span class="op" id="4481005">(</span><span class="ident" id="4481006">false</span><span class="op" id="4481011">,</span>&nbsp;<span class="ident" id="4481013">args</span><span class="op" id="4481017">...</span><span class="op" id="4481020">)</span><br>
<span class="lineno"></span><span class="op" id="4481022">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="4481025">//&nbsp;urlEscaper&nbsp;normalizes&nbsp;URL&nbsp;content&nbsp;so&nbsp;it&nbsp;can&nbsp;be&nbsp;embedded&nbsp;in&nbsp;a&nbsp;quote-delimited</span><br>
<span class="lineno"></span><span class="comment" id="4481105">//&nbsp;string&nbsp;or&nbsp;parenthesis&nbsp;delimited&nbsp;url(...).</span><br>
<span class="lineno"></span><span class="comment" id="4481150">//&nbsp;The&nbsp;normalizer&nbsp;does&nbsp;not&nbsp;encode&nbsp;all&nbsp;HTML&nbsp;specials.&nbsp;Specifically,&nbsp;it&nbsp;does&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="4481229">//&nbsp;encode&nbsp;&#39;&amp;&#39;&nbsp;so&nbsp;correct&nbsp;embedding&nbsp;in&nbsp;an&nbsp;HTML&nbsp;attribute&nbsp;requires&nbsp;escaping&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4481306">//&nbsp;&#39;&amp;&#39;&nbsp;to&nbsp;&#39;&amp;amp;&#39;.</span><br>
<span class="lineno">40</span><span class="keyword" id="4481325">func</span>&nbsp;<span class="ident" id="4481330">urlNormalizer</span><span class="op" id="4481343">(</span><span class="ident" id="4481344">args</span>&nbsp;<span class="op" id="4481349">...</span><span class="keyword" id="4481352">interface</span><span class="op" id="4481361">{</span><span class="op" id="4481362">}</span><span class="op" id="4481363">)</span>&nbsp;<span class="builtintype" id="4481365">string</span>&nbsp;<span class="op" id="4481372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4481375">return</span>&nbsp;<span class="ident" id="4481382">urlProcessor</span><span class="op" id="4481394">(</span><span class="ident" id="4481395">true</span><span class="op" id="4481399">,</span>&nbsp;<span class="ident" id="4481401">args</span><span class="op" id="4481405">...</span><span class="op" id="4481408">)</span><br>
<span class="lineno"></span><span class="op" id="4481410">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4481413">//&nbsp;urlProcessor&nbsp;normalizes&nbsp;(when&nbsp;norm&nbsp;is&nbsp;true)&nbsp;or&nbsp;escapes&nbsp;its&nbsp;input&nbsp;to&nbsp;produce</span><br>
<span class="lineno">45</span><span class="comment" id="4481492">//&nbsp;a&nbsp;valid&nbsp;hierarchical&nbsp;or&nbsp;opaque&nbsp;URL&nbsp;part.</span><br>
<span class="lineno"></span><span class="keyword" id="4481536">func</span>&nbsp;<span class="ident" id="4481541">urlProcessor</span><span class="op" id="4481553">(</span><span class="ident" id="4481554">norm</span>&nbsp;<span class="builtintype" id="4481559">bool</span><span class="op" id="4481563">,</span>&nbsp;<span class="ident" id="4481565">args</span>&nbsp;<span class="op" id="4481570">...</span><span class="keyword" id="4481573">interface</span><span class="op" id="4481582">{</span><span class="op" id="4481583">}</span><span class="op" id="4481584">)</span>&nbsp;<span class="builtintype" id="4481586">string</span>&nbsp;<span class="op" id="4481593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4481596">s</span><span class="op" id="4481597">,</span>&nbsp;<span class="ident" id="4481599">t</span>&nbsp;<span class="op" id="4481601">:=</span>&nbsp;<span class="ident" id="4481604">stringify</span><span class="op" id="4481613">(</span><span class="ident" id="4481614">args</span><span class="op" id="4481618">...</span><span class="op" id="4481621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4481624">if</span>&nbsp;<span class="ident" id="4481627">t</span>&nbsp;<span class="op" id="4481629">==</span>&nbsp;<span class="ident" id="4481632">contentTypeURL</span>&nbsp;<span class="op" id="4481647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4481651">norm</span>&nbsp;<span class="op" id="4481656">=</span>&nbsp;<span class="ident" id="4481658">true</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4481664">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4481667">var</span>&nbsp;<span class="ident" id="4481671">b</span>&nbsp;<span class="ident" id="4481673">bytes</span><span class="op" id="4481678">.</span><span class="ident" id="4481679">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4481687">written</span>&nbsp;<span class="op" id="4481695">:=</span>&nbsp;<span class="num" id="4481698">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4481701">//&nbsp;The&nbsp;byte&nbsp;loop&nbsp;below&nbsp;assumes&nbsp;that&nbsp;all&nbsp;URLs&nbsp;use&nbsp;UTF-8&nbsp;as&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4481764">//&nbsp;content-encoding.&nbsp;This&nbsp;is&nbsp;similar&nbsp;to&nbsp;the&nbsp;URI&nbsp;to&nbsp;IRI&nbsp;encoding&nbsp;scheme</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4481836">//&nbsp;defined&nbsp;in&nbsp;section&nbsp;3.1&nbsp;of&nbsp;&nbsp;RFC&nbsp;3987,&nbsp;and&nbsp;behaves&nbsp;the&nbsp;same&nbsp;as&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4481905">//&nbsp;EcmaScript&nbsp;builtin&nbsp;encodeURIComponent.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4481948">//&nbsp;It&nbsp;should&nbsp;not&nbsp;cause&nbsp;any&nbsp;misencoding&nbsp;of&nbsp;URLs&nbsp;in&nbsp;pages&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4482010">//&nbsp;Content-type:&nbsp;text/html;charset=UTF-8.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4482053">for</span>&nbsp;<span class="ident" id="4482057">i</span><span class="op" id="4482058">,</span>&nbsp;<span class="ident" id="4482060">n</span>&nbsp;<span class="op" id="4482062">:=</span>&nbsp;<span class="num" id="4482065">0</span><span class="op" id="4482066">,</span>&nbsp;<span class="builtinfunc" id="4482068">len</span><span class="op" id="4482071">(</span><span class="ident" id="4482072">s</span><span class="op" id="4482073">)</span><span class="op" id="4482074">;</span>&nbsp;<span class="ident" id="4482076">i</span>&nbsp;<span class="op" id="4482078">&lt;</span>&nbsp;<span class="ident" id="4482080">n</span><span class="op" id="4482081">;</span>&nbsp;<span class="ident" id="4482083">i</span><span class="op" id="4482084">++</span>&nbsp;<span class="op" id="4482087">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4482091">c</span>&nbsp;<span class="op" id="4482093">:=</span>&nbsp;<span class="ident" id="4482096">s</span><span class="op" id="4482097">[</span><span class="ident" id="4482098">i</span><span class="op" id="4482099">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4482103">switch</span>&nbsp;<span class="ident" id="4482110">c</span>&nbsp;<span class="op" id="4482112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4482116">//&nbsp;Single&nbsp;quote&nbsp;and&nbsp;parens&nbsp;are&nbsp;sub-delims&nbsp;in&nbsp;RFC&nbsp;3986,&nbsp;but&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4482180">//&nbsp;escape&nbsp;them&nbsp;so&nbsp;the&nbsp;output&nbsp;can&nbsp;be&nbsp;embedded&nbsp;in&nbsp;single</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4482237">//&nbsp;quoted&nbsp;attributes&nbsp;and&nbsp;unquoted&nbsp;CSS&nbsp;url(...)&nbsp;constructs.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4482298">//&nbsp;Single&nbsp;quotes&nbsp;are&nbsp;reserved&nbsp;in&nbsp;URLs,&nbsp;but&nbsp;are&nbsp;only&nbsp;used&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4482360">//&nbsp;the&nbsp;obsolete&nbsp;&#34;mark&#34;&nbsp;rule&nbsp;in&nbsp;an&nbsp;appendix&nbsp;in&nbsp;RFC&nbsp;3986</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4482417">//&nbsp;so&nbsp;can&nbsp;be&nbsp;safely&nbsp;encoded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4482448">case</span>&nbsp;<span class="string" id="4482453">&#39;!&#39;</span><span class="op" id="4482456">,</span>&nbsp;<span class="string" id="4482458">&#39;#&#39;</span><span class="op" id="4482461">,</span>&nbsp;<span class="string" id="4482463">&#39;$&#39;</span><span class="op" id="4482466">,</span>&nbsp;<span class="string" id="4482468">&#39;&amp;&#39;</span><span class="op" id="4482471">,</span>&nbsp;<span class="string" id="4482473">&#39;*&#39;</span><span class="op" id="4482476">,</span>&nbsp;<span class="string" id="4482478">&#39;+&#39;</span><span class="op" id="4482481">,</span>&nbsp;<span class="string" id="4482483">&#39;,&#39;</span><span class="op" id="4482486">,</span>&nbsp;<span class="string" id="4482488">&#39;/&#39;</span><span class="op" id="4482491">,</span>&nbsp;<span class="string" id="4482493">&#39;:&#39;</span><span class="op" id="4482496">,</span>&nbsp;<span class="string" id="4482498">&#39;;&#39;</span><span class="op" id="4482501">,</span>&nbsp;<span class="string" id="4482503">&#39;=&#39;</span><span class="op" id="4482506">,</span>&nbsp;<span class="string" id="4482508">&#39;?&#39;</span><span class="op" id="4482511">,</span>&nbsp;<span class="string" id="4482513">&#39;@&#39;</span><span class="op" id="4482516">,</span>&nbsp;<span class="string" id="4482518">&#39;[&#39;</span><span class="op" id="4482521">,</span>&nbsp;<span class="string" id="4482523">&#39;]&#39;</span><span class="op" id="4482526">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4482531">if</span>&nbsp;<span class="ident" id="4482534">norm</span>&nbsp;<span class="op" id="4482539">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4482545">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4482557">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4482561">//&nbsp;Unreserved&nbsp;according&nbsp;to&nbsp;RFC&nbsp;3986&nbsp;sec&nbsp;2.3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4482607">//&nbsp;&#34;For&nbsp;consistency,&nbsp;percent-encoded&nbsp;octets&nbsp;in&nbsp;the&nbsp;ranges&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4482670">//&nbsp;ALPHA&nbsp;(%41-%5A&nbsp;and&nbsp;%61-%7A),&nbsp;DIGIT&nbsp;(%30-%39),&nbsp;hyphen&nbsp;(%2D),</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4482735">//&nbsp;period&nbsp;(%2E),&nbsp;underscore&nbsp;(%5F),&nbsp;or&nbsp;tilde&nbsp;(%7E)&nbsp;should&nbsp;not&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4482801">//&nbsp;created&nbsp;by&nbsp;URI&nbsp;producers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4482831">case</span>&nbsp;<span class="string" id="4482836">&#39;-&#39;</span><span class="op" id="4482839">,</span>&nbsp;<span class="string" id="4482841">&#39;.&#39;</span><span class="op" id="4482844">,</span>&nbsp;<span class="string" id="4482846">&#39;_&#39;</span><span class="op" id="4482849">,</span>&nbsp;<span class="string" id="4482851">&#39;~&#39;</span><span class="op" id="4482854">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4482859">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4482870">case</span>&nbsp;<span class="string" id="4482875">&#39;%&#39;</span><span class="op" id="4482878">:</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4482883">//&nbsp;When&nbsp;normalizing&nbsp;do&nbsp;not&nbsp;re-encode&nbsp;valid&nbsp;escapes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4482938">if</span>&nbsp;<span class="ident" id="4482941">norm</span>&nbsp;<span class="op" id="4482946">&amp;&amp;</span>&nbsp;<span class="ident" id="4482949">i</span><span class="op" id="4482950">+</span><span class="num" id="4482951">2</span>&nbsp;<span class="op" id="4482953">&lt;</span>&nbsp;<span class="builtinfunc" id="4482955">len</span><span class="op" id="4482958">(</span><span class="ident" id="4482959">s</span><span class="op" id="4482960">)</span>&nbsp;<span class="op" id="4482962">&amp;&amp;</span>&nbsp;<span class="ident" id="4482965">isHex</span><span class="op" id="4482970">(</span><span class="ident" id="4482971">s</span><span class="op" id="4482972">[</span><span class="ident" id="4482973">i</span><span class="op" id="4482974">+</span><span class="num" id="4482975">1</span><span class="op" id="4482976">]</span><span class="op" id="4482977">)</span>&nbsp;<span class="op" id="4482979">&amp;&amp;</span>&nbsp;<span class="ident" id="4482982">isHex</span><span class="op" id="4482987">(</span><span class="ident" id="4482988">s</span><span class="op" id="4482989">[</span><span class="ident" id="4482990">i</span><span class="op" id="4482991">+</span><span class="num" id="4482992">2</span><span class="op" id="4482993">]</span><span class="op" id="4482994">)</span>&nbsp;<span class="op" id="4482996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4483002">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4483014">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4483018">default</span><span class="op" id="4483025">:</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4483030">//&nbsp;Unreserved&nbsp;according&nbsp;to&nbsp;RFC&nbsp;3986&nbsp;sec&nbsp;2.3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4483077">if</span>&nbsp;<span class="string" id="4483080">&#39;a&#39;</span>&nbsp;<span class="op" id="4483084">&lt;=</span>&nbsp;<span class="ident" id="4483087">c</span>&nbsp;<span class="op" id="4483089">&amp;&amp;</span>&nbsp;<span class="ident" id="4483092">c</span>&nbsp;<span class="op" id="4483094">&lt;=</span>&nbsp;<span class="string" id="4483097">&#39;z&#39;</span>&nbsp;<span class="op" id="4483101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4483107">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4483119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4483124">if</span>&nbsp;<span class="string" id="4483127">&#39;A&#39;</span>&nbsp;<span class="op" id="4483131">&lt;=</span>&nbsp;<span class="ident" id="4483134">c</span>&nbsp;<span class="op" id="4483136">&amp;&amp;</span>&nbsp;<span class="ident" id="4483139">c</span>&nbsp;<span class="op" id="4483141">&lt;=</span>&nbsp;<span class="string" id="4483144">&#39;Z&#39;</span>&nbsp;<span class="op" id="4483148">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4483154">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4483166">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4483171">if</span>&nbsp;<span class="string" id="4483174">&#39;0&#39;</span>&nbsp;<span class="op" id="4483178">&lt;=</span>&nbsp;<span class="ident" id="4483181">c</span>&nbsp;<span class="op" id="4483183">&amp;&amp;</span>&nbsp;<span class="ident" id="4483186">c</span>&nbsp;<span class="op" id="4483188">&lt;=</span>&nbsp;<span class="string" id="4483191">&#39;9&#39;</span>&nbsp;<span class="op" id="4483195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4483201">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4483213">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4483217">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4483221">b</span><span class="op" id="4483222">.</span><span class="ident" id="4483223">WriteString</span><span class="op" id="4483234">(</span><span class="ident" id="4483235">s</span><span class="op" id="4483236">[</span><span class="ident" id="4483237">written</span><span class="op" id="4483244">:</span><span class="ident" id="4483245">i</span><span class="op" id="4483246">]</span><span class="op" id="4483247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4483251">fmt</span><span class="op" id="4483254">.</span><span class="ident" id="4483255">Fprintf</span><span class="op" id="4483262">(</span><span class="op" id="4483263">&amp;</span><span class="ident" id="4483264">b</span><span class="op" id="4483265">,</span>&nbsp;<span class="string" id="4483267">&#34;%%%02x&#34;</span><span class="op" id="4483275">,</span>&nbsp;<span class="ident" id="4483277">c</span><span class="op" id="4483278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4483282">written</span>&nbsp;<span class="op" id="4483290">=</span>&nbsp;<span class="ident" id="4483292">i</span>&nbsp;<span class="op" id="4483294">+</span>&nbsp;<span class="num" id="4483296">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4483299">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4483302">if</span>&nbsp;<span class="ident" id="4483305">written</span>&nbsp;<span class="op" id="4483313">==</span>&nbsp;<span class="num" id="4483316">0</span>&nbsp;<span class="op" id="4483318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4483322">return</span>&nbsp;<span class="ident" id="4483329">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4483332">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4483335">b</span><span class="op" id="4483336">.</span><span class="ident" id="4483337">WriteString</span><span class="op" id="4483348">(</span><span class="ident" id="4483349">s</span><span class="op" id="4483350">[</span><span class="ident" id="4483351">written</span><span class="op" id="4483358">:</span><span class="op" id="4483359">]</span><span class="op" id="4483360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4483363">return</span>&nbsp;<span class="ident" id="4483370">b</span><span class="op" id="4483371">.</span><span class="ident" id="4483372">String</span><span class="op" id="4483378">(</span><span class="op" id="4483379">)</span><br>
<span class="lineno">105</span><span class="op" id="4483381">}</span>
</div>
</body>
</html>
