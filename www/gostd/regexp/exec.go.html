<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>regexp</h2>
<ul>
<li><a href="/gostd/regexp/all_test.go.html">all_test.go</a></li>
<li><a href="/gostd/regexp/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/regexp/exec.go.html" class="current">exec.go</a></li>
<li><a href="/gostd/regexp/exec2_test.go.html">exec2_test.go</a></li>
<li><a href="/gostd/regexp/exec_test.go.html">exec_test.go</a></li>
<li><a href="/gostd/regexp/find_test.go.html">find_test.go</a></li>
<li><a href="/gostd/regexp/onepass.go.html">onepass.go</a></li>
<li><a href="/gostd/regexp/onepass_test.go.html">onepass_test.go</a></li>
<li><a href="/gostd/regexp/regexp.go.html">regexp.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4393669">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4393724">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4393778">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4393829">package</span>&nbsp;<span class="ident" id="4393837">regexp</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4393845">import</span>&nbsp;<span class="op" id="4393852">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4393855">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4393861">&#34;regexp/syntax&#34;</span><br>
<span class="lineno">10</span><span class="op" id="4393877">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4393880">//&nbsp;A&nbsp;queue&nbsp;is&nbsp;a&nbsp;&#39;sparse&nbsp;array&#39;&nbsp;holding&nbsp;pending&nbsp;threads&nbsp;of&nbsp;execution.</span><br>
<span class="lineno"></span><span class="comment" id="4393949">//&nbsp;See&nbsp;http://research.swtch.com/2008/03/using-uninitialized-memory-for-fun-and.html</span><br>
<span class="lineno"></span><span class="keyword" id="4394034">type</span>&nbsp;<span class="ident" id="4394039">queue</span>&nbsp;<span class="keyword" id="4394045">struct</span>&nbsp;<span class="op" id="4394052">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4394055">sparse</span>&nbsp;<span class="op" id="4394062">[</span><span class="op" id="4394063">]</span><span class="builtintype" id="4394064">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4394072">dense</span>&nbsp;&nbsp;<span class="op" id="4394079">[</span><span class="op" id="4394080">]</span><span class="ident" id="4394081">entry</span><br>
<span class="lineno"></span><span class="op" id="4394087">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4394090">//&nbsp;A&nbsp;entry&nbsp;is&nbsp;an&nbsp;entry&nbsp;on&nbsp;a&nbsp;queue.</span><br>
<span class="lineno">20</span><span class="comment" id="4394125">//&nbsp;It&nbsp;holds&nbsp;both&nbsp;the&nbsp;instruction&nbsp;pc&nbsp;and&nbsp;the&nbsp;actual&nbsp;thread.</span><br>
<span class="lineno"></span><span class="comment" id="4394184">//&nbsp;Some&nbsp;queue&nbsp;entries&nbsp;are&nbsp;just&nbsp;place&nbsp;holders&nbsp;so&nbsp;that&nbsp;the&nbsp;machine</span><br>
<span class="lineno"></span><span class="comment" id="4394249">//&nbsp;knows&nbsp;it&nbsp;has&nbsp;considered&nbsp;that&nbsp;pc.&nbsp;&nbsp;Such&nbsp;entries&nbsp;have&nbsp;t&nbsp;==&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="4394314">type</span>&nbsp;<span class="ident" id="4394319">entry</span>&nbsp;<span class="keyword" id="4394325">struct</span>&nbsp;<span class="op" id="4394332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4394335">pc</span>&nbsp;<span class="builtintype" id="4394338">uint32</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4394346">t</span>&nbsp;&nbsp;<span class="op" id="4394349">*</span><span class="ident" id="4394350">thread</span><br>
<span class="lineno"></span><span class="op" id="4394357">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4394360">//&nbsp;A&nbsp;thread&nbsp;is&nbsp;the&nbsp;state&nbsp;of&nbsp;a&nbsp;single&nbsp;path&nbsp;through&nbsp;the&nbsp;machine:</span><br>
<span class="lineno"></span><span class="comment" id="4394423">//&nbsp;an&nbsp;instruction&nbsp;and&nbsp;a&nbsp;corresponding&nbsp;capture&nbsp;array.</span><br>
<span class="lineno">30</span><span class="comment" id="4394476">//&nbsp;See&nbsp;http://swtch.com/~rsc/regexp/regexp2.html</span><br>
<span class="lineno"></span><span class="keyword" id="4394525">type</span>&nbsp;<span class="ident" id="4394530">thread</span>&nbsp;<span class="keyword" id="4394537">struct</span>&nbsp;<span class="op" id="4394544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4394547">inst</span>&nbsp;<span class="op" id="4394552">*</span><span class="ident" id="4394553">syntax</span><span class="op" id="4394559">.</span><span class="ident" id="4394560">Inst</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4394566">cap</span>&nbsp;&nbsp;<span class="op" id="4394571">[</span><span class="op" id="4394572">]</span><span class="builtintype" id="4394573">int</span><br>
<span class="lineno"></span><span class="op" id="4394577">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="comment" id="4394580">//&nbsp;A&nbsp;machine&nbsp;holds&nbsp;all&nbsp;the&nbsp;state&nbsp;during&nbsp;an&nbsp;NFA&nbsp;simulation&nbsp;for&nbsp;p.</span><br>
<span class="lineno"></span><span class="keyword" id="4394645">type</span>&nbsp;<span class="ident" id="4394650">machine</span>&nbsp;<span class="keyword" id="4394658">struct</span>&nbsp;<span class="op" id="4394665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4394668">re</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4394677">*</span><span class="ident" id="4394678">Regexp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4394690">//&nbsp;corresponding&nbsp;Regexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4394715">p</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4394724">*</span><span class="ident" id="4394725">syntax</span><span class="op" id="4394731">.</span><span class="ident" id="4394732">Prog</span>&nbsp;<span class="comment" id="4394737">//&nbsp;compiled&nbsp;program</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4394758">op</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4394767">*</span><span class="ident" id="4394768">onePassProg</span>&nbsp;<span class="comment" id="4394780">//&nbsp;compiled&nbsp;onepass&nbsp;program,&nbsp;or&nbsp;notOnePass</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4394824">q0</span><span class="op" id="4394826">,</span>&nbsp;<span class="ident" id="4394828">q1</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4394833">queue</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4394846">//&nbsp;two&nbsp;queues&nbsp;for&nbsp;runq,&nbsp;nextq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4394877">pool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4394886">[</span><span class="op" id="4394887">]</span><span class="op" id="4394888">*</span><span class="ident" id="4394889">thread</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4394899">//&nbsp;pool&nbsp;of&nbsp;available&nbsp;threads</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4394929">matched</span>&nbsp;&nbsp;<span class="builtintype" id="4394938">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4394951">//&nbsp;whether&nbsp;a&nbsp;match&nbsp;was&nbsp;found</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4394981">matchcap</span>&nbsp;<span class="op" id="4394990">[</span><span class="op" id="4394991">]</span><span class="builtintype" id="4394992">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4395003">//&nbsp;capture&nbsp;information&nbsp;for&nbsp;the&nbsp;match</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4395042">//&nbsp;cached&nbsp;inputs,&nbsp;to&nbsp;avoid&nbsp;allocation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4395081">inputBytes</span>&nbsp;&nbsp;<span class="ident" id="4395093">inputBytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4395105">inputString</span>&nbsp;<span class="ident" id="4395117">inputString</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4395130">inputReader</span>&nbsp;<span class="ident" id="4395142">inputReader</span><br>
<span class="lineno">50</span><span class="op" id="4395154">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4395157">func</span>&nbsp;<span class="op" id="4395162">(</span><span class="ident" id="4395163">m</span>&nbsp;<span class="op" id="4395165">*</span><span class="ident" id="4395166">machine</span><span class="op" id="4395173">)</span>&nbsp;<span class="ident" id="4395175">newInputBytes</span><span class="op" id="4395188">(</span><span class="ident" id="4395189">b</span>&nbsp;<span class="op" id="4395191">[</span><span class="op" id="4395192">]</span><span class="builtintype" id="4395193">byte</span><span class="op" id="4395197">)</span>&nbsp;<span class="ident" id="4395199">input</span>&nbsp;<span class="op" id="4395205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4395208">m</span><span class="op" id="4395209">.</span><span class="ident" id="4395210">inputBytes</span><span class="op" id="4395220">.</span><span class="ident" id="4395221">str</span>&nbsp;<span class="op" id="4395225">=</span>&nbsp;<span class="ident" id="4395227">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4395230">return</span>&nbsp;<span class="op" id="4395237">&amp;</span><span class="ident" id="4395238">m</span><span class="op" id="4395239">.</span><span class="ident" id="4395240">inputBytes</span><br>
<span class="lineno">55</span><span class="op" id="4395251">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4395254">func</span>&nbsp;<span class="op" id="4395259">(</span><span class="ident" id="4395260">m</span>&nbsp;<span class="op" id="4395262">*</span><span class="ident" id="4395263">machine</span><span class="op" id="4395270">)</span>&nbsp;<span class="ident" id="4395272">newInputString</span><span class="op" id="4395286">(</span><span class="ident" id="4395287">s</span>&nbsp;<span class="builtintype" id="4395289">string</span><span class="op" id="4395295">)</span>&nbsp;<span class="ident" id="4395297">input</span>&nbsp;<span class="op" id="4395303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4395306">m</span><span class="op" id="4395307">.</span><span class="ident" id="4395308">inputString</span><span class="op" id="4395319">.</span><span class="ident" id="4395320">str</span>&nbsp;<span class="op" id="4395324">=</span>&nbsp;<span class="ident" id="4395326">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4395329">return</span>&nbsp;<span class="op" id="4395336">&amp;</span><span class="ident" id="4395337">m</span><span class="op" id="4395338">.</span><span class="ident" id="4395339">inputString</span><br>
<span class="lineno">60</span><span class="op" id="4395351">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4395354">func</span>&nbsp;<span class="op" id="4395359">(</span><span class="ident" id="4395360">m</span>&nbsp;<span class="op" id="4395362">*</span><span class="ident" id="4395363">machine</span><span class="op" id="4395370">)</span>&nbsp;<span class="ident" id="4395372">newInputReader</span><span class="op" id="4395386">(</span><span class="ident" id="4395387">r</span>&nbsp;<span class="ident" id="4395389">io</span><span class="op" id="4395391">.</span><span class="ident" id="4395392">RuneReader</span><span class="op" id="4395402">)</span>&nbsp;<span class="ident" id="4395404">input</span>&nbsp;<span class="op" id="4395410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4395413">m</span><span class="op" id="4395414">.</span><span class="ident" id="4395415">inputReader</span><span class="op" id="4395426">.</span><span class="ident" id="4395427">r</span>&nbsp;<span class="op" id="4395429">=</span>&nbsp;<span class="ident" id="4395431">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4395434">m</span><span class="op" id="4395435">.</span><span class="ident" id="4395436">inputReader</span><span class="op" id="4395447">.</span><span class="ident" id="4395448">atEOT</span>&nbsp;<span class="op" id="4395454">=</span>&nbsp;<span class="builtintype" id="4395456">false</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4395463">m</span><span class="op" id="4395464">.</span><span class="ident" id="4395465">inputReader</span><span class="op" id="4395476">.</span><span class="ident" id="4395477">pos</span>&nbsp;<span class="op" id="4395481">=</span>&nbsp;<span class="num" id="4395483">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4395486">return</span>&nbsp;<span class="op" id="4395493">&amp;</span><span class="ident" id="4395494">m</span><span class="op" id="4395495">.</span><span class="ident" id="4395496">inputReader</span><br>
<span class="lineno"></span><span class="op" id="4395508">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4395511">//&nbsp;progMachine&nbsp;returns&nbsp;a&nbsp;new&nbsp;machine&nbsp;running&nbsp;the&nbsp;prog&nbsp;p.</span><br>
<span class="lineno">70</span><span class="keyword" id="4395568">func</span>&nbsp;<span class="ident" id="4395573">progMachine</span><span class="op" id="4395584">(</span><span class="ident" id="4395585">p</span>&nbsp;<span class="op" id="4395587">*</span><span class="ident" id="4395588">syntax</span><span class="op" id="4395594">.</span><span class="ident" id="4395595">Prog</span><span class="op" id="4395599">,</span>&nbsp;<span class="ident" id="4395601">op</span>&nbsp;<span class="op" id="4395604">*</span><span class="ident" id="4395605">onePassProg</span><span class="op" id="4395616">)</span>&nbsp;<span class="op" id="4395618">*</span><span class="ident" id="4395619">machine</span>&nbsp;<span class="op" id="4395627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4395630">m</span>&nbsp;<span class="op" id="4395632">:=</span>&nbsp;<span class="op" id="4395635">&amp;</span><span class="ident" id="4395636">machine</span><span class="op" id="4395643">{</span><span class="ident" id="4395644">p</span><span class="op" id="4395645">:</span>&nbsp;<span class="ident" id="4395647">p</span><span class="op" id="4395648">,</span>&nbsp;<span class="ident" id="4395650">op</span><span class="op" id="4395652">:</span>&nbsp;<span class="ident" id="4395654">op</span><span class="op" id="4395656">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4395659">n</span>&nbsp;<span class="op" id="4395661">:=</span>&nbsp;<span class="builtinfunc" id="4395664">len</span><span class="op" id="4395667">(</span><span class="ident" id="4395668">m</span><span class="op" id="4395669">.</span><span class="ident" id="4395670">p</span><span class="op" id="4395671">.</span><span class="ident" id="4395672">Inst</span><span class="op" id="4395676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4395679">m</span><span class="op" id="4395680">.</span><span class="ident" id="4395681">q0</span>&nbsp;<span class="op" id="4395684">=</span>&nbsp;<span class="ident" id="4395686">queue</span><span class="op" id="4395691">{</span><span class="builtinfunc" id="4395692">make</span><span class="op" id="4395696">(</span><span class="op" id="4395697">[</span><span class="op" id="4395698">]</span><span class="builtintype" id="4395699">uint32</span><span class="op" id="4395705">,</span>&nbsp;<span class="ident" id="4395707">n</span><span class="op" id="4395708">)</span><span class="op" id="4395709">,</span>&nbsp;<span class="builtinfunc" id="4395711">make</span><span class="op" id="4395715">(</span><span class="op" id="4395716">[</span><span class="op" id="4395717">]</span><span class="ident" id="4395718">entry</span><span class="op" id="4395723">,</span>&nbsp;<span class="num" id="4395725">0</span><span class="op" id="4395726">,</span>&nbsp;<span class="ident" id="4395728">n</span><span class="op" id="4395729">)</span><span class="op" id="4395730">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4395733">m</span><span class="op" id="4395734">.</span><span class="ident" id="4395735">q1</span>&nbsp;<span class="op" id="4395738">=</span>&nbsp;<span class="ident" id="4395740">queue</span><span class="op" id="4395745">{</span><span class="builtinfunc" id="4395746">make</span><span class="op" id="4395750">(</span><span class="op" id="4395751">[</span><span class="op" id="4395752">]</span><span class="builtintype" id="4395753">uint32</span><span class="op" id="4395759">,</span>&nbsp;<span class="ident" id="4395761">n</span><span class="op" id="4395762">)</span><span class="op" id="4395763">,</span>&nbsp;<span class="builtinfunc" id="4395765">make</span><span class="op" id="4395769">(</span><span class="op" id="4395770">[</span><span class="op" id="4395771">]</span><span class="ident" id="4395772">entry</span><span class="op" id="4395777">,</span>&nbsp;<span class="num" id="4395779">0</span><span class="op" id="4395780">,</span>&nbsp;<span class="ident" id="4395782">n</span><span class="op" id="4395783">)</span><span class="op" id="4395784">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4395787">ncap</span>&nbsp;<span class="op" id="4395792">:=</span>&nbsp;<span class="ident" id="4395795">p</span><span class="op" id="4395796">.</span><span class="ident" id="4395797">NumCap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4395805">if</span>&nbsp;<span class="ident" id="4395808">ncap</span>&nbsp;<span class="op" id="4395813">&lt;</span>&nbsp;<span class="num" id="4395815">2</span>&nbsp;<span class="op" id="4395817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4395821">ncap</span>&nbsp;<span class="op" id="4395826">=</span>&nbsp;<span class="num" id="4395828">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4395831">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4395834">m</span><span class="op" id="4395835">.</span><span class="ident" id="4395836">matchcap</span>&nbsp;<span class="op" id="4395845">=</span>&nbsp;<span class="builtinfunc" id="4395847">make</span><span class="op" id="4395851">(</span><span class="op" id="4395852">[</span><span class="op" id="4395853">]</span><span class="builtintype" id="4395854">int</span><span class="op" id="4395857">,</span>&nbsp;<span class="ident" id="4395859">ncap</span><span class="op" id="4395863">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4395866">return</span>&nbsp;<span class="ident" id="4395873">m</span><br>
<span class="lineno"></span><span class="op" id="4395875">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4395878">func</span>&nbsp;<span class="op" id="4395883">(</span><span class="ident" id="4395884">m</span>&nbsp;<span class="op" id="4395886">*</span><span class="ident" id="4395887">machine</span><span class="op" id="4395894">)</span>&nbsp;<span class="ident" id="4395896">init</span><span class="op" id="4395900">(</span><span class="ident" id="4395901">ncap</span>&nbsp;<span class="builtintype" id="4395906">int</span><span class="op" id="4395909">)</span>&nbsp;<span class="op" id="4395911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4395914">for</span>&nbsp;<span class="ident" id="4395918">_</span><span class="op" id="4395919">,</span>&nbsp;<span class="ident" id="4395921">t</span>&nbsp;<span class="op" id="4395923">:=</span>&nbsp;<span class="keyword" id="4395926">range</span>&nbsp;<span class="ident" id="4395932">m</span><span class="op" id="4395933">.</span><span class="ident" id="4395934">pool</span>&nbsp;<span class="op" id="4395939">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4395943">t</span><span class="op" id="4395944">.</span><span class="builtinfunc" id="4395945">cap</span>&nbsp;<span class="op" id="4395949">=</span>&nbsp;<span class="ident" id="4395951">t</span><span class="op" id="4395952">.</span><span class="builtinfunc" id="4395953">cap</span><span class="op" id="4395956">[</span><span class="op" id="4395957">:</span><span class="ident" id="4395958">ncap</span><span class="op" id="4395962">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4395965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4395968">m</span><span class="op" id="4395969">.</span><span class="ident" id="4395970">matchcap</span>&nbsp;<span class="op" id="4395979">=</span>&nbsp;<span class="ident" id="4395981">m</span><span class="op" id="4395982">.</span><span class="ident" id="4395983">matchcap</span><span class="op" id="4395991">[</span><span class="op" id="4395992">:</span><span class="ident" id="4395993">ncap</span><span class="op" id="4395997">]</span><br>
<span class="lineno"></span><span class="op" id="4395999">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="4396002">//&nbsp;alloc&nbsp;allocates&nbsp;a&nbsp;new&nbsp;thread&nbsp;with&nbsp;the&nbsp;given&nbsp;instruction.</span><br>
<span class="lineno"></span><span class="comment" id="4396062">//&nbsp;It&nbsp;uses&nbsp;the&nbsp;free&nbsp;pool&nbsp;if&nbsp;possible.</span><br>
<span class="lineno"></span><span class="keyword" id="4396100">func</span>&nbsp;<span class="op" id="4396105">(</span><span class="ident" id="4396106">m</span>&nbsp;<span class="op" id="4396108">*</span><span class="ident" id="4396109">machine</span><span class="op" id="4396116">)</span>&nbsp;<span class="ident" id="4396118">alloc</span><span class="op" id="4396123">(</span><span class="ident" id="4396124">i</span>&nbsp;<span class="op" id="4396126">*</span><span class="ident" id="4396127">syntax</span><span class="op" id="4396133">.</span><span class="ident" id="4396134">Inst</span><span class="op" id="4396138">)</span>&nbsp;<span class="op" id="4396140">*</span><span class="ident" id="4396141">thread</span>&nbsp;<span class="op" id="4396148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4396151">var</span>&nbsp;<span class="ident" id="4396155">t</span>&nbsp;<span class="op" id="4396157">*</span><span class="ident" id="4396158">thread</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4396166">if</span>&nbsp;<span class="ident" id="4396169">n</span>&nbsp;<span class="op" id="4396171">:=</span>&nbsp;<span class="builtinfunc" id="4396174">len</span><span class="op" id="4396177">(</span><span class="ident" id="4396178">m</span><span class="op" id="4396179">.</span><span class="ident" id="4396180">pool</span><span class="op" id="4396184">)</span><span class="op" id="4396185">;</span>&nbsp;<span class="ident" id="4396187">n</span>&nbsp;<span class="op" id="4396189">&gt;</span>&nbsp;<span class="num" id="4396191">0</span>&nbsp;<span class="op" id="4396193">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4396197">t</span>&nbsp;<span class="op" id="4396199">=</span>&nbsp;<span class="ident" id="4396201">m</span><span class="op" id="4396202">.</span><span class="ident" id="4396203">pool</span><span class="op" id="4396207">[</span><span class="ident" id="4396208">n</span><span class="op" id="4396209">-</span><span class="num" id="4396210">1</span><span class="op" id="4396211">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4396215">m</span><span class="op" id="4396216">.</span><span class="ident" id="4396217">pool</span>&nbsp;<span class="op" id="4396222">=</span>&nbsp;<span class="ident" id="4396224">m</span><span class="op" id="4396225">.</span><span class="ident" id="4396226">pool</span><span class="op" id="4396230">[</span><span class="op" id="4396231">:</span><span class="ident" id="4396232">n</span><span class="op" id="4396233">-</span><span class="num" id="4396234">1</span><span class="op" id="4396235">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4396238">}</span>&nbsp;<span class="keyword" id="4396240">else</span>&nbsp;<span class="op" id="4396245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4396249">t</span>&nbsp;<span class="op" id="4396251">=</span>&nbsp;<span class="builtinfunc" id="4396253">new</span><span class="op" id="4396256">(</span><span class="ident" id="4396257">thread</span><span class="op" id="4396263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4396267">t</span><span class="op" id="4396268">.</span><span class="builtinfunc" id="4396269">cap</span>&nbsp;<span class="op" id="4396273">=</span>&nbsp;<span class="builtinfunc" id="4396275">make</span><span class="op" id="4396279">(</span><span class="op" id="4396280">[</span><span class="op" id="4396281">]</span><span class="builtintype" id="4396282">int</span><span class="op" id="4396285">,</span>&nbsp;<span class="builtinfunc" id="4396287">len</span><span class="op" id="4396290">(</span><span class="ident" id="4396291">m</span><span class="op" id="4396292">.</span><span class="ident" id="4396293">matchcap</span><span class="op" id="4396301">)</span><span class="op" id="4396302">,</span>&nbsp;<span class="builtinfunc" id="4396304">cap</span><span class="op" id="4396307">(</span><span class="ident" id="4396308">m</span><span class="op" id="4396309">.</span><span class="ident" id="4396310">matchcap</span><span class="op" id="4396318">)</span><span class="op" id="4396319">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4396322">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4396325">t</span><span class="op" id="4396326">.</span><span class="ident" id="4396327">inst</span>&nbsp;<span class="op" id="4396332">=</span>&nbsp;<span class="ident" id="4396334">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4396337">return</span>&nbsp;<span class="ident" id="4396344">t</span><br>
<span class="lineno"></span><span class="op" id="4396346">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="4396349">//&nbsp;free&nbsp;returns&nbsp;t&nbsp;to&nbsp;the&nbsp;free&nbsp;pool.</span><br>
<span class="lineno"></span><span class="keyword" id="4396385">func</span>&nbsp;<span class="op" id="4396390">(</span><span class="ident" id="4396391">m</span>&nbsp;<span class="op" id="4396393">*</span><span class="ident" id="4396394">machine</span><span class="op" id="4396401">)</span>&nbsp;<span class="ident" id="4396403">free</span><span class="op" id="4396407">(</span><span class="ident" id="4396408">t</span>&nbsp;<span class="op" id="4396410">*</span><span class="ident" id="4396411">thread</span><span class="op" id="4396417">)</span>&nbsp;<span class="op" id="4396419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4396422">m</span><span class="op" id="4396423">.</span><span class="ident" id="4396424">inputBytes</span><span class="op" id="4396434">.</span><span class="ident" id="4396435">str</span>&nbsp;<span class="op" id="4396439">=</span>&nbsp;<span class="ident" id="4396441">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4396446">m</span><span class="op" id="4396447">.</span><span class="ident" id="4396448">inputString</span><span class="op" id="4396459">.</span><span class="ident" id="4396460">str</span>&nbsp;<span class="op" id="4396464">=</span>&nbsp;<span class="string" id="4396466">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4396470">m</span><span class="op" id="4396471">.</span><span class="ident" id="4396472">inputReader</span><span class="op" id="4396483">.</span><span class="ident" id="4396484">r</span>&nbsp;<span class="op" id="4396486">=</span>&nbsp;<span class="ident" id="4396488">nil</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4396493">m</span><span class="op" id="4396494">.</span><span class="ident" id="4396495">pool</span>&nbsp;<span class="op" id="4396500">=</span>&nbsp;<span class="builtinfunc" id="4396502">append</span><span class="op" id="4396508">(</span><span class="ident" id="4396509">m</span><span class="op" id="4396510">.</span><span class="ident" id="4396511">pool</span><span class="op" id="4396515">,</span>&nbsp;<span class="ident" id="4396517">t</span><span class="op" id="4396518">)</span><br>
<span class="lineno"></span><span class="op" id="4396520">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4396523">//&nbsp;match&nbsp;runs&nbsp;the&nbsp;machine&nbsp;over&nbsp;the&nbsp;input&nbsp;starting&nbsp;at&nbsp;pos.</span><br>
<span class="lineno"></span><span class="comment" id="4396581">//&nbsp;It&nbsp;reports&nbsp;whether&nbsp;a&nbsp;match&nbsp;was&nbsp;found.</span><br>
<span class="lineno">115</span><span class="comment" id="4396622">//&nbsp;If&nbsp;so,&nbsp;m.matchcap&nbsp;holds&nbsp;the&nbsp;submatch&nbsp;information.</span><br>
<span class="lineno"></span><span class="keyword" id="4396675">func</span>&nbsp;<span class="op" id="4396680">(</span><span class="ident" id="4396681">m</span>&nbsp;<span class="op" id="4396683">*</span><span class="ident" id="4396684">machine</span><span class="op" id="4396691">)</span>&nbsp;<span class="ident" id="4396693">match</span><span class="op" id="4396698">(</span><span class="ident" id="4396699">i</span>&nbsp;<span class="ident" id="4396701">input</span><span class="op" id="4396706">,</span>&nbsp;<span class="ident" id="4396708">pos</span>&nbsp;<span class="builtintype" id="4396712">int</span><span class="op" id="4396715">)</span>&nbsp;<span class="builtintype" id="4396717">bool</span>&nbsp;<span class="op" id="4396722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4396725">startCond</span>&nbsp;<span class="op" id="4396735">:=</span>&nbsp;<span class="ident" id="4396738">m</span><span class="op" id="4396739">.</span><span class="ident" id="4396740">re</span><span class="op" id="4396742">.</span><span class="ident" id="4396743">cond</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4396749">if</span>&nbsp;<span class="ident" id="4396752">startCond</span>&nbsp;<span class="op" id="4396762">==</span>&nbsp;<span class="op" id="4396765">^</span><span class="ident" id="4396766">syntax</span><span class="op" id="4396772">.</span><span class="ident" id="4396773">EmptyOp</span><span class="op" id="4396780">(</span><span class="num" id="4396781">0</span><span class="op" id="4396782">)</span>&nbsp;<span class="op" id="4396784">{</span>&nbsp;<span class="comment" id="4396786">//&nbsp;impossible</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4396802">return</span>&nbsp;<span class="builtintype" id="4396809">false</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4396816">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4396819">m</span><span class="op" id="4396820">.</span><span class="ident" id="4396821">matched</span>&nbsp;<span class="op" id="4396829">=</span>&nbsp;<span class="builtintype" id="4396831">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4396838">for</span>&nbsp;<span class="ident" id="4396842">i</span>&nbsp;<span class="op" id="4396844">:=</span>&nbsp;<span class="keyword" id="4396847">range</span>&nbsp;<span class="ident" id="4396853">m</span><span class="op" id="4396854">.</span><span class="ident" id="4396855">matchcap</span>&nbsp;<span class="op" id="4396864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4396868">m</span><span class="op" id="4396869">.</span><span class="ident" id="4396870">matchcap</span><span class="op" id="4396878">[</span><span class="ident" id="4396879">i</span><span class="op" id="4396880">]</span>&nbsp;<span class="op" id="4396882">=</span>&nbsp;<span class="op" id="4396884">-</span><span class="num" id="4396885">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4396888">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4396891">runq</span><span class="op" id="4396895">,</span>&nbsp;<span class="ident" id="4396897">nextq</span>&nbsp;<span class="op" id="4396903">:=</span>&nbsp;<span class="op" id="4396906">&amp;</span><span class="ident" id="4396907">m</span><span class="op" id="4396908">.</span><span class="ident" id="4396909">q0</span><span class="op" id="4396911">,</span>&nbsp;<span class="op" id="4396913">&amp;</span><span class="ident" id="4396914">m</span><span class="op" id="4396915">.</span><span class="ident" id="4396916">q1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4396920">r</span><span class="op" id="4396921">,</span>&nbsp;<span class="ident" id="4396923">r1</span>&nbsp;<span class="op" id="4396926">:=</span>&nbsp;<span class="ident" id="4396929">endOfText</span><span class="op" id="4396938">,</span>&nbsp;<span class="ident" id="4396940">endOfText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4396951">width</span><span class="op" id="4396956">,</span>&nbsp;<span class="ident" id="4396958">width1</span>&nbsp;<span class="op" id="4396965">:=</span>&nbsp;<span class="num" id="4396968">0</span><span class="op" id="4396969">,</span>&nbsp;<span class="num" id="4396971">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4396974">r</span><span class="op" id="4396975">,</span>&nbsp;<span class="ident" id="4396977">width</span>&nbsp;<span class="op" id="4396983">=</span>&nbsp;<span class="ident" id="4396985">i</span><span class="op" id="4396986">.</span><span class="ident" id="4396987">step</span><span class="op" id="4396991">(</span><span class="ident" id="4396992">pos</span><span class="op" id="4396995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4396998">if</span>&nbsp;<span class="ident" id="4397001">r</span>&nbsp;<span class="op" id="4397003">!=</span>&nbsp;<span class="ident" id="4397006">endOfText</span>&nbsp;<span class="op" id="4397016">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4397020">r1</span><span class="op" id="4397022">,</span>&nbsp;<span class="ident" id="4397024">width1</span>&nbsp;<span class="op" id="4397031">=</span>&nbsp;<span class="ident" id="4397033">i</span><span class="op" id="4397034">.</span><span class="ident" id="4397035">step</span><span class="op" id="4397039">(</span><span class="ident" id="4397040">pos</span>&nbsp;<span class="op" id="4397044">+</span>&nbsp;<span class="ident" id="4397046">width</span><span class="op" id="4397051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4397054">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4397057">var</span>&nbsp;<span class="ident" id="4397061">flag</span>&nbsp;<span class="ident" id="4397066">syntax</span><span class="op" id="4397072">.</span><span class="ident" id="4397073">EmptyOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4397082">if</span>&nbsp;<span class="ident" id="4397085">pos</span>&nbsp;<span class="op" id="4397089">==</span>&nbsp;<span class="num" id="4397092">0</span>&nbsp;<span class="op" id="4397094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4397098">flag</span>&nbsp;<span class="op" id="4397103">=</span>&nbsp;<span class="ident" id="4397105">syntax</span><span class="op" id="4397111">.</span><span class="ident" id="4397112">EmptyOpContext</span><span class="op" id="4397126">(</span><span class="op" id="4397127">-</span><span class="num" id="4397128">1</span><span class="op" id="4397129">,</span>&nbsp;<span class="ident" id="4397131">r</span><span class="op" id="4397132">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4397135">}</span>&nbsp;<span class="keyword" id="4397137">else</span>&nbsp;<span class="op" id="4397142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4397146">flag</span>&nbsp;<span class="op" id="4397151">=</span>&nbsp;<span class="ident" id="4397153">i</span><span class="op" id="4397154">.</span><span class="ident" id="4397155">context</span><span class="op" id="4397162">(</span><span class="ident" id="4397163">pos</span><span class="op" id="4397166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4397169">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4397172">for</span>&nbsp;<span class="op" id="4397176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4397180">if</span>&nbsp;<span class="builtinfunc" id="4397183">len</span><span class="op" id="4397186">(</span><span class="ident" id="4397187">runq</span><span class="op" id="4397191">.</span><span class="ident" id="4397192">dense</span><span class="op" id="4397197">)</span>&nbsp;<span class="op" id="4397199">==</span>&nbsp;<span class="num" id="4397202">0</span>&nbsp;<span class="op" id="4397204">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4397209">if</span>&nbsp;<span class="ident" id="4397212">startCond</span><span class="op" id="4397221">&amp;</span><span class="ident" id="4397222">syntax</span><span class="op" id="4397228">.</span><span class="ident" id="4397229">EmptyBeginText</span>&nbsp;<span class="op" id="4397244">!=</span>&nbsp;<span class="num" id="4397247">0</span>&nbsp;<span class="op" id="4397249">&amp;&amp;</span>&nbsp;<span class="ident" id="4397252">pos</span>&nbsp;<span class="op" id="4397256">!=</span>&nbsp;<span class="num" id="4397259">0</span>&nbsp;<span class="op" id="4397261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4397267">//&nbsp;Anchored&nbsp;match,&nbsp;past&nbsp;beginning&nbsp;of&nbsp;text.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4397314">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4397323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4397328">if</span>&nbsp;<span class="ident" id="4397331">m</span><span class="op" id="4397332">.</span><span class="ident" id="4397333">matched</span>&nbsp;<span class="op" id="4397341">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4397347">//&nbsp;Have&nbsp;match;&nbsp;finished&nbsp;exploring&nbsp;alternatives.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4397399">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4397408">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4397413">if</span>&nbsp;<span class="builtinfunc" id="4397416">len</span><span class="op" id="4397419">(</span><span class="ident" id="4397420">m</span><span class="op" id="4397421">.</span><span class="ident" id="4397422">re</span><span class="op" id="4397424">.</span><span class="ident" id="4397425">prefix</span><span class="op" id="4397431">)</span>&nbsp;<span class="op" id="4397433">&gt;</span>&nbsp;<span class="num" id="4397435">0</span>&nbsp;<span class="op" id="4397437">&amp;&amp;</span>&nbsp;<span class="ident" id="4397440">r1</span>&nbsp;<span class="op" id="4397443">!=</span>&nbsp;<span class="ident" id="4397446">m</span><span class="op" id="4397447">.</span><span class="ident" id="4397448">re</span><span class="op" id="4397450">.</span><span class="ident" id="4397451">prefixRune</span>&nbsp;<span class="op" id="4397462">&amp;&amp;</span>&nbsp;<span class="ident" id="4397465">i</span><span class="op" id="4397466">.</span><span class="ident" id="4397467">canCheckPrefix</span><span class="op" id="4397481">(</span><span class="op" id="4397482">)</span>&nbsp;<span class="op" id="4397484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4397490">//&nbsp;Match&nbsp;requires&nbsp;literal&nbsp;prefix;&nbsp;fast&nbsp;search&nbsp;for&nbsp;it.</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4397548">advance</span>&nbsp;<span class="op" id="4397556">:=</span>&nbsp;<span class="ident" id="4397559">i</span><span class="op" id="4397560">.</span><span class="ident" id="4397561">index</span><span class="op" id="4397566">(</span><span class="ident" id="4397567">m</span><span class="op" id="4397568">.</span><span class="ident" id="4397569">re</span><span class="op" id="4397571">,</span>&nbsp;<span class="ident" id="4397573">pos</span><span class="op" id="4397576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4397582">if</span>&nbsp;<span class="ident" id="4397585">advance</span>&nbsp;<span class="op" id="4397593">&lt;</span>&nbsp;<span class="num" id="4397595">0</span>&nbsp;<span class="op" id="4397597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4397604">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4397614">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4397620">pos</span>&nbsp;<span class="op" id="4397624">+=</span>&nbsp;<span class="ident" id="4397627">advance</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4397639">r</span><span class="op" id="4397640">,</span>&nbsp;<span class="ident" id="4397642">width</span>&nbsp;<span class="op" id="4397648">=</span>&nbsp;<span class="ident" id="4397650">i</span><span class="op" id="4397651">.</span><span class="ident" id="4397652">step</span><span class="op" id="4397656">(</span><span class="ident" id="4397657">pos</span><span class="op" id="4397660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4397666">r1</span><span class="op" id="4397668">,</span>&nbsp;<span class="ident" id="4397670">width1</span>&nbsp;<span class="op" id="4397677">=</span>&nbsp;<span class="ident" id="4397679">i</span><span class="op" id="4397680">.</span><span class="ident" id="4397681">step</span><span class="op" id="4397685">(</span><span class="ident" id="4397686">pos</span>&nbsp;<span class="op" id="4397690">+</span>&nbsp;<span class="ident" id="4397692">width</span><span class="op" id="4397697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4397702">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4397706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4397710">if</span>&nbsp;<span class="op" id="4397713">!</span><span class="ident" id="4397714">m</span><span class="op" id="4397715">.</span><span class="ident" id="4397716">matched</span>&nbsp;<span class="op" id="4397724">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4397729">if</span>&nbsp;<span class="builtinfunc" id="4397732">len</span><span class="op" id="4397735">(</span><span class="ident" id="4397736">m</span><span class="op" id="4397737">.</span><span class="ident" id="4397738">matchcap</span><span class="op" id="4397746">)</span>&nbsp;<span class="op" id="4397748">&gt;</span>&nbsp;<span class="num" id="4397750">0</span>&nbsp;<span class="op" id="4397752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4397758">m</span><span class="op" id="4397759">.</span><span class="ident" id="4397760">matchcap</span><span class="op" id="4397768">[</span><span class="num" id="4397769">0</span><span class="op" id="4397770">]</span>&nbsp;<span class="op" id="4397772">=</span>&nbsp;<span class="ident" id="4397774">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4397781">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4397786">m</span><span class="op" id="4397787">.</span><span class="ident" id="4397788">add</span><span class="op" id="4397791">(</span><span class="ident" id="4397792">runq</span><span class="op" id="4397796">,</span>&nbsp;<span class="builtintype" id="4397798">uint32</span><span class="op" id="4397804">(</span><span class="ident" id="4397805">m</span><span class="op" id="4397806">.</span><span class="ident" id="4397807">p</span><span class="op" id="4397808">.</span><span class="ident" id="4397809">Start</span><span class="op" id="4397814">)</span><span class="op" id="4397815">,</span>&nbsp;<span class="ident" id="4397817">pos</span><span class="op" id="4397820">,</span>&nbsp;<span class="ident" id="4397822">m</span><span class="op" id="4397823">.</span><span class="ident" id="4397824">matchcap</span><span class="op" id="4397832">,</span>&nbsp;<span class="ident" id="4397834">flag</span><span class="op" id="4397838">,</span>&nbsp;<span class="ident" id="4397840">nil</span><span class="op" id="4397843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4397847">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4397851">flag</span>&nbsp;<span class="op" id="4397856">=</span>&nbsp;<span class="ident" id="4397858">syntax</span><span class="op" id="4397864">.</span><span class="ident" id="4397865">EmptyOpContext</span><span class="op" id="4397879">(</span><span class="ident" id="4397880">r</span><span class="op" id="4397881">,</span>&nbsp;<span class="ident" id="4397883">r1</span><span class="op" id="4397885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4397889">m</span><span class="op" id="4397890">.</span><span class="ident" id="4397891">step</span><span class="op" id="4397895">(</span><span class="ident" id="4397896">runq</span><span class="op" id="4397900">,</span>&nbsp;<span class="ident" id="4397902">nextq</span><span class="op" id="4397907">,</span>&nbsp;<span class="ident" id="4397909">pos</span><span class="op" id="4397912">,</span>&nbsp;<span class="ident" id="4397914">pos</span><span class="op" id="4397917">+</span><span class="ident" id="4397918">width</span><span class="op" id="4397923">,</span>&nbsp;<span class="ident" id="4397925">r</span><span class="op" id="4397926">,</span>&nbsp;<span class="ident" id="4397928">flag</span><span class="op" id="4397932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4397936">if</span>&nbsp;<span class="ident" id="4397939">width</span>&nbsp;<span class="op" id="4397945">==</span>&nbsp;<span class="num" id="4397948">0</span>&nbsp;<span class="op" id="4397950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4397955">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4397963">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4397967">if</span>&nbsp;<span class="builtinfunc" id="4397970">len</span><span class="op" id="4397973">(</span><span class="ident" id="4397974">m</span><span class="op" id="4397975">.</span><span class="ident" id="4397976">matchcap</span><span class="op" id="4397984">)</span>&nbsp;<span class="op" id="4397986">==</span>&nbsp;<span class="num" id="4397989">0</span>&nbsp;<span class="op" id="4397991">&amp;&amp;</span>&nbsp;<span class="ident" id="4397994">m</span><span class="op" id="4397995">.</span><span class="ident" id="4397996">matched</span>&nbsp;<span class="op" id="4398004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4398009">//&nbsp;Found&nbsp;a&nbsp;match&nbsp;and&nbsp;not&nbsp;paying&nbsp;attention</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4398054">//&nbsp;to&nbsp;where&nbsp;it&nbsp;is,&nbsp;so&nbsp;any&nbsp;match&nbsp;will&nbsp;do.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4398098">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4398106">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4398110">pos</span>&nbsp;<span class="op" id="4398114">+=</span>&nbsp;<span class="ident" id="4398117">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4398125">r</span><span class="op" id="4398126">,</span>&nbsp;<span class="ident" id="4398128">width</span>&nbsp;<span class="op" id="4398134">=</span>&nbsp;<span class="ident" id="4398136">r1</span><span class="op" id="4398138">,</span>&nbsp;<span class="ident" id="4398140">width1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4398149">if</span>&nbsp;<span class="ident" id="4398152">r</span>&nbsp;<span class="op" id="4398154">!=</span>&nbsp;<span class="ident" id="4398157">endOfText</span>&nbsp;<span class="op" id="4398167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4398172">r1</span><span class="op" id="4398174">,</span>&nbsp;<span class="ident" id="4398176">width1</span>&nbsp;<span class="op" id="4398183">=</span>&nbsp;<span class="ident" id="4398185">i</span><span class="op" id="4398186">.</span><span class="ident" id="4398187">step</span><span class="op" id="4398191">(</span><span class="ident" id="4398192">pos</span>&nbsp;<span class="op" id="4398196">+</span>&nbsp;<span class="ident" id="4398198">width</span><span class="op" id="4398203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4398207">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4398211">runq</span><span class="op" id="4398215">,</span>&nbsp;<span class="ident" id="4398217">nextq</span>&nbsp;<span class="op" id="4398223">=</span>&nbsp;<span class="ident" id="4398225">nextq</span><span class="op" id="4398230">,</span>&nbsp;<span class="ident" id="4398232">runq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4398238">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4398241">m</span><span class="op" id="4398242">.</span><span class="ident" id="4398243">clear</span><span class="op" id="4398248">(</span><span class="ident" id="4398249">nextq</span><span class="op" id="4398254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4398257">return</span>&nbsp;<span class="ident" id="4398264">m</span><span class="op" id="4398265">.</span><span class="ident" id="4398266">matched</span><br>
<span class="lineno"></span><span class="op" id="4398274">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span><span class="comment" id="4398277">//&nbsp;clear&nbsp;frees&nbsp;all&nbsp;threads&nbsp;on&nbsp;the&nbsp;thread&nbsp;queue.</span><br>
<span class="lineno"></span><span class="keyword" id="4398325">func</span>&nbsp;<span class="op" id="4398330">(</span><span class="ident" id="4398331">m</span>&nbsp;<span class="op" id="4398333">*</span><span class="ident" id="4398334">machine</span><span class="op" id="4398341">)</span>&nbsp;<span class="ident" id="4398343">clear</span><span class="op" id="4398348">(</span><span class="ident" id="4398349">q</span>&nbsp;<span class="op" id="4398351">*</span><span class="ident" id="4398352">queue</span><span class="op" id="4398357">)</span>&nbsp;<span class="op" id="4398359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4398362">for</span>&nbsp;<span class="ident" id="4398366">_</span><span class="op" id="4398367">,</span>&nbsp;<span class="ident" id="4398369">d</span>&nbsp;<span class="op" id="4398371">:=</span>&nbsp;<span class="keyword" id="4398374">range</span>&nbsp;<span class="ident" id="4398380">q</span><span class="op" id="4398381">.</span><span class="ident" id="4398382">dense</span>&nbsp;<span class="op" id="4398388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4398392">if</span>&nbsp;<span class="ident" id="4398395">d</span><span class="op" id="4398396">.</span><span class="ident" id="4398397">t</span>&nbsp;<span class="op" id="4398399">!=</span>&nbsp;<span class="ident" id="4398402">nil</span>&nbsp;<span class="op" id="4398406">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4398411">//&nbsp;m.free(d.t)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4398429">m</span><span class="op" id="4398430">.</span><span class="ident" id="4398431">pool</span>&nbsp;<span class="op" id="4398436">=</span>&nbsp;<span class="builtinfunc" id="4398438">append</span><span class="op" id="4398444">(</span><span class="ident" id="4398445">m</span><span class="op" id="4398446">.</span><span class="ident" id="4398447">pool</span><span class="op" id="4398451">,</span>&nbsp;<span class="ident" id="4398453">d</span><span class="op" id="4398454">.</span><span class="ident" id="4398455">t</span><span class="op" id="4398456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4398460">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4398463">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4398466">q</span><span class="op" id="4398467">.</span><span class="ident" id="4398468">dense</span>&nbsp;<span class="op" id="4398474">=</span>&nbsp;<span class="ident" id="4398476">q</span><span class="op" id="4398477">.</span><span class="ident" id="4398478">dense</span><span class="op" id="4398483">[</span><span class="op" id="4398484">:</span><span class="num" id="4398485">0</span><span class="op" id="4398486">]</span><br>
<span class="lineno">195</span><span class="op" id="4398488">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4398491">//&nbsp;step&nbsp;executes&nbsp;one&nbsp;step&nbsp;of&nbsp;the&nbsp;machine,&nbsp;running&nbsp;each&nbsp;of&nbsp;the&nbsp;threads</span><br>
<span class="lineno"></span><span class="comment" id="4398561">//&nbsp;on&nbsp;runq&nbsp;and&nbsp;appending&nbsp;new&nbsp;threads&nbsp;to&nbsp;nextq.</span><br>
<span class="lineno"></span><span class="comment" id="4398608">//&nbsp;The&nbsp;step&nbsp;processes&nbsp;the&nbsp;rune&nbsp;c&nbsp;(which&nbsp;may&nbsp;be&nbsp;endOfText),</span><br>
<span class="lineno">200</span><span class="comment" id="4398667">//&nbsp;which&nbsp;starts&nbsp;at&nbsp;position&nbsp;pos&nbsp;and&nbsp;ends&nbsp;at&nbsp;nextPos.</span><br>
<span class="lineno"></span><span class="comment" id="4398720">//&nbsp;nextCond&nbsp;gives&nbsp;the&nbsp;setting&nbsp;for&nbsp;the&nbsp;empty-width&nbsp;flags&nbsp;after&nbsp;c.</span><br>
<span class="lineno"></span><span class="keyword" id="4398785">func</span>&nbsp;<span class="op" id="4398790">(</span><span class="ident" id="4398791">m</span>&nbsp;<span class="op" id="4398793">*</span><span class="ident" id="4398794">machine</span><span class="op" id="4398801">)</span>&nbsp;<span class="ident" id="4398803">step</span><span class="op" id="4398807">(</span><span class="ident" id="4398808">runq</span><span class="op" id="4398812">,</span>&nbsp;<span class="ident" id="4398814">nextq</span>&nbsp;<span class="op" id="4398820">*</span><span class="ident" id="4398821">queue</span><span class="op" id="4398826">,</span>&nbsp;<span class="ident" id="4398828">pos</span><span class="op" id="4398831">,</span>&nbsp;<span class="ident" id="4398833">nextPos</span>&nbsp;<span class="builtintype" id="4398841">int</span><span class="op" id="4398844">,</span>&nbsp;<span class="ident" id="4398846">c</span>&nbsp;<span class="builtintype" id="4398848">rune</span><span class="op" id="4398852">,</span>&nbsp;<span class="ident" id="4398854">nextCond</span>&nbsp;<span class="ident" id="4398863">syntax</span><span class="op" id="4398869">.</span><span class="ident" id="4398870">EmptyOp</span><span class="op" id="4398877">)</span>&nbsp;<span class="op" id="4398879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4398882">longest</span>&nbsp;<span class="op" id="4398890">:=</span>&nbsp;<span class="ident" id="4398893">m</span><span class="op" id="4398894">.</span><span class="ident" id="4398895">re</span><span class="op" id="4398897">.</span><span class="ident" id="4398898">longest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4398907">for</span>&nbsp;<span class="ident" id="4398911">j</span>&nbsp;<span class="op" id="4398913">:=</span>&nbsp;<span class="num" id="4398916">0</span><span class="op" id="4398917">;</span>&nbsp;<span class="ident" id="4398919">j</span>&nbsp;<span class="op" id="4398921">&lt;</span>&nbsp;<span class="builtinfunc" id="4398923">len</span><span class="op" id="4398926">(</span><span class="ident" id="4398927">runq</span><span class="op" id="4398931">.</span><span class="ident" id="4398932">dense</span><span class="op" id="4398937">)</span><span class="op" id="4398938">;</span>&nbsp;<span class="ident" id="4398940">j</span><span class="op" id="4398941">++</span>&nbsp;<span class="op" id="4398944">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4398948">d</span>&nbsp;<span class="op" id="4398950">:=</span>&nbsp;<span class="op" id="4398953">&amp;</span><span class="ident" id="4398954">runq</span><span class="op" id="4398958">.</span><span class="ident" id="4398959">dense</span><span class="op" id="4398964">[</span><span class="ident" id="4398965">j</span><span class="op" id="4398966">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4398970">t</span>&nbsp;<span class="op" id="4398972">:=</span>&nbsp;<span class="ident" id="4398975">d</span><span class="op" id="4398976">.</span><span class="ident" id="4398977">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4398981">if</span>&nbsp;<span class="ident" id="4398984">t</span>&nbsp;<span class="op" id="4398986">==</span>&nbsp;<span class="ident" id="4398989">nil</span>&nbsp;<span class="op" id="4398993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4398998">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4399009">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4399013">if</span>&nbsp;<span class="ident" id="4399016">longest</span>&nbsp;<span class="op" id="4399024">&amp;&amp;</span>&nbsp;<span class="ident" id="4399027">m</span><span class="op" id="4399028">.</span><span class="ident" id="4399029">matched</span>&nbsp;<span class="op" id="4399037">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="4399040">len</span><span class="op" id="4399043">(</span><span class="ident" id="4399044">t</span><span class="op" id="4399045">.</span><span class="builtinfunc" id="4399046">cap</span><span class="op" id="4399049">)</span>&nbsp;<span class="op" id="4399051">&gt;</span>&nbsp;<span class="num" id="4399053">0</span>&nbsp;<span class="op" id="4399055">&amp;&amp;</span>&nbsp;<span class="ident" id="4399058">m</span><span class="op" id="4399059">.</span><span class="ident" id="4399060">matchcap</span><span class="op" id="4399068">[</span><span class="num" id="4399069">0</span><span class="op" id="4399070">]</span>&nbsp;<span class="op" id="4399072">&lt;</span>&nbsp;<span class="ident" id="4399074">t</span><span class="op" id="4399075">.</span><span class="builtinfunc" id="4399076">cap</span><span class="op" id="4399079">[</span><span class="num" id="4399080">0</span><span class="op" id="4399081">]</span>&nbsp;<span class="op" id="4399083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4399088">//&nbsp;m.free(t)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4399104">m</span><span class="op" id="4399105">.</span><span class="ident" id="4399106">pool</span>&nbsp;<span class="op" id="4399111">=</span>&nbsp;<span class="builtinfunc" id="4399113">append</span><span class="op" id="4399119">(</span><span class="ident" id="4399120">m</span><span class="op" id="4399121">.</span><span class="ident" id="4399122">pool</span><span class="op" id="4399126">,</span>&nbsp;<span class="ident" id="4399128">t</span><span class="op" id="4399129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4399134">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4399145">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4399149">i</span>&nbsp;<span class="op" id="4399151">:=</span>&nbsp;<span class="ident" id="4399154">t</span><span class="op" id="4399155">.</span><span class="ident" id="4399156">inst</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4399163">add</span>&nbsp;<span class="op" id="4399167">:=</span>&nbsp;<span class="builtintype" id="4399170">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4399178">switch</span>&nbsp;<span class="ident" id="4399185">i</span><span class="op" id="4399186">.</span><span class="ident" id="4399187">Op</span>&nbsp;<span class="op" id="4399190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4399194">default</span><span class="op" id="4399201">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4399206">panic</span><span class="op" id="4399211">(</span><span class="string" id="4399212">&#34;bad&nbsp;inst&#34;</span><span class="op" id="4399222">)</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4399227">case</span>&nbsp;<span class="ident" id="4399232">syntax</span><span class="op" id="4399238">.</span><span class="ident" id="4399239">InstMatch</span><span class="op" id="4399248">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4399253">if</span>&nbsp;<span class="builtinfunc" id="4399256">len</span><span class="op" id="4399259">(</span><span class="ident" id="4399260">t</span><span class="op" id="4399261">.</span><span class="builtinfunc" id="4399262">cap</span><span class="op" id="4399265">)</span>&nbsp;<span class="op" id="4399267">&gt;</span>&nbsp;<span class="num" id="4399269">0</span>&nbsp;<span class="op" id="4399271">&amp;&amp;</span>&nbsp;<span class="op" id="4399274">(</span><span class="op" id="4399275">!</span><span class="ident" id="4399276">longest</span>&nbsp;<span class="op" id="4399284">||</span>&nbsp;<span class="op" id="4399287">!</span><span class="ident" id="4399288">m</span><span class="op" id="4399289">.</span><span class="ident" id="4399290">matched</span>&nbsp;<span class="op" id="4399298">||</span>&nbsp;<span class="ident" id="4399301">m</span><span class="op" id="4399302">.</span><span class="ident" id="4399303">matchcap</span><span class="op" id="4399311">[</span><span class="num" id="4399312">1</span><span class="op" id="4399313">]</span>&nbsp;<span class="op" id="4399315">&lt;</span>&nbsp;<span class="ident" id="4399317">pos</span><span class="op" id="4399320">)</span>&nbsp;<span class="op" id="4399322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4399328">t</span><span class="op" id="4399329">.</span><span class="builtinfunc" id="4399330">cap</span><span class="op" id="4399333">[</span><span class="num" id="4399334">1</span><span class="op" id="4399335">]</span>&nbsp;<span class="op" id="4399337">=</span>&nbsp;<span class="ident" id="4399339">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4399347">copy</span><span class="op" id="4399351">(</span><span class="ident" id="4399352">m</span><span class="op" id="4399353">.</span><span class="ident" id="4399354">matchcap</span><span class="op" id="4399362">,</span>&nbsp;<span class="ident" id="4399364">t</span><span class="op" id="4399365">.</span><span class="builtinfunc" id="4399366">cap</span><span class="op" id="4399369">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4399374">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4399379">if</span>&nbsp;<span class="op" id="4399382">!</span><span class="ident" id="4399383">longest</span>&nbsp;<span class="op" id="4399391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4399397">//&nbsp;First-match&nbsp;mode:&nbsp;cut&nbsp;off&nbsp;all&nbsp;lower-priority&nbsp;threads.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4399458">for</span>&nbsp;<span class="ident" id="4399462">_</span><span class="op" id="4399463">,</span>&nbsp;<span class="ident" id="4399465">d</span>&nbsp;<span class="op" id="4399467">:=</span>&nbsp;<span class="keyword" id="4399470">range</span>&nbsp;<span class="ident" id="4399476">runq</span><span class="op" id="4399480">.</span><span class="ident" id="4399481">dense</span><span class="op" id="4399486">[</span><span class="ident" id="4399487">j</span><span class="op" id="4399488">+</span><span class="num" id="4399489">1</span><span class="op" id="4399490">:</span><span class="op" id="4399491">]</span>&nbsp;<span class="op" id="4399493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4399500">if</span>&nbsp;<span class="ident" id="4399503">d</span><span class="op" id="4399504">.</span><span class="ident" id="4399505">t</span>&nbsp;<span class="op" id="4399507">!=</span>&nbsp;<span class="ident" id="4399510">nil</span>&nbsp;<span class="op" id="4399514">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4399522">//&nbsp;m.free(d.t)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4399543">m</span><span class="op" id="4399544">.</span><span class="ident" id="4399545">pool</span>&nbsp;<span class="op" id="4399550">=</span>&nbsp;<span class="builtinfunc" id="4399552">append</span><span class="op" id="4399558">(</span><span class="ident" id="4399559">m</span><span class="op" id="4399560">.</span><span class="ident" id="4399561">pool</span><span class="op" id="4399565">,</span>&nbsp;<span class="ident" id="4399567">d</span><span class="op" id="4399568">.</span><span class="ident" id="4399569">t</span><span class="op" id="4399570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4399577">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4399583">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4399589">runq</span><span class="op" id="4399593">.</span><span class="ident" id="4399594">dense</span>&nbsp;<span class="op" id="4399600">=</span>&nbsp;<span class="ident" id="4399602">runq</span><span class="op" id="4399606">.</span><span class="ident" id="4399607">dense</span><span class="op" id="4399612">[</span><span class="op" id="4399613">:</span><span class="num" id="4399614">0</span><span class="op" id="4399615">]</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4399620">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4399625">m</span><span class="op" id="4399626">.</span><span class="ident" id="4399627">matched</span>&nbsp;<span class="op" id="4399635">=</span>&nbsp;<span class="builtintype" id="4399637">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4399645">case</span>&nbsp;<span class="ident" id="4399650">syntax</span><span class="op" id="4399656">.</span><span class="ident" id="4399657">InstRune</span><span class="op" id="4399665">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4399670">add</span>&nbsp;<span class="op" id="4399674">=</span>&nbsp;<span class="ident" id="4399676">i</span><span class="op" id="4399677">.</span><span class="ident" id="4399678">MatchRune</span><span class="op" id="4399687">(</span><span class="ident" id="4399688">c</span><span class="op" id="4399689">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4399693">case</span>&nbsp;<span class="ident" id="4399698">syntax</span><span class="op" id="4399704">.</span><span class="ident" id="4399705">InstRune1</span><span class="op" id="4399714">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4399719">add</span>&nbsp;<span class="op" id="4399723">=</span>&nbsp;<span class="ident" id="4399725">c</span>&nbsp;<span class="op" id="4399727">==</span>&nbsp;<span class="ident" id="4399730">i</span><span class="op" id="4399731">.</span><span class="ident" id="4399732">Rune</span><span class="op" id="4399736">[</span><span class="num" id="4399737">0</span><span class="op" id="4399738">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4399742">case</span>&nbsp;<span class="ident" id="4399747">syntax</span><span class="op" id="4399753">.</span><span class="ident" id="4399754">InstRuneAny</span><span class="op" id="4399765">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4399770">add</span>&nbsp;<span class="op" id="4399774">=</span>&nbsp;<span class="builtintype" id="4399776">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4399783">case</span>&nbsp;<span class="ident" id="4399788">syntax</span><span class="op" id="4399794">.</span><span class="ident" id="4399795">InstRuneAnyNotNL</span><span class="op" id="4399811">:</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4399816">add</span>&nbsp;<span class="op" id="4399820">=</span>&nbsp;<span class="ident" id="4399822">c</span>&nbsp;<span class="op" id="4399824">!=</span>&nbsp;<span class="string" id="4399827">&#39;\n&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4399834">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4399838">if</span>&nbsp;<span class="ident" id="4399841">add</span>&nbsp;<span class="op" id="4399845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4399850">t</span>&nbsp;<span class="op" id="4399852">=</span>&nbsp;<span class="ident" id="4399854">m</span><span class="op" id="4399855">.</span><span class="ident" id="4399856">add</span><span class="op" id="4399859">(</span><span class="ident" id="4399860">nextq</span><span class="op" id="4399865">,</span>&nbsp;<span class="ident" id="4399867">i</span><span class="op" id="4399868">.</span><span class="ident" id="4399869">Out</span><span class="op" id="4399872">,</span>&nbsp;<span class="ident" id="4399874">nextPos</span><span class="op" id="4399881">,</span>&nbsp;<span class="ident" id="4399883">t</span><span class="op" id="4399884">.</span><span class="builtinfunc" id="4399885">cap</span><span class="op" id="4399888">,</span>&nbsp;<span class="ident" id="4399890">nextCond</span><span class="op" id="4399898">,</span>&nbsp;<span class="ident" id="4399900">t</span><span class="op" id="4399901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4399905">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4399909">if</span>&nbsp;<span class="ident" id="4399912">t</span>&nbsp;<span class="op" id="4399914">!=</span>&nbsp;<span class="ident" id="4399917">nil</span>&nbsp;<span class="op" id="4399921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4399926">//&nbsp;m.free(t)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4399942">m</span><span class="op" id="4399943">.</span><span class="ident" id="4399944">pool</span>&nbsp;<span class="op" id="4399949">=</span>&nbsp;<span class="builtinfunc" id="4399951">append</span><span class="op" id="4399957">(</span><span class="ident" id="4399958">m</span><span class="op" id="4399959">.</span><span class="ident" id="4399960">pool</span><span class="op" id="4399964">,</span>&nbsp;<span class="ident" id="4399966">t</span><span class="op" id="4399967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4399971">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4399974">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4399977">runq</span><span class="op" id="4399981">.</span><span class="ident" id="4399982">dense</span>&nbsp;<span class="op" id="4399988">=</span>&nbsp;<span class="ident" id="4399990">runq</span><span class="op" id="4399994">.</span><span class="ident" id="4399995">dense</span><span class="op" id="4400000">[</span><span class="op" id="4400001">:</span><span class="num" id="4400002">0</span><span class="op" id="4400003">]</span><br>
<span class="lineno"></span><span class="op" id="4400005">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4400008">//&nbsp;add&nbsp;adds&nbsp;an&nbsp;entry&nbsp;to&nbsp;q&nbsp;for&nbsp;pc,&nbsp;unless&nbsp;the&nbsp;q&nbsp;already&nbsp;has&nbsp;such&nbsp;an&nbsp;entry.</span><br>
<span class="lineno"></span><span class="comment" id="4400082">//&nbsp;It&nbsp;also&nbsp;recursively&nbsp;adds&nbsp;an&nbsp;entry&nbsp;for&nbsp;all&nbsp;instructions&nbsp;reachable&nbsp;from&nbsp;pc&nbsp;by&nbsp;following</span><br>
<span class="lineno">260</span><span class="comment" id="4400171">//&nbsp;empty-width&nbsp;conditions&nbsp;satisfied&nbsp;by&nbsp;cond.&nbsp;&nbsp;pos&nbsp;gives&nbsp;the&nbsp;current&nbsp;position</span><br>
<span class="lineno"></span><span class="comment" id="4400248">//&nbsp;in&nbsp;the&nbsp;input.</span><br>
<span class="lineno"></span><span class="keyword" id="4400265">func</span>&nbsp;<span class="op" id="4400270">(</span><span class="ident" id="4400271">m</span>&nbsp;<span class="op" id="4400273">*</span><span class="ident" id="4400274">machine</span><span class="op" id="4400281">)</span>&nbsp;<span class="ident" id="4400283">add</span><span class="op" id="4400286">(</span><span class="ident" id="4400287">q</span>&nbsp;<span class="op" id="4400289">*</span><span class="ident" id="4400290">queue</span><span class="op" id="4400295">,</span>&nbsp;<span class="ident" id="4400297">pc</span>&nbsp;<span class="builtintype" id="4400300">uint32</span><span class="op" id="4400306">,</span>&nbsp;<span class="ident" id="4400308">pos</span>&nbsp;<span class="builtintype" id="4400312">int</span><span class="op" id="4400315">,</span>&nbsp;<span class="builtinfunc" id="4400317">cap</span>&nbsp;<span class="op" id="4400321">[</span><span class="op" id="4400322">]</span><span class="builtintype" id="4400323">int</span><span class="op" id="4400326">,</span>&nbsp;<span class="ident" id="4400328">cond</span>&nbsp;<span class="ident" id="4400333">syntax</span><span class="op" id="4400339">.</span><span class="ident" id="4400340">EmptyOp</span><span class="op" id="4400347">,</span>&nbsp;<span class="ident" id="4400349">t</span>&nbsp;<span class="op" id="4400351">*</span><span class="ident" id="4400352">thread</span><span class="op" id="4400358">)</span>&nbsp;<span class="op" id="4400360">*</span><span class="ident" id="4400361">thread</span>&nbsp;<span class="op" id="4400368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4400371">if</span>&nbsp;<span class="ident" id="4400374">pc</span>&nbsp;<span class="op" id="4400377">==</span>&nbsp;<span class="num" id="4400380">0</span>&nbsp;<span class="op" id="4400382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4400386">return</span>&nbsp;<span class="ident" id="4400393">t</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4400396">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4400399">if</span>&nbsp;<span class="ident" id="4400402">j</span>&nbsp;<span class="op" id="4400404">:=</span>&nbsp;<span class="ident" id="4400407">q</span><span class="op" id="4400408">.</span><span class="ident" id="4400409">sparse</span><span class="op" id="4400415">[</span><span class="ident" id="4400416">pc</span><span class="op" id="4400418">]</span><span class="op" id="4400419">;</span>&nbsp;<span class="ident" id="4400421">j</span>&nbsp;<span class="op" id="4400423">&lt;</span>&nbsp;<span class="builtintype" id="4400425">uint32</span><span class="op" id="4400431">(</span><span class="builtinfunc" id="4400432">len</span><span class="op" id="4400435">(</span><span class="ident" id="4400436">q</span><span class="op" id="4400437">.</span><span class="ident" id="4400438">dense</span><span class="op" id="4400443">)</span><span class="op" id="4400444">)</span>&nbsp;<span class="op" id="4400446">&amp;&amp;</span>&nbsp;<span class="ident" id="4400449">q</span><span class="op" id="4400450">.</span><span class="ident" id="4400451">dense</span><span class="op" id="4400456">[</span><span class="ident" id="4400457">j</span><span class="op" id="4400458">]</span><span class="op" id="4400459">.</span><span class="ident" id="4400460">pc</span>&nbsp;<span class="op" id="4400463">==</span>&nbsp;<span class="ident" id="4400466">pc</span>&nbsp;<span class="op" id="4400469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4400473">return</span>&nbsp;<span class="ident" id="4400480">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4400483">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4400487">j</span>&nbsp;<span class="op" id="4400489">:=</span>&nbsp;<span class="builtinfunc" id="4400492">len</span><span class="op" id="4400495">(</span><span class="ident" id="4400496">q</span><span class="op" id="4400497">.</span><span class="ident" id="4400498">dense</span><span class="op" id="4400503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4400506">q</span><span class="op" id="4400507">.</span><span class="ident" id="4400508">dense</span>&nbsp;<span class="op" id="4400514">=</span>&nbsp;<span class="ident" id="4400516">q</span><span class="op" id="4400517">.</span><span class="ident" id="4400518">dense</span><span class="op" id="4400523">[</span><span class="op" id="4400524">:</span><span class="ident" id="4400525">j</span><span class="op" id="4400526">+</span><span class="num" id="4400527">1</span><span class="op" id="4400528">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4400531">d</span>&nbsp;<span class="op" id="4400533">:=</span>&nbsp;<span class="op" id="4400536">&amp;</span><span class="ident" id="4400537">q</span><span class="op" id="4400538">.</span><span class="ident" id="4400539">dense</span><span class="op" id="4400544">[</span><span class="ident" id="4400545">j</span><span class="op" id="4400546">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4400549">d</span><span class="op" id="4400550">.</span><span class="ident" id="4400551">t</span>&nbsp;<span class="op" id="4400553">=</span>&nbsp;<span class="ident" id="4400555">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4400560">d</span><span class="op" id="4400561">.</span><span class="ident" id="4400562">pc</span>&nbsp;<span class="op" id="4400565">=</span>&nbsp;<span class="ident" id="4400567">pc</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4400571">q</span><span class="op" id="4400572">.</span><span class="ident" id="4400573">sparse</span><span class="op" id="4400579">[</span><span class="ident" id="4400580">pc</span><span class="op" id="4400582">]</span>&nbsp;<span class="op" id="4400584">=</span>&nbsp;<span class="builtintype" id="4400586">uint32</span><span class="op" id="4400592">(</span><span class="ident" id="4400593">j</span><span class="op" id="4400594">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4400598">i</span>&nbsp;<span class="op" id="4400600">:=</span>&nbsp;<span class="op" id="4400603">&amp;</span><span class="ident" id="4400604">m</span><span class="op" id="4400605">.</span><span class="ident" id="4400606">p</span><span class="op" id="4400607">.</span><span class="ident" id="4400608">Inst</span><span class="op" id="4400612">[</span><span class="ident" id="4400613">pc</span><span class="op" id="4400615">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4400618">switch</span>&nbsp;<span class="ident" id="4400625">i</span><span class="op" id="4400626">.</span><span class="ident" id="4400627">Op</span>&nbsp;<span class="op" id="4400630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4400633">default</span><span class="op" id="4400640">:</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4400644">panic</span><span class="op" id="4400649">(</span><span class="string" id="4400650">&#34;unhandled&#34;</span><span class="op" id="4400661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4400664">case</span>&nbsp;<span class="ident" id="4400669">syntax</span><span class="op" id="4400675">.</span><span class="ident" id="4400676">InstFail</span><span class="op" id="4400684">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4400688">//&nbsp;nothing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4400700">case</span>&nbsp;<span class="ident" id="4400705">syntax</span><span class="op" id="4400711">.</span><span class="ident" id="4400712">InstAlt</span><span class="op" id="4400719">,</span>&nbsp;<span class="ident" id="4400721">syntax</span><span class="op" id="4400727">.</span><span class="ident" id="4400728">InstAltMatch</span><span class="op" id="4400740">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4400744">t</span>&nbsp;<span class="op" id="4400746">=</span>&nbsp;<span class="ident" id="4400748">m</span><span class="op" id="4400749">.</span><span class="ident" id="4400750">add</span><span class="op" id="4400753">(</span><span class="ident" id="4400754">q</span><span class="op" id="4400755">,</span>&nbsp;<span class="ident" id="4400757">i</span><span class="op" id="4400758">.</span><span class="ident" id="4400759">Out</span><span class="op" id="4400762">,</span>&nbsp;<span class="ident" id="4400764">pos</span><span class="op" id="4400767">,</span>&nbsp;<span class="builtinfunc" id="4400769">cap</span><span class="op" id="4400772">,</span>&nbsp;<span class="ident" id="4400774">cond</span><span class="op" id="4400778">,</span>&nbsp;<span class="ident" id="4400780">t</span><span class="op" id="4400781">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4400785">t</span>&nbsp;<span class="op" id="4400787">=</span>&nbsp;<span class="ident" id="4400789">m</span><span class="op" id="4400790">.</span><span class="ident" id="4400791">add</span><span class="op" id="4400794">(</span><span class="ident" id="4400795">q</span><span class="op" id="4400796">,</span>&nbsp;<span class="ident" id="4400798">i</span><span class="op" id="4400799">.</span><span class="ident" id="4400800">Arg</span><span class="op" id="4400803">,</span>&nbsp;<span class="ident" id="4400805">pos</span><span class="op" id="4400808">,</span>&nbsp;<span class="builtinfunc" id="4400810">cap</span><span class="op" id="4400813">,</span>&nbsp;<span class="ident" id="4400815">cond</span><span class="op" id="4400819">,</span>&nbsp;<span class="ident" id="4400821">t</span><span class="op" id="4400822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4400825">case</span>&nbsp;<span class="ident" id="4400830">syntax</span><span class="op" id="4400836">.</span><span class="ident" id="4400837">InstEmptyWidth</span><span class="op" id="4400851">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4400855">if</span>&nbsp;<span class="ident" id="4400858">syntax</span><span class="op" id="4400864">.</span><span class="ident" id="4400865">EmptyOp</span><span class="op" id="4400872">(</span><span class="ident" id="4400873">i</span><span class="op" id="4400874">.</span><span class="ident" id="4400875">Arg</span><span class="op" id="4400878">)</span><span class="op" id="4400879">&amp;^</span><span class="ident" id="4400881">cond</span>&nbsp;<span class="op" id="4400886">==</span>&nbsp;<span class="num" id="4400889">0</span>&nbsp;<span class="op" id="4400891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4400896">t</span>&nbsp;<span class="op" id="4400898">=</span>&nbsp;<span class="ident" id="4400900">m</span><span class="op" id="4400901">.</span><span class="ident" id="4400902">add</span><span class="op" id="4400905">(</span><span class="ident" id="4400906">q</span><span class="op" id="4400907">,</span>&nbsp;<span class="ident" id="4400909">i</span><span class="op" id="4400910">.</span><span class="ident" id="4400911">Out</span><span class="op" id="4400914">,</span>&nbsp;<span class="ident" id="4400916">pos</span><span class="op" id="4400919">,</span>&nbsp;<span class="builtinfunc" id="4400921">cap</span><span class="op" id="4400924">,</span>&nbsp;<span class="ident" id="4400926">cond</span><span class="op" id="4400930">,</span>&nbsp;<span class="ident" id="4400932">t</span><span class="op" id="4400933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4400937">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4400940">case</span>&nbsp;<span class="ident" id="4400945">syntax</span><span class="op" id="4400951">.</span><span class="ident" id="4400952">InstNop</span><span class="op" id="4400959">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4400963">t</span>&nbsp;<span class="op" id="4400965">=</span>&nbsp;<span class="ident" id="4400967">m</span><span class="op" id="4400968">.</span><span class="ident" id="4400969">add</span><span class="op" id="4400972">(</span><span class="ident" id="4400973">q</span><span class="op" id="4400974">,</span>&nbsp;<span class="ident" id="4400976">i</span><span class="op" id="4400977">.</span><span class="ident" id="4400978">Out</span><span class="op" id="4400981">,</span>&nbsp;<span class="ident" id="4400983">pos</span><span class="op" id="4400986">,</span>&nbsp;<span class="builtinfunc" id="4400988">cap</span><span class="op" id="4400991">,</span>&nbsp;<span class="ident" id="4400993">cond</span><span class="op" id="4400997">,</span>&nbsp;<span class="ident" id="4400999">t</span><span class="op" id="4401000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4401003">case</span>&nbsp;<span class="ident" id="4401008">syntax</span><span class="op" id="4401014">.</span><span class="ident" id="4401015">InstCapture</span><span class="op" id="4401026">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4401030">if</span>&nbsp;<span class="builtintype" id="4401033">int</span><span class="op" id="4401036">(</span><span class="ident" id="4401037">i</span><span class="op" id="4401038">.</span><span class="ident" id="4401039">Arg</span><span class="op" id="4401042">)</span>&nbsp;<span class="op" id="4401044">&lt;</span>&nbsp;<span class="builtinfunc" id="4401046">len</span><span class="op" id="4401049">(</span><span class="builtinfunc" id="4401050">cap</span><span class="op" id="4401053">)</span>&nbsp;<span class="op" id="4401055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4401060">opos</span>&nbsp;<span class="op" id="4401065">:=</span>&nbsp;<span class="builtinfunc" id="4401068">cap</span><span class="op" id="4401071">[</span><span class="ident" id="4401072">i</span><span class="op" id="4401073">.</span><span class="ident" id="4401074">Arg</span><span class="op" id="4401077">]</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4401082">cap</span><span class="op" id="4401085">[</span><span class="ident" id="4401086">i</span><span class="op" id="4401087">.</span><span class="ident" id="4401088">Arg</span><span class="op" id="4401091">]</span>&nbsp;<span class="op" id="4401093">=</span>&nbsp;<span class="ident" id="4401095">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4401102">m</span><span class="op" id="4401103">.</span><span class="ident" id="4401104">add</span><span class="op" id="4401107">(</span><span class="ident" id="4401108">q</span><span class="op" id="4401109">,</span>&nbsp;<span class="ident" id="4401111">i</span><span class="op" id="4401112">.</span><span class="ident" id="4401113">Out</span><span class="op" id="4401116">,</span>&nbsp;<span class="ident" id="4401118">pos</span><span class="op" id="4401121">,</span>&nbsp;<span class="builtinfunc" id="4401123">cap</span><span class="op" id="4401126">,</span>&nbsp;<span class="ident" id="4401128">cond</span><span class="op" id="4401132">,</span>&nbsp;<span class="ident" id="4401134">nil</span><span class="op" id="4401137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4401142">cap</span><span class="op" id="4401145">[</span><span class="ident" id="4401146">i</span><span class="op" id="4401147">.</span><span class="ident" id="4401148">Arg</span><span class="op" id="4401151">]</span>&nbsp;<span class="op" id="4401153">=</span>&nbsp;<span class="ident" id="4401155">opos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4401162">}</span>&nbsp;<span class="keyword" id="4401164">else</span>&nbsp;<span class="op" id="4401169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4401174">t</span>&nbsp;<span class="op" id="4401176">=</span>&nbsp;<span class="ident" id="4401178">m</span><span class="op" id="4401179">.</span><span class="ident" id="4401180">add</span><span class="op" id="4401183">(</span><span class="ident" id="4401184">q</span><span class="op" id="4401185">,</span>&nbsp;<span class="ident" id="4401187">i</span><span class="op" id="4401188">.</span><span class="ident" id="4401189">Out</span><span class="op" id="4401192">,</span>&nbsp;<span class="ident" id="4401194">pos</span><span class="op" id="4401197">,</span>&nbsp;<span class="builtinfunc" id="4401199">cap</span><span class="op" id="4401202">,</span>&nbsp;<span class="ident" id="4401204">cond</span><span class="op" id="4401208">,</span>&nbsp;<span class="ident" id="4401210">t</span><span class="op" id="4401211">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4401215">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4401218">case</span>&nbsp;<span class="ident" id="4401223">syntax</span><span class="op" id="4401229">.</span><span class="ident" id="4401230">InstMatch</span><span class="op" id="4401239">,</span>&nbsp;<span class="ident" id="4401241">syntax</span><span class="op" id="4401247">.</span><span class="ident" id="4401248">InstRune</span><span class="op" id="4401256">,</span>&nbsp;<span class="ident" id="4401258">syntax</span><span class="op" id="4401264">.</span><span class="ident" id="4401265">InstRune1</span><span class="op" id="4401274">,</span>&nbsp;<span class="ident" id="4401276">syntax</span><span class="op" id="4401282">.</span><span class="ident" id="4401283">InstRuneAny</span><span class="op" id="4401294">,</span>&nbsp;<span class="ident" id="4401296">syntax</span><span class="op" id="4401302">.</span><span class="ident" id="4401303">InstRuneAnyNotNL</span><span class="op" id="4401319">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4401323">if</span>&nbsp;<span class="ident" id="4401326">t</span>&nbsp;<span class="op" id="4401328">==</span>&nbsp;<span class="ident" id="4401331">nil</span>&nbsp;<span class="op" id="4401335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4401340">t</span>&nbsp;<span class="op" id="4401342">=</span>&nbsp;<span class="ident" id="4401344">m</span><span class="op" id="4401345">.</span><span class="ident" id="4401346">alloc</span><span class="op" id="4401351">(</span><span class="ident" id="4401352">i</span><span class="op" id="4401353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4401357">}</span>&nbsp;<span class="keyword" id="4401359">else</span>&nbsp;<span class="op" id="4401364">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4401369">t</span><span class="op" id="4401370">.</span><span class="ident" id="4401371">inst</span>&nbsp;<span class="op" id="4401376">=</span>&nbsp;<span class="ident" id="4401378">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4401382">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4401386">if</span>&nbsp;<span class="builtinfunc" id="4401389">len</span><span class="op" id="4401392">(</span><span class="builtinfunc" id="4401393">cap</span><span class="op" id="4401396">)</span>&nbsp;<span class="op" id="4401398">&gt;</span>&nbsp;<span class="num" id="4401400">0</span>&nbsp;<span class="op" id="4401402">&amp;&amp;</span>&nbsp;<span class="op" id="4401405">&amp;</span><span class="ident" id="4401406">t</span><span class="op" id="4401407">.</span><span class="builtinfunc" id="4401408">cap</span><span class="op" id="4401411">[</span><span class="num" id="4401412">0</span><span class="op" id="4401413">]</span>&nbsp;<span class="op" id="4401415">!=</span>&nbsp;<span class="op" id="4401418">&amp;</span><span class="builtinfunc" id="4401419">cap</span><span class="op" id="4401422">[</span><span class="num" id="4401423">0</span><span class="op" id="4401424">]</span>&nbsp;<span class="op" id="4401426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4401431">copy</span><span class="op" id="4401435">(</span><span class="ident" id="4401436">t</span><span class="op" id="4401437">.</span><span class="builtinfunc" id="4401438">cap</span><span class="op" id="4401441">,</span>&nbsp;<span class="builtinfunc" id="4401443">cap</span><span class="op" id="4401446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4401450">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4401454">d</span><span class="op" id="4401455">.</span><span class="ident" id="4401456">t</span>&nbsp;<span class="op" id="4401458">=</span>&nbsp;<span class="ident" id="4401460">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4401464">t</span>&nbsp;<span class="op" id="4401466">=</span>&nbsp;<span class="ident" id="4401468">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4401473">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4401476">return</span>&nbsp;<span class="ident" id="4401483">t</span><br>
<span class="lineno"></span><span class="op" id="4401485">}</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span><span class="comment" id="4401488">//&nbsp;onepass&nbsp;runs&nbsp;the&nbsp;machine&nbsp;over&nbsp;the&nbsp;input&nbsp;starting&nbsp;at&nbsp;pos.</span><br>
<span class="lineno"></span><span class="comment" id="4401548">//&nbsp;It&nbsp;reports&nbsp;whether&nbsp;a&nbsp;match&nbsp;was&nbsp;found.</span><br>
<span class="lineno"></span><span class="comment" id="4401589">//&nbsp;If&nbsp;so,&nbsp;m.matchcap&nbsp;holds&nbsp;the&nbsp;submatch&nbsp;information.</span><br>
<span class="lineno"></span><span class="keyword" id="4401642">func</span>&nbsp;<span class="op" id="4401647">(</span><span class="ident" id="4401648">m</span>&nbsp;<span class="op" id="4401650">*</span><span class="ident" id="4401651">machine</span><span class="op" id="4401658">)</span>&nbsp;<span class="ident" id="4401660">onepass</span><span class="op" id="4401667">(</span><span class="ident" id="4401668">i</span>&nbsp;<span class="ident" id="4401670">input</span><span class="op" id="4401675">,</span>&nbsp;<span class="ident" id="4401677">pos</span>&nbsp;<span class="builtintype" id="4401681">int</span><span class="op" id="4401684">)</span>&nbsp;<span class="builtintype" id="4401686">bool</span>&nbsp;<span class="op" id="4401691">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4401694">startCond</span>&nbsp;<span class="op" id="4401704">:=</span>&nbsp;<span class="ident" id="4401707">m</span><span class="op" id="4401708">.</span><span class="ident" id="4401709">re</span><span class="op" id="4401711">.</span><span class="ident" id="4401712">cond</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4401718">if</span>&nbsp;<span class="ident" id="4401721">startCond</span>&nbsp;<span class="op" id="4401731">==</span>&nbsp;<span class="op" id="4401734">^</span><span class="ident" id="4401735">syntax</span><span class="op" id="4401741">.</span><span class="ident" id="4401742">EmptyOp</span><span class="op" id="4401749">(</span><span class="num" id="4401750">0</span><span class="op" id="4401751">)</span>&nbsp;<span class="op" id="4401753">{</span>&nbsp;<span class="comment" id="4401755">//&nbsp;impossible</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4401771">return</span>&nbsp;<span class="builtintype" id="4401778">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4401785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4401788">m</span><span class="op" id="4401789">.</span><span class="ident" id="4401790">matched</span>&nbsp;<span class="op" id="4401798">=</span>&nbsp;<span class="builtintype" id="4401800">false</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4401807">for</span>&nbsp;<span class="ident" id="4401811">i</span>&nbsp;<span class="op" id="4401813">:=</span>&nbsp;<span class="keyword" id="4401816">range</span>&nbsp;<span class="ident" id="4401822">m</span><span class="op" id="4401823">.</span><span class="ident" id="4401824">matchcap</span>&nbsp;<span class="op" id="4401833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4401837">m</span><span class="op" id="4401838">.</span><span class="ident" id="4401839">matchcap</span><span class="op" id="4401847">[</span><span class="ident" id="4401848">i</span><span class="op" id="4401849">]</span>&nbsp;<span class="op" id="4401851">=</span>&nbsp;<span class="op" id="4401853">-</span><span class="num" id="4401854">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4401857">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4401860">r</span><span class="op" id="4401861">,</span>&nbsp;<span class="ident" id="4401863">r1</span>&nbsp;<span class="op" id="4401866">:=</span>&nbsp;<span class="ident" id="4401869">endOfText</span><span class="op" id="4401878">,</span>&nbsp;<span class="ident" id="4401880">endOfText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4401891">width</span><span class="op" id="4401896">,</span>&nbsp;<span class="ident" id="4401898">width1</span>&nbsp;<span class="op" id="4401905">:=</span>&nbsp;<span class="num" id="4401908">0</span><span class="op" id="4401909">,</span>&nbsp;<span class="num" id="4401911">0</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4401914">r</span><span class="op" id="4401915">,</span>&nbsp;<span class="ident" id="4401917">width</span>&nbsp;<span class="op" id="4401923">=</span>&nbsp;<span class="ident" id="4401925">i</span><span class="op" id="4401926">.</span><span class="ident" id="4401927">step</span><span class="op" id="4401931">(</span><span class="ident" id="4401932">pos</span><span class="op" id="4401935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4401938">if</span>&nbsp;<span class="ident" id="4401941">r</span>&nbsp;<span class="op" id="4401943">!=</span>&nbsp;<span class="ident" id="4401946">endOfText</span>&nbsp;<span class="op" id="4401956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4401960">r1</span><span class="op" id="4401962">,</span>&nbsp;<span class="ident" id="4401964">width1</span>&nbsp;<span class="op" id="4401971">=</span>&nbsp;<span class="ident" id="4401973">i</span><span class="op" id="4401974">.</span><span class="ident" id="4401975">step</span><span class="op" id="4401979">(</span><span class="ident" id="4401980">pos</span>&nbsp;<span class="op" id="4401984">+</span>&nbsp;<span class="ident" id="4401986">width</span><span class="op" id="4401991">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4401994">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4401997">var</span>&nbsp;<span class="ident" id="4402001">flag</span>&nbsp;<span class="ident" id="4402006">syntax</span><span class="op" id="4402012">.</span><span class="ident" id="4402013">EmptyOp</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4402022">if</span>&nbsp;<span class="ident" id="4402025">pos</span>&nbsp;<span class="op" id="4402029">==</span>&nbsp;<span class="num" id="4402032">0</span>&nbsp;<span class="op" id="4402034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4402038">flag</span>&nbsp;<span class="op" id="4402043">=</span>&nbsp;<span class="ident" id="4402045">syntax</span><span class="op" id="4402051">.</span><span class="ident" id="4402052">EmptyOpContext</span><span class="op" id="4402066">(</span><span class="op" id="4402067">-</span><span class="num" id="4402068">1</span><span class="op" id="4402069">,</span>&nbsp;<span class="ident" id="4402071">r</span><span class="op" id="4402072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4402075">}</span>&nbsp;<span class="keyword" id="4402077">else</span>&nbsp;<span class="op" id="4402082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4402086">flag</span>&nbsp;<span class="op" id="4402091">=</span>&nbsp;<span class="ident" id="4402093">i</span><span class="op" id="4402094">.</span><span class="ident" id="4402095">context</span><span class="op" id="4402102">(</span><span class="ident" id="4402103">pos</span><span class="op" id="4402106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4402109">}</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4402112">pc</span>&nbsp;<span class="op" id="4402115">:=</span>&nbsp;<span class="ident" id="4402118">m</span><span class="op" id="4402119">.</span><span class="ident" id="4402120">op</span><span class="op" id="4402122">.</span><span class="ident" id="4402123">Start</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4402130">inst</span>&nbsp;<span class="op" id="4402135">:=</span>&nbsp;<span class="ident" id="4402138">m</span><span class="op" id="4402139">.</span><span class="ident" id="4402140">op</span><span class="op" id="4402142">.</span><span class="ident" id="4402143">Inst</span><span class="op" id="4402147">[</span><span class="ident" id="4402148">pc</span><span class="op" id="4402150">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4402153">//&nbsp;If&nbsp;there&nbsp;is&nbsp;a&nbsp;simple&nbsp;literal&nbsp;prefix,&nbsp;skip&nbsp;over&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4402208">if</span>&nbsp;<span class="ident" id="4402211">pos</span>&nbsp;<span class="op" id="4402215">==</span>&nbsp;<span class="num" id="4402218">0</span>&nbsp;<span class="op" id="4402220">&amp;&amp;</span>&nbsp;<span class="ident" id="4402223">syntax</span><span class="op" id="4402229">.</span><span class="ident" id="4402230">EmptyOp</span><span class="op" id="4402237">(</span><span class="ident" id="4402238">inst</span><span class="op" id="4402242">.</span><span class="ident" id="4402243">Arg</span><span class="op" id="4402246">)</span><span class="op" id="4402247">&amp;^</span><span class="ident" id="4402249">flag</span>&nbsp;<span class="op" id="4402254">==</span>&nbsp;<span class="num" id="4402257">0</span>&nbsp;<span class="op" id="4402259">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4402264">len</span><span class="op" id="4402267">(</span><span class="ident" id="4402268">m</span><span class="op" id="4402269">.</span><span class="ident" id="4402270">re</span><span class="op" id="4402272">.</span><span class="ident" id="4402273">prefix</span><span class="op" id="4402279">)</span>&nbsp;<span class="op" id="4402281">&gt;</span>&nbsp;<span class="num" id="4402283">0</span>&nbsp;<span class="op" id="4402285">&amp;&amp;</span>&nbsp;<span class="ident" id="4402288">i</span><span class="op" id="4402289">.</span><span class="ident" id="4402290">canCheckPrefix</span><span class="op" id="4402304">(</span><span class="op" id="4402305">)</span>&nbsp;<span class="op" id="4402307">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4402311">//&nbsp;Match&nbsp;requires&nbsp;literal&nbsp;prefix;&nbsp;fast&nbsp;search&nbsp;for&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4402367">if</span>&nbsp;<span class="ident" id="4402370">i</span><span class="op" id="4402371">.</span><span class="ident" id="4402372">hasPrefix</span><span class="op" id="4402381">(</span><span class="ident" id="4402382">m</span><span class="op" id="4402383">.</span><span class="ident" id="4402384">re</span><span class="op" id="4402386">)</span>&nbsp;<span class="op" id="4402388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4402393">pos</span>&nbsp;<span class="op" id="4402397">+=</span>&nbsp;<span class="builtinfunc" id="4402400">len</span><span class="op" id="4402403">(</span><span class="ident" id="4402404">m</span><span class="op" id="4402405">.</span><span class="ident" id="4402406">re</span><span class="op" id="4402408">.</span><span class="ident" id="4402409">prefix</span><span class="op" id="4402415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4402420">r</span><span class="op" id="4402421">,</span>&nbsp;<span class="ident" id="4402423">width</span>&nbsp;<span class="op" id="4402429">=</span>&nbsp;<span class="ident" id="4402431">i</span><span class="op" id="4402432">.</span><span class="ident" id="4402433">step</span><span class="op" id="4402437">(</span><span class="ident" id="4402438">pos</span><span class="op" id="4402441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4402446">r1</span><span class="op" id="4402448">,</span>&nbsp;<span class="ident" id="4402450">width1</span>&nbsp;<span class="op" id="4402457">=</span>&nbsp;<span class="ident" id="4402459">i</span><span class="op" id="4402460">.</span><span class="ident" id="4402461">step</span><span class="op" id="4402465">(</span><span class="ident" id="4402466">pos</span>&nbsp;<span class="op" id="4402470">+</span>&nbsp;<span class="ident" id="4402472">width</span><span class="op" id="4402477">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4402482">flag</span>&nbsp;<span class="op" id="4402487">=</span>&nbsp;<span class="ident" id="4402489">i</span><span class="op" id="4402490">.</span><span class="ident" id="4402491">context</span><span class="op" id="4402498">(</span><span class="ident" id="4402499">pos</span><span class="op" id="4402502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4402507">pc</span>&nbsp;<span class="op" id="4402510">=</span>&nbsp;<span class="builtintype" id="4402512">int</span><span class="op" id="4402515">(</span><span class="ident" id="4402516">m</span><span class="op" id="4402517">.</span><span class="ident" id="4402518">re</span><span class="op" id="4402520">.</span><span class="ident" id="4402521">prefixEnd</span><span class="op" id="4402530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4402534">}</span>&nbsp;<span class="keyword" id="4402536">else</span>&nbsp;<span class="op" id="4402541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4402546">return</span>&nbsp;<span class="ident" id="4402553">m</span><span class="op" id="4402554">.</span><span class="ident" id="4402555">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4402565">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4402568">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4402571">for</span>&nbsp;<span class="op" id="4402575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4402579">inst</span>&nbsp;<span class="op" id="4402584">=</span>&nbsp;<span class="ident" id="4402586">m</span><span class="op" id="4402587">.</span><span class="ident" id="4402588">op</span><span class="op" id="4402590">.</span><span class="ident" id="4402591">Inst</span><span class="op" id="4402595">[</span><span class="ident" id="4402596">pc</span><span class="op" id="4402598">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4402602">pc</span>&nbsp;<span class="op" id="4402605">=</span>&nbsp;<span class="builtintype" id="4402607">int</span><span class="op" id="4402610">(</span><span class="ident" id="4402611">inst</span><span class="op" id="4402615">.</span><span class="ident" id="4402616">Out</span><span class="op" id="4402619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4402623">switch</span>&nbsp;<span class="ident" id="4402630">inst</span><span class="op" id="4402634">.</span><span class="ident" id="4402635">Op</span>&nbsp;<span class="op" id="4402638">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4402642">default</span><span class="op" id="4402649">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4402654">panic</span><span class="op" id="4402659">(</span><span class="string" id="4402660">&#34;bad&nbsp;inst&#34;</span><span class="op" id="4402670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4402674">case</span>&nbsp;<span class="ident" id="4402679">syntax</span><span class="op" id="4402685">.</span><span class="ident" id="4402686">InstMatch</span><span class="op" id="4402695">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4402700">m</span><span class="op" id="4402701">.</span><span class="ident" id="4402702">matched</span>&nbsp;<span class="op" id="4402710">=</span>&nbsp;<span class="builtintype" id="4402712">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4402720">if</span>&nbsp;<span class="builtinfunc" id="4402723">len</span><span class="op" id="4402726">(</span><span class="ident" id="4402727">m</span><span class="op" id="4402728">.</span><span class="ident" id="4402729">matchcap</span><span class="op" id="4402737">)</span>&nbsp;<span class="op" id="4402739">&gt;</span>&nbsp;<span class="num" id="4402741">0</span>&nbsp;<span class="op" id="4402743">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4402749">m</span><span class="op" id="4402750">.</span><span class="ident" id="4402751">matchcap</span><span class="op" id="4402759">[</span><span class="num" id="4402760">0</span><span class="op" id="4402761">]</span>&nbsp;<span class="op" id="4402763">=</span>&nbsp;<span class="num" id="4402765">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4402771">m</span><span class="op" id="4402772">.</span><span class="ident" id="4402773">matchcap</span><span class="op" id="4402781">[</span><span class="num" id="4402782">1</span><span class="op" id="4402783">]</span>&nbsp;<span class="op" id="4402785">=</span>&nbsp;<span class="ident" id="4402787">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4402794">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4402799">return</span>&nbsp;<span class="ident" id="4402806">m</span><span class="op" id="4402807">.</span><span class="ident" id="4402808">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4402818">case</span>&nbsp;<span class="ident" id="4402823">syntax</span><span class="op" id="4402829">.</span><span class="ident" id="4402830">InstRune</span><span class="op" id="4402838">:</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4402843">if</span>&nbsp;<span class="op" id="4402846">!</span><span class="ident" id="4402847">inst</span><span class="op" id="4402851">.</span><span class="ident" id="4402852">MatchRune</span><span class="op" id="4402861">(</span><span class="ident" id="4402862">r</span><span class="op" id="4402863">)</span>&nbsp;<span class="op" id="4402865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4402871">return</span>&nbsp;<span class="ident" id="4402878">m</span><span class="op" id="4402879">.</span><span class="ident" id="4402880">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4402891">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4402895">case</span>&nbsp;<span class="ident" id="4402900">syntax</span><span class="op" id="4402906">.</span><span class="ident" id="4402907">InstRune1</span><span class="op" id="4402916">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4402921">if</span>&nbsp;<span class="ident" id="4402924">r</span>&nbsp;<span class="op" id="4402926">!=</span>&nbsp;<span class="ident" id="4402929">inst</span><span class="op" id="4402933">.</span><span class="ident" id="4402934">Rune</span><span class="op" id="4402938">[</span><span class="num" id="4402939">0</span><span class="op" id="4402940">]</span>&nbsp;<span class="op" id="4402942">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4402948">return</span>&nbsp;<span class="ident" id="4402955">m</span><span class="op" id="4402956">.</span><span class="ident" id="4402957">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4402968">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4402972">case</span>&nbsp;<span class="ident" id="4402977">syntax</span><span class="op" id="4402983">.</span><span class="ident" id="4402984">InstRuneAny</span><span class="op" id="4402995">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4403000">//&nbsp;Nothing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4403013">case</span>&nbsp;<span class="ident" id="4403018">syntax</span><span class="op" id="4403024">.</span><span class="ident" id="4403025">InstRuneAnyNotNL</span><span class="op" id="4403041">:</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4403046">if</span>&nbsp;<span class="ident" id="4403049">r</span>&nbsp;<span class="op" id="4403051">==</span>&nbsp;<span class="string" id="4403054">&#39;\n&#39;</span>&nbsp;<span class="op" id="4403059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4403065">return</span>&nbsp;<span class="ident" id="4403072">m</span><span class="op" id="4403073">.</span><span class="ident" id="4403074">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4403085">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4403089">//&nbsp;peek&nbsp;at&nbsp;the&nbsp;input&nbsp;rune&nbsp;to&nbsp;see&nbsp;which&nbsp;branch&nbsp;of&nbsp;the&nbsp;Alt&nbsp;to&nbsp;take</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4403156">case</span>&nbsp;<span class="ident" id="4403161">syntax</span><span class="op" id="4403167">.</span><span class="ident" id="4403168">InstAlt</span><span class="op" id="4403175">,</span>&nbsp;<span class="ident" id="4403177">syntax</span><span class="op" id="4403183">.</span><span class="ident" id="4403184">InstAltMatch</span><span class="op" id="4403196">:</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4403201">pc</span>&nbsp;<span class="op" id="4403204">=</span>&nbsp;<span class="builtintype" id="4403206">int</span><span class="op" id="4403209">(</span><span class="ident" id="4403210">onePassNext</span><span class="op" id="4403221">(</span><span class="op" id="4403222">&amp;</span><span class="ident" id="4403223">inst</span><span class="op" id="4403227">,</span>&nbsp;<span class="ident" id="4403229">r</span><span class="op" id="4403230">)</span><span class="op" id="4403231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4403236">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4403247">case</span>&nbsp;<span class="ident" id="4403252">syntax</span><span class="op" id="4403258">.</span><span class="ident" id="4403259">InstFail</span><span class="op" id="4403267">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4403272">return</span>&nbsp;<span class="ident" id="4403279">m</span><span class="op" id="4403280">.</span><span class="ident" id="4403281">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4403291">case</span>&nbsp;<span class="ident" id="4403296">syntax</span><span class="op" id="4403302">.</span><span class="ident" id="4403303">InstNop</span><span class="op" id="4403310">:</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4403315">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4403326">case</span>&nbsp;<span class="ident" id="4403331">syntax</span><span class="op" id="4403337">.</span><span class="ident" id="4403338">InstEmptyWidth</span><span class="op" id="4403352">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4403357">if</span>&nbsp;<span class="ident" id="4403360">syntax</span><span class="op" id="4403366">.</span><span class="ident" id="4403367">EmptyOp</span><span class="op" id="4403374">(</span><span class="ident" id="4403375">inst</span><span class="op" id="4403379">.</span><span class="ident" id="4403380">Arg</span><span class="op" id="4403383">)</span><span class="op" id="4403384">&amp;^</span><span class="ident" id="4403386">flag</span>&nbsp;<span class="op" id="4403391">!=</span>&nbsp;<span class="num" id="4403394">0</span>&nbsp;<span class="op" id="4403396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4403402">return</span>&nbsp;<span class="ident" id="4403409">m</span><span class="op" id="4403410">.</span><span class="ident" id="4403411">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4403422">}</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4403427">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4403438">case</span>&nbsp;<span class="ident" id="4403443">syntax</span><span class="op" id="4403449">.</span><span class="ident" id="4403450">InstCapture</span><span class="op" id="4403461">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4403466">if</span>&nbsp;<span class="builtintype" id="4403469">int</span><span class="op" id="4403472">(</span><span class="ident" id="4403473">inst</span><span class="op" id="4403477">.</span><span class="ident" id="4403478">Arg</span><span class="op" id="4403481">)</span>&nbsp;<span class="op" id="4403483">&lt;</span>&nbsp;<span class="builtinfunc" id="4403485">len</span><span class="op" id="4403488">(</span><span class="ident" id="4403489">m</span><span class="op" id="4403490">.</span><span class="ident" id="4403491">matchcap</span><span class="op" id="4403499">)</span>&nbsp;<span class="op" id="4403501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4403507">m</span><span class="op" id="4403508">.</span><span class="ident" id="4403509">matchcap</span><span class="op" id="4403517">[</span><span class="ident" id="4403518">inst</span><span class="op" id="4403522">.</span><span class="ident" id="4403523">Arg</span><span class="op" id="4403526">]</span>&nbsp;<span class="op" id="4403528">=</span>&nbsp;<span class="ident" id="4403530">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4403537">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4403542">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4403553">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4403557">if</span>&nbsp;<span class="ident" id="4403560">width</span>&nbsp;<span class="op" id="4403566">==</span>&nbsp;<span class="num" id="4403569">0</span>&nbsp;<span class="op" id="4403571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4403576">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4403584">}</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4403588">flag</span>&nbsp;<span class="op" id="4403593">=</span>&nbsp;<span class="ident" id="4403595">syntax</span><span class="op" id="4403601">.</span><span class="ident" id="4403602">EmptyOpContext</span><span class="op" id="4403616">(</span><span class="ident" id="4403617">r</span><span class="op" id="4403618">,</span>&nbsp;<span class="ident" id="4403620">r1</span><span class="op" id="4403622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4403626">pos</span>&nbsp;<span class="op" id="4403630">+=</span>&nbsp;<span class="ident" id="4403633">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4403641">r</span><span class="op" id="4403642">,</span>&nbsp;<span class="ident" id="4403644">width</span>&nbsp;<span class="op" id="4403650">=</span>&nbsp;<span class="ident" id="4403652">r1</span><span class="op" id="4403654">,</span>&nbsp;<span class="ident" id="4403656">width1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4403665">if</span>&nbsp;<span class="ident" id="4403668">r</span>&nbsp;<span class="op" id="4403670">!=</span>&nbsp;<span class="ident" id="4403673">endOfText</span>&nbsp;<span class="op" id="4403683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4403688">r1</span><span class="op" id="4403690">,</span>&nbsp;<span class="ident" id="4403692">width1</span>&nbsp;<span class="op" id="4403699">=</span>&nbsp;<span class="ident" id="4403701">i</span><span class="op" id="4403702">.</span><span class="ident" id="4403703">step</span><span class="op" id="4403707">(</span><span class="ident" id="4403708">pos</span>&nbsp;<span class="op" id="4403712">+</span>&nbsp;<span class="ident" id="4403714">width</span><span class="op" id="4403719">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4403723">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4403726">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4403729">return</span>&nbsp;<span class="ident" id="4403736">m</span><span class="op" id="4403737">.</span><span class="ident" id="4403738">matched</span><br>
<span class="lineno"></span><span class="op" id="4403746">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span><span class="comment" id="4403749">//&nbsp;empty&nbsp;is&nbsp;a&nbsp;non-nil&nbsp;0-element&nbsp;slice,</span><br>
<span class="lineno"></span><span class="comment" id="4403788">//&nbsp;so&nbsp;doExecute&nbsp;can&nbsp;avoid&nbsp;an&nbsp;allocation</span><br>
<span class="lineno"></span><span class="comment" id="4403828">//&nbsp;when&nbsp;0&nbsp;captures&nbsp;are&nbsp;requested&nbsp;from&nbsp;a&nbsp;successful&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="4403886">var</span>&nbsp;<span class="ident" id="4403890">empty</span>&nbsp;<span class="op" id="4403896">=</span>&nbsp;<span class="builtinfunc" id="4403898">make</span><span class="op" id="4403902">(</span><span class="op" id="4403903">[</span><span class="op" id="4403904">]</span><span class="builtintype" id="4403905">int</span><span class="op" id="4403908">,</span>&nbsp;<span class="num" id="4403910">0</span><span class="op" id="4403911">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">420</span><span class="comment" id="4403914">//&nbsp;doExecute&nbsp;finds&nbsp;the&nbsp;leftmost&nbsp;match&nbsp;in&nbsp;the&nbsp;input&nbsp;and&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="4403977">//&nbsp;the&nbsp;position&nbsp;of&nbsp;its&nbsp;subexpressions.</span><br>
<span class="lineno"></span><span class="keyword" id="4404016">func</span>&nbsp;<span class="op" id="4404021">(</span><span class="ident" id="4404022">re</span>&nbsp;<span class="op" id="4404025">*</span><span class="ident" id="4404026">Regexp</span><span class="op" id="4404032">)</span>&nbsp;<span class="ident" id="4404034">doExecute</span><span class="op" id="4404043">(</span><span class="ident" id="4404044">r</span>&nbsp;<span class="ident" id="4404046">io</span><span class="op" id="4404048">.</span><span class="ident" id="4404049">RuneReader</span><span class="op" id="4404059">,</span>&nbsp;<span class="ident" id="4404061">b</span>&nbsp;<span class="op" id="4404063">[</span><span class="op" id="4404064">]</span><span class="builtintype" id="4404065">byte</span><span class="op" id="4404069">,</span>&nbsp;<span class="ident" id="4404071">s</span>&nbsp;<span class="builtintype" id="4404073">string</span><span class="op" id="4404079">,</span>&nbsp;<span class="ident" id="4404081">pos</span>&nbsp;<span class="builtintype" id="4404085">int</span><span class="op" id="4404088">,</span>&nbsp;<span class="ident" id="4404090">ncap</span>&nbsp;<span class="builtintype" id="4404095">int</span><span class="op" id="4404098">)</span>&nbsp;<span class="op" id="4404100">[</span><span class="op" id="4404101">]</span><span class="builtintype" id="4404102">int</span>&nbsp;<span class="op" id="4404106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4404109">m</span>&nbsp;<span class="op" id="4404111">:=</span>&nbsp;<span class="ident" id="4404114">re</span><span class="op" id="4404116">.</span><span class="ident" id="4404117">get</span><span class="op" id="4404120">(</span><span class="op" id="4404121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4404124">var</span>&nbsp;<span class="ident" id="4404128">i</span>&nbsp;<span class="ident" id="4404130">input</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4404137">if</span>&nbsp;<span class="ident" id="4404140">r</span>&nbsp;<span class="op" id="4404142">!=</span>&nbsp;<span class="ident" id="4404145">nil</span>&nbsp;<span class="op" id="4404149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4404153">i</span>&nbsp;<span class="op" id="4404155">=</span>&nbsp;<span class="ident" id="4404157">m</span><span class="op" id="4404158">.</span><span class="ident" id="4404159">newInputReader</span><span class="op" id="4404173">(</span><span class="ident" id="4404174">r</span><span class="op" id="4404175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4404178">}</span>&nbsp;<span class="keyword" id="4404180">else</span>&nbsp;<span class="keyword" id="4404185">if</span>&nbsp;<span class="ident" id="4404188">b</span>&nbsp;<span class="op" id="4404190">!=</span>&nbsp;<span class="ident" id="4404193">nil</span>&nbsp;<span class="op" id="4404197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4404201">i</span>&nbsp;<span class="op" id="4404203">=</span>&nbsp;<span class="ident" id="4404205">m</span><span class="op" id="4404206">.</span><span class="ident" id="4404207">newInputBytes</span><span class="op" id="4404220">(</span><span class="ident" id="4404221">b</span><span class="op" id="4404222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4404225">}</span>&nbsp;<span class="keyword" id="4404227">else</span>&nbsp;<span class="op" id="4404232">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4404236">i</span>&nbsp;<span class="op" id="4404238">=</span>&nbsp;<span class="ident" id="4404240">m</span><span class="op" id="4404241">.</span><span class="ident" id="4404242">newInputString</span><span class="op" id="4404256">(</span><span class="ident" id="4404257">s</span><span class="op" id="4404258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4404261">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4404264">if</span>&nbsp;<span class="ident" id="4404267">m</span><span class="op" id="4404268">.</span><span class="ident" id="4404269">op</span>&nbsp;<span class="op" id="4404272">!=</span>&nbsp;<span class="ident" id="4404275">notOnePass</span>&nbsp;<span class="op" id="4404286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4404290">if</span>&nbsp;<span class="op" id="4404293">!</span><span class="ident" id="4404294">m</span><span class="op" id="4404295">.</span><span class="ident" id="4404296">onepass</span><span class="op" id="4404303">(</span><span class="ident" id="4404304">i</span><span class="op" id="4404305">,</span>&nbsp;<span class="ident" id="4404307">pos</span><span class="op" id="4404310">)</span>&nbsp;<span class="op" id="4404312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4404317">re</span><span class="op" id="4404319">.</span><span class="ident" id="4404320">put</span><span class="op" id="4404323">(</span><span class="ident" id="4404324">m</span><span class="op" id="4404325">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4404330">return</span>&nbsp;<span class="ident" id="4404337">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4404343">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4404346">}</span>&nbsp;<span class="keyword" id="4404348">else</span>&nbsp;<span class="op" id="4404353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4404357">m</span><span class="op" id="4404358">.</span><span class="ident" id="4404359">init</span><span class="op" id="4404363">(</span><span class="ident" id="4404364">ncap</span><span class="op" id="4404368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4404372">if</span>&nbsp;<span class="op" id="4404375">!</span><span class="ident" id="4404376">m</span><span class="op" id="4404377">.</span><span class="ident" id="4404378">match</span><span class="op" id="4404383">(</span><span class="ident" id="4404384">i</span><span class="op" id="4404385">,</span>&nbsp;<span class="ident" id="4404387">pos</span><span class="op" id="4404390">)</span>&nbsp;<span class="op" id="4404392">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4404397">re</span><span class="op" id="4404399">.</span><span class="ident" id="4404400">put</span><span class="op" id="4404403">(</span><span class="ident" id="4404404">m</span><span class="op" id="4404405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4404410">return</span>&nbsp;<span class="ident" id="4404417">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4404423">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4404426">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4404429">if</span>&nbsp;<span class="ident" id="4404432">ncap</span>&nbsp;<span class="op" id="4404437">==</span>&nbsp;<span class="num" id="4404440">0</span>&nbsp;<span class="op" id="4404442">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4404446">re</span><span class="op" id="4404448">.</span><span class="ident" id="4404449">put</span><span class="op" id="4404452">(</span><span class="ident" id="4404453">m</span><span class="op" id="4404454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4404458">return</span>&nbsp;<span class="ident" id="4404465">empty</span>&nbsp;<span class="comment" id="4404471">//&nbsp;empty&nbsp;but&nbsp;not&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4404493">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4404496">cap</span>&nbsp;<span class="op" id="4404500">:=</span>&nbsp;<span class="builtinfunc" id="4404503">make</span><span class="op" id="4404507">(</span><span class="op" id="4404508">[</span><span class="op" id="4404509">]</span><span class="builtintype" id="4404510">int</span><span class="op" id="4404513">,</span>&nbsp;<span class="builtinfunc" id="4404515">len</span><span class="op" id="4404518">(</span><span class="ident" id="4404519">m</span><span class="op" id="4404520">.</span><span class="ident" id="4404521">matchcap</span><span class="op" id="4404529">)</span><span class="op" id="4404530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4404533">copy</span><span class="op" id="4404537">(</span><span class="builtinfunc" id="4404538">cap</span><span class="op" id="4404541">,</span>&nbsp;<span class="ident" id="4404543">m</span><span class="op" id="4404544">.</span><span class="ident" id="4404545">matchcap</span><span class="op" id="4404553">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4404556">re</span><span class="op" id="4404558">.</span><span class="ident" id="4404559">put</span><span class="op" id="4404562">(</span><span class="ident" id="4404563">m</span><span class="op" id="4404564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4404567">return</span>&nbsp;<span class="builtinfunc" id="4404574">cap</span><br>
<span class="lineno"></span><span class="op" id="4404578">}</span>
</div>
</body>
</html>
