<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/x509</h2>
<ul>
<li><a href="/gostd/crypto/x509/cert_pool.go.html">cert_pool.go</a></li>
<li><a href="/gostd/crypto/x509/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt.go.html">pem_decrypt.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt_test.go.html">pem_decrypt_test.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs1.go.html">pkcs1.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8.go.html">pkcs8.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8_test.go.html">pkcs8_test.go</a></li>
<li><a href="/gostd/crypto/x509/root.go.html">root.go</a></li>
<li><a href="/gostd/crypto/x509/root_unix.go.html" class="current">root_unix.go</a></li>
<li><a href="/gostd/crypto/x509/sec1.go.html">sec1.go</a></li>
<li><a href="/gostd/crypto/x509/sec1_test.go.html">sec1_test.go</a></li>
<li><a href="/gostd/crypto/x509/verify.go.html">verify.go</a></li>
<li><a href="/gostd/crypto/x509/verify_test.go.html">verify_test.go</a></li>
<li><a href="/gostd/crypto/x509/x509.go.html">x509.go</a></li>
<li><a href="/gostd/crypto/x509/x509_test.go.html">x509_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4361425">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4361480">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4361534">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4361585">//&nbsp;+build&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4361648">package</span>&nbsp;<span class="ident" id="4361656">x509</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4361662">import</span>&nbsp;<span class="string" id="4361669">&#34;io/ioutil&#34;</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="4361682">//&nbsp;Possible&nbsp;certificate&nbsp;files;&nbsp;stop&nbsp;after&nbsp;finding&nbsp;one.</span><br>
<span class="lineno"></span><span class="keyword" id="4361737">var</span>&nbsp;<span class="ident" id="4361741">certFiles</span>&nbsp;<span class="op" id="4361751">=</span>&nbsp;<span class="op" id="4361753">[</span><span class="op" id="4361754">]</span><span class="builtintype" id="4361755">string</span><span class="op" id="4361761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4361764">&#34;/etc/ssl/certs/ca-certificates.crt&#34;</span><span class="op" id="4361800">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4361806">//&nbsp;Debian/Ubuntu/Gentoo&nbsp;etc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4361836">&#34;/etc/pki/tls/certs/ca-bundle.crt&#34;</span><span class="op" id="4361870">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4361878">//&nbsp;Fedora/RHEL</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4361894">&#34;/etc/ssl/ca-bundle.pem&#34;</span><span class="op" id="4361918">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4361936">//&nbsp;OpenSUSE</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4361949">&#34;/etc/ssl/cert.pem&#34;</span><span class="op" id="4361968">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4361991">//&nbsp;OpenBSD</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4362003">&#34;/usr/local/share/certs/ca-root-nss.crt&#34;</span><span class="op" id="4362043">,</span>&nbsp;<span class="comment" id="4362045">//&nbsp;FreeBSD/DragonFly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4362067">&#34;/etc/pki/tls/cacert.pem&#34;</span><span class="op" id="4362092">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4362109">//&nbsp;OpenELEC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4362122">&#34;/etc/certs/ca-certificates.crt&#34;</span><span class="op" id="4362154">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4362164">//&nbsp;Solaris&nbsp;11.2+</span><br>
<span class="lineno">20</span><span class="op" id="4362181">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4362184">//&nbsp;Possible&nbsp;directories&nbsp;with&nbsp;certificate&nbsp;files;&nbsp;stop&nbsp;after&nbsp;successfully</span><br>
<span class="lineno"></span><span class="comment" id="4362256">//&nbsp;reading&nbsp;at&nbsp;least&nbsp;one&nbsp;file&nbsp;from&nbsp;a&nbsp;directory.</span><br>
<span class="lineno"></span><span class="keyword" id="4362303">var</span>&nbsp;<span class="ident" id="4362307">certDirectories</span>&nbsp;<span class="op" id="4362323">=</span>&nbsp;<span class="op" id="4362325">[</span><span class="op" id="4362326">]</span><span class="builtintype" id="4362327">string</span><span class="op" id="4362333">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4362336">&#34;/system/etc/security/cacerts&#34;</span><span class="op" id="4362366">,</span>&nbsp;<span class="comment" id="4362368">//&nbsp;Android</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="op" id="4362380">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4362383">func</span>&nbsp;<span class="op" id="4362388">(</span><span class="ident" id="4362389">c</span>&nbsp;<span class="op" id="4362391">*</span><span class="ident" id="4362392">Certificate</span><span class="op" id="4362403">)</span>&nbsp;<span class="ident" id="4362405">systemVerify</span><span class="op" id="4362417">(</span><span class="ident" id="4362418">opts</span>&nbsp;<span class="op" id="4362423">*</span><span class="ident" id="4362424">VerifyOptions</span><span class="op" id="4362437">)</span>&nbsp;<span class="op" id="4362439">(</span><span class="ident" id="4362440">chains</span>&nbsp;<span class="op" id="4362447">[</span><span class="op" id="4362448">]</span><span class="op" id="4362449">[</span><span class="op" id="4362450">]</span><span class="op" id="4362451">*</span><span class="ident" id="4362452">Certificate</span><span class="op" id="4362463">,</span>&nbsp;<span class="ident" id="4362465">err</span>&nbsp;<span class="builtintype" id="4362469">error</span><span class="op" id="4362474">)</span>&nbsp;<span class="op" id="4362476">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4362479">return</span>&nbsp;<span class="builtintype" id="4362486">nil</span><span class="op" id="4362489">,</span>&nbsp;<span class="builtintype" id="4362491">nil</span><br>
<span class="lineno"></span><span class="op" id="4362495">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4362498">func</span>&nbsp;<span class="ident" id="4362503">initSystemRoots</span><span class="op" id="4362518">(</span><span class="op" id="4362519">)</span>&nbsp;<span class="op" id="4362521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4362524">roots</span>&nbsp;<span class="op" id="4362530">:=</span>&nbsp;<span class="ident" id="4362533">NewCertPool</span><span class="op" id="4362544">(</span><span class="op" id="4362545">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4362548">for</span>&nbsp;<span class="ident" id="4362552">_</span><span class="op" id="4362553">,</span>&nbsp;<span class="ident" id="4362555">file</span>&nbsp;<span class="op" id="4362560">:=</span>&nbsp;<span class="keyword" id="4362563">range</span>&nbsp;<span class="ident" id="4362569">certFiles</span>&nbsp;<span class="op" id="4362579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4362583">data</span><span class="op" id="4362587">,</span>&nbsp;<span class="ident" id="4362589">err</span>&nbsp;<span class="op" id="4362593">:=</span>&nbsp;<span class="ident" id="4362596">ioutil</span><span class="op" id="4362602">.</span><span class="ident" id="4362603">ReadFile</span><span class="op" id="4362611">(</span><span class="ident" id="4362612">file</span><span class="op" id="4362616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4362620">if</span>&nbsp;<span class="ident" id="4362623">err</span>&nbsp;<span class="op" id="4362627">==</span>&nbsp;<span class="builtintype" id="4362630">nil</span>&nbsp;<span class="op" id="4362634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4362639">roots</span><span class="op" id="4362644">.</span><span class="ident" id="4362645">AppendCertsFromPEM</span><span class="op" id="4362663">(</span><span class="ident" id="4362664">data</span><span class="op" id="4362668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4362673">systemRoots</span>&nbsp;<span class="op" id="4362685">=</span>&nbsp;<span class="ident" id="4362687">roots</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4362696">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4362705">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4362708">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4362712">for</span>&nbsp;<span class="ident" id="4362716">_</span><span class="op" id="4362717">,</span>&nbsp;<span class="ident" id="4362719">directory</span>&nbsp;<span class="op" id="4362729">:=</span>&nbsp;<span class="keyword" id="4362732">range</span>&nbsp;<span class="ident" id="4362738">certDirectories</span>&nbsp;<span class="op" id="4362754">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4362758">fis</span><span class="op" id="4362761">,</span>&nbsp;<span class="ident" id="4362763">err</span>&nbsp;<span class="op" id="4362767">:=</span>&nbsp;<span class="ident" id="4362770">ioutil</span><span class="op" id="4362776">.</span><span class="ident" id="4362777">ReadDir</span><span class="op" id="4362784">(</span><span class="ident" id="4362785">directory</span><span class="op" id="4362794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4362798">if</span>&nbsp;<span class="ident" id="4362801">err</span>&nbsp;<span class="op" id="4362805">!=</span>&nbsp;<span class="builtintype" id="4362808">nil</span>&nbsp;<span class="op" id="4362812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4362817">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4362828">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4362832">rootsAdded</span>&nbsp;<span class="op" id="4362843">:=</span>&nbsp;<span class="builtintype" id="4362846">false</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4362854">for</span>&nbsp;<span class="ident" id="4362858">_</span><span class="op" id="4362859">,</span>&nbsp;<span class="ident" id="4362861">fi</span>&nbsp;<span class="op" id="4362864">:=</span>&nbsp;<span class="keyword" id="4362867">range</span>&nbsp;<span class="ident" id="4362873">fis</span>&nbsp;<span class="op" id="4362877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4362882">data</span><span class="op" id="4362886">,</span>&nbsp;<span class="ident" id="4362888">err</span>&nbsp;<span class="op" id="4362892">:=</span>&nbsp;<span class="ident" id="4362895">ioutil</span><span class="op" id="4362901">.</span><span class="ident" id="4362902">ReadFile</span><span class="op" id="4362910">(</span><span class="ident" id="4362911">directory</span>&nbsp;<span class="op" id="4362921">+</span>&nbsp;<span class="string" id="4362923">&#34;/&#34;</span>&nbsp;<span class="op" id="4362927">+</span>&nbsp;<span class="ident" id="4362929">fi</span><span class="op" id="4362931">.</span><span class="ident" id="4362932">Name</span><span class="op" id="4362936">(</span><span class="op" id="4362937">)</span><span class="op" id="4362938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4362943">if</span>&nbsp;<span class="ident" id="4362946">err</span>&nbsp;<span class="op" id="4362950">==</span>&nbsp;<span class="builtintype" id="4362953">nil</span>&nbsp;<span class="op" id="4362957">&amp;&amp;</span>&nbsp;<span class="ident" id="4362960">roots</span><span class="op" id="4362965">.</span><span class="ident" id="4362966">AppendCertsFromPEM</span><span class="op" id="4362984">(</span><span class="ident" id="4362985">data</span><span class="op" id="4362989">)</span>&nbsp;<span class="op" id="4362991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4362997">rootsAdded</span>&nbsp;<span class="op" id="4363008">=</span>&nbsp;<span class="builtintype" id="4363010">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4363018">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4363022">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4363026">if</span>&nbsp;<span class="ident" id="4363029">rootsAdded</span>&nbsp;<span class="op" id="4363040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4363045">systemRoots</span>&nbsp;<span class="op" id="4363057">=</span>&nbsp;<span class="ident" id="4363059">roots</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4363068">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4363077">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4363080">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4363084">//&nbsp;All&nbsp;of&nbsp;the&nbsp;files&nbsp;failed&nbsp;to&nbsp;load.&nbsp;systemRoots&nbsp;will&nbsp;be&nbsp;nil&nbsp;which&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4363156">//&nbsp;trigger&nbsp;a&nbsp;specific&nbsp;error&nbsp;at&nbsp;verification&nbsp;time.</span><br>
<span class="lineno"></span><span class="op" id="4363206">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
