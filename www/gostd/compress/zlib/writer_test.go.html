<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/zlib</h2>
<ul>
<li><a href="/gostd/compress/zlib/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/compress/zlib/reader.go.html">reader.go</a></li>
<li><a href="/gostd/compress/zlib/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/compress/zlib/writer.go.html">writer.go</a></li>
<li><a href="/gostd/compress/zlib/writer_test.go.html" class="current">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8279418">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8279473">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8279527">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8279578">package</span>&nbsp;<span class="ident" id="8279586">zlib</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8279592">import</span>&nbsp;<span class="op" id="8279599">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8279602">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8279611">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8279618">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8279624">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8279637">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8279643">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8279653">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="8279656">var</span>&nbsp;<span class="ident" id="8279660">filenames</span>&nbsp;<span class="op" id="8279670">=</span>&nbsp;<span class="op" id="8279672">[</span><span class="op" id="8279673">]</span><span class="builtintype" id="8279674">string</span><span class="op" id="8279680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8279683">&#34;../testdata/e.txt&#34;</span><span class="op" id="8279702">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8279705">&#34;../testdata/pi.txt&#34;</span><span class="op" id="8279725">,</span><br>
<span class="lineno"></span><span class="op" id="8279727">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="8279730">var</span>&nbsp;<span class="ident" id="8279734">data</span>&nbsp;<span class="op" id="8279739">=</span>&nbsp;<span class="op" id="8279741">[</span><span class="op" id="8279742">]</span><span class="builtintype" id="8279743">string</span><span class="op" id="8279749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8279752">&#34;test&nbsp;a&nbsp;reasonable&nbsp;sized&nbsp;string&nbsp;that&nbsp;can&nbsp;be&nbsp;compressed&#34;</span><span class="op" id="8279807">,</span><br>
<span class="lineno"></span><span class="op" id="8279809">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="8279812">//&nbsp;Tests&nbsp;that&nbsp;compressing&nbsp;and&nbsp;then&nbsp;decompressing&nbsp;the&nbsp;given&nbsp;file&nbsp;at&nbsp;the&nbsp;given&nbsp;compression&nbsp;level&nbsp;and&nbsp;dictionary</span><br>
<span class="lineno"></span><span class="comment" id="8279922">//&nbsp;yields&nbsp;equivalent&nbsp;bytes&nbsp;to&nbsp;the&nbsp;original&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="8279971">func</span>&nbsp;<span class="ident" id="8279976">testFileLevelDict</span><span class="op" id="8279993">(</span><span class="ident" id="8279994">t</span>&nbsp;<span class="op" id="8279996">*</span><span class="ident" id="8279997">testing</span><span class="op" id="8280004">.</span><span class="ident" id="8280005">T</span><span class="op" id="8280006">,</span>&nbsp;<span class="ident" id="8280008">fn</span>&nbsp;<span class="builtintype" id="8280011">string</span><span class="op" id="8280017">,</span>&nbsp;<span class="ident" id="8280019">level</span>&nbsp;<span class="builtintype" id="8280025">int</span><span class="op" id="8280028">,</span>&nbsp;<span class="ident" id="8280030">d</span>&nbsp;<span class="builtintype" id="8280032">string</span><span class="op" id="8280038">)</span>&nbsp;<span class="op" id="8280040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8280043">//&nbsp;Read&nbsp;the&nbsp;file,&nbsp;as&nbsp;golden&nbsp;output.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8280080">golden</span><span class="op" id="8280086">,</span>&nbsp;<span class="ident" id="8280088">err</span>&nbsp;<span class="op" id="8280092">:=</span>&nbsp;<span class="ident" id="8280095">os</span><span class="op" id="8280097">.</span><span class="ident" id="8280098">Open</span><span class="op" id="8280102">(</span><span class="ident" id="8280103">fn</span><span class="op" id="8280105">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8280108">if</span>&nbsp;<span class="ident" id="8280111">err</span>&nbsp;<span class="op" id="8280115">!=</span>&nbsp;<span class="ident" id="8280118">nil</span>&nbsp;<span class="op" id="8280122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8280126">t</span><span class="op" id="8280127">.</span><span class="ident" id="8280128">Errorf</span><span class="op" id="8280134">(</span><span class="string" id="8280135">&#34;%s&nbsp;(level=%d,&nbsp;dict=%q):&nbsp;%v&#34;</span><span class="op" id="8280163">,</span>&nbsp;<span class="ident" id="8280165">fn</span><span class="op" id="8280167">,</span>&nbsp;<span class="ident" id="8280169">level</span><span class="op" id="8280174">,</span>&nbsp;<span class="ident" id="8280176">d</span><span class="op" id="8280177">,</span>&nbsp;<span class="ident" id="8280179">err</span><span class="op" id="8280182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8280186">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8280194">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8280197">defer</span>&nbsp;<span class="ident" id="8280203">golden</span><span class="op" id="8280209">.</span><span class="ident" id="8280210">Close</span><span class="op" id="8280215">(</span><span class="op" id="8280216">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8280219">b0</span><span class="op" id="8280221">,</span>&nbsp;<span class="ident" id="8280223">err0</span>&nbsp;<span class="op" id="8280228">:=</span>&nbsp;<span class="ident" id="8280231">ioutil</span><span class="op" id="8280237">.</span><span class="ident" id="8280238">ReadAll</span><span class="op" id="8280245">(</span><span class="ident" id="8280246">golden</span><span class="op" id="8280252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8280255">if</span>&nbsp;<span class="ident" id="8280258">err0</span>&nbsp;<span class="op" id="8280263">!=</span>&nbsp;<span class="ident" id="8280266">nil</span>&nbsp;<span class="op" id="8280270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8280274">t</span><span class="op" id="8280275">.</span><span class="ident" id="8280276">Errorf</span><span class="op" id="8280282">(</span><span class="string" id="8280283">&#34;%s&nbsp;(level=%d,&nbsp;dict=%q):&nbsp;%v&#34;</span><span class="op" id="8280311">,</span>&nbsp;<span class="ident" id="8280313">fn</span><span class="op" id="8280315">,</span>&nbsp;<span class="ident" id="8280317">level</span><span class="op" id="8280322">,</span>&nbsp;<span class="ident" id="8280324">d</span><span class="op" id="8280325">,</span>&nbsp;<span class="ident" id="8280327">err0</span><span class="op" id="8280331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8280335">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8280343">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8280346">testLevelDict</span><span class="op" id="8280359">(</span><span class="ident" id="8280360">t</span><span class="op" id="8280361">,</span>&nbsp;<span class="ident" id="8280363">fn</span><span class="op" id="8280365">,</span>&nbsp;<span class="ident" id="8280367">b0</span><span class="op" id="8280369">,</span>&nbsp;<span class="ident" id="8280371">level</span><span class="op" id="8280376">,</span>&nbsp;<span class="ident" id="8280378">d</span><span class="op" id="8280379">)</span><br>
<span class="lineno"></span><span class="op" id="8280381">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8280384">func</span>&nbsp;<span class="ident" id="8280389">testLevelDict</span><span class="op" id="8280402">(</span><span class="ident" id="8280403">t</span>&nbsp;<span class="op" id="8280405">*</span><span class="ident" id="8280406">testing</span><span class="op" id="8280413">.</span><span class="ident" id="8280414">T</span><span class="op" id="8280415">,</span>&nbsp;<span class="ident" id="8280417">fn</span>&nbsp;<span class="builtintype" id="8280420">string</span><span class="op" id="8280426">,</span>&nbsp;<span class="ident" id="8280428">b0</span>&nbsp;<span class="op" id="8280431">[</span><span class="op" id="8280432">]</span><span class="builtintype" id="8280433">byte</span><span class="op" id="8280437">,</span>&nbsp;<span class="ident" id="8280439">level</span>&nbsp;<span class="builtintype" id="8280445">int</span><span class="op" id="8280448">,</span>&nbsp;<span class="ident" id="8280450">d</span>&nbsp;<span class="builtintype" id="8280452">string</span><span class="op" id="8280458">)</span>&nbsp;<span class="op" id="8280460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8280463">//&nbsp;Make&nbsp;dictionary,&nbsp;if&nbsp;given.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8280494">var</span>&nbsp;<span class="ident" id="8280498">dict</span>&nbsp;<span class="op" id="8280503">[</span><span class="op" id="8280504">]</span><span class="builtintype" id="8280505">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8280511">if</span>&nbsp;<span class="ident" id="8280514">d</span>&nbsp;<span class="op" id="8280516">!=</span>&nbsp;<span class="string" id="8280519">&#34;&#34;</span>&nbsp;<span class="op" id="8280522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8280526">dict</span>&nbsp;<span class="op" id="8280531">=</span>&nbsp;<span class="op" id="8280533">[</span><span class="op" id="8280534">]</span><span class="builtintype" id="8280535">byte</span><span class="op" id="8280539">(</span><span class="ident" id="8280540">d</span><span class="op" id="8280541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8280544">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8280548">//&nbsp;Push&nbsp;data&nbsp;through&nbsp;a&nbsp;pipe&nbsp;that&nbsp;compresses&nbsp;at&nbsp;the&nbsp;write&nbsp;end,&nbsp;and&nbsp;decompresses&nbsp;at&nbsp;the&nbsp;read&nbsp;end.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8280645">piper</span><span class="op" id="8280650">,</span>&nbsp;<span class="ident" id="8280652">pipew</span>&nbsp;<span class="op" id="8280658">:=</span>&nbsp;<span class="ident" id="8280661">io</span><span class="op" id="8280663">.</span><span class="ident" id="8280664">Pipe</span><span class="op" id="8280668">(</span><span class="op" id="8280669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8280672">defer</span>&nbsp;<span class="ident" id="8280678">piper</span><span class="op" id="8280683">.</span><span class="ident" id="8280684">Close</span><span class="op" id="8280689">(</span><span class="op" id="8280690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8280693">go</span>&nbsp;<span class="keyword" id="8280696">func</span><span class="op" id="8280700">(</span><span class="op" id="8280701">)</span>&nbsp;<span class="op" id="8280703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8280707">defer</span>&nbsp;<span class="ident" id="8280713">pipew</span><span class="op" id="8280718">.</span><span class="ident" id="8280719">Close</span><span class="op" id="8280724">(</span><span class="op" id="8280725">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8280729">zlibw</span><span class="op" id="8280734">,</span>&nbsp;<span class="ident" id="8280736">err</span>&nbsp;<span class="op" id="8280740">:=</span>&nbsp;<span class="ident" id="8280743">NewWriterLevelDict</span><span class="op" id="8280761">(</span><span class="ident" id="8280762">pipew</span><span class="op" id="8280767">,</span>&nbsp;<span class="ident" id="8280769">level</span><span class="op" id="8280774">,</span>&nbsp;<span class="ident" id="8280776">dict</span><span class="op" id="8280780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8280784">if</span>&nbsp;<span class="ident" id="8280787">err</span>&nbsp;<span class="op" id="8280791">!=</span>&nbsp;<span class="ident" id="8280794">nil</span>&nbsp;<span class="op" id="8280798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8280803">t</span><span class="op" id="8280804">.</span><span class="ident" id="8280805">Errorf</span><span class="op" id="8280811">(</span><span class="string" id="8280812">&#34;%s&nbsp;(level=%d,&nbsp;dict=%q):&nbsp;%v&#34;</span><span class="op" id="8280840">,</span>&nbsp;<span class="ident" id="8280842">fn</span><span class="op" id="8280844">,</span>&nbsp;<span class="ident" id="8280846">level</span><span class="op" id="8280851">,</span>&nbsp;<span class="ident" id="8280853">d</span><span class="op" id="8280854">,</span>&nbsp;<span class="ident" id="8280856">err</span><span class="op" id="8280859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8280864">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8280873">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8280877">defer</span>&nbsp;<span class="ident" id="8280883">zlibw</span><span class="op" id="8280888">.</span><span class="ident" id="8280889">Close</span><span class="op" id="8280894">(</span><span class="op" id="8280895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8280899">_</span><span class="op" id="8280900">,</span>&nbsp;<span class="ident" id="8280902">err</span>&nbsp;<span class="op" id="8280906">=</span>&nbsp;<span class="ident" id="8280908">zlibw</span><span class="op" id="8280913">.</span><span class="ident" id="8280914">Write</span><span class="op" id="8280919">(</span><span class="ident" id="8280920">b0</span><span class="op" id="8280922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8280926">if</span>&nbsp;<span class="ident" id="8280929">err</span>&nbsp;<span class="op" id="8280933">!=</span>&nbsp;<span class="ident" id="8280936">nil</span>&nbsp;<span class="op" id="8280940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8280945">t</span><span class="op" id="8280946">.</span><span class="ident" id="8280947">Errorf</span><span class="op" id="8280953">(</span><span class="string" id="8280954">&#34;%s&nbsp;(level=%d,&nbsp;dict=%q):&nbsp;%v&#34;</span><span class="op" id="8280982">,</span>&nbsp;<span class="ident" id="8280984">fn</span><span class="op" id="8280986">,</span>&nbsp;<span class="ident" id="8280988">level</span><span class="op" id="8280993">,</span>&nbsp;<span class="ident" id="8280995">d</span><span class="op" id="8280996">,</span>&nbsp;<span class="ident" id="8280998">err</span><span class="op" id="8281001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8281006">return</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8281015">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8281018">}</span><span class="op" id="8281019">(</span><span class="op" id="8281020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8281023">zlibr</span><span class="op" id="8281028">,</span>&nbsp;<span class="ident" id="8281030">err</span>&nbsp;<span class="op" id="8281034">:=</span>&nbsp;<span class="ident" id="8281037">NewReaderDict</span><span class="op" id="8281050">(</span><span class="ident" id="8281051">piper</span><span class="op" id="8281056">,</span>&nbsp;<span class="ident" id="8281058">dict</span><span class="op" id="8281062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8281065">if</span>&nbsp;<span class="ident" id="8281068">err</span>&nbsp;<span class="op" id="8281072">!=</span>&nbsp;<span class="ident" id="8281075">nil</span>&nbsp;<span class="op" id="8281079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8281083">t</span><span class="op" id="8281084">.</span><span class="ident" id="8281085">Errorf</span><span class="op" id="8281091">(</span><span class="string" id="8281092">&#34;%s&nbsp;(level=%d,&nbsp;dict=%q):&nbsp;%v&#34;</span><span class="op" id="8281120">,</span>&nbsp;<span class="ident" id="8281122">fn</span><span class="op" id="8281124">,</span>&nbsp;<span class="ident" id="8281126">level</span><span class="op" id="8281131">,</span>&nbsp;<span class="ident" id="8281133">d</span><span class="op" id="8281134">,</span>&nbsp;<span class="ident" id="8281136">err</span><span class="op" id="8281139">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8281143">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8281151">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8281154">defer</span>&nbsp;<span class="ident" id="8281160">zlibr</span><span class="op" id="8281165">.</span><span class="ident" id="8281166">Close</span><span class="op" id="8281171">(</span><span class="op" id="8281172">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8281176">//&nbsp;Compare&nbsp;the&nbsp;decompressed&nbsp;data.</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8281211">b1</span><span class="op" id="8281213">,</span>&nbsp;<span class="ident" id="8281215">err1</span>&nbsp;<span class="op" id="8281220">:=</span>&nbsp;<span class="ident" id="8281223">ioutil</span><span class="op" id="8281229">.</span><span class="ident" id="8281230">ReadAll</span><span class="op" id="8281237">(</span><span class="ident" id="8281238">zlibr</span><span class="op" id="8281243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8281246">if</span>&nbsp;<span class="ident" id="8281249">err1</span>&nbsp;<span class="op" id="8281254">!=</span>&nbsp;<span class="ident" id="8281257">nil</span>&nbsp;<span class="op" id="8281261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8281265">t</span><span class="op" id="8281266">.</span><span class="ident" id="8281267">Errorf</span><span class="op" id="8281273">(</span><span class="string" id="8281274">&#34;%s&nbsp;(level=%d,&nbsp;dict=%q):&nbsp;%v&#34;</span><span class="op" id="8281302">,</span>&nbsp;<span class="ident" id="8281304">fn</span><span class="op" id="8281306">,</span>&nbsp;<span class="ident" id="8281308">level</span><span class="op" id="8281313">,</span>&nbsp;<span class="ident" id="8281315">d</span><span class="op" id="8281316">,</span>&nbsp;<span class="ident" id="8281318">err1</span><span class="op" id="8281322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8281326">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8281334">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8281337">if</span>&nbsp;<span class="builtinfunc" id="8281340">len</span><span class="op" id="8281343">(</span><span class="ident" id="8281344">b0</span><span class="op" id="8281346">)</span>&nbsp;<span class="op" id="8281348">!=</span>&nbsp;<span class="builtinfunc" id="8281351">len</span><span class="op" id="8281354">(</span><span class="ident" id="8281355">b1</span><span class="op" id="8281357">)</span>&nbsp;<span class="op" id="8281359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8281363">t</span><span class="op" id="8281364">.</span><span class="ident" id="8281365">Errorf</span><span class="op" id="8281371">(</span><span class="string" id="8281372">&#34;%s&nbsp;(level=%d,&nbsp;dict=%q):&nbsp;length&nbsp;mismatch&nbsp;%d&nbsp;versus&nbsp;%d&#34;</span><span class="op" id="8281426">,</span>&nbsp;<span class="ident" id="8281428">fn</span><span class="op" id="8281430">,</span>&nbsp;<span class="ident" id="8281432">level</span><span class="op" id="8281437">,</span>&nbsp;<span class="ident" id="8281439">d</span><span class="op" id="8281440">,</span>&nbsp;<span class="builtinfunc" id="8281442">len</span><span class="op" id="8281445">(</span><span class="ident" id="8281446">b0</span><span class="op" id="8281448">)</span><span class="op" id="8281449">,</span>&nbsp;<span class="builtinfunc" id="8281451">len</span><span class="op" id="8281454">(</span><span class="ident" id="8281455">b1</span><span class="op" id="8281457">)</span><span class="op" id="8281458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8281462">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8281470">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8281473">for</span>&nbsp;<span class="ident" id="8281477">i</span>&nbsp;<span class="op" id="8281479">:=</span>&nbsp;<span class="num" id="8281482">0</span><span class="op" id="8281483">;</span>&nbsp;<span class="ident" id="8281485">i</span>&nbsp;<span class="op" id="8281487">&lt;</span>&nbsp;<span class="builtinfunc" id="8281489">len</span><span class="op" id="8281492">(</span><span class="ident" id="8281493">b0</span><span class="op" id="8281495">)</span><span class="op" id="8281496">;</span>&nbsp;<span class="ident" id="8281498">i</span><span class="op" id="8281499">++</span>&nbsp;<span class="op" id="8281502">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8281506">if</span>&nbsp;<span class="ident" id="8281509">b0</span><span class="op" id="8281511">[</span><span class="ident" id="8281512">i</span><span class="op" id="8281513">]</span>&nbsp;<span class="op" id="8281515">!=</span>&nbsp;<span class="ident" id="8281518">b1</span><span class="op" id="8281520">[</span><span class="ident" id="8281521">i</span><span class="op" id="8281522">]</span>&nbsp;<span class="op" id="8281524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8281529">t</span><span class="op" id="8281530">.</span><span class="ident" id="8281531">Errorf</span><span class="op" id="8281537">(</span><span class="string" id="8281538">&#34;%s&nbsp;(level=%d,&nbsp;dict=%q):&nbsp;mismatch&nbsp;at&nbsp;%d,&nbsp;0x%02x&nbsp;versus&nbsp;0x%02x\n&#34;</span><span class="op" id="8281602">,</span>&nbsp;<span class="ident" id="8281604">fn</span><span class="op" id="8281606">,</span>&nbsp;<span class="ident" id="8281608">level</span><span class="op" id="8281613">,</span>&nbsp;<span class="ident" id="8281615">d</span><span class="op" id="8281616">,</span>&nbsp;<span class="ident" id="8281618">i</span><span class="op" id="8281619">,</span>&nbsp;<span class="ident" id="8281621">b0</span><span class="op" id="8281623">[</span><span class="ident" id="8281624">i</span><span class="op" id="8281625">]</span><span class="op" id="8281626">,</span>&nbsp;<span class="ident" id="8281628">b1</span><span class="op" id="8281630">[</span><span class="ident" id="8281631">i</span><span class="op" id="8281632">]</span><span class="op" id="8281633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8281638">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8281647">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8281650">}</span><br>
<span class="lineno">90</span><span class="op" id="8281652">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8281655">func</span>&nbsp;<span class="ident" id="8281660">testFileLevelDictReset</span><span class="op" id="8281682">(</span><span class="ident" id="8281683">t</span>&nbsp;<span class="op" id="8281685">*</span><span class="ident" id="8281686">testing</span><span class="op" id="8281693">.</span><span class="ident" id="8281694">T</span><span class="op" id="8281695">,</span>&nbsp;<span class="ident" id="8281697">fn</span>&nbsp;<span class="builtintype" id="8281700">string</span><span class="op" id="8281706">,</span>&nbsp;<span class="ident" id="8281708">level</span>&nbsp;<span class="builtintype" id="8281714">int</span><span class="op" id="8281717">,</span>&nbsp;<span class="ident" id="8281719">dict</span>&nbsp;<span class="op" id="8281724">[</span><span class="op" id="8281725">]</span><span class="builtintype" id="8281726">byte</span><span class="op" id="8281730">)</span>&nbsp;<span class="op" id="8281732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8281735">var</span>&nbsp;<span class="ident" id="8281739">b0</span>&nbsp;<span class="op" id="8281742">[</span><span class="op" id="8281743">]</span><span class="builtintype" id="8281744">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8281750">var</span>&nbsp;<span class="ident" id="8281754">err</span>&nbsp;<span class="builtintype" id="8281758">error</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8281765">if</span>&nbsp;<span class="ident" id="8281768">fn</span>&nbsp;<span class="op" id="8281771">!=</span>&nbsp;<span class="string" id="8281774">&#34;&#34;</span>&nbsp;<span class="op" id="8281777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8281781">b0</span><span class="op" id="8281783">,</span>&nbsp;<span class="ident" id="8281785">err</span>&nbsp;<span class="op" id="8281789">=</span>&nbsp;<span class="ident" id="8281791">ioutil</span><span class="op" id="8281797">.</span><span class="ident" id="8281798">ReadFile</span><span class="op" id="8281806">(</span><span class="ident" id="8281807">fn</span><span class="op" id="8281809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8281813">if</span>&nbsp;<span class="ident" id="8281816">err</span>&nbsp;<span class="op" id="8281820">!=</span>&nbsp;<span class="ident" id="8281823">nil</span>&nbsp;<span class="op" id="8281827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8281832">t</span><span class="op" id="8281833">.</span><span class="ident" id="8281834">Errorf</span><span class="op" id="8281840">(</span><span class="string" id="8281841">&#34;%s&nbsp;(level=%d):&nbsp;%v&#34;</span><span class="op" id="8281860">,</span>&nbsp;<span class="ident" id="8281862">fn</span><span class="op" id="8281864">,</span>&nbsp;<span class="ident" id="8281866">level</span><span class="op" id="8281871">,</span>&nbsp;<span class="ident" id="8281873">err</span><span class="op" id="8281876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8281881">return</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8281890">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8281893">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8281897">//&nbsp;Compress&nbsp;once.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8281916">buf</span>&nbsp;<span class="op" id="8281920">:=</span>&nbsp;<span class="builtinfunc" id="8281923">new</span><span class="op" id="8281926">(</span><span class="ident" id="8281927">bytes</span><span class="op" id="8281932">.</span><span class="ident" id="8281933">Buffer</span><span class="op" id="8281939">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8281942">var</span>&nbsp;<span class="ident" id="8281946">zlibw</span>&nbsp;<span class="op" id="8281952">*</span><span class="ident" id="8281953">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8281961">if</span>&nbsp;<span class="ident" id="8281964">dict</span>&nbsp;<span class="op" id="8281969">==</span>&nbsp;<span class="ident" id="8281972">nil</span>&nbsp;<span class="op" id="8281976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8281980">zlibw</span><span class="op" id="8281985">,</span>&nbsp;<span class="ident" id="8281987">err</span>&nbsp;<span class="op" id="8281991">=</span>&nbsp;<span class="ident" id="8281993">NewWriterLevel</span><span class="op" id="8282007">(</span><span class="ident" id="8282008">buf</span><span class="op" id="8282011">,</span>&nbsp;<span class="ident" id="8282013">level</span><span class="op" id="8282018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8282021">}</span>&nbsp;<span class="keyword" id="8282023">else</span>&nbsp;<span class="op" id="8282028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8282032">zlibw</span><span class="op" id="8282037">,</span>&nbsp;<span class="ident" id="8282039">err</span>&nbsp;<span class="op" id="8282043">=</span>&nbsp;<span class="ident" id="8282045">NewWriterLevelDict</span><span class="op" id="8282063">(</span><span class="ident" id="8282064">buf</span><span class="op" id="8282067">,</span>&nbsp;<span class="ident" id="8282069">level</span><span class="op" id="8282074">,</span>&nbsp;<span class="ident" id="8282076">dict</span><span class="op" id="8282080">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8282083">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8282086">if</span>&nbsp;<span class="ident" id="8282089">err</span>&nbsp;<span class="op" id="8282093">==</span>&nbsp;<span class="ident" id="8282096">nil</span>&nbsp;<span class="op" id="8282100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8282104">_</span><span class="op" id="8282105">,</span>&nbsp;<span class="ident" id="8282107">err</span>&nbsp;<span class="op" id="8282111">=</span>&nbsp;<span class="ident" id="8282113">zlibw</span><span class="op" id="8282118">.</span><span class="ident" id="8282119">Write</span><span class="op" id="8282124">(</span><span class="ident" id="8282125">b0</span><span class="op" id="8282127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8282130">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8282133">if</span>&nbsp;<span class="ident" id="8282136">err</span>&nbsp;<span class="op" id="8282140">==</span>&nbsp;<span class="ident" id="8282143">nil</span>&nbsp;<span class="op" id="8282147">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8282151">err</span>&nbsp;<span class="op" id="8282155">=</span>&nbsp;<span class="ident" id="8282157">zlibw</span><span class="op" id="8282162">.</span><span class="ident" id="8282163">Close</span><span class="op" id="8282168">(</span><span class="op" id="8282169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8282172">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8282175">if</span>&nbsp;<span class="ident" id="8282178">err</span>&nbsp;<span class="op" id="8282182">!=</span>&nbsp;<span class="ident" id="8282185">nil</span>&nbsp;<span class="op" id="8282189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8282193">t</span><span class="op" id="8282194">.</span><span class="ident" id="8282195">Errorf</span><span class="op" id="8282201">(</span><span class="string" id="8282202">&#34;%s&nbsp;(level=%d):&nbsp;%v&#34;</span><span class="op" id="8282221">,</span>&nbsp;<span class="ident" id="8282223">fn</span><span class="op" id="8282225">,</span>&nbsp;<span class="ident" id="8282227">level</span><span class="op" id="8282232">,</span>&nbsp;<span class="ident" id="8282234">err</span><span class="op" id="8282237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8282241">return</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8282249">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8282252">out</span>&nbsp;<span class="op" id="8282256">:=</span>&nbsp;<span class="ident" id="8282259">buf</span><span class="op" id="8282262">.</span><span class="ident" id="8282263">String</span><span class="op" id="8282269">(</span><span class="op" id="8282270">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8282274">//&nbsp;Reset&nbsp;and&nbsp;compress&nbsp;again.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8282304">buf2</span>&nbsp;<span class="op" id="8282309">:=</span>&nbsp;<span class="builtinfunc" id="8282312">new</span><span class="op" id="8282315">(</span><span class="ident" id="8282316">bytes</span><span class="op" id="8282321">.</span><span class="ident" id="8282322">Buffer</span><span class="op" id="8282328">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8282331">zlibw</span><span class="op" id="8282336">.</span><span class="ident" id="8282337">Reset</span><span class="op" id="8282342">(</span><span class="ident" id="8282343">buf2</span><span class="op" id="8282347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8282350">_</span><span class="op" id="8282351">,</span>&nbsp;<span class="ident" id="8282353">err</span>&nbsp;<span class="op" id="8282357">=</span>&nbsp;<span class="ident" id="8282359">zlibw</span><span class="op" id="8282364">.</span><span class="ident" id="8282365">Write</span><span class="op" id="8282370">(</span><span class="ident" id="8282371">b0</span><span class="op" id="8282373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8282376">if</span>&nbsp;<span class="ident" id="8282379">err</span>&nbsp;<span class="op" id="8282383">==</span>&nbsp;<span class="ident" id="8282386">nil</span>&nbsp;<span class="op" id="8282390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8282394">err</span>&nbsp;<span class="op" id="8282398">=</span>&nbsp;<span class="ident" id="8282400">zlibw</span><span class="op" id="8282405">.</span><span class="ident" id="8282406">Close</span><span class="op" id="8282411">(</span><span class="op" id="8282412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8282415">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8282418">if</span>&nbsp;<span class="ident" id="8282421">err</span>&nbsp;<span class="op" id="8282425">!=</span>&nbsp;<span class="ident" id="8282428">nil</span>&nbsp;<span class="op" id="8282432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8282436">t</span><span class="op" id="8282437">.</span><span class="ident" id="8282438">Errorf</span><span class="op" id="8282444">(</span><span class="string" id="8282445">&#34;%s&nbsp;(level=%d):&nbsp;%v&#34;</span><span class="op" id="8282464">,</span>&nbsp;<span class="ident" id="8282466">fn</span><span class="op" id="8282468">,</span>&nbsp;<span class="ident" id="8282470">level</span><span class="op" id="8282475">,</span>&nbsp;<span class="ident" id="8282477">err</span><span class="op" id="8282480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8282484">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8282492">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8282495">out2</span>&nbsp;<span class="op" id="8282500">:=</span>&nbsp;<span class="ident" id="8282503">buf2</span><span class="op" id="8282507">.</span><span class="ident" id="8282508">String</span><span class="op" id="8282514">(</span><span class="op" id="8282515">)</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8282519">if</span>&nbsp;<span class="ident" id="8282522">out2</span>&nbsp;<span class="op" id="8282527">!=</span>&nbsp;<span class="ident" id="8282530">out</span>&nbsp;<span class="op" id="8282534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8282538">t</span><span class="op" id="8282539">.</span><span class="ident" id="8282540">Errorf</span><span class="op" id="8282546">(</span><span class="string" id="8282547">&#34;%s&nbsp;(level=%d):&nbsp;different&nbsp;output&nbsp;after&nbsp;reset&nbsp;(got&nbsp;%d&nbsp;bytes,&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="8282619">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8282624">fn</span><span class="op" id="8282626">,</span>&nbsp;<span class="ident" id="8282628">level</span><span class="op" id="8282633">,</span>&nbsp;<span class="builtinfunc" id="8282635">len</span><span class="op" id="8282638">(</span><span class="ident" id="8282639">out2</span><span class="op" id="8282643">)</span><span class="op" id="8282644">,</span>&nbsp;<span class="builtinfunc" id="8282646">len</span><span class="op" id="8282649">(</span><span class="ident" id="8282650">out</span><span class="op" id="8282653">)</span><span class="op" id="8282654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8282657">}</span><br>
<span class="lineno">140</span><span class="op" id="8282659">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8282662">func</span>&nbsp;<span class="ident" id="8282667">TestWriter</span><span class="op" id="8282677">(</span><span class="ident" id="8282678">t</span>&nbsp;<span class="op" id="8282680">*</span><span class="ident" id="8282681">testing</span><span class="op" id="8282688">.</span><span class="ident" id="8282689">T</span><span class="op" id="8282690">)</span>&nbsp;<span class="op" id="8282692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8282695">for</span>&nbsp;<span class="ident" id="8282699">i</span><span class="op" id="8282700">,</span>&nbsp;<span class="ident" id="8282702">s</span>&nbsp;<span class="op" id="8282704">:=</span>&nbsp;<span class="keyword" id="8282707">range</span>&nbsp;<span class="ident" id="8282713">data</span>&nbsp;<span class="op" id="8282718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8282722">b</span>&nbsp;<span class="op" id="8282724">:=</span>&nbsp;<span class="op" id="8282727">[</span><span class="op" id="8282728">]</span><span class="builtintype" id="8282729">byte</span><span class="op" id="8282733">(</span><span class="ident" id="8282734">s</span><span class="op" id="8282735">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8282739">tag</span>&nbsp;<span class="op" id="8282743">:=</span>&nbsp;<span class="ident" id="8282746">fmt</span><span class="op" id="8282749">.</span><span class="ident" id="8282750">Sprintf</span><span class="op" id="8282757">(</span><span class="string" id="8282758">&#34;#%d&#34;</span><span class="op" id="8282763">,</span>&nbsp;<span class="ident" id="8282765">i</span><span class="op" id="8282766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8282770">testLevelDict</span><span class="op" id="8282783">(</span><span class="ident" id="8282784">t</span><span class="op" id="8282785">,</span>&nbsp;<span class="ident" id="8282787">tag</span><span class="op" id="8282790">,</span>&nbsp;<span class="ident" id="8282792">b</span><span class="op" id="8282793">,</span>&nbsp;<span class="ident" id="8282795">DefaultCompression</span><span class="op" id="8282813">,</span>&nbsp;<span class="string" id="8282815">&#34;&#34;</span><span class="op" id="8282817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8282821">testLevelDict</span><span class="op" id="8282834">(</span><span class="ident" id="8282835">t</span><span class="op" id="8282836">,</span>&nbsp;<span class="ident" id="8282838">tag</span><span class="op" id="8282841">,</span>&nbsp;<span class="ident" id="8282843">b</span><span class="op" id="8282844">,</span>&nbsp;<span class="ident" id="8282846">NoCompression</span><span class="op" id="8282859">,</span>&nbsp;<span class="string" id="8282861">&#34;&#34;</span><span class="op" id="8282863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8282867">for</span>&nbsp;<span class="ident" id="8282871">level</span>&nbsp;<span class="op" id="8282877">:=</span>&nbsp;<span class="ident" id="8282880">BestSpeed</span><span class="op" id="8282889">;</span>&nbsp;<span class="ident" id="8282891">level</span>&nbsp;<span class="op" id="8282897">&lt;=</span>&nbsp;<span class="ident" id="8282900">BestCompression</span><span class="op" id="8282915">;</span>&nbsp;<span class="ident" id="8282917">level</span><span class="op" id="8282922">++</span>&nbsp;<span class="op" id="8282925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8282930">testLevelDict</span><span class="op" id="8282943">(</span><span class="ident" id="8282944">t</span><span class="op" id="8282945">,</span>&nbsp;<span class="ident" id="8282947">tag</span><span class="op" id="8282950">,</span>&nbsp;<span class="ident" id="8282952">b</span><span class="op" id="8282953">,</span>&nbsp;<span class="ident" id="8282955">level</span><span class="op" id="8282960">,</span>&nbsp;<span class="string" id="8282962">&#34;&#34;</span><span class="op" id="8282964">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8282968">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8282971">}</span><br>
<span class="lineno"></span><span class="op" id="8282973">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8282976">func</span>&nbsp;<span class="ident" id="8282981">TestWriterBig</span><span class="op" id="8282994">(</span><span class="ident" id="8282995">t</span>&nbsp;<span class="op" id="8282997">*</span><span class="ident" id="8282998">testing</span><span class="op" id="8283005">.</span><span class="ident" id="8283006">T</span><span class="op" id="8283007">)</span>&nbsp;<span class="op" id="8283009">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8283012">for</span>&nbsp;<span class="ident" id="8283016">_</span><span class="op" id="8283017">,</span>&nbsp;<span class="ident" id="8283019">fn</span>&nbsp;<span class="op" id="8283022">:=</span>&nbsp;<span class="keyword" id="8283025">range</span>&nbsp;<span class="ident" id="8283031">filenames</span>&nbsp;<span class="op" id="8283041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8283045">testFileLevelDict</span><span class="op" id="8283062">(</span><span class="ident" id="8283063">t</span><span class="op" id="8283064">,</span>&nbsp;<span class="ident" id="8283066">fn</span><span class="op" id="8283068">,</span>&nbsp;<span class="ident" id="8283070">DefaultCompression</span><span class="op" id="8283088">,</span>&nbsp;<span class="string" id="8283090">&#34;&#34;</span><span class="op" id="8283092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8283096">testFileLevelDict</span><span class="op" id="8283113">(</span><span class="ident" id="8283114">t</span><span class="op" id="8283115">,</span>&nbsp;<span class="ident" id="8283117">fn</span><span class="op" id="8283119">,</span>&nbsp;<span class="ident" id="8283121">NoCompression</span><span class="op" id="8283134">,</span>&nbsp;<span class="string" id="8283136">&#34;&#34;</span><span class="op" id="8283138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8283142">for</span>&nbsp;<span class="ident" id="8283146">level</span>&nbsp;<span class="op" id="8283152">:=</span>&nbsp;<span class="ident" id="8283155">BestSpeed</span><span class="op" id="8283164">;</span>&nbsp;<span class="ident" id="8283166">level</span>&nbsp;<span class="op" id="8283172">&lt;=</span>&nbsp;<span class="ident" id="8283175">BestCompression</span><span class="op" id="8283190">;</span>&nbsp;<span class="ident" id="8283192">level</span><span class="op" id="8283197">++</span>&nbsp;<span class="op" id="8283200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8283205">testFileLevelDict</span><span class="op" id="8283222">(</span><span class="ident" id="8283223">t</span><span class="op" id="8283224">,</span>&nbsp;<span class="ident" id="8283226">fn</span><span class="op" id="8283228">,</span>&nbsp;<span class="ident" id="8283230">level</span><span class="op" id="8283235">,</span>&nbsp;<span class="string" id="8283237">&#34;&#34;</span><span class="op" id="8283239">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8283243">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8283246">}</span><br>
<span class="lineno"></span><span class="op" id="8283248">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8283251">func</span>&nbsp;<span class="ident" id="8283256">TestWriterDict</span><span class="op" id="8283270">(</span><span class="ident" id="8283271">t</span>&nbsp;<span class="op" id="8283273">*</span><span class="ident" id="8283274">testing</span><span class="op" id="8283281">.</span><span class="ident" id="8283282">T</span><span class="op" id="8283283">)</span>&nbsp;<span class="op" id="8283285">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8283288">const</span>&nbsp;<span class="ident" id="8283294">dictionary</span>&nbsp;<span class="op" id="8283305">=</span>&nbsp;<span class="string" id="8283307">&#34;0123456789.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8283322">for</span>&nbsp;<span class="ident" id="8283326">_</span><span class="op" id="8283327">,</span>&nbsp;<span class="ident" id="8283329">fn</span>&nbsp;<span class="op" id="8283332">:=</span>&nbsp;<span class="keyword" id="8283335">range</span>&nbsp;<span class="ident" id="8283341">filenames</span>&nbsp;<span class="op" id="8283351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8283355">testFileLevelDict</span><span class="op" id="8283372">(</span><span class="ident" id="8283373">t</span><span class="op" id="8283374">,</span>&nbsp;<span class="ident" id="8283376">fn</span><span class="op" id="8283378">,</span>&nbsp;<span class="ident" id="8283380">DefaultCompression</span><span class="op" id="8283398">,</span>&nbsp;<span class="ident" id="8283400">dictionary</span><span class="op" id="8283410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8283414">testFileLevelDict</span><span class="op" id="8283431">(</span><span class="ident" id="8283432">t</span><span class="op" id="8283433">,</span>&nbsp;<span class="ident" id="8283435">fn</span><span class="op" id="8283437">,</span>&nbsp;<span class="ident" id="8283439">NoCompression</span><span class="op" id="8283452">,</span>&nbsp;<span class="ident" id="8283454">dictionary</span><span class="op" id="8283464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8283468">for</span>&nbsp;<span class="ident" id="8283472">level</span>&nbsp;<span class="op" id="8283478">:=</span>&nbsp;<span class="ident" id="8283481">BestSpeed</span><span class="op" id="8283490">;</span>&nbsp;<span class="ident" id="8283492">level</span>&nbsp;<span class="op" id="8283498">&lt;=</span>&nbsp;<span class="ident" id="8283501">BestCompression</span><span class="op" id="8283516">;</span>&nbsp;<span class="ident" id="8283518">level</span><span class="op" id="8283523">++</span>&nbsp;<span class="op" id="8283526">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8283531">testFileLevelDict</span><span class="op" id="8283548">(</span><span class="ident" id="8283549">t</span><span class="op" id="8283550">,</span>&nbsp;<span class="ident" id="8283552">fn</span><span class="op" id="8283554">,</span>&nbsp;<span class="ident" id="8283556">level</span><span class="op" id="8283561">,</span>&nbsp;<span class="ident" id="8283563">dictionary</span><span class="op" id="8283573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8283577">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8283580">}</span><br>
<span class="lineno"></span><span class="op" id="8283582">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="keyword" id="8283585">func</span>&nbsp;<span class="ident" id="8283590">TestWriterReset</span><span class="op" id="8283605">(</span><span class="ident" id="8283606">t</span>&nbsp;<span class="op" id="8283608">*</span><span class="ident" id="8283609">testing</span><span class="op" id="8283616">.</span><span class="ident" id="8283617">T</span><span class="op" id="8283618">)</span>&nbsp;<span class="op" id="8283620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8283623">const</span>&nbsp;<span class="ident" id="8283629">dictionary</span>&nbsp;<span class="op" id="8283640">=</span>&nbsp;<span class="string" id="8283642">&#34;0123456789.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8283657">for</span>&nbsp;<span class="ident" id="8283661">_</span><span class="op" id="8283662">,</span>&nbsp;<span class="ident" id="8283664">fn</span>&nbsp;<span class="op" id="8283667">:=</span>&nbsp;<span class="keyword" id="8283670">range</span>&nbsp;<span class="ident" id="8283676">filenames</span>&nbsp;<span class="op" id="8283686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8283690">testFileLevelDictReset</span><span class="op" id="8283712">(</span><span class="ident" id="8283713">t</span><span class="op" id="8283714">,</span>&nbsp;<span class="ident" id="8283716">fn</span><span class="op" id="8283718">,</span>&nbsp;<span class="ident" id="8283720">NoCompression</span><span class="op" id="8283733">,</span>&nbsp;<span class="ident" id="8283735">nil</span><span class="op" id="8283738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8283742">testFileLevelDictReset</span><span class="op" id="8283764">(</span><span class="ident" id="8283765">t</span><span class="op" id="8283766">,</span>&nbsp;<span class="ident" id="8283768">fn</span><span class="op" id="8283770">,</span>&nbsp;<span class="ident" id="8283772">DefaultCompression</span><span class="op" id="8283790">,</span>&nbsp;<span class="ident" id="8283792">nil</span><span class="op" id="8283795">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8283799">testFileLevelDictReset</span><span class="op" id="8283821">(</span><span class="ident" id="8283822">t</span><span class="op" id="8283823">,</span>&nbsp;<span class="ident" id="8283825">fn</span><span class="op" id="8283827">,</span>&nbsp;<span class="ident" id="8283829">NoCompression</span><span class="op" id="8283842">,</span>&nbsp;<span class="op" id="8283844">[</span><span class="op" id="8283845">]</span><span class="builtintype" id="8283846">byte</span><span class="op" id="8283850">(</span><span class="ident" id="8283851">dictionary</span><span class="op" id="8283861">)</span><span class="op" id="8283862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8283866">testFileLevelDictReset</span><span class="op" id="8283888">(</span><span class="ident" id="8283889">t</span><span class="op" id="8283890">,</span>&nbsp;<span class="ident" id="8283892">fn</span><span class="op" id="8283894">,</span>&nbsp;<span class="ident" id="8283896">DefaultCompression</span><span class="op" id="8283914">,</span>&nbsp;<span class="op" id="8283916">[</span><span class="op" id="8283917">]</span><span class="builtintype" id="8283918">byte</span><span class="op" id="8283922">(</span><span class="ident" id="8283923">dictionary</span><span class="op" id="8283933">)</span><span class="op" id="8283934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8283938">if</span>&nbsp;<span class="op" id="8283941">!</span><span class="ident" id="8283942">testing</span><span class="op" id="8283949">.</span><span class="ident" id="8283950">Short</span><span class="op" id="8283955">(</span><span class="op" id="8283956">)</span>&nbsp;<span class="op" id="8283958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8283963">for</span>&nbsp;<span class="ident" id="8283967">level</span>&nbsp;<span class="op" id="8283973">:=</span>&nbsp;<span class="ident" id="8283976">BestSpeed</span><span class="op" id="8283985">;</span>&nbsp;<span class="ident" id="8283987">level</span>&nbsp;<span class="op" id="8283993">&lt;=</span>&nbsp;<span class="ident" id="8283996">BestCompression</span><span class="op" id="8284011">;</span>&nbsp;<span class="ident" id="8284013">level</span><span class="op" id="8284018">++</span>&nbsp;<span class="op" id="8284021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8284027">testFileLevelDictReset</span><span class="op" id="8284049">(</span><span class="ident" id="8284050">t</span><span class="op" id="8284051">,</span>&nbsp;<span class="ident" id="8284053">fn</span><span class="op" id="8284055">,</span>&nbsp;<span class="ident" id="8284057">level</span><span class="op" id="8284062">,</span>&nbsp;<span class="ident" id="8284064">nil</span><span class="op" id="8284067">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8284072">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8284076">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8284079">}</span><br>
<span class="lineno"></span><span class="op" id="8284081">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="keyword" id="8284084">func</span>&nbsp;<span class="ident" id="8284089">TestWriterDictIsUsed</span><span class="op" id="8284109">(</span><span class="ident" id="8284110">t</span>&nbsp;<span class="op" id="8284112">*</span><span class="ident" id="8284113">testing</span><span class="op" id="8284120">.</span><span class="ident" id="8284121">T</span><span class="op" id="8284122">)</span>&nbsp;<span class="op" id="8284124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8284127">var</span>&nbsp;<span class="ident" id="8284131">input</span>&nbsp;<span class="op" id="8284137">=</span>&nbsp;<span class="op" id="8284139">[</span><span class="op" id="8284140">]</span><span class="builtintype" id="8284141">byte</span><span class="op" id="8284145">(</span><span class="string" id="8284146">&#34;Lorem&nbsp;ipsum&nbsp;dolor&nbsp;sit&nbsp;amet,&nbsp;consectetur&nbsp;adipisicing&nbsp;elit,&nbsp;sed&nbsp;do&nbsp;eiusmod&nbsp;tempor&nbsp;incididunt&nbsp;ut&nbsp;labore&nbsp;et&nbsp;dolore&nbsp;magna&nbsp;aliqua.&#34;</span><span class="op" id="8284272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8284275">var</span>&nbsp;<span class="ident" id="8284279">buf</span>&nbsp;<span class="ident" id="8284283">bytes</span><span class="op" id="8284288">.</span><span class="ident" id="8284289">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8284297">compressor</span><span class="op" id="8284307">,</span>&nbsp;<span class="ident" id="8284309">err</span>&nbsp;<span class="op" id="8284313">:=</span>&nbsp;<span class="ident" id="8284316">NewWriterLevelDict</span><span class="op" id="8284334">(</span><span class="op" id="8284335">&amp;</span><span class="ident" id="8284336">buf</span><span class="op" id="8284339">,</span>&nbsp;<span class="ident" id="8284341">BestCompression</span><span class="op" id="8284356">,</span>&nbsp;<span class="ident" id="8284358">input</span><span class="op" id="8284363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8284366">if</span>&nbsp;<span class="ident" id="8284369">err</span>&nbsp;<span class="op" id="8284373">!=</span>&nbsp;<span class="ident" id="8284376">nil</span>&nbsp;<span class="op" id="8284380">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8284384">t</span><span class="op" id="8284385">.</span><span class="ident" id="8284386">Errorf</span><span class="op" id="8284392">(</span><span class="string" id="8284393">&#34;error&nbsp;in&nbsp;NewWriterLevelDict:&nbsp;%s&#34;</span><span class="op" id="8284426">,</span>&nbsp;<span class="ident" id="8284428">err</span><span class="op" id="8284431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8284435">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8284443">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8284446">compressor</span><span class="op" id="8284456">.</span><span class="ident" id="8284457">Write</span><span class="op" id="8284462">(</span><span class="ident" id="8284463">input</span><span class="op" id="8284468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8284471">compressor</span><span class="op" id="8284481">.</span><span class="ident" id="8284482">Close</span><span class="op" id="8284487">(</span><span class="op" id="8284488">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8284491">const</span>&nbsp;<span class="ident" id="8284497">expectedMaxSize</span>&nbsp;<span class="op" id="8284513">=</span>&nbsp;<span class="num" id="8284515">25</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8284519">output</span>&nbsp;<span class="op" id="8284526">:=</span>&nbsp;<span class="ident" id="8284529">buf</span><span class="op" id="8284532">.</span><span class="ident" id="8284533">Bytes</span><span class="op" id="8284538">(</span><span class="op" id="8284539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8284542">if</span>&nbsp;<span class="builtinfunc" id="8284545">len</span><span class="op" id="8284548">(</span><span class="ident" id="8284549">output</span><span class="op" id="8284555">)</span>&nbsp;<span class="op" id="8284557">&gt;</span>&nbsp;<span class="ident" id="8284559">expectedMaxSize</span>&nbsp;<span class="op" id="8284575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8284579">t</span><span class="op" id="8284580">.</span><span class="ident" id="8284581">Errorf</span><span class="op" id="8284587">(</span><span class="string" id="8284588">&#34;result&nbsp;too&nbsp;large&nbsp;(got&nbsp;%d,&nbsp;want&nbsp;&lt;=&nbsp;%d&nbsp;bytes).&nbsp;Is&nbsp;the&nbsp;dictionary&nbsp;being&nbsp;used?&#34;</span><span class="op" id="8284664">,</span>&nbsp;<span class="builtinfunc" id="8284666">len</span><span class="op" id="8284669">(</span><span class="ident" id="8284670">output</span><span class="op" id="8284676">)</span><span class="op" id="8284677">,</span>&nbsp;<span class="ident" id="8284679">expectedMaxSize</span><span class="op" id="8284694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8284697">}</span><br>
<span class="lineno">205</span><span class="op" id="8284699">}</span>
</div>
</body>
</html>
