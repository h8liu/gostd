<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/flate</h2>
<ul>
<li><a href="/gostd/compress/flate/copy.go.html">copy.go</a></li>
<li><a href="/gostd/compress/flate/copy_test.go.html">copy_test.go</a></li>
<li><a href="/gostd/compress/flate/deflate.go.html">deflate.go</a></li>
<li><a href="/gostd/compress/flate/deflate_test.go.html">deflate_test.go</a></li>
<li><a href="/gostd/compress/flate/fixedhuff.go.html">fixedhuff.go</a></li>
<li><a href="/gostd/compress/flate/flate_test.go.html">flate_test.go</a></li>
<li><a href="/gostd/compress/flate/huffman_bit_writer.go.html" class="current">huffman_bit_writer.go</a></li>
<li><a href="/gostd/compress/flate/huffman_code.go.html">huffman_code.go</a></li>
<li><a href="/gostd/compress/flate/inflate.go.html">inflate.go</a></li>
<li><a href="/gostd/compress/flate/inflate_test.go.html">inflate_test.go</a></li>
<li><a href="/gostd/compress/flate/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/compress/flate/reverse_bits.go.html">reverse_bits.go</a></li>
<li><a href="/gostd/compress/flate/token.go.html">token.go</a></li>
<li><a href="/gostd/compress/flate/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4794381">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4794436">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4794490">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4794541">package</span>&nbsp;<span class="ident" id="4794549">flate</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4794556">import</span>&nbsp;<span class="op" id="4794563">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4794566">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4794572">&#34;math&#34;</span><br>
<span class="lineno">10</span><span class="op" id="4794579">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4794582">const</span>&nbsp;<span class="op" id="4794588">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4794591">//&nbsp;The&nbsp;largest&nbsp;offset&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4794620">offsetCodeCount</span>&nbsp;<span class="op" id="4794636">=</span>&nbsp;<span class="num" id="4794638">30</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4794643">//&nbsp;The&nbsp;special&nbsp;code&nbsp;used&nbsp;to&nbsp;mark&nbsp;the&nbsp;end&nbsp;of&nbsp;a&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4794697">endBlockMarker</span>&nbsp;<span class="op" id="4794712">=</span>&nbsp;<span class="num" id="4794714">256</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4794720">//&nbsp;The&nbsp;first&nbsp;length&nbsp;code.</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4794747">lengthCodesStart</span>&nbsp;<span class="op" id="4794764">=</span>&nbsp;<span class="num" id="4794766">257</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4794772">//&nbsp;The&nbsp;number&nbsp;of&nbsp;codegen&nbsp;codes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4794805">codegenCodeCount</span>&nbsp;<span class="op" id="4794822">=</span>&nbsp;<span class="num" id="4794824">19</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4794828">badCode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4794845">=</span>&nbsp;<span class="num" id="4794847">255</span><br>
<span class="lineno">25</span><span class="op" id="4794851">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4794854">//&nbsp;The&nbsp;number&nbsp;of&nbsp;extra&nbsp;bits&nbsp;needed&nbsp;by&nbsp;length&nbsp;code&nbsp;X&nbsp;-&nbsp;LENGTH_CODES_START.</span><br>
<span class="lineno"></span><span class="keyword" id="4794928">var</span>&nbsp;<span class="ident" id="4794932">lengthExtraBits</span>&nbsp;<span class="op" id="4794948">=</span>&nbsp;<span class="op" id="4794950">[</span><span class="op" id="4794951">]</span><span class="builtintype" id="4794952">int8</span><span class="op" id="4794956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4794959">/*&nbsp;257&nbsp;*/</span>&nbsp;<span class="num" id="4794969">0</span><span class="op" id="4794970">,</span>&nbsp;<span class="num" id="4794972">0</span><span class="op" id="4794973">,</span>&nbsp;<span class="num" id="4794975">0</span><span class="op" id="4794976">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4794979">/*&nbsp;260&nbsp;*/</span>&nbsp;<span class="num" id="4794989">0</span><span class="op" id="4794990">,</span>&nbsp;<span class="num" id="4794992">0</span><span class="op" id="4794993">,</span>&nbsp;<span class="num" id="4794995">0</span><span class="op" id="4794996">,</span>&nbsp;<span class="num" id="4794998">0</span><span class="op" id="4794999">,</span>&nbsp;<span class="num" id="4795001">0</span><span class="op" id="4795002">,</span>&nbsp;<span class="num" id="4795004">1</span><span class="op" id="4795005">,</span>&nbsp;<span class="num" id="4795007">1</span><span class="op" id="4795008">,</span>&nbsp;<span class="num" id="4795010">1</span><span class="op" id="4795011">,</span>&nbsp;<span class="num" id="4795013">1</span><span class="op" id="4795014">,</span>&nbsp;<span class="num" id="4795016">2</span><span class="op" id="4795017">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4795020">/*&nbsp;270&nbsp;*/</span>&nbsp;<span class="num" id="4795030">2</span><span class="op" id="4795031">,</span>&nbsp;<span class="num" id="4795033">2</span><span class="op" id="4795034">,</span>&nbsp;<span class="num" id="4795036">2</span><span class="op" id="4795037">,</span>&nbsp;<span class="num" id="4795039">3</span><span class="op" id="4795040">,</span>&nbsp;<span class="num" id="4795042">3</span><span class="op" id="4795043">,</span>&nbsp;<span class="num" id="4795045">3</span><span class="op" id="4795046">,</span>&nbsp;<span class="num" id="4795048">3</span><span class="op" id="4795049">,</span>&nbsp;<span class="num" id="4795051">4</span><span class="op" id="4795052">,</span>&nbsp;<span class="num" id="4795054">4</span><span class="op" id="4795055">,</span>&nbsp;<span class="num" id="4795057">4</span><span class="op" id="4795058">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4795061">/*&nbsp;280&nbsp;*/</span>&nbsp;<span class="num" id="4795071">4</span><span class="op" id="4795072">,</span>&nbsp;<span class="num" id="4795074">5</span><span class="op" id="4795075">,</span>&nbsp;<span class="num" id="4795077">5</span><span class="op" id="4795078">,</span>&nbsp;<span class="num" id="4795080">5</span><span class="op" id="4795081">,</span>&nbsp;<span class="num" id="4795083">5</span><span class="op" id="4795084">,</span>&nbsp;<span class="num" id="4795086">0</span><span class="op" id="4795087">,</span><br>
<span class="lineno"></span><span class="op" id="4795089">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="4795092">//&nbsp;The&nbsp;length&nbsp;indicated&nbsp;by&nbsp;length&nbsp;code&nbsp;X&nbsp;-&nbsp;LENGTH_CODES_START.</span><br>
<span class="lineno"></span><span class="keyword" id="4795155">var</span>&nbsp;<span class="ident" id="4795159">lengthBase</span>&nbsp;<span class="op" id="4795170">=</span>&nbsp;<span class="op" id="4795172">[</span><span class="op" id="4795173">]</span><span class="builtintype" id="4795174">uint32</span><span class="op" id="4795180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4795183">0</span><span class="op" id="4795184">,</span>&nbsp;<span class="num" id="4795186">1</span><span class="op" id="4795187">,</span>&nbsp;<span class="num" id="4795189">2</span><span class="op" id="4795190">,</span>&nbsp;<span class="num" id="4795192">3</span><span class="op" id="4795193">,</span>&nbsp;<span class="num" id="4795195">4</span><span class="op" id="4795196">,</span>&nbsp;<span class="num" id="4795198">5</span><span class="op" id="4795199">,</span>&nbsp;<span class="num" id="4795201">6</span><span class="op" id="4795202">,</span>&nbsp;<span class="num" id="4795204">7</span><span class="op" id="4795205">,</span>&nbsp;<span class="num" id="4795207">8</span><span class="op" id="4795208">,</span>&nbsp;<span class="num" id="4795210">10</span><span class="op" id="4795212">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4795215">12</span><span class="op" id="4795217">,</span>&nbsp;<span class="num" id="4795219">14</span><span class="op" id="4795221">,</span>&nbsp;<span class="num" id="4795223">16</span><span class="op" id="4795225">,</span>&nbsp;<span class="num" id="4795227">20</span><span class="op" id="4795229">,</span>&nbsp;<span class="num" id="4795231">24</span><span class="op" id="4795233">,</span>&nbsp;<span class="num" id="4795235">28</span><span class="op" id="4795237">,</span>&nbsp;<span class="num" id="4795239">32</span><span class="op" id="4795241">,</span>&nbsp;<span class="num" id="4795243">40</span><span class="op" id="4795245">,</span>&nbsp;<span class="num" id="4795247">48</span><span class="op" id="4795249">,</span>&nbsp;<span class="num" id="4795251">56</span><span class="op" id="4795253">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4795256">64</span><span class="op" id="4795258">,</span>&nbsp;<span class="num" id="4795260">80</span><span class="op" id="4795262">,</span>&nbsp;<span class="num" id="4795264">96</span><span class="op" id="4795266">,</span>&nbsp;<span class="num" id="4795268">112</span><span class="op" id="4795271">,</span>&nbsp;<span class="num" id="4795273">128</span><span class="op" id="4795276">,</span>&nbsp;<span class="num" id="4795278">160</span><span class="op" id="4795281">,</span>&nbsp;<span class="num" id="4795283">192</span><span class="op" id="4795286">,</span>&nbsp;<span class="num" id="4795288">224</span><span class="op" id="4795291">,</span>&nbsp;<span class="num" id="4795293">255</span><span class="op" id="4795296">,</span><br>
<span class="lineno">40</span><span class="op" id="4795298">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4795301">//&nbsp;offset&nbsp;code&nbsp;word&nbsp;extra&nbsp;bits.</span><br>
<span class="lineno"></span><span class="keyword" id="4795333">var</span>&nbsp;<span class="ident" id="4795337">offsetExtraBits</span>&nbsp;<span class="op" id="4795353">=</span>&nbsp;<span class="op" id="4795355">[</span><span class="op" id="4795356">]</span><span class="builtintype" id="4795357">int8</span><span class="op" id="4795361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4795364">0</span><span class="op" id="4795365">,</span>&nbsp;<span class="num" id="4795367">0</span><span class="op" id="4795368">,</span>&nbsp;<span class="num" id="4795370">0</span><span class="op" id="4795371">,</span>&nbsp;<span class="num" id="4795373">0</span><span class="op" id="4795374">,</span>&nbsp;<span class="num" id="4795376">1</span><span class="op" id="4795377">,</span>&nbsp;<span class="num" id="4795379">1</span><span class="op" id="4795380">,</span>&nbsp;<span class="num" id="4795382">2</span><span class="op" id="4795383">,</span>&nbsp;<span class="num" id="4795385">2</span><span class="op" id="4795386">,</span>&nbsp;<span class="num" id="4795388">3</span><span class="op" id="4795389">,</span>&nbsp;<span class="num" id="4795391">3</span><span class="op" id="4795392">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4795395">4</span><span class="op" id="4795396">,</span>&nbsp;<span class="num" id="4795398">4</span><span class="op" id="4795399">,</span>&nbsp;<span class="num" id="4795401">5</span><span class="op" id="4795402">,</span>&nbsp;<span class="num" id="4795404">5</span><span class="op" id="4795405">,</span>&nbsp;<span class="num" id="4795407">6</span><span class="op" id="4795408">,</span>&nbsp;<span class="num" id="4795410">6</span><span class="op" id="4795411">,</span>&nbsp;<span class="num" id="4795413">7</span><span class="op" id="4795414">,</span>&nbsp;<span class="num" id="4795416">7</span><span class="op" id="4795417">,</span>&nbsp;<span class="num" id="4795419">8</span><span class="op" id="4795420">,</span>&nbsp;<span class="num" id="4795422">8</span><span class="op" id="4795423">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4795426">9</span><span class="op" id="4795427">,</span>&nbsp;<span class="num" id="4795429">9</span><span class="op" id="4795430">,</span>&nbsp;<span class="num" id="4795432">10</span><span class="op" id="4795434">,</span>&nbsp;<span class="num" id="4795436">10</span><span class="op" id="4795438">,</span>&nbsp;<span class="num" id="4795440">11</span><span class="op" id="4795442">,</span>&nbsp;<span class="num" id="4795444">11</span><span class="op" id="4795446">,</span>&nbsp;<span class="num" id="4795448">12</span><span class="op" id="4795450">,</span>&nbsp;<span class="num" id="4795452">12</span><span class="op" id="4795454">,</span>&nbsp;<span class="num" id="4795456">13</span><span class="op" id="4795458">,</span>&nbsp;<span class="num" id="4795460">13</span><span class="op" id="4795462">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4795465">/*&nbsp;extended&nbsp;window&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4795488">14</span><span class="op" id="4795490">,</span>&nbsp;<span class="num" id="4795492">14</span><span class="op" id="4795494">,</span>&nbsp;<span class="num" id="4795496">15</span><span class="op" id="4795498">,</span>&nbsp;<span class="num" id="4795500">15</span><span class="op" id="4795502">,</span>&nbsp;<span class="num" id="4795504">16</span><span class="op" id="4795506">,</span>&nbsp;<span class="num" id="4795508">16</span><span class="op" id="4795510">,</span>&nbsp;<span class="num" id="4795512">17</span><span class="op" id="4795514">,</span>&nbsp;<span class="num" id="4795516">17</span><span class="op" id="4795518">,</span>&nbsp;<span class="num" id="4795520">18</span><span class="op" id="4795522">,</span>&nbsp;<span class="num" id="4795524">18</span><span class="op" id="4795526">,</span>&nbsp;<span class="num" id="4795528">19</span><span class="op" id="4795530">,</span>&nbsp;<span class="num" id="4795532">19</span><span class="op" id="4795534">,</span>&nbsp;<span class="num" id="4795536">20</span><span class="op" id="4795538">,</span>&nbsp;<span class="num" id="4795540">20</span><span class="op" id="4795542">,</span><br>
<span class="lineno"></span><span class="op" id="4795544">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="4795547">var</span>&nbsp;<span class="ident" id="4795551">offsetBase</span>&nbsp;<span class="op" id="4795562">=</span>&nbsp;<span class="op" id="4795564">[</span><span class="op" id="4795565">]</span><span class="builtintype" id="4795566">uint32</span><span class="op" id="4795572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4795575">/*&nbsp;normal&nbsp;deflate&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4795597">0x000000</span><span class="op" id="4795605">,</span>&nbsp;<span class="num" id="4795607">0x000001</span><span class="op" id="4795615">,</span>&nbsp;<span class="num" id="4795617">0x000002</span><span class="op" id="4795625">,</span>&nbsp;<span class="num" id="4795627">0x000003</span><span class="op" id="4795635">,</span>&nbsp;<span class="num" id="4795637">0x000004</span><span class="op" id="4795645">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4795648">0x000006</span><span class="op" id="4795656">,</span>&nbsp;<span class="num" id="4795658">0x000008</span><span class="op" id="4795666">,</span>&nbsp;<span class="num" id="4795668">0x00000c</span><span class="op" id="4795676">,</span>&nbsp;<span class="num" id="4795678">0x000010</span><span class="op" id="4795686">,</span>&nbsp;<span class="num" id="4795688">0x000018</span><span class="op" id="4795696">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4795699">0x000020</span><span class="op" id="4795707">,</span>&nbsp;<span class="num" id="4795709">0x000030</span><span class="op" id="4795717">,</span>&nbsp;<span class="num" id="4795719">0x000040</span><span class="op" id="4795727">,</span>&nbsp;<span class="num" id="4795729">0x000060</span><span class="op" id="4795737">,</span>&nbsp;<span class="num" id="4795739">0x000080</span><span class="op" id="4795747">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4795750">0x0000c0</span><span class="op" id="4795758">,</span>&nbsp;<span class="num" id="4795760">0x000100</span><span class="op" id="4795768">,</span>&nbsp;<span class="num" id="4795770">0x000180</span><span class="op" id="4795778">,</span>&nbsp;<span class="num" id="4795780">0x000200</span><span class="op" id="4795788">,</span>&nbsp;<span class="num" id="4795790">0x000300</span><span class="op" id="4795798">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4795801">0x000400</span><span class="op" id="4795809">,</span>&nbsp;<span class="num" id="4795811">0x000600</span><span class="op" id="4795819">,</span>&nbsp;<span class="num" id="4795821">0x000800</span><span class="op" id="4795829">,</span>&nbsp;<span class="num" id="4795831">0x000c00</span><span class="op" id="4795839">,</span>&nbsp;<span class="num" id="4795841">0x001000</span><span class="op" id="4795849">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4795852">0x001800</span><span class="op" id="4795860">,</span>&nbsp;<span class="num" id="4795862">0x002000</span><span class="op" id="4795870">,</span>&nbsp;<span class="num" id="4795872">0x003000</span><span class="op" id="4795880">,</span>&nbsp;<span class="num" id="4795882">0x004000</span><span class="op" id="4795890">,</span>&nbsp;<span class="num" id="4795892">0x006000</span><span class="op" id="4795900">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4795904">/*&nbsp;extended&nbsp;window&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4795927">0x008000</span><span class="op" id="4795935">,</span>&nbsp;<span class="num" id="4795937">0x00c000</span><span class="op" id="4795945">,</span>&nbsp;<span class="num" id="4795947">0x010000</span><span class="op" id="4795955">,</span>&nbsp;<span class="num" id="4795957">0x018000</span><span class="op" id="4795965">,</span>&nbsp;<span class="num" id="4795967">0x020000</span><span class="op" id="4795975">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4795978">0x030000</span><span class="op" id="4795986">,</span>&nbsp;<span class="num" id="4795988">0x040000</span><span class="op" id="4795996">,</span>&nbsp;<span class="num" id="4795998">0x060000</span><span class="op" id="4796006">,</span>&nbsp;<span class="num" id="4796008">0x080000</span><span class="op" id="4796016">,</span>&nbsp;<span class="num" id="4796018">0x0c0000</span><span class="op" id="4796026">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4796029">0x100000</span><span class="op" id="4796037">,</span>&nbsp;<span class="num" id="4796039">0x180000</span><span class="op" id="4796047">,</span>&nbsp;<span class="num" id="4796049">0x200000</span><span class="op" id="4796057">,</span>&nbsp;<span class="num" id="4796059">0x300000</span><span class="op" id="4796067">,</span><br>
<span class="lineno"></span><span class="op" id="4796069">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="comment" id="4796072">//&nbsp;The&nbsp;odd&nbsp;order&nbsp;in&nbsp;which&nbsp;the&nbsp;codegen&nbsp;code&nbsp;sizes&nbsp;are&nbsp;written.</span><br>
<span class="lineno"></span><span class="keyword" id="4796134">var</span>&nbsp;<span class="ident" id="4796138">codegenOrder</span>&nbsp;<span class="op" id="4796151">=</span>&nbsp;<span class="op" id="4796153">[</span><span class="op" id="4796154">]</span><span class="builtintype" id="4796155">uint32</span><span class="op" id="4796161">{</span><span class="num" id="4796162">16</span><span class="op" id="4796164">,</span>&nbsp;<span class="num" id="4796166">17</span><span class="op" id="4796168">,</span>&nbsp;<span class="num" id="4796170">18</span><span class="op" id="4796172">,</span>&nbsp;<span class="num" id="4796174">0</span><span class="op" id="4796175">,</span>&nbsp;<span class="num" id="4796177">8</span><span class="op" id="4796178">,</span>&nbsp;<span class="num" id="4796180">7</span><span class="op" id="4796181">,</span>&nbsp;<span class="num" id="4796183">9</span><span class="op" id="4796184">,</span>&nbsp;<span class="num" id="4796186">6</span><span class="op" id="4796187">,</span>&nbsp;<span class="num" id="4796189">10</span><span class="op" id="4796191">,</span>&nbsp;<span class="num" id="4796193">5</span><span class="op" id="4796194">,</span>&nbsp;<span class="num" id="4796196">11</span><span class="op" id="4796198">,</span>&nbsp;<span class="num" id="4796200">4</span><span class="op" id="4796201">,</span>&nbsp;<span class="num" id="4796203">12</span><span class="op" id="4796205">,</span>&nbsp;<span class="num" id="4796207">3</span><span class="op" id="4796208">,</span>&nbsp;<span class="num" id="4796210">13</span><span class="op" id="4796212">,</span>&nbsp;<span class="num" id="4796214">2</span><span class="op" id="4796215">,</span>&nbsp;<span class="num" id="4796217">14</span><span class="op" id="4796219">,</span>&nbsp;<span class="num" id="4796221">1</span><span class="op" id="4796222">,</span>&nbsp;<span class="num" id="4796224">15</span><span class="op" id="4796226">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4796229">type</span>&nbsp;<span class="ident" id="4796234">huffmanBitWriter</span>&nbsp;<span class="keyword" id="4796251">struct</span>&nbsp;<span class="op" id="4796258">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4796261">w</span>&nbsp;<span class="ident" id="4796263">io</span><span class="op" id="4796265">.</span><span class="ident" id="4796266">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4796274">//&nbsp;Data&nbsp;waiting&nbsp;to&nbsp;be&nbsp;written&nbsp;is&nbsp;bytes[0:nbytes]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4796324">//&nbsp;and&nbsp;then&nbsp;the&nbsp;low&nbsp;nbits&nbsp;of&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4796360">bits</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4796376">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4796384">nbits</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4796400">uint32</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4796408">bytes</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4796424">[</span><span class="num" id="4796425">64</span><span class="op" id="4796427">]</span><span class="builtintype" id="4796428">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4796434">nbytes</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4796450">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4796455">literalFreq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4796471">[</span><span class="op" id="4796472">]</span><span class="builtintype" id="4796473">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4796480">offsetFreq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4796496">[</span><span class="op" id="4796497">]</span><span class="builtintype" id="4796498">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4796505">codegen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4796521">[</span><span class="op" id="4796522">]</span><span class="builtintype" id="4796523">uint8</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4796530">codegenFreq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4796546">[</span><span class="op" id="4796547">]</span><span class="builtintype" id="4796548">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4796555">literalEncoding</span>&nbsp;<span class="op" id="4796571">*</span><span class="ident" id="4796572">huffmanEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4796588">offsetEncoding</span>&nbsp;&nbsp;<span class="op" id="4796604">*</span><span class="ident" id="4796605">huffmanEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4796621">codegenEncoding</span>&nbsp;<span class="op" id="4796637">*</span><span class="ident" id="4796638">huffmanEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4796654">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4796670">error</span><br>
<span class="lineno">85</span><span class="op" id="4796676">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4796679">func</span>&nbsp;<span class="ident" id="4796684">newHuffmanBitWriter</span><span class="op" id="4796703">(</span><span class="ident" id="4796704">w</span>&nbsp;<span class="ident" id="4796706">io</span><span class="op" id="4796708">.</span><span class="ident" id="4796709">Writer</span><span class="op" id="4796715">)</span>&nbsp;<span class="op" id="4796717">*</span><span class="ident" id="4796718">huffmanBitWriter</span>&nbsp;<span class="op" id="4796735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4796738">return</span>&nbsp;<span class="op" id="4796745">&amp;</span><span class="ident" id="4796746">huffmanBitWriter</span><span class="op" id="4796762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4796766">w</span><span class="op" id="4796767">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4796783">w</span><span class="op" id="4796784">,</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4796788">literalFreq</span><span class="op" id="4796799">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4796805">make</span><span class="op" id="4796809">(</span><span class="op" id="4796810">[</span><span class="op" id="4796811">]</span><span class="builtintype" id="4796812">int32</span><span class="op" id="4796817">,</span>&nbsp;<span class="ident" id="4796819">maxLit</span><span class="op" id="4796825">)</span><span class="op" id="4796826">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4796830">offsetFreq</span><span class="op" id="4796840">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4796847">make</span><span class="op" id="4796851">(</span><span class="op" id="4796852">[</span><span class="op" id="4796853">]</span><span class="builtintype" id="4796854">int32</span><span class="op" id="4796859">,</span>&nbsp;<span class="ident" id="4796861">offsetCodeCount</span><span class="op" id="4796876">)</span><span class="op" id="4796877">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4796881">codegen</span><span class="op" id="4796888">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4796898">make</span><span class="op" id="4796902">(</span><span class="op" id="4796903">[</span><span class="op" id="4796904">]</span><span class="builtintype" id="4796905">uint8</span><span class="op" id="4796910">,</span>&nbsp;<span class="ident" id="4796912">maxLit</span><span class="op" id="4796918">+</span><span class="ident" id="4796919">offsetCodeCount</span><span class="op" id="4796934">+</span><span class="num" id="4796935">1</span><span class="op" id="4796936">)</span><span class="op" id="4796937">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4796941">codegenFreq</span><span class="op" id="4796952">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4796958">make</span><span class="op" id="4796962">(</span><span class="op" id="4796963">[</span><span class="op" id="4796964">]</span><span class="builtintype" id="4796965">int32</span><span class="op" id="4796970">,</span>&nbsp;<span class="ident" id="4796972">codegenCodeCount</span><span class="op" id="4796988">)</span><span class="op" id="4796989">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4796993">literalEncoding</span><span class="op" id="4797008">:</span>&nbsp;<span class="ident" id="4797010">newHuffmanEncoder</span><span class="op" id="4797027">(</span><span class="ident" id="4797028">maxLit</span><span class="op" id="4797034">)</span><span class="op" id="4797035">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4797039">offsetEncoding</span><span class="op" id="4797053">:</span>&nbsp;&nbsp;<span class="ident" id="4797056">newHuffmanEncoder</span><span class="op" id="4797073">(</span><span class="ident" id="4797074">offsetCodeCount</span><span class="op" id="4797089">)</span><span class="op" id="4797090">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4797094">codegenEncoding</span><span class="op" id="4797109">:</span>&nbsp;<span class="ident" id="4797111">newHuffmanEncoder</span><span class="op" id="4797128">(</span><span class="ident" id="4797129">codegenCodeCount</span><span class="op" id="4797145">)</span><span class="op" id="4797146">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4797149">}</span><br>
<span class="lineno"></span><span class="op" id="4797151">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="keyword" id="4797154">func</span>&nbsp;<span class="op" id="4797159">(</span><span class="ident" id="4797160">w</span>&nbsp;<span class="op" id="4797162">*</span><span class="ident" id="4797163">huffmanBitWriter</span><span class="op" id="4797179">)</span>&nbsp;<span class="ident" id="4797181">reset</span><span class="op" id="4797186">(</span><span class="ident" id="4797187">writer</span>&nbsp;<span class="ident" id="4797194">io</span><span class="op" id="4797196">.</span><span class="ident" id="4797197">Writer</span><span class="op" id="4797203">)</span>&nbsp;<span class="op" id="4797205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4797208">w</span><span class="op" id="4797209">.</span><span class="ident" id="4797210">w</span>&nbsp;<span class="op" id="4797212">=</span>&nbsp;<span class="ident" id="4797214">writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4797222">w</span><span class="op" id="4797223">.</span><span class="ident" id="4797224">bits</span><span class="op" id="4797228">,</span>&nbsp;<span class="ident" id="4797230">w</span><span class="op" id="4797231">.</span><span class="ident" id="4797232">nbits</span><span class="op" id="4797237">,</span>&nbsp;<span class="ident" id="4797239">w</span><span class="op" id="4797240">.</span><span class="ident" id="4797241">nbytes</span><span class="op" id="4797247">,</span>&nbsp;<span class="ident" id="4797249">w</span><span class="op" id="4797250">.</span><span class="ident" id="4797251">err</span>&nbsp;<span class="op" id="4797255">=</span>&nbsp;<span class="num" id="4797257">0</span><span class="op" id="4797258">,</span>&nbsp;<span class="num" id="4797260">0</span><span class="op" id="4797261">,</span>&nbsp;<span class="num" id="4797263">0</span><span class="op" id="4797264">,</span>&nbsp;<span class="builtintype" id="4797266">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4797271">w</span><span class="op" id="4797272">.</span><span class="ident" id="4797273">bytes</span>&nbsp;<span class="op" id="4797279">=</span>&nbsp;<span class="op" id="4797281">[</span><span class="num" id="4797282">64</span><span class="op" id="4797284">]</span><span class="builtintype" id="4797285">byte</span><span class="op" id="4797289">{</span><span class="op" id="4797290">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4797293">for</span>&nbsp;<span class="ident" id="4797297">i</span>&nbsp;<span class="op" id="4797299">:=</span>&nbsp;<span class="keyword" id="4797302">range</span>&nbsp;<span class="ident" id="4797308">w</span><span class="op" id="4797309">.</span><span class="ident" id="4797310">codegen</span>&nbsp;<span class="op" id="4797318">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4797322">w</span><span class="op" id="4797323">.</span><span class="ident" id="4797324">codegen</span><span class="op" id="4797331">[</span><span class="ident" id="4797332">i</span><span class="op" id="4797333">]</span>&nbsp;<span class="op" id="4797335">=</span>&nbsp;<span class="num" id="4797337">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4797340">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4797343">for</span>&nbsp;<span class="ident" id="4797347">_</span><span class="op" id="4797348">,</span>&nbsp;<span class="ident" id="4797350">s</span>&nbsp;<span class="op" id="4797352">:=</span>&nbsp;<span class="keyword" id="4797355">range</span>&nbsp;<span class="op" id="4797361">[</span><span class="op" id="4797362">...</span><span class="op" id="4797365">]</span><span class="op" id="4797366">[</span><span class="op" id="4797367">]</span><span class="builtintype" id="4797368">int32</span><span class="op" id="4797373">{</span><span class="ident" id="4797374">w</span><span class="op" id="4797375">.</span><span class="ident" id="4797376">literalFreq</span><span class="op" id="4797387">,</span>&nbsp;<span class="ident" id="4797389">w</span><span class="op" id="4797390">.</span><span class="ident" id="4797391">offsetFreq</span><span class="op" id="4797401">,</span>&nbsp;<span class="ident" id="4797403">w</span><span class="op" id="4797404">.</span><span class="ident" id="4797405">codegenFreq</span><span class="op" id="4797416">}</span>&nbsp;<span class="op" id="4797418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4797422">for</span>&nbsp;<span class="ident" id="4797426">i</span>&nbsp;<span class="op" id="4797428">:=</span>&nbsp;<span class="keyword" id="4797431">range</span>&nbsp;<span class="ident" id="4797437">s</span>&nbsp;<span class="op" id="4797439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4797444">s</span><span class="op" id="4797445">[</span><span class="ident" id="4797446">i</span><span class="op" id="4797447">]</span>&nbsp;<span class="op" id="4797449">=</span>&nbsp;<span class="num" id="4797451">0</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4797455">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4797458">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4797461">for</span>&nbsp;<span class="ident" id="4797465">_</span><span class="op" id="4797466">,</span>&nbsp;<span class="ident" id="4797468">enc</span>&nbsp;<span class="op" id="4797472">:=</span>&nbsp;<span class="keyword" id="4797475">range</span>&nbsp;<span class="op" id="4797481">[</span><span class="op" id="4797482">...</span><span class="op" id="4797485">]</span><span class="op" id="4797486">*</span><span class="ident" id="4797487">huffmanEncoder</span><span class="op" id="4797501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4797505">w</span><span class="op" id="4797506">.</span><span class="ident" id="4797507">literalEncoding</span><span class="op" id="4797522">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4797526">w</span><span class="op" id="4797527">.</span><span class="ident" id="4797528">offsetEncoding</span><span class="op" id="4797542">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4797546">w</span><span class="op" id="4797547">.</span><span class="ident" id="4797548">codegenEncoding</span><span class="op" id="4797563">}</span>&nbsp;<span class="op" id="4797565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4797569">for</span>&nbsp;<span class="ident" id="4797573">i</span>&nbsp;<span class="op" id="4797575">:=</span>&nbsp;<span class="keyword" id="4797578">range</span>&nbsp;<span class="ident" id="4797584">enc</span><span class="op" id="4797587">.</span><span class="ident" id="4797588">code</span>&nbsp;<span class="op" id="4797593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4797598">enc</span><span class="op" id="4797601">.</span><span class="ident" id="4797602">code</span><span class="op" id="4797606">[</span><span class="ident" id="4797607">i</span><span class="op" id="4797608">]</span>&nbsp;<span class="op" id="4797610">=</span>&nbsp;<span class="num" id="4797612">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4797616">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4797620">for</span>&nbsp;<span class="ident" id="4797624">i</span>&nbsp;<span class="op" id="4797626">:=</span>&nbsp;<span class="keyword" id="4797629">range</span>&nbsp;<span class="ident" id="4797635">enc</span><span class="op" id="4797638">.</span><span class="ident" id="4797639">codeBits</span>&nbsp;<span class="op" id="4797648">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4797653">enc</span><span class="op" id="4797656">.</span><span class="ident" id="4797657">codeBits</span><span class="op" id="4797665">[</span><span class="ident" id="4797666">i</span><span class="op" id="4797667">]</span>&nbsp;<span class="op" id="4797669">=</span>&nbsp;<span class="num" id="4797671">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4797675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4797678">}</span><br>
<span class="lineno"></span><span class="op" id="4797680">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="4797683">func</span>&nbsp;<span class="op" id="4797688">(</span><span class="ident" id="4797689">w</span>&nbsp;<span class="op" id="4797691">*</span><span class="ident" id="4797692">huffmanBitWriter</span><span class="op" id="4797708">)</span>&nbsp;<span class="ident" id="4797710">flushBits</span><span class="op" id="4797719">(</span><span class="op" id="4797720">)</span>&nbsp;<span class="op" id="4797722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4797725">if</span>&nbsp;<span class="ident" id="4797728">w</span><span class="op" id="4797729">.</span><span class="ident" id="4797730">err</span>&nbsp;<span class="op" id="4797734">!=</span>&nbsp;<span class="builtintype" id="4797737">nil</span>&nbsp;<span class="op" id="4797741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4797745">w</span><span class="op" id="4797746">.</span><span class="ident" id="4797747">nbits</span>&nbsp;<span class="op" id="4797753">=</span>&nbsp;<span class="num" id="4797755">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4797759">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4797767">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4797770">bits</span>&nbsp;<span class="op" id="4797775">:=</span>&nbsp;<span class="ident" id="4797778">w</span><span class="op" id="4797779">.</span><span class="ident" id="4797780">bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4797786">w</span><span class="op" id="4797787">.</span><span class="ident" id="4797788">bits</span>&nbsp;<span class="op" id="4797793">&gt;&gt;=</span>&nbsp;<span class="num" id="4797797">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4797801">w</span><span class="op" id="4797802">.</span><span class="ident" id="4797803">nbits</span>&nbsp;<span class="op" id="4797809">-=</span>&nbsp;<span class="num" id="4797812">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4797816">n</span>&nbsp;<span class="op" id="4797818">:=</span>&nbsp;<span class="ident" id="4797821">w</span><span class="op" id="4797822">.</span><span class="ident" id="4797823">nbytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4797831">w</span><span class="op" id="4797832">.</span><span class="ident" id="4797833">bytes</span><span class="op" id="4797838">[</span><span class="ident" id="4797839">n</span><span class="op" id="4797840">]</span>&nbsp;<span class="op" id="4797842">=</span>&nbsp;<span class="builtintype" id="4797844">byte</span><span class="op" id="4797848">(</span><span class="ident" id="4797849">bits</span><span class="op" id="4797853">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4797856">w</span><span class="op" id="4797857">.</span><span class="ident" id="4797858">bytes</span><span class="op" id="4797863">[</span><span class="ident" id="4797864">n</span><span class="op" id="4797865">+</span><span class="num" id="4797866">1</span><span class="op" id="4797867">]</span>&nbsp;<span class="op" id="4797869">=</span>&nbsp;<span class="builtintype" id="4797871">byte</span><span class="op" id="4797875">(</span><span class="ident" id="4797876">bits</span>&nbsp;<span class="op" id="4797881">&gt;&gt;</span>&nbsp;<span class="num" id="4797884">8</span><span class="op" id="4797885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4797888">if</span>&nbsp;<span class="ident" id="4797891">n</span>&nbsp;<span class="op" id="4797893">+=</span>&nbsp;<span class="num" id="4797896">2</span><span class="op" id="4797897">;</span>&nbsp;<span class="ident" id="4797899">n</span>&nbsp;<span class="op" id="4797901">&gt;=</span>&nbsp;<span class="builtinfunc" id="4797904">len</span><span class="op" id="4797907">(</span><span class="ident" id="4797908">w</span><span class="op" id="4797909">.</span><span class="ident" id="4797910">bytes</span><span class="op" id="4797915">)</span>&nbsp;<span class="op" id="4797917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4797921">_</span><span class="op" id="4797922">,</span>&nbsp;<span class="ident" id="4797924">w</span><span class="op" id="4797925">.</span><span class="ident" id="4797926">err</span>&nbsp;<span class="op" id="4797930">=</span>&nbsp;<span class="ident" id="4797932">w</span><span class="op" id="4797933">.</span><span class="ident" id="4797934">w</span><span class="op" id="4797935">.</span><span class="ident" id="4797936">Write</span><span class="op" id="4797941">(</span><span class="ident" id="4797942">w</span><span class="op" id="4797943">.</span><span class="ident" id="4797944">bytes</span><span class="op" id="4797949">[</span><span class="num" id="4797950">0</span><span class="op" id="4797951">:</span><span class="op" id="4797952">]</span><span class="op" id="4797953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4797957">n</span>&nbsp;<span class="op" id="4797959">=</span>&nbsp;<span class="num" id="4797961">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4797964">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4797967">w</span><span class="op" id="4797968">.</span><span class="ident" id="4797969">nbytes</span>&nbsp;<span class="op" id="4797976">=</span>&nbsp;<span class="ident" id="4797978">n</span><br>
<span class="lineno"></span><span class="op" id="4797980">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4797983">func</span>&nbsp;<span class="op" id="4797988">(</span><span class="ident" id="4797989">w</span>&nbsp;<span class="op" id="4797991">*</span><span class="ident" id="4797992">huffmanBitWriter</span><span class="op" id="4798008">)</span>&nbsp;<span class="ident" id="4798010">flush</span><span class="op" id="4798015">(</span><span class="op" id="4798016">)</span>&nbsp;<span class="op" id="4798018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4798021">if</span>&nbsp;<span class="ident" id="4798024">w</span><span class="op" id="4798025">.</span><span class="ident" id="4798026">err</span>&nbsp;<span class="op" id="4798030">!=</span>&nbsp;<span class="builtintype" id="4798033">nil</span>&nbsp;<span class="op" id="4798037">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4798041">w</span><span class="op" id="4798042">.</span><span class="ident" id="4798043">nbits</span>&nbsp;<span class="op" id="4798049">=</span>&nbsp;<span class="num" id="4798051">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4798055">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4798063">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4798066">n</span>&nbsp;<span class="op" id="4798068">:=</span>&nbsp;<span class="ident" id="4798071">w</span><span class="op" id="4798072">.</span><span class="ident" id="4798073">nbytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4798081">if</span>&nbsp;<span class="ident" id="4798084">w</span><span class="op" id="4798085">.</span><span class="ident" id="4798086">nbits</span>&nbsp;<span class="op" id="4798092">&gt;</span>&nbsp;<span class="num" id="4798094">8</span>&nbsp;<span class="op" id="4798096">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4798100">w</span><span class="op" id="4798101">.</span><span class="ident" id="4798102">bytes</span><span class="op" id="4798107">[</span><span class="ident" id="4798108">n</span><span class="op" id="4798109">]</span>&nbsp;<span class="op" id="4798111">=</span>&nbsp;<span class="builtintype" id="4798113">byte</span><span class="op" id="4798117">(</span><span class="ident" id="4798118">w</span><span class="op" id="4798119">.</span><span class="ident" id="4798120">bits</span><span class="op" id="4798124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4798128">w</span><span class="op" id="4798129">.</span><span class="ident" id="4798130">bits</span>&nbsp;<span class="op" id="4798135">&gt;&gt;=</span>&nbsp;<span class="num" id="4798139">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4798143">w</span><span class="op" id="4798144">.</span><span class="ident" id="4798145">nbits</span>&nbsp;<span class="op" id="4798151">-=</span>&nbsp;<span class="num" id="4798154">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4798158">n</span><span class="op" id="4798159">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4798163">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4798166">if</span>&nbsp;<span class="ident" id="4798169">w</span><span class="op" id="4798170">.</span><span class="ident" id="4798171">nbits</span>&nbsp;<span class="op" id="4798177">&gt;</span>&nbsp;<span class="num" id="4798179">0</span>&nbsp;<span class="op" id="4798181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4798185">w</span><span class="op" id="4798186">.</span><span class="ident" id="4798187">bytes</span><span class="op" id="4798192">[</span><span class="ident" id="4798193">n</span><span class="op" id="4798194">]</span>&nbsp;<span class="op" id="4798196">=</span>&nbsp;<span class="builtintype" id="4798198">byte</span><span class="op" id="4798202">(</span><span class="ident" id="4798203">w</span><span class="op" id="4798204">.</span><span class="ident" id="4798205">bits</span><span class="op" id="4798209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4798213">w</span><span class="op" id="4798214">.</span><span class="ident" id="4798215">nbits</span>&nbsp;<span class="op" id="4798221">=</span>&nbsp;<span class="num" id="4798223">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4798227">n</span><span class="op" id="4798228">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4798232">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4798235">w</span><span class="op" id="4798236">.</span><span class="ident" id="4798237">bits</span>&nbsp;<span class="op" id="4798242">=</span>&nbsp;<span class="num" id="4798244">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4798247">_</span><span class="op" id="4798248">,</span>&nbsp;<span class="ident" id="4798250">w</span><span class="op" id="4798251">.</span><span class="ident" id="4798252">err</span>&nbsp;<span class="op" id="4798256">=</span>&nbsp;<span class="ident" id="4798258">w</span><span class="op" id="4798259">.</span><span class="ident" id="4798260">w</span><span class="op" id="4798261">.</span><span class="ident" id="4798262">Write</span><span class="op" id="4798267">(</span><span class="ident" id="4798268">w</span><span class="op" id="4798269">.</span><span class="ident" id="4798270">bytes</span><span class="op" id="4798275">[</span><span class="num" id="4798276">0</span><span class="op" id="4798277">:</span><span class="ident" id="4798278">n</span><span class="op" id="4798279">]</span><span class="op" id="4798280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4798283">w</span><span class="op" id="4798284">.</span><span class="ident" id="4798285">nbytes</span>&nbsp;<span class="op" id="4798292">=</span>&nbsp;<span class="num" id="4798294">0</span><br>
<span class="lineno"></span><span class="op" id="4798296">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="keyword" id="4798299">func</span>&nbsp;<span class="op" id="4798304">(</span><span class="ident" id="4798305">w</span>&nbsp;<span class="op" id="4798307">*</span><span class="ident" id="4798308">huffmanBitWriter</span><span class="op" id="4798324">)</span>&nbsp;<span class="ident" id="4798326">writeBits</span><span class="op" id="4798335">(</span><span class="ident" id="4798336">b</span><span class="op" id="4798337">,</span>&nbsp;<span class="ident" id="4798339">nb</span>&nbsp;<span class="builtintype" id="4798342">int32</span><span class="op" id="4798347">)</span>&nbsp;<span class="op" id="4798349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4798352">w</span><span class="op" id="4798353">.</span><span class="ident" id="4798354">bits</span>&nbsp;<span class="op" id="4798359">|=</span>&nbsp;<span class="builtintype" id="4798362">uint32</span><span class="op" id="4798368">(</span><span class="ident" id="4798369">b</span><span class="op" id="4798370">)</span>&nbsp;<span class="op" id="4798372">&lt;&lt;</span>&nbsp;<span class="ident" id="4798375">w</span><span class="op" id="4798376">.</span><span class="ident" id="4798377">nbits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4798384">if</span>&nbsp;<span class="ident" id="4798387">w</span><span class="op" id="4798388">.</span><span class="ident" id="4798389">nbits</span>&nbsp;<span class="op" id="4798395">+=</span>&nbsp;<span class="builtintype" id="4798398">uint32</span><span class="op" id="4798404">(</span><span class="ident" id="4798405">nb</span><span class="op" id="4798407">)</span><span class="op" id="4798408">;</span>&nbsp;<span class="ident" id="4798410">w</span><span class="op" id="4798411">.</span><span class="ident" id="4798412">nbits</span>&nbsp;<span class="op" id="4798418">&gt;=</span>&nbsp;<span class="num" id="4798421">16</span>&nbsp;<span class="op" id="4798424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4798428">w</span><span class="op" id="4798429">.</span><span class="ident" id="4798430">flushBits</span><span class="op" id="4798439">(</span><span class="op" id="4798440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4798443">}</span><br>
<span class="lineno">170</span><span class="op" id="4798445">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4798448">func</span>&nbsp;<span class="op" id="4798453">(</span><span class="ident" id="4798454">w</span>&nbsp;<span class="op" id="4798456">*</span><span class="ident" id="4798457">huffmanBitWriter</span><span class="op" id="4798473">)</span>&nbsp;<span class="ident" id="4798475">writeBytes</span><span class="op" id="4798485">(</span><span class="ident" id="4798486">bytes</span>&nbsp;<span class="op" id="4798492">[</span><span class="op" id="4798493">]</span><span class="builtintype" id="4798494">byte</span><span class="op" id="4798498">)</span>&nbsp;<span class="op" id="4798500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4798503">if</span>&nbsp;<span class="ident" id="4798506">w</span><span class="op" id="4798507">.</span><span class="ident" id="4798508">err</span>&nbsp;<span class="op" id="4798512">!=</span>&nbsp;<span class="builtintype" id="4798515">nil</span>&nbsp;<span class="op" id="4798519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4798523">return</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4798531">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4798534">n</span>&nbsp;<span class="op" id="4798536">:=</span>&nbsp;<span class="ident" id="4798539">w</span><span class="op" id="4798540">.</span><span class="ident" id="4798541">nbytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4798549">if</span>&nbsp;<span class="ident" id="4798552">w</span><span class="op" id="4798553">.</span><span class="ident" id="4798554">nbits</span>&nbsp;<span class="op" id="4798560">==</span>&nbsp;<span class="num" id="4798563">8</span>&nbsp;<span class="op" id="4798565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4798569">w</span><span class="op" id="4798570">.</span><span class="ident" id="4798571">bytes</span><span class="op" id="4798576">[</span><span class="ident" id="4798577">n</span><span class="op" id="4798578">]</span>&nbsp;<span class="op" id="4798580">=</span>&nbsp;<span class="builtintype" id="4798582">byte</span><span class="op" id="4798586">(</span><span class="ident" id="4798587">w</span><span class="op" id="4798588">.</span><span class="ident" id="4798589">bits</span><span class="op" id="4798593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4798597">w</span><span class="op" id="4798598">.</span><span class="ident" id="4798599">nbits</span>&nbsp;<span class="op" id="4798605">=</span>&nbsp;<span class="num" id="4798607">0</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4798611">n</span><span class="op" id="4798612">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4798616">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4798619">if</span>&nbsp;<span class="ident" id="4798622">w</span><span class="op" id="4798623">.</span><span class="ident" id="4798624">nbits</span>&nbsp;<span class="op" id="4798630">!=</span>&nbsp;<span class="num" id="4798633">0</span>&nbsp;<span class="op" id="4798635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4798639">w</span><span class="op" id="4798640">.</span><span class="ident" id="4798641">err</span>&nbsp;<span class="op" id="4798645">=</span>&nbsp;<span class="ident" id="4798647">InternalError</span><span class="op" id="4798660">(</span><span class="string" id="4798661">&#34;writeBytes&nbsp;with&nbsp;unfinished&nbsp;bits&#34;</span><span class="op" id="4798694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4798698">return</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4798706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4798709">if</span>&nbsp;<span class="ident" id="4798712">n</span>&nbsp;<span class="op" id="4798714">!=</span>&nbsp;<span class="num" id="4798717">0</span>&nbsp;<span class="op" id="4798719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4798723">_</span><span class="op" id="4798724">,</span>&nbsp;<span class="ident" id="4798726">w</span><span class="op" id="4798727">.</span><span class="ident" id="4798728">err</span>&nbsp;<span class="op" id="4798732">=</span>&nbsp;<span class="ident" id="4798734">w</span><span class="op" id="4798735">.</span><span class="ident" id="4798736">w</span><span class="op" id="4798737">.</span><span class="ident" id="4798738">Write</span><span class="op" id="4798743">(</span><span class="ident" id="4798744">w</span><span class="op" id="4798745">.</span><span class="ident" id="4798746">bytes</span><span class="op" id="4798751">[</span><span class="num" id="4798752">0</span><span class="op" id="4798753">:</span><span class="ident" id="4798754">n</span><span class="op" id="4798755">]</span><span class="op" id="4798756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4798760">if</span>&nbsp;<span class="ident" id="4798763">w</span><span class="op" id="4798764">.</span><span class="ident" id="4798765">err</span>&nbsp;<span class="op" id="4798769">!=</span>&nbsp;<span class="builtintype" id="4798772">nil</span>&nbsp;<span class="op" id="4798776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4798781">return</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4798790">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4798793">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4798796">w</span><span class="op" id="4798797">.</span><span class="ident" id="4798798">nbytes</span>&nbsp;<span class="op" id="4798805">=</span>&nbsp;<span class="num" id="4798807">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4798810">_</span><span class="op" id="4798811">,</span>&nbsp;<span class="ident" id="4798813">w</span><span class="op" id="4798814">.</span><span class="ident" id="4798815">err</span>&nbsp;<span class="op" id="4798819">=</span>&nbsp;<span class="ident" id="4798821">w</span><span class="op" id="4798822">.</span><span class="ident" id="4798823">w</span><span class="op" id="4798824">.</span><span class="ident" id="4798825">Write</span><span class="op" id="4798830">(</span><span class="ident" id="4798831">bytes</span><span class="op" id="4798836">)</span><br>
<span class="lineno"></span><span class="op" id="4798838">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="comment" id="4798841">//&nbsp;RFC&nbsp;1951&nbsp;3.2.7&nbsp;specifies&nbsp;a&nbsp;special&nbsp;run-length&nbsp;encoding&nbsp;for&nbsp;specifying</span><br>
<span class="lineno"></span><span class="comment" id="4798914">//&nbsp;the&nbsp;literal&nbsp;and&nbsp;offset&nbsp;lengths&nbsp;arrays&nbsp;(which&nbsp;are&nbsp;concatenated&nbsp;into&nbsp;a&nbsp;single</span><br>
<span class="lineno"></span><span class="comment" id="4798993">//&nbsp;array).&nbsp;&nbsp;This&nbsp;method&nbsp;generates&nbsp;that&nbsp;run-length&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="comment" id="4799053">//</span><br>
<span class="lineno">200</span><span class="comment" id="4799056">//&nbsp;The&nbsp;result&nbsp;is&nbsp;written&nbsp;into&nbsp;the&nbsp;codegen&nbsp;array,&nbsp;and&nbsp;the&nbsp;frequencies</span><br>
<span class="lineno"></span><span class="comment" id="4799125">//&nbsp;of&nbsp;each&nbsp;code&nbsp;is&nbsp;written&nbsp;into&nbsp;the&nbsp;codegenFreq&nbsp;array.</span><br>
<span class="lineno"></span><span class="comment" id="4799180">//&nbsp;Codes&nbsp;0-15&nbsp;are&nbsp;single&nbsp;byte&nbsp;codes.&nbsp;Codes&nbsp;16-18&nbsp;are&nbsp;followed&nbsp;by&nbsp;additional</span><br>
<span class="lineno"></span><span class="comment" id="4799256">//&nbsp;information.&nbsp;&nbsp;Code&nbsp;badCode&nbsp;is&nbsp;an&nbsp;end&nbsp;marker</span><br>
<span class="lineno"></span><span class="comment" id="4799303">//</span><br>
<span class="lineno">205</span><span class="comment" id="4799306">//&nbsp;&nbsp;numLiterals&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;number&nbsp;of&nbsp;literals&nbsp;in&nbsp;literalEncoding</span><br>
<span class="lineno"></span><span class="comment" id="4799369">//&nbsp;&nbsp;numOffsets&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;number&nbsp;of&nbsp;offsets&nbsp;in&nbsp;offsetEncoding</span><br>
<span class="lineno"></span><span class="keyword" id="4799430">func</span>&nbsp;<span class="op" id="4799435">(</span><span class="ident" id="4799436">w</span>&nbsp;<span class="op" id="4799438">*</span><span class="ident" id="4799439">huffmanBitWriter</span><span class="op" id="4799455">)</span>&nbsp;<span class="ident" id="4799457">generateCodegen</span><span class="op" id="4799472">(</span><span class="ident" id="4799473">numLiterals</span>&nbsp;<span class="builtintype" id="4799485">int</span><span class="op" id="4799488">,</span>&nbsp;<span class="ident" id="4799490">numOffsets</span>&nbsp;<span class="builtintype" id="4799501">int</span><span class="op" id="4799504">)</span>&nbsp;<span class="op" id="4799506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4799509">for</span>&nbsp;<span class="ident" id="4799513">i</span>&nbsp;<span class="op" id="4799515">:=</span>&nbsp;<span class="keyword" id="4799518">range</span>&nbsp;<span class="ident" id="4799524">w</span><span class="op" id="4799525">.</span><span class="ident" id="4799526">codegenFreq</span>&nbsp;<span class="op" id="4799538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4799542">w</span><span class="op" id="4799543">.</span><span class="ident" id="4799544">codegenFreq</span><span class="op" id="4799555">[</span><span class="ident" id="4799556">i</span><span class="op" id="4799557">]</span>&nbsp;<span class="op" id="4799559">=</span>&nbsp;<span class="num" id="4799561">0</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4799564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4799567">//&nbsp;Note&nbsp;that&nbsp;we&nbsp;are&nbsp;using&nbsp;codegen&nbsp;both&nbsp;as&nbsp;a&nbsp;temporary&nbsp;variable&nbsp;for&nbsp;holding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4799643">//&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;frequencies,&nbsp;and&nbsp;as&nbsp;the&nbsp;place&nbsp;where&nbsp;we&nbsp;put&nbsp;the&nbsp;result.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4799716">//&nbsp;This&nbsp;is&nbsp;fine&nbsp;because&nbsp;the&nbsp;output&nbsp;is&nbsp;always&nbsp;shorter&nbsp;than&nbsp;the&nbsp;input&nbsp;used</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4799790">//&nbsp;so&nbsp;far.</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4799802">codegen</span>&nbsp;<span class="op" id="4799810">:=</span>&nbsp;<span class="ident" id="4799813">w</span><span class="op" id="4799814">.</span><span class="ident" id="4799815">codegen</span>&nbsp;<span class="comment" id="4799823">//&nbsp;cache</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4799833">//&nbsp;Copy&nbsp;the&nbsp;concatenated&nbsp;code&nbsp;sizes&nbsp;to&nbsp;codegen.&nbsp;&nbsp;Put&nbsp;a&nbsp;marker&nbsp;at&nbsp;the&nbsp;end.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4799908">copy</span><span class="op" id="4799912">(</span><span class="ident" id="4799913">codegen</span><span class="op" id="4799920">[</span><span class="num" id="4799921">0</span><span class="op" id="4799922">:</span><span class="ident" id="4799923">numLiterals</span><span class="op" id="4799934">]</span><span class="op" id="4799935">,</span>&nbsp;<span class="ident" id="4799937">w</span><span class="op" id="4799938">.</span><span class="ident" id="4799939">literalEncoding</span><span class="op" id="4799954">.</span><span class="ident" id="4799955">codeBits</span><span class="op" id="4799963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4799966">copy</span><span class="op" id="4799970">(</span><span class="ident" id="4799971">codegen</span><span class="op" id="4799978">[</span><span class="ident" id="4799979">numLiterals</span><span class="op" id="4799990">:</span><span class="ident" id="4799991">numLiterals</span><span class="op" id="4800002">+</span><span class="ident" id="4800003">numOffsets</span><span class="op" id="4800013">]</span><span class="op" id="4800014">,</span>&nbsp;<span class="ident" id="4800016">w</span><span class="op" id="4800017">.</span><span class="ident" id="4800018">offsetEncoding</span><span class="op" id="4800032">.</span><span class="ident" id="4800033">codeBits</span><span class="op" id="4800041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4800044">codegen</span><span class="op" id="4800051">[</span><span class="ident" id="4800052">numLiterals</span><span class="op" id="4800063">+</span><span class="ident" id="4800064">numOffsets</span><span class="op" id="4800074">]</span>&nbsp;<span class="op" id="4800076">=</span>&nbsp;<span class="ident" id="4800078">badCode</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4800088">size</span>&nbsp;<span class="op" id="4800093">:=</span>&nbsp;<span class="ident" id="4800096">codegen</span><span class="op" id="4800103">[</span><span class="num" id="4800104">0</span><span class="op" id="4800105">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4800108">count</span>&nbsp;<span class="op" id="4800114">:=</span>&nbsp;<span class="num" id="4800117">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4800120">outIndex</span>&nbsp;<span class="op" id="4800129">:=</span>&nbsp;<span class="num" id="4800132">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4800135">for</span>&nbsp;<span class="ident" id="4800139">inIndex</span>&nbsp;<span class="op" id="4800147">:=</span>&nbsp;<span class="num" id="4800150">1</span><span class="op" id="4800151">;</span>&nbsp;<span class="ident" id="4800153">size</span>&nbsp;<span class="op" id="4800158">!=</span>&nbsp;<span class="ident" id="4800161">badCode</span><span class="op" id="4800168">;</span>&nbsp;<span class="ident" id="4800170">inIndex</span><span class="op" id="4800177">++</span>&nbsp;<span class="op" id="4800180">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4800184">//&nbsp;INVARIANT:&nbsp;We&nbsp;have&nbsp;seen&nbsp;&#34;count&#34;&nbsp;copies&nbsp;of&nbsp;size&nbsp;that&nbsp;have&nbsp;not&nbsp;yet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4800254">//&nbsp;had&nbsp;output&nbsp;generated&nbsp;for&nbsp;them.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4800290">nextSize</span>&nbsp;<span class="op" id="4800299">:=</span>&nbsp;<span class="ident" id="4800302">codegen</span><span class="op" id="4800309">[</span><span class="ident" id="4800310">inIndex</span><span class="op" id="4800317">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4800321">if</span>&nbsp;<span class="ident" id="4800324">nextSize</span>&nbsp;<span class="op" id="4800333">==</span>&nbsp;<span class="ident" id="4800336">size</span>&nbsp;<span class="op" id="4800341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4800346">count</span><span class="op" id="4800351">++</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4800357">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4800368">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4800372">//&nbsp;We&nbsp;need&nbsp;to&nbsp;generate&nbsp;codegen&nbsp;indicating&nbsp;&#34;count&#34;&nbsp;of&nbsp;size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4800433">if</span>&nbsp;<span class="ident" id="4800436">size</span>&nbsp;<span class="op" id="4800441">!=</span>&nbsp;<span class="num" id="4800444">0</span>&nbsp;<span class="op" id="4800446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4800451">codegen</span><span class="op" id="4800458">[</span><span class="ident" id="4800459">outIndex</span><span class="op" id="4800467">]</span>&nbsp;<span class="op" id="4800469">=</span>&nbsp;<span class="ident" id="4800471">size</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4800479">outIndex</span><span class="op" id="4800487">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4800493">w</span><span class="op" id="4800494">.</span><span class="ident" id="4800495">codegenFreq</span><span class="op" id="4800506">[</span><span class="ident" id="4800507">size</span><span class="op" id="4800511">]</span><span class="op" id="4800512">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4800518">count</span><span class="op" id="4800523">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4800529">for</span>&nbsp;<span class="ident" id="4800533">count</span>&nbsp;<span class="op" id="4800539">&gt;=</span>&nbsp;<span class="num" id="4800542">3</span>&nbsp;<span class="op" id="4800544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4800550">n</span>&nbsp;<span class="op" id="4800552">:=</span>&nbsp;<span class="num" id="4800555">6</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4800561">if</span>&nbsp;<span class="ident" id="4800564">n</span>&nbsp;<span class="op" id="4800566">&gt;</span>&nbsp;<span class="ident" id="4800568">count</span>&nbsp;<span class="op" id="4800574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4800581">n</span>&nbsp;<span class="op" id="4800583">=</span>&nbsp;<span class="ident" id="4800585">count</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4800595">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4800601">codegen</span><span class="op" id="4800608">[</span><span class="ident" id="4800609">outIndex</span><span class="op" id="4800617">]</span>&nbsp;<span class="op" id="4800619">=</span>&nbsp;<span class="num" id="4800621">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4800628">outIndex</span><span class="op" id="4800636">++</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4800643">codegen</span><span class="op" id="4800650">[</span><span class="ident" id="4800651">outIndex</span><span class="op" id="4800659">]</span>&nbsp;<span class="op" id="4800661">=</span>&nbsp;<span class="builtintype" id="4800663">uint8</span><span class="op" id="4800668">(</span><span class="ident" id="4800669">n</span>&nbsp;<span class="op" id="4800671">-</span>&nbsp;<span class="num" id="4800673">3</span><span class="op" id="4800674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4800680">outIndex</span><span class="op" id="4800688">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4800695">w</span><span class="op" id="4800696">.</span><span class="ident" id="4800697">codegenFreq</span><span class="op" id="4800708">[</span><span class="num" id="4800709">16</span><span class="op" id="4800711">]</span><span class="op" id="4800712">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4800719">count</span>&nbsp;<span class="op" id="4800725">-=</span>&nbsp;<span class="ident" id="4800728">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4800733">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4800737">}</span>&nbsp;<span class="keyword" id="4800739">else</span>&nbsp;<span class="op" id="4800744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4800749">for</span>&nbsp;<span class="ident" id="4800753">count</span>&nbsp;<span class="op" id="4800759">&gt;=</span>&nbsp;<span class="num" id="4800762">11</span>&nbsp;<span class="op" id="4800765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4800771">n</span>&nbsp;<span class="op" id="4800773">:=</span>&nbsp;<span class="num" id="4800776">138</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4800784">if</span>&nbsp;<span class="ident" id="4800787">n</span>&nbsp;<span class="op" id="4800789">&gt;</span>&nbsp;<span class="ident" id="4800791">count</span>&nbsp;<span class="op" id="4800797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4800804">n</span>&nbsp;<span class="op" id="4800806">=</span>&nbsp;<span class="ident" id="4800808">count</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4800818">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4800824">codegen</span><span class="op" id="4800831">[</span><span class="ident" id="4800832">outIndex</span><span class="op" id="4800840">]</span>&nbsp;<span class="op" id="4800842">=</span>&nbsp;<span class="num" id="4800844">18</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4800851">outIndex</span><span class="op" id="4800859">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4800866">codegen</span><span class="op" id="4800873">[</span><span class="ident" id="4800874">outIndex</span><span class="op" id="4800882">]</span>&nbsp;<span class="op" id="4800884">=</span>&nbsp;<span class="builtintype" id="4800886">uint8</span><span class="op" id="4800891">(</span><span class="ident" id="4800892">n</span>&nbsp;<span class="op" id="4800894">-</span>&nbsp;<span class="num" id="4800896">11</span><span class="op" id="4800898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4800904">outIndex</span><span class="op" id="4800912">++</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4800919">w</span><span class="op" id="4800920">.</span><span class="ident" id="4800921">codegenFreq</span><span class="op" id="4800932">[</span><span class="num" id="4800933">18</span><span class="op" id="4800935">]</span><span class="op" id="4800936">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4800943">count</span>&nbsp;<span class="op" id="4800949">-=</span>&nbsp;<span class="ident" id="4800952">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4800957">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4800962">if</span>&nbsp;<span class="ident" id="4800965">count</span>&nbsp;<span class="op" id="4800971">&gt;=</span>&nbsp;<span class="num" id="4800974">3</span>&nbsp;<span class="op" id="4800976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4800982">//&nbsp;count&nbsp;&gt;=&nbsp;3&nbsp;&amp;&amp;&nbsp;count&nbsp;&lt;=&nbsp;10</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4801015">codegen</span><span class="op" id="4801022">[</span><span class="ident" id="4801023">outIndex</span><span class="op" id="4801031">]</span>&nbsp;<span class="op" id="4801033">=</span>&nbsp;<span class="num" id="4801035">17</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4801042">outIndex</span><span class="op" id="4801050">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4801057">codegen</span><span class="op" id="4801064">[</span><span class="ident" id="4801065">outIndex</span><span class="op" id="4801073">]</span>&nbsp;<span class="op" id="4801075">=</span>&nbsp;<span class="builtintype" id="4801077">uint8</span><span class="op" id="4801082">(</span><span class="ident" id="4801083">count</span>&nbsp;<span class="op" id="4801089">-</span>&nbsp;<span class="num" id="4801091">3</span><span class="op" id="4801092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4801098">outIndex</span><span class="op" id="4801106">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4801113">w</span><span class="op" id="4801114">.</span><span class="ident" id="4801115">codegenFreq</span><span class="op" id="4801126">[</span><span class="num" id="4801127">17</span><span class="op" id="4801129">]</span><span class="op" id="4801130">++</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4801137">count</span>&nbsp;<span class="op" id="4801143">=</span>&nbsp;<span class="num" id="4801145">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4801150">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4801154">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4801158">count</span><span class="op" id="4801163">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4801168">for</span>&nbsp;<span class="op" id="4801172">;</span>&nbsp;<span class="ident" id="4801174">count</span>&nbsp;<span class="op" id="4801180">&gt;=</span>&nbsp;<span class="num" id="4801183">0</span><span class="op" id="4801184">;</span>&nbsp;<span class="ident" id="4801186">count</span><span class="op" id="4801191">--</span>&nbsp;<span class="op" id="4801194">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4801199">codegen</span><span class="op" id="4801206">[</span><span class="ident" id="4801207">outIndex</span><span class="op" id="4801215">]</span>&nbsp;<span class="op" id="4801217">=</span>&nbsp;<span class="ident" id="4801219">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4801227">outIndex</span><span class="op" id="4801235">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4801241">w</span><span class="op" id="4801242">.</span><span class="ident" id="4801243">codegenFreq</span><span class="op" id="4801254">[</span><span class="ident" id="4801255">size</span><span class="op" id="4801259">]</span><span class="op" id="4801260">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4801265">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4801269">//&nbsp;Set&nbsp;up&nbsp;invariant&nbsp;for&nbsp;next&nbsp;time&nbsp;through&nbsp;the&nbsp;loop.</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4801323">size</span>&nbsp;<span class="op" id="4801328">=</span>&nbsp;<span class="ident" id="4801330">nextSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4801341">count</span>&nbsp;<span class="op" id="4801347">=</span>&nbsp;<span class="num" id="4801349">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4801352">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4801355">//&nbsp;Marker&nbsp;indicating&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;codegen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4801401">codegen</span><span class="op" id="4801408">[</span><span class="ident" id="4801409">outIndex</span><span class="op" id="4801417">]</span>&nbsp;<span class="op" id="4801419">=</span>&nbsp;<span class="ident" id="4801421">badCode</span><br>
<span class="lineno">285</span><span class="op" id="4801429">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4801432">func</span>&nbsp;<span class="op" id="4801437">(</span><span class="ident" id="4801438">w</span>&nbsp;<span class="op" id="4801440">*</span><span class="ident" id="4801441">huffmanBitWriter</span><span class="op" id="4801457">)</span>&nbsp;<span class="ident" id="4801459">writeCode</span><span class="op" id="4801468">(</span><span class="ident" id="4801469">code</span>&nbsp;<span class="op" id="4801474">*</span><span class="ident" id="4801475">huffmanEncoder</span><span class="op" id="4801489">,</span>&nbsp;<span class="ident" id="4801491">literal</span>&nbsp;<span class="builtintype" id="4801499">uint32</span><span class="op" id="4801505">)</span>&nbsp;<span class="op" id="4801507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4801510">if</span>&nbsp;<span class="ident" id="4801513">w</span><span class="op" id="4801514">.</span><span class="ident" id="4801515">err</span>&nbsp;<span class="op" id="4801519">!=</span>&nbsp;<span class="builtintype" id="4801522">nil</span>&nbsp;<span class="op" id="4801526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4801530">return</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4801538">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4801541">w</span><span class="op" id="4801542">.</span><span class="ident" id="4801543">writeBits</span><span class="op" id="4801552">(</span><span class="builtintype" id="4801553">int32</span><span class="op" id="4801558">(</span><span class="ident" id="4801559">code</span><span class="op" id="4801563">.</span><span class="ident" id="4801564">code</span><span class="op" id="4801568">[</span><span class="ident" id="4801569">literal</span><span class="op" id="4801576">]</span><span class="op" id="4801577">)</span><span class="op" id="4801578">,</span>&nbsp;<span class="builtintype" id="4801580">int32</span><span class="op" id="4801585">(</span><span class="ident" id="4801586">code</span><span class="op" id="4801590">.</span><span class="ident" id="4801591">codeBits</span><span class="op" id="4801599">[</span><span class="ident" id="4801600">literal</span><span class="op" id="4801607">]</span><span class="op" id="4801608">)</span><span class="op" id="4801609">)</span><br>
<span class="lineno"></span><span class="op" id="4801611">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4801614">//&nbsp;Write&nbsp;the&nbsp;header&nbsp;of&nbsp;a&nbsp;dynamic&nbsp;Huffman&nbsp;block&nbsp;to&nbsp;the&nbsp;output&nbsp;stream.</span><br>
<span class="lineno">295</span><span class="comment" id="4801683">//</span><br>
<span class="lineno"></span><span class="comment" id="4801686">//&nbsp;&nbsp;numLiterals&nbsp;&nbsp;The&nbsp;number&nbsp;of&nbsp;literals&nbsp;specified&nbsp;in&nbsp;codegen</span><br>
<span class="lineno"></span><span class="comment" id="4801747">//&nbsp;&nbsp;numOffsets&nbsp;&nbsp;&nbsp;The&nbsp;number&nbsp;of&nbsp;offsets&nbsp;specified&nbsp;in&nbsp;codegen</span><br>
<span class="lineno"></span><span class="comment" id="4801807">//&nbsp;&nbsp;numCodegens&nbsp;&nbsp;The&nbsp;number&nbsp;of&nbsp;codegens&nbsp;used&nbsp;in&nbsp;codegen</span><br>
<span class="lineno"></span><span class="keyword" id="4801863">func</span>&nbsp;<span class="op" id="4801868">(</span><span class="ident" id="4801869">w</span>&nbsp;<span class="op" id="4801871">*</span><span class="ident" id="4801872">huffmanBitWriter</span><span class="op" id="4801888">)</span>&nbsp;<span class="ident" id="4801890">writeDynamicHeader</span><span class="op" id="4801908">(</span><span class="ident" id="4801909">numLiterals</span>&nbsp;<span class="builtintype" id="4801921">int</span><span class="op" id="4801924">,</span>&nbsp;<span class="ident" id="4801926">numOffsets</span>&nbsp;<span class="builtintype" id="4801937">int</span><span class="op" id="4801940">,</span>&nbsp;<span class="ident" id="4801942">numCodegens</span>&nbsp;<span class="builtintype" id="4801954">int</span><span class="op" id="4801957">,</span>&nbsp;<span class="ident" id="4801959">isEof</span>&nbsp;<span class="builtintype" id="4801965">bool</span><span class="op" id="4801969">)</span>&nbsp;<span class="op" id="4801971">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4801974">if</span>&nbsp;<span class="ident" id="4801977">w</span><span class="op" id="4801978">.</span><span class="ident" id="4801979">err</span>&nbsp;<span class="op" id="4801983">!=</span>&nbsp;<span class="builtintype" id="4801986">nil</span>&nbsp;<span class="op" id="4801990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4801994">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4802002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4802005">var</span>&nbsp;<span class="ident" id="4802009">firstBits</span>&nbsp;<span class="builtintype" id="4802019">int32</span>&nbsp;<span class="op" id="4802025">=</span>&nbsp;<span class="num" id="4802027">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4802030">if</span>&nbsp;<span class="ident" id="4802033">isEof</span>&nbsp;<span class="op" id="4802039">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4802043">firstBits</span>&nbsp;<span class="op" id="4802053">=</span>&nbsp;<span class="num" id="4802055">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4802058">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4802061">w</span><span class="op" id="4802062">.</span><span class="ident" id="4802063">writeBits</span><span class="op" id="4802072">(</span><span class="ident" id="4802073">firstBits</span><span class="op" id="4802082">,</span>&nbsp;<span class="num" id="4802084">3</span><span class="op" id="4802085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4802088">w</span><span class="op" id="4802089">.</span><span class="ident" id="4802090">writeBits</span><span class="op" id="4802099">(</span><span class="builtintype" id="4802100">int32</span><span class="op" id="4802105">(</span><span class="ident" id="4802106">numLiterals</span><span class="op" id="4802117">-</span><span class="num" id="4802118">257</span><span class="op" id="4802121">)</span><span class="op" id="4802122">,</span>&nbsp;<span class="num" id="4802124">5</span><span class="op" id="4802125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4802128">w</span><span class="op" id="4802129">.</span><span class="ident" id="4802130">writeBits</span><span class="op" id="4802139">(</span><span class="builtintype" id="4802140">int32</span><span class="op" id="4802145">(</span><span class="ident" id="4802146">numOffsets</span><span class="op" id="4802156">-</span><span class="num" id="4802157">1</span><span class="op" id="4802158">)</span><span class="op" id="4802159">,</span>&nbsp;<span class="num" id="4802161">5</span><span class="op" id="4802162">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4802165">w</span><span class="op" id="4802166">.</span><span class="ident" id="4802167">writeBits</span><span class="op" id="4802176">(</span><span class="builtintype" id="4802177">int32</span><span class="op" id="4802182">(</span><span class="ident" id="4802183">numCodegens</span><span class="op" id="4802194">-</span><span class="num" id="4802195">4</span><span class="op" id="4802196">)</span><span class="op" id="4802197">,</span>&nbsp;<span class="num" id="4802199">4</span><span class="op" id="4802200">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4802204">for</span>&nbsp;<span class="ident" id="4802208">i</span>&nbsp;<span class="op" id="4802210">:=</span>&nbsp;<span class="num" id="4802213">0</span><span class="op" id="4802214">;</span>&nbsp;<span class="ident" id="4802216">i</span>&nbsp;<span class="op" id="4802218">&lt;</span>&nbsp;<span class="ident" id="4802220">numCodegens</span><span class="op" id="4802231">;</span>&nbsp;<span class="ident" id="4802233">i</span><span class="op" id="4802234">++</span>&nbsp;<span class="op" id="4802237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4802241">value</span>&nbsp;<span class="op" id="4802247">:=</span>&nbsp;<span class="ident" id="4802250">w</span><span class="op" id="4802251">.</span><span class="ident" id="4802252">codegenEncoding</span><span class="op" id="4802267">.</span><span class="ident" id="4802268">codeBits</span><span class="op" id="4802276">[</span><span class="ident" id="4802277">codegenOrder</span><span class="op" id="4802289">[</span><span class="ident" id="4802290">i</span><span class="op" id="4802291">]</span><span class="op" id="4802292">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4802296">w</span><span class="op" id="4802297">.</span><span class="ident" id="4802298">writeBits</span><span class="op" id="4802307">(</span><span class="builtintype" id="4802308">int32</span><span class="op" id="4802313">(</span><span class="ident" id="4802314">value</span><span class="op" id="4802319">)</span><span class="op" id="4802320">,</span>&nbsp;<span class="num" id="4802322">3</span><span class="op" id="4802323">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4802326">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4802330">i</span>&nbsp;<span class="op" id="4802332">:=</span>&nbsp;<span class="num" id="4802335">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4802338">for</span>&nbsp;<span class="op" id="4802342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4802346">var</span>&nbsp;<span class="ident" id="4802350">codeWord</span>&nbsp;<span class="builtintype" id="4802359">int</span>&nbsp;<span class="op" id="4802363">=</span>&nbsp;<span class="builtintype" id="4802365">int</span><span class="op" id="4802368">(</span><span class="ident" id="4802369">w</span><span class="op" id="4802370">.</span><span class="ident" id="4802371">codegen</span><span class="op" id="4802378">[</span><span class="ident" id="4802379">i</span><span class="op" id="4802380">]</span><span class="op" id="4802381">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4802385">i</span><span class="op" id="4802386">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4802391">if</span>&nbsp;<span class="ident" id="4802394">codeWord</span>&nbsp;<span class="op" id="4802403">==</span>&nbsp;<span class="ident" id="4802406">badCode</span>&nbsp;<span class="op" id="4802414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4802419">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4802427">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4802431">//&nbsp;The&nbsp;low&nbsp;byte&nbsp;contains&nbsp;the&nbsp;actual&nbsp;code&nbsp;to&nbsp;generate.</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4802487">w</span><span class="op" id="4802488">.</span><span class="ident" id="4802489">writeCode</span><span class="op" id="4802498">(</span><span class="ident" id="4802499">w</span><span class="op" id="4802500">.</span><span class="ident" id="4802501">codegenEncoding</span><span class="op" id="4802516">,</span>&nbsp;<span class="builtintype" id="4802518">uint32</span><span class="op" id="4802524">(</span><span class="ident" id="4802525">codeWord</span><span class="op" id="4802533">)</span><span class="op" id="4802534">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4802539">switch</span>&nbsp;<span class="ident" id="4802546">codeWord</span>&nbsp;<span class="op" id="4802555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4802559">case</span>&nbsp;<span class="num" id="4802564">16</span><span class="op" id="4802566">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4802571">w</span><span class="op" id="4802572">.</span><span class="ident" id="4802573">writeBits</span><span class="op" id="4802582">(</span><span class="builtintype" id="4802583">int32</span><span class="op" id="4802588">(</span><span class="ident" id="4802589">w</span><span class="op" id="4802590">.</span><span class="ident" id="4802591">codegen</span><span class="op" id="4802598">[</span><span class="ident" id="4802599">i</span><span class="op" id="4802600">]</span><span class="op" id="4802601">)</span><span class="op" id="4802602">,</span>&nbsp;<span class="num" id="4802604">2</span><span class="op" id="4802605">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4802610">i</span><span class="op" id="4802611">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4802617">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4802625">case</span>&nbsp;<span class="num" id="4802630">17</span><span class="op" id="4802632">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4802637">w</span><span class="op" id="4802638">.</span><span class="ident" id="4802639">writeBits</span><span class="op" id="4802648">(</span><span class="builtintype" id="4802649">int32</span><span class="op" id="4802654">(</span><span class="ident" id="4802655">w</span><span class="op" id="4802656">.</span><span class="ident" id="4802657">codegen</span><span class="op" id="4802664">[</span><span class="ident" id="4802665">i</span><span class="op" id="4802666">]</span><span class="op" id="4802667">)</span><span class="op" id="4802668">,</span>&nbsp;<span class="num" id="4802670">3</span><span class="op" id="4802671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4802676">i</span><span class="op" id="4802677">++</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4802683">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4802691">case</span>&nbsp;<span class="num" id="4802696">18</span><span class="op" id="4802698">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4802703">w</span><span class="op" id="4802704">.</span><span class="ident" id="4802705">writeBits</span><span class="op" id="4802714">(</span><span class="builtintype" id="4802715">int32</span><span class="op" id="4802720">(</span><span class="ident" id="4802721">w</span><span class="op" id="4802722">.</span><span class="ident" id="4802723">codegen</span><span class="op" id="4802730">[</span><span class="ident" id="4802731">i</span><span class="op" id="4802732">]</span><span class="op" id="4802733">)</span><span class="op" id="4802734">,</span>&nbsp;<span class="num" id="4802736">7</span><span class="op" id="4802737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4802742">i</span><span class="op" id="4802743">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4802749">break</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4802757">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4802760">}</span><br>
<span class="lineno"></span><span class="op" id="4802762">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4802765">func</span>&nbsp;<span class="op" id="4802770">(</span><span class="ident" id="4802771">w</span>&nbsp;<span class="op" id="4802773">*</span><span class="ident" id="4802774">huffmanBitWriter</span><span class="op" id="4802790">)</span>&nbsp;<span class="ident" id="4802792">writeStoredHeader</span><span class="op" id="4802809">(</span><span class="ident" id="4802810">length</span>&nbsp;<span class="builtintype" id="4802817">int</span><span class="op" id="4802820">,</span>&nbsp;<span class="ident" id="4802822">isEof</span>&nbsp;<span class="builtintype" id="4802828">bool</span><span class="op" id="4802832">)</span>&nbsp;<span class="op" id="4802834">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4802837">if</span>&nbsp;<span class="ident" id="4802840">w</span><span class="op" id="4802841">.</span><span class="ident" id="4802842">err</span>&nbsp;<span class="op" id="4802846">!=</span>&nbsp;<span class="builtintype" id="4802849">nil</span>&nbsp;<span class="op" id="4802853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4802857">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4802865">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4802868">var</span>&nbsp;<span class="ident" id="4802872">flag</span>&nbsp;<span class="builtintype" id="4802877">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4802884">if</span>&nbsp;<span class="ident" id="4802887">isEof</span>&nbsp;<span class="op" id="4802893">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4802897">flag</span>&nbsp;<span class="op" id="4802902">=</span>&nbsp;<span class="num" id="4802904">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4802907">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4802910">w</span><span class="op" id="4802911">.</span><span class="ident" id="4802912">writeBits</span><span class="op" id="4802921">(</span><span class="ident" id="4802922">flag</span><span class="op" id="4802926">,</span>&nbsp;<span class="num" id="4802928">3</span><span class="op" id="4802929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4802932">w</span><span class="op" id="4802933">.</span><span class="ident" id="4802934">flush</span><span class="op" id="4802939">(</span><span class="op" id="4802940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4802943">w</span><span class="op" id="4802944">.</span><span class="ident" id="4802945">writeBits</span><span class="op" id="4802954">(</span><span class="builtintype" id="4802955">int32</span><span class="op" id="4802960">(</span><span class="ident" id="4802961">length</span><span class="op" id="4802967">)</span><span class="op" id="4802968">,</span>&nbsp;<span class="num" id="4802970">16</span><span class="op" id="4802972">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4802975">w</span><span class="op" id="4802976">.</span><span class="ident" id="4802977">writeBits</span><span class="op" id="4802986">(</span><span class="builtintype" id="4802987">int32</span><span class="op" id="4802992">(</span><span class="op" id="4802993">^</span><span class="builtintype" id="4802994">uint16</span><span class="op" id="4803000">(</span><span class="ident" id="4803001">length</span><span class="op" id="4803007">)</span><span class="op" id="4803008">)</span><span class="op" id="4803009">,</span>&nbsp;<span class="num" id="4803011">16</span><span class="op" id="4803013">)</span><br>
<span class="lineno"></span><span class="op" id="4803015">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4803018">func</span>&nbsp;<span class="op" id="4803023">(</span><span class="ident" id="4803024">w</span>&nbsp;<span class="op" id="4803026">*</span><span class="ident" id="4803027">huffmanBitWriter</span><span class="op" id="4803043">)</span>&nbsp;<span class="ident" id="4803045">writeFixedHeader</span><span class="op" id="4803061">(</span><span class="ident" id="4803062">isEof</span>&nbsp;<span class="builtintype" id="4803068">bool</span><span class="op" id="4803072">)</span>&nbsp;<span class="op" id="4803074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4803077">if</span>&nbsp;<span class="ident" id="4803080">w</span><span class="op" id="4803081">.</span><span class="ident" id="4803082">err</span>&nbsp;<span class="op" id="4803086">!=</span>&nbsp;<span class="builtintype" id="4803089">nil</span>&nbsp;<span class="op" id="4803093">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4803097">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4803105">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4803108">//&nbsp;Indicate&nbsp;that&nbsp;we&nbsp;are&nbsp;a&nbsp;fixed&nbsp;Huffman&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4803155">var</span>&nbsp;<span class="ident" id="4803159">value</span>&nbsp;<span class="builtintype" id="4803165">int32</span>&nbsp;<span class="op" id="4803171">=</span>&nbsp;<span class="num" id="4803173">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4803176">if</span>&nbsp;<span class="ident" id="4803179">isEof</span>&nbsp;<span class="op" id="4803185">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4803189">value</span>&nbsp;<span class="op" id="4803195">=</span>&nbsp;<span class="num" id="4803197">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4803200">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4803203">w</span><span class="op" id="4803204">.</span><span class="ident" id="4803205">writeBits</span><span class="op" id="4803214">(</span><span class="ident" id="4803215">value</span><span class="op" id="4803220">,</span>&nbsp;<span class="num" id="4803222">3</span><span class="op" id="4803223">)</span><br>
<span class="lineno"></span><span class="op" id="4803225">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span><span class="keyword" id="4803228">func</span>&nbsp;<span class="op" id="4803233">(</span><span class="ident" id="4803234">w</span>&nbsp;<span class="op" id="4803236">*</span><span class="ident" id="4803237">huffmanBitWriter</span><span class="op" id="4803253">)</span>&nbsp;<span class="ident" id="4803255">writeBlock</span><span class="op" id="4803265">(</span><span class="ident" id="4803266">tokens</span>&nbsp;<span class="op" id="4803273">[</span><span class="op" id="4803274">]</span><span class="ident" id="4803275">token</span><span class="op" id="4803280">,</span>&nbsp;<span class="ident" id="4803282">eof</span>&nbsp;<span class="builtintype" id="4803286">bool</span><span class="op" id="4803290">,</span>&nbsp;<span class="ident" id="4803292">input</span>&nbsp;<span class="op" id="4803298">[</span><span class="op" id="4803299">]</span><span class="builtintype" id="4803300">byte</span><span class="op" id="4803304">)</span>&nbsp;<span class="op" id="4803306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4803309">if</span>&nbsp;<span class="ident" id="4803312">w</span><span class="op" id="4803313">.</span><span class="ident" id="4803314">err</span>&nbsp;<span class="op" id="4803318">!=</span>&nbsp;<span class="builtintype" id="4803321">nil</span>&nbsp;<span class="op" id="4803325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4803329">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4803337">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4803340">for</span>&nbsp;<span class="ident" id="4803344">i</span>&nbsp;<span class="op" id="4803346">:=</span>&nbsp;<span class="keyword" id="4803349">range</span>&nbsp;<span class="ident" id="4803355">w</span><span class="op" id="4803356">.</span><span class="ident" id="4803357">literalFreq</span>&nbsp;<span class="op" id="4803369">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4803373">w</span><span class="op" id="4803374">.</span><span class="ident" id="4803375">literalFreq</span><span class="op" id="4803386">[</span><span class="ident" id="4803387">i</span><span class="op" id="4803388">]</span>&nbsp;<span class="op" id="4803390">=</span>&nbsp;<span class="num" id="4803392">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4803395">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4803398">for</span>&nbsp;<span class="ident" id="4803402">i</span>&nbsp;<span class="op" id="4803404">:=</span>&nbsp;<span class="keyword" id="4803407">range</span>&nbsp;<span class="ident" id="4803413">w</span><span class="op" id="4803414">.</span><span class="ident" id="4803415">offsetFreq</span>&nbsp;<span class="op" id="4803426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4803430">w</span><span class="op" id="4803431">.</span><span class="ident" id="4803432">offsetFreq</span><span class="op" id="4803442">[</span><span class="ident" id="4803443">i</span><span class="op" id="4803444">]</span>&nbsp;<span class="op" id="4803446">=</span>&nbsp;<span class="num" id="4803448">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4803451">}</span><br>
<span class="lineno">380</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4803455">n</span>&nbsp;<span class="op" id="4803457">:=</span>&nbsp;<span class="builtinfunc" id="4803460">len</span><span class="op" id="4803463">(</span><span class="ident" id="4803464">tokens</span><span class="op" id="4803470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4803473">tokens</span>&nbsp;<span class="op" id="4803480">=</span>&nbsp;<span class="ident" id="4803482">tokens</span><span class="op" id="4803488">[</span><span class="num" id="4803489">0</span>&nbsp;<span class="op" id="4803491">:</span>&nbsp;<span class="ident" id="4803493">n</span><span class="op" id="4803494">+</span><span class="num" id="4803495">1</span><span class="op" id="4803496">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4803499">tokens</span><span class="op" id="4803505">[</span><span class="ident" id="4803506">n</span><span class="op" id="4803507">]</span>&nbsp;<span class="op" id="4803509">=</span>&nbsp;<span class="ident" id="4803511">endBlockMarker</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4803528">for</span>&nbsp;<span class="ident" id="4803532">_</span><span class="op" id="4803533">,</span>&nbsp;<span class="ident" id="4803535">t</span>&nbsp;<span class="op" id="4803537">:=</span>&nbsp;<span class="keyword" id="4803540">range</span>&nbsp;<span class="ident" id="4803546">tokens</span>&nbsp;<span class="op" id="4803553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4803557">switch</span>&nbsp;<span class="ident" id="4803564">t</span><span class="op" id="4803565">.</span><span class="ident" id="4803566">typ</span><span class="op" id="4803569">(</span><span class="op" id="4803570">)</span>&nbsp;<span class="op" id="4803572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4803576">case</span>&nbsp;<span class="ident" id="4803581">literalType</span><span class="op" id="4803592">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4803597">w</span><span class="op" id="4803598">.</span><span class="ident" id="4803599">literalFreq</span><span class="op" id="4803610">[</span><span class="ident" id="4803611">t</span><span class="op" id="4803612">.</span><span class="ident" id="4803613">literal</span><span class="op" id="4803620">(</span><span class="op" id="4803621">)</span><span class="op" id="4803622">]</span><span class="op" id="4803623">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4803628">case</span>&nbsp;<span class="ident" id="4803633">matchType</span><span class="op" id="4803642">:</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4803647">length</span>&nbsp;<span class="op" id="4803654">:=</span>&nbsp;<span class="ident" id="4803657">t</span><span class="op" id="4803658">.</span><span class="ident" id="4803659">length</span><span class="op" id="4803665">(</span><span class="op" id="4803666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4803671">offset</span>&nbsp;<span class="op" id="4803678">:=</span>&nbsp;<span class="ident" id="4803681">t</span><span class="op" id="4803682">.</span><span class="ident" id="4803683">offset</span><span class="op" id="4803689">(</span><span class="op" id="4803690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4803695">w</span><span class="op" id="4803696">.</span><span class="ident" id="4803697">literalFreq</span><span class="op" id="4803708">[</span><span class="ident" id="4803709">lengthCodesStart</span><span class="op" id="4803725">+</span><span class="ident" id="4803726">lengthCode</span><span class="op" id="4803736">(</span><span class="ident" id="4803737">length</span><span class="op" id="4803743">)</span><span class="op" id="4803744">]</span><span class="op" id="4803745">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4803751">w</span><span class="op" id="4803752">.</span><span class="ident" id="4803753">offsetFreq</span><span class="op" id="4803763">[</span><span class="ident" id="4803764">offsetCode</span><span class="op" id="4803774">(</span><span class="ident" id="4803775">offset</span><span class="op" id="4803781">)</span><span class="op" id="4803782">]</span><span class="op" id="4803783">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4803788">}</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4803791">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4803795">//&nbsp;get&nbsp;the&nbsp;number&nbsp;of&nbsp;literals</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4803826">numLiterals</span>&nbsp;<span class="op" id="4803838">:=</span>&nbsp;<span class="builtinfunc" id="4803841">len</span><span class="op" id="4803844">(</span><span class="ident" id="4803845">w</span><span class="op" id="4803846">.</span><span class="ident" id="4803847">literalFreq</span><span class="op" id="4803858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4803861">for</span>&nbsp;<span class="ident" id="4803865">w</span><span class="op" id="4803866">.</span><span class="ident" id="4803867">literalFreq</span><span class="op" id="4803878">[</span><span class="ident" id="4803879">numLiterals</span><span class="op" id="4803890">-</span><span class="num" id="4803891">1</span><span class="op" id="4803892">]</span>&nbsp;<span class="op" id="4803894">==</span>&nbsp;<span class="num" id="4803897">0</span>&nbsp;<span class="op" id="4803899">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4803903">numLiterals</span><span class="op" id="4803914">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4803918">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4803921">//&nbsp;get&nbsp;the&nbsp;number&nbsp;of&nbsp;offsets</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4803951">numOffsets</span>&nbsp;<span class="op" id="4803962">:=</span>&nbsp;<span class="builtinfunc" id="4803965">len</span><span class="op" id="4803968">(</span><span class="ident" id="4803969">w</span><span class="op" id="4803970">.</span><span class="ident" id="4803971">offsetFreq</span><span class="op" id="4803981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4803984">for</span>&nbsp;<span class="ident" id="4803988">numOffsets</span>&nbsp;<span class="op" id="4803999">&gt;</span>&nbsp;<span class="num" id="4804001">0</span>&nbsp;<span class="op" id="4804003">&amp;&amp;</span>&nbsp;<span class="ident" id="4804006">w</span><span class="op" id="4804007">.</span><span class="ident" id="4804008">offsetFreq</span><span class="op" id="4804018">[</span><span class="ident" id="4804019">numOffsets</span><span class="op" id="4804029">-</span><span class="num" id="4804030">1</span><span class="op" id="4804031">]</span>&nbsp;<span class="op" id="4804033">==</span>&nbsp;<span class="num" id="4804036">0</span>&nbsp;<span class="op" id="4804038">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4804042">numOffsets</span><span class="op" id="4804052">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4804056">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4804059">if</span>&nbsp;<span class="ident" id="4804062">numOffsets</span>&nbsp;<span class="op" id="4804073">==</span>&nbsp;<span class="num" id="4804076">0</span>&nbsp;<span class="op" id="4804078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4804082">//&nbsp;We&nbsp;haven&#39;t&nbsp;found&nbsp;a&nbsp;single&nbsp;match.&nbsp;If&nbsp;we&nbsp;want&nbsp;to&nbsp;go&nbsp;with&nbsp;the&nbsp;dynamic&nbsp;encoding,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4804164">//&nbsp;we&nbsp;should&nbsp;count&nbsp;at&nbsp;least&nbsp;one&nbsp;offset&nbsp;to&nbsp;be&nbsp;sure&nbsp;that&nbsp;the&nbsp;offset&nbsp;huffman&nbsp;tree&nbsp;could&nbsp;be&nbsp;encoded.</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4804263">w</span><span class="op" id="4804264">.</span><span class="ident" id="4804265">offsetFreq</span><span class="op" id="4804275">[</span><span class="num" id="4804276">0</span><span class="op" id="4804277">]</span>&nbsp;<span class="op" id="4804279">=</span>&nbsp;<span class="num" id="4804281">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4804285">numOffsets</span>&nbsp;<span class="op" id="4804296">=</span>&nbsp;<span class="num" id="4804298">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4804301">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4804305">w</span><span class="op" id="4804306">.</span><span class="ident" id="4804307">literalEncoding</span><span class="op" id="4804322">.</span><span class="ident" id="4804323">generate</span><span class="op" id="4804331">(</span><span class="ident" id="4804332">w</span><span class="op" id="4804333">.</span><span class="ident" id="4804334">literalFreq</span><span class="op" id="4804345">,</span>&nbsp;<span class="num" id="4804347">15</span><span class="op" id="4804349">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4804352">w</span><span class="op" id="4804353">.</span><span class="ident" id="4804354">offsetEncoding</span><span class="op" id="4804368">.</span><span class="ident" id="4804369">generate</span><span class="op" id="4804377">(</span><span class="ident" id="4804378">w</span><span class="op" id="4804379">.</span><span class="ident" id="4804380">offsetFreq</span><span class="op" id="4804390">,</span>&nbsp;<span class="num" id="4804392">15</span><span class="op" id="4804394">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4804398">storedBytes</span>&nbsp;<span class="op" id="4804410">:=</span>&nbsp;<span class="num" id="4804413">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4804416">if</span>&nbsp;<span class="ident" id="4804419">input</span>&nbsp;<span class="op" id="4804425">!=</span>&nbsp;<span class="builtintype" id="4804428">nil</span>&nbsp;<span class="op" id="4804432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4804436">storedBytes</span>&nbsp;<span class="op" id="4804448">=</span>&nbsp;<span class="builtinfunc" id="4804450">len</span><span class="op" id="4804453">(</span><span class="ident" id="4804454">input</span><span class="op" id="4804459">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4804462">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4804465">var</span>&nbsp;<span class="ident" id="4804469">extraBits</span>&nbsp;<span class="ident" id="4804479">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4804486">var</span>&nbsp;<span class="ident" id="4804490">storedSize</span>&nbsp;<span class="ident" id="4804501">int64</span>&nbsp;<span class="op" id="4804507">=</span>&nbsp;<span class="ident" id="4804509">math</span><span class="op" id="4804513">.</span><span class="ident" id="4804514">MaxInt64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4804524">if</span>&nbsp;<span class="ident" id="4804527">storedBytes</span>&nbsp;<span class="op" id="4804539">&lt;=</span>&nbsp;<span class="ident" id="4804542">maxStoreBlockSize</span>&nbsp;<span class="op" id="4804560">&amp;&amp;</span>&nbsp;<span class="ident" id="4804563">input</span>&nbsp;<span class="op" id="4804569">!=</span>&nbsp;<span class="builtintype" id="4804572">nil</span>&nbsp;<span class="op" id="4804576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4804580">storedSize</span>&nbsp;<span class="op" id="4804591">=</span>&nbsp;<span class="ident" id="4804593">int64</span><span class="op" id="4804598">(</span><span class="op" id="4804599">(</span><span class="ident" id="4804600">storedBytes</span>&nbsp;<span class="op" id="4804612">+</span>&nbsp;<span class="num" id="4804614">5</span><span class="op" id="4804615">)</span>&nbsp;<span class="op" id="4804617">*</span>&nbsp;<span class="num" id="4804619">8</span><span class="op" id="4804620">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4804624">//&nbsp;We&nbsp;only&nbsp;bother&nbsp;calculating&nbsp;the&nbsp;costs&nbsp;of&nbsp;the&nbsp;extra&nbsp;bits&nbsp;required&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4804696">//&nbsp;the&nbsp;length&nbsp;of&nbsp;offset&nbsp;fields&nbsp;(which&nbsp;will&nbsp;be&nbsp;the&nbsp;same&nbsp;for&nbsp;both&nbsp;fixed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4804768">//&nbsp;and&nbsp;dynamic&nbsp;encoding),&nbsp;if&nbsp;we&nbsp;need&nbsp;to&nbsp;compare&nbsp;those&nbsp;two&nbsp;encodings</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4804838">//&nbsp;against&nbsp;stored&nbsp;encoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4804868">for</span>&nbsp;<span class="ident" id="4804872">lengthCode</span>&nbsp;<span class="op" id="4804883">:=</span>&nbsp;<span class="ident" id="4804886">lengthCodesStart</span>&nbsp;<span class="op" id="4804903">+</span>&nbsp;<span class="num" id="4804905">8</span><span class="op" id="4804906">;</span>&nbsp;<span class="ident" id="4804908">lengthCode</span>&nbsp;<span class="op" id="4804919">&lt;</span>&nbsp;<span class="ident" id="4804921">numLiterals</span><span class="op" id="4804932">;</span>&nbsp;<span class="ident" id="4804934">lengthCode</span><span class="op" id="4804944">++</span>&nbsp;<span class="op" id="4804947">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4804952">//&nbsp;First&nbsp;eight&nbsp;length&nbsp;codes&nbsp;have&nbsp;extra&nbsp;size&nbsp;=&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4805004">extraBits</span>&nbsp;<span class="op" id="4805014">+=</span>&nbsp;<span class="ident" id="4805017">int64</span><span class="op" id="4805022">(</span><span class="ident" id="4805023">w</span><span class="op" id="4805024">.</span><span class="ident" id="4805025">literalFreq</span><span class="op" id="4805036">[</span><span class="ident" id="4805037">lengthCode</span><span class="op" id="4805047">]</span><span class="op" id="4805048">)</span>&nbsp;<span class="op" id="4805050">*</span>&nbsp;<span class="ident" id="4805052">int64</span><span class="op" id="4805057">(</span><span class="ident" id="4805058">lengthExtraBits</span><span class="op" id="4805073">[</span><span class="ident" id="4805074">lengthCode</span><span class="op" id="4805084">-</span><span class="ident" id="4805085">lengthCodesStart</span><span class="op" id="4805101">]</span><span class="op" id="4805102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4805106">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4805110">for</span>&nbsp;<span class="ident" id="4805114">offsetCode</span>&nbsp;<span class="op" id="4805125">:=</span>&nbsp;<span class="num" id="4805128">4</span><span class="op" id="4805129">;</span>&nbsp;<span class="ident" id="4805131">offsetCode</span>&nbsp;<span class="op" id="4805142">&lt;</span>&nbsp;<span class="ident" id="4805144">numOffsets</span><span class="op" id="4805154">;</span>&nbsp;<span class="ident" id="4805156">offsetCode</span><span class="op" id="4805166">++</span>&nbsp;<span class="op" id="4805169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4805174">//&nbsp;First&nbsp;four&nbsp;offset&nbsp;codes&nbsp;have&nbsp;extra&nbsp;size&nbsp;=&nbsp;0.</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4805225">extraBits</span>&nbsp;<span class="op" id="4805235">+=</span>&nbsp;<span class="ident" id="4805238">int64</span><span class="op" id="4805243">(</span><span class="ident" id="4805244">w</span><span class="op" id="4805245">.</span><span class="ident" id="4805246">offsetFreq</span><span class="op" id="4805256">[</span><span class="ident" id="4805257">offsetCode</span><span class="op" id="4805267">]</span><span class="op" id="4805268">)</span>&nbsp;<span class="op" id="4805270">*</span>&nbsp;<span class="ident" id="4805272">int64</span><span class="op" id="4805277">(</span><span class="ident" id="4805278">offsetExtraBits</span><span class="op" id="4805293">[</span><span class="ident" id="4805294">offsetCode</span><span class="op" id="4805304">]</span><span class="op" id="4805305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4805309">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4805312">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4805316">//&nbsp;Figure&nbsp;out&nbsp;smallest&nbsp;code.</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4805346">//&nbsp;Fixed&nbsp;Huffman&nbsp;baseline.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4805374">var</span>&nbsp;<span class="ident" id="4805378">size</span>&nbsp;<span class="op" id="4805383">=</span>&nbsp;<span class="ident" id="4805385">int64</span><span class="op" id="4805390">(</span><span class="num" id="4805391">3</span><span class="op" id="4805392">)</span>&nbsp;<span class="op" id="4805394">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4805398">fixedLiteralEncoding</span><span class="op" id="4805418">.</span><span class="ident" id="4805419">bitLength</span><span class="op" id="4805428">(</span><span class="ident" id="4805429">w</span><span class="op" id="4805430">.</span><span class="ident" id="4805431">literalFreq</span><span class="op" id="4805442">)</span>&nbsp;<span class="op" id="4805444">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4805448">fixedOffsetEncoding</span><span class="op" id="4805467">.</span><span class="ident" id="4805468">bitLength</span><span class="op" id="4805477">(</span><span class="ident" id="4805478">w</span><span class="op" id="4805479">.</span><span class="ident" id="4805480">offsetFreq</span><span class="op" id="4805490">)</span>&nbsp;<span class="op" id="4805492">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4805496">extraBits</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4805507">var</span>&nbsp;<span class="ident" id="4805511">literalEncoding</span>&nbsp;<span class="op" id="4805527">=</span>&nbsp;<span class="ident" id="4805529">fixedLiteralEncoding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4805551">var</span>&nbsp;<span class="ident" id="4805555">offsetEncoding</span>&nbsp;<span class="op" id="4805570">=</span>&nbsp;<span class="ident" id="4805572">fixedOffsetEncoding</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4805594">//&nbsp;Dynamic&nbsp;Huffman?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4805615">var</span>&nbsp;<span class="ident" id="4805619">numCodegens</span>&nbsp;<span class="builtintype" id="4805631">int</span><br>
<span class="lineno">450</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4805637">//&nbsp;Generate&nbsp;codegen&nbsp;and&nbsp;codegenFrequencies,&nbsp;which&nbsp;indicates&nbsp;how&nbsp;to&nbsp;encode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4805712">//&nbsp;the&nbsp;literalEncoding&nbsp;and&nbsp;the&nbsp;offsetEncoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4805760">w</span><span class="op" id="4805761">.</span><span class="ident" id="4805762">generateCodegen</span><span class="op" id="4805777">(</span><span class="ident" id="4805778">numLiterals</span><span class="op" id="4805789">,</span>&nbsp;<span class="ident" id="4805791">numOffsets</span><span class="op" id="4805801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4805804">w</span><span class="op" id="4805805">.</span><span class="ident" id="4805806">codegenEncoding</span><span class="op" id="4805821">.</span><span class="ident" id="4805822">generate</span><span class="op" id="4805830">(</span><span class="ident" id="4805831">w</span><span class="op" id="4805832">.</span><span class="ident" id="4805833">codegenFreq</span><span class="op" id="4805844">,</span>&nbsp;<span class="num" id="4805846">7</span><span class="op" id="4805847">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4805850">numCodegens</span>&nbsp;<span class="op" id="4805862">=</span>&nbsp;<span class="builtinfunc" id="4805864">len</span><span class="op" id="4805867">(</span><span class="ident" id="4805868">w</span><span class="op" id="4805869">.</span><span class="ident" id="4805870">codegenFreq</span><span class="op" id="4805881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4805884">for</span>&nbsp;<span class="ident" id="4805888">numCodegens</span>&nbsp;<span class="op" id="4805900">&gt;</span>&nbsp;<span class="num" id="4805902">4</span>&nbsp;<span class="op" id="4805904">&amp;&amp;</span>&nbsp;<span class="ident" id="4805907">w</span><span class="op" id="4805908">.</span><span class="ident" id="4805909">codegenFreq</span><span class="op" id="4805920">[</span><span class="ident" id="4805921">codegenOrder</span><span class="op" id="4805933">[</span><span class="ident" id="4805934">numCodegens</span><span class="op" id="4805945">-</span><span class="num" id="4805946">1</span><span class="op" id="4805947">]</span><span class="op" id="4805948">]</span>&nbsp;<span class="op" id="4805950">==</span>&nbsp;<span class="num" id="4805953">0</span>&nbsp;<span class="op" id="4805955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4805959">numCodegens</span><span class="op" id="4805970">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4805974">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4805977">dynamicHeader</span>&nbsp;<span class="op" id="4805991">:=</span>&nbsp;<span class="ident" id="4805994">int64</span><span class="op" id="4805999">(</span><span class="num" id="4806000">3</span><span class="op" id="4806001">+</span><span class="num" id="4806002">5</span><span class="op" id="4806003">+</span><span class="num" id="4806004">5</span><span class="op" id="4806005">+</span><span class="num" id="4806006">4</span><span class="op" id="4806007">+</span><span class="op" id="4806008">(</span><span class="num" id="4806009">3</span><span class="op" id="4806010">*</span><span class="ident" id="4806011">numCodegens</span><span class="op" id="4806022">)</span><span class="op" id="4806023">)</span>&nbsp;<span class="op" id="4806025">+</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4806029">w</span><span class="op" id="4806030">.</span><span class="ident" id="4806031">codegenEncoding</span><span class="op" id="4806046">.</span><span class="ident" id="4806047">bitLength</span><span class="op" id="4806056">(</span><span class="ident" id="4806057">w</span><span class="op" id="4806058">.</span><span class="ident" id="4806059">codegenFreq</span><span class="op" id="4806070">)</span>&nbsp;<span class="op" id="4806072">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4806076">int64</span><span class="op" id="4806081">(</span><span class="ident" id="4806082">extraBits</span><span class="op" id="4806091">)</span>&nbsp;<span class="op" id="4806093">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4806097">int64</span><span class="op" id="4806102">(</span><span class="ident" id="4806103">w</span><span class="op" id="4806104">.</span><span class="ident" id="4806105">codegenFreq</span><span class="op" id="4806116">[</span><span class="num" id="4806117">16</span><span class="op" id="4806119">]</span><span class="op" id="4806120">*</span><span class="num" id="4806121">2</span><span class="op" id="4806122">)</span>&nbsp;<span class="op" id="4806124">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4806128">int64</span><span class="op" id="4806133">(</span><span class="ident" id="4806134">w</span><span class="op" id="4806135">.</span><span class="ident" id="4806136">codegenFreq</span><span class="op" id="4806147">[</span><span class="num" id="4806148">17</span><span class="op" id="4806150">]</span><span class="op" id="4806151">*</span><span class="num" id="4806152">3</span><span class="op" id="4806153">)</span>&nbsp;<span class="op" id="4806155">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4806159">int64</span><span class="op" id="4806164">(</span><span class="ident" id="4806165">w</span><span class="op" id="4806166">.</span><span class="ident" id="4806167">codegenFreq</span><span class="op" id="4806178">[</span><span class="num" id="4806179">18</span><span class="op" id="4806181">]</span><span class="op" id="4806182">*</span><span class="num" id="4806183">7</span><span class="op" id="4806184">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4806187">dynamicSize</span>&nbsp;<span class="op" id="4806199">:=</span>&nbsp;<span class="ident" id="4806202">dynamicHeader</span>&nbsp;<span class="op" id="4806216">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4806220">w</span><span class="op" id="4806221">.</span><span class="ident" id="4806222">literalEncoding</span><span class="op" id="4806237">.</span><span class="ident" id="4806238">bitLength</span><span class="op" id="4806247">(</span><span class="ident" id="4806248">w</span><span class="op" id="4806249">.</span><span class="ident" id="4806250">literalFreq</span><span class="op" id="4806261">)</span>&nbsp;<span class="op" id="4806263">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4806267">w</span><span class="op" id="4806268">.</span><span class="ident" id="4806269">offsetEncoding</span><span class="op" id="4806283">.</span><span class="ident" id="4806284">bitLength</span><span class="op" id="4806293">(</span><span class="ident" id="4806294">w</span><span class="op" id="4806295">.</span><span class="ident" id="4806296">offsetFreq</span><span class="op" id="4806306">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4806310">if</span>&nbsp;<span class="ident" id="4806313">dynamicSize</span>&nbsp;<span class="op" id="4806325">&lt;</span>&nbsp;<span class="ident" id="4806327">size</span>&nbsp;<span class="op" id="4806332">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4806336">size</span>&nbsp;<span class="op" id="4806341">=</span>&nbsp;<span class="ident" id="4806343">dynamicSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4806357">literalEncoding</span>&nbsp;<span class="op" id="4806373">=</span>&nbsp;<span class="ident" id="4806375">w</span><span class="op" id="4806376">.</span><span class="ident" id="4806377">literalEncoding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4806395">offsetEncoding</span>&nbsp;<span class="op" id="4806410">=</span>&nbsp;<span class="ident" id="4806412">w</span><span class="op" id="4806413">.</span><span class="ident" id="4806414">offsetEncoding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4806430">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4806434">//&nbsp;Stored&nbsp;bytes?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4806452">if</span>&nbsp;<span class="ident" id="4806455">storedSize</span>&nbsp;<span class="op" id="4806466">&lt;</span>&nbsp;<span class="ident" id="4806468">size</span>&nbsp;<span class="op" id="4806473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4806477">w</span><span class="op" id="4806478">.</span><span class="ident" id="4806479">writeStoredHeader</span><span class="op" id="4806496">(</span><span class="ident" id="4806497">storedBytes</span><span class="op" id="4806508">,</span>&nbsp;<span class="ident" id="4806510">eof</span><span class="op" id="4806513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4806517">w</span><span class="op" id="4806518">.</span><span class="ident" id="4806519">writeBytes</span><span class="op" id="4806529">(</span><span class="ident" id="4806530">input</span><span class="op" id="4806535">[</span><span class="num" id="4806536">0</span><span class="op" id="4806537">:</span><span class="ident" id="4806538">storedBytes</span><span class="op" id="4806549">]</span><span class="op" id="4806550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4806554">return</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4806562">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4806566">//&nbsp;Huffman.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4806579">if</span>&nbsp;<span class="ident" id="4806582">literalEncoding</span>&nbsp;<span class="op" id="4806598">==</span>&nbsp;<span class="ident" id="4806601">fixedLiteralEncoding</span>&nbsp;<span class="op" id="4806622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4806626">w</span><span class="op" id="4806627">.</span><span class="ident" id="4806628">writeFixedHeader</span><span class="op" id="4806644">(</span><span class="ident" id="4806645">eof</span><span class="op" id="4806648">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4806651">}</span>&nbsp;<span class="keyword" id="4806653">else</span>&nbsp;<span class="op" id="4806658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4806662">w</span><span class="op" id="4806663">.</span><span class="ident" id="4806664">writeDynamicHeader</span><span class="op" id="4806682">(</span><span class="ident" id="4806683">numLiterals</span><span class="op" id="4806694">,</span>&nbsp;<span class="ident" id="4806696">numOffsets</span><span class="op" id="4806706">,</span>&nbsp;<span class="ident" id="4806708">numCodegens</span><span class="op" id="4806719">,</span>&nbsp;<span class="ident" id="4806721">eof</span><span class="op" id="4806724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4806727">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4806730">for</span>&nbsp;<span class="ident" id="4806734">_</span><span class="op" id="4806735">,</span>&nbsp;<span class="ident" id="4806737">t</span>&nbsp;<span class="op" id="4806739">:=</span>&nbsp;<span class="keyword" id="4806742">range</span>&nbsp;<span class="ident" id="4806748">tokens</span>&nbsp;<span class="op" id="4806755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4806759">switch</span>&nbsp;<span class="ident" id="4806766">t</span><span class="op" id="4806767">.</span><span class="ident" id="4806768">typ</span><span class="op" id="4806771">(</span><span class="op" id="4806772">)</span>&nbsp;<span class="op" id="4806774">{</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4806778">case</span>&nbsp;<span class="ident" id="4806783">literalType</span><span class="op" id="4806794">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4806799">w</span><span class="op" id="4806800">.</span><span class="ident" id="4806801">writeCode</span><span class="op" id="4806810">(</span><span class="ident" id="4806811">literalEncoding</span><span class="op" id="4806826">,</span>&nbsp;<span class="ident" id="4806828">t</span><span class="op" id="4806829">.</span><span class="ident" id="4806830">literal</span><span class="op" id="4806837">(</span><span class="op" id="4806838">)</span><span class="op" id="4806839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4806844">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4806852">case</span>&nbsp;<span class="ident" id="4806857">matchType</span><span class="op" id="4806866">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4806871">//&nbsp;Write&nbsp;the&nbsp;length</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4806894">length</span>&nbsp;<span class="op" id="4806901">:=</span>&nbsp;<span class="ident" id="4806904">t</span><span class="op" id="4806905">.</span><span class="ident" id="4806906">length</span><span class="op" id="4806912">(</span><span class="op" id="4806913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4806918">lengthCode</span>&nbsp;<span class="op" id="4806929">:=</span>&nbsp;<span class="ident" id="4806932">lengthCode</span><span class="op" id="4806942">(</span><span class="ident" id="4806943">length</span><span class="op" id="4806949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4806954">w</span><span class="op" id="4806955">.</span><span class="ident" id="4806956">writeCode</span><span class="op" id="4806965">(</span><span class="ident" id="4806966">literalEncoding</span><span class="op" id="4806981">,</span>&nbsp;<span class="ident" id="4806983">lengthCode</span><span class="op" id="4806993">+</span><span class="ident" id="4806994">lengthCodesStart</span><span class="op" id="4807010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4807015">extraLengthBits</span>&nbsp;<span class="op" id="4807031">:=</span>&nbsp;<span class="builtintype" id="4807034">int32</span><span class="op" id="4807039">(</span><span class="ident" id="4807040">lengthExtraBits</span><span class="op" id="4807055">[</span><span class="ident" id="4807056">lengthCode</span><span class="op" id="4807066">]</span><span class="op" id="4807067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4807072">if</span>&nbsp;<span class="ident" id="4807075">extraLengthBits</span>&nbsp;<span class="op" id="4807091">&gt;</span>&nbsp;<span class="num" id="4807093">0</span>&nbsp;<span class="op" id="4807095">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4807101">extraLength</span>&nbsp;<span class="op" id="4807113">:=</span>&nbsp;<span class="builtintype" id="4807116">int32</span><span class="op" id="4807121">(</span><span class="ident" id="4807122">length</span>&nbsp;<span class="op" id="4807129">-</span>&nbsp;<span class="ident" id="4807131">lengthBase</span><span class="op" id="4807141">[</span><span class="ident" id="4807142">lengthCode</span><span class="op" id="4807152">]</span><span class="op" id="4807153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4807159">w</span><span class="op" id="4807160">.</span><span class="ident" id="4807161">writeBits</span><span class="op" id="4807170">(</span><span class="ident" id="4807171">extraLength</span><span class="op" id="4807182">,</span>&nbsp;<span class="ident" id="4807184">extraLengthBits</span><span class="op" id="4807199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4807204">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4807209">//&nbsp;Write&nbsp;the&nbsp;offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4807232">offset</span>&nbsp;<span class="op" id="4807239">:=</span>&nbsp;<span class="ident" id="4807242">t</span><span class="op" id="4807243">.</span><span class="ident" id="4807244">offset</span><span class="op" id="4807250">(</span><span class="op" id="4807251">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4807256">offsetCode</span>&nbsp;<span class="op" id="4807267">:=</span>&nbsp;<span class="ident" id="4807270">offsetCode</span><span class="op" id="4807280">(</span><span class="ident" id="4807281">offset</span><span class="op" id="4807287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4807292">w</span><span class="op" id="4807293">.</span><span class="ident" id="4807294">writeCode</span><span class="op" id="4807303">(</span><span class="ident" id="4807304">offsetEncoding</span><span class="op" id="4807318">,</span>&nbsp;<span class="ident" id="4807320">offsetCode</span><span class="op" id="4807330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4807335">extraOffsetBits</span>&nbsp;<span class="op" id="4807351">:=</span>&nbsp;<span class="builtintype" id="4807354">int32</span><span class="op" id="4807359">(</span><span class="ident" id="4807360">offsetExtraBits</span><span class="op" id="4807375">[</span><span class="ident" id="4807376">offsetCode</span><span class="op" id="4807386">]</span><span class="op" id="4807387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4807392">if</span>&nbsp;<span class="ident" id="4807395">extraOffsetBits</span>&nbsp;<span class="op" id="4807411">&gt;</span>&nbsp;<span class="num" id="4807413">0</span>&nbsp;<span class="op" id="4807415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4807421">extraOffset</span>&nbsp;<span class="op" id="4807433">:=</span>&nbsp;<span class="builtintype" id="4807436">int32</span><span class="op" id="4807441">(</span><span class="ident" id="4807442">offset</span>&nbsp;<span class="op" id="4807449">-</span>&nbsp;<span class="ident" id="4807451">offsetBase</span><span class="op" id="4807461">[</span><span class="ident" id="4807462">offsetCode</span><span class="op" id="4807472">]</span><span class="op" id="4807473">)</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4807479">w</span><span class="op" id="4807480">.</span><span class="ident" id="4807481">writeBits</span><span class="op" id="4807490">(</span><span class="ident" id="4807491">extraOffset</span><span class="op" id="4807502">,</span>&nbsp;<span class="ident" id="4807504">extraOffsetBits</span><span class="op" id="4807519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4807524">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4807529">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4807537">default</span><span class="op" id="4807544">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4807549">panic</span><span class="op" id="4807554">(</span><span class="string" id="4807555">&#34;unknown&nbsp;token&nbsp;type:&nbsp;&#34;</span>&nbsp;<span class="op" id="4807578">+</span>&nbsp;<span class="builtintype" id="4807580">string</span><span class="op" id="4807586">(</span><span class="ident" id="4807587">t</span><span class="op" id="4807588">)</span><span class="op" id="4807589">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4807593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4807596">}</span><br>
<span class="lineno"></span><span class="op" id="4807598">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
