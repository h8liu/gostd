<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/rc4</h2>
<ul>
<li><a href="/gostd/crypto/rc4/rc4.go.html" class="current">rc4.go</a></li>
<li><a href="/gostd/crypto/rc4/rc4_asm.go.html">rc4_asm.go</a></li>
<li><a href="/gostd/crypto/rc4/rc4_test.go.html">rc4_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4027206">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4027261">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4027315">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4027366">//&nbsp;Package&nbsp;rc4&nbsp;implements&nbsp;RC4&nbsp;encryption,&nbsp;as&nbsp;defined&nbsp;in&nbsp;Bruce&nbsp;Schneier&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="4027439">//&nbsp;Applied&nbsp;Cryptography.</span><br>
<span class="lineno"></span><span class="keyword" id="4027464">package</span>&nbsp;<span class="ident" id="4027472">rc4</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4027477">//&nbsp;BUG(agl):&nbsp;RC4&nbsp;is&nbsp;in&nbsp;common&nbsp;use&nbsp;but&nbsp;has&nbsp;design&nbsp;weaknesses&nbsp;that&nbsp;make</span><br>
<span class="lineno">10</span><span class="comment" id="4027547">//&nbsp;it&nbsp;a&nbsp;poor&nbsp;choice&nbsp;for&nbsp;new&nbsp;protocols.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4027587">import</span>&nbsp;<span class="string" id="4027594">&#34;strconv&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4027605">//&nbsp;A&nbsp;Cipher&nbsp;is&nbsp;an&nbsp;instance&nbsp;of&nbsp;RC4&nbsp;using&nbsp;a&nbsp;particular&nbsp;key.</span><br>
<span class="lineno">15</span><span class="keyword" id="4027663">type</span>&nbsp;<span class="ident" id="4027668">Cipher</span>&nbsp;<span class="keyword" id="4027675">struct</span>&nbsp;<span class="op" id="4027682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4027685">s</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4027690">[</span><span class="num" id="4027691">256</span><span class="op" id="4027694">]</span><span class="builtintype" id="4027695">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4027703">i</span><span class="op" id="4027704">,</span>&nbsp;<span class="ident" id="4027706">j</span>&nbsp;<span class="builtintype" id="4027708">uint8</span><br>
<span class="lineno"></span><span class="op" id="4027714">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="4027717">type</span>&nbsp;<span class="ident" id="4027722">KeySizeError</span>&nbsp;<span class="builtintype" id="4027735">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4027740">func</span>&nbsp;<span class="op" id="4027745">(</span><span class="ident" id="4027746">k</span>&nbsp;<span class="ident" id="4027748">KeySizeError</span><span class="op" id="4027760">)</span>&nbsp;<span class="ident" id="4027762">Error</span><span class="op" id="4027767">(</span><span class="op" id="4027768">)</span>&nbsp;<span class="builtintype" id="4027770">string</span>&nbsp;<span class="op" id="4027777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4027780">return</span>&nbsp;<span class="string" id="4027787">&#34;crypto/rc4:&nbsp;invalid&nbsp;key&nbsp;size&nbsp;&#34;</span>&nbsp;<span class="op" id="4027819">+</span>&nbsp;<span class="ident" id="4027821">strconv</span><span class="op" id="4027828">.</span><span class="ident" id="4027829">Itoa</span><span class="op" id="4027833">(</span><span class="builtintype" id="4027834">int</span><span class="op" id="4027837">(</span><span class="ident" id="4027838">k</span><span class="op" id="4027839">)</span><span class="op" id="4027840">)</span><br>
<span class="lineno"></span><span class="op" id="4027842">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="comment" id="4027845">//&nbsp;NewCipher&nbsp;creates&nbsp;and&nbsp;returns&nbsp;a&nbsp;new&nbsp;Cipher.&nbsp;&nbsp;The&nbsp;key&nbsp;argument&nbsp;should&nbsp;be&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4027924">//&nbsp;RC4&nbsp;key,&nbsp;at&nbsp;least&nbsp;1&nbsp;byte&nbsp;and&nbsp;at&nbsp;most&nbsp;256&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="4027975">func</span>&nbsp;<span class="ident" id="4027980">NewCipher</span><span class="op" id="4027989">(</span><span class="ident" id="4027990">key</span>&nbsp;<span class="op" id="4027994">[</span><span class="op" id="4027995">]</span><span class="builtintype" id="4027996">byte</span><span class="op" id="4028000">)</span>&nbsp;<span class="op" id="4028002">(</span><span class="op" id="4028003">*</span><span class="ident" id="4028004">Cipher</span><span class="op" id="4028010">,</span>&nbsp;<span class="builtintype" id="4028012">error</span><span class="op" id="4028017">)</span>&nbsp;<span class="op" id="4028019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4028022">k</span>&nbsp;<span class="op" id="4028024">:=</span>&nbsp;<span class="builtinfunc" id="4028027">len</span><span class="op" id="4028030">(</span><span class="ident" id="4028031">key</span><span class="op" id="4028034">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4028037">if</span>&nbsp;<span class="ident" id="4028040">k</span>&nbsp;<span class="op" id="4028042">&lt;</span>&nbsp;<span class="num" id="4028044">1</span>&nbsp;<span class="op" id="4028046">||</span>&nbsp;<span class="ident" id="4028049">k</span>&nbsp;<span class="op" id="4028051">&gt;</span>&nbsp;<span class="num" id="4028053">256</span>&nbsp;<span class="op" id="4028057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4028061">return</span>&nbsp;<span class="ident" id="4028068">nil</span><span class="op" id="4028071">,</span>&nbsp;<span class="ident" id="4028073">KeySizeError</span><span class="op" id="4028085">(</span><span class="ident" id="4028086">k</span><span class="op" id="4028087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4028090">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4028093">var</span>&nbsp;<span class="ident" id="4028097">c</span>&nbsp;<span class="ident" id="4028099">Cipher</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4028107">for</span>&nbsp;<span class="ident" id="4028111">i</span>&nbsp;<span class="op" id="4028113">:=</span>&nbsp;<span class="num" id="4028116">0</span><span class="op" id="4028117">;</span>&nbsp;<span class="ident" id="4028119">i</span>&nbsp;<span class="op" id="4028121">&lt;</span>&nbsp;<span class="num" id="4028123">256</span><span class="op" id="4028126">;</span>&nbsp;<span class="ident" id="4028128">i</span><span class="op" id="4028129">++</span>&nbsp;<span class="op" id="4028132">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4028136">c</span><span class="op" id="4028137">.</span><span class="ident" id="4028138">s</span><span class="op" id="4028139">[</span><span class="ident" id="4028140">i</span><span class="op" id="4028141">]</span>&nbsp;<span class="op" id="4028143">=</span>&nbsp;<span class="builtintype" id="4028145">uint32</span><span class="op" id="4028151">(</span><span class="ident" id="4028152">i</span><span class="op" id="4028153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4028156">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4028159">var</span>&nbsp;<span class="ident" id="4028163">j</span>&nbsp;<span class="builtintype" id="4028165">uint8</span>&nbsp;<span class="op" id="4028171">=</span>&nbsp;<span class="num" id="4028173">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4028176">for</span>&nbsp;<span class="ident" id="4028180">i</span>&nbsp;<span class="op" id="4028182">:=</span>&nbsp;<span class="num" id="4028185">0</span><span class="op" id="4028186">;</span>&nbsp;<span class="ident" id="4028188">i</span>&nbsp;<span class="op" id="4028190">&lt;</span>&nbsp;<span class="num" id="4028192">256</span><span class="op" id="4028195">;</span>&nbsp;<span class="ident" id="4028197">i</span><span class="op" id="4028198">++</span>&nbsp;<span class="op" id="4028201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4028205">j</span>&nbsp;<span class="op" id="4028207">+=</span>&nbsp;<span class="builtintype" id="4028210">uint8</span><span class="op" id="4028215">(</span><span class="ident" id="4028216">c</span><span class="op" id="4028217">.</span><span class="ident" id="4028218">s</span><span class="op" id="4028219">[</span><span class="ident" id="4028220">i</span><span class="op" id="4028221">]</span><span class="op" id="4028222">)</span>&nbsp;<span class="op" id="4028224">+</span>&nbsp;<span class="ident" id="4028226">key</span><span class="op" id="4028229">[</span><span class="ident" id="4028230">i</span><span class="op" id="4028231">%</span><span class="ident" id="4028232">k</span><span class="op" id="4028233">]</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4028237">c</span><span class="op" id="4028238">.</span><span class="ident" id="4028239">s</span><span class="op" id="4028240">[</span><span class="ident" id="4028241">i</span><span class="op" id="4028242">]</span><span class="op" id="4028243">,</span>&nbsp;<span class="ident" id="4028245">c</span><span class="op" id="4028246">.</span><span class="ident" id="4028247">s</span><span class="op" id="4028248">[</span><span class="ident" id="4028249">j</span><span class="op" id="4028250">]</span>&nbsp;<span class="op" id="4028252">=</span>&nbsp;<span class="ident" id="4028254">c</span><span class="op" id="4028255">.</span><span class="ident" id="4028256">s</span><span class="op" id="4028257">[</span><span class="ident" id="4028258">j</span><span class="op" id="4028259">]</span><span class="op" id="4028260">,</span>&nbsp;<span class="ident" id="4028262">c</span><span class="op" id="4028263">.</span><span class="ident" id="4028264">s</span><span class="op" id="4028265">[</span><span class="ident" id="4028266">i</span><span class="op" id="4028267">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4028270">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4028273">return</span>&nbsp;<span class="op" id="4028280">&amp;</span><span class="ident" id="4028281">c</span><span class="op" id="4028282">,</span>&nbsp;<span class="ident" id="4028284">nil</span><br>
<span class="lineno"></span><span class="op" id="4028288">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="4028291">//&nbsp;Reset&nbsp;zeros&nbsp;the&nbsp;key&nbsp;data&nbsp;so&nbsp;that&nbsp;it&nbsp;will&nbsp;no&nbsp;longer&nbsp;appear&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4028359">//&nbsp;process&#39;s&nbsp;memory.</span><br>
<span class="lineno"></span><span class="keyword" id="4028380">func</span>&nbsp;<span class="op" id="4028385">(</span><span class="ident" id="4028386">c</span>&nbsp;<span class="op" id="4028388">*</span><span class="ident" id="4028389">Cipher</span><span class="op" id="4028395">)</span>&nbsp;<span class="ident" id="4028397">Reset</span><span class="op" id="4028402">(</span><span class="op" id="4028403">)</span>&nbsp;<span class="op" id="4028405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4028408">for</span>&nbsp;<span class="ident" id="4028412">i</span>&nbsp;<span class="op" id="4028414">:=</span>&nbsp;<span class="keyword" id="4028417">range</span>&nbsp;<span class="ident" id="4028423">c</span><span class="op" id="4028424">.</span><span class="ident" id="4028425">s</span>&nbsp;<span class="op" id="4028427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4028431">c</span><span class="op" id="4028432">.</span><span class="ident" id="4028433">s</span><span class="op" id="4028434">[</span><span class="ident" id="4028435">i</span><span class="op" id="4028436">]</span>&nbsp;<span class="op" id="4028438">=</span>&nbsp;<span class="num" id="4028440">0</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4028443">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4028446">c</span><span class="op" id="4028447">.</span><span class="ident" id="4028448">i</span><span class="op" id="4028449">,</span>&nbsp;<span class="ident" id="4028451">c</span><span class="op" id="4028452">.</span><span class="ident" id="4028453">j</span>&nbsp;<span class="op" id="4028455">=</span>&nbsp;<span class="num" id="4028457">0</span><span class="op" id="4028458">,</span>&nbsp;<span class="num" id="4028460">0</span><br>
<span class="lineno"></span><span class="op" id="4028462">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4028465">//&nbsp;xorKeyStreamGeneric&nbsp;sets&nbsp;dst&nbsp;to&nbsp;the&nbsp;result&nbsp;of&nbsp;XORing&nbsp;src&nbsp;with&nbsp;the</span><br>
<span class="lineno">55</span><span class="comment" id="4028534">//&nbsp;key&nbsp;stream.&nbsp;&nbsp;Dst&nbsp;and&nbsp;src&nbsp;may&nbsp;be&nbsp;the&nbsp;same&nbsp;slice&nbsp;but&nbsp;otherwise&nbsp;should</span><br>
<span class="lineno"></span><span class="comment" id="4028605">//&nbsp;not&nbsp;overlap.</span><br>
<span class="lineno"></span><span class="comment" id="4028621">//</span><br>
<span class="lineno"></span><span class="comment" id="4028624">//&nbsp;This&nbsp;is&nbsp;the&nbsp;pure&nbsp;Go&nbsp;version.&nbsp;rc4_{amd64,386,arm}*&nbsp;contain&nbsp;assembly</span><br>
<span class="lineno"></span><span class="comment" id="4028694">//&nbsp;implementations.&nbsp;This&nbsp;is&nbsp;here&nbsp;for&nbsp;tests&nbsp;and&nbsp;to&nbsp;prevent&nbsp;bitrot.</span><br>
<span class="lineno">60</span><span class="keyword" id="4028760">func</span>&nbsp;<span class="op" id="4028765">(</span><span class="ident" id="4028766">c</span>&nbsp;<span class="op" id="4028768">*</span><span class="ident" id="4028769">Cipher</span><span class="op" id="4028775">)</span>&nbsp;<span class="ident" id="4028777">xorKeyStreamGeneric</span><span class="op" id="4028796">(</span><span class="ident" id="4028797">dst</span><span class="op" id="4028800">,</span>&nbsp;<span class="ident" id="4028802">src</span>&nbsp;<span class="op" id="4028806">[</span><span class="op" id="4028807">]</span><span class="builtintype" id="4028808">byte</span><span class="op" id="4028812">)</span>&nbsp;<span class="op" id="4028814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4028817">i</span><span class="op" id="4028818">,</span>&nbsp;<span class="ident" id="4028820">j</span>&nbsp;<span class="op" id="4028822">:=</span>&nbsp;<span class="ident" id="4028825">c</span><span class="op" id="4028826">.</span><span class="ident" id="4028827">i</span><span class="op" id="4028828">,</span>&nbsp;<span class="ident" id="4028830">c</span><span class="op" id="4028831">.</span><span class="ident" id="4028832">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4028835">for</span>&nbsp;<span class="ident" id="4028839">k</span><span class="op" id="4028840">,</span>&nbsp;<span class="ident" id="4028842">v</span>&nbsp;<span class="op" id="4028844">:=</span>&nbsp;<span class="keyword" id="4028847">range</span>&nbsp;<span class="ident" id="4028853">src</span>&nbsp;<span class="op" id="4028857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4028861">i</span>&nbsp;<span class="op" id="4028863">+=</span>&nbsp;<span class="num" id="4028866">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4028870">j</span>&nbsp;<span class="op" id="4028872">+=</span>&nbsp;<span class="builtintype" id="4028875">uint8</span><span class="op" id="4028880">(</span><span class="ident" id="4028881">c</span><span class="op" id="4028882">.</span><span class="ident" id="4028883">s</span><span class="op" id="4028884">[</span><span class="ident" id="4028885">i</span><span class="op" id="4028886">]</span><span class="op" id="4028887">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4028891">c</span><span class="op" id="4028892">.</span><span class="ident" id="4028893">s</span><span class="op" id="4028894">[</span><span class="ident" id="4028895">i</span><span class="op" id="4028896">]</span><span class="op" id="4028897">,</span>&nbsp;<span class="ident" id="4028899">c</span><span class="op" id="4028900">.</span><span class="ident" id="4028901">s</span><span class="op" id="4028902">[</span><span class="ident" id="4028903">j</span><span class="op" id="4028904">]</span>&nbsp;<span class="op" id="4028906">=</span>&nbsp;<span class="ident" id="4028908">c</span><span class="op" id="4028909">.</span><span class="ident" id="4028910">s</span><span class="op" id="4028911">[</span><span class="ident" id="4028912">j</span><span class="op" id="4028913">]</span><span class="op" id="4028914">,</span>&nbsp;<span class="ident" id="4028916">c</span><span class="op" id="4028917">.</span><span class="ident" id="4028918">s</span><span class="op" id="4028919">[</span><span class="ident" id="4028920">i</span><span class="op" id="4028921">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4028925">dst</span><span class="op" id="4028928">[</span><span class="ident" id="4028929">k</span><span class="op" id="4028930">]</span>&nbsp;<span class="op" id="4028932">=</span>&nbsp;<span class="ident" id="4028934">v</span>&nbsp;<span class="op" id="4028936">^</span>&nbsp;<span class="builtintype" id="4028938">uint8</span><span class="op" id="4028943">(</span><span class="ident" id="4028944">c</span><span class="op" id="4028945">.</span><span class="ident" id="4028946">s</span><span class="op" id="4028947">[</span><span class="builtintype" id="4028948">uint8</span><span class="op" id="4028953">(</span><span class="ident" id="4028954">c</span><span class="op" id="4028955">.</span><span class="ident" id="4028956">s</span><span class="op" id="4028957">[</span><span class="ident" id="4028958">i</span><span class="op" id="4028959">]</span><span class="op" id="4028960">+</span><span class="ident" id="4028961">c</span><span class="op" id="4028962">.</span><span class="ident" id="4028963">s</span><span class="op" id="4028964">[</span><span class="ident" id="4028965">j</span><span class="op" id="4028966">]</span><span class="op" id="4028967">)</span><span class="op" id="4028968">]</span><span class="op" id="4028969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4028972">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4028975">c</span><span class="op" id="4028976">.</span><span class="ident" id="4028977">i</span><span class="op" id="4028978">,</span>&nbsp;<span class="ident" id="4028980">c</span><span class="op" id="4028981">.</span><span class="ident" id="4028982">j</span>&nbsp;<span class="op" id="4028984">=</span>&nbsp;<span class="ident" id="4028986">i</span><span class="op" id="4028987">,</span>&nbsp;<span class="ident" id="4028989">j</span><br>
<span class="lineno"></span><span class="op" id="4028991">}</span>
</div>
</body>
</html>
