<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime</h2>
<ul>
<li><a href="/gostd/runtime/alg.go.html">alg.go</a></li>
<li><a href="/gostd/runtime/append_test.go.html">append_test.go</a></li>
<li><a href="/gostd/runtime/arch_amd64.go.html">arch_amd64.go</a></li>
<li><a href="/gostd/runtime/atomic.go.html">atomic.go</a></li>
<li><a href="/gostd/runtime/cgocall.go.html">cgocall.go</a></li>
<li><a href="/gostd/runtime/cgocallback.go.html">cgocallback.go</a></li>
<li><a href="/gostd/runtime/chan.go.html">chan.go</a></li>
<li><a href="/gostd/runtime/chan_test.go.html">chan_test.go</a></li>
<li><a href="/gostd/runtime/closure_test.go.html">closure_test.go</a></li>
<li><a href="/gostd/runtime/compiler.go.html">compiler.go</a></li>
<li><a href="/gostd/runtime/complex.go.html">complex.go</a></li>
<li><a href="/gostd/runtime/complex_test.go.html">complex_test.go</a></li>
<li><a href="/gostd/runtime/cpuprof.go.html">cpuprof.go</a></li>
<li><a href="/gostd/runtime/crash_test.go.html">crash_test.go</a></li>
<li><a href="/gostd/runtime/debug.go.html">debug.go</a></li>
<li><a href="/gostd/runtime/env_posix.go.html">env_posix.go</a></li>
<li><a href="/gostd/runtime/error.go.html">error.go</a></li>
<li><a href="/gostd/runtime/export_futex_test.go.html">export_futex_test.go</a></li>
<li><a href="/gostd/runtime/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/runtime/extern.go.html">extern.go</a></li>
<li><a href="/gostd/runtime/futex_test.go.html">futex_test.go</a></li>
<li><a href="/gostd/runtime/gc_test.go.html">gc_test.go</a></li>
<li><a href="/gostd/runtime/gcinfo_test.go.html">gcinfo_test.go</a></li>
<li><a href="/gostd/runtime/hash_test.go.html">hash_test.go</a></li>
<li><a href="/gostd/runtime/hashmap.go.html">hashmap.go</a></li>
<li><a href="/gostd/runtime/hashmap_fast.go.html">hashmap_fast.go</a></li>
<li><a href="/gostd/runtime/iface.go.html">iface.go</a></li>
<li><a href="/gostd/runtime/iface_test.go.html">iface_test.go</a></li>
<li><a href="/gostd/runtime/lfstack_test.go.html">lfstack_test.go</a></li>
<li><a href="/gostd/runtime/lock_futex.go.html">lock_futex.go</a></li>
<li><a href="/gostd/runtime/malloc.go.html">malloc.go</a></li>
<li><a href="/gostd/runtime/malloc_test.go.html">malloc_test.go</a></li>
<li><a href="/gostd/runtime/map_test.go.html">map_test.go</a></li>
<li><a href="/gostd/runtime/mapspeed_test.go.html">mapspeed_test.go</a></li>
<li><a href="/gostd/runtime/mem.go.html">mem.go</a></li>
<li><a href="/gostd/runtime/memmove_linux_amd64_test.go.html">memmove_linux_amd64_test.go</a></li>
<li><a href="/gostd/runtime/memmove_test.go.html">memmove_test.go</a></li>
<li><a href="/gostd/runtime/mfinal_test.go.html">mfinal_test.go</a></li>
<li><a href="/gostd/runtime/mgc0.go.html">mgc0.go</a></li>
<li><a href="/gostd/runtime/mprof.go.html">mprof.go</a></li>
<li><a href="/gostd/runtime/netpoll.go.html">netpoll.go</a></li>
<li><a href="/gostd/runtime/netpoll_epoll.go.html">netpoll_epoll.go</a></li>
<li><a href="/gostd/runtime/norace_test.go.html">norace_test.go</a></li>
<li><a href="/gostd/runtime/os_linux.go.html">os_linux.go</a></li>
<li><a href="/gostd/runtime/panic.go.html">panic.go</a></li>
<li><a href="/gostd/runtime/parfor_test.go.html">parfor_test.go</a></li>
<li><a href="/gostd/runtime/print1.go.html">print1.go</a></li>
<li><a href="/gostd/runtime/proc.go.html">proc.go</a></li>
<li><a href="/gostd/runtime/proc_test.go.html">proc_test.go</a></li>
<li><a href="/gostd/runtime/race0.go.html">race0.go</a></li>
<li><a href="/gostd/runtime/rdebug.go.html">rdebug.go</a></li>
<li><a href="/gostd/runtime/rune.go.html">rune.go</a></li>
<li><a href="/gostd/runtime/runtime.go.html">runtime.go</a></li>
<li><a href="/gostd/runtime/runtime_linux_test.go.html">runtime_linux_test.go</a></li>
<li><a href="/gostd/runtime/runtime_test.go.html">runtime_test.go</a></li>
<li><a href="/gostd/runtime/runtime_unix_test.go.html">runtime_unix_test.go</a></li>
<li><a href="/gostd/runtime/select.go.html">select.go</a></li>
<li><a href="/gostd/runtime/sema.go.html">sema.go</a></li>
<li><a href="/gostd/runtime/signal_unix.go.html">signal_unix.go</a></li>
<li><a href="/gostd/runtime/sigpanic_unix.go.html">sigpanic_unix.go</a></li>
<li><a href="/gostd/runtime/sigqueue.go.html">sigqueue.go</a></li>
<li><a href="/gostd/runtime/slice.go.html">slice.go</a></li>
<li><a href="/gostd/runtime/softfloat64.go.html">softfloat64.go</a></li>
<li><a href="/gostd/runtime/softfloat64_test.go.html">softfloat64_test.go</a></li>
<li><a href="/gostd/runtime/sqrt.go.html">sqrt.go</a></li>
<li><a href="/gostd/runtime/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/string.go.html">string.go</a></li>
<li><a href="/gostd/runtime/string_test.go.html">string_test.go</a></li>
<li><a href="/gostd/runtime/stubs.go.html">stubs.go</a></li>
<li><a href="/gostd/runtime/symtab.go.html">symtab.go</a></li>
<li><a href="/gostd/runtime/symtab_test.go.html">symtab_test.go</a></li>
<li><a href="/gostd/runtime/time.go.html">time.go</a></li>
<li><a href="/gostd/runtime/traceback.go.html" class="current">traceback.go</a></li>
<li><a href="/gostd/runtime/typekind.go.html">typekind.go</a></li>
<li><a href="/gostd/runtime/zgoarch_amd64.go.html">zgoarch_amd64.go</a></li>
<li><a href="/gostd/runtime/zgoos_linux.go.html">zgoos_linux.go</a></li>
<li><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html">zruntime_defs_linux_amd64.go</a></li>
<li><a href="/gostd/runtime/zversion.go.html">zversion.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1932706">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1932761">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1932815">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1932866">package</span>&nbsp;<span class="ident" id="1932874">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1932883">import</span>&nbsp;<span class="string" id="1932890">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1932900">//&nbsp;The&nbsp;code&nbsp;in&nbsp;this&nbsp;file&nbsp;implements&nbsp;stack&nbsp;trace&nbsp;walking&nbsp;for&nbsp;all&nbsp;architectures.</span><br>
<span class="lineno">10</span><span class="comment" id="1932979">//&nbsp;The&nbsp;most&nbsp;important&nbsp;fact&nbsp;about&nbsp;a&nbsp;given&nbsp;architecture&nbsp;is&nbsp;whether&nbsp;it&nbsp;uses&nbsp;a&nbsp;link&nbsp;register.</span><br>
<span class="lineno"></span><span class="comment" id="1933069">//&nbsp;On&nbsp;systems&nbsp;with&nbsp;link&nbsp;registers,&nbsp;the&nbsp;prologue&nbsp;for&nbsp;a&nbsp;non-leaf&nbsp;function&nbsp;stores&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1933152">//&nbsp;incoming&nbsp;value&nbsp;of&nbsp;LR&nbsp;at&nbsp;the&nbsp;bottom&nbsp;of&nbsp;the&nbsp;newly&nbsp;allocated&nbsp;stack&nbsp;frame.</span><br>
<span class="lineno"></span><span class="comment" id="1933226">//&nbsp;On&nbsp;systems&nbsp;without&nbsp;link&nbsp;registers,&nbsp;the&nbsp;architecture&nbsp;pushes&nbsp;a&nbsp;return&nbsp;PC&nbsp;during</span><br>
<span class="lineno"></span><span class="comment" id="1933307">//&nbsp;the&nbsp;call&nbsp;instruction,&nbsp;so&nbsp;the&nbsp;return&nbsp;PC&nbsp;ends&nbsp;up&nbsp;above&nbsp;the&nbsp;stack&nbsp;frame.</span><br>
<span class="lineno">15</span><span class="comment" id="1933380">//&nbsp;In&nbsp;this&nbsp;file,&nbsp;the&nbsp;return&nbsp;PC&nbsp;is&nbsp;always&nbsp;called&nbsp;LR,&nbsp;no&nbsp;matter&nbsp;how&nbsp;it&nbsp;was&nbsp;found.</span><br>
<span class="lineno"></span><span class="comment" id="1933460">//</span><br>
<span class="lineno"></span><span class="comment" id="1933463">//&nbsp;To&nbsp;date,&nbsp;the&nbsp;opposite&nbsp;of&nbsp;a&nbsp;link&nbsp;register&nbsp;architecture&nbsp;is&nbsp;an&nbsp;x86&nbsp;architecture.</span><br>
<span class="lineno"></span><span class="comment" id="1933544">//&nbsp;This&nbsp;code&nbsp;may&nbsp;need&nbsp;to&nbsp;change&nbsp;if&nbsp;some&nbsp;other&nbsp;kind&nbsp;of&nbsp;non-link-register</span><br>
<span class="lineno"></span><span class="comment" id="1933616">//&nbsp;architecture&nbsp;comes&nbsp;along.</span><br>
<span class="lineno">20</span><span class="comment" id="1933645">//</span><br>
<span class="lineno"></span><span class="comment" id="1933648">//&nbsp;The&nbsp;other&nbsp;important&nbsp;fact&nbsp;is&nbsp;the&nbsp;size&nbsp;of&nbsp;a&nbsp;pointer:&nbsp;on&nbsp;32-bit&nbsp;systems&nbsp;the&nbsp;LR</span><br>
<span class="lineno"></span><span class="comment" id="1933727">//&nbsp;takes&nbsp;up&nbsp;only&nbsp;4&nbsp;bytes&nbsp;on&nbsp;the&nbsp;stack,&nbsp;while&nbsp;on&nbsp;64-bit&nbsp;systems&nbsp;it&nbsp;takes&nbsp;up&nbsp;8&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="comment" id="1933811">//&nbsp;Typically&nbsp;this&nbsp;is&nbsp;ptrSize.</span><br>
<span class="lineno"></span><span class="comment" id="1933841">//</span><br>
<span class="lineno">25</span><span class="comment" id="1933844">//&nbsp;As&nbsp;an&nbsp;exception,&nbsp;amd64p32&nbsp;has&nbsp;ptrSize&nbsp;==&nbsp;4&nbsp;but&nbsp;the&nbsp;CALL&nbsp;instruction&nbsp;still</span><br>
<span class="lineno"></span><span class="comment" id="1933921">//&nbsp;stores&nbsp;an&nbsp;8-byte&nbsp;return&nbsp;PC&nbsp;onto&nbsp;the&nbsp;stack.&nbsp;To&nbsp;accommodate&nbsp;this,&nbsp;we&nbsp;use&nbsp;regSize</span><br>
<span class="lineno"></span><span class="comment" id="1934003">//&nbsp;as&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;architecture-pushed&nbsp;return&nbsp;PC.</span><br>
<span class="lineno"></span><span class="comment" id="1934056">//</span><br>
<span class="lineno"></span><span class="comment" id="1934059">//&nbsp;usesLR&nbsp;is&nbsp;defined&nbsp;below.&nbsp;ptrSize&nbsp;and&nbsp;regSize&nbsp;are&nbsp;defined&nbsp;in&nbsp;stubs.go.</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="keyword" id="1934133">const</span>&nbsp;<span class="ident" id="1934139">usesLR</span>&nbsp;<span class="op" id="1934146">=</span>&nbsp;<span class="ident" id="1934148">GOARCH</span>&nbsp;<span class="op" id="1934155">!=</span>&nbsp;<span class="string" id="1934158">&#34;amd64&#34;</span>&nbsp;<span class="op" id="1934166">&amp;&amp;</span>&nbsp;<span class="ident" id="1934169">GOARCH</span>&nbsp;<span class="op" id="1934176">!=</span>&nbsp;<span class="string" id="1934179">&#34;amd64p32&#34;</span>&nbsp;<span class="op" id="1934190">&amp;&amp;</span>&nbsp;<span class="ident" id="1934193">GOARCH</span>&nbsp;<span class="op" id="1934200">!=</span>&nbsp;<span class="string" id="1934203">&#34;386&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1934210">var</span>&nbsp;<span class="op" id="1934214">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1934217">//&nbsp;initialized&nbsp;in&nbsp;tracebackinit</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1934250">deferprocPC</span>&nbsp;<span class="builtintype" id="1934262">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1934271">goexitPC</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1934283">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1934292">jmpdeferPC</span>&nbsp;&nbsp;<span class="builtintype" id="1934304">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1934313">mcallPC</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1934325">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1934334">morestackPC</span>&nbsp;<span class="builtintype" id="1934346">uintptr</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1934355">mstartPC</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1934367">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1934376">newprocPC</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1934388">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1934397">rt0_goPC</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1934409">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1934418">sigpanicPC</span>&nbsp;&nbsp;<span class="builtintype" id="1934430">uintptr</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1934440">externalthreadhandlerp</span>&nbsp;<span class="builtintype" id="1934463">uintptr</span>&nbsp;<span class="comment" id="1934471">//&nbsp;initialized&nbsp;elsewhere</span><br>
<span class="lineno"></span><span class="op" id="1934496">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1934499">func</span>&nbsp;<span class="ident" id="1934504">tracebackinit</span><span class="op" id="1934517">(</span><span class="op" id="1934518">)</span>&nbsp;<span class="op" id="1934520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1934523">//&nbsp;Go&nbsp;variable&nbsp;initialization&nbsp;happens&nbsp;late&nbsp;during&nbsp;runtime&nbsp;startup.</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1934591">//&nbsp;Instead&nbsp;of&nbsp;initializing&nbsp;the&nbsp;variables&nbsp;above&nbsp;in&nbsp;the&nbsp;declarations,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1934660">//&nbsp;schedinit&nbsp;calls&nbsp;this&nbsp;function&nbsp;so&nbsp;that&nbsp;the&nbsp;variables&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1934720">//&nbsp;initialized&nbsp;and&nbsp;available&nbsp;earlier&nbsp;in&nbsp;the&nbsp;startup&nbsp;sequence.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1934783">deferprocPC</span>&nbsp;<span class="op" id="1934795">=</span>&nbsp;<span class="ident" id="1934797">funcPC</span><span class="op" id="1934803">(</span><span class="ident" id="1934804">deferproc</span><span class="op" id="1934813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1934816">goexitPC</span>&nbsp;<span class="op" id="1934825">=</span>&nbsp;<span class="ident" id="1934827">funcPC</span><span class="op" id="1934833">(</span><span class="ident" id="1934834">goexit</span><span class="op" id="1934840">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1934843">jmpdeferPC</span>&nbsp;<span class="op" id="1934854">=</span>&nbsp;<span class="ident" id="1934856">funcPC</span><span class="op" id="1934862">(</span><span class="ident" id="1934863">jmpdefer</span><span class="op" id="1934871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1934874">mcallPC</span>&nbsp;<span class="op" id="1934882">=</span>&nbsp;<span class="ident" id="1934884">funcPC</span><span class="op" id="1934890">(</span><span class="ident" id="1934891">mcall</span><span class="op" id="1934896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1934899">morestackPC</span>&nbsp;<span class="op" id="1934911">=</span>&nbsp;<span class="ident" id="1934913">funcPC</span><span class="op" id="1934919">(</span><span class="ident" id="1934920">morestack</span><span class="op" id="1934929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1934932">mstartPC</span>&nbsp;<span class="op" id="1934941">=</span>&nbsp;<span class="ident" id="1934943">funcPC</span><span class="op" id="1934949">(</span><span class="ident" id="1934950">mstart</span><span class="op" id="1934956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1934959">newprocPC</span>&nbsp;<span class="op" id="1934969">=</span>&nbsp;<span class="ident" id="1934971">funcPC</span><span class="op" id="1934977">(</span><span class="ident" id="1934978">newproc</span><span class="op" id="1934985">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1934988">rt0_goPC</span>&nbsp;<span class="op" id="1934997">=</span>&nbsp;<span class="ident" id="1934999">funcPC</span><span class="op" id="1935005">(</span><span class="ident" id="1935006">rt0_go</span><span class="op" id="1935012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1935015">sigpanicPC</span>&nbsp;<span class="op" id="1935026">=</span>&nbsp;<span class="ident" id="1935028">funcPC</span><span class="op" id="1935034">(</span><span class="ident" id="1935035">sigpanic</span><span class="op" id="1935043">)</span><br>
<span class="lineno"></span><span class="op" id="1935045">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1935048">//&nbsp;Traceback&nbsp;over&nbsp;the&nbsp;deferred&nbsp;function&nbsp;calls.</span><br>
<span class="lineno">65</span><span class="comment" id="1935095">//&nbsp;Report&nbsp;them&nbsp;like&nbsp;calls&nbsp;that&nbsp;have&nbsp;been&nbsp;invoked&nbsp;but&nbsp;not&nbsp;started&nbsp;executing&nbsp;yet.</span><br>
<span class="lineno"></span><span class="keyword" id="1935175">func</span>&nbsp;<span class="ident" id="1935180">tracebackdefers</span><span class="op" id="1935195">(</span><span class="ident" id="1935196">gp</span>&nbsp;<span class="op" id="1935199">*</span><span class="ident" id="1935200">g</span><span class="op" id="1935201">,</span>&nbsp;<span class="ident" id="1935203">callback</span>&nbsp;<span class="keyword" id="1935212">func</span><span class="op" id="1935216">(</span><span class="op" id="1935217">*</span><span class="ident" id="1935218">stkframe</span><span class="op" id="1935226">,</span>&nbsp;<span class="ident" id="1935228">unsafe</span><span class="op" id="1935234">.</span><span class="ident" id="1935235">Pointer</span><span class="op" id="1935242">)</span>&nbsp;<span class="builtintype" id="1935244">bool</span><span class="op" id="1935248">,</span>&nbsp;<span class="ident" id="1935250">v</span>&nbsp;<span class="ident" id="1935252">unsafe</span><span class="op" id="1935258">.</span><span class="ident" id="1935259">Pointer</span><span class="op" id="1935266">)</span>&nbsp;<span class="op" id="1935268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1935271">var</span>&nbsp;<span class="ident" id="1935275">frame</span>&nbsp;<span class="ident" id="1935281">stkframe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1935291">for</span>&nbsp;<span class="ident" id="1935295">d</span>&nbsp;<span class="op" id="1935297">:=</span>&nbsp;<span class="ident" id="1935300">gp</span><span class="op" id="1935302">.</span><span class="ident" id="1935303">_defer</span><span class="op" id="1935309">;</span>&nbsp;<span class="ident" id="1935311">d</span>&nbsp;<span class="op" id="1935313">!=</span>&nbsp;<span class="ident" id="1935316">nil</span><span class="op" id="1935319">;</span>&nbsp;<span class="ident" id="1935321">d</span>&nbsp;<span class="op" id="1935323">=</span>&nbsp;<span class="ident" id="1935325">d</span><span class="op" id="1935326">.</span><span class="ident" id="1935327">link</span>&nbsp;<span class="op" id="1935332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1935336">fn</span>&nbsp;<span class="op" id="1935339">:=</span>&nbsp;<span class="ident" id="1935342">d</span><span class="op" id="1935343">.</span><span class="ident" id="1935344">fn</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1935349">if</span>&nbsp;<span class="ident" id="1935352">fn</span>&nbsp;<span class="op" id="1935355">==</span>&nbsp;<span class="ident" id="1935358">nil</span>&nbsp;<span class="op" id="1935362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1935367">//&nbsp;Defer&nbsp;of&nbsp;nil&nbsp;function.&nbsp;Args&nbsp;don&#39;t&nbsp;matter.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1935415">frame</span><span class="op" id="1935420">.</span><span class="ident" id="1935421">pc</span>&nbsp;<span class="op" id="1935424">=</span>&nbsp;<span class="num" id="1935426">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1935431">frame</span><span class="op" id="1935436">.</span><span class="ident" id="1935437">fn</span>&nbsp;<span class="op" id="1935440">=</span>&nbsp;<span class="ident" id="1935442">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1935449">frame</span><span class="op" id="1935454">.</span><span class="ident" id="1935455">argp</span>&nbsp;<span class="op" id="1935460">=</span>&nbsp;<span class="num" id="1935462">0</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1935467">frame</span><span class="op" id="1935472">.</span><span class="ident" id="1935473">arglen</span>&nbsp;<span class="op" id="1935480">=</span>&nbsp;<span class="num" id="1935482">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1935487">frame</span><span class="op" id="1935492">.</span><span class="ident" id="1935493">argmap</span>&nbsp;<span class="op" id="1935500">=</span>&nbsp;<span class="ident" id="1935502">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1935508">}</span>&nbsp;<span class="keyword" id="1935510">else</span>&nbsp;<span class="op" id="1935515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1935520">frame</span><span class="op" id="1935525">.</span><span class="ident" id="1935526">pc</span>&nbsp;<span class="op" id="1935529">=</span>&nbsp;<span class="builtintype" id="1935531">uintptr</span><span class="op" id="1935538">(</span><span class="ident" id="1935539">fn</span><span class="op" id="1935541">.</span><span class="ident" id="1935542">fn</span><span class="op" id="1935544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1935549">f</span>&nbsp;<span class="op" id="1935551">:=</span>&nbsp;<span class="ident" id="1935554">findfunc</span><span class="op" id="1935562">(</span><span class="ident" id="1935563">frame</span><span class="op" id="1935568">.</span><span class="ident" id="1935569">pc</span><span class="op" id="1935571">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1935576">if</span>&nbsp;<span class="ident" id="1935579">f</span>&nbsp;<span class="op" id="1935581">==</span>&nbsp;<span class="ident" id="1935584">nil</span>&nbsp;<span class="op" id="1935588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1935594">print</span><span class="op" id="1935599">(</span><span class="string" id="1935600">&#34;runtime:&nbsp;unknown&nbsp;pc&nbsp;in&nbsp;defer&nbsp;&#34;</span><span class="op" id="1935631">,</span>&nbsp;<span class="ident" id="1935633">hex</span><span class="op" id="1935636">(</span><span class="ident" id="1935637">frame</span><span class="op" id="1935642">.</span><span class="ident" id="1935643">pc</span><span class="op" id="1935645">)</span><span class="op" id="1935646">,</span>&nbsp;<span class="string" id="1935648">&#34;\n&#34;</span><span class="op" id="1935652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1935658">gothrow</span><span class="op" id="1935665">(</span><span class="string" id="1935666">&#34;unknown&nbsp;pc&#34;</span><span class="op" id="1935678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1935683">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1935688">frame</span><span class="op" id="1935693">.</span><span class="ident" id="1935694">fn</span>&nbsp;<span class="op" id="1935697">=</span>&nbsp;<span class="ident" id="1935699">f</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1935704">frame</span><span class="op" id="1935709">.</span><span class="ident" id="1935710">argp</span>&nbsp;<span class="op" id="1935715">=</span>&nbsp;<span class="builtintype" id="1935717">uintptr</span><span class="op" id="1935724">(</span><span class="ident" id="1935725">deferArgs</span><span class="op" id="1935734">(</span><span class="ident" id="1935735">d</span><span class="op" id="1935736">)</span><span class="op" id="1935737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1935742">setArgInfo</span><span class="op" id="1935752">(</span><span class="op" id="1935753">&amp;</span><span class="ident" id="1935754">frame</span><span class="op" id="1935759">,</span>&nbsp;<span class="ident" id="1935761">f</span><span class="op" id="1935762">,</span>&nbsp;<span class="builtintype" id="1935764">true</span><span class="op" id="1935768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1935772">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1935776">frame</span><span class="op" id="1935781">.</span><span class="ident" id="1935782">continpc</span>&nbsp;<span class="op" id="1935791">=</span>&nbsp;<span class="ident" id="1935793">frame</span><span class="op" id="1935798">.</span><span class="ident" id="1935799">pc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1935804">if</span>&nbsp;<span class="op" id="1935807">!</span><span class="ident" id="1935808">callback</span><span class="op" id="1935816">(</span><span class="op" id="1935817">(</span><span class="op" id="1935818">*</span><span class="ident" id="1935819">stkframe</span><span class="op" id="1935827">)</span><span class="op" id="1935828">(</span><span class="ident" id="1935829">noescape</span><span class="op" id="1935837">(</span><span class="ident" id="1935838">unsafe</span><span class="op" id="1935844">.</span><span class="ident" id="1935845">Pointer</span><span class="op" id="1935852">(</span><span class="op" id="1935853">&amp;</span><span class="ident" id="1935854">frame</span><span class="op" id="1935859">)</span><span class="op" id="1935860">)</span><span class="op" id="1935861">)</span><span class="op" id="1935862">,</span>&nbsp;<span class="ident" id="1935864">v</span><span class="op" id="1935865">)</span>&nbsp;<span class="op" id="1935867">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1935872">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1935881">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1935884">}</span><br>
<span class="lineno"></span><span class="op" id="1935886">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="1935889">//&nbsp;Generic&nbsp;traceback.&nbsp;&nbsp;Handles&nbsp;runtime&nbsp;stack&nbsp;prints&nbsp;(pcbuf&nbsp;==&nbsp;nil),</span><br>
<span class="lineno"></span><span class="comment" id="1935957">//&nbsp;the&nbsp;runtime.Callers&nbsp;function&nbsp;(pcbuf&nbsp;!=&nbsp;nil),&nbsp;as&nbsp;well&nbsp;as&nbsp;the&nbsp;garbage</span><br>
<span class="lineno"></span><span class="comment" id="1936028">//&nbsp;collector&nbsp;(callback&nbsp;!=&nbsp;nil).&nbsp;&nbsp;A&nbsp;little&nbsp;clunky&nbsp;to&nbsp;merge&nbsp;these,&nbsp;but&nbsp;avoids</span><br>
<span class="lineno"></span><span class="comment" id="1936104">//&nbsp;duplicating&nbsp;the&nbsp;code&nbsp;and&nbsp;all&nbsp;its&nbsp;subtlety.</span><br>
<span class="lineno"></span><span class="keyword" id="1936150">func</span>&nbsp;<span class="ident" id="1936155">gentraceback</span><span class="op" id="1936167">(</span><span class="ident" id="1936168">pc0</span>&nbsp;<span class="builtintype" id="1936172">uintptr</span><span class="op" id="1936179">,</span>&nbsp;<span class="ident" id="1936181">sp0</span>&nbsp;<span class="builtintype" id="1936185">uintptr</span><span class="op" id="1936192">,</span>&nbsp;<span class="ident" id="1936194">lr0</span>&nbsp;<span class="builtintype" id="1936198">uintptr</span><span class="op" id="1936205">,</span>&nbsp;<span class="ident" id="1936207">gp</span>&nbsp;<span class="op" id="1936210">*</span><span class="ident" id="1936211">g</span><span class="op" id="1936212">,</span>&nbsp;<span class="ident" id="1936214">skip</span>&nbsp;<span class="builtintype" id="1936219">int</span><span class="op" id="1936222">,</span>&nbsp;<span class="ident" id="1936224">pcbuf</span>&nbsp;<span class="op" id="1936230">*</span><span class="builtintype" id="1936231">uintptr</span><span class="op" id="1936238">,</span>&nbsp;<span class="ident" id="1936240">max</span>&nbsp;<span class="builtintype" id="1936244">int</span><span class="op" id="1936247">,</span>&nbsp;<span class="ident" id="1936249">callback</span>&nbsp;<span class="keyword" id="1936258">func</span><span class="op" id="1936262">(</span><span class="op" id="1936263">*</span><span class="ident" id="1936264">stkframe</span><span class="op" id="1936272">,</span>&nbsp;<span class="ident" id="1936274">unsafe</span><span class="op" id="1936280">.</span><span class="ident" id="1936281">Pointer</span><span class="op" id="1936288">)</span>&nbsp;<span class="builtintype" id="1936290">bool</span><span class="op" id="1936294">,</span>&nbsp;<span class="ident" id="1936296">v</span>&nbsp;<span class="ident" id="1936298">unsafe</span><span class="op" id="1936304">.</span><span class="ident" id="1936305">Pointer</span><span class="op" id="1936312">,</span>&nbsp;<span class="ident" id="1936314">flags</span>&nbsp;<span class="builtintype" id="1936320">uint</span><span class="op" id="1936324">)</span>&nbsp;<span class="builtintype" id="1936326">int</span>&nbsp;<span class="op" id="1936330">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1936333">if</span>&nbsp;<span class="ident" id="1936336">goexitPC</span>&nbsp;<span class="op" id="1936345">==</span>&nbsp;<span class="num" id="1936348">0</span>&nbsp;<span class="op" id="1936350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1936354">gothrow</span><span class="op" id="1936361">(</span><span class="string" id="1936362">&#34;gentraceback&nbsp;before&nbsp;goexitPC&nbsp;initialization&#34;</span><span class="op" id="1936407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1936410">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1936413">g</span>&nbsp;<span class="op" id="1936415">:=</span>&nbsp;<span class="ident" id="1936418">getg</span><span class="op" id="1936422">(</span><span class="op" id="1936423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1936426">if</span>&nbsp;<span class="ident" id="1936429">g</span>&nbsp;<span class="op" id="1936431">==</span>&nbsp;<span class="ident" id="1936434">gp</span>&nbsp;<span class="op" id="1936437">&amp;&amp;</span>&nbsp;<span class="ident" id="1936440">g</span>&nbsp;<span class="op" id="1936442">==</span>&nbsp;<span class="ident" id="1936445">g</span><span class="op" id="1936446">.</span><span class="ident" id="1936447">m</span><span class="op" id="1936448">.</span><span class="ident" id="1936449">curg</span>&nbsp;<span class="op" id="1936454">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1936458">//&nbsp;The&nbsp;starting&nbsp;sp&nbsp;has&nbsp;been&nbsp;passed&nbsp;in&nbsp;as&nbsp;a&nbsp;uintptr,&nbsp;and&nbsp;the&nbsp;caller&nbsp;may</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1936531">//&nbsp;have&nbsp;other&nbsp;uintptr-typed&nbsp;stack&nbsp;references&nbsp;as&nbsp;well.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1936587">//&nbsp;If&nbsp;during&nbsp;one&nbsp;of&nbsp;the&nbsp;calls&nbsp;that&nbsp;got&nbsp;us&nbsp;here&nbsp;or&nbsp;during&nbsp;one&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1936657">//&nbsp;callbacks&nbsp;below&nbsp;the&nbsp;stack&nbsp;must&nbsp;be&nbsp;grown,&nbsp;all&nbsp;these&nbsp;uintptr&nbsp;references</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1936732">//&nbsp;to&nbsp;the&nbsp;stack&nbsp;will&nbsp;not&nbsp;be&nbsp;updated,&nbsp;and&nbsp;gentraceback&nbsp;will&nbsp;continue</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1936802">//&nbsp;to&nbsp;inspect&nbsp;the&nbsp;old&nbsp;stack&nbsp;memory,&nbsp;which&nbsp;may&nbsp;no&nbsp;longer&nbsp;be&nbsp;valid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1936870">//&nbsp;Even&nbsp;if&nbsp;all&nbsp;the&nbsp;variables&nbsp;were&nbsp;updated&nbsp;correctly,&nbsp;it&nbsp;is&nbsp;not&nbsp;clear&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1936946">//&nbsp;we&nbsp;want&nbsp;to&nbsp;expose&nbsp;a&nbsp;traceback&nbsp;that&nbsp;begins&nbsp;on&nbsp;one&nbsp;stack&nbsp;and&nbsp;ends</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1937015">//&nbsp;on&nbsp;another&nbsp;stack.&nbsp;That&nbsp;could&nbsp;confuse&nbsp;callers&nbsp;quite&nbsp;a&nbsp;bit.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1937078">//&nbsp;Instead,&nbsp;we&nbsp;require&nbsp;that&nbsp;gentraceback&nbsp;and&nbsp;any&nbsp;other&nbsp;function&nbsp;that</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1937149">//&nbsp;accepts&nbsp;an&nbsp;sp&nbsp;for&nbsp;the&nbsp;current&nbsp;goroutine&nbsp;(typically&nbsp;obtained&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1937217">//&nbsp;calling&nbsp;getcallersp)&nbsp;must&nbsp;not&nbsp;run&nbsp;on&nbsp;that&nbsp;goroutine&#39;s&nbsp;stack&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1937286">//&nbsp;instead&nbsp;on&nbsp;the&nbsp;g0&nbsp;stack.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1937316">gothrow</span><span class="op" id="1937323">(</span><span class="string" id="1937324">&#34;gentraceback&nbsp;cannot&nbsp;trace&nbsp;user&nbsp;goroutine&nbsp;on&nbsp;its&nbsp;own&nbsp;stack&#34;</span><span class="op" id="1937383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1937386">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1937389">gotraceback</span>&nbsp;<span class="op" id="1937401">:=</span>&nbsp;<span class="ident" id="1937404">gotraceback</span><span class="op" id="1937415">(</span><span class="ident" id="1937416">nil</span><span class="op" id="1937419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1937422">if</span>&nbsp;<span class="ident" id="1937425">pc0</span>&nbsp;<span class="op" id="1937429">==</span>&nbsp;<span class="op" id="1937432">^</span><span class="builtintype" id="1937433">uintptr</span><span class="op" id="1937440">(</span><span class="num" id="1937441">0</span><span class="op" id="1937442">)</span>&nbsp;<span class="op" id="1937444">&amp;&amp;</span>&nbsp;<span class="ident" id="1937447">sp0</span>&nbsp;<span class="op" id="1937451">==</span>&nbsp;<span class="op" id="1937454">^</span><span class="builtintype" id="1937455">uintptr</span><span class="op" id="1937462">(</span><span class="num" id="1937463">0</span><span class="op" id="1937464">)</span>&nbsp;<span class="op" id="1937466">{</span>&nbsp;<span class="comment" id="1937468">//&nbsp;Signal&nbsp;to&nbsp;fetch&nbsp;saved&nbsp;values&nbsp;from&nbsp;gp.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1937511">if</span>&nbsp;<span class="ident" id="1937514">gp</span><span class="op" id="1937516">.</span><span class="ident" id="1937517">syscallsp</span>&nbsp;<span class="op" id="1937527">!=</span>&nbsp;<span class="num" id="1937530">0</span>&nbsp;<span class="op" id="1937532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1937537">pc0</span>&nbsp;<span class="op" id="1937541">=</span>&nbsp;<span class="ident" id="1937543">gp</span><span class="op" id="1937545">.</span><span class="ident" id="1937546">syscallpc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1937559">sp0</span>&nbsp;<span class="op" id="1937563">=</span>&nbsp;<span class="ident" id="1937565">gp</span><span class="op" id="1937567">.</span><span class="ident" id="1937568">syscallsp</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1937581">if</span>&nbsp;<span class="ident" id="1937584">usesLR</span>&nbsp;<span class="op" id="1937591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1937597">lr0</span>&nbsp;<span class="op" id="1937601">=</span>&nbsp;<span class="num" id="1937603">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1937608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1937612">}</span>&nbsp;<span class="keyword" id="1937614">else</span>&nbsp;<span class="op" id="1937619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1937624">pc0</span>&nbsp;<span class="op" id="1937628">=</span>&nbsp;<span class="ident" id="1937630">gp</span><span class="op" id="1937632">.</span><span class="ident" id="1937633">sched</span><span class="op" id="1937638">.</span><span class="ident" id="1937639">pc</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1937645">sp0</span>&nbsp;<span class="op" id="1937649">=</span>&nbsp;<span class="ident" id="1937651">gp</span><span class="op" id="1937653">.</span><span class="ident" id="1937654">sched</span><span class="op" id="1937659">.</span><span class="ident" id="1937660">sp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1937666">if</span>&nbsp;<span class="ident" id="1937669">usesLR</span>&nbsp;<span class="op" id="1937676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1937682">lr0</span>&nbsp;<span class="op" id="1937686">=</span>&nbsp;<span class="ident" id="1937688">gp</span><span class="op" id="1937690">.</span><span class="ident" id="1937691">sched</span><span class="op" id="1937696">.</span><span class="ident" id="1937697">lr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1937703">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1937707">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1937710">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1937714">nprint</span>&nbsp;<span class="op" id="1937721">:=</span>&nbsp;<span class="num" id="1937724">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1937727">var</span>&nbsp;<span class="ident" id="1937731">frame</span>&nbsp;<span class="ident" id="1937737">stkframe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1937747">frame</span><span class="op" id="1937752">.</span><span class="ident" id="1937753">pc</span>&nbsp;<span class="op" id="1937756">=</span>&nbsp;<span class="ident" id="1937758">pc0</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1937763">frame</span><span class="op" id="1937768">.</span><span class="ident" id="1937769">sp</span>&nbsp;<span class="op" id="1937772">=</span>&nbsp;<span class="ident" id="1937774">sp0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1937779">if</span>&nbsp;<span class="ident" id="1937782">usesLR</span>&nbsp;<span class="op" id="1937789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1937793">frame</span><span class="op" id="1937798">.</span><span class="ident" id="1937799">lr</span>&nbsp;<span class="op" id="1937802">=</span>&nbsp;<span class="ident" id="1937804">lr0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1937809">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1937812">waspanic</span>&nbsp;<span class="op" id="1937821">:=</span>&nbsp;<span class="builtintype" id="1937824">false</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1937831">wasnewproc</span>&nbsp;<span class="op" id="1937842">:=</span>&nbsp;<span class="builtintype" id="1937845">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1937852">printing</span>&nbsp;<span class="op" id="1937861">:=</span>&nbsp;<span class="ident" id="1937864">pcbuf</span>&nbsp;<span class="op" id="1937870">==</span>&nbsp;<span class="ident" id="1937873">nil</span>&nbsp;<span class="op" id="1937877">&amp;&amp;</span>&nbsp;<span class="ident" id="1937880">callback</span>&nbsp;<span class="op" id="1937889">==</span>&nbsp;<span class="ident" id="1937892">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1937897">_defer</span>&nbsp;<span class="op" id="1937904">:=</span>&nbsp;<span class="ident" id="1937907">gp</span><span class="op" id="1937909">.</span><span class="ident" id="1937910">_defer</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1937919">for</span>&nbsp;<span class="ident" id="1937923">_defer</span>&nbsp;<span class="op" id="1937930">!=</span>&nbsp;<span class="ident" id="1937933">nil</span>&nbsp;<span class="op" id="1937937">&amp;&amp;</span>&nbsp;<span class="builtintype" id="1937940">uintptr</span><span class="op" id="1937947">(</span><span class="ident" id="1937948">_defer</span><span class="op" id="1937954">.</span><span class="ident" id="1937955">argp</span><span class="op" id="1937959">)</span>&nbsp;<span class="op" id="1937961">==</span>&nbsp;<span class="ident" id="1937964">_NoArgs</span>&nbsp;<span class="op" id="1937972">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1937976">_defer</span>&nbsp;<span class="op" id="1937983">=</span>&nbsp;<span class="ident" id="1937985">_defer</span><span class="op" id="1937991">.</span><span class="ident" id="1937992">link</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1937998">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1938002">//&nbsp;If&nbsp;the&nbsp;PC&nbsp;is&nbsp;zero,&nbsp;it&#39;s&nbsp;likely&nbsp;a&nbsp;nil&nbsp;function&nbsp;call.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1938058">//&nbsp;Start&nbsp;in&nbsp;the&nbsp;caller&#39;s&nbsp;frame.</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1938091">if</span>&nbsp;<span class="ident" id="1938094">frame</span><span class="op" id="1938099">.</span><span class="ident" id="1938100">pc</span>&nbsp;<span class="op" id="1938103">==</span>&nbsp;<span class="num" id="1938106">0</span>&nbsp;<span class="op" id="1938108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1938112">if</span>&nbsp;<span class="ident" id="1938115">usesLR</span>&nbsp;<span class="op" id="1938122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1938127">frame</span><span class="op" id="1938132">.</span><span class="ident" id="1938133">pc</span>&nbsp;<span class="op" id="1938136">=</span>&nbsp;<span class="op" id="1938138">*</span><span class="op" id="1938139">(</span><span class="op" id="1938140">*</span><span class="builtintype" id="1938141">uintptr</span><span class="op" id="1938148">)</span><span class="op" id="1938149">(</span><span class="ident" id="1938150">unsafe</span><span class="op" id="1938156">.</span><span class="ident" id="1938157">Pointer</span><span class="op" id="1938164">(</span><span class="ident" id="1938165">frame</span><span class="op" id="1938170">.</span><span class="ident" id="1938171">sp</span><span class="op" id="1938173">)</span><span class="op" id="1938174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1938179">frame</span><span class="op" id="1938184">.</span><span class="ident" id="1938185">lr</span>&nbsp;<span class="op" id="1938188">=</span>&nbsp;<span class="num" id="1938190">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1938194">}</span>&nbsp;<span class="keyword" id="1938196">else</span>&nbsp;<span class="op" id="1938201">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1938206">frame</span><span class="op" id="1938211">.</span><span class="ident" id="1938212">pc</span>&nbsp;<span class="op" id="1938215">=</span>&nbsp;<span class="builtintype" id="1938217">uintptr</span><span class="op" id="1938224">(</span><span class="op" id="1938225">*</span><span class="op" id="1938226">(</span><span class="op" id="1938227">*</span><span class="ident" id="1938228">uintreg</span><span class="op" id="1938235">)</span><span class="op" id="1938236">(</span><span class="ident" id="1938237">unsafe</span><span class="op" id="1938243">.</span><span class="ident" id="1938244">Pointer</span><span class="op" id="1938251">(</span><span class="ident" id="1938252">frame</span><span class="op" id="1938257">.</span><span class="ident" id="1938258">sp</span><span class="op" id="1938260">)</span><span class="op" id="1938261">)</span><span class="op" id="1938262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1938267">frame</span><span class="op" id="1938272">.</span><span class="ident" id="1938273">sp</span>&nbsp;<span class="op" id="1938276">+=</span>&nbsp;<span class="ident" id="1938279">regSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1938289">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1938292">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1938296">f</span>&nbsp;<span class="op" id="1938298">:=</span>&nbsp;<span class="ident" id="1938301">findfunc</span><span class="op" id="1938309">(</span><span class="ident" id="1938310">frame</span><span class="op" id="1938315">.</span><span class="ident" id="1938316">pc</span><span class="op" id="1938318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1938321">if</span>&nbsp;<span class="ident" id="1938324">f</span>&nbsp;<span class="op" id="1938326">==</span>&nbsp;<span class="ident" id="1938329">nil</span>&nbsp;<span class="op" id="1938333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1938337">if</span>&nbsp;<span class="ident" id="1938340">callback</span>&nbsp;<span class="op" id="1938349">!=</span>&nbsp;<span class="ident" id="1938352">nil</span>&nbsp;<span class="op" id="1938356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1938361">print</span><span class="op" id="1938366">(</span><span class="string" id="1938367">&#34;runtime:&nbsp;unknown&nbsp;pc&nbsp;&#34;</span><span class="op" id="1938389">,</span>&nbsp;<span class="ident" id="1938391">hex</span><span class="op" id="1938394">(</span><span class="ident" id="1938395">frame</span><span class="op" id="1938400">.</span><span class="ident" id="1938401">pc</span><span class="op" id="1938403">)</span><span class="op" id="1938404">,</span>&nbsp;<span class="string" id="1938406">&#34;\n&#34;</span><span class="op" id="1938410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1938415">gothrow</span><span class="op" id="1938422">(</span><span class="string" id="1938423">&#34;unknown&nbsp;pc&#34;</span><span class="op" id="1938435">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1938439">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1938443">return</span>&nbsp;<span class="num" id="1938450">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1938453">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1938456">frame</span><span class="op" id="1938461">.</span><span class="ident" id="1938462">fn</span>&nbsp;<span class="op" id="1938465">=</span>&nbsp;<span class="ident" id="1938467">f</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1938471">n</span>&nbsp;<span class="op" id="1938473">:=</span>&nbsp;<span class="num" id="1938476">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1938479">for</span>&nbsp;<span class="ident" id="1938483">n</span>&nbsp;<span class="op" id="1938485">&lt;</span>&nbsp;<span class="ident" id="1938487">max</span>&nbsp;<span class="op" id="1938491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1938495">//&nbsp;Typically:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1938511">//&nbsp;&nbsp;&nbsp;&nbsppc&nbsp;is&nbsp;the&nbsp;PC&nbsp;of&nbsp;the&nbsp;running&nbsp;function.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1938554">//&nbsp;&nbsp;&nbsp;&nbspsp&nbsp;is&nbsp;the&nbsp;stack&nbsp;pointer&nbsp;at&nbsp;that&nbsp;program&nbsp;counter.</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1938608">//&nbsp;&nbsp;&nbsp;&nbspfp&nbsp;is&nbsp;the&nbsp;frame&nbsp;pointer&nbsp;(caller&#39;s&nbsp;stack&nbsp;pointer)&nbsp;at&nbsp;that&nbsp;program&nbsp;counter,&nbsp;or&nbsp;nil&nbsp;if&nbsp;unknown.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1938706">//&nbsp;&nbsp;&nbsp;&nbspstk&nbsp;is&nbsp;the&nbsp;stack&nbsp;containing&nbsp;sp.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1938743">//&nbsp;&nbsp;&nbsp;&nbspThe&nbsp;caller&#39;s&nbsp;program&nbsp;counter&nbsp;is&nbsp;lr,&nbsp;unless&nbsp;lr&nbsp;is&nbsp;zero,&nbsp;in&nbsp;which&nbsp;case&nbsp;it&nbsp;is&nbsp;*(uintptr*)sp.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1938838">f</span>&nbsp;<span class="op" id="1938840">=</span>&nbsp;<span class="ident" id="1938842">frame</span><span class="op" id="1938847">.</span><span class="ident" id="1938848">fn</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1938854">//&nbsp;Found&nbsp;an&nbsp;actual&nbsp;function.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1938885">//&nbsp;Derive&nbsp;frame&nbsp;pointer&nbsp;and&nbsp;link&nbsp;register.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1938930">if</span>&nbsp;<span class="ident" id="1938933">frame</span><span class="op" id="1938938">.</span><span class="ident" id="1938939">fp</span>&nbsp;<span class="op" id="1938942">==</span>&nbsp;<span class="num" id="1938945">0</span>&nbsp;<span class="op" id="1938947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1938952">frame</span><span class="op" id="1938957">.</span><span class="ident" id="1938958">fp</span>&nbsp;<span class="op" id="1938961">=</span>&nbsp;<span class="ident" id="1938963">frame</span><span class="op" id="1938968">.</span><span class="ident" id="1938969">sp</span>&nbsp;<span class="op" id="1938972">+</span>&nbsp;<span class="builtintype" id="1938974">uintptr</span><span class="op" id="1938981">(</span><span class="ident" id="1938982">funcspdelta</span><span class="op" id="1938993">(</span><span class="ident" id="1938994">f</span><span class="op" id="1938995">,</span>&nbsp;<span class="ident" id="1938997">frame</span><span class="op" id="1939002">.</span><span class="ident" id="1939003">pc</span><span class="op" id="1939005">)</span><span class="op" id="1939006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1939011">if</span>&nbsp;<span class="op" id="1939014">!</span><span class="ident" id="1939015">usesLR</span>&nbsp;<span class="op" id="1939022">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1939028">//&nbsp;On&nbsp;x86,&nbsp;call&nbsp;instruction&nbsp;pushes&nbsp;return&nbsp;PC&nbsp;before&nbsp;entering&nbsp;new&nbsp;function.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1939107">frame</span><span class="op" id="1939112">.</span><span class="ident" id="1939113">fp</span>&nbsp;<span class="op" id="1939116">+=</span>&nbsp;<span class="ident" id="1939119">regSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1939130">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1939134">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1939138">var</span>&nbsp;<span class="ident" id="1939142">flr</span>&nbsp;<span class="op" id="1939146">*</span><span class="ident" id="1939147">_func</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1939155">if</span>&nbsp;<span class="ident" id="1939158">topofstack</span><span class="op" id="1939168">(</span><span class="ident" id="1939169">f</span><span class="op" id="1939170">)</span>&nbsp;<span class="op" id="1939172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1939177">frame</span><span class="op" id="1939182">.</span><span class="ident" id="1939183">lr</span>&nbsp;<span class="op" id="1939186">=</span>&nbsp;<span class="num" id="1939188">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1939193">flr</span>&nbsp;<span class="op" id="1939197">=</span>&nbsp;<span class="ident" id="1939199">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1939205">}</span>&nbsp;<span class="keyword" id="1939207">else</span>&nbsp;<span class="keyword" id="1939212">if</span>&nbsp;<span class="ident" id="1939215">usesLR</span>&nbsp;<span class="op" id="1939222">&amp;&amp;</span>&nbsp;<span class="ident" id="1939225">f</span><span class="op" id="1939226">.</span><span class="ident" id="1939227">entry</span>&nbsp;<span class="op" id="1939233">==</span>&nbsp;<span class="ident" id="1939236">jmpdeferPC</span>&nbsp;<span class="op" id="1939247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1939252">//&nbsp;jmpdefer&nbsp;modifies&nbsp;SP/LR/PC&nbsp;non-atomically.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1939301">//&nbsp;If&nbsp;a&nbsp;profiling&nbsp;interrupt&nbsp;arrives&nbsp;during&nbsp;jmpdefer,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1939357">//&nbsp;the&nbsp;stack&nbsp;unwind&nbsp;may&nbsp;see&nbsp;a&nbsp;mismatched&nbsp;register&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1939414">//&nbsp;and&nbsp;get&nbsp;confused.&nbsp;Stop&nbsp;if&nbsp;we&nbsp;see&nbsp;PC&nbsp;within&nbsp;jmpdefer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1939472">//&nbsp;to&nbsp;avoid&nbsp;that&nbsp;confusion.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1939503">//&nbsp;See&nbsp;golang.org/issue/8153.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1939536">if</span>&nbsp;<span class="ident" id="1939539">callback</span>&nbsp;<span class="op" id="1939548">!=</span>&nbsp;<span class="ident" id="1939551">nil</span>&nbsp;<span class="op" id="1939555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1939561">gothrow</span><span class="op" id="1939568">(</span><span class="string" id="1939569">&#34;traceback_arm:&nbsp;found&nbsp;jmpdefer&nbsp;when&nbsp;tracing&nbsp;with&nbsp;callback&#34;</span><span class="op" id="1939627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1939632">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1939637">frame</span><span class="op" id="1939642">.</span><span class="ident" id="1939643">lr</span>&nbsp;<span class="op" id="1939646">=</span>&nbsp;<span class="num" id="1939648">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1939652">}</span>&nbsp;<span class="keyword" id="1939654">else</span>&nbsp;<span class="op" id="1939659">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1939664">if</span>&nbsp;<span class="ident" id="1939667">usesLR</span>&nbsp;<span class="op" id="1939674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1939680">if</span>&nbsp;<span class="ident" id="1939683">n</span>&nbsp;<span class="op" id="1939685">==</span>&nbsp;<span class="num" id="1939688">0</span>&nbsp;<span class="op" id="1939690">&amp;&amp;</span>&nbsp;<span class="ident" id="1939693">frame</span><span class="op" id="1939698">.</span><span class="ident" id="1939699">sp</span>&nbsp;<span class="op" id="1939702">&lt;</span>&nbsp;<span class="ident" id="1939704">frame</span><span class="op" id="1939709">.</span><span class="ident" id="1939710">fp</span>&nbsp;<span class="op" id="1939713">||</span>&nbsp;<span class="ident" id="1939716">frame</span><span class="op" id="1939721">.</span><span class="ident" id="1939722">lr</span>&nbsp;<span class="op" id="1939725">==</span>&nbsp;<span class="num" id="1939728">0</span>&nbsp;<span class="op" id="1939730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1939737">frame</span><span class="op" id="1939742">.</span><span class="ident" id="1939743">lr</span>&nbsp;<span class="op" id="1939746">=</span>&nbsp;<span class="op" id="1939748">*</span><span class="op" id="1939749">(</span><span class="op" id="1939750">*</span><span class="builtintype" id="1939751">uintptr</span><span class="op" id="1939758">)</span><span class="op" id="1939759">(</span><span class="ident" id="1939760">unsafe</span><span class="op" id="1939766">.</span><span class="ident" id="1939767">Pointer</span><span class="op" id="1939774">(</span><span class="ident" id="1939775">frame</span><span class="op" id="1939780">.</span><span class="ident" id="1939781">sp</span><span class="op" id="1939783">)</span><span class="op" id="1939784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1939790">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1939795">}</span>&nbsp;<span class="keyword" id="1939797">else</span>&nbsp;<span class="op" id="1939802">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1939808">if</span>&nbsp;<span class="ident" id="1939811">frame</span><span class="op" id="1939816">.</span><span class="ident" id="1939817">lr</span>&nbsp;<span class="op" id="1939820">==</span>&nbsp;<span class="num" id="1939823">0</span>&nbsp;<span class="op" id="1939825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1939832">frame</span><span class="op" id="1939837">.</span><span class="ident" id="1939838">lr</span>&nbsp;<span class="op" id="1939841">=</span>&nbsp;<span class="builtintype" id="1939843">uintptr</span><span class="op" id="1939850">(</span><span class="op" id="1939851">*</span><span class="op" id="1939852">(</span><span class="op" id="1939853">*</span><span class="ident" id="1939854">uintreg</span><span class="op" id="1939861">)</span><span class="op" id="1939862">(</span><span class="ident" id="1939863">unsafe</span><span class="op" id="1939869">.</span><span class="ident" id="1939870">Pointer</span><span class="op" id="1939877">(</span><span class="ident" id="1939878">frame</span><span class="op" id="1939883">.</span><span class="ident" id="1939884">fp</span>&nbsp;<span class="op" id="1939887">-</span>&nbsp;<span class="ident" id="1939889">regSize</span><span class="op" id="1939896">)</span><span class="op" id="1939897">)</span><span class="op" id="1939898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1939904">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1939909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1939914">flr</span>&nbsp;<span class="op" id="1939918">=</span>&nbsp;<span class="ident" id="1939920">findfunc</span><span class="op" id="1939928">(</span><span class="ident" id="1939929">frame</span><span class="op" id="1939934">.</span><span class="ident" id="1939935">lr</span><span class="op" id="1939937">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1939942">if</span>&nbsp;<span class="ident" id="1939945">flr</span>&nbsp;<span class="op" id="1939949">==</span>&nbsp;<span class="ident" id="1939952">nil</span>&nbsp;<span class="op" id="1939956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1939962">//&nbsp;This&nbsp;happens&nbsp;if&nbsp;you&nbsp;get&nbsp;a&nbsp;profiling&nbsp;interrupt&nbsp;at&nbsp;just&nbsp;the&nbsp;wrong&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1940039">//&nbsp;In&nbsp;that&nbsp;context&nbsp;it&nbsp;is&nbsp;okay&nbsp;to&nbsp;stop&nbsp;early.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1940088">//&nbsp;But&nbsp;if&nbsp;callback&nbsp;is&nbsp;set,&nbsp;we&#39;re&nbsp;doing&nbsp;a&nbsp;garbage&nbsp;collection&nbsp;and&nbsp;must</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1940161">//&nbsp;get&nbsp;everything,&nbsp;so&nbsp;crash&nbsp;loudly.</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1940201">if</span>&nbsp;<span class="ident" id="1940204">callback</span>&nbsp;<span class="op" id="1940213">!=</span>&nbsp;<span class="ident" id="1940216">nil</span>&nbsp;<span class="op" id="1940220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1940227">print</span><span class="op" id="1940232">(</span><span class="string" id="1940233">&#34;runtime:&nbsp;unexpected&nbsp;return&nbsp;pc&nbsp;for&nbsp;&#34;</span><span class="op" id="1940269">,</span>&nbsp;<span class="ident" id="1940271">gofuncname</span><span class="op" id="1940281">(</span><span class="ident" id="1940282">f</span><span class="op" id="1940283">)</span><span class="op" id="1940284">,</span>&nbsp;<span class="string" id="1940286">&#34;&nbsp;called&nbsp;from&nbsp;&#34;</span><span class="op" id="1940301">,</span>&nbsp;<span class="ident" id="1940303">hex</span><span class="op" id="1940306">(</span><span class="ident" id="1940307">frame</span><span class="op" id="1940312">.</span><span class="ident" id="1940313">lr</span><span class="op" id="1940315">)</span><span class="op" id="1940316">,</span>&nbsp;<span class="string" id="1940318">&#34;\n&#34;</span><span class="op" id="1940322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1940329">gothrow</span><span class="op" id="1940336">(</span><span class="string" id="1940337">&#34;unknown&nbsp;caller&nbsp;pc&#34;</span><span class="op" id="1940356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1940362">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1940367">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1940371">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1940376">frame</span><span class="op" id="1940381">.</span><span class="ident" id="1940382">varp</span>&nbsp;<span class="op" id="1940387">=</span>&nbsp;<span class="ident" id="1940389">frame</span><span class="op" id="1940394">.</span><span class="ident" id="1940395">fp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1940400">if</span>&nbsp;<span class="op" id="1940403">!</span><span class="ident" id="1940404">usesLR</span>&nbsp;<span class="op" id="1940411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1940416">//&nbsp;On&nbsp;x86,&nbsp;call&nbsp;instruction&nbsp;pushes&nbsp;return&nbsp;PC&nbsp;before&nbsp;entering&nbsp;new&nbsp;function.</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1940494">frame</span><span class="op" id="1940499">.</span><span class="ident" id="1940500">varp</span>&nbsp;<span class="op" id="1940505">-=</span>&nbsp;<span class="ident" id="1940508">regSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1940518">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1940523">//&nbsp;Derive&nbsp;size&nbsp;of&nbsp;arguments.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1940554">//&nbsp;Most&nbsp;functions&nbsp;have&nbsp;a&nbsp;fixed-size&nbsp;argument&nbsp;block,</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1940608">//&nbsp;so&nbsp;we&nbsp;can&nbsp;use&nbsp;metadata&nbsp;about&nbsp;the&nbsp;function&nbsp;f.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1940658">//&nbsp;Not&nbsp;all,&nbsp;though:&nbsp;there&nbsp;are&nbsp;some&nbsp;variadic&nbsp;functions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1940714">//&nbsp;in&nbsp;package&nbsp;runtime&nbsp;and&nbsp;reflect,&nbsp;and&nbsp;for&nbsp;those&nbsp;we&nbsp;use&nbsp;call-specific</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1940786">//&nbsp;metadata&nbsp;recorded&nbsp;by&nbsp;f&#39;s&nbsp;caller.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1940824">if</span>&nbsp;<span class="ident" id="1940827">callback</span>&nbsp;<span class="op" id="1940836">!=</span>&nbsp;<span class="ident" id="1940839">nil</span>&nbsp;<span class="op" id="1940843">||</span>&nbsp;<span class="ident" id="1940846">printing</span>&nbsp;<span class="op" id="1940855">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1940860">frame</span><span class="op" id="1940865">.</span><span class="ident" id="1940866">argp</span>&nbsp;<span class="op" id="1940871">=</span>&nbsp;<span class="ident" id="1940873">frame</span><span class="op" id="1940878">.</span><span class="ident" id="1940879">fp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1940885">if</span>&nbsp;<span class="ident" id="1940888">usesLR</span>&nbsp;<span class="op" id="1940895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1940901">frame</span><span class="op" id="1940906">.</span><span class="ident" id="1940907">argp</span>&nbsp;<span class="op" id="1940912">+=</span>&nbsp;<span class="ident" id="1940915">ptrSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1940926">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1940931">setArgInfo</span><span class="op" id="1940941">(</span><span class="op" id="1940942">&amp;</span><span class="ident" id="1940943">frame</span><span class="op" id="1940948">,</span>&nbsp;<span class="ident" id="1940950">f</span><span class="op" id="1940951">,</span>&nbsp;<span class="ident" id="1940953">callback</span>&nbsp;<span class="op" id="1940962">!=</span>&nbsp;<span class="ident" id="1940965">nil</span><span class="op" id="1940968">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1940972">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1940977">//&nbsp;Determine&nbsp;function&nbsp;SP&nbsp;where&nbsp;deferproc&nbsp;would&nbsp;find&nbsp;its&nbsp;arguments.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1941046">var</span>&nbsp;<span class="ident" id="1941050">sparg</span>&nbsp;<span class="builtintype" id="1941056">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1941066">if</span>&nbsp;<span class="ident" id="1941069">usesLR</span>&nbsp;<span class="op" id="1941076">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1941081">//&nbsp;On&nbsp;link&nbsp;register&nbsp;architectures,&nbsp;that&#39;s&nbsp;the&nbsp;standard&nbsp;bottom-of-stack&nbsp;plus&nbsp;1&nbsp;word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1941167">//&nbsp;for&nbsp;the&nbsp;saved&nbsp;LR.&nbsp;If&nbsp;the&nbsp;previous&nbsp;frame&nbsp;was&nbsp;a&nbsp;direct&nbsp;call&nbsp;to&nbsp;newproc/deferproc,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1941253">//&nbsp;however,&nbsp;the&nbsp;SP&nbsp;is&nbsp;three&nbsp;words&nbsp;lower&nbsp;than&nbsp;normal.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1941309">//&nbsp;If&nbsp;the&nbsp;function&nbsp;has&nbsp;no&nbsp;frame&nbsp;at&nbsp;all&nbsp;-&nbsp;perhaps&nbsp;it&nbsp;just&nbsp;started,&nbsp;or&nbsp;perhaps</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1941389">//&nbsp;it&nbsp;is&nbsp;a&nbsp;leaf&nbsp;with&nbsp;no&nbsp;local&nbsp;variables&nbsp;-&nbsp;then&nbsp;we&nbsp;cannot&nbsp;possibly&nbsp;find&nbsp;its</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1941467">//&nbsp;SP&nbsp;in&nbsp;a&nbsp;defer,&nbsp;and&nbsp;we&nbsp;might&nbsp;confuse&nbsp;its&nbsp;SP&nbsp;for&nbsp;its&nbsp;caller&#39;s&nbsp;SP,&nbsp;so</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1941540">//&nbsp;leave&nbsp;sparg=0&nbsp;in&nbsp;that&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1941574">if</span>&nbsp;<span class="ident" id="1941577">frame</span><span class="op" id="1941582">.</span><span class="ident" id="1941583">fp</span>&nbsp;<span class="op" id="1941586">!=</span>&nbsp;<span class="ident" id="1941589">frame</span><span class="op" id="1941594">.</span><span class="ident" id="1941595">sp</span>&nbsp;<span class="op" id="1941598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1941604">sparg</span>&nbsp;<span class="op" id="1941610">=</span>&nbsp;<span class="ident" id="1941612">frame</span><span class="op" id="1941617">.</span><span class="ident" id="1941618">sp</span>&nbsp;<span class="op" id="1941621">+</span>&nbsp;<span class="ident" id="1941623">regSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1941635">if</span>&nbsp;<span class="ident" id="1941638">wasnewproc</span>&nbsp;<span class="op" id="1941649">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1941656">sparg</span>&nbsp;<span class="op" id="1941662">+=</span>&nbsp;<span class="num" id="1941665">3</span>&nbsp;<span class="op" id="1941667">*</span>&nbsp;<span class="ident" id="1941669">regSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1941681">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1941686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1941690">}</span>&nbsp;<span class="keyword" id="1941692">else</span>&nbsp;<span class="op" id="1941697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1941702">//&nbsp;On&nbsp;x86&nbsp;that&#39;s&nbsp;the&nbsp;standard&nbsp;bottom-of-stack,&nbsp;so&nbsp;SP&nbsp;exactly.</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1941767">//&nbsp;If&nbsp;the&nbsp;previous&nbsp;frame&nbsp;was&nbsp;a&nbsp;direct&nbsp;call&nbsp;to&nbsp;newproc/deferproc,&nbsp;however,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1941844">//&nbsp;the&nbsp;SP&nbsp;is&nbsp;two&nbsp;words&nbsp;lower&nbsp;than&nbsp;normal.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1941889">sparg</span>&nbsp;<span class="op" id="1941895">=</span>&nbsp;<span class="ident" id="1941897">frame</span><span class="op" id="1941902">.</span><span class="ident" id="1941903">sp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1941909">if</span>&nbsp;<span class="ident" id="1941912">wasnewproc</span>&nbsp;<span class="op" id="1941923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1941929">sparg</span>&nbsp;<span class="op" id="1941935">+=</span>&nbsp;<span class="num" id="1941938">2</span>&nbsp;<span class="op" id="1941940">*</span>&nbsp;<span class="ident" id="1941942">ptrSize</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1941953">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1941957">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1941962">//&nbsp;Determine&nbsp;frame&#39;s&nbsp;&#39;continuation&nbsp;PC&#39;,&nbsp;where&nbsp;it&nbsp;can&nbsp;continue.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1942027">//&nbsp;Normally&nbsp;this&nbsp;is&nbsp;the&nbsp;return&nbsp;address&nbsp;on&nbsp;the&nbsp;stack,&nbsp;but&nbsp;if&nbsp;sigpanic</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1942098">//&nbsp;is&nbsp;immediately&nbsp;below&nbsp;this&nbsp;function&nbsp;on&nbsp;the&nbsp;stack,&nbsp;then&nbsp;the&nbsp;frame</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1942167">//&nbsp;stopped&nbsp;executing&nbsp;due&nbsp;to&nbsp;a&nbsp;trap,&nbsp;and&nbsp;frame.pc&nbsp;is&nbsp;probably&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1942234">//&nbsp;a&nbsp;safe&nbsp;point&nbsp;for&nbsp;looking&nbsp;up&nbsp;liveness&nbsp;information.&nbsp;In&nbsp;this&nbsp;panicking&nbsp;case,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1942313">//&nbsp;the&nbsp;function&nbsp;either&nbsp;doesn&#39;t&nbsp;return&nbsp;at&nbsp;all&nbsp;(if&nbsp;it&nbsp;has&nbsp;no&nbsp;defers&nbsp;or&nbsp;if&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1942391">//&nbsp;defers&nbsp;do&nbsp;not&nbsp;recover)&nbsp;or&nbsp;it&nbsp;returns&nbsp;from&nbsp;one&nbsp;of&nbsp;the&nbsp;calls&nbsp;to</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1942458">//&nbsp;deferproc&nbsp;a&nbsp;second&nbsp;time&nbsp;(if&nbsp;the&nbsp;corresponding&nbsp;deferred&nbsp;func&nbsp;recovers).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1942534">//&nbsp;It&nbsp;suffices&nbsp;to&nbsp;assume&nbsp;that&nbsp;the&nbsp;most&nbsp;recent&nbsp;deferproc&nbsp;is&nbsp;the&nbsp;one&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1942608">//&nbsp;returns;&nbsp;everything&nbsp;live&nbsp;at&nbsp;earlier&nbsp;deferprocs&nbsp;is&nbsp;still&nbsp;live&nbsp;at&nbsp;that&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1942687">frame</span><span class="op" id="1942692">.</span><span class="ident" id="1942693">continpc</span>&nbsp;<span class="op" id="1942702">=</span>&nbsp;<span class="ident" id="1942704">frame</span><span class="op" id="1942709">.</span><span class="ident" id="1942710">pc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1942715">if</span>&nbsp;<span class="ident" id="1942718">waspanic</span>&nbsp;<span class="op" id="1942727">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1942732">if</span>&nbsp;<span class="ident" id="1942735">_defer</span>&nbsp;<span class="op" id="1942742">!=</span>&nbsp;<span class="ident" id="1942745">nil</span>&nbsp;<span class="op" id="1942749">&amp;&amp;</span>&nbsp;<span class="ident" id="1942752">_defer</span><span class="op" id="1942758">.</span><span class="ident" id="1942759">argp</span>&nbsp;<span class="op" id="1942764">==</span>&nbsp;<span class="ident" id="1942767">sparg</span>&nbsp;<span class="op" id="1942773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1942779">frame</span><span class="op" id="1942784">.</span><span class="ident" id="1942785">continpc</span>&nbsp;<span class="op" id="1942794">=</span>&nbsp;<span class="ident" id="1942796">_defer</span><span class="op" id="1942802">.</span><span class="ident" id="1942803">pc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1942809">}</span>&nbsp;<span class="keyword" id="1942811">else</span>&nbsp;<span class="op" id="1942816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1942822">frame</span><span class="op" id="1942827">.</span><span class="ident" id="1942828">continpc</span>&nbsp;<span class="op" id="1942837">=</span>&nbsp;<span class="num" id="1942839">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1942844">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1942848">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1942853">//&nbsp;Unwind&nbsp;our&nbsp;local&nbsp;defer&nbsp;stack&nbsp;past&nbsp;this&nbsp;frame.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1942904">for</span>&nbsp;<span class="ident" id="1942908">_defer</span>&nbsp;<span class="op" id="1942915">!=</span>&nbsp;<span class="ident" id="1942918">nil</span>&nbsp;<span class="op" id="1942922">&amp;&amp;</span>&nbsp;<span class="op" id="1942925">(</span><span class="ident" id="1942926">_defer</span><span class="op" id="1942932">.</span><span class="ident" id="1942933">argp</span>&nbsp;<span class="op" id="1942938">==</span>&nbsp;<span class="ident" id="1942941">sparg</span>&nbsp;<span class="op" id="1942947">||</span>&nbsp;<span class="ident" id="1942950">_defer</span><span class="op" id="1942956">.</span><span class="ident" id="1942957">argp</span>&nbsp;<span class="op" id="1942962">==</span>&nbsp;<span class="ident" id="1942965">_NoArgs</span><span class="op" id="1942972">)</span>&nbsp;<span class="op" id="1942974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1942979">_defer</span>&nbsp;<span class="op" id="1942986">=</span>&nbsp;<span class="ident" id="1942988">_defer</span><span class="op" id="1942994">.</span><span class="ident" id="1942995">link</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1943002">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1943007">if</span>&nbsp;<span class="ident" id="1943010">skip</span>&nbsp;<span class="op" id="1943015">&gt;</span>&nbsp;<span class="num" id="1943017">0</span>&nbsp;<span class="op" id="1943019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1943024">skip</span><span class="op" id="1943028">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1943034">goto</span>&nbsp;<span class="ident" id="1943039">skipped</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1943049">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1943054">if</span>&nbsp;<span class="ident" id="1943057">pcbuf</span>&nbsp;<span class="op" id="1943063">!=</span>&nbsp;<span class="ident" id="1943066">nil</span>&nbsp;<span class="op" id="1943070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1943075">(</span><span class="op" id="1943076">*</span><span class="op" id="1943077">[</span><span class="num" id="1943078">1</span>&nbsp;<span class="op" id="1943080">&lt;&lt;</span>&nbsp;<span class="num" id="1943083">20</span><span class="op" id="1943085">]</span><span class="builtintype" id="1943086">uintptr</span><span class="op" id="1943093">)</span><span class="op" id="1943094">(</span><span class="ident" id="1943095">unsafe</span><span class="op" id="1943101">.</span><span class="ident" id="1943102">Pointer</span><span class="op" id="1943109">(</span><span class="ident" id="1943110">pcbuf</span><span class="op" id="1943115">)</span><span class="op" id="1943116">)</span><span class="op" id="1943117">[</span><span class="ident" id="1943118">n</span><span class="op" id="1943119">]</span>&nbsp;<span class="op" id="1943121">=</span>&nbsp;<span class="ident" id="1943123">frame</span><span class="op" id="1943128">.</span><span class="ident" id="1943129">pc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1943134">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1943138">if</span>&nbsp;<span class="ident" id="1943141">callback</span>&nbsp;<span class="op" id="1943150">!=</span>&nbsp;<span class="ident" id="1943153">nil</span>&nbsp;<span class="op" id="1943157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1943162">if</span>&nbsp;<span class="op" id="1943165">!</span><span class="ident" id="1943166">callback</span><span class="op" id="1943174">(</span><span class="op" id="1943175">(</span><span class="op" id="1943176">*</span><span class="ident" id="1943177">stkframe</span><span class="op" id="1943185">)</span><span class="op" id="1943186">(</span><span class="ident" id="1943187">noescape</span><span class="op" id="1943195">(</span><span class="ident" id="1943196">unsafe</span><span class="op" id="1943202">.</span><span class="ident" id="1943203">Pointer</span><span class="op" id="1943210">(</span><span class="op" id="1943211">&amp;</span><span class="ident" id="1943212">frame</span><span class="op" id="1943217">)</span><span class="op" id="1943218">)</span><span class="op" id="1943219">)</span><span class="op" id="1943220">,</span>&nbsp;<span class="ident" id="1943222">v</span><span class="op" id="1943223">)</span>&nbsp;<span class="op" id="1943225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1943231">return</span>&nbsp;<span class="ident" id="1943238">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1943243">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1943247">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1943251">if</span>&nbsp;<span class="ident" id="1943254">printing</span>&nbsp;<span class="op" id="1943263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1943268">if</span>&nbsp;<span class="op" id="1943271">(</span><span class="ident" id="1943272">flags</span><span class="op" id="1943277">&amp;</span><span class="ident" id="1943278">_TraceRuntimeFrames</span><span class="op" id="1943297">)</span>&nbsp;<span class="op" id="1943299">!=</span>&nbsp;<span class="num" id="1943302">0</span>&nbsp;<span class="op" id="1943304">||</span>&nbsp;<span class="ident" id="1943307">showframe</span><span class="op" id="1943316">(</span><span class="ident" id="1943317">f</span><span class="op" id="1943318">,</span>&nbsp;<span class="ident" id="1943320">gp</span><span class="op" id="1943322">)</span>&nbsp;<span class="op" id="1943324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1943330">//&nbsp;Print&nbsp;during&nbsp;crash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1943357">//&nbsp;&nbsp;&nbsp;&nbspmain(0x1,&nbsp;0x2,&nbsp;0x3)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1943384">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp/home/rsc/go/src/runtime/x.go:23&nbsp;+0xf</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1943430">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1943437">tracepc</span>&nbsp;<span class="op" id="1943445">:=</span>&nbsp;<span class="ident" id="1943448">frame</span><span class="op" id="1943453">.</span><span class="ident" id="1943454">pc</span>&nbsp;<span class="comment" id="1943457">//&nbsp;back&nbsp;up&nbsp;to&nbsp;CALL&nbsp;instruction&nbsp;for&nbsp;funcline.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1943506">if</span>&nbsp;<span class="op" id="1943509">(</span><span class="ident" id="1943510">n</span>&nbsp;<span class="op" id="1943512">&gt;</span>&nbsp;<span class="num" id="1943514">0</span>&nbsp;<span class="op" id="1943516">||</span>&nbsp;<span class="ident" id="1943519">flags</span><span class="op" id="1943524">&amp;</span><span class="ident" id="1943525">_TraceTrap</span>&nbsp;<span class="op" id="1943536">==</span>&nbsp;<span class="num" id="1943539">0</span><span class="op" id="1943540">)</span>&nbsp;<span class="op" id="1943542">&amp;&amp;</span>&nbsp;<span class="ident" id="1943545">frame</span><span class="op" id="1943550">.</span><span class="ident" id="1943551">pc</span>&nbsp;<span class="op" id="1943554">&gt;</span>&nbsp;<span class="ident" id="1943556">f</span><span class="op" id="1943557">.</span><span class="ident" id="1943558">entry</span>&nbsp;<span class="op" id="1943564">&amp;&amp;</span>&nbsp;<span class="op" id="1943567">!</span><span class="ident" id="1943568">waspanic</span>&nbsp;<span class="op" id="1943577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1943584">tracepc</span><span class="op" id="1943591">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1943598">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1943604">print</span><span class="op" id="1943609">(</span><span class="ident" id="1943610">gofuncname</span><span class="op" id="1943620">(</span><span class="ident" id="1943621">f</span><span class="op" id="1943622">)</span><span class="op" id="1943623">,</span>&nbsp;<span class="string" id="1943625">&#34;(&#34;</span><span class="op" id="1943628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1943634">argp</span>&nbsp;<span class="op" id="1943639">:=</span>&nbsp;<span class="op" id="1943642">(</span><span class="op" id="1943643">*</span><span class="op" id="1943644">[</span><span class="num" id="1943645">100</span><span class="op" id="1943648">]</span><span class="builtintype" id="1943649">uintptr</span><span class="op" id="1943656">)</span><span class="op" id="1943657">(</span><span class="ident" id="1943658">unsafe</span><span class="op" id="1943664">.</span><span class="ident" id="1943665">Pointer</span><span class="op" id="1943672">(</span><span class="ident" id="1943673">frame</span><span class="op" id="1943678">.</span><span class="ident" id="1943679">argp</span><span class="op" id="1943683">)</span><span class="op" id="1943684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1943690">for</span>&nbsp;<span class="ident" id="1943694">i</span>&nbsp;<span class="op" id="1943696">:=</span>&nbsp;<span class="builtintype" id="1943699">uintptr</span><span class="op" id="1943706">(</span><span class="num" id="1943707">0</span><span class="op" id="1943708">)</span><span class="op" id="1943709">;</span>&nbsp;<span class="ident" id="1943711">i</span>&nbsp;<span class="op" id="1943713">&lt;</span>&nbsp;<span class="ident" id="1943715">frame</span><span class="op" id="1943720">.</span><span class="ident" id="1943721">arglen</span><span class="op" id="1943727">/</span><span class="ident" id="1943728">ptrSize</span><span class="op" id="1943735">;</span>&nbsp;<span class="ident" id="1943737">i</span><span class="op" id="1943738">++</span>&nbsp;<span class="op" id="1943741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1943748">if</span>&nbsp;<span class="ident" id="1943751">i</span>&nbsp;<span class="op" id="1943753">&gt;=</span>&nbsp;<span class="num" id="1943756">10</span>&nbsp;<span class="op" id="1943759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1943767">print</span><span class="op" id="1943772">(</span><span class="string" id="1943773">&#34;,&nbsp;...&#34;</span><span class="op" id="1943780">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1943788">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1943799">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1943806">if</span>&nbsp;<span class="ident" id="1943809">i</span>&nbsp;<span class="op" id="1943811">!=</span>&nbsp;<span class="num" id="1943814">0</span>&nbsp;<span class="op" id="1943816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1943824">print</span><span class="op" id="1943829">(</span><span class="string" id="1943830">&#34;,&nbsp;&#34;</span><span class="op" id="1943834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1943841">}</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1943848">print</span><span class="op" id="1943853">(</span><span class="ident" id="1943854">hex</span><span class="op" id="1943857">(</span><span class="ident" id="1943858">argp</span><span class="op" id="1943862">[</span><span class="ident" id="1943863">i</span><span class="op" id="1943864">]</span><span class="op" id="1943865">)</span><span class="op" id="1943866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1943872">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1943878">print</span><span class="op" id="1943883">(</span><span class="string" id="1943884">&#34;)\n&#34;</span><span class="op" id="1943889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1943895">var</span>&nbsp;<span class="ident" id="1943899">file</span>&nbsp;<span class="builtintype" id="1943904">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1943915">line</span>&nbsp;<span class="op" id="1943920">:=</span>&nbsp;<span class="ident" id="1943923">funcline</span><span class="op" id="1943931">(</span><span class="ident" id="1943932">f</span><span class="op" id="1943933">,</span>&nbsp;<span class="ident" id="1943935">tracepc</span><span class="op" id="1943942">,</span>&nbsp;<span class="op" id="1943944">&amp;</span><span class="ident" id="1943945">file</span><span class="op" id="1943949">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1943955">print</span><span class="op" id="1943960">(</span><span class="string" id="1943961">&#34;\t&#34;</span><span class="op" id="1943965">,</span>&nbsp;<span class="ident" id="1943967">file</span><span class="op" id="1943971">,</span>&nbsp;<span class="string" id="1943973">&#34;:&#34;</span><span class="op" id="1943976">,</span>&nbsp;<span class="ident" id="1943978">line</span><span class="op" id="1943982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1943988">if</span>&nbsp;<span class="ident" id="1943991">frame</span><span class="op" id="1943996">.</span><span class="ident" id="1943997">pc</span>&nbsp;<span class="op" id="1944000">&gt;</span>&nbsp;<span class="ident" id="1944002">f</span><span class="op" id="1944003">.</span><span class="ident" id="1944004">entry</span>&nbsp;<span class="op" id="1944010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1944017">print</span><span class="op" id="1944022">(</span><span class="string" id="1944023">&#34;&nbsp;+&#34;</span><span class="op" id="1944027">,</span>&nbsp;<span class="ident" id="1944029">hex</span><span class="op" id="1944032">(</span><span class="ident" id="1944033">frame</span><span class="op" id="1944038">.</span><span class="ident" id="1944039">pc</span><span class="op" id="1944041">-</span><span class="ident" id="1944042">f</span><span class="op" id="1944043">.</span><span class="ident" id="1944044">entry</span><span class="op" id="1944049">)</span><span class="op" id="1944050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1944056">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1944062">if</span>&nbsp;<span class="ident" id="1944065">g</span><span class="op" id="1944066">.</span><span class="ident" id="1944067">m</span><span class="op" id="1944068">.</span><span class="ident" id="1944069">throwing</span>&nbsp;<span class="op" id="1944078">&gt;</span>&nbsp;<span class="num" id="1944080">0</span>&nbsp;<span class="op" id="1944082">&amp;&amp;</span>&nbsp;<span class="ident" id="1944085">gp</span>&nbsp;<span class="op" id="1944088">==</span>&nbsp;<span class="ident" id="1944091">g</span><span class="op" id="1944092">.</span><span class="ident" id="1944093">m</span><span class="op" id="1944094">.</span><span class="ident" id="1944095">curg</span>&nbsp;<span class="op" id="1944100">||</span>&nbsp;<span class="ident" id="1944103">gotraceback</span>&nbsp;<span class="op" id="1944115">&gt;=</span>&nbsp;<span class="num" id="1944118">2</span>&nbsp;<span class="op" id="1944120">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1944127">print</span><span class="op" id="1944132">(</span><span class="string" id="1944133">&#34;&nbsp;fp=&#34;</span><span class="op" id="1944139">,</span>&nbsp;<span class="ident" id="1944141">hex</span><span class="op" id="1944144">(</span><span class="ident" id="1944145">frame</span><span class="op" id="1944150">.</span><span class="ident" id="1944151">fp</span><span class="op" id="1944153">)</span><span class="op" id="1944154">,</span>&nbsp;<span class="string" id="1944156">&#34;&nbsp;sp=&#34;</span><span class="op" id="1944162">,</span>&nbsp;<span class="ident" id="1944164">hex</span><span class="op" id="1944167">(</span><span class="ident" id="1944168">frame</span><span class="op" id="1944173">.</span><span class="ident" id="1944174">sp</span><span class="op" id="1944176">)</span><span class="op" id="1944177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1944183">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1944189">print</span><span class="op" id="1944194">(</span><span class="string" id="1944195">&#34;\n&#34;</span><span class="op" id="1944199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1944205">nprint</span><span class="op" id="1944211">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1944217">}</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1944221">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1944225">n</span><span class="op" id="1944226">++</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1944231">skipped</span><span class="op" id="1944238">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1944242">waspanic</span>&nbsp;<span class="op" id="1944251">=</span>&nbsp;<span class="ident" id="1944253">f</span><span class="op" id="1944254">.</span><span class="ident" id="1944255">entry</span>&nbsp;<span class="op" id="1944261">==</span>&nbsp;<span class="ident" id="1944264">sigpanicPC</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1944277">wasnewproc</span>&nbsp;<span class="op" id="1944288">=</span>&nbsp;<span class="ident" id="1944290">f</span><span class="op" id="1944291">.</span><span class="ident" id="1944292">entry</span>&nbsp;<span class="op" id="1944298">==</span>&nbsp;<span class="ident" id="1944301">newprocPC</span>&nbsp;<span class="op" id="1944311">||</span>&nbsp;<span class="ident" id="1944314">f</span><span class="op" id="1944315">.</span><span class="ident" id="1944316">entry</span>&nbsp;<span class="op" id="1944322">==</span>&nbsp;<span class="ident" id="1944325">deferprocPC</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1944340">//&nbsp;Do&nbsp;not&nbsp;unwind&nbsp;past&nbsp;the&nbsp;bottom&nbsp;of&nbsp;the&nbsp;stack.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1944389">if</span>&nbsp;<span class="ident" id="1944392">flr</span>&nbsp;<span class="op" id="1944396">==</span>&nbsp;<span class="ident" id="1944399">nil</span>&nbsp;<span class="op" id="1944403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1944408">break</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1944416">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1944421">//&nbsp;Unwind&nbsp;to&nbsp;next&nbsp;frame.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1944448">frame</span><span class="op" id="1944453">.</span><span class="ident" id="1944454">fn</span>&nbsp;<span class="op" id="1944457">=</span>&nbsp;<span class="ident" id="1944459">flr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1944465">frame</span><span class="op" id="1944470">.</span><span class="ident" id="1944471">pc</span>&nbsp;<span class="op" id="1944474">=</span>&nbsp;<span class="ident" id="1944476">frame</span><span class="op" id="1944481">.</span><span class="ident" id="1944482">lr</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1944487">frame</span><span class="op" id="1944492">.</span><span class="ident" id="1944493">lr</span>&nbsp;<span class="op" id="1944496">=</span>&nbsp;<span class="num" id="1944498">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1944502">frame</span><span class="op" id="1944507">.</span><span class="ident" id="1944508">sp</span>&nbsp;<span class="op" id="1944511">=</span>&nbsp;<span class="ident" id="1944513">frame</span><span class="op" id="1944518">.</span><span class="ident" id="1944519">fp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1944524">frame</span><span class="op" id="1944529">.</span><span class="ident" id="1944530">fp</span>&nbsp;<span class="op" id="1944533">=</span>&nbsp;<span class="num" id="1944535">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1944539">frame</span><span class="op" id="1944544">.</span><span class="ident" id="1944545">argmap</span>&nbsp;<span class="op" id="1944552">=</span>&nbsp;<span class="ident" id="1944554">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1944561">//&nbsp;On&nbsp;link&nbsp;register&nbsp;architectures,&nbsp;sighandler&nbsp;saves&nbsp;the&nbsp;LR&nbsp;on&nbsp;stack</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1944631">//&nbsp;before&nbsp;faking&nbsp;a&nbsp;call&nbsp;to&nbsp;sigpanic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1944670">if</span>&nbsp;<span class="ident" id="1944673">usesLR</span>&nbsp;<span class="op" id="1944680">&amp;&amp;</span>&nbsp;<span class="ident" id="1944683">waspanic</span>&nbsp;<span class="op" id="1944692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1944697">x</span>&nbsp;<span class="op" id="1944699">:=</span>&nbsp;<span class="op" id="1944702">*</span><span class="op" id="1944703">(</span><span class="op" id="1944704">*</span><span class="builtintype" id="1944705">uintptr</span><span class="op" id="1944712">)</span><span class="op" id="1944713">(</span><span class="ident" id="1944714">unsafe</span><span class="op" id="1944720">.</span><span class="ident" id="1944721">Pointer</span><span class="op" id="1944728">(</span><span class="ident" id="1944729">frame</span><span class="op" id="1944734">.</span><span class="ident" id="1944735">sp</span><span class="op" id="1944737">)</span><span class="op" id="1944738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1944743">frame</span><span class="op" id="1944748">.</span><span class="ident" id="1944749">sp</span>&nbsp;<span class="op" id="1944752">+=</span>&nbsp;<span class="ident" id="1944755">ptrSize</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1944766">f</span>&nbsp;<span class="op" id="1944768">=</span>&nbsp;<span class="ident" id="1944770">findfunc</span><span class="op" id="1944778">(</span><span class="ident" id="1944779">frame</span><span class="op" id="1944784">.</span><span class="ident" id="1944785">pc</span><span class="op" id="1944787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1944792">frame</span><span class="op" id="1944797">.</span><span class="ident" id="1944798">fn</span>&nbsp;<span class="op" id="1944801">=</span>&nbsp;<span class="ident" id="1944803">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1944808">if</span>&nbsp;<span class="ident" id="1944811">f</span>&nbsp;<span class="op" id="1944813">==</span>&nbsp;<span class="ident" id="1944816">nil</span>&nbsp;<span class="op" id="1944820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1944826">frame</span><span class="op" id="1944831">.</span><span class="ident" id="1944832">pc</span>&nbsp;<span class="op" id="1944835">=</span>&nbsp;<span class="ident" id="1944837">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1944842">}</span>&nbsp;<span class="keyword" id="1944844">else</span>&nbsp;<span class="keyword" id="1944849">if</span>&nbsp;<span class="ident" id="1944852">f</span><span class="op" id="1944853">.</span><span class="ident" id="1944854">frame</span>&nbsp;<span class="op" id="1944860">==</span>&nbsp;<span class="num" id="1944863">0</span>&nbsp;<span class="op" id="1944865">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1944871">frame</span><span class="op" id="1944876">.</span><span class="ident" id="1944877">lr</span>&nbsp;<span class="op" id="1944880">=</span>&nbsp;<span class="ident" id="1944882">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1944887">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1944891">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1944894">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1944898">if</span>&nbsp;<span class="ident" id="1944901">pcbuf</span>&nbsp;<span class="op" id="1944907">==</span>&nbsp;<span class="ident" id="1944910">nil</span>&nbsp;<span class="op" id="1944914">&amp;&amp;</span>&nbsp;<span class="ident" id="1944917">callback</span>&nbsp;<span class="op" id="1944926">==</span>&nbsp;<span class="ident" id="1944929">nil</span>&nbsp;<span class="op" id="1944933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1944937">n</span>&nbsp;<span class="op" id="1944939">=</span>&nbsp;<span class="ident" id="1944941">nprint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1944949">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1944953">//&nbsp;If&nbsp;callback&nbsp;!=&nbsp;nil,&nbsp;we&#39;re&nbsp;being&nbsp;called&nbsp;to&nbsp;gather&nbsp;stack&nbsp;information&nbsp;during</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1945031">//&nbsp;garbage&nbsp;collection&nbsp;or&nbsp;stack&nbsp;growth.&nbsp;In&nbsp;that&nbsp;context,&nbsp;require&nbsp;that&nbsp;we&nbsp;used</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1945109">//&nbsp;up&nbsp;the&nbsp;entire&nbsp;defer&nbsp;stack.&nbsp;If&nbsp;not,&nbsp;then&nbsp;there&nbsp;is&nbsp;a&nbsp;bug&nbsp;somewhere&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1945186">//&nbsp;garbage&nbsp;collection&nbsp;or&nbsp;stack&nbsp;growth&nbsp;may&nbsp;not&nbsp;have&nbsp;seen&nbsp;the&nbsp;correct&nbsp;picture</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1945263">//&nbsp;of&nbsp;the&nbsp;stack.&nbsp;Crash&nbsp;now&nbsp;instead&nbsp;of&nbsp;silently&nbsp;executing&nbsp;the&nbsp;garbage&nbsp;collection</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1945344">//&nbsp;or&nbsp;stack&nbsp;copy&nbsp;incorrectly&nbsp;and&nbsp;setting&nbsp;up&nbsp;for&nbsp;a&nbsp;mysterious&nbsp;crash&nbsp;later.</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1945419">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1945423">//&nbsp;Note&nbsp;that&nbsp;panic&nbsp;!=&nbsp;nil&nbsp;is&nbsp;okay&nbsp;here:&nbsp;there&nbsp;can&nbsp;be&nbsp;leftover&nbsp;panics,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1945494">//&nbsp;because&nbsp;the&nbsp;defers&nbsp;on&nbsp;the&nbsp;panic&nbsp;stack&nbsp;do&nbsp;not&nbsp;nest&nbsp;in&nbsp;frame&nbsp;order&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1945566">//&nbsp;they&nbsp;do&nbsp;on&nbsp;the&nbsp;defer&nbsp;stack.&nbsp;If&nbsp;you&nbsp;have:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1945611">//</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1945615">//&nbsp;&nbsp;&nbsp;&nbspframe&nbsp;1&nbsp;defers&nbsp;d1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1945637">//&nbsp;&nbsp;&nbsp;&nbspframe&nbsp;2&nbsp;defers&nbsp;d2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1945659">//&nbsp;&nbsp;&nbsp;&nbspframe&nbsp;3&nbsp;defers&nbsp;d3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1945681">//&nbsp;&nbsp;&nbsp;&nbspframe&nbsp;4&nbsp;panics</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1945700">//&nbsp;&nbsp;&nbsp;&nbspframe&nbsp;4&#39;s&nbsp;panic&nbsp;starts&nbsp;running&nbsp;defers</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1945742">//&nbsp;&nbsp;&nbsp;&nbspframe&nbsp;5,&nbsp;running&nbsp;d3,&nbsp;defers&nbsp;d4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1945777">//&nbsp;&nbsp;&nbsp;&nbspframe&nbsp;5&nbsp;panics</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1945796">//&nbsp;&nbsp;&nbsp;&nbspframe&nbsp;5&#39;s&nbsp;panic&nbsp;starts&nbsp;running&nbsp;defers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1945838">//&nbsp;&nbsp;&nbsp;&nbspframe&nbsp;6,&nbsp;running&nbsp;d4,&nbsp;garbage&nbsp;collects</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1945880">//&nbsp;&nbsp;&nbsp;&nbspframe&nbsp;6,&nbsp;running&nbsp;d2,&nbsp;garbage&nbsp;collects</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1945922">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1945926">//&nbsp;During&nbsp;the&nbsp;execution&nbsp;of&nbsp;d4,&nbsp;the&nbsp;panic&nbsp;stack&nbsp;is&nbsp;d4&nbsp;-&gt;&nbsp;d3,&nbsp;which</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1945993">//&nbsp;is&nbsp;nested&nbsp;properly,&nbsp;and&nbsp;we&#39;ll&nbsp;treat&nbsp;frame&nbsp;3&nbsp;as&nbsp;resumable,&nbsp;because&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1946066">//&nbsp;can&nbsp;find&nbsp;d3.&nbsp;(And&nbsp;in&nbsp;fact&nbsp;frame&nbsp;3&nbsp;is&nbsp;resumable.&nbsp;If&nbsp;d4&nbsp;recovers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1946133">//&nbsp;and&nbsp;frame&nbsp;5&nbsp;continues&nbsp;running,&nbsp;d3,&nbsp;d3&nbsp;can&nbsp;recover&nbsp;and&nbsp;we&#39;ll</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1946197">//&nbsp;resume&nbsp;execution&nbsp;in&nbsp;(returning&nbsp;from)&nbsp;frame&nbsp;3.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1946248">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1946252">//&nbsp;During&nbsp;the&nbsp;execution&nbsp;of&nbsp;d2,&nbsp;however,&nbsp;the&nbsp;panic&nbsp;stack&nbsp;is&nbsp;d2&nbsp;-&gt;&nbsp;d3,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1946322">//&nbsp;which&nbsp;is&nbsp;inverted.&nbsp;The&nbsp;scan&nbsp;will&nbsp;match&nbsp;d2&nbsp;to&nbsp;frame&nbsp;2&nbsp;but&nbsp;having</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1946390">//&nbsp;d2&nbsp;on&nbsp;the&nbsp;stack&nbsp;until&nbsp;then&nbsp;means&nbsp;it&nbsp;will&nbsp;not&nbsp;match&nbsp;d3&nbsp;to&nbsp;frame&nbsp;3.</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1946460">//&nbsp;This&nbsp;is&nbsp;okay:&nbsp;if&nbsp;we&#39;re&nbsp;running&nbsp;d2,&nbsp;then&nbsp;all&nbsp;the&nbsp;defers&nbsp;after&nbsp;d2&nbsp;have</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1946533">//&nbsp;completed&nbsp;and&nbsp;their&nbsp;corresponding&nbsp;frames&nbsp;are&nbsp;dead.&nbsp;Not&nbsp;finding&nbsp;d3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1946603">//&nbsp;for&nbsp;frame&nbsp;3&nbsp;means&nbsp;we&#39;ll&nbsp;set&nbsp;frame&nbsp;3&#39;s&nbsp;continpc&nbsp;==&nbsp;0,&nbsp;which&nbsp;is&nbsp;correct</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1946677">//&nbsp;(frame&nbsp;3&nbsp;is&nbsp;dead).&nbsp;At&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;walk&nbsp;the&nbsp;panic&nbsp;stack&nbsp;can&nbsp;thus</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1946748">//&nbsp;contain&nbsp;defers&nbsp;(d3&nbsp;in&nbsp;this&nbsp;case)&nbsp;for&nbsp;dead&nbsp;frames.&nbsp;The&nbsp;inversion&nbsp;here</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1946821">//&nbsp;always&nbsp;indicates&nbsp;a&nbsp;dead&nbsp;frame,&nbsp;and&nbsp;the&nbsp;effect&nbsp;of&nbsp;the&nbsp;inversion&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1946895">//&nbsp;scan&nbsp;is&nbsp;to&nbsp;hide&nbsp;those&nbsp;dead&nbsp;frames,&nbsp;so&nbsp;the&nbsp;scan&nbsp;is&nbsp;still&nbsp;okay:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1946961">//&nbsp;what&#39;s&nbsp;left&nbsp;on&nbsp;the&nbsp;panic&nbsp;stack&nbsp;are&nbsp;exactly&nbsp;(and&nbsp;only)&nbsp;the&nbsp;dead&nbsp;frames.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1947036">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1947040">//&nbsp;We&nbsp;require&nbsp;callback&nbsp;!=&nbsp;nil&nbsp;here&nbsp;because&nbsp;only&nbsp;when&nbsp;callback&nbsp;!=&nbsp;nil</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1947110">//&nbsp;do&nbsp;we&nbsp;know&nbsp;that&nbsp;gentraceback&nbsp;is&nbsp;being&nbsp;called&nbsp;in&nbsp;a&nbsp;&#34;must&nbsp;be&nbsp;correct&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1947182">//&nbsp;context&nbsp;as&nbsp;opposed&nbsp;to&nbsp;a&nbsp;&#34;best&nbsp;effort&#34;&nbsp;context.&nbsp;The&nbsp;tracebacks&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1947253">//&nbsp;callbacks&nbsp;only&nbsp;happen&nbsp;when&nbsp;everything&nbsp;is&nbsp;stopped&nbsp;nicely.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1947314">//&nbsp;At&nbsp;other&nbsp;times,&nbsp;such&nbsp;as&nbsp;when&nbsp;gathering&nbsp;a&nbsp;stack&nbsp;for&nbsp;a&nbsp;profiling&nbsp;signal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1947388">//&nbsp;or&nbsp;when&nbsp;printing&nbsp;a&nbsp;traceback&nbsp;during&nbsp;a&nbsp;crash,&nbsp;everything&nbsp;may&nbsp;not&nbsp;be</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1947459">//&nbsp;stopped&nbsp;nicely,&nbsp;and&nbsp;the&nbsp;stack&nbsp;walk&nbsp;may&nbsp;not&nbsp;be&nbsp;able&nbsp;to&nbsp;complete.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1947527">//&nbsp;It&#39;s&nbsp;okay&nbsp;in&nbsp;those&nbsp;situations&nbsp;not&nbsp;to&nbsp;use&nbsp;up&nbsp;the&nbsp;entire&nbsp;defer&nbsp;stack:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1947599">//&nbsp;incomplete&nbsp;information&nbsp;then&nbsp;is&nbsp;still&nbsp;better&nbsp;than&nbsp;nothing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1947661">if</span>&nbsp;<span class="ident" id="1947664">callback</span>&nbsp;<span class="op" id="1947673">!=</span>&nbsp;<span class="ident" id="1947676">nil</span>&nbsp;<span class="op" id="1947680">&amp;&amp;</span>&nbsp;<span class="ident" id="1947683">n</span>&nbsp;<span class="op" id="1947685">&lt;</span>&nbsp;<span class="ident" id="1947687">max</span>&nbsp;<span class="op" id="1947691">&amp;&amp;</span>&nbsp;<span class="ident" id="1947694">_defer</span>&nbsp;<span class="op" id="1947701">!=</span>&nbsp;<span class="ident" id="1947704">nil</span>&nbsp;<span class="op" id="1947708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1947712">if</span>&nbsp;<span class="ident" id="1947715">_defer</span>&nbsp;<span class="op" id="1947722">!=</span>&nbsp;<span class="ident" id="1947725">nil</span>&nbsp;<span class="op" id="1947729">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1947734">print</span><span class="op" id="1947739">(</span><span class="string" id="1947740">&#34;runtime:&nbsp;g&#34;</span><span class="op" id="1947752">,</span>&nbsp;<span class="ident" id="1947754">gp</span><span class="op" id="1947756">.</span><span class="ident" id="1947757">goid</span><span class="op" id="1947761">,</span>&nbsp;<span class="string" id="1947763">&#34;:&nbsp;leftover&nbsp;defer&nbsp;argp=&#34;</span><span class="op" id="1947787">,</span>&nbsp;<span class="ident" id="1947789">hex</span><span class="op" id="1947792">(</span><span class="ident" id="1947793">_defer</span><span class="op" id="1947799">.</span><span class="ident" id="1947800">argp</span><span class="op" id="1947804">)</span><span class="op" id="1947805">,</span>&nbsp;<span class="string" id="1947807">&#34;&nbsp;pc=&#34;</span><span class="op" id="1947813">,</span>&nbsp;<span class="ident" id="1947815">hex</span><span class="op" id="1947818">(</span><span class="ident" id="1947819">_defer</span><span class="op" id="1947825">.</span><span class="ident" id="1947826">pc</span><span class="op" id="1947828">)</span><span class="op" id="1947829">,</span>&nbsp;<span class="string" id="1947831">&#34;\n&#34;</span><span class="op" id="1947835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1947839">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1947843">for</span>&nbsp;<span class="ident" id="1947847">_defer</span>&nbsp;<span class="op" id="1947854">=</span>&nbsp;<span class="ident" id="1947856">gp</span><span class="op" id="1947858">.</span><span class="ident" id="1947859">_defer</span><span class="op" id="1947865">;</span>&nbsp;<span class="ident" id="1947867">_defer</span>&nbsp;<span class="op" id="1947874">!=</span>&nbsp;<span class="ident" id="1947877">nil</span><span class="op" id="1947880">;</span>&nbsp;<span class="ident" id="1947882">_defer</span>&nbsp;<span class="op" id="1947889">=</span>&nbsp;<span class="ident" id="1947891">_defer</span><span class="op" id="1947897">.</span><span class="ident" id="1947898">link</span>&nbsp;<span class="op" id="1947903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1947908">print</span><span class="op" id="1947913">(</span><span class="string" id="1947914">&#34;\tdefer&nbsp;&#34;</span><span class="op" id="1947924">,</span>&nbsp;<span class="ident" id="1947926">_defer</span><span class="op" id="1947932">,</span>&nbsp;<span class="string" id="1947934">&#34;&nbsp;argp=&#34;</span><span class="op" id="1947942">,</span>&nbsp;<span class="ident" id="1947944">hex</span><span class="op" id="1947947">(</span><span class="ident" id="1947948">_defer</span><span class="op" id="1947954">.</span><span class="ident" id="1947955">argp</span><span class="op" id="1947959">)</span><span class="op" id="1947960">,</span>&nbsp;<span class="string" id="1947962">&#34;&nbsp;pc=&#34;</span><span class="op" id="1947968">,</span>&nbsp;<span class="ident" id="1947970">hex</span><span class="op" id="1947973">(</span><span class="ident" id="1947974">_defer</span><span class="op" id="1947980">.</span><span class="ident" id="1947981">pc</span><span class="op" id="1947983">)</span><span class="op" id="1947984">,</span>&nbsp;<span class="string" id="1947986">&#34;\n&#34;</span><span class="op" id="1947990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1947994">}</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1947998">gothrow</span><span class="op" id="1948005">(</span><span class="string" id="1948006">&#34;traceback&nbsp;has&nbsp;leftover&nbsp;defers&#34;</span><span class="op" id="1948037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1948040">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1948044">return</span>&nbsp;<span class="ident" id="1948051">n</span><br>
<span class="lineno"></span><span class="op" id="1948053">}</span><br>
<span class="lineno">450</span><br>
<span class="lineno"></span><span class="keyword" id="1948056">func</span>&nbsp;<span class="ident" id="1948061">setArgInfo</span><span class="op" id="1948071">(</span><span class="ident" id="1948072">frame</span>&nbsp;<span class="op" id="1948078">*</span><span class="ident" id="1948079">stkframe</span><span class="op" id="1948087">,</span>&nbsp;<span class="ident" id="1948089">f</span>&nbsp;<span class="op" id="1948091">*</span><span class="ident" id="1948092">_func</span><span class="op" id="1948097">,</span>&nbsp;<span class="ident" id="1948099">needArgMap</span>&nbsp;<span class="builtintype" id="1948110">bool</span><span class="op" id="1948114">)</span>&nbsp;<span class="op" id="1948116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1948119">frame</span><span class="op" id="1948124">.</span><span class="ident" id="1948125">arglen</span>&nbsp;<span class="op" id="1948132">=</span>&nbsp;<span class="builtintype" id="1948134">uintptr</span><span class="op" id="1948141">(</span><span class="ident" id="1948142">f</span><span class="op" id="1948143">.</span><span class="ident" id="1948144">args</span><span class="op" id="1948148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1948151">if</span>&nbsp;<span class="ident" id="1948154">needArgMap</span>&nbsp;<span class="op" id="1948165">&amp;&amp;</span>&nbsp;<span class="ident" id="1948168">f</span><span class="op" id="1948169">.</span><span class="ident" id="1948170">args</span>&nbsp;<span class="op" id="1948175">==</span>&nbsp;<span class="ident" id="1948178">_ArgsSizeUnknown</span>&nbsp;<span class="op" id="1948195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1948199">//&nbsp;Extract&nbsp;argument&nbsp;bitmaps&nbsp;for&nbsp;reflect&nbsp;stubs&nbsp;from&nbsp;the&nbsp;calls&nbsp;they&nbsp;made&nbsp;to&nbsp;reflect.</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1948284">switch</span>&nbsp;<span class="ident" id="1948291">gofuncname</span><span class="op" id="1948301">(</span><span class="ident" id="1948302">f</span><span class="op" id="1948303">)</span>&nbsp;<span class="op" id="1948305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1948309">case</span>&nbsp;<span class="string" id="1948314">&#34;reflect.makeFuncStub&#34;</span><span class="op" id="1948336">,</span>&nbsp;<span class="string" id="1948338">&#34;reflect.methodValueCall&#34;</span><span class="op" id="1948363">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1948368">arg0</span>&nbsp;<span class="op" id="1948373">:=</span>&nbsp;<span class="ident" id="1948376">frame</span><span class="op" id="1948381">.</span><span class="ident" id="1948382">sp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1948388">if</span>&nbsp;<span class="ident" id="1948391">usesLR</span>&nbsp;<span class="op" id="1948398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1948404">arg0</span>&nbsp;<span class="op" id="1948409">+=</span>&nbsp;<span class="ident" id="1948412">ptrSize</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1948423">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1948428">fn</span>&nbsp;<span class="op" id="1948431">:=</span>&nbsp;<span class="op" id="1948434">*</span><span class="op" id="1948435">(</span><span class="op" id="1948436">*</span><span class="op" id="1948437">*</span><span class="op" id="1948438">[</span><span class="num" id="1948439">2</span><span class="op" id="1948440">]</span><span class="builtintype" id="1948441">uintptr</span><span class="op" id="1948448">)</span><span class="op" id="1948449">(</span><span class="ident" id="1948450">unsafe</span><span class="op" id="1948456">.</span><span class="ident" id="1948457">Pointer</span><span class="op" id="1948464">(</span><span class="ident" id="1948465">arg0</span><span class="op" id="1948469">)</span><span class="op" id="1948470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1948475">if</span>&nbsp;<span class="ident" id="1948478">fn</span><span class="op" id="1948480">[</span><span class="num" id="1948481">0</span><span class="op" id="1948482">]</span>&nbsp;<span class="op" id="1948484">!=</span>&nbsp;<span class="ident" id="1948487">f</span><span class="op" id="1948488">.</span><span class="ident" id="1948489">entry</span>&nbsp;<span class="op" id="1948495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1948501">print</span><span class="op" id="1948506">(</span><span class="string" id="1948507">&#34;runtime:&nbsp;confused&nbsp;by&nbsp;&#34;</span><span class="op" id="1948530">,</span>&nbsp;<span class="ident" id="1948532">gofuncname</span><span class="op" id="1948542">(</span><span class="ident" id="1948543">f</span><span class="op" id="1948544">)</span><span class="op" id="1948545">,</span>&nbsp;<span class="string" id="1948547">&#34;\n&#34;</span><span class="op" id="1948551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1948557">gothrow</span><span class="op" id="1948564">(</span><span class="string" id="1948565">&#34;reflect&nbsp;mismatch&#34;</span><span class="op" id="1948583">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1948588">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1948593">bv</span>&nbsp;<span class="op" id="1948596">:=</span>&nbsp;<span class="op" id="1948599">(</span><span class="op" id="1948600">*</span><span class="ident" id="1948601">bitvector</span><span class="op" id="1948610">)</span><span class="op" id="1948611">(</span><span class="ident" id="1948612">unsafe</span><span class="op" id="1948618">.</span><span class="ident" id="1948619">Pointer</span><span class="op" id="1948626">(</span><span class="ident" id="1948627">fn</span><span class="op" id="1948629">[</span><span class="num" id="1948630">1</span><span class="op" id="1948631">]</span><span class="op" id="1948632">)</span><span class="op" id="1948633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1948638">frame</span><span class="op" id="1948643">.</span><span class="ident" id="1948644">arglen</span>&nbsp;<span class="op" id="1948651">=</span>&nbsp;<span class="builtintype" id="1948653">uintptr</span><span class="op" id="1948660">(</span><span class="ident" id="1948661">bv</span><span class="op" id="1948663">.</span><span class="ident" id="1948664">n</span>&nbsp;<span class="op" id="1948666">/</span>&nbsp;<span class="num" id="1948668">2</span>&nbsp;<span class="op" id="1948670">*</span>&nbsp;<span class="ident" id="1948672">ptrSize</span><span class="op" id="1948679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1948684">frame</span><span class="op" id="1948689">.</span><span class="ident" id="1948690">argmap</span>&nbsp;<span class="op" id="1948697">=</span>&nbsp;<span class="ident" id="1948699">bv</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1948704">}</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1948707">}</span><br>
<span class="lineno"></span><span class="op" id="1948709">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1948712">func</span>&nbsp;<span class="ident" id="1948717">printcreatedby</span><span class="op" id="1948731">(</span><span class="ident" id="1948732">gp</span>&nbsp;<span class="op" id="1948735">*</span><span class="ident" id="1948736">g</span><span class="op" id="1948737">)</span>&nbsp;<span class="op" id="1948739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1948742">//&nbsp;Show&nbsp;what&nbsp;created&nbsp;goroutine,&nbsp;except&nbsp;main&nbsp;goroutine&nbsp;(goid&nbsp;1).</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1948807">pc</span>&nbsp;<span class="op" id="1948810">:=</span>&nbsp;<span class="ident" id="1948813">gp</span><span class="op" id="1948815">.</span><span class="ident" id="1948816">gopc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1948822">f</span>&nbsp;<span class="op" id="1948824">:=</span>&nbsp;<span class="ident" id="1948827">findfunc</span><span class="op" id="1948835">(</span><span class="ident" id="1948836">pc</span><span class="op" id="1948838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1948841">if</span>&nbsp;<span class="ident" id="1948844">f</span>&nbsp;<span class="op" id="1948846">!=</span>&nbsp;<span class="ident" id="1948849">nil</span>&nbsp;<span class="op" id="1948853">&amp;&amp;</span>&nbsp;<span class="ident" id="1948856">showframe</span><span class="op" id="1948865">(</span><span class="ident" id="1948866">f</span><span class="op" id="1948867">,</span>&nbsp;<span class="ident" id="1948869">gp</span><span class="op" id="1948871">)</span>&nbsp;<span class="op" id="1948873">&amp;&amp;</span>&nbsp;<span class="ident" id="1948876">gp</span><span class="op" id="1948878">.</span><span class="ident" id="1948879">goid</span>&nbsp;<span class="op" id="1948884">!=</span>&nbsp;<span class="num" id="1948887">1</span>&nbsp;<span class="op" id="1948889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1948893">print</span><span class="op" id="1948898">(</span><span class="string" id="1948899">&#34;created&nbsp;by&nbsp;&#34;</span><span class="op" id="1948912">,</span>&nbsp;<span class="ident" id="1948914">gofuncname</span><span class="op" id="1948924">(</span><span class="ident" id="1948925">f</span><span class="op" id="1948926">)</span><span class="op" id="1948927">,</span>&nbsp;<span class="string" id="1948929">&#34;\n&#34;</span><span class="op" id="1948933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1948937">tracepc</span>&nbsp;<span class="op" id="1948945">:=</span>&nbsp;<span class="ident" id="1948948">pc</span>&nbsp;<span class="comment" id="1948951">//&nbsp;back&nbsp;up&nbsp;to&nbsp;CALL&nbsp;instruction&nbsp;for&nbsp;funcline.</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1948998">if</span>&nbsp;<span class="ident" id="1949001">pc</span>&nbsp;<span class="op" id="1949004">&gt;</span>&nbsp;<span class="ident" id="1949006">f</span><span class="op" id="1949007">.</span><span class="ident" id="1949008">entry</span>&nbsp;<span class="op" id="1949014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1949019">tracepc</span>&nbsp;<span class="op" id="1949027">-=</span>&nbsp;<span class="ident" id="1949030">_PCQuantum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1949043">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1949047">var</span>&nbsp;<span class="ident" id="1949051">file</span>&nbsp;<span class="builtintype" id="1949056">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1949065">line</span>&nbsp;<span class="op" id="1949070">:=</span>&nbsp;<span class="ident" id="1949073">funcline</span><span class="op" id="1949081">(</span><span class="ident" id="1949082">f</span><span class="op" id="1949083">,</span>&nbsp;<span class="ident" id="1949085">tracepc</span><span class="op" id="1949092">,</span>&nbsp;<span class="op" id="1949094">&amp;</span><span class="ident" id="1949095">file</span><span class="op" id="1949099">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1949103">print</span><span class="op" id="1949108">(</span><span class="string" id="1949109">&#34;\t&#34;</span><span class="op" id="1949113">,</span>&nbsp;<span class="ident" id="1949115">file</span><span class="op" id="1949119">,</span>&nbsp;<span class="string" id="1949121">&#34;:&#34;</span><span class="op" id="1949124">,</span>&nbsp;<span class="ident" id="1949126">line</span><span class="op" id="1949130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1949134">if</span>&nbsp;<span class="ident" id="1949137">pc</span>&nbsp;<span class="op" id="1949140">&gt;</span>&nbsp;<span class="ident" id="1949142">f</span><span class="op" id="1949143">.</span><span class="ident" id="1949144">entry</span>&nbsp;<span class="op" id="1949150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1949155">print</span><span class="op" id="1949160">(</span><span class="string" id="1949161">&#34;&nbsp;+&#34;</span><span class="op" id="1949165">,</span>&nbsp;<span class="ident" id="1949167">hex</span><span class="op" id="1949170">(</span><span class="ident" id="1949171">pc</span><span class="op" id="1949173">-</span><span class="ident" id="1949174">f</span><span class="op" id="1949175">.</span><span class="ident" id="1949176">entry</span><span class="op" id="1949181">)</span><span class="op" id="1949182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1949186">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1949190">print</span><span class="op" id="1949195">(</span><span class="string" id="1949196">&#34;\n&#34;</span><span class="op" id="1949200">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1949203">}</span><br>
<span class="lineno"></span><span class="op" id="1949205">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1949208">func</span>&nbsp;<span class="ident" id="1949213">traceback</span><span class="op" id="1949222">(</span><span class="ident" id="1949223">pc</span>&nbsp;<span class="builtintype" id="1949226">uintptr</span><span class="op" id="1949233">,</span>&nbsp;<span class="ident" id="1949235">sp</span>&nbsp;<span class="builtintype" id="1949238">uintptr</span><span class="op" id="1949245">,</span>&nbsp;<span class="ident" id="1949247">lr</span>&nbsp;<span class="builtintype" id="1949250">uintptr</span><span class="op" id="1949257">,</span>&nbsp;<span class="ident" id="1949259">gp</span>&nbsp;<span class="op" id="1949262">*</span><span class="ident" id="1949263">g</span><span class="op" id="1949264">)</span>&nbsp;<span class="op" id="1949266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1949269">traceback1</span><span class="op" id="1949279">(</span><span class="ident" id="1949280">pc</span><span class="op" id="1949282">,</span>&nbsp;<span class="ident" id="1949284">sp</span><span class="op" id="1949286">,</span>&nbsp;<span class="ident" id="1949288">lr</span><span class="op" id="1949290">,</span>&nbsp;<span class="ident" id="1949292">gp</span><span class="op" id="1949294">,</span>&nbsp;<span class="num" id="1949296">0</span><span class="op" id="1949297">)</span><br>
<span class="lineno">495</span><span class="op" id="1949299">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1949302">//&nbsp;tracebacktrap&nbsp;is&nbsp;like&nbsp;traceback&nbsp;but&nbsp;expects&nbsp;that&nbsp;the&nbsp;PC&nbsp;and&nbsp;SP&nbsp;were&nbsp;obtained</span><br>
<span class="lineno"></span><span class="comment" id="1949382">//&nbsp;from&nbsp;a&nbsp;trap,&nbsp;not&nbsp;from&nbsp;gp-&gt;sched&nbsp;or&nbsp;gp-&gt;syscallpc/gp-&gt;syscallsp&nbsp;or&nbsp;getcallerpc/getcallersp.</span><br>
<span class="lineno"></span><span class="comment" id="1949476">//&nbsp;Because&nbsp;they&nbsp;are&nbsp;from&nbsp;a&nbsp;trap&nbsp;instead&nbsp;of&nbsp;from&nbsp;a&nbsp;saved&nbsp;pair,</span><br>
<span class="lineno">500</span><span class="comment" id="1949538">//&nbsp;the&nbsp;initial&nbsp;PC&nbsp;must&nbsp;not&nbsp;be&nbsp;rewound&nbsp;to&nbsp;the&nbsp;previous&nbsp;instruction.</span><br>
<span class="lineno"></span><span class="comment" id="1949605">//&nbsp;(All&nbsp;the&nbsp;saved&nbsp;pairs&nbsp;record&nbsp;a&nbsp;PC&nbsp;that&nbsp;is&nbsp;a&nbsp;return&nbsp;address,&nbsp;so&nbsp;we</span><br>
<span class="lineno"></span><span class="comment" id="1949673">//&nbsp;rewind&nbsp;it&nbsp;into&nbsp;the&nbsp;CALL&nbsp;instruction.)</span><br>
<span class="lineno"></span><span class="keyword" id="1949714">func</span>&nbsp;<span class="ident" id="1949719">tracebacktrap</span><span class="op" id="1949732">(</span><span class="ident" id="1949733">pc</span>&nbsp;<span class="builtintype" id="1949736">uintptr</span><span class="op" id="1949743">,</span>&nbsp;<span class="ident" id="1949745">sp</span>&nbsp;<span class="builtintype" id="1949748">uintptr</span><span class="op" id="1949755">,</span>&nbsp;<span class="ident" id="1949757">lr</span>&nbsp;<span class="builtintype" id="1949760">uintptr</span><span class="op" id="1949767">,</span>&nbsp;<span class="ident" id="1949769">gp</span>&nbsp;<span class="op" id="1949772">*</span><span class="ident" id="1949773">g</span><span class="op" id="1949774">)</span>&nbsp;<span class="op" id="1949776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1949779">traceback1</span><span class="op" id="1949789">(</span><span class="ident" id="1949790">pc</span><span class="op" id="1949792">,</span>&nbsp;<span class="ident" id="1949794">sp</span><span class="op" id="1949796">,</span>&nbsp;<span class="ident" id="1949798">lr</span><span class="op" id="1949800">,</span>&nbsp;<span class="ident" id="1949802">gp</span><span class="op" id="1949804">,</span>&nbsp;<span class="ident" id="1949806">_TraceTrap</span><span class="op" id="1949816">)</span><br>
<span class="lineno">505</span><span class="op" id="1949818">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1949821">func</span>&nbsp;<span class="ident" id="1949826">traceback1</span><span class="op" id="1949836">(</span><span class="ident" id="1949837">pc</span>&nbsp;<span class="builtintype" id="1949840">uintptr</span><span class="op" id="1949847">,</span>&nbsp;<span class="ident" id="1949849">sp</span>&nbsp;<span class="builtintype" id="1949852">uintptr</span><span class="op" id="1949859">,</span>&nbsp;<span class="ident" id="1949861">lr</span>&nbsp;<span class="builtintype" id="1949864">uintptr</span><span class="op" id="1949871">,</span>&nbsp;<span class="ident" id="1949873">gp</span>&nbsp;<span class="op" id="1949876">*</span><span class="ident" id="1949877">g</span><span class="op" id="1949878">,</span>&nbsp;<span class="ident" id="1949880">flags</span>&nbsp;<span class="builtintype" id="1949886">uint</span><span class="op" id="1949890">)</span>&nbsp;<span class="op" id="1949892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1949895">var</span>&nbsp;<span class="ident" id="1949899">n</span>&nbsp;<span class="builtintype" id="1949901">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1949906">if</span>&nbsp;<span class="ident" id="1949909">readgstatus</span><span class="op" id="1949920">(</span><span class="ident" id="1949921">gp</span><span class="op" id="1949923">)</span><span class="op" id="1949924">&amp;^</span><span class="ident" id="1949926">_Gscan</span>&nbsp;<span class="op" id="1949933">==</span>&nbsp;<span class="ident" id="1949936">_Gsyscall</span>&nbsp;<span class="op" id="1949946">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1949950">//&nbsp;Override&nbsp;registers&nbsp;if&nbsp;blocked&nbsp;in&nbsp;system&nbsp;call.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1950001">pc</span>&nbsp;<span class="op" id="1950004">=</span>&nbsp;<span class="ident" id="1950006">gp</span><span class="op" id="1950008">.</span><span class="ident" id="1950009">syscallpc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1950021">sp</span>&nbsp;<span class="op" id="1950024">=</span>&nbsp;<span class="ident" id="1950026">gp</span><span class="op" id="1950028">.</span><span class="ident" id="1950029">syscallsp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1950041">flags</span>&nbsp;<span class="op" id="1950047">&amp;^=</span>&nbsp;<span class="ident" id="1950051">_TraceTrap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1950063">}</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1950066">//&nbsp;Print&nbsp;traceback.&nbsp;By&nbsp;default,&nbsp;omits&nbsp;runtime&nbsp;frames.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1950121">//&nbsp;If&nbsp;that&nbsp;means&nbsp;we&nbsp;print&nbsp;nothing&nbsp;at&nbsp;all,&nbsp;repeat&nbsp;forcing&nbsp;all&nbsp;frames&nbsp;printed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1950199">n</span>&nbsp;<span class="op" id="1950201">=</span>&nbsp;<span class="ident" id="1950203">gentraceback</span><span class="op" id="1950215">(</span><span class="ident" id="1950216">pc</span><span class="op" id="1950218">,</span>&nbsp;<span class="ident" id="1950220">sp</span><span class="op" id="1950222">,</span>&nbsp;<span class="ident" id="1950224">lr</span><span class="op" id="1950226">,</span>&nbsp;<span class="ident" id="1950228">gp</span><span class="op" id="1950230">,</span>&nbsp;<span class="num" id="1950232">0</span><span class="op" id="1950233">,</span>&nbsp;<span class="ident" id="1950235">nil</span><span class="op" id="1950238">,</span>&nbsp;<span class="ident" id="1950240">_TracebackMaxFrames</span><span class="op" id="1950259">,</span>&nbsp;<span class="ident" id="1950261">nil</span><span class="op" id="1950264">,</span>&nbsp;<span class="ident" id="1950266">nil</span><span class="op" id="1950269">,</span>&nbsp;<span class="ident" id="1950271">flags</span><span class="op" id="1950276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1950279">if</span>&nbsp;<span class="ident" id="1950282">n</span>&nbsp;<span class="op" id="1950284">==</span>&nbsp;<span class="num" id="1950287">0</span>&nbsp;<span class="op" id="1950289">&amp;&amp;</span>&nbsp;<span class="op" id="1950292">(</span><span class="ident" id="1950293">flags</span><span class="op" id="1950298">&amp;</span><span class="ident" id="1950299">_TraceRuntimeFrames</span><span class="op" id="1950318">)</span>&nbsp;<span class="op" id="1950320">==</span>&nbsp;<span class="num" id="1950323">0</span>&nbsp;<span class="op" id="1950325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1950329">n</span>&nbsp;<span class="op" id="1950331">=</span>&nbsp;<span class="ident" id="1950333">gentraceback</span><span class="op" id="1950345">(</span><span class="ident" id="1950346">pc</span><span class="op" id="1950348">,</span>&nbsp;<span class="ident" id="1950350">sp</span><span class="op" id="1950352">,</span>&nbsp;<span class="ident" id="1950354">lr</span><span class="op" id="1950356">,</span>&nbsp;<span class="ident" id="1950358">gp</span><span class="op" id="1950360">,</span>&nbsp;<span class="num" id="1950362">0</span><span class="op" id="1950363">,</span>&nbsp;<span class="ident" id="1950365">nil</span><span class="op" id="1950368">,</span>&nbsp;<span class="ident" id="1950370">_TracebackMaxFrames</span><span class="op" id="1950389">,</span>&nbsp;<span class="ident" id="1950391">nil</span><span class="op" id="1950394">,</span>&nbsp;<span class="ident" id="1950396">nil</span><span class="op" id="1950399">,</span>&nbsp;<span class="ident" id="1950401">flags</span><span class="op" id="1950406">|</span><span class="ident" id="1950407">_TraceRuntimeFrames</span><span class="op" id="1950426">)</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1950429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1950432">if</span>&nbsp;<span class="ident" id="1950435">n</span>&nbsp;<span class="op" id="1950437">==</span>&nbsp;<span class="ident" id="1950440">_TracebackMaxFrames</span>&nbsp;<span class="op" id="1950460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1950464">print</span><span class="op" id="1950469">(</span><span class="string" id="1950470">&#34;...additional&nbsp;frames&nbsp;elided...\n&#34;</span><span class="op" id="1950504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1950507">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1950510">printcreatedby</span><span class="op" id="1950524">(</span><span class="ident" id="1950525">gp</span><span class="op" id="1950527">)</span><br>
<span class="lineno">525</span><span class="op" id="1950529">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1950532">func</span>&nbsp;<span class="ident" id="1950537">callers</span><span class="op" id="1950544">(</span><span class="ident" id="1950545">skip</span>&nbsp;<span class="builtintype" id="1950550">int</span><span class="op" id="1950553">,</span>&nbsp;<span class="ident" id="1950555">pcbuf</span>&nbsp;<span class="op" id="1950561">*</span><span class="builtintype" id="1950562">uintptr</span><span class="op" id="1950569">,</span>&nbsp;<span class="ident" id="1950571">m</span>&nbsp;<span class="builtintype" id="1950573">int</span><span class="op" id="1950576">)</span>&nbsp;<span class="builtintype" id="1950578">int</span>&nbsp;<span class="op" id="1950582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1950585">sp</span>&nbsp;<span class="op" id="1950588">:=</span>&nbsp;<span class="ident" id="1950591">getcallersp</span><span class="op" id="1950602">(</span><span class="ident" id="1950603">unsafe</span><span class="op" id="1950609">.</span><span class="ident" id="1950610">Pointer</span><span class="op" id="1950617">(</span><span class="op" id="1950618">&amp;</span><span class="ident" id="1950619">skip</span><span class="op" id="1950623">)</span><span class="op" id="1950624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1950627">pc</span>&nbsp;<span class="op" id="1950630">:=</span>&nbsp;<span class="builtintype" id="1950633">uintptr</span><span class="op" id="1950640">(</span><span class="ident" id="1950641">getcallerpc</span><span class="op" id="1950652">(</span><span class="ident" id="1950653">unsafe</span><span class="op" id="1950659">.</span><span class="ident" id="1950660">Pointer</span><span class="op" id="1950667">(</span><span class="op" id="1950668">&amp;</span><span class="ident" id="1950669">skip</span><span class="op" id="1950673">)</span><span class="op" id="1950674">)</span><span class="op" id="1950675">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1950678">var</span>&nbsp;<span class="ident" id="1950682">n</span>&nbsp;<span class="builtintype" id="1950684">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1950689">onM</span><span class="op" id="1950692">(</span><span class="keyword" id="1950693">func</span><span class="op" id="1950697">(</span><span class="op" id="1950698">)</span>&nbsp;<span class="op" id="1950700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1950704">n</span>&nbsp;<span class="op" id="1950706">=</span>&nbsp;<span class="ident" id="1950708">gentraceback</span><span class="op" id="1950720">(</span><span class="ident" id="1950721">pc</span><span class="op" id="1950723">,</span>&nbsp;<span class="ident" id="1950725">sp</span><span class="op" id="1950727">,</span>&nbsp;<span class="num" id="1950729">0</span><span class="op" id="1950730">,</span>&nbsp;<span class="ident" id="1950732">getg</span><span class="op" id="1950736">(</span><span class="op" id="1950737">)</span><span class="op" id="1950738">,</span>&nbsp;<span class="ident" id="1950740">skip</span><span class="op" id="1950744">,</span>&nbsp;<span class="ident" id="1950746">pcbuf</span><span class="op" id="1950751">,</span>&nbsp;<span class="ident" id="1950753">m</span><span class="op" id="1950754">,</span>&nbsp;<span class="ident" id="1950756">nil</span><span class="op" id="1950759">,</span>&nbsp;<span class="ident" id="1950761">nil</span><span class="op" id="1950764">,</span>&nbsp;<span class="num" id="1950766">0</span><span class="op" id="1950767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1950770">}</span><span class="op" id="1950771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1950774">return</span>&nbsp;<span class="ident" id="1950781">n</span><br>
<span class="lineno">535</span><span class="op" id="1950783">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1950786">func</span>&nbsp;<span class="ident" id="1950791">gcallers</span><span class="op" id="1950799">(</span><span class="ident" id="1950800">gp</span>&nbsp;<span class="op" id="1950803">*</span><span class="ident" id="1950804">g</span><span class="op" id="1950805">,</span>&nbsp;<span class="ident" id="1950807">skip</span>&nbsp;<span class="builtintype" id="1950812">int</span><span class="op" id="1950815">,</span>&nbsp;<span class="ident" id="1950817">pcbuf</span>&nbsp;<span class="op" id="1950823">*</span><span class="builtintype" id="1950824">uintptr</span><span class="op" id="1950831">,</span>&nbsp;<span class="ident" id="1950833">m</span>&nbsp;<span class="builtintype" id="1950835">int</span><span class="op" id="1950838">)</span>&nbsp;<span class="builtintype" id="1950840">int</span>&nbsp;<span class="op" id="1950844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1950847">return</span>&nbsp;<span class="ident" id="1950854">gentraceback</span><span class="op" id="1950866">(</span><span class="op" id="1950867">^</span><span class="builtintype" id="1950868">uintptr</span><span class="op" id="1950875">(</span><span class="num" id="1950876">0</span><span class="op" id="1950877">)</span><span class="op" id="1950878">,</span>&nbsp;<span class="op" id="1950880">^</span><span class="builtintype" id="1950881">uintptr</span><span class="op" id="1950888">(</span><span class="num" id="1950889">0</span><span class="op" id="1950890">)</span><span class="op" id="1950891">,</span>&nbsp;<span class="num" id="1950893">0</span><span class="op" id="1950894">,</span>&nbsp;<span class="ident" id="1950896">gp</span><span class="op" id="1950898">,</span>&nbsp;<span class="ident" id="1950900">skip</span><span class="op" id="1950904">,</span>&nbsp;<span class="ident" id="1950906">pcbuf</span><span class="op" id="1950911">,</span>&nbsp;<span class="ident" id="1950913">m</span><span class="op" id="1950914">,</span>&nbsp;<span class="ident" id="1950916">nil</span><span class="op" id="1950919">,</span>&nbsp;<span class="ident" id="1950921">nil</span><span class="op" id="1950924">,</span>&nbsp;<span class="num" id="1950926">0</span><span class="op" id="1950927">)</span><br>
<span class="lineno"></span><span class="op" id="1950929">}</span><br>
<span class="lineno">540</span><br>
<span class="lineno"></span><span class="keyword" id="1950932">func</span>&nbsp;<span class="ident" id="1950937">showframe</span><span class="op" id="1950946">(</span><span class="ident" id="1950947">f</span>&nbsp;<span class="op" id="1950949">*</span><span class="ident" id="1950950">_func</span><span class="op" id="1950955">,</span>&nbsp;<span class="ident" id="1950957">gp</span>&nbsp;<span class="op" id="1950960">*</span><span class="ident" id="1950961">g</span><span class="op" id="1950962">)</span>&nbsp;<span class="builtintype" id="1950964">bool</span>&nbsp;<span class="op" id="1950969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1950972">g</span>&nbsp;<span class="op" id="1950974">:=</span>&nbsp;<span class="ident" id="1950977">getg</span><span class="op" id="1950981">(</span><span class="op" id="1950982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1950985">if</span>&nbsp;<span class="ident" id="1950988">g</span><span class="op" id="1950989">.</span><span class="ident" id="1950990">m</span><span class="op" id="1950991">.</span><span class="ident" id="1950992">throwing</span>&nbsp;<span class="op" id="1951001">&gt;</span>&nbsp;<span class="num" id="1951003">0</span>&nbsp;<span class="op" id="1951005">&amp;&amp;</span>&nbsp;<span class="ident" id="1951008">gp</span>&nbsp;<span class="op" id="1951011">!=</span>&nbsp;<span class="ident" id="1951014">nil</span>&nbsp;<span class="op" id="1951018">&amp;&amp;</span>&nbsp;<span class="op" id="1951021">(</span><span class="ident" id="1951022">gp</span>&nbsp;<span class="op" id="1951025">==</span>&nbsp;<span class="ident" id="1951028">g</span><span class="op" id="1951029">.</span><span class="ident" id="1951030">m</span><span class="op" id="1951031">.</span><span class="ident" id="1951032">curg</span>&nbsp;<span class="op" id="1951037">||</span>&nbsp;<span class="ident" id="1951040">gp</span>&nbsp;<span class="op" id="1951043">==</span>&nbsp;<span class="ident" id="1951046">g</span><span class="op" id="1951047">.</span><span class="ident" id="1951048">m</span><span class="op" id="1951049">.</span><span class="ident" id="1951050">caughtsig</span><span class="op" id="1951059">)</span>&nbsp;<span class="op" id="1951061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1951065">return</span>&nbsp;<span class="builtintype" id="1951072">true</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1951078">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1951081">traceback</span>&nbsp;<span class="op" id="1951091">:=</span>&nbsp;<span class="ident" id="1951094">gotraceback</span><span class="op" id="1951105">(</span><span class="ident" id="1951106">nil</span><span class="op" id="1951109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1951112">name</span>&nbsp;<span class="op" id="1951117">:=</span>&nbsp;<span class="ident" id="1951120">gostringnocopy</span><span class="op" id="1951134">(</span><span class="ident" id="1951135">funcname</span><span class="op" id="1951143">(</span><span class="ident" id="1951144">f</span><span class="op" id="1951145">)</span><span class="op" id="1951146">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1951150">//&nbsp;Special&nbsp;case:&nbsp;always&nbsp;show&nbsp;runtime.panic&nbsp;frame,&nbsp;so&nbsp;that&nbsp;we&nbsp;can</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1951216">//&nbsp;see&nbsp;where&nbsp;a&nbsp;panic&nbsp;started&nbsp;in&nbsp;the&nbsp;middle&nbsp;of&nbsp;a&nbsp;stack&nbsp;trace.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1951278">//&nbsp;See&nbsp;golang.org/issue/5832.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1951309">if</span>&nbsp;<span class="ident" id="1951312">name</span>&nbsp;<span class="op" id="1951317">==</span>&nbsp;<span class="string" id="1951320">&#34;runtime.panic&#34;</span>&nbsp;<span class="op" id="1951336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1951340">return</span>&nbsp;<span class="builtintype" id="1951347">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1951353">}</span><br>
<span class="lineno">555</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1951357">return</span>&nbsp;<span class="ident" id="1951364">traceback</span>&nbsp;<span class="op" id="1951374">&gt;</span>&nbsp;<span class="num" id="1951376">1</span>&nbsp;<span class="op" id="1951378">||</span>&nbsp;<span class="ident" id="1951381">f</span>&nbsp;<span class="op" id="1951383">!=</span>&nbsp;<span class="ident" id="1951386">nil</span>&nbsp;<span class="op" id="1951390">&amp;&amp;</span>&nbsp;<span class="ident" id="1951393">contains</span><span class="op" id="1951401">(</span><span class="ident" id="1951402">name</span><span class="op" id="1951406">,</span>&nbsp;<span class="string" id="1951408">&#34;.&#34;</span><span class="op" id="1951411">)</span>&nbsp;<span class="op" id="1951413">&amp;&amp;</span>&nbsp;<span class="op" id="1951416">(</span><span class="op" id="1951417">!</span><span class="ident" id="1951418">hasprefix</span><span class="op" id="1951427">(</span><span class="ident" id="1951428">name</span><span class="op" id="1951432">,</span>&nbsp;<span class="string" id="1951434">&#34;runtime.&#34;</span><span class="op" id="1951444">)</span>&nbsp;<span class="op" id="1951446">||</span>&nbsp;<span class="ident" id="1951449">isExportedRuntime</span><span class="op" id="1951466">(</span><span class="ident" id="1951467">name</span><span class="op" id="1951471">)</span><span class="op" id="1951472">)</span><br>
<span class="lineno"></span><span class="op" id="1951474">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1951477">//&nbsp;isExportedRuntime&nbsp;reports&nbsp;whether&nbsp;name&nbsp;is&nbsp;an&nbsp;exported&nbsp;runtime&nbsp;function.</span><br>
<span class="lineno">560</span><span class="comment" id="1951552">//&nbsp;It&nbsp;is&nbsp;only&nbsp;for&nbsp;runtime&nbsp;functions,&nbsp;so&nbsp;ASCII&nbsp;A-Z&nbsp;is&nbsp;fine.</span><br>
<span class="lineno"></span><span class="keyword" id="1951611">func</span>&nbsp;<span class="ident" id="1951616">isExportedRuntime</span><span class="op" id="1951633">(</span><span class="ident" id="1951634">name</span>&nbsp;<span class="builtintype" id="1951639">string</span><span class="op" id="1951645">)</span>&nbsp;<span class="builtintype" id="1951647">bool</span>&nbsp;<span class="op" id="1951652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1951655">const</span>&nbsp;<span class="ident" id="1951661">n</span>&nbsp;<span class="op" id="1951663">=</span>&nbsp;<span class="builtinfunc" id="1951665">len</span><span class="op" id="1951668">(</span><span class="string" id="1951669">&#34;runtime.&#34;</span><span class="op" id="1951679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1951682">return</span>&nbsp;<span class="builtinfunc" id="1951689">len</span><span class="op" id="1951692">(</span><span class="ident" id="1951693">name</span><span class="op" id="1951697">)</span>&nbsp;<span class="op" id="1951699">&gt;</span>&nbsp;<span class="ident" id="1951701">n</span>&nbsp;<span class="op" id="1951703">&amp;&amp;</span>&nbsp;<span class="ident" id="1951706">name</span><span class="op" id="1951710">[</span><span class="op" id="1951711">:</span><span class="ident" id="1951712">n</span><span class="op" id="1951713">]</span>&nbsp;<span class="op" id="1951715">==</span>&nbsp;<span class="string" id="1951718">&#34;runtime.&#34;</span>&nbsp;<span class="op" id="1951729">&amp;&amp;</span>&nbsp;<span class="string" id="1951732">&#39;A&#39;</span>&nbsp;<span class="op" id="1951736">&lt;=</span>&nbsp;<span class="ident" id="1951739">name</span><span class="op" id="1951743">[</span><span class="ident" id="1951744">n</span><span class="op" id="1951745">]</span>&nbsp;<span class="op" id="1951747">&amp;&amp;</span>&nbsp;<span class="ident" id="1951750">name</span><span class="op" id="1951754">[</span><span class="ident" id="1951755">n</span><span class="op" id="1951756">]</span>&nbsp;<span class="op" id="1951758">&lt;=</span>&nbsp;<span class="string" id="1951761">&#39;Z&#39;</span><br>
<span class="lineno"></span><span class="op" id="1951765">}</span><br>
<span class="lineno">565</span><br>
<span class="lineno"></span><span class="keyword" id="1951768">var</span>&nbsp;<span class="ident" id="1951772">gStatusStrings</span>&nbsp;<span class="op" id="1951787">=</span>&nbsp;<span class="op" id="1951789">[</span><span class="op" id="1951790">...</span><span class="op" id="1951793">]</span><span class="builtintype" id="1951794">string</span><span class="op" id="1951800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1951803">_Gidle</span><span class="op" id="1951809">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1951816">&#34;idle&#34;</span><span class="op" id="1951822">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1951825">_Grunnable</span><span class="op" id="1951835">:</span>&nbsp;&nbsp;<span class="string" id="1951838">&#34;runnable&#34;</span><span class="op" id="1951848">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1951851">_Grunning</span><span class="op" id="1951860">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="1951864">&#34;running&#34;</span><span class="op" id="1951873">,</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1951876">_Gsyscall</span><span class="op" id="1951885">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="1951889">&#34;syscall&#34;</span><span class="op" id="1951898">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1951901">_Gwaiting</span><span class="op" id="1951910">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="1951914">&#34;waiting&#34;</span><span class="op" id="1951923">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1951926">_Gdead</span><span class="op" id="1951932">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1951939">&#34;dead&#34;</span><span class="op" id="1951945">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1951948">_Genqueue</span><span class="op" id="1951957">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="1951961">&#34;enqueue&#34;</span><span class="op" id="1951970">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1951973">_Gcopystack</span><span class="op" id="1951984">:</span>&nbsp;<span class="string" id="1951986">&#34;copystack&#34;</span><span class="op" id="1951997">,</span><br>
<span class="lineno">575</span><span class="op" id="1951999">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1952002">var</span>&nbsp;<span class="ident" id="1952006">gScanStatusStrings</span>&nbsp;<span class="op" id="1952025">=</span>&nbsp;<span class="op" id="1952027">[</span><span class="op" id="1952028">...</span><span class="op" id="1952031">]</span><span class="builtintype" id="1952032">string</span><span class="op" id="1952038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="1952041">0</span><span class="op" id="1952042">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1952053">&#34;scan&#34;</span><span class="op" id="1952059">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1952062">_Grunnable</span><span class="op" id="1952072">:</span>&nbsp;<span class="string" id="1952074">&#34;scanrunnable&#34;</span><span class="op" id="1952088">,</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1952091">_Grunning</span><span class="op" id="1952100">:</span>&nbsp;&nbsp;<span class="string" id="1952103">&#34;scanrunning&#34;</span><span class="op" id="1952116">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1952119">_Gsyscall</span><span class="op" id="1952128">:</span>&nbsp;&nbsp;<span class="string" id="1952131">&#34;scansyscall&#34;</span><span class="op" id="1952144">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1952147">_Gwaiting</span><span class="op" id="1952156">:</span>&nbsp;&nbsp;<span class="string" id="1952159">&#34;scanwaiting&#34;</span><span class="op" id="1952172">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1952175">_Gdead</span><span class="op" id="1952181">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1952187">&#34;scandead&#34;</span><span class="op" id="1952197">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1952200">_Genqueue</span><span class="op" id="1952209">:</span>&nbsp;&nbsp;<span class="string" id="1952212">&#34;scanenqueue&#34;</span><span class="op" id="1952225">,</span><br>
<span class="lineno">585</span><span class="op" id="1952227">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1952230">func</span>&nbsp;<span class="ident" id="1952235">goroutineheader</span><span class="op" id="1952250">(</span><span class="ident" id="1952251">gp</span>&nbsp;<span class="op" id="1952254">*</span><span class="ident" id="1952255">g</span><span class="op" id="1952256">)</span>&nbsp;<span class="op" id="1952258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1952261">gpstatus</span>&nbsp;<span class="op" id="1952270">:=</span>&nbsp;<span class="ident" id="1952273">readgstatus</span><span class="op" id="1952284">(</span><span class="ident" id="1952285">gp</span><span class="op" id="1952287">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1952291">//&nbsp;Basic&nbsp;string&nbsp;status</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1952315">var</span>&nbsp;<span class="ident" id="1952319">status</span>&nbsp;<span class="builtintype" id="1952326">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1952334">if</span>&nbsp;<span class="num" id="1952337">0</span>&nbsp;<span class="op" id="1952339">&lt;=</span>&nbsp;<span class="ident" id="1952342">gpstatus</span>&nbsp;<span class="op" id="1952351">&amp;&amp;</span>&nbsp;<span class="ident" id="1952354">gpstatus</span>&nbsp;<span class="op" id="1952363">&lt;</span>&nbsp;<span class="builtintype" id="1952365">uint32</span><span class="op" id="1952371">(</span><span class="builtinfunc" id="1952372">len</span><span class="op" id="1952375">(</span><span class="ident" id="1952376">gStatusStrings</span><span class="op" id="1952390">)</span><span class="op" id="1952391">)</span>&nbsp;<span class="op" id="1952393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1952397">status</span>&nbsp;<span class="op" id="1952404">=</span>&nbsp;<span class="ident" id="1952406">gStatusStrings</span><span class="op" id="1952420">[</span><span class="ident" id="1952421">gpstatus</span><span class="op" id="1952429">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1952432">}</span>&nbsp;<span class="keyword" id="1952434">else</span>&nbsp;<span class="keyword" id="1952439">if</span>&nbsp;<span class="ident" id="1952442">gpstatus</span><span class="op" id="1952450">&amp;</span><span class="ident" id="1952451">_Gscan</span>&nbsp;<span class="op" id="1952458">!=</span>&nbsp;<span class="num" id="1952461">0</span>&nbsp;<span class="op" id="1952463">&amp;&amp;</span>&nbsp;<span class="num" id="1952466">0</span>&nbsp;<span class="op" id="1952468">&lt;=</span>&nbsp;<span class="ident" id="1952471">gpstatus</span><span class="op" id="1952479">&amp;^</span><span class="ident" id="1952481">_Gscan</span>&nbsp;<span class="op" id="1952488">&amp;&amp;</span>&nbsp;<span class="ident" id="1952491">gpstatus</span><span class="op" id="1952499">&amp;^</span><span class="ident" id="1952501">_Gscan</span>&nbsp;<span class="op" id="1952508">&lt;</span>&nbsp;<span class="builtintype" id="1952510">uint32</span><span class="op" id="1952516">(</span><span class="builtinfunc" id="1952517">len</span><span class="op" id="1952520">(</span><span class="ident" id="1952521">gStatusStrings</span><span class="op" id="1952535">)</span><span class="op" id="1952536">)</span>&nbsp;<span class="op" id="1952538">{</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1952542">status</span>&nbsp;<span class="op" id="1952549">=</span>&nbsp;<span class="ident" id="1952551">gStatusStrings</span><span class="op" id="1952565">[</span><span class="ident" id="1952566">gpstatus</span><span class="op" id="1952574">&amp;^</span><span class="ident" id="1952576">_Gscan</span><span class="op" id="1952582">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1952585">}</span>&nbsp;<span class="keyword" id="1952587">else</span>&nbsp;<span class="op" id="1952592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1952596">status</span>&nbsp;<span class="op" id="1952603">=</span>&nbsp;<span class="string" id="1952605">&#34;???&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1952612">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1952616">//&nbsp;Override.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1952630">if</span>&nbsp;<span class="op" id="1952633">(</span><span class="ident" id="1952634">gpstatus</span>&nbsp;<span class="op" id="1952643">==</span>&nbsp;<span class="ident" id="1952646">_Gwaiting</span>&nbsp;<span class="op" id="1952656">||</span>&nbsp;<span class="ident" id="1952659">gpstatus</span>&nbsp;<span class="op" id="1952668">==</span>&nbsp;<span class="ident" id="1952671">_Gscanwaiting</span><span class="op" id="1952684">)</span>&nbsp;<span class="op" id="1952686">&amp;&amp;</span>&nbsp;<span class="ident" id="1952689">gp</span><span class="op" id="1952691">.</span><span class="ident" id="1952692">waitreason</span>&nbsp;<span class="op" id="1952703">!=</span>&nbsp;<span class="string" id="1952706">&#34;&#34;</span>&nbsp;<span class="op" id="1952709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1952713">status</span>&nbsp;<span class="op" id="1952720">=</span>&nbsp;<span class="ident" id="1952722">gp</span><span class="op" id="1952724">.</span><span class="ident" id="1952725">waitreason</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1952737">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1952741">//&nbsp;approx&nbsp;time&nbsp;the&nbsp;G&nbsp;is&nbsp;blocked,&nbsp;in&nbsp;minutes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1952786">var</span>&nbsp;<span class="ident" id="1952790">waitfor</span>&nbsp;<span class="ident" id="1952798">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1952805">gpstatus</span>&nbsp;<span class="op" id="1952814">&amp;^=</span>&nbsp;<span class="ident" id="1952818">_Gscan</span>&nbsp;<span class="comment" id="1952825">//&nbsp;drop&nbsp;the&nbsp;scan&nbsp;bit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1952847">if</span>&nbsp;<span class="op" id="1952850">(</span><span class="ident" id="1952851">gpstatus</span>&nbsp;<span class="op" id="1952860">==</span>&nbsp;<span class="ident" id="1952863">_Gwaiting</span>&nbsp;<span class="op" id="1952873">||</span>&nbsp;<span class="ident" id="1952876">gpstatus</span>&nbsp;<span class="op" id="1952885">==</span>&nbsp;<span class="ident" id="1952888">_Gsyscall</span><span class="op" id="1952897">)</span>&nbsp;<span class="op" id="1952899">&amp;&amp;</span>&nbsp;<span class="ident" id="1952902">gp</span><span class="op" id="1952904">.</span><span class="ident" id="1952905">waitsince</span>&nbsp;<span class="op" id="1952915">!=</span>&nbsp;<span class="num" id="1952918">0</span>&nbsp;<span class="op" id="1952920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1952924">waitfor</span>&nbsp;<span class="op" id="1952932">=</span>&nbsp;<span class="op" id="1952934">(</span><span class="ident" id="1952935">nanotime</span><span class="op" id="1952943">(</span><span class="op" id="1952944">)</span>&nbsp;<span class="op" id="1952946">-</span>&nbsp;<span class="ident" id="1952948">gp</span><span class="op" id="1952950">.</span><span class="ident" id="1952951">waitsince</span><span class="op" id="1952960">)</span>&nbsp;<span class="op" id="1952962">/</span>&nbsp;<span class="num" id="1952964">60e9</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1952970">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1952973">print</span><span class="op" id="1952978">(</span><span class="string" id="1952979">&#34;goroutine&nbsp;&#34;</span><span class="op" id="1952991">,</span>&nbsp;<span class="ident" id="1952993">gp</span><span class="op" id="1952995">.</span><span class="ident" id="1952996">goid</span><span class="op" id="1953000">,</span>&nbsp;<span class="string" id="1953002">&#34;&nbsp;[&#34;</span><span class="op" id="1953006">,</span>&nbsp;<span class="ident" id="1953008">status</span><span class="op" id="1953014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1953017">if</span>&nbsp;<span class="ident" id="1953020">waitfor</span>&nbsp;<span class="op" id="1953028">&gt;=</span>&nbsp;<span class="num" id="1953031">1</span>&nbsp;<span class="op" id="1953033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1953037">print</span><span class="op" id="1953042">(</span><span class="string" id="1953043">&#34;,&nbsp;&#34;</span><span class="op" id="1953047">,</span>&nbsp;<span class="ident" id="1953049">waitfor</span><span class="op" id="1953056">,</span>&nbsp;<span class="string" id="1953058">&#34;&nbsp;minutes&#34;</span><span class="op" id="1953068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1953071">}</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1953074">if</span>&nbsp;<span class="ident" id="1953077">gp</span><span class="op" id="1953079">.</span><span class="ident" id="1953080">lockedm</span>&nbsp;<span class="op" id="1953088">!=</span>&nbsp;<span class="ident" id="1953091">nil</span>&nbsp;<span class="op" id="1953095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1953099">print</span><span class="op" id="1953104">(</span><span class="string" id="1953105">&#34;,&nbsp;locked&nbsp;to&nbsp;thread&#34;</span><span class="op" id="1953125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1953128">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1953131">print</span><span class="op" id="1953136">(</span><span class="string" id="1953137">&#34;]:\n&#34;</span><span class="op" id="1953143">)</span><br>
<span class="lineno"></span><span class="op" id="1953145">}</span><br>
<span class="lineno">620</span><br>
<span class="lineno"></span><span class="keyword" id="1953148">func</span>&nbsp;<span class="ident" id="1953153">tracebackothers</span><span class="op" id="1953168">(</span><span class="ident" id="1953169">me</span>&nbsp;<span class="op" id="1953172">*</span><span class="ident" id="1953173">g</span><span class="op" id="1953174">)</span>&nbsp;<span class="op" id="1953176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1953179">level</span>&nbsp;<span class="op" id="1953185">:=</span>&nbsp;<span class="ident" id="1953188">gotraceback</span><span class="op" id="1953199">(</span><span class="ident" id="1953200">nil</span><span class="op" id="1953203">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1953207">//&nbsp;Show&nbsp;the&nbsp;current&nbsp;goroutine&nbsp;first,&nbsp;if&nbsp;we&nbsp;haven&#39;t&nbsp;already.</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1953268">g</span>&nbsp;<span class="op" id="1953270">:=</span>&nbsp;<span class="ident" id="1953273">getg</span><span class="op" id="1953277">(</span><span class="op" id="1953278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1953281">gp</span>&nbsp;<span class="op" id="1953284">:=</span>&nbsp;<span class="ident" id="1953287">g</span><span class="op" id="1953288">.</span><span class="ident" id="1953289">m</span><span class="op" id="1953290">.</span><span class="ident" id="1953291">curg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1953297">if</span>&nbsp;<span class="ident" id="1953300">gp</span>&nbsp;<span class="op" id="1953303">!=</span>&nbsp;<span class="ident" id="1953306">nil</span>&nbsp;<span class="op" id="1953310">&amp;&amp;</span>&nbsp;<span class="ident" id="1953313">gp</span>&nbsp;<span class="op" id="1953316">!=</span>&nbsp;<span class="ident" id="1953319">me</span>&nbsp;<span class="op" id="1953322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1953326">print</span><span class="op" id="1953331">(</span><span class="string" id="1953332">&#34;\n&#34;</span><span class="op" id="1953336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1953340">goroutineheader</span><span class="op" id="1953355">(</span><span class="ident" id="1953356">gp</span><span class="op" id="1953358">)</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1953362">traceback</span><span class="op" id="1953371">(</span><span class="op" id="1953372">^</span><span class="builtintype" id="1953373">uintptr</span><span class="op" id="1953380">(</span><span class="num" id="1953381">0</span><span class="op" id="1953382">)</span><span class="op" id="1953383">,</span>&nbsp;<span class="op" id="1953385">^</span><span class="builtintype" id="1953386">uintptr</span><span class="op" id="1953393">(</span><span class="num" id="1953394">0</span><span class="op" id="1953395">)</span><span class="op" id="1953396">,</span>&nbsp;<span class="num" id="1953398">0</span><span class="op" id="1953399">,</span>&nbsp;<span class="ident" id="1953401">gp</span><span class="op" id="1953403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1953406">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1953410">lock</span><span class="op" id="1953414">(</span><span class="op" id="1953415">&amp;</span><span class="ident" id="1953416">allglock</span><span class="op" id="1953424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1953427">for</span>&nbsp;<span class="ident" id="1953431">_</span><span class="op" id="1953432">,</span>&nbsp;<span class="ident" id="1953434">gp</span>&nbsp;<span class="op" id="1953437">:=</span>&nbsp;<span class="keyword" id="1953440">range</span>&nbsp;<span class="ident" id="1953446">allgs</span>&nbsp;<span class="op" id="1953452">{</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1953456">if</span>&nbsp;<span class="ident" id="1953459">gp</span>&nbsp;<span class="op" id="1953462">==</span>&nbsp;<span class="ident" id="1953465">me</span>&nbsp;<span class="op" id="1953468">||</span>&nbsp;<span class="ident" id="1953471">gp</span>&nbsp;<span class="op" id="1953474">==</span>&nbsp;<span class="ident" id="1953477">g</span><span class="op" id="1953478">.</span><span class="ident" id="1953479">m</span><span class="op" id="1953480">.</span><span class="ident" id="1953481">curg</span>&nbsp;<span class="op" id="1953486">||</span>&nbsp;<span class="ident" id="1953489">readgstatus</span><span class="op" id="1953500">(</span><span class="ident" id="1953501">gp</span><span class="op" id="1953503">)</span>&nbsp;<span class="op" id="1953505">==</span>&nbsp;<span class="ident" id="1953508">_Gdead</span>&nbsp;<span class="op" id="1953515">||</span>&nbsp;<span class="ident" id="1953518">gp</span><span class="op" id="1953520">.</span><span class="ident" id="1953521">issystem</span>&nbsp;<span class="op" id="1953530">&amp;&amp;</span>&nbsp;<span class="ident" id="1953533">level</span>&nbsp;<span class="op" id="1953539">&lt;</span>&nbsp;<span class="num" id="1953541">2</span>&nbsp;<span class="op" id="1953543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1953548">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1953559">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1953563">print</span><span class="op" id="1953568">(</span><span class="string" id="1953569">&#34;\n&#34;</span><span class="op" id="1953573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1953577">goroutineheader</span><span class="op" id="1953592">(</span><span class="ident" id="1953593">gp</span><span class="op" id="1953595">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1953599">if</span>&nbsp;<span class="ident" id="1953602">readgstatus</span><span class="op" id="1953613">(</span><span class="ident" id="1953614">gp</span><span class="op" id="1953616">)</span><span class="op" id="1953617">&amp;^</span><span class="ident" id="1953619">_Gscan</span>&nbsp;<span class="op" id="1953626">==</span>&nbsp;<span class="ident" id="1953629">_Grunning</span>&nbsp;<span class="op" id="1953639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1953644">print</span><span class="op" id="1953649">(</span><span class="string" id="1953650">&#34;\tgoroutine&nbsp;running&nbsp;on&nbsp;other&nbsp;thread;&nbsp;stack&nbsp;unavailable\n&#34;</span><span class="op" id="1953708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1953713">printcreatedby</span><span class="op" id="1953727">(</span><span class="ident" id="1953728">gp</span><span class="op" id="1953730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1953734">}</span>&nbsp;<span class="keyword" id="1953736">else</span>&nbsp;<span class="op" id="1953741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1953746">traceback</span><span class="op" id="1953755">(</span><span class="op" id="1953756">^</span><span class="builtintype" id="1953757">uintptr</span><span class="op" id="1953764">(</span><span class="num" id="1953765">0</span><span class="op" id="1953766">)</span><span class="op" id="1953767">,</span>&nbsp;<span class="op" id="1953769">^</span><span class="builtintype" id="1953770">uintptr</span><span class="op" id="1953777">(</span><span class="num" id="1953778">0</span><span class="op" id="1953779">)</span><span class="op" id="1953780">,</span>&nbsp;<span class="num" id="1953782">0</span><span class="op" id="1953783">,</span>&nbsp;<span class="ident" id="1953785">gp</span><span class="op" id="1953787">)</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1953791">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1953794">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1953797">unlock</span><span class="op" id="1953803">(</span><span class="op" id="1953804">&amp;</span><span class="ident" id="1953805">allglock</span><span class="op" id="1953813">)</span><br>
<span class="lineno"></span><span class="op" id="1953815">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">650</span><span class="comment" id="1953818">//&nbsp;Does&nbsp;f&nbsp;mark&nbsp;the&nbsp;top&nbsp;of&nbsp;a&nbsp;goroutine&nbsp;stack?</span><br>
<span class="lineno"></span><span class="keyword" id="1953863">func</span>&nbsp;<span class="ident" id="1953868">topofstack</span><span class="op" id="1953878">(</span><span class="ident" id="1953879">f</span>&nbsp;<span class="op" id="1953881">*</span><span class="ident" id="1953882">_func</span><span class="op" id="1953887">)</span>&nbsp;<span class="builtintype" id="1953889">bool</span>&nbsp;<span class="op" id="1953894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1953897">pc</span>&nbsp;<span class="op" id="1953900">:=</span>&nbsp;<span class="ident" id="1953903">f</span><span class="op" id="1953904">.</span><span class="ident" id="1953905">entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1953912">return</span>&nbsp;<span class="ident" id="1953919">pc</span>&nbsp;<span class="op" id="1953922">==</span>&nbsp;<span class="ident" id="1953925">goexitPC</span>&nbsp;<span class="op" id="1953934">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1953939">pc</span>&nbsp;<span class="op" id="1953942">==</span>&nbsp;<span class="ident" id="1953945">mstartPC</span>&nbsp;<span class="op" id="1953954">||</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1953959">pc</span>&nbsp;<span class="op" id="1953962">==</span>&nbsp;<span class="ident" id="1953965">mcallPC</span>&nbsp;<span class="op" id="1953973">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1953978">pc</span>&nbsp;<span class="op" id="1953981">==</span>&nbsp;<span class="ident" id="1953984">morestackPC</span>&nbsp;<span class="op" id="1953996">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1954001">pc</span>&nbsp;<span class="op" id="1954004">==</span>&nbsp;<span class="ident" id="1954007">rt0_goPC</span>&nbsp;<span class="op" id="1954016">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1954021">externalthreadhandlerp</span>&nbsp;<span class="op" id="1954044">!=</span>&nbsp;<span class="num" id="1954047">0</span>&nbsp;<span class="op" id="1954049">&amp;&amp;</span>&nbsp;<span class="ident" id="1954052">pc</span>&nbsp;<span class="op" id="1954055">==</span>&nbsp;<span class="ident" id="1954058">externalthreadhandlerp</span><br>
<span class="lineno"></span><span class="op" id="1954081">}</span>
</div>
</body>
</html>
