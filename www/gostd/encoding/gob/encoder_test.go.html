<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/gob</h2>
<ul>
<li><a href="/gostd/encoding/gob/codec_test.go.html">codec_test.go</a></li>
<li><a href="/gostd/encoding/gob/dec_helpers.go.html">dec_helpers.go</a></li>
<li><a href="/gostd/encoding/gob/decode.go.html">decode.go</a></li>
<li><a href="/gostd/encoding/gob/decoder.go.html">decoder.go</a></li>
<li><a href="/gostd/encoding/gob/doc.go.html">doc.go</a></li>
<li><a href="/gostd/encoding/gob/enc_helpers.go.html">enc_helpers.go</a></li>
<li><a href="/gostd/encoding/gob/encode.go.html">encode.go</a></li>
<li><a href="/gostd/encoding/gob/encoder.go.html">encoder.go</a></li>
<li><a href="/gostd/encoding/gob/encoder_test.go.html" class="current">encoder_test.go</a></li>
<li><a href="/gostd/encoding/gob/error.go.html">error.go</a></li>
<li><a href="/gostd/encoding/gob/example_encdec_test.go.html">example_encdec_test.go</a></li>
<li><a href="/gostd/encoding/gob/example_interface_test.go.html">example_interface_test.go</a></li>
<li><a href="/gostd/encoding/gob/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/gob/gobencdec_test.go.html">gobencdec_test.go</a></li>
<li><a href="/gostd/encoding/gob/timing_test.go.html">timing_test.go</a></li>
<li><a href="/gostd/encoding/gob/type.go.html">type.go</a></li>
<li><a href="/gostd/encoding/gob/type_test.go.html">type_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8123693">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8123748">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8123802">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8123853">package</span>&nbsp;<span class="ident" id="8123861">gob</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8123866">import</span>&nbsp;<span class="op" id="8123873">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8123876">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8123885">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8123892">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8123898">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8123909">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8123920">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8123930">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="8123933">//&nbsp;Test&nbsp;basic&nbsp;operations&nbsp;in&nbsp;a&nbsp;safe&nbsp;manner.</span><br>
<span class="lineno"></span><span class="keyword" id="8123976">func</span>&nbsp;<span class="ident" id="8123981">TestBasicEncoderDecoder</span><span class="op" id="8124004">(</span><span class="ident" id="8124005">t</span>&nbsp;<span class="op" id="8124007">*</span><span class="ident" id="8124008">testing</span><span class="op" id="8124015">.</span><span class="ident" id="8124016">T</span><span class="op" id="8124017">)</span>&nbsp;<span class="op" id="8124019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8124022">var</span>&nbsp;<span class="ident" id="8124026">values</span>&nbsp;<span class="op" id="8124033">=</span>&nbsp;<span class="op" id="8124035">[</span><span class="op" id="8124036">]</span><span class="keyword" id="8124037">interface</span><span class="op" id="8124046">{</span><span class="op" id="8124047">}</span><span class="op" id="8124048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8124052">true</span><span class="op" id="8124056">,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8124060">int</span><span class="op" id="8124063">(</span><span class="num" id="8124064">123</span><span class="op" id="8124067">)</span><span class="op" id="8124068">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8124072">int8</span><span class="op" id="8124076">(</span><span class="num" id="8124077">123</span><span class="op" id="8124080">)</span><span class="op" id="8124081">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8124085">int16</span><span class="op" id="8124090">(</span><span class="op" id="8124091">-</span><span class="num" id="8124092">12345</span><span class="op" id="8124097">)</span><span class="op" id="8124098">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8124102">int32</span><span class="op" id="8124107">(</span><span class="num" id="8124108">123456</span><span class="op" id="8124114">)</span><span class="op" id="8124115">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8124119">int64</span><span class="op" id="8124124">(</span><span class="op" id="8124125">-</span><span class="num" id="8124126">1234567</span><span class="op" id="8124133">)</span><span class="op" id="8124134">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8124138">uint</span><span class="op" id="8124142">(</span><span class="num" id="8124143">123</span><span class="op" id="8124146">)</span><span class="op" id="8124147">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8124151">uint8</span><span class="op" id="8124156">(</span><span class="num" id="8124157">123</span><span class="op" id="8124160">)</span><span class="op" id="8124161">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8124165">uint16</span><span class="op" id="8124171">(</span><span class="num" id="8124172">12345</span><span class="op" id="8124177">)</span><span class="op" id="8124178">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8124182">uint32</span><span class="op" id="8124188">(</span><span class="num" id="8124189">123456</span><span class="op" id="8124195">)</span><span class="op" id="8124196">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8124200">uint64</span><span class="op" id="8124206">(</span><span class="num" id="8124207">1234567</span><span class="op" id="8124214">)</span><span class="op" id="8124215">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8124219">uintptr</span><span class="op" id="8124226">(</span><span class="num" id="8124227">12345678</span><span class="op" id="8124235">)</span><span class="op" id="8124236">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8124240">float32</span><span class="op" id="8124247">(</span><span class="num" id="8124248">1.2345</span><span class="op" id="8124254">)</span><span class="op" id="8124255">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8124259">float64</span><span class="op" id="8124266">(</span><span class="num" id="8124267">1.2345678</span><span class="op" id="8124276">)</span><span class="op" id="8124277">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8124281">complex64</span><span class="op" id="8124290">(</span><span class="num" id="8124291">1.2345</span>&nbsp;<span class="op" id="8124298">+</span>&nbsp;<span class="num" id="8124300">2.3456i</span><span class="op" id="8124307">)</span><span class="op" id="8124308">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8124312">complex128</span><span class="op" id="8124322">(</span><span class="num" id="8124323">1.2345678</span>&nbsp;<span class="op" id="8124333">+</span>&nbsp;<span class="num" id="8124335">2.3456789i</span><span class="op" id="8124345">)</span><span class="op" id="8124346">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8124350">[</span><span class="op" id="8124351">]</span><span class="builtintype" id="8124352">byte</span><span class="op" id="8124356">(</span><span class="string" id="8124357">&#34;hello&#34;</span><span class="op" id="8124364">)</span><span class="op" id="8124365">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8124369">string</span><span class="op" id="8124375">(</span><span class="string" id="8124376">&#34;hello&#34;</span><span class="op" id="8124383">)</span><span class="op" id="8124384">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8124387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8124390">for</span>&nbsp;<span class="ident" id="8124394">_</span><span class="op" id="8124395">,</span>&nbsp;<span class="ident" id="8124397">value</span>&nbsp;<span class="op" id="8124403">:=</span>&nbsp;<span class="keyword" id="8124406">range</span>&nbsp;<span class="ident" id="8124412">values</span>&nbsp;<span class="op" id="8124419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8124423">b</span>&nbsp;<span class="op" id="8124425">:=</span>&nbsp;<span class="builtinfunc" id="8124428">new</span><span class="op" id="8124431">(</span><span class="ident" id="8124432">bytes</span><span class="op" id="8124437">.</span><span class="ident" id="8124438">Buffer</span><span class="op" id="8124444">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8124448">enc</span>&nbsp;<span class="op" id="8124452">:=</span>&nbsp;<span class="ident" id="8124455">NewEncoder</span><span class="op" id="8124465">(</span><span class="ident" id="8124466">b</span><span class="op" id="8124467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8124471">err</span>&nbsp;<span class="op" id="8124475">:=</span>&nbsp;<span class="ident" id="8124478">enc</span><span class="op" id="8124481">.</span><span class="ident" id="8124482">Encode</span><span class="op" id="8124488">(</span><span class="ident" id="8124489">value</span><span class="op" id="8124494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8124498">if</span>&nbsp;<span class="ident" id="8124501">err</span>&nbsp;<span class="op" id="8124505">!=</span>&nbsp;<span class="ident" id="8124508">nil</span>&nbsp;<span class="op" id="8124512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8124517">t</span><span class="op" id="8124518">.</span><span class="ident" id="8124519">Error</span><span class="op" id="8124524">(</span><span class="string" id="8124525">&#34;encoder&nbsp;fail:&#34;</span><span class="op" id="8124540">,</span>&nbsp;<span class="ident" id="8124542">err</span><span class="op" id="8124545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8124549">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8124553">dec</span>&nbsp;<span class="op" id="8124557">:=</span>&nbsp;<span class="ident" id="8124560">NewDecoder</span><span class="op" id="8124570">(</span><span class="ident" id="8124571">b</span><span class="op" id="8124572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8124576">result</span>&nbsp;<span class="op" id="8124583">:=</span>&nbsp;<span class="ident" id="8124586">reflect</span><span class="op" id="8124593">.</span><span class="ident" id="8124594">New</span><span class="op" id="8124597">(</span><span class="ident" id="8124598">reflect</span><span class="op" id="8124605">.</span><span class="ident" id="8124606">TypeOf</span><span class="op" id="8124612">(</span><span class="ident" id="8124613">value</span><span class="op" id="8124618">)</span><span class="op" id="8124619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8124623">err</span>&nbsp;<span class="op" id="8124627">=</span>&nbsp;<span class="ident" id="8124629">dec</span><span class="op" id="8124632">.</span><span class="ident" id="8124633">Decode</span><span class="op" id="8124639">(</span><span class="ident" id="8124640">result</span><span class="op" id="8124646">.</span><span class="ident" id="8124647">Interface</span><span class="op" id="8124656">(</span><span class="op" id="8124657">)</span><span class="op" id="8124658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8124662">if</span>&nbsp;<span class="ident" id="8124665">err</span>&nbsp;<span class="op" id="8124669">!=</span>&nbsp;<span class="ident" id="8124672">nil</span>&nbsp;<span class="op" id="8124676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8124681">t</span><span class="op" id="8124682">.</span><span class="ident" id="8124683">Fatalf</span><span class="op" id="8124689">(</span><span class="string" id="8124690">&#34;error&nbsp;decoding&nbsp;%T:&nbsp;%v:&#34;</span><span class="op" id="8124714">,</span>&nbsp;<span class="ident" id="8124716">reflect</span><span class="op" id="8124723">.</span><span class="ident" id="8124724">TypeOf</span><span class="op" id="8124730">(</span><span class="ident" id="8124731">value</span><span class="op" id="8124736">)</span><span class="op" id="8124737">,</span>&nbsp;<span class="ident" id="8124739">err</span><span class="op" id="8124742">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8124746">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8124750">if</span>&nbsp;<span class="op" id="8124753">!</span><span class="ident" id="8124754">reflect</span><span class="op" id="8124761">.</span><span class="ident" id="8124762">DeepEqual</span><span class="op" id="8124771">(</span><span class="ident" id="8124772">value</span><span class="op" id="8124777">,</span>&nbsp;<span class="ident" id="8124779">result</span><span class="op" id="8124785">.</span><span class="ident" id="8124786">Elem</span><span class="op" id="8124790">(</span><span class="op" id="8124791">)</span><span class="op" id="8124792">.</span><span class="ident" id="8124793">Interface</span><span class="op" id="8124802">(</span><span class="op" id="8124803">)</span><span class="op" id="8124804">)</span>&nbsp;<span class="op" id="8124806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8124811">t</span><span class="op" id="8124812">.</span><span class="ident" id="8124813">Fatalf</span><span class="op" id="8124819">(</span><span class="string" id="8124820">&#34;%T:&nbsp;expected&nbsp;%v&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8124844">,</span>&nbsp;<span class="ident" id="8124846">value</span><span class="op" id="8124851">,</span>&nbsp;<span class="ident" id="8124853">value</span><span class="op" id="8124858">,</span>&nbsp;<span class="ident" id="8124860">result</span><span class="op" id="8124866">.</span><span class="ident" id="8124867">Elem</span><span class="op" id="8124871">(</span><span class="op" id="8124872">)</span><span class="op" id="8124873">.</span><span class="ident" id="8124874">Interface</span><span class="op" id="8124883">(</span><span class="op" id="8124884">)</span><span class="op" id="8124885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8124889">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8124892">}</span><br>
<span class="lineno">55</span><span class="op" id="8124894">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8124897">type</span>&nbsp;<span class="ident" id="8124902">ET0</span>&nbsp;<span class="keyword" id="8124906">struct</span>&nbsp;<span class="op" id="8124913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8124916">A</span>&nbsp;<span class="builtintype" id="8124918">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8124923">B</span>&nbsp;<span class="builtintype" id="8124925">string</span><br>
<span class="lineno">60</span><span class="op" id="8124932">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8124935">type</span>&nbsp;<span class="ident" id="8124940">ET2</span>&nbsp;<span class="keyword" id="8124944">struct</span>&nbsp;<span class="op" id="8124951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8124954">X</span>&nbsp;<span class="builtintype" id="8124956">string</span><br>
<span class="lineno"></span><span class="op" id="8124963">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="8124966">type</span>&nbsp;<span class="ident" id="8124971">ET1</span>&nbsp;<span class="keyword" id="8124975">struct</span>&nbsp;<span class="op" id="8124982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8124985">A</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8124990">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8124995">Et2</span>&nbsp;&nbsp;<span class="op" id="8125000">*</span><span class="ident" id="8125001">ET2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8125006">Next</span>&nbsp;<span class="op" id="8125011">*</span><span class="ident" id="8125012">ET1</span><br>
<span class="lineno">70</span><span class="op" id="8125016">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8125019">//&nbsp;Like&nbsp;ET1&nbsp;but&nbsp;with&nbsp;a&nbsp;different&nbsp;name&nbsp;for&nbsp;a&nbsp;field</span><br>
<span class="lineno"></span><span class="keyword" id="8125069">type</span>&nbsp;<span class="ident" id="8125074">ET3</span>&nbsp;<span class="keyword" id="8125078">struct</span>&nbsp;<span class="op" id="8125085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8125088">A</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8125102">int</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8125107">Et2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8125121">*</span><span class="ident" id="8125122">ET2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8125127">DifferentNext</span>&nbsp;<span class="op" id="8125141">*</span><span class="ident" id="8125142">ET1</span><br>
<span class="lineno"></span><span class="op" id="8125146">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8125149">//&nbsp;Like&nbsp;ET1&nbsp;but&nbsp;with&nbsp;a&nbsp;different&nbsp;type&nbsp;for&nbsp;a&nbsp;field</span><br>
<span class="lineno">80</span><span class="keyword" id="8125199">type</span>&nbsp;<span class="ident" id="8125204">ET4</span>&nbsp;<span class="keyword" id="8125208">struct</span>&nbsp;<span class="op" id="8125215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8125218">A</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8125223">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8125228">Et2</span>&nbsp;&nbsp;<span class="builtintype" id="8125233">float64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8125242">Next</span>&nbsp;<span class="builtintype" id="8125247">int</span><br>
<span class="lineno"></span><span class="op" id="8125251">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="keyword" id="8125254">func</span>&nbsp;<span class="ident" id="8125259">TestEncoderDecoder</span><span class="op" id="8125277">(</span><span class="ident" id="8125278">t</span>&nbsp;<span class="op" id="8125280">*</span><span class="ident" id="8125281">testing</span><span class="op" id="8125288">.</span><span class="ident" id="8125289">T</span><span class="op" id="8125290">)</span>&nbsp;<span class="op" id="8125292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8125295">b</span>&nbsp;<span class="op" id="8125297">:=</span>&nbsp;<span class="builtinfunc" id="8125300">new</span><span class="op" id="8125303">(</span><span class="ident" id="8125304">bytes</span><span class="op" id="8125309">.</span><span class="ident" id="8125310">Buffer</span><span class="op" id="8125316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8125319">enc</span>&nbsp;<span class="op" id="8125323">:=</span>&nbsp;<span class="ident" id="8125326">NewEncoder</span><span class="op" id="8125336">(</span><span class="ident" id="8125337">b</span><span class="op" id="8125338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8125341">et0</span>&nbsp;<span class="op" id="8125345">:=</span>&nbsp;<span class="builtinfunc" id="8125348">new</span><span class="op" id="8125351">(</span><span class="ident" id="8125352">ET0</span><span class="op" id="8125355">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8125358">et0</span><span class="op" id="8125361">.</span><span class="ident" id="8125362">A</span>&nbsp;<span class="op" id="8125364">=</span>&nbsp;<span class="num" id="8125366">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8125369">et0</span><span class="op" id="8125372">.</span><span class="ident" id="8125373">B</span>&nbsp;<span class="op" id="8125375">=</span>&nbsp;<span class="string" id="8125377">&#34;gobs&nbsp;of&nbsp;fun&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8125392">err</span>&nbsp;<span class="op" id="8125396">:=</span>&nbsp;<span class="ident" id="8125399">enc</span><span class="op" id="8125402">.</span><span class="ident" id="8125403">Encode</span><span class="op" id="8125409">(</span><span class="ident" id="8125410">et0</span><span class="op" id="8125413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8125416">if</span>&nbsp;<span class="ident" id="8125419">err</span>&nbsp;<span class="op" id="8125423">!=</span>&nbsp;<span class="ident" id="8125426">nil</span>&nbsp;<span class="op" id="8125430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8125434">t</span><span class="op" id="8125435">.</span><span class="ident" id="8125436">Error</span><span class="op" id="8125441">(</span><span class="string" id="8125442">&#34;encoder&nbsp;fail:&#34;</span><span class="op" id="8125457">,</span>&nbsp;<span class="ident" id="8125459">err</span><span class="op" id="8125462">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8125465">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8125468">//fmt.Printf(&#34;%&nbsp;x&nbsp;%q\n&#34;,&nbsp;b,&nbsp;b)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8125500">//Debug(b)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8125512">dec</span>&nbsp;<span class="op" id="8125516">:=</span>&nbsp;<span class="ident" id="8125519">NewDecoder</span><span class="op" id="8125529">(</span><span class="ident" id="8125530">b</span><span class="op" id="8125531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8125534">newEt0</span>&nbsp;<span class="op" id="8125541">:=</span>&nbsp;<span class="builtinfunc" id="8125544">new</span><span class="op" id="8125547">(</span><span class="ident" id="8125548">ET0</span><span class="op" id="8125551">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8125554">err</span>&nbsp;<span class="op" id="8125558">=</span>&nbsp;<span class="ident" id="8125560">dec</span><span class="op" id="8125563">.</span><span class="ident" id="8125564">Decode</span><span class="op" id="8125570">(</span><span class="ident" id="8125571">newEt0</span><span class="op" id="8125577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8125580">if</span>&nbsp;<span class="ident" id="8125583">err</span>&nbsp;<span class="op" id="8125587">!=</span>&nbsp;<span class="ident" id="8125590">nil</span>&nbsp;<span class="op" id="8125594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8125598">t</span><span class="op" id="8125599">.</span><span class="ident" id="8125600">Fatal</span><span class="op" id="8125605">(</span><span class="string" id="8125606">&#34;error&nbsp;decoding&nbsp;ET0:&#34;</span><span class="op" id="8125627">,</span>&nbsp;<span class="ident" id="8125629">err</span><span class="op" id="8125632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8125635">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8125639">if</span>&nbsp;<span class="op" id="8125642">!</span><span class="ident" id="8125643">reflect</span><span class="op" id="8125650">.</span><span class="ident" id="8125651">DeepEqual</span><span class="op" id="8125660">(</span><span class="ident" id="8125661">et0</span><span class="op" id="8125664">,</span>&nbsp;<span class="ident" id="8125666">newEt0</span><span class="op" id="8125672">)</span>&nbsp;<span class="op" id="8125674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8125678">t</span><span class="op" id="8125679">.</span><span class="ident" id="8125680">Fatalf</span><span class="op" id="8125686">(</span><span class="string" id="8125687">&#34;invalid&nbsp;data&nbsp;for&nbsp;et0:&nbsp;expected&nbsp;%+v;&nbsp;got&nbsp;%+v&#34;</span><span class="op" id="8125732">,</span>&nbsp;<span class="op" id="8125734">*</span><span class="ident" id="8125735">et0</span><span class="op" id="8125738">,</span>&nbsp;<span class="op" id="8125740">*</span><span class="ident" id="8125741">newEt0</span><span class="op" id="8125747">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8125750">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8125753">if</span>&nbsp;<span class="ident" id="8125756">b</span><span class="op" id="8125757">.</span><span class="ident" id="8125758">Len</span><span class="op" id="8125761">(</span><span class="op" id="8125762">)</span>&nbsp;<span class="op" id="8125764">!=</span>&nbsp;<span class="num" id="8125767">0</span>&nbsp;<span class="op" id="8125769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8125773">t</span><span class="op" id="8125774">.</span><span class="ident" id="8125775">Error</span><span class="op" id="8125780">(</span><span class="string" id="8125781">&#34;not&nbsp;at&nbsp;eof;&#34;</span><span class="op" id="8125794">,</span>&nbsp;<span class="ident" id="8125796">b</span><span class="op" id="8125797">.</span><span class="ident" id="8125798">Len</span><span class="op" id="8125801">(</span><span class="op" id="8125802">)</span><span class="op" id="8125803">,</span>&nbsp;<span class="string" id="8125805">&#34;bytes&nbsp;left&#34;</span><span class="op" id="8125817">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8125820">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8125823">//&nbsp;&nbsp;&nbsp;&nbspt.FailNow()</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8125840">b</span>&nbsp;<span class="op" id="8125842">=</span>&nbsp;<span class="builtinfunc" id="8125844">new</span><span class="op" id="8125847">(</span><span class="ident" id="8125848">bytes</span><span class="op" id="8125853">.</span><span class="ident" id="8125854">Buffer</span><span class="op" id="8125860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8125863">enc</span>&nbsp;<span class="op" id="8125867">=</span>&nbsp;<span class="ident" id="8125869">NewEncoder</span><span class="op" id="8125879">(</span><span class="ident" id="8125880">b</span><span class="op" id="8125881">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8125884">et1</span>&nbsp;<span class="op" id="8125888">:=</span>&nbsp;<span class="builtinfunc" id="8125891">new</span><span class="op" id="8125894">(</span><span class="ident" id="8125895">ET1</span><span class="op" id="8125898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8125901">et1</span><span class="op" id="8125904">.</span><span class="ident" id="8125905">A</span>&nbsp;<span class="op" id="8125907">=</span>&nbsp;<span class="num" id="8125909">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8125912">et1</span><span class="op" id="8125915">.</span><span class="ident" id="8125916">Et2</span>&nbsp;<span class="op" id="8125920">=</span>&nbsp;<span class="builtinfunc" id="8125922">new</span><span class="op" id="8125925">(</span><span class="ident" id="8125926">ET2</span><span class="op" id="8125929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8125932">err</span>&nbsp;<span class="op" id="8125936">=</span>&nbsp;<span class="ident" id="8125938">enc</span><span class="op" id="8125941">.</span><span class="ident" id="8125942">Encode</span><span class="op" id="8125948">(</span><span class="ident" id="8125949">et1</span><span class="op" id="8125952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8125955">if</span>&nbsp;<span class="ident" id="8125958">err</span>&nbsp;<span class="op" id="8125962">!=</span>&nbsp;<span class="ident" id="8125965">nil</span>&nbsp;<span class="op" id="8125969">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8125973">t</span><span class="op" id="8125974">.</span><span class="ident" id="8125975">Error</span><span class="op" id="8125980">(</span><span class="string" id="8125981">&#34;encoder&nbsp;fail:&#34;</span><span class="op" id="8125996">,</span>&nbsp;<span class="ident" id="8125998">err</span><span class="op" id="8126001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8126004">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8126007">dec</span>&nbsp;<span class="op" id="8126011">=</span>&nbsp;<span class="ident" id="8126013">NewDecoder</span><span class="op" id="8126023">(</span><span class="ident" id="8126024">b</span><span class="op" id="8126025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8126028">newEt1</span>&nbsp;<span class="op" id="8126035">:=</span>&nbsp;<span class="builtinfunc" id="8126038">new</span><span class="op" id="8126041">(</span><span class="ident" id="8126042">ET1</span><span class="op" id="8126045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8126048">err</span>&nbsp;<span class="op" id="8126052">=</span>&nbsp;<span class="ident" id="8126054">dec</span><span class="op" id="8126057">.</span><span class="ident" id="8126058">Decode</span><span class="op" id="8126064">(</span><span class="ident" id="8126065">newEt1</span><span class="op" id="8126071">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8126074">if</span>&nbsp;<span class="ident" id="8126077">err</span>&nbsp;<span class="op" id="8126081">!=</span>&nbsp;<span class="ident" id="8126084">nil</span>&nbsp;<span class="op" id="8126088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8126092">t</span><span class="op" id="8126093">.</span><span class="ident" id="8126094">Fatal</span><span class="op" id="8126099">(</span><span class="string" id="8126100">&#34;error&nbsp;decoding&nbsp;ET1:&#34;</span><span class="op" id="8126121">,</span>&nbsp;<span class="ident" id="8126123">err</span><span class="op" id="8126126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8126129">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8126133">if</span>&nbsp;<span class="op" id="8126136">!</span><span class="ident" id="8126137">reflect</span><span class="op" id="8126144">.</span><span class="ident" id="8126145">DeepEqual</span><span class="op" id="8126154">(</span><span class="ident" id="8126155">et1</span><span class="op" id="8126158">,</span>&nbsp;<span class="ident" id="8126160">newEt1</span><span class="op" id="8126166">)</span>&nbsp;<span class="op" id="8126168">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8126172">t</span><span class="op" id="8126173">.</span><span class="ident" id="8126174">Fatalf</span><span class="op" id="8126180">(</span><span class="string" id="8126181">&#34;invalid&nbsp;data&nbsp;for&nbsp;et1:&nbsp;expected&nbsp;%+v;&nbsp;got&nbsp;%+v&#34;</span><span class="op" id="8126226">,</span>&nbsp;<span class="op" id="8126228">*</span><span class="ident" id="8126229">et1</span><span class="op" id="8126232">,</span>&nbsp;<span class="op" id="8126234">*</span><span class="ident" id="8126235">newEt1</span><span class="op" id="8126241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8126244">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8126247">if</span>&nbsp;<span class="ident" id="8126250">b</span><span class="op" id="8126251">.</span><span class="ident" id="8126252">Len</span><span class="op" id="8126255">(</span><span class="op" id="8126256">)</span>&nbsp;<span class="op" id="8126258">!=</span>&nbsp;<span class="num" id="8126261">0</span>&nbsp;<span class="op" id="8126263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8126267">t</span><span class="op" id="8126268">.</span><span class="ident" id="8126269">Error</span><span class="op" id="8126274">(</span><span class="string" id="8126275">&#34;not&nbsp;at&nbsp;eof;&#34;</span><span class="op" id="8126288">,</span>&nbsp;<span class="ident" id="8126290">b</span><span class="op" id="8126291">.</span><span class="ident" id="8126292">Len</span><span class="op" id="8126295">(</span><span class="op" id="8126296">)</span><span class="op" id="8126297">,</span>&nbsp;<span class="string" id="8126299">&#34;bytes&nbsp;left&#34;</span><span class="op" id="8126311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8126314">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8126318">enc</span><span class="op" id="8126321">.</span><span class="ident" id="8126322">Encode</span><span class="op" id="8126328">(</span><span class="ident" id="8126329">et1</span><span class="op" id="8126332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8126335">newEt1</span>&nbsp;<span class="op" id="8126342">=</span>&nbsp;<span class="builtinfunc" id="8126344">new</span><span class="op" id="8126347">(</span><span class="ident" id="8126348">ET1</span><span class="op" id="8126351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8126354">err</span>&nbsp;<span class="op" id="8126358">=</span>&nbsp;<span class="ident" id="8126360">dec</span><span class="op" id="8126363">.</span><span class="ident" id="8126364">Decode</span><span class="op" id="8126370">(</span><span class="ident" id="8126371">newEt1</span><span class="op" id="8126377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8126380">if</span>&nbsp;<span class="ident" id="8126383">err</span>&nbsp;<span class="op" id="8126387">!=</span>&nbsp;<span class="ident" id="8126390">nil</span>&nbsp;<span class="op" id="8126394">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8126398">t</span><span class="op" id="8126399">.</span><span class="ident" id="8126400">Fatal</span><span class="op" id="8126405">(</span><span class="string" id="8126406">&#34;round&nbsp;2:&nbsp;error&nbsp;decoding&nbsp;ET1:&#34;</span><span class="op" id="8126436">,</span>&nbsp;<span class="ident" id="8126438">err</span><span class="op" id="8126441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8126444">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8126447">if</span>&nbsp;<span class="op" id="8126450">!</span><span class="ident" id="8126451">reflect</span><span class="op" id="8126458">.</span><span class="ident" id="8126459">DeepEqual</span><span class="op" id="8126468">(</span><span class="ident" id="8126469">et1</span><span class="op" id="8126472">,</span>&nbsp;<span class="ident" id="8126474">newEt1</span><span class="op" id="8126480">)</span>&nbsp;<span class="op" id="8126482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8126486">t</span><span class="op" id="8126487">.</span><span class="ident" id="8126488">Fatalf</span><span class="op" id="8126494">(</span><span class="string" id="8126495">&#34;round&nbsp;2:&nbsp;invalid&nbsp;data&nbsp;for&nbsp;et1:&nbsp;expected&nbsp;%+v;&nbsp;got&nbsp;%+v&#34;</span><span class="op" id="8126549">,</span>&nbsp;<span class="op" id="8126551">*</span><span class="ident" id="8126552">et1</span><span class="op" id="8126555">,</span>&nbsp;<span class="op" id="8126557">*</span><span class="ident" id="8126558">newEt1</span><span class="op" id="8126564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8126567">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8126570">if</span>&nbsp;<span class="ident" id="8126573">b</span><span class="op" id="8126574">.</span><span class="ident" id="8126575">Len</span><span class="op" id="8126578">(</span><span class="op" id="8126579">)</span>&nbsp;<span class="op" id="8126581">!=</span>&nbsp;<span class="num" id="8126584">0</span>&nbsp;<span class="op" id="8126586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8126590">t</span><span class="op" id="8126591">.</span><span class="ident" id="8126592">Error</span><span class="op" id="8126597">(</span><span class="string" id="8126598">&#34;round&nbsp;2:&nbsp;not&nbsp;at&nbsp;eof;&#34;</span><span class="op" id="8126620">,</span>&nbsp;<span class="ident" id="8126622">b</span><span class="op" id="8126623">.</span><span class="ident" id="8126624">Len</span><span class="op" id="8126627">(</span><span class="op" id="8126628">)</span><span class="op" id="8126629">,</span>&nbsp;<span class="string" id="8126631">&#34;bytes&nbsp;left&#34;</span><span class="op" id="8126643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8126646">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8126650">//&nbsp;Now&nbsp;test&nbsp;with&nbsp;a&nbsp;running&nbsp;encoder/decoder&nbsp;pair&nbsp;that&nbsp;we&nbsp;recognize&nbsp;a&nbsp;type&nbsp;mismatch.</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8126734">err</span>&nbsp;<span class="op" id="8126738">=</span>&nbsp;<span class="ident" id="8126740">enc</span><span class="op" id="8126743">.</span><span class="ident" id="8126744">Encode</span><span class="op" id="8126750">(</span><span class="ident" id="8126751">et1</span><span class="op" id="8126754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8126757">if</span>&nbsp;<span class="ident" id="8126760">err</span>&nbsp;<span class="op" id="8126764">!=</span>&nbsp;<span class="ident" id="8126767">nil</span>&nbsp;<span class="op" id="8126771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8126775">t</span><span class="op" id="8126776">.</span><span class="ident" id="8126777">Error</span><span class="op" id="8126782">(</span><span class="string" id="8126783">&#34;round&nbsp;3:&nbsp;encoder&nbsp;fail:&#34;</span><span class="op" id="8126807">,</span>&nbsp;<span class="ident" id="8126809">err</span><span class="op" id="8126812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8126815">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8126818">newEt2</span>&nbsp;<span class="op" id="8126825">:=</span>&nbsp;<span class="builtinfunc" id="8126828">new</span><span class="op" id="8126831">(</span><span class="ident" id="8126832">ET2</span><span class="op" id="8126835">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8126838">err</span>&nbsp;<span class="op" id="8126842">=</span>&nbsp;<span class="ident" id="8126844">dec</span><span class="op" id="8126847">.</span><span class="ident" id="8126848">Decode</span><span class="op" id="8126854">(</span><span class="ident" id="8126855">newEt2</span><span class="op" id="8126861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8126864">if</span>&nbsp;<span class="ident" id="8126867">err</span>&nbsp;<span class="op" id="8126871">==</span>&nbsp;<span class="ident" id="8126874">nil</span>&nbsp;<span class="op" id="8126878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8126882">t</span><span class="op" id="8126883">.</span><span class="ident" id="8126884">Fatal</span><span class="op" id="8126889">(</span><span class="string" id="8126890">&#34;round&nbsp;3:&nbsp;expected&nbsp;`bad&nbsp;type&#39;&nbsp;error&nbsp;decoding&nbsp;ET2&#34;</span><span class="op" id="8126939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8126942">}</span><br>
<span class="lineno"></span><span class="op" id="8126944">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span><span class="comment" id="8126947">//&nbsp;Run&nbsp;one&nbsp;value&nbsp;through&nbsp;the&nbsp;encoder/decoder,&nbsp;but&nbsp;use&nbsp;the&nbsp;wrong&nbsp;type.</span><br>
<span class="lineno"></span><span class="comment" id="8127017">//&nbsp;Input&nbsp;is&nbsp;always&nbsp;an&nbsp;ET1;&nbsp;we&nbsp;compare&nbsp;it&nbsp;to&nbsp;whatever&nbsp;is&nbsp;under&nbsp;&#39;e&#39;.</span><br>
<span class="lineno"></span><span class="keyword" id="8127084">func</span>&nbsp;<span class="ident" id="8127089">badTypeCheck</span><span class="op" id="8127101">(</span><span class="ident" id="8127102">e</span>&nbsp;<span class="keyword" id="8127104">interface</span><span class="op" id="8127113">{</span><span class="op" id="8127114">}</span><span class="op" id="8127115">,</span>&nbsp;<span class="ident" id="8127117">shouldFail</span>&nbsp;<span class="builtintype" id="8127128">bool</span><span class="op" id="8127132">,</span>&nbsp;<span class="ident" id="8127134">msg</span>&nbsp;<span class="builtintype" id="8127138">string</span><span class="op" id="8127144">,</span>&nbsp;<span class="ident" id="8127146">t</span>&nbsp;<span class="op" id="8127148">*</span><span class="ident" id="8127149">testing</span><span class="op" id="8127156">.</span><span class="ident" id="8127157">T</span><span class="op" id="8127158">)</span>&nbsp;<span class="op" id="8127160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8127163">b</span>&nbsp;<span class="op" id="8127165">:=</span>&nbsp;<span class="builtinfunc" id="8127168">new</span><span class="op" id="8127171">(</span><span class="ident" id="8127172">bytes</span><span class="op" id="8127177">.</span><span class="ident" id="8127178">Buffer</span><span class="op" id="8127184">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8127187">enc</span>&nbsp;<span class="op" id="8127191">:=</span>&nbsp;<span class="ident" id="8127194">NewEncoder</span><span class="op" id="8127204">(</span><span class="ident" id="8127205">b</span><span class="op" id="8127206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8127209">et1</span>&nbsp;<span class="op" id="8127213">:=</span>&nbsp;<span class="builtinfunc" id="8127216">new</span><span class="op" id="8127219">(</span><span class="ident" id="8127220">ET1</span><span class="op" id="8127223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8127226">et1</span><span class="op" id="8127229">.</span><span class="ident" id="8127230">A</span>&nbsp;<span class="op" id="8127232">=</span>&nbsp;<span class="num" id="8127234">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8127237">et1</span><span class="op" id="8127240">.</span><span class="ident" id="8127241">Et2</span>&nbsp;<span class="op" id="8127245">=</span>&nbsp;<span class="builtinfunc" id="8127247">new</span><span class="op" id="8127250">(</span><span class="ident" id="8127251">ET2</span><span class="op" id="8127254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8127257">err</span>&nbsp;<span class="op" id="8127261">:=</span>&nbsp;<span class="ident" id="8127264">enc</span><span class="op" id="8127267">.</span><span class="ident" id="8127268">Encode</span><span class="op" id="8127274">(</span><span class="ident" id="8127275">et1</span><span class="op" id="8127278">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8127281">if</span>&nbsp;<span class="ident" id="8127284">err</span>&nbsp;<span class="op" id="8127288">!=</span>&nbsp;<span class="ident" id="8127291">nil</span>&nbsp;<span class="op" id="8127295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8127299">t</span><span class="op" id="8127300">.</span><span class="ident" id="8127301">Error</span><span class="op" id="8127306">(</span><span class="string" id="8127307">&#34;encoder&nbsp;fail:&#34;</span><span class="op" id="8127322">,</span>&nbsp;<span class="ident" id="8127324">err</span><span class="op" id="8127327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8127330">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8127333">dec</span>&nbsp;<span class="op" id="8127337">:=</span>&nbsp;<span class="ident" id="8127340">NewDecoder</span><span class="op" id="8127350">(</span><span class="ident" id="8127351">b</span><span class="op" id="8127352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8127355">err</span>&nbsp;<span class="op" id="8127359">=</span>&nbsp;<span class="ident" id="8127361">dec</span><span class="op" id="8127364">.</span><span class="ident" id="8127365">Decode</span><span class="op" id="8127371">(</span><span class="ident" id="8127372">e</span><span class="op" id="8127373">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8127376">if</span>&nbsp;<span class="ident" id="8127379">shouldFail</span>&nbsp;<span class="op" id="8127390">&amp;&amp;</span>&nbsp;<span class="ident" id="8127393">err</span>&nbsp;<span class="op" id="8127397">==</span>&nbsp;<span class="ident" id="8127400">nil</span>&nbsp;<span class="op" id="8127404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8127408">t</span><span class="op" id="8127409">.</span><span class="ident" id="8127410">Error</span><span class="op" id="8127415">(</span><span class="string" id="8127416">&#34;expected&nbsp;error&nbsp;for&#34;</span><span class="op" id="8127436">,</span>&nbsp;<span class="ident" id="8127438">msg</span><span class="op" id="8127441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8127444">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8127447">if</span>&nbsp;<span class="op" id="8127450">!</span><span class="ident" id="8127451">shouldFail</span>&nbsp;<span class="op" id="8127462">&amp;&amp;</span>&nbsp;<span class="ident" id="8127465">err</span>&nbsp;<span class="op" id="8127469">!=</span>&nbsp;<span class="ident" id="8127472">nil</span>&nbsp;<span class="op" id="8127476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8127480">t</span><span class="op" id="8127481">.</span><span class="ident" id="8127482">Error</span><span class="op" id="8127487">(</span><span class="string" id="8127488">&#34;unexpected&nbsp;error&nbsp;for&#34;</span><span class="op" id="8127510">,</span>&nbsp;<span class="ident" id="8127512">msg</span><span class="op" id="8127515">,</span>&nbsp;<span class="ident" id="8127517">err</span><span class="op" id="8127520">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8127523">}</span><br>
<span class="lineno"></span><span class="op" id="8127525">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8127528">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;recognize&nbsp;a&nbsp;bad&nbsp;type&nbsp;the&nbsp;first&nbsp;time.</span><br>
<span class="lineno"></span><span class="keyword" id="8127581">func</span>&nbsp;<span class="ident" id="8127586">TestWrongTypeDecoder</span><span class="op" id="8127606">(</span><span class="ident" id="8127607">t</span>&nbsp;<span class="op" id="8127609">*</span><span class="ident" id="8127610">testing</span><span class="op" id="8127617">.</span><span class="ident" id="8127618">T</span><span class="op" id="8127619">)</span>&nbsp;<span class="op" id="8127621">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8127624">badTypeCheck</span><span class="op" id="8127636">(</span><span class="builtinfunc" id="8127637">new</span><span class="op" id="8127640">(</span><span class="ident" id="8127641">ET2</span><span class="op" id="8127644">)</span><span class="op" id="8127645">,</span>&nbsp;<span class="builtintype" id="8127647">true</span><span class="op" id="8127651">,</span>&nbsp;<span class="string" id="8127653">&#34;no&nbsp;fields&nbsp;in&nbsp;common&#34;</span><span class="op" id="8127674">,</span>&nbsp;<span class="ident" id="8127676">t</span><span class="op" id="8127677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8127680">badTypeCheck</span><span class="op" id="8127692">(</span><span class="builtinfunc" id="8127693">new</span><span class="op" id="8127696">(</span><span class="ident" id="8127697">ET3</span><span class="op" id="8127700">)</span><span class="op" id="8127701">,</span>&nbsp;<span class="builtintype" id="8127703">false</span><span class="op" id="8127708">,</span>&nbsp;<span class="string" id="8127710">&#34;different&nbsp;name&nbsp;of&nbsp;field&#34;</span><span class="op" id="8127735">,</span>&nbsp;<span class="ident" id="8127737">t</span><span class="op" id="8127738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8127741">badTypeCheck</span><span class="op" id="8127753">(</span><span class="builtinfunc" id="8127754">new</span><span class="op" id="8127757">(</span><span class="ident" id="8127758">ET4</span><span class="op" id="8127761">)</span><span class="op" id="8127762">,</span>&nbsp;<span class="builtintype" id="8127764">true</span><span class="op" id="8127768">,</span>&nbsp;<span class="string" id="8127770">&#34;different&nbsp;type&nbsp;of&nbsp;field&#34;</span><span class="op" id="8127795">,</span>&nbsp;<span class="ident" id="8127797">t</span><span class="op" id="8127798">)</span><br>
<span class="lineno"></span><span class="op" id="8127800">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="keyword" id="8127803">func</span>&nbsp;<span class="ident" id="8127808">corruptDataCheck</span><span class="op" id="8127824">(</span><span class="ident" id="8127825">s</span>&nbsp;<span class="builtintype" id="8127827">string</span><span class="op" id="8127833">,</span>&nbsp;<span class="ident" id="8127835">err</span>&nbsp;<span class="builtintype" id="8127839">error</span><span class="op" id="8127844">,</span>&nbsp;<span class="ident" id="8127846">t</span>&nbsp;<span class="op" id="8127848">*</span><span class="ident" id="8127849">testing</span><span class="op" id="8127856">.</span><span class="ident" id="8127857">T</span><span class="op" id="8127858">)</span>&nbsp;<span class="op" id="8127860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8127863">b</span>&nbsp;<span class="op" id="8127865">:=</span>&nbsp;<span class="ident" id="8127868">bytes</span><span class="op" id="8127873">.</span><span class="ident" id="8127874">NewBufferString</span><span class="op" id="8127889">(</span><span class="ident" id="8127890">s</span><span class="op" id="8127891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8127894">dec</span>&nbsp;<span class="op" id="8127898">:=</span>&nbsp;<span class="ident" id="8127901">NewDecoder</span><span class="op" id="8127911">(</span><span class="ident" id="8127912">b</span><span class="op" id="8127913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8127916">err1</span>&nbsp;<span class="op" id="8127921">:=</span>&nbsp;<span class="ident" id="8127924">dec</span><span class="op" id="8127927">.</span><span class="ident" id="8127928">Decode</span><span class="op" id="8127934">(</span><span class="builtinfunc" id="8127935">new</span><span class="op" id="8127938">(</span><span class="ident" id="8127939">ET2</span><span class="op" id="8127942">)</span><span class="op" id="8127943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8127946">if</span>&nbsp;<span class="ident" id="8127949">err1</span>&nbsp;<span class="op" id="8127954">!=</span>&nbsp;<span class="ident" id="8127957">err</span>&nbsp;<span class="op" id="8127961">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8127965">t</span><span class="op" id="8127966">.</span><span class="ident" id="8127967">Errorf</span><span class="op" id="8127973">(</span><span class="string" id="8127974">&#34;from&nbsp;%q&nbsp;expected&nbsp;error&nbsp;%s;&nbsp;got&nbsp;%s&#34;</span><span class="op" id="8128009">,</span>&nbsp;<span class="ident" id="8128011">s</span><span class="op" id="8128012">,</span>&nbsp;<span class="ident" id="8128014">err</span><span class="op" id="8128017">,</span>&nbsp;<span class="ident" id="8128019">err1</span><span class="op" id="8128023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8128026">}</span><br>
<span class="lineno"></span><span class="op" id="8128028">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8128031">//&nbsp;Check&nbsp;that&nbsp;we&nbsp;survive&nbsp;bad&nbsp;data.</span><br>
<span class="lineno">200</span><span class="keyword" id="8128066">func</span>&nbsp;<span class="ident" id="8128071">TestBadData</span><span class="op" id="8128082">(</span><span class="ident" id="8128083">t</span>&nbsp;<span class="op" id="8128085">*</span><span class="ident" id="8128086">testing</span><span class="op" id="8128093">.</span><span class="ident" id="8128094">T</span><span class="op" id="8128095">)</span>&nbsp;<span class="op" id="8128097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8128100">corruptDataCheck</span><span class="op" id="8128116">(</span><span class="string" id="8128117">&#34;&#34;</span><span class="op" id="8128119">,</span>&nbsp;<span class="ident" id="8128121">io</span><span class="op" id="8128123">.</span><span class="ident" id="8128124">EOF</span><span class="op" id="8128127">,</span>&nbsp;<span class="ident" id="8128129">t</span><span class="op" id="8128130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8128133">corruptDataCheck</span><span class="op" id="8128149">(</span><span class="string" id="8128150">&#34;\x7Fhi&#34;</span><span class="op" id="8128158">,</span>&nbsp;<span class="ident" id="8128160">io</span><span class="op" id="8128162">.</span><span class="ident" id="8128163">ErrUnexpectedEOF</span><span class="op" id="8128179">,</span>&nbsp;<span class="ident" id="8128181">t</span><span class="op" id="8128182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8128185">corruptDataCheck</span><span class="op" id="8128201">(</span><span class="string" id="8128202">&#34;\x03now&nbsp;is&nbsp;the&nbsp;time&nbsp;for&nbsp;all&nbsp;good&nbsp;men&#34;</span><span class="op" id="8128240">,</span>&nbsp;<span class="ident" id="8128242">errBadType</span><span class="op" id="8128252">,</span>&nbsp;<span class="ident" id="8128254">t</span><span class="op" id="8128255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8128258">//&nbsp;issue&nbsp;6323.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8128274">corruptDataCheck</span><span class="op" id="8128290">(</span><span class="string" id="8128291">&#34;\x04\x24foo&#34;</span><span class="op" id="8128304">,</span>&nbsp;<span class="ident" id="8128306">errRange</span><span class="op" id="8128314">,</span>&nbsp;<span class="ident" id="8128316">t</span><span class="op" id="8128317">)</span><br>
<span class="lineno"></span><span class="op" id="8128319">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8128322">//&nbsp;Types&nbsp;not&nbsp;supported&nbsp;at&nbsp;top&nbsp;level&nbsp;by&nbsp;the&nbsp;Encoder.</span><br>
<span class="lineno"></span><span class="keyword" id="8128374">var</span>&nbsp;<span class="ident" id="8128378">unsupportedValues</span>&nbsp;<span class="op" id="8128396">=</span>&nbsp;<span class="op" id="8128398">[</span><span class="op" id="8128399">]</span><span class="keyword" id="8128400">interface</span><span class="op" id="8128409">{</span><span class="op" id="8128410">}</span><span class="op" id="8128411">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8128414">make</span><span class="op" id="8128418">(</span><span class="keyword" id="8128419">chan</span>&nbsp;<span class="builtintype" id="8128424">int</span><span class="op" id="8128427">)</span><span class="op" id="8128428">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8128431">func</span><span class="op" id="8128435">(</span><span class="ident" id="8128436">a</span>&nbsp;<span class="builtintype" id="8128438">int</span><span class="op" id="8128441">)</span>&nbsp;<span class="builtintype" id="8128443">bool</span>&nbsp;<span class="op" id="8128448">{</span>&nbsp;<span class="keyword" id="8128450">return</span>&nbsp;<span class="builtintype" id="8128457">true</span>&nbsp;<span class="op" id="8128462">}</span><span class="op" id="8128463">,</span><br>
<span class="lineno"></span><span class="op" id="8128465">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8128468">func</span>&nbsp;<span class="ident" id="8128473">TestUnsupported</span><span class="op" id="8128488">(</span><span class="ident" id="8128489">t</span>&nbsp;<span class="op" id="8128491">*</span><span class="ident" id="8128492">testing</span><span class="op" id="8128499">.</span><span class="ident" id="8128500">T</span><span class="op" id="8128501">)</span>&nbsp;<span class="op" id="8128503">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8128506">var</span>&nbsp;<span class="ident" id="8128510">b</span>&nbsp;<span class="ident" id="8128512">bytes</span><span class="op" id="8128517">.</span><span class="ident" id="8128518">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8128526">enc</span>&nbsp;<span class="op" id="8128530">:=</span>&nbsp;<span class="ident" id="8128533">NewEncoder</span><span class="op" id="8128543">(</span><span class="op" id="8128544">&amp;</span><span class="ident" id="8128545">b</span><span class="op" id="8128546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8128549">for</span>&nbsp;<span class="ident" id="8128553">_</span><span class="op" id="8128554">,</span>&nbsp;<span class="ident" id="8128556">v</span>&nbsp;<span class="op" id="8128558">:=</span>&nbsp;<span class="keyword" id="8128561">range</span>&nbsp;<span class="ident" id="8128567">unsupportedValues</span>&nbsp;<span class="op" id="8128585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8128589">err</span>&nbsp;<span class="op" id="8128593">:=</span>&nbsp;<span class="ident" id="8128596">enc</span><span class="op" id="8128599">.</span><span class="ident" id="8128600">Encode</span><span class="op" id="8128606">(</span><span class="ident" id="8128607">v</span><span class="op" id="8128608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8128612">if</span>&nbsp;<span class="ident" id="8128615">err</span>&nbsp;<span class="op" id="8128619">==</span>&nbsp;<span class="ident" id="8128622">nil</span>&nbsp;<span class="op" id="8128626">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8128631">t</span><span class="op" id="8128632">.</span><span class="ident" id="8128633">Errorf</span><span class="op" id="8128639">(</span><span class="string" id="8128640">&#34;expected&nbsp;error&nbsp;for&nbsp;%T;&nbsp;got&nbsp;none&#34;</span><span class="op" id="8128673">,</span>&nbsp;<span class="ident" id="8128675">v</span><span class="op" id="8128676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8128680">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8128683">}</span><br>
<span class="lineno"></span><span class="op" id="8128685">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span><span class="keyword" id="8128688">func</span>&nbsp;<span class="ident" id="8128693">encAndDec</span><span class="op" id="8128702">(</span><span class="ident" id="8128703">in</span><span class="op" id="8128705">,</span>&nbsp;<span class="ident" id="8128707">out</span>&nbsp;<span class="keyword" id="8128711">interface</span><span class="op" id="8128720">{</span><span class="op" id="8128721">}</span><span class="op" id="8128722">)</span>&nbsp;<span class="builtintype" id="8128724">error</span>&nbsp;<span class="op" id="8128730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8128733">b</span>&nbsp;<span class="op" id="8128735">:=</span>&nbsp;<span class="builtinfunc" id="8128738">new</span><span class="op" id="8128741">(</span><span class="ident" id="8128742">bytes</span><span class="op" id="8128747">.</span><span class="ident" id="8128748">Buffer</span><span class="op" id="8128754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8128757">enc</span>&nbsp;<span class="op" id="8128761">:=</span>&nbsp;<span class="ident" id="8128764">NewEncoder</span><span class="op" id="8128774">(</span><span class="ident" id="8128775">b</span><span class="op" id="8128776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8128779">err</span>&nbsp;<span class="op" id="8128783">:=</span>&nbsp;<span class="ident" id="8128786">enc</span><span class="op" id="8128789">.</span><span class="ident" id="8128790">Encode</span><span class="op" id="8128796">(</span><span class="ident" id="8128797">in</span><span class="op" id="8128799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8128802">if</span>&nbsp;<span class="ident" id="8128805">err</span>&nbsp;<span class="op" id="8128809">!=</span>&nbsp;<span class="ident" id="8128812">nil</span>&nbsp;<span class="op" id="8128816">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8128820">return</span>&nbsp;<span class="ident" id="8128827">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8128832">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8128835">dec</span>&nbsp;<span class="op" id="8128839">:=</span>&nbsp;<span class="ident" id="8128842">NewDecoder</span><span class="op" id="8128852">(</span><span class="ident" id="8128853">b</span><span class="op" id="8128854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8128857">err</span>&nbsp;<span class="op" id="8128861">=</span>&nbsp;<span class="ident" id="8128863">dec</span><span class="op" id="8128866">.</span><span class="ident" id="8128867">Decode</span><span class="op" id="8128873">(</span><span class="ident" id="8128874">out</span><span class="op" id="8128877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8128880">if</span>&nbsp;<span class="ident" id="8128883">err</span>&nbsp;<span class="op" id="8128887">!=</span>&nbsp;<span class="ident" id="8128890">nil</span>&nbsp;<span class="op" id="8128894">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8128898">return</span>&nbsp;<span class="ident" id="8128905">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8128910">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8128913">return</span>&nbsp;<span class="ident" id="8128920">nil</span><br>
<span class="lineno"></span><span class="op" id="8128924">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="keyword" id="8128927">func</span>&nbsp;<span class="ident" id="8128932">TestTypeToPtrType</span><span class="op" id="8128949">(</span><span class="ident" id="8128950">t</span>&nbsp;<span class="op" id="8128952">*</span><span class="ident" id="8128953">testing</span><span class="op" id="8128960">.</span><span class="ident" id="8128961">T</span><span class="op" id="8128962">)</span>&nbsp;<span class="op" id="8128964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8128967">//&nbsp;Encode&nbsp;a&nbsp;T,&nbsp;decode&nbsp;a&nbsp;*T</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8128995">type</span>&nbsp;<span class="ident" id="8129000">Type0</span>&nbsp;<span class="keyword" id="8129006">struct</span>&nbsp;<span class="op" id="8129013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8129017">A</span>&nbsp;<span class="builtintype" id="8129019">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8129024">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8129027">t0</span>&nbsp;<span class="op" id="8129030">:=</span>&nbsp;<span class="ident" id="8129033">Type0</span><span class="op" id="8129038">{</span><span class="num" id="8129039">7</span><span class="op" id="8129040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8129043">t0p</span>&nbsp;<span class="op" id="8129047">:=</span>&nbsp;<span class="builtinfunc" id="8129050">new</span><span class="op" id="8129053">(</span><span class="ident" id="8129054">Type0</span><span class="op" id="8129059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8129062">if</span>&nbsp;<span class="ident" id="8129065">err</span>&nbsp;<span class="op" id="8129069">:=</span>&nbsp;<span class="ident" id="8129072">encAndDec</span><span class="op" id="8129081">(</span><span class="ident" id="8129082">t0</span><span class="op" id="8129084">,</span>&nbsp;<span class="ident" id="8129086">t0p</span><span class="op" id="8129089">)</span><span class="op" id="8129090">;</span>&nbsp;<span class="ident" id="8129092">err</span>&nbsp;<span class="op" id="8129096">!=</span>&nbsp;<span class="ident" id="8129099">nil</span>&nbsp;<span class="op" id="8129103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8129107">t</span><span class="op" id="8129108">.</span><span class="ident" id="8129109">Error</span><span class="op" id="8129114">(</span><span class="ident" id="8129115">err</span><span class="op" id="8129118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8129121">}</span><br>
<span class="lineno">250</span><span class="op" id="8129123">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8129126">func</span>&nbsp;<span class="ident" id="8129131">TestPtrTypeToType</span><span class="op" id="8129148">(</span><span class="ident" id="8129149">t</span>&nbsp;<span class="op" id="8129151">*</span><span class="ident" id="8129152">testing</span><span class="op" id="8129159">.</span><span class="ident" id="8129160">T</span><span class="op" id="8129161">)</span>&nbsp;<span class="op" id="8129163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8129166">//&nbsp;Encode&nbsp;a&nbsp;*T,&nbsp;decode&nbsp;a&nbsp;T</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8129194">type</span>&nbsp;<span class="ident" id="8129199">Type1</span>&nbsp;<span class="keyword" id="8129205">struct</span>&nbsp;<span class="op" id="8129212">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8129216">A</span>&nbsp;<span class="builtintype" id="8129218">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8129224">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8129227">t1p</span>&nbsp;<span class="op" id="8129231">:=</span>&nbsp;<span class="op" id="8129234">&amp;</span><span class="ident" id="8129235">Type1</span><span class="op" id="8129240">{</span><span class="num" id="8129241">17</span><span class="op" id="8129243">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8129246">var</span>&nbsp;<span class="ident" id="8129250">t1</span>&nbsp;<span class="ident" id="8129253">Type1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8129260">if</span>&nbsp;<span class="ident" id="8129263">err</span>&nbsp;<span class="op" id="8129267">:=</span>&nbsp;<span class="ident" id="8129270">encAndDec</span><span class="op" id="8129279">(</span><span class="ident" id="8129280">t1</span><span class="op" id="8129282">,</span>&nbsp;<span class="ident" id="8129284">t1p</span><span class="op" id="8129287">)</span><span class="op" id="8129288">;</span>&nbsp;<span class="ident" id="8129290">err</span>&nbsp;<span class="op" id="8129294">!=</span>&nbsp;<span class="ident" id="8129297">nil</span>&nbsp;<span class="op" id="8129301">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8129305">t</span><span class="op" id="8129306">.</span><span class="ident" id="8129307">Error</span><span class="op" id="8129312">(</span><span class="ident" id="8129313">err</span><span class="op" id="8129316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8129319">}</span><br>
<span class="lineno"></span><span class="op" id="8129321">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8129324">func</span>&nbsp;<span class="ident" id="8129329">TestTypeToPtrPtrPtrPtrType</span><span class="op" id="8129355">(</span><span class="ident" id="8129356">t</span>&nbsp;<span class="op" id="8129358">*</span><span class="ident" id="8129359">testing</span><span class="op" id="8129366">.</span><span class="ident" id="8129367">T</span><span class="op" id="8129368">)</span>&nbsp;<span class="op" id="8129370">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8129373">type</span>&nbsp;<span class="ident" id="8129378">Type2</span>&nbsp;<span class="keyword" id="8129384">struct</span>&nbsp;<span class="op" id="8129391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8129395">A</span>&nbsp;<span class="op" id="8129397">*</span><span class="op" id="8129398">*</span><span class="op" id="8129399">*</span><span class="op" id="8129400">*</span><span class="builtintype" id="8129401">float64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8129410">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8129413">t2</span>&nbsp;<span class="op" id="8129416">:=</span>&nbsp;<span class="ident" id="8129419">Type2</span><span class="op" id="8129424">{</span><span class="op" id="8129425">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8129428">t2</span><span class="op" id="8129430">.</span><span class="ident" id="8129431">A</span>&nbsp;<span class="op" id="8129433">=</span>&nbsp;<span class="builtinfunc" id="8129435">new</span><span class="op" id="8129438">(</span><span class="op" id="8129439">*</span><span class="op" id="8129440">*</span><span class="op" id="8129441">*</span><span class="builtintype" id="8129442">float64</span><span class="op" id="8129449">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8129452">*</span><span class="ident" id="8129453">t2</span><span class="op" id="8129455">.</span><span class="ident" id="8129456">A</span>&nbsp;<span class="op" id="8129458">=</span>&nbsp;<span class="builtinfunc" id="8129460">new</span><span class="op" id="8129463">(</span><span class="op" id="8129464">*</span><span class="op" id="8129465">*</span><span class="builtintype" id="8129466">float64</span><span class="op" id="8129473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8129476">*</span><span class="op" id="8129477">*</span><span class="ident" id="8129478">t2</span><span class="op" id="8129480">.</span><span class="ident" id="8129481">A</span>&nbsp;<span class="op" id="8129483">=</span>&nbsp;<span class="builtinfunc" id="8129485">new</span><span class="op" id="8129488">(</span><span class="op" id="8129489">*</span><span class="builtintype" id="8129490">float64</span><span class="op" id="8129497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8129500">*</span><span class="op" id="8129501">*</span><span class="op" id="8129502">*</span><span class="ident" id="8129503">t2</span><span class="op" id="8129505">.</span><span class="ident" id="8129506">A</span>&nbsp;<span class="op" id="8129508">=</span>&nbsp;<span class="builtinfunc" id="8129510">new</span><span class="op" id="8129513">(</span><span class="builtintype" id="8129514">float64</span><span class="op" id="8129521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8129524">*</span><span class="op" id="8129525">*</span><span class="op" id="8129526">*</span><span class="op" id="8129527">*</span><span class="ident" id="8129528">t2</span><span class="op" id="8129530">.</span><span class="ident" id="8129531">A</span>&nbsp;<span class="op" id="8129533">=</span>&nbsp;<span class="num" id="8129535">27.4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8129541">t2pppp</span>&nbsp;<span class="op" id="8129548">:=</span>&nbsp;<span class="builtinfunc" id="8129551">new</span><span class="op" id="8129554">(</span><span class="op" id="8129555">*</span><span class="op" id="8129556">*</span><span class="op" id="8129557">*</span><span class="ident" id="8129558">Type2</span><span class="op" id="8129563">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8129566">if</span>&nbsp;<span class="ident" id="8129569">err</span>&nbsp;<span class="op" id="8129573">:=</span>&nbsp;<span class="ident" id="8129576">encAndDec</span><span class="op" id="8129585">(</span><span class="ident" id="8129586">t2</span><span class="op" id="8129588">,</span>&nbsp;<span class="ident" id="8129590">t2pppp</span><span class="op" id="8129596">)</span><span class="op" id="8129597">;</span>&nbsp;<span class="ident" id="8129599">err</span>&nbsp;<span class="op" id="8129603">!=</span>&nbsp;<span class="ident" id="8129606">nil</span>&nbsp;<span class="op" id="8129610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8129614">t</span><span class="op" id="8129615">.</span><span class="ident" id="8129616">Fatal</span><span class="op" id="8129621">(</span><span class="ident" id="8129622">err</span><span class="op" id="8129625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8129628">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8129631">if</span>&nbsp;<span class="op" id="8129634">*</span><span class="op" id="8129635">*</span><span class="op" id="8129636">*</span><span class="op" id="8129637">*</span><span class="op" id="8129638">(</span><span class="op" id="8129639">*</span><span class="op" id="8129640">*</span><span class="op" id="8129641">*</span><span class="op" id="8129642">*</span><span class="ident" id="8129643">t2pppp</span><span class="op" id="8129649">)</span><span class="op" id="8129650">.</span><span class="ident" id="8129651">A</span>&nbsp;<span class="op" id="8129653">!=</span>&nbsp;<span class="op" id="8129656">*</span><span class="op" id="8129657">*</span><span class="op" id="8129658">*</span><span class="op" id="8129659">*</span><span class="ident" id="8129660">t2</span><span class="op" id="8129662">.</span><span class="ident" id="8129663">A</span>&nbsp;<span class="op" id="8129665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8129669">t</span><span class="op" id="8129670">.</span><span class="ident" id="8129671">Errorf</span><span class="op" id="8129677">(</span><span class="string" id="8129678">&#34;wrong&nbsp;value&nbsp;after&nbsp;decode:&nbsp;%g&nbsp;not&nbsp;%g&#34;</span><span class="op" id="8129715">,</span>&nbsp;<span class="op" id="8129717">*</span><span class="op" id="8129718">*</span><span class="op" id="8129719">*</span><span class="op" id="8129720">*</span><span class="op" id="8129721">(</span><span class="op" id="8129722">*</span><span class="op" id="8129723">*</span><span class="op" id="8129724">*</span><span class="op" id="8129725">*</span><span class="ident" id="8129726">t2pppp</span><span class="op" id="8129732">)</span><span class="op" id="8129733">.</span><span class="ident" id="8129734">A</span><span class="op" id="8129735">,</span>&nbsp;<span class="op" id="8129737">*</span><span class="op" id="8129738">*</span><span class="op" id="8129739">*</span><span class="op" id="8129740">*</span><span class="ident" id="8129741">t2</span><span class="op" id="8129743">.</span><span class="ident" id="8129744">A</span><span class="op" id="8129745">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8129748">}</span><br>
<span class="lineno"></span><span class="op" id="8129750">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8129753">func</span>&nbsp;<span class="ident" id="8129758">TestSlice</span><span class="op" id="8129767">(</span><span class="ident" id="8129768">t</span>&nbsp;<span class="op" id="8129770">*</span><span class="ident" id="8129771">testing</span><span class="op" id="8129778">.</span><span class="ident" id="8129779">T</span><span class="op" id="8129780">)</span>&nbsp;<span class="op" id="8129782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8129785">type</span>&nbsp;<span class="ident" id="8129790">Type3</span>&nbsp;<span class="keyword" id="8129796">struct</span>&nbsp;<span class="op" id="8129803">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8129807">A</span>&nbsp;<span class="op" id="8129809">[</span><span class="op" id="8129810">]</span><span class="builtintype" id="8129811">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8129819">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8129822">t3p</span>&nbsp;<span class="op" id="8129826">:=</span>&nbsp;<span class="op" id="8129829">&amp;</span><span class="ident" id="8129830">Type3</span><span class="op" id="8129835">{</span><span class="op" id="8129836">[</span><span class="op" id="8129837">]</span><span class="builtintype" id="8129838">string</span><span class="op" id="8129844">{</span><span class="string" id="8129845">&#34;hello&#34;</span><span class="op" id="8129852">,</span>&nbsp;<span class="string" id="8129854">&#34;world&#34;</span><span class="op" id="8129861">}</span><span class="op" id="8129862">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8129865">var</span>&nbsp;<span class="ident" id="8129869">t3</span>&nbsp;<span class="ident" id="8129872">Type3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8129879">if</span>&nbsp;<span class="ident" id="8129882">err</span>&nbsp;<span class="op" id="8129886">:=</span>&nbsp;<span class="ident" id="8129889">encAndDec</span><span class="op" id="8129898">(</span><span class="ident" id="8129899">t3</span><span class="op" id="8129901">,</span>&nbsp;<span class="ident" id="8129903">t3p</span><span class="op" id="8129906">)</span><span class="op" id="8129907">;</span>&nbsp;<span class="ident" id="8129909">err</span>&nbsp;<span class="op" id="8129913">!=</span>&nbsp;<span class="ident" id="8129916">nil</span>&nbsp;<span class="op" id="8129920">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8129924">t</span><span class="op" id="8129925">.</span><span class="ident" id="8129926">Error</span><span class="op" id="8129931">(</span><span class="ident" id="8129932">err</span><span class="op" id="8129935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8129938">}</span><br>
<span class="lineno"></span><span class="op" id="8129940">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8129943">func</span>&nbsp;<span class="ident" id="8129948">TestValueError</span><span class="op" id="8129962">(</span><span class="ident" id="8129963">t</span>&nbsp;<span class="op" id="8129965">*</span><span class="ident" id="8129966">testing</span><span class="op" id="8129973">.</span><span class="ident" id="8129974">T</span><span class="op" id="8129975">)</span>&nbsp;<span class="op" id="8129977">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8129980">//&nbsp;Encode&nbsp;a&nbsp;*T,&nbsp;decode&nbsp;a&nbsp;T</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8130008">type</span>&nbsp;<span class="ident" id="8130013">Type4</span>&nbsp;<span class="keyword" id="8130019">struct</span>&nbsp;<span class="op" id="8130026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8130030">A</span>&nbsp;<span class="builtintype" id="8130032">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8130037">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8130040">t4p</span>&nbsp;<span class="op" id="8130044">:=</span>&nbsp;<span class="op" id="8130047">&amp;</span><span class="ident" id="8130048">Type4</span><span class="op" id="8130053">{</span><span class="num" id="8130054">3</span><span class="op" id="8130055">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8130058">var</span>&nbsp;<span class="ident" id="8130062">t4</span>&nbsp;<span class="ident" id="8130065">Type4</span>&nbsp;<span class="comment" id="8130071">//&nbsp;note:&nbsp;not&nbsp;a&nbsp;pointer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8130096">if</span>&nbsp;<span class="ident" id="8130099">err</span>&nbsp;<span class="op" id="8130103">:=</span>&nbsp;<span class="ident" id="8130106">encAndDec</span><span class="op" id="8130115">(</span><span class="ident" id="8130116">t4p</span><span class="op" id="8130119">,</span>&nbsp;<span class="ident" id="8130121">t4</span><span class="op" id="8130123">)</span><span class="op" id="8130124">;</span>&nbsp;<span class="ident" id="8130126">err</span>&nbsp;<span class="op" id="8130130">==</span>&nbsp;<span class="ident" id="8130133">nil</span>&nbsp;<span class="op" id="8130137">||</span>&nbsp;<span class="ident" id="8130140">strings</span><span class="op" id="8130147">.</span><span class="ident" id="8130148">Index</span><span class="op" id="8130153">(</span><span class="ident" id="8130154">err</span><span class="op" id="8130157">.</span><span class="ident" id="8130158">Error</span><span class="op" id="8130163">(</span><span class="op" id="8130164">)</span><span class="op" id="8130165">,</span>&nbsp;<span class="string" id="8130167">&#34;pointer&#34;</span><span class="op" id="8130176">)</span>&nbsp;<span class="op" id="8130178">&lt;</span>&nbsp;<span class="num" id="8130180">0</span>&nbsp;<span class="op" id="8130182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8130186">t</span><span class="op" id="8130187">.</span><span class="ident" id="8130188">Error</span><span class="op" id="8130193">(</span><span class="string" id="8130194">&#34;expected&nbsp;error&nbsp;about&nbsp;pointer;&nbsp;got&#34;</span><span class="op" id="8130229">,</span>&nbsp;<span class="ident" id="8130231">err</span><span class="op" id="8130234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8130237">}</span><br>
<span class="lineno"></span><span class="op" id="8130239">}</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span><span class="keyword" id="8130242">func</span>&nbsp;<span class="ident" id="8130247">TestArray</span><span class="op" id="8130256">(</span><span class="ident" id="8130257">t</span>&nbsp;<span class="op" id="8130259">*</span><span class="ident" id="8130260">testing</span><span class="op" id="8130267">.</span><span class="ident" id="8130268">T</span><span class="op" id="8130269">)</span>&nbsp;<span class="op" id="8130271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8130274">type</span>&nbsp;<span class="ident" id="8130279">Type5</span>&nbsp;<span class="keyword" id="8130285">struct</span>&nbsp;<span class="op" id="8130292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8130296">A</span>&nbsp;<span class="op" id="8130298">[</span><span class="num" id="8130299">3</span><span class="op" id="8130300">]</span><span class="builtintype" id="8130301">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8130310">B</span>&nbsp;<span class="op" id="8130312">[</span><span class="num" id="8130313">3</span><span class="op" id="8130314">]</span><span class="builtintype" id="8130315">byte</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8130321">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8130324">type</span>&nbsp;<span class="ident" id="8130329">Type6</span>&nbsp;<span class="keyword" id="8130335">struct</span>&nbsp;<span class="op" id="8130342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8130346">A</span>&nbsp;<span class="op" id="8130348">[</span><span class="num" id="8130349">2</span><span class="op" id="8130350">]</span><span class="builtintype" id="8130351">string</span>&nbsp;<span class="comment" id="8130358">//&nbsp;can&#39;t&nbsp;hold&nbsp;t5.a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8130378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8130381">t5</span>&nbsp;<span class="op" id="8130384">:=</span>&nbsp;<span class="ident" id="8130387">Type5</span><span class="op" id="8130392">{</span><span class="op" id="8130393">[</span><span class="num" id="8130394">3</span><span class="op" id="8130395">]</span><span class="builtintype" id="8130396">string</span><span class="op" id="8130402">{</span><span class="string" id="8130403">&#34;hello&#34;</span><span class="op" id="8130410">,</span>&nbsp;<span class="string" id="8130412">&#34;,&#34;</span><span class="op" id="8130415">,</span>&nbsp;<span class="string" id="8130417">&#34;world&#34;</span><span class="op" id="8130424">}</span><span class="op" id="8130425">,</span>&nbsp;<span class="op" id="8130427">[</span><span class="num" id="8130428">3</span><span class="op" id="8130429">]</span><span class="builtintype" id="8130430">byte</span><span class="op" id="8130434">{</span><span class="num" id="8130435">1</span><span class="op" id="8130436">,</span>&nbsp;<span class="num" id="8130438">2</span><span class="op" id="8130439">,</span>&nbsp;<span class="num" id="8130441">3</span><span class="op" id="8130442">}</span><span class="op" id="8130443">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8130446">var</span>&nbsp;<span class="ident" id="8130450">t5p</span>&nbsp;<span class="ident" id="8130454">Type5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8130461">if</span>&nbsp;<span class="ident" id="8130464">err</span>&nbsp;<span class="op" id="8130468">:=</span>&nbsp;<span class="ident" id="8130471">encAndDec</span><span class="op" id="8130480">(</span><span class="ident" id="8130481">t5</span><span class="op" id="8130483">,</span>&nbsp;<span class="op" id="8130485">&amp;</span><span class="ident" id="8130486">t5p</span><span class="op" id="8130489">)</span><span class="op" id="8130490">;</span>&nbsp;<span class="ident" id="8130492">err</span>&nbsp;<span class="op" id="8130496">!=</span>&nbsp;<span class="ident" id="8130499">nil</span>&nbsp;<span class="op" id="8130503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8130507">t</span><span class="op" id="8130508">.</span><span class="ident" id="8130509">Error</span><span class="op" id="8130514">(</span><span class="ident" id="8130515">err</span><span class="op" id="8130518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8130521">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8130524">var</span>&nbsp;<span class="ident" id="8130528">t6</span>&nbsp;<span class="ident" id="8130531">Type6</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8130538">if</span>&nbsp;<span class="ident" id="8130541">err</span>&nbsp;<span class="op" id="8130545">:=</span>&nbsp;<span class="ident" id="8130548">encAndDec</span><span class="op" id="8130557">(</span><span class="ident" id="8130558">t5</span><span class="op" id="8130560">,</span>&nbsp;<span class="op" id="8130562">&amp;</span><span class="ident" id="8130563">t6</span><span class="op" id="8130565">)</span><span class="op" id="8130566">;</span>&nbsp;<span class="ident" id="8130568">err</span>&nbsp;<span class="op" id="8130572">==</span>&nbsp;<span class="ident" id="8130575">nil</span>&nbsp;<span class="op" id="8130579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8130583">t</span><span class="op" id="8130584">.</span><span class="ident" id="8130585">Error</span><span class="op" id="8130590">(</span><span class="string" id="8130591">&#34;should&nbsp;fail&nbsp;with&nbsp;mismatched&nbsp;array&nbsp;sizes&#34;</span><span class="op" id="8130632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8130635">}</span><br>
<span class="lineno"></span><span class="op" id="8130637">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span><span class="keyword" id="8130640">func</span>&nbsp;<span class="ident" id="8130645">TestRecursiveMapType</span><span class="op" id="8130665">(</span><span class="ident" id="8130666">t</span>&nbsp;<span class="op" id="8130668">*</span><span class="ident" id="8130669">testing</span><span class="op" id="8130676">.</span><span class="ident" id="8130677">T</span><span class="op" id="8130678">)</span>&nbsp;<span class="op" id="8130680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8130683">type</span>&nbsp;<span class="ident" id="8130688">recursiveMap</span>&nbsp;<span class="keyword" id="8130701">map</span><span class="op" id="8130704">[</span><span class="builtintype" id="8130705">string</span><span class="op" id="8130711">]</span><span class="ident" id="8130712">recursiveMap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8130726">r1</span>&nbsp;<span class="op" id="8130729">:=</span>&nbsp;<span class="ident" id="8130732">recursiveMap</span><span class="op" id="8130744">{</span><span class="string" id="8130745">&#34;A&#34;</span><span class="op" id="8130748">:</span>&nbsp;<span class="ident" id="8130750">recursiveMap</span><span class="op" id="8130762">{</span><span class="string" id="8130763">&#34;B&#34;</span><span class="op" id="8130766">:</span>&nbsp;<span class="ident" id="8130768">nil</span><span class="op" id="8130771">,</span>&nbsp;<span class="string" id="8130773">&#34;C&#34;</span><span class="op" id="8130776">:</span>&nbsp;<span class="ident" id="8130778">nil</span><span class="op" id="8130781">}</span><span class="op" id="8130782">,</span>&nbsp;<span class="string" id="8130784">&#34;D&#34;</span><span class="op" id="8130787">:</span>&nbsp;<span class="ident" id="8130789">nil</span><span class="op" id="8130792">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8130795">r2</span>&nbsp;<span class="op" id="8130798">:=</span>&nbsp;<span class="builtinfunc" id="8130801">make</span><span class="op" id="8130805">(</span><span class="ident" id="8130806">recursiveMap</span><span class="op" id="8130818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8130821">if</span>&nbsp;<span class="ident" id="8130824">err</span>&nbsp;<span class="op" id="8130828">:=</span>&nbsp;<span class="ident" id="8130831">encAndDec</span><span class="op" id="8130840">(</span><span class="ident" id="8130841">r1</span><span class="op" id="8130843">,</span>&nbsp;<span class="op" id="8130845">&amp;</span><span class="ident" id="8130846">r2</span><span class="op" id="8130848">)</span><span class="op" id="8130849">;</span>&nbsp;<span class="ident" id="8130851">err</span>&nbsp;<span class="op" id="8130855">!=</span>&nbsp;<span class="ident" id="8130858">nil</span>&nbsp;<span class="op" id="8130862">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8130866">t</span><span class="op" id="8130867">.</span><span class="ident" id="8130868">Error</span><span class="op" id="8130873">(</span><span class="ident" id="8130874">err</span><span class="op" id="8130877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8130880">}</span><br>
<span class="lineno"></span><span class="op" id="8130882">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8130885">func</span>&nbsp;<span class="ident" id="8130890">TestRecursiveSliceType</span><span class="op" id="8130912">(</span><span class="ident" id="8130913">t</span>&nbsp;<span class="op" id="8130915">*</span><span class="ident" id="8130916">testing</span><span class="op" id="8130923">.</span><span class="ident" id="8130924">T</span><span class="op" id="8130925">)</span>&nbsp;<span class="op" id="8130927">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8130930">type</span>&nbsp;<span class="ident" id="8130935">recursiveSlice</span>&nbsp;<span class="op" id="8130950">[</span><span class="op" id="8130951">]</span><span class="ident" id="8130952">recursiveSlice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8130968">r1</span>&nbsp;<span class="op" id="8130971">:=</span>&nbsp;<span class="ident" id="8130974">recursiveSlice</span><span class="op" id="8130988">{</span><span class="num" id="8130989">0</span><span class="op" id="8130990">:</span>&nbsp;<span class="ident" id="8130992">recursiveSlice</span><span class="op" id="8131006">{</span><span class="num" id="8131007">0</span><span class="op" id="8131008">:</span>&nbsp;<span class="ident" id="8131010">nil</span><span class="op" id="8131013">}</span><span class="op" id="8131014">,</span>&nbsp;<span class="num" id="8131016">1</span><span class="op" id="8131017">:</span>&nbsp;<span class="ident" id="8131019">nil</span><span class="op" id="8131022">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8131025">r2</span>&nbsp;<span class="op" id="8131028">:=</span>&nbsp;<span class="builtinfunc" id="8131031">make</span><span class="op" id="8131035">(</span><span class="ident" id="8131036">recursiveSlice</span><span class="op" id="8131050">,</span>&nbsp;<span class="num" id="8131052">0</span><span class="op" id="8131053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8131056">if</span>&nbsp;<span class="ident" id="8131059">err</span>&nbsp;<span class="op" id="8131063">:=</span>&nbsp;<span class="ident" id="8131066">encAndDec</span><span class="op" id="8131075">(</span><span class="ident" id="8131076">r1</span><span class="op" id="8131078">,</span>&nbsp;<span class="op" id="8131080">&amp;</span><span class="ident" id="8131081">r2</span><span class="op" id="8131083">)</span><span class="op" id="8131084">;</span>&nbsp;<span class="ident" id="8131086">err</span>&nbsp;<span class="op" id="8131090">!=</span>&nbsp;<span class="ident" id="8131093">nil</span>&nbsp;<span class="op" id="8131097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8131101">t</span><span class="op" id="8131102">.</span><span class="ident" id="8131103">Error</span><span class="op" id="8131108">(</span><span class="ident" id="8131109">err</span><span class="op" id="8131112">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8131115">}</span><br>
<span class="lineno"></span><span class="op" id="8131117">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8131120">//&nbsp;Regression&nbsp;test&nbsp;for&nbsp;bug:&nbsp;must&nbsp;send&nbsp;zero&nbsp;values&nbsp;inside&nbsp;arrays</span><br>
<span class="lineno"></span><span class="keyword" id="8131184">func</span>&nbsp;<span class="ident" id="8131189">TestDefaultsInArray</span><span class="op" id="8131208">(</span><span class="ident" id="8131209">t</span>&nbsp;<span class="op" id="8131211">*</span><span class="ident" id="8131212">testing</span><span class="op" id="8131219">.</span><span class="ident" id="8131220">T</span><span class="op" id="8131221">)</span>&nbsp;<span class="op" id="8131223">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8131226">type</span>&nbsp;<span class="ident" id="8131231">Type7</span>&nbsp;<span class="keyword" id="8131237">struct</span>&nbsp;<span class="op" id="8131244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8131248">B</span>&nbsp;<span class="op" id="8131250">[</span><span class="op" id="8131251">]</span><span class="builtintype" id="8131252">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8131259">I</span>&nbsp;<span class="op" id="8131261">[</span><span class="op" id="8131262">]</span><span class="builtintype" id="8131263">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8131269">S</span>&nbsp;<span class="op" id="8131271">[</span><span class="op" id="8131272">]</span><span class="builtintype" id="8131273">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8131282">F</span>&nbsp;<span class="op" id="8131284">[</span><span class="op" id="8131285">]</span><span class="builtintype" id="8131286">float64</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8131295">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8131298">t7</span>&nbsp;<span class="op" id="8131301">:=</span>&nbsp;<span class="ident" id="8131304">Type7</span><span class="op" id="8131309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8131313">[</span><span class="op" id="8131314">]</span><span class="builtintype" id="8131315">bool</span><span class="op" id="8131319">{</span><span class="builtintype" id="8131320">false</span><span class="op" id="8131325">,</span>&nbsp;<span class="builtintype" id="8131327">false</span><span class="op" id="8131332">,</span>&nbsp;<span class="builtintype" id="8131334">true</span><span class="op" id="8131338">}</span><span class="op" id="8131339">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8131343">[</span><span class="op" id="8131344">]</span><span class="builtintype" id="8131345">int</span><span class="op" id="8131348">{</span><span class="num" id="8131349">0</span><span class="op" id="8131350">,</span>&nbsp;<span class="num" id="8131352">0</span><span class="op" id="8131353">,</span>&nbsp;<span class="num" id="8131355">1</span><span class="op" id="8131356">}</span><span class="op" id="8131357">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8131361">[</span><span class="op" id="8131362">]</span><span class="builtintype" id="8131363">string</span><span class="op" id="8131369">{</span><span class="string" id="8131370">&#34;hi&#34;</span><span class="op" id="8131374">,</span>&nbsp;<span class="string" id="8131376">&#34;&#34;</span><span class="op" id="8131378">,</span>&nbsp;<span class="string" id="8131380">&#34;there&#34;</span><span class="op" id="8131387">}</span><span class="op" id="8131388">,</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8131392">[</span><span class="op" id="8131393">]</span><span class="builtintype" id="8131394">float64</span><span class="op" id="8131401">{</span><span class="num" id="8131402">0</span><span class="op" id="8131403">,</span>&nbsp;<span class="num" id="8131405">0</span><span class="op" id="8131406">,</span>&nbsp;<span class="num" id="8131408">1</span><span class="op" id="8131409">}</span><span class="op" id="8131410">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8131413">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8131416">var</span>&nbsp;<span class="ident" id="8131420">t7p</span>&nbsp;<span class="ident" id="8131424">Type7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8131431">if</span>&nbsp;<span class="ident" id="8131434">err</span>&nbsp;<span class="op" id="8131438">:=</span>&nbsp;<span class="ident" id="8131441">encAndDec</span><span class="op" id="8131450">(</span><span class="ident" id="8131451">t7</span><span class="op" id="8131453">,</span>&nbsp;<span class="op" id="8131455">&amp;</span><span class="ident" id="8131456">t7p</span><span class="op" id="8131459">)</span><span class="op" id="8131460">;</span>&nbsp;<span class="ident" id="8131462">err</span>&nbsp;<span class="op" id="8131466">!=</span>&nbsp;<span class="ident" id="8131469">nil</span>&nbsp;<span class="op" id="8131473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8131477">t</span><span class="op" id="8131478">.</span><span class="ident" id="8131479">Error</span><span class="op" id="8131484">(</span><span class="ident" id="8131485">err</span><span class="op" id="8131488">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8131491">}</span><br>
<span class="lineno"></span><span class="op" id="8131493">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8131496">var</span>&nbsp;<span class="ident" id="8131500">testInt</span>&nbsp;<span class="builtintype" id="8131508">int</span><br>
<span class="lineno"></span><span class="keyword" id="8131512">var</span>&nbsp;<span class="ident" id="8131516">testFloat32</span>&nbsp;<span class="builtintype" id="8131528">float32</span><br>
<span class="lineno">365</span><span class="keyword" id="8131536">var</span>&nbsp;<span class="ident" id="8131540">testString</span>&nbsp;<span class="builtintype" id="8131551">string</span><br>
<span class="lineno"></span><span class="keyword" id="8131558">var</span>&nbsp;<span class="ident" id="8131562">testSlice</span>&nbsp;<span class="op" id="8131572">[</span><span class="op" id="8131573">]</span><span class="builtintype" id="8131574">string</span><br>
<span class="lineno"></span><span class="keyword" id="8131581">var</span>&nbsp;<span class="ident" id="8131585">testMap</span>&nbsp;<span class="keyword" id="8131593">map</span><span class="op" id="8131596">[</span><span class="builtintype" id="8131597">string</span><span class="op" id="8131603">]</span><span class="builtintype" id="8131604">int</span><br>
<span class="lineno"></span><span class="keyword" id="8131608">var</span>&nbsp;<span class="ident" id="8131612">testArray</span>&nbsp;<span class="op" id="8131622">[</span><span class="num" id="8131623">7</span><span class="op" id="8131624">]</span><span class="builtintype" id="8131625">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span><span class="keyword" id="8131630">type</span>&nbsp;<span class="ident" id="8131635">SingleTest</span>&nbsp;<span class="keyword" id="8131646">struct</span>&nbsp;<span class="op" id="8131653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8131656">in</span>&nbsp;&nbsp;<span class="keyword" id="8131660">interface</span><span class="op" id="8131669">{</span><span class="op" id="8131670">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8131673">out</span>&nbsp;<span class="keyword" id="8131677">interface</span><span class="op" id="8131686">{</span><span class="op" id="8131687">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8131690">err</span>&nbsp;<span class="builtintype" id="8131694">string</span><br>
<span class="lineno"></span><span class="op" id="8131701">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span><span class="keyword" id="8131704">var</span>&nbsp;<span class="ident" id="8131708">singleTests</span>&nbsp;<span class="op" id="8131720">=</span>&nbsp;<span class="op" id="8131722">[</span><span class="op" id="8131723">]</span><span class="ident" id="8131724">SingleTest</span><span class="op" id="8131734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8131737">{</span><span class="num" id="8131738">17</span><span class="op" id="8131740">,</span>&nbsp;<span class="op" id="8131742">&amp;</span><span class="ident" id="8131743">testInt</span><span class="op" id="8131750">,</span>&nbsp;<span class="string" id="8131752">&#34;&#34;</span><span class="op" id="8131754">}</span><span class="op" id="8131755">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8131758">{</span><span class="builtintype" id="8131759">float32</span><span class="op" id="8131766">(</span><span class="num" id="8131767">17.5</span><span class="op" id="8131771">)</span><span class="op" id="8131772">,</span>&nbsp;<span class="op" id="8131774">&amp;</span><span class="ident" id="8131775">testFloat32</span><span class="op" id="8131786">,</span>&nbsp;<span class="string" id="8131788">&#34;&#34;</span><span class="op" id="8131790">}</span><span class="op" id="8131791">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8131794">{</span><span class="string" id="8131795">&#34;bike&nbsp;shed&#34;</span><span class="op" id="8131806">,</span>&nbsp;<span class="op" id="8131808">&amp;</span><span class="ident" id="8131809">testString</span><span class="op" id="8131819">,</span>&nbsp;<span class="string" id="8131821">&#34;&#34;</span><span class="op" id="8131823">}</span><span class="op" id="8131824">,</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8131827">{</span><span class="op" id="8131828">[</span><span class="op" id="8131829">]</span><span class="builtintype" id="8131830">string</span><span class="op" id="8131836">{</span><span class="string" id="8131837">&#34;bike&#34;</span><span class="op" id="8131843">,</span>&nbsp;<span class="string" id="8131845">&#34;shed&#34;</span><span class="op" id="8131851">,</span>&nbsp;<span class="string" id="8131853">&#34;paint&#34;</span><span class="op" id="8131860">,</span>&nbsp;<span class="string" id="8131862">&#34;color&#34;</span><span class="op" id="8131869">}</span><span class="op" id="8131870">,</span>&nbsp;<span class="op" id="8131872">&amp;</span><span class="ident" id="8131873">testSlice</span><span class="op" id="8131882">,</span>&nbsp;<span class="string" id="8131884">&#34;&#34;</span><span class="op" id="8131886">}</span><span class="op" id="8131887">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8131890">{</span><span class="keyword" id="8131891">map</span><span class="op" id="8131894">[</span><span class="builtintype" id="8131895">string</span><span class="op" id="8131901">]</span><span class="builtintype" id="8131902">int</span><span class="op" id="8131905">{</span><span class="string" id="8131906">&#34;seven&#34;</span><span class="op" id="8131913">:</span>&nbsp;<span class="num" id="8131915">7</span><span class="op" id="8131916">,</span>&nbsp;<span class="string" id="8131918">&#34;twelve&#34;</span><span class="op" id="8131926">:</span>&nbsp;<span class="num" id="8131928">12</span><span class="op" id="8131930">}</span><span class="op" id="8131931">,</span>&nbsp;<span class="op" id="8131933">&amp;</span><span class="ident" id="8131934">testMap</span><span class="op" id="8131941">,</span>&nbsp;<span class="string" id="8131943">&#34;&#34;</span><span class="op" id="8131945">}</span><span class="op" id="8131946">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8131949">{</span><span class="op" id="8131950">[</span><span class="num" id="8131951">7</span><span class="op" id="8131952">]</span><span class="builtintype" id="8131953">int</span><span class="op" id="8131956">{</span><span class="num" id="8131957">4</span><span class="op" id="8131958">,</span>&nbsp;<span class="num" id="8131960">55</span><span class="op" id="8131962">,</span>&nbsp;<span class="num" id="8131964">0</span><span class="op" id="8131965">,</span>&nbsp;<span class="num" id="8131967">0</span><span class="op" id="8131968">,</span>&nbsp;<span class="num" id="8131970">0</span><span class="op" id="8131971">,</span>&nbsp;<span class="num" id="8131973">0</span><span class="op" id="8131974">,</span>&nbsp;<span class="num" id="8131976">0</span><span class="op" id="8131977">}</span><span class="op" id="8131978">,</span>&nbsp;<span class="op" id="8131980">&amp;</span><span class="ident" id="8131981">testArray</span><span class="op" id="8131990">,</span>&nbsp;<span class="string" id="8131992">&#34;&#34;</span><span class="op" id="8131994">}</span><span class="op" id="8131995">,</span>&nbsp;<span class="comment" id="8131997">//&nbsp;case&nbsp;that&nbsp;once&nbsp;triggered&nbsp;a&nbsp;bug</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8132032">{</span><span class="op" id="8132033">[</span><span class="num" id="8132034">7</span><span class="op" id="8132035">]</span><span class="builtintype" id="8132036">int</span><span class="op" id="8132039">{</span><span class="num" id="8132040">4</span><span class="op" id="8132041">,</span>&nbsp;<span class="num" id="8132043">55</span><span class="op" id="8132045">,</span>&nbsp;<span class="num" id="8132047">1</span><span class="op" id="8132048">,</span>&nbsp;<span class="num" id="8132050">44</span><span class="op" id="8132052">,</span>&nbsp;<span class="num" id="8132054">22</span><span class="op" id="8132056">,</span>&nbsp;<span class="num" id="8132058">66</span><span class="op" id="8132060">,</span>&nbsp;<span class="num" id="8132062">1234</span><span class="op" id="8132066">}</span><span class="op" id="8132067">,</span>&nbsp;<span class="op" id="8132069">&amp;</span><span class="ident" id="8132070">testArray</span><span class="op" id="8132079">,</span>&nbsp;<span class="string" id="8132081">&#34;&#34;</span><span class="op" id="8132083">}</span><span class="op" id="8132084">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8132088">//&nbsp;Decode&nbsp;errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8132106">{</span><span class="num" id="8132107">172</span><span class="op" id="8132110">,</span>&nbsp;<span class="op" id="8132112">&amp;</span><span class="ident" id="8132113">testFloat32</span><span class="op" id="8132124">,</span>&nbsp;<span class="string" id="8132126">&#34;type&#34;</span><span class="op" id="8132132">}</span><span class="op" id="8132133">,</span><br>
<span class="lineno"></span><span class="op" id="8132135">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8132138">func</span>&nbsp;<span class="ident" id="8132143">TestSingletons</span><span class="op" id="8132157">(</span><span class="ident" id="8132158">t</span>&nbsp;<span class="op" id="8132160">*</span><span class="ident" id="8132161">testing</span><span class="op" id="8132168">.</span><span class="ident" id="8132169">T</span><span class="op" id="8132170">)</span>&nbsp;<span class="op" id="8132172">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8132175">b</span>&nbsp;<span class="op" id="8132177">:=</span>&nbsp;<span class="builtinfunc" id="8132180">new</span><span class="op" id="8132183">(</span><span class="ident" id="8132184">bytes</span><span class="op" id="8132189">.</span><span class="ident" id="8132190">Buffer</span><span class="op" id="8132196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8132199">enc</span>&nbsp;<span class="op" id="8132203">:=</span>&nbsp;<span class="ident" id="8132206">NewEncoder</span><span class="op" id="8132216">(</span><span class="ident" id="8132217">b</span><span class="op" id="8132218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8132221">dec</span>&nbsp;<span class="op" id="8132225">:=</span>&nbsp;<span class="ident" id="8132228">NewDecoder</span><span class="op" id="8132238">(</span><span class="ident" id="8132239">b</span><span class="op" id="8132240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8132243">for</span>&nbsp;<span class="ident" id="8132247">_</span><span class="op" id="8132248">,</span>&nbsp;<span class="ident" id="8132250">test</span>&nbsp;<span class="op" id="8132255">:=</span>&nbsp;<span class="keyword" id="8132258">range</span>&nbsp;<span class="ident" id="8132264">singleTests</span>&nbsp;<span class="op" id="8132276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8132280">b</span><span class="op" id="8132281">.</span><span class="ident" id="8132282">Reset</span><span class="op" id="8132287">(</span><span class="op" id="8132288">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8132292">err</span>&nbsp;<span class="op" id="8132296">:=</span>&nbsp;<span class="ident" id="8132299">enc</span><span class="op" id="8132302">.</span><span class="ident" id="8132303">Encode</span><span class="op" id="8132309">(</span><span class="ident" id="8132310">test</span><span class="op" id="8132314">.</span><span class="ident" id="8132315">in</span><span class="op" id="8132317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8132321">if</span>&nbsp;<span class="ident" id="8132324">err</span>&nbsp;<span class="op" id="8132328">!=</span>&nbsp;<span class="ident" id="8132331">nil</span>&nbsp;<span class="op" id="8132335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8132340">t</span><span class="op" id="8132341">.</span><span class="ident" id="8132342">Errorf</span><span class="op" id="8132348">(</span><span class="string" id="8132349">&#34;error&nbsp;encoding&nbsp;%v:&nbsp;%s&#34;</span><span class="op" id="8132372">,</span>&nbsp;<span class="ident" id="8132374">test</span><span class="op" id="8132378">.</span><span class="ident" id="8132379">in</span><span class="op" id="8132381">,</span>&nbsp;<span class="ident" id="8132383">err</span><span class="op" id="8132386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8132391">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8132402">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8132406">err</span>&nbsp;<span class="op" id="8132410">=</span>&nbsp;<span class="ident" id="8132412">dec</span><span class="op" id="8132415">.</span><span class="ident" id="8132416">Decode</span><span class="op" id="8132422">(</span><span class="ident" id="8132423">test</span><span class="op" id="8132427">.</span><span class="ident" id="8132428">out</span><span class="op" id="8132431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8132435">switch</span>&nbsp;<span class="op" id="8132442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8132446">case</span>&nbsp;<span class="ident" id="8132451">err</span>&nbsp;<span class="op" id="8132455">!=</span>&nbsp;<span class="ident" id="8132458">nil</span>&nbsp;<span class="op" id="8132462">&amp;&amp;</span>&nbsp;<span class="ident" id="8132465">test</span><span class="op" id="8132469">.</span><span class="ident" id="8132470">err</span>&nbsp;<span class="op" id="8132474">==</span>&nbsp;<span class="string" id="8132477">&#34;&#34;</span><span class="op" id="8132479">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8132484">t</span><span class="op" id="8132485">.</span><span class="ident" id="8132486">Errorf</span><span class="op" id="8132492">(</span><span class="string" id="8132493">&#34;error&nbsp;decoding&nbsp;%v:&nbsp;%s&#34;</span><span class="op" id="8132516">,</span>&nbsp;<span class="ident" id="8132518">test</span><span class="op" id="8132522">.</span><span class="ident" id="8132523">in</span><span class="op" id="8132525">,</span>&nbsp;<span class="ident" id="8132527">err</span><span class="op" id="8132530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8132535">continue</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8132546">case</span>&nbsp;<span class="ident" id="8132551">err</span>&nbsp;<span class="op" id="8132555">==</span>&nbsp;<span class="ident" id="8132558">nil</span>&nbsp;<span class="op" id="8132562">&amp;&amp;</span>&nbsp;<span class="ident" id="8132565">test</span><span class="op" id="8132569">.</span><span class="ident" id="8132570">err</span>&nbsp;<span class="op" id="8132574">!=</span>&nbsp;<span class="string" id="8132577">&#34;&#34;</span><span class="op" id="8132579">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8132584">t</span><span class="op" id="8132585">.</span><span class="ident" id="8132586">Errorf</span><span class="op" id="8132592">(</span><span class="string" id="8132593">&#34;expected&nbsp;error&nbsp;decoding&nbsp;%v:&nbsp;%s&#34;</span><span class="op" id="8132625">,</span>&nbsp;<span class="ident" id="8132627">test</span><span class="op" id="8132631">.</span><span class="ident" id="8132632">in</span><span class="op" id="8132634">,</span>&nbsp;<span class="ident" id="8132636">test</span><span class="op" id="8132640">.</span><span class="ident" id="8132641">err</span><span class="op" id="8132644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8132649">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8132660">case</span>&nbsp;<span class="ident" id="8132665">err</span>&nbsp;<span class="op" id="8132669">!=</span>&nbsp;<span class="ident" id="8132672">nil</span>&nbsp;<span class="op" id="8132676">&amp;&amp;</span>&nbsp;<span class="ident" id="8132679">test</span><span class="op" id="8132683">.</span><span class="ident" id="8132684">err</span>&nbsp;<span class="op" id="8132688">!=</span>&nbsp;<span class="string" id="8132691">&#34;&#34;</span><span class="op" id="8132693">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8132698">if</span>&nbsp;<span class="ident" id="8132701">strings</span><span class="op" id="8132708">.</span><span class="ident" id="8132709">Index</span><span class="op" id="8132714">(</span><span class="ident" id="8132715">err</span><span class="op" id="8132718">.</span><span class="ident" id="8132719">Error</span><span class="op" id="8132724">(</span><span class="op" id="8132725">)</span><span class="op" id="8132726">,</span>&nbsp;<span class="ident" id="8132728">test</span><span class="op" id="8132732">.</span><span class="ident" id="8132733">err</span><span class="op" id="8132736">)</span>&nbsp;<span class="op" id="8132738">&lt;</span>&nbsp;<span class="num" id="8132740">0</span>&nbsp;<span class="op" id="8132742">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8132748">t</span><span class="op" id="8132749">.</span><span class="ident" id="8132750">Errorf</span><span class="op" id="8132756">(</span><span class="string" id="8132757">&#34;wrong&nbsp;error&nbsp;decoding&nbsp;%v:&nbsp;wanted&nbsp;%s,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8132801">,</span>&nbsp;<span class="ident" id="8132803">test</span><span class="op" id="8132807">.</span><span class="ident" id="8132808">in</span><span class="op" id="8132810">,</span>&nbsp;<span class="ident" id="8132812">test</span><span class="op" id="8132816">.</span><span class="ident" id="8132817">err</span><span class="op" id="8132820">,</span>&nbsp;<span class="ident" id="8132822">err</span><span class="op" id="8132825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8132830">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8132835">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8132846">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8132850">//&nbsp;Get&nbsp;rid&nbsp;of&nbsp;the&nbsp;pointer&nbsp;in&nbsp;the&nbsp;rhs</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8132889">val</span>&nbsp;<span class="op" id="8132893">:=</span>&nbsp;<span class="ident" id="8132896">reflect</span><span class="op" id="8132903">.</span><span class="ident" id="8132904">ValueOf</span><span class="op" id="8132911">(</span><span class="ident" id="8132912">test</span><span class="op" id="8132916">.</span><span class="ident" id="8132917">out</span><span class="op" id="8132920">)</span><span class="op" id="8132921">.</span><span class="ident" id="8132922">Elem</span><span class="op" id="8132926">(</span><span class="op" id="8132927">)</span><span class="op" id="8132928">.</span><span class="ident" id="8132929">Interface</span><span class="op" id="8132938">(</span><span class="op" id="8132939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8132943">if</span>&nbsp;<span class="op" id="8132946">!</span><span class="ident" id="8132947">reflect</span><span class="op" id="8132954">.</span><span class="ident" id="8132955">DeepEqual</span><span class="op" id="8132964">(</span><span class="ident" id="8132965">test</span><span class="op" id="8132969">.</span><span class="ident" id="8132970">in</span><span class="op" id="8132972">,</span>&nbsp;<span class="ident" id="8132974">val</span><span class="op" id="8132977">)</span>&nbsp;<span class="op" id="8132979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8132984">t</span><span class="op" id="8132985">.</span><span class="ident" id="8132986">Errorf</span><span class="op" id="8132992">(</span><span class="string" id="8132993">&#34;decoding&nbsp;singleton:&nbsp;expected&nbsp;%v&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8133033">,</span>&nbsp;<span class="ident" id="8133035">test</span><span class="op" id="8133039">.</span><span class="ident" id="8133040">in</span><span class="op" id="8133042">,</span>&nbsp;<span class="ident" id="8133044">val</span><span class="op" id="8133047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8133051">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8133054">}</span><br>
<span class="lineno">420</span><span class="op" id="8133056">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8133059">func</span>&nbsp;<span class="ident" id="8133064">TestStructNonStruct</span><span class="op" id="8133083">(</span><span class="ident" id="8133084">t</span>&nbsp;<span class="op" id="8133086">*</span><span class="ident" id="8133087">testing</span><span class="op" id="8133094">.</span><span class="ident" id="8133095">T</span><span class="op" id="8133096">)</span>&nbsp;<span class="op" id="8133098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8133101">type</span>&nbsp;<span class="ident" id="8133106">Struct</span>&nbsp;<span class="keyword" id="8133113">struct</span>&nbsp;<span class="op" id="8133120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8133124">A</span>&nbsp;<span class="builtintype" id="8133126">string</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8133134">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8133137">type</span>&nbsp;<span class="ident" id="8133142">NonStruct</span>&nbsp;<span class="builtintype" id="8133152">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8133160">s</span>&nbsp;<span class="op" id="8133162">:=</span>&nbsp;<span class="ident" id="8133165">Struct</span><span class="op" id="8133171">{</span><span class="string" id="8133172">&#34;hello&#34;</span><span class="op" id="8133179">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8133182">var</span>&nbsp;<span class="ident" id="8133186">sp</span>&nbsp;<span class="ident" id="8133189">Struct</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8133197">if</span>&nbsp;<span class="ident" id="8133200">err</span>&nbsp;<span class="op" id="8133204">:=</span>&nbsp;<span class="ident" id="8133207">encAndDec</span><span class="op" id="8133216">(</span><span class="ident" id="8133217">s</span><span class="op" id="8133218">,</span>&nbsp;<span class="op" id="8133220">&amp;</span><span class="ident" id="8133221">sp</span><span class="op" id="8133223">)</span><span class="op" id="8133224">;</span>&nbsp;<span class="ident" id="8133226">err</span>&nbsp;<span class="op" id="8133230">!=</span>&nbsp;<span class="ident" id="8133233">nil</span>&nbsp;<span class="op" id="8133237">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8133241">t</span><span class="op" id="8133242">.</span><span class="ident" id="8133243">Error</span><span class="op" id="8133248">(</span><span class="ident" id="8133249">err</span><span class="op" id="8133252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8133255">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8133258">var</span>&nbsp;<span class="ident" id="8133262">ns</span>&nbsp;<span class="ident" id="8133265">NonStruct</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8133276">if</span>&nbsp;<span class="ident" id="8133279">err</span>&nbsp;<span class="op" id="8133283">:=</span>&nbsp;<span class="ident" id="8133286">encAndDec</span><span class="op" id="8133295">(</span><span class="ident" id="8133296">s</span><span class="op" id="8133297">,</span>&nbsp;<span class="op" id="8133299">&amp;</span><span class="ident" id="8133300">ns</span><span class="op" id="8133302">)</span><span class="op" id="8133303">;</span>&nbsp;<span class="ident" id="8133305">err</span>&nbsp;<span class="op" id="8133309">==</span>&nbsp;<span class="ident" id="8133312">nil</span>&nbsp;<span class="op" id="8133316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8133320">t</span><span class="op" id="8133321">.</span><span class="ident" id="8133322">Error</span><span class="op" id="8133327">(</span><span class="string" id="8133328">&#34;should&nbsp;get&nbsp;error&nbsp;for&nbsp;struct/non-struct&#34;</span><span class="op" id="8133368">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8133371">}</span>&nbsp;<span class="keyword" id="8133373">else</span>&nbsp;<span class="keyword" id="8133378">if</span>&nbsp;<span class="ident" id="8133381">strings</span><span class="op" id="8133388">.</span><span class="ident" id="8133389">Index</span><span class="op" id="8133394">(</span><span class="ident" id="8133395">err</span><span class="op" id="8133398">.</span><span class="ident" id="8133399">Error</span><span class="op" id="8133404">(</span><span class="op" id="8133405">)</span><span class="op" id="8133406">,</span>&nbsp;<span class="string" id="8133408">&#34;type&#34;</span><span class="op" id="8133414">)</span>&nbsp;<span class="op" id="8133416">&lt;</span>&nbsp;<span class="num" id="8133418">0</span>&nbsp;<span class="op" id="8133420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8133424">t</span><span class="op" id="8133425">.</span><span class="ident" id="8133426">Error</span><span class="op" id="8133431">(</span><span class="string" id="8133432">&#34;for&nbsp;struct/non-struct&nbsp;expected&nbsp;type&nbsp;error;&nbsp;got&#34;</span><span class="op" id="8133480">,</span>&nbsp;<span class="ident" id="8133482">err</span><span class="op" id="8133485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8133488">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8133491">//&nbsp;Now&nbsp;try&nbsp;the&nbsp;other&nbsp;way</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8133517">var</span>&nbsp;<span class="ident" id="8133521">nsp</span>&nbsp;<span class="ident" id="8133525">NonStruct</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8133536">if</span>&nbsp;<span class="ident" id="8133539">err</span>&nbsp;<span class="op" id="8133543">:=</span>&nbsp;<span class="ident" id="8133546">encAndDec</span><span class="op" id="8133555">(</span><span class="ident" id="8133556">ns</span><span class="op" id="8133558">,</span>&nbsp;<span class="op" id="8133560">&amp;</span><span class="ident" id="8133561">nsp</span><span class="op" id="8133564">)</span><span class="op" id="8133565">;</span>&nbsp;<span class="ident" id="8133567">err</span>&nbsp;<span class="op" id="8133571">!=</span>&nbsp;<span class="ident" id="8133574">nil</span>&nbsp;<span class="op" id="8133578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8133582">t</span><span class="op" id="8133583">.</span><span class="ident" id="8133584">Error</span><span class="op" id="8133589">(</span><span class="ident" id="8133590">err</span><span class="op" id="8133593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8133596">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8133599">if</span>&nbsp;<span class="ident" id="8133602">err</span>&nbsp;<span class="op" id="8133606">:=</span>&nbsp;<span class="ident" id="8133609">encAndDec</span><span class="op" id="8133618">(</span><span class="ident" id="8133619">ns</span><span class="op" id="8133621">,</span>&nbsp;<span class="op" id="8133623">&amp;</span><span class="ident" id="8133624">s</span><span class="op" id="8133625">)</span><span class="op" id="8133626">;</span>&nbsp;<span class="ident" id="8133628">err</span>&nbsp;<span class="op" id="8133632">==</span>&nbsp;<span class="ident" id="8133635">nil</span>&nbsp;<span class="op" id="8133639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8133643">t</span><span class="op" id="8133644">.</span><span class="ident" id="8133645">Error</span><span class="op" id="8133650">(</span><span class="string" id="8133651">&#34;should&nbsp;get&nbsp;error&nbsp;for&nbsp;non-struct/struct&#34;</span><span class="op" id="8133691">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8133694">}</span>&nbsp;<span class="keyword" id="8133696">else</span>&nbsp;<span class="keyword" id="8133701">if</span>&nbsp;<span class="ident" id="8133704">strings</span><span class="op" id="8133711">.</span><span class="ident" id="8133712">Index</span><span class="op" id="8133717">(</span><span class="ident" id="8133718">err</span><span class="op" id="8133721">.</span><span class="ident" id="8133722">Error</span><span class="op" id="8133727">(</span><span class="op" id="8133728">)</span><span class="op" id="8133729">,</span>&nbsp;<span class="string" id="8133731">&#34;type&#34;</span><span class="op" id="8133737">)</span>&nbsp;<span class="op" id="8133739">&lt;</span>&nbsp;<span class="num" id="8133741">0</span>&nbsp;<span class="op" id="8133743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8133747">t</span><span class="op" id="8133748">.</span><span class="ident" id="8133749">Error</span><span class="op" id="8133754">(</span><span class="string" id="8133755">&#34;for&nbsp;non-struct/struct&nbsp;expected&nbsp;type&nbsp;error;&nbsp;got&#34;</span><span class="op" id="8133803">,</span>&nbsp;<span class="ident" id="8133805">err</span><span class="op" id="8133808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8133811">}</span><br>
<span class="lineno"></span><span class="op" id="8133813">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">450</span><span class="keyword" id="8133816">type</span>&nbsp;<span class="ident" id="8133821">interfaceIndirectTestI</span>&nbsp;<span class="keyword" id="8133844">interface</span>&nbsp;<span class="op" id="8133854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8133857">F</span><span class="op" id="8133858">(</span><span class="op" id="8133859">)</span>&nbsp;<span class="builtintype" id="8133861">bool</span><br>
<span class="lineno"></span><span class="op" id="8133866">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8133869">type</span>&nbsp;<span class="ident" id="8133874">interfaceIndirectTestT</span>&nbsp;<span class="keyword" id="8133897">struct</span><span class="op" id="8133903">{</span><span class="op" id="8133904">}</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span><span class="keyword" id="8133907">func</span>&nbsp;<span class="op" id="8133912">(</span><span class="ident" id="8133913">this</span>&nbsp;<span class="op" id="8133918">*</span><span class="ident" id="8133919">interfaceIndirectTestT</span><span class="op" id="8133941">)</span>&nbsp;<span class="ident" id="8133943">F</span><span class="op" id="8133944">(</span><span class="op" id="8133945">)</span>&nbsp;<span class="builtintype" id="8133947">bool</span>&nbsp;<span class="op" id="8133952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8133955">return</span>&nbsp;<span class="builtintype" id="8133962">true</span><br>
<span class="lineno"></span><span class="op" id="8133967">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">460</span><span class="comment" id="8133970">//&nbsp;A&nbsp;version&nbsp;of&nbsp;a&nbsp;bug&nbsp;reported&nbsp;on&nbsp;golang-nuts.&nbsp;&nbsp;Also&nbsp;tests&nbsp;top-level</span><br>
<span class="lineno"></span><span class="comment" id="8134039">//&nbsp;slice&nbsp;of&nbsp;interfaces.&nbsp;&nbsp;The&nbsp;issue&nbsp;was&nbsp;registering&nbsp;*T&nbsp;caused&nbsp;T&nbsp;to&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="8134108">//&nbsp;stored&nbsp;as&nbsp;the&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="8134140">func</span>&nbsp;<span class="ident" id="8134145">TestInterfaceIndirect</span><span class="op" id="8134166">(</span><span class="ident" id="8134167">t</span>&nbsp;<span class="op" id="8134169">*</span><span class="ident" id="8134170">testing</span><span class="op" id="8134177">.</span><span class="ident" id="8134178">T</span><span class="op" id="8134179">)</span>&nbsp;<span class="op" id="8134181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8134184">Register</span><span class="op" id="8134192">(</span><span class="op" id="8134193">&amp;</span><span class="ident" id="8134194">interfaceIndirectTestT</span><span class="op" id="8134216">{</span><span class="op" id="8134217">}</span><span class="op" id="8134218">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8134221">b</span>&nbsp;<span class="op" id="8134223">:=</span>&nbsp;<span class="builtinfunc" id="8134226">new</span><span class="op" id="8134229">(</span><span class="ident" id="8134230">bytes</span><span class="op" id="8134235">.</span><span class="ident" id="8134236">Buffer</span><span class="op" id="8134242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8134245">w</span>&nbsp;<span class="op" id="8134247">:=</span>&nbsp;<span class="op" id="8134250">[</span><span class="op" id="8134251">]</span><span class="ident" id="8134252">interfaceIndirectTestI</span><span class="op" id="8134274">{</span><span class="op" id="8134275">&amp;</span><span class="ident" id="8134276">interfaceIndirectTestT</span><span class="op" id="8134298">{</span><span class="op" id="8134299">}</span><span class="op" id="8134300">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8134303">err</span>&nbsp;<span class="op" id="8134307">:=</span>&nbsp;<span class="ident" id="8134310">NewEncoder</span><span class="op" id="8134320">(</span><span class="ident" id="8134321">b</span><span class="op" id="8134322">)</span><span class="op" id="8134323">.</span><span class="ident" id="8134324">Encode</span><span class="op" id="8134330">(</span><span class="ident" id="8134331">w</span><span class="op" id="8134332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8134335">if</span>&nbsp;<span class="ident" id="8134338">err</span>&nbsp;<span class="op" id="8134342">!=</span>&nbsp;<span class="ident" id="8134345">nil</span>&nbsp;<span class="op" id="8134349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8134353">t</span><span class="op" id="8134354">.</span><span class="ident" id="8134355">Fatal</span><span class="op" id="8134360">(</span><span class="string" id="8134361">&#34;encode&nbsp;error:&#34;</span><span class="op" id="8134376">,</span>&nbsp;<span class="ident" id="8134378">err</span><span class="op" id="8134381">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8134384">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8134388">var</span>&nbsp;<span class="ident" id="8134392">r</span>&nbsp;<span class="op" id="8134394">[</span><span class="op" id="8134395">]</span><span class="ident" id="8134396">interfaceIndirectTestI</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8134420">err</span>&nbsp;<span class="op" id="8134424">=</span>&nbsp;<span class="ident" id="8134426">NewDecoder</span><span class="op" id="8134436">(</span><span class="ident" id="8134437">b</span><span class="op" id="8134438">)</span><span class="op" id="8134439">.</span><span class="ident" id="8134440">Decode</span><span class="op" id="8134446">(</span><span class="op" id="8134447">&amp;</span><span class="ident" id="8134448">r</span><span class="op" id="8134449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8134452">if</span>&nbsp;<span class="ident" id="8134455">err</span>&nbsp;<span class="op" id="8134459">!=</span>&nbsp;<span class="ident" id="8134462">nil</span>&nbsp;<span class="op" id="8134466">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8134470">t</span><span class="op" id="8134471">.</span><span class="ident" id="8134472">Fatal</span><span class="op" id="8134477">(</span><span class="string" id="8134478">&#34;decode&nbsp;error:&#34;</span><span class="op" id="8134493">,</span>&nbsp;<span class="ident" id="8134495">err</span><span class="op" id="8134498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8134501">}</span><br>
<span class="lineno"></span><span class="op" id="8134503">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8134506">//&nbsp;Now&nbsp;follow&nbsp;various&nbsp;tests&nbsp;that&nbsp;decode&nbsp;into&nbsp;things&nbsp;that&nbsp;can&#39;t&nbsp;represent&nbsp;the</span><br>
<span class="lineno">480</span><span class="comment" id="8134583">//&nbsp;encoded&nbsp;value,&nbsp;all&nbsp;of&nbsp;which&nbsp;should&nbsp;be&nbsp;legal.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8134632">//&nbsp;Also,&nbsp;when&nbsp;the&nbsp;ignored&nbsp;object&nbsp;contains&nbsp;an&nbsp;interface&nbsp;value,&nbsp;it&nbsp;may&nbsp;define</span><br>
<span class="lineno"></span><span class="comment" id="8134708">//&nbsp;types.&nbsp;Make&nbsp;sure&nbsp;that&nbsp;skipping&nbsp;the&nbsp;value&nbsp;still&nbsp;defines&nbsp;the&nbsp;types&nbsp;by&nbsp;using</span><br>
<span class="lineno"></span><span class="comment" id="8134785">//&nbsp;the&nbsp;encoder/decoder&nbsp;pair&nbsp;to&nbsp;send&nbsp;a&nbsp;value&nbsp;afterwards.&nbsp;&nbsp;If&nbsp;an&nbsp;interface</span><br>
<span class="lineno">485</span><span class="comment" id="8134858">//&nbsp;is&nbsp;sent,&nbsp;its&nbsp;type&nbsp;in&nbsp;the&nbsp;test&nbsp;is&nbsp;always&nbsp;NewType0,&nbsp;so&nbsp;this&nbsp;checks&nbsp;that&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="8134935">//&nbsp;encoder&nbsp;and&nbsp;decoder&nbsp;don&#39;t&nbsp;skew&nbsp;with&nbsp;respect&nbsp;to&nbsp;type&nbsp;definitions.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8135004">type</span>&nbsp;<span class="ident" id="8135009">Struct0</span>&nbsp;<span class="keyword" id="8135017">struct</span>&nbsp;<span class="op" id="8135024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8135027">I</span>&nbsp;<span class="keyword" id="8135029">interface</span><span class="op" id="8135038">{</span><span class="op" id="8135039">}</span><br>
<span class="lineno">490</span><span class="op" id="8135041">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8135044">type</span>&nbsp;<span class="ident" id="8135049">NewType0</span>&nbsp;<span class="keyword" id="8135058">struct</span>&nbsp;<span class="op" id="8135065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8135068">S</span>&nbsp;<span class="builtintype" id="8135070">string</span><br>
<span class="lineno"></span><span class="op" id="8135077">}</span><br>
<span class="lineno">495</span><br>
<span class="lineno"></span><span class="keyword" id="8135080">type</span>&nbsp;<span class="ident" id="8135085">ignoreTest</span>&nbsp;<span class="keyword" id="8135096">struct</span>&nbsp;<span class="op" id="8135103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8135106">in</span><span class="op" id="8135108">,</span>&nbsp;<span class="ident" id="8135110">out</span>&nbsp;<span class="keyword" id="8135114">interface</span><span class="op" id="8135123">{</span><span class="op" id="8135124">}</span><br>
<span class="lineno"></span><span class="op" id="8135126">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">500</span><span class="keyword" id="8135129">var</span>&nbsp;<span class="ident" id="8135133">ignoreTests</span>&nbsp;<span class="op" id="8135145">=</span>&nbsp;<span class="op" id="8135147">[</span><span class="op" id="8135148">]</span><span class="ident" id="8135149">ignoreTest</span><span class="op" id="8135159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8135162">//&nbsp;Decode&nbsp;normal&nbsp;struct&nbsp;into&nbsp;an&nbsp;empty&nbsp;struct</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8135208">{</span><span class="op" id="8135209">&amp;</span><span class="keyword" id="8135210">struct</span><span class="op" id="8135216">{</span>&nbsp;<span class="ident" id="8135218">A</span>&nbsp;<span class="builtintype" id="8135220">int</span>&nbsp;<span class="op" id="8135224">}</span><span class="op" id="8135225">{</span><span class="num" id="8135226">23</span><span class="op" id="8135228">}</span><span class="op" id="8135229">,</span>&nbsp;<span class="op" id="8135231">&amp;</span><span class="keyword" id="8135232">struct</span><span class="op" id="8135238">{</span><span class="op" id="8135239">}</span><span class="op" id="8135240">{</span><span class="op" id="8135241">}</span><span class="op" id="8135242">}</span><span class="op" id="8135243">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8135246">//&nbsp;Decode&nbsp;normal&nbsp;struct&nbsp;into&nbsp;a&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8135283">{</span><span class="op" id="8135284">&amp;</span><span class="keyword" id="8135285">struct</span><span class="op" id="8135291">{</span>&nbsp;<span class="ident" id="8135293">A</span>&nbsp;<span class="builtintype" id="8135295">int</span>&nbsp;<span class="op" id="8135299">}</span><span class="op" id="8135300">{</span><span class="num" id="8135301">23</span><span class="op" id="8135303">}</span><span class="op" id="8135304">,</span>&nbsp;<span class="ident" id="8135306">nil</span><span class="op" id="8135309">}</span><span class="op" id="8135310">,</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8135313">//&nbsp;Decode&nbsp;singleton&nbsp;string&nbsp;into&nbsp;a&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8135353">{</span><span class="string" id="8135354">&#34;hello,&nbsp;world&#34;</span><span class="op" id="8135368">,</span>&nbsp;<span class="ident" id="8135370">nil</span><span class="op" id="8135373">}</span><span class="op" id="8135374">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8135377">//&nbsp;Decode&nbsp;singleton&nbsp;slice&nbsp;into&nbsp;a&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8135416">{</span><span class="op" id="8135417">[</span><span class="op" id="8135418">]</span><span class="builtintype" id="8135419">int</span><span class="op" id="8135422">{</span><span class="num" id="8135423">1</span><span class="op" id="8135424">,</span>&nbsp;<span class="num" id="8135426">2</span><span class="op" id="8135427">,</span>&nbsp;<span class="num" id="8135429">3</span><span class="op" id="8135430">,</span>&nbsp;<span class="num" id="8135432">4</span><span class="op" id="8135433">}</span><span class="op" id="8135434">,</span>&nbsp;<span class="ident" id="8135436">nil</span><span class="op" id="8135439">}</span><span class="op" id="8135440">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8135443">//&nbsp;Decode&nbsp;struct&nbsp;containing&nbsp;an&nbsp;interface&nbsp;into&nbsp;a&nbsp;nil.</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8135497">{</span><span class="op" id="8135498">&amp;</span><span class="ident" id="8135499">Struct0</span><span class="op" id="8135506">{</span><span class="op" id="8135507">&amp;</span><span class="ident" id="8135508">NewType0</span><span class="op" id="8135516">{</span><span class="string" id="8135517">&#34;value0&#34;</span><span class="op" id="8135525">}</span><span class="op" id="8135526">}</span><span class="op" id="8135527">,</span>&nbsp;<span class="ident" id="8135529">nil</span><span class="op" id="8135532">}</span><span class="op" id="8135533">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8135536">//&nbsp;Decode&nbsp;singleton&nbsp;slice&nbsp;of&nbsp;interfaces&nbsp;into&nbsp;a&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8135589">{</span><span class="op" id="8135590">[</span><span class="op" id="8135591">]</span><span class="keyword" id="8135592">interface</span><span class="op" id="8135601">{</span><span class="op" id="8135602">}</span><span class="op" id="8135603">{</span><span class="string" id="8135604">&#34;hi&#34;</span><span class="op" id="8135608">,</span>&nbsp;<span class="op" id="8135610">&amp;</span><span class="ident" id="8135611">NewType0</span><span class="op" id="8135619">{</span><span class="string" id="8135620">&#34;value1&#34;</span><span class="op" id="8135628">}</span><span class="op" id="8135629">,</span>&nbsp;<span class="num" id="8135631">23</span><span class="op" id="8135633">}</span><span class="op" id="8135634">,</span>&nbsp;<span class="ident" id="8135636">nil</span><span class="op" id="8135639">}</span><span class="op" id="8135640">,</span><br>
<span class="lineno"></span><span class="op" id="8135642">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span><span class="keyword" id="8135645">func</span>&nbsp;<span class="ident" id="8135650">TestDecodeIntoNothing</span><span class="op" id="8135671">(</span><span class="ident" id="8135672">t</span>&nbsp;<span class="op" id="8135674">*</span><span class="ident" id="8135675">testing</span><span class="op" id="8135682">.</span><span class="ident" id="8135683">T</span><span class="op" id="8135684">)</span>&nbsp;<span class="op" id="8135686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8135689">Register</span><span class="op" id="8135697">(</span><span class="builtinfunc" id="8135698">new</span><span class="op" id="8135701">(</span><span class="ident" id="8135702">NewType0</span><span class="op" id="8135710">)</span><span class="op" id="8135711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8135714">for</span>&nbsp;<span class="ident" id="8135718">i</span><span class="op" id="8135719">,</span>&nbsp;<span class="ident" id="8135721">test</span>&nbsp;<span class="op" id="8135726">:=</span>&nbsp;<span class="keyword" id="8135729">range</span>&nbsp;<span class="ident" id="8135735">ignoreTests</span>&nbsp;<span class="op" id="8135747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8135751">b</span>&nbsp;<span class="op" id="8135753">:=</span>&nbsp;<span class="builtinfunc" id="8135756">new</span><span class="op" id="8135759">(</span><span class="ident" id="8135760">bytes</span><span class="op" id="8135765">.</span><span class="ident" id="8135766">Buffer</span><span class="op" id="8135772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8135776">enc</span>&nbsp;<span class="op" id="8135780">:=</span>&nbsp;<span class="ident" id="8135783">NewEncoder</span><span class="op" id="8135793">(</span><span class="ident" id="8135794">b</span><span class="op" id="8135795">)</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8135799">err</span>&nbsp;<span class="op" id="8135803">:=</span>&nbsp;<span class="ident" id="8135806">enc</span><span class="op" id="8135809">.</span><span class="ident" id="8135810">Encode</span><span class="op" id="8135816">(</span><span class="ident" id="8135817">test</span><span class="op" id="8135821">.</span><span class="ident" id="8135822">in</span><span class="op" id="8135824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8135828">if</span>&nbsp;<span class="ident" id="8135831">err</span>&nbsp;<span class="op" id="8135835">!=</span>&nbsp;<span class="ident" id="8135838">nil</span>&nbsp;<span class="op" id="8135842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8135847">t</span><span class="op" id="8135848">.</span><span class="ident" id="8135849">Errorf</span><span class="op" id="8135855">(</span><span class="string" id="8135856">&#34;%d:&nbsp;encode&nbsp;error&nbsp;%s:&#34;</span><span class="op" id="8135878">,</span>&nbsp;<span class="ident" id="8135880">i</span><span class="op" id="8135881">,</span>&nbsp;<span class="ident" id="8135883">err</span><span class="op" id="8135886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8135891">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8135902">}</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8135906">dec</span>&nbsp;<span class="op" id="8135910">:=</span>&nbsp;<span class="ident" id="8135913">NewDecoder</span><span class="op" id="8135923">(</span><span class="ident" id="8135924">b</span><span class="op" id="8135925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8135929">err</span>&nbsp;<span class="op" id="8135933">=</span>&nbsp;<span class="ident" id="8135935">dec</span><span class="op" id="8135938">.</span><span class="ident" id="8135939">Decode</span><span class="op" id="8135945">(</span><span class="ident" id="8135946">test</span><span class="op" id="8135950">.</span><span class="ident" id="8135951">out</span><span class="op" id="8135954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8135958">if</span>&nbsp;<span class="ident" id="8135961">err</span>&nbsp;<span class="op" id="8135965">!=</span>&nbsp;<span class="ident" id="8135968">nil</span>&nbsp;<span class="op" id="8135972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8135977">t</span><span class="op" id="8135978">.</span><span class="ident" id="8135979">Errorf</span><span class="op" id="8135985">(</span><span class="string" id="8135986">&#34;%d:&nbsp;decode&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="8136008">,</span>&nbsp;<span class="ident" id="8136010">i</span><span class="op" id="8136011">,</span>&nbsp;<span class="ident" id="8136013">err</span><span class="op" id="8136016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8136021">continue</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8136032">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8136036">//&nbsp;Now&nbsp;see&nbsp;if&nbsp;the&nbsp;encoder&nbsp;and&nbsp;decoder&nbsp;are&nbsp;in&nbsp;a&nbsp;consistent&nbsp;state.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8136103">str</span>&nbsp;<span class="op" id="8136107">:=</span>&nbsp;<span class="ident" id="8136110">fmt</span><span class="op" id="8136113">.</span><span class="ident" id="8136114">Sprintf</span><span class="op" id="8136121">(</span><span class="string" id="8136122">&#34;Value&nbsp;%d&#34;</span><span class="op" id="8136132">,</span>&nbsp;<span class="ident" id="8136134">i</span><span class="op" id="8136135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8136139">err</span>&nbsp;<span class="op" id="8136143">=</span>&nbsp;<span class="ident" id="8136145">enc</span><span class="op" id="8136148">.</span><span class="ident" id="8136149">Encode</span><span class="op" id="8136155">(</span><span class="op" id="8136156">&amp;</span><span class="ident" id="8136157">NewType0</span><span class="op" id="8136165">{</span><span class="ident" id="8136166">str</span><span class="op" id="8136169">}</span><span class="op" id="8136170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8136174">if</span>&nbsp;<span class="ident" id="8136177">err</span>&nbsp;<span class="op" id="8136181">!=</span>&nbsp;<span class="ident" id="8136184">nil</span>&nbsp;<span class="op" id="8136188">{</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8136193">t</span><span class="op" id="8136194">.</span><span class="ident" id="8136195">Fatalf</span><span class="op" id="8136201">(</span><span class="string" id="8136202">&#34;%d:&nbsp;NewType0&nbsp;encode&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="8136233">,</span>&nbsp;<span class="ident" id="8136235">i</span><span class="op" id="8136236">,</span>&nbsp;<span class="ident" id="8136238">err</span><span class="op" id="8136241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8136245">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8136249">ns</span>&nbsp;<span class="op" id="8136252">:=</span>&nbsp;<span class="builtinfunc" id="8136255">new</span><span class="op" id="8136258">(</span><span class="ident" id="8136259">NewType0</span><span class="op" id="8136267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8136271">err</span>&nbsp;<span class="op" id="8136275">=</span>&nbsp;<span class="ident" id="8136277">dec</span><span class="op" id="8136280">.</span><span class="ident" id="8136281">Decode</span><span class="op" id="8136287">(</span><span class="ident" id="8136288">ns</span><span class="op" id="8136290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8136294">if</span>&nbsp;<span class="ident" id="8136297">err</span>&nbsp;<span class="op" id="8136301">!=</span>&nbsp;<span class="ident" id="8136304">nil</span>&nbsp;<span class="op" id="8136308">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8136313">t</span><span class="op" id="8136314">.</span><span class="ident" id="8136315">Fatalf</span><span class="op" id="8136321">(</span><span class="string" id="8136322">&#34;%d:&nbsp;NewType0&nbsp;decode&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="8136353">,</span>&nbsp;<span class="ident" id="8136355">i</span><span class="op" id="8136356">,</span>&nbsp;<span class="ident" id="8136358">err</span><span class="op" id="8136361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8136365">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8136369">if</span>&nbsp;<span class="ident" id="8136372">ns</span><span class="op" id="8136374">.</span><span class="ident" id="8136375">S</span>&nbsp;<span class="op" id="8136377">!=</span>&nbsp;<span class="ident" id="8136380">str</span>&nbsp;<span class="op" id="8136384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8136389">t</span><span class="op" id="8136390">.</span><span class="ident" id="8136391">Fatalf</span><span class="op" id="8136397">(</span><span class="string" id="8136398">&#34;%d:&nbsp;expected&nbsp;%q&nbsp;got&nbsp;%q&#34;</span><span class="op" id="8136422">,</span>&nbsp;<span class="ident" id="8136424">i</span><span class="op" id="8136425">,</span>&nbsp;<span class="ident" id="8136427">str</span><span class="op" id="8136430">,</span>&nbsp;<span class="ident" id="8136432">ns</span><span class="op" id="8136434">.</span><span class="ident" id="8136435">S</span><span class="op" id="8136436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8136440">}</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8136443">}</span><br>
<span class="lineno"></span><span class="op" id="8136445">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8136448">//&nbsp;Another&nbsp;bug&nbsp;from&nbsp;golang-nuts,&nbsp;involving&nbsp;nested&nbsp;interfaces.</span><br>
<span class="lineno"></span><span class="keyword" id="8136510">type</span>&nbsp;<span class="ident" id="8136515">Bug0Outer</span>&nbsp;<span class="keyword" id="8136525">struct</span>&nbsp;<span class="op" id="8136532">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8136535">Bug0Field</span>&nbsp;<span class="keyword" id="8136545">interface</span><span class="op" id="8136554">{</span><span class="op" id="8136555">}</span><br>
<span class="lineno"></span><span class="op" id="8136557">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8136560">type</span>&nbsp;<span class="ident" id="8136565">Bug0Inner</span>&nbsp;<span class="keyword" id="8136575">struct</span>&nbsp;<span class="op" id="8136582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8136585">A</span>&nbsp;<span class="builtintype" id="8136587">int</span><br>
<span class="lineno">555</span><span class="op" id="8136591">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8136594">func</span>&nbsp;<span class="ident" id="8136599">TestNestedInterfaces</span><span class="op" id="8136619">(</span><span class="ident" id="8136620">t</span>&nbsp;<span class="op" id="8136622">*</span><span class="ident" id="8136623">testing</span><span class="op" id="8136630">.</span><span class="ident" id="8136631">T</span><span class="op" id="8136632">)</span>&nbsp;<span class="op" id="8136634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8136637">var</span>&nbsp;<span class="ident" id="8136641">buf</span>&nbsp;<span class="ident" id="8136645">bytes</span><span class="op" id="8136650">.</span><span class="ident" id="8136651">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8136659">e</span>&nbsp;<span class="op" id="8136661">:=</span>&nbsp;<span class="ident" id="8136664">NewEncoder</span><span class="op" id="8136674">(</span><span class="op" id="8136675">&amp;</span><span class="ident" id="8136676">buf</span><span class="op" id="8136679">)</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8136682">d</span>&nbsp;<span class="op" id="8136684">:=</span>&nbsp;<span class="ident" id="8136687">NewDecoder</span><span class="op" id="8136697">(</span><span class="op" id="8136698">&amp;</span><span class="ident" id="8136699">buf</span><span class="op" id="8136702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8136705">Register</span><span class="op" id="8136713">(</span><span class="builtinfunc" id="8136714">new</span><span class="op" id="8136717">(</span><span class="ident" id="8136718">Bug0Outer</span><span class="op" id="8136727">)</span><span class="op" id="8136728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8136731">Register</span><span class="op" id="8136739">(</span><span class="builtinfunc" id="8136740">new</span><span class="op" id="8136743">(</span><span class="ident" id="8136744">Bug0Inner</span><span class="op" id="8136753">)</span><span class="op" id="8136754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8136757">f</span>&nbsp;<span class="op" id="8136759">:=</span>&nbsp;<span class="op" id="8136762">&amp;</span><span class="ident" id="8136763">Bug0Outer</span><span class="op" id="8136772">{</span><span class="op" id="8136773">&amp;</span><span class="ident" id="8136774">Bug0Outer</span><span class="op" id="8136783">{</span><span class="op" id="8136784">&amp;</span><span class="ident" id="8136785">Bug0Inner</span><span class="op" id="8136794">{</span><span class="num" id="8136795">7</span><span class="op" id="8136796">}</span><span class="op" id="8136797">}</span><span class="op" id="8136798">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8136801">var</span>&nbsp;<span class="ident" id="8136805">v</span>&nbsp;<span class="keyword" id="8136807">interface</span><span class="op" id="8136816">{</span><span class="op" id="8136817">}</span>&nbsp;<span class="op" id="8136819">=</span>&nbsp;<span class="ident" id="8136821">f</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8136824">err</span>&nbsp;<span class="op" id="8136828">:=</span>&nbsp;<span class="ident" id="8136831">e</span><span class="op" id="8136832">.</span><span class="ident" id="8136833">Encode</span><span class="op" id="8136839">(</span><span class="op" id="8136840">&amp;</span><span class="ident" id="8136841">v</span><span class="op" id="8136842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8136845">if</span>&nbsp;<span class="ident" id="8136848">err</span>&nbsp;<span class="op" id="8136852">!=</span>&nbsp;<span class="ident" id="8136855">nil</span>&nbsp;<span class="op" id="8136859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8136863">t</span><span class="op" id="8136864">.</span><span class="ident" id="8136865">Fatal</span><span class="op" id="8136870">(</span><span class="string" id="8136871">&#34;Encode:&#34;</span><span class="op" id="8136880">,</span>&nbsp;<span class="ident" id="8136882">err</span><span class="op" id="8136885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8136888">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8136891">err</span>&nbsp;<span class="op" id="8136895">=</span>&nbsp;<span class="ident" id="8136897">d</span><span class="op" id="8136898">.</span><span class="ident" id="8136899">Decode</span><span class="op" id="8136905">(</span><span class="op" id="8136906">&amp;</span><span class="ident" id="8136907">v</span><span class="op" id="8136908">)</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8136911">if</span>&nbsp;<span class="ident" id="8136914">err</span>&nbsp;<span class="op" id="8136918">!=</span>&nbsp;<span class="ident" id="8136921">nil</span>&nbsp;<span class="op" id="8136925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8136929">t</span><span class="op" id="8136930">.</span><span class="ident" id="8136931">Fatal</span><span class="op" id="8136936">(</span><span class="string" id="8136937">&#34;Decode:&#34;</span><span class="op" id="8136946">,</span>&nbsp;<span class="ident" id="8136948">err</span><span class="op" id="8136951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8136954">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8136957">//&nbsp;Make&nbsp;sure&nbsp;it&nbsp;decoded&nbsp;correctly.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8136993">outer1</span><span class="op" id="8136999">,</span>&nbsp;<span class="ident" id="8137001">ok</span>&nbsp;<span class="op" id="8137004">:=</span>&nbsp;<span class="ident" id="8137007">v</span><span class="op" id="8137008">.</span><span class="op" id="8137009">(</span><span class="op" id="8137010">*</span><span class="ident" id="8137011">Bug0Outer</span><span class="op" id="8137020">)</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8137023">if</span>&nbsp;<span class="op" id="8137026">!</span><span class="ident" id="8137027">ok</span>&nbsp;<span class="op" id="8137030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8137034">t</span><span class="op" id="8137035">.</span><span class="ident" id="8137036">Fatalf</span><span class="op" id="8137042">(</span><span class="string" id="8137043">&#34;v&nbsp;not&nbsp;Bug0Outer:&nbsp;%T&#34;</span><span class="op" id="8137064">,</span>&nbsp;<span class="ident" id="8137066">v</span><span class="op" id="8137067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8137070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8137073">outer2</span><span class="op" id="8137079">,</span>&nbsp;<span class="ident" id="8137081">ok</span>&nbsp;<span class="op" id="8137084">:=</span>&nbsp;<span class="ident" id="8137087">outer1</span><span class="op" id="8137093">.</span><span class="ident" id="8137094">Bug0Field</span><span class="op" id="8137103">.</span><span class="op" id="8137104">(</span><span class="op" id="8137105">*</span><span class="ident" id="8137106">Bug0Outer</span><span class="op" id="8137115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8137118">if</span>&nbsp;<span class="op" id="8137121">!</span><span class="ident" id="8137122">ok</span>&nbsp;<span class="op" id="8137125">{</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8137129">t</span><span class="op" id="8137130">.</span><span class="ident" id="8137131">Fatalf</span><span class="op" id="8137137">(</span><span class="string" id="8137138">&#34;v.Bug0Field&nbsp;not&nbsp;Bug0Outer:&nbsp;%T&#34;</span><span class="op" id="8137169">,</span>&nbsp;<span class="ident" id="8137171">outer1</span><span class="op" id="8137177">.</span><span class="ident" id="8137178">Bug0Field</span><span class="op" id="8137187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8137190">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8137193">inner</span><span class="op" id="8137198">,</span>&nbsp;<span class="ident" id="8137200">ok</span>&nbsp;<span class="op" id="8137203">:=</span>&nbsp;<span class="ident" id="8137206">outer2</span><span class="op" id="8137212">.</span><span class="ident" id="8137213">Bug0Field</span><span class="op" id="8137222">.</span><span class="op" id="8137223">(</span><span class="op" id="8137224">*</span><span class="ident" id="8137225">Bug0Inner</span><span class="op" id="8137234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8137237">if</span>&nbsp;<span class="op" id="8137240">!</span><span class="ident" id="8137241">ok</span>&nbsp;<span class="op" id="8137244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8137248">t</span><span class="op" id="8137249">.</span><span class="ident" id="8137250">Fatalf</span><span class="op" id="8137256">(</span><span class="string" id="8137257">&#34;v.Bug0Field.Bug0Field&nbsp;not&nbsp;Bug0Inner:&nbsp;%T&#34;</span><span class="op" id="8137298">,</span>&nbsp;<span class="ident" id="8137300">outer2</span><span class="op" id="8137306">.</span><span class="ident" id="8137307">Bug0Field</span><span class="op" id="8137316">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8137319">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8137322">if</span>&nbsp;<span class="ident" id="8137325">inner</span><span class="op" id="8137330">.</span><span class="ident" id="8137331">A</span>&nbsp;<span class="op" id="8137333">!=</span>&nbsp;<span class="num" id="8137336">7</span>&nbsp;<span class="op" id="8137338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8137342">t</span><span class="op" id="8137343">.</span><span class="ident" id="8137344">Fatalf</span><span class="op" id="8137350">(</span><span class="string" id="8137351">&#34;final&nbsp;value&nbsp;%d;&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="8137380">,</span>&nbsp;<span class="ident" id="8137382">inner</span><span class="op" id="8137387">.</span><span class="ident" id="8137388">A</span><span class="op" id="8137389">,</span>&nbsp;<span class="num" id="8137391">7</span><span class="op" id="8137392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8137395">}</span><br>
<span class="lineno"></span><span class="op" id="8137397">}</span><br>
<span class="lineno">590</span><br>
<span class="lineno"></span><span class="comment" id="8137400">//&nbsp;The&nbsp;bugs&nbsp;keep&nbsp;coming.&nbsp;We&nbsp;forgot&nbsp;to&nbsp;send&nbsp;map&nbsp;subtypes&nbsp;before&nbsp;the&nbsp;map.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8137473">type</span>&nbsp;<span class="ident" id="8137478">Bug1Elem</span>&nbsp;<span class="keyword" id="8137487">struct</span>&nbsp;<span class="op" id="8137494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8137497">Name</span>&nbsp;<span class="builtintype" id="8137502">string</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8137510">Id</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8137515">int</span><br>
<span class="lineno"></span><span class="op" id="8137519">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8137522">type</span>&nbsp;<span class="ident" id="8137527">Bug1StructMap</span>&nbsp;<span class="keyword" id="8137541">map</span><span class="op" id="8137544">[</span><span class="builtintype" id="8137545">string</span><span class="op" id="8137551">]</span><span class="ident" id="8137552">Bug1Elem</span><br>
<span class="lineno"></span><br>
<span class="lineno">600</span><span class="keyword" id="8137562">func</span>&nbsp;<span class="ident" id="8137567">bug1EncDec</span><span class="op" id="8137577">(</span><span class="ident" id="8137578">in</span>&nbsp;<span class="ident" id="8137581">Bug1StructMap</span><span class="op" id="8137594">,</span>&nbsp;<span class="ident" id="8137596">out</span>&nbsp;<span class="op" id="8137600">*</span><span class="ident" id="8137601">Bug1StructMap</span><span class="op" id="8137614">)</span>&nbsp;<span class="builtintype" id="8137616">error</span>&nbsp;<span class="op" id="8137622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8137625">return</span>&nbsp;<span class="ident" id="8137632">nil</span><br>
<span class="lineno"></span><span class="op" id="8137636">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8137639">func</span>&nbsp;<span class="ident" id="8137644">TestMapBug1</span><span class="op" id="8137655">(</span><span class="ident" id="8137656">t</span>&nbsp;<span class="op" id="8137658">*</span><span class="ident" id="8137659">testing</span><span class="op" id="8137666">.</span><span class="ident" id="8137667">T</span><span class="op" id="8137668">)</span>&nbsp;<span class="op" id="8137670">{</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8137673">in</span>&nbsp;<span class="op" id="8137676">:=</span>&nbsp;<span class="builtinfunc" id="8137679">make</span><span class="op" id="8137683">(</span><span class="ident" id="8137684">Bug1StructMap</span><span class="op" id="8137697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8137700">in</span><span class="op" id="8137702">[</span><span class="string" id="8137703">&#34;val1&#34;</span><span class="op" id="8137709">]</span>&nbsp;<span class="op" id="8137711">=</span>&nbsp;<span class="ident" id="8137713">Bug1Elem</span><span class="op" id="8137721">{</span><span class="string" id="8137722">&#34;elem1&#34;</span><span class="op" id="8137729">,</span>&nbsp;<span class="num" id="8137731">1</span><span class="op" id="8137732">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8137735">in</span><span class="op" id="8137737">[</span><span class="string" id="8137738">&#34;val2&#34;</span><span class="op" id="8137744">]</span>&nbsp;<span class="op" id="8137746">=</span>&nbsp;<span class="ident" id="8137748">Bug1Elem</span><span class="op" id="8137756">{</span><span class="string" id="8137757">&#34;elem2&#34;</span><span class="op" id="8137764">,</span>&nbsp;<span class="num" id="8137766">2</span><span class="op" id="8137767">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8137771">b</span>&nbsp;<span class="op" id="8137773">:=</span>&nbsp;<span class="builtinfunc" id="8137776">new</span><span class="op" id="8137779">(</span><span class="ident" id="8137780">bytes</span><span class="op" id="8137785">.</span><span class="ident" id="8137786">Buffer</span><span class="op" id="8137792">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8137795">enc</span>&nbsp;<span class="op" id="8137799">:=</span>&nbsp;<span class="ident" id="8137802">NewEncoder</span><span class="op" id="8137812">(</span><span class="ident" id="8137813">b</span><span class="op" id="8137814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8137817">err</span>&nbsp;<span class="op" id="8137821">:=</span>&nbsp;<span class="ident" id="8137824">enc</span><span class="op" id="8137827">.</span><span class="ident" id="8137828">Encode</span><span class="op" id="8137834">(</span><span class="ident" id="8137835">in</span><span class="op" id="8137837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8137840">if</span>&nbsp;<span class="ident" id="8137843">err</span>&nbsp;<span class="op" id="8137847">!=</span>&nbsp;<span class="ident" id="8137850">nil</span>&nbsp;<span class="op" id="8137854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8137858">t</span><span class="op" id="8137859">.</span><span class="ident" id="8137860">Fatal</span><span class="op" id="8137865">(</span><span class="string" id="8137866">&#34;encode:&#34;</span><span class="op" id="8137875">,</span>&nbsp;<span class="ident" id="8137877">err</span><span class="op" id="8137880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8137883">}</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8137886">dec</span>&nbsp;<span class="op" id="8137890">:=</span>&nbsp;<span class="ident" id="8137893">NewDecoder</span><span class="op" id="8137903">(</span><span class="ident" id="8137904">b</span><span class="op" id="8137905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8137908">out</span>&nbsp;<span class="op" id="8137912">:=</span>&nbsp;<span class="builtinfunc" id="8137915">make</span><span class="op" id="8137919">(</span><span class="ident" id="8137920">Bug1StructMap</span><span class="op" id="8137933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8137936">err</span>&nbsp;<span class="op" id="8137940">=</span>&nbsp;<span class="ident" id="8137942">dec</span><span class="op" id="8137945">.</span><span class="ident" id="8137946">Decode</span><span class="op" id="8137952">(</span><span class="op" id="8137953">&amp;</span><span class="ident" id="8137954">out</span><span class="op" id="8137957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8137960">if</span>&nbsp;<span class="ident" id="8137963">err</span>&nbsp;<span class="op" id="8137967">!=</span>&nbsp;<span class="ident" id="8137970">nil</span>&nbsp;<span class="op" id="8137974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8137978">t</span><span class="op" id="8137979">.</span><span class="ident" id="8137980">Fatal</span><span class="op" id="8137985">(</span><span class="string" id="8137986">&#34;decode:&#34;</span><span class="op" id="8137995">,</span>&nbsp;<span class="ident" id="8137997">err</span><span class="op" id="8138000">)</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8138003">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8138006">if</span>&nbsp;<span class="op" id="8138009">!</span><span class="ident" id="8138010">reflect</span><span class="op" id="8138017">.</span><span class="ident" id="8138018">DeepEqual</span><span class="op" id="8138027">(</span><span class="ident" id="8138028">in</span><span class="op" id="8138030">,</span>&nbsp;<span class="ident" id="8138032">out</span><span class="op" id="8138035">)</span>&nbsp;<span class="op" id="8138037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8138041">t</span><span class="op" id="8138042">.</span><span class="ident" id="8138043">Errorf</span><span class="op" id="8138049">(</span><span class="string" id="8138050">&#34;mismatch:&nbsp;%v&nbsp;%v&#34;</span><span class="op" id="8138067">,</span>&nbsp;<span class="ident" id="8138069">in</span><span class="op" id="8138071">,</span>&nbsp;<span class="ident" id="8138073">out</span><span class="op" id="8138076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8138079">}</span><br>
<span class="lineno"></span><span class="op" id="8138081">}</span><br>
<span class="lineno">625</span><br>
<span class="lineno"></span><span class="keyword" id="8138084">func</span>&nbsp;<span class="ident" id="8138089">TestGobMapInterfaceEncode</span><span class="op" id="8138114">(</span><span class="ident" id="8138115">t</span>&nbsp;<span class="op" id="8138117">*</span><span class="ident" id="8138118">testing</span><span class="op" id="8138125">.</span><span class="ident" id="8138126">T</span><span class="op" id="8138127">)</span>&nbsp;<span class="op" id="8138129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8138132">m</span>&nbsp;<span class="op" id="8138134">:=</span>&nbsp;<span class="keyword" id="8138137">map</span><span class="op" id="8138140">[</span><span class="builtintype" id="8138141">string</span><span class="op" id="8138147">]</span><span class="keyword" id="8138148">interface</span><span class="op" id="8138157">{</span><span class="op" id="8138158">}</span><span class="op" id="8138159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8138163">&#34;up&#34;</span><span class="op" id="8138167">:</span>&nbsp;<span class="builtintype" id="8138169">uintptr</span><span class="op" id="8138176">(</span><span class="num" id="8138177">0</span><span class="op" id="8138178">)</span><span class="op" id="8138179">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8138183">&#34;i0&#34;</span><span class="op" id="8138187">:</span>&nbsp;<span class="op" id="8138189">[</span><span class="op" id="8138190">]</span><span class="builtintype" id="8138191">int</span><span class="op" id="8138194">{</span><span class="op" id="8138195">-</span><span class="num" id="8138196">1</span><span class="op" id="8138197">}</span><span class="op" id="8138198">,</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8138202">&#34;i1&#34;</span><span class="op" id="8138206">:</span>&nbsp;<span class="op" id="8138208">[</span><span class="op" id="8138209">]</span><span class="builtintype" id="8138210">int8</span><span class="op" id="8138214">{</span><span class="op" id="8138215">-</span><span class="num" id="8138216">1</span><span class="op" id="8138217">}</span><span class="op" id="8138218">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8138222">&#34;i2&#34;</span><span class="op" id="8138226">:</span>&nbsp;<span class="op" id="8138228">[</span><span class="op" id="8138229">]</span><span class="builtintype" id="8138230">int16</span><span class="op" id="8138235">{</span><span class="op" id="8138236">-</span><span class="num" id="8138237">1</span><span class="op" id="8138238">}</span><span class="op" id="8138239">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8138243">&#34;i3&#34;</span><span class="op" id="8138247">:</span>&nbsp;<span class="op" id="8138249">[</span><span class="op" id="8138250">]</span><span class="builtintype" id="8138251">int32</span><span class="op" id="8138256">{</span><span class="op" id="8138257">-</span><span class="num" id="8138258">1</span><span class="op" id="8138259">}</span><span class="op" id="8138260">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8138264">&#34;i4&#34;</span><span class="op" id="8138268">:</span>&nbsp;<span class="op" id="8138270">[</span><span class="op" id="8138271">]</span><span class="ident" id="8138272">int64</span><span class="op" id="8138277">{</span><span class="op" id="8138278">-</span><span class="num" id="8138279">1</span><span class="op" id="8138280">}</span><span class="op" id="8138281">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8138285">&#34;u0&#34;</span><span class="op" id="8138289">:</span>&nbsp;<span class="op" id="8138291">[</span><span class="op" id="8138292">]</span><span class="builtintype" id="8138293">uint</span><span class="op" id="8138297">{</span><span class="num" id="8138298">1</span><span class="op" id="8138299">}</span><span class="op" id="8138300">,</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8138304">&#34;u1&#34;</span><span class="op" id="8138308">:</span>&nbsp;<span class="op" id="8138310">[</span><span class="op" id="8138311">]</span><span class="builtintype" id="8138312">uint8</span><span class="op" id="8138317">{</span><span class="num" id="8138318">1</span><span class="op" id="8138319">}</span><span class="op" id="8138320">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8138324">&#34;u2&#34;</span><span class="op" id="8138328">:</span>&nbsp;<span class="op" id="8138330">[</span><span class="op" id="8138331">]</span><span class="builtintype" id="8138332">uint16</span><span class="op" id="8138338">{</span><span class="num" id="8138339">1</span><span class="op" id="8138340">}</span><span class="op" id="8138341">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8138345">&#34;u3&#34;</span><span class="op" id="8138349">:</span>&nbsp;<span class="op" id="8138351">[</span><span class="op" id="8138352">]</span><span class="builtintype" id="8138353">uint32</span><span class="op" id="8138359">{</span><span class="num" id="8138360">1</span><span class="op" id="8138361">}</span><span class="op" id="8138362">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8138366">&#34;u4&#34;</span><span class="op" id="8138370">:</span>&nbsp;<span class="op" id="8138372">[</span><span class="op" id="8138373">]</span><span class="ident" id="8138374">uint64</span><span class="op" id="8138380">{</span><span class="num" id="8138381">1</span><span class="op" id="8138382">}</span><span class="op" id="8138383">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8138387">&#34;f0&#34;</span><span class="op" id="8138391">:</span>&nbsp;<span class="op" id="8138393">[</span><span class="op" id="8138394">]</span><span class="builtintype" id="8138395">float32</span><span class="op" id="8138402">{</span><span class="num" id="8138403">1</span><span class="op" id="8138404">}</span><span class="op" id="8138405">,</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8138409">&#34;f1&#34;</span><span class="op" id="8138413">:</span>&nbsp;<span class="op" id="8138415">[</span><span class="op" id="8138416">]</span><span class="builtintype" id="8138417">float64</span><span class="op" id="8138424">{</span><span class="num" id="8138425">1</span><span class="op" id="8138426">}</span><span class="op" id="8138427">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8138431">&#34;c0&#34;</span><span class="op" id="8138435">:</span>&nbsp;<span class="op" id="8138437">[</span><span class="op" id="8138438">]</span><span class="builtintype" id="8138439">complex64</span><span class="op" id="8138448">{</span><span class="builtinfunc" id="8138449">complex</span><span class="op" id="8138456">(</span><span class="num" id="8138457">2</span><span class="op" id="8138458">,</span>&nbsp;<span class="op" id="8138460">-</span><span class="num" id="8138461">2</span><span class="op" id="8138462">)</span><span class="op" id="8138463">}</span><span class="op" id="8138464">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8138468">&#34;c1&#34;</span><span class="op" id="8138472">:</span>&nbsp;<span class="op" id="8138474">[</span><span class="op" id="8138475">]</span><span class="builtintype" id="8138476">complex128</span><span class="op" id="8138486">{</span><span class="builtinfunc" id="8138487">complex</span><span class="op" id="8138494">(</span><span class="num" id="8138495">2</span><span class="op" id="8138496">,</span>&nbsp;<span class="builtintype" id="8138498">float64</span><span class="op" id="8138505">(</span><span class="op" id="8138506">-</span><span class="num" id="8138507">2</span><span class="op" id="8138508">)</span><span class="op" id="8138509">)</span><span class="op" id="8138510">}</span><span class="op" id="8138511">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8138515">&#34;us&#34;</span><span class="op" id="8138519">:</span>&nbsp;<span class="op" id="8138521">[</span><span class="op" id="8138522">]</span><span class="builtintype" id="8138523">uintptr</span><span class="op" id="8138530">{</span><span class="num" id="8138531">0</span><span class="op" id="8138532">}</span><span class="op" id="8138533">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8138537">&#34;bo&#34;</span><span class="op" id="8138541">:</span>&nbsp;<span class="op" id="8138543">[</span><span class="op" id="8138544">]</span><span class="builtintype" id="8138545">bool</span><span class="op" id="8138549">{</span><span class="builtintype" id="8138550">false</span><span class="op" id="8138555">}</span><span class="op" id="8138556">,</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8138560">&#34;st&#34;</span><span class="op" id="8138564">:</span>&nbsp;<span class="op" id="8138566">[</span><span class="op" id="8138567">]</span><span class="builtintype" id="8138568">string</span><span class="op" id="8138574">{</span><span class="string" id="8138575">&#34;s&#34;</span><span class="op" id="8138578">}</span><span class="op" id="8138579">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8138582">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8138585">enc</span>&nbsp;<span class="op" id="8138589">:=</span>&nbsp;<span class="ident" id="8138592">NewEncoder</span><span class="op" id="8138602">(</span><span class="builtinfunc" id="8138603">new</span><span class="op" id="8138606">(</span><span class="ident" id="8138607">bytes</span><span class="op" id="8138612">.</span><span class="ident" id="8138613">Buffer</span><span class="op" id="8138619">)</span><span class="op" id="8138620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8138623">err</span>&nbsp;<span class="op" id="8138627">:=</span>&nbsp;<span class="ident" id="8138630">enc</span><span class="op" id="8138633">.</span><span class="ident" id="8138634">Encode</span><span class="op" id="8138640">(</span><span class="ident" id="8138641">m</span><span class="op" id="8138642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8138645">if</span>&nbsp;<span class="ident" id="8138648">err</span>&nbsp;<span class="op" id="8138652">!=</span>&nbsp;<span class="ident" id="8138655">nil</span>&nbsp;<span class="op" id="8138659">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8138663">t</span><span class="op" id="8138664">.</span><span class="ident" id="8138665">Errorf</span><span class="op" id="8138671">(</span><span class="string" id="8138672">&#34;encode&nbsp;map:&nbsp;%s&#34;</span><span class="op" id="8138688">,</span>&nbsp;<span class="ident" id="8138690">err</span><span class="op" id="8138693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8138696">}</span><br>
<span class="lineno"></span><span class="op" id="8138698">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8138701">func</span>&nbsp;<span class="ident" id="8138706">TestSliceReusesMemory</span><span class="op" id="8138727">(</span><span class="ident" id="8138728">t</span>&nbsp;<span class="op" id="8138730">*</span><span class="ident" id="8138731">testing</span><span class="op" id="8138738">.</span><span class="ident" id="8138739">T</span><span class="op" id="8138740">)</span>&nbsp;<span class="op" id="8138742">{</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8138745">buf</span>&nbsp;<span class="op" id="8138749">:=</span>&nbsp;<span class="builtinfunc" id="8138752">new</span><span class="op" id="8138755">(</span><span class="ident" id="8138756">bytes</span><span class="op" id="8138761">.</span><span class="ident" id="8138762">Buffer</span><span class="op" id="8138768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8138771">//&nbsp;Bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8138781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8138785">x</span>&nbsp;<span class="op" id="8138787">:=</span>&nbsp;<span class="op" id="8138790">[</span><span class="op" id="8138791">]</span><span class="builtintype" id="8138792">byte</span><span class="op" id="8138796">(</span><span class="string" id="8138797">&#34;abcd&#34;</span><span class="op" id="8138803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8138807">enc</span>&nbsp;<span class="op" id="8138811">:=</span>&nbsp;<span class="ident" id="8138814">NewEncoder</span><span class="op" id="8138824">(</span><span class="ident" id="8138825">buf</span><span class="op" id="8138828">)</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8138832">err</span>&nbsp;<span class="op" id="8138836">:=</span>&nbsp;<span class="ident" id="8138839">enc</span><span class="op" id="8138842">.</span><span class="ident" id="8138843">Encode</span><span class="op" id="8138849">(</span><span class="ident" id="8138850">x</span><span class="op" id="8138851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8138855">if</span>&nbsp;<span class="ident" id="8138858">err</span>&nbsp;<span class="op" id="8138862">!=</span>&nbsp;<span class="ident" id="8138865">nil</span>&nbsp;<span class="op" id="8138869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8138874">t</span><span class="op" id="8138875">.</span><span class="ident" id="8138876">Errorf</span><span class="op" id="8138882">(</span><span class="string" id="8138883">&#34;bytes:&nbsp;encode:&nbsp;%s&#34;</span><span class="op" id="8138902">,</span>&nbsp;<span class="ident" id="8138904">err</span><span class="op" id="8138907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8138911">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8138915">//&nbsp;Decode&nbsp;into&nbsp;y,&nbsp;which&nbsp;is&nbsp;big&nbsp;enough.</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8138956">y</span>&nbsp;<span class="op" id="8138958">:=</span>&nbsp;<span class="op" id="8138961">[</span><span class="op" id="8138962">]</span><span class="builtintype" id="8138963">byte</span><span class="op" id="8138967">(</span><span class="string" id="8138968">&#34;ABCDE&#34;</span><span class="op" id="8138975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8138979">addr</span>&nbsp;<span class="op" id="8138984">:=</span>&nbsp;<span class="op" id="8138987">&amp;</span><span class="ident" id="8138988">y</span><span class="op" id="8138989">[</span><span class="num" id="8138990">0</span><span class="op" id="8138991">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8138995">dec</span>&nbsp;<span class="op" id="8138999">:=</span>&nbsp;<span class="ident" id="8139002">NewDecoder</span><span class="op" id="8139012">(</span><span class="ident" id="8139013">buf</span><span class="op" id="8139016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8139020">err</span>&nbsp;<span class="op" id="8139024">=</span>&nbsp;<span class="ident" id="8139026">dec</span><span class="op" id="8139029">.</span><span class="ident" id="8139030">Decode</span><span class="op" id="8139036">(</span><span class="op" id="8139037">&amp;</span><span class="ident" id="8139038">y</span><span class="op" id="8139039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8139043">if</span>&nbsp;<span class="ident" id="8139046">err</span>&nbsp;<span class="op" id="8139050">!=</span>&nbsp;<span class="ident" id="8139053">nil</span>&nbsp;<span class="op" id="8139057">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8139062">t</span><span class="op" id="8139063">.</span><span class="ident" id="8139064">Fatal</span><span class="op" id="8139069">(</span><span class="string" id="8139070">&#34;bytes:&nbsp;decode:&#34;</span><span class="op" id="8139086">,</span>&nbsp;<span class="ident" id="8139088">err</span><span class="op" id="8139091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8139095">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8139099">if</span>&nbsp;<span class="op" id="8139102">!</span><span class="ident" id="8139103">bytes</span><span class="op" id="8139108">.</span><span class="ident" id="8139109">Equal</span><span class="op" id="8139114">(</span><span class="ident" id="8139115">x</span><span class="op" id="8139116">,</span>&nbsp;<span class="ident" id="8139118">y</span><span class="op" id="8139119">)</span>&nbsp;<span class="op" id="8139121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8139126">t</span><span class="op" id="8139127">.</span><span class="ident" id="8139128">Errorf</span><span class="op" id="8139134">(</span><span class="string" id="8139135">&#34;bytes:&nbsp;expected&nbsp;%q&nbsp;got&nbsp;%q\n&#34;</span><span class="op" id="8139164">,</span>&nbsp;<span class="ident" id="8139166">x</span><span class="op" id="8139167">,</span>&nbsp;<span class="ident" id="8139169">y</span><span class="op" id="8139170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8139174">}</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8139178">if</span>&nbsp;<span class="ident" id="8139181">addr</span>&nbsp;<span class="op" id="8139186">!=</span>&nbsp;<span class="op" id="8139189">&amp;</span><span class="ident" id="8139190">y</span><span class="op" id="8139191">[</span><span class="num" id="8139192">0</span><span class="op" id="8139193">]</span>&nbsp;<span class="op" id="8139195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8139200">t</span><span class="op" id="8139201">.</span><span class="ident" id="8139202">Errorf</span><span class="op" id="8139208">(</span><span class="string" id="8139209">&#34;bytes:&nbsp;unnecessary&nbsp;reallocation&#34;</span><span class="op" id="8139242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8139246">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8139249">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8139252">//&nbsp;general&nbsp;slice</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8139270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8139274">x</span>&nbsp;<span class="op" id="8139276">:=</span>&nbsp;<span class="op" id="8139279">[</span><span class="op" id="8139280">]</span><span class="builtintype" id="8139281">rune</span><span class="op" id="8139285">(</span><span class="string" id="8139286">&#34;abcd&#34;</span><span class="op" id="8139292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8139296">enc</span>&nbsp;<span class="op" id="8139300">:=</span>&nbsp;<span class="ident" id="8139303">NewEncoder</span><span class="op" id="8139313">(</span><span class="ident" id="8139314">buf</span><span class="op" id="8139317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8139321">err</span>&nbsp;<span class="op" id="8139325">:=</span>&nbsp;<span class="ident" id="8139328">enc</span><span class="op" id="8139331">.</span><span class="ident" id="8139332">Encode</span><span class="op" id="8139338">(</span><span class="ident" id="8139339">x</span><span class="op" id="8139340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8139344">if</span>&nbsp;<span class="ident" id="8139347">err</span>&nbsp;<span class="op" id="8139351">!=</span>&nbsp;<span class="ident" id="8139354">nil</span>&nbsp;<span class="op" id="8139358">{</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8139363">t</span><span class="op" id="8139364">.</span><span class="ident" id="8139365">Errorf</span><span class="op" id="8139371">(</span><span class="string" id="8139372">&#34;ints:&nbsp;encode:&nbsp;%s&#34;</span><span class="op" id="8139390">,</span>&nbsp;<span class="ident" id="8139392">err</span><span class="op" id="8139395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8139399">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8139403">//&nbsp;Decode&nbsp;into&nbsp;y,&nbsp;which&nbsp;is&nbsp;big&nbsp;enough.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8139444">y</span>&nbsp;<span class="op" id="8139446">:=</span>&nbsp;<span class="op" id="8139449">[</span><span class="op" id="8139450">]</span><span class="builtintype" id="8139451">rune</span><span class="op" id="8139455">(</span><span class="string" id="8139456">&#34;ABCDE&#34;</span><span class="op" id="8139463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8139467">addr</span>&nbsp;<span class="op" id="8139472">:=</span>&nbsp;<span class="op" id="8139475">&amp;</span><span class="ident" id="8139476">y</span><span class="op" id="8139477">[</span><span class="num" id="8139478">0</span><span class="op" id="8139479">]</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8139483">dec</span>&nbsp;<span class="op" id="8139487">:=</span>&nbsp;<span class="ident" id="8139490">NewDecoder</span><span class="op" id="8139500">(</span><span class="ident" id="8139501">buf</span><span class="op" id="8139504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8139508">err</span>&nbsp;<span class="op" id="8139512">=</span>&nbsp;<span class="ident" id="8139514">dec</span><span class="op" id="8139517">.</span><span class="ident" id="8139518">Decode</span><span class="op" id="8139524">(</span><span class="op" id="8139525">&amp;</span><span class="ident" id="8139526">y</span><span class="op" id="8139527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8139531">if</span>&nbsp;<span class="ident" id="8139534">err</span>&nbsp;<span class="op" id="8139538">!=</span>&nbsp;<span class="ident" id="8139541">nil</span>&nbsp;<span class="op" id="8139545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8139550">t</span><span class="op" id="8139551">.</span><span class="ident" id="8139552">Fatal</span><span class="op" id="8139557">(</span><span class="string" id="8139558">&#34;ints:&nbsp;decode:&#34;</span><span class="op" id="8139573">,</span>&nbsp;<span class="ident" id="8139575">err</span><span class="op" id="8139578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8139582">}</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8139586">if</span>&nbsp;<span class="op" id="8139589">!</span><span class="ident" id="8139590">reflect</span><span class="op" id="8139597">.</span><span class="ident" id="8139598">DeepEqual</span><span class="op" id="8139607">(</span><span class="ident" id="8139608">x</span><span class="op" id="8139609">,</span>&nbsp;<span class="ident" id="8139611">y</span><span class="op" id="8139612">)</span>&nbsp;<span class="op" id="8139614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8139619">t</span><span class="op" id="8139620">.</span><span class="ident" id="8139621">Errorf</span><span class="op" id="8139627">(</span><span class="string" id="8139628">&#34;ints:&nbsp;expected&nbsp;%q&nbsp;got&nbsp;%q\n&#34;</span><span class="op" id="8139656">,</span>&nbsp;<span class="ident" id="8139658">x</span><span class="op" id="8139659">,</span>&nbsp;<span class="ident" id="8139661">y</span><span class="op" id="8139662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8139666">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8139670">if</span>&nbsp;<span class="ident" id="8139673">addr</span>&nbsp;<span class="op" id="8139678">!=</span>&nbsp;<span class="op" id="8139681">&amp;</span><span class="ident" id="8139682">y</span><span class="op" id="8139683">[</span><span class="num" id="8139684">0</span><span class="op" id="8139685">]</span>&nbsp;<span class="op" id="8139687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8139692">t</span><span class="op" id="8139693">.</span><span class="ident" id="8139694">Errorf</span><span class="op" id="8139700">(</span><span class="string" id="8139701">&#34;ints:&nbsp;unnecessary&nbsp;reallocation&#34;</span><span class="op" id="8139733">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8139737">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8139740">}</span><br>
<span class="lineno"></span><span class="op" id="8139742">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8139745">//&nbsp;Used&nbsp;to&nbsp;crash:&nbsp;negative&nbsp;count&nbsp;in&nbsp;recvMessage.</span><br>
<span class="lineno">705</span><span class="keyword" id="8139794">func</span>&nbsp;<span class="ident" id="8139799">TestBadCount</span><span class="op" id="8139811">(</span><span class="ident" id="8139812">t</span>&nbsp;<span class="op" id="8139814">*</span><span class="ident" id="8139815">testing</span><span class="op" id="8139822">.</span><span class="ident" id="8139823">T</span><span class="op" id="8139824">)</span>&nbsp;<span class="op" id="8139826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8139829">b</span>&nbsp;<span class="op" id="8139831">:=</span>&nbsp;<span class="op" id="8139834">[</span><span class="op" id="8139835">]</span><span class="builtintype" id="8139836">byte</span><span class="op" id="8139840">{</span><span class="num" id="8139841">0xfb</span><span class="op" id="8139845">,</span>&nbsp;<span class="num" id="8139847">0xa5</span><span class="op" id="8139851">,</span>&nbsp;<span class="num" id="8139853">0x82</span><span class="op" id="8139857">,</span>&nbsp;<span class="num" id="8139859">0x2f</span><span class="op" id="8139863">,</span>&nbsp;<span class="num" id="8139865">0xca</span><span class="op" id="8139869">,</span>&nbsp;<span class="num" id="8139871">0x1</span><span class="op" id="8139874">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8139877">if</span>&nbsp;<span class="ident" id="8139880">err</span>&nbsp;<span class="op" id="8139884">:=</span>&nbsp;<span class="ident" id="8139887">NewDecoder</span><span class="op" id="8139897">(</span><span class="ident" id="8139898">bytes</span><span class="op" id="8139903">.</span><span class="ident" id="8139904">NewReader</span><span class="op" id="8139913">(</span><span class="ident" id="8139914">b</span><span class="op" id="8139915">)</span><span class="op" id="8139916">)</span><span class="op" id="8139917">.</span><span class="ident" id="8139918">Decode</span><span class="op" id="8139924">(</span><span class="ident" id="8139925">nil</span><span class="op" id="8139928">)</span><span class="op" id="8139929">;</span>&nbsp;<span class="ident" id="8139931">err</span>&nbsp;<span class="op" id="8139935">==</span>&nbsp;<span class="ident" id="8139938">nil</span>&nbsp;<span class="op" id="8139942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8139946">t</span><span class="op" id="8139947">.</span><span class="ident" id="8139948">Error</span><span class="op" id="8139953">(</span><span class="string" id="8139954">&#34;expected&nbsp;error&nbsp;from&nbsp;bad&nbsp;count&#34;</span><span class="op" id="8139985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8139988">}</span>&nbsp;<span class="keyword" id="8139990">else</span>&nbsp;<span class="keyword" id="8139995">if</span>&nbsp;<span class="ident" id="8139998">err</span><span class="op" id="8140001">.</span><span class="ident" id="8140002">Error</span><span class="op" id="8140007">(</span><span class="op" id="8140008">)</span>&nbsp;<span class="op" id="8140010">!=</span>&nbsp;<span class="ident" id="8140013">errBadCount</span><span class="op" id="8140024">.</span><span class="ident" id="8140025">Error</span><span class="op" id="8140030">(</span><span class="op" id="8140031">)</span>&nbsp;<span class="op" id="8140033">{</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8140037">t</span><span class="op" id="8140038">.</span><span class="ident" id="8140039">Error</span><span class="op" id="8140044">(</span><span class="string" id="8140045">&#34;expected&nbsp;bad&nbsp;count&nbsp;error;&nbsp;got&#34;</span><span class="op" id="8140076">,</span>&nbsp;<span class="ident" id="8140078">err</span><span class="op" id="8140081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8140084">}</span><br>
<span class="lineno"></span><span class="op" id="8140086">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8140089">//&nbsp;Verify&nbsp;that&nbsp;sequential&nbsp;Decoders&nbsp;built&nbsp;on&nbsp;a&nbsp;single&nbsp;input&nbsp;will</span><br>
<span class="lineno">715</span><span class="comment" id="8140153">//&nbsp;succeed&nbsp;if&nbsp;the&nbsp;input&nbsp;implements&nbsp;ReadByte&nbsp;and&nbsp;there&nbsp;is&nbsp;no</span><br>
<span class="lineno"></span><span class="comment" id="8140213">//&nbsp;type&nbsp;information&nbsp;in&nbsp;the&nbsp;stream.</span><br>
<span class="lineno"></span><span class="keyword" id="8140248">func</span>&nbsp;<span class="ident" id="8140253">TestSequentialDecoder</span><span class="op" id="8140274">(</span><span class="ident" id="8140275">t</span>&nbsp;<span class="op" id="8140277">*</span><span class="ident" id="8140278">testing</span><span class="op" id="8140285">.</span><span class="ident" id="8140286">T</span><span class="op" id="8140287">)</span>&nbsp;<span class="op" id="8140289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8140292">b</span>&nbsp;<span class="op" id="8140294">:=</span>&nbsp;<span class="builtinfunc" id="8140297">new</span><span class="op" id="8140300">(</span><span class="ident" id="8140301">bytes</span><span class="op" id="8140306">.</span><span class="ident" id="8140307">Buffer</span><span class="op" id="8140313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8140316">enc</span>&nbsp;<span class="op" id="8140320">:=</span>&nbsp;<span class="ident" id="8140323">NewEncoder</span><span class="op" id="8140333">(</span><span class="ident" id="8140334">b</span><span class="op" id="8140335">)</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8140338">const</span>&nbsp;<span class="ident" id="8140344">count</span>&nbsp;<span class="op" id="8140350">=</span>&nbsp;<span class="num" id="8140352">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8140356">for</span>&nbsp;<span class="ident" id="8140360">i</span>&nbsp;<span class="op" id="8140362">:=</span>&nbsp;<span class="num" id="8140365">0</span><span class="op" id="8140366">;</span>&nbsp;<span class="ident" id="8140368">i</span>&nbsp;<span class="op" id="8140370">&lt;</span>&nbsp;<span class="ident" id="8140372">count</span><span class="op" id="8140377">;</span>&nbsp;<span class="ident" id="8140379">i</span><span class="op" id="8140380">++</span>&nbsp;<span class="op" id="8140383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8140387">s</span>&nbsp;<span class="op" id="8140389">:=</span>&nbsp;<span class="ident" id="8140392">fmt</span><span class="op" id="8140395">.</span><span class="ident" id="8140396">Sprintf</span><span class="op" id="8140403">(</span><span class="string" id="8140404">&#34;%d&#34;</span><span class="op" id="8140408">,</span>&nbsp;<span class="ident" id="8140410">i</span><span class="op" id="8140411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8140415">if</span>&nbsp;<span class="ident" id="8140418">err</span>&nbsp;<span class="op" id="8140422">:=</span>&nbsp;<span class="ident" id="8140425">enc</span><span class="op" id="8140428">.</span><span class="ident" id="8140429">Encode</span><span class="op" id="8140435">(</span><span class="ident" id="8140436">s</span><span class="op" id="8140437">)</span><span class="op" id="8140438">;</span>&nbsp;<span class="ident" id="8140440">err</span>&nbsp;<span class="op" id="8140444">!=</span>&nbsp;<span class="ident" id="8140447">nil</span>&nbsp;<span class="op" id="8140451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8140456">t</span><span class="op" id="8140457">.</span><span class="ident" id="8140458">Error</span><span class="op" id="8140463">(</span><span class="string" id="8140464">&#34;encoder&nbsp;fail:&#34;</span><span class="op" id="8140479">,</span>&nbsp;<span class="ident" id="8140481">err</span><span class="op" id="8140484">)</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8140488">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8140491">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8140494">for</span>&nbsp;<span class="ident" id="8140498">i</span>&nbsp;<span class="op" id="8140500">:=</span>&nbsp;<span class="num" id="8140503">0</span><span class="op" id="8140504">;</span>&nbsp;<span class="ident" id="8140506">i</span>&nbsp;<span class="op" id="8140508">&lt;</span>&nbsp;<span class="ident" id="8140510">count</span><span class="op" id="8140515">;</span>&nbsp;<span class="ident" id="8140517">i</span><span class="op" id="8140518">++</span>&nbsp;<span class="op" id="8140521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8140525">dec</span>&nbsp;<span class="op" id="8140529">:=</span>&nbsp;<span class="ident" id="8140532">NewDecoder</span><span class="op" id="8140542">(</span><span class="ident" id="8140543">b</span><span class="op" id="8140544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8140548">var</span>&nbsp;<span class="ident" id="8140552">s</span>&nbsp;<span class="builtintype" id="8140554">string</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8140563">if</span>&nbsp;<span class="ident" id="8140566">err</span>&nbsp;<span class="op" id="8140570">:=</span>&nbsp;<span class="ident" id="8140573">dec</span><span class="op" id="8140576">.</span><span class="ident" id="8140577">Decode</span><span class="op" id="8140583">(</span><span class="op" id="8140584">&amp;</span><span class="ident" id="8140585">s</span><span class="op" id="8140586">)</span><span class="op" id="8140587">;</span>&nbsp;<span class="ident" id="8140589">err</span>&nbsp;<span class="op" id="8140593">!=</span>&nbsp;<span class="ident" id="8140596">nil</span>&nbsp;<span class="op" id="8140600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8140605">t</span><span class="op" id="8140606">.</span><span class="ident" id="8140607">Fatal</span><span class="op" id="8140612">(</span><span class="string" id="8140613">&#34;decoder&nbsp;fail:&#34;</span><span class="op" id="8140628">,</span>&nbsp;<span class="ident" id="8140630">err</span><span class="op" id="8140633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8140637">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8140641">if</span>&nbsp;<span class="ident" id="8140644">s</span>&nbsp;<span class="op" id="8140646">!=</span>&nbsp;<span class="ident" id="8140649">fmt</span><span class="op" id="8140652">.</span><span class="ident" id="8140653">Sprintf</span><span class="op" id="8140660">(</span><span class="string" id="8140661">&#34;%d&#34;</span><span class="op" id="8140665">,</span>&nbsp;<span class="ident" id="8140667">i</span><span class="op" id="8140668">)</span>&nbsp;<span class="op" id="8140670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8140675">t</span><span class="op" id="8140676">.</span><span class="ident" id="8140677">Fatalf</span><span class="op" id="8140683">(</span><span class="string" id="8140684">&#34;decode&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%s&#34;</span><span class="op" id="8140711">,</span>&nbsp;<span class="ident" id="8140713">i</span><span class="op" id="8140714">,</span>&nbsp;<span class="ident" id="8140716">s</span><span class="op" id="8140717">)</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8140721">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8140724">}</span><br>
<span class="lineno"></span><span class="op" id="8140726">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8140729">//&nbsp;Should&nbsp;be&nbsp;able&nbsp;to&nbsp;have&nbsp;unrepresentable&nbsp;fields&nbsp;(chan,&nbsp;func,&nbsp;*chan&nbsp;etc.);&nbsp;we&nbsp;just&nbsp;ignore&nbsp;them.</span><br>
<span class="lineno">740</span><span class="keyword" id="8140825">type</span>&nbsp;<span class="ident" id="8140830">Bug2</span>&nbsp;<span class="keyword" id="8140835">struct</span>&nbsp;<span class="op" id="8140842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8140845">A</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8140849">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8140854">C</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="8140858">chan</span>&nbsp;<span class="builtintype" id="8140863">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8140868">CP</span>&nbsp;&nbsp;<span class="op" id="8140872">*</span><span class="keyword" id="8140873">chan</span>&nbsp;<span class="builtintype" id="8140878">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8140883">F</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="8140887">func</span><span class="op" id="8140891">(</span><span class="op" id="8140892">)</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8140895">FPP</span>&nbsp;<span class="op" id="8140899">*</span><span class="op" id="8140900">*</span><span class="keyword" id="8140901">func</span><span class="op" id="8140905">(</span><span class="op" id="8140906">)</span><br>
<span class="lineno"></span><span class="op" id="8140908">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8140911">func</span>&nbsp;<span class="ident" id="8140916">TestChanFuncIgnored</span><span class="op" id="8140935">(</span><span class="ident" id="8140936">t</span>&nbsp;<span class="op" id="8140938">*</span><span class="ident" id="8140939">testing</span><span class="op" id="8140946">.</span><span class="ident" id="8140947">T</span><span class="op" id="8140948">)</span>&nbsp;<span class="op" id="8140950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8140953">c</span>&nbsp;<span class="op" id="8140955">:=</span>&nbsp;<span class="builtinfunc" id="8140958">make</span><span class="op" id="8140962">(</span><span class="keyword" id="8140963">chan</span>&nbsp;<span class="builtintype" id="8140968">int</span><span class="op" id="8140971">)</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8140974">f</span>&nbsp;<span class="op" id="8140976">:=</span>&nbsp;<span class="keyword" id="8140979">func</span><span class="op" id="8140983">(</span><span class="op" id="8140984">)</span>&nbsp;<span class="op" id="8140986">{</span><span class="op" id="8140987">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8140990">fp</span>&nbsp;<span class="op" id="8140993">:=</span>&nbsp;<span class="op" id="8140996">&amp;</span><span class="ident" id="8140997">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8141000">b0</span>&nbsp;<span class="op" id="8141003">:=</span>&nbsp;<span class="ident" id="8141006">Bug2</span><span class="op" id="8141010">{</span><span class="num" id="8141011">23</span><span class="op" id="8141013">,</span>&nbsp;<span class="ident" id="8141015">c</span><span class="op" id="8141016">,</span>&nbsp;<span class="op" id="8141018">&amp;</span><span class="ident" id="8141019">c</span><span class="op" id="8141020">,</span>&nbsp;<span class="ident" id="8141022">f</span><span class="op" id="8141023">,</span>&nbsp;<span class="op" id="8141025">&amp;</span><span class="ident" id="8141026">fp</span><span class="op" id="8141028">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8141031">var</span>&nbsp;<span class="ident" id="8141035">buf</span>&nbsp;<span class="ident" id="8141039">bytes</span><span class="op" id="8141044">.</span><span class="ident" id="8141045">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8141053">enc</span>&nbsp;<span class="op" id="8141057">:=</span>&nbsp;<span class="ident" id="8141060">NewEncoder</span><span class="op" id="8141070">(</span><span class="op" id="8141071">&amp;</span><span class="ident" id="8141072">buf</span><span class="op" id="8141075">)</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8141078">if</span>&nbsp;<span class="ident" id="8141081">err</span>&nbsp;<span class="op" id="8141085">:=</span>&nbsp;<span class="ident" id="8141088">enc</span><span class="op" id="8141091">.</span><span class="ident" id="8141092">Encode</span><span class="op" id="8141098">(</span><span class="ident" id="8141099">b0</span><span class="op" id="8141101">)</span><span class="op" id="8141102">;</span>&nbsp;<span class="ident" id="8141104">err</span>&nbsp;<span class="op" id="8141108">!=</span>&nbsp;<span class="ident" id="8141111">nil</span>&nbsp;<span class="op" id="8141115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8141119">t</span><span class="op" id="8141120">.</span><span class="ident" id="8141121">Fatal</span><span class="op" id="8141126">(</span><span class="string" id="8141127">&#34;error&nbsp;encoding:&#34;</span><span class="op" id="8141144">,</span>&nbsp;<span class="ident" id="8141146">err</span><span class="op" id="8141149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8141152">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8141155">var</span>&nbsp;<span class="ident" id="8141159">b1</span>&nbsp;<span class="ident" id="8141162">Bug2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8141168">err</span>&nbsp;<span class="op" id="8141172">:=</span>&nbsp;<span class="ident" id="8141175">NewDecoder</span><span class="op" id="8141185">(</span><span class="op" id="8141186">&amp;</span><span class="ident" id="8141187">buf</span><span class="op" id="8141190">)</span><span class="op" id="8141191">.</span><span class="ident" id="8141192">Decode</span><span class="op" id="8141198">(</span><span class="op" id="8141199">&amp;</span><span class="ident" id="8141200">b1</span><span class="op" id="8141202">)</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8141205">if</span>&nbsp;<span class="ident" id="8141208">err</span>&nbsp;<span class="op" id="8141212">!=</span>&nbsp;<span class="ident" id="8141215">nil</span>&nbsp;<span class="op" id="8141219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8141223">t</span><span class="op" id="8141224">.</span><span class="ident" id="8141225">Fatal</span><span class="op" id="8141230">(</span><span class="string" id="8141231">&#34;decode:&#34;</span><span class="op" id="8141240">,</span>&nbsp;<span class="ident" id="8141242">err</span><span class="op" id="8141245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8141248">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8141251">if</span>&nbsp;<span class="ident" id="8141254">b1</span><span class="op" id="8141256">.</span><span class="ident" id="8141257">A</span>&nbsp;<span class="op" id="8141259">!=</span>&nbsp;<span class="ident" id="8141262">b0</span><span class="op" id="8141264">.</span><span class="ident" id="8141265">A</span>&nbsp;<span class="op" id="8141267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8141271">t</span><span class="op" id="8141272">.</span><span class="ident" id="8141273">Fatalf</span><span class="op" id="8141279">(</span><span class="string" id="8141280">&#34;got&nbsp;%d&nbsp;want&nbsp;%d&#34;</span><span class="op" id="8141296">,</span>&nbsp;<span class="ident" id="8141298">b1</span><span class="op" id="8141300">.</span><span class="ident" id="8141301">A</span><span class="op" id="8141302">,</span>&nbsp;<span class="ident" id="8141304">b0</span><span class="op" id="8141306">.</span><span class="ident" id="8141307">A</span><span class="op" id="8141308">)</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8141311">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8141314">if</span>&nbsp;<span class="ident" id="8141317">b1</span><span class="op" id="8141319">.</span><span class="ident" id="8141320">C</span>&nbsp;<span class="op" id="8141322">!=</span>&nbsp;<span class="ident" id="8141325">nil</span>&nbsp;<span class="op" id="8141329">||</span>&nbsp;<span class="ident" id="8141332">b1</span><span class="op" id="8141334">.</span><span class="ident" id="8141335">CP</span>&nbsp;<span class="op" id="8141338">!=</span>&nbsp;<span class="ident" id="8141341">nil</span>&nbsp;<span class="op" id="8141345">||</span>&nbsp;<span class="ident" id="8141348">b1</span><span class="op" id="8141350">.</span><span class="ident" id="8141351">F</span>&nbsp;<span class="op" id="8141353">!=</span>&nbsp;<span class="ident" id="8141356">nil</span>&nbsp;<span class="op" id="8141360">||</span>&nbsp;<span class="ident" id="8141363">b1</span><span class="op" id="8141365">.</span><span class="ident" id="8141366">FPP</span>&nbsp;<span class="op" id="8141370">!=</span>&nbsp;<span class="ident" id="8141373">nil</span>&nbsp;<span class="op" id="8141377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8141381">t</span><span class="op" id="8141382">.</span><span class="ident" id="8141383">Fatal</span><span class="op" id="8141388">(</span><span class="string" id="8141389">&#34;unexpected&nbsp;value&nbsp;for&nbsp;chan&nbsp;or&nbsp;func&#34;</span><span class="op" id="8141424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8141427">}</span><br>
<span class="lineno"></span><span class="op" id="8141429">}</span><br>
<span class="lineno">770</span><br>
<span class="lineno"></span><span class="keyword" id="8141432">func</span>&nbsp;<span class="ident" id="8141437">TestSliceIncompatibility</span><span class="op" id="8141461">(</span><span class="ident" id="8141462">t</span>&nbsp;<span class="op" id="8141464">*</span><span class="ident" id="8141465">testing</span><span class="op" id="8141472">.</span><span class="ident" id="8141473">T</span><span class="op" id="8141474">)</span>&nbsp;<span class="op" id="8141476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8141479">var</span>&nbsp;<span class="ident" id="8141483">in</span>&nbsp;<span class="op" id="8141486">=</span>&nbsp;<span class="op" id="8141488">[</span><span class="op" id="8141489">]</span><span class="builtintype" id="8141490">byte</span><span class="op" id="8141494">{</span><span class="num" id="8141495">1</span><span class="op" id="8141496">,</span>&nbsp;<span class="num" id="8141498">2</span><span class="op" id="8141499">,</span>&nbsp;<span class="num" id="8141501">3</span><span class="op" id="8141502">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8141505">var</span>&nbsp;<span class="ident" id="8141509">out</span>&nbsp;<span class="op" id="8141513">[</span><span class="op" id="8141514">]</span><span class="builtintype" id="8141515">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8141520">if</span>&nbsp;<span class="ident" id="8141523">err</span>&nbsp;<span class="op" id="8141527">:=</span>&nbsp;<span class="ident" id="8141530">encAndDec</span><span class="op" id="8141539">(</span><span class="ident" id="8141540">in</span><span class="op" id="8141542">,</span>&nbsp;<span class="op" id="8141544">&amp;</span><span class="ident" id="8141545">out</span><span class="op" id="8141548">)</span><span class="op" id="8141549">;</span>&nbsp;<span class="ident" id="8141551">err</span>&nbsp;<span class="op" id="8141555">==</span>&nbsp;<span class="ident" id="8141558">nil</span>&nbsp;<span class="op" id="8141562">{</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8141566">t</span><span class="op" id="8141567">.</span><span class="ident" id="8141568">Error</span><span class="op" id="8141573">(</span><span class="string" id="8141574">&#34;expected&nbsp;compatibility&nbsp;error&#34;</span><span class="op" id="8141604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8141607">}</span><br>
<span class="lineno"></span><span class="op" id="8141609">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8141612">//&nbsp;Mutually&nbsp;recursive&nbsp;slices&nbsp;of&nbsp;structs&nbsp;caused&nbsp;problems.</span><br>
<span class="lineno">780</span><span class="keyword" id="8141669">type</span>&nbsp;<span class="ident" id="8141674">Bug3</span>&nbsp;<span class="keyword" id="8141679">struct</span>&nbsp;<span class="op" id="8141686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8141689">Num</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8141698">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8141703">Children</span>&nbsp;<span class="op" id="8141712">[</span><span class="op" id="8141713">]</span><span class="op" id="8141714">*</span><span class="ident" id="8141715">Bug3</span><br>
<span class="lineno"></span><span class="op" id="8141720">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">785</span><span class="keyword" id="8141723">func</span>&nbsp;<span class="ident" id="8141728">TestGobPtrSlices</span><span class="op" id="8141744">(</span><span class="ident" id="8141745">t</span>&nbsp;<span class="op" id="8141747">*</span><span class="ident" id="8141748">testing</span><span class="op" id="8141755">.</span><span class="ident" id="8141756">T</span><span class="op" id="8141757">)</span>&nbsp;<span class="op" id="8141759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8141762">in</span>&nbsp;<span class="op" id="8141765">:=</span>&nbsp;<span class="op" id="8141768">[</span><span class="op" id="8141769">]</span><span class="op" id="8141770">*</span><span class="ident" id="8141771">Bug3</span><span class="op" id="8141775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8141779">{</span><span class="num" id="8141780">1</span><span class="op" id="8141781">,</span>&nbsp;<span class="ident" id="8141783">nil</span><span class="op" id="8141786">}</span><span class="op" id="8141787">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8141791">{</span><span class="num" id="8141792">2</span><span class="op" id="8141793">,</span>&nbsp;<span class="ident" id="8141795">nil</span><span class="op" id="8141798">}</span><span class="op" id="8141799">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8141802">}</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8141805">b</span>&nbsp;<span class="op" id="8141807">:=</span>&nbsp;<span class="builtinfunc" id="8141810">new</span><span class="op" id="8141813">(</span><span class="ident" id="8141814">bytes</span><span class="op" id="8141819">.</span><span class="ident" id="8141820">Buffer</span><span class="op" id="8141826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8141829">err</span>&nbsp;<span class="op" id="8141833">:=</span>&nbsp;<span class="ident" id="8141836">NewEncoder</span><span class="op" id="8141846">(</span><span class="ident" id="8141847">b</span><span class="op" id="8141848">)</span><span class="op" id="8141849">.</span><span class="ident" id="8141850">Encode</span><span class="op" id="8141856">(</span><span class="op" id="8141857">&amp;</span><span class="ident" id="8141858">in</span><span class="op" id="8141860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8141863">if</span>&nbsp;<span class="ident" id="8141866">err</span>&nbsp;<span class="op" id="8141870">!=</span>&nbsp;<span class="ident" id="8141873">nil</span>&nbsp;<span class="op" id="8141877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8141881">t</span><span class="op" id="8141882">.</span><span class="ident" id="8141883">Fatal</span><span class="op" id="8141888">(</span><span class="string" id="8141889">&#34;encode:&#34;</span><span class="op" id="8141898">,</span>&nbsp;<span class="ident" id="8141900">err</span><span class="op" id="8141903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8141906">}</span><br>
<span class="lineno">795</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8141910">var</span>&nbsp;<span class="ident" id="8141914">out</span>&nbsp;<span class="op" id="8141918">[</span><span class="op" id="8141919">]</span><span class="op" id="8141920">*</span><span class="ident" id="8141921">Bug3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8141927">err</span>&nbsp;<span class="op" id="8141931">=</span>&nbsp;<span class="ident" id="8141933">NewDecoder</span><span class="op" id="8141943">(</span><span class="ident" id="8141944">b</span><span class="op" id="8141945">)</span><span class="op" id="8141946">.</span><span class="ident" id="8141947">Decode</span><span class="op" id="8141953">(</span><span class="op" id="8141954">&amp;</span><span class="ident" id="8141955">out</span><span class="op" id="8141958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8141961">if</span>&nbsp;<span class="ident" id="8141964">err</span>&nbsp;<span class="op" id="8141968">!=</span>&nbsp;<span class="ident" id="8141971">nil</span>&nbsp;<span class="op" id="8141975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8141979">t</span><span class="op" id="8141980">.</span><span class="ident" id="8141981">Fatal</span><span class="op" id="8141986">(</span><span class="string" id="8141987">&#34;decode:&#34;</span><span class="op" id="8141996">,</span>&nbsp;<span class="ident" id="8141998">err</span><span class="op" id="8142001">)</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8142004">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8142007">if</span>&nbsp;<span class="op" id="8142010">!</span><span class="ident" id="8142011">reflect</span><span class="op" id="8142018">.</span><span class="ident" id="8142019">DeepEqual</span><span class="op" id="8142028">(</span><span class="ident" id="8142029">in</span><span class="op" id="8142031">,</span>&nbsp;<span class="ident" id="8142033">out</span><span class="op" id="8142036">)</span>&nbsp;<span class="op" id="8142038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8142042">t</span><span class="op" id="8142043">.</span><span class="ident" id="8142044">Fatalf</span><span class="op" id="8142050">(</span><span class="string" id="8142051">&#34;got&nbsp;%v;&nbsp;wanted&nbsp;%v&#34;</span><span class="op" id="8142070">,</span>&nbsp;<span class="ident" id="8142072">out</span><span class="op" id="8142075">,</span>&nbsp;<span class="ident" id="8142077">in</span><span class="op" id="8142079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8142082">}</span><br>
<span class="lineno"></span><span class="op" id="8142084">}</span><br>
<span class="lineno">805</span><br>
<span class="lineno"></span><span class="comment" id="8142087">//&nbsp;getDecEnginePtr&nbsp;cached&nbsp;engine&nbsp;for&nbsp;ut.base&nbsp;instead&nbsp;of&nbsp;ut.user&nbsp;so&nbsp;we&nbsp;passed</span><br>
<span class="lineno"></span><span class="comment" id="8142164">//&nbsp;a&nbsp;*map&nbsp;and&nbsp;then&nbsp;tried&nbsp;to&nbsp;reuse&nbsp;its&nbsp;engine&nbsp;to&nbsp;decode&nbsp;the&nbsp;inner&nbsp;map.</span><br>
<span class="lineno"></span><span class="keyword" id="8142234">func</span>&nbsp;<span class="ident" id="8142239">TestPtrToMapOfMap</span><span class="op" id="8142256">(</span><span class="ident" id="8142257">t</span>&nbsp;<span class="op" id="8142259">*</span><span class="ident" id="8142260">testing</span><span class="op" id="8142267">.</span><span class="ident" id="8142268">T</span><span class="op" id="8142269">)</span>&nbsp;<span class="op" id="8142271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8142274">Register</span><span class="op" id="8142282">(</span><span class="builtinfunc" id="8142283">make</span><span class="op" id="8142287">(</span><span class="keyword" id="8142288">map</span><span class="op" id="8142291">[</span><span class="builtintype" id="8142292">string</span><span class="op" id="8142298">]</span><span class="keyword" id="8142299">interface</span><span class="op" id="8142308">{</span><span class="op" id="8142309">}</span><span class="op" id="8142310">)</span><span class="op" id="8142311">)</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8142314">subdata</span>&nbsp;<span class="op" id="8142322">:=</span>&nbsp;<span class="builtinfunc" id="8142325">make</span><span class="op" id="8142329">(</span><span class="keyword" id="8142330">map</span><span class="op" id="8142333">[</span><span class="builtintype" id="8142334">string</span><span class="op" id="8142340">]</span><span class="keyword" id="8142341">interface</span><span class="op" id="8142350">{</span><span class="op" id="8142351">}</span><span class="op" id="8142352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8142355">subdata</span><span class="op" id="8142362">[</span><span class="string" id="8142363">&#34;bar&#34;</span><span class="op" id="8142368">]</span>&nbsp;<span class="op" id="8142370">=</span>&nbsp;<span class="string" id="8142372">&#34;baz&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8142379">data</span>&nbsp;<span class="op" id="8142384">:=</span>&nbsp;<span class="builtinfunc" id="8142387">make</span><span class="op" id="8142391">(</span><span class="keyword" id="8142392">map</span><span class="op" id="8142395">[</span><span class="builtintype" id="8142396">string</span><span class="op" id="8142402">]</span><span class="keyword" id="8142403">interface</span><span class="op" id="8142412">{</span><span class="op" id="8142413">}</span><span class="op" id="8142414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8142417">data</span><span class="op" id="8142421">[</span><span class="string" id="8142422">&#34;foo&#34;</span><span class="op" id="8142427">]</span>&nbsp;<span class="op" id="8142429">=</span>&nbsp;<span class="ident" id="8142431">subdata</span><br>
<span class="lineno"></span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8142441">b</span>&nbsp;<span class="op" id="8142443">:=</span>&nbsp;<span class="builtinfunc" id="8142446">new</span><span class="op" id="8142449">(</span><span class="ident" id="8142450">bytes</span><span class="op" id="8142455">.</span><span class="ident" id="8142456">Buffer</span><span class="op" id="8142462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8142465">err</span>&nbsp;<span class="op" id="8142469">:=</span>&nbsp;<span class="ident" id="8142472">NewEncoder</span><span class="op" id="8142482">(</span><span class="ident" id="8142483">b</span><span class="op" id="8142484">)</span><span class="op" id="8142485">.</span><span class="ident" id="8142486">Encode</span><span class="op" id="8142492">(</span><span class="ident" id="8142493">data</span><span class="op" id="8142497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8142500">if</span>&nbsp;<span class="ident" id="8142503">err</span>&nbsp;<span class="op" id="8142507">!=</span>&nbsp;<span class="ident" id="8142510">nil</span>&nbsp;<span class="op" id="8142514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8142518">t</span><span class="op" id="8142519">.</span><span class="ident" id="8142520">Fatal</span><span class="op" id="8142525">(</span><span class="string" id="8142526">&#34;encode:&#34;</span><span class="op" id="8142535">,</span>&nbsp;<span class="ident" id="8142537">err</span><span class="op" id="8142540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8142543">}</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8142546">var</span>&nbsp;<span class="ident" id="8142550">newData</span>&nbsp;<span class="keyword" id="8142558">map</span><span class="op" id="8142561">[</span><span class="builtintype" id="8142562">string</span><span class="op" id="8142568">]</span><span class="keyword" id="8142569">interface</span><span class="op" id="8142578">{</span><span class="op" id="8142579">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8142582">err</span>&nbsp;<span class="op" id="8142586">=</span>&nbsp;<span class="ident" id="8142588">NewDecoder</span><span class="op" id="8142598">(</span><span class="ident" id="8142599">b</span><span class="op" id="8142600">)</span><span class="op" id="8142601">.</span><span class="ident" id="8142602">Decode</span><span class="op" id="8142608">(</span><span class="op" id="8142609">&amp;</span><span class="ident" id="8142610">newData</span><span class="op" id="8142617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8142620">if</span>&nbsp;<span class="ident" id="8142623">err</span>&nbsp;<span class="op" id="8142627">!=</span>&nbsp;<span class="ident" id="8142630">nil</span>&nbsp;<span class="op" id="8142634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8142638">t</span><span class="op" id="8142639">.</span><span class="ident" id="8142640">Fatal</span><span class="op" id="8142645">(</span><span class="string" id="8142646">&#34;decode:&#34;</span><span class="op" id="8142655">,</span>&nbsp;<span class="ident" id="8142657">err</span><span class="op" id="8142660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8142663">}</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8142666">if</span>&nbsp;<span class="op" id="8142669">!</span><span class="ident" id="8142670">reflect</span><span class="op" id="8142677">.</span><span class="ident" id="8142678">DeepEqual</span><span class="op" id="8142687">(</span><span class="ident" id="8142688">data</span><span class="op" id="8142692">,</span>&nbsp;<span class="ident" id="8142694">newData</span><span class="op" id="8142701">)</span>&nbsp;<span class="op" id="8142703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8142707">t</span><span class="op" id="8142708">.</span><span class="ident" id="8142709">Fatalf</span><span class="op" id="8142715">(</span><span class="string" id="8142716">&#34;expected&nbsp;%v&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8142736">,</span>&nbsp;<span class="ident" id="8142738">data</span><span class="op" id="8142742">,</span>&nbsp;<span class="ident" id="8142744">newData</span><span class="op" id="8142751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8142754">}</span><br>
<span class="lineno"></span><span class="op" id="8142756">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">830</span><span class="comment" id="8142759">//&nbsp;A&nbsp;top-level&nbsp;nil&nbsp;pointer&nbsp;generates&nbsp;a&nbsp;panic&nbsp;with&nbsp;a&nbsp;helpful&nbsp;string-valued&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="8142842">func</span>&nbsp;<span class="ident" id="8142847">TestTopLevelNilPointer</span><span class="op" id="8142869">(</span><span class="ident" id="8142870">t</span>&nbsp;<span class="op" id="8142872">*</span><span class="ident" id="8142873">testing</span><span class="op" id="8142880">.</span><span class="ident" id="8142881">T</span><span class="op" id="8142882">)</span>&nbsp;<span class="op" id="8142884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8142887">errMsg</span>&nbsp;<span class="op" id="8142894">:=</span>&nbsp;<span class="ident" id="8142897">topLevelNilPanic</span><span class="op" id="8142913">(</span><span class="ident" id="8142914">t</span><span class="op" id="8142915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8142918">if</span>&nbsp;<span class="ident" id="8142921">errMsg</span>&nbsp;<span class="op" id="8142928">==</span>&nbsp;<span class="string" id="8142931">&#34;&#34;</span>&nbsp;<span class="op" id="8142934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8142938">t</span><span class="op" id="8142939">.</span><span class="ident" id="8142940">Fatal</span><span class="op" id="8142945">(</span><span class="string" id="8142946">&#34;top-level&nbsp;nil&nbsp;pointer&nbsp;did&nbsp;not&nbsp;panic&#34;</span><span class="op" id="8142983">)</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8142986">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8142989">if</span>&nbsp;<span class="op" id="8142992">!</span><span class="ident" id="8142993">strings</span><span class="op" id="8143000">.</span><span class="ident" id="8143001">Contains</span><span class="op" id="8143009">(</span><span class="ident" id="8143010">errMsg</span><span class="op" id="8143016">,</span>&nbsp;<span class="string" id="8143018">&#34;nil&nbsp;pointer&#34;</span><span class="op" id="8143031">)</span>&nbsp;<span class="op" id="8143033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8143037">t</span><span class="op" id="8143038">.</span><span class="ident" id="8143039">Fatal</span><span class="op" id="8143044">(</span><span class="string" id="8143045">&#34;expected&nbsp;nil&nbsp;pointer&nbsp;error,&nbsp;got:&#34;</span><span class="op" id="8143079">,</span>&nbsp;<span class="ident" id="8143081">errMsg</span><span class="op" id="8143087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8143090">}</span><br>
<span class="lineno"></span><span class="op" id="8143092">}</span><br>
<span class="lineno">840</span><br>
<span class="lineno"></span><span class="keyword" id="8143095">func</span>&nbsp;<span class="ident" id="8143100">topLevelNilPanic</span><span class="op" id="8143116">(</span><span class="ident" id="8143117">t</span>&nbsp;<span class="op" id="8143119">*</span><span class="ident" id="8143120">testing</span><span class="op" id="8143127">.</span><span class="ident" id="8143128">T</span><span class="op" id="8143129">)</span>&nbsp;<span class="op" id="8143131">(</span><span class="ident" id="8143132">panicErr</span>&nbsp;<span class="builtintype" id="8143141">string</span><span class="op" id="8143147">)</span>&nbsp;<span class="op" id="8143149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8143152">defer</span>&nbsp;<span class="keyword" id="8143158">func</span><span class="op" id="8143162">(</span><span class="op" id="8143163">)</span>&nbsp;<span class="op" id="8143165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8143169">e</span>&nbsp;<span class="op" id="8143171">:=</span>&nbsp;<span class="builtinfunc" id="8143174">recover</span><span class="op" id="8143181">(</span><span class="op" id="8143182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8143186">if</span>&nbsp;<span class="ident" id="8143189">err</span><span class="op" id="8143192">,</span>&nbsp;<span class="ident" id="8143194">ok</span>&nbsp;<span class="op" id="8143197">:=</span>&nbsp;<span class="ident" id="8143200">e</span><span class="op" id="8143201">.</span><span class="op" id="8143202">(</span><span class="builtintype" id="8143203">string</span><span class="op" id="8143209">)</span><span class="op" id="8143210">;</span>&nbsp;<span class="ident" id="8143212">ok</span>&nbsp;<span class="op" id="8143215">{</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8143220">panicErr</span>&nbsp;<span class="op" id="8143229">=</span>&nbsp;<span class="ident" id="8143231">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8143237">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8143240">}</span><span class="op" id="8143241">(</span><span class="op" id="8143242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8143245">var</span>&nbsp;<span class="ident" id="8143249">ip</span>&nbsp;<span class="op" id="8143252">*</span><span class="builtintype" id="8143253">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8143258">buf</span>&nbsp;<span class="op" id="8143262">:=</span>&nbsp;<span class="builtinfunc" id="8143265">new</span><span class="op" id="8143268">(</span><span class="ident" id="8143269">bytes</span><span class="op" id="8143274">.</span><span class="ident" id="8143275">Buffer</span><span class="op" id="8143281">)</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8143284">if</span>&nbsp;<span class="ident" id="8143287">err</span>&nbsp;<span class="op" id="8143291">:=</span>&nbsp;<span class="ident" id="8143294">NewEncoder</span><span class="op" id="8143304">(</span><span class="ident" id="8143305">buf</span><span class="op" id="8143308">)</span><span class="op" id="8143309">.</span><span class="ident" id="8143310">Encode</span><span class="op" id="8143316">(</span><span class="ident" id="8143317">ip</span><span class="op" id="8143319">)</span><span class="op" id="8143320">;</span>&nbsp;<span class="ident" id="8143322">err</span>&nbsp;<span class="op" id="8143326">!=</span>&nbsp;<span class="ident" id="8143329">nil</span>&nbsp;<span class="op" id="8143333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8143337">t</span><span class="op" id="8143338">.</span><span class="ident" id="8143339">Fatal</span><span class="op" id="8143344">(</span><span class="string" id="8143345">&#34;error&nbsp;in&nbsp;encode:&#34;</span><span class="op" id="8143363">,</span>&nbsp;<span class="ident" id="8143365">err</span><span class="op" id="8143368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8143371">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8143374">return</span><br>
<span class="lineno"></span><span class="op" id="8143381">}</span><br>
<span class="lineno">855</span><br>
<span class="lineno"></span><span class="keyword" id="8143384">func</span>&nbsp;<span class="ident" id="8143389">TestNilPointerInsideInterface</span><span class="op" id="8143418">(</span><span class="ident" id="8143419">t</span>&nbsp;<span class="op" id="8143421">*</span><span class="ident" id="8143422">testing</span><span class="op" id="8143429">.</span><span class="ident" id="8143430">T</span><span class="op" id="8143431">)</span>&nbsp;<span class="op" id="8143433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8143436">var</span>&nbsp;<span class="ident" id="8143440">ip</span>&nbsp;<span class="op" id="8143443">*</span><span class="builtintype" id="8143444">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8143449">si</span>&nbsp;<span class="op" id="8143452">:=</span>&nbsp;<span class="keyword" id="8143455">struct</span>&nbsp;<span class="op" id="8143462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8143466">I</span>&nbsp;<span class="keyword" id="8143468">interface</span><span class="op" id="8143477">{</span><span class="op" id="8143478">}</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8143481">}</span><span class="op" id="8143482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8143486">I</span><span class="op" id="8143487">:</span>&nbsp;<span class="ident" id="8143489">ip</span><span class="op" id="8143491">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8143494">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8143497">buf</span>&nbsp;<span class="op" id="8143501">:=</span>&nbsp;<span class="builtinfunc" id="8143504">new</span><span class="op" id="8143507">(</span><span class="ident" id="8143508">bytes</span><span class="op" id="8143513">.</span><span class="ident" id="8143514">Buffer</span><span class="op" id="8143520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8143523">err</span>&nbsp;<span class="op" id="8143527">:=</span>&nbsp;<span class="ident" id="8143530">NewEncoder</span><span class="op" id="8143540">(</span><span class="ident" id="8143541">buf</span><span class="op" id="8143544">)</span><span class="op" id="8143545">.</span><span class="ident" id="8143546">Encode</span><span class="op" id="8143552">(</span><span class="ident" id="8143553">si</span><span class="op" id="8143555">)</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8143558">if</span>&nbsp;<span class="ident" id="8143561">err</span>&nbsp;<span class="op" id="8143565">==</span>&nbsp;<span class="ident" id="8143568">nil</span>&nbsp;<span class="op" id="8143572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8143576">t</span><span class="op" id="8143577">.</span><span class="ident" id="8143578">Fatal</span><span class="op" id="8143583">(</span><span class="string" id="8143584">&#34;expected&nbsp;error,&nbsp;got&nbsp;none&#34;</span><span class="op" id="8143610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8143613">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8143616">errMsg</span>&nbsp;<span class="op" id="8143623">:=</span>&nbsp;<span class="ident" id="8143626">err</span><span class="op" id="8143629">.</span><span class="ident" id="8143630">Error</span><span class="op" id="8143635">(</span><span class="op" id="8143636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8143639">if</span>&nbsp;<span class="op" id="8143642">!</span><span class="ident" id="8143643">strings</span><span class="op" id="8143650">.</span><span class="ident" id="8143651">Contains</span><span class="op" id="8143659">(</span><span class="ident" id="8143660">errMsg</span><span class="op" id="8143666">,</span>&nbsp;<span class="string" id="8143668">&#34;nil&nbsp;pointer&#34;</span><span class="op" id="8143681">)</span>&nbsp;<span class="op" id="8143683">||</span>&nbsp;<span class="op" id="8143686">!</span><span class="ident" id="8143687">strings</span><span class="op" id="8143694">.</span><span class="ident" id="8143695">Contains</span><span class="op" id="8143703">(</span><span class="ident" id="8143704">errMsg</span><span class="op" id="8143710">,</span>&nbsp;<span class="string" id="8143712">&#34;interface&#34;</span><span class="op" id="8143723">)</span>&nbsp;<span class="op" id="8143725">{</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8143729">t</span><span class="op" id="8143730">.</span><span class="ident" id="8143731">Fatal</span><span class="op" id="8143736">(</span><span class="string" id="8143737">&#34;expected&nbsp;error&nbsp;about&nbsp;nil&nbsp;pointer&nbsp;and&nbsp;interface,&nbsp;got:&#34;</span><span class="op" id="8143791">,</span>&nbsp;<span class="ident" id="8143793">errMsg</span><span class="op" id="8143799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8143802">}</span><br>
<span class="lineno"></span><span class="op" id="8143804">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8143807">type</span>&nbsp;<span class="ident" id="8143812">Bug4Public</span>&nbsp;<span class="keyword" id="8143823">struct</span>&nbsp;<span class="op" id="8143830">{</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8143833">Name</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8143840">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8143848">Secret</span>&nbsp;<span class="ident" id="8143855">Bug4Secret</span><br>
<span class="lineno"></span><span class="op" id="8143866">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8143869">type</span>&nbsp;<span class="ident" id="8143874">Bug4Secret</span>&nbsp;<span class="keyword" id="8143885">struct</span>&nbsp;<span class="op" id="8143892">{</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8143895">a</span>&nbsp;<span class="builtintype" id="8143897">int</span>&nbsp;<span class="comment" id="8143901">//&nbsp;error:&nbsp;no&nbsp;exported&nbsp;fields.</span><br>
<span class="lineno"></span><span class="op" id="8143931">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8143934">//&nbsp;Test&nbsp;that&nbsp;a&nbsp;failed&nbsp;compilation&nbsp;doesn&#39;t&nbsp;leave&nbsp;around&nbsp;an&nbsp;executable&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="comment" id="8144012">//&nbsp;Issue&nbsp;3273.</span><br>
<span class="lineno">885</span><span class="keyword" id="8144027">func</span>&nbsp;<span class="ident" id="8144032">TestMutipleEncodingsOfBadType</span><span class="op" id="8144061">(</span><span class="ident" id="8144062">t</span>&nbsp;<span class="op" id="8144064">*</span><span class="ident" id="8144065">testing</span><span class="op" id="8144072">.</span><span class="ident" id="8144073">T</span><span class="op" id="8144074">)</span>&nbsp;<span class="op" id="8144076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8144079">x</span>&nbsp;<span class="op" id="8144081">:=</span>&nbsp;<span class="ident" id="8144084">Bug4Public</span><span class="op" id="8144094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8144098">Name</span><span class="op" id="8144102">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8144106">&#34;name&#34;</span><span class="op" id="8144112">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8144116">Secret</span><span class="op" id="8144122">:</span>&nbsp;<span class="ident" id="8144124">Bug4Secret</span><span class="op" id="8144134">{</span><span class="num" id="8144135">1</span><span class="op" id="8144136">}</span><span class="op" id="8144137">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8144140">}</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8144143">buf</span>&nbsp;<span class="op" id="8144147">:=</span>&nbsp;<span class="builtinfunc" id="8144150">new</span><span class="op" id="8144153">(</span><span class="ident" id="8144154">bytes</span><span class="op" id="8144159">.</span><span class="ident" id="8144160">Buffer</span><span class="op" id="8144166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8144169">enc</span>&nbsp;<span class="op" id="8144173">:=</span>&nbsp;<span class="ident" id="8144176">NewEncoder</span><span class="op" id="8144186">(</span><span class="ident" id="8144187">buf</span><span class="op" id="8144190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8144193">err</span>&nbsp;<span class="op" id="8144197">:=</span>&nbsp;<span class="ident" id="8144200">enc</span><span class="op" id="8144203">.</span><span class="ident" id="8144204">Encode</span><span class="op" id="8144210">(</span><span class="ident" id="8144211">x</span><span class="op" id="8144212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8144215">if</span>&nbsp;<span class="ident" id="8144218">err</span>&nbsp;<span class="op" id="8144222">==</span>&nbsp;<span class="ident" id="8144225">nil</span>&nbsp;<span class="op" id="8144229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8144233">t</span><span class="op" id="8144234">.</span><span class="ident" id="8144235">Fatal</span><span class="op" id="8144240">(</span><span class="string" id="8144241">&#34;first&nbsp;encoding:&nbsp;expected&nbsp;error&#34;</span><span class="op" id="8144273">)</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8144276">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8144279">buf</span><span class="op" id="8144282">.</span><span class="ident" id="8144283">Reset</span><span class="op" id="8144288">(</span><span class="op" id="8144289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8144292">enc</span>&nbsp;<span class="op" id="8144296">=</span>&nbsp;<span class="ident" id="8144298">NewEncoder</span><span class="op" id="8144308">(</span><span class="ident" id="8144309">buf</span><span class="op" id="8144312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8144315">err</span>&nbsp;<span class="op" id="8144319">=</span>&nbsp;<span class="ident" id="8144321">enc</span><span class="op" id="8144324">.</span><span class="ident" id="8144325">Encode</span><span class="op" id="8144331">(</span><span class="ident" id="8144332">x</span><span class="op" id="8144333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8144336">if</span>&nbsp;<span class="ident" id="8144339">err</span>&nbsp;<span class="op" id="8144343">==</span>&nbsp;<span class="ident" id="8144346">nil</span>&nbsp;<span class="op" id="8144350">{</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8144354">t</span><span class="op" id="8144355">.</span><span class="ident" id="8144356">Fatal</span><span class="op" id="8144361">(</span><span class="string" id="8144362">&#34;second&nbsp;encoding:&nbsp;expected&nbsp;error&#34;</span><span class="op" id="8144395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8144398">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8144401">if</span>&nbsp;<span class="op" id="8144404">!</span><span class="ident" id="8144405">strings</span><span class="op" id="8144412">.</span><span class="ident" id="8144413">Contains</span><span class="op" id="8144421">(</span><span class="ident" id="8144422">err</span><span class="op" id="8144425">.</span><span class="ident" id="8144426">Error</span><span class="op" id="8144431">(</span><span class="op" id="8144432">)</span><span class="op" id="8144433">,</span>&nbsp;<span class="string" id="8144435">&#34;no&nbsp;exported&nbsp;fields&#34;</span><span class="op" id="8144455">)</span>&nbsp;<span class="op" id="8144457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8144461">t</span><span class="op" id="8144462">.</span><span class="ident" id="8144463">Errorf</span><span class="op" id="8144469">(</span><span class="string" id="8144470">&#34;expected&nbsp;error&nbsp;about&nbsp;no&nbsp;exported&nbsp;fields;&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8144519">,</span>&nbsp;<span class="ident" id="8144521">err</span><span class="op" id="8144524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8144527">}</span><br>
<span class="lineno">905</span><span class="op" id="8144529">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8144532">//&nbsp;There&nbsp;was&nbsp;an&nbsp;error&nbsp;check&nbsp;comparing&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;input&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="8144603">//&nbsp;length&nbsp;of&nbsp;the&nbsp;slice&nbsp;being&nbsp;decoded.&nbsp;It&nbsp;was&nbsp;wrong&nbsp;because&nbsp;the&nbsp;next</span><br>
<span class="lineno"></span><span class="comment" id="8144671">//&nbsp;thing&nbsp;in&nbsp;the&nbsp;input&nbsp;might&nbsp;be&nbsp;a&nbsp;type&nbsp;definition,&nbsp;which&nbsp;would&nbsp;lead&nbsp;to</span><br>
<span class="lineno">910</span><span class="comment" id="8144741">//&nbsp;an&nbsp;incorrect&nbsp;length&nbsp;check.&nbsp;&nbsp;This&nbsp;test&nbsp;reproduces&nbsp;the&nbsp;corner&nbsp;case.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8144811">type</span>&nbsp;<span class="ident" id="8144816">Z</span>&nbsp;<span class="keyword" id="8144818">struct</span>&nbsp;<span class="op" id="8144825">{</span><br>
<span class="lineno"></span><span class="op" id="8144827">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">915</span><span class="keyword" id="8144830">func</span>&nbsp;<span class="ident" id="8144835">Test29ElementSlice</span><span class="op" id="8144853">(</span><span class="ident" id="8144854">t</span>&nbsp;<span class="op" id="8144856">*</span><span class="ident" id="8144857">testing</span><span class="op" id="8144864">.</span><span class="ident" id="8144865">T</span><span class="op" id="8144866">)</span>&nbsp;<span class="op" id="8144868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8144871">Register</span><span class="op" id="8144879">(</span><span class="ident" id="8144880">Z</span><span class="op" id="8144881">{</span><span class="op" id="8144882">}</span><span class="op" id="8144883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8144886">src</span>&nbsp;<span class="op" id="8144890">:=</span>&nbsp;<span class="builtinfunc" id="8144893">make</span><span class="op" id="8144897">(</span><span class="op" id="8144898">[</span><span class="op" id="8144899">]</span><span class="keyword" id="8144900">interface</span><span class="op" id="8144909">{</span><span class="op" id="8144910">}</span><span class="op" id="8144911">,</span>&nbsp;<span class="num" id="8144913">100</span><span class="op" id="8144916">)</span>&nbsp;<span class="comment" id="8144918">//&nbsp;Size&nbsp;needs&nbsp;to&nbsp;be&nbsp;bigger&nbsp;than&nbsp;size&nbsp;of&nbsp;type&nbsp;definition.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8144976">for</span>&nbsp;<span class="ident" id="8144980">i</span>&nbsp;<span class="op" id="8144982">:=</span>&nbsp;<span class="keyword" id="8144985">range</span>&nbsp;<span class="ident" id="8144991">src</span>&nbsp;<span class="op" id="8144995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8144999">src</span><span class="op" id="8145002">[</span><span class="ident" id="8145003">i</span><span class="op" id="8145004">]</span>&nbsp;<span class="op" id="8145006">=</span>&nbsp;<span class="ident" id="8145008">Z</span><span class="op" id="8145009">{</span><span class="op" id="8145010">}</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8145013">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8145016">buf</span>&nbsp;<span class="op" id="8145020">:=</span>&nbsp;<span class="builtinfunc" id="8145023">new</span><span class="op" id="8145026">(</span><span class="ident" id="8145027">bytes</span><span class="op" id="8145032">.</span><span class="ident" id="8145033">Buffer</span><span class="op" id="8145039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8145042">err</span>&nbsp;<span class="op" id="8145046">:=</span>&nbsp;<span class="ident" id="8145049">NewEncoder</span><span class="op" id="8145059">(</span><span class="ident" id="8145060">buf</span><span class="op" id="8145063">)</span><span class="op" id="8145064">.</span><span class="ident" id="8145065">Encode</span><span class="op" id="8145071">(</span><span class="ident" id="8145072">src</span><span class="op" id="8145075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8145078">if</span>&nbsp;<span class="ident" id="8145081">err</span>&nbsp;<span class="op" id="8145085">!=</span>&nbsp;<span class="ident" id="8145088">nil</span>&nbsp;<span class="op" id="8145092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8145096">t</span><span class="op" id="8145097">.</span><span class="ident" id="8145098">Fatalf</span><span class="op" id="8145104">(</span><span class="string" id="8145105">&#34;encode:&nbsp;%v&#34;</span><span class="op" id="8145117">,</span>&nbsp;<span class="ident" id="8145119">err</span><span class="op" id="8145122">)</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8145126">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8145134">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8145138">var</span>&nbsp;<span class="ident" id="8145142">dst</span>&nbsp;<span class="op" id="8145146">[</span><span class="op" id="8145147">]</span><span class="keyword" id="8145148">interface</span><span class="op" id="8145157">{</span><span class="op" id="8145158">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8145161">err</span>&nbsp;<span class="op" id="8145165">=</span>&nbsp;<span class="ident" id="8145167">NewDecoder</span><span class="op" id="8145177">(</span><span class="ident" id="8145178">buf</span><span class="op" id="8145181">)</span><span class="op" id="8145182">.</span><span class="ident" id="8145183">Decode</span><span class="op" id="8145189">(</span><span class="op" id="8145190">&amp;</span><span class="ident" id="8145191">dst</span><span class="op" id="8145194">)</span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8145197">if</span>&nbsp;<span class="ident" id="8145200">err</span>&nbsp;<span class="op" id="8145204">!=</span>&nbsp;<span class="ident" id="8145207">nil</span>&nbsp;<span class="op" id="8145211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8145215">t</span><span class="op" id="8145216">.</span><span class="ident" id="8145217">Errorf</span><span class="op" id="8145223">(</span><span class="string" id="8145224">&#34;decode:&nbsp;%v&#34;</span><span class="op" id="8145236">,</span>&nbsp;<span class="ident" id="8145238">err</span><span class="op" id="8145241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8145245">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8145253">}</span><br>
<span class="lineno"></span><span class="op" id="8145255">}</span><br>
<span class="lineno">935</span><br>
<span class="lineno"></span><span class="comment" id="8145258">//&nbsp;Don&#39;t&nbsp;crash,&nbsp;just&nbsp;give&nbsp;error&nbsp;when&nbsp;allocating&nbsp;a&nbsp;huge&nbsp;slice.</span><br>
<span class="lineno"></span><span class="comment" id="8145320">//&nbsp;Issue&nbsp;8084.</span><br>
<span class="lineno"></span><span class="keyword" id="8145335">func</span>&nbsp;<span class="ident" id="8145340">TestErrorForHugeSlice</span><span class="op" id="8145361">(</span><span class="ident" id="8145362">t</span>&nbsp;<span class="op" id="8145364">*</span><span class="ident" id="8145365">testing</span><span class="op" id="8145372">.</span><span class="ident" id="8145373">T</span><span class="op" id="8145374">)</span>&nbsp;<span class="op" id="8145376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8145379">//&nbsp;Encode&nbsp;an&nbsp;int&nbsp;slice.</span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8145404">buf</span>&nbsp;<span class="op" id="8145408">:=</span>&nbsp;<span class="builtinfunc" id="8145411">new</span><span class="op" id="8145414">(</span><span class="ident" id="8145415">bytes</span><span class="op" id="8145420">.</span><span class="ident" id="8145421">Buffer</span><span class="op" id="8145427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8145430">slice</span>&nbsp;<span class="op" id="8145436">:=</span>&nbsp;<span class="op" id="8145439">[</span><span class="op" id="8145440">]</span><span class="builtintype" id="8145441">int</span><span class="op" id="8145444">{</span><span class="num" id="8145445">1</span><span class="op" id="8145446">,</span>&nbsp;<span class="num" id="8145448">1</span><span class="op" id="8145449">,</span>&nbsp;<span class="num" id="8145451">1</span><span class="op" id="8145452">,</span>&nbsp;<span class="num" id="8145454">1</span><span class="op" id="8145455">,</span>&nbsp;<span class="num" id="8145457">1</span><span class="op" id="8145458">,</span>&nbsp;<span class="num" id="8145460">1</span><span class="op" id="8145461">,</span>&nbsp;<span class="num" id="8145463">1</span><span class="op" id="8145464">,</span>&nbsp;<span class="num" id="8145466">1</span><span class="op" id="8145467">,</span>&nbsp;<span class="num" id="8145469">1</span><span class="op" id="8145470">,</span>&nbsp;<span class="num" id="8145472">1</span><span class="op" id="8145473">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8145476">err</span>&nbsp;<span class="op" id="8145480">:=</span>&nbsp;<span class="ident" id="8145483">NewEncoder</span><span class="op" id="8145493">(</span><span class="ident" id="8145494">buf</span><span class="op" id="8145497">)</span><span class="op" id="8145498">.</span><span class="ident" id="8145499">Encode</span><span class="op" id="8145505">(</span><span class="ident" id="8145506">slice</span><span class="op" id="8145511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8145514">if</span>&nbsp;<span class="ident" id="8145517">err</span>&nbsp;<span class="op" id="8145521">!=</span>&nbsp;<span class="ident" id="8145524">nil</span>&nbsp;<span class="op" id="8145528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8145532">t</span><span class="op" id="8145533">.</span><span class="ident" id="8145534">Fatal</span><span class="op" id="8145539">(</span><span class="string" id="8145540">&#34;encode:&#34;</span><span class="op" id="8145549">,</span>&nbsp;<span class="ident" id="8145551">err</span><span class="op" id="8145554">)</span><br>
<span class="lineno">945</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8145557">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8145560">//&nbsp;Reach&nbsp;into&nbsp;the&nbsp;buffer&nbsp;and&nbsp;smash&nbsp;the&nbsp;count&nbsp;to&nbsp;make&nbsp;the&nbsp;encoded&nbsp;slice&nbsp;very&nbsp;long.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8145643">buf</span><span class="op" id="8145646">.</span><span class="ident" id="8145647">Bytes</span><span class="op" id="8145652">(</span><span class="op" id="8145653">)</span><span class="op" id="8145654">[</span><span class="ident" id="8145655">buf</span><span class="op" id="8145658">.</span><span class="ident" id="8145659">Len</span><span class="op" id="8145662">(</span><span class="op" id="8145663">)</span><span class="op" id="8145664">-</span><span class="builtinfunc" id="8145665">len</span><span class="op" id="8145668">(</span><span class="ident" id="8145669">slice</span><span class="op" id="8145674">)</span><span class="op" id="8145675">-</span><span class="num" id="8145676">1</span><span class="op" id="8145677">]</span>&nbsp;<span class="op" id="8145679">=</span>&nbsp;<span class="num" id="8145681">0xfa</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8145687">//&nbsp;Decode&nbsp;and&nbsp;see&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8145713">err</span>&nbsp;<span class="op" id="8145717">=</span>&nbsp;<span class="ident" id="8145719">NewDecoder</span><span class="op" id="8145729">(</span><span class="ident" id="8145730">buf</span><span class="op" id="8145733">)</span><span class="op" id="8145734">.</span><span class="ident" id="8145735">Decode</span><span class="op" id="8145741">(</span><span class="op" id="8145742">&amp;</span><span class="ident" id="8145743">slice</span><span class="op" id="8145748">)</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8145751">if</span>&nbsp;<span class="ident" id="8145754">err</span>&nbsp;<span class="op" id="8145758">==</span>&nbsp;<span class="ident" id="8145761">nil</span>&nbsp;<span class="op" id="8145765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8145769">t</span><span class="op" id="8145770">.</span><span class="ident" id="8145771">Fatal</span><span class="op" id="8145776">(</span><span class="string" id="8145777">&#34;decode:&nbsp;no&nbsp;error&#34;</span><span class="op" id="8145795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8145798">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8145801">if</span>&nbsp;<span class="op" id="8145804">!</span><span class="ident" id="8145805">strings</span><span class="op" id="8145812">.</span><span class="ident" id="8145813">Contains</span><span class="op" id="8145821">(</span><span class="ident" id="8145822">err</span><span class="op" id="8145825">.</span><span class="ident" id="8145826">Error</span><span class="op" id="8145831">(</span><span class="op" id="8145832">)</span><span class="op" id="8145833">,</span>&nbsp;<span class="string" id="8145835">&#34;slice&nbsp;too&nbsp;big&#34;</span><span class="op" id="8145850">)</span>&nbsp;<span class="op" id="8145852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8145856">t</span><span class="op" id="8145857">.</span><span class="ident" id="8145858">Fatal</span><span class="op" id="8145863">(</span><span class="string" id="8145864">&#34;decode:&nbsp;expected&nbsp;slice&nbsp;too&nbsp;big&nbsp;error,&nbsp;got&nbsp;%s&#34;</span><span class="op" id="8145910">,</span>&nbsp;<span class="ident" id="8145912">err</span><span class="op" id="8145915">.</span><span class="ident" id="8145916">Error</span><span class="op" id="8145921">(</span><span class="op" id="8145922">)</span><span class="op" id="8145923">)</span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8145926">}</span><br>
<span class="lineno"></span><span class="op" id="8145928">}</span>
</div>
</body>
</html>
