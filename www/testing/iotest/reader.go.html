<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2785714">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2785769">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2785823">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2785874">//&nbsp;Package&nbsp;iotest&nbsp;implements&nbsp;Readers&nbsp;and&nbsp;Writers&nbsp;useful&nbsp;mainly&nbsp;for&nbsp;testing.</span><br>
<span class="lineno"></span><span class="keyword" id="2785950">package</span>&nbsp;<span class="ident" id="2785958">iotest</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2785966">import</span>&nbsp;<span class="op" id="2785973">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2785976">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2785986">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="2785991">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2785994">//&nbsp;OneByteReader&nbsp;returns&nbsp;a&nbsp;Reader&nbsp;that&nbsp;implements</span><br>
<span class="lineno"></span><span class="comment" id="2786044">//&nbsp;each&nbsp;non-empty&nbsp;Read&nbsp;by&nbsp;reading&nbsp;one&nbsp;byte&nbsp;from&nbsp;r.</span><br>
<span class="lineno">15</span><span class="keyword" id="2786095">func</span>&nbsp;<span class="ident" id="2786100">OneByteReader</span><span class="op" id="2786113">(</span><span class="ident" id="2786114">r</span>&nbsp;<span class="ident" id="2786116"><a href="/testing/iotest/reader.go.html#2785986">io</a></span><span class="op" id="2786118">.</span><span class="ident" id="2786119">Reader</span><span class="op" id="2786125">)</span>&nbsp;<span class="ident" id="2786127"><a href="/testing/iotest/reader.go.html#2785986">io</a></span><span class="op" id="2786129">.</span><span class="ident" id="2786130">Reader</span>&nbsp;<span class="op" id="2786137">{</span>&nbsp;<span class="keyword" id="2786139">return</span>&nbsp;<span class="op" id="2786146">&amp;</span><span class="ident" id="2786147"><a href="/testing/iotest/reader.go.html#2786172">oneByteReader</a></span><span class="op" id="2786160">{</span><span class="ident" id="2786161"><a href="/testing/iotest/reader.go.html#2786114">r</a></span><span class="op" id="2786162">}</span>&nbsp;<span class="op" id="2786164">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2786167">type</span>&nbsp;<span class="ident" id="2786172">oneByteReader</span>&nbsp;<span class="keyword" id="2786186">struct</span>&nbsp;<span class="op" id="2786193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2786196">r</span>&nbsp;<span class="ident" id="2786198"><a href="/testing/iotest/reader.go.html#2785986">io</a></span><span class="op" id="2786200">.</span><span class="ident" id="2786201">Reader</span><br>
<span class="lineno"></span><span class="op" id="2786208">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="2786211">func</span>&nbsp;<span class="op" id="2786216">(</span><span class="ident" id="2786217">r</span>&nbsp;<span class="op" id="2786219">*</span><span class="ident" id="2786220"><a href="/testing/iotest/reader.go.html#2786172">oneByteReader</a></span><span class="op" id="2786233">)</span>&nbsp;<span class="ident" id="2786235">Read</span><span class="op" id="2786239">(</span><span class="ident" id="2786240">p</span>&nbsp;<span class="op" id="2786242">[</span><span class="op" id="2786243">]</span><span class="builtintype" id="2786244">byte</span><span class="op" id="2786248">)</span>&nbsp;<span class="op" id="2786250">(</span><span class="builtintype" id="2786251">int</span><span class="op" id="2786254">,</span>&nbsp;<span class="builtintype" id="2786256">error</span><span class="op" id="2786261">)</span>&nbsp;<span class="op" id="2786263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2786266">if</span>&nbsp;<span class="builtinfunc" id="2786269">len</span><span class="op" id="2786272">(</span><span class="ident" id="2786273"><a href="/testing/iotest/reader.go.html#2786240">p</a></span><span class="op" id="2786274">)</span>&nbsp;<span class="op" id="2786276">==</span>&nbsp;<span class="num" id="2786279">0</span>&nbsp;<span class="op" id="2786281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2786285">return</span>&nbsp;<span class="num" id="2786292">0</span><span class="op" id="2786293">,</span>&nbsp;<span class="ident" id="2786295">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2786300">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2786303">return</span>&nbsp;<span class="ident" id="2786310"><a href="/testing/iotest/reader.go.html#2786217">r</a></span><span class="op" id="2786311">.</span><span class="ident" id="2786312">r</span><span class="op" id="2786313">.</span><span class="ident" id="2786314">Read</span><span class="op" id="2786318">(</span><span class="ident" id="2786319"><a href="/testing/iotest/reader.go.html#2786240">p</a></span><span class="op" id="2786320">[</span><span class="num" id="2786321">0</span><span class="op" id="2786322">:</span><span class="num" id="2786323">1</span><span class="op" id="2786324">]</span><span class="op" id="2786325">)</span><br>
<span class="lineno"></span><span class="op" id="2786327">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2786330">//&nbsp;HalfReader&nbsp;returns&nbsp;a&nbsp;Reader&nbsp;that&nbsp;implements&nbsp;Read</span><br>
<span class="lineno"></span><span class="comment" id="2786382">//&nbsp;by&nbsp;reading&nbsp;half&nbsp;as&nbsp;many&nbsp;requested&nbsp;bytes&nbsp;from&nbsp;r.</span><br>
<span class="lineno">30</span><span class="keyword" id="2786433">func</span>&nbsp;<span class="ident" id="2786438">HalfReader</span><span class="op" id="2786448">(</span><span class="ident" id="2786449">r</span>&nbsp;<span class="ident" id="2786451"><a href="/testing/iotest/reader.go.html#2785986">io</a></span><span class="op" id="2786453">.</span><span class="ident" id="2786454">Reader</span><span class="op" id="2786460">)</span>&nbsp;<span class="ident" id="2786462"><a href="/testing/iotest/reader.go.html#2785986">io</a></span><span class="op" id="2786464">.</span><span class="ident" id="2786465">Reader</span>&nbsp;<span class="op" id="2786472">{</span>&nbsp;<span class="keyword" id="2786474">return</span>&nbsp;<span class="op" id="2786481">&amp;</span><span class="ident" id="2786482"><a href="/testing/iotest/reader.go.html#2786504">halfReader</a></span><span class="op" id="2786492">{</span><span class="ident" id="2786493"><a href="/testing/iotest/reader.go.html#2786449">r</a></span><span class="op" id="2786494">}</span>&nbsp;<span class="op" id="2786496">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2786499">type</span>&nbsp;<span class="ident" id="2786504">halfReader</span>&nbsp;<span class="keyword" id="2786515">struct</span>&nbsp;<span class="op" id="2786522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2786525">r</span>&nbsp;<span class="ident" id="2786527"><a href="/testing/iotest/reader.go.html#2785986">io</a></span><span class="op" id="2786529">.</span><span class="ident" id="2786530">Reader</span><br>
<span class="lineno"></span><span class="op" id="2786537">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="2786540">func</span>&nbsp;<span class="op" id="2786545">(</span><span class="ident" id="2786546">r</span>&nbsp;<span class="op" id="2786548">*</span><span class="ident" id="2786549"><a href="/testing/iotest/reader.go.html#2786504">halfReader</a></span><span class="op" id="2786559">)</span>&nbsp;<span class="ident" id="2786561">Read</span><span class="op" id="2786565">(</span><span class="ident" id="2786566">p</span>&nbsp;<span class="op" id="2786568">[</span><span class="op" id="2786569">]</span><span class="builtintype" id="2786570">byte</span><span class="op" id="2786574">)</span>&nbsp;<span class="op" id="2786576">(</span><span class="builtintype" id="2786577">int</span><span class="op" id="2786580">,</span>&nbsp;<span class="builtintype" id="2786582">error</span><span class="op" id="2786587">)</span>&nbsp;<span class="op" id="2786589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2786592">return</span>&nbsp;<span class="ident" id="2786599"><a href="/testing/iotest/reader.go.html#2786546">r</a></span><span class="op" id="2786600">.</span><span class="ident" id="2786601">r</span><span class="op" id="2786602">.</span><span class="ident" id="2786603">Read</span><span class="op" id="2786607">(</span><span class="ident" id="2786608"><a href="/testing/iotest/reader.go.html#2786566">p</a></span><span class="op" id="2786609">[</span><span class="num" id="2786610">0</span>&nbsp;<span class="op" id="2786612">:</span>&nbsp;<span class="op" id="2786614">(</span><span class="builtinfunc" id="2786615">len</span><span class="op" id="2786618">(</span><span class="ident" id="2786619"><a href="/testing/iotest/reader.go.html#2786566">p</a></span><span class="op" id="2786620">)</span><span class="op" id="2786621">+</span><span class="num" id="2786622">1</span><span class="op" id="2786623">)</span><span class="op" id="2786624">/</span><span class="num" id="2786625">2</span><span class="op" id="2786626">]</span><span class="op" id="2786627">)</span><br>
<span class="lineno"></span><span class="op" id="2786629">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="2786632">//&nbsp;DataErrReader&nbsp;changes&nbsp;the&nbsp;way&nbsp;errors&nbsp;are&nbsp;handled&nbsp;by&nbsp;a&nbsp;Reader.&nbsp;Normally,&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="2786709">//&nbsp;Reader&nbsp;returns&nbsp;an&nbsp;error&nbsp;(typically&nbsp;EOF)&nbsp;from&nbsp;the&nbsp;first&nbsp;Read&nbsp;call&nbsp;after&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2786787">//&nbsp;last&nbsp;piece&nbsp;of&nbsp;data&nbsp;is&nbsp;read.&nbsp;DataErrReader&nbsp;wraps&nbsp;a&nbsp;Reader&nbsp;and&nbsp;changes&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="2786863">//&nbsp;behavior&nbsp;so&nbsp;the&nbsp;final&nbsp;error&nbsp;is&nbsp;returned&nbsp;along&nbsp;with&nbsp;the&nbsp;final&nbsp;data,&nbsp;instead</span><br>
<span class="lineno"></span><span class="comment" id="2786941">//&nbsp;of&nbsp;in&nbsp;the&nbsp;first&nbsp;call&nbsp;after&nbsp;the&nbsp;final&nbsp;data.</span><br>
<span class="lineno">45</span><span class="keyword" id="2786987">func</span>&nbsp;<span class="ident" id="2786992">DataErrReader</span><span class="op" id="2787005">(</span><span class="ident" id="2787006">r</span>&nbsp;<span class="ident" id="2787008"><a href="/testing/iotest/reader.go.html#2785986">io</a></span><span class="op" id="2787010">.</span><span class="ident" id="2787011">Reader</span><span class="op" id="2787017">)</span>&nbsp;<span class="ident" id="2787019"><a href="/testing/iotest/reader.go.html#2785986">io</a></span><span class="op" id="2787021">.</span><span class="ident" id="2787022">Reader</span>&nbsp;<span class="op" id="2787029">{</span>&nbsp;<span class="keyword" id="2787031">return</span>&nbsp;<span class="op" id="2787038">&amp;</span><span class="ident" id="2787039"><a href="/testing/iotest/reader.go.html#2787089">dataErrReader</a></span><span class="op" id="2787052">{</span><span class="ident" id="2787053"><a href="/testing/iotest/reader.go.html#2787006">r</a></span><span class="op" id="2787054">,</span>&nbsp;<span class="ident" id="2787056">nil</span><span class="op" id="2787059">,</span>&nbsp;<span class="builtinfunc" id="2787061">make</span><span class="op" id="2787065">(</span><span class="op" id="2787066">[</span><span class="op" id="2787067">]</span><span class="builtintype" id="2787068">byte</span><span class="op" id="2787072">,</span>&nbsp;<span class="num" id="2787074">1024</span><span class="op" id="2787078">)</span><span class="op" id="2787079">}</span>&nbsp;<span class="op" id="2787081">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2787084">type</span>&nbsp;<span class="ident" id="2787089">dataErrReader</span>&nbsp;<span class="keyword" id="2787103">struct</span>&nbsp;<span class="op" id="2787110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2787113">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2787120"><a href="/testing/iotest/reader.go.html#2785986">io</a></span><span class="op" id="2787122">.</span><span class="ident" id="2787123">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2787131">unread</span>&nbsp;<span class="op" id="2787138">[</span><span class="op" id="2787139">]</span><span class="builtintype" id="2787140">byte</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2787146">data</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2787153">[</span><span class="op" id="2787154">]</span><span class="builtintype" id="2787155">byte</span><br>
<span class="lineno"></span><span class="op" id="2787160">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2787163">func</span>&nbsp;<span class="op" id="2787168">(</span><span class="ident" id="2787169">r</span>&nbsp;<span class="op" id="2787171">*</span><span class="ident" id="2787172"><a href="/testing/iotest/reader.go.html#2787089">dataErrReader</a></span><span class="op" id="2787185">)</span>&nbsp;<span class="ident" id="2787187">Read</span><span class="op" id="2787191">(</span><span class="ident" id="2787192">p</span>&nbsp;<span class="op" id="2787194">[</span><span class="op" id="2787195">]</span><span class="builtintype" id="2787196">byte</span><span class="op" id="2787200">)</span>&nbsp;<span class="op" id="2787202">(</span><span class="ident" id="2787203">n</span>&nbsp;<span class="builtintype" id="2787205">int</span><span class="op" id="2787208">,</span>&nbsp;<span class="ident" id="2787210">err</span>&nbsp;<span class="builtintype" id="2787214">error</span><span class="op" id="2787219">)</span>&nbsp;<span class="op" id="2787221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2787224">//&nbsp;loop&nbsp;because&nbsp;first&nbsp;call&nbsp;needs&nbsp;two&nbsp;reads:</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2787269">//&nbsp;one&nbsp;to&nbsp;get&nbsp;data&nbsp;and&nbsp;a&nbsp;second&nbsp;to&nbsp;look&nbsp;for&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2787324">for</span>&nbsp;<span class="op" id="2787328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2787332">if</span>&nbsp;<span class="builtinfunc" id="2787335">len</span><span class="op" id="2787338">(</span><span class="ident" id="2787339"><a href="/testing/iotest/reader.go.html#2787169">r</a></span><span class="op" id="2787340">.</span><span class="ident" id="2787341">unread</span><span class="op" id="2787347">)</span>&nbsp;<span class="op" id="2787349">==</span>&nbsp;<span class="num" id="2787352">0</span>&nbsp;<span class="op" id="2787354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2787359">n1</span><span class="op" id="2787361">,</span>&nbsp;<span class="ident" id="2787363">err1</span>&nbsp;<span class="op" id="2787368">:=</span>&nbsp;<span class="ident" id="2787371"><a href="/testing/iotest/reader.go.html#2787169">r</a></span><span class="op" id="2787372">.</span><span class="ident" id="2787373">r</span><span class="op" id="2787374">.</span><span class="ident" id="2787375">Read</span><span class="op" id="2787379">(</span><span class="ident" id="2787380"><a href="/testing/iotest/reader.go.html#2787169">r</a></span><span class="op" id="2787381">.</span><span class="ident" id="2787382">data</span><span class="op" id="2787386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2787391"><a href="/testing/iotest/reader.go.html#2787169">r</a></span><span class="op" id="2787392">.</span><span class="ident" id="2787393">unread</span>&nbsp;<span class="op" id="2787400">=</span>&nbsp;<span class="ident" id="2787402"><a href="/testing/iotest/reader.go.html#2787169">r</a></span><span class="op" id="2787403">.</span><span class="ident" id="2787404">data</span><span class="op" id="2787408">[</span><span class="num" id="2787409">0</span><span class="op" id="2787410">:</span><span class="ident" id="2787411"><a href="/testing/iotest/reader.go.html#2787359">n1</a></span><span class="op" id="2787413">]</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2787418"><a href="/testing/iotest/reader.go.html#2787210">err</a></span>&nbsp;<span class="op" id="2787422">=</span>&nbsp;<span class="ident" id="2787424"><a href="/testing/iotest/reader.go.html#2787363">err1</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2787431">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2787435">if</span>&nbsp;<span class="ident" id="2787438"><a href="/testing/iotest/reader.go.html#2787203">n</a></span>&nbsp;<span class="op" id="2787440">&gt;</span>&nbsp;<span class="num" id="2787442">0</span>&nbsp;<span class="op" id="2787444">||</span>&nbsp;<span class="ident" id="2787447"><a href="/testing/iotest/reader.go.html#2787210">err</a></span>&nbsp;<span class="op" id="2787451">!=</span>&nbsp;<span class="ident" id="2787454">nil</span>&nbsp;<span class="op" id="2787458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2787463">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2787471">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2787475"><a href="/testing/iotest/reader.go.html#2787203">n</a></span>&nbsp;<span class="op" id="2787477">=</span>&nbsp;<span class="builtinfunc" id="2787479">copy</span><span class="op" id="2787483">(</span><span class="ident" id="2787484"><a href="/testing/iotest/reader.go.html#2787192">p</a></span><span class="op" id="2787485">,</span>&nbsp;<span class="ident" id="2787487"><a href="/testing/iotest/reader.go.html#2787169">r</a></span><span class="op" id="2787488">.</span><span class="ident" id="2787489">unread</span><span class="op" id="2787495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2787499"><a href="/testing/iotest/reader.go.html#2787169">r</a></span><span class="op" id="2787500">.</span><span class="ident" id="2787501">unread</span>&nbsp;<span class="op" id="2787508">=</span>&nbsp;<span class="ident" id="2787510"><a href="/testing/iotest/reader.go.html#2787169">r</a></span><span class="op" id="2787511">.</span><span class="ident" id="2787512">unread</span><span class="op" id="2787518">[</span><span class="ident" id="2787519"><a href="/testing/iotest/reader.go.html#2787203">n</a></span><span class="op" id="2787520">:</span><span class="op" id="2787521">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2787524">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2787527">return</span><br>
<span class="lineno"></span><span class="op" id="2787534">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="2787537">var</span>&nbsp;<span class="ident" id="2787541">ErrTimeout</span>&nbsp;<span class="op" id="2787552">=</span>&nbsp;<span class="ident" id="2787554"><a href="/testing/iotest/reader.go.html#2785976">errors</a></span><span class="op" id="2787560">.</span><span class="ident" id="2787561">New</span><span class="op" id="2787564">(</span><span class="string" id="2787565">&#34;timeout&#34;</span><span class="op" id="2787574">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2787577">//&nbsp;TimeoutReader&nbsp;returns&nbsp;ErrTimeout&nbsp;on&nbsp;the&nbsp;second&nbsp;read</span><br>
<span class="lineno"></span><span class="comment" id="2787632">//&nbsp;with&nbsp;no&nbsp;data.&nbsp;&nbsp;Subsequent&nbsp;calls&nbsp;to&nbsp;read&nbsp;succeed.</span><br>
<span class="lineno">75</span><span class="keyword" id="2787684">func</span>&nbsp;<span class="ident" id="2787689">TimeoutReader</span><span class="op" id="2787702">(</span><span class="ident" id="2787703">r</span>&nbsp;<span class="ident" id="2787705"><a href="/testing/iotest/reader.go.html#2785986">io</a></span><span class="op" id="2787707">.</span><span class="ident" id="2787708">Reader</span><span class="op" id="2787714">)</span>&nbsp;<span class="ident" id="2787716"><a href="/testing/iotest/reader.go.html#2785986">io</a></span><span class="op" id="2787718">.</span><span class="ident" id="2787719">Reader</span>&nbsp;<span class="op" id="2787726">{</span>&nbsp;<span class="keyword" id="2787728">return</span>&nbsp;<span class="op" id="2787735">&amp;</span><span class="ident" id="2787736"><a href="/testing/iotest/reader.go.html#2787764">timeoutReader</a></span><span class="op" id="2787749">{</span><span class="ident" id="2787750"><a href="/testing/iotest/reader.go.html#2787703">r</a></span><span class="op" id="2787751">,</span>&nbsp;<span class="num" id="2787753">0</span><span class="op" id="2787754">}</span>&nbsp;<span class="op" id="2787756">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2787759">type</span>&nbsp;<span class="ident" id="2787764">timeoutReader</span>&nbsp;<span class="keyword" id="2787778">struct</span>&nbsp;<span class="op" id="2787785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2787788">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2787794"><a href="/testing/iotest/reader.go.html#2785986">io</a></span><span class="op" id="2787796">.</span><span class="ident" id="2787797">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2787805">count</span>&nbsp;<span class="builtintype" id="2787811">int</span><br>
<span class="lineno">80</span><span class="op" id="2787815">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2787818">func</span>&nbsp;<span class="op" id="2787823">(</span><span class="ident" id="2787824">r</span>&nbsp;<span class="op" id="2787826">*</span><span class="ident" id="2787827"><a href="/testing/iotest/reader.go.html#2787764">timeoutReader</a></span><span class="op" id="2787840">)</span>&nbsp;<span class="ident" id="2787842">Read</span><span class="op" id="2787846">(</span><span class="ident" id="2787847">p</span>&nbsp;<span class="op" id="2787849">[</span><span class="op" id="2787850">]</span><span class="builtintype" id="2787851">byte</span><span class="op" id="2787855">)</span>&nbsp;<span class="op" id="2787857">(</span><span class="builtintype" id="2787858">int</span><span class="op" id="2787861">,</span>&nbsp;<span class="builtintype" id="2787863">error</span><span class="op" id="2787868">)</span>&nbsp;<span class="op" id="2787870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2787873"><a href="/testing/iotest/reader.go.html#2787824">r</a></span><span class="op" id="2787874">.</span><span class="ident" id="2787875">count</span><span class="op" id="2787880">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2787884">if</span>&nbsp;<span class="ident" id="2787887"><a href="/testing/iotest/reader.go.html#2787824">r</a></span><span class="op" id="2787888">.</span><span class="ident" id="2787889">count</span>&nbsp;<span class="op" id="2787895">==</span>&nbsp;<span class="num" id="2787898">2</span>&nbsp;<span class="op" id="2787900">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2787904">return</span>&nbsp;<span class="num" id="2787911">0</span><span class="op" id="2787912">,</span>&nbsp;<span class="ident" id="2787914"><a href="/testing/iotest/reader.go.html#2787541">ErrTimeout</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2787926">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2787929">return</span>&nbsp;<span class="ident" id="2787936"><a href="/testing/iotest/reader.go.html#2787824">r</a></span><span class="op" id="2787937">.</span><span class="ident" id="2787938">r</span><span class="op" id="2787939">.</span><span class="ident" id="2787940">Read</span><span class="op" id="2787944">(</span><span class="ident" id="2787945"><a href="/testing/iotest/reader.go.html#2787847">p</a></span><span class="op" id="2787946">)</span><br>
<span class="lineno"></span><span class="op" id="2787948">}</span>
</div>
</body>
</html>
