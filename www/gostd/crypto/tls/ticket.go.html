<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4269735">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4269790">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4269844">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4269895">package</span>&nbsp;<span class="ident" id="4269903">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4269908">import</span>&nbsp;<span class="op" id="4269915">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4269918">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4269927">&#34;crypto/aes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4269941">&#34;crypto/cipher&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4269958">&#34;crypto/hmac&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4269973">&#34;crypto/sha256&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4269990">&#34;crypto/subtle&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4270007">&#34;errors&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4270017">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="4270022">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4270025">//&nbsp;sessionState&nbsp;contains&nbsp;the&nbsp;information&nbsp;that&nbsp;is&nbsp;serialized&nbsp;into&nbsp;a&nbsp;session</span><br>
<span class="lineno"></span><span class="comment" id="4270100">//&nbsp;ticket&nbsp;in&nbsp;order&nbsp;to&nbsp;later&nbsp;resume&nbsp;a&nbsp;connection.</span><br>
<span class="lineno">20</span><span class="keyword" id="4270149">type</span>&nbsp;<span class="ident" id="4270154">sessionState</span>&nbsp;<span class="keyword" id="4270167">struct</span>&nbsp;<span class="op" id="4270174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4270177">vers</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4270190">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4270198">cipherSuite</span>&nbsp;&nbsp;<span class="builtintype" id="4270211">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4270219">masterSecret</span>&nbsp;<span class="op" id="4270232">[</span><span class="op" id="4270233">]</span><span class="builtintype" id="4270234">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4270240">certificates</span>&nbsp;<span class="op" id="4270253">[</span><span class="op" id="4270254">]</span><span class="op" id="4270255">[</span><span class="op" id="4270256">]</span><span class="builtintype" id="4270257">byte</span><br>
<span class="lineno">25</span><span class="op" id="4270262">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4270265">func</span>&nbsp;<span class="op" id="4270270">(</span><span class="ident" id="4270271">s</span>&nbsp;<span class="op" id="4270273">*</span><span class="ident" id="4270274">sessionState</span><span class="op" id="4270286">)</span>&nbsp;<span class="ident" id="4270288">equal</span><span class="op" id="4270293">(</span><span class="ident" id="4270294">i</span>&nbsp;<span class="keyword" id="4270296">interface</span><span class="op" id="4270305">{</span><span class="op" id="4270306">}</span><span class="op" id="4270307">)</span>&nbsp;<span class="builtintype" id="4270309">bool</span>&nbsp;<span class="op" id="4270314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4270317">s1</span><span class="op" id="4270319">,</span>&nbsp;<span class="ident" id="4270321">ok</span>&nbsp;<span class="op" id="4270324">:=</span>&nbsp;<span class="ident" id="4270327">i</span><span class="op" id="4270328">.</span><span class="op" id="4270329">(</span><span class="op" id="4270330">*</span><span class="ident" id="4270331">sessionState</span><span class="op" id="4270343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4270346">if</span>&nbsp;<span class="op" id="4270349">!</span><span class="ident" id="4270350">ok</span>&nbsp;<span class="op" id="4270353">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4270357">return</span>&nbsp;<span class="builtintype" id="4270364">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4270371">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4270375">if</span>&nbsp;<span class="ident" id="4270378">s</span><span class="op" id="4270379">.</span><span class="ident" id="4270380">vers</span>&nbsp;<span class="op" id="4270385">!=</span>&nbsp;<span class="ident" id="4270388">s1</span><span class="op" id="4270390">.</span><span class="ident" id="4270391">vers</span>&nbsp;<span class="op" id="4270396">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4270401">s</span><span class="op" id="4270402">.</span><span class="ident" id="4270403">cipherSuite</span>&nbsp;<span class="op" id="4270415">!=</span>&nbsp;<span class="ident" id="4270418">s1</span><span class="op" id="4270420">.</span><span class="ident" id="4270421">cipherSuite</span>&nbsp;<span class="op" id="4270433">||</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4270438">!</span><span class="ident" id="4270439">bytes</span><span class="op" id="4270444">.</span><span class="ident" id="4270445">Equal</span><span class="op" id="4270450">(</span><span class="ident" id="4270451">s</span><span class="op" id="4270452">.</span><span class="ident" id="4270453">masterSecret</span><span class="op" id="4270465">,</span>&nbsp;<span class="ident" id="4270467">s1</span><span class="op" id="4270469">.</span><span class="ident" id="4270470">masterSecret</span><span class="op" id="4270482">)</span>&nbsp;<span class="op" id="4270484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4270488">return</span>&nbsp;<span class="builtintype" id="4270495">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4270502">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4270506">if</span>&nbsp;<span class="builtinfunc" id="4270509">len</span><span class="op" id="4270512">(</span><span class="ident" id="4270513">s</span><span class="op" id="4270514">.</span><span class="ident" id="4270515">certificates</span><span class="op" id="4270527">)</span>&nbsp;<span class="op" id="4270529">!=</span>&nbsp;<span class="builtinfunc" id="4270532">len</span><span class="op" id="4270535">(</span><span class="ident" id="4270536">s1</span><span class="op" id="4270538">.</span><span class="ident" id="4270539">certificates</span><span class="op" id="4270551">)</span>&nbsp;<span class="op" id="4270553">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4270557">return</span>&nbsp;<span class="builtintype" id="4270564">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4270571">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4270575">for</span>&nbsp;<span class="ident" id="4270579">i</span>&nbsp;<span class="op" id="4270581">:=</span>&nbsp;<span class="keyword" id="4270584">range</span>&nbsp;<span class="ident" id="4270590">s</span><span class="op" id="4270591">.</span><span class="ident" id="4270592">certificates</span>&nbsp;<span class="op" id="4270605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4270609">if</span>&nbsp;<span class="op" id="4270612">!</span><span class="ident" id="4270613">bytes</span><span class="op" id="4270618">.</span><span class="ident" id="4270619">Equal</span><span class="op" id="4270624">(</span><span class="ident" id="4270625">s</span><span class="op" id="4270626">.</span><span class="ident" id="4270627">certificates</span><span class="op" id="4270639">[</span><span class="ident" id="4270640">i</span><span class="op" id="4270641">]</span><span class="op" id="4270642">,</span>&nbsp;<span class="ident" id="4270644">s1</span><span class="op" id="4270646">.</span><span class="ident" id="4270647">certificates</span><span class="op" id="4270659">[</span><span class="ident" id="4270660">i</span><span class="op" id="4270661">]</span><span class="op" id="4270662">)</span>&nbsp;<span class="op" id="4270664">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4270669">return</span>&nbsp;<span class="builtintype" id="4270676">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4270684">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4270687">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4270691">return</span>&nbsp;<span class="builtintype" id="4270698">true</span><br>
<span class="lineno">50</span><span class="op" id="4270703">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4270706">func</span>&nbsp;<span class="op" id="4270711">(</span><span class="ident" id="4270712">s</span>&nbsp;<span class="op" id="4270714">*</span><span class="ident" id="4270715">sessionState</span><span class="op" id="4270727">)</span>&nbsp;<span class="ident" id="4270729">marshal</span><span class="op" id="4270736">(</span><span class="op" id="4270737">)</span>&nbsp;<span class="op" id="4270739">[</span><span class="op" id="4270740">]</span><span class="builtintype" id="4270741">byte</span>&nbsp;<span class="op" id="4270746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4270749">length</span>&nbsp;<span class="op" id="4270756">:=</span>&nbsp;<span class="num" id="4270759">2</span>&nbsp;<span class="op" id="4270761">+</span>&nbsp;<span class="num" id="4270763">2</span>&nbsp;<span class="op" id="4270765">+</span>&nbsp;<span class="num" id="4270767">2</span>&nbsp;<span class="op" id="4270769">+</span>&nbsp;<span class="builtinfunc" id="4270771">len</span><span class="op" id="4270774">(</span><span class="ident" id="4270775">s</span><span class="op" id="4270776">.</span><span class="ident" id="4270777">masterSecret</span><span class="op" id="4270789">)</span>&nbsp;<span class="op" id="4270791">+</span>&nbsp;<span class="num" id="4270793">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4270796">for</span>&nbsp;<span class="ident" id="4270800">_</span><span class="op" id="4270801">,</span>&nbsp;<span class="ident" id="4270803">cert</span>&nbsp;<span class="op" id="4270808">:=</span>&nbsp;<span class="keyword" id="4270811">range</span>&nbsp;<span class="ident" id="4270817">s</span><span class="op" id="4270818">.</span><span class="ident" id="4270819">certificates</span>&nbsp;<span class="op" id="4270832">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4270836">length</span>&nbsp;<span class="op" id="4270843">+=</span>&nbsp;<span class="num" id="4270846">4</span>&nbsp;<span class="op" id="4270848">+</span>&nbsp;<span class="builtinfunc" id="4270850">len</span><span class="op" id="4270853">(</span><span class="ident" id="4270854">cert</span><span class="op" id="4270858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4270861">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4270865">ret</span>&nbsp;<span class="op" id="4270869">:=</span>&nbsp;<span class="builtinfunc" id="4270872">make</span><span class="op" id="4270876">(</span><span class="op" id="4270877">[</span><span class="op" id="4270878">]</span><span class="builtintype" id="4270879">byte</span><span class="op" id="4270883">,</span>&nbsp;<span class="ident" id="4270885">length</span><span class="op" id="4270891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4270894">x</span>&nbsp;<span class="op" id="4270896">:=</span>&nbsp;<span class="ident" id="4270899">ret</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4270904">x</span><span class="op" id="4270905">[</span><span class="num" id="4270906">0</span><span class="op" id="4270907">]</span>&nbsp;<span class="op" id="4270909">=</span>&nbsp;<span class="builtintype" id="4270911">byte</span><span class="op" id="4270915">(</span><span class="ident" id="4270916">s</span><span class="op" id="4270917">.</span><span class="ident" id="4270918">vers</span>&nbsp;<span class="op" id="4270923">&gt;&gt;</span>&nbsp;<span class="num" id="4270926">8</span><span class="op" id="4270927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4270930">x</span><span class="op" id="4270931">[</span><span class="num" id="4270932">1</span><span class="op" id="4270933">]</span>&nbsp;<span class="op" id="4270935">=</span>&nbsp;<span class="builtintype" id="4270937">byte</span><span class="op" id="4270941">(</span><span class="ident" id="4270942">s</span><span class="op" id="4270943">.</span><span class="ident" id="4270944">vers</span><span class="op" id="4270948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4270951">x</span><span class="op" id="4270952">[</span><span class="num" id="4270953">2</span><span class="op" id="4270954">]</span>&nbsp;<span class="op" id="4270956">=</span>&nbsp;<span class="builtintype" id="4270958">byte</span><span class="op" id="4270962">(</span><span class="ident" id="4270963">s</span><span class="op" id="4270964">.</span><span class="ident" id="4270965">cipherSuite</span>&nbsp;<span class="op" id="4270977">&gt;&gt;</span>&nbsp;<span class="num" id="4270980">8</span><span class="op" id="4270981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4270984">x</span><span class="op" id="4270985">[</span><span class="num" id="4270986">3</span><span class="op" id="4270987">]</span>&nbsp;<span class="op" id="4270989">=</span>&nbsp;<span class="builtintype" id="4270991">byte</span><span class="op" id="4270995">(</span><span class="ident" id="4270996">s</span><span class="op" id="4270997">.</span><span class="ident" id="4270998">cipherSuite</span><span class="op" id="4271009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4271012">x</span><span class="op" id="4271013">[</span><span class="num" id="4271014">4</span><span class="op" id="4271015">]</span>&nbsp;<span class="op" id="4271017">=</span>&nbsp;<span class="builtintype" id="4271019">byte</span><span class="op" id="4271023">(</span><span class="builtinfunc" id="4271024">len</span><span class="op" id="4271027">(</span><span class="ident" id="4271028">s</span><span class="op" id="4271029">.</span><span class="ident" id="4271030">masterSecret</span><span class="op" id="4271042">)</span>&nbsp;<span class="op" id="4271044">&gt;&gt;</span>&nbsp;<span class="num" id="4271047">8</span><span class="op" id="4271048">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4271051">x</span><span class="op" id="4271052">[</span><span class="num" id="4271053">5</span><span class="op" id="4271054">]</span>&nbsp;<span class="op" id="4271056">=</span>&nbsp;<span class="builtintype" id="4271058">byte</span><span class="op" id="4271062">(</span><span class="builtinfunc" id="4271063">len</span><span class="op" id="4271066">(</span><span class="ident" id="4271067">s</span><span class="op" id="4271068">.</span><span class="ident" id="4271069">masterSecret</span><span class="op" id="4271081">)</span><span class="op" id="4271082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4271085">x</span>&nbsp;<span class="op" id="4271087">=</span>&nbsp;<span class="ident" id="4271089">x</span><span class="op" id="4271090">[</span><span class="num" id="4271091">6</span><span class="op" id="4271092">:</span><span class="op" id="4271093">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4271096">copy</span><span class="op" id="4271100">(</span><span class="ident" id="4271101">x</span><span class="op" id="4271102">,</span>&nbsp;<span class="ident" id="4271104">s</span><span class="op" id="4271105">.</span><span class="ident" id="4271106">masterSecret</span><span class="op" id="4271118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4271121">x</span>&nbsp;<span class="op" id="4271123">=</span>&nbsp;<span class="ident" id="4271125">x</span><span class="op" id="4271126">[</span><span class="builtinfunc" id="4271127">len</span><span class="op" id="4271130">(</span><span class="ident" id="4271131">s</span><span class="op" id="4271132">.</span><span class="ident" id="4271133">masterSecret</span><span class="op" id="4271145">)</span><span class="op" id="4271146">:</span><span class="op" id="4271147">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4271151">x</span><span class="op" id="4271152">[</span><span class="num" id="4271153">0</span><span class="op" id="4271154">]</span>&nbsp;<span class="op" id="4271156">=</span>&nbsp;<span class="builtintype" id="4271158">byte</span><span class="op" id="4271162">(</span><span class="builtinfunc" id="4271163">len</span><span class="op" id="4271166">(</span><span class="ident" id="4271167">s</span><span class="op" id="4271168">.</span><span class="ident" id="4271169">certificates</span><span class="op" id="4271181">)</span>&nbsp;<span class="op" id="4271183">&gt;&gt;</span>&nbsp;<span class="num" id="4271186">8</span><span class="op" id="4271187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4271190">x</span><span class="op" id="4271191">[</span><span class="num" id="4271192">1</span><span class="op" id="4271193">]</span>&nbsp;<span class="op" id="4271195">=</span>&nbsp;<span class="builtintype" id="4271197">byte</span><span class="op" id="4271201">(</span><span class="builtinfunc" id="4271202">len</span><span class="op" id="4271205">(</span><span class="ident" id="4271206">s</span><span class="op" id="4271207">.</span><span class="ident" id="4271208">certificates</span><span class="op" id="4271220">)</span><span class="op" id="4271221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4271224">x</span>&nbsp;<span class="op" id="4271226">=</span>&nbsp;<span class="ident" id="4271228">x</span><span class="op" id="4271229">[</span><span class="num" id="4271230">2</span><span class="op" id="4271231">:</span><span class="op" id="4271232">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4271236">for</span>&nbsp;<span class="ident" id="4271240">_</span><span class="op" id="4271241">,</span>&nbsp;<span class="ident" id="4271243">cert</span>&nbsp;<span class="op" id="4271248">:=</span>&nbsp;<span class="keyword" id="4271251">range</span>&nbsp;<span class="ident" id="4271257">s</span><span class="op" id="4271258">.</span><span class="ident" id="4271259">certificates</span>&nbsp;<span class="op" id="4271272">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4271276">x</span><span class="op" id="4271277">[</span><span class="num" id="4271278">0</span><span class="op" id="4271279">]</span>&nbsp;<span class="op" id="4271281">=</span>&nbsp;<span class="builtintype" id="4271283">byte</span><span class="op" id="4271287">(</span><span class="builtinfunc" id="4271288">len</span><span class="op" id="4271291">(</span><span class="ident" id="4271292">cert</span><span class="op" id="4271296">)</span>&nbsp;<span class="op" id="4271298">&gt;&gt;</span>&nbsp;<span class="num" id="4271301">24</span><span class="op" id="4271303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4271307">x</span><span class="op" id="4271308">[</span><span class="num" id="4271309">1</span><span class="op" id="4271310">]</span>&nbsp;<span class="op" id="4271312">=</span>&nbsp;<span class="builtintype" id="4271314">byte</span><span class="op" id="4271318">(</span><span class="builtinfunc" id="4271319">len</span><span class="op" id="4271322">(</span><span class="ident" id="4271323">cert</span><span class="op" id="4271327">)</span>&nbsp;<span class="op" id="4271329">&gt;&gt;</span>&nbsp;<span class="num" id="4271332">16</span><span class="op" id="4271334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4271338">x</span><span class="op" id="4271339">[</span><span class="num" id="4271340">2</span><span class="op" id="4271341">]</span>&nbsp;<span class="op" id="4271343">=</span>&nbsp;<span class="builtintype" id="4271345">byte</span><span class="op" id="4271349">(</span><span class="builtinfunc" id="4271350">len</span><span class="op" id="4271353">(</span><span class="ident" id="4271354">cert</span><span class="op" id="4271358">)</span>&nbsp;<span class="op" id="4271360">&gt;&gt;</span>&nbsp;<span class="num" id="4271363">8</span><span class="op" id="4271364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4271368">x</span><span class="op" id="4271369">[</span><span class="num" id="4271370">3</span><span class="op" id="4271371">]</span>&nbsp;<span class="op" id="4271373">=</span>&nbsp;<span class="builtintype" id="4271375">byte</span><span class="op" id="4271379">(</span><span class="builtinfunc" id="4271380">len</span><span class="op" id="4271383">(</span><span class="ident" id="4271384">cert</span><span class="op" id="4271388">)</span><span class="op" id="4271389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4271393">copy</span><span class="op" id="4271397">(</span><span class="ident" id="4271398">x</span><span class="op" id="4271399">[</span><span class="num" id="4271400">4</span><span class="op" id="4271401">:</span><span class="op" id="4271402">]</span><span class="op" id="4271403">,</span>&nbsp;<span class="ident" id="4271405">cert</span><span class="op" id="4271409">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4271413">x</span>&nbsp;<span class="op" id="4271415">=</span>&nbsp;<span class="ident" id="4271417">x</span><span class="op" id="4271418">[</span><span class="num" id="4271419">4</span><span class="op" id="4271420">+</span><span class="builtinfunc" id="4271421">len</span><span class="op" id="4271424">(</span><span class="ident" id="4271425">cert</span><span class="op" id="4271429">)</span><span class="op" id="4271430">:</span><span class="op" id="4271431">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4271434">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4271438">return</span>&nbsp;<span class="ident" id="4271445">ret</span><br>
<span class="lineno"></span><span class="op" id="4271449">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="keyword" id="4271452">func</span>&nbsp;<span class="op" id="4271457">(</span><span class="ident" id="4271458">s</span>&nbsp;<span class="op" id="4271460">*</span><span class="ident" id="4271461">sessionState</span><span class="op" id="4271473">)</span>&nbsp;<span class="ident" id="4271475">unmarshal</span><span class="op" id="4271484">(</span><span class="ident" id="4271485">data</span>&nbsp;<span class="op" id="4271490">[</span><span class="op" id="4271491">]</span><span class="builtintype" id="4271492">byte</span><span class="op" id="4271496">)</span>&nbsp;<span class="builtintype" id="4271498">bool</span>&nbsp;<span class="op" id="4271503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4271506">if</span>&nbsp;<span class="builtinfunc" id="4271509">len</span><span class="op" id="4271512">(</span><span class="ident" id="4271513">data</span><span class="op" id="4271517">)</span>&nbsp;<span class="op" id="4271519">&lt;</span>&nbsp;<span class="num" id="4271521">8</span>&nbsp;<span class="op" id="4271523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4271527">return</span>&nbsp;<span class="builtintype" id="4271534">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4271541">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4271545">s</span><span class="op" id="4271546">.</span><span class="ident" id="4271547">vers</span>&nbsp;<span class="op" id="4271552">=</span>&nbsp;<span class="builtintype" id="4271554">uint16</span><span class="op" id="4271560">(</span><span class="ident" id="4271561">data</span><span class="op" id="4271565">[</span><span class="num" id="4271566">0</span><span class="op" id="4271567">]</span><span class="op" id="4271568">)</span><span class="op" id="4271569">&lt;&lt;</span><span class="num" id="4271571">8</span>&nbsp;<span class="op" id="4271573">|</span>&nbsp;<span class="builtintype" id="4271575">uint16</span><span class="op" id="4271581">(</span><span class="ident" id="4271582">data</span><span class="op" id="4271586">[</span><span class="num" id="4271587">1</span><span class="op" id="4271588">]</span><span class="op" id="4271589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4271592">s</span><span class="op" id="4271593">.</span><span class="ident" id="4271594">cipherSuite</span>&nbsp;<span class="op" id="4271606">=</span>&nbsp;<span class="builtintype" id="4271608">uint16</span><span class="op" id="4271614">(</span><span class="ident" id="4271615">data</span><span class="op" id="4271619">[</span><span class="num" id="4271620">2</span><span class="op" id="4271621">]</span><span class="op" id="4271622">)</span><span class="op" id="4271623">&lt;&lt;</span><span class="num" id="4271625">8</span>&nbsp;<span class="op" id="4271627">|</span>&nbsp;<span class="builtintype" id="4271629">uint16</span><span class="op" id="4271635">(</span><span class="ident" id="4271636">data</span><span class="op" id="4271640">[</span><span class="num" id="4271641">3</span><span class="op" id="4271642">]</span><span class="op" id="4271643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4271646">masterSecretLen</span>&nbsp;<span class="op" id="4271662">:=</span>&nbsp;<span class="builtintype" id="4271665">int</span><span class="op" id="4271668">(</span><span class="ident" id="4271669">data</span><span class="op" id="4271673">[</span><span class="num" id="4271674">4</span><span class="op" id="4271675">]</span><span class="op" id="4271676">)</span><span class="op" id="4271677">&lt;&lt;</span><span class="num" id="4271679">8</span>&nbsp;<span class="op" id="4271681">|</span>&nbsp;<span class="builtintype" id="4271683">int</span><span class="op" id="4271686">(</span><span class="ident" id="4271687">data</span><span class="op" id="4271691">[</span><span class="num" id="4271692">5</span><span class="op" id="4271693">]</span><span class="op" id="4271694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4271697">data</span>&nbsp;<span class="op" id="4271702">=</span>&nbsp;<span class="ident" id="4271704">data</span><span class="op" id="4271708">[</span><span class="num" id="4271709">6</span><span class="op" id="4271710">:</span><span class="op" id="4271711">]</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4271714">if</span>&nbsp;<span class="builtinfunc" id="4271717">len</span><span class="op" id="4271720">(</span><span class="ident" id="4271721">data</span><span class="op" id="4271725">)</span>&nbsp;<span class="op" id="4271727">&lt;</span>&nbsp;<span class="ident" id="4271729">masterSecretLen</span>&nbsp;<span class="op" id="4271745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4271749">return</span>&nbsp;<span class="builtintype" id="4271756">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4271763">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4271767">s</span><span class="op" id="4271768">.</span><span class="ident" id="4271769">masterSecret</span>&nbsp;<span class="op" id="4271782">=</span>&nbsp;<span class="ident" id="4271784">data</span><span class="op" id="4271788">[</span><span class="op" id="4271789">:</span><span class="ident" id="4271790">masterSecretLen</span><span class="op" id="4271805">]</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4271808">data</span>&nbsp;<span class="op" id="4271813">=</span>&nbsp;<span class="ident" id="4271815">data</span><span class="op" id="4271819">[</span><span class="ident" id="4271820">masterSecretLen</span><span class="op" id="4271835">:</span><span class="op" id="4271836">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4271840">if</span>&nbsp;<span class="builtinfunc" id="4271843">len</span><span class="op" id="4271846">(</span><span class="ident" id="4271847">data</span><span class="op" id="4271851">)</span>&nbsp;<span class="op" id="4271853">&lt;</span>&nbsp;<span class="num" id="4271855">2</span>&nbsp;<span class="op" id="4271857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4271861">return</span>&nbsp;<span class="builtintype" id="4271868">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4271875">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4271879">numCerts</span>&nbsp;<span class="op" id="4271888">:=</span>&nbsp;<span class="builtintype" id="4271891">int</span><span class="op" id="4271894">(</span><span class="ident" id="4271895">data</span><span class="op" id="4271899">[</span><span class="num" id="4271900">0</span><span class="op" id="4271901">]</span><span class="op" id="4271902">)</span><span class="op" id="4271903">&lt;&lt;</span><span class="num" id="4271905">8</span>&nbsp;<span class="op" id="4271907">|</span>&nbsp;<span class="builtintype" id="4271909">int</span><span class="op" id="4271912">(</span><span class="ident" id="4271913">data</span><span class="op" id="4271917">[</span><span class="num" id="4271918">1</span><span class="op" id="4271919">]</span><span class="op" id="4271920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4271923">data</span>&nbsp;<span class="op" id="4271928">=</span>&nbsp;<span class="ident" id="4271930">data</span><span class="op" id="4271934">[</span><span class="num" id="4271935">2</span><span class="op" id="4271936">:</span><span class="op" id="4271937">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4271941">s</span><span class="op" id="4271942">.</span><span class="ident" id="4271943">certificates</span>&nbsp;<span class="op" id="4271956">=</span>&nbsp;<span class="builtinfunc" id="4271958">make</span><span class="op" id="4271962">(</span><span class="op" id="4271963">[</span><span class="op" id="4271964">]</span><span class="op" id="4271965">[</span><span class="op" id="4271966">]</span><span class="builtintype" id="4271967">byte</span><span class="op" id="4271971">,</span>&nbsp;<span class="ident" id="4271973">numCerts</span><span class="op" id="4271981">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4271984">for</span>&nbsp;<span class="ident" id="4271988">i</span>&nbsp;<span class="op" id="4271990">:=</span>&nbsp;<span class="keyword" id="4271993">range</span>&nbsp;<span class="ident" id="4271999">s</span><span class="op" id="4272000">.</span><span class="ident" id="4272001">certificates</span>&nbsp;<span class="op" id="4272014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4272018">if</span>&nbsp;<span class="builtinfunc" id="4272021">len</span><span class="op" id="4272024">(</span><span class="ident" id="4272025">data</span><span class="op" id="4272029">)</span>&nbsp;<span class="op" id="4272031">&lt;</span>&nbsp;<span class="num" id="4272033">4</span>&nbsp;<span class="op" id="4272035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4272040">return</span>&nbsp;<span class="builtintype" id="4272047">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4272055">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4272059">certLen</span>&nbsp;<span class="op" id="4272067">:=</span>&nbsp;<span class="builtintype" id="4272070">int</span><span class="op" id="4272073">(</span><span class="ident" id="4272074">data</span><span class="op" id="4272078">[</span><span class="num" id="4272079">0</span><span class="op" id="4272080">]</span><span class="op" id="4272081">)</span><span class="op" id="4272082">&lt;&lt;</span><span class="num" id="4272084">24</span>&nbsp;<span class="op" id="4272087">|</span>&nbsp;<span class="builtintype" id="4272089">int</span><span class="op" id="4272092">(</span><span class="ident" id="4272093">data</span><span class="op" id="4272097">[</span><span class="num" id="4272098">1</span><span class="op" id="4272099">]</span><span class="op" id="4272100">)</span><span class="op" id="4272101">&lt;&lt;</span><span class="num" id="4272103">16</span>&nbsp;<span class="op" id="4272106">|</span>&nbsp;<span class="builtintype" id="4272108">int</span><span class="op" id="4272111">(</span><span class="ident" id="4272112">data</span><span class="op" id="4272116">[</span><span class="num" id="4272117">2</span><span class="op" id="4272118">]</span><span class="op" id="4272119">)</span><span class="op" id="4272120">&lt;&lt;</span><span class="num" id="4272122">8</span>&nbsp;<span class="op" id="4272124">|</span>&nbsp;<span class="builtintype" id="4272126">int</span><span class="op" id="4272129">(</span><span class="ident" id="4272130">data</span><span class="op" id="4272134">[</span><span class="num" id="4272135">3</span><span class="op" id="4272136">]</span><span class="op" id="4272137">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4272141">data</span>&nbsp;<span class="op" id="4272146">=</span>&nbsp;<span class="ident" id="4272148">data</span><span class="op" id="4272152">[</span><span class="num" id="4272153">4</span><span class="op" id="4272154">:</span><span class="op" id="4272155">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4272159">if</span>&nbsp;<span class="ident" id="4272162">certLen</span>&nbsp;<span class="op" id="4272170">&lt;</span>&nbsp;<span class="num" id="4272172">0</span>&nbsp;<span class="op" id="4272174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4272179">return</span>&nbsp;<span class="builtintype" id="4272186">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4272194">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4272198">if</span>&nbsp;<span class="builtinfunc" id="4272201">len</span><span class="op" id="4272204">(</span><span class="ident" id="4272205">data</span><span class="op" id="4272209">)</span>&nbsp;<span class="op" id="4272211">&lt;</span>&nbsp;<span class="ident" id="4272213">certLen</span>&nbsp;<span class="op" id="4272221">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4272226">return</span>&nbsp;<span class="builtintype" id="4272233">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4272241">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4272245">s</span><span class="op" id="4272246">.</span><span class="ident" id="4272247">certificates</span><span class="op" id="4272259">[</span><span class="ident" id="4272260">i</span><span class="op" id="4272261">]</span>&nbsp;<span class="op" id="4272263">=</span>&nbsp;<span class="ident" id="4272265">data</span><span class="op" id="4272269">[</span><span class="op" id="4272270">:</span><span class="ident" id="4272271">certLen</span><span class="op" id="4272278">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4272282">data</span>&nbsp;<span class="op" id="4272287">=</span>&nbsp;<span class="ident" id="4272289">data</span><span class="op" id="4272293">[</span><span class="ident" id="4272294">certLen</span><span class="op" id="4272301">:</span><span class="op" id="4272302">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4272305">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4272309">if</span>&nbsp;<span class="builtinfunc" id="4272312">len</span><span class="op" id="4272315">(</span><span class="ident" id="4272316">data</span><span class="op" id="4272320">)</span>&nbsp;<span class="op" id="4272322">&gt;</span>&nbsp;<span class="num" id="4272324">0</span>&nbsp;<span class="op" id="4272326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4272330">return</span>&nbsp;<span class="builtintype" id="4272337">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4272344">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4272348">return</span>&nbsp;<span class="builtintype" id="4272355">true</span><br>
<span class="lineno"></span><span class="op" id="4272360">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4272363">func</span>&nbsp;<span class="op" id="4272368">(</span><span class="ident" id="4272369">c</span>&nbsp;<span class="op" id="4272371">*</span><span class="ident" id="4272372">Conn</span><span class="op" id="4272376">)</span>&nbsp;<span class="ident" id="4272378">encryptTicket</span><span class="op" id="4272391">(</span><span class="ident" id="4272392">state</span>&nbsp;<span class="op" id="4272398">*</span><span class="ident" id="4272399">sessionState</span><span class="op" id="4272411">)</span>&nbsp;<span class="op" id="4272413">(</span><span class="op" id="4272414">[</span><span class="op" id="4272415">]</span><span class="builtintype" id="4272416">byte</span><span class="op" id="4272420">,</span>&nbsp;<span class="builtintype" id="4272422">error</span><span class="op" id="4272427">)</span>&nbsp;<span class="op" id="4272429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4272432">serialized</span>&nbsp;<span class="op" id="4272443">:=</span>&nbsp;<span class="ident" id="4272446">state</span><span class="op" id="4272451">.</span><span class="ident" id="4272452">marshal</span><span class="op" id="4272459">(</span><span class="op" id="4272460">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4272463">encrypted</span>&nbsp;<span class="op" id="4272473">:=</span>&nbsp;<span class="builtinfunc" id="4272476">make</span><span class="op" id="4272480">(</span><span class="op" id="4272481">[</span><span class="op" id="4272482">]</span><span class="builtintype" id="4272483">byte</span><span class="op" id="4272487">,</span>&nbsp;<span class="ident" id="4272489">aes</span><span class="op" id="4272492">.</span><span class="ident" id="4272493">BlockSize</span><span class="op" id="4272502">+</span><span class="builtinfunc" id="4272503">len</span><span class="op" id="4272506">(</span><span class="ident" id="4272507">serialized</span><span class="op" id="4272517">)</span><span class="op" id="4272518">+</span><span class="ident" id="4272519">sha256</span><span class="op" id="4272525">.</span><span class="ident" id="4272526">Size</span><span class="op" id="4272530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4272533">iv</span>&nbsp;<span class="op" id="4272536">:=</span>&nbsp;<span class="ident" id="4272539">encrypted</span><span class="op" id="4272548">[</span><span class="op" id="4272549">:</span><span class="ident" id="4272550">aes</span><span class="op" id="4272553">.</span><span class="ident" id="4272554">BlockSize</span><span class="op" id="4272563">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4272566">macBytes</span>&nbsp;<span class="op" id="4272575">:=</span>&nbsp;<span class="ident" id="4272578">encrypted</span><span class="op" id="4272587">[</span><span class="builtinfunc" id="4272588">len</span><span class="op" id="4272591">(</span><span class="ident" id="4272592">encrypted</span><span class="op" id="4272601">)</span><span class="op" id="4272602">-</span><span class="ident" id="4272603">sha256</span><span class="op" id="4272609">.</span><span class="ident" id="4272610">Size</span><span class="op" id="4272614">:</span><span class="op" id="4272615">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4272619">if</span>&nbsp;<span class="ident" id="4272622">_</span><span class="op" id="4272623">,</span>&nbsp;<span class="ident" id="4272625">err</span>&nbsp;<span class="op" id="4272629">:=</span>&nbsp;<span class="ident" id="4272632">io</span><span class="op" id="4272634">.</span><span class="ident" id="4272635">ReadFull</span><span class="op" id="4272643">(</span><span class="ident" id="4272644">c</span><span class="op" id="4272645">.</span><span class="ident" id="4272646">config</span><span class="op" id="4272652">.</span><span class="ident" id="4272653">rand</span><span class="op" id="4272657">(</span><span class="op" id="4272658">)</span><span class="op" id="4272659">,</span>&nbsp;<span class="ident" id="4272661">iv</span><span class="op" id="4272663">)</span><span class="op" id="4272664">;</span>&nbsp;<span class="ident" id="4272666">err</span>&nbsp;<span class="op" id="4272670">!=</span>&nbsp;<span class="ident" id="4272673">nil</span>&nbsp;<span class="op" id="4272677">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4272681">return</span>&nbsp;<span class="ident" id="4272688">nil</span><span class="op" id="4272691">,</span>&nbsp;<span class="ident" id="4272693">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4272698">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4272701">block</span><span class="op" id="4272706">,</span>&nbsp;<span class="ident" id="4272708">err</span>&nbsp;<span class="op" id="4272712">:=</span>&nbsp;<span class="ident" id="4272715">aes</span><span class="op" id="4272718">.</span><span class="ident" id="4272719">NewCipher</span><span class="op" id="4272728">(</span><span class="ident" id="4272729">c</span><span class="op" id="4272730">.</span><span class="ident" id="4272731">config</span><span class="op" id="4272737">.</span><span class="ident" id="4272738">SessionTicketKey</span><span class="op" id="4272754">[</span><span class="op" id="4272755">:</span><span class="num" id="4272756">16</span><span class="op" id="4272758">]</span><span class="op" id="4272759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4272762">if</span>&nbsp;<span class="ident" id="4272765">err</span>&nbsp;<span class="op" id="4272769">!=</span>&nbsp;<span class="ident" id="4272772">nil</span>&nbsp;<span class="op" id="4272776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4272780">return</span>&nbsp;<span class="ident" id="4272787">nil</span><span class="op" id="4272790">,</span>&nbsp;<span class="ident" id="4272792">errors</span><span class="op" id="4272798">.</span><span class="ident" id="4272799">New</span><span class="op" id="4272802">(</span><span class="string" id="4272803">&#34;tls:&nbsp;failed&nbsp;to&nbsp;create&nbsp;cipher&nbsp;while&nbsp;encrypting&nbsp;ticket:&nbsp;&#34;</span>&nbsp;<span class="op" id="4272860">+</span>&nbsp;<span class="ident" id="4272862">err</span><span class="op" id="4272865">.</span><span class="ident" id="4272866">Error</span><span class="op" id="4272871">(</span><span class="op" id="4272872">)</span><span class="op" id="4272873">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4272876">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4272879">cipher</span><span class="op" id="4272885">.</span><span class="ident" id="4272886">NewCTR</span><span class="op" id="4272892">(</span><span class="ident" id="4272893">block</span><span class="op" id="4272898">,</span>&nbsp;<span class="ident" id="4272900">iv</span><span class="op" id="4272902">)</span><span class="op" id="4272903">.</span><span class="ident" id="4272904">XORKeyStream</span><span class="op" id="4272916">(</span><span class="ident" id="4272917">encrypted</span><span class="op" id="4272926">[</span><span class="ident" id="4272927">aes</span><span class="op" id="4272930">.</span><span class="ident" id="4272931">BlockSize</span><span class="op" id="4272940">:</span><span class="op" id="4272941">]</span><span class="op" id="4272942">,</span>&nbsp;<span class="ident" id="4272944">serialized</span><span class="op" id="4272954">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4272958">mac</span>&nbsp;<span class="op" id="4272962">:=</span>&nbsp;<span class="ident" id="4272965">hmac</span><span class="op" id="4272969">.</span><span class="ident" id="4272970">New</span><span class="op" id="4272973">(</span><span class="ident" id="4272974">sha256</span><span class="op" id="4272980">.</span><span class="ident" id="4272981">New</span><span class="op" id="4272984">,</span>&nbsp;<span class="ident" id="4272986">c</span><span class="op" id="4272987">.</span><span class="ident" id="4272988">config</span><span class="op" id="4272994">.</span><span class="ident" id="4272995">SessionTicketKey</span><span class="op" id="4273011">[</span><span class="num" id="4273012">16</span><span class="op" id="4273014">:</span><span class="num" id="4273015">32</span><span class="op" id="4273017">]</span><span class="op" id="4273018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4273021">mac</span><span class="op" id="4273024">.</span><span class="ident" id="4273025">Write</span><span class="op" id="4273030">(</span><span class="ident" id="4273031">encrypted</span><span class="op" id="4273040">[</span><span class="op" id="4273041">:</span><span class="builtinfunc" id="4273042">len</span><span class="op" id="4273045">(</span><span class="ident" id="4273046">encrypted</span><span class="op" id="4273055">)</span><span class="op" id="4273056">-</span><span class="ident" id="4273057">sha256</span><span class="op" id="4273063">.</span><span class="ident" id="4273064">Size</span><span class="op" id="4273068">]</span><span class="op" id="4273069">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4273072">mac</span><span class="op" id="4273075">.</span><span class="ident" id="4273076">Sum</span><span class="op" id="4273079">(</span><span class="ident" id="4273080">macBytes</span><span class="op" id="4273088">[</span><span class="op" id="4273089">:</span><span class="num" id="4273090">0</span><span class="op" id="4273091">]</span><span class="op" id="4273092">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4273096">return</span>&nbsp;<span class="ident" id="4273103">encrypted</span><span class="op" id="4273112">,</span>&nbsp;<span class="ident" id="4273114">nil</span><br>
<span class="lineno"></span><span class="op" id="4273118">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span><span class="keyword" id="4273121">func</span>&nbsp;<span class="op" id="4273126">(</span><span class="ident" id="4273127">c</span>&nbsp;<span class="op" id="4273129">*</span><span class="ident" id="4273130">Conn</span><span class="op" id="4273134">)</span>&nbsp;<span class="ident" id="4273136">decryptTicket</span><span class="op" id="4273149">(</span><span class="ident" id="4273150">encrypted</span>&nbsp;<span class="op" id="4273160">[</span><span class="op" id="4273161">]</span><span class="builtintype" id="4273162">byte</span><span class="op" id="4273166">)</span>&nbsp;<span class="op" id="4273168">(</span><span class="op" id="4273169">*</span><span class="ident" id="4273170">sessionState</span><span class="op" id="4273182">,</span>&nbsp;<span class="builtintype" id="4273184">bool</span><span class="op" id="4273188">)</span>&nbsp;<span class="op" id="4273190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4273193">if</span>&nbsp;<span class="ident" id="4273196">c</span><span class="op" id="4273197">.</span><span class="ident" id="4273198">config</span><span class="op" id="4273204">.</span><span class="ident" id="4273205">SessionTicketsDisabled</span>&nbsp;<span class="op" id="4273228">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4273233">len</span><span class="op" id="4273236">(</span><span class="ident" id="4273237">encrypted</span><span class="op" id="4273246">)</span>&nbsp;<span class="op" id="4273248">&lt;</span>&nbsp;<span class="ident" id="4273250">aes</span><span class="op" id="4273253">.</span><span class="ident" id="4273254">BlockSize</span><span class="op" id="4273263">+</span><span class="ident" id="4273264">sha256</span><span class="op" id="4273270">.</span><span class="ident" id="4273271">Size</span>&nbsp;<span class="op" id="4273276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4273280">return</span>&nbsp;<span class="ident" id="4273287">nil</span><span class="op" id="4273290">,</span>&nbsp;<span class="builtintype" id="4273292">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4273299">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4273303">iv</span>&nbsp;<span class="op" id="4273306">:=</span>&nbsp;<span class="ident" id="4273309">encrypted</span><span class="op" id="4273318">[</span><span class="op" id="4273319">:</span><span class="ident" id="4273320">aes</span><span class="op" id="4273323">.</span><span class="ident" id="4273324">BlockSize</span><span class="op" id="4273333">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4273336">macBytes</span>&nbsp;<span class="op" id="4273345">:=</span>&nbsp;<span class="ident" id="4273348">encrypted</span><span class="op" id="4273357">[</span><span class="builtinfunc" id="4273358">len</span><span class="op" id="4273361">(</span><span class="ident" id="4273362">encrypted</span><span class="op" id="4273371">)</span><span class="op" id="4273372">-</span><span class="ident" id="4273373">sha256</span><span class="op" id="4273379">.</span><span class="ident" id="4273380">Size</span><span class="op" id="4273384">:</span><span class="op" id="4273385">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4273389">mac</span>&nbsp;<span class="op" id="4273393">:=</span>&nbsp;<span class="ident" id="4273396">hmac</span><span class="op" id="4273400">.</span><span class="ident" id="4273401">New</span><span class="op" id="4273404">(</span><span class="ident" id="4273405">sha256</span><span class="op" id="4273411">.</span><span class="ident" id="4273412">New</span><span class="op" id="4273415">,</span>&nbsp;<span class="ident" id="4273417">c</span><span class="op" id="4273418">.</span><span class="ident" id="4273419">config</span><span class="op" id="4273425">.</span><span class="ident" id="4273426">SessionTicketKey</span><span class="op" id="4273442">[</span><span class="num" id="4273443">16</span><span class="op" id="4273445">:</span><span class="num" id="4273446">32</span><span class="op" id="4273448">]</span><span class="op" id="4273449">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4273452">mac</span><span class="op" id="4273455">.</span><span class="ident" id="4273456">Write</span><span class="op" id="4273461">(</span><span class="ident" id="4273462">encrypted</span><span class="op" id="4273471">[</span><span class="op" id="4273472">:</span><span class="builtinfunc" id="4273473">len</span><span class="op" id="4273476">(</span><span class="ident" id="4273477">encrypted</span><span class="op" id="4273486">)</span><span class="op" id="4273487">-</span><span class="ident" id="4273488">sha256</span><span class="op" id="4273494">.</span><span class="ident" id="4273495">Size</span><span class="op" id="4273499">]</span><span class="op" id="4273500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4273503">expected</span>&nbsp;<span class="op" id="4273512">:=</span>&nbsp;<span class="ident" id="4273515">mac</span><span class="op" id="4273518">.</span><span class="ident" id="4273519">Sum</span><span class="op" id="4273522">(</span><span class="ident" id="4273523">nil</span><span class="op" id="4273526">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4273530">if</span>&nbsp;<span class="ident" id="4273533">subtle</span><span class="op" id="4273539">.</span><span class="ident" id="4273540">ConstantTimeCompare</span><span class="op" id="4273559">(</span><span class="ident" id="4273560">macBytes</span><span class="op" id="4273568">,</span>&nbsp;<span class="ident" id="4273570">expected</span><span class="op" id="4273578">)</span>&nbsp;<span class="op" id="4273580">!=</span>&nbsp;<span class="num" id="4273583">1</span>&nbsp;<span class="op" id="4273585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4273589">return</span>&nbsp;<span class="ident" id="4273596">nil</span><span class="op" id="4273599">,</span>&nbsp;<span class="builtintype" id="4273601">false</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4273608">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4273612">block</span><span class="op" id="4273617">,</span>&nbsp;<span class="ident" id="4273619">err</span>&nbsp;<span class="op" id="4273623">:=</span>&nbsp;<span class="ident" id="4273626">aes</span><span class="op" id="4273629">.</span><span class="ident" id="4273630">NewCipher</span><span class="op" id="4273639">(</span><span class="ident" id="4273640">c</span><span class="op" id="4273641">.</span><span class="ident" id="4273642">config</span><span class="op" id="4273648">.</span><span class="ident" id="4273649">SessionTicketKey</span><span class="op" id="4273665">[</span><span class="op" id="4273666">:</span><span class="num" id="4273667">16</span><span class="op" id="4273669">]</span><span class="op" id="4273670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4273673">if</span>&nbsp;<span class="ident" id="4273676">err</span>&nbsp;<span class="op" id="4273680">!=</span>&nbsp;<span class="ident" id="4273683">nil</span>&nbsp;<span class="op" id="4273687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4273691">return</span>&nbsp;<span class="ident" id="4273698">nil</span><span class="op" id="4273701">,</span>&nbsp;<span class="builtintype" id="4273703">false</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4273710">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4273713">ciphertext</span>&nbsp;<span class="op" id="4273724">:=</span>&nbsp;<span class="ident" id="4273727">encrypted</span><span class="op" id="4273736">[</span><span class="ident" id="4273737">aes</span><span class="op" id="4273740">.</span><span class="ident" id="4273741">BlockSize</span>&nbsp;<span class="op" id="4273751">:</span>&nbsp;<span class="builtinfunc" id="4273753">len</span><span class="op" id="4273756">(</span><span class="ident" id="4273757">encrypted</span><span class="op" id="4273766">)</span><span class="op" id="4273767">-</span><span class="ident" id="4273768">sha256</span><span class="op" id="4273774">.</span><span class="ident" id="4273775">Size</span><span class="op" id="4273779">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4273782">plaintext</span>&nbsp;<span class="op" id="4273792">:=</span>&nbsp;<span class="ident" id="4273795">ciphertext</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4273807">cipher</span><span class="op" id="4273813">.</span><span class="ident" id="4273814">NewCTR</span><span class="op" id="4273820">(</span><span class="ident" id="4273821">block</span><span class="op" id="4273826">,</span>&nbsp;<span class="ident" id="4273828">iv</span><span class="op" id="4273830">)</span><span class="op" id="4273831">.</span><span class="ident" id="4273832">XORKeyStream</span><span class="op" id="4273844">(</span><span class="ident" id="4273845">plaintext</span><span class="op" id="4273854">,</span>&nbsp;<span class="ident" id="4273856">ciphertext</span><span class="op" id="4273866">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4273870">state</span>&nbsp;<span class="op" id="4273876">:=</span>&nbsp;<span class="builtinfunc" id="4273879">new</span><span class="op" id="4273882">(</span><span class="ident" id="4273883">sessionState</span><span class="op" id="4273895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4273898">ok</span>&nbsp;<span class="op" id="4273901">:=</span>&nbsp;<span class="ident" id="4273904">state</span><span class="op" id="4273909">.</span><span class="ident" id="4273910">unmarshal</span><span class="op" id="4273919">(</span><span class="ident" id="4273920">plaintext</span><span class="op" id="4273929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4273932">return</span>&nbsp;<span class="ident" id="4273939">state</span><span class="op" id="4273944">,</span>&nbsp;<span class="ident" id="4273946">ok</span><br>
<span class="lineno"></span><span class="op" id="4273949">}</span>
</div>
</body>
</html>
