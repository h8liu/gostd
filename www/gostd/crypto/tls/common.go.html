<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html" class="current">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4325046">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4325101">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4325155">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4325206">package</span>&nbsp;<span class="ident" id="4325214">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4325219">import</span>&nbsp;<span class="op" id="4325226">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4325229">&#34;container/list&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4325247">&#34;crypto&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4325257">&#34;crypto/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4325272">&#34;crypto/x509&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4325287">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4325294">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4325300">&#34;math/big&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4325312">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4325323">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4325331">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="4325338">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="4325341">const</span>&nbsp;<span class="op" id="4325347">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4325350">VersionSSL30</span>&nbsp;<span class="op" id="4325363">=</span>&nbsp;<span class="num" id="4325365">0x0300</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4325373">VersionTLS10</span>&nbsp;<span class="op" id="4325386">=</span>&nbsp;<span class="num" id="4325388">0x0301</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4325396">VersionTLS11</span>&nbsp;<span class="op" id="4325409">=</span>&nbsp;<span class="num" id="4325411">0x0302</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4325419">VersionTLS12</span>&nbsp;<span class="op" id="4325432">=</span>&nbsp;<span class="num" id="4325434">0x0303</span><br>
<span class="lineno">25</span><span class="op" id="4325441">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4325444">const</span>&nbsp;<span class="op" id="4325450">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4325453">maxPlaintext</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4325469">=</span>&nbsp;<span class="num" id="4325471">16384</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4325484">//&nbsp;maximum&nbsp;plaintext&nbsp;payload&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4325521">maxCiphertext</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4325537">=</span>&nbsp;<span class="num" id="4325539">16384</span>&nbsp;<span class="op" id="4325545">+</span>&nbsp;<span class="num" id="4325547">2048</span>&nbsp;<span class="comment" id="4325552">//&nbsp;maximum&nbsp;ciphertext&nbsp;payload&nbsp;length</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4325590">recordHeaderLen</span>&nbsp;<span class="op" id="4325606">=</span>&nbsp;<span class="num" id="4325608">5</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4325621">//&nbsp;record&nbsp;header&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4325646">maxHandshake</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4325662">=</span>&nbsp;<span class="num" id="4325664">65536</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4325677">//&nbsp;maximum&nbsp;handshake&nbsp;we&nbsp;support&nbsp;(protocol&nbsp;max&nbsp;is&nbsp;16&nbsp;MB)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4325735">minVersion</span>&nbsp;<span class="op" id="4325746">=</span>&nbsp;<span class="ident" id="4325748">VersionSSL30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4325762">maxVersion</span>&nbsp;<span class="op" id="4325773">=</span>&nbsp;<span class="ident" id="4325775">VersionTLS12</span><br>
<span class="lineno">35</span><span class="op" id="4325788">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4325791">//&nbsp;TLS&nbsp;record&nbsp;types.</span><br>
<span class="lineno"></span><span class="keyword" id="4325812">type</span>&nbsp;<span class="ident" id="4325817">recordType</span>&nbsp;<span class="builtintype" id="4325828">uint8</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="4325835">const</span>&nbsp;<span class="op" id="4325841">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4325844">recordTypeChangeCipherSpec</span>&nbsp;<span class="ident" id="4325871">recordType</span>&nbsp;<span class="op" id="4325882">=</span>&nbsp;<span class="num" id="4325884">20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4325888">recordTypeAlert</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4325915">recordType</span>&nbsp;<span class="op" id="4325926">=</span>&nbsp;<span class="num" id="4325928">21</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4325932">recordTypeHandshake</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4325959">recordType</span>&nbsp;<span class="op" id="4325970">=</span>&nbsp;<span class="num" id="4325972">22</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4325976">recordTypeApplicationData</span>&nbsp;&nbsp;<span class="ident" id="4326003">recordType</span>&nbsp;<span class="op" id="4326014">=</span>&nbsp;<span class="num" id="4326016">23</span><br>
<span class="lineno">45</span><span class="op" id="4326019">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4326022">//&nbsp;TLS&nbsp;handshake&nbsp;message&nbsp;types.</span><br>
<span class="lineno"></span><span class="keyword" id="4326054">const</span>&nbsp;<span class="op" id="4326060">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4326063">typeClientHello</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4326086">uint8</span>&nbsp;<span class="op" id="4326092">=</span>&nbsp;<span class="num" id="4326094">1</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4326097">typeServerHello</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4326120">uint8</span>&nbsp;<span class="op" id="4326126">=</span>&nbsp;<span class="num" id="4326128">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4326131">typeNewSessionTicket</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4326154">uint8</span>&nbsp;<span class="op" id="4326160">=</span>&nbsp;<span class="num" id="4326162">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4326165">typeCertificate</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4326188">uint8</span>&nbsp;<span class="op" id="4326194">=</span>&nbsp;<span class="num" id="4326196">11</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4326200">typeServerKeyExchange</span>&nbsp;&nbsp;<span class="builtintype" id="4326223">uint8</span>&nbsp;<span class="op" id="4326229">=</span>&nbsp;<span class="num" id="4326231">12</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4326235">typeCertificateRequest</span>&nbsp;<span class="builtintype" id="4326258">uint8</span>&nbsp;<span class="op" id="4326264">=</span>&nbsp;<span class="num" id="4326266">13</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4326270">typeServerHelloDone</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4326293">uint8</span>&nbsp;<span class="op" id="4326299">=</span>&nbsp;<span class="num" id="4326301">14</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4326305">typeCertificateVerify</span>&nbsp;&nbsp;<span class="builtintype" id="4326328">uint8</span>&nbsp;<span class="op" id="4326334">=</span>&nbsp;<span class="num" id="4326336">15</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4326340">typeClientKeyExchange</span>&nbsp;&nbsp;<span class="builtintype" id="4326363">uint8</span>&nbsp;<span class="op" id="4326369">=</span>&nbsp;<span class="num" id="4326371">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4326375">typeFinished</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4326398">uint8</span>&nbsp;<span class="op" id="4326404">=</span>&nbsp;<span class="num" id="4326406">20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4326410">typeCertificateStatus</span>&nbsp;&nbsp;<span class="builtintype" id="4326433">uint8</span>&nbsp;<span class="op" id="4326439">=</span>&nbsp;<span class="num" id="4326441">22</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4326445">typeNextProtocol</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4326468">uint8</span>&nbsp;<span class="op" id="4326474">=</span>&nbsp;<span class="num" id="4326476">67</span>&nbsp;<span class="comment" id="4326479">//&nbsp;Not&nbsp;IANA&nbsp;assigned</span><br>
<span class="lineno"></span><span class="op" id="4326500">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4326503">//&nbsp;TLS&nbsp;compression&nbsp;types.</span><br>
<span class="lineno"></span><span class="keyword" id="4326529">const</span>&nbsp;<span class="op" id="4326535">(</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4326538">compressionNone</span>&nbsp;<span class="builtintype" id="4326554">uint8</span>&nbsp;<span class="op" id="4326560">=</span>&nbsp;<span class="num" id="4326562">0</span><br>
<span class="lineno"></span><span class="op" id="4326564">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4326567">//&nbsp;TLS&nbsp;extension&nbsp;numbers</span><br>
<span class="lineno"></span><span class="keyword" id="4326592">const</span>&nbsp;<span class="op" id="4326598">(</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4326601">extensionServerName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4326630">uint16</span>&nbsp;<span class="op" id="4326637">=</span>&nbsp;<span class="num" id="4326639">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4326642">extensionStatusRequest</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4326671">uint16</span>&nbsp;<span class="op" id="4326678">=</span>&nbsp;<span class="num" id="4326680">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4326683">extensionSupportedCurves</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4326712">uint16</span>&nbsp;<span class="op" id="4326719">=</span>&nbsp;<span class="num" id="4326721">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4326725">extensionSupportedPoints</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4326754">uint16</span>&nbsp;<span class="op" id="4326761">=</span>&nbsp;<span class="num" id="4326763">11</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4326767">extensionSignatureAlgorithms</span>&nbsp;<span class="builtintype" id="4326796">uint16</span>&nbsp;<span class="op" id="4326803">=</span>&nbsp;<span class="num" id="4326805">13</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4326809">extensionALPN</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4326838">uint16</span>&nbsp;<span class="op" id="4326845">=</span>&nbsp;<span class="num" id="4326847">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4326851">extensionSessionTicket</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4326880">uint16</span>&nbsp;<span class="op" id="4326887">=</span>&nbsp;<span class="num" id="4326889">35</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4326893">extensionNextProtoNeg</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4326922">uint16</span>&nbsp;<span class="op" id="4326929">=</span>&nbsp;<span class="num" id="4326931">13172</span>&nbsp;<span class="comment" id="4326937">//&nbsp;not&nbsp;IANA&nbsp;assigned</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4326959">extensionRenegotiationInfo</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4326988">uint16</span>&nbsp;<span class="op" id="4326995">=</span>&nbsp;<span class="num" id="4326997">0xff01</span><br>
<span class="lineno"></span><span class="op" id="4327004">)</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="comment" id="4327007">//&nbsp;TLS&nbsp;signaling&nbsp;cipher&nbsp;suite&nbsp;values</span><br>
<span class="lineno"></span><span class="keyword" id="4327044">const</span>&nbsp;<span class="op" id="4327050">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4327053">scsvRenegotiation</span>&nbsp;<span class="builtintype" id="4327071">uint16</span>&nbsp;<span class="op" id="4327078">=</span>&nbsp;<span class="num" id="4327080">0x00ff</span><br>
<span class="lineno"></span><span class="op" id="4327087">)</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="4327090">//&nbsp;CurveID&nbsp;is&nbsp;the&nbsp;type&nbsp;of&nbsp;a&nbsp;TLS&nbsp;identifier&nbsp;for&nbsp;an&nbsp;elliptic&nbsp;curve.&nbsp;See</span><br>
<span class="lineno"></span><span class="comment" id="4327160">//&nbsp;http://www.iana.org/assignments/tls-parameters/tls-parameters.xml#tls-parameters-8</span><br>
<span class="lineno"></span><span class="keyword" id="4327246">type</span>&nbsp;<span class="ident" id="4327251">CurveID</span>&nbsp;<span class="builtintype" id="4327259">uint16</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="4327267">const</span>&nbsp;<span class="op" id="4327273">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4327276">CurveP256</span>&nbsp;<span class="ident" id="4327286">CurveID</span>&nbsp;<span class="op" id="4327294">=</span>&nbsp;<span class="num" id="4327296">23</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4327300">CurveP384</span>&nbsp;<span class="ident" id="4327310">CurveID</span>&nbsp;<span class="op" id="4327318">=</span>&nbsp;<span class="num" id="4327320">24</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4327324">CurveP521</span>&nbsp;<span class="ident" id="4327334">CurveID</span>&nbsp;<span class="op" id="4327342">=</span>&nbsp;<span class="num" id="4327344">25</span><br>
<span class="lineno"></span><span class="op" id="4327347">)</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="comment" id="4327350">//&nbsp;TLS&nbsp;Elliptic&nbsp;Curve&nbsp;Point&nbsp;Formats</span><br>
<span class="lineno"></span><span class="comment" id="4327386">//&nbsp;http://www.iana.org/assignments/tls-parameters/tls-parameters.xml#tls-parameters-9</span><br>
<span class="lineno"></span><span class="keyword" id="4327472">const</span>&nbsp;<span class="op" id="4327478">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4327481">pointFormatUncompressed</span>&nbsp;<span class="builtintype" id="4327505">uint8</span>&nbsp;<span class="op" id="4327511">=</span>&nbsp;<span class="num" id="4327513">0</span><br>
<span class="lineno">100</span><span class="op" id="4327515">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4327518">//&nbsp;TLS&nbsp;CertificateStatusType&nbsp;(RFC&nbsp;3546)</span><br>
<span class="lineno"></span><span class="keyword" id="4327558">const</span>&nbsp;<span class="op" id="4327564">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4327567">statusTypeOCSP</span>&nbsp;<span class="builtintype" id="4327582">uint8</span>&nbsp;<span class="op" id="4327588">=</span>&nbsp;<span class="num" id="4327590">1</span><br>
<span class="lineno">105</span><span class="op" id="4327592">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4327595">//&nbsp;Certificate&nbsp;types&nbsp;(for&nbsp;certificateRequestMsg)</span><br>
<span class="lineno"></span><span class="keyword" id="4327644">const</span>&nbsp;<span class="op" id="4327650">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4327653">certTypeRSASign</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4327672">=</span>&nbsp;<span class="num" id="4327674">1</span>&nbsp;<span class="comment" id="4327676">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;an&nbsp;RSA&nbsp;key</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4327716">certTypeDSSSign</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4327735">=</span>&nbsp;<span class="num" id="4327737">2</span>&nbsp;<span class="comment" id="4327739">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;a&nbsp;DSA&nbsp;key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4327778">certTypeRSAFixedDH</span>&nbsp;<span class="op" id="4327797">=</span>&nbsp;<span class="num" id="4327799">3</span>&nbsp;<span class="comment" id="4327801">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;a&nbsp;static&nbsp;DH&nbsp;key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4327846">certTypeDSSFixedDH</span>&nbsp;<span class="op" id="4327865">=</span>&nbsp;<span class="num" id="4327867">4</span>&nbsp;<span class="comment" id="4327869">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;a&nbsp;static&nbsp;DH&nbsp;key</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4327915">//&nbsp;See&nbsp;RFC4492&nbsp;sections&nbsp;3&nbsp;and&nbsp;5.5.</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4327951">certTypeECDSASign</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4327974">=</span>&nbsp;<span class="num" id="4327976">64</span>&nbsp;<span class="comment" id="4327979">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;an&nbsp;ECDSA-capable&nbsp;public&nbsp;key,&nbsp;signed&nbsp;with&nbsp;ECDSA.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4328056">certTypeRSAFixedECDH</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4328079">=</span>&nbsp;<span class="num" id="4328081">65</span>&nbsp;<span class="comment" id="4328084">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;an&nbsp;ECDH-capable&nbsp;public&nbsp;key,&nbsp;signed&nbsp;with&nbsp;RSA.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4328158">certTypeECDSAFixedECDH</span>&nbsp;<span class="op" id="4328181">=</span>&nbsp;<span class="num" id="4328183">66</span>&nbsp;<span class="comment" id="4328186">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;an&nbsp;ECDH-capable&nbsp;public&nbsp;key,&nbsp;signed&nbsp;with&nbsp;ECDSA.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4328263">//&nbsp;Rest&nbsp;of&nbsp;these&nbsp;are&nbsp;reserved&nbsp;by&nbsp;the&nbsp;TLS&nbsp;spec</span><br>
<span class="lineno">120</span><span class="op" id="4328309">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4328312">//&nbsp;Hash&nbsp;functions&nbsp;for&nbsp;TLS&nbsp;1.2&nbsp;(See&nbsp;RFC&nbsp;5246,&nbsp;section&nbsp;A.4.1)</span><br>
<span class="lineno"></span><span class="keyword" id="4328372">const</span>&nbsp;<span class="op" id="4328378">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4328381">hashSHA1</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4328392">uint8</span>&nbsp;<span class="op" id="4328398">=</span>&nbsp;<span class="num" id="4328400">2</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4328403">hashSHA256</span>&nbsp;<span class="builtintype" id="4328414">uint8</span>&nbsp;<span class="op" id="4328420">=</span>&nbsp;<span class="num" id="4328422">4</span><br>
<span class="lineno"></span><span class="op" id="4328424">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4328427">//&nbsp;Signature&nbsp;algorithms&nbsp;for&nbsp;TLS&nbsp;1.2&nbsp;(See&nbsp;RFC&nbsp;5246,&nbsp;section&nbsp;A.4.1)</span><br>
<span class="lineno"></span><span class="keyword" id="4328493">const</span>&nbsp;<span class="op" id="4328499">(</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4328502">signatureRSA</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4328517">uint8</span>&nbsp;<span class="op" id="4328523">=</span>&nbsp;<span class="num" id="4328525">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4328528">signatureECDSA</span>&nbsp;<span class="builtintype" id="4328543">uint8</span>&nbsp;<span class="op" id="4328549">=</span>&nbsp;<span class="num" id="4328551">3</span><br>
<span class="lineno"></span><span class="op" id="4328553">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4328556">//&nbsp;signatureAndHash&nbsp;mirrors&nbsp;the&nbsp;TLS&nbsp;1.2,&nbsp;SignatureAndHashAlgorithm&nbsp;struct.&nbsp;See</span><br>
<span class="lineno">135</span><span class="comment" id="4328635">//&nbsp;RFC&nbsp;5246,&nbsp;section&nbsp;A.4.1.</span><br>
<span class="lineno"></span><span class="keyword" id="4328663">type</span>&nbsp;<span class="ident" id="4328668">signatureAndHash</span>&nbsp;<span class="keyword" id="4328685">struct</span>&nbsp;<span class="op" id="4328692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4328695">hash</span><span class="op" id="4328699">,</span>&nbsp;<span class="ident" id="4328701">signature</span>&nbsp;<span class="builtintype" id="4328711">uint8</span><br>
<span class="lineno"></span><span class="op" id="4328717">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span><span class="comment" id="4328720">//&nbsp;supportedSKXSignatureAlgorithms&nbsp;contains&nbsp;the&nbsp;signature&nbsp;and&nbsp;hash&nbsp;algorithms</span><br>
<span class="lineno"></span><span class="comment" id="4328798">//&nbsp;that&nbsp;the&nbsp;code&nbsp;advertises&nbsp;as&nbsp;supported&nbsp;in&nbsp;a&nbsp;TLS&nbsp;1.2&nbsp;ClientHello.</span><br>
<span class="lineno"></span><span class="keyword" id="4328865">var</span>&nbsp;<span class="ident" id="4328869">supportedSKXSignatureAlgorithms</span>&nbsp;<span class="op" id="4328901">=</span>&nbsp;<span class="op" id="4328903">[</span><span class="op" id="4328904">]</span><span class="ident" id="4328905">signatureAndHash</span><span class="op" id="4328921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4328924">{</span><span class="ident" id="4328925">hashSHA256</span><span class="op" id="4328935">,</span>&nbsp;<span class="ident" id="4328937">signatureRSA</span><span class="op" id="4328949">}</span><span class="op" id="4328950">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4328953">{</span><span class="ident" id="4328954">hashSHA256</span><span class="op" id="4328964">,</span>&nbsp;<span class="ident" id="4328966">signatureECDSA</span><span class="op" id="4328980">}</span><span class="op" id="4328981">,</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4328984">{</span><span class="ident" id="4328985">hashSHA1</span><span class="op" id="4328993">,</span>&nbsp;<span class="ident" id="4328995">signatureRSA</span><span class="op" id="4329007">}</span><span class="op" id="4329008">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4329011">{</span><span class="ident" id="4329012">hashSHA1</span><span class="op" id="4329020">,</span>&nbsp;<span class="ident" id="4329022">signatureECDSA</span><span class="op" id="4329036">}</span><span class="op" id="4329037">,</span><br>
<span class="lineno"></span><span class="op" id="4329039">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4329042">//&nbsp;supportedClientCertSignatureAlgorithms&nbsp;contains&nbsp;the&nbsp;signature&nbsp;and&nbsp;hash</span><br>
<span class="lineno">150</span><span class="comment" id="4329116">//&nbsp;algorithms&nbsp;that&nbsp;the&nbsp;code&nbsp;advertises&nbsp;as&nbsp;supported&nbsp;in&nbsp;a&nbsp;TLS&nbsp;1.2</span><br>
<span class="lineno"></span><span class="comment" id="4329181">//&nbsp;CertificateRequest.</span><br>
<span class="lineno"></span><span class="keyword" id="4329204">var</span>&nbsp;<span class="ident" id="4329208">supportedClientCertSignatureAlgorithms</span>&nbsp;<span class="op" id="4329247">=</span>&nbsp;<span class="op" id="4329249">[</span><span class="op" id="4329250">]</span><span class="ident" id="4329251">signatureAndHash</span><span class="op" id="4329267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4329270">{</span><span class="ident" id="4329271">hashSHA256</span><span class="op" id="4329281">,</span>&nbsp;<span class="ident" id="4329283">signatureRSA</span><span class="op" id="4329295">}</span><span class="op" id="4329296">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4329299">{</span><span class="ident" id="4329300">hashSHA256</span><span class="op" id="4329310">,</span>&nbsp;<span class="ident" id="4329312">signatureECDSA</span><span class="op" id="4329326">}</span><span class="op" id="4329327">,</span><br>
<span class="lineno">155</span><span class="op" id="4329329">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4329332">//&nbsp;ConnectionState&nbsp;records&nbsp;basic&nbsp;TLS&nbsp;details&nbsp;about&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="4329399">type</span>&nbsp;<span class="ident" id="4329404">ConnectionState</span>&nbsp;<span class="keyword" id="4329420">struct</span>&nbsp;<span class="op" id="4329427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4329430">Version</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4329457">uint16</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4329479">//&nbsp;TLS&nbsp;version&nbsp;used&nbsp;by&nbsp;the&nbsp;connection&nbsp;(e.g.&nbsp;VersionTLS12)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4329538">HandshakeComplete</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4329565">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4329587">//&nbsp;TLS&nbsp;handshake&nbsp;is&nbsp;complete</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4329617">DidResume</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4329644">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4329666">//&nbsp;connection&nbsp;resumes&nbsp;a&nbsp;previous&nbsp;TLS&nbsp;connection</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4329715">CipherSuite</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4329742">uint16</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4329764">//&nbsp;cipher&nbsp;suite&nbsp;in&nbsp;use&nbsp;(TLS_RSA_WITH_RC4_128_SHA,&nbsp;...)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4329820">NegotiatedProtocol</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4329847">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4329869">//&nbsp;negotiated&nbsp;next&nbsp;protocol&nbsp;(from&nbsp;Config.NextProtos)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4329923">NegotiatedProtocolIsMutual</span>&nbsp;<span class="builtintype" id="4329950">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4329972">//&nbsp;negotiated&nbsp;protocol&nbsp;was&nbsp;advertised&nbsp;by&nbsp;server</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4330021">ServerName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4330048">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4330070">//&nbsp;server&nbsp;name&nbsp;requested&nbsp;by&nbsp;client,&nbsp;if&nbsp;any&nbsp;(server&nbsp;side&nbsp;only)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4330133">PeerCertificates</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4330160">[</span><span class="op" id="4330161">]</span><span class="op" id="4330162">*</span><span class="ident" id="4330163">x509</span><span class="op" id="4330167">.</span><span class="ident" id="4330168">Certificate</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="4330182">//&nbsp;certificate&nbsp;chain&nbsp;presented&nbsp;by&nbsp;remote&nbsp;peer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4330229">VerifiedChains</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4330256">[</span><span class="op" id="4330257">]</span><span class="op" id="4330258">[</span><span class="op" id="4330259">]</span><span class="op" id="4330260">*</span><span class="ident" id="4330261">x509</span><span class="op" id="4330265">.</span><span class="ident" id="4330266">Certificate</span>&nbsp;<span class="comment" id="4330278">//&nbsp;verified&nbsp;chains&nbsp;built&nbsp;from&nbsp;PeerCertificates</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4330327">//&nbsp;TLSUnique&nbsp;contains&nbsp;the&nbsp;&#34;tls-unique&#34;&nbsp;channel&nbsp;binding&nbsp;value&nbsp;(see&nbsp;RFC</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4330398">//&nbsp;5929,&nbsp;section&nbsp;3).&nbsp;For&nbsp;resumed&nbsp;sessions&nbsp;this&nbsp;value&nbsp;will&nbsp;be&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4330464">//&nbsp;because&nbsp;resumption&nbsp;does&nbsp;not&nbsp;include&nbsp;enough&nbsp;context&nbsp;(see</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4330524">//&nbsp;https://secure-resumption.com/#channelbindings).&nbsp;This&nbsp;will&nbsp;change&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4330597">//&nbsp;future&nbsp;versions&nbsp;of&nbsp;Go&nbsp;once&nbsp;the&nbsp;TLS&nbsp;master-secret&nbsp;fix&nbsp;has&nbsp;been</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4330663">//&nbsp;standardized&nbsp;and&nbsp;implemented.</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4330697">TLSUnique</span>&nbsp;<span class="op" id="4330707">[</span><span class="op" id="4330708">]</span><span class="builtintype" id="4330709">byte</span><br>
<span class="lineno"></span><span class="op" id="4330714">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4330717">//&nbsp;ClientAuthType&nbsp;declares&nbsp;the&nbsp;policy&nbsp;the&nbsp;server&nbsp;will&nbsp;follow&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="4330782">//&nbsp;TLS&nbsp;Client&nbsp;Authentication.</span><br>
<span class="lineno">180</span><span class="keyword" id="4330812">type</span>&nbsp;<span class="ident" id="4330817">ClientAuthType</span>&nbsp;<span class="builtintype" id="4330832">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4330837">const</span>&nbsp;<span class="op" id="4330843">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4330846">NoClientCert</span>&nbsp;<span class="ident" id="4330859">ClientAuthType</span>&nbsp;<span class="op" id="4330874">=</span>&nbsp;<span class="ident" id="4330876">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4330882">RequestClientCert</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4330901">RequireAnyClientCert</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4330923">VerifyClientCertIfGiven</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4330948">RequireAndVerifyClientCert</span><br>
<span class="lineno"></span><span class="op" id="4330975">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="comment" id="4330978">//&nbsp;ClientSessionState&nbsp;contains&nbsp;the&nbsp;state&nbsp;needed&nbsp;by&nbsp;clients&nbsp;to&nbsp;resume&nbsp;TLS</span><br>
<span class="lineno"></span><span class="comment" id="4331051">//&nbsp;sessions.</span><br>
<span class="lineno"></span><span class="keyword" id="4331064">type</span>&nbsp;<span class="ident" id="4331069">ClientSessionState</span>&nbsp;<span class="keyword" id="4331088">struct</span>&nbsp;<span class="op" id="4331095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4331098">sessionTicket</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4331117">[</span><span class="op" id="4331118">]</span><span class="builtintype" id="4331119">uint8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4331137">//&nbsp;Encrypted&nbsp;ticket&nbsp;used&nbsp;for&nbsp;session&nbsp;resumption&nbsp;with&nbsp;server</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4331198">vers</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4331217">uint16</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4331237">//&nbsp;SSL/TLS&nbsp;version&nbsp;negotiated&nbsp;for&nbsp;the&nbsp;session</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4331284">cipherSuite</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4331303">uint16</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4331323">//&nbsp;Ciphersuite&nbsp;negotiated&nbsp;for&nbsp;the&nbsp;session</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4331366">masterSecret</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4331385">[</span><span class="op" id="4331386">]</span><span class="builtintype" id="4331387">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4331405">//&nbsp;MasterSecret&nbsp;generated&nbsp;by&nbsp;client&nbsp;on&nbsp;a&nbsp;full&nbsp;handshake</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4331462">serverCertificates</span>&nbsp;<span class="op" id="4331481">[</span><span class="op" id="4331482">]</span><span class="op" id="4331483">*</span><span class="ident" id="4331484">x509</span><span class="op" id="4331488">.</span><span class="ident" id="4331489">Certificate</span>&nbsp;<span class="comment" id="4331501">//&nbsp;Certificate&nbsp;chain&nbsp;presented&nbsp;by&nbsp;the&nbsp;server</span><br>
<span class="lineno"></span><span class="op" id="4331546">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span><span class="comment" id="4331549">//&nbsp;ClientSessionCache&nbsp;is&nbsp;a&nbsp;cache&nbsp;of&nbsp;ClientSessionState&nbsp;objects&nbsp;that&nbsp;can&nbsp;be&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="4331629">//&nbsp;by&nbsp;a&nbsp;client&nbsp;to&nbsp;resume&nbsp;a&nbsp;TLS&nbsp;session&nbsp;with&nbsp;a&nbsp;given&nbsp;server.&nbsp;ClientSessionCache</span><br>
<span class="lineno"></span><span class="comment" id="4331708">//&nbsp;implementations&nbsp;should&nbsp;expect&nbsp;to&nbsp;be&nbsp;called&nbsp;concurrently&nbsp;from&nbsp;different</span><br>
<span class="lineno"></span><span class="comment" id="4331782">//&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="keyword" id="4331797">type</span>&nbsp;<span class="ident" id="4331802">ClientSessionCache</span>&nbsp;<span class="keyword" id="4331821">interface</span>&nbsp;<span class="op" id="4331831">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4331834">//&nbsp;Get&nbsp;searches&nbsp;for&nbsp;a&nbsp;ClientSessionState&nbsp;associated&nbsp;with&nbsp;the&nbsp;given&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4331907">//&nbsp;On&nbsp;return,&nbsp;ok&nbsp;is&nbsp;true&nbsp;if&nbsp;one&nbsp;was&nbsp;found.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4331951">Get</span><span class="op" id="4331954">(</span><span class="ident" id="4331955">sessionKey</span>&nbsp;<span class="builtintype" id="4331966">string</span><span class="op" id="4331972">)</span>&nbsp;<span class="op" id="4331974">(</span><span class="ident" id="4331975">session</span>&nbsp;<span class="op" id="4331983">*</span><span class="ident" id="4331984">ClientSessionState</span><span class="op" id="4332002">,</span>&nbsp;<span class="ident" id="4332004">ok</span>&nbsp;<span class="builtintype" id="4332007">bool</span><span class="op" id="4332011">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4332015">//&nbsp;Put&nbsp;adds&nbsp;the&nbsp;ClientSessionState&nbsp;to&nbsp;the&nbsp;cache&nbsp;with&nbsp;the&nbsp;given&nbsp;key.</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4332084">Put</span><span class="op" id="4332087">(</span><span class="ident" id="4332088">sessionKey</span>&nbsp;<span class="builtintype" id="4332099">string</span><span class="op" id="4332105">,</span>&nbsp;<span class="ident" id="4332107">cs</span>&nbsp;<span class="op" id="4332110">*</span><span class="ident" id="4332111">ClientSessionState</span><span class="op" id="4332129">)</span><br>
<span class="lineno"></span><span class="op" id="4332131">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4332134">//&nbsp;ClientHelloInfo&nbsp;contains&nbsp;information&nbsp;from&nbsp;a&nbsp;ClientHello&nbsp;message&nbsp;in&nbsp;order&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4332213">//&nbsp;guide&nbsp;certificate&nbsp;selection&nbsp;in&nbsp;the&nbsp;GetCertificate&nbsp;callback.</span><br>
<span class="lineno">215</span><span class="keyword" id="4332276">type</span>&nbsp;<span class="ident" id="4332281">ClientHelloInfo</span>&nbsp;<span class="keyword" id="4332297">struct</span>&nbsp;<span class="op" id="4332304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4332307">//&nbsp;CipherSuites&nbsp;lists&nbsp;the&nbsp;CipherSuites&nbsp;supported&nbsp;by&nbsp;the&nbsp;client&nbsp;(e.g.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4332377">//&nbsp;TLS_RSA_WITH_RC4_128_SHA).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4332408">CipherSuites</span>&nbsp;<span class="op" id="4332421">[</span><span class="op" id="4332422">]</span><span class="builtintype" id="4332423">uint16</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4332432">//&nbsp;ServerName&nbsp;indicates&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;server&nbsp;requested&nbsp;by&nbsp;the&nbsp;client</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4332504">//&nbsp;in&nbsp;order&nbsp;to&nbsp;support&nbsp;virtual&nbsp;hosting.&nbsp;ServerName&nbsp;is&nbsp;only&nbsp;set&nbsp;if&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4332575">//&nbsp;client&nbsp;is&nbsp;using&nbsp;SNI&nbsp;(see</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4332604">//&nbsp;http://tools.ietf.org/html/rfc4366#section-3.1).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4332657">ServerName</span>&nbsp;<span class="builtintype" id="4332668">string</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4332677">//&nbsp;SupportedCurves&nbsp;lists&nbsp;the&nbsp;elliptic&nbsp;curves&nbsp;supported&nbsp;by&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4332748">//&nbsp;SupportedCurves&nbsp;is&nbsp;set&nbsp;only&nbsp;if&nbsp;the&nbsp;Supported&nbsp;Elliptic&nbsp;Curves</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4332813">//&nbsp;Extension&nbsp;is&nbsp;being&nbsp;used&nbsp;(see</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4332846">//&nbsp;http://tools.ietf.org/html/rfc4492#section-5.1.1).</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4332901">SupportedCurves</span>&nbsp;<span class="op" id="4332917">[</span><span class="op" id="4332918">]</span><span class="ident" id="4332919">CurveID</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4332929">//&nbsp;SupportedPoints&nbsp;lists&nbsp;the&nbsp;point&nbsp;formats&nbsp;supported&nbsp;by&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4332998">//&nbsp;SupportedPoints&nbsp;is&nbsp;set&nbsp;only&nbsp;if&nbsp;the&nbsp;Supported&nbsp;Point&nbsp;Formats&nbsp;Extension</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4333071">//&nbsp;is&nbsp;being&nbsp;used&nbsp;(see</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4333094">//&nbsp;http://tools.ietf.org/html/rfc4492#section-5.1.2).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4333149">SupportedPoints</span>&nbsp;<span class="op" id="4333165">[</span><span class="op" id="4333166">]</span><span class="builtintype" id="4333167">uint8</span><br>
<span class="lineno"></span><span class="op" id="4333173">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4333176">//&nbsp;A&nbsp;Config&nbsp;structure&nbsp;is&nbsp;used&nbsp;to&nbsp;configure&nbsp;a&nbsp;TLS&nbsp;client&nbsp;or&nbsp;server.</span><br>
<span class="lineno">240</span><span class="comment" id="4333243">//&nbsp;After&nbsp;one&nbsp;has&nbsp;been&nbsp;passed&nbsp;to&nbsp;a&nbsp;TLS&nbsp;function&nbsp;it&nbsp;must&nbsp;not&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="4333305">//&nbsp;modified.&nbsp;A&nbsp;Config&nbsp;may&nbsp;be&nbsp;reused;&nbsp;the&nbsp;tls&nbsp;package&nbsp;will&nbsp;also&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="4333372">//&nbsp;modify&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="4333386">type</span>&nbsp;<span class="ident" id="4333391">Config</span>&nbsp;<span class="keyword" id="4333398">struct</span>&nbsp;<span class="op" id="4333405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4333408">//&nbsp;Rand&nbsp;provides&nbsp;the&nbsp;source&nbsp;of&nbsp;entropy&nbsp;for&nbsp;nonces&nbsp;and&nbsp;RSA&nbsp;blinding.</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4333477">//&nbsp;If&nbsp;Rand&nbsp;is&nbsp;nil,&nbsp;TLS&nbsp;uses&nbsp;the&nbsp;cryptographic&nbsp;random&nbsp;reader&nbsp;in&nbsp;package</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4333549">//&nbsp;crypto/rand.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4333566">//&nbsp;The&nbsp;Reader&nbsp;must&nbsp;be&nbsp;safe&nbsp;for&nbsp;use&nbsp;by&nbsp;multiple&nbsp;goroutines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4333626">Rand</span>&nbsp;<span class="ident" id="4333631">io</span><span class="op" id="4333633">.</span><span class="ident" id="4333634">Reader</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4333643">//&nbsp;Time&nbsp;returns&nbsp;the&nbsp;current&nbsp;time&nbsp;as&nbsp;the&nbsp;number&nbsp;of&nbsp;seconds&nbsp;since&nbsp;the&nbsp;epoch.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4333719">//&nbsp;If&nbsp;Time&nbsp;is&nbsp;nil,&nbsp;TLS&nbsp;uses&nbsp;time.Now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4333758">Time</span>&nbsp;<span class="keyword" id="4333763">func</span><span class="op" id="4333767">(</span><span class="op" id="4333768">)</span>&nbsp;<span class="ident" id="4333770">time</span><span class="op" id="4333774">.</span><span class="ident" id="4333775">Time</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4333782">//&nbsp;Certificates&nbsp;contains&nbsp;one&nbsp;or&nbsp;more&nbsp;certificate&nbsp;chains</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4333839">//&nbsp;to&nbsp;present&nbsp;to&nbsp;the&nbsp;other&nbsp;side&nbsp;of&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4333891">//&nbsp;Server&nbsp;configurations&nbsp;must&nbsp;include&nbsp;at&nbsp;least&nbsp;one&nbsp;certificate.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4333956">Certificates</span>&nbsp;<span class="op" id="4333969">[</span><span class="op" id="4333970">]</span><span class="ident" id="4333971">Certificate</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4333985">//&nbsp;NameToCertificate&nbsp;maps&nbsp;from&nbsp;a&nbsp;certificate&nbsp;name&nbsp;to&nbsp;an&nbsp;element&nbsp;of</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4334053">//&nbsp;Certificates.&nbsp;Note&nbsp;that&nbsp;a&nbsp;certificate&nbsp;name&nbsp;can&nbsp;be&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4334119">//&nbsp;&#39;*.example.com&#39;&nbsp;and&nbsp;so&nbsp;doesn&#39;t&nbsp;have&nbsp;to&nbsp;be&nbsp;a&nbsp;domain&nbsp;name&nbsp;as&nbsp;such.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4334188">//&nbsp;See&nbsp;Config.BuildNameToCertificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4334226">//&nbsp;The&nbsp;nil&nbsp;value&nbsp;causes&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Certificates&nbsp;to&nbsp;be&nbsp;used</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4334296">//&nbsp;for&nbsp;all&nbsp;connections.</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4334321">NameToCertificate</span>&nbsp;<span class="keyword" id="4334339">map</span><span class="op" id="4334342">[</span><span class="builtintype" id="4334343">string</span><span class="op" id="4334349">]</span><span class="op" id="4334350">*</span><span class="ident" id="4334351">Certificate</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4334365">//&nbsp;GetCertificate&nbsp;returns&nbsp;a&nbsp;Certificate&nbsp;based&nbsp;on&nbsp;the&nbsp;given</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4334425">//&nbsp;ClientHelloInfo.&nbsp;If&nbsp;GetCertificate&nbsp;is&nbsp;nil&nbsp;or&nbsp;returns&nbsp;nil,&nbsp;then&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4334496">//&nbsp;certificate&nbsp;is&nbsp;retrieved&nbsp;from&nbsp;NameToCertificate.&nbsp;If</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4334552">//&nbsp;NameToCertificate&nbsp;is&nbsp;nil,&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Certificates&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4334624">//&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4334634">GetCertificate</span>&nbsp;<span class="keyword" id="4334649">func</span><span class="op" id="4334653">(</span><span class="ident" id="4334654">clientHello</span>&nbsp;<span class="op" id="4334666">*</span><span class="ident" id="4334667">ClientHelloInfo</span><span class="op" id="4334682">)</span>&nbsp;<span class="op" id="4334684">(</span><span class="op" id="4334685">*</span><span class="ident" id="4334686">Certificate</span><span class="op" id="4334697">,</span>&nbsp;<span class="builtintype" id="4334699">error</span><span class="op" id="4334704">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4334708">//&nbsp;RootCAs&nbsp;defines&nbsp;the&nbsp;set&nbsp;of&nbsp;root&nbsp;certificate&nbsp;authorities</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4334768">//&nbsp;that&nbsp;clients&nbsp;use&nbsp;when&nbsp;verifying&nbsp;server&nbsp;certificates.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4334825">//&nbsp;If&nbsp;RootCAs&nbsp;is&nbsp;nil,&nbsp;TLS&nbsp;uses&nbsp;the&nbsp;host&#39;s&nbsp;root&nbsp;CA&nbsp;set.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4334881">RootCAs</span>&nbsp;<span class="op" id="4334889">*</span><span class="ident" id="4334890">x509</span><span class="op" id="4334894">.</span><span class="ident" id="4334895">CertPool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4334906">//&nbsp;NextProtos&nbsp;is&nbsp;a&nbsp;list&nbsp;of&nbsp;supported,&nbsp;application&nbsp;level&nbsp;protocols.</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4334974">NextProtos</span>&nbsp;<span class="op" id="4334985">[</span><span class="op" id="4334986">]</span><span class="builtintype" id="4334987">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4334996">//&nbsp;ServerName&nbsp;is&nbsp;used&nbsp;to&nbsp;verify&nbsp;the&nbsp;hostname&nbsp;on&nbsp;the&nbsp;returned</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4335058">//&nbsp;certificates&nbsp;unless&nbsp;InsecureSkipVerify&nbsp;is&nbsp;given.&nbsp;It&nbsp;is&nbsp;also&nbsp;included</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4335131">//&nbsp;in&nbsp;the&nbsp;client&#39;s&nbsp;handshake&nbsp;to&nbsp;support&nbsp;virtual&nbsp;hosting.</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4335189">ServerName</span>&nbsp;<span class="builtintype" id="4335200">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4335209">//&nbsp;ClientAuth&nbsp;determines&nbsp;the&nbsp;server&#39;s&nbsp;policy&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4335259">//&nbsp;TLS&nbsp;Client&nbsp;Authentication.&nbsp;The&nbsp;default&nbsp;is&nbsp;NoClientCert.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4335319">ClientAuth</span>&nbsp;<span class="ident" id="4335330">ClientAuthType</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4335347">//&nbsp;ClientCAs&nbsp;defines&nbsp;the&nbsp;set&nbsp;of&nbsp;root&nbsp;certificate&nbsp;authorities</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4335409">//&nbsp;that&nbsp;servers&nbsp;use&nbsp;if&nbsp;required&nbsp;to&nbsp;verify&nbsp;a&nbsp;client&nbsp;certificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4335473">//&nbsp;by&nbsp;the&nbsp;policy&nbsp;in&nbsp;ClientAuth.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4335506">ClientCAs</span>&nbsp;<span class="op" id="4335516">*</span><span class="ident" id="4335517">x509</span><span class="op" id="4335521">.</span><span class="ident" id="4335522">CertPool</span><br>
<span class="lineno">295</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4335533">//&nbsp;InsecureSkipVerify&nbsp;controls&nbsp;whether&nbsp;a&nbsp;client&nbsp;verifies&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4335595">//&nbsp;server&#39;s&nbsp;certificate&nbsp;chain&nbsp;and&nbsp;host&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4335641">//&nbsp;If&nbsp;InsecureSkipVerify&nbsp;is&nbsp;true,&nbsp;TLS&nbsp;accepts&nbsp;any&nbsp;certificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4335704">//&nbsp;presented&nbsp;by&nbsp;the&nbsp;server&nbsp;and&nbsp;any&nbsp;host&nbsp;name&nbsp;in&nbsp;that&nbsp;certificate.</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4335771">//&nbsp;In&nbsp;this&nbsp;mode,&nbsp;TLS&nbsp;is&nbsp;susceptible&nbsp;to&nbsp;man-in-the-middle&nbsp;attacks.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4335838">//&nbsp;This&nbsp;should&nbsp;be&nbsp;used&nbsp;only&nbsp;for&nbsp;testing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4335880">InsecureSkipVerify</span>&nbsp;<span class="builtintype" id="4335899">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4335906">//&nbsp;CipherSuites&nbsp;is&nbsp;a&nbsp;list&nbsp;of&nbsp;supported&nbsp;cipher&nbsp;suites.&nbsp;If&nbsp;CipherSuites</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4335977">//&nbsp;is&nbsp;nil,&nbsp;TLS&nbsp;uses&nbsp;a&nbsp;list&nbsp;of&nbsp;suites&nbsp;supported&nbsp;by&nbsp;the&nbsp;implementation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4336048">CipherSuites</span>&nbsp;<span class="op" id="4336061">[</span><span class="op" id="4336062">]</span><span class="builtintype" id="4336063">uint16</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4336072">//&nbsp;PreferServerCipherSuites&nbsp;controls&nbsp;whether&nbsp;the&nbsp;server&nbsp;selects&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4336141">//&nbsp;client&#39;s&nbsp;most&nbsp;preferred&nbsp;ciphersuite,&nbsp;or&nbsp;the&nbsp;server&#39;s&nbsp;most&nbsp;preferred</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4336213">//&nbsp;ciphersuite.&nbsp;If&nbsp;true&nbsp;then&nbsp;the&nbsp;server&#39;s&nbsp;preference,&nbsp;as&nbsp;expressed&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4336284">//&nbsp;the&nbsp;order&nbsp;of&nbsp;elements&nbsp;in&nbsp;CipherSuites,&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4336336">PreferServerCipherSuites</span>&nbsp;<span class="builtintype" id="4336361">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4336368">//&nbsp;SessionTicketsDisabled&nbsp;may&nbsp;be&nbsp;set&nbsp;to&nbsp;true&nbsp;to&nbsp;disable&nbsp;session&nbsp;ticket</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4336440">//&nbsp;(resumption)&nbsp;support.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4336466">SessionTicketsDisabled</span>&nbsp;<span class="builtintype" id="4336489">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4336496">//&nbsp;SessionTicketKey&nbsp;is&nbsp;used&nbsp;by&nbsp;TLS&nbsp;servers&nbsp;to&nbsp;provide&nbsp;session</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4336559">//&nbsp;resumption.&nbsp;See&nbsp;RFC&nbsp;5077.&nbsp;If&nbsp;zero,&nbsp;it&nbsp;will&nbsp;be&nbsp;filled&nbsp;with</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4336621">//&nbsp;random&nbsp;data&nbsp;before&nbsp;the&nbsp;first&nbsp;server&nbsp;handshake.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4336672">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4336676">//&nbsp;If&nbsp;multiple&nbsp;servers&nbsp;are&nbsp;terminating&nbsp;connections&nbsp;for&nbsp;the&nbsp;same&nbsp;host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4336746">//&nbsp;they&nbsp;should&nbsp;all&nbsp;have&nbsp;the&nbsp;same&nbsp;SessionTicketKey.&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4336805">//&nbsp;SessionTicketKey&nbsp;leaks,&nbsp;previously&nbsp;recorded&nbsp;and&nbsp;future&nbsp;TLS</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4336868">//&nbsp;connections&nbsp;using&nbsp;that&nbsp;key&nbsp;are&nbsp;compromised.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4336916">SessionTicketKey</span>&nbsp;<span class="op" id="4336933">[</span><span class="num" id="4336934">32</span><span class="op" id="4336936">]</span><span class="builtintype" id="4336937">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4336944">//&nbsp;SessionCache&nbsp;is&nbsp;a&nbsp;cache&nbsp;of&nbsp;ClientSessionState&nbsp;entries&nbsp;for&nbsp;TLS&nbsp;session</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4337018">//&nbsp;resumption.</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4337034">ClientSessionCache</span>&nbsp;<span class="ident" id="4337053">ClientSessionCache</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4337074">//&nbsp;MinVersion&nbsp;contains&nbsp;the&nbsp;minimum&nbsp;SSL/TLS&nbsp;version&nbsp;that&nbsp;is&nbsp;acceptable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4337146">//&nbsp;If&nbsp;zero,&nbsp;then&nbsp;SSLv3&nbsp;is&nbsp;taken&nbsp;as&nbsp;the&nbsp;minimum.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4337195">MinVersion</span>&nbsp;<span class="builtintype" id="4337206">uint16</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4337215">//&nbsp;MaxVersion&nbsp;contains&nbsp;the&nbsp;maximum&nbsp;SSL/TLS&nbsp;version&nbsp;that&nbsp;is&nbsp;acceptable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4337287">//&nbsp;If&nbsp;zero,&nbsp;then&nbsp;the&nbsp;maximum&nbsp;version&nbsp;supported&nbsp;by&nbsp;this&nbsp;package&nbsp;is&nbsp;used,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4337360">//&nbsp;which&nbsp;is&nbsp;currently&nbsp;TLS&nbsp;1.2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4337392">MaxVersion</span>&nbsp;<span class="builtintype" id="4337403">uint16</span><br>
<span class="lineno">340</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4337412">//&nbsp;CurvePreferences&nbsp;contains&nbsp;the&nbsp;elliptic&nbsp;curves&nbsp;that&nbsp;will&nbsp;be&nbsp;used&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4337483">//&nbsp;an&nbsp;ECDHE&nbsp;handshake,&nbsp;in&nbsp;preference&nbsp;order.&nbsp;If&nbsp;empty,&nbsp;the&nbsp;default&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4337555">//&nbsp;be&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4337568">CurvePreferences</span>&nbsp;<span class="op" id="4337585">[</span><span class="op" id="4337586">]</span><span class="ident" id="4337587">CurveID</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4337597">serverInitOnce</span>&nbsp;<span class="ident" id="4337612">sync</span><span class="op" id="4337616">.</span><span class="ident" id="4337617">Once</span>&nbsp;<span class="comment" id="4337622">//&nbsp;guards&nbsp;calling&nbsp;(*Config).serverInit</span><br>
<span class="lineno"></span><span class="op" id="4337661">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4337664">func</span>&nbsp;<span class="op" id="4337669">(</span><span class="ident" id="4337670">c</span>&nbsp;<span class="op" id="4337672">*</span><span class="ident" id="4337673">Config</span><span class="op" id="4337679">)</span>&nbsp;<span class="ident" id="4337681">serverInit</span><span class="op" id="4337691">(</span><span class="op" id="4337692">)</span>&nbsp;<span class="op" id="4337694">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4337697">if</span>&nbsp;<span class="ident" id="4337700">c</span><span class="op" id="4337701">.</span><span class="ident" id="4337702">SessionTicketsDisabled</span>&nbsp;<span class="op" id="4337725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4337729">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4337737">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4337741">//&nbsp;If&nbsp;the&nbsp;key&nbsp;has&nbsp;already&nbsp;been&nbsp;set&nbsp;then&nbsp;we&nbsp;have&nbsp;nothing&nbsp;to&nbsp;do.</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4337805">for</span>&nbsp;<span class="ident" id="4337809">_</span><span class="op" id="4337810">,</span>&nbsp;<span class="ident" id="4337812">b</span>&nbsp;<span class="op" id="4337814">:=</span>&nbsp;<span class="keyword" id="4337817">range</span>&nbsp;<span class="ident" id="4337823">c</span><span class="op" id="4337824">.</span><span class="ident" id="4337825">SessionTicketKey</span>&nbsp;<span class="op" id="4337842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4337846">if</span>&nbsp;<span class="ident" id="4337849">b</span>&nbsp;<span class="op" id="4337851">!=</span>&nbsp;<span class="num" id="4337854">0</span>&nbsp;<span class="op" id="4337856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4337861">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4337870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4337873">}</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4337877">if</span>&nbsp;<span class="ident" id="4337880">_</span><span class="op" id="4337881">,</span>&nbsp;<span class="ident" id="4337883">err</span>&nbsp;<span class="op" id="4337887">:=</span>&nbsp;<span class="ident" id="4337890">io</span><span class="op" id="4337892">.</span><span class="ident" id="4337893">ReadFull</span><span class="op" id="4337901">(</span><span class="ident" id="4337902">c</span><span class="op" id="4337903">.</span><span class="ident" id="4337904">rand</span><span class="op" id="4337908">(</span><span class="op" id="4337909">)</span><span class="op" id="4337910">,</span>&nbsp;<span class="ident" id="4337912">c</span><span class="op" id="4337913">.</span><span class="ident" id="4337914">SessionTicketKey</span><span class="op" id="4337930">[</span><span class="op" id="4337931">:</span><span class="op" id="4337932">]</span><span class="op" id="4337933">)</span><span class="op" id="4337934">;</span>&nbsp;<span class="ident" id="4337936">err</span>&nbsp;<span class="op" id="4337940">!=</span>&nbsp;<span class="builtintype" id="4337943">nil</span>&nbsp;<span class="op" id="4337947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4337951">c</span><span class="op" id="4337952">.</span><span class="ident" id="4337953">SessionTicketsDisabled</span>&nbsp;<span class="op" id="4337976">=</span>&nbsp;<span class="builtintype" id="4337978">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4337984">}</span><br>
<span class="lineno"></span><span class="op" id="4337986">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="keyword" id="4337989">func</span>&nbsp;<span class="op" id="4337994">(</span><span class="ident" id="4337995">c</span>&nbsp;<span class="op" id="4337997">*</span><span class="ident" id="4337998">Config</span><span class="op" id="4338004">)</span>&nbsp;<span class="ident" id="4338006">rand</span><span class="op" id="4338010">(</span><span class="op" id="4338011">)</span>&nbsp;<span class="ident" id="4338013">io</span><span class="op" id="4338015">.</span><span class="ident" id="4338016">Reader</span>&nbsp;<span class="op" id="4338023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4338026">r</span>&nbsp;<span class="op" id="4338028">:=</span>&nbsp;<span class="ident" id="4338031">c</span><span class="op" id="4338032">.</span><span class="ident" id="4338033">Rand</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4338039">if</span>&nbsp;<span class="ident" id="4338042">r</span>&nbsp;<span class="op" id="4338044">==</span>&nbsp;<span class="builtintype" id="4338047">nil</span>&nbsp;<span class="op" id="4338051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4338055">return</span>&nbsp;<span class="ident" id="4338062">rand</span><span class="op" id="4338066">.</span><span class="ident" id="4338067">Reader</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4338075">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4338078">return</span>&nbsp;<span class="ident" id="4338085">r</span><br>
<span class="lineno"></span><span class="op" id="4338087">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4338090">func</span>&nbsp;<span class="op" id="4338095">(</span><span class="ident" id="4338096">c</span>&nbsp;<span class="op" id="4338098">*</span><span class="ident" id="4338099">Config</span><span class="op" id="4338105">)</span>&nbsp;<span class="ident" id="4338107">time</span><span class="op" id="4338111">(</span><span class="op" id="4338112">)</span>&nbsp;<span class="ident" id="4338114">time</span><span class="op" id="4338118">.</span><span class="ident" id="4338119">Time</span>&nbsp;<span class="op" id="4338124">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4338127">t</span>&nbsp;<span class="op" id="4338129">:=</span>&nbsp;<span class="ident" id="4338132">c</span><span class="op" id="4338133">.</span><span class="ident" id="4338134">Time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4338140">if</span>&nbsp;<span class="ident" id="4338143">t</span>&nbsp;<span class="op" id="4338145">==</span>&nbsp;<span class="builtintype" id="4338148">nil</span>&nbsp;<span class="op" id="4338152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4338156">t</span>&nbsp;<span class="op" id="4338158">=</span>&nbsp;<span class="ident" id="4338160">time</span><span class="op" id="4338164">.</span><span class="ident" id="4338165">Now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4338170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4338173">return</span>&nbsp;<span class="ident" id="4338180">t</span><span class="op" id="4338181">(</span><span class="op" id="4338182">)</span><br>
<span class="lineno">380</span><span class="op" id="4338184">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4338187">func</span>&nbsp;<span class="op" id="4338192">(</span><span class="ident" id="4338193">c</span>&nbsp;<span class="op" id="4338195">*</span><span class="ident" id="4338196">Config</span><span class="op" id="4338202">)</span>&nbsp;<span class="ident" id="4338204">cipherSuites</span><span class="op" id="4338216">(</span><span class="op" id="4338217">)</span>&nbsp;<span class="op" id="4338219">[</span><span class="op" id="4338220">]</span><span class="builtintype" id="4338221">uint16</span>&nbsp;<span class="op" id="4338228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4338231">s</span>&nbsp;<span class="op" id="4338233">:=</span>&nbsp;<span class="ident" id="4338236">c</span><span class="op" id="4338237">.</span><span class="ident" id="4338238">CipherSuites</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4338252">if</span>&nbsp;<span class="ident" id="4338255">s</span>&nbsp;<span class="op" id="4338257">==</span>&nbsp;<span class="builtintype" id="4338260">nil</span>&nbsp;<span class="op" id="4338264">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4338268">s</span>&nbsp;<span class="op" id="4338270">=</span>&nbsp;<span class="ident" id="4338272">defaultCipherSuites</span><span class="op" id="4338291">(</span><span class="op" id="4338292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4338295">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4338298">return</span>&nbsp;<span class="ident" id="4338305">s</span><br>
<span class="lineno"></span><span class="op" id="4338307">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">390</span><span class="keyword" id="4338310">func</span>&nbsp;<span class="op" id="4338315">(</span><span class="ident" id="4338316">c</span>&nbsp;<span class="op" id="4338318">*</span><span class="ident" id="4338319">Config</span><span class="op" id="4338325">)</span>&nbsp;<span class="ident" id="4338327">minVersion</span><span class="op" id="4338337">(</span><span class="op" id="4338338">)</span>&nbsp;<span class="builtintype" id="4338340">uint16</span>&nbsp;<span class="op" id="4338347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4338350">if</span>&nbsp;<span class="ident" id="4338353">c</span>&nbsp;<span class="op" id="4338355">==</span>&nbsp;<span class="builtintype" id="4338358">nil</span>&nbsp;<span class="op" id="4338362">||</span>&nbsp;<span class="ident" id="4338365">c</span><span class="op" id="4338366">.</span><span class="ident" id="4338367">MinVersion</span>&nbsp;<span class="op" id="4338378">==</span>&nbsp;<span class="num" id="4338381">0</span>&nbsp;<span class="op" id="4338383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4338387">return</span>&nbsp;<span class="ident" id="4338394">minVersion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4338406">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4338409">return</span>&nbsp;<span class="ident" id="4338416">c</span><span class="op" id="4338417">.</span><span class="ident" id="4338418">MinVersion</span><br>
<span class="lineno">395</span><span class="op" id="4338429">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4338432">func</span>&nbsp;<span class="op" id="4338437">(</span><span class="ident" id="4338438">c</span>&nbsp;<span class="op" id="4338440">*</span><span class="ident" id="4338441">Config</span><span class="op" id="4338447">)</span>&nbsp;<span class="ident" id="4338449">maxVersion</span><span class="op" id="4338459">(</span><span class="op" id="4338460">)</span>&nbsp;<span class="builtintype" id="4338462">uint16</span>&nbsp;<span class="op" id="4338469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4338472">if</span>&nbsp;<span class="ident" id="4338475">c</span>&nbsp;<span class="op" id="4338477">==</span>&nbsp;<span class="builtintype" id="4338480">nil</span>&nbsp;<span class="op" id="4338484">||</span>&nbsp;<span class="ident" id="4338487">c</span><span class="op" id="4338488">.</span><span class="ident" id="4338489">MaxVersion</span>&nbsp;<span class="op" id="4338500">==</span>&nbsp;<span class="num" id="4338503">0</span>&nbsp;<span class="op" id="4338505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4338509">return</span>&nbsp;<span class="ident" id="4338516">maxVersion</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4338528">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4338531">return</span>&nbsp;<span class="ident" id="4338538">c</span><span class="op" id="4338539">.</span><span class="ident" id="4338540">MaxVersion</span><br>
<span class="lineno"></span><span class="op" id="4338551">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4338554">var</span>&nbsp;<span class="ident" id="4338558">defaultCurvePreferences</span>&nbsp;<span class="op" id="4338582">=</span>&nbsp;<span class="op" id="4338584">[</span><span class="op" id="4338585">]</span><span class="ident" id="4338586">CurveID</span><span class="op" id="4338593">{</span><span class="ident" id="4338594">CurveP256</span><span class="op" id="4338603">,</span>&nbsp;<span class="ident" id="4338605">CurveP384</span><span class="op" id="4338614">,</span>&nbsp;<span class="ident" id="4338616">CurveP521</span><span class="op" id="4338625">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="keyword" id="4338628">func</span>&nbsp;<span class="op" id="4338633">(</span><span class="ident" id="4338634">c</span>&nbsp;<span class="op" id="4338636">*</span><span class="ident" id="4338637">Config</span><span class="op" id="4338643">)</span>&nbsp;<span class="ident" id="4338645">curvePreferences</span><span class="op" id="4338661">(</span><span class="op" id="4338662">)</span>&nbsp;<span class="op" id="4338664">[</span><span class="op" id="4338665">]</span><span class="ident" id="4338666">CurveID</span>&nbsp;<span class="op" id="4338674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4338677">if</span>&nbsp;<span class="ident" id="4338680">c</span>&nbsp;<span class="op" id="4338682">==</span>&nbsp;<span class="builtintype" id="4338685">nil</span>&nbsp;<span class="op" id="4338689">||</span>&nbsp;<span class="builtinfunc" id="4338692">len</span><span class="op" id="4338695">(</span><span class="ident" id="4338696">c</span><span class="op" id="4338697">.</span><span class="ident" id="4338698">CurvePreferences</span><span class="op" id="4338714">)</span>&nbsp;<span class="op" id="4338716">==</span>&nbsp;<span class="num" id="4338719">0</span>&nbsp;<span class="op" id="4338721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4338725">return</span>&nbsp;<span class="ident" id="4338732">defaultCurvePreferences</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4338757">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4338760">return</span>&nbsp;<span class="ident" id="4338767">c</span><span class="op" id="4338768">.</span><span class="ident" id="4338769">CurvePreferences</span><br>
<span class="lineno"></span><span class="op" id="4338786">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4338789">//&nbsp;mutualVersion&nbsp;returns&nbsp;the&nbsp;protocol&nbsp;version&nbsp;to&nbsp;use&nbsp;given&nbsp;the&nbsp;advertised</span><br>
<span class="lineno"></span><span class="comment" id="4338863">//&nbsp;version&nbsp;of&nbsp;the&nbsp;peer.</span><br>
<span class="lineno">415</span><span class="keyword" id="4338887">func</span>&nbsp;<span class="op" id="4338892">(</span><span class="ident" id="4338893">c</span>&nbsp;<span class="op" id="4338895">*</span><span class="ident" id="4338896">Config</span><span class="op" id="4338902">)</span>&nbsp;<span class="ident" id="4338904">mutualVersion</span><span class="op" id="4338917">(</span><span class="ident" id="4338918">vers</span>&nbsp;<span class="builtintype" id="4338923">uint16</span><span class="op" id="4338929">)</span>&nbsp;<span class="op" id="4338931">(</span><span class="builtintype" id="4338932">uint16</span><span class="op" id="4338938">,</span>&nbsp;<span class="builtintype" id="4338940">bool</span><span class="op" id="4338944">)</span>&nbsp;<span class="op" id="4338946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4338949">minVersion</span>&nbsp;<span class="op" id="4338960">:=</span>&nbsp;<span class="ident" id="4338963">c</span><span class="op" id="4338964">.</span><span class="ident" id="4338965">minVersion</span><span class="op" id="4338975">(</span><span class="op" id="4338976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4338979">maxVersion</span>&nbsp;<span class="op" id="4338990">:=</span>&nbsp;<span class="ident" id="4338993">c</span><span class="op" id="4338994">.</span><span class="ident" id="4338995">maxVersion</span><span class="op" id="4339005">(</span><span class="op" id="4339006">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4339010">if</span>&nbsp;<span class="ident" id="4339013">vers</span>&nbsp;<span class="op" id="4339018">&lt;</span>&nbsp;<span class="ident" id="4339020">minVersion</span>&nbsp;<span class="op" id="4339031">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4339035">return</span>&nbsp;<span class="num" id="4339042">0</span><span class="op" id="4339043">,</span>&nbsp;<span class="builtintype" id="4339045">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4339052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4339055">if</span>&nbsp;<span class="ident" id="4339058">vers</span>&nbsp;<span class="op" id="4339063">&gt;</span>&nbsp;<span class="ident" id="4339065">maxVersion</span>&nbsp;<span class="op" id="4339076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4339080">vers</span>&nbsp;<span class="op" id="4339085">=</span>&nbsp;<span class="ident" id="4339087">maxVersion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4339099">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4339102">return</span>&nbsp;<span class="ident" id="4339109">vers</span><span class="op" id="4339113">,</span>&nbsp;<span class="builtintype" id="4339115">true</span><br>
<span class="lineno"></span><span class="op" id="4339120">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4339123">//&nbsp;getCertificate&nbsp;returns&nbsp;the&nbsp;best&nbsp;certificate&nbsp;for&nbsp;the&nbsp;given&nbsp;ClientHelloInfo,</span><br>
<span class="lineno"></span><span class="comment" id="4339201">//&nbsp;defaulting&nbsp;to&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;c.Certificates.</span><br>
<span class="lineno">430</span><span class="keyword" id="4339255">func</span>&nbsp;<span class="op" id="4339260">(</span><span class="ident" id="4339261">c</span>&nbsp;<span class="op" id="4339263">*</span><span class="ident" id="4339264">Config</span><span class="op" id="4339270">)</span>&nbsp;<span class="ident" id="4339272">getCertificate</span><span class="op" id="4339286">(</span><span class="ident" id="4339287">clientHello</span>&nbsp;<span class="op" id="4339299">*</span><span class="ident" id="4339300">ClientHelloInfo</span><span class="op" id="4339315">)</span>&nbsp;<span class="op" id="4339317">(</span><span class="op" id="4339318">*</span><span class="ident" id="4339319">Certificate</span><span class="op" id="4339330">,</span>&nbsp;<span class="builtintype" id="4339332">error</span><span class="op" id="4339337">)</span>&nbsp;<span class="op" id="4339339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4339342">if</span>&nbsp;<span class="ident" id="4339345">c</span><span class="op" id="4339346">.</span><span class="ident" id="4339347">GetCertificate</span>&nbsp;<span class="op" id="4339362">!=</span>&nbsp;<span class="builtintype" id="4339365">nil</span>&nbsp;<span class="op" id="4339369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4339373">cert</span><span class="op" id="4339377">,</span>&nbsp;<span class="ident" id="4339379">err</span>&nbsp;<span class="op" id="4339383">:=</span>&nbsp;<span class="ident" id="4339386">c</span><span class="op" id="4339387">.</span><span class="ident" id="4339388">GetCertificate</span><span class="op" id="4339402">(</span><span class="ident" id="4339403">clientHello</span><span class="op" id="4339414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4339418">if</span>&nbsp;<span class="ident" id="4339421">cert</span>&nbsp;<span class="op" id="4339426">!=</span>&nbsp;<span class="builtintype" id="4339429">nil</span>&nbsp;<span class="op" id="4339433">||</span>&nbsp;<span class="ident" id="4339436">err</span>&nbsp;<span class="op" id="4339440">!=</span>&nbsp;<span class="builtintype" id="4339443">nil</span>&nbsp;<span class="op" id="4339447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4339452">return</span>&nbsp;<span class="ident" id="4339459">cert</span><span class="op" id="4339463">,</span>&nbsp;<span class="ident" id="4339465">err</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4339471">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4339474">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4339478">if</span>&nbsp;<span class="builtinfunc" id="4339481">len</span><span class="op" id="4339484">(</span><span class="ident" id="4339485">c</span><span class="op" id="4339486">.</span><span class="ident" id="4339487">Certificates</span><span class="op" id="4339499">)</span>&nbsp;<span class="op" id="4339501">==</span>&nbsp;<span class="num" id="4339504">1</span>&nbsp;<span class="op" id="4339506">||</span>&nbsp;<span class="ident" id="4339509">c</span><span class="op" id="4339510">.</span><span class="ident" id="4339511">NameToCertificate</span>&nbsp;<span class="op" id="4339529">==</span>&nbsp;<span class="builtintype" id="4339532">nil</span>&nbsp;<span class="op" id="4339536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4339540">//&nbsp;There&#39;s&nbsp;only&nbsp;one&nbsp;choice,&nbsp;so&nbsp;no&nbsp;point&nbsp;doing&nbsp;any&nbsp;work.</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4339598">return</span>&nbsp;<span class="op" id="4339605">&amp;</span><span class="ident" id="4339606">c</span><span class="op" id="4339607">.</span><span class="ident" id="4339608">Certificates</span><span class="op" id="4339620">[</span><span class="num" id="4339621">0</span><span class="op" id="4339622">]</span><span class="op" id="4339623">,</span>&nbsp;<span class="builtintype" id="4339625">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4339630">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4339634">name</span>&nbsp;<span class="op" id="4339639">:=</span>&nbsp;<span class="ident" id="4339642">strings</span><span class="op" id="4339649">.</span><span class="ident" id="4339650">ToLower</span><span class="op" id="4339657">(</span><span class="ident" id="4339658">clientHello</span><span class="op" id="4339669">.</span><span class="ident" id="4339670">ServerName</span><span class="op" id="4339680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4339683">for</span>&nbsp;<span class="builtinfunc" id="4339687">len</span><span class="op" id="4339690">(</span><span class="ident" id="4339691">name</span><span class="op" id="4339695">)</span>&nbsp;<span class="op" id="4339697">&gt;</span>&nbsp;<span class="num" id="4339699">0</span>&nbsp;<span class="op" id="4339701">&amp;&amp;</span>&nbsp;<span class="ident" id="4339704">name</span><span class="op" id="4339708">[</span><span class="builtinfunc" id="4339709">len</span><span class="op" id="4339712">(</span><span class="ident" id="4339713">name</span><span class="op" id="4339717">)</span><span class="op" id="4339718">-</span><span class="num" id="4339719">1</span><span class="op" id="4339720">]</span>&nbsp;<span class="op" id="4339722">==</span>&nbsp;<span class="string" id="4339725">&#39;.&#39;</span>&nbsp;<span class="op" id="4339729">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4339733">name</span>&nbsp;<span class="op" id="4339738">=</span>&nbsp;<span class="ident" id="4339740">name</span><span class="op" id="4339744">[</span><span class="op" id="4339745">:</span><span class="builtinfunc" id="4339746">len</span><span class="op" id="4339749">(</span><span class="ident" id="4339750">name</span><span class="op" id="4339754">)</span><span class="op" id="4339755">-</span><span class="num" id="4339756">1</span><span class="op" id="4339757">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4339760">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4339764">if</span>&nbsp;<span class="ident" id="4339767">cert</span><span class="op" id="4339771">,</span>&nbsp;<span class="ident" id="4339773">ok</span>&nbsp;<span class="op" id="4339776">:=</span>&nbsp;<span class="ident" id="4339779">c</span><span class="op" id="4339780">.</span><span class="ident" id="4339781">NameToCertificate</span><span class="op" id="4339798">[</span><span class="ident" id="4339799">name</span><span class="op" id="4339803">]</span><span class="op" id="4339804">;</span>&nbsp;<span class="ident" id="4339806">ok</span>&nbsp;<span class="op" id="4339809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4339813">return</span>&nbsp;<span class="ident" id="4339820">cert</span><span class="op" id="4339824">,</span>&nbsp;<span class="builtintype" id="4339826">nil</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4339831">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4339835">//&nbsp;try&nbsp;replacing&nbsp;labels&nbsp;in&nbsp;the&nbsp;name&nbsp;with&nbsp;wildcards&nbsp;until&nbsp;we&nbsp;get&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4339902">//&nbsp;match.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4339913">labels</span>&nbsp;<span class="op" id="4339920">:=</span>&nbsp;<span class="ident" id="4339923">strings</span><span class="op" id="4339930">.</span><span class="ident" id="4339931">Split</span><span class="op" id="4339936">(</span><span class="ident" id="4339937">name</span><span class="op" id="4339941">,</span>&nbsp;<span class="string" id="4339943">&#34;.&#34;</span><span class="op" id="4339946">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4339949">for</span>&nbsp;<span class="ident" id="4339953">i</span>&nbsp;<span class="op" id="4339955">:=</span>&nbsp;<span class="keyword" id="4339958">range</span>&nbsp;<span class="ident" id="4339964">labels</span>&nbsp;<span class="op" id="4339971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4339975">labels</span><span class="op" id="4339981">[</span><span class="ident" id="4339982">i</span><span class="op" id="4339983">]</span>&nbsp;<span class="op" id="4339985">=</span>&nbsp;<span class="string" id="4339987">&#34;*&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4339993">candidate</span>&nbsp;<span class="op" id="4340003">:=</span>&nbsp;<span class="ident" id="4340006">strings</span><span class="op" id="4340013">.</span><span class="ident" id="4340014">Join</span><span class="op" id="4340018">(</span><span class="ident" id="4340019">labels</span><span class="op" id="4340025">,</span>&nbsp;<span class="string" id="4340027">&#34;.&#34;</span><span class="op" id="4340030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4340034">if</span>&nbsp;<span class="ident" id="4340037">cert</span><span class="op" id="4340041">,</span>&nbsp;<span class="ident" id="4340043">ok</span>&nbsp;<span class="op" id="4340046">:=</span>&nbsp;<span class="ident" id="4340049">c</span><span class="op" id="4340050">.</span><span class="ident" id="4340051">NameToCertificate</span><span class="op" id="4340068">[</span><span class="ident" id="4340069">candidate</span><span class="op" id="4340078">]</span><span class="op" id="4340079">;</span>&nbsp;<span class="ident" id="4340081">ok</span>&nbsp;<span class="op" id="4340084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4340089">return</span>&nbsp;<span class="ident" id="4340096">cert</span><span class="op" id="4340100">,</span>&nbsp;<span class="builtintype" id="4340102">nil</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4340108">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4340111">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4340115">//&nbsp;If&nbsp;nothing&nbsp;matches,&nbsp;return&nbsp;the&nbsp;first&nbsp;certificate.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4340169">return</span>&nbsp;<span class="op" id="4340176">&amp;</span><span class="ident" id="4340177">c</span><span class="op" id="4340178">.</span><span class="ident" id="4340179">Certificates</span><span class="op" id="4340191">[</span><span class="num" id="4340192">0</span><span class="op" id="4340193">]</span><span class="op" id="4340194">,</span>&nbsp;<span class="builtintype" id="4340196">nil</span><br>
<span class="lineno">465</span><span class="op" id="4340200">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4340203">//&nbsp;BuildNameToCertificate&nbsp;parses&nbsp;c.Certificates&nbsp;and&nbsp;builds&nbsp;c.NameToCertificate</span><br>
<span class="lineno"></span><span class="comment" id="4340282">//&nbsp;from&nbsp;the&nbsp;CommonName&nbsp;and&nbsp;SubjectAlternateName&nbsp;fields&nbsp;of&nbsp;each&nbsp;of&nbsp;the&nbsp;leaf</span><br>
<span class="lineno"></span><span class="comment" id="4340357">//&nbsp;certificates.</span><br>
<span class="lineno">470</span><span class="keyword" id="4340374">func</span>&nbsp;<span class="op" id="4340379">(</span><span class="ident" id="4340380">c</span>&nbsp;<span class="op" id="4340382">*</span><span class="ident" id="4340383">Config</span><span class="op" id="4340389">)</span>&nbsp;<span class="ident" id="4340391">BuildNameToCertificate</span><span class="op" id="4340413">(</span><span class="op" id="4340414">)</span>&nbsp;<span class="op" id="4340416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4340419">c</span><span class="op" id="4340420">.</span><span class="ident" id="4340421">NameToCertificate</span>&nbsp;<span class="op" id="4340439">=</span>&nbsp;<span class="builtinfunc" id="4340441">make</span><span class="op" id="4340445">(</span><span class="keyword" id="4340446">map</span><span class="op" id="4340449">[</span><span class="builtintype" id="4340450">string</span><span class="op" id="4340456">]</span><span class="op" id="4340457">*</span><span class="ident" id="4340458">Certificate</span><span class="op" id="4340469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4340472">for</span>&nbsp;<span class="ident" id="4340476">i</span>&nbsp;<span class="op" id="4340478">:=</span>&nbsp;<span class="keyword" id="4340481">range</span>&nbsp;<span class="ident" id="4340487">c</span><span class="op" id="4340488">.</span><span class="ident" id="4340489">Certificates</span>&nbsp;<span class="op" id="4340502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4340506">cert</span>&nbsp;<span class="op" id="4340511">:=</span>&nbsp;<span class="op" id="4340514">&amp;</span><span class="ident" id="4340515">c</span><span class="op" id="4340516">.</span><span class="ident" id="4340517">Certificates</span><span class="op" id="4340529">[</span><span class="ident" id="4340530">i</span><span class="op" id="4340531">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4340535">x509Cert</span><span class="op" id="4340543">,</span>&nbsp;<span class="ident" id="4340545">err</span>&nbsp;<span class="op" id="4340549">:=</span>&nbsp;<span class="ident" id="4340552">x509</span><span class="op" id="4340556">.</span><span class="ident" id="4340557">ParseCertificate</span><span class="op" id="4340573">(</span><span class="ident" id="4340574">cert</span><span class="op" id="4340578">.</span><span class="ident" id="4340579">Certificate</span><span class="op" id="4340590">[</span><span class="num" id="4340591">0</span><span class="op" id="4340592">]</span><span class="op" id="4340593">)</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4340597">if</span>&nbsp;<span class="ident" id="4340600">err</span>&nbsp;<span class="op" id="4340604">!=</span>&nbsp;<span class="builtintype" id="4340607">nil</span>&nbsp;<span class="op" id="4340611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4340616">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4340627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4340631">if</span>&nbsp;<span class="builtinfunc" id="4340634">len</span><span class="op" id="4340637">(</span><span class="ident" id="4340638">x509Cert</span><span class="op" id="4340646">.</span><span class="ident" id="4340647">Subject</span><span class="op" id="4340654">.</span><span class="ident" id="4340655">CommonName</span><span class="op" id="4340665">)</span>&nbsp;<span class="op" id="4340667">&gt;</span>&nbsp;<span class="num" id="4340669">0</span>&nbsp;<span class="op" id="4340671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4340676">c</span><span class="op" id="4340677">.</span><span class="ident" id="4340678">NameToCertificate</span><span class="op" id="4340695">[</span><span class="ident" id="4340696">x509Cert</span><span class="op" id="4340704">.</span><span class="ident" id="4340705">Subject</span><span class="op" id="4340712">.</span><span class="ident" id="4340713">CommonName</span><span class="op" id="4340723">]</span>&nbsp;<span class="op" id="4340725">=</span>&nbsp;<span class="ident" id="4340727">cert</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4340734">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4340738">for</span>&nbsp;<span class="ident" id="4340742">_</span><span class="op" id="4340743">,</span>&nbsp;<span class="ident" id="4340745">san</span>&nbsp;<span class="op" id="4340749">:=</span>&nbsp;<span class="keyword" id="4340752">range</span>&nbsp;<span class="ident" id="4340758">x509Cert</span><span class="op" id="4340766">.</span><span class="ident" id="4340767">DNSNames</span>&nbsp;<span class="op" id="4340776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4340781">c</span><span class="op" id="4340782">.</span><span class="ident" id="4340783">NameToCertificate</span><span class="op" id="4340800">[</span><span class="ident" id="4340801">san</span><span class="op" id="4340804">]</span>&nbsp;<span class="op" id="4340806">=</span>&nbsp;<span class="ident" id="4340808">cert</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4340815">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4340818">}</span><br>
<span class="lineno">485</span><span class="op" id="4340820">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4340823">//&nbsp;A&nbsp;Certificate&nbsp;is&nbsp;a&nbsp;chain&nbsp;of&nbsp;one&nbsp;or&nbsp;more&nbsp;certificates,&nbsp;leaf&nbsp;first.</span><br>
<span class="lineno"></span><span class="keyword" id="4340892">type</span>&nbsp;<span class="ident" id="4340897">Certificate</span>&nbsp;<span class="keyword" id="4340909">struct</span>&nbsp;<span class="op" id="4340916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4340919">Certificate</span>&nbsp;<span class="op" id="4340931">[</span><span class="op" id="4340932">]</span><span class="op" id="4340933">[</span><span class="op" id="4340934">]</span><span class="builtintype" id="4340935">byte</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4340941">//&nbsp;PrivateKey&nbsp;contains&nbsp;the&nbsp;private&nbsp;key&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;public&nbsp;key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4341013">//&nbsp;in&nbsp;Leaf.&nbsp;For&nbsp;a&nbsp;server,&nbsp;this&nbsp;must&nbsp;be&nbsp;a&nbsp;*rsa.PrivateKey&nbsp;or</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4341074">//&nbsp;*ecdsa.PrivateKey.&nbsp;For&nbsp;a&nbsp;client&nbsp;doing&nbsp;client&nbsp;authentication,&nbsp;this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4341144">//&nbsp;can&nbsp;be&nbsp;any&nbsp;type&nbsp;that&nbsp;implements&nbsp;crypto.Signer&nbsp;(which&nbsp;includes&nbsp;RSA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4341214">//&nbsp;and&nbsp;ECDSA&nbsp;private&nbsp;keys).</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4341243">PrivateKey</span>&nbsp;<span class="ident" id="4341254">crypto</span><span class="op" id="4341260">.</span><span class="ident" id="4341261">PrivateKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4341273">//&nbsp;OCSPStaple&nbsp;contains&nbsp;an&nbsp;optional&nbsp;OCSP&nbsp;response&nbsp;which&nbsp;will&nbsp;be&nbsp;served</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4341344">//&nbsp;to&nbsp;clients&nbsp;that&nbsp;request&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4341376">OCSPStaple</span>&nbsp;<span class="op" id="4341387">[</span><span class="op" id="4341388">]</span><span class="builtintype" id="4341389">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4341395">//&nbsp;Leaf&nbsp;is&nbsp;the&nbsp;parsed&nbsp;form&nbsp;of&nbsp;the&nbsp;leaf&nbsp;certificate,&nbsp;which&nbsp;may&nbsp;be</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4341461">//&nbsp;initialized&nbsp;using&nbsp;x509.ParseCertificate&nbsp;to&nbsp;reduce&nbsp;per-handshake</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4341529">//&nbsp;processing&nbsp;for&nbsp;TLS&nbsp;clients&nbsp;doing&nbsp;client&nbsp;authentication.&nbsp;If&nbsp;nil,&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4341601">//&nbsp;leaf&nbsp;certificate&nbsp;will&nbsp;be&nbsp;parsed&nbsp;as&nbsp;needed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4341648">Leaf</span>&nbsp;<span class="op" id="4341653">*</span><span class="ident" id="4341654">x509</span><span class="op" id="4341658">.</span><span class="ident" id="4341659">Certificate</span><br>
<span class="lineno"></span><span class="op" id="4341671">}</span><br>
<span class="lineno">505</span><br>
<span class="lineno"></span><span class="comment" id="4341674">//&nbsp;A&nbsp;TLS&nbsp;record.</span><br>
<span class="lineno"></span><span class="keyword" id="4341691">type</span>&nbsp;<span class="ident" id="4341696">record</span>&nbsp;<span class="keyword" id="4341703">struct</span>&nbsp;<span class="op" id="4341710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4341713">contentType</span>&nbsp;&nbsp;<span class="ident" id="4341726">recordType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4341738">major</span><span class="op" id="4341743">,</span>&nbsp;<span class="ident" id="4341745">minor</span>&nbsp;<span class="builtintype" id="4341751">uint8</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4341758">payload</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4341771">[</span><span class="op" id="4341772">]</span><span class="builtintype" id="4341773">byte</span><br>
<span class="lineno"></span><span class="op" id="4341778">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4341781">type</span>&nbsp;<span class="ident" id="4341786">handshakeMessage</span>&nbsp;<span class="keyword" id="4341803">interface</span>&nbsp;<span class="op" id="4341813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4341816">marshal</span><span class="op" id="4341823">(</span><span class="op" id="4341824">)</span>&nbsp;<span class="op" id="4341826">[</span><span class="op" id="4341827">]</span><span class="builtintype" id="4341828">byte</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4341834">unmarshal</span><span class="op" id="4341843">(</span><span class="op" id="4341844">[</span><span class="op" id="4341845">]</span><span class="builtintype" id="4341846">byte</span><span class="op" id="4341850">)</span>&nbsp;<span class="builtintype" id="4341852">bool</span><br>
<span class="lineno"></span><span class="op" id="4341857">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4341860">//&nbsp;lruSessionCache&nbsp;is&nbsp;a&nbsp;ClientSessionCache&nbsp;implementation&nbsp;that&nbsp;uses&nbsp;an&nbsp;LRU</span><br>
<span class="lineno"></span><span class="comment" id="4341935">//&nbsp;caching&nbsp;strategy.</span><br>
<span class="lineno">520</span><span class="keyword" id="4341956">type</span>&nbsp;<span class="ident" id="4341961">lruSessionCache</span>&nbsp;<span class="keyword" id="4341977">struct</span>&nbsp;<span class="op" id="4341984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4341987">sync</span><span class="op" id="4341991">.</span><span class="ident" id="4341992">Mutex</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4342000">m</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4342009">map</span><span class="op" id="4342012">[</span><span class="builtintype" id="4342013">string</span><span class="op" id="4342019">]</span><span class="op" id="4342020">*</span><span class="ident" id="4342021">list</span><span class="op" id="4342025">.</span><span class="ident" id="4342026">Element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4342035">q</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4342044">*</span><span class="ident" id="4342045">list</span><span class="op" id="4342049">.</span><span class="ident" id="4342050">List</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4342056">capacity</span>&nbsp;<span class="builtintype" id="4342065">int</span><br>
<span class="lineno"></span><span class="op" id="4342069">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4342072">type</span>&nbsp;<span class="ident" id="4342077">lruSessionCacheEntry</span>&nbsp;<span class="keyword" id="4342098">struct</span>&nbsp;<span class="op" id="4342105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4342108">sessionKey</span>&nbsp;<span class="builtintype" id="4342119">string</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4342127">state</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4342138">*</span><span class="ident" id="4342139">ClientSessionState</span><br>
<span class="lineno"></span><span class="op" id="4342158">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4342161">//&nbsp;NewLRUClientSessionCache&nbsp;returns&nbsp;a&nbsp;ClientSessionCache&nbsp;with&nbsp;the&nbsp;given</span><br>
<span class="lineno"></span><span class="comment" id="4342233">//&nbsp;capacity&nbsp;that&nbsp;uses&nbsp;an&nbsp;LRU&nbsp;strategy.&nbsp;If&nbsp;capacity&nbsp;is&nbsp;&lt;&nbsp;1,&nbsp;a&nbsp;default&nbsp;capacity</span><br>
<span class="lineno">535</span><span class="comment" id="4342311">//&nbsp;is&nbsp;used&nbsp;instead.</span><br>
<span class="lineno"></span><span class="keyword" id="4342331">func</span>&nbsp;<span class="ident" id="4342336">NewLRUClientSessionCache</span><span class="op" id="4342360">(</span><span class="ident" id="4342361">capacity</span>&nbsp;<span class="builtintype" id="4342370">int</span><span class="op" id="4342373">)</span>&nbsp;<span class="ident" id="4342375">ClientSessionCache</span>&nbsp;<span class="op" id="4342394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4342397">const</span>&nbsp;<span class="ident" id="4342403">defaultSessionCacheCapacity</span>&nbsp;<span class="op" id="4342431">=</span>&nbsp;<span class="num" id="4342433">64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4342438">if</span>&nbsp;<span class="ident" id="4342441">capacity</span>&nbsp;<span class="op" id="4342450">&lt;</span>&nbsp;<span class="num" id="4342452">1</span>&nbsp;<span class="op" id="4342454">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4342458">capacity</span>&nbsp;<span class="op" id="4342467">=</span>&nbsp;<span class="ident" id="4342469">defaultSessionCacheCapacity</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4342498">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4342501">return</span>&nbsp;<span class="op" id="4342508">&amp;</span><span class="ident" id="4342509">lruSessionCache</span><span class="op" id="4342524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4342528">m</span><span class="op" id="4342529">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4342538">make</span><span class="op" id="4342542">(</span><span class="keyword" id="4342543">map</span><span class="op" id="4342546">[</span><span class="builtintype" id="4342547">string</span><span class="op" id="4342553">]</span><span class="op" id="4342554">*</span><span class="ident" id="4342555">list</span><span class="op" id="4342559">.</span><span class="ident" id="4342560">Element</span><span class="op" id="4342567">)</span><span class="op" id="4342568">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4342572">q</span><span class="op" id="4342573">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4342582">list</span><span class="op" id="4342586">.</span><span class="ident" id="4342587">New</span><span class="op" id="4342590">(</span><span class="op" id="4342591">)</span><span class="op" id="4342592">,</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4342596">capacity</span><span class="op" id="4342604">:</span>&nbsp;<span class="ident" id="4342606">capacity</span><span class="op" id="4342614">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4342617">}</span><br>
<span class="lineno"></span><span class="op" id="4342619">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4342622">//&nbsp;Put&nbsp;adds&nbsp;the&nbsp;provided&nbsp;(sessionKey,&nbsp;cs)&nbsp;pair&nbsp;to&nbsp;the&nbsp;cache.</span><br>
<span class="lineno">550</span><span class="keyword" id="4342683">func</span>&nbsp;<span class="op" id="4342688">(</span><span class="ident" id="4342689">c</span>&nbsp;<span class="op" id="4342691">*</span><span class="ident" id="4342692">lruSessionCache</span><span class="op" id="4342707">)</span>&nbsp;<span class="ident" id="4342709">Put</span><span class="op" id="4342712">(</span><span class="ident" id="4342713">sessionKey</span>&nbsp;<span class="builtintype" id="4342724">string</span><span class="op" id="4342730">,</span>&nbsp;<span class="ident" id="4342732">cs</span>&nbsp;<span class="op" id="4342735">*</span><span class="ident" id="4342736">ClientSessionState</span><span class="op" id="4342754">)</span>&nbsp;<span class="op" id="4342756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4342759">c</span><span class="op" id="4342760">.</span><span class="ident" id="4342761">Lock</span><span class="op" id="4342765">(</span><span class="op" id="4342766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4342769">defer</span>&nbsp;<span class="ident" id="4342775">c</span><span class="op" id="4342776">.</span><span class="ident" id="4342777">Unlock</span><span class="op" id="4342783">(</span><span class="op" id="4342784">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4342788">if</span>&nbsp;<span class="ident" id="4342791">elem</span><span class="op" id="4342795">,</span>&nbsp;<span class="ident" id="4342797">ok</span>&nbsp;<span class="op" id="4342800">:=</span>&nbsp;<span class="ident" id="4342803">c</span><span class="op" id="4342804">.</span><span class="ident" id="4342805">m</span><span class="op" id="4342806">[</span><span class="ident" id="4342807">sessionKey</span><span class="op" id="4342817">]</span><span class="op" id="4342818">;</span>&nbsp;<span class="ident" id="4342820">ok</span>&nbsp;<span class="op" id="4342823">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4342827">entry</span>&nbsp;<span class="op" id="4342833">:=</span>&nbsp;<span class="ident" id="4342836">elem</span><span class="op" id="4342840">.</span><span class="ident" id="4342841">Value</span><span class="op" id="4342846">.</span><span class="op" id="4342847">(</span><span class="op" id="4342848">*</span><span class="ident" id="4342849">lruSessionCacheEntry</span><span class="op" id="4342869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4342873">entry</span><span class="op" id="4342878">.</span><span class="ident" id="4342879">state</span>&nbsp;<span class="op" id="4342885">=</span>&nbsp;<span class="ident" id="4342887">cs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4342892">c</span><span class="op" id="4342893">.</span><span class="ident" id="4342894">q</span><span class="op" id="4342895">.</span><span class="ident" id="4342896">MoveToFront</span><span class="op" id="4342907">(</span><span class="ident" id="4342908">elem</span><span class="op" id="4342912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4342916">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4342924">}</span><br>
<span class="lineno">560</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4342928">if</span>&nbsp;<span class="ident" id="4342931">c</span><span class="op" id="4342932">.</span><span class="ident" id="4342933">q</span><span class="op" id="4342934">.</span><span class="ident" id="4342935">Len</span><span class="op" id="4342938">(</span><span class="op" id="4342939">)</span>&nbsp;<span class="op" id="4342941">&lt;</span>&nbsp;<span class="ident" id="4342943">c</span><span class="op" id="4342944">.</span><span class="ident" id="4342945">capacity</span>&nbsp;<span class="op" id="4342954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4342958">entry</span>&nbsp;<span class="op" id="4342964">:=</span>&nbsp;<span class="op" id="4342967">&amp;</span><span class="ident" id="4342968">lruSessionCacheEntry</span><span class="op" id="4342988">{</span><span class="ident" id="4342989">sessionKey</span><span class="op" id="4342999">,</span>&nbsp;<span class="ident" id="4343001">cs</span><span class="op" id="4343003">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4343007">c</span><span class="op" id="4343008">.</span><span class="ident" id="4343009">m</span><span class="op" id="4343010">[</span><span class="ident" id="4343011">sessionKey</span><span class="op" id="4343021">]</span>&nbsp;<span class="op" id="4343023">=</span>&nbsp;<span class="ident" id="4343025">c</span><span class="op" id="4343026">.</span><span class="ident" id="4343027">q</span><span class="op" id="4343028">.</span><span class="ident" id="4343029">PushFront</span><span class="op" id="4343038">(</span><span class="ident" id="4343039">entry</span><span class="op" id="4343044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4343048">return</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4343056">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4343060">elem</span>&nbsp;<span class="op" id="4343065">:=</span>&nbsp;<span class="ident" id="4343068">c</span><span class="op" id="4343069">.</span><span class="ident" id="4343070">q</span><span class="op" id="4343071">.</span><span class="ident" id="4343072">Back</span><span class="op" id="4343076">(</span><span class="op" id="4343077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4343080">entry</span>&nbsp;<span class="op" id="4343086">:=</span>&nbsp;<span class="ident" id="4343089">elem</span><span class="op" id="4343093">.</span><span class="ident" id="4343094">Value</span><span class="op" id="4343099">.</span><span class="op" id="4343100">(</span><span class="op" id="4343101">*</span><span class="ident" id="4343102">lruSessionCacheEntry</span><span class="op" id="4343122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4343125">delete</span><span class="op" id="4343131">(</span><span class="ident" id="4343132">c</span><span class="op" id="4343133">.</span><span class="ident" id="4343134">m</span><span class="op" id="4343135">,</span>&nbsp;<span class="ident" id="4343137">entry</span><span class="op" id="4343142">.</span><span class="ident" id="4343143">sessionKey</span><span class="op" id="4343153">)</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4343156">entry</span><span class="op" id="4343161">.</span><span class="ident" id="4343162">sessionKey</span>&nbsp;<span class="op" id="4343173">=</span>&nbsp;<span class="ident" id="4343175">sessionKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4343187">entry</span><span class="op" id="4343192">.</span><span class="ident" id="4343193">state</span>&nbsp;<span class="op" id="4343199">=</span>&nbsp;<span class="ident" id="4343201">cs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4343205">c</span><span class="op" id="4343206">.</span><span class="ident" id="4343207">q</span><span class="op" id="4343208">.</span><span class="ident" id="4343209">MoveToFront</span><span class="op" id="4343220">(</span><span class="ident" id="4343221">elem</span><span class="op" id="4343225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4343228">c</span><span class="op" id="4343229">.</span><span class="ident" id="4343230">m</span><span class="op" id="4343231">[</span><span class="ident" id="4343232">sessionKey</span><span class="op" id="4343242">]</span>&nbsp;<span class="op" id="4343244">=</span>&nbsp;<span class="ident" id="4343246">elem</span><br>
<span class="lineno"></span><span class="op" id="4343251">}</span><br>
<span class="lineno">575</span><br>
<span class="lineno"></span><span class="comment" id="4343254">//&nbsp;Get&nbsp;returns&nbsp;the&nbsp;ClientSessionState&nbsp;value&nbsp;associated&nbsp;with&nbsp;a&nbsp;given&nbsp;key.&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="4343330">//&nbsp;returns&nbsp;(nil,&nbsp;false)&nbsp;if&nbsp;no&nbsp;value&nbsp;is&nbsp;found.</span><br>
<span class="lineno"></span><span class="keyword" id="4343376">func</span>&nbsp;<span class="op" id="4343381">(</span><span class="ident" id="4343382">c</span>&nbsp;<span class="op" id="4343384">*</span><span class="ident" id="4343385">lruSessionCache</span><span class="op" id="4343400">)</span>&nbsp;<span class="ident" id="4343402">Get</span><span class="op" id="4343405">(</span><span class="ident" id="4343406">sessionKey</span>&nbsp;<span class="builtintype" id="4343417">string</span><span class="op" id="4343423">)</span>&nbsp;<span class="op" id="4343425">(</span><span class="op" id="4343426">*</span><span class="ident" id="4343427">ClientSessionState</span><span class="op" id="4343445">,</span>&nbsp;<span class="builtintype" id="4343447">bool</span><span class="op" id="4343451">)</span>&nbsp;<span class="op" id="4343453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4343456">c</span><span class="op" id="4343457">.</span><span class="ident" id="4343458">Lock</span><span class="op" id="4343462">(</span><span class="op" id="4343463">)</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4343466">defer</span>&nbsp;<span class="ident" id="4343472">c</span><span class="op" id="4343473">.</span><span class="ident" id="4343474">Unlock</span><span class="op" id="4343480">(</span><span class="op" id="4343481">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4343485">if</span>&nbsp;<span class="ident" id="4343488">elem</span><span class="op" id="4343492">,</span>&nbsp;<span class="ident" id="4343494">ok</span>&nbsp;<span class="op" id="4343497">:=</span>&nbsp;<span class="ident" id="4343500">c</span><span class="op" id="4343501">.</span><span class="ident" id="4343502">m</span><span class="op" id="4343503">[</span><span class="ident" id="4343504">sessionKey</span><span class="op" id="4343514">]</span><span class="op" id="4343515">;</span>&nbsp;<span class="ident" id="4343517">ok</span>&nbsp;<span class="op" id="4343520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4343524">c</span><span class="op" id="4343525">.</span><span class="ident" id="4343526">q</span><span class="op" id="4343527">.</span><span class="ident" id="4343528">MoveToFront</span><span class="op" id="4343539">(</span><span class="ident" id="4343540">elem</span><span class="op" id="4343544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4343548">return</span>&nbsp;<span class="ident" id="4343555">elem</span><span class="op" id="4343559">.</span><span class="ident" id="4343560">Value</span><span class="op" id="4343565">.</span><span class="op" id="4343566">(</span><span class="op" id="4343567">*</span><span class="ident" id="4343568">lruSessionCacheEntry</span><span class="op" id="4343588">)</span><span class="op" id="4343589">.</span><span class="ident" id="4343590">state</span><span class="op" id="4343595">,</span>&nbsp;<span class="builtintype" id="4343597">true</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4343603">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4343606">return</span>&nbsp;<span class="builtintype" id="4343613">nil</span><span class="op" id="4343616">,</span>&nbsp;<span class="builtintype" id="4343618">false</span><br>
<span class="lineno"></span><span class="op" id="4343624">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4343627">//&nbsp;TODO(jsing):&nbsp;Make&nbsp;these&nbsp;available&nbsp;to&nbsp;both&nbsp;crypto/x509&nbsp;and&nbsp;crypto/tls.</span><br>
<span class="lineno">590</span><span class="keyword" id="4343700">type</span>&nbsp;<span class="ident" id="4343705">dsaSignature</span>&nbsp;<span class="keyword" id="4343718">struct</span>&nbsp;<span class="op" id="4343725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4343728">R</span><span class="op" id="4343729">,</span>&nbsp;<span class="ident" id="4343731">S</span>&nbsp;<span class="op" id="4343733">*</span><span class="ident" id="4343734">big</span><span class="op" id="4343737">.</span><span class="ident" id="4343738">Int</span><br>
<span class="lineno"></span><span class="op" id="4343742">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4343745">type</span>&nbsp;<span class="ident" id="4343750">ecdsaSignature</span>&nbsp;<span class="ident" id="4343765">dsaSignature</span><br>
<span class="lineno">595</span><br>
<span class="lineno"></span><span class="keyword" id="4343779">var</span>&nbsp;<span class="ident" id="4343783">emptyConfig</span>&nbsp;<span class="ident" id="4343795">Config</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4343803">func</span>&nbsp;<span class="ident" id="4343808">defaultConfig</span><span class="op" id="4343821">(</span><span class="op" id="4343822">)</span>&nbsp;<span class="op" id="4343824">*</span><span class="ident" id="4343825">Config</span>&nbsp;<span class="op" id="4343832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4343835">return</span>&nbsp;<span class="op" id="4343842">&amp;</span><span class="ident" id="4343843">emptyConfig</span><br>
<span class="lineno">600</span><span class="op" id="4343855">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4343858">var</span>&nbsp;<span class="op" id="4343862">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4343865">once</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4343888">sync</span><span class="op" id="4343892">.</span><span class="ident" id="4343893">Once</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4343899">varDefaultCipherSuites</span>&nbsp;<span class="op" id="4343922">[</span><span class="op" id="4343923">]</span><span class="builtintype" id="4343924">uint16</span><br>
<span class="lineno">605</span><span class="op" id="4343931">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4343934">func</span>&nbsp;<span class="ident" id="4343939">defaultCipherSuites</span><span class="op" id="4343958">(</span><span class="op" id="4343959">)</span>&nbsp;<span class="op" id="4343961">[</span><span class="op" id="4343962">]</span><span class="builtintype" id="4343963">uint16</span>&nbsp;<span class="op" id="4343970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4343973">once</span><span class="op" id="4343977">.</span><span class="ident" id="4343978">Do</span><span class="op" id="4343980">(</span><span class="ident" id="4343981">initDefaultCipherSuites</span><span class="op" id="4344004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4344007">return</span>&nbsp;<span class="ident" id="4344014">varDefaultCipherSuites</span><br>
<span class="lineno">610</span><span class="op" id="4344037">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4344040">func</span>&nbsp;<span class="ident" id="4344045">initDefaultCipherSuites</span><span class="op" id="4344068">(</span><span class="op" id="4344069">)</span>&nbsp;<span class="op" id="4344071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4344074">varDefaultCipherSuites</span>&nbsp;<span class="op" id="4344097">=</span>&nbsp;<span class="builtinfunc" id="4344099">make</span><span class="op" id="4344103">(</span><span class="op" id="4344104">[</span><span class="op" id="4344105">]</span><span class="builtintype" id="4344106">uint16</span><span class="op" id="4344112">,</span>&nbsp;<span class="builtinfunc" id="4344114">len</span><span class="op" id="4344117">(</span><span class="ident" id="4344118">cipherSuites</span><span class="op" id="4344130">)</span><span class="op" id="4344131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4344134">for</span>&nbsp;<span class="ident" id="4344138">i</span><span class="op" id="4344139">,</span>&nbsp;<span class="ident" id="4344141">suite</span>&nbsp;<span class="op" id="4344147">:=</span>&nbsp;<span class="keyword" id="4344150">range</span>&nbsp;<span class="ident" id="4344156">cipherSuites</span>&nbsp;<span class="op" id="4344169">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4344173">varDefaultCipherSuites</span><span class="op" id="4344195">[</span><span class="ident" id="4344196">i</span><span class="op" id="4344197">]</span>&nbsp;<span class="op" id="4344199">=</span>&nbsp;<span class="ident" id="4344201">suite</span><span class="op" id="4344206">.</span><span class="ident" id="4344207">id</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4344211">}</span><br>
<span class="lineno"></span><span class="op" id="4344213">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4344216">func</span>&nbsp;<span class="ident" id="4344221">unexpectedMessageError</span><span class="op" id="4344243">(</span><span class="ident" id="4344244">wanted</span><span class="op" id="4344250">,</span>&nbsp;<span class="ident" id="4344252">got</span>&nbsp;<span class="keyword" id="4344256">interface</span><span class="op" id="4344265">{</span><span class="op" id="4344266">}</span><span class="op" id="4344267">)</span>&nbsp;<span class="builtintype" id="4344269">error</span>&nbsp;<span class="op" id="4344275">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4344278">return</span>&nbsp;<span class="ident" id="4344285">fmt</span><span class="op" id="4344288">.</span><span class="ident" id="4344289">Errorf</span><span class="op" id="4344295">(</span><span class="string" id="4344296">&#34;tls:&nbsp;received&nbsp;unexpected&nbsp;handshake&nbsp;message&nbsp;of&nbsp;type&nbsp;%T&nbsp;when&nbsp;waiting&nbsp;for&nbsp;%T&#34;</span><span class="op" id="4344371">,</span>&nbsp;<span class="ident" id="4344373">got</span><span class="op" id="4344376">,</span>&nbsp;<span class="ident" id="4344378">wanted</span><span class="op" id="4344384">)</span><br>
<span class="lineno"></span><span class="op" id="4344386">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
