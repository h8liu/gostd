<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/json</h2>
<ul>
<li><a href="/gostd/encoding/json/bench_test.go.html">bench_test.go</a></li>
<li><a href="/gostd/encoding/json/decode.go.html">decode.go</a></li>
<li><a href="/gostd/encoding/json/decode_test.go.html">decode_test.go</a></li>
<li><a href="/gostd/encoding/json/encode.go.html">encode.go</a></li>
<li><a href="/gostd/encoding/json/encode_test.go.html">encode_test.go</a></li>
<li><a href="/gostd/encoding/json/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/json/fold.go.html">fold.go</a></li>
<li><a href="/gostd/encoding/json/fold_test.go.html">fold_test.go</a></li>
<li><a href="/gostd/encoding/json/indent.go.html">indent.go</a></li>
<li><a href="/gostd/encoding/json/scanner.go.html">scanner.go</a></li>
<li><a href="/gostd/encoding/json/scanner_test.go.html">scanner_test.go</a></li>
<li><a href="/gostd/encoding/json/stream.go.html" class="current">stream.go</a></li>
<li><a href="/gostd/encoding/json/stream_test.go.html">stream_test.go</a></li>
<li><a href="/gostd/encoding/json/tagkey_test.go.html">tagkey_test.go</a></li>
<li><a href="/gostd/encoding/json/tags.go.html">tags.go</a></li>
<li><a href="/gostd/encoding/json/tags_test.go.html">tags_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5406282">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5406338">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5406392">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5406443">package</span>&nbsp;<span class="ident" id="5406451">json</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5406457">import</span>&nbsp;<span class="op" id="5406464">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5406467">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5406476">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5406486">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="5406491">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5406494">//&nbsp;A&nbsp;Decoder&nbsp;reads&nbsp;and&nbsp;decodes&nbsp;JSON&nbsp;objects&nbsp;from&nbsp;an&nbsp;input&nbsp;stream.</span><br>
<span class="lineno"></span><span class="keyword" id="5406560">type</span>&nbsp;<span class="ident" id="5406565">Decoder</span>&nbsp;<span class="keyword" id="5406573">struct</span>&nbsp;<span class="op" id="5406580">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5406583">r</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5406588">io</span><span class="op" id="5406590">.</span><span class="ident" id="5406591">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5406599">buf</span>&nbsp;&nbsp;<span class="op" id="5406604">[</span><span class="op" id="5406605">]</span><span class="builtintype" id="5406606">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5406612">d</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5406617">decodeState</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5406630">scan</span>&nbsp;<span class="ident" id="5406635">scanner</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5406644">err</span>&nbsp;&nbsp;<span class="builtintype" id="5406649">error</span><br>
<span class="lineno">20</span><span class="op" id="5406655">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5406658">//&nbsp;NewDecoder&nbsp;returns&nbsp;a&nbsp;new&nbsp;decoder&nbsp;that&nbsp;reads&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="5406713">//</span><br>
<span class="lineno"></span><span class="comment" id="5406716">//&nbsp;The&nbsp;decoder&nbsp;introduces&nbsp;its&nbsp;own&nbsp;buffering&nbsp;and&nbsp;may</span><br>
<span class="lineno">25</span><span class="comment" id="5406768">//&nbsp;read&nbsp;data&nbsp;from&nbsp;r&nbsp;beyond&nbsp;the&nbsp;JSON&nbsp;values&nbsp;requested.</span><br>
<span class="lineno"></span><span class="keyword" id="5406822">func</span>&nbsp;<span class="ident" id="5406827">NewDecoder</span><span class="op" id="5406837">(</span><span class="ident" id="5406838">r</span>&nbsp;<span class="ident" id="5406840">io</span><span class="op" id="5406842">.</span><span class="ident" id="5406843">Reader</span><span class="op" id="5406849">)</span>&nbsp;<span class="op" id="5406851">*</span><span class="ident" id="5406852">Decoder</span>&nbsp;<span class="op" id="5406860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5406863">return</span>&nbsp;<span class="op" id="5406870">&amp;</span><span class="ident" id="5406871">Decoder</span><span class="op" id="5406878">{</span><span class="ident" id="5406879">r</span><span class="op" id="5406880">:</span>&nbsp;<span class="ident" id="5406882">r</span><span class="op" id="5406883">}</span><br>
<span class="lineno"></span><span class="op" id="5406885">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="5406888">//&nbsp;UseNumber&nbsp;causes&nbsp;the&nbsp;Decoder&nbsp;to&nbsp;unmarshal&nbsp;a&nbsp;number&nbsp;into&nbsp;an&nbsp;interface{}&nbsp;as&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5406967">//&nbsp;Number&nbsp;instead&nbsp;of&nbsp;as&nbsp;a&nbsp;float64.</span><br>
<span class="lineno"></span><span class="keyword" id="5407002">func</span>&nbsp;<span class="op" id="5407007">(</span><span class="ident" id="5407008">dec</span>&nbsp;<span class="op" id="5407012">*</span><span class="ident" id="5407013">Decoder</span><span class="op" id="5407020">)</span>&nbsp;<span class="ident" id="5407022">UseNumber</span><span class="op" id="5407031">(</span><span class="op" id="5407032">)</span>&nbsp;<span class="op" id="5407034">{</span>&nbsp;<span class="ident" id="5407036">dec</span><span class="op" id="5407039">.</span><span class="ident" id="5407040">d</span><span class="op" id="5407041">.</span><span class="ident" id="5407042">useNumber</span>&nbsp;<span class="op" id="5407052">=</span>&nbsp;<span class="builtintype" id="5407054">true</span>&nbsp;<span class="op" id="5407059">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5407062">//&nbsp;Decode&nbsp;reads&nbsp;the&nbsp;next&nbsp;JSON-encoded&nbsp;value&nbsp;from&nbsp;its</span><br>
<span class="lineno">35</span><span class="comment" id="5407115">//&nbsp;input&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;the&nbsp;value&nbsp;pointed&nbsp;to&nbsp;by&nbsp;v.</span><br>
<span class="lineno"></span><span class="comment" id="5407168">//</span><br>
<span class="lineno"></span><span class="comment" id="5407171">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;Unmarshal&nbsp;for&nbsp;details&nbsp;about</span><br>
<span class="lineno"></span><span class="comment" id="5407228">//&nbsp;the&nbsp;conversion&nbsp;of&nbsp;JSON&nbsp;into&nbsp;a&nbsp;Go&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="5407271">func</span>&nbsp;<span class="op" id="5407276">(</span><span class="ident" id="5407277">dec</span>&nbsp;<span class="op" id="5407281">*</span><span class="ident" id="5407282">Decoder</span><span class="op" id="5407289">)</span>&nbsp;<span class="ident" id="5407291">Decode</span><span class="op" id="5407297">(</span><span class="ident" id="5407298">v</span>&nbsp;<span class="keyword" id="5407300">interface</span><span class="op" id="5407309">{</span><span class="op" id="5407310">}</span><span class="op" id="5407311">)</span>&nbsp;<span class="builtintype" id="5407313">error</span>&nbsp;<span class="op" id="5407319">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5407322">if</span>&nbsp;<span class="ident" id="5407325">dec</span><span class="op" id="5407328">.</span><span class="ident" id="5407329">err</span>&nbsp;<span class="op" id="5407333">!=</span>&nbsp;<span class="builtintype" id="5407336">nil</span>&nbsp;<span class="op" id="5407340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5407344">return</span>&nbsp;<span class="ident" id="5407351">dec</span><span class="op" id="5407354">.</span><span class="ident" id="5407355">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5407360">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5407364">n</span><span class="op" id="5407365">,</span>&nbsp;<span class="ident" id="5407367">err</span>&nbsp;<span class="op" id="5407371">:=</span>&nbsp;<span class="ident" id="5407374">dec</span><span class="op" id="5407377">.</span><span class="ident" id="5407378">readValue</span><span class="op" id="5407387">(</span><span class="op" id="5407388">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5407391">if</span>&nbsp;<span class="ident" id="5407394">err</span>&nbsp;<span class="op" id="5407398">!=</span>&nbsp;<span class="builtintype" id="5407401">nil</span>&nbsp;<span class="op" id="5407405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5407409">return</span>&nbsp;<span class="ident" id="5407416">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5407421">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5407425">//&nbsp;Don&#39;t&nbsp;save&nbsp;err&nbsp;from&nbsp;unmarshal&nbsp;into&nbsp;dec.err:</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5407473">//&nbsp;the&nbsp;connection&nbsp;is&nbsp;still&nbsp;usable&nbsp;since&nbsp;we&nbsp;read&nbsp;a&nbsp;complete&nbsp;JSON</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5407538">//&nbsp;object&nbsp;from&nbsp;it&nbsp;before&nbsp;the&nbsp;error&nbsp;happened.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5407584">dec</span><span class="op" id="5407587">.</span><span class="ident" id="5407588">d</span><span class="op" id="5407589">.</span><span class="ident" id="5407590">init</span><span class="op" id="5407594">(</span><span class="ident" id="5407595">dec</span><span class="op" id="5407598">.</span><span class="ident" id="5407599">buf</span><span class="op" id="5407602">[</span><span class="num" id="5407603">0</span><span class="op" id="5407604">:</span><span class="ident" id="5407605">n</span><span class="op" id="5407606">]</span><span class="op" id="5407607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5407610">err</span>&nbsp;<span class="op" id="5407614">=</span>&nbsp;<span class="ident" id="5407616">dec</span><span class="op" id="5407619">.</span><span class="ident" id="5407620">d</span><span class="op" id="5407621">.</span><span class="ident" id="5407622">unmarshal</span><span class="op" id="5407631">(</span><span class="ident" id="5407632">v</span><span class="op" id="5407633">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5407637">//&nbsp;Slide&nbsp;rest&nbsp;of&nbsp;data&nbsp;down.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5407666">rest</span>&nbsp;<span class="op" id="5407671">:=</span>&nbsp;<span class="builtinfunc" id="5407674">copy</span><span class="op" id="5407678">(</span><span class="ident" id="5407679">dec</span><span class="op" id="5407682">.</span><span class="ident" id="5407683">buf</span><span class="op" id="5407686">,</span>&nbsp;<span class="ident" id="5407688">dec</span><span class="op" id="5407691">.</span><span class="ident" id="5407692">buf</span><span class="op" id="5407695">[</span><span class="ident" id="5407696">n</span><span class="op" id="5407697">:</span><span class="op" id="5407698">]</span><span class="op" id="5407699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5407702">dec</span><span class="op" id="5407705">.</span><span class="ident" id="5407706">buf</span>&nbsp;<span class="op" id="5407710">=</span>&nbsp;<span class="ident" id="5407712">dec</span><span class="op" id="5407715">.</span><span class="ident" id="5407716">buf</span><span class="op" id="5407719">[</span><span class="num" id="5407720">0</span><span class="op" id="5407721">:</span><span class="ident" id="5407722">rest</span><span class="op" id="5407726">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5407730">return</span>&nbsp;<span class="ident" id="5407737">err</span><br>
<span class="lineno">60</span><span class="op" id="5407741">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5407744">//&nbsp;Buffered&nbsp;returns&nbsp;a&nbsp;reader&nbsp;of&nbsp;the&nbsp;data&nbsp;remaining&nbsp;in&nbsp;the&nbsp;Decoder&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="5407812">//&nbsp;buffer.&nbsp;The&nbsp;reader&nbsp;is&nbsp;valid&nbsp;until&nbsp;the&nbsp;next&nbsp;call&nbsp;to&nbsp;Decode.</span><br>
<span class="lineno"></span><span class="keyword" id="5407874">func</span>&nbsp;<span class="op" id="5407879">(</span><span class="ident" id="5407880">dec</span>&nbsp;<span class="op" id="5407884">*</span><span class="ident" id="5407885">Decoder</span><span class="op" id="5407892">)</span>&nbsp;<span class="ident" id="5407894">Buffered</span><span class="op" id="5407902">(</span><span class="op" id="5407903">)</span>&nbsp;<span class="ident" id="5407905">io</span><span class="op" id="5407907">.</span><span class="ident" id="5407908">Reader</span>&nbsp;<span class="op" id="5407915">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5407918">return</span>&nbsp;<span class="ident" id="5407925">bytes</span><span class="op" id="5407930">.</span><span class="ident" id="5407931">NewReader</span><span class="op" id="5407940">(</span><span class="ident" id="5407941">dec</span><span class="op" id="5407944">.</span><span class="ident" id="5407945">buf</span><span class="op" id="5407948">)</span><br>
<span class="lineno"></span><span class="op" id="5407950">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5407953">//&nbsp;readValue&nbsp;reads&nbsp;a&nbsp;JSON&nbsp;value&nbsp;into&nbsp;dec.buf.</span><br>
<span class="lineno"></span><span class="comment" id="5407999">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;encoding.</span><br>
<span class="lineno">70</span><span class="keyword" id="5408041">func</span>&nbsp;<span class="op" id="5408046">(</span><span class="ident" id="5408047">dec</span>&nbsp;<span class="op" id="5408051">*</span><span class="ident" id="5408052">Decoder</span><span class="op" id="5408059">)</span>&nbsp;<span class="ident" id="5408061">readValue</span><span class="op" id="5408070">(</span><span class="op" id="5408071">)</span>&nbsp;<span class="op" id="5408073">(</span><span class="builtintype" id="5408074">int</span><span class="op" id="5408077">,</span>&nbsp;<span class="builtintype" id="5408079">error</span><span class="op" id="5408084">)</span>&nbsp;<span class="op" id="5408086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5408089">dec</span><span class="op" id="5408092">.</span><span class="ident" id="5408093">scan</span><span class="op" id="5408097">.</span><span class="ident" id="5408098">reset</span><span class="op" id="5408103">(</span><span class="op" id="5408104">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5408108">scanp</span>&nbsp;<span class="op" id="5408114">:=</span>&nbsp;<span class="num" id="5408117">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5408120">var</span>&nbsp;<span class="ident" id="5408124">err</span>&nbsp;<span class="builtintype" id="5408128">error</span><br>
<span class="lineno">75</span><span class="ident" id="5408134">Input</span><span class="op" id="5408139">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5408142">for</span>&nbsp;<span class="op" id="5408146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5408150">//&nbsp;Look&nbsp;in&nbsp;the&nbsp;buffer&nbsp;for&nbsp;a&nbsp;new&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5408191">for</span>&nbsp;<span class="ident" id="5408195">i</span><span class="op" id="5408196">,</span>&nbsp;<span class="ident" id="5408198">c</span>&nbsp;<span class="op" id="5408200">:=</span>&nbsp;<span class="keyword" id="5408203">range</span>&nbsp;<span class="ident" id="5408209">dec</span><span class="op" id="5408212">.</span><span class="ident" id="5408213">buf</span><span class="op" id="5408216">[</span><span class="ident" id="5408217">scanp</span><span class="op" id="5408222">:</span><span class="op" id="5408223">]</span>&nbsp;<span class="op" id="5408225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5408230">dec</span><span class="op" id="5408233">.</span><span class="ident" id="5408234">scan</span><span class="op" id="5408238">.</span><span class="ident" id="5408239">bytes</span><span class="op" id="5408244">++</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5408250">v</span>&nbsp;<span class="op" id="5408252">:=</span>&nbsp;<span class="ident" id="5408255">dec</span><span class="op" id="5408258">.</span><span class="ident" id="5408259">scan</span><span class="op" id="5408263">.</span><span class="ident" id="5408264">step</span><span class="op" id="5408268">(</span><span class="op" id="5408269">&amp;</span><span class="ident" id="5408270">dec</span><span class="op" id="5408273">.</span><span class="ident" id="5408274">scan</span><span class="op" id="5408278">,</span>&nbsp;<span class="builtintype" id="5408280">int</span><span class="op" id="5408283">(</span><span class="ident" id="5408284">c</span><span class="op" id="5408285">)</span><span class="op" id="5408286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5408291">if</span>&nbsp;<span class="ident" id="5408294">v</span>&nbsp;<span class="op" id="5408296">==</span>&nbsp;<span class="ident" id="5408299">scanEnd</span>&nbsp;<span class="op" id="5408307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5408313">scanp</span>&nbsp;<span class="op" id="5408319">+=</span>&nbsp;<span class="ident" id="5408322">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5408328">break</span>&nbsp;<span class="ident" id="5408334">Input</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5408343">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5408348">//&nbsp;scanEnd&nbsp;is&nbsp;delayed&nbsp;one&nbsp;byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5408383">//&nbsp;We&nbsp;might&nbsp;block&nbsp;trying&nbsp;to&nbsp;get&nbsp;that&nbsp;byte&nbsp;from&nbsp;src,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5408438">//&nbsp;so&nbsp;instead&nbsp;invent&nbsp;a&nbsp;space&nbsp;byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5408476">if</span>&nbsp;<span class="op" id="5408479">(</span><span class="ident" id="5408480">v</span>&nbsp;<span class="op" id="5408482">==</span>&nbsp;<span class="ident" id="5408485">scanEndObject</span>&nbsp;<span class="op" id="5408499">||</span>&nbsp;<span class="ident" id="5408502">v</span>&nbsp;<span class="op" id="5408504">==</span>&nbsp;<span class="ident" id="5408507">scanEndArray</span><span class="op" id="5408519">)</span>&nbsp;<span class="op" id="5408521">&amp;&amp;</span>&nbsp;<span class="ident" id="5408524">dec</span><span class="op" id="5408527">.</span><span class="ident" id="5408528">scan</span><span class="op" id="5408532">.</span><span class="ident" id="5408533">step</span><span class="op" id="5408537">(</span><span class="op" id="5408538">&amp;</span><span class="ident" id="5408539">dec</span><span class="op" id="5408542">.</span><span class="ident" id="5408543">scan</span><span class="op" id="5408547">,</span>&nbsp;<span class="string" id="5408549">&#39;&nbsp;&#39;</span><span class="op" id="5408552">)</span>&nbsp;<span class="op" id="5408554">==</span>&nbsp;<span class="ident" id="5408557">scanEnd</span>&nbsp;<span class="op" id="5408565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5408571">scanp</span>&nbsp;<span class="op" id="5408577">+=</span>&nbsp;<span class="ident" id="5408580">i</span>&nbsp;<span class="op" id="5408582">+</span>&nbsp;<span class="num" id="5408584">1</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5408590">break</span>&nbsp;<span class="ident" id="5408596">Input</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5408605">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5408610">if</span>&nbsp;<span class="ident" id="5408613">v</span>&nbsp;<span class="op" id="5408615">==</span>&nbsp;<span class="ident" id="5408618">scanError</span>&nbsp;<span class="op" id="5408628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5408634">dec</span><span class="op" id="5408637">.</span><span class="ident" id="5408638">err</span>&nbsp;<span class="op" id="5408642">=</span>&nbsp;<span class="ident" id="5408644">dec</span><span class="op" id="5408647">.</span><span class="ident" id="5408648">scan</span><span class="op" id="5408652">.</span><span class="ident" id="5408653">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5408661">return</span>&nbsp;<span class="num" id="5408668">0</span><span class="op" id="5408669">,</span>&nbsp;<span class="ident" id="5408671">dec</span><span class="op" id="5408674">.</span><span class="ident" id="5408675">scan</span><span class="op" id="5408679">.</span><span class="ident" id="5408680">err</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5408687">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5408691">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5408695">scanp</span>&nbsp;<span class="op" id="5408701">=</span>&nbsp;<span class="builtinfunc" id="5408703">len</span><span class="op" id="5408706">(</span><span class="ident" id="5408707">dec</span><span class="op" id="5408710">.</span><span class="ident" id="5408711">buf</span><span class="op" id="5408714">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5408719">//&nbsp;Did&nbsp;the&nbsp;last&nbsp;read&nbsp;have&nbsp;an&nbsp;error?</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5408757">//&nbsp;Delayed&nbsp;until&nbsp;now&nbsp;to&nbsp;allow&nbsp;buffer&nbsp;scan.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5408802">if</span>&nbsp;<span class="ident" id="5408805">err</span>&nbsp;<span class="op" id="5408809">!=</span>&nbsp;<span class="builtintype" id="5408812">nil</span>&nbsp;<span class="op" id="5408816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5408821">if</span>&nbsp;<span class="ident" id="5408824">err</span>&nbsp;<span class="op" id="5408828">==</span>&nbsp;<span class="ident" id="5408831">io</span><span class="op" id="5408833">.</span><span class="ident" id="5408834">EOF</span>&nbsp;<span class="op" id="5408838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5408844">if</span>&nbsp;<span class="ident" id="5408847">dec</span><span class="op" id="5408850">.</span><span class="ident" id="5408851">scan</span><span class="op" id="5408855">.</span><span class="ident" id="5408856">step</span><span class="op" id="5408860">(</span><span class="op" id="5408861">&amp;</span><span class="ident" id="5408862">dec</span><span class="op" id="5408865">.</span><span class="ident" id="5408866">scan</span><span class="op" id="5408870">,</span>&nbsp;<span class="string" id="5408872">&#39;&nbsp;&#39;</span><span class="op" id="5408875">)</span>&nbsp;<span class="op" id="5408877">==</span>&nbsp;<span class="ident" id="5408880">scanEnd</span>&nbsp;<span class="op" id="5408888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5408895">break</span>&nbsp;<span class="ident" id="5408901">Input</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5408911">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5408917">if</span>&nbsp;<span class="ident" id="5408920">nonSpace</span><span class="op" id="5408928">(</span><span class="ident" id="5408929">dec</span><span class="op" id="5408932">.</span><span class="ident" id="5408933">buf</span><span class="op" id="5408936">)</span>&nbsp;<span class="op" id="5408938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5408945">err</span>&nbsp;<span class="op" id="5408949">=</span>&nbsp;<span class="ident" id="5408951">io</span><span class="op" id="5408953">.</span><span class="ident" id="5408954">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5408975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5408980">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5408985">dec</span><span class="op" id="5408988">.</span><span class="ident" id="5408989">err</span>&nbsp;<span class="op" id="5408993">=</span>&nbsp;<span class="ident" id="5408995">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5409002">return</span>&nbsp;<span class="num" id="5409009">0</span><span class="op" id="5409010">,</span>&nbsp;<span class="ident" id="5409012">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5409018">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5409023">//&nbsp;Make&nbsp;room&nbsp;to&nbsp;read&nbsp;more&nbsp;into&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5409068">const</span>&nbsp;<span class="ident" id="5409074">minRead</span>&nbsp;<span class="op" id="5409082">=</span>&nbsp;<span class="num" id="5409084">512</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5409090">if</span>&nbsp;<span class="builtinfunc" id="5409093">cap</span><span class="op" id="5409096">(</span><span class="ident" id="5409097">dec</span><span class="op" id="5409100">.</span><span class="ident" id="5409101">buf</span><span class="op" id="5409104">)</span><span class="op" id="5409105">-</span><span class="builtinfunc" id="5409106">len</span><span class="op" id="5409109">(</span><span class="ident" id="5409110">dec</span><span class="op" id="5409113">.</span><span class="ident" id="5409114">buf</span><span class="op" id="5409117">)</span>&nbsp;<span class="op" id="5409119">&lt;</span>&nbsp;<span class="ident" id="5409121">minRead</span>&nbsp;<span class="op" id="5409129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5409134">newBuf</span>&nbsp;<span class="op" id="5409141">:=</span>&nbsp;<span class="builtinfunc" id="5409144">make</span><span class="op" id="5409148">(</span><span class="op" id="5409149">[</span><span class="op" id="5409150">]</span><span class="builtintype" id="5409151">byte</span><span class="op" id="5409155">,</span>&nbsp;<span class="builtinfunc" id="5409157">len</span><span class="op" id="5409160">(</span><span class="ident" id="5409161">dec</span><span class="op" id="5409164">.</span><span class="ident" id="5409165">buf</span><span class="op" id="5409168">)</span><span class="op" id="5409169">,</span>&nbsp;<span class="num" id="5409171">2</span><span class="op" id="5409172">*</span><span class="builtinfunc" id="5409173">cap</span><span class="op" id="5409176">(</span><span class="ident" id="5409177">dec</span><span class="op" id="5409180">.</span><span class="ident" id="5409181">buf</span><span class="op" id="5409184">)</span><span class="op" id="5409185">+</span><span class="ident" id="5409186">minRead</span><span class="op" id="5409193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5409198">copy</span><span class="op" id="5409202">(</span><span class="ident" id="5409203">newBuf</span><span class="op" id="5409209">,</span>&nbsp;<span class="ident" id="5409211">dec</span><span class="op" id="5409214">.</span><span class="ident" id="5409215">buf</span><span class="op" id="5409218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5409223">dec</span><span class="op" id="5409226">.</span><span class="ident" id="5409227">buf</span>&nbsp;<span class="op" id="5409231">=</span>&nbsp;<span class="ident" id="5409233">newBuf</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5409242">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5409247">//&nbsp;Read.&nbsp;&nbsp;Delay&nbsp;error&nbsp;for&nbsp;next&nbsp;iteration&nbsp;(after&nbsp;scan).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5409304">var</span>&nbsp;<span class="ident" id="5409308">n</span>&nbsp;<span class="builtintype" id="5409310">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5409316">n</span><span class="op" id="5409317">,</span>&nbsp;<span class="ident" id="5409319">err</span>&nbsp;<span class="op" id="5409323">=</span>&nbsp;<span class="ident" id="5409325">dec</span><span class="op" id="5409328">.</span><span class="ident" id="5409329">r</span><span class="op" id="5409330">.</span><span class="ident" id="5409331">Read</span><span class="op" id="5409335">(</span><span class="ident" id="5409336">dec</span><span class="op" id="5409339">.</span><span class="ident" id="5409340">buf</span><span class="op" id="5409343">[</span><span class="builtinfunc" id="5409344">len</span><span class="op" id="5409347">(</span><span class="ident" id="5409348">dec</span><span class="op" id="5409351">.</span><span class="ident" id="5409352">buf</span><span class="op" id="5409355">)</span><span class="op" id="5409356">:</span><span class="builtinfunc" id="5409357">cap</span><span class="op" id="5409360">(</span><span class="ident" id="5409361">dec</span><span class="op" id="5409364">.</span><span class="ident" id="5409365">buf</span><span class="op" id="5409368">)</span><span class="op" id="5409369">]</span><span class="op" id="5409370">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5409374">dec</span><span class="op" id="5409377">.</span><span class="ident" id="5409378">buf</span>&nbsp;<span class="op" id="5409382">=</span>&nbsp;<span class="ident" id="5409384">dec</span><span class="op" id="5409387">.</span><span class="ident" id="5409388">buf</span><span class="op" id="5409391">[</span><span class="num" id="5409392">0</span>&nbsp;<span class="op" id="5409394">:</span>&nbsp;<span class="builtinfunc" id="5409396">len</span><span class="op" id="5409399">(</span><span class="ident" id="5409400">dec</span><span class="op" id="5409403">.</span><span class="ident" id="5409404">buf</span><span class="op" id="5409407">)</span><span class="op" id="5409408">+</span><span class="ident" id="5409409">n</span><span class="op" id="5409410">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5409413">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5409416">return</span>&nbsp;<span class="ident" id="5409423">scanp</span><span class="op" id="5409428">,</span>&nbsp;<span class="builtintype" id="5409430">nil</span><br>
<span class="lineno"></span><span class="op" id="5409434">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="5409437">func</span>&nbsp;<span class="ident" id="5409442">nonSpace</span><span class="op" id="5409450">(</span><span class="ident" id="5409451">b</span>&nbsp;<span class="op" id="5409453">[</span><span class="op" id="5409454">]</span><span class="builtintype" id="5409455">byte</span><span class="op" id="5409459">)</span>&nbsp;<span class="builtintype" id="5409461">bool</span>&nbsp;<span class="op" id="5409466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5409469">for</span>&nbsp;<span class="ident" id="5409473">_</span><span class="op" id="5409474">,</span>&nbsp;<span class="ident" id="5409476">c</span>&nbsp;<span class="op" id="5409478">:=</span>&nbsp;<span class="keyword" id="5409481">range</span>&nbsp;<span class="ident" id="5409487">b</span>&nbsp;<span class="op" id="5409489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5409493">if</span>&nbsp;<span class="op" id="5409496">!</span><span class="ident" id="5409497">isSpace</span><span class="op" id="5409504">(</span><span class="builtintype" id="5409505">rune</span><span class="op" id="5409509">(</span><span class="ident" id="5409510">c</span><span class="op" id="5409511">)</span><span class="op" id="5409512">)</span>&nbsp;<span class="op" id="5409514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5409519">return</span>&nbsp;<span class="builtintype" id="5409526">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5409533">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5409536">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5409539">return</span>&nbsp;<span class="builtintype" id="5409546">false</span><br>
<span class="lineno"></span><span class="op" id="5409552">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5409555">//&nbsp;An&nbsp;Encoder&nbsp;writes&nbsp;JSON&nbsp;objects&nbsp;to&nbsp;an&nbsp;output&nbsp;stream.</span><br>
<span class="lineno">140</span><span class="keyword" id="5409610">type</span>&nbsp;<span class="ident" id="5409615">Encoder</span>&nbsp;<span class="keyword" id="5409623">struct</span>&nbsp;<span class="op" id="5409630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5409633">w</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5409637">io</span><span class="op" id="5409639">.</span><span class="ident" id="5409640">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5409648">err</span>&nbsp;<span class="builtintype" id="5409652">error</span><br>
<span class="lineno"></span><span class="op" id="5409658">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="comment" id="5409661">//&nbsp;NewEncoder&nbsp;returns&nbsp;a&nbsp;new&nbsp;encoder&nbsp;that&nbsp;writes&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="5409715">func</span>&nbsp;<span class="ident" id="5409720">NewEncoder</span><span class="op" id="5409730">(</span><span class="ident" id="5409731">w</span>&nbsp;<span class="ident" id="5409733">io</span><span class="op" id="5409735">.</span><span class="ident" id="5409736">Writer</span><span class="op" id="5409742">)</span>&nbsp;<span class="op" id="5409744">*</span><span class="ident" id="5409745">Encoder</span>&nbsp;<span class="op" id="5409753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5409756">return</span>&nbsp;<span class="op" id="5409763">&amp;</span><span class="ident" id="5409764">Encoder</span><span class="op" id="5409771">{</span><span class="ident" id="5409772">w</span><span class="op" id="5409773">:</span>&nbsp;<span class="ident" id="5409775">w</span><span class="op" id="5409776">}</span><br>
<span class="lineno"></span><span class="op" id="5409778">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span><span class="comment" id="5409781">//&nbsp;Encode&nbsp;writes&nbsp;the&nbsp;JSON&nbsp;encoding&nbsp;of&nbsp;v&nbsp;to&nbsp;the&nbsp;stream,</span><br>
<span class="lineno"></span><span class="comment" id="5409836">//&nbsp;followed&nbsp;by&nbsp;a&nbsp;newline&nbsp;character.</span><br>
<span class="lineno"></span><span class="comment" id="5409872">//</span><br>
<span class="lineno"></span><span class="comment" id="5409875">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;Marshal&nbsp;for&nbsp;details&nbsp;about&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5409934">//&nbsp;conversion&nbsp;of&nbsp;Go&nbsp;values&nbsp;to&nbsp;JSON.</span><br>
<span class="lineno">155</span><span class="keyword" id="5409970">func</span>&nbsp;<span class="op" id="5409975">(</span><span class="ident" id="5409976">enc</span>&nbsp;<span class="op" id="5409980">*</span><span class="ident" id="5409981">Encoder</span><span class="op" id="5409988">)</span>&nbsp;<span class="ident" id="5409990">Encode</span><span class="op" id="5409996">(</span><span class="ident" id="5409997">v</span>&nbsp;<span class="keyword" id="5409999">interface</span><span class="op" id="5410008">{</span><span class="op" id="5410009">}</span><span class="op" id="5410010">)</span>&nbsp;<span class="builtintype" id="5410012">error</span>&nbsp;<span class="op" id="5410018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5410021">if</span>&nbsp;<span class="ident" id="5410024">enc</span><span class="op" id="5410027">.</span><span class="ident" id="5410028">err</span>&nbsp;<span class="op" id="5410032">!=</span>&nbsp;<span class="builtintype" id="5410035">nil</span>&nbsp;<span class="op" id="5410039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5410043">return</span>&nbsp;<span class="ident" id="5410050">enc</span><span class="op" id="5410053">.</span><span class="ident" id="5410054">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5410059">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5410062">e</span>&nbsp;<span class="op" id="5410064">:=</span>&nbsp;<span class="ident" id="5410067">newEncodeState</span><span class="op" id="5410081">(</span><span class="op" id="5410082">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5410085">err</span>&nbsp;<span class="op" id="5410089">:=</span>&nbsp;<span class="ident" id="5410092">e</span><span class="op" id="5410093">.</span><span class="ident" id="5410094">marshal</span><span class="op" id="5410101">(</span><span class="ident" id="5410102">v</span><span class="op" id="5410103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5410106">if</span>&nbsp;<span class="ident" id="5410109">err</span>&nbsp;<span class="op" id="5410113">!=</span>&nbsp;<span class="builtintype" id="5410116">nil</span>&nbsp;<span class="op" id="5410120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5410124">return</span>&nbsp;<span class="ident" id="5410131">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5410136">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5410140">//&nbsp;Terminate&nbsp;each&nbsp;value&nbsp;with&nbsp;a&nbsp;newline.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5410181">//&nbsp;This&nbsp;makes&nbsp;the&nbsp;output&nbsp;look&nbsp;a&nbsp;little&nbsp;nicer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5410227">//&nbsp;when&nbsp;debugging,&nbsp;and&nbsp;some&nbsp;kind&nbsp;of&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5410270">//&nbsp;is&nbsp;required&nbsp;if&nbsp;the&nbsp;encoded&nbsp;value&nbsp;was&nbsp;a&nbsp;number,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5410321">//&nbsp;so&nbsp;that&nbsp;the&nbsp;reader&nbsp;knows&nbsp;there&nbsp;aren&#39;t&nbsp;more</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5410368">//&nbsp;digits&nbsp;coming.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5410387">e</span><span class="op" id="5410388">.</span><span class="ident" id="5410389">WriteByte</span><span class="op" id="5410398">(</span><span class="string" id="5410399">&#39;\n&#39;</span><span class="op" id="5410403">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5410407">if</span>&nbsp;<span class="ident" id="5410410">_</span><span class="op" id="5410411">,</span>&nbsp;<span class="ident" id="5410413">err</span>&nbsp;<span class="op" id="5410417">=</span>&nbsp;<span class="ident" id="5410419">enc</span><span class="op" id="5410422">.</span><span class="ident" id="5410423">w</span><span class="op" id="5410424">.</span><span class="ident" id="5410425">Write</span><span class="op" id="5410430">(</span><span class="ident" id="5410431">e</span><span class="op" id="5410432">.</span><span class="ident" id="5410433">Bytes</span><span class="op" id="5410438">(</span><span class="op" id="5410439">)</span><span class="op" id="5410440">)</span><span class="op" id="5410441">;</span>&nbsp;<span class="ident" id="5410443">err</span>&nbsp;<span class="op" id="5410447">!=</span>&nbsp;<span class="builtintype" id="5410450">nil</span>&nbsp;<span class="op" id="5410454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5410458">enc</span><span class="op" id="5410461">.</span><span class="ident" id="5410462">err</span>&nbsp;<span class="op" id="5410466">=</span>&nbsp;<span class="ident" id="5410468">err</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5410473">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5410476">encodeStatePool</span><span class="op" id="5410491">.</span><span class="ident" id="5410492">Put</span><span class="op" id="5410495">(</span><span class="ident" id="5410496">e</span><span class="op" id="5410497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5410500">return</span>&nbsp;<span class="ident" id="5410507">err</span><br>
<span class="lineno"></span><span class="op" id="5410511">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="comment" id="5410514">//&nbsp;RawMessage&nbsp;is&nbsp;a&nbsp;raw&nbsp;encoded&nbsp;JSON&nbsp;object.</span><br>
<span class="lineno"></span><span class="comment" id="5410558">//&nbsp;It&nbsp;implements&nbsp;Marshaler&nbsp;and&nbsp;Unmarshaler&nbsp;and&nbsp;can</span><br>
<span class="lineno"></span><span class="comment" id="5410609">//&nbsp;be&nbsp;used&nbsp;to&nbsp;delay&nbsp;JSON&nbsp;decoding&nbsp;or&nbsp;precompute&nbsp;a&nbsp;JSON&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="5410674">type</span>&nbsp;<span class="ident" id="5410679">RawMessage</span>&nbsp;<span class="op" id="5410690">[</span><span class="op" id="5410691">]</span><span class="builtintype" id="5410692">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="comment" id="5410698">//&nbsp;MarshalJSON&nbsp;returns&nbsp;*m&nbsp;as&nbsp;the&nbsp;JSON&nbsp;encoding&nbsp;of&nbsp;m.</span><br>
<span class="lineno"></span><span class="keyword" id="5410751">func</span>&nbsp;<span class="op" id="5410756">(</span><span class="ident" id="5410757">m</span>&nbsp;<span class="op" id="5410759">*</span><span class="ident" id="5410760">RawMessage</span><span class="op" id="5410770">)</span>&nbsp;<span class="ident" id="5410772">MarshalJSON</span><span class="op" id="5410783">(</span><span class="op" id="5410784">)</span>&nbsp;<span class="op" id="5410786">(</span><span class="op" id="5410787">[</span><span class="op" id="5410788">]</span><span class="builtintype" id="5410789">byte</span><span class="op" id="5410793">,</span>&nbsp;<span class="builtintype" id="5410795">error</span><span class="op" id="5410800">)</span>&nbsp;<span class="op" id="5410802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5410805">return</span>&nbsp;<span class="op" id="5410812">*</span><span class="ident" id="5410813">m</span><span class="op" id="5410814">,</span>&nbsp;<span class="builtintype" id="5410816">nil</span><br>
<span class="lineno"></span><span class="op" id="5410820">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="comment" id="5410823">//&nbsp;UnmarshalJSON&nbsp;sets&nbsp;*m&nbsp;to&nbsp;a&nbsp;copy&nbsp;of&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="5410867">func</span>&nbsp;<span class="op" id="5410872">(</span><span class="ident" id="5410873">m</span>&nbsp;<span class="op" id="5410875">*</span><span class="ident" id="5410876">RawMessage</span><span class="op" id="5410886">)</span>&nbsp;<span class="ident" id="5410888">UnmarshalJSON</span><span class="op" id="5410901">(</span><span class="ident" id="5410902">data</span>&nbsp;<span class="op" id="5410907">[</span><span class="op" id="5410908">]</span><span class="builtintype" id="5410909">byte</span><span class="op" id="5410913">)</span>&nbsp;<span class="builtintype" id="5410915">error</span>&nbsp;<span class="op" id="5410921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5410924">if</span>&nbsp;<span class="ident" id="5410927">m</span>&nbsp;<span class="op" id="5410929">==</span>&nbsp;<span class="builtintype" id="5410932">nil</span>&nbsp;<span class="op" id="5410936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5410940">return</span>&nbsp;<span class="ident" id="5410947">errors</span><span class="op" id="5410953">.</span><span class="ident" id="5410954">New</span><span class="op" id="5410957">(</span><span class="string" id="5410958">&#34;json.RawMessage:&nbsp;UnmarshalJSON&nbsp;on&nbsp;nil&nbsp;pointer&#34;</span><span class="op" id="5411005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5411008">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5411011">*</span><span class="ident" id="5411012">m</span>&nbsp;<span class="op" id="5411014">=</span>&nbsp;<span class="builtinfunc" id="5411016">append</span><span class="op" id="5411022">(</span><span class="op" id="5411023">(</span><span class="op" id="5411024">*</span><span class="ident" id="5411025">m</span><span class="op" id="5411026">)</span><span class="op" id="5411027">[</span><span class="num" id="5411028">0</span><span class="op" id="5411029">:</span><span class="num" id="5411030">0</span><span class="op" id="5411031">]</span><span class="op" id="5411032">,</span>&nbsp;<span class="ident" id="5411034">data</span><span class="op" id="5411038">...</span><span class="op" id="5411041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5411044">return</span>&nbsp;<span class="builtintype" id="5411051">nil</span><br>
<span class="lineno"></span><span class="op" id="5411055">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5411058">var</span>&nbsp;<span class="ident" id="5411062">_</span>&nbsp;<span class="ident" id="5411064">Marshaler</span>&nbsp;<span class="op" id="5411074">=</span>&nbsp;<span class="op" id="5411076">(</span><span class="op" id="5411077">*</span><span class="ident" id="5411078">RawMessage</span><span class="op" id="5411088">)</span><span class="op" id="5411089">(</span><span class="builtintype" id="5411090">nil</span><span class="op" id="5411093">)</span><br>
<span class="lineno">200</span><span class="keyword" id="5411095">var</span>&nbsp;<span class="ident" id="5411099">_</span>&nbsp;<span class="ident" id="5411101">Unmarshaler</span>&nbsp;<span class="op" id="5411113">=</span>&nbsp;<span class="op" id="5411115">(</span><span class="op" id="5411116">*</span><span class="ident" id="5411117">RawMessage</span><span class="op" id="5411127">)</span><span class="op" id="5411128">(</span><span class="builtintype" id="5411129">nil</span><span class="op" id="5411132">)</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
