<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5907527">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5907582">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5907636">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5907687">package</span>&nbsp;<span class="ident" id="5907695">zip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5907700">import</span>&nbsp;<span class="op" id="5907707">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5907710">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5907719">&#34;encoding/binary&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5907738">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5907748">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5907756">&#34;hash/crc32&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5907770">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="5907775">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="5907778">//&nbsp;TODO(adg):&nbsp;support&nbsp;zip&nbsp;file&nbsp;comments</span><br>
<span class="lineno"></span><span class="comment" id="5907818">//&nbsp;TODO(adg):&nbsp;support&nbsp;specifying&nbsp;deflate&nbsp;level</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5907866">//&nbsp;Writer&nbsp;implements&nbsp;a&nbsp;zip&nbsp;file&nbsp;writer.</span><br>
<span class="lineno">20</span><span class="keyword" id="5907906">type</span>&nbsp;<span class="ident" id="5907911">Writer</span>&nbsp;<span class="keyword" id="5907918">struct</span>&nbsp;<span class="op" id="5907925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5907928">cw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5907935">*</span><span class="ident" id="5907936">countWriter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5907949">dir</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5907956">[</span><span class="op" id="5907957">]</span><span class="op" id="5907958">*</span><span class="ident" id="5907959">header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5907967">last</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5907974">*</span><span class="ident" id="5907975">fileWriter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5907987">closed</span>&nbsp;<span class="builtintype" id="5907994">bool</span><br>
<span class="lineno">25</span><span class="op" id="5907999">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5908002">type</span>&nbsp;<span class="ident" id="5908007">header</span>&nbsp;<span class="keyword" id="5908014">struct</span>&nbsp;<span class="op" id="5908021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5908024">*</span><span class="ident" id="5908025">FileHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5908037">offset</span>&nbsp;<span class="ident" id="5908044">uint64</span><br>
<span class="lineno">30</span><span class="op" id="5908051">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5908054">//&nbsp;NewWriter&nbsp;returns&nbsp;a&nbsp;new&nbsp;Writer&nbsp;writing&nbsp;a&nbsp;zip&nbsp;file&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="5908113">func</span>&nbsp;<span class="ident" id="5908118">NewWriter</span><span class="op" id="5908127">(</span><span class="ident" id="5908128">w</span>&nbsp;<span class="ident" id="5908130">io</span><span class="op" id="5908132">.</span><span class="ident" id="5908133">Writer</span><span class="op" id="5908139">)</span>&nbsp;<span class="op" id="5908141">*</span><span class="ident" id="5908142">Writer</span>&nbsp;<span class="op" id="5908149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5908152">return</span>&nbsp;<span class="op" id="5908159">&amp;</span><span class="ident" id="5908160">Writer</span><span class="op" id="5908166">{</span><span class="ident" id="5908167">cw</span><span class="op" id="5908169">:</span>&nbsp;<span class="op" id="5908171">&amp;</span><span class="ident" id="5908172">countWriter</span><span class="op" id="5908183">{</span><span class="ident" id="5908184">w</span><span class="op" id="5908185">:</span>&nbsp;<span class="ident" id="5908187">bufio</span><span class="op" id="5908192">.</span><span class="ident" id="5908193">NewWriter</span><span class="op" id="5908202">(</span><span class="ident" id="5908203">w</span><span class="op" id="5908204">)</span><span class="op" id="5908205">}</span><span class="op" id="5908206">}</span><br>
<span class="lineno">35</span><span class="op" id="5908208">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5908211">//&nbsp;Flush&nbsp;flushes&nbsp;any&nbsp;buffered&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno"></span><span class="comment" id="5908272">//&nbsp;Calling&nbsp;Flush&nbsp;is&nbsp;not&nbsp;normally&nbsp;necessary;&nbsp;calling&nbsp;Close&nbsp;is&nbsp;sufficient.</span><br>
<span class="lineno"></span><span class="keyword" id="5908345">func</span>&nbsp;<span class="op" id="5908350">(</span><span class="ident" id="5908351">w</span>&nbsp;<span class="op" id="5908353">*</span><span class="ident" id="5908354">Writer</span><span class="op" id="5908360">)</span>&nbsp;<span class="ident" id="5908362">Flush</span><span class="op" id="5908367">(</span><span class="op" id="5908368">)</span>&nbsp;<span class="builtintype" id="5908370">error</span>&nbsp;<span class="op" id="5908376">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5908379">return</span>&nbsp;<span class="ident" id="5908386">w</span><span class="op" id="5908387">.</span><span class="ident" id="5908388">cw</span><span class="op" id="5908390">.</span><span class="ident" id="5908391">w</span><span class="op" id="5908392">.</span><span class="op" id="5908393">(</span><span class="op" id="5908394">*</span><span class="ident" id="5908395">bufio</span><span class="op" id="5908400">.</span><span class="ident" id="5908401">Writer</span><span class="op" id="5908407">)</span><span class="op" id="5908408">.</span><span class="ident" id="5908409">Flush</span><span class="op" id="5908414">(</span><span class="op" id="5908415">)</span><br>
<span class="lineno"></span><span class="op" id="5908417">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5908420">//&nbsp;Close&nbsp;finishes&nbsp;writing&nbsp;the&nbsp;zip&nbsp;file&nbsp;by&nbsp;writing&nbsp;the&nbsp;central&nbsp;directory.</span><br>
<span class="lineno"></span><span class="comment" id="5908493">//&nbsp;It&nbsp;does&nbsp;not&nbsp;(and&nbsp;can&nbsp;not)&nbsp;close&nbsp;the&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno">45</span><span class="keyword" id="5908551">func</span>&nbsp;<span class="op" id="5908556">(</span><span class="ident" id="5908557">w</span>&nbsp;<span class="op" id="5908559">*</span><span class="ident" id="5908560">Writer</span><span class="op" id="5908566">)</span>&nbsp;<span class="ident" id="5908568">Close</span><span class="op" id="5908573">(</span><span class="op" id="5908574">)</span>&nbsp;<span class="builtintype" id="5908576">error</span>&nbsp;<span class="op" id="5908582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5908585">if</span>&nbsp;<span class="ident" id="5908588">w</span><span class="op" id="5908589">.</span><span class="ident" id="5908590">last</span>&nbsp;<span class="op" id="5908595">!=</span>&nbsp;<span class="ident" id="5908598">nil</span>&nbsp;<span class="op" id="5908602">&amp;&amp;</span>&nbsp;<span class="op" id="5908605">!</span><span class="ident" id="5908606">w</span><span class="op" id="5908607">.</span><span class="ident" id="5908608">last</span><span class="op" id="5908612">.</span><span class="ident" id="5908613">closed</span>&nbsp;<span class="op" id="5908620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5908624">if</span>&nbsp;<span class="ident" id="5908627">err</span>&nbsp;<span class="op" id="5908631">:=</span>&nbsp;<span class="ident" id="5908634">w</span><span class="op" id="5908635">.</span><span class="ident" id="5908636">last</span><span class="op" id="5908640">.</span><span class="builtinfunc" id="5908641">close</span><span class="op" id="5908646">(</span><span class="op" id="5908647">)</span><span class="op" id="5908648">;</span>&nbsp;<span class="ident" id="5908650">err</span>&nbsp;<span class="op" id="5908654">!=</span>&nbsp;<span class="ident" id="5908657">nil</span>&nbsp;<span class="op" id="5908661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5908666">return</span>&nbsp;<span class="ident" id="5908673">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5908679">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5908683">w</span><span class="op" id="5908684">.</span><span class="ident" id="5908685">last</span>&nbsp;<span class="op" id="5908690">=</span>&nbsp;<span class="ident" id="5908692">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5908697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5908700">if</span>&nbsp;<span class="ident" id="5908703">w</span><span class="op" id="5908704">.</span><span class="ident" id="5908705">closed</span>&nbsp;<span class="op" id="5908712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5908716">return</span>&nbsp;<span class="ident" id="5908723">errors</span><span class="op" id="5908729">.</span><span class="ident" id="5908730">New</span><span class="op" id="5908733">(</span><span class="string" id="5908734">&#34;zip:&nbsp;writer&nbsp;closed&nbsp;twice&#34;</span><span class="op" id="5908760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5908763">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5908766">w</span><span class="op" id="5908767">.</span><span class="ident" id="5908768">closed</span>&nbsp;<span class="op" id="5908775">=</span>&nbsp;<span class="builtintype" id="5908777">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5908784">//&nbsp;write&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5908812">start</span>&nbsp;<span class="op" id="5908818">:=</span>&nbsp;<span class="ident" id="5908821">w</span><span class="op" id="5908822">.</span><span class="ident" id="5908823">cw</span><span class="op" id="5908825">.</span><span class="ident" id="5908826">count</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5908833">for</span>&nbsp;<span class="ident" id="5908837">_</span><span class="op" id="5908838">,</span>&nbsp;<span class="ident" id="5908840">h</span>&nbsp;<span class="op" id="5908842">:=</span>&nbsp;<span class="keyword" id="5908845">range</span>&nbsp;<span class="ident" id="5908851">w</span><span class="op" id="5908852">.</span><span class="ident" id="5908853">dir</span>&nbsp;<span class="op" id="5908857">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5908861">var</span>&nbsp;<span class="ident" id="5908865">buf</span>&nbsp;<span class="op" id="5908869">[</span><span class="ident" id="5908870">directoryHeaderLen</span><span class="op" id="5908888">]</span><span class="builtintype" id="5908889">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5908896">b</span>&nbsp;<span class="op" id="5908898">:=</span>&nbsp;<span class="ident" id="5908901">writeBuf</span><span class="op" id="5908909">(</span><span class="ident" id="5908910">buf</span><span class="op" id="5908913">[</span><span class="op" id="5908914">:</span><span class="op" id="5908915">]</span><span class="op" id="5908916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5908920">b</span><span class="op" id="5908921">.</span><span class="builtintype" id="5908922">uint32</span><span class="op" id="5908928">(</span><span class="builtintype" id="5908929">uint32</span><span class="op" id="5908935">(</span><span class="ident" id="5908936">directoryHeaderSignature</span><span class="op" id="5908960">)</span><span class="op" id="5908961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5908965">b</span><span class="op" id="5908966">.</span><span class="builtintype" id="5908967">uint16</span><span class="op" id="5908973">(</span><span class="ident" id="5908974">h</span><span class="op" id="5908975">.</span><span class="ident" id="5908976">CreatorVersion</span><span class="op" id="5908990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5908994">b</span><span class="op" id="5908995">.</span><span class="builtintype" id="5908996">uint16</span><span class="op" id="5909002">(</span><span class="ident" id="5909003">h</span><span class="op" id="5909004">.</span><span class="ident" id="5909005">ReaderVersion</span><span class="op" id="5909018">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5909022">b</span><span class="op" id="5909023">.</span><span class="builtintype" id="5909024">uint16</span><span class="op" id="5909030">(</span><span class="ident" id="5909031">h</span><span class="op" id="5909032">.</span><span class="ident" id="5909033">Flags</span><span class="op" id="5909038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5909042">b</span><span class="op" id="5909043">.</span><span class="builtintype" id="5909044">uint16</span><span class="op" id="5909050">(</span><span class="ident" id="5909051">h</span><span class="op" id="5909052">.</span><span class="ident" id="5909053">Method</span><span class="op" id="5909059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5909063">b</span><span class="op" id="5909064">.</span><span class="builtintype" id="5909065">uint16</span><span class="op" id="5909071">(</span><span class="ident" id="5909072">h</span><span class="op" id="5909073">.</span><span class="ident" id="5909074">ModifiedTime</span><span class="op" id="5909086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5909090">b</span><span class="op" id="5909091">.</span><span class="builtintype" id="5909092">uint16</span><span class="op" id="5909098">(</span><span class="ident" id="5909099">h</span><span class="op" id="5909100">.</span><span class="ident" id="5909101">ModifiedDate</span><span class="op" id="5909113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5909117">b</span><span class="op" id="5909118">.</span><span class="builtintype" id="5909119">uint32</span><span class="op" id="5909125">(</span><span class="ident" id="5909126">h</span><span class="op" id="5909127">.</span><span class="ident" id="5909128">CRC32</span><span class="op" id="5909133">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5909137">if</span>&nbsp;<span class="ident" id="5909140">h</span><span class="op" id="5909141">.</span><span class="ident" id="5909142">isZip64</span><span class="op" id="5909149">(</span><span class="op" id="5909150">)</span>&nbsp;<span class="op" id="5909152">||</span>&nbsp;<span class="ident" id="5909155">h</span><span class="op" id="5909156">.</span><span class="ident" id="5909157">offset</span>&nbsp;<span class="op" id="5909164">&gt;</span>&nbsp;<span class="ident" id="5909166">uint32max</span>&nbsp;<span class="op" id="5909176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5909181">//&nbsp;the&nbsp;file&nbsp;needs&nbsp;a&nbsp;zip64&nbsp;header.&nbsp;store&nbsp;maxint&nbsp;in&nbsp;both</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5909239">//&nbsp;32&nbsp;bit&nbsp;size&nbsp;fields&nbsp;(and&nbsp;offset&nbsp;later)&nbsp;to&nbsp;signal&nbsp;that&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5909302">//&nbsp;zip64&nbsp;extra&nbsp;header&nbsp;should&nbsp;be&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5909343">b</span><span class="op" id="5909344">.</span><span class="builtintype" id="5909345">uint32</span><span class="op" id="5909351">(</span><span class="ident" id="5909352">uint32max</span><span class="op" id="5909361">)</span>&nbsp;<span class="comment" id="5909363">//&nbsp;compressed&nbsp;size</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5909385">b</span><span class="op" id="5909386">.</span><span class="builtintype" id="5909387">uint32</span><span class="op" id="5909393">(</span><span class="ident" id="5909394">uint32max</span><span class="op" id="5909403">)</span>&nbsp;<span class="comment" id="5909405">//&nbsp;uncompressed&nbsp;size</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5909430">//&nbsp;append&nbsp;a&nbsp;zip64&nbsp;extra&nbsp;block&nbsp;to&nbsp;Extra</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5909472">var</span>&nbsp;<span class="ident" id="5909476">buf</span>&nbsp;<span class="op" id="5909480">[</span><span class="num" id="5909481">28</span><span class="op" id="5909483">]</span><span class="builtintype" id="5909484">byte</span>&nbsp;<span class="comment" id="5909489">//&nbsp;2x&nbsp;uint16&nbsp;+&nbsp;3x&nbsp;uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5909517">eb</span>&nbsp;<span class="op" id="5909520">:=</span>&nbsp;<span class="ident" id="5909523">writeBuf</span><span class="op" id="5909531">(</span><span class="ident" id="5909532">buf</span><span class="op" id="5909535">[</span><span class="op" id="5909536">:</span><span class="op" id="5909537">]</span><span class="op" id="5909538">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5909543">eb</span><span class="op" id="5909545">.</span><span class="builtintype" id="5909546">uint16</span><span class="op" id="5909552">(</span><span class="ident" id="5909553">zip64ExtraId</span><span class="op" id="5909565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5909570">eb</span><span class="op" id="5909572">.</span><span class="builtintype" id="5909573">uint16</span><span class="op" id="5909579">(</span><span class="num" id="5909580">24</span><span class="op" id="5909582">)</span>&nbsp;<span class="comment" id="5909584">//&nbsp;size&nbsp;=&nbsp;3x&nbsp;uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5909607">eb</span><span class="op" id="5909609">.</span><span class="ident" id="5909610">uint64</span><span class="op" id="5909616">(</span><span class="ident" id="5909617">h</span><span class="op" id="5909618">.</span><span class="ident" id="5909619">UncompressedSize64</span><span class="op" id="5909637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5909642">eb</span><span class="op" id="5909644">.</span><span class="ident" id="5909645">uint64</span><span class="op" id="5909651">(</span><span class="ident" id="5909652">h</span><span class="op" id="5909653">.</span><span class="ident" id="5909654">CompressedSize64</span><span class="op" id="5909670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5909675">eb</span><span class="op" id="5909677">.</span><span class="ident" id="5909678">uint64</span><span class="op" id="5909684">(</span><span class="ident" id="5909685">h</span><span class="op" id="5909686">.</span><span class="ident" id="5909687">offset</span><span class="op" id="5909693">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5909698">h</span><span class="op" id="5909699">.</span><span class="ident" id="5909700">Extra</span>&nbsp;<span class="op" id="5909706">=</span>&nbsp;<span class="builtinfunc" id="5909708">append</span><span class="op" id="5909714">(</span><span class="ident" id="5909715">h</span><span class="op" id="5909716">.</span><span class="ident" id="5909717">Extra</span><span class="op" id="5909722">,</span>&nbsp;<span class="ident" id="5909724">buf</span><span class="op" id="5909727">[</span><span class="op" id="5909728">:</span><span class="op" id="5909729">]</span><span class="op" id="5909730">...</span><span class="op" id="5909733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5909737">}</span>&nbsp;<span class="keyword" id="5909739">else</span>&nbsp;<span class="op" id="5909744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5909749">b</span><span class="op" id="5909750">.</span><span class="builtintype" id="5909751">uint32</span><span class="op" id="5909757">(</span><span class="ident" id="5909758">h</span><span class="op" id="5909759">.</span><span class="ident" id="5909760">CompressedSize</span><span class="op" id="5909774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5909779">b</span><span class="op" id="5909780">.</span><span class="builtintype" id="5909781">uint32</span><span class="op" id="5909787">(</span><span class="ident" id="5909788">h</span><span class="op" id="5909789">.</span><span class="ident" id="5909790">UncompressedSize</span><span class="op" id="5909806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5909810">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5909814">b</span><span class="op" id="5909815">.</span><span class="builtintype" id="5909816">uint16</span><span class="op" id="5909822">(</span><span class="builtintype" id="5909823">uint16</span><span class="op" id="5909829">(</span><span class="builtinfunc" id="5909830">len</span><span class="op" id="5909833">(</span><span class="ident" id="5909834">h</span><span class="op" id="5909835">.</span><span class="ident" id="5909836">Name</span><span class="op" id="5909840">)</span><span class="op" id="5909841">)</span><span class="op" id="5909842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5909846">b</span><span class="op" id="5909847">.</span><span class="builtintype" id="5909848">uint16</span><span class="op" id="5909854">(</span><span class="builtintype" id="5909855">uint16</span><span class="op" id="5909861">(</span><span class="builtinfunc" id="5909862">len</span><span class="op" id="5909865">(</span><span class="ident" id="5909866">h</span><span class="op" id="5909867">.</span><span class="ident" id="5909868">Extra</span><span class="op" id="5909873">)</span><span class="op" id="5909874">)</span><span class="op" id="5909875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5909879">b</span><span class="op" id="5909880">.</span><span class="builtintype" id="5909881">uint16</span><span class="op" id="5909887">(</span><span class="builtintype" id="5909888">uint16</span><span class="op" id="5909894">(</span><span class="builtinfunc" id="5909895">len</span><span class="op" id="5909898">(</span><span class="ident" id="5909899">h</span><span class="op" id="5909900">.</span><span class="ident" id="5909901">Comment</span><span class="op" id="5909908">)</span><span class="op" id="5909909">)</span><span class="op" id="5909910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5909914">b</span>&nbsp;<span class="op" id="5909916">=</span>&nbsp;<span class="ident" id="5909918">b</span><span class="op" id="5909919">[</span><span class="num" id="5909920">4</span><span class="op" id="5909921">:</span><span class="op" id="5909922">]</span>&nbsp;<span class="comment" id="5909924">//&nbsp;skip&nbsp;disk&nbsp;number&nbsp;start&nbsp;and&nbsp;internal&nbsp;file&nbsp;attr&nbsp;(2x&nbsp;uint16)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5909987">b</span><span class="op" id="5909988">.</span><span class="builtintype" id="5909989">uint32</span><span class="op" id="5909995">(</span><span class="ident" id="5909996">h</span><span class="op" id="5909997">.</span><span class="ident" id="5909998">ExternalAttrs</span><span class="op" id="5910011">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5910015">if</span>&nbsp;<span class="ident" id="5910018">h</span><span class="op" id="5910019">.</span><span class="ident" id="5910020">offset</span>&nbsp;<span class="op" id="5910027">&gt;</span>&nbsp;<span class="ident" id="5910029">uint32max</span>&nbsp;<span class="op" id="5910039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5910044">b</span><span class="op" id="5910045">.</span><span class="builtintype" id="5910046">uint32</span><span class="op" id="5910052">(</span><span class="ident" id="5910053">uint32max</span><span class="op" id="5910062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5910066">}</span>&nbsp;<span class="keyword" id="5910068">else</span>&nbsp;<span class="op" id="5910073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5910078">b</span><span class="op" id="5910079">.</span><span class="builtintype" id="5910080">uint32</span><span class="op" id="5910086">(</span><span class="builtintype" id="5910087">uint32</span><span class="op" id="5910093">(</span><span class="ident" id="5910094">h</span><span class="op" id="5910095">.</span><span class="ident" id="5910096">offset</span><span class="op" id="5910102">)</span><span class="op" id="5910103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5910107">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5910111">if</span>&nbsp;<span class="ident" id="5910114">_</span><span class="op" id="5910115">,</span>&nbsp;<span class="ident" id="5910117">err</span>&nbsp;<span class="op" id="5910121">:=</span>&nbsp;<span class="ident" id="5910124">w</span><span class="op" id="5910125">.</span><span class="ident" id="5910126">cw</span><span class="op" id="5910128">.</span><span class="ident" id="5910129">Write</span><span class="op" id="5910134">(</span><span class="ident" id="5910135">buf</span><span class="op" id="5910138">[</span><span class="op" id="5910139">:</span><span class="op" id="5910140">]</span><span class="op" id="5910141">)</span><span class="op" id="5910142">;</span>&nbsp;<span class="ident" id="5910144">err</span>&nbsp;<span class="op" id="5910148">!=</span>&nbsp;<span class="ident" id="5910151">nil</span>&nbsp;<span class="op" id="5910155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5910160">return</span>&nbsp;<span class="ident" id="5910167">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5910173">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5910177">if</span>&nbsp;<span class="ident" id="5910180">_</span><span class="op" id="5910181">,</span>&nbsp;<span class="ident" id="5910183">err</span>&nbsp;<span class="op" id="5910187">:=</span>&nbsp;<span class="ident" id="5910190">io</span><span class="op" id="5910192">.</span><span class="ident" id="5910193">WriteString</span><span class="op" id="5910204">(</span><span class="ident" id="5910205">w</span><span class="op" id="5910206">.</span><span class="ident" id="5910207">cw</span><span class="op" id="5910209">,</span>&nbsp;<span class="ident" id="5910211">h</span><span class="op" id="5910212">.</span><span class="ident" id="5910213">Name</span><span class="op" id="5910217">)</span><span class="op" id="5910218">;</span>&nbsp;<span class="ident" id="5910220">err</span>&nbsp;<span class="op" id="5910224">!=</span>&nbsp;<span class="ident" id="5910227">nil</span>&nbsp;<span class="op" id="5910231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5910236">return</span>&nbsp;<span class="ident" id="5910243">err</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5910249">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5910253">if</span>&nbsp;<span class="ident" id="5910256">_</span><span class="op" id="5910257">,</span>&nbsp;<span class="ident" id="5910259">err</span>&nbsp;<span class="op" id="5910263">:=</span>&nbsp;<span class="ident" id="5910266">w</span><span class="op" id="5910267">.</span><span class="ident" id="5910268">cw</span><span class="op" id="5910270">.</span><span class="ident" id="5910271">Write</span><span class="op" id="5910276">(</span><span class="ident" id="5910277">h</span><span class="op" id="5910278">.</span><span class="ident" id="5910279">Extra</span><span class="op" id="5910284">)</span><span class="op" id="5910285">;</span>&nbsp;<span class="ident" id="5910287">err</span>&nbsp;<span class="op" id="5910291">!=</span>&nbsp;<span class="ident" id="5910294">nil</span>&nbsp;<span class="op" id="5910298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5910303">return</span>&nbsp;<span class="ident" id="5910310">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5910316">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5910320">if</span>&nbsp;<span class="ident" id="5910323">_</span><span class="op" id="5910324">,</span>&nbsp;<span class="ident" id="5910326">err</span>&nbsp;<span class="op" id="5910330">:=</span>&nbsp;<span class="ident" id="5910333">io</span><span class="op" id="5910335">.</span><span class="ident" id="5910336">WriteString</span><span class="op" id="5910347">(</span><span class="ident" id="5910348">w</span><span class="op" id="5910349">.</span><span class="ident" id="5910350">cw</span><span class="op" id="5910352">,</span>&nbsp;<span class="ident" id="5910354">h</span><span class="op" id="5910355">.</span><span class="ident" id="5910356">Comment</span><span class="op" id="5910363">)</span><span class="op" id="5910364">;</span>&nbsp;<span class="ident" id="5910366">err</span>&nbsp;<span class="op" id="5910370">!=</span>&nbsp;<span class="ident" id="5910373">nil</span>&nbsp;<span class="op" id="5910377">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5910382">return</span>&nbsp;<span class="ident" id="5910389">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5910395">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5910398">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5910401">end</span>&nbsp;<span class="op" id="5910405">:=</span>&nbsp;<span class="ident" id="5910408">w</span><span class="op" id="5910409">.</span><span class="ident" id="5910410">cw</span><span class="op" id="5910412">.</span><span class="ident" id="5910413">count</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5910421">records</span>&nbsp;<span class="op" id="5910429">:=</span>&nbsp;<span class="ident" id="5910432">uint64</span><span class="op" id="5910438">(</span><span class="builtinfunc" id="5910439">len</span><span class="op" id="5910442">(</span><span class="ident" id="5910443">w</span><span class="op" id="5910444">.</span><span class="ident" id="5910445">dir</span><span class="op" id="5910448">)</span><span class="op" id="5910449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5910452">size</span>&nbsp;<span class="op" id="5910457">:=</span>&nbsp;<span class="ident" id="5910460">uint64</span><span class="op" id="5910466">(</span><span class="ident" id="5910467">end</span>&nbsp;<span class="op" id="5910471">-</span>&nbsp;<span class="ident" id="5910473">start</span><span class="op" id="5910478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5910481">offset</span>&nbsp;<span class="op" id="5910488">:=</span>&nbsp;<span class="ident" id="5910491">uint64</span><span class="op" id="5910497">(</span><span class="ident" id="5910498">start</span><span class="op" id="5910503">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5910507">if</span>&nbsp;<span class="ident" id="5910510">records</span>&nbsp;<span class="op" id="5910518">&gt;</span>&nbsp;<span class="ident" id="5910520">uint16max</span>&nbsp;<span class="op" id="5910530">||</span>&nbsp;<span class="ident" id="5910533">size</span>&nbsp;<span class="op" id="5910538">&gt;</span>&nbsp;<span class="ident" id="5910540">uint32max</span>&nbsp;<span class="op" id="5910550">||</span>&nbsp;<span class="ident" id="5910553">offset</span>&nbsp;<span class="op" id="5910560">&gt;</span>&nbsp;<span class="ident" id="5910562">uint32max</span>&nbsp;<span class="op" id="5910572">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5910576">var</span>&nbsp;<span class="ident" id="5910580">buf</span>&nbsp;<span class="op" id="5910584">[</span><span class="ident" id="5910585">directory64EndLen</span>&nbsp;<span class="op" id="5910603">+</span>&nbsp;<span class="ident" id="5910605">directory64LocLen</span><span class="op" id="5910622">]</span><span class="builtintype" id="5910623">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5910630">b</span>&nbsp;<span class="op" id="5910632">:=</span>&nbsp;<span class="ident" id="5910635">writeBuf</span><span class="op" id="5910643">(</span><span class="ident" id="5910644">buf</span><span class="op" id="5910647">[</span><span class="op" id="5910648">:</span><span class="op" id="5910649">]</span><span class="op" id="5910650">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5910655">//&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5910698">b</span><span class="op" id="5910699">.</span><span class="builtintype" id="5910700">uint32</span><span class="op" id="5910706">(</span><span class="ident" id="5910707">directory64EndSignature</span><span class="op" id="5910730">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5910734">b</span><span class="op" id="5910735">.</span><span class="ident" id="5910736">uint64</span><span class="op" id="5910742">(</span><span class="ident" id="5910743">directory64EndLen</span><span class="op" id="5910760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5910764">b</span><span class="op" id="5910765">.</span><span class="builtintype" id="5910766">uint16</span><span class="op" id="5910772">(</span><span class="ident" id="5910773">zipVersion45</span><span class="op" id="5910785">)</span>&nbsp;<span class="comment" id="5910787">//&nbsp;version&nbsp;made&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5910808">b</span><span class="op" id="5910809">.</span><span class="builtintype" id="5910810">uint16</span><span class="op" id="5910816">(</span><span class="ident" id="5910817">zipVersion45</span><span class="op" id="5910829">)</span>&nbsp;<span class="comment" id="5910831">//&nbsp;version&nbsp;needed&nbsp;to&nbsp;extract</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5910862">b</span><span class="op" id="5910863">.</span><span class="builtintype" id="5910864">uint32</span><span class="op" id="5910870">(</span><span class="num" id="5910871">0</span><span class="op" id="5910872">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5910885">//&nbsp;number&nbsp;of&nbsp;this&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5910910">b</span><span class="op" id="5910911">.</span><span class="builtintype" id="5910912">uint32</span><span class="op" id="5910918">(</span><span class="num" id="5910919">0</span><span class="op" id="5910920">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5910933">//&nbsp;number&nbsp;of&nbsp;the&nbsp;disk&nbsp;with&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5910997">b</span><span class="op" id="5910998">.</span><span class="ident" id="5910999">uint64</span><span class="op" id="5911005">(</span><span class="ident" id="5911006">records</span><span class="op" id="5911013">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5911020">//&nbsp;total&nbsp;number&nbsp;of&nbsp;entries&nbsp;in&nbsp;the&nbsp;central&nbsp;directory&nbsp;on&nbsp;this&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5911087">b</span><span class="op" id="5911088">.</span><span class="ident" id="5911089">uint64</span><span class="op" id="5911095">(</span><span class="ident" id="5911096">records</span><span class="op" id="5911103">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5911110">//&nbsp;total&nbsp;number&nbsp;of&nbsp;entries&nbsp;in&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5911164">b</span><span class="op" id="5911165">.</span><span class="ident" id="5911166">uint64</span><span class="op" id="5911172">(</span><span class="ident" id="5911173">size</span><span class="op" id="5911177">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5911187">//&nbsp;size&nbsp;of&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5911222">b</span><span class="op" id="5911223">.</span><span class="ident" id="5911224">uint64</span><span class="op" id="5911230">(</span><span class="ident" id="5911231">offset</span><span class="op" id="5911237">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5911245">//&nbsp;offset&nbsp;of&nbsp;start&nbsp;of&nbsp;central&nbsp;directory&nbsp;with&nbsp;respect&nbsp;to&nbsp;the&nbsp;starting&nbsp;disk&nbsp;number</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5911329">//&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory&nbsp;locator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5911373">b</span><span class="op" id="5911374">.</span><span class="builtintype" id="5911375">uint32</span><span class="op" id="5911381">(</span><span class="ident" id="5911382">directory64LocSignature</span><span class="op" id="5911405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5911409">b</span><span class="op" id="5911410">.</span><span class="builtintype" id="5911411">uint32</span><span class="op" id="5911417">(</span><span class="num" id="5911418">0</span><span class="op" id="5911419">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5911431">//&nbsp;number&nbsp;of&nbsp;the&nbsp;disk&nbsp;with&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5911508">b</span><span class="op" id="5911509">.</span><span class="ident" id="5911510">uint64</span><span class="op" id="5911516">(</span><span class="ident" id="5911517">uint64</span><span class="op" id="5911523">(</span><span class="ident" id="5911524">end</span><span class="op" id="5911527">)</span><span class="op" id="5911528">)</span>&nbsp;<span class="comment" id="5911530">//&nbsp;relative&nbsp;offset&nbsp;of&nbsp;the&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5911596">b</span><span class="op" id="5911597">.</span><span class="builtintype" id="5911598">uint32</span><span class="op" id="5911604">(</span><span class="num" id="5911605">1</span><span class="op" id="5911606">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5911618">//&nbsp;total&nbsp;number&nbsp;of&nbsp;disks</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5911646">if</span>&nbsp;<span class="ident" id="5911649">_</span><span class="op" id="5911650">,</span>&nbsp;<span class="ident" id="5911652">err</span>&nbsp;<span class="op" id="5911656">:=</span>&nbsp;<span class="ident" id="5911659">w</span><span class="op" id="5911660">.</span><span class="ident" id="5911661">cw</span><span class="op" id="5911663">.</span><span class="ident" id="5911664">Write</span><span class="op" id="5911669">(</span><span class="ident" id="5911670">buf</span><span class="op" id="5911673">[</span><span class="op" id="5911674">:</span><span class="op" id="5911675">]</span><span class="op" id="5911676">)</span><span class="op" id="5911677">;</span>&nbsp;<span class="ident" id="5911679">err</span>&nbsp;<span class="op" id="5911683">!=</span>&nbsp;<span class="ident" id="5911686">nil</span>&nbsp;<span class="op" id="5911690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5911695">return</span>&nbsp;<span class="ident" id="5911702">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5911708">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5911713">//&nbsp;store&nbsp;max&nbsp;values&nbsp;in&nbsp;the&nbsp;regular&nbsp;end&nbsp;record&nbsp;to&nbsp;signal&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5911776">//&nbsp;that&nbsp;the&nbsp;zip64&nbsp;values&nbsp;should&nbsp;be&nbsp;used&nbsp;instead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5911826">records</span>&nbsp;<span class="op" id="5911834">=</span>&nbsp;<span class="ident" id="5911836">uint16max</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5911848">size</span>&nbsp;<span class="op" id="5911853">=</span>&nbsp;<span class="ident" id="5911855">uint32max</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5911867">offset</span>&nbsp;<span class="op" id="5911874">=</span>&nbsp;<span class="ident" id="5911876">uint32max</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5911887">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5911891">//&nbsp;write&nbsp;end&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5911912">var</span>&nbsp;<span class="ident" id="5911916">buf</span>&nbsp;<span class="op" id="5911920">[</span><span class="ident" id="5911921">directoryEndLen</span><span class="op" id="5911936">]</span><span class="builtintype" id="5911937">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5911943">b</span>&nbsp;<span class="op" id="5911945">:=</span>&nbsp;<span class="ident" id="5911948">writeBuf</span><span class="op" id="5911956">(</span><span class="ident" id="5911957">buf</span><span class="op" id="5911960">[</span><span class="op" id="5911961">:</span><span class="op" id="5911962">]</span><span class="op" id="5911963">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5911966">b</span><span class="op" id="5911967">.</span><span class="builtintype" id="5911968">uint32</span><span class="op" id="5911974">(</span><span class="builtintype" id="5911975">uint32</span><span class="op" id="5911981">(</span><span class="ident" id="5911982">directoryEndSignature</span><span class="op" id="5912003">)</span><span class="op" id="5912004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912007">b</span>&nbsp;<span class="op" id="5912009">=</span>&nbsp;<span class="ident" id="5912011">b</span><span class="op" id="5912012">[</span><span class="num" id="5912013">4</span><span class="op" id="5912014">:</span><span class="op" id="5912015">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5912033">//&nbsp;skip&nbsp;over&nbsp;disk&nbsp;number&nbsp;and&nbsp;first&nbsp;disk&nbsp;number&nbsp;(2x&nbsp;uint16)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912093">b</span><span class="op" id="5912094">.</span><span class="builtintype" id="5912095">uint16</span><span class="op" id="5912101">(</span><span class="builtintype" id="5912102">uint16</span><span class="op" id="5912108">(</span><span class="ident" id="5912109">records</span><span class="op" id="5912116">)</span><span class="op" id="5912117">)</span>&nbsp;<span class="comment" id="5912119">//&nbsp;number&nbsp;of&nbsp;entries&nbsp;this&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912151">b</span><span class="op" id="5912152">.</span><span class="builtintype" id="5912153">uint16</span><span class="op" id="5912159">(</span><span class="builtintype" id="5912160">uint16</span><span class="op" id="5912166">(</span><span class="ident" id="5912167">records</span><span class="op" id="5912174">)</span><span class="op" id="5912175">)</span>&nbsp;<span class="comment" id="5912177">//&nbsp;number&nbsp;of&nbsp;entries&nbsp;total</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912205">b</span><span class="op" id="5912206">.</span><span class="builtintype" id="5912207">uint32</span><span class="op" id="5912213">(</span><span class="builtintype" id="5912214">uint32</span><span class="op" id="5912220">(</span><span class="ident" id="5912221">size</span><span class="op" id="5912225">)</span><span class="op" id="5912226">)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5912231">//&nbsp;size&nbsp;of&nbsp;directory</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912253">b</span><span class="op" id="5912254">.</span><span class="builtintype" id="5912255">uint32</span><span class="op" id="5912261">(</span><span class="builtintype" id="5912262">uint32</span><span class="op" id="5912268">(</span><span class="ident" id="5912269">offset</span><span class="op" id="5912275">)</span><span class="op" id="5912276">)</span>&nbsp;&nbsp;<span class="comment" id="5912279">//&nbsp;start&nbsp;of&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5912302">//&nbsp;skipped&nbsp;size&nbsp;of&nbsp;comment&nbsp;(always&nbsp;zero)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5912344">if</span>&nbsp;<span class="ident" id="5912347">_</span><span class="op" id="5912348">,</span>&nbsp;<span class="ident" id="5912350">err</span>&nbsp;<span class="op" id="5912354">:=</span>&nbsp;<span class="ident" id="5912357">w</span><span class="op" id="5912358">.</span><span class="ident" id="5912359">cw</span><span class="op" id="5912361">.</span><span class="ident" id="5912362">Write</span><span class="op" id="5912367">(</span><span class="ident" id="5912368">buf</span><span class="op" id="5912371">[</span><span class="op" id="5912372">:</span><span class="op" id="5912373">]</span><span class="op" id="5912374">)</span><span class="op" id="5912375">;</span>&nbsp;<span class="ident" id="5912377">err</span>&nbsp;<span class="op" id="5912381">!=</span>&nbsp;<span class="ident" id="5912384">nil</span>&nbsp;<span class="op" id="5912388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5912392">return</span>&nbsp;<span class="ident" id="5912399">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5912404">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5912408">return</span>&nbsp;<span class="ident" id="5912415">w</span><span class="op" id="5912416">.</span><span class="ident" id="5912417">cw</span><span class="op" id="5912419">.</span><span class="ident" id="5912420">w</span><span class="op" id="5912421">.</span><span class="op" id="5912422">(</span><span class="op" id="5912423">*</span><span class="ident" id="5912424">bufio</span><span class="op" id="5912429">.</span><span class="ident" id="5912430">Writer</span><span class="op" id="5912436">)</span><span class="op" id="5912437">.</span><span class="ident" id="5912438">Flush</span><span class="op" id="5912443">(</span><span class="op" id="5912444">)</span><br>
<span class="lineno"></span><span class="op" id="5912446">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5912449">//&nbsp;Create&nbsp;adds&nbsp;a&nbsp;file&nbsp;to&nbsp;the&nbsp;zip&nbsp;file&nbsp;using&nbsp;the&nbsp;provided&nbsp;name.</span><br>
<span class="lineno">170</span><span class="comment" id="5912512">//&nbsp;It&nbsp;returns&nbsp;a&nbsp;Writer&nbsp;to&nbsp;which&nbsp;the&nbsp;file&nbsp;contents&nbsp;should&nbsp;be&nbsp;written.</span><br>
<span class="lineno"></span><span class="comment" id="5912581">//&nbsp;The&nbsp;name&nbsp;must&nbsp;be&nbsp;a&nbsp;relative&nbsp;path:&nbsp;it&nbsp;must&nbsp;not&nbsp;start&nbsp;with&nbsp;a&nbsp;drive</span><br>
<span class="lineno"></span><span class="comment" id="5912649">//&nbsp;letter&nbsp;(e.g.&nbsp;C:)&nbsp;or&nbsp;leading&nbsp;slash,&nbsp;and&nbsp;only&nbsp;forward&nbsp;slashes&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="5912716">//&nbsp;allowed.</span><br>
<span class="lineno"></span><span class="comment" id="5912728">//&nbsp;The&nbsp;file&#39;s&nbsp;contents&nbsp;must&nbsp;be&nbsp;written&nbsp;to&nbsp;the&nbsp;io.Writer&nbsp;before&nbsp;the&nbsp;next</span><br>
<span class="lineno">175</span><span class="comment" id="5912800">//&nbsp;call&nbsp;to&nbsp;Create,&nbsp;CreateHeader,&nbsp;or&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="5912843">func</span>&nbsp;<span class="op" id="5912848">(</span><span class="ident" id="5912849">w</span>&nbsp;<span class="op" id="5912851">*</span><span class="ident" id="5912852">Writer</span><span class="op" id="5912858">)</span>&nbsp;<span class="ident" id="5912860">Create</span><span class="op" id="5912866">(</span><span class="ident" id="5912867">name</span>&nbsp;<span class="builtintype" id="5912872">string</span><span class="op" id="5912878">)</span>&nbsp;<span class="op" id="5912880">(</span><span class="ident" id="5912881">io</span><span class="op" id="5912883">.</span><span class="ident" id="5912884">Writer</span><span class="op" id="5912890">,</span>&nbsp;<span class="builtintype" id="5912892">error</span><span class="op" id="5912897">)</span>&nbsp;<span class="op" id="5912899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912902">header</span>&nbsp;<span class="op" id="5912909">:=</span>&nbsp;<span class="op" id="5912912">&amp;</span><span class="ident" id="5912913">FileHeader</span><span class="op" id="5912923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912927">Name</span><span class="op" id="5912931">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5912935">name</span><span class="op" id="5912939">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912943">Method</span><span class="op" id="5912949">:</span>&nbsp;<span class="ident" id="5912951">Deflate</span><span class="op" id="5912958">,</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5912961">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5912964">return</span>&nbsp;<span class="ident" id="5912971">w</span><span class="op" id="5912972">.</span><span class="ident" id="5912973">CreateHeader</span><span class="op" id="5912985">(</span><span class="ident" id="5912986">header</span><span class="op" id="5912992">)</span><br>
<span class="lineno"></span><span class="op" id="5912994">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5912997">//&nbsp;CreateHeader&nbsp;adds&nbsp;a&nbsp;file&nbsp;to&nbsp;the&nbsp;zip&nbsp;file&nbsp;using&nbsp;the&nbsp;provided&nbsp;FileHeader</span><br>
<span class="lineno">185</span><span class="comment" id="5913071">//&nbsp;for&nbsp;the&nbsp;file&nbsp;metadata.</span><br>
<span class="lineno"></span><span class="comment" id="5913097">//&nbsp;It&nbsp;returns&nbsp;a&nbsp;Writer&nbsp;to&nbsp;which&nbsp;the&nbsp;file&nbsp;contents&nbsp;should&nbsp;be&nbsp;written.</span><br>
<span class="lineno"></span><span class="comment" id="5913166">//&nbsp;The&nbsp;file&#39;s&nbsp;contents&nbsp;must&nbsp;be&nbsp;written&nbsp;to&nbsp;the&nbsp;io.Writer&nbsp;before&nbsp;the&nbsp;next</span><br>
<span class="lineno"></span><span class="comment" id="5913238">//&nbsp;call&nbsp;to&nbsp;Create,&nbsp;CreateHeader,&nbsp;or&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="5913281">func</span>&nbsp;<span class="op" id="5913286">(</span><span class="ident" id="5913287">w</span>&nbsp;<span class="op" id="5913289">*</span><span class="ident" id="5913290">Writer</span><span class="op" id="5913296">)</span>&nbsp;<span class="ident" id="5913298">CreateHeader</span><span class="op" id="5913310">(</span><span class="ident" id="5913311">fh</span>&nbsp;<span class="op" id="5913314">*</span><span class="ident" id="5913315">FileHeader</span><span class="op" id="5913325">)</span>&nbsp;<span class="op" id="5913327">(</span><span class="ident" id="5913328">io</span><span class="op" id="5913330">.</span><span class="ident" id="5913331">Writer</span><span class="op" id="5913337">,</span>&nbsp;<span class="builtintype" id="5913339">error</span><span class="op" id="5913344">)</span>&nbsp;<span class="op" id="5913346">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913349">if</span>&nbsp;<span class="ident" id="5913352">w</span><span class="op" id="5913353">.</span><span class="ident" id="5913354">last</span>&nbsp;<span class="op" id="5913359">!=</span>&nbsp;<span class="ident" id="5913362">nil</span>&nbsp;<span class="op" id="5913366">&amp;&amp;</span>&nbsp;<span class="op" id="5913369">!</span><span class="ident" id="5913370">w</span><span class="op" id="5913371">.</span><span class="ident" id="5913372">last</span><span class="op" id="5913376">.</span><span class="ident" id="5913377">closed</span>&nbsp;<span class="op" id="5913384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913388">if</span>&nbsp;<span class="ident" id="5913391">err</span>&nbsp;<span class="op" id="5913395">:=</span>&nbsp;<span class="ident" id="5913398">w</span><span class="op" id="5913399">.</span><span class="ident" id="5913400">last</span><span class="op" id="5913404">.</span><span class="builtinfunc" id="5913405">close</span><span class="op" id="5913410">(</span><span class="op" id="5913411">)</span><span class="op" id="5913412">;</span>&nbsp;<span class="ident" id="5913414">err</span>&nbsp;<span class="op" id="5913418">!=</span>&nbsp;<span class="ident" id="5913421">nil</span>&nbsp;<span class="op" id="5913425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913430">return</span>&nbsp;<span class="ident" id="5913437">nil</span><span class="op" id="5913440">,</span>&nbsp;<span class="ident" id="5913442">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5913448">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5913451">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5913455">fh</span><span class="op" id="5913457">.</span><span class="ident" id="5913458">Flags</span>&nbsp;<span class="op" id="5913464">|=</span>&nbsp;<span class="num" id="5913467">0x8</span>&nbsp;<span class="comment" id="5913471">//&nbsp;we&nbsp;will&nbsp;write&nbsp;a&nbsp;data&nbsp;descriptor</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5913508">fh</span><span class="op" id="5913510">.</span><span class="ident" id="5913511">CreatorVersion</span>&nbsp;<span class="op" id="5913526">=</span>&nbsp;<span class="ident" id="5913528">fh</span><span class="op" id="5913530">.</span><span class="ident" id="5913531">CreatorVersion</span><span class="op" id="5913545">&amp;</span><span class="num" id="5913546">0xff00</span>&nbsp;<span class="op" id="5913553">|</span>&nbsp;<span class="ident" id="5913555">zipVersion20</span>&nbsp;<span class="comment" id="5913568">//&nbsp;preserve&nbsp;compatibility&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5913600">fh</span><span class="op" id="5913602">.</span><span class="ident" id="5913603">ReaderVersion</span>&nbsp;<span class="op" id="5913617">=</span>&nbsp;<span class="ident" id="5913619">zipVersion20</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5913634">fw</span>&nbsp;<span class="op" id="5913637">:=</span>&nbsp;<span class="op" id="5913640">&amp;</span><span class="ident" id="5913641">fileWriter</span><span class="op" id="5913651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5913655">zipw</span><span class="op" id="5913659">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5913666">w</span><span class="op" id="5913667">.</span><span class="ident" id="5913668">cw</span><span class="op" id="5913670">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5913674">compCount</span><span class="op" id="5913683">:</span>&nbsp;<span class="op" id="5913685">&amp;</span><span class="ident" id="5913686">countWriter</span><span class="op" id="5913697">{</span><span class="ident" id="5913698">w</span><span class="op" id="5913699">:</span>&nbsp;<span class="ident" id="5913701">w</span><span class="op" id="5913702">.</span><span class="ident" id="5913703">cw</span><span class="op" id="5913705">}</span><span class="op" id="5913706">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5913710">crc32</span><span class="op" id="5913715">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5913721">crc32</span><span class="op" id="5913726">.</span><span class="ident" id="5913727">NewIEEE</span><span class="op" id="5913734">(</span><span class="op" id="5913735">)</span><span class="op" id="5913736">,</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5913739">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5913742">comp</span>&nbsp;<span class="op" id="5913747">:=</span>&nbsp;<span class="ident" id="5913750">compressor</span><span class="op" id="5913760">(</span><span class="ident" id="5913761">fh</span><span class="op" id="5913763">.</span><span class="ident" id="5913764">Method</span><span class="op" id="5913770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913773">if</span>&nbsp;<span class="ident" id="5913776">comp</span>&nbsp;<span class="op" id="5913781">==</span>&nbsp;<span class="ident" id="5913784">nil</span>&nbsp;<span class="op" id="5913788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913792">return</span>&nbsp;<span class="ident" id="5913799">nil</span><span class="op" id="5913802">,</span>&nbsp;<span class="ident" id="5913804">ErrAlgorithm</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5913818">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913821">var</span>&nbsp;<span class="ident" id="5913825">err</span>&nbsp;<span class="builtintype" id="5913829">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5913836">fw</span><span class="op" id="5913838">.</span><span class="ident" id="5913839">comp</span><span class="op" id="5913843">,</span>&nbsp;<span class="ident" id="5913845">err</span>&nbsp;<span class="op" id="5913849">=</span>&nbsp;<span class="ident" id="5913851">comp</span><span class="op" id="5913855">(</span><span class="ident" id="5913856">fw</span><span class="op" id="5913858">.</span><span class="ident" id="5913859">compCount</span><span class="op" id="5913868">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913871">if</span>&nbsp;<span class="ident" id="5913874">err</span>&nbsp;<span class="op" id="5913878">!=</span>&nbsp;<span class="ident" id="5913881">nil</span>&nbsp;<span class="op" id="5913885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913889">return</span>&nbsp;<span class="ident" id="5913896">nil</span><span class="op" id="5913899">,</span>&nbsp;<span class="ident" id="5913901">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5913906">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5913909">fw</span><span class="op" id="5913911">.</span><span class="ident" id="5913912">rawCount</span>&nbsp;<span class="op" id="5913921">=</span>&nbsp;<span class="op" id="5913923">&amp;</span><span class="ident" id="5913924">countWriter</span><span class="op" id="5913935">{</span><span class="ident" id="5913936">w</span><span class="op" id="5913937">:</span>&nbsp;<span class="ident" id="5913939">fw</span><span class="op" id="5913941">.</span><span class="ident" id="5913942">comp</span><span class="op" id="5913946">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5913950">h</span>&nbsp;<span class="op" id="5913952">:=</span>&nbsp;<span class="op" id="5913955">&amp;</span><span class="ident" id="5913956">header</span><span class="op" id="5913962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5913966">FileHeader</span><span class="op" id="5913976">:</span>&nbsp;<span class="ident" id="5913978">fh</span><span class="op" id="5913980">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5913984">offset</span><span class="op" id="5913990">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5913996">uint64</span><span class="op" id="5914002">(</span><span class="ident" id="5914003">w</span><span class="op" id="5914004">.</span><span class="ident" id="5914005">cw</span><span class="op" id="5914007">.</span><span class="ident" id="5914008">count</span><span class="op" id="5914013">)</span><span class="op" id="5914014">,</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5914017">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5914020">w</span><span class="op" id="5914021">.</span><span class="ident" id="5914022">dir</span>&nbsp;<span class="op" id="5914026">=</span>&nbsp;<span class="builtinfunc" id="5914028">append</span><span class="op" id="5914034">(</span><span class="ident" id="5914035">w</span><span class="op" id="5914036">.</span><span class="ident" id="5914037">dir</span><span class="op" id="5914040">,</span>&nbsp;<span class="ident" id="5914042">h</span><span class="op" id="5914043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5914046">fw</span><span class="op" id="5914048">.</span><span class="ident" id="5914049">header</span>&nbsp;<span class="op" id="5914056">=</span>&nbsp;<span class="ident" id="5914058">h</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5914062">if</span>&nbsp;<span class="ident" id="5914065">err</span>&nbsp;<span class="op" id="5914069">:=</span>&nbsp;<span class="ident" id="5914072">writeHeader</span><span class="op" id="5914083">(</span><span class="ident" id="5914084">w</span><span class="op" id="5914085">.</span><span class="ident" id="5914086">cw</span><span class="op" id="5914088">,</span>&nbsp;<span class="ident" id="5914090">fh</span><span class="op" id="5914092">)</span><span class="op" id="5914093">;</span>&nbsp;<span class="ident" id="5914095">err</span>&nbsp;<span class="op" id="5914099">!=</span>&nbsp;<span class="ident" id="5914102">nil</span>&nbsp;<span class="op" id="5914106">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5914110">return</span>&nbsp;<span class="ident" id="5914117">nil</span><span class="op" id="5914120">,</span>&nbsp;<span class="ident" id="5914122">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5914127">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5914131">w</span><span class="op" id="5914132">.</span><span class="ident" id="5914133">last</span>&nbsp;<span class="op" id="5914138">=</span>&nbsp;<span class="ident" id="5914140">fw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5914144">return</span>&nbsp;<span class="ident" id="5914151">fw</span><span class="op" id="5914153">,</span>&nbsp;<span class="ident" id="5914155">nil</span><br>
<span class="lineno">230</span><span class="op" id="5914159">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5914162">func</span>&nbsp;<span class="ident" id="5914167">writeHeader</span><span class="op" id="5914178">(</span><span class="ident" id="5914179">w</span>&nbsp;<span class="ident" id="5914181">io</span><span class="op" id="5914183">.</span><span class="ident" id="5914184">Writer</span><span class="op" id="5914190">,</span>&nbsp;<span class="ident" id="5914192">h</span>&nbsp;<span class="op" id="5914194">*</span><span class="ident" id="5914195">FileHeader</span><span class="op" id="5914205">)</span>&nbsp;<span class="builtintype" id="5914207">error</span>&nbsp;<span class="op" id="5914213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5914216">var</span>&nbsp;<span class="ident" id="5914220">buf</span>&nbsp;<span class="op" id="5914224">[</span><span class="ident" id="5914225">fileHeaderLen</span><span class="op" id="5914238">]</span><span class="builtintype" id="5914239">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5914245">b</span>&nbsp;<span class="op" id="5914247">:=</span>&nbsp;<span class="ident" id="5914250">writeBuf</span><span class="op" id="5914258">(</span><span class="ident" id="5914259">buf</span><span class="op" id="5914262">[</span><span class="op" id="5914263">:</span><span class="op" id="5914264">]</span><span class="op" id="5914265">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5914268">b</span><span class="op" id="5914269">.</span><span class="builtintype" id="5914270">uint32</span><span class="op" id="5914276">(</span><span class="builtintype" id="5914277">uint32</span><span class="op" id="5914283">(</span><span class="ident" id="5914284">fileHeaderSignature</span><span class="op" id="5914303">)</span><span class="op" id="5914304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5914307">b</span><span class="op" id="5914308">.</span><span class="builtintype" id="5914309">uint16</span><span class="op" id="5914315">(</span><span class="ident" id="5914316">h</span><span class="op" id="5914317">.</span><span class="ident" id="5914318">ReaderVersion</span><span class="op" id="5914331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5914334">b</span><span class="op" id="5914335">.</span><span class="builtintype" id="5914336">uint16</span><span class="op" id="5914342">(</span><span class="ident" id="5914343">h</span><span class="op" id="5914344">.</span><span class="ident" id="5914345">Flags</span><span class="op" id="5914350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5914353">b</span><span class="op" id="5914354">.</span><span class="builtintype" id="5914355">uint16</span><span class="op" id="5914361">(</span><span class="ident" id="5914362">h</span><span class="op" id="5914363">.</span><span class="ident" id="5914364">Method</span><span class="op" id="5914370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5914373">b</span><span class="op" id="5914374">.</span><span class="builtintype" id="5914375">uint16</span><span class="op" id="5914381">(</span><span class="ident" id="5914382">h</span><span class="op" id="5914383">.</span><span class="ident" id="5914384">ModifiedTime</span><span class="op" id="5914396">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5914399">b</span><span class="op" id="5914400">.</span><span class="builtintype" id="5914401">uint16</span><span class="op" id="5914407">(</span><span class="ident" id="5914408">h</span><span class="op" id="5914409">.</span><span class="ident" id="5914410">ModifiedDate</span><span class="op" id="5914422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5914425">b</span><span class="op" id="5914426">.</span><span class="builtintype" id="5914427">uint32</span><span class="op" id="5914433">(</span><span class="num" id="5914434">0</span><span class="op" id="5914435">)</span>&nbsp;<span class="comment" id="5914437">//&nbsp;since&nbsp;we&nbsp;are&nbsp;writing&nbsp;a&nbsp;data&nbsp;descriptor&nbsp;crc32,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5914487">b</span><span class="op" id="5914488">.</span><span class="builtintype" id="5914489">uint32</span><span class="op" id="5914495">(</span><span class="num" id="5914496">0</span><span class="op" id="5914497">)</span>&nbsp;<span class="comment" id="5914499">//&nbsp;compressed&nbsp;size,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5914520">b</span><span class="op" id="5914521">.</span><span class="builtintype" id="5914522">uint32</span><span class="op" id="5914528">(</span><span class="num" id="5914529">0</span><span class="op" id="5914530">)</span>&nbsp;<span class="comment" id="5914532">//&nbsp;and&nbsp;uncompressed&nbsp;size&nbsp;should&nbsp;be&nbsp;zero</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5914573">b</span><span class="op" id="5914574">.</span><span class="builtintype" id="5914575">uint16</span><span class="op" id="5914581">(</span><span class="builtintype" id="5914582">uint16</span><span class="op" id="5914588">(</span><span class="builtinfunc" id="5914589">len</span><span class="op" id="5914592">(</span><span class="ident" id="5914593">h</span><span class="op" id="5914594">.</span><span class="ident" id="5914595">Name</span><span class="op" id="5914599">)</span><span class="op" id="5914600">)</span><span class="op" id="5914601">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5914604">b</span><span class="op" id="5914605">.</span><span class="builtintype" id="5914606">uint16</span><span class="op" id="5914612">(</span><span class="builtintype" id="5914613">uint16</span><span class="op" id="5914619">(</span><span class="builtinfunc" id="5914620">len</span><span class="op" id="5914623">(</span><span class="ident" id="5914624">h</span><span class="op" id="5914625">.</span><span class="ident" id="5914626">Extra</span><span class="op" id="5914631">)</span><span class="op" id="5914632">)</span><span class="op" id="5914633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5914636">if</span>&nbsp;<span class="ident" id="5914639">_</span><span class="op" id="5914640">,</span>&nbsp;<span class="ident" id="5914642">err</span>&nbsp;<span class="op" id="5914646">:=</span>&nbsp;<span class="ident" id="5914649">w</span><span class="op" id="5914650">.</span><span class="ident" id="5914651">Write</span><span class="op" id="5914656">(</span><span class="ident" id="5914657">buf</span><span class="op" id="5914660">[</span><span class="op" id="5914661">:</span><span class="op" id="5914662">]</span><span class="op" id="5914663">)</span><span class="op" id="5914664">;</span>&nbsp;<span class="ident" id="5914666">err</span>&nbsp;<span class="op" id="5914670">!=</span>&nbsp;<span class="ident" id="5914673">nil</span>&nbsp;<span class="op" id="5914677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5914681">return</span>&nbsp;<span class="ident" id="5914688">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5914693">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5914696">if</span>&nbsp;<span class="ident" id="5914699">_</span><span class="op" id="5914700">,</span>&nbsp;<span class="ident" id="5914702">err</span>&nbsp;<span class="op" id="5914706">:=</span>&nbsp;<span class="ident" id="5914709">io</span><span class="op" id="5914711">.</span><span class="ident" id="5914712">WriteString</span><span class="op" id="5914723">(</span><span class="ident" id="5914724">w</span><span class="op" id="5914725">,</span>&nbsp;<span class="ident" id="5914727">h</span><span class="op" id="5914728">.</span><span class="ident" id="5914729">Name</span><span class="op" id="5914733">)</span><span class="op" id="5914734">;</span>&nbsp;<span class="ident" id="5914736">err</span>&nbsp;<span class="op" id="5914740">!=</span>&nbsp;<span class="ident" id="5914743">nil</span>&nbsp;<span class="op" id="5914747">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5914751">return</span>&nbsp;<span class="ident" id="5914758">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5914763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5914766">_</span><span class="op" id="5914767">,</span>&nbsp;<span class="ident" id="5914769">err</span>&nbsp;<span class="op" id="5914773">:=</span>&nbsp;<span class="ident" id="5914776">w</span><span class="op" id="5914777">.</span><span class="ident" id="5914778">Write</span><span class="op" id="5914783">(</span><span class="ident" id="5914784">h</span><span class="op" id="5914785">.</span><span class="ident" id="5914786">Extra</span><span class="op" id="5914791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5914794">return</span>&nbsp;<span class="ident" id="5914801">err</span><br>
<span class="lineno"></span><span class="op" id="5914805">}</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span><span class="keyword" id="5914808">type</span>&nbsp;<span class="ident" id="5914813">fileWriter</span>&nbsp;<span class="keyword" id="5914824">struct</span>&nbsp;<span class="op" id="5914831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5914834">*</span><span class="ident" id="5914835">header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5914843">zipw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5914853">io</span><span class="op" id="5914855">.</span><span class="ident" id="5914856">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5914864">rawCount</span>&nbsp;&nbsp;<span class="op" id="5914874">*</span><span class="ident" id="5914875">countWriter</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5914888">comp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5914898">io</span><span class="op" id="5914900">.</span><span class="ident" id="5914901">WriteCloser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5914914">compCount</span>&nbsp;<span class="op" id="5914924">*</span><span class="ident" id="5914925">countWriter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5914938">crc32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5914948">hash</span><span class="op" id="5914952">.</span><span class="ident" id="5914953">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5914961">closed</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5914971">bool</span><br>
<span class="lineno"></span><span class="op" id="5914976">}</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span><span class="keyword" id="5914979">func</span>&nbsp;<span class="op" id="5914984">(</span><span class="ident" id="5914985">w</span>&nbsp;<span class="op" id="5914987">*</span><span class="ident" id="5914988">fileWriter</span><span class="op" id="5914998">)</span>&nbsp;<span class="ident" id="5915000">Write</span><span class="op" id="5915005">(</span><span class="ident" id="5915006">p</span>&nbsp;<span class="op" id="5915008">[</span><span class="op" id="5915009">]</span><span class="builtintype" id="5915010">byte</span><span class="op" id="5915014">)</span>&nbsp;<span class="op" id="5915016">(</span><span class="builtintype" id="5915017">int</span><span class="op" id="5915020">,</span>&nbsp;<span class="builtintype" id="5915022">error</span><span class="op" id="5915027">)</span>&nbsp;<span class="op" id="5915029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5915032">if</span>&nbsp;<span class="ident" id="5915035">w</span><span class="op" id="5915036">.</span><span class="ident" id="5915037">closed</span>&nbsp;<span class="op" id="5915044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5915048">return</span>&nbsp;<span class="num" id="5915055">0</span><span class="op" id="5915056">,</span>&nbsp;<span class="ident" id="5915058">errors</span><span class="op" id="5915064">.</span><span class="ident" id="5915065">New</span><span class="op" id="5915068">(</span><span class="string" id="5915069">&#34;zip:&nbsp;write&nbsp;to&nbsp;closed&nbsp;file&#34;</span><span class="op" id="5915096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5915099">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5915102">w</span><span class="op" id="5915103">.</span><span class="ident" id="5915104">crc32</span><span class="op" id="5915109">.</span><span class="ident" id="5915110">Write</span><span class="op" id="5915115">(</span><span class="ident" id="5915116">p</span><span class="op" id="5915117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5915120">return</span>&nbsp;<span class="ident" id="5915127">w</span><span class="op" id="5915128">.</span><span class="ident" id="5915129">rawCount</span><span class="op" id="5915137">.</span><span class="ident" id="5915138">Write</span><span class="op" id="5915143">(</span><span class="ident" id="5915144">p</span><span class="op" id="5915145">)</span><br>
<span class="lineno"></span><span class="op" id="5915147">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5915150">func</span>&nbsp;<span class="op" id="5915155">(</span><span class="ident" id="5915156">w</span>&nbsp;<span class="op" id="5915158">*</span><span class="ident" id="5915159">fileWriter</span><span class="op" id="5915169">)</span>&nbsp;<span class="builtinfunc" id="5915171">close</span><span class="op" id="5915176">(</span><span class="op" id="5915177">)</span>&nbsp;<span class="builtintype" id="5915179">error</span>&nbsp;<span class="op" id="5915185">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5915188">if</span>&nbsp;<span class="ident" id="5915191">w</span><span class="op" id="5915192">.</span><span class="ident" id="5915193">closed</span>&nbsp;<span class="op" id="5915200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5915204">return</span>&nbsp;<span class="ident" id="5915211">errors</span><span class="op" id="5915217">.</span><span class="ident" id="5915218">New</span><span class="op" id="5915221">(</span><span class="string" id="5915222">&#34;zip:&nbsp;file&nbsp;closed&nbsp;twice&#34;</span><span class="op" id="5915246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5915249">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5915252">w</span><span class="op" id="5915253">.</span><span class="ident" id="5915254">closed</span>&nbsp;<span class="op" id="5915261">=</span>&nbsp;<span class="builtintype" id="5915263">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5915269">if</span>&nbsp;<span class="ident" id="5915272">err</span>&nbsp;<span class="op" id="5915276">:=</span>&nbsp;<span class="ident" id="5915279">w</span><span class="op" id="5915280">.</span><span class="ident" id="5915281">comp</span><span class="op" id="5915285">.</span><span class="ident" id="5915286">Close</span><span class="op" id="5915291">(</span><span class="op" id="5915292">)</span><span class="op" id="5915293">;</span>&nbsp;<span class="ident" id="5915295">err</span>&nbsp;<span class="op" id="5915299">!=</span>&nbsp;<span class="ident" id="5915302">nil</span>&nbsp;<span class="op" id="5915306">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5915310">return</span>&nbsp;<span class="ident" id="5915317">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5915322">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5915326">//&nbsp;update&nbsp;FileHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5915348">fh</span>&nbsp;<span class="op" id="5915351">:=</span>&nbsp;<span class="ident" id="5915354">w</span><span class="op" id="5915355">.</span><span class="ident" id="5915356">header</span><span class="op" id="5915362">.</span><span class="ident" id="5915363">FileHeader</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5915375">fh</span><span class="op" id="5915377">.</span><span class="ident" id="5915378">CRC32</span>&nbsp;<span class="op" id="5915384">=</span>&nbsp;<span class="ident" id="5915386">w</span><span class="op" id="5915387">.</span><span class="ident" id="5915388">crc32</span><span class="op" id="5915393">.</span><span class="ident" id="5915394">Sum32</span><span class="op" id="5915399">(</span><span class="op" id="5915400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5915403">fh</span><span class="op" id="5915405">.</span><span class="ident" id="5915406">CompressedSize64</span>&nbsp;<span class="op" id="5915423">=</span>&nbsp;<span class="ident" id="5915425">uint64</span><span class="op" id="5915431">(</span><span class="ident" id="5915432">w</span><span class="op" id="5915433">.</span><span class="ident" id="5915434">compCount</span><span class="op" id="5915443">.</span><span class="ident" id="5915444">count</span><span class="op" id="5915449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5915452">fh</span><span class="op" id="5915454">.</span><span class="ident" id="5915455">UncompressedSize64</span>&nbsp;<span class="op" id="5915474">=</span>&nbsp;<span class="ident" id="5915476">uint64</span><span class="op" id="5915482">(</span><span class="ident" id="5915483">w</span><span class="op" id="5915484">.</span><span class="ident" id="5915485">rawCount</span><span class="op" id="5915493">.</span><span class="ident" id="5915494">count</span><span class="op" id="5915499">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5915503">if</span>&nbsp;<span class="ident" id="5915506">fh</span><span class="op" id="5915508">.</span><span class="ident" id="5915509">isZip64</span><span class="op" id="5915516">(</span><span class="op" id="5915517">)</span>&nbsp;<span class="op" id="5915519">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5915523">fh</span><span class="op" id="5915525">.</span><span class="ident" id="5915526">CompressedSize</span>&nbsp;<span class="op" id="5915541">=</span>&nbsp;<span class="ident" id="5915543">uint32max</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5915555">fh</span><span class="op" id="5915557">.</span><span class="ident" id="5915558">UncompressedSize</span>&nbsp;<span class="op" id="5915575">=</span>&nbsp;<span class="ident" id="5915577">uint32max</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5915589">fh</span><span class="op" id="5915591">.</span><span class="ident" id="5915592">ReaderVersion</span>&nbsp;<span class="op" id="5915606">=</span>&nbsp;<span class="ident" id="5915608">zipVersion45</span>&nbsp;<span class="comment" id="5915621">//&nbsp;requires&nbsp;4.5&nbsp;-&nbsp;File&nbsp;uses&nbsp;ZIP64&nbsp;format&nbsp;extensions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5915674">}</span>&nbsp;<span class="keyword" id="5915676">else</span>&nbsp;<span class="op" id="5915681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5915685">fh</span><span class="op" id="5915687">.</span><span class="ident" id="5915688">CompressedSize</span>&nbsp;<span class="op" id="5915703">=</span>&nbsp;<span class="builtintype" id="5915705">uint32</span><span class="op" id="5915711">(</span><span class="ident" id="5915712">fh</span><span class="op" id="5915714">.</span><span class="ident" id="5915715">CompressedSize64</span><span class="op" id="5915731">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5915735">fh</span><span class="op" id="5915737">.</span><span class="ident" id="5915738">UncompressedSize</span>&nbsp;<span class="op" id="5915755">=</span>&nbsp;<span class="builtintype" id="5915757">uint32</span><span class="op" id="5915763">(</span><span class="ident" id="5915764">fh</span><span class="op" id="5915766">.</span><span class="ident" id="5915767">UncompressedSize64</span><span class="op" id="5915785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5915788">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5915792">//&nbsp;Write&nbsp;data&nbsp;descriptor.&nbsp;This&nbsp;is&nbsp;more&nbsp;complicated&nbsp;than&nbsp;one&nbsp;would</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5915859">//&nbsp;think,&nbsp;see&nbsp;e.g.&nbsp;comments&nbsp;in&nbsp;zipfile.c:putextended()&nbsp;and</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5915919">//&nbsp;http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=7073588.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5915983">//&nbsp;The&nbsp;approach&nbsp;here&nbsp;is&nbsp;to&nbsp;write&nbsp;8&nbsp;byte&nbsp;sizes&nbsp;if&nbsp;needed&nbsp;without</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5916048">//&nbsp;adding&nbsp;a&nbsp;zip64&nbsp;extra&nbsp;in&nbsp;the&nbsp;local&nbsp;header&nbsp;(too&nbsp;late&nbsp;anyway).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5916112">var</span>&nbsp;<span class="ident" id="5916116">buf</span>&nbsp;<span class="op" id="5916120">[</span><span class="op" id="5916121">]</span><span class="builtintype" id="5916122">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5916128">if</span>&nbsp;<span class="ident" id="5916131">fh</span><span class="op" id="5916133">.</span><span class="ident" id="5916134">isZip64</span><span class="op" id="5916141">(</span><span class="op" id="5916142">)</span>&nbsp;<span class="op" id="5916144">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5916148">buf</span>&nbsp;<span class="op" id="5916152">=</span>&nbsp;<span class="builtinfunc" id="5916154">make</span><span class="op" id="5916158">(</span><span class="op" id="5916159">[</span><span class="op" id="5916160">]</span><span class="builtintype" id="5916161">byte</span><span class="op" id="5916165">,</span>&nbsp;<span class="ident" id="5916167">dataDescriptor64Len</span><span class="op" id="5916186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5916189">}</span>&nbsp;<span class="keyword" id="5916191">else</span>&nbsp;<span class="op" id="5916196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5916200">buf</span>&nbsp;<span class="op" id="5916204">=</span>&nbsp;<span class="builtinfunc" id="5916206">make</span><span class="op" id="5916210">(</span><span class="op" id="5916211">[</span><span class="op" id="5916212">]</span><span class="builtintype" id="5916213">byte</span><span class="op" id="5916217">,</span>&nbsp;<span class="ident" id="5916219">dataDescriptorLen</span><span class="op" id="5916236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5916239">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5916242">b</span>&nbsp;<span class="op" id="5916244">:=</span>&nbsp;<span class="ident" id="5916247">writeBuf</span><span class="op" id="5916255">(</span><span class="ident" id="5916256">buf</span><span class="op" id="5916259">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5916262">b</span><span class="op" id="5916263">.</span><span class="builtintype" id="5916264">uint32</span><span class="op" id="5916270">(</span><span class="ident" id="5916271">dataDescriptorSignature</span><span class="op" id="5916294">)</span>&nbsp;<span class="comment" id="5916296">//&nbsp;de-facto&nbsp;standard,&nbsp;required&nbsp;by&nbsp;OS&nbsp;X</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5916336">b</span><span class="op" id="5916337">.</span><span class="builtintype" id="5916338">uint32</span><span class="op" id="5916344">(</span><span class="ident" id="5916345">fh</span><span class="op" id="5916347">.</span><span class="ident" id="5916348">CRC32</span><span class="op" id="5916353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5916356">if</span>&nbsp;<span class="ident" id="5916359">fh</span><span class="op" id="5916361">.</span><span class="ident" id="5916362">isZip64</span><span class="op" id="5916369">(</span><span class="op" id="5916370">)</span>&nbsp;<span class="op" id="5916372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5916376">b</span><span class="op" id="5916377">.</span><span class="ident" id="5916378">uint64</span><span class="op" id="5916384">(</span><span class="ident" id="5916385">fh</span><span class="op" id="5916387">.</span><span class="ident" id="5916388">CompressedSize64</span><span class="op" id="5916404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5916408">b</span><span class="op" id="5916409">.</span><span class="ident" id="5916410">uint64</span><span class="op" id="5916416">(</span><span class="ident" id="5916417">fh</span><span class="op" id="5916419">.</span><span class="ident" id="5916420">UncompressedSize64</span><span class="op" id="5916438">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5916441">}</span>&nbsp;<span class="keyword" id="5916443">else</span>&nbsp;<span class="op" id="5916448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5916452">b</span><span class="op" id="5916453">.</span><span class="builtintype" id="5916454">uint32</span><span class="op" id="5916460">(</span><span class="ident" id="5916461">fh</span><span class="op" id="5916463">.</span><span class="ident" id="5916464">CompressedSize</span><span class="op" id="5916478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5916482">b</span><span class="op" id="5916483">.</span><span class="builtintype" id="5916484">uint32</span><span class="op" id="5916490">(</span><span class="ident" id="5916491">fh</span><span class="op" id="5916493">.</span><span class="ident" id="5916494">UncompressedSize</span><span class="op" id="5916510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5916513">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5916516">_</span><span class="op" id="5916517">,</span>&nbsp;<span class="ident" id="5916519">err</span>&nbsp;<span class="op" id="5916523">:=</span>&nbsp;<span class="ident" id="5916526">w</span><span class="op" id="5916527">.</span><span class="ident" id="5916528">zipw</span><span class="op" id="5916532">.</span><span class="ident" id="5916533">Write</span><span class="op" id="5916538">(</span><span class="ident" id="5916539">buf</span><span class="op" id="5916542">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5916545">return</span>&nbsp;<span class="ident" id="5916552">err</span><br>
<span class="lineno"></span><span class="op" id="5916556">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5916559">type</span>&nbsp;<span class="ident" id="5916564">countWriter</span>&nbsp;<span class="keyword" id="5916576">struct</span>&nbsp;<span class="op" id="5916583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5916586">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5916592">io</span><span class="op" id="5916594">.</span><span class="ident" id="5916595">Writer</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5916603">count</span>&nbsp;<span class="ident" id="5916609">int64</span><br>
<span class="lineno"></span><span class="op" id="5916615">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5916618">func</span>&nbsp;<span class="op" id="5916623">(</span><span class="ident" id="5916624">w</span>&nbsp;<span class="op" id="5916626">*</span><span class="ident" id="5916627">countWriter</span><span class="op" id="5916638">)</span>&nbsp;<span class="ident" id="5916640">Write</span><span class="op" id="5916645">(</span><span class="ident" id="5916646">p</span>&nbsp;<span class="op" id="5916648">[</span><span class="op" id="5916649">]</span><span class="builtintype" id="5916650">byte</span><span class="op" id="5916654">)</span>&nbsp;<span class="op" id="5916656">(</span><span class="builtintype" id="5916657">int</span><span class="op" id="5916660">,</span>&nbsp;<span class="builtintype" id="5916662">error</span><span class="op" id="5916667">)</span>&nbsp;<span class="op" id="5916669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5916672">n</span><span class="op" id="5916673">,</span>&nbsp;<span class="ident" id="5916675">err</span>&nbsp;<span class="op" id="5916679">:=</span>&nbsp;<span class="ident" id="5916682">w</span><span class="op" id="5916683">.</span><span class="ident" id="5916684">w</span><span class="op" id="5916685">.</span><span class="ident" id="5916686">Write</span><span class="op" id="5916691">(</span><span class="ident" id="5916692">p</span><span class="op" id="5916693">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5916696">w</span><span class="op" id="5916697">.</span><span class="ident" id="5916698">count</span>&nbsp;<span class="op" id="5916704">+=</span>&nbsp;<span class="ident" id="5916707">int64</span><span class="op" id="5916712">(</span><span class="ident" id="5916713">n</span><span class="op" id="5916714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5916717">return</span>&nbsp;<span class="ident" id="5916724">n</span><span class="op" id="5916725">,</span>&nbsp;<span class="ident" id="5916727">err</span><br>
<span class="lineno"></span><span class="op" id="5916731">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5916734">type</span>&nbsp;<span class="ident" id="5916739">nopCloser</span>&nbsp;<span class="keyword" id="5916749">struct</span>&nbsp;<span class="op" id="5916756">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5916759">io</span><span class="op" id="5916761">.</span><span class="ident" id="5916762">Writer</span><br>
<span class="lineno"></span><span class="op" id="5916769">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5916772">func</span>&nbsp;<span class="op" id="5916777">(</span><span class="ident" id="5916778">w</span>&nbsp;<span class="ident" id="5916780">nopCloser</span><span class="op" id="5916789">)</span>&nbsp;<span class="ident" id="5916791">Close</span><span class="op" id="5916796">(</span><span class="op" id="5916797">)</span>&nbsp;<span class="builtintype" id="5916799">error</span>&nbsp;<span class="op" id="5916805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5916808">return</span>&nbsp;<span class="ident" id="5916815">nil</span><br>
<span class="lineno">340</span><span class="op" id="5916819">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5916822">type</span>&nbsp;<span class="ident" id="5916827">writeBuf</span>&nbsp;<span class="op" id="5916836">[</span><span class="op" id="5916837">]</span><span class="builtintype" id="5916838">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5916844">func</span>&nbsp;<span class="op" id="5916849">(</span><span class="ident" id="5916850">b</span>&nbsp;<span class="op" id="5916852">*</span><span class="ident" id="5916853">writeBuf</span><span class="op" id="5916861">)</span>&nbsp;<span class="builtintype" id="5916863">uint16</span><span class="op" id="5916869">(</span><span class="ident" id="5916870">v</span>&nbsp;<span class="builtintype" id="5916872">uint16</span><span class="op" id="5916878">)</span>&nbsp;<span class="op" id="5916880">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5916883">binary</span><span class="op" id="5916889">.</span><span class="ident" id="5916890">LittleEndian</span><span class="op" id="5916902">.</span><span class="ident" id="5916903">PutUint16</span><span class="op" id="5916912">(</span><span class="op" id="5916913">*</span><span class="ident" id="5916914">b</span><span class="op" id="5916915">,</span>&nbsp;<span class="ident" id="5916917">v</span><span class="op" id="5916918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5916921">*</span><span class="ident" id="5916922">b</span>&nbsp;<span class="op" id="5916924">=</span>&nbsp;<span class="op" id="5916926">(</span><span class="op" id="5916927">*</span><span class="ident" id="5916928">b</span><span class="op" id="5916929">)</span><span class="op" id="5916930">[</span><span class="num" id="5916931">2</span><span class="op" id="5916932">:</span><span class="op" id="5916933">]</span><br>
<span class="lineno"></span><span class="op" id="5916935">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5916938">func</span>&nbsp;<span class="op" id="5916943">(</span><span class="ident" id="5916944">b</span>&nbsp;<span class="op" id="5916946">*</span><span class="ident" id="5916947">writeBuf</span><span class="op" id="5916955">)</span>&nbsp;<span class="builtintype" id="5916957">uint32</span><span class="op" id="5916963">(</span><span class="ident" id="5916964">v</span>&nbsp;<span class="builtintype" id="5916966">uint32</span><span class="op" id="5916972">)</span>&nbsp;<span class="op" id="5916974">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5916977">binary</span><span class="op" id="5916983">.</span><span class="ident" id="5916984">LittleEndian</span><span class="op" id="5916996">.</span><span class="ident" id="5916997">PutUint32</span><span class="op" id="5917006">(</span><span class="op" id="5917007">*</span><span class="ident" id="5917008">b</span><span class="op" id="5917009">,</span>&nbsp;<span class="ident" id="5917011">v</span><span class="op" id="5917012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5917015">*</span><span class="ident" id="5917016">b</span>&nbsp;<span class="op" id="5917018">=</span>&nbsp;<span class="op" id="5917020">(</span><span class="op" id="5917021">*</span><span class="ident" id="5917022">b</span><span class="op" id="5917023">)</span><span class="op" id="5917024">[</span><span class="num" id="5917025">4</span><span class="op" id="5917026">:</span><span class="op" id="5917027">]</span><br>
<span class="lineno"></span><span class="op" id="5917029">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5917032">func</span>&nbsp;<span class="op" id="5917037">(</span><span class="ident" id="5917038">b</span>&nbsp;<span class="op" id="5917040">*</span><span class="ident" id="5917041">writeBuf</span><span class="op" id="5917049">)</span>&nbsp;<span class="ident" id="5917051">uint64</span><span class="op" id="5917057">(</span><span class="ident" id="5917058">v</span>&nbsp;<span class="ident" id="5917060">uint64</span><span class="op" id="5917066">)</span>&nbsp;<span class="op" id="5917068">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5917071">binary</span><span class="op" id="5917077">.</span><span class="ident" id="5917078">LittleEndian</span><span class="op" id="5917090">.</span><span class="ident" id="5917091">PutUint64</span><span class="op" id="5917100">(</span><span class="op" id="5917101">*</span><span class="ident" id="5917102">b</span><span class="op" id="5917103">,</span>&nbsp;<span class="ident" id="5917105">v</span><span class="op" id="5917106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5917109">*</span><span class="ident" id="5917110">b</span>&nbsp;<span class="op" id="5917112">=</span>&nbsp;<span class="op" id="5917114">(</span><span class="op" id="5917115">*</span><span class="ident" id="5917116">b</span><span class="op" id="5917117">)</span><span class="op" id="5917118">[</span><span class="num" id="5917119">8</span><span class="op" id="5917120">:</span><span class="op" id="5917121">]</span><br>
<span class="lineno"></span><span class="op" id="5917123">}</span>
</div>
</body>
</html>
