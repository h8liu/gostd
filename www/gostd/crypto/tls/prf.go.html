<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html" class="current">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3853971">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3854026">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3854080">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3854131">package</span>&nbsp;<span class="ident" id="3854139">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3854144">import</span>&nbsp;<span class="op" id="3854151">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3854154">&#34;crypto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3854164">&#34;crypto/hmac&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3854179">&#34;crypto/md5&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3854193">&#34;crypto/sha1&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3854208">&#34;crypto/sha256&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3854225">&#34;hash&#34;</span><br>
<span class="lineno"></span><span class="op" id="3854232">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="3854235">//&nbsp;Split&nbsp;a&nbsp;premaster&nbsp;secret&nbsp;in&nbsp;two&nbsp;as&nbsp;specified&nbsp;in&nbsp;RFC&nbsp;4346,&nbsp;section&nbsp;5.</span><br>
<span class="lineno"></span><span class="keyword" id="3854307">func</span>&nbsp;<span class="ident" id="3854312">splitPreMasterSecret</span><span class="op" id="3854332">(</span><span class="ident" id="3854333">secret</span>&nbsp;<span class="op" id="3854340">[</span><span class="op" id="3854341">]</span><span class="builtintype" id="3854342">byte</span><span class="op" id="3854346">)</span>&nbsp;<span class="op" id="3854348">(</span><span class="ident" id="3854349">s1</span><span class="op" id="3854351">,</span>&nbsp;<span class="ident" id="3854353">s2</span>&nbsp;<span class="op" id="3854356">[</span><span class="op" id="3854357">]</span><span class="builtintype" id="3854358">byte</span><span class="op" id="3854362">)</span>&nbsp;<span class="op" id="3854364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3854367">s1</span>&nbsp;<span class="op" id="3854370">=</span>&nbsp;<span class="ident" id="3854372">secret</span><span class="op" id="3854378">[</span><span class="num" id="3854379">0</span>&nbsp;<span class="op" id="3854381">:</span>&nbsp;<span class="op" id="3854383">(</span><span class="builtinfunc" id="3854384">len</span><span class="op" id="3854387">(</span><span class="ident" id="3854388">secret</span><span class="op" id="3854394">)</span><span class="op" id="3854395">+</span><span class="num" id="3854396">1</span><span class="op" id="3854397">)</span><span class="op" id="3854398">/</span><span class="num" id="3854399">2</span><span class="op" id="3854400">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3854403">s2</span>&nbsp;<span class="op" id="3854406">=</span>&nbsp;<span class="ident" id="3854408">secret</span><span class="op" id="3854414">[</span><span class="builtinfunc" id="3854415">len</span><span class="op" id="3854418">(</span><span class="ident" id="3854419">secret</span><span class="op" id="3854425">)</span><span class="op" id="3854426">/</span><span class="num" id="3854427">2</span><span class="op" id="3854428">:</span><span class="op" id="3854429">]</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3854432">return</span><br>
<span class="lineno"></span><span class="op" id="3854439">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3854442">//&nbsp;pHash&nbsp;implements&nbsp;the&nbsp;P_hash&nbsp;function,&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;4346,&nbsp;section&nbsp;5.</span><br>
<span class="lineno"></span><span class="keyword" id="3854518">func</span>&nbsp;<span class="ident" id="3854523">pHash</span><span class="op" id="3854528">(</span><span class="ident" id="3854529">result</span><span class="op" id="3854535">,</span>&nbsp;<span class="ident" id="3854537">secret</span><span class="op" id="3854543">,</span>&nbsp;<span class="ident" id="3854545">seed</span>&nbsp;<span class="op" id="3854550">[</span><span class="op" id="3854551">]</span><span class="builtintype" id="3854552">byte</span><span class="op" id="3854556">,</span>&nbsp;<span class="ident" id="3854558">hash</span>&nbsp;<span class="keyword" id="3854563">func</span><span class="op" id="3854567">(</span><span class="op" id="3854568">)</span>&nbsp;<span class="ident" id="3854570">hash</span><span class="op" id="3854574">.</span><span class="ident" id="3854575">Hash</span><span class="op" id="3854579">)</span>&nbsp;<span class="op" id="3854581">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3854584">h</span>&nbsp;<span class="op" id="3854586">:=</span>&nbsp;<span class="ident" id="3854589">hmac</span><span class="op" id="3854593">.</span><span class="ident" id="3854594">New</span><span class="op" id="3854597">(</span><span class="ident" id="3854598">hash</span><span class="op" id="3854602">,</span>&nbsp;<span class="ident" id="3854604">secret</span><span class="op" id="3854610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3854613">h</span><span class="op" id="3854614">.</span><span class="ident" id="3854615">Write</span><span class="op" id="3854620">(</span><span class="ident" id="3854621">seed</span><span class="op" id="3854625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3854628">a</span>&nbsp;<span class="op" id="3854630">:=</span>&nbsp;<span class="ident" id="3854633">h</span><span class="op" id="3854634">.</span><span class="ident" id="3854635">Sum</span><span class="op" id="3854638">(</span><span class="builtintype" id="3854639">nil</span><span class="op" id="3854642">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3854646">j</span>&nbsp;<span class="op" id="3854648">:=</span>&nbsp;<span class="num" id="3854651">0</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3854654">for</span>&nbsp;<span class="ident" id="3854658">j</span>&nbsp;<span class="op" id="3854660">&lt;</span>&nbsp;<span class="builtinfunc" id="3854662">len</span><span class="op" id="3854665">(</span><span class="ident" id="3854666">result</span><span class="op" id="3854672">)</span>&nbsp;<span class="op" id="3854674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3854678">h</span><span class="op" id="3854679">.</span><span class="ident" id="3854680">Reset</span><span class="op" id="3854685">(</span><span class="op" id="3854686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3854690">h</span><span class="op" id="3854691">.</span><span class="ident" id="3854692">Write</span><span class="op" id="3854697">(</span><span class="ident" id="3854698">a</span><span class="op" id="3854699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3854703">h</span><span class="op" id="3854704">.</span><span class="ident" id="3854705">Write</span><span class="op" id="3854710">(</span><span class="ident" id="3854711">seed</span><span class="op" id="3854715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3854719">b</span>&nbsp;<span class="op" id="3854721">:=</span>&nbsp;<span class="ident" id="3854724">h</span><span class="op" id="3854725">.</span><span class="ident" id="3854726">Sum</span><span class="op" id="3854729">(</span><span class="builtintype" id="3854730">nil</span><span class="op" id="3854733">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3854737">todo</span>&nbsp;<span class="op" id="3854742">:=</span>&nbsp;<span class="builtinfunc" id="3854745">len</span><span class="op" id="3854748">(</span><span class="ident" id="3854749">b</span><span class="op" id="3854750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3854754">if</span>&nbsp;<span class="ident" id="3854757">j</span><span class="op" id="3854758">+</span><span class="ident" id="3854759">todo</span>&nbsp;<span class="op" id="3854764">&gt;</span>&nbsp;<span class="builtinfunc" id="3854766">len</span><span class="op" id="3854769">(</span><span class="ident" id="3854770">result</span><span class="op" id="3854776">)</span>&nbsp;<span class="op" id="3854778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3854783">todo</span>&nbsp;<span class="op" id="3854788">=</span>&nbsp;<span class="builtinfunc" id="3854790">len</span><span class="op" id="3854793">(</span><span class="ident" id="3854794">result</span><span class="op" id="3854800">)</span>&nbsp;<span class="op" id="3854802">-</span>&nbsp;<span class="ident" id="3854804">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3854808">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3854812">copy</span><span class="op" id="3854816">(</span><span class="ident" id="3854817">result</span><span class="op" id="3854823">[</span><span class="ident" id="3854824">j</span><span class="op" id="3854825">:</span><span class="ident" id="3854826">j</span><span class="op" id="3854827">+</span><span class="ident" id="3854828">todo</span><span class="op" id="3854832">]</span><span class="op" id="3854833">,</span>&nbsp;<span class="ident" id="3854835">b</span><span class="op" id="3854836">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3854840">j</span>&nbsp;<span class="op" id="3854842">+=</span>&nbsp;<span class="ident" id="3854845">todo</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3854853">h</span><span class="op" id="3854854">.</span><span class="ident" id="3854855">Reset</span><span class="op" id="3854860">(</span><span class="op" id="3854861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3854865">h</span><span class="op" id="3854866">.</span><span class="ident" id="3854867">Write</span><span class="op" id="3854872">(</span><span class="ident" id="3854873">a</span><span class="op" id="3854874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3854878">a</span>&nbsp;<span class="op" id="3854880">=</span>&nbsp;<span class="ident" id="3854882">h</span><span class="op" id="3854883">.</span><span class="ident" id="3854884">Sum</span><span class="op" id="3854887">(</span><span class="builtintype" id="3854888">nil</span><span class="op" id="3854891">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3854894">}</span><br>
<span class="lineno"></span><span class="op" id="3854896">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3854899">//&nbsp;prf10&nbsp;implements&nbsp;the&nbsp;TLS&nbsp;1.0&nbsp;pseudo-random&nbsp;function,&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;2246,&nbsp;section&nbsp;5.</span><br>
<span class="lineno"></span><span class="keyword" id="3854990">func</span>&nbsp;<span class="ident" id="3854995">prf10</span><span class="op" id="3855000">(</span><span class="ident" id="3855001">result</span><span class="op" id="3855007">,</span>&nbsp;<span class="ident" id="3855009">secret</span><span class="op" id="3855015">,</span>&nbsp;<span class="ident" id="3855017">label</span><span class="op" id="3855022">,</span>&nbsp;<span class="ident" id="3855024">seed</span>&nbsp;<span class="op" id="3855029">[</span><span class="op" id="3855030">]</span><span class="builtintype" id="3855031">byte</span><span class="op" id="3855035">)</span>&nbsp;<span class="op" id="3855037">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3855040">hashSHA1</span>&nbsp;<span class="op" id="3855049">:=</span>&nbsp;<span class="ident" id="3855052">sha1</span><span class="op" id="3855056">.</span><span class="ident" id="3855057">New</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3855062">hashMD5</span>&nbsp;<span class="op" id="3855070">:=</span>&nbsp;<span class="ident" id="3855073">md5</span><span class="op" id="3855076">.</span><span class="ident" id="3855077">New</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3855083">labelAndSeed</span>&nbsp;<span class="op" id="3855096">:=</span>&nbsp;<span class="builtinfunc" id="3855099">make</span><span class="op" id="3855103">(</span><span class="op" id="3855104">[</span><span class="op" id="3855105">]</span><span class="builtintype" id="3855106">byte</span><span class="op" id="3855110">,</span>&nbsp;<span class="builtinfunc" id="3855112">len</span><span class="op" id="3855115">(</span><span class="ident" id="3855116">label</span><span class="op" id="3855121">)</span><span class="op" id="3855122">+</span><span class="builtinfunc" id="3855123">len</span><span class="op" id="3855126">(</span><span class="ident" id="3855127">seed</span><span class="op" id="3855131">)</span><span class="op" id="3855132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3855135">copy</span><span class="op" id="3855139">(</span><span class="ident" id="3855140">labelAndSeed</span><span class="op" id="3855152">,</span>&nbsp;<span class="ident" id="3855154">label</span><span class="op" id="3855159">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3855162">copy</span><span class="op" id="3855166">(</span><span class="ident" id="3855167">labelAndSeed</span><span class="op" id="3855179">[</span><span class="builtinfunc" id="3855180">len</span><span class="op" id="3855183">(</span><span class="ident" id="3855184">label</span><span class="op" id="3855189">)</span><span class="op" id="3855190">:</span><span class="op" id="3855191">]</span><span class="op" id="3855192">,</span>&nbsp;<span class="ident" id="3855194">seed</span><span class="op" id="3855198">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3855202">s1</span><span class="op" id="3855204">,</span>&nbsp;<span class="ident" id="3855206">s2</span>&nbsp;<span class="op" id="3855209">:=</span>&nbsp;<span class="ident" id="3855212">splitPreMasterSecret</span><span class="op" id="3855232">(</span><span class="ident" id="3855233">secret</span><span class="op" id="3855239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3855242">pHash</span><span class="op" id="3855247">(</span><span class="ident" id="3855248">result</span><span class="op" id="3855254">,</span>&nbsp;<span class="ident" id="3855256">s1</span><span class="op" id="3855258">,</span>&nbsp;<span class="ident" id="3855260">labelAndSeed</span><span class="op" id="3855272">,</span>&nbsp;<span class="ident" id="3855274">hashMD5</span><span class="op" id="3855281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3855284">result2</span>&nbsp;<span class="op" id="3855292">:=</span>&nbsp;<span class="builtinfunc" id="3855295">make</span><span class="op" id="3855299">(</span><span class="op" id="3855300">[</span><span class="op" id="3855301">]</span><span class="builtintype" id="3855302">byte</span><span class="op" id="3855306">,</span>&nbsp;<span class="builtinfunc" id="3855308">len</span><span class="op" id="3855311">(</span><span class="ident" id="3855312">result</span><span class="op" id="3855318">)</span><span class="op" id="3855319">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3855322">pHash</span><span class="op" id="3855327">(</span><span class="ident" id="3855328">result2</span><span class="op" id="3855335">,</span>&nbsp;<span class="ident" id="3855337">s2</span><span class="op" id="3855339">,</span>&nbsp;<span class="ident" id="3855341">labelAndSeed</span><span class="op" id="3855353">,</span>&nbsp;<span class="ident" id="3855355">hashSHA1</span><span class="op" id="3855363">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3855367">for</span>&nbsp;<span class="ident" id="3855371">i</span><span class="op" id="3855372">,</span>&nbsp;<span class="ident" id="3855374">b</span>&nbsp;<span class="op" id="3855376">:=</span>&nbsp;<span class="keyword" id="3855379">range</span>&nbsp;<span class="ident" id="3855385">result2</span>&nbsp;<span class="op" id="3855393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3855397">result</span><span class="op" id="3855403">[</span><span class="ident" id="3855404">i</span><span class="op" id="3855405">]</span>&nbsp;<span class="op" id="3855407">^=</span>&nbsp;<span class="ident" id="3855410">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3855413">}</span><br>
<span class="lineno">65</span><span class="op" id="3855415">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3855418">//&nbsp;prf12&nbsp;implements&nbsp;the&nbsp;TLS&nbsp;1.2&nbsp;pseudo-random&nbsp;function,&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;5246,&nbsp;section&nbsp;5.</span><br>
<span class="lineno"></span><span class="keyword" id="3855509">func</span>&nbsp;<span class="ident" id="3855514">prf12</span><span class="op" id="3855519">(</span><span class="ident" id="3855520">result</span><span class="op" id="3855526">,</span>&nbsp;<span class="ident" id="3855528">secret</span><span class="op" id="3855534">,</span>&nbsp;<span class="ident" id="3855536">label</span><span class="op" id="3855541">,</span>&nbsp;<span class="ident" id="3855543">seed</span>&nbsp;<span class="op" id="3855548">[</span><span class="op" id="3855549">]</span><span class="builtintype" id="3855550">byte</span><span class="op" id="3855554">)</span>&nbsp;<span class="op" id="3855556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3855559">labelAndSeed</span>&nbsp;<span class="op" id="3855572">:=</span>&nbsp;<span class="builtinfunc" id="3855575">make</span><span class="op" id="3855579">(</span><span class="op" id="3855580">[</span><span class="op" id="3855581">]</span><span class="builtintype" id="3855582">byte</span><span class="op" id="3855586">,</span>&nbsp;<span class="builtinfunc" id="3855588">len</span><span class="op" id="3855591">(</span><span class="ident" id="3855592">label</span><span class="op" id="3855597">)</span><span class="op" id="3855598">+</span><span class="builtinfunc" id="3855599">len</span><span class="op" id="3855602">(</span><span class="ident" id="3855603">seed</span><span class="op" id="3855607">)</span><span class="op" id="3855608">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3855611">copy</span><span class="op" id="3855615">(</span><span class="ident" id="3855616">labelAndSeed</span><span class="op" id="3855628">,</span>&nbsp;<span class="ident" id="3855630">label</span><span class="op" id="3855635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3855638">copy</span><span class="op" id="3855642">(</span><span class="ident" id="3855643">labelAndSeed</span><span class="op" id="3855655">[</span><span class="builtinfunc" id="3855656">len</span><span class="op" id="3855659">(</span><span class="ident" id="3855660">label</span><span class="op" id="3855665">)</span><span class="op" id="3855666">:</span><span class="op" id="3855667">]</span><span class="op" id="3855668">,</span>&nbsp;<span class="ident" id="3855670">seed</span><span class="op" id="3855674">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3855678">pHash</span><span class="op" id="3855683">(</span><span class="ident" id="3855684">result</span><span class="op" id="3855690">,</span>&nbsp;<span class="ident" id="3855692">secret</span><span class="op" id="3855698">,</span>&nbsp;<span class="ident" id="3855700">labelAndSeed</span><span class="op" id="3855712">,</span>&nbsp;<span class="ident" id="3855714">sha256</span><span class="op" id="3855720">.</span><span class="ident" id="3855721">New</span><span class="op" id="3855724">)</span><br>
<span class="lineno"></span><span class="op" id="3855726">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="comment" id="3855729">//&nbsp;prf30&nbsp;implements&nbsp;the&nbsp;SSL&nbsp;3.0&nbsp;pseudo-random&nbsp;function,&nbsp;as&nbsp;defined&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="3855799">//&nbsp;www.mozilla.org/projects/security/pki/nss/ssl/draft302.txt&nbsp;section&nbsp;6.</span><br>
<span class="lineno"></span><span class="keyword" id="3855872">func</span>&nbsp;<span class="ident" id="3855877">prf30</span><span class="op" id="3855882">(</span><span class="ident" id="3855883">result</span><span class="op" id="3855889">,</span>&nbsp;<span class="ident" id="3855891">secret</span><span class="op" id="3855897">,</span>&nbsp;<span class="ident" id="3855899">label</span><span class="op" id="3855904">,</span>&nbsp;<span class="ident" id="3855906">seed</span>&nbsp;<span class="op" id="3855911">[</span><span class="op" id="3855912">]</span><span class="builtintype" id="3855913">byte</span><span class="op" id="3855917">)</span>&nbsp;<span class="op" id="3855919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3855922">hashSHA1</span>&nbsp;<span class="op" id="3855931">:=</span>&nbsp;<span class="ident" id="3855934">sha1</span><span class="op" id="3855938">.</span><span class="ident" id="3855939">New</span><span class="op" id="3855942">(</span><span class="op" id="3855943">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3855946">hashMD5</span>&nbsp;<span class="op" id="3855954">:=</span>&nbsp;<span class="ident" id="3855957">md5</span><span class="op" id="3855960">.</span><span class="ident" id="3855961">New</span><span class="op" id="3855964">(</span><span class="op" id="3855965">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3855969">done</span>&nbsp;<span class="op" id="3855974">:=</span>&nbsp;<span class="num" id="3855977">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3855980">i</span>&nbsp;<span class="op" id="3855982">:=</span>&nbsp;<span class="num" id="3855985">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3855988">//&nbsp;RFC5246&nbsp;section&nbsp;6.3&nbsp;says&nbsp;that&nbsp;the&nbsp;largest&nbsp;PRF&nbsp;output&nbsp;needed&nbsp;is&nbsp;128</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3856059">//&nbsp;bytes.&nbsp;Since&nbsp;no&nbsp;more&nbsp;ciphersuites&nbsp;will&nbsp;be&nbsp;added&nbsp;to&nbsp;SSLv3,&nbsp;this&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3856131">//&nbsp;remain&nbsp;true.&nbsp;Each&nbsp;iteration&nbsp;gives&nbsp;us&nbsp;16&nbsp;bytes&nbsp;so&nbsp;10&nbsp;iterations&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3856203">//&nbsp;be&nbsp;sufficient.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3856222">var</span>&nbsp;<span class="ident" id="3856226">b</span>&nbsp;<span class="op" id="3856228">[</span><span class="num" id="3856229">11</span><span class="op" id="3856231">]</span><span class="builtintype" id="3856232">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3856238">for</span>&nbsp;<span class="ident" id="3856242">done</span>&nbsp;<span class="op" id="3856247">&lt;</span>&nbsp;<span class="builtinfunc" id="3856249">len</span><span class="op" id="3856252">(</span><span class="ident" id="3856253">result</span><span class="op" id="3856259">)</span>&nbsp;<span class="op" id="3856261">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3856265">for</span>&nbsp;<span class="ident" id="3856269">j</span>&nbsp;<span class="op" id="3856271">:=</span>&nbsp;<span class="num" id="3856274">0</span><span class="op" id="3856275">;</span>&nbsp;<span class="ident" id="3856277">j</span>&nbsp;<span class="op" id="3856279">&lt;=</span>&nbsp;<span class="ident" id="3856282">i</span><span class="op" id="3856283">;</span>&nbsp;<span class="ident" id="3856285">j</span><span class="op" id="3856286">++</span>&nbsp;<span class="op" id="3856289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3856294">b</span><span class="op" id="3856295">[</span><span class="ident" id="3856296">j</span><span class="op" id="3856297">]</span>&nbsp;<span class="op" id="3856299">=</span>&nbsp;<span class="string" id="3856301">&#39;A&#39;</span>&nbsp;<span class="op" id="3856305">+</span>&nbsp;<span class="builtintype" id="3856307">byte</span><span class="op" id="3856311">(</span><span class="ident" id="3856312">i</span><span class="op" id="3856313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3856317">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3856322">hashSHA1</span><span class="op" id="3856330">.</span><span class="ident" id="3856331">Reset</span><span class="op" id="3856336">(</span><span class="op" id="3856337">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3856341">hashSHA1</span><span class="op" id="3856349">.</span><span class="ident" id="3856350">Write</span><span class="op" id="3856355">(</span><span class="ident" id="3856356">b</span><span class="op" id="3856357">[</span><span class="op" id="3856358">:</span><span class="ident" id="3856359">i</span><span class="op" id="3856360">+</span><span class="num" id="3856361">1</span><span class="op" id="3856362">]</span><span class="op" id="3856363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3856367">hashSHA1</span><span class="op" id="3856375">.</span><span class="ident" id="3856376">Write</span><span class="op" id="3856381">(</span><span class="ident" id="3856382">secret</span><span class="op" id="3856388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3856392">hashSHA1</span><span class="op" id="3856400">.</span><span class="ident" id="3856401">Write</span><span class="op" id="3856406">(</span><span class="ident" id="3856407">seed</span><span class="op" id="3856411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3856415">digest</span>&nbsp;<span class="op" id="3856422">:=</span>&nbsp;<span class="ident" id="3856425">hashSHA1</span><span class="op" id="3856433">.</span><span class="ident" id="3856434">Sum</span><span class="op" id="3856437">(</span><span class="builtintype" id="3856438">nil</span><span class="op" id="3856441">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3856446">hashMD5</span><span class="op" id="3856453">.</span><span class="ident" id="3856454">Reset</span><span class="op" id="3856459">(</span><span class="op" id="3856460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3856464">hashMD5</span><span class="op" id="3856471">.</span><span class="ident" id="3856472">Write</span><span class="op" id="3856477">(</span><span class="ident" id="3856478">secret</span><span class="op" id="3856484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3856488">hashMD5</span><span class="op" id="3856495">.</span><span class="ident" id="3856496">Write</span><span class="op" id="3856501">(</span><span class="ident" id="3856502">digest</span><span class="op" id="3856508">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3856513">done</span>&nbsp;<span class="op" id="3856518">+=</span>&nbsp;<span class="builtinfunc" id="3856521">copy</span><span class="op" id="3856525">(</span><span class="ident" id="3856526">result</span><span class="op" id="3856532">[</span><span class="ident" id="3856533">done</span><span class="op" id="3856537">:</span><span class="op" id="3856538">]</span><span class="op" id="3856539">,</span>&nbsp;<span class="ident" id="3856541">hashMD5</span><span class="op" id="3856548">.</span><span class="ident" id="3856549">Sum</span><span class="op" id="3856552">(</span><span class="builtintype" id="3856553">nil</span><span class="op" id="3856556">)</span><span class="op" id="3856557">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3856561">i</span><span class="op" id="3856562">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3856566">}</span><br>
<span class="lineno"></span><span class="op" id="3856568">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3856571">const</span>&nbsp;<span class="op" id="3856577">(</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3856580">tlsRandomLength</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3856601">=</span>&nbsp;<span class="num" id="3856603">32</span>&nbsp;<span class="comment" id="3856606">//&nbsp;Length&nbsp;of&nbsp;a&nbsp;random&nbsp;nonce&nbsp;in&nbsp;TLS&nbsp;1.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3856647">masterSecretLength</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3856668">=</span>&nbsp;<span class="num" id="3856670">48</span>&nbsp;<span class="comment" id="3856673">//&nbsp;Length&nbsp;of&nbsp;a&nbsp;master&nbsp;secret&nbsp;in&nbsp;TLS&nbsp;1.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3856715">finishedVerifyLength</span>&nbsp;<span class="op" id="3856736">=</span>&nbsp;<span class="num" id="3856738">12</span>&nbsp;<span class="comment" id="3856741">//&nbsp;Length&nbsp;of&nbsp;verify_data&nbsp;in&nbsp;a&nbsp;Finished&nbsp;message.</span><br>
<span class="lineno"></span><span class="op" id="3856789">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="3856792">var</span>&nbsp;<span class="ident" id="3856796">masterSecretLabel</span>&nbsp;<span class="op" id="3856814">=</span>&nbsp;<span class="op" id="3856816">[</span><span class="op" id="3856817">]</span><span class="builtintype" id="3856818">byte</span><span class="op" id="3856822">(</span><span class="string" id="3856823">&#34;master&nbsp;secret&#34;</span><span class="op" id="3856838">)</span><br>
<span class="lineno"></span><span class="keyword" id="3856840">var</span>&nbsp;<span class="ident" id="3856844">keyExpansionLabel</span>&nbsp;<span class="op" id="3856862">=</span>&nbsp;<span class="op" id="3856864">[</span><span class="op" id="3856865">]</span><span class="builtintype" id="3856866">byte</span><span class="op" id="3856870">(</span><span class="string" id="3856871">&#34;key&nbsp;expansion&#34;</span><span class="op" id="3856886">)</span><br>
<span class="lineno"></span><span class="keyword" id="3856888">var</span>&nbsp;<span class="ident" id="3856892">clientFinishedLabel</span>&nbsp;<span class="op" id="3856912">=</span>&nbsp;<span class="op" id="3856914">[</span><span class="op" id="3856915">]</span><span class="builtintype" id="3856916">byte</span><span class="op" id="3856920">(</span><span class="string" id="3856921">&#34;client&nbsp;finished&#34;</span><span class="op" id="3856938">)</span><br>
<span class="lineno"></span><span class="keyword" id="3856940">var</span>&nbsp;<span class="ident" id="3856944">serverFinishedLabel</span>&nbsp;<span class="op" id="3856964">=</span>&nbsp;<span class="op" id="3856966">[</span><span class="op" id="3856967">]</span><span class="builtintype" id="3856968">byte</span><span class="op" id="3856972">(</span><span class="string" id="3856973">&#34;server&nbsp;finished&#34;</span><span class="op" id="3856990">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="keyword" id="3856993">func</span>&nbsp;<span class="ident" id="3856998">prfForVersion</span><span class="op" id="3857011">(</span><span class="ident" id="3857012">version</span>&nbsp;<span class="builtintype" id="3857020">uint16</span><span class="op" id="3857026">)</span>&nbsp;<span class="keyword" id="3857028">func</span><span class="op" id="3857032">(</span><span class="ident" id="3857033">result</span><span class="op" id="3857039">,</span>&nbsp;<span class="ident" id="3857041">secret</span><span class="op" id="3857047">,</span>&nbsp;<span class="ident" id="3857049">label</span><span class="op" id="3857054">,</span>&nbsp;<span class="ident" id="3857056">seed</span>&nbsp;<span class="op" id="3857061">[</span><span class="op" id="3857062">]</span><span class="builtintype" id="3857063">byte</span><span class="op" id="3857067">)</span>&nbsp;<span class="op" id="3857069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3857072">switch</span>&nbsp;<span class="ident" id="3857079">version</span>&nbsp;<span class="op" id="3857087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3857090">case</span>&nbsp;<span class="ident" id="3857095">VersionSSL30</span><span class="op" id="3857107">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3857111">return</span>&nbsp;<span class="ident" id="3857118">prf30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3857125">case</span>&nbsp;<span class="ident" id="3857130">VersionTLS10</span><span class="op" id="3857142">,</span>&nbsp;<span class="ident" id="3857144">VersionTLS11</span><span class="op" id="3857156">:</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3857160">return</span>&nbsp;<span class="ident" id="3857167">prf10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3857174">case</span>&nbsp;<span class="ident" id="3857179">VersionTLS12</span><span class="op" id="3857191">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3857195">return</span>&nbsp;<span class="ident" id="3857202">prf12</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3857209">default</span><span class="op" id="3857216">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3857220">panic</span><span class="op" id="3857225">(</span><span class="string" id="3857226">&#34;unknown&nbsp;version&#34;</span><span class="op" id="3857243">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3857246">}</span><br>
<span class="lineno"></span><span class="op" id="3857248">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3857251">//&nbsp;masterFromPreMasterSecret&nbsp;generates&nbsp;the&nbsp;master&nbsp;secret&nbsp;from&nbsp;the&nbsp;pre-master</span><br>
<span class="lineno"></span><span class="comment" id="3857328">//&nbsp;secret.&nbsp;See&nbsp;http://tools.ietf.org/html/rfc5246#section-8.1</span><br>
<span class="lineno">135</span><span class="keyword" id="3857390">func</span>&nbsp;<span class="ident" id="3857395">masterFromPreMasterSecret</span><span class="op" id="3857420">(</span><span class="ident" id="3857421">version</span>&nbsp;<span class="builtintype" id="3857429">uint16</span><span class="op" id="3857435">,</span>&nbsp;<span class="ident" id="3857437">preMasterSecret</span><span class="op" id="3857452">,</span>&nbsp;<span class="ident" id="3857454">clientRandom</span><span class="op" id="3857466">,</span>&nbsp;<span class="ident" id="3857468">serverRandom</span>&nbsp;<span class="op" id="3857481">[</span><span class="op" id="3857482">]</span><span class="builtintype" id="3857483">byte</span><span class="op" id="3857487">)</span>&nbsp;<span class="op" id="3857489">[</span><span class="op" id="3857490">]</span><span class="builtintype" id="3857491">byte</span>&nbsp;<span class="op" id="3857496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3857499">var</span>&nbsp;<span class="ident" id="3857503">seed</span>&nbsp;<span class="op" id="3857508">[</span><span class="ident" id="3857509">tlsRandomLength</span>&nbsp;<span class="op" id="3857525">*</span>&nbsp;<span class="num" id="3857527">2</span><span class="op" id="3857528">]</span><span class="builtintype" id="3857529">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3857535">copy</span><span class="op" id="3857539">(</span><span class="ident" id="3857540">seed</span><span class="op" id="3857544">[</span><span class="num" id="3857545">0</span><span class="op" id="3857546">:</span><span class="builtinfunc" id="3857547">len</span><span class="op" id="3857550">(</span><span class="ident" id="3857551">clientRandom</span><span class="op" id="3857563">)</span><span class="op" id="3857564">]</span><span class="op" id="3857565">,</span>&nbsp;<span class="ident" id="3857567">clientRandom</span><span class="op" id="3857579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3857582">copy</span><span class="op" id="3857586">(</span><span class="ident" id="3857587">seed</span><span class="op" id="3857591">[</span><span class="builtinfunc" id="3857592">len</span><span class="op" id="3857595">(</span><span class="ident" id="3857596">clientRandom</span><span class="op" id="3857608">)</span><span class="op" id="3857609">:</span><span class="op" id="3857610">]</span><span class="op" id="3857611">,</span>&nbsp;<span class="ident" id="3857613">serverRandom</span><span class="op" id="3857625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3857628">masterSecret</span>&nbsp;<span class="op" id="3857641">:=</span>&nbsp;<span class="builtinfunc" id="3857644">make</span><span class="op" id="3857648">(</span><span class="op" id="3857649">[</span><span class="op" id="3857650">]</span><span class="builtintype" id="3857651">byte</span><span class="op" id="3857655">,</span>&nbsp;<span class="ident" id="3857657">masterSecretLength</span><span class="op" id="3857675">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3857678">prfForVersion</span><span class="op" id="3857691">(</span><span class="ident" id="3857692">version</span><span class="op" id="3857699">)</span><span class="op" id="3857700">(</span><span class="ident" id="3857701">masterSecret</span><span class="op" id="3857713">,</span>&nbsp;<span class="ident" id="3857715">preMasterSecret</span><span class="op" id="3857730">,</span>&nbsp;<span class="ident" id="3857732">masterSecretLabel</span><span class="op" id="3857749">,</span>&nbsp;<span class="ident" id="3857751">seed</span><span class="op" id="3857755">[</span><span class="num" id="3857756">0</span><span class="op" id="3857757">:</span><span class="op" id="3857758">]</span><span class="op" id="3857759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3857762">return</span>&nbsp;<span class="ident" id="3857769">masterSecret</span><br>
<span class="lineno"></span><span class="op" id="3857782">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3857785">//&nbsp;keysFromMasterSecret&nbsp;generates&nbsp;the&nbsp;connection&nbsp;keys&nbsp;from&nbsp;the&nbsp;master</span><br>
<span class="lineno">145</span><span class="comment" id="3857855">//&nbsp;secret,&nbsp;given&nbsp;the&nbsp;lengths&nbsp;of&nbsp;the&nbsp;MAC&nbsp;key,&nbsp;cipher&nbsp;key&nbsp;and&nbsp;IV,&nbsp;as&nbsp;defined&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="3857933">//&nbsp;RFC&nbsp;2246,&nbsp;section&nbsp;6.3.</span><br>
<span class="lineno"></span><span class="keyword" id="3857959">func</span>&nbsp;<span class="ident" id="3857964">keysFromMasterSecret</span><span class="op" id="3857984">(</span><span class="ident" id="3857985">version</span>&nbsp;<span class="builtintype" id="3857993">uint16</span><span class="op" id="3857999">,</span>&nbsp;<span class="ident" id="3858001">masterSecret</span><span class="op" id="3858013">,</span>&nbsp;<span class="ident" id="3858015">clientRandom</span><span class="op" id="3858027">,</span>&nbsp;<span class="ident" id="3858029">serverRandom</span>&nbsp;<span class="op" id="3858042">[</span><span class="op" id="3858043">]</span><span class="builtintype" id="3858044">byte</span><span class="op" id="3858048">,</span>&nbsp;<span class="ident" id="3858050">macLen</span><span class="op" id="3858056">,</span>&nbsp;<span class="ident" id="3858058">keyLen</span><span class="op" id="3858064">,</span>&nbsp;<span class="ident" id="3858066">ivLen</span>&nbsp;<span class="builtintype" id="3858072">int</span><span class="op" id="3858075">)</span>&nbsp;<span class="op" id="3858077">(</span><span class="ident" id="3858078">clientMAC</span><span class="op" id="3858087">,</span>&nbsp;<span class="ident" id="3858089">serverMAC</span><span class="op" id="3858098">,</span>&nbsp;<span class="ident" id="3858100">clientKey</span><span class="op" id="3858109">,</span>&nbsp;<span class="ident" id="3858111">serverKey</span><span class="op" id="3858120">,</span>&nbsp;<span class="ident" id="3858122">clientIV</span><span class="op" id="3858130">,</span>&nbsp;<span class="ident" id="3858132">serverIV</span>&nbsp;<span class="op" id="3858141">[</span><span class="op" id="3858142">]</span><span class="builtintype" id="3858143">byte</span><span class="op" id="3858147">)</span>&nbsp;<span class="op" id="3858149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3858152">var</span>&nbsp;<span class="ident" id="3858156">seed</span>&nbsp;<span class="op" id="3858161">[</span><span class="ident" id="3858162">tlsRandomLength</span>&nbsp;<span class="op" id="3858178">*</span>&nbsp;<span class="num" id="3858180">2</span><span class="op" id="3858181">]</span><span class="builtintype" id="3858182">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3858188">copy</span><span class="op" id="3858192">(</span><span class="ident" id="3858193">seed</span><span class="op" id="3858197">[</span><span class="num" id="3858198">0</span><span class="op" id="3858199">:</span><span class="builtinfunc" id="3858200">len</span><span class="op" id="3858203">(</span><span class="ident" id="3858204">clientRandom</span><span class="op" id="3858216">)</span><span class="op" id="3858217">]</span><span class="op" id="3858218">,</span>&nbsp;<span class="ident" id="3858220">serverRandom</span><span class="op" id="3858232">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3858235">copy</span><span class="op" id="3858239">(</span><span class="ident" id="3858240">seed</span><span class="op" id="3858244">[</span><span class="builtinfunc" id="3858245">len</span><span class="op" id="3858248">(</span><span class="ident" id="3858249">serverRandom</span><span class="op" id="3858261">)</span><span class="op" id="3858262">:</span><span class="op" id="3858263">]</span><span class="op" id="3858264">,</span>&nbsp;<span class="ident" id="3858266">clientRandom</span><span class="op" id="3858278">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3858282">n</span>&nbsp;<span class="op" id="3858284">:=</span>&nbsp;<span class="num" id="3858287">2</span><span class="op" id="3858288">*</span><span class="ident" id="3858289">macLen</span>&nbsp;<span class="op" id="3858296">+</span>&nbsp;<span class="num" id="3858298">2</span><span class="op" id="3858299">*</span><span class="ident" id="3858300">keyLen</span>&nbsp;<span class="op" id="3858307">+</span>&nbsp;<span class="num" id="3858309">2</span><span class="op" id="3858310">*</span><span class="ident" id="3858311">ivLen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3858318">keyMaterial</span>&nbsp;<span class="op" id="3858330">:=</span>&nbsp;<span class="builtinfunc" id="3858333">make</span><span class="op" id="3858337">(</span><span class="op" id="3858338">[</span><span class="op" id="3858339">]</span><span class="builtintype" id="3858340">byte</span><span class="op" id="3858344">,</span>&nbsp;<span class="ident" id="3858346">n</span><span class="op" id="3858347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3858350">prfForVersion</span><span class="op" id="3858363">(</span><span class="ident" id="3858364">version</span><span class="op" id="3858371">)</span><span class="op" id="3858372">(</span><span class="ident" id="3858373">keyMaterial</span><span class="op" id="3858384">,</span>&nbsp;<span class="ident" id="3858386">masterSecret</span><span class="op" id="3858398">,</span>&nbsp;<span class="ident" id="3858400">keyExpansionLabel</span><span class="op" id="3858417">,</span>&nbsp;<span class="ident" id="3858419">seed</span><span class="op" id="3858423">[</span><span class="num" id="3858424">0</span><span class="op" id="3858425">:</span><span class="op" id="3858426">]</span><span class="op" id="3858427">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3858430">clientMAC</span>&nbsp;<span class="op" id="3858440">=</span>&nbsp;<span class="ident" id="3858442">keyMaterial</span><span class="op" id="3858453">[</span><span class="op" id="3858454">:</span><span class="ident" id="3858455">macLen</span><span class="op" id="3858461">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3858464">keyMaterial</span>&nbsp;<span class="op" id="3858476">=</span>&nbsp;<span class="ident" id="3858478">keyMaterial</span><span class="op" id="3858489">[</span><span class="ident" id="3858490">macLen</span><span class="op" id="3858496">:</span><span class="op" id="3858497">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3858500">serverMAC</span>&nbsp;<span class="op" id="3858510">=</span>&nbsp;<span class="ident" id="3858512">keyMaterial</span><span class="op" id="3858523">[</span><span class="op" id="3858524">:</span><span class="ident" id="3858525">macLen</span><span class="op" id="3858531">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3858534">keyMaterial</span>&nbsp;<span class="op" id="3858546">=</span>&nbsp;<span class="ident" id="3858548">keyMaterial</span><span class="op" id="3858559">[</span><span class="ident" id="3858560">macLen</span><span class="op" id="3858566">:</span><span class="op" id="3858567">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3858570">clientKey</span>&nbsp;<span class="op" id="3858580">=</span>&nbsp;<span class="ident" id="3858582">keyMaterial</span><span class="op" id="3858593">[</span><span class="op" id="3858594">:</span><span class="ident" id="3858595">keyLen</span><span class="op" id="3858601">]</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3858604">keyMaterial</span>&nbsp;<span class="op" id="3858616">=</span>&nbsp;<span class="ident" id="3858618">keyMaterial</span><span class="op" id="3858629">[</span><span class="ident" id="3858630">keyLen</span><span class="op" id="3858636">:</span><span class="op" id="3858637">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3858640">serverKey</span>&nbsp;<span class="op" id="3858650">=</span>&nbsp;<span class="ident" id="3858652">keyMaterial</span><span class="op" id="3858663">[</span><span class="op" id="3858664">:</span><span class="ident" id="3858665">keyLen</span><span class="op" id="3858671">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3858674">keyMaterial</span>&nbsp;<span class="op" id="3858686">=</span>&nbsp;<span class="ident" id="3858688">keyMaterial</span><span class="op" id="3858699">[</span><span class="ident" id="3858700">keyLen</span><span class="op" id="3858706">:</span><span class="op" id="3858707">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3858710">clientIV</span>&nbsp;<span class="op" id="3858719">=</span>&nbsp;<span class="ident" id="3858721">keyMaterial</span><span class="op" id="3858732">[</span><span class="op" id="3858733">:</span><span class="ident" id="3858734">ivLen</span><span class="op" id="3858739">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3858742">keyMaterial</span>&nbsp;<span class="op" id="3858754">=</span>&nbsp;<span class="ident" id="3858756">keyMaterial</span><span class="op" id="3858767">[</span><span class="ident" id="3858768">ivLen</span><span class="op" id="3858773">:</span><span class="op" id="3858774">]</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3858777">serverIV</span>&nbsp;<span class="op" id="3858786">=</span>&nbsp;<span class="ident" id="3858788">keyMaterial</span><span class="op" id="3858799">[</span><span class="op" id="3858800">:</span><span class="ident" id="3858801">ivLen</span><span class="op" id="3858806">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3858809">return</span><br>
<span class="lineno"></span><span class="op" id="3858816">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3858819">func</span>&nbsp;<span class="ident" id="3858824">newFinishedHash</span><span class="op" id="3858839">(</span><span class="ident" id="3858840">version</span>&nbsp;<span class="builtintype" id="3858848">uint16</span><span class="op" id="3858854">)</span>&nbsp;<span class="ident" id="3858856">finishedHash</span>&nbsp;<span class="op" id="3858869">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3858872">if</span>&nbsp;<span class="ident" id="3858875">version</span>&nbsp;<span class="op" id="3858883">&gt;=</span>&nbsp;<span class="ident" id="3858886">VersionTLS12</span>&nbsp;<span class="op" id="3858899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3858903">return</span>&nbsp;<span class="ident" id="3858910">finishedHash</span><span class="op" id="3858922">{</span><span class="ident" id="3858923">sha256</span><span class="op" id="3858929">.</span><span class="ident" id="3858930">New</span><span class="op" id="3858933">(</span><span class="op" id="3858934">)</span><span class="op" id="3858935">,</span>&nbsp;<span class="ident" id="3858937">sha256</span><span class="op" id="3858943">.</span><span class="ident" id="3858944">New</span><span class="op" id="3858947">(</span><span class="op" id="3858948">)</span><span class="op" id="3858949">,</span>&nbsp;<span class="builtintype" id="3858951">nil</span><span class="op" id="3858954">,</span>&nbsp;<span class="builtintype" id="3858956">nil</span><span class="op" id="3858959">,</span>&nbsp;<span class="ident" id="3858961">version</span><span class="op" id="3858968">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3858971">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3858974">return</span>&nbsp;<span class="ident" id="3858981">finishedHash</span><span class="op" id="3858993">{</span><span class="ident" id="3858994">sha1</span><span class="op" id="3858998">.</span><span class="ident" id="3858999">New</span><span class="op" id="3859002">(</span><span class="op" id="3859003">)</span><span class="op" id="3859004">,</span>&nbsp;<span class="ident" id="3859006">sha1</span><span class="op" id="3859010">.</span><span class="ident" id="3859011">New</span><span class="op" id="3859014">(</span><span class="op" id="3859015">)</span><span class="op" id="3859016">,</span>&nbsp;<span class="ident" id="3859018">md5</span><span class="op" id="3859021">.</span><span class="ident" id="3859022">New</span><span class="op" id="3859025">(</span><span class="op" id="3859026">)</span><span class="op" id="3859027">,</span>&nbsp;<span class="ident" id="3859029">md5</span><span class="op" id="3859032">.</span><span class="ident" id="3859033">New</span><span class="op" id="3859036">(</span><span class="op" id="3859037">)</span><span class="op" id="3859038">,</span>&nbsp;<span class="ident" id="3859040">version</span><span class="op" id="3859047">}</span><br>
<span class="lineno"></span><span class="op" id="3859049">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span><span class="comment" id="3859052">//&nbsp;A&nbsp;finishedHash&nbsp;calculates&nbsp;the&nbsp;hash&nbsp;of&nbsp;a&nbsp;set&nbsp;of&nbsp;handshake&nbsp;messages&nbsp;suitable</span><br>
<span class="lineno"></span><span class="comment" id="3859130">//&nbsp;for&nbsp;including&nbsp;in&nbsp;a&nbsp;Finished&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="3859170">type</span>&nbsp;<span class="ident" id="3859175">finishedHash</span>&nbsp;<span class="keyword" id="3859188">struct</span>&nbsp;<span class="op" id="3859195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3859198">client</span>&nbsp;<span class="ident" id="3859205">hash</span><span class="op" id="3859209">.</span><span class="ident" id="3859210">Hash</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3859216">server</span>&nbsp;<span class="ident" id="3859223">hash</span><span class="op" id="3859227">.</span><span class="ident" id="3859228">Hash</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3859235">//&nbsp;Prior&nbsp;to&nbsp;TLS&nbsp;1.2,&nbsp;an&nbsp;additional&nbsp;MD5&nbsp;hash&nbsp;is&nbsp;required.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3859293">clientMD5</span>&nbsp;<span class="ident" id="3859303">hash</span><span class="op" id="3859307">.</span><span class="ident" id="3859308">Hash</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3859314">serverMD5</span>&nbsp;<span class="ident" id="3859324">hash</span><span class="op" id="3859328">.</span><span class="ident" id="3859329">Hash</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3859336">version</span>&nbsp;<span class="builtintype" id="3859344">uint16</span><br>
<span class="lineno"></span><span class="op" id="3859351">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3859354">func</span>&nbsp;<span class="op" id="3859359">(</span><span class="ident" id="3859360">h</span>&nbsp;<span class="ident" id="3859362">finishedHash</span><span class="op" id="3859374">)</span>&nbsp;<span class="ident" id="3859376">Write</span><span class="op" id="3859381">(</span><span class="ident" id="3859382">msg</span>&nbsp;<span class="op" id="3859386">[</span><span class="op" id="3859387">]</span><span class="builtintype" id="3859388">byte</span><span class="op" id="3859392">)</span>&nbsp;<span class="op" id="3859394">(</span><span class="ident" id="3859395">n</span>&nbsp;<span class="builtintype" id="3859397">int</span><span class="op" id="3859400">,</span>&nbsp;<span class="ident" id="3859402">err</span>&nbsp;<span class="builtintype" id="3859406">error</span><span class="op" id="3859411">)</span>&nbsp;<span class="op" id="3859413">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3859416">h</span><span class="op" id="3859417">.</span><span class="ident" id="3859418">client</span><span class="op" id="3859424">.</span><span class="ident" id="3859425">Write</span><span class="op" id="3859430">(</span><span class="ident" id="3859431">msg</span><span class="op" id="3859434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3859437">h</span><span class="op" id="3859438">.</span><span class="ident" id="3859439">server</span><span class="op" id="3859445">.</span><span class="ident" id="3859446">Write</span><span class="op" id="3859451">(</span><span class="ident" id="3859452">msg</span><span class="op" id="3859455">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3859459">if</span>&nbsp;<span class="ident" id="3859462">h</span><span class="op" id="3859463">.</span><span class="ident" id="3859464">version</span>&nbsp;<span class="op" id="3859472">&lt;</span>&nbsp;<span class="ident" id="3859474">VersionTLS12</span>&nbsp;<span class="op" id="3859487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3859491">h</span><span class="op" id="3859492">.</span><span class="ident" id="3859493">clientMD5</span><span class="op" id="3859502">.</span><span class="ident" id="3859503">Write</span><span class="op" id="3859508">(</span><span class="ident" id="3859509">msg</span><span class="op" id="3859512">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3859516">h</span><span class="op" id="3859517">.</span><span class="ident" id="3859518">serverMD5</span><span class="op" id="3859527">.</span><span class="ident" id="3859528">Write</span><span class="op" id="3859533">(</span><span class="ident" id="3859534">msg</span><span class="op" id="3859537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3859540">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3859543">return</span>&nbsp;<span class="builtinfunc" id="3859550">len</span><span class="op" id="3859553">(</span><span class="ident" id="3859554">msg</span><span class="op" id="3859557">)</span><span class="op" id="3859558">,</span>&nbsp;<span class="builtintype" id="3859560">nil</span><br>
<span class="lineno"></span><span class="op" id="3859564">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span><span class="comment" id="3859567">//&nbsp;finishedSum30&nbsp;calculates&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;verify_data&nbsp;member&nbsp;of&nbsp;a&nbsp;SSLv3</span><br>
<span class="lineno"></span><span class="comment" id="3859645">//&nbsp;Finished&nbsp;message&nbsp;given&nbsp;the&nbsp;MD5&nbsp;and&nbsp;SHA1&nbsp;hashes&nbsp;of&nbsp;a&nbsp;set&nbsp;of&nbsp;handshake</span><br>
<span class="lineno"></span><span class="comment" id="3859717">//&nbsp;messages.</span><br>
<span class="lineno"></span><span class="keyword" id="3859730">func</span>&nbsp;<span class="ident" id="3859735">finishedSum30</span><span class="op" id="3859748">(</span><span class="ident" id="3859749">md5</span><span class="op" id="3859752">,</span>&nbsp;<span class="ident" id="3859754">sha1</span>&nbsp;<span class="ident" id="3859759">hash</span><span class="op" id="3859763">.</span><span class="ident" id="3859764">Hash</span><span class="op" id="3859768">,</span>&nbsp;<span class="ident" id="3859770">masterSecret</span>&nbsp;<span class="op" id="3859783">[</span><span class="op" id="3859784">]</span><span class="builtintype" id="3859785">byte</span><span class="op" id="3859789">,</span>&nbsp;<span class="ident" id="3859791">magic</span>&nbsp;<span class="op" id="3859797">[</span><span class="num" id="3859798">4</span><span class="op" id="3859799">]</span><span class="builtintype" id="3859800">byte</span><span class="op" id="3859804">)</span>&nbsp;<span class="op" id="3859806">[</span><span class="op" id="3859807">]</span><span class="builtintype" id="3859808">byte</span>&nbsp;<span class="op" id="3859813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3859816">md5</span><span class="op" id="3859819">.</span><span class="ident" id="3859820">Write</span><span class="op" id="3859825">(</span><span class="ident" id="3859826">magic</span><span class="op" id="3859831">[</span><span class="op" id="3859832">:</span><span class="op" id="3859833">]</span><span class="op" id="3859834">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3859837">md5</span><span class="op" id="3859840">.</span><span class="ident" id="3859841">Write</span><span class="op" id="3859846">(</span><span class="ident" id="3859847">masterSecret</span><span class="op" id="3859859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3859862">md5</span><span class="op" id="3859865">.</span><span class="ident" id="3859866">Write</span><span class="op" id="3859871">(</span><span class="ident" id="3859872">ssl30Pad1</span><span class="op" id="3859881">[</span><span class="op" id="3859882">:</span><span class="op" id="3859883">]</span><span class="op" id="3859884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3859887">md5Digest</span>&nbsp;<span class="op" id="3859897">:=</span>&nbsp;<span class="ident" id="3859900">md5</span><span class="op" id="3859903">.</span><span class="ident" id="3859904">Sum</span><span class="op" id="3859907">(</span><span class="builtintype" id="3859908">nil</span><span class="op" id="3859911">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3859915">md5</span><span class="op" id="3859918">.</span><span class="ident" id="3859919">Reset</span><span class="op" id="3859924">(</span><span class="op" id="3859925">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3859928">md5</span><span class="op" id="3859931">.</span><span class="ident" id="3859932">Write</span><span class="op" id="3859937">(</span><span class="ident" id="3859938">masterSecret</span><span class="op" id="3859950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3859953">md5</span><span class="op" id="3859956">.</span><span class="ident" id="3859957">Write</span><span class="op" id="3859962">(</span><span class="ident" id="3859963">ssl30Pad2</span><span class="op" id="3859972">[</span><span class="op" id="3859973">:</span><span class="op" id="3859974">]</span><span class="op" id="3859975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3859978">md5</span><span class="op" id="3859981">.</span><span class="ident" id="3859982">Write</span><span class="op" id="3859987">(</span><span class="ident" id="3859988">md5Digest</span><span class="op" id="3859997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3860000">md5Digest</span>&nbsp;<span class="op" id="3860010">=</span>&nbsp;<span class="ident" id="3860012">md5</span><span class="op" id="3860015">.</span><span class="ident" id="3860016">Sum</span><span class="op" id="3860019">(</span><span class="builtintype" id="3860020">nil</span><span class="op" id="3860023">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3860027">sha1</span><span class="op" id="3860031">.</span><span class="ident" id="3860032">Write</span><span class="op" id="3860037">(</span><span class="ident" id="3860038">magic</span><span class="op" id="3860043">[</span><span class="op" id="3860044">:</span><span class="op" id="3860045">]</span><span class="op" id="3860046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3860049">sha1</span><span class="op" id="3860053">.</span><span class="ident" id="3860054">Write</span><span class="op" id="3860059">(</span><span class="ident" id="3860060">masterSecret</span><span class="op" id="3860072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3860075">sha1</span><span class="op" id="3860079">.</span><span class="ident" id="3860080">Write</span><span class="op" id="3860085">(</span><span class="ident" id="3860086">ssl30Pad1</span><span class="op" id="3860095">[</span><span class="op" id="3860096">:</span><span class="num" id="3860097">40</span><span class="op" id="3860099">]</span><span class="op" id="3860100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3860103">sha1Digest</span>&nbsp;<span class="op" id="3860114">:=</span>&nbsp;<span class="ident" id="3860117">sha1</span><span class="op" id="3860121">.</span><span class="ident" id="3860122">Sum</span><span class="op" id="3860125">(</span><span class="builtintype" id="3860126">nil</span><span class="op" id="3860129">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3860133">sha1</span><span class="op" id="3860137">.</span><span class="ident" id="3860138">Reset</span><span class="op" id="3860143">(</span><span class="op" id="3860144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3860147">sha1</span><span class="op" id="3860151">.</span><span class="ident" id="3860152">Write</span><span class="op" id="3860157">(</span><span class="ident" id="3860158">masterSecret</span><span class="op" id="3860170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3860173">sha1</span><span class="op" id="3860177">.</span><span class="ident" id="3860178">Write</span><span class="op" id="3860183">(</span><span class="ident" id="3860184">ssl30Pad2</span><span class="op" id="3860193">[</span><span class="op" id="3860194">:</span><span class="num" id="3860195">40</span><span class="op" id="3860197">]</span><span class="op" id="3860198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3860201">sha1</span><span class="op" id="3860205">.</span><span class="ident" id="3860206">Write</span><span class="op" id="3860211">(</span><span class="ident" id="3860212">sha1Digest</span><span class="op" id="3860222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3860225">sha1Digest</span>&nbsp;<span class="op" id="3860236">=</span>&nbsp;<span class="ident" id="3860238">sha1</span><span class="op" id="3860242">.</span><span class="ident" id="3860243">Sum</span><span class="op" id="3860246">(</span><span class="builtintype" id="3860247">nil</span><span class="op" id="3860250">)</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3860254">ret</span>&nbsp;<span class="op" id="3860258">:=</span>&nbsp;<span class="builtinfunc" id="3860261">make</span><span class="op" id="3860265">(</span><span class="op" id="3860266">[</span><span class="op" id="3860267">]</span><span class="builtintype" id="3860268">byte</span><span class="op" id="3860272">,</span>&nbsp;<span class="builtinfunc" id="3860274">len</span><span class="op" id="3860277">(</span><span class="ident" id="3860278">md5Digest</span><span class="op" id="3860287">)</span><span class="op" id="3860288">+</span><span class="builtinfunc" id="3860289">len</span><span class="op" id="3860292">(</span><span class="ident" id="3860293">sha1Digest</span><span class="op" id="3860303">)</span><span class="op" id="3860304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3860307">copy</span><span class="op" id="3860311">(</span><span class="ident" id="3860312">ret</span><span class="op" id="3860315">,</span>&nbsp;<span class="ident" id="3860317">md5Digest</span><span class="op" id="3860326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3860329">copy</span><span class="op" id="3860333">(</span><span class="ident" id="3860334">ret</span><span class="op" id="3860337">[</span><span class="builtinfunc" id="3860338">len</span><span class="op" id="3860341">(</span><span class="ident" id="3860342">md5Digest</span><span class="op" id="3860351">)</span><span class="op" id="3860352">:</span><span class="op" id="3860353">]</span><span class="op" id="3860354">,</span>&nbsp;<span class="ident" id="3860356">sha1Digest</span><span class="op" id="3860366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3860369">return</span>&nbsp;<span class="ident" id="3860376">ret</span><br>
<span class="lineno">230</span><span class="op" id="3860380">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3860383">var</span>&nbsp;<span class="ident" id="3860387">ssl3ClientFinishedMagic</span>&nbsp;<span class="op" id="3860411">=</span>&nbsp;<span class="op" id="3860413">[</span><span class="num" id="3860414">4</span><span class="op" id="3860415">]</span><span class="builtintype" id="3860416">byte</span><span class="op" id="3860420">{</span><span class="num" id="3860421">0x43</span><span class="op" id="3860425">,</span>&nbsp;<span class="num" id="3860427">0x4c</span><span class="op" id="3860431">,</span>&nbsp;<span class="num" id="3860433">0x4e</span><span class="op" id="3860437">,</span>&nbsp;<span class="num" id="3860439">0x54</span><span class="op" id="3860443">}</span><br>
<span class="lineno"></span><span class="keyword" id="3860445">var</span>&nbsp;<span class="ident" id="3860449">ssl3ServerFinishedMagic</span>&nbsp;<span class="op" id="3860473">=</span>&nbsp;<span class="op" id="3860475">[</span><span class="num" id="3860476">4</span><span class="op" id="3860477">]</span><span class="builtintype" id="3860478">byte</span><span class="op" id="3860482">{</span><span class="num" id="3860483">0x53</span><span class="op" id="3860487">,</span>&nbsp;<span class="num" id="3860489">0x52</span><span class="op" id="3860493">,</span>&nbsp;<span class="num" id="3860495">0x56</span><span class="op" id="3860499">,</span>&nbsp;<span class="num" id="3860501">0x52</span><span class="op" id="3860505">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="comment" id="3860508">//&nbsp;clientSum&nbsp;returns&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;verify_data&nbsp;member&nbsp;of&nbsp;a&nbsp;client&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="3860582">//&nbsp;Finished&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="3860603">func</span>&nbsp;<span class="op" id="3860608">(</span><span class="ident" id="3860609">h</span>&nbsp;<span class="ident" id="3860611">finishedHash</span><span class="op" id="3860623">)</span>&nbsp;<span class="ident" id="3860625">clientSum</span><span class="op" id="3860634">(</span><span class="ident" id="3860635">masterSecret</span>&nbsp;<span class="op" id="3860648">[</span><span class="op" id="3860649">]</span><span class="builtintype" id="3860650">byte</span><span class="op" id="3860654">)</span>&nbsp;<span class="op" id="3860656">[</span><span class="op" id="3860657">]</span><span class="builtintype" id="3860658">byte</span>&nbsp;<span class="op" id="3860663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3860666">if</span>&nbsp;<span class="ident" id="3860669">h</span><span class="op" id="3860670">.</span><span class="ident" id="3860671">version</span>&nbsp;<span class="op" id="3860679">==</span>&nbsp;<span class="ident" id="3860682">VersionSSL30</span>&nbsp;<span class="op" id="3860695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3860699">return</span>&nbsp;<span class="ident" id="3860706">finishedSum30</span><span class="op" id="3860719">(</span><span class="ident" id="3860720">h</span><span class="op" id="3860721">.</span><span class="ident" id="3860722">clientMD5</span><span class="op" id="3860731">,</span>&nbsp;<span class="ident" id="3860733">h</span><span class="op" id="3860734">.</span><span class="ident" id="3860735">client</span><span class="op" id="3860741">,</span>&nbsp;<span class="ident" id="3860743">masterSecret</span><span class="op" id="3860755">,</span>&nbsp;<span class="ident" id="3860757">ssl3ClientFinishedMagic</span><span class="op" id="3860780">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3860783">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3860787">out</span>&nbsp;<span class="op" id="3860791">:=</span>&nbsp;<span class="builtinfunc" id="3860794">make</span><span class="op" id="3860798">(</span><span class="op" id="3860799">[</span><span class="op" id="3860800">]</span><span class="builtintype" id="3860801">byte</span><span class="op" id="3860805">,</span>&nbsp;<span class="ident" id="3860807">finishedVerifyLength</span><span class="op" id="3860827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3860830">if</span>&nbsp;<span class="ident" id="3860833">h</span><span class="op" id="3860834">.</span><span class="ident" id="3860835">version</span>&nbsp;<span class="op" id="3860843">&gt;=</span>&nbsp;<span class="ident" id="3860846">VersionTLS12</span>&nbsp;<span class="op" id="3860859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3860863">seed</span>&nbsp;<span class="op" id="3860868">:=</span>&nbsp;<span class="ident" id="3860871">h</span><span class="op" id="3860872">.</span><span class="ident" id="3860873">client</span><span class="op" id="3860879">.</span><span class="ident" id="3860880">Sum</span><span class="op" id="3860883">(</span><span class="builtintype" id="3860884">nil</span><span class="op" id="3860887">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3860891">prf12</span><span class="op" id="3860896">(</span><span class="ident" id="3860897">out</span><span class="op" id="3860900">,</span>&nbsp;<span class="ident" id="3860902">masterSecret</span><span class="op" id="3860914">,</span>&nbsp;<span class="ident" id="3860916">clientFinishedLabel</span><span class="op" id="3860935">,</span>&nbsp;<span class="ident" id="3860937">seed</span><span class="op" id="3860941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3860944">}</span>&nbsp;<span class="keyword" id="3860946">else</span>&nbsp;<span class="op" id="3860951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3860955">seed</span>&nbsp;<span class="op" id="3860960">:=</span>&nbsp;<span class="builtinfunc" id="3860963">make</span><span class="op" id="3860967">(</span><span class="op" id="3860968">[</span><span class="op" id="3860969">]</span><span class="builtintype" id="3860970">byte</span><span class="op" id="3860974">,</span>&nbsp;<span class="num" id="3860976">0</span><span class="op" id="3860977">,</span>&nbsp;<span class="ident" id="3860979">md5</span><span class="op" id="3860982">.</span><span class="ident" id="3860983">Size</span><span class="op" id="3860987">+</span><span class="ident" id="3860988">sha1</span><span class="op" id="3860992">.</span><span class="ident" id="3860993">Size</span><span class="op" id="3860997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3861001">seed</span>&nbsp;<span class="op" id="3861006">=</span>&nbsp;<span class="ident" id="3861008">h</span><span class="op" id="3861009">.</span><span class="ident" id="3861010">clientMD5</span><span class="op" id="3861019">.</span><span class="ident" id="3861020">Sum</span><span class="op" id="3861023">(</span><span class="ident" id="3861024">seed</span><span class="op" id="3861028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3861032">seed</span>&nbsp;<span class="op" id="3861037">=</span>&nbsp;<span class="ident" id="3861039">h</span><span class="op" id="3861040">.</span><span class="ident" id="3861041">client</span><span class="op" id="3861047">.</span><span class="ident" id="3861048">Sum</span><span class="op" id="3861051">(</span><span class="ident" id="3861052">seed</span><span class="op" id="3861056">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3861060">prf10</span><span class="op" id="3861065">(</span><span class="ident" id="3861066">out</span><span class="op" id="3861069">,</span>&nbsp;<span class="ident" id="3861071">masterSecret</span><span class="op" id="3861083">,</span>&nbsp;<span class="ident" id="3861085">clientFinishedLabel</span><span class="op" id="3861104">,</span>&nbsp;<span class="ident" id="3861106">seed</span><span class="op" id="3861110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3861113">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3861116">return</span>&nbsp;<span class="ident" id="3861123">out</span><br>
<span class="lineno"></span><span class="op" id="3861127">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="comment" id="3861130">//&nbsp;serverSum&nbsp;returns&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;verify_data&nbsp;member&nbsp;of&nbsp;a&nbsp;server&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="3861204">//&nbsp;Finished&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="3861225">func</span>&nbsp;<span class="op" id="3861230">(</span><span class="ident" id="3861231">h</span>&nbsp;<span class="ident" id="3861233">finishedHash</span><span class="op" id="3861245">)</span>&nbsp;<span class="ident" id="3861247">serverSum</span><span class="op" id="3861256">(</span><span class="ident" id="3861257">masterSecret</span>&nbsp;<span class="op" id="3861270">[</span><span class="op" id="3861271">]</span><span class="builtintype" id="3861272">byte</span><span class="op" id="3861276">)</span>&nbsp;<span class="op" id="3861278">[</span><span class="op" id="3861279">]</span><span class="builtintype" id="3861280">byte</span>&nbsp;<span class="op" id="3861285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3861288">if</span>&nbsp;<span class="ident" id="3861291">h</span><span class="op" id="3861292">.</span><span class="ident" id="3861293">version</span>&nbsp;<span class="op" id="3861301">==</span>&nbsp;<span class="ident" id="3861304">VersionSSL30</span>&nbsp;<span class="op" id="3861317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3861321">return</span>&nbsp;<span class="ident" id="3861328">finishedSum30</span><span class="op" id="3861341">(</span><span class="ident" id="3861342">h</span><span class="op" id="3861343">.</span><span class="ident" id="3861344">serverMD5</span><span class="op" id="3861353">,</span>&nbsp;<span class="ident" id="3861355">h</span><span class="op" id="3861356">.</span><span class="ident" id="3861357">server</span><span class="op" id="3861363">,</span>&nbsp;<span class="ident" id="3861365">masterSecret</span><span class="op" id="3861377">,</span>&nbsp;<span class="ident" id="3861379">ssl3ServerFinishedMagic</span><span class="op" id="3861402">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3861405">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3861409">out</span>&nbsp;<span class="op" id="3861413">:=</span>&nbsp;<span class="builtinfunc" id="3861416">make</span><span class="op" id="3861420">(</span><span class="op" id="3861421">[</span><span class="op" id="3861422">]</span><span class="builtintype" id="3861423">byte</span><span class="op" id="3861427">,</span>&nbsp;<span class="ident" id="3861429">finishedVerifyLength</span><span class="op" id="3861449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3861452">if</span>&nbsp;<span class="ident" id="3861455">h</span><span class="op" id="3861456">.</span><span class="ident" id="3861457">version</span>&nbsp;<span class="op" id="3861465">&gt;=</span>&nbsp;<span class="ident" id="3861468">VersionTLS12</span>&nbsp;<span class="op" id="3861481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3861485">seed</span>&nbsp;<span class="op" id="3861490">:=</span>&nbsp;<span class="ident" id="3861493">h</span><span class="op" id="3861494">.</span><span class="ident" id="3861495">server</span><span class="op" id="3861501">.</span><span class="ident" id="3861502">Sum</span><span class="op" id="3861505">(</span><span class="builtintype" id="3861506">nil</span><span class="op" id="3861509">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3861513">prf12</span><span class="op" id="3861518">(</span><span class="ident" id="3861519">out</span><span class="op" id="3861522">,</span>&nbsp;<span class="ident" id="3861524">masterSecret</span><span class="op" id="3861536">,</span>&nbsp;<span class="ident" id="3861538">serverFinishedLabel</span><span class="op" id="3861557">,</span>&nbsp;<span class="ident" id="3861559">seed</span><span class="op" id="3861563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3861566">}</span>&nbsp;<span class="keyword" id="3861568">else</span>&nbsp;<span class="op" id="3861573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3861577">seed</span>&nbsp;<span class="op" id="3861582">:=</span>&nbsp;<span class="builtinfunc" id="3861585">make</span><span class="op" id="3861589">(</span><span class="op" id="3861590">[</span><span class="op" id="3861591">]</span><span class="builtintype" id="3861592">byte</span><span class="op" id="3861596">,</span>&nbsp;<span class="num" id="3861598">0</span><span class="op" id="3861599">,</span>&nbsp;<span class="ident" id="3861601">md5</span><span class="op" id="3861604">.</span><span class="ident" id="3861605">Size</span><span class="op" id="3861609">+</span><span class="ident" id="3861610">sha1</span><span class="op" id="3861614">.</span><span class="ident" id="3861615">Size</span><span class="op" id="3861619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3861623">seed</span>&nbsp;<span class="op" id="3861628">=</span>&nbsp;<span class="ident" id="3861630">h</span><span class="op" id="3861631">.</span><span class="ident" id="3861632">serverMD5</span><span class="op" id="3861641">.</span><span class="ident" id="3861642">Sum</span><span class="op" id="3861645">(</span><span class="ident" id="3861646">seed</span><span class="op" id="3861650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3861654">seed</span>&nbsp;<span class="op" id="3861659">=</span>&nbsp;<span class="ident" id="3861661">h</span><span class="op" id="3861662">.</span><span class="ident" id="3861663">server</span><span class="op" id="3861669">.</span><span class="ident" id="3861670">Sum</span><span class="op" id="3861673">(</span><span class="ident" id="3861674">seed</span><span class="op" id="3861678">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3861682">prf10</span><span class="op" id="3861687">(</span><span class="ident" id="3861688">out</span><span class="op" id="3861691">,</span>&nbsp;<span class="ident" id="3861693">masterSecret</span><span class="op" id="3861705">,</span>&nbsp;<span class="ident" id="3861707">serverFinishedLabel</span><span class="op" id="3861726">,</span>&nbsp;<span class="ident" id="3861728">seed</span><span class="op" id="3861732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3861735">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3861738">return</span>&nbsp;<span class="ident" id="3861745">out</span><br>
<span class="lineno"></span><span class="op" id="3861749">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span><span class="comment" id="3861752">//&nbsp;hashForClientCertificate&nbsp;returns&nbsp;a&nbsp;digest,&nbsp;hash&nbsp;function,&nbsp;and&nbsp;TLS&nbsp;1.2&nbsp;hash</span><br>
<span class="lineno"></span><span class="comment" id="3861830">//&nbsp;id&nbsp;suitable&nbsp;for&nbsp;signing&nbsp;by&nbsp;a&nbsp;TLS&nbsp;client&nbsp;certificate.</span><br>
<span class="lineno"></span><span class="keyword" id="3861886">func</span>&nbsp;<span class="op" id="3861891">(</span><span class="ident" id="3861892">h</span>&nbsp;<span class="ident" id="3861894">finishedHash</span><span class="op" id="3861906">)</span>&nbsp;<span class="ident" id="3861908">hashForClientCertificate</span><span class="op" id="3861932">(</span><span class="ident" id="3861933">sigType</span>&nbsp;<span class="builtintype" id="3861941">uint8</span><span class="op" id="3861946">)</span>&nbsp;<span class="op" id="3861948">(</span><span class="op" id="3861949">[</span><span class="op" id="3861950">]</span><span class="builtintype" id="3861951">byte</span><span class="op" id="3861955">,</span>&nbsp;<span class="ident" id="3861957">crypto</span><span class="op" id="3861963">.</span><span class="ident" id="3861964">Hash</span><span class="op" id="3861968">,</span>&nbsp;<span class="builtintype" id="3861970">uint8</span><span class="op" id="3861975">)</span>&nbsp;<span class="op" id="3861977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3861980">if</span>&nbsp;<span class="ident" id="3861983">h</span><span class="op" id="3861984">.</span><span class="ident" id="3861985">version</span>&nbsp;<span class="op" id="3861993">&gt;=</span>&nbsp;<span class="ident" id="3861996">VersionTLS12</span>&nbsp;<span class="op" id="3862009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3862013">digest</span>&nbsp;<span class="op" id="3862020">:=</span>&nbsp;<span class="ident" id="3862023">h</span><span class="op" id="3862024">.</span><span class="ident" id="3862025">server</span><span class="op" id="3862031">.</span><span class="ident" id="3862032">Sum</span><span class="op" id="3862035">(</span><span class="builtintype" id="3862036">nil</span><span class="op" id="3862039">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3862043">return</span>&nbsp;<span class="ident" id="3862050">digest</span><span class="op" id="3862056">,</span>&nbsp;<span class="ident" id="3862058">crypto</span><span class="op" id="3862064">.</span><span class="ident" id="3862065">SHA256</span><span class="op" id="3862071">,</span>&nbsp;<span class="ident" id="3862073">hashSHA256</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3862085">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3862088">if</span>&nbsp;<span class="ident" id="3862091">sigType</span>&nbsp;<span class="op" id="3862099">==</span>&nbsp;<span class="ident" id="3862102">signatureECDSA</span>&nbsp;<span class="op" id="3862117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3862121">digest</span>&nbsp;<span class="op" id="3862128">:=</span>&nbsp;<span class="ident" id="3862131">h</span><span class="op" id="3862132">.</span><span class="ident" id="3862133">server</span><span class="op" id="3862139">.</span><span class="ident" id="3862140">Sum</span><span class="op" id="3862143">(</span><span class="builtintype" id="3862144">nil</span><span class="op" id="3862147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3862151">return</span>&nbsp;<span class="ident" id="3862158">digest</span><span class="op" id="3862164">,</span>&nbsp;<span class="ident" id="3862166">crypto</span><span class="op" id="3862172">.</span><span class="ident" id="3862173">SHA1</span><span class="op" id="3862177">,</span>&nbsp;<span class="ident" id="3862179">hashSHA1</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3862189">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3862193">digest</span>&nbsp;<span class="op" id="3862200">:=</span>&nbsp;<span class="builtinfunc" id="3862203">make</span><span class="op" id="3862207">(</span><span class="op" id="3862208">[</span><span class="op" id="3862209">]</span><span class="builtintype" id="3862210">byte</span><span class="op" id="3862214">,</span>&nbsp;<span class="num" id="3862216">0</span><span class="op" id="3862217">,</span>&nbsp;<span class="num" id="3862219">36</span><span class="op" id="3862221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3862224">digest</span>&nbsp;<span class="op" id="3862231">=</span>&nbsp;<span class="ident" id="3862233">h</span><span class="op" id="3862234">.</span><span class="ident" id="3862235">serverMD5</span><span class="op" id="3862244">.</span><span class="ident" id="3862245">Sum</span><span class="op" id="3862248">(</span><span class="ident" id="3862249">digest</span><span class="op" id="3862255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3862258">digest</span>&nbsp;<span class="op" id="3862265">=</span>&nbsp;<span class="ident" id="3862267">h</span><span class="op" id="3862268">.</span><span class="ident" id="3862269">server</span><span class="op" id="3862275">.</span><span class="ident" id="3862276">Sum</span><span class="op" id="3862279">(</span><span class="ident" id="3862280">digest</span><span class="op" id="3862286">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3862289">return</span>&nbsp;<span class="ident" id="3862296">digest</span><span class="op" id="3862302">,</span>&nbsp;<span class="ident" id="3862304">crypto</span><span class="op" id="3862310">.</span><span class="ident" id="3862311">MD5SHA1</span><span class="op" id="3862318">,</span>&nbsp;<span class="num" id="3862320">0</span>&nbsp;<span class="comment" id="3862322">/*&nbsp;not&nbsp;specified&nbsp;in&nbsp;TLS&nbsp;1.2.&nbsp;*/</span><br>
<span class="lineno"></span><span class="op" id="3862354">}</span>
</div>
</body>
</html>
