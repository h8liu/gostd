<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/json</h2>
<ul>
<li><a href="/gostd/encoding/json/bench_test.go.html">bench_test.go</a></li>
<li><a href="/gostd/encoding/json/decode.go.html">decode.go</a></li>
<li><a href="/gostd/encoding/json/decode_test.go.html">decode_test.go</a></li>
<li><a href="/gostd/encoding/json/encode.go.html">encode.go</a></li>
<li><a href="/gostd/encoding/json/encode_test.go.html">encode_test.go</a></li>
<li><a href="/gostd/encoding/json/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/json/fold.go.html">fold.go</a></li>
<li><a href="/gostd/encoding/json/fold_test.go.html">fold_test.go</a></li>
<li><a href="/gostd/encoding/json/indent.go.html">indent.go</a></li>
<li><a href="/gostd/encoding/json/scanner.go.html">scanner.go</a></li>
<li><a href="/gostd/encoding/json/scanner_test.go.html">scanner_test.go</a></li>
<li><a href="/gostd/encoding/json/stream.go.html">stream.go</a></li>
<li><a href="/gostd/encoding/json/stream_test.go.html">stream_test.go</a></li>
<li><a href="/gostd/encoding/json/tagkey_test.go.html">tagkey_test.go</a></li>
<li><a href="/gostd/encoding/json/tags.go.html">tags.go</a></li>
<li><a href="/gostd/encoding/json/tags_test.go.html">tags_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4814584">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4814640">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4814694">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4814745">package</span>&nbsp;<span class="ident" id="4814753">json</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4814759">import</span>&nbsp;<span class="op" id="4814766">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4814769">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4814778">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4814788">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="4814793">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4814796">//&nbsp;A&nbsp;Decoder&nbsp;reads&nbsp;and&nbsp;decodes&nbsp;JSON&nbsp;objects&nbsp;from&nbsp;an&nbsp;input&nbsp;stream.</span><br>
<span class="lineno"></span><span class="keyword" id="4814862">type</span>&nbsp;<span class="ident" id="4814867">Decoder</span>&nbsp;<span class="keyword" id="4814875">struct</span>&nbsp;<span class="op" id="4814882">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4814885">r</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4814890">io</span><span class="op" id="4814892">.</span><span class="ident" id="4814893">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4814901">buf</span>&nbsp;&nbsp;<span class="op" id="4814906">[</span><span class="op" id="4814907">]</span><span class="builtintype" id="4814908">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4814914">d</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4814919">decodeState</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4814932">scan</span>&nbsp;<span class="ident" id="4814937">scanner</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4814946">err</span>&nbsp;&nbsp;<span class="builtintype" id="4814951">error</span><br>
<span class="lineno">20</span><span class="op" id="4814957">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4814960">//&nbsp;NewDecoder&nbsp;returns&nbsp;a&nbsp;new&nbsp;decoder&nbsp;that&nbsp;reads&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="4815015">//</span><br>
<span class="lineno"></span><span class="comment" id="4815018">//&nbsp;The&nbsp;decoder&nbsp;introduces&nbsp;its&nbsp;own&nbsp;buffering&nbsp;and&nbsp;may</span><br>
<span class="lineno">25</span><span class="comment" id="4815070">//&nbsp;read&nbsp;data&nbsp;from&nbsp;r&nbsp;beyond&nbsp;the&nbsp;JSON&nbsp;values&nbsp;requested.</span><br>
<span class="lineno"></span><span class="keyword" id="4815124">func</span>&nbsp;<span class="ident" id="4815129">NewDecoder</span><span class="op" id="4815139">(</span><span class="ident" id="4815140">r</span>&nbsp;<span class="ident" id="4815142">io</span><span class="op" id="4815144">.</span><span class="ident" id="4815145">Reader</span><span class="op" id="4815151">)</span>&nbsp;<span class="op" id="4815153">*</span><span class="ident" id="4815154">Decoder</span>&nbsp;<span class="op" id="4815162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4815165">return</span>&nbsp;<span class="op" id="4815172">&amp;</span><span class="ident" id="4815173">Decoder</span><span class="op" id="4815180">{</span><span class="ident" id="4815181">r</span><span class="op" id="4815182">:</span>&nbsp;<span class="ident" id="4815184">r</span><span class="op" id="4815185">}</span><br>
<span class="lineno"></span><span class="op" id="4815187">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="4815190">//&nbsp;UseNumber&nbsp;causes&nbsp;the&nbsp;Decoder&nbsp;to&nbsp;unmarshal&nbsp;a&nbsp;number&nbsp;into&nbsp;an&nbsp;interface{}&nbsp;as&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4815269">//&nbsp;Number&nbsp;instead&nbsp;of&nbsp;as&nbsp;a&nbsp;float64.</span><br>
<span class="lineno"></span><span class="keyword" id="4815304">func</span>&nbsp;<span class="op" id="4815309">(</span><span class="ident" id="4815310">dec</span>&nbsp;<span class="op" id="4815314">*</span><span class="ident" id="4815315">Decoder</span><span class="op" id="4815322">)</span>&nbsp;<span class="ident" id="4815324">UseNumber</span><span class="op" id="4815333">(</span><span class="op" id="4815334">)</span>&nbsp;<span class="op" id="4815336">{</span>&nbsp;<span class="ident" id="4815338">dec</span><span class="op" id="4815341">.</span><span class="ident" id="4815342">d</span><span class="op" id="4815343">.</span><span class="ident" id="4815344">useNumber</span>&nbsp;<span class="op" id="4815354">=</span>&nbsp;<span class="builtintype" id="4815356">true</span>&nbsp;<span class="op" id="4815361">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4815364">//&nbsp;Decode&nbsp;reads&nbsp;the&nbsp;next&nbsp;JSON-encoded&nbsp;value&nbsp;from&nbsp;its</span><br>
<span class="lineno">35</span><span class="comment" id="4815417">//&nbsp;input&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;the&nbsp;value&nbsp;pointed&nbsp;to&nbsp;by&nbsp;v.</span><br>
<span class="lineno"></span><span class="comment" id="4815470">//</span><br>
<span class="lineno"></span><span class="comment" id="4815473">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;Unmarshal&nbsp;for&nbsp;details&nbsp;about</span><br>
<span class="lineno"></span><span class="comment" id="4815530">//&nbsp;the&nbsp;conversion&nbsp;of&nbsp;JSON&nbsp;into&nbsp;a&nbsp;Go&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="4815573">func</span>&nbsp;<span class="op" id="4815578">(</span><span class="ident" id="4815579">dec</span>&nbsp;<span class="op" id="4815583">*</span><span class="ident" id="4815584">Decoder</span><span class="op" id="4815591">)</span>&nbsp;<span class="ident" id="4815593">Decode</span><span class="op" id="4815599">(</span><span class="ident" id="4815600">v</span>&nbsp;<span class="keyword" id="4815602">interface</span><span class="op" id="4815611">{</span><span class="op" id="4815612">}</span><span class="op" id="4815613">)</span>&nbsp;<span class="builtintype" id="4815615">error</span>&nbsp;<span class="op" id="4815621">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4815624">if</span>&nbsp;<span class="ident" id="4815627">dec</span><span class="op" id="4815630">.</span><span class="ident" id="4815631">err</span>&nbsp;<span class="op" id="4815635">!=</span>&nbsp;<span class="ident" id="4815638">nil</span>&nbsp;<span class="op" id="4815642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4815646">return</span>&nbsp;<span class="ident" id="4815653">dec</span><span class="op" id="4815656">.</span><span class="ident" id="4815657">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4815662">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4815666">n</span><span class="op" id="4815667">,</span>&nbsp;<span class="ident" id="4815669">err</span>&nbsp;<span class="op" id="4815673">:=</span>&nbsp;<span class="ident" id="4815676">dec</span><span class="op" id="4815679">.</span><span class="ident" id="4815680">readValue</span><span class="op" id="4815689">(</span><span class="op" id="4815690">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4815693">if</span>&nbsp;<span class="ident" id="4815696">err</span>&nbsp;<span class="op" id="4815700">!=</span>&nbsp;<span class="ident" id="4815703">nil</span>&nbsp;<span class="op" id="4815707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4815711">return</span>&nbsp;<span class="ident" id="4815718">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4815723">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4815727">//&nbsp;Don&#39;t&nbsp;save&nbsp;err&nbsp;from&nbsp;unmarshal&nbsp;into&nbsp;dec.err:</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4815775">//&nbsp;the&nbsp;connection&nbsp;is&nbsp;still&nbsp;usable&nbsp;since&nbsp;we&nbsp;read&nbsp;a&nbsp;complete&nbsp;JSON</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4815840">//&nbsp;object&nbsp;from&nbsp;it&nbsp;before&nbsp;the&nbsp;error&nbsp;happened.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4815886">dec</span><span class="op" id="4815889">.</span><span class="ident" id="4815890">d</span><span class="op" id="4815891">.</span><span class="ident" id="4815892">init</span><span class="op" id="4815896">(</span><span class="ident" id="4815897">dec</span><span class="op" id="4815900">.</span><span class="ident" id="4815901">buf</span><span class="op" id="4815904">[</span><span class="num" id="4815905">0</span><span class="op" id="4815906">:</span><span class="ident" id="4815907">n</span><span class="op" id="4815908">]</span><span class="op" id="4815909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4815912">err</span>&nbsp;<span class="op" id="4815916">=</span>&nbsp;<span class="ident" id="4815918">dec</span><span class="op" id="4815921">.</span><span class="ident" id="4815922">d</span><span class="op" id="4815923">.</span><span class="ident" id="4815924">unmarshal</span><span class="op" id="4815933">(</span><span class="ident" id="4815934">v</span><span class="op" id="4815935">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4815939">//&nbsp;Slide&nbsp;rest&nbsp;of&nbsp;data&nbsp;down.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4815968">rest</span>&nbsp;<span class="op" id="4815973">:=</span>&nbsp;<span class="builtinfunc" id="4815976">copy</span><span class="op" id="4815980">(</span><span class="ident" id="4815981">dec</span><span class="op" id="4815984">.</span><span class="ident" id="4815985">buf</span><span class="op" id="4815988">,</span>&nbsp;<span class="ident" id="4815990">dec</span><span class="op" id="4815993">.</span><span class="ident" id="4815994">buf</span><span class="op" id="4815997">[</span><span class="ident" id="4815998">n</span><span class="op" id="4815999">:</span><span class="op" id="4816000">]</span><span class="op" id="4816001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4816004">dec</span><span class="op" id="4816007">.</span><span class="ident" id="4816008">buf</span>&nbsp;<span class="op" id="4816012">=</span>&nbsp;<span class="ident" id="4816014">dec</span><span class="op" id="4816017">.</span><span class="ident" id="4816018">buf</span><span class="op" id="4816021">[</span><span class="num" id="4816022">0</span><span class="op" id="4816023">:</span><span class="ident" id="4816024">rest</span><span class="op" id="4816028">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4816032">return</span>&nbsp;<span class="ident" id="4816039">err</span><br>
<span class="lineno">60</span><span class="op" id="4816043">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4816046">//&nbsp;Buffered&nbsp;returns&nbsp;a&nbsp;reader&nbsp;of&nbsp;the&nbsp;data&nbsp;remaining&nbsp;in&nbsp;the&nbsp;Decoder&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="4816114">//&nbsp;buffer.&nbsp;The&nbsp;reader&nbsp;is&nbsp;valid&nbsp;until&nbsp;the&nbsp;next&nbsp;call&nbsp;to&nbsp;Decode.</span><br>
<span class="lineno"></span><span class="keyword" id="4816176">func</span>&nbsp;<span class="op" id="4816181">(</span><span class="ident" id="4816182">dec</span>&nbsp;<span class="op" id="4816186">*</span><span class="ident" id="4816187">Decoder</span><span class="op" id="4816194">)</span>&nbsp;<span class="ident" id="4816196">Buffered</span><span class="op" id="4816204">(</span><span class="op" id="4816205">)</span>&nbsp;<span class="ident" id="4816207">io</span><span class="op" id="4816209">.</span><span class="ident" id="4816210">Reader</span>&nbsp;<span class="op" id="4816217">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4816220">return</span>&nbsp;<span class="ident" id="4816227">bytes</span><span class="op" id="4816232">.</span><span class="ident" id="4816233">NewReader</span><span class="op" id="4816242">(</span><span class="ident" id="4816243">dec</span><span class="op" id="4816246">.</span><span class="ident" id="4816247">buf</span><span class="op" id="4816250">)</span><br>
<span class="lineno"></span><span class="op" id="4816252">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4816255">//&nbsp;readValue&nbsp;reads&nbsp;a&nbsp;JSON&nbsp;value&nbsp;into&nbsp;dec.buf.</span><br>
<span class="lineno"></span><span class="comment" id="4816301">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;encoding.</span><br>
<span class="lineno">70</span><span class="keyword" id="4816343">func</span>&nbsp;<span class="op" id="4816348">(</span><span class="ident" id="4816349">dec</span>&nbsp;<span class="op" id="4816353">*</span><span class="ident" id="4816354">Decoder</span><span class="op" id="4816361">)</span>&nbsp;<span class="ident" id="4816363">readValue</span><span class="op" id="4816372">(</span><span class="op" id="4816373">)</span>&nbsp;<span class="op" id="4816375">(</span><span class="builtintype" id="4816376">int</span><span class="op" id="4816379">,</span>&nbsp;<span class="builtintype" id="4816381">error</span><span class="op" id="4816386">)</span>&nbsp;<span class="op" id="4816388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4816391">dec</span><span class="op" id="4816394">.</span><span class="ident" id="4816395">scan</span><span class="op" id="4816399">.</span><span class="ident" id="4816400">reset</span><span class="op" id="4816405">(</span><span class="op" id="4816406">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4816410">scanp</span>&nbsp;<span class="op" id="4816416">:=</span>&nbsp;<span class="num" id="4816419">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4816422">var</span>&nbsp;<span class="ident" id="4816426">err</span>&nbsp;<span class="builtintype" id="4816430">error</span><br>
<span class="lineno">75</span><span class="ident" id="4816436">Input</span><span class="op" id="4816441">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4816444">for</span>&nbsp;<span class="op" id="4816448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4816452">//&nbsp;Look&nbsp;in&nbsp;the&nbsp;buffer&nbsp;for&nbsp;a&nbsp;new&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4816493">for</span>&nbsp;<span class="ident" id="4816497">i</span><span class="op" id="4816498">,</span>&nbsp;<span class="ident" id="4816500">c</span>&nbsp;<span class="op" id="4816502">:=</span>&nbsp;<span class="keyword" id="4816505">range</span>&nbsp;<span class="ident" id="4816511">dec</span><span class="op" id="4816514">.</span><span class="ident" id="4816515">buf</span><span class="op" id="4816518">[</span><span class="ident" id="4816519">scanp</span><span class="op" id="4816524">:</span><span class="op" id="4816525">]</span>&nbsp;<span class="op" id="4816527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4816532">dec</span><span class="op" id="4816535">.</span><span class="ident" id="4816536">scan</span><span class="op" id="4816540">.</span><span class="ident" id="4816541">bytes</span><span class="op" id="4816546">++</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4816552">v</span>&nbsp;<span class="op" id="4816554">:=</span>&nbsp;<span class="ident" id="4816557">dec</span><span class="op" id="4816560">.</span><span class="ident" id="4816561">scan</span><span class="op" id="4816565">.</span><span class="ident" id="4816566">step</span><span class="op" id="4816570">(</span><span class="op" id="4816571">&amp;</span><span class="ident" id="4816572">dec</span><span class="op" id="4816575">.</span><span class="ident" id="4816576">scan</span><span class="op" id="4816580">,</span>&nbsp;<span class="builtintype" id="4816582">int</span><span class="op" id="4816585">(</span><span class="ident" id="4816586">c</span><span class="op" id="4816587">)</span><span class="op" id="4816588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4816593">if</span>&nbsp;<span class="ident" id="4816596">v</span>&nbsp;<span class="op" id="4816598">==</span>&nbsp;<span class="ident" id="4816601">scanEnd</span>&nbsp;<span class="op" id="4816609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4816615">scanp</span>&nbsp;<span class="op" id="4816621">+=</span>&nbsp;<span class="ident" id="4816624">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4816630">break</span>&nbsp;<span class="ident" id="4816636">Input</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4816645">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4816650">//&nbsp;scanEnd&nbsp;is&nbsp;delayed&nbsp;one&nbsp;byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4816685">//&nbsp;We&nbsp;might&nbsp;block&nbsp;trying&nbsp;to&nbsp;get&nbsp;that&nbsp;byte&nbsp;from&nbsp;src,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4816740">//&nbsp;so&nbsp;instead&nbsp;invent&nbsp;a&nbsp;space&nbsp;byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4816778">if</span>&nbsp;<span class="op" id="4816781">(</span><span class="ident" id="4816782">v</span>&nbsp;<span class="op" id="4816784">==</span>&nbsp;<span class="ident" id="4816787">scanEndObject</span>&nbsp;<span class="op" id="4816801">||</span>&nbsp;<span class="ident" id="4816804">v</span>&nbsp;<span class="op" id="4816806">==</span>&nbsp;<span class="ident" id="4816809">scanEndArray</span><span class="op" id="4816821">)</span>&nbsp;<span class="op" id="4816823">&amp;&amp;</span>&nbsp;<span class="ident" id="4816826">dec</span><span class="op" id="4816829">.</span><span class="ident" id="4816830">scan</span><span class="op" id="4816834">.</span><span class="ident" id="4816835">step</span><span class="op" id="4816839">(</span><span class="op" id="4816840">&amp;</span><span class="ident" id="4816841">dec</span><span class="op" id="4816844">.</span><span class="ident" id="4816845">scan</span><span class="op" id="4816849">,</span>&nbsp;<span class="string" id="4816851">&#39;&nbsp;&#39;</span><span class="op" id="4816854">)</span>&nbsp;<span class="op" id="4816856">==</span>&nbsp;<span class="ident" id="4816859">scanEnd</span>&nbsp;<span class="op" id="4816867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4816873">scanp</span>&nbsp;<span class="op" id="4816879">+=</span>&nbsp;<span class="ident" id="4816882">i</span>&nbsp;<span class="op" id="4816884">+</span>&nbsp;<span class="num" id="4816886">1</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4816892">break</span>&nbsp;<span class="ident" id="4816898">Input</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4816907">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4816912">if</span>&nbsp;<span class="ident" id="4816915">v</span>&nbsp;<span class="op" id="4816917">==</span>&nbsp;<span class="ident" id="4816920">scanError</span>&nbsp;<span class="op" id="4816930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4816936">dec</span><span class="op" id="4816939">.</span><span class="ident" id="4816940">err</span>&nbsp;<span class="op" id="4816944">=</span>&nbsp;<span class="ident" id="4816946">dec</span><span class="op" id="4816949">.</span><span class="ident" id="4816950">scan</span><span class="op" id="4816954">.</span><span class="ident" id="4816955">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4816963">return</span>&nbsp;<span class="num" id="4816970">0</span><span class="op" id="4816971">,</span>&nbsp;<span class="ident" id="4816973">dec</span><span class="op" id="4816976">.</span><span class="ident" id="4816977">scan</span><span class="op" id="4816981">.</span><span class="ident" id="4816982">err</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4816989">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4816993">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4816997">scanp</span>&nbsp;<span class="op" id="4817003">=</span>&nbsp;<span class="builtinfunc" id="4817005">len</span><span class="op" id="4817008">(</span><span class="ident" id="4817009">dec</span><span class="op" id="4817012">.</span><span class="ident" id="4817013">buf</span><span class="op" id="4817016">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4817021">//&nbsp;Did&nbsp;the&nbsp;last&nbsp;read&nbsp;have&nbsp;an&nbsp;error?</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4817059">//&nbsp;Delayed&nbsp;until&nbsp;now&nbsp;to&nbsp;allow&nbsp;buffer&nbsp;scan.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4817104">if</span>&nbsp;<span class="ident" id="4817107">err</span>&nbsp;<span class="op" id="4817111">!=</span>&nbsp;<span class="ident" id="4817114">nil</span>&nbsp;<span class="op" id="4817118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4817123">if</span>&nbsp;<span class="ident" id="4817126">err</span>&nbsp;<span class="op" id="4817130">==</span>&nbsp;<span class="ident" id="4817133">io</span><span class="op" id="4817135">.</span><span class="ident" id="4817136">EOF</span>&nbsp;<span class="op" id="4817140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4817146">if</span>&nbsp;<span class="ident" id="4817149">dec</span><span class="op" id="4817152">.</span><span class="ident" id="4817153">scan</span><span class="op" id="4817157">.</span><span class="ident" id="4817158">step</span><span class="op" id="4817162">(</span><span class="op" id="4817163">&amp;</span><span class="ident" id="4817164">dec</span><span class="op" id="4817167">.</span><span class="ident" id="4817168">scan</span><span class="op" id="4817172">,</span>&nbsp;<span class="string" id="4817174">&#39;&nbsp;&#39;</span><span class="op" id="4817177">)</span>&nbsp;<span class="op" id="4817179">==</span>&nbsp;<span class="ident" id="4817182">scanEnd</span>&nbsp;<span class="op" id="4817190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4817197">break</span>&nbsp;<span class="ident" id="4817203">Input</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4817213">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4817219">if</span>&nbsp;<span class="ident" id="4817222">nonSpace</span><span class="op" id="4817230">(</span><span class="ident" id="4817231">dec</span><span class="op" id="4817234">.</span><span class="ident" id="4817235">buf</span><span class="op" id="4817238">)</span>&nbsp;<span class="op" id="4817240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4817247">err</span>&nbsp;<span class="op" id="4817251">=</span>&nbsp;<span class="ident" id="4817253">io</span><span class="op" id="4817255">.</span><span class="ident" id="4817256">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4817277">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4817282">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4817287">dec</span><span class="op" id="4817290">.</span><span class="ident" id="4817291">err</span>&nbsp;<span class="op" id="4817295">=</span>&nbsp;<span class="ident" id="4817297">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4817304">return</span>&nbsp;<span class="num" id="4817311">0</span><span class="op" id="4817312">,</span>&nbsp;<span class="ident" id="4817314">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4817320">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4817325">//&nbsp;Make&nbsp;room&nbsp;to&nbsp;read&nbsp;more&nbsp;into&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4817370">const</span>&nbsp;<span class="ident" id="4817376">minRead</span>&nbsp;<span class="op" id="4817384">=</span>&nbsp;<span class="num" id="4817386">512</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4817392">if</span>&nbsp;<span class="builtinfunc" id="4817395">cap</span><span class="op" id="4817398">(</span><span class="ident" id="4817399">dec</span><span class="op" id="4817402">.</span><span class="ident" id="4817403">buf</span><span class="op" id="4817406">)</span><span class="op" id="4817407">-</span><span class="builtinfunc" id="4817408">len</span><span class="op" id="4817411">(</span><span class="ident" id="4817412">dec</span><span class="op" id="4817415">.</span><span class="ident" id="4817416">buf</span><span class="op" id="4817419">)</span>&nbsp;<span class="op" id="4817421">&lt;</span>&nbsp;<span class="ident" id="4817423">minRead</span>&nbsp;<span class="op" id="4817431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4817436">newBuf</span>&nbsp;<span class="op" id="4817443">:=</span>&nbsp;<span class="builtinfunc" id="4817446">make</span><span class="op" id="4817450">(</span><span class="op" id="4817451">[</span><span class="op" id="4817452">]</span><span class="builtintype" id="4817453">byte</span><span class="op" id="4817457">,</span>&nbsp;<span class="builtinfunc" id="4817459">len</span><span class="op" id="4817462">(</span><span class="ident" id="4817463">dec</span><span class="op" id="4817466">.</span><span class="ident" id="4817467">buf</span><span class="op" id="4817470">)</span><span class="op" id="4817471">,</span>&nbsp;<span class="num" id="4817473">2</span><span class="op" id="4817474">*</span><span class="builtinfunc" id="4817475">cap</span><span class="op" id="4817478">(</span><span class="ident" id="4817479">dec</span><span class="op" id="4817482">.</span><span class="ident" id="4817483">buf</span><span class="op" id="4817486">)</span><span class="op" id="4817487">+</span><span class="ident" id="4817488">minRead</span><span class="op" id="4817495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4817500">copy</span><span class="op" id="4817504">(</span><span class="ident" id="4817505">newBuf</span><span class="op" id="4817511">,</span>&nbsp;<span class="ident" id="4817513">dec</span><span class="op" id="4817516">.</span><span class="ident" id="4817517">buf</span><span class="op" id="4817520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4817525">dec</span><span class="op" id="4817528">.</span><span class="ident" id="4817529">buf</span>&nbsp;<span class="op" id="4817533">=</span>&nbsp;<span class="ident" id="4817535">newBuf</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4817544">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4817549">//&nbsp;Read.&nbsp;&nbsp;Delay&nbsp;error&nbsp;for&nbsp;next&nbsp;iteration&nbsp;(after&nbsp;scan).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4817606">var</span>&nbsp;<span class="ident" id="4817610">n</span>&nbsp;<span class="builtintype" id="4817612">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4817618">n</span><span class="op" id="4817619">,</span>&nbsp;<span class="ident" id="4817621">err</span>&nbsp;<span class="op" id="4817625">=</span>&nbsp;<span class="ident" id="4817627">dec</span><span class="op" id="4817630">.</span><span class="ident" id="4817631">r</span><span class="op" id="4817632">.</span><span class="ident" id="4817633">Read</span><span class="op" id="4817637">(</span><span class="ident" id="4817638">dec</span><span class="op" id="4817641">.</span><span class="ident" id="4817642">buf</span><span class="op" id="4817645">[</span><span class="builtinfunc" id="4817646">len</span><span class="op" id="4817649">(</span><span class="ident" id="4817650">dec</span><span class="op" id="4817653">.</span><span class="ident" id="4817654">buf</span><span class="op" id="4817657">)</span><span class="op" id="4817658">:</span><span class="builtinfunc" id="4817659">cap</span><span class="op" id="4817662">(</span><span class="ident" id="4817663">dec</span><span class="op" id="4817666">.</span><span class="ident" id="4817667">buf</span><span class="op" id="4817670">)</span><span class="op" id="4817671">]</span><span class="op" id="4817672">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4817676">dec</span><span class="op" id="4817679">.</span><span class="ident" id="4817680">buf</span>&nbsp;<span class="op" id="4817684">=</span>&nbsp;<span class="ident" id="4817686">dec</span><span class="op" id="4817689">.</span><span class="ident" id="4817690">buf</span><span class="op" id="4817693">[</span><span class="num" id="4817694">0</span>&nbsp;<span class="op" id="4817696">:</span>&nbsp;<span class="builtinfunc" id="4817698">len</span><span class="op" id="4817701">(</span><span class="ident" id="4817702">dec</span><span class="op" id="4817705">.</span><span class="ident" id="4817706">buf</span><span class="op" id="4817709">)</span><span class="op" id="4817710">+</span><span class="ident" id="4817711">n</span><span class="op" id="4817712">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4817715">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4817718">return</span>&nbsp;<span class="ident" id="4817725">scanp</span><span class="op" id="4817730">,</span>&nbsp;<span class="ident" id="4817732">nil</span><br>
<span class="lineno"></span><span class="op" id="4817736">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="4817739">func</span>&nbsp;<span class="ident" id="4817744">nonSpace</span><span class="op" id="4817752">(</span><span class="ident" id="4817753">b</span>&nbsp;<span class="op" id="4817755">[</span><span class="op" id="4817756">]</span><span class="builtintype" id="4817757">byte</span><span class="op" id="4817761">)</span>&nbsp;<span class="builtintype" id="4817763">bool</span>&nbsp;<span class="op" id="4817768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4817771">for</span>&nbsp;<span class="ident" id="4817775">_</span><span class="op" id="4817776">,</span>&nbsp;<span class="ident" id="4817778">c</span>&nbsp;<span class="op" id="4817780">:=</span>&nbsp;<span class="keyword" id="4817783">range</span>&nbsp;<span class="ident" id="4817789">b</span>&nbsp;<span class="op" id="4817791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4817795">if</span>&nbsp;<span class="op" id="4817798">!</span><span class="ident" id="4817799">isSpace</span><span class="op" id="4817806">(</span><span class="builtintype" id="4817807">rune</span><span class="op" id="4817811">(</span><span class="ident" id="4817812">c</span><span class="op" id="4817813">)</span><span class="op" id="4817814">)</span>&nbsp;<span class="op" id="4817816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4817821">return</span>&nbsp;<span class="builtintype" id="4817828">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4817835">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4817838">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4817841">return</span>&nbsp;<span class="builtintype" id="4817848">false</span><br>
<span class="lineno"></span><span class="op" id="4817854">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4817857">//&nbsp;An&nbsp;Encoder&nbsp;writes&nbsp;JSON&nbsp;objects&nbsp;to&nbsp;an&nbsp;output&nbsp;stream.</span><br>
<span class="lineno">140</span><span class="keyword" id="4817912">type</span>&nbsp;<span class="ident" id="4817917">Encoder</span>&nbsp;<span class="keyword" id="4817925">struct</span>&nbsp;<span class="op" id="4817932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4817935">w</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4817939">io</span><span class="op" id="4817941">.</span><span class="ident" id="4817942">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4817950">err</span>&nbsp;<span class="builtintype" id="4817954">error</span><br>
<span class="lineno"></span><span class="op" id="4817960">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="comment" id="4817963">//&nbsp;NewEncoder&nbsp;returns&nbsp;a&nbsp;new&nbsp;encoder&nbsp;that&nbsp;writes&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="4818017">func</span>&nbsp;<span class="ident" id="4818022">NewEncoder</span><span class="op" id="4818032">(</span><span class="ident" id="4818033">w</span>&nbsp;<span class="ident" id="4818035">io</span><span class="op" id="4818037">.</span><span class="ident" id="4818038">Writer</span><span class="op" id="4818044">)</span>&nbsp;<span class="op" id="4818046">*</span><span class="ident" id="4818047">Encoder</span>&nbsp;<span class="op" id="4818055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4818058">return</span>&nbsp;<span class="op" id="4818065">&amp;</span><span class="ident" id="4818066">Encoder</span><span class="op" id="4818073">{</span><span class="ident" id="4818074">w</span><span class="op" id="4818075">:</span>&nbsp;<span class="ident" id="4818077">w</span><span class="op" id="4818078">}</span><br>
<span class="lineno"></span><span class="op" id="4818080">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span><span class="comment" id="4818083">//&nbsp;Encode&nbsp;writes&nbsp;the&nbsp;JSON&nbsp;encoding&nbsp;of&nbsp;v&nbsp;to&nbsp;the&nbsp;stream,</span><br>
<span class="lineno"></span><span class="comment" id="4818138">//&nbsp;followed&nbsp;by&nbsp;a&nbsp;newline&nbsp;character.</span><br>
<span class="lineno"></span><span class="comment" id="4818174">//</span><br>
<span class="lineno"></span><span class="comment" id="4818177">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;Marshal&nbsp;for&nbsp;details&nbsp;about&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4818236">//&nbsp;conversion&nbsp;of&nbsp;Go&nbsp;values&nbsp;to&nbsp;JSON.</span><br>
<span class="lineno">155</span><span class="keyword" id="4818272">func</span>&nbsp;<span class="op" id="4818277">(</span><span class="ident" id="4818278">enc</span>&nbsp;<span class="op" id="4818282">*</span><span class="ident" id="4818283">Encoder</span><span class="op" id="4818290">)</span>&nbsp;<span class="ident" id="4818292">Encode</span><span class="op" id="4818298">(</span><span class="ident" id="4818299">v</span>&nbsp;<span class="keyword" id="4818301">interface</span><span class="op" id="4818310">{</span><span class="op" id="4818311">}</span><span class="op" id="4818312">)</span>&nbsp;<span class="builtintype" id="4818314">error</span>&nbsp;<span class="op" id="4818320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4818323">if</span>&nbsp;<span class="ident" id="4818326">enc</span><span class="op" id="4818329">.</span><span class="ident" id="4818330">err</span>&nbsp;<span class="op" id="4818334">!=</span>&nbsp;<span class="ident" id="4818337">nil</span>&nbsp;<span class="op" id="4818341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4818345">return</span>&nbsp;<span class="ident" id="4818352">enc</span><span class="op" id="4818355">.</span><span class="ident" id="4818356">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4818361">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4818364">e</span>&nbsp;<span class="op" id="4818366">:=</span>&nbsp;<span class="ident" id="4818369">newEncodeState</span><span class="op" id="4818383">(</span><span class="op" id="4818384">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4818387">err</span>&nbsp;<span class="op" id="4818391">:=</span>&nbsp;<span class="ident" id="4818394">e</span><span class="op" id="4818395">.</span><span class="ident" id="4818396">marshal</span><span class="op" id="4818403">(</span><span class="ident" id="4818404">v</span><span class="op" id="4818405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4818408">if</span>&nbsp;<span class="ident" id="4818411">err</span>&nbsp;<span class="op" id="4818415">!=</span>&nbsp;<span class="ident" id="4818418">nil</span>&nbsp;<span class="op" id="4818422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4818426">return</span>&nbsp;<span class="ident" id="4818433">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4818438">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4818442">//&nbsp;Terminate&nbsp;each&nbsp;value&nbsp;with&nbsp;a&nbsp;newline.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4818483">//&nbsp;This&nbsp;makes&nbsp;the&nbsp;output&nbsp;look&nbsp;a&nbsp;little&nbsp;nicer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4818529">//&nbsp;when&nbsp;debugging,&nbsp;and&nbsp;some&nbsp;kind&nbsp;of&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4818572">//&nbsp;is&nbsp;required&nbsp;if&nbsp;the&nbsp;encoded&nbsp;value&nbsp;was&nbsp;a&nbsp;number,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4818623">//&nbsp;so&nbsp;that&nbsp;the&nbsp;reader&nbsp;knows&nbsp;there&nbsp;aren&#39;t&nbsp;more</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4818670">//&nbsp;digits&nbsp;coming.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4818689">e</span><span class="op" id="4818690">.</span><span class="ident" id="4818691">WriteByte</span><span class="op" id="4818700">(</span><span class="string" id="4818701">&#39;\n&#39;</span><span class="op" id="4818705">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4818709">if</span>&nbsp;<span class="ident" id="4818712">_</span><span class="op" id="4818713">,</span>&nbsp;<span class="ident" id="4818715">err</span>&nbsp;<span class="op" id="4818719">=</span>&nbsp;<span class="ident" id="4818721">enc</span><span class="op" id="4818724">.</span><span class="ident" id="4818725">w</span><span class="op" id="4818726">.</span><span class="ident" id="4818727">Write</span><span class="op" id="4818732">(</span><span class="ident" id="4818733">e</span><span class="op" id="4818734">.</span><span class="ident" id="4818735">Bytes</span><span class="op" id="4818740">(</span><span class="op" id="4818741">)</span><span class="op" id="4818742">)</span><span class="op" id="4818743">;</span>&nbsp;<span class="ident" id="4818745">err</span>&nbsp;<span class="op" id="4818749">!=</span>&nbsp;<span class="ident" id="4818752">nil</span>&nbsp;<span class="op" id="4818756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4818760">enc</span><span class="op" id="4818763">.</span><span class="ident" id="4818764">err</span>&nbsp;<span class="op" id="4818768">=</span>&nbsp;<span class="ident" id="4818770">err</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4818775">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4818778">encodeStatePool</span><span class="op" id="4818793">.</span><span class="ident" id="4818794">Put</span><span class="op" id="4818797">(</span><span class="ident" id="4818798">e</span><span class="op" id="4818799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4818802">return</span>&nbsp;<span class="ident" id="4818809">err</span><br>
<span class="lineno"></span><span class="op" id="4818813">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="comment" id="4818816">//&nbsp;RawMessage&nbsp;is&nbsp;a&nbsp;raw&nbsp;encoded&nbsp;JSON&nbsp;object.</span><br>
<span class="lineno"></span><span class="comment" id="4818860">//&nbsp;It&nbsp;implements&nbsp;Marshaler&nbsp;and&nbsp;Unmarshaler&nbsp;and&nbsp;can</span><br>
<span class="lineno"></span><span class="comment" id="4818911">//&nbsp;be&nbsp;used&nbsp;to&nbsp;delay&nbsp;JSON&nbsp;decoding&nbsp;or&nbsp;precompute&nbsp;a&nbsp;JSON&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="4818976">type</span>&nbsp;<span class="ident" id="4818981">RawMessage</span>&nbsp;<span class="op" id="4818992">[</span><span class="op" id="4818993">]</span><span class="builtintype" id="4818994">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="comment" id="4819000">//&nbsp;MarshalJSON&nbsp;returns&nbsp;*m&nbsp;as&nbsp;the&nbsp;JSON&nbsp;encoding&nbsp;of&nbsp;m.</span><br>
<span class="lineno"></span><span class="keyword" id="4819053">func</span>&nbsp;<span class="op" id="4819058">(</span><span class="ident" id="4819059">m</span>&nbsp;<span class="op" id="4819061">*</span><span class="ident" id="4819062">RawMessage</span><span class="op" id="4819072">)</span>&nbsp;<span class="ident" id="4819074">MarshalJSON</span><span class="op" id="4819085">(</span><span class="op" id="4819086">)</span>&nbsp;<span class="op" id="4819088">(</span><span class="op" id="4819089">[</span><span class="op" id="4819090">]</span><span class="builtintype" id="4819091">byte</span><span class="op" id="4819095">,</span>&nbsp;<span class="builtintype" id="4819097">error</span><span class="op" id="4819102">)</span>&nbsp;<span class="op" id="4819104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4819107">return</span>&nbsp;<span class="op" id="4819114">*</span><span class="ident" id="4819115">m</span><span class="op" id="4819116">,</span>&nbsp;<span class="ident" id="4819118">nil</span><br>
<span class="lineno"></span><span class="op" id="4819122">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="comment" id="4819125">//&nbsp;UnmarshalJSON&nbsp;sets&nbsp;*m&nbsp;to&nbsp;a&nbsp;copy&nbsp;of&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="4819169">func</span>&nbsp;<span class="op" id="4819174">(</span><span class="ident" id="4819175">m</span>&nbsp;<span class="op" id="4819177">*</span><span class="ident" id="4819178">RawMessage</span><span class="op" id="4819188">)</span>&nbsp;<span class="ident" id="4819190">UnmarshalJSON</span><span class="op" id="4819203">(</span><span class="ident" id="4819204">data</span>&nbsp;<span class="op" id="4819209">[</span><span class="op" id="4819210">]</span><span class="builtintype" id="4819211">byte</span><span class="op" id="4819215">)</span>&nbsp;<span class="builtintype" id="4819217">error</span>&nbsp;<span class="op" id="4819223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4819226">if</span>&nbsp;<span class="ident" id="4819229">m</span>&nbsp;<span class="op" id="4819231">==</span>&nbsp;<span class="ident" id="4819234">nil</span>&nbsp;<span class="op" id="4819238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4819242">return</span>&nbsp;<span class="ident" id="4819249">errors</span><span class="op" id="4819255">.</span><span class="ident" id="4819256">New</span><span class="op" id="4819259">(</span><span class="string" id="4819260">&#34;json.RawMessage:&nbsp;UnmarshalJSON&nbsp;on&nbsp;nil&nbsp;pointer&#34;</span><span class="op" id="4819307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4819310">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4819313">*</span><span class="ident" id="4819314">m</span>&nbsp;<span class="op" id="4819316">=</span>&nbsp;<span class="builtinfunc" id="4819318">append</span><span class="op" id="4819324">(</span><span class="op" id="4819325">(</span><span class="op" id="4819326">*</span><span class="ident" id="4819327">m</span><span class="op" id="4819328">)</span><span class="op" id="4819329">[</span><span class="num" id="4819330">0</span><span class="op" id="4819331">:</span><span class="num" id="4819332">0</span><span class="op" id="4819333">]</span><span class="op" id="4819334">,</span>&nbsp;<span class="ident" id="4819336">data</span><span class="op" id="4819340">...</span><span class="op" id="4819343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4819346">return</span>&nbsp;<span class="ident" id="4819353">nil</span><br>
<span class="lineno"></span><span class="op" id="4819357">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4819360">var</span>&nbsp;<span class="ident" id="4819364">_</span>&nbsp;<span class="ident" id="4819366">Marshaler</span>&nbsp;<span class="op" id="4819376">=</span>&nbsp;<span class="op" id="4819378">(</span><span class="op" id="4819379">*</span><span class="ident" id="4819380">RawMessage</span><span class="op" id="4819390">)</span><span class="op" id="4819391">(</span><span class="ident" id="4819392">nil</span><span class="op" id="4819395">)</span><br>
<span class="lineno">200</span><span class="keyword" id="4819397">var</span>&nbsp;<span class="ident" id="4819401">_</span>&nbsp;<span class="ident" id="4819403">Unmarshaler</span>&nbsp;<span class="op" id="4819415">=</span>&nbsp;<span class="op" id="4819417">(</span><span class="op" id="4819418">*</span><span class="ident" id="4819419">RawMessage</span><span class="op" id="4819429">)</span><span class="op" id="4819430">(</span><span class="ident" id="4819431">nil</span><span class="op" id="4819434">)</span>
</div>
</body>
</html>
