<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/printer</h2>
<ul>
<li><a href="/gostd/go/printer/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/printer/nodes.go.html">nodes.go</a></li>
<li><a href="/gostd/go/printer/performance_test.go.html">performance_test.go</a></li>
<li><a href="/gostd/go/printer/printer.go.html">printer.go</a></li>
<li><a href="/gostd/go/printer/printer_test.go.html" class="current">printer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8322095">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8322150">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8322204">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8322255">package</span>&nbsp;<span class="ident" id="8322263">printer</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8322272">import</span>&nbsp;<span class="op" id="8322279">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8322282">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8322291">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8322301">&#34;flag&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8322309">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8322316">&#34;go/ast&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8322326">&#34;go/parser&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8322339">&#34;go/token&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8322351">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8322364">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8322381">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8322392">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="8322399">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="8322402">const</span>&nbsp;<span class="op" id="8322408">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8322411">dataDir</span>&nbsp;&nbsp;<span class="op" id="8322420">=</span>&nbsp;<span class="string" id="8322422">&#34;testdata&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8322434">tabwidth</span>&nbsp;<span class="op" id="8322443">=</span>&nbsp;<span class="num" id="8322445">8</span><br>
<span class="lineno"></span><span class="op" id="8322447">)</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="8322450">var</span>&nbsp;<span class="ident" id="8322454">update</span>&nbsp;<span class="op" id="8322461">=</span>&nbsp;<span class="ident" id="8322463">flag</span><span class="op" id="8322467">.</span><span class="ident" id="8322468">Bool</span><span class="op" id="8322472">(</span><span class="string" id="8322473">&#34;update&#34;</span><span class="op" id="8322481">,</span>&nbsp;<span class="builtintype" id="8322483">false</span><span class="op" id="8322488">,</span>&nbsp;<span class="string" id="8322490">&#34;update&nbsp;golden&nbsp;files&#34;</span><span class="op" id="8322511">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8322514">var</span>&nbsp;<span class="ident" id="8322518">fset</span>&nbsp;<span class="op" id="8322523">=</span>&nbsp;<span class="ident" id="8322525">token</span><span class="op" id="8322530">.</span><span class="ident" id="8322531">NewFileSet</span><span class="op" id="8322541">(</span><span class="op" id="8322542">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="8322545">type</span>&nbsp;<span class="ident" id="8322550">checkMode</span>&nbsp;<span class="builtintype" id="8322560">uint</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8322566">const</span>&nbsp;<span class="op" id="8322572">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8322575">export</span>&nbsp;<span class="ident" id="8322582">checkMode</span>&nbsp;<span class="op" id="8322592">=</span>&nbsp;<span class="num" id="8322594">1</span>&nbsp;<span class="op" id="8322596">&lt;&lt;</span>&nbsp;<span class="ident" id="8322599">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8322605">rawFormat</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8322616">idempotent</span><br>
<span class="lineno"></span><span class="op" id="8322627">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8322630">//&nbsp;format&nbsp;parses&nbsp;src,&nbsp;prints&nbsp;the&nbsp;corresponding&nbsp;AST,&nbsp;verifies&nbsp;the&nbsp;resulting</span><br>
<span class="lineno"></span><span class="comment" id="8322705">//&nbsp;src&nbsp;is&nbsp;syntactically&nbsp;correct,&nbsp;and&nbsp;returns&nbsp;the&nbsp;resulting&nbsp;src&nbsp;or&nbsp;an&nbsp;error</span><br>
<span class="lineno">40</span><span class="comment" id="8322780">//&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="8322791">func</span>&nbsp;<span class="ident" id="8322796">format</span><span class="op" id="8322802">(</span><span class="ident" id="8322803">src</span>&nbsp;<span class="op" id="8322807">[</span><span class="op" id="8322808">]</span><span class="builtintype" id="8322809">byte</span><span class="op" id="8322813">,</span>&nbsp;<span class="ident" id="8322815">mode</span>&nbsp;<span class="ident" id="8322820">checkMode</span><span class="op" id="8322829">)</span>&nbsp;<span class="op" id="8322831">(</span><span class="op" id="8322832">[</span><span class="op" id="8322833">]</span><span class="builtintype" id="8322834">byte</span><span class="op" id="8322838">,</span>&nbsp;<span class="builtintype" id="8322840">error</span><span class="op" id="8322845">)</span>&nbsp;<span class="op" id="8322847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8322850">//&nbsp;parse&nbsp;src</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8322864">f</span><span class="op" id="8322865">,</span>&nbsp;<span class="ident" id="8322867">err</span>&nbsp;<span class="op" id="8322871">:=</span>&nbsp;<span class="ident" id="8322874">parser</span><span class="op" id="8322880">.</span><span class="ident" id="8322881">ParseFile</span><span class="op" id="8322890">(</span><span class="ident" id="8322891">fset</span><span class="op" id="8322895">,</span>&nbsp;<span class="string" id="8322897">&#34;&#34;</span><span class="op" id="8322899">,</span>&nbsp;<span class="ident" id="8322901">src</span><span class="op" id="8322904">,</span>&nbsp;<span class="ident" id="8322906">parser</span><span class="op" id="8322912">.</span><span class="ident" id="8322913">ParseComments</span><span class="op" id="8322926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8322929">if</span>&nbsp;<span class="ident" id="8322932">err</span>&nbsp;<span class="op" id="8322936">!=</span>&nbsp;<span class="builtintype" id="8322939">nil</span>&nbsp;<span class="op" id="8322943">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8322947">return</span>&nbsp;<span class="builtintype" id="8322954">nil</span><span class="op" id="8322957">,</span>&nbsp;<span class="ident" id="8322959">fmt</span><span class="op" id="8322962">.</span><span class="ident" id="8322963">Errorf</span><span class="op" id="8322969">(</span><span class="string" id="8322970">&#34;parse:&nbsp;%s\n%s&#34;</span><span class="op" id="8322985">,</span>&nbsp;<span class="ident" id="8322987">err</span><span class="op" id="8322990">,</span>&nbsp;<span class="ident" id="8322992">src</span><span class="op" id="8322995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8322998">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8323002">//&nbsp;filter&nbsp;exports&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8323034">if</span>&nbsp;<span class="ident" id="8323037">mode</span><span class="op" id="8323041">&amp;</span><span class="ident" id="8323042">export</span>&nbsp;<span class="op" id="8323049">!=</span>&nbsp;<span class="num" id="8323052">0</span>&nbsp;<span class="op" id="8323054">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8323058">ast</span><span class="op" id="8323061">.</span><span class="ident" id="8323062">FileExports</span><span class="op" id="8323073">(</span><span class="ident" id="8323074">f</span><span class="op" id="8323075">)</span>&nbsp;<span class="comment" id="8323077">//&nbsp;ignore&nbsp;result</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8323096">f</span><span class="op" id="8323097">.</span><span class="ident" id="8323098">Comments</span>&nbsp;<span class="op" id="8323107">=</span>&nbsp;<span class="builtintype" id="8323109">nil</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="8323115">//&nbsp;don&#39;t&nbsp;print&nbsp;comments&nbsp;that&nbsp;are&nbsp;not&nbsp;in&nbsp;AST</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8323160">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8323164">//&nbsp;determine&nbsp;printer&nbsp;configuration</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8323200">cfg</span>&nbsp;<span class="op" id="8323204">:=</span>&nbsp;<span class="ident" id="8323207">Config</span><span class="op" id="8323213">{</span><span class="ident" id="8323214">Tabwidth</span><span class="op" id="8323222">:</span>&nbsp;<span class="ident" id="8323224">tabwidth</span><span class="op" id="8323232">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8323235">if</span>&nbsp;<span class="ident" id="8323238">mode</span><span class="op" id="8323242">&amp;</span><span class="ident" id="8323243">rawFormat</span>&nbsp;<span class="op" id="8323253">!=</span>&nbsp;<span class="num" id="8323256">0</span>&nbsp;<span class="op" id="8323258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8323262">cfg</span><span class="op" id="8323265">.</span><span class="ident" id="8323266">Mode</span>&nbsp;<span class="op" id="8323271">|=</span>&nbsp;<span class="ident" id="8323274">RawFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8323285">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8323289">//&nbsp;print&nbsp;AST</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8323303">var</span>&nbsp;<span class="ident" id="8323307">buf</span>&nbsp;<span class="ident" id="8323311">bytes</span><span class="op" id="8323316">.</span><span class="ident" id="8323317">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8323325">if</span>&nbsp;<span class="ident" id="8323328">err</span>&nbsp;<span class="op" id="8323332">:=</span>&nbsp;<span class="ident" id="8323335">cfg</span><span class="op" id="8323338">.</span><span class="ident" id="8323339">Fprint</span><span class="op" id="8323345">(</span><span class="op" id="8323346">&amp;</span><span class="ident" id="8323347">buf</span><span class="op" id="8323350">,</span>&nbsp;<span class="ident" id="8323352">fset</span><span class="op" id="8323356">,</span>&nbsp;<span class="ident" id="8323358">f</span><span class="op" id="8323359">)</span><span class="op" id="8323360">;</span>&nbsp;<span class="ident" id="8323362">err</span>&nbsp;<span class="op" id="8323366">!=</span>&nbsp;<span class="builtintype" id="8323369">nil</span>&nbsp;<span class="op" id="8323373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8323377">return</span>&nbsp;<span class="builtintype" id="8323384">nil</span><span class="op" id="8323387">,</span>&nbsp;<span class="ident" id="8323389">fmt</span><span class="op" id="8323392">.</span><span class="ident" id="8323393">Errorf</span><span class="op" id="8323399">(</span><span class="string" id="8323400">&#34;print:&nbsp;%s&#34;</span><span class="op" id="8323411">,</span>&nbsp;<span class="ident" id="8323413">err</span><span class="op" id="8323416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8323419">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8323423">//&nbsp;make&nbsp;sure&nbsp;formatted&nbsp;output&nbsp;is&nbsp;syntactically&nbsp;correct</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8323479">res</span>&nbsp;<span class="op" id="8323483">:=</span>&nbsp;<span class="ident" id="8323486">buf</span><span class="op" id="8323489">.</span><span class="ident" id="8323490">Bytes</span><span class="op" id="8323495">(</span><span class="op" id="8323496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8323499">if</span>&nbsp;<span class="ident" id="8323502">_</span><span class="op" id="8323503">,</span>&nbsp;<span class="ident" id="8323505">err</span>&nbsp;<span class="op" id="8323509">:=</span>&nbsp;<span class="ident" id="8323512">parser</span><span class="op" id="8323518">.</span><span class="ident" id="8323519">ParseFile</span><span class="op" id="8323528">(</span><span class="ident" id="8323529">fset</span><span class="op" id="8323533">,</span>&nbsp;<span class="string" id="8323535">&#34;&#34;</span><span class="op" id="8323537">,</span>&nbsp;<span class="ident" id="8323539">res</span><span class="op" id="8323542">,</span>&nbsp;<span class="num" id="8323544">0</span><span class="op" id="8323545">)</span><span class="op" id="8323546">;</span>&nbsp;<span class="ident" id="8323548">err</span>&nbsp;<span class="op" id="8323552">!=</span>&nbsp;<span class="builtintype" id="8323555">nil</span>&nbsp;<span class="op" id="8323559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8323563">return</span>&nbsp;<span class="builtintype" id="8323570">nil</span><span class="op" id="8323573">,</span>&nbsp;<span class="ident" id="8323575">fmt</span><span class="op" id="8323578">.</span><span class="ident" id="8323579">Errorf</span><span class="op" id="8323585">(</span><span class="string" id="8323586">&#34;re-parse:&nbsp;%s\n%s&#34;</span><span class="op" id="8323604">,</span>&nbsp;<span class="ident" id="8323606">err</span><span class="op" id="8323609">,</span>&nbsp;<span class="ident" id="8323611">buf</span><span class="op" id="8323614">.</span><span class="ident" id="8323615">Bytes</span><span class="op" id="8323620">(</span><span class="op" id="8323621">)</span><span class="op" id="8323622">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8323625">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8323629">return</span>&nbsp;<span class="ident" id="8323636">res</span><span class="op" id="8323639">,</span>&nbsp;<span class="builtintype" id="8323641">nil</span><br>
<span class="lineno"></span><span class="op" id="8323645">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="comment" id="8323648">//&nbsp;lineAt&nbsp;returns&nbsp;the&nbsp;line&nbsp;in&nbsp;text&nbsp;starting&nbsp;at&nbsp;offset&nbsp;offs.</span><br>
<span class="lineno"></span><span class="keyword" id="8323708">func</span>&nbsp;<span class="ident" id="8323713">lineAt</span><span class="op" id="8323719">(</span><span class="ident" id="8323720">text</span>&nbsp;<span class="op" id="8323725">[</span><span class="op" id="8323726">]</span><span class="builtintype" id="8323727">byte</span><span class="op" id="8323731">,</span>&nbsp;<span class="ident" id="8323733">offs</span>&nbsp;<span class="builtintype" id="8323738">int</span><span class="op" id="8323741">)</span>&nbsp;<span class="op" id="8323743">[</span><span class="op" id="8323744">]</span><span class="builtintype" id="8323745">byte</span>&nbsp;<span class="op" id="8323750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8323753">i</span>&nbsp;<span class="op" id="8323755">:=</span>&nbsp;<span class="ident" id="8323758">offs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8323764">for</span>&nbsp;<span class="ident" id="8323768">i</span>&nbsp;<span class="op" id="8323770">&lt;</span>&nbsp;<span class="builtinfunc" id="8323772">len</span><span class="op" id="8323775">(</span><span class="ident" id="8323776">text</span><span class="op" id="8323780">)</span>&nbsp;<span class="op" id="8323782">&amp;&amp;</span>&nbsp;<span class="ident" id="8323785">text</span><span class="op" id="8323789">[</span><span class="ident" id="8323790">i</span><span class="op" id="8323791">]</span>&nbsp;<span class="op" id="8323793">!=</span>&nbsp;<span class="string" id="8323796">&#39;\n&#39;</span>&nbsp;<span class="op" id="8323801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8323805">i</span><span class="op" id="8323806">++</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8323810">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8323813">return</span>&nbsp;<span class="ident" id="8323820">text</span><span class="op" id="8323824">[</span><span class="ident" id="8323825">offs</span><span class="op" id="8323829">:</span><span class="ident" id="8323830">i</span><span class="op" id="8323831">]</span><br>
<span class="lineno"></span><span class="op" id="8323833">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8323836">//&nbsp;diff&nbsp;compares&nbsp;a&nbsp;and&nbsp;b.</span><br>
<span class="lineno">85</span><span class="keyword" id="8323862">func</span>&nbsp;<span class="ident" id="8323867">diff</span><span class="op" id="8323871">(</span><span class="ident" id="8323872">aname</span><span class="op" id="8323877">,</span>&nbsp;<span class="ident" id="8323879">bname</span>&nbsp;<span class="builtintype" id="8323885">string</span><span class="op" id="8323891">,</span>&nbsp;<span class="ident" id="8323893">a</span><span class="op" id="8323894">,</span>&nbsp;<span class="ident" id="8323896">b</span>&nbsp;<span class="op" id="8323898">[</span><span class="op" id="8323899">]</span><span class="builtintype" id="8323900">byte</span><span class="op" id="8323904">)</span>&nbsp;<span class="builtintype" id="8323906">error</span>&nbsp;<span class="op" id="8323912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8323915">var</span>&nbsp;<span class="ident" id="8323919">buf</span>&nbsp;<span class="ident" id="8323923">bytes</span><span class="op" id="8323928">.</span><span class="ident" id="8323929">Buffer</span>&nbsp;<span class="comment" id="8323936">//&nbsp;holding&nbsp;long&nbsp;error&nbsp;message</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8323968">//&nbsp;compare&nbsp;lengths</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8323988">if</span>&nbsp;<span class="builtinfunc" id="8323991">len</span><span class="op" id="8323994">(</span><span class="ident" id="8323995">a</span><span class="op" id="8323996">)</span>&nbsp;<span class="op" id="8323998">!=</span>&nbsp;<span class="builtinfunc" id="8324001">len</span><span class="op" id="8324004">(</span><span class="ident" id="8324005">b</span><span class="op" id="8324006">)</span>&nbsp;<span class="op" id="8324008">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8324012">fmt</span><span class="op" id="8324015">.</span><span class="ident" id="8324016">Fprintf</span><span class="op" id="8324023">(</span><span class="op" id="8324024">&amp;</span><span class="ident" id="8324025">buf</span><span class="op" id="8324028">,</span>&nbsp;<span class="string" id="8324030">&#34;\nlength&nbsp;changed:&nbsp;len(%s)&nbsp;=&nbsp;%d,&nbsp;len(%s)&nbsp;=&nbsp;%d&#34;</span><span class="op" id="8324076">,</span>&nbsp;<span class="ident" id="8324078">aname</span><span class="op" id="8324083">,</span>&nbsp;<span class="builtinfunc" id="8324085">len</span><span class="op" id="8324088">(</span><span class="ident" id="8324089">a</span><span class="op" id="8324090">)</span><span class="op" id="8324091">,</span>&nbsp;<span class="ident" id="8324093">bname</span><span class="op" id="8324098">,</span>&nbsp;<span class="builtinfunc" id="8324100">len</span><span class="op" id="8324103">(</span><span class="ident" id="8324104">b</span><span class="op" id="8324105">)</span><span class="op" id="8324106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8324109">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8324113">//&nbsp;compare&nbsp;contents</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8324134">line</span>&nbsp;<span class="op" id="8324139">:=</span>&nbsp;<span class="num" id="8324142">1</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8324145">offs</span>&nbsp;<span class="op" id="8324150">:=</span>&nbsp;<span class="num" id="8324153">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8324156">for</span>&nbsp;<span class="ident" id="8324160">i</span>&nbsp;<span class="op" id="8324162">:=</span>&nbsp;<span class="num" id="8324165">0</span><span class="op" id="8324166">;</span>&nbsp;<span class="ident" id="8324168">i</span>&nbsp;<span class="op" id="8324170">&lt;</span>&nbsp;<span class="builtinfunc" id="8324172">len</span><span class="op" id="8324175">(</span><span class="ident" id="8324176">a</span><span class="op" id="8324177">)</span>&nbsp;<span class="op" id="8324179">&amp;&amp;</span>&nbsp;<span class="ident" id="8324182">i</span>&nbsp;<span class="op" id="8324184">&lt;</span>&nbsp;<span class="builtinfunc" id="8324186">len</span><span class="op" id="8324189">(</span><span class="ident" id="8324190">b</span><span class="op" id="8324191">)</span><span class="op" id="8324192">;</span>&nbsp;<span class="ident" id="8324194">i</span><span class="op" id="8324195">++</span>&nbsp;<span class="op" id="8324198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8324202">ch</span>&nbsp;<span class="op" id="8324205">:=</span>&nbsp;<span class="ident" id="8324208">a</span><span class="op" id="8324209">[</span><span class="ident" id="8324210">i</span><span class="op" id="8324211">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8324215">if</span>&nbsp;<span class="ident" id="8324218">ch</span>&nbsp;<span class="op" id="8324221">!=</span>&nbsp;<span class="ident" id="8324224">b</span><span class="op" id="8324225">[</span><span class="ident" id="8324226">i</span><span class="op" id="8324227">]</span>&nbsp;<span class="op" id="8324229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8324234">fmt</span><span class="op" id="8324237">.</span><span class="ident" id="8324238">Fprintf</span><span class="op" id="8324245">(</span><span class="op" id="8324246">&amp;</span><span class="ident" id="8324247">buf</span><span class="op" id="8324250">,</span>&nbsp;<span class="string" id="8324252">&#34;\n%s:%d:%d:&nbsp;%s&#34;</span><span class="op" id="8324268">,</span>&nbsp;<span class="ident" id="8324270">aname</span><span class="op" id="8324275">,</span>&nbsp;<span class="ident" id="8324277">line</span><span class="op" id="8324281">,</span>&nbsp;<span class="ident" id="8324283">i</span><span class="op" id="8324284">-</span><span class="ident" id="8324285">offs</span><span class="op" id="8324289">+</span><span class="num" id="8324290">1</span><span class="op" id="8324291">,</span>&nbsp;<span class="ident" id="8324293">lineAt</span><span class="op" id="8324299">(</span><span class="ident" id="8324300">a</span><span class="op" id="8324301">,</span>&nbsp;<span class="ident" id="8324303">offs</span><span class="op" id="8324307">)</span><span class="op" id="8324308">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8324313">fmt</span><span class="op" id="8324316">.</span><span class="ident" id="8324317">Fprintf</span><span class="op" id="8324324">(</span><span class="op" id="8324325">&amp;</span><span class="ident" id="8324326">buf</span><span class="op" id="8324329">,</span>&nbsp;<span class="string" id="8324331">&#34;\n%s:%d:%d:&nbsp;%s&#34;</span><span class="op" id="8324347">,</span>&nbsp;<span class="ident" id="8324349">bname</span><span class="op" id="8324354">,</span>&nbsp;<span class="ident" id="8324356">line</span><span class="op" id="8324360">,</span>&nbsp;<span class="ident" id="8324362">i</span><span class="op" id="8324363">-</span><span class="ident" id="8324364">offs</span><span class="op" id="8324368">+</span><span class="num" id="8324369">1</span><span class="op" id="8324370">,</span>&nbsp;<span class="ident" id="8324372">lineAt</span><span class="op" id="8324378">(</span><span class="ident" id="8324379">b</span><span class="op" id="8324380">,</span>&nbsp;<span class="ident" id="8324382">offs</span><span class="op" id="8324386">)</span><span class="op" id="8324387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8324392">fmt</span><span class="op" id="8324395">.</span><span class="ident" id="8324396">Fprintf</span><span class="op" id="8324403">(</span><span class="op" id="8324404">&amp;</span><span class="ident" id="8324405">buf</span><span class="op" id="8324408">,</span>&nbsp;<span class="string" id="8324410">&#34;\n\n&#34;</span><span class="op" id="8324416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8324421">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8324429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8324433">if</span>&nbsp;<span class="ident" id="8324436">ch</span>&nbsp;<span class="op" id="8324439">==</span>&nbsp;<span class="string" id="8324442">&#39;\n&#39;</span>&nbsp;<span class="op" id="8324447">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8324452">line</span><span class="op" id="8324456">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8324462">offs</span>&nbsp;<span class="op" id="8324467">=</span>&nbsp;<span class="ident" id="8324469">i</span>&nbsp;<span class="op" id="8324471">+</span>&nbsp;<span class="num" id="8324473">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8324477">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8324480">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8324484">if</span>&nbsp;<span class="ident" id="8324487">buf</span><span class="op" id="8324490">.</span><span class="ident" id="8324491">Len</span><span class="op" id="8324494">(</span><span class="op" id="8324495">)</span>&nbsp;<span class="op" id="8324497">&gt;</span>&nbsp;<span class="num" id="8324499">0</span>&nbsp;<span class="op" id="8324501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8324505">return</span>&nbsp;<span class="ident" id="8324512">errors</span><span class="op" id="8324518">.</span><span class="ident" id="8324519">New</span><span class="op" id="8324522">(</span><span class="ident" id="8324523">buf</span><span class="op" id="8324526">.</span><span class="ident" id="8324527">String</span><span class="op" id="8324533">(</span><span class="op" id="8324534">)</span><span class="op" id="8324535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8324538">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8324541">return</span>&nbsp;<span class="builtintype" id="8324548">nil</span><br>
<span class="lineno"></span><span class="op" id="8324552">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="keyword" id="8324555">func</span>&nbsp;<span class="ident" id="8324560">runcheck</span><span class="op" id="8324568">(</span><span class="ident" id="8324569">t</span>&nbsp;<span class="op" id="8324571">*</span><span class="ident" id="8324572">testing</span><span class="op" id="8324579">.</span><span class="ident" id="8324580">T</span><span class="op" id="8324581">,</span>&nbsp;<span class="ident" id="8324583">source</span><span class="op" id="8324589">,</span>&nbsp;<span class="ident" id="8324591">golden</span>&nbsp;<span class="builtintype" id="8324598">string</span><span class="op" id="8324604">,</span>&nbsp;<span class="ident" id="8324606">mode</span>&nbsp;<span class="ident" id="8324611">checkMode</span><span class="op" id="8324620">)</span>&nbsp;<span class="op" id="8324622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8324625">src</span><span class="op" id="8324628">,</span>&nbsp;<span class="ident" id="8324630">err</span>&nbsp;<span class="op" id="8324634">:=</span>&nbsp;<span class="ident" id="8324637">ioutil</span><span class="op" id="8324643">.</span><span class="ident" id="8324644">ReadFile</span><span class="op" id="8324652">(</span><span class="ident" id="8324653">source</span><span class="op" id="8324659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8324662">if</span>&nbsp;<span class="ident" id="8324665">err</span>&nbsp;<span class="op" id="8324669">!=</span>&nbsp;<span class="builtintype" id="8324672">nil</span>&nbsp;<span class="op" id="8324676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8324680">t</span><span class="op" id="8324681">.</span><span class="ident" id="8324682">Error</span><span class="op" id="8324687">(</span><span class="ident" id="8324688">err</span><span class="op" id="8324691">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8324695">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8324703">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8324707">res</span><span class="op" id="8324710">,</span>&nbsp;<span class="ident" id="8324712">err</span>&nbsp;<span class="op" id="8324716">:=</span>&nbsp;<span class="ident" id="8324719">format</span><span class="op" id="8324725">(</span><span class="ident" id="8324726">src</span><span class="op" id="8324729">,</span>&nbsp;<span class="ident" id="8324731">mode</span><span class="op" id="8324735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8324738">if</span>&nbsp;<span class="ident" id="8324741">err</span>&nbsp;<span class="op" id="8324745">!=</span>&nbsp;<span class="builtintype" id="8324748">nil</span>&nbsp;<span class="op" id="8324752">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8324756">t</span><span class="op" id="8324757">.</span><span class="ident" id="8324758">Error</span><span class="op" id="8324763">(</span><span class="ident" id="8324764">err</span><span class="op" id="8324767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8324771">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8324779">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8324783">//&nbsp;update&nbsp;golden&nbsp;files&nbsp;if&nbsp;necessary</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8324820">if</span>&nbsp;<span class="op" id="8324823">*</span><span class="ident" id="8324824">update</span>&nbsp;<span class="op" id="8324831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8324835">if</span>&nbsp;<span class="ident" id="8324838">err</span>&nbsp;<span class="op" id="8324842">:=</span>&nbsp;<span class="ident" id="8324845">ioutil</span><span class="op" id="8324851">.</span><span class="ident" id="8324852">WriteFile</span><span class="op" id="8324861">(</span><span class="ident" id="8324862">golden</span><span class="op" id="8324868">,</span>&nbsp;<span class="ident" id="8324870">res</span><span class="op" id="8324873">,</span>&nbsp;<span class="num" id="8324875">0644</span><span class="op" id="8324879">)</span><span class="op" id="8324880">;</span>&nbsp;<span class="ident" id="8324882">err</span>&nbsp;<span class="op" id="8324886">!=</span>&nbsp;<span class="builtintype" id="8324889">nil</span>&nbsp;<span class="op" id="8324893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8324898">t</span><span class="op" id="8324899">.</span><span class="ident" id="8324900">Error</span><span class="op" id="8324905">(</span><span class="ident" id="8324906">err</span><span class="op" id="8324909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8324913">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8324917">return</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8324925">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8324929">//&nbsp;get&nbsp;golden</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8324944">gld</span><span class="op" id="8324947">,</span>&nbsp;<span class="ident" id="8324949">err</span>&nbsp;<span class="op" id="8324953">:=</span>&nbsp;<span class="ident" id="8324956">ioutil</span><span class="op" id="8324962">.</span><span class="ident" id="8324963">ReadFile</span><span class="op" id="8324971">(</span><span class="ident" id="8324972">golden</span><span class="op" id="8324978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8324981">if</span>&nbsp;<span class="ident" id="8324984">err</span>&nbsp;<span class="op" id="8324988">!=</span>&nbsp;<span class="builtintype" id="8324991">nil</span>&nbsp;<span class="op" id="8324995">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8324999">t</span><span class="op" id="8325000">.</span><span class="ident" id="8325001">Error</span><span class="op" id="8325006">(</span><span class="ident" id="8325007">err</span><span class="op" id="8325010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8325014">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8325022">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8325026">//&nbsp;formatted&nbsp;source&nbsp;and&nbsp;golden&nbsp;must&nbsp;be&nbsp;the&nbsp;same</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8325075">if</span>&nbsp;<span class="ident" id="8325078">err</span>&nbsp;<span class="op" id="8325082">:=</span>&nbsp;<span class="ident" id="8325085">diff</span><span class="op" id="8325089">(</span><span class="ident" id="8325090">source</span><span class="op" id="8325096">,</span>&nbsp;<span class="ident" id="8325098">golden</span><span class="op" id="8325104">,</span>&nbsp;<span class="ident" id="8325106">res</span><span class="op" id="8325109">,</span>&nbsp;<span class="ident" id="8325111">gld</span><span class="op" id="8325114">)</span><span class="op" id="8325115">;</span>&nbsp;<span class="ident" id="8325117">err</span>&nbsp;<span class="op" id="8325121">!=</span>&nbsp;<span class="builtintype" id="8325124">nil</span>&nbsp;<span class="op" id="8325128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8325132">t</span><span class="op" id="8325133">.</span><span class="ident" id="8325134">Error</span><span class="op" id="8325139">(</span><span class="ident" id="8325140">err</span><span class="op" id="8325143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8325147">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8325155">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8325159">if</span>&nbsp;<span class="ident" id="8325162">mode</span><span class="op" id="8325166">&amp;</span><span class="ident" id="8325167">idempotent</span>&nbsp;<span class="op" id="8325178">!=</span>&nbsp;<span class="num" id="8325181">0</span>&nbsp;<span class="op" id="8325183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8325187">//&nbsp;formatting&nbsp;golden&nbsp;must&nbsp;be&nbsp;idempotent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8325229">//&nbsp;(This&nbsp;is&nbsp;very&nbsp;difficult&nbsp;to&nbsp;achieve&nbsp;in&nbsp;general&nbsp;and&nbsp;for&nbsp;now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8325292">//&nbsp;it&nbsp;is&nbsp;only&nbsp;checked&nbsp;for&nbsp;files&nbsp;explicitly&nbsp;marked&nbsp;as&nbsp;such.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8325354">res</span><span class="op" id="8325357">,</span>&nbsp;<span class="ident" id="8325359">err</span>&nbsp;<span class="op" id="8325363">=</span>&nbsp;<span class="ident" id="8325365">format</span><span class="op" id="8325371">(</span><span class="ident" id="8325372">gld</span><span class="op" id="8325375">,</span>&nbsp;<span class="ident" id="8325377">mode</span><span class="op" id="8325381">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8325385">if</span>&nbsp;<span class="ident" id="8325388">err</span>&nbsp;<span class="op" id="8325392">:=</span>&nbsp;<span class="ident" id="8325395">diff</span><span class="op" id="8325399">(</span><span class="ident" id="8325400">golden</span><span class="op" id="8325406">,</span>&nbsp;<span class="ident" id="8325408">fmt</span><span class="op" id="8325411">.</span><span class="ident" id="8325412">Sprintf</span><span class="op" id="8325419">(</span><span class="string" id="8325420">&#34;format(%s)&#34;</span><span class="op" id="8325432">,</span>&nbsp;<span class="ident" id="8325434">golden</span><span class="op" id="8325440">)</span><span class="op" id="8325441">,</span>&nbsp;<span class="ident" id="8325443">gld</span><span class="op" id="8325446">,</span>&nbsp;<span class="ident" id="8325448">res</span><span class="op" id="8325451">)</span><span class="op" id="8325452">;</span>&nbsp;<span class="ident" id="8325454">err</span>&nbsp;<span class="op" id="8325458">!=</span>&nbsp;<span class="builtintype" id="8325461">nil</span>&nbsp;<span class="op" id="8325465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8325470">t</span><span class="op" id="8325471">.</span><span class="ident" id="8325472">Errorf</span><span class="op" id="8325478">(</span><span class="string" id="8325479">&#34;golden&nbsp;is&nbsp;not&nbsp;idempotent:&nbsp;%s&#34;</span><span class="op" id="8325509">,</span>&nbsp;<span class="ident" id="8325511">err</span><span class="op" id="8325514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8325518">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8325521">}</span><br>
<span class="lineno"></span><span class="op" id="8325523">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span><span class="keyword" id="8325526">func</span>&nbsp;<span class="ident" id="8325531">check</span><span class="op" id="8325536">(</span><span class="ident" id="8325537">t</span>&nbsp;<span class="op" id="8325539">*</span><span class="ident" id="8325540">testing</span><span class="op" id="8325547">.</span><span class="ident" id="8325548">T</span><span class="op" id="8325549">,</span>&nbsp;<span class="ident" id="8325551">source</span><span class="op" id="8325557">,</span>&nbsp;<span class="ident" id="8325559">golden</span>&nbsp;<span class="builtintype" id="8325566">string</span><span class="op" id="8325572">,</span>&nbsp;<span class="ident" id="8325574">mode</span>&nbsp;<span class="ident" id="8325579">checkMode</span><span class="op" id="8325588">)</span>&nbsp;<span class="op" id="8325590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8325593">//&nbsp;run&nbsp;the&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8325610">cc</span>&nbsp;<span class="op" id="8325613">:=</span>&nbsp;<span class="builtinfunc" id="8325616">make</span><span class="op" id="8325620">(</span><span class="keyword" id="8325621">chan</span>&nbsp;<span class="builtintype" id="8325626">int</span><span class="op" id="8325629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8325632">go</span>&nbsp;<span class="keyword" id="8325635">func</span><span class="op" id="8325639">(</span><span class="op" id="8325640">)</span>&nbsp;<span class="op" id="8325642">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8325646">runcheck</span><span class="op" id="8325654">(</span><span class="ident" id="8325655">t</span><span class="op" id="8325656">,</span>&nbsp;<span class="ident" id="8325658">source</span><span class="op" id="8325664">,</span>&nbsp;<span class="ident" id="8325666">golden</span><span class="op" id="8325672">,</span>&nbsp;<span class="ident" id="8325674">mode</span><span class="op" id="8325678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8325682">cc</span>&nbsp;<span class="op" id="8325685">&lt;-</span>&nbsp;<span class="num" id="8325688">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8325691">}</span><span class="op" id="8325692">(</span><span class="op" id="8325693">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8325697">//&nbsp;wait&nbsp;with&nbsp;timeout</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8325719">select</span>&nbsp;<span class="op" id="8325726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8325729">case</span>&nbsp;<span class="op" id="8325734">&lt;-</span><span class="ident" id="8325736">time</span><span class="op" id="8325740">.</span><span class="ident" id="8325741">After</span><span class="op" id="8325746">(</span><span class="num" id="8325747">10</span>&nbsp;<span class="op" id="8325750">*</span>&nbsp;<span class="ident" id="8325752">time</span><span class="op" id="8325756">.</span><span class="ident" id="8325757">Second</span><span class="op" id="8325763">)</span><span class="op" id="8325764">:</span>&nbsp;<span class="comment" id="8325766">//&nbsp;plenty&nbsp;of&nbsp;a&nbsp;safety&nbsp;margin,&nbsp;even&nbsp;for&nbsp;very&nbsp;slow&nbsp;machines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8325826">//&nbsp;test&nbsp;running&nbsp;past&nbsp;time&nbsp;out</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8325858">t</span><span class="op" id="8325859">.</span><span class="ident" id="8325860">Errorf</span><span class="op" id="8325866">(</span><span class="string" id="8325867">&#34;%s:&nbsp;running&nbsp;too&nbsp;slowly&#34;</span><span class="op" id="8325891">,</span>&nbsp;<span class="ident" id="8325893">source</span><span class="op" id="8325899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8325902">case</span>&nbsp;<span class="op" id="8325907">&lt;-</span><span class="ident" id="8325909">cc</span><span class="op" id="8325911">:</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8325915">//&nbsp;test&nbsp;finished&nbsp;within&nbsp;allotted&nbsp;time&nbsp;margin</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8325961">}</span><br>
<span class="lineno"></span><span class="op" id="8325963">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8325966">type</span>&nbsp;<span class="ident" id="8325971">entry</span>&nbsp;<span class="keyword" id="8325977">struct</span>&nbsp;<span class="op" id="8325984">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8325987">source</span><span class="op" id="8325993">,</span>&nbsp;<span class="ident" id="8325995">golden</span>&nbsp;<span class="builtintype" id="8326002">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8326010">mode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8326025">checkMode</span><br>
<span class="lineno"></span><span class="op" id="8326035">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8326038">//&nbsp;Use&nbsp;go&nbsp;test&nbsp;-update&nbsp;to&nbsp;create/update&nbsp;the&nbsp;respective&nbsp;golden&nbsp;files.</span><br>
<span class="lineno">185</span><span class="keyword" id="8326107">var</span>&nbsp;<span class="ident" id="8326111">data</span>&nbsp;<span class="op" id="8326116">=</span>&nbsp;<span class="op" id="8326118">[</span><span class="op" id="8326119">]</span><span class="ident" id="8326120">entry</span><span class="op" id="8326125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8326128">{</span><span class="string" id="8326129">&#34;empty.input&#34;</span><span class="op" id="8326142">,</span>&nbsp;<span class="string" id="8326144">&#34;empty.golden&#34;</span><span class="op" id="8326158">,</span>&nbsp;<span class="ident" id="8326160">idempotent</span><span class="op" id="8326170">}</span><span class="op" id="8326171">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8326174">{</span><span class="string" id="8326175">&#34;comments.input&#34;</span><span class="op" id="8326191">,</span>&nbsp;<span class="string" id="8326193">&#34;comments.golden&#34;</span><span class="op" id="8326210">,</span>&nbsp;<span class="num" id="8326212">0</span><span class="op" id="8326213">}</span><span class="op" id="8326214">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8326217">{</span><span class="string" id="8326218">&#34;comments.input&#34;</span><span class="op" id="8326234">,</span>&nbsp;<span class="string" id="8326236">&#34;comments.x&#34;</span><span class="op" id="8326248">,</span>&nbsp;<span class="ident" id="8326250">export</span><span class="op" id="8326256">}</span><span class="op" id="8326257">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8326260">{</span><span class="string" id="8326261">&#34;comments2.input&#34;</span><span class="op" id="8326278">,</span>&nbsp;<span class="string" id="8326280">&#34;comments2.golden&#34;</span><span class="op" id="8326298">,</span>&nbsp;<span class="ident" id="8326300">idempotent</span><span class="op" id="8326310">}</span><span class="op" id="8326311">,</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8326314">{</span><span class="string" id="8326315">&#34;linebreaks.input&#34;</span><span class="op" id="8326333">,</span>&nbsp;<span class="string" id="8326335">&#34;linebreaks.golden&#34;</span><span class="op" id="8326354">,</span>&nbsp;<span class="ident" id="8326356">idempotent</span><span class="op" id="8326366">}</span><span class="op" id="8326367">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8326370">{</span><span class="string" id="8326371">&#34;expressions.input&#34;</span><span class="op" id="8326390">,</span>&nbsp;<span class="string" id="8326392">&#34;expressions.golden&#34;</span><span class="op" id="8326412">,</span>&nbsp;<span class="ident" id="8326414">idempotent</span><span class="op" id="8326424">}</span><span class="op" id="8326425">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8326428">{</span><span class="string" id="8326429">&#34;expressions.input&#34;</span><span class="op" id="8326448">,</span>&nbsp;<span class="string" id="8326450">&#34;expressions.raw&#34;</span><span class="op" id="8326467">,</span>&nbsp;<span class="ident" id="8326469">rawFormat</span>&nbsp;<span class="op" id="8326479">|</span>&nbsp;<span class="ident" id="8326481">idempotent</span><span class="op" id="8326491">}</span><span class="op" id="8326492">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8326495">{</span><span class="string" id="8326496">&#34;declarations.input&#34;</span><span class="op" id="8326516">,</span>&nbsp;<span class="string" id="8326518">&#34;declarations.golden&#34;</span><span class="op" id="8326539">,</span>&nbsp;<span class="num" id="8326541">0</span><span class="op" id="8326542">}</span><span class="op" id="8326543">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8326546">{</span><span class="string" id="8326547">&#34;statements.input&#34;</span><span class="op" id="8326565">,</span>&nbsp;<span class="string" id="8326567">&#34;statements.golden&#34;</span><span class="op" id="8326586">,</span>&nbsp;<span class="num" id="8326588">0</span><span class="op" id="8326589">}</span><span class="op" id="8326590">,</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8326593">{</span><span class="string" id="8326594">&#34;slow.input&#34;</span><span class="op" id="8326606">,</span>&nbsp;<span class="string" id="8326608">&#34;slow.golden&#34;</span><span class="op" id="8326621">,</span>&nbsp;<span class="ident" id="8326623">idempotent</span><span class="op" id="8326633">}</span><span class="op" id="8326634">,</span><br>
<span class="lineno"></span><span class="op" id="8326636">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8326639">func</span>&nbsp;<span class="ident" id="8326644">TestFiles</span><span class="op" id="8326653">(</span><span class="ident" id="8326654">t</span>&nbsp;<span class="op" id="8326656">*</span><span class="ident" id="8326657">testing</span><span class="op" id="8326664">.</span><span class="ident" id="8326665">T</span><span class="op" id="8326666">)</span>&nbsp;<span class="op" id="8326668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8326671">for</span>&nbsp;<span class="ident" id="8326675">_</span><span class="op" id="8326676">,</span>&nbsp;<span class="ident" id="8326678">e</span>&nbsp;<span class="op" id="8326680">:=</span>&nbsp;<span class="keyword" id="8326683">range</span>&nbsp;<span class="ident" id="8326689">data</span>&nbsp;<span class="op" id="8326694">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8326698">source</span>&nbsp;<span class="op" id="8326705">:=</span>&nbsp;<span class="ident" id="8326708">filepath</span><span class="op" id="8326716">.</span><span class="ident" id="8326717">Join</span><span class="op" id="8326721">(</span><span class="ident" id="8326722">dataDir</span><span class="op" id="8326729">,</span>&nbsp;<span class="ident" id="8326731">e</span><span class="op" id="8326732">.</span><span class="ident" id="8326733">source</span><span class="op" id="8326739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8326743">golden</span>&nbsp;<span class="op" id="8326750">:=</span>&nbsp;<span class="ident" id="8326753">filepath</span><span class="op" id="8326761">.</span><span class="ident" id="8326762">Join</span><span class="op" id="8326766">(</span><span class="ident" id="8326767">dataDir</span><span class="op" id="8326774">,</span>&nbsp;<span class="ident" id="8326776">e</span><span class="op" id="8326777">.</span><span class="ident" id="8326778">golden</span><span class="op" id="8326784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8326788">check</span><span class="op" id="8326793">(</span><span class="ident" id="8326794">t</span><span class="op" id="8326795">,</span>&nbsp;<span class="ident" id="8326797">source</span><span class="op" id="8326803">,</span>&nbsp;<span class="ident" id="8326805">golden</span><span class="op" id="8326811">,</span>&nbsp;<span class="ident" id="8326813">e</span><span class="op" id="8326814">.</span><span class="ident" id="8326815">mode</span><span class="op" id="8326819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8326823">//&nbsp;TODO(gri)&nbsp;check&nbsp;that&nbsp;golden&nbsp;is&nbsp;idempotent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8326870">//check(t,&nbsp;golden,&nbsp;golden,&nbsp;e.mode)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8326906">}</span><br>
<span class="lineno"></span><span class="op" id="8326908">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8326911">//&nbsp;TestLineComments,&nbsp;using&nbsp;a&nbsp;simple&nbsp;test&nbsp;case,&nbsp;checks&nbsp;that&nbsp;consecutive&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="8326987">//&nbsp;comments&nbsp;are&nbsp;properly&nbsp;terminated&nbsp;with&nbsp;a&nbsp;newline&nbsp;even&nbsp;if&nbsp;the&nbsp;AST&nbsp;position</span><br>
<span class="lineno">210</span><span class="comment" id="8327063">//&nbsp;information&nbsp;is&nbsp;incorrect.</span><br>
<span class="lineno"></span><span class="comment" id="8327092">//</span><br>
<span class="lineno"></span><span class="keyword" id="8327095">func</span>&nbsp;<span class="ident" id="8327100">TestLineComments</span><span class="op" id="8327116">(</span><span class="ident" id="8327117">t</span>&nbsp;<span class="op" id="8327119">*</span><span class="ident" id="8327120">testing</span><span class="op" id="8327127">.</span><span class="ident" id="8327128">T</span><span class="op" id="8327129">)</span>&nbsp;<span class="op" id="8327131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8327134">const</span>&nbsp;<span class="ident" id="8327140">src</span>&nbsp;<span class="op" id="8327144">=</span>&nbsp;<span class="string" id="8327146">`//&nbsp;comment&nbsp;1<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;comment&nbsp;2<br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;comment&nbsp;3<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;package&nbsp;main<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8327207">fset</span>&nbsp;<span class="op" id="8327212">:=</span>&nbsp;<span class="ident" id="8327215">token</span><span class="op" id="8327220">.</span><span class="ident" id="8327221">NewFileSet</span><span class="op" id="8327231">(</span><span class="op" id="8327232">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8327235">f</span><span class="op" id="8327236">,</span>&nbsp;<span class="ident" id="8327238">err</span>&nbsp;<span class="op" id="8327242">:=</span>&nbsp;<span class="ident" id="8327245">parser</span><span class="op" id="8327251">.</span><span class="ident" id="8327252">ParseFile</span><span class="op" id="8327261">(</span><span class="ident" id="8327262">fset</span><span class="op" id="8327266">,</span>&nbsp;<span class="string" id="8327268">&#34;&#34;</span><span class="op" id="8327270">,</span>&nbsp;<span class="ident" id="8327272">src</span><span class="op" id="8327275">,</span>&nbsp;<span class="ident" id="8327277">parser</span><span class="op" id="8327283">.</span><span class="ident" id="8327284">ParseComments</span><span class="op" id="8327297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8327300">if</span>&nbsp;<span class="ident" id="8327303">err</span>&nbsp;<span class="op" id="8327307">!=</span>&nbsp;<span class="builtintype" id="8327310">nil</span>&nbsp;<span class="op" id="8327314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="8327318">panic</span><span class="op" id="8327323">(</span><span class="ident" id="8327324">err</span><span class="op" id="8327327">)</span>&nbsp;<span class="comment" id="8327329">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8327347">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8327351">var</span>&nbsp;<span class="ident" id="8327355">buf</span>&nbsp;<span class="ident" id="8327359">bytes</span><span class="op" id="8327364">.</span><span class="ident" id="8327365">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8327373">fset</span>&nbsp;<span class="op" id="8327378">=</span>&nbsp;<span class="ident" id="8327380">token</span><span class="op" id="8327385">.</span><span class="ident" id="8327386">NewFileSet</span><span class="op" id="8327396">(</span><span class="op" id="8327397">)</span>&nbsp;<span class="comment" id="8327399">//&nbsp;use&nbsp;the&nbsp;wrong&nbsp;file&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8327426">Fprint</span><span class="op" id="8327432">(</span><span class="op" id="8327433">&amp;</span><span class="ident" id="8327434">buf</span><span class="op" id="8327437">,</span>&nbsp;<span class="ident" id="8327439">fset</span><span class="op" id="8327443">,</span>&nbsp;<span class="ident" id="8327445">f</span><span class="op" id="8327446">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8327450">nlines</span>&nbsp;<span class="op" id="8327457">:=</span>&nbsp;<span class="num" id="8327460">0</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8327463">for</span>&nbsp;<span class="ident" id="8327467">_</span><span class="op" id="8327468">,</span>&nbsp;<span class="ident" id="8327470">ch</span>&nbsp;<span class="op" id="8327473">:=</span>&nbsp;<span class="keyword" id="8327476">range</span>&nbsp;<span class="ident" id="8327482">buf</span><span class="op" id="8327485">.</span><span class="ident" id="8327486">Bytes</span><span class="op" id="8327491">(</span><span class="op" id="8327492">)</span>&nbsp;<span class="op" id="8327494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8327498">if</span>&nbsp;<span class="ident" id="8327501">ch</span>&nbsp;<span class="op" id="8327504">==</span>&nbsp;<span class="string" id="8327507">&#39;\n&#39;</span>&nbsp;<span class="op" id="8327512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8327517">nlines</span><span class="op" id="8327523">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8327528">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8327531">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8327535">const</span>&nbsp;<span class="ident" id="8327541">expected</span>&nbsp;<span class="op" id="8327550">=</span>&nbsp;<span class="num" id="8327552">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8327555">if</span>&nbsp;<span class="ident" id="8327558">nlines</span>&nbsp;<span class="op" id="8327565">&lt;</span>&nbsp;<span class="ident" id="8327567">expected</span>&nbsp;<span class="op" id="8327576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8327580">t</span><span class="op" id="8327581">.</span><span class="ident" id="8327582">Errorf</span><span class="op" id="8327588">(</span><span class="string" id="8327589">&#34;got&nbsp;%d,&nbsp;expected&nbsp;%d\n&#34;</span><span class="op" id="8327612">,</span>&nbsp;<span class="ident" id="8327614">nlines</span><span class="op" id="8327620">,</span>&nbsp;<span class="ident" id="8327622">expected</span><span class="op" id="8327630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8327634">t</span><span class="op" id="8327635">.</span><span class="ident" id="8327636">Errorf</span><span class="op" id="8327642">(</span><span class="string" id="8327643">&#34;result:\n%s&#34;</span><span class="op" id="8327656">,</span>&nbsp;<span class="ident" id="8327658">buf</span><span class="op" id="8327661">.</span><span class="ident" id="8327662">Bytes</span><span class="op" id="8327667">(</span><span class="op" id="8327668">)</span><span class="op" id="8327669">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8327672">}</span><br>
<span class="lineno"></span><span class="op" id="8327674">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8327677">//&nbsp;Verify&nbsp;that&nbsp;the&nbsp;printer&nbsp;can&nbsp;be&nbsp;invoked&nbsp;during&nbsp;initialization.</span><br>
<span class="lineno"></span><span class="keyword" id="8327742">func</span>&nbsp;<span class="ident" id="8327747">init</span><span class="op" id="8327751">(</span><span class="op" id="8327752">)</span>&nbsp;<span class="op" id="8327754">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8327757">const</span>&nbsp;<span class="ident" id="8327763">name</span>&nbsp;<span class="op" id="8327768">=</span>&nbsp;<span class="string" id="8327770">&#34;foobar&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8327780">var</span>&nbsp;<span class="ident" id="8327784">buf</span>&nbsp;<span class="ident" id="8327788">bytes</span><span class="op" id="8327793">.</span><span class="ident" id="8327794">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8327802">if</span>&nbsp;<span class="ident" id="8327805">err</span>&nbsp;<span class="op" id="8327809">:=</span>&nbsp;<span class="ident" id="8327812">Fprint</span><span class="op" id="8327818">(</span><span class="op" id="8327819">&amp;</span><span class="ident" id="8327820">buf</span><span class="op" id="8327823">,</span>&nbsp;<span class="ident" id="8327825">fset</span><span class="op" id="8327829">,</span>&nbsp;<span class="op" id="8327831">&amp;</span><span class="ident" id="8327832">ast</span><span class="op" id="8327835">.</span><span class="ident" id="8327836">Ident</span><span class="op" id="8327841">{</span><span class="ident" id="8327842">Name</span><span class="op" id="8327846">:</span>&nbsp;<span class="ident" id="8327848">name</span><span class="op" id="8327852">}</span><span class="op" id="8327853">)</span><span class="op" id="8327854">;</span>&nbsp;<span class="ident" id="8327856">err</span>&nbsp;<span class="op" id="8327860">!=</span>&nbsp;<span class="builtintype" id="8327863">nil</span>&nbsp;<span class="op" id="8327867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="8327871">panic</span><span class="op" id="8327876">(</span><span class="ident" id="8327877">err</span><span class="op" id="8327880">)</span>&nbsp;<span class="comment" id="8327882">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8327900">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8327903">//&nbsp;in&nbsp;debug&nbsp;mode,&nbsp;the&nbsp;result&nbsp;contains&nbsp;additional&nbsp;information;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8327966">//&nbsp;ignore&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8327980">if</span>&nbsp;<span class="ident" id="8327983">s</span>&nbsp;<span class="op" id="8327985">:=</span>&nbsp;<span class="ident" id="8327988">buf</span><span class="op" id="8327991">.</span><span class="ident" id="8327992">String</span><span class="op" id="8327998">(</span><span class="op" id="8327999">)</span><span class="op" id="8328000">;</span>&nbsp;<span class="op" id="8328002">!</span><span class="ident" id="8328003">debug</span>&nbsp;<span class="op" id="8328009">&amp;&amp;</span>&nbsp;<span class="ident" id="8328012">s</span>&nbsp;<span class="op" id="8328014">!=</span>&nbsp;<span class="ident" id="8328017">name</span>&nbsp;<span class="op" id="8328022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="8328026">panic</span><span class="op" id="8328031">(</span><span class="string" id="8328032">&#34;got&nbsp;&#34;</span>&nbsp;<span class="op" id="8328039">+</span>&nbsp;<span class="ident" id="8328041">s</span>&nbsp;<span class="op" id="8328043">+</span>&nbsp;<span class="string" id="8328045">&#34;,&nbsp;want&nbsp;&#34;</span>&nbsp;<span class="op" id="8328055">+</span>&nbsp;<span class="ident" id="8328057">name</span><span class="op" id="8328061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8328064">}</span><br>
<span class="lineno">255</span><span class="op" id="8328066">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8328069">//&nbsp;Verify&nbsp;that&nbsp;the&nbsp;printer&nbsp;doesn&#39;t&nbsp;crash&nbsp;if&nbsp;the&nbsp;AST&nbsp;contains&nbsp;BadXXX&nbsp;nodes.</span><br>
<span class="lineno"></span><span class="keyword" id="8328144">func</span>&nbsp;<span class="ident" id="8328149">TestBadNodes</span><span class="op" id="8328161">(</span><span class="ident" id="8328162">t</span>&nbsp;<span class="op" id="8328164">*</span><span class="ident" id="8328165">testing</span><span class="op" id="8328172">.</span><span class="ident" id="8328173">T</span><span class="op" id="8328174">)</span>&nbsp;<span class="op" id="8328176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8328179">const</span>&nbsp;<span class="ident" id="8328185">src</span>&nbsp;<span class="op" id="8328189">=</span>&nbsp;<span class="string" id="8328191">&#34;package&nbsp;p\n(&#34;</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8328207">const</span>&nbsp;<span class="ident" id="8328213">res</span>&nbsp;<span class="op" id="8328217">=</span>&nbsp;<span class="string" id="8328219">&#34;package&nbsp;p\nBadDecl\n&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8328243">f</span><span class="op" id="8328244">,</span>&nbsp;<span class="ident" id="8328246">err</span>&nbsp;<span class="op" id="8328250">:=</span>&nbsp;<span class="ident" id="8328253">parser</span><span class="op" id="8328259">.</span><span class="ident" id="8328260">ParseFile</span><span class="op" id="8328269">(</span><span class="ident" id="8328270">fset</span><span class="op" id="8328274">,</span>&nbsp;<span class="string" id="8328276">&#34;&#34;</span><span class="op" id="8328278">,</span>&nbsp;<span class="ident" id="8328280">src</span><span class="op" id="8328283">,</span>&nbsp;<span class="ident" id="8328285">parser</span><span class="op" id="8328291">.</span><span class="ident" id="8328292">ParseComments</span><span class="op" id="8328305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8328308">if</span>&nbsp;<span class="ident" id="8328311">err</span>&nbsp;<span class="op" id="8328315">==</span>&nbsp;<span class="builtintype" id="8328318">nil</span>&nbsp;<span class="op" id="8328322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8328326">t</span><span class="op" id="8328327">.</span><span class="ident" id="8328328">Error</span><span class="op" id="8328333">(</span><span class="string" id="8328334">&#34;expected&nbsp;illegal&nbsp;program&#34;</span><span class="op" id="8328360">)</span>&nbsp;<span class="comment" id="8328362">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8328380">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8328383">var</span>&nbsp;<span class="ident" id="8328387">buf</span>&nbsp;<span class="ident" id="8328391">bytes</span><span class="op" id="8328396">.</span><span class="ident" id="8328397">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8328405">Fprint</span><span class="op" id="8328411">(</span><span class="op" id="8328412">&amp;</span><span class="ident" id="8328413">buf</span><span class="op" id="8328416">,</span>&nbsp;<span class="ident" id="8328418">fset</span><span class="op" id="8328422">,</span>&nbsp;<span class="ident" id="8328424">f</span><span class="op" id="8328425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8328428">if</span>&nbsp;<span class="ident" id="8328431">buf</span><span class="op" id="8328434">.</span><span class="ident" id="8328435">String</span><span class="op" id="8328441">(</span><span class="op" id="8328442">)</span>&nbsp;<span class="op" id="8328444">!=</span>&nbsp;<span class="ident" id="8328447">res</span>&nbsp;<span class="op" id="8328451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8328455">t</span><span class="op" id="8328456">.</span><span class="ident" id="8328457">Errorf</span><span class="op" id="8328463">(</span><span class="string" id="8328464">&#34;got&nbsp;%q,&nbsp;expected&nbsp;%q&#34;</span><span class="op" id="8328485">,</span>&nbsp;<span class="ident" id="8328487">buf</span><span class="op" id="8328490">.</span><span class="ident" id="8328491">String</span><span class="op" id="8328497">(</span><span class="op" id="8328498">)</span><span class="op" id="8328499">,</span>&nbsp;<span class="ident" id="8328501">res</span><span class="op" id="8328504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8328507">}</span><br>
<span class="lineno">270</span><span class="op" id="8328509">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8328512">//&nbsp;testComment&nbsp;verifies&nbsp;that&nbsp;f&nbsp;can&nbsp;be&nbsp;parsed&nbsp;again&nbsp;after&nbsp;printing&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="8328581">//&nbsp;with&nbsp;its&nbsp;first&nbsp;comment&nbsp;set&nbsp;to&nbsp;comment&nbsp;at&nbsp;any&nbsp;possible&nbsp;source&nbsp;offset.</span><br>
<span class="lineno"></span><span class="keyword" id="8328653">func</span>&nbsp;<span class="ident" id="8328658">testComment</span><span class="op" id="8328669">(</span><span class="ident" id="8328670">t</span>&nbsp;<span class="op" id="8328672">*</span><span class="ident" id="8328673">testing</span><span class="op" id="8328680">.</span><span class="ident" id="8328681">T</span><span class="op" id="8328682">,</span>&nbsp;<span class="ident" id="8328684">f</span>&nbsp;<span class="op" id="8328686">*</span><span class="ident" id="8328687">ast</span><span class="op" id="8328690">.</span><span class="ident" id="8328691">File</span><span class="op" id="8328695">,</span>&nbsp;<span class="ident" id="8328697">srclen</span>&nbsp;<span class="builtintype" id="8328704">int</span><span class="op" id="8328707">,</span>&nbsp;<span class="ident" id="8328709">comment</span>&nbsp;<span class="op" id="8328717">*</span><span class="ident" id="8328718">ast</span><span class="op" id="8328721">.</span><span class="ident" id="8328722">Comment</span><span class="op" id="8328729">)</span>&nbsp;<span class="op" id="8328731">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8328734">f</span><span class="op" id="8328735">.</span><span class="ident" id="8328736">Comments</span><span class="op" id="8328744">[</span><span class="num" id="8328745">0</span><span class="op" id="8328746">]</span><span class="op" id="8328747">.</span><span class="ident" id="8328748">List</span><span class="op" id="8328752">[</span><span class="num" id="8328753">0</span><span class="op" id="8328754">]</span>&nbsp;<span class="op" id="8328756">=</span>&nbsp;<span class="ident" id="8328758">comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8328767">var</span>&nbsp;<span class="ident" id="8328771">buf</span>&nbsp;<span class="ident" id="8328775">bytes</span><span class="op" id="8328780">.</span><span class="ident" id="8328781">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8328789">for</span>&nbsp;<span class="ident" id="8328793">offs</span>&nbsp;<span class="op" id="8328798">:=</span>&nbsp;<span class="num" id="8328801">0</span><span class="op" id="8328802">;</span>&nbsp;<span class="ident" id="8328804">offs</span>&nbsp;<span class="op" id="8328809">&lt;=</span>&nbsp;<span class="ident" id="8328812">srclen</span><span class="op" id="8328818">;</span>&nbsp;<span class="ident" id="8328820">offs</span><span class="op" id="8328824">++</span>&nbsp;<span class="op" id="8328827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8328831">buf</span><span class="op" id="8328834">.</span><span class="ident" id="8328835">Reset</span><span class="op" id="8328840">(</span><span class="op" id="8328841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8328845">//&nbsp;Printing&nbsp;f&nbsp;should&nbsp;result&nbsp;in&nbsp;a&nbsp;correct&nbsp;program&nbsp;no</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8328899">//&nbsp;matter&nbsp;what&nbsp;the&nbsp;(incorrect)&nbsp;comment&nbsp;position&nbsp;is.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8328953">if</span>&nbsp;<span class="ident" id="8328956">err</span>&nbsp;<span class="op" id="8328960">:=</span>&nbsp;<span class="ident" id="8328963">Fprint</span><span class="op" id="8328969">(</span><span class="op" id="8328970">&amp;</span><span class="ident" id="8328971">buf</span><span class="op" id="8328974">,</span>&nbsp;<span class="ident" id="8328976">fset</span><span class="op" id="8328980">,</span>&nbsp;<span class="ident" id="8328982">f</span><span class="op" id="8328983">)</span><span class="op" id="8328984">;</span>&nbsp;<span class="ident" id="8328986">err</span>&nbsp;<span class="op" id="8328990">!=</span>&nbsp;<span class="builtintype" id="8328993">nil</span>&nbsp;<span class="op" id="8328997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8329002">t</span><span class="op" id="8329003">.</span><span class="ident" id="8329004">Error</span><span class="op" id="8329009">(</span><span class="ident" id="8329010">err</span><span class="op" id="8329013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8329017">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8329021">if</span>&nbsp;<span class="ident" id="8329024">_</span><span class="op" id="8329025">,</span>&nbsp;<span class="ident" id="8329027">err</span>&nbsp;<span class="op" id="8329031">:=</span>&nbsp;<span class="ident" id="8329034">parser</span><span class="op" id="8329040">.</span><span class="ident" id="8329041">ParseFile</span><span class="op" id="8329050">(</span><span class="ident" id="8329051">fset</span><span class="op" id="8329055">,</span>&nbsp;<span class="string" id="8329057">&#34;&#34;</span><span class="op" id="8329059">,</span>&nbsp;<span class="ident" id="8329061">buf</span><span class="op" id="8329064">.</span><span class="ident" id="8329065">Bytes</span><span class="op" id="8329070">(</span><span class="op" id="8329071">)</span><span class="op" id="8329072">,</span>&nbsp;<span class="num" id="8329074">0</span><span class="op" id="8329075">)</span><span class="op" id="8329076">;</span>&nbsp;<span class="ident" id="8329078">err</span>&nbsp;<span class="op" id="8329082">!=</span>&nbsp;<span class="builtintype" id="8329085">nil</span>&nbsp;<span class="op" id="8329089">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8329094">t</span><span class="op" id="8329095">.</span><span class="ident" id="8329096">Fatalf</span><span class="op" id="8329102">(</span><span class="string" id="8329103">&#34;incorrect&nbsp;program&nbsp;for&nbsp;pos&nbsp;=&nbsp;%d:\n%s&#34;</span><span class="op" id="8329140">,</span>&nbsp;<span class="ident" id="8329142">comment</span><span class="op" id="8329149">.</span><span class="ident" id="8329150">Slash</span><span class="op" id="8329155">,</span>&nbsp;<span class="ident" id="8329157">buf</span><span class="op" id="8329160">.</span><span class="ident" id="8329161">String</span><span class="op" id="8329167">(</span><span class="op" id="8329168">)</span><span class="op" id="8329169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8329173">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8329177">//&nbsp;Position&nbsp;information&nbsp;is&nbsp;just&nbsp;an&nbsp;offset.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8329222">//&nbsp;Move&nbsp;comment&nbsp;one&nbsp;byte&nbsp;down&nbsp;in&nbsp;the&nbsp;source.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8329269">comment</span><span class="op" id="8329276">.</span><span class="ident" id="8329277">Slash</span><span class="op" id="8329282">++</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8329286">}</span><br>
<span class="lineno"></span><span class="op" id="8329288">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8329291">//&nbsp;Verify&nbsp;that&nbsp;the&nbsp;printer&nbsp;produces&nbsp;a&nbsp;correct&nbsp;program</span><br>
<span class="lineno"></span><span class="comment" id="8329345">//&nbsp;even&nbsp;if&nbsp;the&nbsp;position&nbsp;information&nbsp;of&nbsp;comments&nbsp;introducing&nbsp;newlines</span><br>
<span class="lineno">295</span><span class="comment" id="8329414">//&nbsp;is&nbsp;incorrect.</span><br>
<span class="lineno"></span><span class="keyword" id="8329431">func</span>&nbsp;<span class="ident" id="8329436">TestBadComments</span><span class="op" id="8329451">(</span><span class="ident" id="8329452">t</span>&nbsp;<span class="op" id="8329454">*</span><span class="ident" id="8329455">testing</span><span class="op" id="8329462">.</span><span class="ident" id="8329463">T</span><span class="op" id="8329464">)</span>&nbsp;<span class="op" id="8329466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8329469">const</span>&nbsp;<span class="ident" id="8329475">src</span>&nbsp;<span class="op" id="8329479">=</span>&nbsp;<span class="string" id="8329481">`<br>
<span class="lineno"></span>//&nbsp;first&nbsp;comment&nbsp;-&nbsp;text&nbsp;and&nbsp;position&nbsp;changed&nbsp;by&nbsp;test<br>
<span class="lineno"></span>package&nbsp;p<br>
<span class="lineno">300</span>import&nbsp;&#34;fmt&#34;<br>
<span class="lineno"></span>const&nbsp;pi&nbsp;=&nbsp;3.14&nbsp;//&nbsp;rough&nbsp;circle<br>
<span class="lineno"></span>var&nbsp;(<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;x,&nbsp;y,&nbsp;z&nbsp;int&nbsp;=&nbsp;1,&nbsp;2,&nbsp;3<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;u,&nbsp;v&nbsp;float64<br>
<span class="lineno">305</span>)<br>
<span class="lineno"></span>func&nbsp;fibo(n&nbsp;int)&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;n&nbsp;&lt;&nbsp;2&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;n&nbsp;/*&nbsp;seed&nbsp;values&nbsp;*/<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;fibo(n-1)&nbsp;+&nbsp;fibo(n-2)<br>
<span class="lineno"></span>}<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8329735">f</span><span class="op" id="8329736">,</span>&nbsp;<span class="ident" id="8329738">err</span>&nbsp;<span class="op" id="8329742">:=</span>&nbsp;<span class="ident" id="8329745">parser</span><span class="op" id="8329751">.</span><span class="ident" id="8329752">ParseFile</span><span class="op" id="8329761">(</span><span class="ident" id="8329762">fset</span><span class="op" id="8329766">,</span>&nbsp;<span class="string" id="8329768">&#34;&#34;</span><span class="op" id="8329770">,</span>&nbsp;<span class="ident" id="8329772">src</span><span class="op" id="8329775">,</span>&nbsp;<span class="ident" id="8329777">parser</span><span class="op" id="8329783">.</span><span class="ident" id="8329784">ParseComments</span><span class="op" id="8329797">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8329800">if</span>&nbsp;<span class="ident" id="8329803">err</span>&nbsp;<span class="op" id="8329807">!=</span>&nbsp;<span class="builtintype" id="8329810">nil</span>&nbsp;<span class="op" id="8329814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8329818">t</span><span class="op" id="8329819">.</span><span class="ident" id="8329820">Error</span><span class="op" id="8329825">(</span><span class="ident" id="8329826">err</span><span class="op" id="8329829">)</span>&nbsp;<span class="comment" id="8329831">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8329849">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8329853">comment</span>&nbsp;<span class="op" id="8329861">:=</span>&nbsp;<span class="ident" id="8329864">f</span><span class="op" id="8329865">.</span><span class="ident" id="8329866">Comments</span><span class="op" id="8329874">[</span><span class="num" id="8329875">0</span><span class="op" id="8329876">]</span><span class="op" id="8329877">.</span><span class="ident" id="8329878">List</span><span class="op" id="8329882">[</span><span class="num" id="8329883">0</span><span class="op" id="8329884">]</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8329887">pos</span>&nbsp;<span class="op" id="8329891">:=</span>&nbsp;<span class="ident" id="8329894">comment</span><span class="op" id="8329901">.</span><span class="ident" id="8329902">Pos</span><span class="op" id="8329905">(</span><span class="op" id="8329906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8329909">if</span>&nbsp;<span class="ident" id="8329912">fset</span><span class="op" id="8329916">.</span><span class="ident" id="8329917">Position</span><span class="op" id="8329925">(</span><span class="ident" id="8329926">pos</span><span class="op" id="8329929">)</span><span class="op" id="8329930">.</span><span class="ident" id="8329931">Offset</span>&nbsp;<span class="op" id="8329938">!=</span>&nbsp;<span class="num" id="8329941">1</span>&nbsp;<span class="op" id="8329943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8329947">t</span><span class="op" id="8329948">.</span><span class="ident" id="8329949">Error</span><span class="op" id="8329954">(</span><span class="string" id="8329955">&#34;expected&nbsp;offset&nbsp;1&#34;</span><span class="op" id="8329974">)</span>&nbsp;<span class="comment" id="8329976">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8329994">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8329998">testComment</span><span class="op" id="8330009">(</span><span class="ident" id="8330010">t</span><span class="op" id="8330011">,</span>&nbsp;<span class="ident" id="8330013">f</span><span class="op" id="8330014">,</span>&nbsp;<span class="builtinfunc" id="8330016">len</span><span class="op" id="8330019">(</span><span class="ident" id="8330020">src</span><span class="op" id="8330023">)</span><span class="op" id="8330024">,</span>&nbsp;<span class="op" id="8330026">&amp;</span><span class="ident" id="8330027">ast</span><span class="op" id="8330030">.</span><span class="ident" id="8330031">Comment</span><span class="op" id="8330038">{</span><span class="ident" id="8330039">Slash</span><span class="op" id="8330044">:</span>&nbsp;<span class="ident" id="8330046">pos</span><span class="op" id="8330049">,</span>&nbsp;<span class="ident" id="8330051">Text</span><span class="op" id="8330055">:</span>&nbsp;<span class="string" id="8330057">&#34;//-style&nbsp;comment&#34;</span><span class="op" id="8330075">}</span><span class="op" id="8330076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8330079">testComment</span><span class="op" id="8330090">(</span><span class="ident" id="8330091">t</span><span class="op" id="8330092">,</span>&nbsp;<span class="ident" id="8330094">f</span><span class="op" id="8330095">,</span>&nbsp;<span class="builtinfunc" id="8330097">len</span><span class="op" id="8330100">(</span><span class="ident" id="8330101">src</span><span class="op" id="8330104">)</span><span class="op" id="8330105">,</span>&nbsp;<span class="op" id="8330107">&amp;</span><span class="ident" id="8330108">ast</span><span class="op" id="8330111">.</span><span class="ident" id="8330112">Comment</span><span class="op" id="8330119">{</span><span class="ident" id="8330120">Slash</span><span class="op" id="8330125">:</span>&nbsp;<span class="ident" id="8330127">pos</span><span class="op" id="8330130">,</span>&nbsp;<span class="ident" id="8330132">Text</span><span class="op" id="8330136">:</span>&nbsp;<span class="string" id="8330138">&#34;/*-style&nbsp;comment&nbsp;*/&#34;</span><span class="op" id="8330159">}</span><span class="op" id="8330160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8330163">testComment</span><span class="op" id="8330174">(</span><span class="ident" id="8330175">t</span><span class="op" id="8330176">,</span>&nbsp;<span class="ident" id="8330178">f</span><span class="op" id="8330179">,</span>&nbsp;<span class="builtinfunc" id="8330181">len</span><span class="op" id="8330184">(</span><span class="ident" id="8330185">src</span><span class="op" id="8330188">)</span><span class="op" id="8330189">,</span>&nbsp;<span class="op" id="8330191">&amp;</span><span class="ident" id="8330192">ast</span><span class="op" id="8330195">.</span><span class="ident" id="8330196">Comment</span><span class="op" id="8330203">{</span><span class="ident" id="8330204">Slash</span><span class="op" id="8330209">:</span>&nbsp;<span class="ident" id="8330211">pos</span><span class="op" id="8330214">,</span>&nbsp;<span class="ident" id="8330216">Text</span><span class="op" id="8330220">:</span>&nbsp;<span class="string" id="8330222">&#34;/*-style&nbsp;\n&nbsp;comment&nbsp;*/&#34;</span><span class="op" id="8330246">}</span><span class="op" id="8330247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8330250">testComment</span><span class="op" id="8330261">(</span><span class="ident" id="8330262">t</span><span class="op" id="8330263">,</span>&nbsp;<span class="ident" id="8330265">f</span><span class="op" id="8330266">,</span>&nbsp;<span class="builtinfunc" id="8330268">len</span><span class="op" id="8330271">(</span><span class="ident" id="8330272">src</span><span class="op" id="8330275">)</span><span class="op" id="8330276">,</span>&nbsp;<span class="op" id="8330278">&amp;</span><span class="ident" id="8330279">ast</span><span class="op" id="8330282">.</span><span class="ident" id="8330283">Comment</span><span class="op" id="8330290">{</span><span class="ident" id="8330291">Slash</span><span class="op" id="8330296">:</span>&nbsp;<span class="ident" id="8330298">pos</span><span class="op" id="8330301">,</span>&nbsp;<span class="ident" id="8330303">Text</span><span class="op" id="8330307">:</span>&nbsp;<span class="string" id="8330309">&#34;/*-style&nbsp;comment&nbsp;\n\n\n&nbsp;*/&#34;</span><span class="op" id="8330337">}</span><span class="op" id="8330338">)</span><br>
<span class="lineno"></span><span class="op" id="8330340">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="keyword" id="8330343">type</span>&nbsp;<span class="ident" id="8330348">visitor</span>&nbsp;<span class="keyword" id="8330356">chan</span>&nbsp;<span class="op" id="8330361">*</span><span class="ident" id="8330362">ast</span><span class="op" id="8330365">.</span><span class="ident" id="8330366">Ident</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8330373">func</span>&nbsp;<span class="op" id="8330378">(</span><span class="ident" id="8330379">v</span>&nbsp;<span class="ident" id="8330381">visitor</span><span class="op" id="8330388">)</span>&nbsp;<span class="ident" id="8330390">Visit</span><span class="op" id="8330395">(</span><span class="ident" id="8330396">n</span>&nbsp;<span class="ident" id="8330398">ast</span><span class="op" id="8330401">.</span><span class="ident" id="8330402">Node</span><span class="op" id="8330406">)</span>&nbsp;<span class="op" id="8330408">(</span><span class="ident" id="8330409">w</span>&nbsp;<span class="ident" id="8330411">ast</span><span class="op" id="8330414">.</span><span class="ident" id="8330415">Visitor</span><span class="op" id="8330422">)</span>&nbsp;<span class="op" id="8330424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8330427">if</span>&nbsp;<span class="ident" id="8330430">ident</span><span class="op" id="8330435">,</span>&nbsp;<span class="ident" id="8330437">ok</span>&nbsp;<span class="op" id="8330440">:=</span>&nbsp;<span class="ident" id="8330443">n</span><span class="op" id="8330444">.</span><span class="op" id="8330445">(</span><span class="op" id="8330446">*</span><span class="ident" id="8330447">ast</span><span class="op" id="8330450">.</span><span class="ident" id="8330451">Ident</span><span class="op" id="8330456">)</span><span class="op" id="8330457">;</span>&nbsp;<span class="ident" id="8330459">ok</span>&nbsp;<span class="op" id="8330462">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8330466">v</span>&nbsp;<span class="op" id="8330468">&lt;-</span>&nbsp;<span class="ident" id="8330471">ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8330478">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8330481">return</span>&nbsp;<span class="ident" id="8330488">v</span><br>
<span class="lineno"></span><span class="op" id="8330490">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span><span class="comment" id="8330493">//&nbsp;idents&nbsp;is&nbsp;an&nbsp;iterator&nbsp;that&nbsp;returns&nbsp;all&nbsp;idents&nbsp;in&nbsp;f&nbsp;via&nbsp;the&nbsp;result&nbsp;channel.</span><br>
<span class="lineno"></span><span class="keyword" id="8330571">func</span>&nbsp;<span class="ident" id="8330576">idents</span><span class="op" id="8330582">(</span><span class="ident" id="8330583">f</span>&nbsp;<span class="op" id="8330585">*</span><span class="ident" id="8330586">ast</span><span class="op" id="8330589">.</span><span class="ident" id="8330590">File</span><span class="op" id="8330594">)</span>&nbsp;<span class="op" id="8330596">&lt;-</span><span class="keyword" id="8330598">chan</span>&nbsp;<span class="op" id="8330603">*</span><span class="ident" id="8330604">ast</span><span class="op" id="8330607">.</span><span class="ident" id="8330608">Ident</span>&nbsp;<span class="op" id="8330614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8330617">v</span>&nbsp;<span class="op" id="8330619">:=</span>&nbsp;<span class="builtinfunc" id="8330622">make</span><span class="op" id="8330626">(</span><span class="ident" id="8330627">visitor</span><span class="op" id="8330634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8330637">go</span>&nbsp;<span class="keyword" id="8330640">func</span><span class="op" id="8330644">(</span><span class="op" id="8330645">)</span>&nbsp;<span class="op" id="8330647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8330651">ast</span><span class="op" id="8330654">.</span><span class="ident" id="8330655">Walk</span><span class="op" id="8330659">(</span><span class="ident" id="8330660">v</span><span class="op" id="8330661">,</span>&nbsp;<span class="ident" id="8330663">f</span><span class="op" id="8330664">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="8330668">close</span><span class="op" id="8330673">(</span><span class="ident" id="8330674">v</span><span class="op" id="8330675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8330678">}</span><span class="op" id="8330679">(</span><span class="op" id="8330680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8330683">return</span>&nbsp;<span class="ident" id="8330690">v</span><br>
<span class="lineno"></span><span class="op" id="8330692">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">350</span><span class="comment" id="8330695">//&nbsp;identCount&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;identifiers&nbsp;found&nbsp;in&nbsp;f.</span><br>
<span class="lineno"></span><span class="keyword" id="8330755">func</span>&nbsp;<span class="ident" id="8330760">identCount</span><span class="op" id="8330770">(</span><span class="ident" id="8330771">f</span>&nbsp;<span class="op" id="8330773">*</span><span class="ident" id="8330774">ast</span><span class="op" id="8330777">.</span><span class="ident" id="8330778">File</span><span class="op" id="8330782">)</span>&nbsp;<span class="builtintype" id="8330784">int</span>&nbsp;<span class="op" id="8330788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8330791">n</span>&nbsp;<span class="op" id="8330793">:=</span>&nbsp;<span class="num" id="8330796">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8330799">for</span>&nbsp;<span class="keyword" id="8330803">range</span>&nbsp;<span class="ident" id="8330809">idents</span><span class="op" id="8330815">(</span><span class="ident" id="8330816">f</span><span class="op" id="8330817">)</span>&nbsp;<span class="op" id="8330819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8330823">n</span><span class="op" id="8330824">++</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8330828">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8330831">return</span>&nbsp;<span class="ident" id="8330838">n</span><br>
<span class="lineno"></span><span class="op" id="8330840">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8330843">//&nbsp;Verify&nbsp;that&nbsp;the&nbsp;SourcePos&nbsp;mode&nbsp;emits&nbsp;correct&nbsp;//line&nbsp;comments</span><br>
<span class="lineno">360</span><span class="comment" id="8330907">//&nbsp;by&nbsp;testing&nbsp;that&nbsp;position&nbsp;information&nbsp;for&nbsp;matching&nbsp;identifiers</span><br>
<span class="lineno"></span><span class="comment" id="8330972">//&nbsp;is&nbsp;maintained.</span><br>
<span class="lineno"></span><span class="keyword" id="8330990">func</span>&nbsp;<span class="ident" id="8330995">TestSourcePos</span><span class="op" id="8331008">(</span><span class="ident" id="8331009">t</span>&nbsp;<span class="op" id="8331011">*</span><span class="ident" id="8331012">testing</span><span class="op" id="8331019">.</span><span class="ident" id="8331020">T</span><span class="op" id="8331021">)</span>&nbsp;<span class="op" id="8331023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8331026">const</span>&nbsp;<span class="ident" id="8331032">src</span>&nbsp;<span class="op" id="8331036">=</span>&nbsp;<span class="string" id="8331038">`<br>
<span class="lineno"></span>package&nbsp;p<br>
<span class="lineno">365</span>import&nbsp;(&nbsp;&#34;go/printer&#34;;&nbsp;&#34;math&#34;&nbsp;)<br>
<span class="lineno"></span>const&nbsp;pi&nbsp;=&nbsp;3.14;&nbsp;var&nbsp;x&nbsp;=&nbsp;0<br>
<span class="lineno"></span>type&nbsp;t&nbsp;struct{&nbsp;x,&nbsp;y,&nbsp;z&nbsp;int;&nbsp;u,&nbsp;v,&nbsp;w&nbsp;float32&nbsp;}<br>
<span class="lineno"></span>func&nbsp;(t&nbsp;*t)&nbsp;foo(a,&nbsp;b,&nbsp;c&nbsp;int)&nbsp;int&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;a*t.x&nbsp;+&nbsp;b*t.y&nbsp;+<br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;two&nbsp;extra&nbsp;lines&nbsp;here<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;...<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c*t.z<br>
<span class="lineno"></span>}<br>
<span class="lineno"></span>`</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8331263">//&nbsp;parse&nbsp;original</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8331282">f1</span><span class="op" id="8331284">,</span>&nbsp;<span class="ident" id="8331286">err</span>&nbsp;<span class="op" id="8331290">:=</span>&nbsp;<span class="ident" id="8331293">parser</span><span class="op" id="8331299">.</span><span class="ident" id="8331300">ParseFile</span><span class="op" id="8331309">(</span><span class="ident" id="8331310">fset</span><span class="op" id="8331314">,</span>&nbsp;<span class="string" id="8331316">&#34;src&#34;</span><span class="op" id="8331321">,</span>&nbsp;<span class="ident" id="8331323">src</span><span class="op" id="8331326">,</span>&nbsp;<span class="ident" id="8331328">parser</span><span class="op" id="8331334">.</span><span class="ident" id="8331335">ParseComments</span><span class="op" id="8331348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8331351">if</span>&nbsp;<span class="ident" id="8331354">err</span>&nbsp;<span class="op" id="8331358">!=</span>&nbsp;<span class="builtintype" id="8331361">nil</span>&nbsp;<span class="op" id="8331365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8331369">t</span><span class="op" id="8331370">.</span><span class="ident" id="8331371">Fatal</span><span class="op" id="8331376">(</span><span class="ident" id="8331377">err</span><span class="op" id="8331380">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8331383">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8331387">//&nbsp;pretty-print&nbsp;original</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8331413">var</span>&nbsp;<span class="ident" id="8331417">buf</span>&nbsp;<span class="ident" id="8331421">bytes</span><span class="op" id="8331426">.</span><span class="ident" id="8331427">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8331435">err</span>&nbsp;<span class="op" id="8331439">=</span>&nbsp;<span class="op" id="8331441">(</span><span class="op" id="8331442">&amp;</span><span class="ident" id="8331443">Config</span><span class="op" id="8331449">{</span><span class="ident" id="8331450">Mode</span><span class="op" id="8331454">:</span>&nbsp;<span class="ident" id="8331456">UseSpaces</span>&nbsp;<span class="op" id="8331466">|</span>&nbsp;<span class="ident" id="8331468">SourcePos</span><span class="op" id="8331477">,</span>&nbsp;<span class="ident" id="8331479">Tabwidth</span><span class="op" id="8331487">:</span>&nbsp;<span class="num" id="8331489">8</span><span class="op" id="8331490">}</span><span class="op" id="8331491">)</span><span class="op" id="8331492">.</span><span class="ident" id="8331493">Fprint</span><span class="op" id="8331499">(</span><span class="op" id="8331500">&amp;</span><span class="ident" id="8331501">buf</span><span class="op" id="8331504">,</span>&nbsp;<span class="ident" id="8331506">fset</span><span class="op" id="8331510">,</span>&nbsp;<span class="ident" id="8331512">f1</span><span class="op" id="8331514">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8331517">if</span>&nbsp;<span class="ident" id="8331520">err</span>&nbsp;<span class="op" id="8331524">!=</span>&nbsp;<span class="builtintype" id="8331527">nil</span>&nbsp;<span class="op" id="8331531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8331535">t</span><span class="op" id="8331536">.</span><span class="ident" id="8331537">Fatal</span><span class="op" id="8331542">(</span><span class="ident" id="8331543">err</span><span class="op" id="8331546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8331549">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8331553">//&nbsp;parse&nbsp;pretty&nbsp;printed&nbsp;original</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8331587">//&nbsp;(//line&nbsp;comments&nbsp;must&nbsp;be&nbsp;interpreted&nbsp;even&nbsp;w/o&nbsp;parser.ParseComments&nbsp;set)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8331663">f2</span><span class="op" id="8331665">,</span>&nbsp;<span class="ident" id="8331667">err</span>&nbsp;<span class="op" id="8331671">:=</span>&nbsp;<span class="ident" id="8331674">parser</span><span class="op" id="8331680">.</span><span class="ident" id="8331681">ParseFile</span><span class="op" id="8331690">(</span><span class="ident" id="8331691">fset</span><span class="op" id="8331695">,</span>&nbsp;<span class="string" id="8331697">&#34;&#34;</span><span class="op" id="8331699">,</span>&nbsp;<span class="ident" id="8331701">buf</span><span class="op" id="8331704">.</span><span class="ident" id="8331705">Bytes</span><span class="op" id="8331710">(</span><span class="op" id="8331711">)</span><span class="op" id="8331712">,</span>&nbsp;<span class="num" id="8331714">0</span><span class="op" id="8331715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8331718">if</span>&nbsp;<span class="ident" id="8331721">err</span>&nbsp;<span class="op" id="8331725">!=</span>&nbsp;<span class="builtintype" id="8331728">nil</span>&nbsp;<span class="op" id="8331732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8331736">t</span><span class="op" id="8331737">.</span><span class="ident" id="8331738">Fatalf</span><span class="op" id="8331744">(</span><span class="string" id="8331745">&#34;%s\n%s&#34;</span><span class="op" id="8331753">,</span>&nbsp;<span class="ident" id="8331755">err</span><span class="op" id="8331758">,</span>&nbsp;<span class="ident" id="8331760">buf</span><span class="op" id="8331763">.</span><span class="ident" id="8331764">Bytes</span><span class="op" id="8331769">(</span><span class="op" id="8331770">)</span><span class="op" id="8331771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8331774">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8331778">//&nbsp;At&nbsp;this&nbsp;point&nbsp;the&nbsp;position&nbsp;information&nbsp;of&nbsp;identifiers&nbsp;in&nbsp;f2&nbsp;should</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8331849">//&nbsp;match&nbsp;the&nbsp;position&nbsp;information&nbsp;of&nbsp;corresponding&nbsp;identifiers&nbsp;in&nbsp;f1.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8331921">//&nbsp;number&nbsp;of&nbsp;identifiers&nbsp;must&nbsp;be&nbsp;&gt;&nbsp;0&nbsp;(test&nbsp;should&nbsp;run)&nbsp;and&nbsp;must&nbsp;match</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8331992">n1</span>&nbsp;<span class="op" id="8331995">:=</span>&nbsp;<span class="ident" id="8331998">identCount</span><span class="op" id="8332008">(</span><span class="ident" id="8332009">f1</span><span class="op" id="8332011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8332014">n2</span>&nbsp;<span class="op" id="8332017">:=</span>&nbsp;<span class="ident" id="8332020">identCount</span><span class="op" id="8332030">(</span><span class="ident" id="8332031">f2</span><span class="op" id="8332033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8332036">if</span>&nbsp;<span class="ident" id="8332039">n1</span>&nbsp;<span class="op" id="8332042">==</span>&nbsp;<span class="num" id="8332045">0</span>&nbsp;<span class="op" id="8332047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8332051">t</span><span class="op" id="8332052">.</span><span class="ident" id="8332053">Fatal</span><span class="op" id="8332058">(</span><span class="string" id="8332059">&#34;got&nbsp;no&nbsp;idents&#34;</span><span class="op" id="8332074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8332077">}</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8332080">if</span>&nbsp;<span class="ident" id="8332083">n2</span>&nbsp;<span class="op" id="8332086">!=</span>&nbsp;<span class="ident" id="8332089">n1</span>&nbsp;<span class="op" id="8332092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8332096">t</span><span class="op" id="8332097">.</span><span class="ident" id="8332098">Errorf</span><span class="op" id="8332104">(</span><span class="string" id="8332105">&#34;got&nbsp;%d&nbsp;idents;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="8332129">,</span>&nbsp;<span class="ident" id="8332131">n2</span><span class="op" id="8332133">,</span>&nbsp;<span class="ident" id="8332135">n1</span><span class="op" id="8332137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8332140">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8332144">//&nbsp;verify&nbsp;that&nbsp;all&nbsp;identifiers&nbsp;have&nbsp;correct&nbsp;line&nbsp;information</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8332206">i2range</span>&nbsp;<span class="op" id="8332214">:=</span>&nbsp;<span class="ident" id="8332217">idents</span><span class="op" id="8332223">(</span><span class="ident" id="8332224">f2</span><span class="op" id="8332226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8332229">for</span>&nbsp;<span class="ident" id="8332233">i1</span>&nbsp;<span class="op" id="8332236">:=</span>&nbsp;<span class="keyword" id="8332239">range</span>&nbsp;<span class="ident" id="8332245">idents</span><span class="op" id="8332251">(</span><span class="ident" id="8332252">f1</span><span class="op" id="8332254">)</span>&nbsp;<span class="op" id="8332256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8332260">i2</span>&nbsp;<span class="op" id="8332263">:=</span>&nbsp;<span class="op" id="8332266">&lt;-</span><span class="ident" id="8332268">i2range</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8332279">if</span>&nbsp;<span class="ident" id="8332282">i2</span><span class="op" id="8332284">.</span><span class="ident" id="8332285">Name</span>&nbsp;<span class="op" id="8332290">!=</span>&nbsp;<span class="ident" id="8332293">i1</span><span class="op" id="8332295">.</span><span class="ident" id="8332296">Name</span>&nbsp;<span class="op" id="8332301">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8332306">t</span><span class="op" id="8332307">.</span><span class="ident" id="8332308">Errorf</span><span class="op" id="8332314">(</span><span class="string" id="8332315">&#34;got&nbsp;ident&nbsp;%s;&nbsp;want&nbsp;%s&#34;</span><span class="op" id="8332338">,</span>&nbsp;<span class="ident" id="8332340">i2</span><span class="op" id="8332342">.</span><span class="ident" id="8332343">Name</span><span class="op" id="8332347">,</span>&nbsp;<span class="ident" id="8332349">i1</span><span class="op" id="8332351">.</span><span class="ident" id="8332352">Name</span><span class="op" id="8332356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8332360">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8332365">l1</span>&nbsp;<span class="op" id="8332368">:=</span>&nbsp;<span class="ident" id="8332371">fset</span><span class="op" id="8332375">.</span><span class="ident" id="8332376">Position</span><span class="op" id="8332384">(</span><span class="ident" id="8332385">i1</span><span class="op" id="8332387">.</span><span class="ident" id="8332388">Pos</span><span class="op" id="8332391">(</span><span class="op" id="8332392">)</span><span class="op" id="8332393">)</span><span class="op" id="8332394">.</span><span class="ident" id="8332395">Line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8332402">l2</span>&nbsp;<span class="op" id="8332405">:=</span>&nbsp;<span class="ident" id="8332408">fset</span><span class="op" id="8332412">.</span><span class="ident" id="8332413">Position</span><span class="op" id="8332421">(</span><span class="ident" id="8332422">i2</span><span class="op" id="8332424">.</span><span class="ident" id="8332425">Pos</span><span class="op" id="8332428">(</span><span class="op" id="8332429">)</span><span class="op" id="8332430">)</span><span class="op" id="8332431">.</span><span class="ident" id="8332432">Line</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8332439">if</span>&nbsp;<span class="ident" id="8332442">l2</span>&nbsp;<span class="op" id="8332445">!=</span>&nbsp;<span class="ident" id="8332448">l1</span>&nbsp;<span class="op" id="8332451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8332456">t</span><span class="op" id="8332457">.</span><span class="ident" id="8332458">Errorf</span><span class="op" id="8332464">(</span><span class="string" id="8332465">&#34;got&nbsp;line&nbsp;%d;&nbsp;want&nbsp;%d&nbsp;for&nbsp;%s&#34;</span><span class="op" id="8332494">,</span>&nbsp;<span class="ident" id="8332496">l2</span><span class="op" id="8332498">,</span>&nbsp;<span class="ident" id="8332500">l1</span><span class="op" id="8332502">,</span>&nbsp;<span class="ident" id="8332504">i1</span><span class="op" id="8332506">.</span><span class="ident" id="8332507">Name</span><span class="op" id="8332511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8332515">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8332518">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8332522">if</span>&nbsp;<span class="ident" id="8332525">t</span><span class="op" id="8332526">.</span><span class="ident" id="8332527">Failed</span><span class="op" id="8332533">(</span><span class="op" id="8332534">)</span>&nbsp;<span class="op" id="8332536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8332540">t</span><span class="op" id="8332541">.</span><span class="ident" id="8332542">Logf</span><span class="op" id="8332546">(</span><span class="string" id="8332547">&#34;\n%s&#34;</span><span class="op" id="8332553">,</span>&nbsp;<span class="ident" id="8332555">buf</span><span class="op" id="8332558">.</span><span class="ident" id="8332559">Bytes</span><span class="op" id="8332564">(</span><span class="op" id="8332565">)</span><span class="op" id="8332566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8332569">}</span><br>
<span class="lineno"></span><span class="op" id="8332571">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span><span class="keyword" id="8332574">var</span>&nbsp;<span class="ident" id="8332578">decls</span>&nbsp;<span class="op" id="8332584">=</span>&nbsp;<span class="op" id="8332586">[</span><span class="op" id="8332587">]</span><span class="builtintype" id="8332588">string</span><span class="op" id="8332594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8332597">`import&nbsp;&#34;fmt&#34;`</span><span class="op" id="8332611">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8332614">&#34;const&nbsp;pi&nbsp;=&nbsp;3.1415\nconst&nbsp;e&nbsp;=&nbsp;2.71828\n\nvar&nbsp;x&nbsp;=&nbsp;pi&#34;</span><span class="op" id="8332666">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8332669">&#34;func&nbsp;sum(x,&nbsp;y&nbsp;int)&nbsp;int\t{&nbsp;return&nbsp;x&nbsp;+&nbsp;y&nbsp;}&#34;</span><span class="op" id="8332711">,</span><br>
<span class="lineno"></span><span class="op" id="8332713">}</span><br>
<span class="lineno">435</span><br>
<span class="lineno"></span><span class="keyword" id="8332716">func</span>&nbsp;<span class="ident" id="8332721">TestDeclLists</span><span class="op" id="8332734">(</span><span class="ident" id="8332735">t</span>&nbsp;<span class="op" id="8332737">*</span><span class="ident" id="8332738">testing</span><span class="op" id="8332745">.</span><span class="ident" id="8332746">T</span><span class="op" id="8332747">)</span>&nbsp;<span class="op" id="8332749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8332752">for</span>&nbsp;<span class="ident" id="8332756">_</span><span class="op" id="8332757">,</span>&nbsp;<span class="ident" id="8332759">src</span>&nbsp;<span class="op" id="8332763">:=</span>&nbsp;<span class="keyword" id="8332766">range</span>&nbsp;<span class="ident" id="8332772">decls</span>&nbsp;<span class="op" id="8332778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8332782">file</span><span class="op" id="8332786">,</span>&nbsp;<span class="ident" id="8332788">err</span>&nbsp;<span class="op" id="8332792">:=</span>&nbsp;<span class="ident" id="8332795">parser</span><span class="op" id="8332801">.</span><span class="ident" id="8332802">ParseFile</span><span class="op" id="8332811">(</span><span class="ident" id="8332812">fset</span><span class="op" id="8332816">,</span>&nbsp;<span class="string" id="8332818">&#34;&#34;</span><span class="op" id="8332820">,</span>&nbsp;<span class="string" id="8332822">&#34;package&nbsp;p;&#34;</span><span class="op" id="8332834">+</span><span class="ident" id="8332835">src</span><span class="op" id="8332838">,</span>&nbsp;<span class="ident" id="8332840">parser</span><span class="op" id="8332846">.</span><span class="ident" id="8332847">ParseComments</span><span class="op" id="8332860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8332864">if</span>&nbsp;<span class="ident" id="8332867">err</span>&nbsp;<span class="op" id="8332871">!=</span>&nbsp;<span class="builtintype" id="8332874">nil</span>&nbsp;<span class="op" id="8332878">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="8332883">panic</span><span class="op" id="8332888">(</span><span class="ident" id="8332889">err</span><span class="op" id="8332892">)</span>&nbsp;<span class="comment" id="8332894">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8332913">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8332918">var</span>&nbsp;<span class="ident" id="8332922">buf</span>&nbsp;<span class="ident" id="8332926">bytes</span><span class="op" id="8332931">.</span><span class="ident" id="8332932">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8332941">err</span>&nbsp;<span class="op" id="8332945">=</span>&nbsp;<span class="ident" id="8332947">Fprint</span><span class="op" id="8332953">(</span><span class="op" id="8332954">&amp;</span><span class="ident" id="8332955">buf</span><span class="op" id="8332958">,</span>&nbsp;<span class="ident" id="8332960">fset</span><span class="op" id="8332964">,</span>&nbsp;<span class="ident" id="8332966">file</span><span class="op" id="8332970">.</span><span class="ident" id="8332971">Decls</span><span class="op" id="8332976">)</span>&nbsp;<span class="comment" id="8332978">//&nbsp;only&nbsp;print&nbsp;declarations</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8333007">if</span>&nbsp;<span class="ident" id="8333010">err</span>&nbsp;<span class="op" id="8333014">!=</span>&nbsp;<span class="builtintype" id="8333017">nil</span>&nbsp;<span class="op" id="8333021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="8333026">panic</span><span class="op" id="8333031">(</span><span class="ident" id="8333032">err</span><span class="op" id="8333035">)</span>&nbsp;<span class="comment" id="8333037">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8333056">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8333061">out</span>&nbsp;<span class="op" id="8333065">:=</span>&nbsp;<span class="ident" id="8333068">buf</span><span class="op" id="8333071">.</span><span class="ident" id="8333072">String</span><span class="op" id="8333078">(</span><span class="op" id="8333079">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8333083">if</span>&nbsp;<span class="ident" id="8333086">out</span>&nbsp;<span class="op" id="8333090">!=</span>&nbsp;<span class="ident" id="8333093">src</span>&nbsp;<span class="op" id="8333097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8333102">t</span><span class="op" id="8333103">.</span><span class="ident" id="8333104">Errorf</span><span class="op" id="8333110">(</span><span class="string" id="8333111">&#34;\ngot&nbsp;:&nbsp;%q\nwant:&nbsp;%q\n&#34;</span><span class="op" id="8333135">,</span>&nbsp;<span class="ident" id="8333137">out</span><span class="op" id="8333140">,</span>&nbsp;<span class="ident" id="8333142">src</span><span class="op" id="8333145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8333149">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8333152">}</span><br>
<span class="lineno"></span><span class="op" id="8333154">}</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span><span class="keyword" id="8333157">var</span>&nbsp;<span class="ident" id="8333161">stmts</span>&nbsp;<span class="op" id="8333167">=</span>&nbsp;<span class="op" id="8333169">[</span><span class="op" id="8333170">]</span><span class="builtintype" id="8333171">string</span><span class="op" id="8333177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8333180">&#34;i&nbsp;:=&nbsp;0&#34;</span><span class="op" id="8333188">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8333191">&#34;select&nbsp;{}\nvar&nbsp;a,&nbsp;b&nbsp;=&nbsp;1,&nbsp;2\nreturn&nbsp;a&nbsp;+&nbsp;b&#34;</span><span class="op" id="8333233">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8333236">&#34;go&nbsp;f()\ndefer&nbsp;func()&nbsp;{}()&#34;</span><span class="op" id="8333263">,</span><br>
<span class="lineno">460</span><span class="op" id="8333265">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8333268">func</span>&nbsp;<span class="ident" id="8333273">TestStmtLists</span><span class="op" id="8333286">(</span><span class="ident" id="8333287">t</span>&nbsp;<span class="op" id="8333289">*</span><span class="ident" id="8333290">testing</span><span class="op" id="8333297">.</span><span class="ident" id="8333298">T</span><span class="op" id="8333299">)</span>&nbsp;<span class="op" id="8333301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8333304">for</span>&nbsp;<span class="ident" id="8333308">_</span><span class="op" id="8333309">,</span>&nbsp;<span class="ident" id="8333311">src</span>&nbsp;<span class="op" id="8333315">:=</span>&nbsp;<span class="keyword" id="8333318">range</span>&nbsp;<span class="ident" id="8333324">stmts</span>&nbsp;<span class="op" id="8333330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8333334">file</span><span class="op" id="8333338">,</span>&nbsp;<span class="ident" id="8333340">err</span>&nbsp;<span class="op" id="8333344">:=</span>&nbsp;<span class="ident" id="8333347">parser</span><span class="op" id="8333353">.</span><span class="ident" id="8333354">ParseFile</span><span class="op" id="8333363">(</span><span class="ident" id="8333364">fset</span><span class="op" id="8333368">,</span>&nbsp;<span class="string" id="8333370">&#34;&#34;</span><span class="op" id="8333372">,</span>&nbsp;<span class="string" id="8333374">&#34;package&nbsp;p;&nbsp;func&nbsp;_()&nbsp;{&#34;</span><span class="op" id="8333397">+</span><span class="ident" id="8333398">src</span><span class="op" id="8333401">+</span><span class="string" id="8333402">&#34;}&#34;</span><span class="op" id="8333405">,</span>&nbsp;<span class="ident" id="8333407">parser</span><span class="op" id="8333413">.</span><span class="ident" id="8333414">ParseComments</span><span class="op" id="8333427">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8333431">if</span>&nbsp;<span class="ident" id="8333434">err</span>&nbsp;<span class="op" id="8333438">!=</span>&nbsp;<span class="builtintype" id="8333441">nil</span>&nbsp;<span class="op" id="8333445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="8333450">panic</span><span class="op" id="8333455">(</span><span class="ident" id="8333456">err</span><span class="op" id="8333459">)</span>&nbsp;<span class="comment" id="8333461">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8333480">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8333485">var</span>&nbsp;<span class="ident" id="8333489">buf</span>&nbsp;<span class="ident" id="8333493">bytes</span><span class="op" id="8333498">.</span><span class="ident" id="8333499">Buffer</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8333508">err</span>&nbsp;<span class="op" id="8333512">=</span>&nbsp;<span class="ident" id="8333514">Fprint</span><span class="op" id="8333520">(</span><span class="op" id="8333521">&amp;</span><span class="ident" id="8333522">buf</span><span class="op" id="8333525">,</span>&nbsp;<span class="ident" id="8333527">fset</span><span class="op" id="8333531">,</span>&nbsp;<span class="ident" id="8333533">file</span><span class="op" id="8333537">.</span><span class="ident" id="8333538">Decls</span><span class="op" id="8333543">[</span><span class="num" id="8333544">0</span><span class="op" id="8333545">]</span><span class="op" id="8333546">.</span><span class="op" id="8333547">(</span><span class="op" id="8333548">*</span><span class="ident" id="8333549">ast</span><span class="op" id="8333552">.</span><span class="ident" id="8333553">FuncDecl</span><span class="op" id="8333561">)</span><span class="op" id="8333562">.</span><span class="ident" id="8333563">Body</span><span class="op" id="8333567">.</span><span class="ident" id="8333568">List</span><span class="op" id="8333572">)</span>&nbsp;<span class="comment" id="8333574">//&nbsp;only&nbsp;print&nbsp;statements</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8333601">if</span>&nbsp;<span class="ident" id="8333604">err</span>&nbsp;<span class="op" id="8333608">!=</span>&nbsp;<span class="builtintype" id="8333611">nil</span>&nbsp;<span class="op" id="8333615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="8333620">panic</span><span class="op" id="8333625">(</span><span class="ident" id="8333626">err</span><span class="op" id="8333629">)</span>&nbsp;<span class="comment" id="8333631">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8333650">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8333655">out</span>&nbsp;<span class="op" id="8333659">:=</span>&nbsp;<span class="ident" id="8333662">buf</span><span class="op" id="8333665">.</span><span class="ident" id="8333666">String</span><span class="op" id="8333672">(</span><span class="op" id="8333673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8333677">if</span>&nbsp;<span class="ident" id="8333680">out</span>&nbsp;<span class="op" id="8333684">!=</span>&nbsp;<span class="ident" id="8333687">src</span>&nbsp;<span class="op" id="8333691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8333696">t</span><span class="op" id="8333697">.</span><span class="ident" id="8333698">Errorf</span><span class="op" id="8333704">(</span><span class="string" id="8333705">&#34;\ngot&nbsp;:&nbsp;%q\nwant:&nbsp;%q\n&#34;</span><span class="op" id="8333729">,</span>&nbsp;<span class="ident" id="8333731">out</span><span class="op" id="8333734">,</span>&nbsp;<span class="ident" id="8333736">src</span><span class="op" id="8333739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8333743">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8333746">}</span><br>
<span class="lineno">480</span><span class="op" id="8333748">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8333751">func</span>&nbsp;<span class="ident" id="8333756">TestBaseIndent</span><span class="op" id="8333770">(</span><span class="ident" id="8333771">t</span>&nbsp;<span class="op" id="8333773">*</span><span class="ident" id="8333774">testing</span><span class="op" id="8333781">.</span><span class="ident" id="8333782">T</span><span class="op" id="8333783">)</span>&nbsp;<span class="op" id="8333785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8333788">//&nbsp;The&nbsp;testfile&nbsp;must&nbsp;not&nbsp;contain&nbsp;multi-line&nbsp;raw&nbsp;strings&nbsp;since&nbsp;those</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8333857">//&nbsp;are&nbsp;not&nbsp;indented&nbsp;(because&nbsp;their&nbsp;values&nbsp;must&nbsp;not&nbsp;change)&nbsp;and&nbsp;make</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8333926">//&nbsp;this&nbsp;test&nbsp;fail.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8333946">const</span>&nbsp;<span class="ident" id="8333952">filename</span>&nbsp;<span class="op" id="8333961">=</span>&nbsp;<span class="string" id="8333963">&#34;printer.go&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8333977">src</span><span class="op" id="8333980">,</span>&nbsp;<span class="ident" id="8333982">err</span>&nbsp;<span class="op" id="8333986">:=</span>&nbsp;<span class="ident" id="8333989">ioutil</span><span class="op" id="8333995">.</span><span class="ident" id="8333996">ReadFile</span><span class="op" id="8334004">(</span><span class="ident" id="8334005">filename</span><span class="op" id="8334013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8334016">if</span>&nbsp;<span class="ident" id="8334019">err</span>&nbsp;<span class="op" id="8334023">!=</span>&nbsp;<span class="builtintype" id="8334026">nil</span>&nbsp;<span class="op" id="8334030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="8334034">panic</span><span class="op" id="8334039">(</span><span class="ident" id="8334040">err</span><span class="op" id="8334043">)</span>&nbsp;<span class="comment" id="8334045">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8334063">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8334067">file</span><span class="op" id="8334071">,</span>&nbsp;<span class="ident" id="8334073">err</span>&nbsp;<span class="op" id="8334077">:=</span>&nbsp;<span class="ident" id="8334080">parser</span><span class="op" id="8334086">.</span><span class="ident" id="8334087">ParseFile</span><span class="op" id="8334096">(</span><span class="ident" id="8334097">fset</span><span class="op" id="8334101">,</span>&nbsp;<span class="ident" id="8334103">filename</span><span class="op" id="8334111">,</span>&nbsp;<span class="ident" id="8334113">src</span><span class="op" id="8334116">,</span>&nbsp;<span class="num" id="8334118">0</span><span class="op" id="8334119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8334122">if</span>&nbsp;<span class="ident" id="8334125">err</span>&nbsp;<span class="op" id="8334129">!=</span>&nbsp;<span class="builtintype" id="8334132">nil</span>&nbsp;<span class="op" id="8334136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="8334140">panic</span><span class="op" id="8334145">(</span><span class="ident" id="8334146">err</span><span class="op" id="8334149">)</span>&nbsp;<span class="comment" id="8334151">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8334169">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8334173">var</span>&nbsp;<span class="ident" id="8334177">buf</span>&nbsp;<span class="ident" id="8334181">bytes</span><span class="op" id="8334186">.</span><span class="ident" id="8334187">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8334195">for</span>&nbsp;<span class="ident" id="8334199">indent</span>&nbsp;<span class="op" id="8334206">:=</span>&nbsp;<span class="num" id="8334209">0</span><span class="op" id="8334210">;</span>&nbsp;<span class="ident" id="8334212">indent</span>&nbsp;<span class="op" id="8334219">&lt;</span>&nbsp;<span class="num" id="8334221">4</span><span class="op" id="8334222">;</span>&nbsp;<span class="ident" id="8334224">indent</span><span class="op" id="8334230">++</span>&nbsp;<span class="op" id="8334233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8334237">buf</span><span class="op" id="8334240">.</span><span class="ident" id="8334241">Reset</span><span class="op" id="8334246">(</span><span class="op" id="8334247">)</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8334251">(</span><span class="op" id="8334252">&amp;</span><span class="ident" id="8334253">Config</span><span class="op" id="8334259">{</span><span class="ident" id="8334260">Tabwidth</span><span class="op" id="8334268">:</span>&nbsp;<span class="ident" id="8334270">tabwidth</span><span class="op" id="8334278">,</span>&nbsp;<span class="ident" id="8334280">Indent</span><span class="op" id="8334286">:</span>&nbsp;<span class="ident" id="8334288">indent</span><span class="op" id="8334294">}</span><span class="op" id="8334295">)</span><span class="op" id="8334296">.</span><span class="ident" id="8334297">Fprint</span><span class="op" id="8334303">(</span><span class="op" id="8334304">&amp;</span><span class="ident" id="8334305">buf</span><span class="op" id="8334308">,</span>&nbsp;<span class="ident" id="8334310">fset</span><span class="op" id="8334314">,</span>&nbsp;<span class="ident" id="8334316">file</span><span class="op" id="8334320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8334324">//&nbsp;all&nbsp;code&nbsp;must&nbsp;be&nbsp;indented&nbsp;by&nbsp;at&nbsp;least&nbsp;&#39;indent&#39;&nbsp;tabs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8334381">lines</span>&nbsp;<span class="op" id="8334387">:=</span>&nbsp;<span class="ident" id="8334390">bytes</span><span class="op" id="8334395">.</span><span class="ident" id="8334396">Split</span><span class="op" id="8334401">(</span><span class="ident" id="8334402">buf</span><span class="op" id="8334405">.</span><span class="ident" id="8334406">Bytes</span><span class="op" id="8334411">(</span><span class="op" id="8334412">)</span><span class="op" id="8334413">,</span>&nbsp;<span class="op" id="8334415">[</span><span class="op" id="8334416">]</span><span class="builtintype" id="8334417">byte</span><span class="op" id="8334421">{</span><span class="string" id="8334422">&#39;\n&#39;</span><span class="op" id="8334426">}</span><span class="op" id="8334427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8334431">for</span>&nbsp;<span class="ident" id="8334435">i</span><span class="op" id="8334436">,</span>&nbsp;<span class="ident" id="8334438">line</span>&nbsp;<span class="op" id="8334443">:=</span>&nbsp;<span class="keyword" id="8334446">range</span>&nbsp;<span class="ident" id="8334452">lines</span>&nbsp;<span class="op" id="8334458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8334463">if</span>&nbsp;<span class="builtinfunc" id="8334466">len</span><span class="op" id="8334469">(</span><span class="ident" id="8334470">line</span><span class="op" id="8334474">)</span>&nbsp;<span class="op" id="8334476">==</span>&nbsp;<span class="num" id="8334479">0</span>&nbsp;<span class="op" id="8334481">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8334487">continue</span>&nbsp;<span class="comment" id="8334496">//&nbsp;empty&nbsp;lines&nbsp;don&#39;t&nbsp;have&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8334537">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8334542">n</span>&nbsp;<span class="op" id="8334544">:=</span>&nbsp;<span class="num" id="8334547">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8334552">for</span>&nbsp;<span class="ident" id="8334556">j</span><span class="op" id="8334557">,</span>&nbsp;<span class="ident" id="8334559">b</span>&nbsp;<span class="op" id="8334561">:=</span>&nbsp;<span class="keyword" id="8334564">range</span>&nbsp;<span class="ident" id="8334570">line</span>&nbsp;<span class="op" id="8334575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8334581">if</span>&nbsp;<span class="ident" id="8334584">b</span>&nbsp;<span class="op" id="8334586">!=</span>&nbsp;<span class="string" id="8334589">&#39;\t&#39;</span>&nbsp;<span class="op" id="8334594">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8334601">//&nbsp;end&nbsp;of&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8334628">n</span>&nbsp;<span class="op" id="8334630">=</span>&nbsp;<span class="ident" id="8334632">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8334639">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8334649">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8334654">}</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8334659">if</span>&nbsp;<span class="ident" id="8334662">n</span>&nbsp;<span class="op" id="8334664">&lt;</span>&nbsp;<span class="ident" id="8334666">indent</span>&nbsp;<span class="op" id="8334673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8334679">t</span><span class="op" id="8334680">.</span><span class="ident" id="8334681">Errorf</span><span class="op" id="8334687">(</span><span class="string" id="8334688">&#34;line&nbsp;%d:&nbsp;got&nbsp;only&nbsp;%d&nbsp;tabs;&nbsp;want&nbsp;at&nbsp;least&nbsp;%d:&nbsp;%q&#34;</span><span class="op" id="8334737">,</span>&nbsp;<span class="ident" id="8334739">i</span><span class="op" id="8334740">,</span>&nbsp;<span class="ident" id="8334742">n</span><span class="op" id="8334743">,</span>&nbsp;<span class="ident" id="8334745">indent</span><span class="op" id="8334751">,</span>&nbsp;<span class="ident" id="8334753">line</span><span class="op" id="8334757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8334762">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8334766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8334769">}</span><br>
<span class="lineno">520</span><span class="op" id="8334771">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8334774">//&nbsp;TestFuncType&nbsp;tests&nbsp;that&nbsp;an&nbsp;ast.FuncType&nbsp;with&nbsp;a&nbsp;nil&nbsp;Params&nbsp;field</span><br>
<span class="lineno"></span><span class="comment" id="8334841">//&nbsp;can&nbsp;be&nbsp;printed&nbsp;(per&nbsp;go/ast&nbsp;specification).&nbsp;Test&nbsp;case&nbsp;for&nbsp;issue&nbsp;3870.</span><br>
<span class="lineno"></span><span class="keyword" id="8334913">func</span>&nbsp;<span class="ident" id="8334918">TestFuncType</span><span class="op" id="8334930">(</span><span class="ident" id="8334931">t</span>&nbsp;<span class="op" id="8334933">*</span><span class="ident" id="8334934">testing</span><span class="op" id="8334941">.</span><span class="ident" id="8334942">T</span><span class="op" id="8334943">)</span>&nbsp;<span class="op" id="8334945">{</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8334948">src</span>&nbsp;<span class="op" id="8334952">:=</span>&nbsp;<span class="op" id="8334955">&amp;</span><span class="ident" id="8334956">ast</span><span class="op" id="8334959">.</span><span class="ident" id="8334960">File</span><span class="op" id="8334964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8334968">Name</span><span class="op" id="8334972">:</span>&nbsp;<span class="op" id="8334974">&amp;</span><span class="ident" id="8334975">ast</span><span class="op" id="8334978">.</span><span class="ident" id="8334979">Ident</span><span class="op" id="8334984">{</span><span class="ident" id="8334985">Name</span><span class="op" id="8334989">:</span>&nbsp;<span class="string" id="8334991">&#34;p&#34;</span><span class="op" id="8334994">}</span><span class="op" id="8334995">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8334999">Decls</span><span class="op" id="8335004">:</span>&nbsp;<span class="op" id="8335006">[</span><span class="op" id="8335007">]</span><span class="ident" id="8335008">ast</span><span class="op" id="8335011">.</span><span class="ident" id="8335012">Decl</span><span class="op" id="8335016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8335021">&amp;</span><span class="ident" id="8335022">ast</span><span class="op" id="8335025">.</span><span class="ident" id="8335026">FuncDecl</span><span class="op" id="8335034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8335040">Name</span><span class="op" id="8335044">:</span>&nbsp;<span class="op" id="8335046">&amp;</span><span class="ident" id="8335047">ast</span><span class="op" id="8335050">.</span><span class="ident" id="8335051">Ident</span><span class="op" id="8335056">{</span><span class="ident" id="8335057">Name</span><span class="op" id="8335061">:</span>&nbsp;<span class="string" id="8335063">&#34;f&#34;</span><span class="op" id="8335066">}</span><span class="op" id="8335067">,</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8335073">Type</span><span class="op" id="8335077">:</span>&nbsp;<span class="op" id="8335079">&amp;</span><span class="ident" id="8335080">ast</span><span class="op" id="8335083">.</span><span class="ident" id="8335084">FuncType</span><span class="op" id="8335092">{</span><span class="op" id="8335093">}</span><span class="op" id="8335094">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8335099">}</span><span class="op" id="8335100">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8335104">}</span><span class="op" id="8335105">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8335108">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8335112">var</span>&nbsp;<span class="ident" id="8335116">buf</span>&nbsp;<span class="ident" id="8335120">bytes</span><span class="op" id="8335125">.</span><span class="ident" id="8335126">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8335134">if</span>&nbsp;<span class="ident" id="8335137">err</span>&nbsp;<span class="op" id="8335141">:=</span>&nbsp;<span class="ident" id="8335144">Fprint</span><span class="op" id="8335150">(</span><span class="op" id="8335151">&amp;</span><span class="ident" id="8335152">buf</span><span class="op" id="8335155">,</span>&nbsp;<span class="ident" id="8335157">fset</span><span class="op" id="8335161">,</span>&nbsp;<span class="ident" id="8335163">src</span><span class="op" id="8335166">)</span><span class="op" id="8335167">;</span>&nbsp;<span class="ident" id="8335169">err</span>&nbsp;<span class="op" id="8335173">!=</span>&nbsp;<span class="builtintype" id="8335176">nil</span>&nbsp;<span class="op" id="8335180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8335184">t</span><span class="op" id="8335185">.</span><span class="ident" id="8335186">Fatal</span><span class="op" id="8335191">(</span><span class="ident" id="8335192">err</span><span class="op" id="8335195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8335198">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8335201">got</span>&nbsp;<span class="op" id="8335205">:=</span>&nbsp;<span class="ident" id="8335208">buf</span><span class="op" id="8335211">.</span><span class="ident" id="8335212">String</span><span class="op" id="8335218">(</span><span class="op" id="8335219">)</span><br>
<span class="lineno">540</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8335223">const</span>&nbsp;<span class="ident" id="8335229">want</span>&nbsp;<span class="op" id="8335234">=</span>&nbsp;<span class="string" id="8335236">`package&nbsp;p<br>
<span class="lineno"></span><br>
<span class="lineno"></span>func&nbsp;f()<br>
<span class="lineno"></span>`</span><br>
<span class="lineno">545</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8335261">if</span>&nbsp;<span class="ident" id="8335264">got</span>&nbsp;<span class="op" id="8335268">!=</span>&nbsp;<span class="ident" id="8335271">want</span>&nbsp;<span class="op" id="8335276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8335280">t</span><span class="op" id="8335281">.</span><span class="ident" id="8335282">Fatalf</span><span class="op" id="8335288">(</span><span class="string" id="8335289">&#34;got:\n%s\nwant:\n%s\n&#34;</span><span class="op" id="8335312">,</span>&nbsp;<span class="ident" id="8335314">got</span><span class="op" id="8335317">,</span>&nbsp;<span class="ident" id="8335319">want</span><span class="op" id="8335323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8335326">}</span><br>
<span class="lineno"></span><span class="op" id="8335328">}</span><br>
<span class="lineno">550</span><br>
<span class="lineno"></span><span class="comment" id="8335331">//&nbsp;TextX&nbsp;is&nbsp;a&nbsp;skeleton&nbsp;test&nbsp;that&nbsp;can&nbsp;be&nbsp;filled&nbsp;in&nbsp;for&nbsp;debugging&nbsp;one-off&nbsp;cases.</span><br>
<span class="lineno"></span><span class="comment" id="8335410">//&nbsp;Do&nbsp;not&nbsp;remove.</span><br>
<span class="lineno"></span><span class="keyword" id="8335428">func</span>&nbsp;<span class="ident" id="8335433">TestX</span><span class="op" id="8335438">(</span><span class="ident" id="8335439">t</span>&nbsp;<span class="op" id="8335441">*</span><span class="ident" id="8335442">testing</span><span class="op" id="8335449">.</span><span class="ident" id="8335450">T</span><span class="op" id="8335451">)</span>&nbsp;<span class="op" id="8335453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8335456">const</span>&nbsp;<span class="ident" id="8335462">src</span>&nbsp;<span class="op" id="8335466">=</span>&nbsp;<span class="string" id="8335468">`<br>
<span class="lineno">555</span>package&nbsp;p<br>
<span class="lineno"></span>func&nbsp;_()&nbsp;{}<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8335495">_</span><span class="op" id="8335496">,</span>&nbsp;<span class="ident" id="8335498">err</span>&nbsp;<span class="op" id="8335502">:=</span>&nbsp;<span class="ident" id="8335505">format</span><span class="op" id="8335511">(</span><span class="op" id="8335512">[</span><span class="op" id="8335513">]</span><span class="builtintype" id="8335514">byte</span><span class="op" id="8335518">(</span><span class="ident" id="8335519">src</span><span class="op" id="8335522">)</span><span class="op" id="8335523">,</span>&nbsp;<span class="num" id="8335525">0</span><span class="op" id="8335526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8335529">if</span>&nbsp;<span class="ident" id="8335532">err</span>&nbsp;<span class="op" id="8335536">!=</span>&nbsp;<span class="builtintype" id="8335539">nil</span>&nbsp;<span class="op" id="8335543">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8335547">t</span><span class="op" id="8335548">.</span><span class="ident" id="8335549">Error</span><span class="op" id="8335554">(</span><span class="ident" id="8335555">err</span><span class="op" id="8335558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8335561">}</span><br>
<span class="lineno"></span><span class="op" id="8335563">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
