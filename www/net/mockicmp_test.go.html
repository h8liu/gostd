<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6863793">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6863849">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6863903">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6863954">package</span>&nbsp;<span class="ident" id="6863962">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6863967">import</span>&nbsp;<span class="string" id="6863974">&#34;errors&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6863984">const</span>&nbsp;<span class="op" id="6863990">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6863993">icmpv4EchoRequest</span>&nbsp;<span class="op" id="6864011">=</span>&nbsp;<span class="num" id="6864013">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6864016">icmpv4EchoReply</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6864034">=</span>&nbsp;<span class="num" id="6864036">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6864039">icmpv6EchoRequest</span>&nbsp;<span class="op" id="6864057">=</span>&nbsp;<span class="num" id="6864059">128</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6864064">icmpv6EchoReply</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6864082">=</span>&nbsp;<span class="num" id="6864084">129</span><br>
<span class="lineno"></span><span class="op" id="6864088">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="6864091">//&nbsp;icmpMessage&nbsp;represents&nbsp;an&nbsp;ICMP&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="6864134">type</span>&nbsp;<span class="ident" id="6864139">icmpMessage</span>&nbsp;<span class="keyword" id="6864151">struct</span>&nbsp;<span class="op" id="6864158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6864161">Type</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6864170">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6864186">//&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6864195">Code</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6864204">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6864220">//&nbsp;code</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6864229">Checksum</span>&nbsp;<span class="builtintype" id="6864238">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6864254">//&nbsp;checksum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6864267">Body</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6864276"><a href="/net/mockicmp_test.go.html#6864360">icmpMessageBody</a></span>&nbsp;<span class="comment" id="6864292">//&nbsp;body</span><br>
<span class="lineno"></span><span class="op" id="6864300">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6864303">//&nbsp;icmpMessageBody&nbsp;represents&nbsp;an&nbsp;ICMP&nbsp;message&nbsp;body.</span><br>
<span class="lineno">25</span><span class="keyword" id="6864355">type</span>&nbsp;<span class="ident" id="6864360">icmpMessageBody</span>&nbsp;<span class="keyword" id="6864376">interface</span>&nbsp;<span class="op" id="6864386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6864389">Len</span><span class="op" id="6864392">(</span><span class="op" id="6864393">)</span>&nbsp;<span class="builtintype" id="6864395">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6864400">Marshal</span><span class="op" id="6864407">(</span><span class="op" id="6864408">)</span>&nbsp;<span class="op" id="6864410">(</span><span class="op" id="6864411">[</span><span class="op" id="6864412">]</span><span class="builtintype" id="6864413">byte</span><span class="op" id="6864417">,</span>&nbsp;<span class="builtintype" id="6864419">error</span><span class="op" id="6864424">)</span><br>
<span class="lineno"></span><span class="op" id="6864426">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="6864429">//&nbsp;Marshal&nbsp;returns&nbsp;the&nbsp;binary&nbsp;enconding&nbsp;of&nbsp;the&nbsp;ICMP&nbsp;echo&nbsp;request&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="6864497">//&nbsp;reply&nbsp;message&nbsp;m.</span><br>
<span class="lineno"></span><span class="keyword" id="6864517">func</span>&nbsp;<span class="op" id="6864522">(</span><span class="ident" id="6864523">m</span>&nbsp;<span class="op" id="6864525">*</span><span class="ident" id="6864526"><a href="/net/mockicmp_test.go.html#6864139">icmpMessage</a></span><span class="op" id="6864537">)</span>&nbsp;<span class="ident" id="6864539">Marshal</span><span class="op" id="6864546">(</span><span class="op" id="6864547">)</span>&nbsp;<span class="op" id="6864549">(</span><span class="op" id="6864550">[</span><span class="op" id="6864551">]</span><span class="builtintype" id="6864552">byte</span><span class="op" id="6864556">,</span>&nbsp;<span class="builtintype" id="6864558">error</span><span class="op" id="6864563">)</span>&nbsp;<span class="op" id="6864565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6864568">b</span>&nbsp;<span class="op" id="6864570">:=</span>&nbsp;<span class="op" id="6864573">[</span><span class="op" id="6864574">]</span><span class="builtintype" id="6864575">byte</span><span class="op" id="6864579">{</span><span class="builtintype" id="6864580">byte</span><span class="op" id="6864584">(</span><span class="ident" id="6864585"><a href="/net/mockicmp_test.go.html#6864523">m</a></span><span class="op" id="6864586">.</span><span class="ident" id="6864587">Type</span><span class="op" id="6864591">)</span><span class="op" id="6864592">,</span>&nbsp;<span class="builtintype" id="6864594">byte</span><span class="op" id="6864598">(</span><span class="ident" id="6864599"><a href="/net/mockicmp_test.go.html#6864523">m</a></span><span class="op" id="6864600">.</span><span class="ident" id="6864601">Code</span><span class="op" id="6864605">)</span><span class="op" id="6864606">,</span>&nbsp;<span class="num" id="6864608">0</span><span class="op" id="6864609">,</span>&nbsp;<span class="num" id="6864611">0</span><span class="op" id="6864612">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6864615">if</span>&nbsp;<span class="ident" id="6864618"><a href="/net/mockicmp_test.go.html#6864523">m</a></span><span class="op" id="6864619">.</span><span class="ident" id="6864620">Body</span>&nbsp;<span class="op" id="6864625">!=</span>&nbsp;<span class="ident" id="6864628">nil</span>&nbsp;<span class="op" id="6864632">&amp;&amp;</span>&nbsp;<span class="ident" id="6864635"><a href="/net/mockicmp_test.go.html#6864523">m</a></span><span class="op" id="6864636">.</span><span class="ident" id="6864637">Body</span><span class="op" id="6864641">.</span><span class="ident" id="6864642">Len</span><span class="op" id="6864645">(</span><span class="op" id="6864646">)</span>&nbsp;<span class="op" id="6864648">!=</span>&nbsp;<span class="num" id="6864651">0</span>&nbsp;<span class="op" id="6864653">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6864657">mb</span><span class="op" id="6864659">,</span>&nbsp;<span class="ident" id="6864661">err</span>&nbsp;<span class="op" id="6864665">:=</span>&nbsp;<span class="ident" id="6864668"><a href="/net/mockicmp_test.go.html#6864523">m</a></span><span class="op" id="6864669">.</span><span class="ident" id="6864670">Body</span><span class="op" id="6864674">.</span><span class="ident" id="6864675">Marshal</span><span class="op" id="6864682">(</span><span class="op" id="6864683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6864687">if</span>&nbsp;<span class="ident" id="6864690"><a href="/net/mockicmp_test.go.html#6864661">err</a></span>&nbsp;<span class="op" id="6864694">!=</span>&nbsp;<span class="ident" id="6864697">nil</span>&nbsp;<span class="op" id="6864701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6864706">return</span>&nbsp;<span class="ident" id="6864713">nil</span><span class="op" id="6864716">,</span>&nbsp;<span class="ident" id="6864718"><a href="/net/mockicmp_test.go.html#6864661">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6864724">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6864728"><a href="/net/mockicmp_test.go.html#6864568">b</a></span>&nbsp;<span class="op" id="6864730">=</span>&nbsp;<span class="builtinfunc" id="6864732">append</span><span class="op" id="6864738">(</span><span class="ident" id="6864739"><a href="/net/mockicmp_test.go.html#6864568">b</a></span><span class="op" id="6864740">,</span>&nbsp;<span class="ident" id="6864742"><a href="/net/mockicmp_test.go.html#6864657">mb</a></span><span class="op" id="6864744">...</span><span class="op" id="6864747">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6864750">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6864753">switch</span>&nbsp;<span class="ident" id="6864760"><a href="/net/mockicmp_test.go.html#6864523">m</a></span><span class="op" id="6864761">.</span><span class="ident" id="6864762">Type</span>&nbsp;<span class="op" id="6864767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6864770">case</span>&nbsp;<span class="ident" id="6864775"><a href="/net/mockicmp_test.go.html#6864039">icmpv6EchoRequest</a></span><span class="op" id="6864792">,</span>&nbsp;<span class="ident" id="6864794"><a href="/net/mockicmp_test.go.html#6864064">icmpv6EchoReply</a></span><span class="op" id="6864809">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6864813">return</span>&nbsp;<span class="ident" id="6864820"><a href="/net/mockicmp_test.go.html#6864568">b</a></span><span class="op" id="6864821">,</span>&nbsp;<span class="ident" id="6864823">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6864828">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6864831">csumcv</span>&nbsp;<span class="op" id="6864838">:=</span>&nbsp;<span class="builtinfunc" id="6864841">len</span><span class="op" id="6864844">(</span><span class="ident" id="6864845"><a href="/net/mockicmp_test.go.html#6864568">b</a></span><span class="op" id="6864846">)</span>&nbsp;<span class="op" id="6864848">-</span>&nbsp;<span class="num" id="6864850">1</span>&nbsp;<span class="comment" id="6864852">//&nbsp;checksum&nbsp;coverage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6864874">s</span>&nbsp;<span class="op" id="6864876">:=</span>&nbsp;<span class="builtintype" id="6864879">uint32</span><span class="op" id="6864885">(</span><span class="num" id="6864886">0</span><span class="op" id="6864887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6864890">for</span>&nbsp;<span class="ident" id="6864894">i</span>&nbsp;<span class="op" id="6864896">:=</span>&nbsp;<span class="num" id="6864899">0</span><span class="op" id="6864900">;</span>&nbsp;<span class="ident" id="6864902"><a href="/net/mockicmp_test.go.html#6864894">i</a></span>&nbsp;<span class="op" id="6864904">&lt;</span>&nbsp;<span class="ident" id="6864906"><a href="/net/mockicmp_test.go.html#6864831">csumcv</a></span><span class="op" id="6864912">;</span>&nbsp;<span class="ident" id="6864914"><a href="/net/mockicmp_test.go.html#6864894">i</a></span>&nbsp;<span class="op" id="6864916">+=</span>&nbsp;<span class="num" id="6864919">2</span>&nbsp;<span class="op" id="6864921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6864925"><a href="/net/mockicmp_test.go.html#6864874">s</a></span>&nbsp;<span class="op" id="6864927">+=</span>&nbsp;<span class="builtintype" id="6864930">uint32</span><span class="op" id="6864936">(</span><span class="ident" id="6864937"><a href="/net/mockicmp_test.go.html#6864568">b</a></span><span class="op" id="6864938">[</span><span class="ident" id="6864939"><a href="/net/mockicmp_test.go.html#6864894">i</a></span><span class="op" id="6864940">+</span><span class="num" id="6864941">1</span><span class="op" id="6864942">]</span><span class="op" id="6864943">)</span><span class="op" id="6864944">&lt;&lt;</span><span class="num" id="6864946">8</span>&nbsp;<span class="op" id="6864948">|</span>&nbsp;<span class="builtintype" id="6864950">uint32</span><span class="op" id="6864956">(</span><span class="ident" id="6864957"><a href="/net/mockicmp_test.go.html#6864568">b</a></span><span class="op" id="6864958">[</span><span class="ident" id="6864959"><a href="/net/mockicmp_test.go.html#6864894">i</a></span><span class="op" id="6864960">]</span><span class="op" id="6864961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6864964">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6864967">if</span>&nbsp;<span class="ident" id="6864970"><a href="/net/mockicmp_test.go.html#6864831">csumcv</a></span><span class="op" id="6864976">&amp;</span><span class="num" id="6864977">1</span>&nbsp;<span class="op" id="6864979">==</span>&nbsp;<span class="num" id="6864982">0</span>&nbsp;<span class="op" id="6864984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6864988"><a href="/net/mockicmp_test.go.html#6864874">s</a></span>&nbsp;<span class="op" id="6864990">+=</span>&nbsp;<span class="builtintype" id="6864993">uint32</span><span class="op" id="6864999">(</span><span class="ident" id="6865000"><a href="/net/mockicmp_test.go.html#6864568">b</a></span><span class="op" id="6865001">[</span><span class="ident" id="6865002"><a href="/net/mockicmp_test.go.html#6864831">csumcv</a></span><span class="op" id="6865008">]</span><span class="op" id="6865009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6865012">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6865015"><a href="/net/mockicmp_test.go.html#6864874">s</a></span>&nbsp;<span class="op" id="6865017">=</span>&nbsp;<span class="ident" id="6865019"><a href="/net/mockicmp_test.go.html#6864874">s</a></span><span class="op" id="6865020">&gt;&gt;</span><span class="num" id="6865022">16</span>&nbsp;<span class="op" id="6865025">+</span>&nbsp;<span class="ident" id="6865027"><a href="/net/mockicmp_test.go.html#6864874">s</a></span><span class="op" id="6865028">&amp;</span><span class="num" id="6865029">0xffff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6865037"><a href="/net/mockicmp_test.go.html#6864874">s</a></span>&nbsp;<span class="op" id="6865039">=</span>&nbsp;<span class="ident" id="6865041"><a href="/net/mockicmp_test.go.html#6864874">s</a></span>&nbsp;<span class="op" id="6865043">+</span>&nbsp;<span class="ident" id="6865045"><a href="/net/mockicmp_test.go.html#6864874">s</a></span><span class="op" id="6865046">&gt;&gt;</span><span class="num" id="6865048">16</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6865052">//&nbsp;Place&nbsp;checksum&nbsp;back&nbsp;in&nbsp;header;&nbsp;using&nbsp;^=&nbsp;avoids&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6865107">//&nbsp;assumption&nbsp;the&nbsp;checksum&nbsp;bytes&nbsp;are&nbsp;zero.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6865151"><a href="/net/mockicmp_test.go.html#6864568">b</a></span><span class="op" id="6865152">[</span><span class="num" id="6865153">2</span><span class="op" id="6865154">]</span>&nbsp;<span class="op" id="6865156">^=</span>&nbsp;<span class="builtintype" id="6865159">byte</span><span class="op" id="6865163">(</span><span class="op" id="6865164">^</span><span class="ident" id="6865165"><a href="/net/mockicmp_test.go.html#6864874">s</a></span><span class="op" id="6865166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6865169"><a href="/net/mockicmp_test.go.html#6864568">b</a></span><span class="op" id="6865170">[</span><span class="num" id="6865171">3</span><span class="op" id="6865172">]</span>&nbsp;<span class="op" id="6865174">^=</span>&nbsp;<span class="builtintype" id="6865177">byte</span><span class="op" id="6865181">(</span><span class="op" id="6865182">^</span><span class="ident" id="6865183"><a href="/net/mockicmp_test.go.html#6864874">s</a></span>&nbsp;<span class="op" id="6865185">&gt;&gt;</span>&nbsp;<span class="num" id="6865188">8</span><span class="op" id="6865189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6865192">return</span>&nbsp;<span class="ident" id="6865199"><a href="/net/mockicmp_test.go.html#6864568">b</a></span><span class="op" id="6865200">,</span>&nbsp;<span class="ident" id="6865202">nil</span><br>
<span class="lineno">60</span><span class="op" id="6865206">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6865209">//&nbsp;parseICMPMessage&nbsp;parses&nbsp;b&nbsp;as&nbsp;an&nbsp;ICMP&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="6865258">func</span>&nbsp;<span class="ident" id="6865263">parseICMPMessage</span><span class="op" id="6865279">(</span><span class="ident" id="6865280">b</span>&nbsp;<span class="op" id="6865282">[</span><span class="op" id="6865283">]</span><span class="builtintype" id="6865284">byte</span><span class="op" id="6865288">)</span>&nbsp;<span class="op" id="6865290">(</span><span class="op" id="6865291">*</span><span class="ident" id="6865292"><a href="/net/mockicmp_test.go.html#6864139">icmpMessage</a></span><span class="op" id="6865303">,</span>&nbsp;<span class="builtintype" id="6865305">error</span><span class="op" id="6865310">)</span>&nbsp;<span class="op" id="6865312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6865315">msglen</span>&nbsp;<span class="op" id="6865322">:=</span>&nbsp;<span class="builtinfunc" id="6865325">len</span><span class="op" id="6865328">(</span><span class="ident" id="6865329"><a href="/net/mockicmp_test.go.html#6865280">b</a></span><span class="op" id="6865330">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6865333">if</span>&nbsp;<span class="ident" id="6865336"><a href="/net/mockicmp_test.go.html#6865315">msglen</a></span>&nbsp;<span class="op" id="6865343">&lt;</span>&nbsp;<span class="num" id="6865345">4</span>&nbsp;<span class="op" id="6865347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6865351">return</span>&nbsp;<span class="ident" id="6865358">nil</span><span class="op" id="6865361">,</span>&nbsp;<span class="ident" id="6865363"><a href="/net/mockicmp_test.go.html#6863974">errors</a></span><span class="op" id="6865369">.</span><span class="ident" id="6865370">New</span><span class="op" id="6865373">(</span><span class="string" id="6865374">&#34;message&nbsp;too&nbsp;short&#34;</span><span class="op" id="6865393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6865396">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6865399">m</span>&nbsp;<span class="op" id="6865401">:=</span>&nbsp;<span class="op" id="6865404">&amp;</span><span class="ident" id="6865405"><a href="/net/mockicmp_test.go.html#6864139">icmpMessage</a></span><span class="op" id="6865416">{</span><span class="ident" id="6865417">Type</span><span class="op" id="6865421">:</span>&nbsp;<span class="builtintype" id="6865423">int</span><span class="op" id="6865426">(</span><span class="ident" id="6865427"><a href="/net/mockicmp_test.go.html#6865280">b</a></span><span class="op" id="6865428">[</span><span class="num" id="6865429">0</span><span class="op" id="6865430">]</span><span class="op" id="6865431">)</span><span class="op" id="6865432">,</span>&nbsp;<span class="ident" id="6865434">Code</span><span class="op" id="6865438">:</span>&nbsp;<span class="builtintype" id="6865440">int</span><span class="op" id="6865443">(</span><span class="ident" id="6865444"><a href="/net/mockicmp_test.go.html#6865280">b</a></span><span class="op" id="6865445">[</span><span class="num" id="6865446">1</span><span class="op" id="6865447">]</span><span class="op" id="6865448">)</span><span class="op" id="6865449">,</span>&nbsp;<span class="ident" id="6865451">Checksum</span><span class="op" id="6865459">:</span>&nbsp;<span class="builtintype" id="6865461">int</span><span class="op" id="6865464">(</span><span class="ident" id="6865465"><a href="/net/mockicmp_test.go.html#6865280">b</a></span><span class="op" id="6865466">[</span><span class="num" id="6865467">2</span><span class="op" id="6865468">]</span><span class="op" id="6865469">)</span><span class="op" id="6865470">&lt;&lt;</span><span class="num" id="6865472">8</span>&nbsp;<span class="op" id="6865474">|</span>&nbsp;<span class="builtintype" id="6865476">int</span><span class="op" id="6865479">(</span><span class="ident" id="6865480"><a href="/net/mockicmp_test.go.html#6865280">b</a></span><span class="op" id="6865481">[</span><span class="num" id="6865482">3</span><span class="op" id="6865483">]</span><span class="op" id="6865484">)</span><span class="op" id="6865485">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6865488">if</span>&nbsp;<span class="ident" id="6865491"><a href="/net/mockicmp_test.go.html#6865315">msglen</a></span>&nbsp;<span class="op" id="6865498">&gt;</span>&nbsp;<span class="num" id="6865500">4</span>&nbsp;<span class="op" id="6865502">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6865506">var</span>&nbsp;<span class="ident" id="6865510">err</span>&nbsp;<span class="builtintype" id="6865514">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6865522">switch</span>&nbsp;<span class="ident" id="6865529"><a href="/net/mockicmp_test.go.html#6865399">m</a></span><span class="op" id="6865530">.</span><span class="ident" id="6865531">Type</span>&nbsp;<span class="op" id="6865536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6865540">case</span>&nbsp;<span class="ident" id="6865545"><a href="/net/mockicmp_test.go.html#6863993">icmpv4EchoRequest</a></span><span class="op" id="6865562">,</span>&nbsp;<span class="ident" id="6865564"><a href="/net/mockicmp_test.go.html#6864016">icmpv4EchoReply</a></span><span class="op" id="6865579">,</span>&nbsp;<span class="ident" id="6865581"><a href="/net/mockicmp_test.go.html#6864039">icmpv6EchoRequest</a></span><span class="op" id="6865598">,</span>&nbsp;<span class="ident" id="6865600"><a href="/net/mockicmp_test.go.html#6864064">icmpv6EchoReply</a></span><span class="op" id="6865615">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6865620"><a href="/net/mockicmp_test.go.html#6865399">m</a></span><span class="op" id="6865621">.</span><span class="ident" id="6865622">Body</span><span class="op" id="6865626">,</span>&nbsp;<span class="ident" id="6865628"><a href="/net/mockicmp_test.go.html#6865510">err</a></span>&nbsp;<span class="op" id="6865632">=</span>&nbsp;<span class="ident" id="6865634"><a href="/net/mockicmp_test.go.html#6866361">parseICMPEcho</a></span><span class="op" id="6865647">(</span><span class="ident" id="6865648"><a href="/net/mockicmp_test.go.html#6865280">b</a></span><span class="op" id="6865649">[</span><span class="num" id="6865650">4</span><span class="op" id="6865651">:</span><span class="op" id="6865652">]</span><span class="op" id="6865653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6865658">if</span>&nbsp;<span class="ident" id="6865661"><a href="/net/mockicmp_test.go.html#6865510">err</a></span>&nbsp;<span class="op" id="6865665">!=</span>&nbsp;<span class="ident" id="6865668">nil</span>&nbsp;<span class="op" id="6865672">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6865678">return</span>&nbsp;<span class="ident" id="6865685">nil</span><span class="op" id="6865688">,</span>&nbsp;<span class="ident" id="6865690"><a href="/net/mockicmp_test.go.html#6865510">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6865697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6865701">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6865704">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6865707">return</span>&nbsp;<span class="ident" id="6865714"><a href="/net/mockicmp_test.go.html#6865399">m</a></span><span class="op" id="6865715">,</span>&nbsp;<span class="ident" id="6865717">nil</span><br>
<span class="lineno">80</span><span class="op" id="6865721">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6865724">//&nbsp;imcpEcho&nbsp;represenets&nbsp;an&nbsp;ICMP&nbsp;echo&nbsp;request&nbsp;or&nbsp;reply&nbsp;message&nbsp;body.</span><br>
<span class="lineno"></span><span class="keyword" id="6865792">type</span>&nbsp;<span class="ident" id="6865797">icmpEcho</span>&nbsp;<span class="keyword" id="6865806">struct</span>&nbsp;<span class="op" id="6865813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6865816">ID</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6865821">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6865828">//&nbsp;identifier</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6865843">Seq</span>&nbsp;&nbsp;<span class="builtintype" id="6865848">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6865855">//&nbsp;sequence&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6865875">Data</span>&nbsp;<span class="op" id="6865880">[</span><span class="op" id="6865881">]</span><span class="builtintype" id="6865882">byte</span>&nbsp;<span class="comment" id="6865887">//&nbsp;data</span><br>
<span class="lineno"></span><span class="op" id="6865895">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6865898">func</span>&nbsp;<span class="op" id="6865903">(</span><span class="ident" id="6865904">p</span>&nbsp;<span class="op" id="6865906">*</span><span class="ident" id="6865907"><a href="/net/mockicmp_test.go.html#6865797">icmpEcho</a></span><span class="op" id="6865915">)</span>&nbsp;<span class="ident" id="6865917">Len</span><span class="op" id="6865920">(</span><span class="op" id="6865921">)</span>&nbsp;<span class="builtintype" id="6865923">int</span>&nbsp;<span class="op" id="6865927">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6865930">if</span>&nbsp;<span class="ident" id="6865933"><a href="/net/mockicmp_test.go.html#6865904">p</a></span>&nbsp;<span class="op" id="6865935">==</span>&nbsp;<span class="ident" id="6865938">nil</span>&nbsp;<span class="op" id="6865942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6865946">return</span>&nbsp;<span class="num" id="6865953">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6865956">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6865959">return</span>&nbsp;<span class="num" id="6865966">4</span>&nbsp;<span class="op" id="6865968">+</span>&nbsp;<span class="builtinfunc" id="6865970">len</span><span class="op" id="6865973">(</span><span class="ident" id="6865974"><a href="/net/mockicmp_test.go.html#6865904">p</a></span><span class="op" id="6865975">.</span><span class="ident" id="6865976">Data</span><span class="op" id="6865980">)</span><br>
<span class="lineno"></span><span class="op" id="6865982">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="comment" id="6865985">//&nbsp;Marshal&nbsp;returns&nbsp;the&nbsp;binary&nbsp;enconding&nbsp;of&nbsp;the&nbsp;ICMP&nbsp;echo&nbsp;request&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="6866053">//&nbsp;reply&nbsp;message&nbsp;body&nbsp;p.</span><br>
<span class="lineno"></span><span class="keyword" id="6866078">func</span>&nbsp;<span class="op" id="6866083">(</span><span class="ident" id="6866084">p</span>&nbsp;<span class="op" id="6866086">*</span><span class="ident" id="6866087"><a href="/net/mockicmp_test.go.html#6865797">icmpEcho</a></span><span class="op" id="6866095">)</span>&nbsp;<span class="ident" id="6866097">Marshal</span><span class="op" id="6866104">(</span><span class="op" id="6866105">)</span>&nbsp;<span class="op" id="6866107">(</span><span class="op" id="6866108">[</span><span class="op" id="6866109">]</span><span class="builtintype" id="6866110">byte</span><span class="op" id="6866114">,</span>&nbsp;<span class="builtintype" id="6866116">error</span><span class="op" id="6866121">)</span>&nbsp;<span class="op" id="6866123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6866126">b</span>&nbsp;<span class="op" id="6866128">:=</span>&nbsp;<span class="builtinfunc" id="6866131">make</span><span class="op" id="6866135">(</span><span class="op" id="6866136">[</span><span class="op" id="6866137">]</span><span class="builtintype" id="6866138">byte</span><span class="op" id="6866142">,</span>&nbsp;<span class="num" id="6866144">4</span><span class="op" id="6866145">+</span><span class="builtinfunc" id="6866146">len</span><span class="op" id="6866149">(</span><span class="ident" id="6866150"><a href="/net/mockicmp_test.go.html#6866084">p</a></span><span class="op" id="6866151">.</span><span class="ident" id="6866152">Data</span><span class="op" id="6866156">)</span><span class="op" id="6866157">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6866160"><a href="/net/mockicmp_test.go.html#6866126">b</a></span><span class="op" id="6866161">[</span><span class="num" id="6866162">0</span><span class="op" id="6866163">]</span><span class="op" id="6866164">,</span>&nbsp;<span class="ident" id="6866166"><a href="/net/mockicmp_test.go.html#6866126">b</a></span><span class="op" id="6866167">[</span><span class="num" id="6866168">1</span><span class="op" id="6866169">]</span>&nbsp;<span class="op" id="6866171">=</span>&nbsp;<span class="builtintype" id="6866173">byte</span><span class="op" id="6866177">(</span><span class="ident" id="6866178"><a href="/net/mockicmp_test.go.html#6866084">p</a></span><span class="op" id="6866179">.</span><span class="ident" id="6866180">ID</span><span class="op" id="6866182">&gt;&gt;</span><span class="num" id="6866184">8</span><span class="op" id="6866185">)</span><span class="op" id="6866186">,</span>&nbsp;<span class="builtintype" id="6866188">byte</span><span class="op" id="6866192">(</span><span class="ident" id="6866193"><a href="/net/mockicmp_test.go.html#6866084">p</a></span><span class="op" id="6866194">.</span><span class="ident" id="6866195">ID</span><span class="op" id="6866197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6866200"><a href="/net/mockicmp_test.go.html#6866126">b</a></span><span class="op" id="6866201">[</span><span class="num" id="6866202">2</span><span class="op" id="6866203">]</span><span class="op" id="6866204">,</span>&nbsp;<span class="ident" id="6866206"><a href="/net/mockicmp_test.go.html#6866126">b</a></span><span class="op" id="6866207">[</span><span class="num" id="6866208">3</span><span class="op" id="6866209">]</span>&nbsp;<span class="op" id="6866211">=</span>&nbsp;<span class="builtintype" id="6866213">byte</span><span class="op" id="6866217">(</span><span class="ident" id="6866218"><a href="/net/mockicmp_test.go.html#6866084">p</a></span><span class="op" id="6866219">.</span><span class="ident" id="6866220">Seq</span><span class="op" id="6866223">&gt;&gt;</span><span class="num" id="6866225">8</span><span class="op" id="6866226">)</span><span class="op" id="6866227">,</span>&nbsp;<span class="builtintype" id="6866229">byte</span><span class="op" id="6866233">(</span><span class="ident" id="6866234"><a href="/net/mockicmp_test.go.html#6866084">p</a></span><span class="op" id="6866235">.</span><span class="ident" id="6866236">Seq</span><span class="op" id="6866239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6866242">copy</span><span class="op" id="6866246">(</span><span class="ident" id="6866247"><a href="/net/mockicmp_test.go.html#6866126">b</a></span><span class="op" id="6866248">[</span><span class="num" id="6866249">4</span><span class="op" id="6866250">:</span><span class="op" id="6866251">]</span><span class="op" id="6866252">,</span>&nbsp;<span class="ident" id="6866254"><a href="/net/mockicmp_test.go.html#6866084">p</a></span><span class="op" id="6866255">.</span><span class="ident" id="6866256">Data</span><span class="op" id="6866260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6866263">return</span>&nbsp;<span class="ident" id="6866270"><a href="/net/mockicmp_test.go.html#6866126">b</a></span><span class="op" id="6866271">,</span>&nbsp;<span class="ident" id="6866273">nil</span><br>
<span class="lineno"></span><span class="op" id="6866277">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="comment" id="6866280">//&nbsp;parseICMPEcho&nbsp;parses&nbsp;b&nbsp;as&nbsp;an&nbsp;ICMP&nbsp;echo&nbsp;request&nbsp;or&nbsp;reply&nbsp;message</span><br>
<span class="lineno"></span><span class="comment" id="6866347">//&nbsp;body.</span><br>
<span class="lineno"></span><span class="keyword" id="6866356">func</span>&nbsp;<span class="ident" id="6866361">parseICMPEcho</span><span class="op" id="6866374">(</span><span class="ident" id="6866375">b</span>&nbsp;<span class="op" id="6866377">[</span><span class="op" id="6866378">]</span><span class="builtintype" id="6866379">byte</span><span class="op" id="6866383">)</span>&nbsp;<span class="op" id="6866385">(</span><span class="op" id="6866386">*</span><span class="ident" id="6866387"><a href="/net/mockicmp_test.go.html#6865797">icmpEcho</a></span><span class="op" id="6866395">,</span>&nbsp;<span class="builtintype" id="6866397">error</span><span class="op" id="6866402">)</span>&nbsp;<span class="op" id="6866404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6866407">bodylen</span>&nbsp;<span class="op" id="6866415">:=</span>&nbsp;<span class="builtinfunc" id="6866418">len</span><span class="op" id="6866421">(</span><span class="ident" id="6866422"><a href="/net/mockicmp_test.go.html#6866375">b</a></span><span class="op" id="6866423">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6866426">p</span>&nbsp;<span class="op" id="6866428">:=</span>&nbsp;<span class="op" id="6866431">&amp;</span><span class="ident" id="6866432"><a href="/net/mockicmp_test.go.html#6865797">icmpEcho</a></span><span class="op" id="6866440">{</span><span class="ident" id="6866441">ID</span><span class="op" id="6866443">:</span>&nbsp;<span class="builtintype" id="6866445">int</span><span class="op" id="6866448">(</span><span class="ident" id="6866449"><a href="/net/mockicmp_test.go.html#6866375">b</a></span><span class="op" id="6866450">[</span><span class="num" id="6866451">0</span><span class="op" id="6866452">]</span><span class="op" id="6866453">)</span><span class="op" id="6866454">&lt;&lt;</span><span class="num" id="6866456">8</span>&nbsp;<span class="op" id="6866458">|</span>&nbsp;<span class="builtintype" id="6866460">int</span><span class="op" id="6866463">(</span><span class="ident" id="6866464"><a href="/net/mockicmp_test.go.html#6866375">b</a></span><span class="op" id="6866465">[</span><span class="num" id="6866466">1</span><span class="op" id="6866467">]</span><span class="op" id="6866468">)</span><span class="op" id="6866469">,</span>&nbsp;<span class="ident" id="6866471">Seq</span><span class="op" id="6866474">:</span>&nbsp;<span class="builtintype" id="6866476">int</span><span class="op" id="6866479">(</span><span class="ident" id="6866480"><a href="/net/mockicmp_test.go.html#6866375">b</a></span><span class="op" id="6866481">[</span><span class="num" id="6866482">2</span><span class="op" id="6866483">]</span><span class="op" id="6866484">)</span><span class="op" id="6866485">&lt;&lt;</span><span class="num" id="6866487">8</span>&nbsp;<span class="op" id="6866489">|</span>&nbsp;<span class="builtintype" id="6866491">int</span><span class="op" id="6866494">(</span><span class="ident" id="6866495"><a href="/net/mockicmp_test.go.html#6866375">b</a></span><span class="op" id="6866496">[</span><span class="num" id="6866497">3</span><span class="op" id="6866498">]</span><span class="op" id="6866499">)</span><span class="op" id="6866500">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6866503">if</span>&nbsp;<span class="ident" id="6866506"><a href="/net/mockicmp_test.go.html#6866407">bodylen</a></span>&nbsp;<span class="op" id="6866514">&gt;</span>&nbsp;<span class="num" id="6866516">4</span>&nbsp;<span class="op" id="6866518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6866522"><a href="/net/mockicmp_test.go.html#6866426">p</a></span><span class="op" id="6866523">.</span><span class="ident" id="6866524">Data</span>&nbsp;<span class="op" id="6866529">=</span>&nbsp;<span class="builtinfunc" id="6866531">make</span><span class="op" id="6866535">(</span><span class="op" id="6866536">[</span><span class="op" id="6866537">]</span><span class="builtintype" id="6866538">byte</span><span class="op" id="6866542">,</span>&nbsp;<span class="ident" id="6866544"><a href="/net/mockicmp_test.go.html#6866407">bodylen</a></span><span class="op" id="6866551">-</span><span class="num" id="6866552">4</span><span class="op" id="6866553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6866557">copy</span><span class="op" id="6866561">(</span><span class="ident" id="6866562"><a href="/net/mockicmp_test.go.html#6866426">p</a></span><span class="op" id="6866563">.</span><span class="ident" id="6866564">Data</span><span class="op" id="6866568">,</span>&nbsp;<span class="ident" id="6866570"><a href="/net/mockicmp_test.go.html#6866375">b</a></span><span class="op" id="6866571">[</span><span class="num" id="6866572">4</span><span class="op" id="6866573">:</span><span class="op" id="6866574">]</span><span class="op" id="6866575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6866578">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6866581">return</span>&nbsp;<span class="ident" id="6866588"><a href="/net/mockicmp_test.go.html#6866426">p</a></span><span class="op" id="6866589">,</span>&nbsp;<span class="ident" id="6866591">nil</span><br>
<span class="lineno"></span><span class="op" id="6866595">}</span>
</div>
</body>
</html>
