<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/token</h2>
<ul>
<li><a href="/gostd/go/token/position.go.html">position.go</a></li>
<li><a href="/gostd/go/token/position_test.go.html">position_test.go</a></li>
<li><a href="/gostd/go/token/serialize.go.html">serialize.go</a></li>
<li><a href="/gostd/go/token/serialize_test.go.html" class="current">serialize_test.go</a></li>
<li><a href="/gostd/go/token/token.go.html">token.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8081137">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8081192">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8081246">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8081297">package</span>&nbsp;<span class="ident" id="8081305">token</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8081312">import</span>&nbsp;<span class="op" id="8081319">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8081322">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8081331">&#34;encoding/gob&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8081347">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8081354">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8081364">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8081367">//&nbsp;equal&nbsp;returns&nbsp;nil&nbsp;if&nbsp;p&nbsp;and&nbsp;q&nbsp;describe&nbsp;the&nbsp;same&nbsp;file&nbsp;set;</span><br>
<span class="lineno">15</span><span class="comment" id="8081427">//&nbsp;otherwise&nbsp;it&nbsp;returns&nbsp;an&nbsp;error&nbsp;describing&nbsp;the&nbsp;discrepancy.</span><br>
<span class="lineno"></span><span class="keyword" id="8081488">func</span>&nbsp;<span class="ident" id="8081493">equal</span><span class="op" id="8081498">(</span><span class="ident" id="8081499">p</span><span class="op" id="8081500">,</span>&nbsp;<span class="ident" id="8081502">q</span>&nbsp;<span class="op" id="8081504">*</span><span class="ident" id="8081505">FileSet</span><span class="op" id="8081512">)</span>&nbsp;<span class="builtintype" id="8081514">error</span>&nbsp;<span class="op" id="8081520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8081523">if</span>&nbsp;<span class="ident" id="8081526">p</span>&nbsp;<span class="op" id="8081528">==</span>&nbsp;<span class="ident" id="8081531">q</span>&nbsp;<span class="op" id="8081533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8081537">//&nbsp;avoid&nbsp;deadlock&nbsp;if&nbsp;p&nbsp;==&nbsp;q</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8081567">return</span>&nbsp;<span class="builtintype" id="8081574">nil</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8081579">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8081583">//&nbsp;not&nbsp;strictly&nbsp;needed&nbsp;for&nbsp;the&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8081620">p</span><span class="op" id="8081621">.</span><span class="ident" id="8081622">mutex</span><span class="op" id="8081627">.</span><span class="ident" id="8081628">Lock</span><span class="op" id="8081632">(</span><span class="op" id="8081633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8081636">q</span><span class="op" id="8081637">.</span><span class="ident" id="8081638">mutex</span><span class="op" id="8081643">.</span><span class="ident" id="8081644">Lock</span><span class="op" id="8081648">(</span><span class="op" id="8081649">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8081652">defer</span>&nbsp;<span class="ident" id="8081658">q</span><span class="op" id="8081659">.</span><span class="ident" id="8081660">mutex</span><span class="op" id="8081665">.</span><span class="ident" id="8081666">Unlock</span><span class="op" id="8081672">(</span><span class="op" id="8081673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8081676">defer</span>&nbsp;<span class="ident" id="8081682">p</span><span class="op" id="8081683">.</span><span class="ident" id="8081684">mutex</span><span class="op" id="8081689">.</span><span class="ident" id="8081690">Unlock</span><span class="op" id="8081696">(</span><span class="op" id="8081697">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8081701">if</span>&nbsp;<span class="ident" id="8081704">p</span><span class="op" id="8081705">.</span><span class="ident" id="8081706">base</span>&nbsp;<span class="op" id="8081711">!=</span>&nbsp;<span class="ident" id="8081714">q</span><span class="op" id="8081715">.</span><span class="ident" id="8081716">base</span>&nbsp;<span class="op" id="8081721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8081725">return</span>&nbsp;<span class="ident" id="8081732">fmt</span><span class="op" id="8081735">.</span><span class="ident" id="8081736">Errorf</span><span class="op" id="8081742">(</span><span class="string" id="8081743">&#34;different&nbsp;bases:&nbsp;%d&nbsp;!=&nbsp;%d&#34;</span><span class="op" id="8081770">,</span>&nbsp;<span class="ident" id="8081772">p</span><span class="op" id="8081773">.</span><span class="ident" id="8081774">base</span><span class="op" id="8081778">,</span>&nbsp;<span class="ident" id="8081780">q</span><span class="op" id="8081781">.</span><span class="ident" id="8081782">base</span><span class="op" id="8081786">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8081789">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8081793">if</span>&nbsp;<span class="builtinfunc" id="8081796">len</span><span class="op" id="8081799">(</span><span class="ident" id="8081800">p</span><span class="op" id="8081801">.</span><span class="ident" id="8081802">files</span><span class="op" id="8081807">)</span>&nbsp;<span class="op" id="8081809">!=</span>&nbsp;<span class="builtinfunc" id="8081812">len</span><span class="op" id="8081815">(</span><span class="ident" id="8081816">q</span><span class="op" id="8081817">.</span><span class="ident" id="8081818">files</span><span class="op" id="8081823">)</span>&nbsp;<span class="op" id="8081825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8081829">return</span>&nbsp;<span class="ident" id="8081836">fmt</span><span class="op" id="8081839">.</span><span class="ident" id="8081840">Errorf</span><span class="op" id="8081846">(</span><span class="string" id="8081847">&#34;different&nbsp;number&nbsp;of&nbsp;files:&nbsp;%d&nbsp;!=&nbsp;%d&#34;</span><span class="op" id="8081884">,</span>&nbsp;<span class="builtinfunc" id="8081886">len</span><span class="op" id="8081889">(</span><span class="ident" id="8081890">p</span><span class="op" id="8081891">.</span><span class="ident" id="8081892">files</span><span class="op" id="8081897">)</span><span class="op" id="8081898">,</span>&nbsp;<span class="builtinfunc" id="8081900">len</span><span class="op" id="8081903">(</span><span class="ident" id="8081904">q</span><span class="op" id="8081905">.</span><span class="ident" id="8081906">files</span><span class="op" id="8081911">)</span><span class="op" id="8081912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8081915">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8081919">for</span>&nbsp;<span class="ident" id="8081923">i</span><span class="op" id="8081924">,</span>&nbsp;<span class="ident" id="8081926">f</span>&nbsp;<span class="op" id="8081928">:=</span>&nbsp;<span class="keyword" id="8081931">range</span>&nbsp;<span class="ident" id="8081937">p</span><span class="op" id="8081938">.</span><span class="ident" id="8081939">files</span>&nbsp;<span class="op" id="8081945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8081949">g</span>&nbsp;<span class="op" id="8081951">:=</span>&nbsp;<span class="ident" id="8081954">q</span><span class="op" id="8081955">.</span><span class="ident" id="8081956">files</span><span class="op" id="8081961">[</span><span class="ident" id="8081962">i</span><span class="op" id="8081963">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8081967">if</span>&nbsp;<span class="ident" id="8081970">f</span><span class="op" id="8081971">.</span><span class="ident" id="8081972">set</span>&nbsp;<span class="op" id="8081976">!=</span>&nbsp;<span class="ident" id="8081979">p</span>&nbsp;<span class="op" id="8081981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8081986">return</span>&nbsp;<span class="ident" id="8081993">fmt</span><span class="op" id="8081996">.</span><span class="ident" id="8081997">Errorf</span><span class="op" id="8082003">(</span><span class="string" id="8082004">&#34;wrong&nbsp;fileset&nbsp;for&nbsp;%q&#34;</span><span class="op" id="8082026">,</span>&nbsp;<span class="ident" id="8082028">f</span><span class="op" id="8082029">.</span><span class="ident" id="8082030">name</span><span class="op" id="8082034">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8082038">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8082042">if</span>&nbsp;<span class="ident" id="8082045">g</span><span class="op" id="8082046">.</span><span class="ident" id="8082047">set</span>&nbsp;<span class="op" id="8082051">!=</span>&nbsp;<span class="ident" id="8082054">q</span>&nbsp;<span class="op" id="8082056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8082061">return</span>&nbsp;<span class="ident" id="8082068">fmt</span><span class="op" id="8082071">.</span><span class="ident" id="8082072">Errorf</span><span class="op" id="8082078">(</span><span class="string" id="8082079">&#34;wrong&nbsp;fileset&nbsp;for&nbsp;%q&#34;</span><span class="op" id="8082101">,</span>&nbsp;<span class="ident" id="8082103">g</span><span class="op" id="8082104">.</span><span class="ident" id="8082105">name</span><span class="op" id="8082109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8082113">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8082117">if</span>&nbsp;<span class="ident" id="8082120">f</span><span class="op" id="8082121">.</span><span class="ident" id="8082122">name</span>&nbsp;<span class="op" id="8082127">!=</span>&nbsp;<span class="ident" id="8082130">g</span><span class="op" id="8082131">.</span><span class="ident" id="8082132">name</span>&nbsp;<span class="op" id="8082137">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8082142">return</span>&nbsp;<span class="ident" id="8082149">fmt</span><span class="op" id="8082152">.</span><span class="ident" id="8082153">Errorf</span><span class="op" id="8082159">(</span><span class="string" id="8082160">&#34;different&nbsp;filenames:&nbsp;%q&nbsp;!=&nbsp;%q&#34;</span><span class="op" id="8082191">,</span>&nbsp;<span class="ident" id="8082193">f</span><span class="op" id="8082194">.</span><span class="ident" id="8082195">name</span><span class="op" id="8082199">,</span>&nbsp;<span class="ident" id="8082201">g</span><span class="op" id="8082202">.</span><span class="ident" id="8082203">name</span><span class="op" id="8082207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8082211">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8082215">if</span>&nbsp;<span class="ident" id="8082218">f</span><span class="op" id="8082219">.</span><span class="ident" id="8082220">base</span>&nbsp;<span class="op" id="8082225">!=</span>&nbsp;<span class="ident" id="8082228">g</span><span class="op" id="8082229">.</span><span class="ident" id="8082230">base</span>&nbsp;<span class="op" id="8082235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8082240">return</span>&nbsp;<span class="ident" id="8082247">fmt</span><span class="op" id="8082250">.</span><span class="ident" id="8082251">Errorf</span><span class="op" id="8082257">(</span><span class="string" id="8082258">&#34;different&nbsp;base&nbsp;for&nbsp;%q:&nbsp;%d&nbsp;!=&nbsp;%d&#34;</span><span class="op" id="8082291">,</span>&nbsp;<span class="ident" id="8082293">f</span><span class="op" id="8082294">.</span><span class="ident" id="8082295">name</span><span class="op" id="8082299">,</span>&nbsp;<span class="ident" id="8082301">f</span><span class="op" id="8082302">.</span><span class="ident" id="8082303">base</span><span class="op" id="8082307">,</span>&nbsp;<span class="ident" id="8082309">g</span><span class="op" id="8082310">.</span><span class="ident" id="8082311">base</span><span class="op" id="8082315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8082319">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8082323">if</span>&nbsp;<span class="ident" id="8082326">f</span><span class="op" id="8082327">.</span><span class="ident" id="8082328">size</span>&nbsp;<span class="op" id="8082333">!=</span>&nbsp;<span class="ident" id="8082336">g</span><span class="op" id="8082337">.</span><span class="ident" id="8082338">size</span>&nbsp;<span class="op" id="8082343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8082348">return</span>&nbsp;<span class="ident" id="8082355">fmt</span><span class="op" id="8082358">.</span><span class="ident" id="8082359">Errorf</span><span class="op" id="8082365">(</span><span class="string" id="8082366">&#34;different&nbsp;size&nbsp;for&nbsp;%q:&nbsp;%d&nbsp;!=&nbsp;%d&#34;</span><span class="op" id="8082399">,</span>&nbsp;<span class="ident" id="8082401">f</span><span class="op" id="8082402">.</span><span class="ident" id="8082403">name</span><span class="op" id="8082407">,</span>&nbsp;<span class="ident" id="8082409">f</span><span class="op" id="8082410">.</span><span class="ident" id="8082411">size</span><span class="op" id="8082415">,</span>&nbsp;<span class="ident" id="8082417">g</span><span class="op" id="8082418">.</span><span class="ident" id="8082419">size</span><span class="op" id="8082423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8082427">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8082431">for</span>&nbsp;<span class="ident" id="8082435">j</span><span class="op" id="8082436">,</span>&nbsp;<span class="ident" id="8082438">l</span>&nbsp;<span class="op" id="8082440">:=</span>&nbsp;<span class="keyword" id="8082443">range</span>&nbsp;<span class="ident" id="8082449">f</span><span class="op" id="8082450">.</span><span class="ident" id="8082451">lines</span>&nbsp;<span class="op" id="8082457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8082462">m</span>&nbsp;<span class="op" id="8082464">:=</span>&nbsp;<span class="ident" id="8082467">g</span><span class="op" id="8082468">.</span><span class="ident" id="8082469">lines</span><span class="op" id="8082474">[</span><span class="ident" id="8082475">j</span><span class="op" id="8082476">]</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8082481">if</span>&nbsp;<span class="ident" id="8082484">l</span>&nbsp;<span class="op" id="8082486">!=</span>&nbsp;<span class="ident" id="8082489">m</span>&nbsp;<span class="op" id="8082491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8082497">return</span>&nbsp;<span class="ident" id="8082504">fmt</span><span class="op" id="8082507">.</span><span class="ident" id="8082508">Errorf</span><span class="op" id="8082514">(</span><span class="string" id="8082515">&#34;different&nbsp;offsets&nbsp;for&nbsp;%q&#34;</span><span class="op" id="8082541">,</span>&nbsp;<span class="ident" id="8082543">f</span><span class="op" id="8082544">.</span><span class="ident" id="8082545">name</span><span class="op" id="8082549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8082554">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8082558">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8082562">for</span>&nbsp;<span class="ident" id="8082566">j</span><span class="op" id="8082567">,</span>&nbsp;<span class="ident" id="8082569">l</span>&nbsp;<span class="op" id="8082571">:=</span>&nbsp;<span class="keyword" id="8082574">range</span>&nbsp;<span class="ident" id="8082580">f</span><span class="op" id="8082581">.</span><span class="ident" id="8082582">infos</span>&nbsp;<span class="op" id="8082588">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8082593">m</span>&nbsp;<span class="op" id="8082595">:=</span>&nbsp;<span class="ident" id="8082598">g</span><span class="op" id="8082599">.</span><span class="ident" id="8082600">infos</span><span class="op" id="8082605">[</span><span class="ident" id="8082606">j</span><span class="op" id="8082607">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8082612">if</span>&nbsp;<span class="ident" id="8082615">l</span><span class="op" id="8082616">.</span><span class="ident" id="8082617">Offset</span>&nbsp;<span class="op" id="8082624">!=</span>&nbsp;<span class="ident" id="8082627">m</span><span class="op" id="8082628">.</span><span class="ident" id="8082629">Offset</span>&nbsp;<span class="op" id="8082636">||</span>&nbsp;<span class="ident" id="8082639">l</span><span class="op" id="8082640">.</span><span class="ident" id="8082641">Filename</span>&nbsp;<span class="op" id="8082650">!=</span>&nbsp;<span class="ident" id="8082653">m</span><span class="op" id="8082654">.</span><span class="ident" id="8082655">Filename</span>&nbsp;<span class="op" id="8082664">||</span>&nbsp;<span class="ident" id="8082667">l</span><span class="op" id="8082668">.</span><span class="ident" id="8082669">Line</span>&nbsp;<span class="op" id="8082674">!=</span>&nbsp;<span class="ident" id="8082677">m</span><span class="op" id="8082678">.</span><span class="ident" id="8082679">Line</span>&nbsp;<span class="op" id="8082684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8082690">return</span>&nbsp;<span class="ident" id="8082697">fmt</span><span class="op" id="8082700">.</span><span class="ident" id="8082701">Errorf</span><span class="op" id="8082707">(</span><span class="string" id="8082708">&#34;different&nbsp;infos&nbsp;for&nbsp;%q&#34;</span><span class="op" id="8082732">,</span>&nbsp;<span class="ident" id="8082734">f</span><span class="op" id="8082735">.</span><span class="ident" id="8082736">name</span><span class="op" id="8082740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8082745">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8082749">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8082752">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8082756">//&nbsp;we&nbsp;don&#39;t&nbsp;care&nbsp;about&nbsp;.last&nbsp;-&nbsp;it&#39;s&nbsp;just&nbsp;a&nbsp;cache</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8082806">return</span>&nbsp;<span class="builtintype" id="8082813">nil</span><br>
<span class="lineno"></span><span class="op" id="8082817">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="8082820">func</span>&nbsp;<span class="ident" id="8082825">checkSerialize</span><span class="op" id="8082839">(</span><span class="ident" id="8082840">t</span>&nbsp;<span class="op" id="8082842">*</span><span class="ident" id="8082843">testing</span><span class="op" id="8082850">.</span><span class="ident" id="8082851">T</span><span class="op" id="8082852">,</span>&nbsp;<span class="ident" id="8082854">p</span>&nbsp;<span class="op" id="8082856">*</span><span class="ident" id="8082857">FileSet</span><span class="op" id="8082864">)</span>&nbsp;<span class="op" id="8082866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8082869">var</span>&nbsp;<span class="ident" id="8082873">buf</span>&nbsp;<span class="ident" id="8082877">bytes</span><span class="op" id="8082882">.</span><span class="ident" id="8082883">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8082891">encode</span>&nbsp;<span class="op" id="8082898">:=</span>&nbsp;<span class="keyword" id="8082901">func</span><span class="op" id="8082905">(</span><span class="ident" id="8082906">x</span>&nbsp;<span class="keyword" id="8082908">interface</span><span class="op" id="8082917">{</span><span class="op" id="8082918">}</span><span class="op" id="8082919">)</span>&nbsp;<span class="builtintype" id="8082921">error</span>&nbsp;<span class="op" id="8082927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8082931">return</span>&nbsp;<span class="ident" id="8082938">gob</span><span class="op" id="8082941">.</span><span class="ident" id="8082942">NewEncoder</span><span class="op" id="8082952">(</span><span class="op" id="8082953">&amp;</span><span class="ident" id="8082954">buf</span><span class="op" id="8082957">)</span><span class="op" id="8082958">.</span><span class="ident" id="8082959">Encode</span><span class="op" id="8082965">(</span><span class="ident" id="8082966">x</span><span class="op" id="8082967">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8082970">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8082973">if</span>&nbsp;<span class="ident" id="8082976">err</span>&nbsp;<span class="op" id="8082980">:=</span>&nbsp;<span class="ident" id="8082983">p</span><span class="op" id="8082984">.</span><span class="ident" id="8082985">Write</span><span class="op" id="8082990">(</span><span class="ident" id="8082991">encode</span><span class="op" id="8082997">)</span><span class="op" id="8082998">;</span>&nbsp;<span class="ident" id="8083000">err</span>&nbsp;<span class="op" id="8083004">!=</span>&nbsp;<span class="builtintype" id="8083007">nil</span>&nbsp;<span class="op" id="8083011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8083015">t</span><span class="op" id="8083016">.</span><span class="ident" id="8083017">Errorf</span><span class="op" id="8083023">(</span><span class="string" id="8083024">&#34;writing&nbsp;fileset&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="8083052">,</span>&nbsp;<span class="ident" id="8083054">err</span><span class="op" id="8083057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8083061">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8083069">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8083072">q</span>&nbsp;<span class="op" id="8083074">:=</span>&nbsp;<span class="ident" id="8083077">NewFileSet</span><span class="op" id="8083087">(</span><span class="op" id="8083088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8083091">decode</span>&nbsp;<span class="op" id="8083098">:=</span>&nbsp;<span class="keyword" id="8083101">func</span><span class="op" id="8083105">(</span><span class="ident" id="8083106">x</span>&nbsp;<span class="keyword" id="8083108">interface</span><span class="op" id="8083117">{</span><span class="op" id="8083118">}</span><span class="op" id="8083119">)</span>&nbsp;<span class="builtintype" id="8083121">error</span>&nbsp;<span class="op" id="8083127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8083131">return</span>&nbsp;<span class="ident" id="8083138">gob</span><span class="op" id="8083141">.</span><span class="ident" id="8083142">NewDecoder</span><span class="op" id="8083152">(</span><span class="op" id="8083153">&amp;</span><span class="ident" id="8083154">buf</span><span class="op" id="8083157">)</span><span class="op" id="8083158">.</span><span class="ident" id="8083159">Decode</span><span class="op" id="8083165">(</span><span class="ident" id="8083166">x</span><span class="op" id="8083167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8083170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8083173">if</span>&nbsp;<span class="ident" id="8083176">err</span>&nbsp;<span class="op" id="8083180">:=</span>&nbsp;<span class="ident" id="8083183">q</span><span class="op" id="8083184">.</span><span class="ident" id="8083185">Read</span><span class="op" id="8083189">(</span><span class="ident" id="8083190">decode</span><span class="op" id="8083196">)</span><span class="op" id="8083197">;</span>&nbsp;<span class="ident" id="8083199">err</span>&nbsp;<span class="op" id="8083203">!=</span>&nbsp;<span class="builtintype" id="8083206">nil</span>&nbsp;<span class="op" id="8083210">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8083214">t</span><span class="op" id="8083215">.</span><span class="ident" id="8083216">Errorf</span><span class="op" id="8083222">(</span><span class="string" id="8083223">&#34;reading&nbsp;fileset&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="8083251">,</span>&nbsp;<span class="ident" id="8083253">err</span><span class="op" id="8083256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8083260">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8083268">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8083271">if</span>&nbsp;<span class="ident" id="8083274">err</span>&nbsp;<span class="op" id="8083278">:=</span>&nbsp;<span class="ident" id="8083281">equal</span><span class="op" id="8083286">(</span><span class="ident" id="8083287">p</span><span class="op" id="8083288">,</span>&nbsp;<span class="ident" id="8083290">q</span><span class="op" id="8083291">)</span><span class="op" id="8083292">;</span>&nbsp;<span class="ident" id="8083294">err</span>&nbsp;<span class="op" id="8083298">!=</span>&nbsp;<span class="builtintype" id="8083301">nil</span>&nbsp;<span class="op" id="8083305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8083309">t</span><span class="op" id="8083310">.</span><span class="ident" id="8083311">Errorf</span><span class="op" id="8083317">(</span><span class="string" id="8083318">&#34;filesets&nbsp;not&nbsp;identical:&nbsp;%s&#34;</span><span class="op" id="8083346">,</span>&nbsp;<span class="ident" id="8083348">err</span><span class="op" id="8083351">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8083354">}</span><br>
<span class="lineno"></span><span class="op" id="8083356">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8083359">func</span>&nbsp;<span class="ident" id="8083364">TestSerialization</span><span class="op" id="8083381">(</span><span class="ident" id="8083382">t</span>&nbsp;<span class="op" id="8083384">*</span><span class="ident" id="8083385">testing</span><span class="op" id="8083392">.</span><span class="ident" id="8083393">T</span><span class="op" id="8083394">)</span>&nbsp;<span class="op" id="8083396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8083399">p</span>&nbsp;<span class="op" id="8083401">:=</span>&nbsp;<span class="ident" id="8083404">NewFileSet</span><span class="op" id="8083414">(</span><span class="op" id="8083415">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8083418">checkSerialize</span><span class="op" id="8083432">(</span><span class="ident" id="8083433">t</span><span class="op" id="8083434">,</span>&nbsp;<span class="ident" id="8083436">p</span><span class="op" id="8083437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8083440">//&nbsp;add&nbsp;some&nbsp;files</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8083459">for</span>&nbsp;<span class="ident" id="8083463">i</span>&nbsp;<span class="op" id="8083465">:=</span>&nbsp;<span class="num" id="8083468">0</span><span class="op" id="8083469">;</span>&nbsp;<span class="ident" id="8083471">i</span>&nbsp;<span class="op" id="8083473">&lt;</span>&nbsp;<span class="num" id="8083475">10</span><span class="op" id="8083477">;</span>&nbsp;<span class="ident" id="8083479">i</span><span class="op" id="8083480">++</span>&nbsp;<span class="op" id="8083483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8083487">f</span>&nbsp;<span class="op" id="8083489">:=</span>&nbsp;<span class="ident" id="8083492">p</span><span class="op" id="8083493">.</span><span class="ident" id="8083494">AddFile</span><span class="op" id="8083501">(</span><span class="ident" id="8083502">fmt</span><span class="op" id="8083505">.</span><span class="ident" id="8083506">Sprintf</span><span class="op" id="8083513">(</span><span class="string" id="8083514">&#34;file%d&#34;</span><span class="op" id="8083522">,</span>&nbsp;<span class="ident" id="8083524">i</span><span class="op" id="8083525">)</span><span class="op" id="8083526">,</span>&nbsp;<span class="ident" id="8083528">p</span><span class="op" id="8083529">.</span><span class="ident" id="8083530">Base</span><span class="op" id="8083534">(</span><span class="op" id="8083535">)</span><span class="op" id="8083536">+</span><span class="ident" id="8083537">i</span><span class="op" id="8083538">,</span>&nbsp;<span class="ident" id="8083540">i</span><span class="op" id="8083541">*</span><span class="num" id="8083542">100</span><span class="op" id="8083545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8083549">checkSerialize</span><span class="op" id="8083563">(</span><span class="ident" id="8083564">t</span><span class="op" id="8083565">,</span>&nbsp;<span class="ident" id="8083567">p</span><span class="op" id="8083568">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8083572">//&nbsp;add&nbsp;some&nbsp;lines&nbsp;and&nbsp;alternative&nbsp;file&nbsp;infos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8083619">line</span>&nbsp;<span class="op" id="8083624">:=</span>&nbsp;<span class="num" id="8083627">1000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8083634">for</span>&nbsp;<span class="ident" id="8083638">offs</span>&nbsp;<span class="op" id="8083643">:=</span>&nbsp;<span class="num" id="8083646">0</span><span class="op" id="8083647">;</span>&nbsp;<span class="ident" id="8083649">offs</span>&nbsp;<span class="op" id="8083654">&lt;</span>&nbsp;<span class="ident" id="8083656">f</span><span class="op" id="8083657">.</span><span class="ident" id="8083658">Size</span><span class="op" id="8083662">(</span><span class="op" id="8083663">)</span><span class="op" id="8083664">;</span>&nbsp;<span class="ident" id="8083666">offs</span>&nbsp;<span class="op" id="8083671">+=</span>&nbsp;<span class="num" id="8083674">40</span>&nbsp;<span class="op" id="8083677">+</span>&nbsp;<span class="ident" id="8083679">i</span>&nbsp;<span class="op" id="8083681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8083686">f</span><span class="op" id="8083687">.</span><span class="ident" id="8083688">AddLine</span><span class="op" id="8083695">(</span><span class="ident" id="8083696">offs</span><span class="op" id="8083700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8083705">if</span>&nbsp;<span class="ident" id="8083708">offs</span><span class="op" id="8083712">%</span><span class="num" id="8083713">7</span>&nbsp;<span class="op" id="8083715">==</span>&nbsp;<span class="num" id="8083718">0</span>&nbsp;<span class="op" id="8083720">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8083726">f</span><span class="op" id="8083727">.</span><span class="ident" id="8083728">AddLineInfo</span><span class="op" id="8083739">(</span><span class="ident" id="8083740">offs</span><span class="op" id="8083744">,</span>&nbsp;<span class="ident" id="8083746">fmt</span><span class="op" id="8083749">.</span><span class="ident" id="8083750">Sprintf</span><span class="op" id="8083757">(</span><span class="string" id="8083758">&#34;file%d&#34;</span><span class="op" id="8083766">,</span>&nbsp;<span class="ident" id="8083768">offs</span><span class="op" id="8083772">)</span><span class="op" id="8083773">,</span>&nbsp;<span class="ident" id="8083775">line</span><span class="op" id="8083779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8083785">line</span>&nbsp;<span class="op" id="8083790">+=</span>&nbsp;<span class="num" id="8083793">33</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8083799">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8083803">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8083807">checkSerialize</span><span class="op" id="8083821">(</span><span class="ident" id="8083822">t</span><span class="op" id="8083823">,</span>&nbsp;<span class="ident" id="8083825">p</span><span class="op" id="8083826">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8083829">}</span><br>
<span class="lineno"></span><span class="op" id="8083831">}</span>
</div>
</body>
</html>
