<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3385178">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3385234">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3385288">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3385339">//&nbsp;Internet&nbsp;protocol&nbsp;family&nbsp;sockets</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3385376">package</span>&nbsp;<span class="ident" id="3385384">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3385389">import</span>&nbsp;<span class="op" id="3385396">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3385399">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3385409">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3385416">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3385419">var</span>&nbsp;<span class="op" id="3385423">(</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3385426">//&nbsp;supportsIPv4&nbsp;reports&nbsp;whether&nbsp;the&nbsp;platform&nbsp;supports&nbsp;IPv4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3385486">//&nbsp;networking&nbsp;functionality.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3385516">supportsIPv4</span>&nbsp;<span class="builtintype" id="3385529">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3385536">//&nbsp;supportsIPv6&nbsp;reports&nbsp;whether&nbsp;the&nbsp;platform&nbsp;supports&nbsp;IPv6</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3385596">//&nbsp;networking&nbsp;functionality.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3385626">supportsIPv6</span>&nbsp;<span class="builtintype" id="3385639">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3385646">//&nbsp;supportsIPv4map&nbsp;reports&nbsp;whether&nbsp;the&nbsp;platform&nbsp;supports</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3385704">//&nbsp;mapping&nbsp;an&nbsp;IPv4&nbsp;address&nbsp;inside&nbsp;an&nbsp;IPv6&nbsp;address&nbsp;at&nbsp;transport</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3385768">//&nbsp;layer&nbsp;protocols.&nbsp;&nbsp;See&nbsp;RFC&nbsp;4291,&nbsp;RFC&nbsp;4038&nbsp;and&nbsp;RFC&nbsp;3493.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3385827">supportsIPv4map</span>&nbsp;<span class="builtintype" id="3385843">bool</span><br>
<span class="lineno"></span><span class="op" id="3385848">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3385851">func</span>&nbsp;<span class="ident" id="3385856">init</span><span class="op" id="3385860">(</span><span class="op" id="3385861">)</span>&nbsp;<span class="op" id="3385863">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3385866">sysInit</span><span class="op" id="3385873">(</span><span class="op" id="3385874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3385877">supportsIPv4</span>&nbsp;<span class="op" id="3385890">=</span>&nbsp;<span class="ident" id="3385892">probeIPv4Stack</span><span class="op" id="3385906">(</span><span class="op" id="3385907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3385910">supportsIPv6</span><span class="op" id="3385922">,</span>&nbsp;<span class="ident" id="3385924">supportsIPv4map</span>&nbsp;<span class="op" id="3385940">=</span>&nbsp;<span class="ident" id="3385942">probeIPv6Stack</span><span class="op" id="3385956">(</span><span class="op" id="3385957">)</span><br>
<span class="lineno"></span><span class="op" id="3385959">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="3385962">//&nbsp;A&nbsp;netaddr&nbsp;represents&nbsp;a&nbsp;network&nbsp;endpoint&nbsp;address&nbsp;or&nbsp;a&nbsp;list&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3386026">//&nbsp;network&nbsp;endpoint&nbsp;addresses.</span><br>
<span class="lineno"></span><span class="keyword" id="3386057">type</span>&nbsp;<span class="ident" id="3386062">netaddr</span>&nbsp;<span class="keyword" id="3386070">interface</span>&nbsp;<span class="op" id="3386080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3386083">//&nbsp;toAddr&nbsp;returns&nbsp;the&nbsp;address&nbsp;represented&nbsp;in&nbsp;Addr&nbsp;interface.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3386145">//&nbsp;It&nbsp;returns&nbsp;a&nbsp;nil&nbsp;interface&nbsp;when&nbsp;the&nbsp;address&nbsp;is&nbsp;nil.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3386201">toAddr</span><span class="op" id="3386207">(</span><span class="op" id="3386208">)</span>&nbsp;<span class="ident" id="3386210">Addr</span><br>
<span class="lineno"></span><span class="op" id="3386215">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3386218">//&nbsp;An&nbsp;addrList&nbsp;represents&nbsp;a&nbsp;list&nbsp;of&nbsp;network&nbsp;endpoint&nbsp;addresses.</span><br>
<span class="lineno"></span><span class="keyword" id="3386282">type</span>&nbsp;<span class="ident" id="3386287">addrList</span>&nbsp;<span class="op" id="3386296">[</span><span class="op" id="3386297">]</span><span class="ident" id="3386298">netaddr</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="3386307">func</span>&nbsp;<span class="op" id="3386312">(</span><span class="ident" id="3386313">al</span>&nbsp;<span class="ident" id="3386316">addrList</span><span class="op" id="3386324">)</span>&nbsp;<span class="ident" id="3386326">toAddr</span><span class="op" id="3386332">(</span><span class="op" id="3386333">)</span>&nbsp;<span class="ident" id="3386335">Addr</span>&nbsp;<span class="op" id="3386340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3386343">switch</span>&nbsp;<span class="builtinfunc" id="3386350">len</span><span class="op" id="3386353">(</span><span class="ident" id="3386354">al</span><span class="op" id="3386356">)</span>&nbsp;<span class="op" id="3386358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3386361">case</span>&nbsp;<span class="num" id="3386366">0</span><span class="op" id="3386367">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3386371">return</span>&nbsp;<span class="ident" id="3386378">nil</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3386383">case</span>&nbsp;<span class="num" id="3386388">1</span><span class="op" id="3386389">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3386393">return</span>&nbsp;<span class="ident" id="3386400">al</span><span class="op" id="3386402">[</span><span class="num" id="3386403">0</span><span class="op" id="3386404">]</span><span class="op" id="3386405">.</span><span class="ident" id="3386406">toAddr</span><span class="op" id="3386412">(</span><span class="op" id="3386413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3386416">default</span><span class="op" id="3386423">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3386427">//&nbsp;For&nbsp;now,&nbsp;we&#39;ll&nbsp;roughly&nbsp;pick&nbsp;first&nbsp;one&nbsp;without</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3386478">//&nbsp;considering&nbsp;dealing&nbsp;with&nbsp;any&nbsp;preferences&nbsp;such&nbsp;as</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3386532">//&nbsp;DNS&nbsp;TTL,&nbsp;transport&nbsp;path&nbsp;quality,&nbsp;network&nbsp;routing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3386586">//&nbsp;information.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3386604">return</span>&nbsp;<span class="ident" id="3386611">al</span><span class="op" id="3386613">[</span><span class="num" id="3386614">0</span><span class="op" id="3386615">]</span><span class="op" id="3386616">.</span><span class="ident" id="3386617">toAddr</span><span class="op" id="3386623">(</span><span class="op" id="3386624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3386627">}</span><br>
<span class="lineno"></span><span class="op" id="3386629">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="3386632">var</span>&nbsp;<span class="ident" id="3386636">errNoSuitableAddress</span>&nbsp;<span class="op" id="3386657">=</span>&nbsp;<span class="ident" id="3386659">errors</span><span class="op" id="3386665">.</span><span class="ident" id="3386666">New</span><span class="op" id="3386669">(</span><span class="string" id="3386670">&#34;no&nbsp;suitable&nbsp;address&nbsp;found&#34;</span><span class="op" id="3386697">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3386700">//&nbsp;firstFavoriteAddr&nbsp;returns&nbsp;an&nbsp;address&nbsp;or&nbsp;a&nbsp;list&nbsp;of&nbsp;addresses&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="3386768">//&nbsp;implement&nbsp;the&nbsp;netaddr&nbsp;interface.&nbsp;Known&nbsp;filters&nbsp;are&nbsp;nil,&nbsp;ipv4only</span><br>
<span class="lineno">65</span><span class="comment" id="3386836">//&nbsp;and&nbsp;ipv6only.&nbsp;It&nbsp;returns&nbsp;any&nbsp;address&nbsp;when&nbsp;filter&nbsp;is&nbsp;nil.&nbsp;The&nbsp;result</span><br>
<span class="lineno"></span><span class="comment" id="3386907">//&nbsp;contains&nbsp;at&nbsp;least&nbsp;one&nbsp;address&nbsp;when&nbsp;error&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="3386959">func</span>&nbsp;<span class="ident" id="3386964">firstFavoriteAddr</span><span class="op" id="3386981">(</span><span class="ident" id="3386982">filter</span>&nbsp;<span class="keyword" id="3386989">func</span><span class="op" id="3386993">(</span><span class="ident" id="3386994">IP</span><span class="op" id="3386996">)</span>&nbsp;<span class="ident" id="3386998">IP</span><span class="op" id="3387000">,</span>&nbsp;<span class="ident" id="3387002">ips</span>&nbsp;<span class="op" id="3387006">[</span><span class="op" id="3387007">]</span><span class="ident" id="3387008">IP</span><span class="op" id="3387010">,</span>&nbsp;<span class="ident" id="3387012">inetaddr</span>&nbsp;<span class="keyword" id="3387021">func</span><span class="op" id="3387025">(</span><span class="ident" id="3387026">IP</span><span class="op" id="3387028">)</span>&nbsp;<span class="ident" id="3387030">netaddr</span><span class="op" id="3387037">)</span>&nbsp;<span class="op" id="3387039">(</span><span class="ident" id="3387040">netaddr</span><span class="op" id="3387047">,</span>&nbsp;<span class="builtintype" id="3387049">error</span><span class="op" id="3387054">)</span>&nbsp;<span class="op" id="3387056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3387059">if</span>&nbsp;<span class="ident" id="3387062">filter</span>&nbsp;<span class="op" id="3387069">!=</span>&nbsp;<span class="ident" id="3387072">nil</span>&nbsp;<span class="op" id="3387076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3387080">return</span>&nbsp;<span class="ident" id="3387087">firstSupportedAddr</span><span class="op" id="3387105">(</span><span class="ident" id="3387106">filter</span><span class="op" id="3387112">,</span>&nbsp;<span class="ident" id="3387114">ips</span><span class="op" id="3387117">,</span>&nbsp;<span class="ident" id="3387119">inetaddr</span><span class="op" id="3387127">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3387130">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3387133">var</span>&nbsp;<span class="op" id="3387137">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3387141">ipv4</span><span class="op" id="3387145">,</span>&nbsp;<span class="ident" id="3387147">ipv6</span><span class="op" id="3387151">,</span>&nbsp;<span class="ident" id="3387153">swap</span>&nbsp;<span class="builtintype" id="3387158">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3387165">list</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3387182">addrList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3387192">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3387195">for</span>&nbsp;<span class="ident" id="3387199">_</span><span class="op" id="3387200">,</span>&nbsp;<span class="ident" id="3387202">ip</span>&nbsp;<span class="op" id="3387205">:=</span>&nbsp;<span class="keyword" id="3387208">range</span>&nbsp;<span class="ident" id="3387214">ips</span>&nbsp;<span class="op" id="3387218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3387222">//&nbsp;We&#39;ll&nbsp;take&nbsp;any&nbsp;IP&nbsp;address,&nbsp;but&nbsp;since&nbsp;the&nbsp;dialing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3387276">//&nbsp;code&nbsp;does&nbsp;not&nbsp;yet&nbsp;try&nbsp;multiple&nbsp;addresses</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3387322">//&nbsp;effectively,&nbsp;prefer&nbsp;to&nbsp;use&nbsp;an&nbsp;IPv4&nbsp;address&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3387373">//&nbsp;possible.&nbsp;This&nbsp;is&nbsp;especially&nbsp;relevant&nbsp;if&nbsp;localhost</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3387429">//&nbsp;resolves&nbsp;to&nbsp;[ipv6-localhost,&nbsp;ipv4-localhost].&nbsp;Too</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3387484">//&nbsp;much&nbsp;code&nbsp;assumes&nbsp;localhost&nbsp;==&nbsp;ipv4-localhost.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3387536">if</span>&nbsp;<span class="ident" id="3387539">ip4</span>&nbsp;<span class="op" id="3387543">:=</span>&nbsp;<span class="ident" id="3387546">ipv4only</span><span class="op" id="3387554">(</span><span class="ident" id="3387555">ip</span><span class="op" id="3387557">)</span><span class="op" id="3387558">;</span>&nbsp;<span class="ident" id="3387560">ip4</span>&nbsp;<span class="op" id="3387564">!=</span>&nbsp;<span class="ident" id="3387567">nil</span>&nbsp;<span class="op" id="3387571">&amp;&amp;</span>&nbsp;<span class="op" id="3387574">!</span><span class="ident" id="3387575">ipv4</span>&nbsp;<span class="op" id="3387580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3387585">list</span>&nbsp;<span class="op" id="3387590">=</span>&nbsp;<span class="builtinfunc" id="3387592">append</span><span class="op" id="3387598">(</span><span class="ident" id="3387599">list</span><span class="op" id="3387603">,</span>&nbsp;<span class="ident" id="3387605">inetaddr</span><span class="op" id="3387613">(</span><span class="ident" id="3387614">ip4</span><span class="op" id="3387617">)</span><span class="op" id="3387618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3387623">ipv4</span>&nbsp;<span class="op" id="3387628">=</span>&nbsp;<span class="ident" id="3387630">true</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3387638">if</span>&nbsp;<span class="ident" id="3387641">ipv6</span>&nbsp;<span class="op" id="3387646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3387652">swap</span>&nbsp;<span class="op" id="3387657">=</span>&nbsp;<span class="ident" id="3387659">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3387667">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3387671">}</span>&nbsp;<span class="keyword" id="3387673">else</span>&nbsp;<span class="keyword" id="3387678">if</span>&nbsp;<span class="ident" id="3387681">ip6</span>&nbsp;<span class="op" id="3387685">:=</span>&nbsp;<span class="ident" id="3387688">ipv6only</span><span class="op" id="3387696">(</span><span class="ident" id="3387697">ip</span><span class="op" id="3387699">)</span><span class="op" id="3387700">;</span>&nbsp;<span class="ident" id="3387702">ip6</span>&nbsp;<span class="op" id="3387706">!=</span>&nbsp;<span class="ident" id="3387709">nil</span>&nbsp;<span class="op" id="3387713">&amp;&amp;</span>&nbsp;<span class="op" id="3387716">!</span><span class="ident" id="3387717">ipv6</span>&nbsp;<span class="op" id="3387722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3387727">list</span>&nbsp;<span class="op" id="3387732">=</span>&nbsp;<span class="builtinfunc" id="3387734">append</span><span class="op" id="3387740">(</span><span class="ident" id="3387741">list</span><span class="op" id="3387745">,</span>&nbsp;<span class="ident" id="3387747">inetaddr</span><span class="op" id="3387755">(</span><span class="ident" id="3387756">ip6</span><span class="op" id="3387759">)</span><span class="op" id="3387760">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3387765">ipv6</span>&nbsp;<span class="op" id="3387770">=</span>&nbsp;<span class="ident" id="3387772">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3387779">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3387783">if</span>&nbsp;<span class="ident" id="3387786">ipv4</span>&nbsp;<span class="op" id="3387791">&amp;&amp;</span>&nbsp;<span class="ident" id="3387794">ipv6</span>&nbsp;<span class="op" id="3387799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3387804">if</span>&nbsp;<span class="ident" id="3387807">swap</span>&nbsp;<span class="op" id="3387812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3387818">list</span><span class="op" id="3387822">[</span><span class="num" id="3387823">0</span><span class="op" id="3387824">]</span><span class="op" id="3387825">,</span>&nbsp;<span class="ident" id="3387827">list</span><span class="op" id="3387831">[</span><span class="num" id="3387832">1</span><span class="op" id="3387833">]</span>&nbsp;<span class="op" id="3387835">=</span>&nbsp;<span class="ident" id="3387837">list</span><span class="op" id="3387841">[</span><span class="num" id="3387842">1</span><span class="op" id="3387843">]</span><span class="op" id="3387844">,</span>&nbsp;<span class="ident" id="3387846">list</span><span class="op" id="3387850">[</span><span class="num" id="3387851">0</span><span class="op" id="3387852">]</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3387857">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3387862">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3387870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3387873">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3387876">switch</span>&nbsp;<span class="builtinfunc" id="3387883">len</span><span class="op" id="3387886">(</span><span class="ident" id="3387887">list</span><span class="op" id="3387891">)</span>&nbsp;<span class="op" id="3387893">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3387896">case</span>&nbsp;<span class="num" id="3387901">0</span><span class="op" id="3387902">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3387906">return</span>&nbsp;<span class="ident" id="3387913">nil</span><span class="op" id="3387916">,</span>&nbsp;<span class="ident" id="3387918">errNoSuitableAddress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3387940">case</span>&nbsp;<span class="num" id="3387945">1</span><span class="op" id="3387946">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3387950">return</span>&nbsp;<span class="ident" id="3387957">list</span><span class="op" id="3387961">[</span><span class="num" id="3387962">0</span><span class="op" id="3387963">]</span><span class="op" id="3387964">,</span>&nbsp;<span class="ident" id="3387966">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3387971">default</span><span class="op" id="3387978">:</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3387982">return</span>&nbsp;<span class="ident" id="3387989">list</span><span class="op" id="3387993">,</span>&nbsp;<span class="ident" id="3387995">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3388000">}</span><br>
<span class="lineno"></span><span class="op" id="3388002">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3388005">func</span>&nbsp;<span class="ident" id="3388010">firstSupportedAddr</span><span class="op" id="3388028">(</span><span class="ident" id="3388029">filter</span>&nbsp;<span class="keyword" id="3388036">func</span><span class="op" id="3388040">(</span><span class="ident" id="3388041">IP</span><span class="op" id="3388043">)</span>&nbsp;<span class="ident" id="3388045">IP</span><span class="op" id="3388047">,</span>&nbsp;<span class="ident" id="3388049">ips</span>&nbsp;<span class="op" id="3388053">[</span><span class="op" id="3388054">]</span><span class="ident" id="3388055">IP</span><span class="op" id="3388057">,</span>&nbsp;<span class="ident" id="3388059">inetaddr</span>&nbsp;<span class="keyword" id="3388068">func</span><span class="op" id="3388072">(</span><span class="ident" id="3388073">IP</span><span class="op" id="3388075">)</span>&nbsp;<span class="ident" id="3388077">netaddr</span><span class="op" id="3388084">)</span>&nbsp;<span class="op" id="3388086">(</span><span class="ident" id="3388087">netaddr</span><span class="op" id="3388094">,</span>&nbsp;<span class="builtintype" id="3388096">error</span><span class="op" id="3388101">)</span>&nbsp;<span class="op" id="3388103">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3388106">for</span>&nbsp;<span class="ident" id="3388110">_</span><span class="op" id="3388111">,</span>&nbsp;<span class="ident" id="3388113">ip</span>&nbsp;<span class="op" id="3388116">:=</span>&nbsp;<span class="keyword" id="3388119">range</span>&nbsp;<span class="ident" id="3388125">ips</span>&nbsp;<span class="op" id="3388129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3388133">if</span>&nbsp;<span class="ident" id="3388136">ip</span>&nbsp;<span class="op" id="3388139">:=</span>&nbsp;<span class="ident" id="3388142">filter</span><span class="op" id="3388148">(</span><span class="ident" id="3388149">ip</span><span class="op" id="3388151">)</span><span class="op" id="3388152">;</span>&nbsp;<span class="ident" id="3388154">ip</span>&nbsp;<span class="op" id="3388157">!=</span>&nbsp;<span class="ident" id="3388160">nil</span>&nbsp;<span class="op" id="3388164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3388169">return</span>&nbsp;<span class="ident" id="3388176">inetaddr</span><span class="op" id="3388184">(</span><span class="ident" id="3388185">ip</span><span class="op" id="3388187">)</span><span class="op" id="3388188">,</span>&nbsp;<span class="ident" id="3388190">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3388196">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3388199">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3388202">return</span>&nbsp;<span class="ident" id="3388209">nil</span><span class="op" id="3388212">,</span>&nbsp;<span class="ident" id="3388214">errNoSuitableAddress</span><br>
<span class="lineno"></span><span class="op" id="3388235">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3388238">//&nbsp;ipv4only&nbsp;returns&nbsp;IPv4&nbsp;addresses&nbsp;that&nbsp;we&nbsp;can&nbsp;use&nbsp;with&nbsp;the&nbsp;kernel&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="3388307">//&nbsp;IPv4&nbsp;addressing&nbsp;modes.&nbsp;If&nbsp;ip&nbsp;is&nbsp;an&nbsp;IPv4&nbsp;address,&nbsp;ipv4only&nbsp;returns&nbsp;ip.</span><br>
<span class="lineno">120</span><span class="comment" id="3388380">//&nbsp;Otherwise&nbsp;it&nbsp;returns&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="3388409">func</span>&nbsp;<span class="ident" id="3388414">ipv4only</span><span class="op" id="3388422">(</span><span class="ident" id="3388423">ip</span>&nbsp;<span class="ident" id="3388426">IP</span><span class="op" id="3388428">)</span>&nbsp;<span class="ident" id="3388430">IP</span>&nbsp;<span class="op" id="3388433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3388436">if</span>&nbsp;<span class="ident" id="3388439">supportsIPv4</span>&nbsp;<span class="op" id="3388452">&amp;&amp;</span>&nbsp;<span class="ident" id="3388455">ip</span><span class="op" id="3388457">.</span><span class="ident" id="3388458">To4</span><span class="op" id="3388461">(</span><span class="op" id="3388462">)</span>&nbsp;<span class="op" id="3388464">!=</span>&nbsp;<span class="ident" id="3388467">nil</span>&nbsp;<span class="op" id="3388471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3388475">return</span>&nbsp;<span class="ident" id="3388482">ip</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3388486">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3388489">return</span>&nbsp;<span class="ident" id="3388496">nil</span><br>
<span class="lineno"></span><span class="op" id="3388500">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3388503">//&nbsp;ipv6only&nbsp;returns&nbsp;IPv6&nbsp;addresses&nbsp;that&nbsp;we&nbsp;can&nbsp;use&nbsp;with&nbsp;the&nbsp;kernel&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="3388572">//&nbsp;IPv6&nbsp;addressing&nbsp;modes.&nbsp;&nbsp;It&nbsp;returns&nbsp;IPv4-mapped&nbsp;IPv6&nbsp;addresses&nbsp;as</span><br>
<span class="lineno">130</span><span class="comment" id="3388640">//&nbsp;nils&nbsp;and&nbsp;returns&nbsp;other&nbsp;IPv6&nbsp;address&nbsp;types&nbsp;as&nbsp;IPv6&nbsp;addresses.</span><br>
<span class="lineno"></span><span class="keyword" id="3388704">func</span>&nbsp;<span class="ident" id="3388709">ipv6only</span><span class="op" id="3388717">(</span><span class="ident" id="3388718">ip</span>&nbsp;<span class="ident" id="3388721">IP</span><span class="op" id="3388723">)</span>&nbsp;<span class="ident" id="3388725">IP</span>&nbsp;<span class="op" id="3388728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3388731">if</span>&nbsp;<span class="ident" id="3388734">supportsIPv6</span>&nbsp;<span class="op" id="3388747">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3388750">len</span><span class="op" id="3388753">(</span><span class="ident" id="3388754">ip</span><span class="op" id="3388756">)</span>&nbsp;<span class="op" id="3388758">==</span>&nbsp;<span class="ident" id="3388761">IPv6len</span>&nbsp;<span class="op" id="3388769">&amp;&amp;</span>&nbsp;<span class="ident" id="3388772">ip</span><span class="op" id="3388774">.</span><span class="ident" id="3388775">To4</span><span class="op" id="3388778">(</span><span class="op" id="3388779">)</span>&nbsp;<span class="op" id="3388781">==</span>&nbsp;<span class="ident" id="3388784">nil</span>&nbsp;<span class="op" id="3388788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3388792">return</span>&nbsp;<span class="ident" id="3388799">ip</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3388803">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3388806">return</span>&nbsp;<span class="ident" id="3388813">nil</span><br>
<span class="lineno"></span><span class="op" id="3388817">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3388820">//&nbsp;SplitHostPort&nbsp;splits&nbsp;a&nbsp;network&nbsp;address&nbsp;of&nbsp;the&nbsp;form&nbsp;&#34;host:port&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="3388887">//&nbsp;&#34;[host]:port&#34;&nbsp;or&nbsp;&#34;[ipv6-host%zone]:port&#34;&nbsp;into&nbsp;host&nbsp;or</span><br>
<span class="lineno">140</span><span class="comment" id="3388944">//&nbsp;ipv6-host%zone&nbsp;and&nbsp;port.&nbsp;&nbsp;A&nbsp;literal&nbsp;address&nbsp;or&nbsp;host&nbsp;name&nbsp;for&nbsp;IPv6</span><br>
<span class="lineno"></span><span class="comment" id="3389013">//&nbsp;must&nbsp;be&nbsp;enclosed&nbsp;in&nbsp;square&nbsp;brackets,&nbsp;as&nbsp;in&nbsp;&#34;[::1]:80&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="3389071">//&nbsp;&#34;[ipv6-host]:http&#34;&nbsp;or&nbsp;&#34;[ipv6-host%zone]:80&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="3389119">func</span>&nbsp;<span class="ident" id="3389124">SplitHostPort</span><span class="op" id="3389137">(</span><span class="ident" id="3389138">hostport</span>&nbsp;<span class="builtintype" id="3389147">string</span><span class="op" id="3389153">)</span>&nbsp;<span class="op" id="3389155">(</span><span class="ident" id="3389156">host</span><span class="op" id="3389160">,</span>&nbsp;<span class="ident" id="3389162">port</span>&nbsp;<span class="builtintype" id="3389167">string</span><span class="op" id="3389173">,</span>&nbsp;<span class="ident" id="3389175">err</span>&nbsp;<span class="builtintype" id="3389179">error</span><span class="op" id="3389184">)</span>&nbsp;<span class="op" id="3389186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3389189">j</span><span class="op" id="3389190">,</span>&nbsp;<span class="ident" id="3389192">k</span>&nbsp;<span class="op" id="3389194">:=</span>&nbsp;<span class="num" id="3389197">0</span><span class="op" id="3389198">,</span>&nbsp;<span class="num" id="3389200">0</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3389204">//&nbsp;The&nbsp;port&nbsp;starts&nbsp;after&nbsp;the&nbsp;last&nbsp;colon.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3389246">i</span>&nbsp;<span class="op" id="3389248">:=</span>&nbsp;<span class="ident" id="3389251">last</span><span class="op" id="3389255">(</span><span class="ident" id="3389256">hostport</span><span class="op" id="3389264">,</span>&nbsp;<span class="string" id="3389266">&#39;:&#39;</span><span class="op" id="3389269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3389272">if</span>&nbsp;<span class="ident" id="3389275">i</span>&nbsp;<span class="op" id="3389277">&lt;</span>&nbsp;<span class="num" id="3389279">0</span>&nbsp;<span class="op" id="3389281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3389285">goto</span>&nbsp;<span class="ident" id="3389290">missingPort</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3389303">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3389307">if</span>&nbsp;<span class="ident" id="3389310">hostport</span><span class="op" id="3389318">[</span><span class="num" id="3389319">0</span><span class="op" id="3389320">]</span>&nbsp;<span class="op" id="3389322">==</span>&nbsp;<span class="string" id="3389325">&#39;[&#39;</span>&nbsp;<span class="op" id="3389329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3389333">//&nbsp;Expect&nbsp;the&nbsp;first&nbsp;&#39;]&#39;&nbsp;just&nbsp;before&nbsp;the&nbsp;last&nbsp;&#39;:&#39;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3389385">end</span>&nbsp;<span class="op" id="3389389">:=</span>&nbsp;<span class="ident" id="3389392">byteIndex</span><span class="op" id="3389401">(</span><span class="ident" id="3389402">hostport</span><span class="op" id="3389410">,</span>&nbsp;<span class="string" id="3389412">&#39;]&#39;</span><span class="op" id="3389415">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3389419">if</span>&nbsp;<span class="ident" id="3389422">end</span>&nbsp;<span class="op" id="3389426">&lt;</span>&nbsp;<span class="num" id="3389428">0</span>&nbsp;<span class="op" id="3389430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3389435">err</span>&nbsp;<span class="op" id="3389439">=</span>&nbsp;<span class="op" id="3389441">&amp;</span><span class="ident" id="3389442">AddrError</span><span class="op" id="3389451">{</span><span class="string" id="3389452">&#34;missing&nbsp;&#39;]&#39;&nbsp;in&nbsp;address&#34;</span><span class="op" id="3389476">,</span>&nbsp;<span class="ident" id="3389478">hostport</span><span class="op" id="3389486">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3389491">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3389500">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3389504">switch</span>&nbsp;<span class="ident" id="3389511">end</span>&nbsp;<span class="op" id="3389515">+</span>&nbsp;<span class="num" id="3389517">1</span>&nbsp;<span class="op" id="3389519">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3389523">case</span>&nbsp;<span class="builtinfunc" id="3389528">len</span><span class="op" id="3389531">(</span><span class="ident" id="3389532">hostport</span><span class="op" id="3389540">)</span><span class="op" id="3389541">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3389546">//&nbsp;There&nbsp;can&#39;t&nbsp;be&nbsp;a&nbsp;&#39;:&#39;&nbsp;behind&nbsp;the&nbsp;&#39;]&#39;&nbsp;now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3389593">goto</span>&nbsp;<span class="ident" id="3389598">missingPort</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3389612">case</span>&nbsp;<span class="ident" id="3389617">i</span><span class="op" id="3389618">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3389623">//&nbsp;The&nbsp;expected&nbsp;result.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3389649">default</span><span class="op" id="3389656">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3389661">//&nbsp;Either&nbsp;&#39;]&#39;&nbsp;isn&#39;t&nbsp;followed&nbsp;by&nbsp;a&nbsp;colon,&nbsp;or&nbsp;it&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3389714">//&nbsp;followed&nbsp;by&nbsp;a&nbsp;colon&nbsp;that&nbsp;is&nbsp;not&nbsp;the&nbsp;last&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3389766">if</span>&nbsp;<span class="ident" id="3389769">hostport</span><span class="op" id="3389777">[</span><span class="ident" id="3389778">end</span><span class="op" id="3389781">+</span><span class="num" id="3389782">1</span><span class="op" id="3389783">]</span>&nbsp;<span class="op" id="3389785">==</span>&nbsp;<span class="string" id="3389788">&#39;:&#39;</span>&nbsp;<span class="op" id="3389792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3389798">goto</span>&nbsp;<span class="ident" id="3389803">tooManyColons</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3389820">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3389825">goto</span>&nbsp;<span class="ident" id="3389830">missingPort</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3389844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3389848">host</span>&nbsp;<span class="op" id="3389853">=</span>&nbsp;<span class="ident" id="3389855">hostport</span><span class="op" id="3389863">[</span><span class="num" id="3389864">1</span><span class="op" id="3389865">:</span><span class="ident" id="3389866">end</span><span class="op" id="3389869">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3389873">j</span><span class="op" id="3389874">,</span>&nbsp;<span class="ident" id="3389876">k</span>&nbsp;<span class="op" id="3389878">=</span>&nbsp;<span class="num" id="3389880">1</span><span class="op" id="3389881">,</span>&nbsp;<span class="ident" id="3389883">end</span><span class="op" id="3389886">+</span><span class="num" id="3389887">1</span>&nbsp;<span class="comment" id="3389889">//&nbsp;there&nbsp;can&#39;t&nbsp;be&nbsp;a&nbsp;&#39;[&#39;&nbsp;resp.&nbsp;&#39;]&#39;&nbsp;before&nbsp;these&nbsp;positions</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3389947">}</span>&nbsp;<span class="keyword" id="3389949">else</span>&nbsp;<span class="op" id="3389954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3389958">host</span>&nbsp;<span class="op" id="3389963">=</span>&nbsp;<span class="ident" id="3389965">hostport</span><span class="op" id="3389973">[</span><span class="op" id="3389974">:</span><span class="ident" id="3389975">i</span><span class="op" id="3389976">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3389980">if</span>&nbsp;<span class="ident" id="3389983">byteIndex</span><span class="op" id="3389992">(</span><span class="ident" id="3389993">host</span><span class="op" id="3389997">,</span>&nbsp;<span class="string" id="3389999">&#39;:&#39;</span><span class="op" id="3390002">)</span>&nbsp;<span class="op" id="3390004">&gt;=</span>&nbsp;<span class="num" id="3390007">0</span>&nbsp;<span class="op" id="3390009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3390014">goto</span>&nbsp;<span class="ident" id="3390019">tooManyColons</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3390035">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3390039">if</span>&nbsp;<span class="ident" id="3390042">byteIndex</span><span class="op" id="3390051">(</span><span class="ident" id="3390052">host</span><span class="op" id="3390056">,</span>&nbsp;<span class="string" id="3390058">&#39;%&#39;</span><span class="op" id="3390061">)</span>&nbsp;<span class="op" id="3390063">&gt;=</span>&nbsp;<span class="num" id="3390066">0</span>&nbsp;<span class="op" id="3390068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3390073">goto</span>&nbsp;<span class="ident" id="3390078">missingBrackets</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3390096">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3390099">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3390102">if</span>&nbsp;<span class="ident" id="3390105">byteIndex</span><span class="op" id="3390114">(</span><span class="ident" id="3390115">hostport</span><span class="op" id="3390123">[</span><span class="ident" id="3390124">j</span><span class="op" id="3390125">:</span><span class="op" id="3390126">]</span><span class="op" id="3390127">,</span>&nbsp;<span class="string" id="3390129">&#39;[&#39;</span><span class="op" id="3390132">)</span>&nbsp;<span class="op" id="3390134">&gt;=</span>&nbsp;<span class="num" id="3390137">0</span>&nbsp;<span class="op" id="3390139">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3390143">err</span>&nbsp;<span class="op" id="3390147">=</span>&nbsp;<span class="op" id="3390149">&amp;</span><span class="ident" id="3390150">AddrError</span><span class="op" id="3390159">{</span><span class="string" id="3390160">&#34;unexpected&nbsp;&#39;[&#39;&nbsp;in&nbsp;address&#34;</span><span class="op" id="3390187">,</span>&nbsp;<span class="ident" id="3390189">hostport</span><span class="op" id="3390197">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3390201">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3390209">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3390212">if</span>&nbsp;<span class="ident" id="3390215">byteIndex</span><span class="op" id="3390224">(</span><span class="ident" id="3390225">hostport</span><span class="op" id="3390233">[</span><span class="ident" id="3390234">k</span><span class="op" id="3390235">:</span><span class="op" id="3390236">]</span><span class="op" id="3390237">,</span>&nbsp;<span class="string" id="3390239">&#39;]&#39;</span><span class="op" id="3390242">)</span>&nbsp;<span class="op" id="3390244">&gt;=</span>&nbsp;<span class="num" id="3390247">0</span>&nbsp;<span class="op" id="3390249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3390253">err</span>&nbsp;<span class="op" id="3390257">=</span>&nbsp;<span class="op" id="3390259">&amp;</span><span class="ident" id="3390260">AddrError</span><span class="op" id="3390269">{</span><span class="string" id="3390270">&#34;unexpected&nbsp;&#39;]&#39;&nbsp;in&nbsp;address&#34;</span><span class="op" id="3390297">,</span>&nbsp;<span class="ident" id="3390299">hostport</span><span class="op" id="3390307">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3390311">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3390319">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3390323">port</span>&nbsp;<span class="op" id="3390328">=</span>&nbsp;<span class="ident" id="3390330">hostport</span><span class="op" id="3390338">[</span><span class="ident" id="3390339">i</span><span class="op" id="3390340">+</span><span class="num" id="3390341">1</span><span class="op" id="3390342">:</span><span class="op" id="3390343">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3390346">return</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="ident" id="3390354">missingPort</span><span class="op" id="3390365">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3390368">err</span>&nbsp;<span class="op" id="3390372">=</span>&nbsp;<span class="op" id="3390374">&amp;</span><span class="ident" id="3390375">AddrError</span><span class="op" id="3390384">{</span><span class="string" id="3390385">&#34;missing&nbsp;port&nbsp;in&nbsp;address&#34;</span><span class="op" id="3390410">,</span>&nbsp;<span class="ident" id="3390412">hostport</span><span class="op" id="3390420">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3390423">return</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span><span class="ident" id="3390431">tooManyColons</span><span class="op" id="3390444">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3390447">err</span>&nbsp;<span class="op" id="3390451">=</span>&nbsp;<span class="op" id="3390453">&amp;</span><span class="ident" id="3390454">AddrError</span><span class="op" id="3390463">{</span><span class="string" id="3390464">&#34;too&nbsp;many&nbsp;colons&nbsp;in&nbsp;address&#34;</span><span class="op" id="3390492">,</span>&nbsp;<span class="ident" id="3390494">hostport</span><span class="op" id="3390502">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3390505">return</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="3390513">missingBrackets</span><span class="op" id="3390528">:</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3390531">err</span>&nbsp;<span class="op" id="3390535">=</span>&nbsp;<span class="op" id="3390537">&amp;</span><span class="ident" id="3390538">AddrError</span><span class="op" id="3390547">{</span><span class="string" id="3390548">&#34;missing&nbsp;brackets&nbsp;in&nbsp;address&#34;</span><span class="op" id="3390577">,</span>&nbsp;<span class="ident" id="3390579">hostport</span><span class="op" id="3390587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3390590">return</span><br>
<span class="lineno"></span><span class="op" id="3390597">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3390600">func</span>&nbsp;<span class="ident" id="3390605">splitHostZone</span><span class="op" id="3390618">(</span><span class="ident" id="3390619">s</span>&nbsp;<span class="builtintype" id="3390621">string</span><span class="op" id="3390627">)</span>&nbsp;<span class="op" id="3390629">(</span><span class="ident" id="3390630">host</span><span class="op" id="3390634">,</span>&nbsp;<span class="ident" id="3390636">zone</span>&nbsp;<span class="builtintype" id="3390641">string</span><span class="op" id="3390647">)</span>&nbsp;<span class="op" id="3390649">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3390652">//&nbsp;The&nbsp;IPv6&nbsp;scoped&nbsp;addressing&nbsp;zone&nbsp;identifier&nbsp;starts&nbsp;after&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3390716">//&nbsp;last&nbsp;percent&nbsp;sign.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3390739">if</span>&nbsp;<span class="ident" id="3390742">i</span>&nbsp;<span class="op" id="3390744">:=</span>&nbsp;<span class="ident" id="3390747">last</span><span class="op" id="3390751">(</span><span class="ident" id="3390752">s</span><span class="op" id="3390753">,</span>&nbsp;<span class="string" id="3390755">&#39;%&#39;</span><span class="op" id="3390758">)</span><span class="op" id="3390759">;</span>&nbsp;<span class="ident" id="3390761">i</span>&nbsp;<span class="op" id="3390763">&gt;</span>&nbsp;<span class="num" id="3390765">0</span>&nbsp;<span class="op" id="3390767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3390771">host</span><span class="op" id="3390775">,</span>&nbsp;<span class="ident" id="3390777">zone</span>&nbsp;<span class="op" id="3390782">=</span>&nbsp;<span class="ident" id="3390784">s</span><span class="op" id="3390785">[</span><span class="op" id="3390786">:</span><span class="ident" id="3390787">i</span><span class="op" id="3390788">]</span><span class="op" id="3390789">,</span>&nbsp;<span class="ident" id="3390791">s</span><span class="op" id="3390792">[</span><span class="ident" id="3390793">i</span><span class="op" id="3390794">+</span><span class="num" id="3390795">1</span><span class="op" id="3390796">:</span><span class="op" id="3390797">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3390800">}</span>&nbsp;<span class="keyword" id="3390802">else</span>&nbsp;<span class="op" id="3390807">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3390811">host</span>&nbsp;<span class="op" id="3390816">=</span>&nbsp;<span class="ident" id="3390818">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3390821">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3390824">return</span><br>
<span class="lineno"></span><span class="op" id="3390831">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span><span class="comment" id="3390834">//&nbsp;JoinHostPort&nbsp;combines&nbsp;host&nbsp;and&nbsp;port&nbsp;into&nbsp;a&nbsp;network&nbsp;address&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3390903">//&nbsp;form&nbsp;&#34;host:port&#34;&nbsp;or,&nbsp;if&nbsp;host&nbsp;contains&nbsp;a&nbsp;colon&nbsp;or&nbsp;a&nbsp;percent&nbsp;sign,</span><br>
<span class="lineno"></span><span class="comment" id="3390971">//&nbsp;&#34;[host]:port&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="3390989">func</span>&nbsp;<span class="ident" id="3390994">JoinHostPort</span><span class="op" id="3391006">(</span><span class="ident" id="3391007">host</span><span class="op" id="3391011">,</span>&nbsp;<span class="ident" id="3391013">port</span>&nbsp;<span class="builtintype" id="3391018">string</span><span class="op" id="3391024">)</span>&nbsp;<span class="builtintype" id="3391026">string</span>&nbsp;<span class="op" id="3391033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3391036">//&nbsp;If&nbsp;host&nbsp;has&nbsp;colons&nbsp;or&nbsp;a&nbsp;percent&nbsp;sign,&nbsp;have&nbsp;to&nbsp;bracket&nbsp;it.</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3391098">if</span>&nbsp;<span class="ident" id="3391101">byteIndex</span><span class="op" id="3391110">(</span><span class="ident" id="3391111">host</span><span class="op" id="3391115">,</span>&nbsp;<span class="string" id="3391117">&#39;:&#39;</span><span class="op" id="3391120">)</span>&nbsp;<span class="op" id="3391122">&gt;=</span>&nbsp;<span class="num" id="3391125">0</span>&nbsp;<span class="op" id="3391127">||</span>&nbsp;<span class="ident" id="3391130">byteIndex</span><span class="op" id="3391139">(</span><span class="ident" id="3391140">host</span><span class="op" id="3391144">,</span>&nbsp;<span class="string" id="3391146">&#39;%&#39;</span><span class="op" id="3391149">)</span>&nbsp;<span class="op" id="3391151">&gt;=</span>&nbsp;<span class="num" id="3391154">0</span>&nbsp;<span class="op" id="3391156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3391160">return</span>&nbsp;<span class="string" id="3391167">&#34;[&#34;</span>&nbsp;<span class="op" id="3391171">+</span>&nbsp;<span class="ident" id="3391173">host</span>&nbsp;<span class="op" id="3391178">+</span>&nbsp;<span class="string" id="3391180">&#34;]:&#34;</span>&nbsp;<span class="op" id="3391185">+</span>&nbsp;<span class="ident" id="3391187">port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3391193">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3391196">return</span>&nbsp;<span class="ident" id="3391203">host</span>&nbsp;<span class="op" id="3391208">+</span>&nbsp;<span class="string" id="3391210">&#34;:&#34;</span>&nbsp;<span class="op" id="3391214">+</span>&nbsp;<span class="ident" id="3391216">port</span><br>
<span class="lineno"></span><span class="op" id="3391221">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="3391224">//&nbsp;resolveInternetAddr&nbsp;resolves&nbsp;addr&nbsp;that&nbsp;is&nbsp;either&nbsp;a&nbsp;literal&nbsp;IP</span><br>
<span class="lineno"></span><span class="comment" id="3391289">//&nbsp;address&nbsp;or&nbsp;a&nbsp;DNS&nbsp;name&nbsp;and&nbsp;returns&nbsp;an&nbsp;internet&nbsp;protocol&nbsp;family</span><br>
<span class="lineno"></span><span class="comment" id="3391354">//&nbsp;address.&nbsp;It&nbsp;returns&nbsp;a&nbsp;list&nbsp;that&nbsp;contains&nbsp;a&nbsp;pair&nbsp;of&nbsp;different</span><br>
<span class="lineno"></span><span class="comment" id="3391418">//&nbsp;address&nbsp;family&nbsp;addresses&nbsp;when&nbsp;addr&nbsp;is&nbsp;a&nbsp;DNS&nbsp;name&nbsp;and&nbsp;the&nbsp;name&nbsp;has</span><br>
<span class="lineno">235</span><span class="comment" id="3391487">//&nbsp;multiple&nbsp;address&nbsp;family&nbsp;records.&nbsp;The&nbsp;result&nbsp;contains&nbsp;at&nbsp;least&nbsp;one</span><br>
<span class="lineno"></span><span class="comment" id="3391556">//&nbsp;address&nbsp;when&nbsp;error&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="3391586">func</span>&nbsp;<span class="ident" id="3391591">resolveInternetAddr</span><span class="op" id="3391610">(</span><span class="ident" id="3391611">net</span><span class="op" id="3391614">,</span>&nbsp;<span class="ident" id="3391616">addr</span>&nbsp;<span class="builtintype" id="3391621">string</span><span class="op" id="3391627">,</span>&nbsp;<span class="ident" id="3391629">deadline</span>&nbsp;<span class="ident" id="3391638">time</span><span class="op" id="3391642">.</span><span class="ident" id="3391643">Time</span><span class="op" id="3391647">)</span>&nbsp;<span class="op" id="3391649">(</span><span class="ident" id="3391650">netaddr</span><span class="op" id="3391657">,</span>&nbsp;<span class="builtintype" id="3391659">error</span><span class="op" id="3391664">)</span>&nbsp;<span class="op" id="3391666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3391669">var</span>&nbsp;<span class="op" id="3391673">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3391677">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3391694">error</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3391702">host</span><span class="op" id="3391706">,</span>&nbsp;<span class="ident" id="3391708">port</span><span class="op" id="3391712">,</span>&nbsp;<span class="ident" id="3391714">zone</span>&nbsp;<span class="builtintype" id="3391719">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3391728">portnum</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3391745">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3391750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3391753">switch</span>&nbsp;<span class="ident" id="3391760">net</span>&nbsp;<span class="op" id="3391764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3391767">case</span>&nbsp;<span class="string" id="3391772">&#34;tcp&#34;</span><span class="op" id="3391777">,</span>&nbsp;<span class="string" id="3391779">&#34;tcp4&#34;</span><span class="op" id="3391785">,</span>&nbsp;<span class="string" id="3391787">&#34;tcp6&#34;</span><span class="op" id="3391793">,</span>&nbsp;<span class="string" id="3391795">&#34;udp&#34;</span><span class="op" id="3391800">,</span>&nbsp;<span class="string" id="3391802">&#34;udp4&#34;</span><span class="op" id="3391808">,</span>&nbsp;<span class="string" id="3391810">&#34;udp6&#34;</span><span class="op" id="3391816">:</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3391820">if</span>&nbsp;<span class="ident" id="3391823">addr</span>&nbsp;<span class="op" id="3391828">!=</span>&nbsp;<span class="string" id="3391831">&#34;&#34;</span>&nbsp;<span class="op" id="3391834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3391839">if</span>&nbsp;<span class="ident" id="3391842">host</span><span class="op" id="3391846">,</span>&nbsp;<span class="ident" id="3391848">port</span><span class="op" id="3391852">,</span>&nbsp;<span class="ident" id="3391854">err</span>&nbsp;<span class="op" id="3391858">=</span>&nbsp;<span class="ident" id="3391860">SplitHostPort</span><span class="op" id="3391873">(</span><span class="ident" id="3391874">addr</span><span class="op" id="3391878">)</span><span class="op" id="3391879">;</span>&nbsp;<span class="ident" id="3391881">err</span>&nbsp;<span class="op" id="3391885">!=</span>&nbsp;<span class="ident" id="3391888">nil</span>&nbsp;<span class="op" id="3391892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3391898">return</span>&nbsp;<span class="ident" id="3391905">nil</span><span class="op" id="3391908">,</span>&nbsp;<span class="ident" id="3391910">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3391917">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3391922">if</span>&nbsp;<span class="ident" id="3391925">portnum</span><span class="op" id="3391932">,</span>&nbsp;<span class="ident" id="3391934">err</span>&nbsp;<span class="op" id="3391938">=</span>&nbsp;<span class="ident" id="3391940">parsePort</span><span class="op" id="3391949">(</span><span class="ident" id="3391950">net</span><span class="op" id="3391953">,</span>&nbsp;<span class="ident" id="3391955">port</span><span class="op" id="3391959">)</span><span class="op" id="3391960">;</span>&nbsp;<span class="ident" id="3391962">err</span>&nbsp;<span class="op" id="3391966">!=</span>&nbsp;<span class="ident" id="3391969">nil</span>&nbsp;<span class="op" id="3391973">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3391979">return</span>&nbsp;<span class="ident" id="3391986">nil</span><span class="op" id="3391989">,</span>&nbsp;<span class="ident" id="3391991">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3391998">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3392002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3392005">case</span>&nbsp;<span class="string" id="3392010">&#34;ip&#34;</span><span class="op" id="3392014">,</span>&nbsp;<span class="string" id="3392016">&#34;ip4&#34;</span><span class="op" id="3392021">,</span>&nbsp;<span class="string" id="3392023">&#34;ip6&#34;</span><span class="op" id="3392028">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3392032">if</span>&nbsp;<span class="ident" id="3392035">addr</span>&nbsp;<span class="op" id="3392040">!=</span>&nbsp;<span class="string" id="3392043">&#34;&#34;</span>&nbsp;<span class="op" id="3392046">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3392051">host</span>&nbsp;<span class="op" id="3392056">=</span>&nbsp;<span class="ident" id="3392058">addr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3392065">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3392068">default</span><span class="op" id="3392075">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3392079">return</span>&nbsp;<span class="ident" id="3392086">nil</span><span class="op" id="3392089">,</span>&nbsp;<span class="ident" id="3392091">UnknownNetworkError</span><span class="op" id="3392110">(</span><span class="ident" id="3392111">net</span><span class="op" id="3392114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3392117">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3392120">inetaddr</span>&nbsp;<span class="op" id="3392129">:=</span>&nbsp;<span class="keyword" id="3392132">func</span><span class="op" id="3392136">(</span><span class="ident" id="3392137">ip</span>&nbsp;<span class="ident" id="3392140">IP</span><span class="op" id="3392142">)</span>&nbsp;<span class="ident" id="3392144">netaddr</span>&nbsp;<span class="op" id="3392152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3392156">switch</span>&nbsp;<span class="ident" id="3392163">net</span>&nbsp;<span class="op" id="3392167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3392171">case</span>&nbsp;<span class="string" id="3392176">&#34;tcp&#34;</span><span class="op" id="3392181">,</span>&nbsp;<span class="string" id="3392183">&#34;tcp4&#34;</span><span class="op" id="3392189">,</span>&nbsp;<span class="string" id="3392191">&#34;tcp6&#34;</span><span class="op" id="3392197">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3392202">return</span>&nbsp;<span class="op" id="3392209">&amp;</span><span class="ident" id="3392210">TCPAddr</span><span class="op" id="3392217">{</span><span class="ident" id="3392218">IP</span><span class="op" id="3392220">:</span>&nbsp;<span class="ident" id="3392222">ip</span><span class="op" id="3392224">,</span>&nbsp;<span class="ident" id="3392226">Port</span><span class="op" id="3392230">:</span>&nbsp;<span class="ident" id="3392232">portnum</span><span class="op" id="3392239">,</span>&nbsp;<span class="ident" id="3392241">Zone</span><span class="op" id="3392245">:</span>&nbsp;<span class="ident" id="3392247">zone</span><span class="op" id="3392251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3392255">case</span>&nbsp;<span class="string" id="3392260">&#34;udp&#34;</span><span class="op" id="3392265">,</span>&nbsp;<span class="string" id="3392267">&#34;udp4&#34;</span><span class="op" id="3392273">,</span>&nbsp;<span class="string" id="3392275">&#34;udp6&#34;</span><span class="op" id="3392281">:</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3392286">return</span>&nbsp;<span class="op" id="3392293">&amp;</span><span class="ident" id="3392294">UDPAddr</span><span class="op" id="3392301">{</span><span class="ident" id="3392302">IP</span><span class="op" id="3392304">:</span>&nbsp;<span class="ident" id="3392306">ip</span><span class="op" id="3392308">,</span>&nbsp;<span class="ident" id="3392310">Port</span><span class="op" id="3392314">:</span>&nbsp;<span class="ident" id="3392316">portnum</span><span class="op" id="3392323">,</span>&nbsp;<span class="ident" id="3392325">Zone</span><span class="op" id="3392329">:</span>&nbsp;<span class="ident" id="3392331">zone</span><span class="op" id="3392335">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3392339">case</span>&nbsp;<span class="string" id="3392344">&#34;ip&#34;</span><span class="op" id="3392348">,</span>&nbsp;<span class="string" id="3392350">&#34;ip4&#34;</span><span class="op" id="3392355">,</span>&nbsp;<span class="string" id="3392357">&#34;ip6&#34;</span><span class="op" id="3392362">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3392367">return</span>&nbsp;<span class="op" id="3392374">&amp;</span><span class="ident" id="3392375">IPAddr</span><span class="op" id="3392381">{</span><span class="ident" id="3392382">IP</span><span class="op" id="3392384">:</span>&nbsp;<span class="ident" id="3392386">ip</span><span class="op" id="3392388">,</span>&nbsp;<span class="ident" id="3392390">Zone</span><span class="op" id="3392394">:</span>&nbsp;<span class="ident" id="3392396">zone</span><span class="op" id="3392400">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3392404">default</span><span class="op" id="3392411">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3392416">panic</span><span class="op" id="3392421">(</span><span class="string" id="3392422">&#34;unexpected&nbsp;network:&nbsp;&#34;</span>&nbsp;<span class="op" id="3392445">+</span>&nbsp;<span class="ident" id="3392447">net</span><span class="op" id="3392450">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3392454">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3392457">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3392460">if</span>&nbsp;<span class="ident" id="3392463">host</span>&nbsp;<span class="op" id="3392468">==</span>&nbsp;<span class="string" id="3392471">&#34;&#34;</span>&nbsp;<span class="op" id="3392474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3392478">return</span>&nbsp;<span class="ident" id="3392485">inetaddr</span><span class="op" id="3392493">(</span><span class="ident" id="3392494">nil</span><span class="op" id="3392497">)</span><span class="op" id="3392498">,</span>&nbsp;<span class="ident" id="3392500">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3392505">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3392508">//&nbsp;Try&nbsp;as&nbsp;a&nbsp;literal&nbsp;IP&nbsp;address.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3392541">var</span>&nbsp;<span class="ident" id="3392545">ip</span>&nbsp;<span class="ident" id="3392548">IP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3392552">if</span>&nbsp;<span class="ident" id="3392555">ip</span>&nbsp;<span class="op" id="3392558">=</span>&nbsp;<span class="ident" id="3392560">parseIPv4</span><span class="op" id="3392569">(</span><span class="ident" id="3392570">host</span><span class="op" id="3392574">)</span><span class="op" id="3392575">;</span>&nbsp;<span class="ident" id="3392577">ip</span>&nbsp;<span class="op" id="3392580">!=</span>&nbsp;<span class="ident" id="3392583">nil</span>&nbsp;<span class="op" id="3392587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3392591">return</span>&nbsp;<span class="ident" id="3392598">inetaddr</span><span class="op" id="3392606">(</span><span class="ident" id="3392607">ip</span><span class="op" id="3392609">)</span><span class="op" id="3392610">,</span>&nbsp;<span class="ident" id="3392612">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3392617">}</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3392620">if</span>&nbsp;<span class="ident" id="3392623">ip</span><span class="op" id="3392625">,</span>&nbsp;<span class="ident" id="3392627">zone</span>&nbsp;<span class="op" id="3392632">=</span>&nbsp;<span class="ident" id="3392634">parseIPv6</span><span class="op" id="3392643">(</span><span class="ident" id="3392644">host</span><span class="op" id="3392648">,</span>&nbsp;<span class="ident" id="3392650">true</span><span class="op" id="3392654">)</span><span class="op" id="3392655">;</span>&nbsp;<span class="ident" id="3392657">ip</span>&nbsp;<span class="op" id="3392660">!=</span>&nbsp;<span class="ident" id="3392663">nil</span>&nbsp;<span class="op" id="3392667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3392671">return</span>&nbsp;<span class="ident" id="3392678">inetaddr</span><span class="op" id="3392686">(</span><span class="ident" id="3392687">ip</span><span class="op" id="3392689">)</span><span class="op" id="3392690">,</span>&nbsp;<span class="ident" id="3392692">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3392697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3392700">//&nbsp;Try&nbsp;as&nbsp;a&nbsp;DNS&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3392723">host</span><span class="op" id="3392727">,</span>&nbsp;<span class="ident" id="3392729">zone</span>&nbsp;<span class="op" id="3392734">=</span>&nbsp;<span class="ident" id="3392736">splitHostZone</span><span class="op" id="3392749">(</span><span class="ident" id="3392750">host</span><span class="op" id="3392754">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3392757">ips</span><span class="op" id="3392760">,</span>&nbsp;<span class="ident" id="3392762">err</span>&nbsp;<span class="op" id="3392766">:=</span>&nbsp;<span class="ident" id="3392769">lookupIPDeadline</span><span class="op" id="3392785">(</span><span class="ident" id="3392786">host</span><span class="op" id="3392790">,</span>&nbsp;<span class="ident" id="3392792">deadline</span><span class="op" id="3392800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3392803">if</span>&nbsp;<span class="ident" id="3392806">err</span>&nbsp;<span class="op" id="3392810">!=</span>&nbsp;<span class="ident" id="3392813">nil</span>&nbsp;<span class="op" id="3392817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3392821">return</span>&nbsp;<span class="ident" id="3392828">nil</span><span class="op" id="3392831">,</span>&nbsp;<span class="ident" id="3392833">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3392838">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3392841">var</span>&nbsp;<span class="ident" id="3392845">filter</span>&nbsp;<span class="keyword" id="3392852">func</span><span class="op" id="3392856">(</span><span class="ident" id="3392857">IP</span><span class="op" id="3392859">)</span>&nbsp;<span class="ident" id="3392861">IP</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3392865">if</span>&nbsp;<span class="ident" id="3392868">net</span>&nbsp;<span class="op" id="3392872">!=</span>&nbsp;<span class="string" id="3392875">&#34;&#34;</span>&nbsp;<span class="op" id="3392878">&amp;&amp;</span>&nbsp;<span class="ident" id="3392881">net</span><span class="op" id="3392884">[</span><span class="builtinfunc" id="3392885">len</span><span class="op" id="3392888">(</span><span class="ident" id="3392889">net</span><span class="op" id="3392892">)</span><span class="op" id="3392893">-</span><span class="num" id="3392894">1</span><span class="op" id="3392895">]</span>&nbsp;<span class="op" id="3392897">==</span>&nbsp;<span class="string" id="3392900">&#39;4&#39;</span>&nbsp;<span class="op" id="3392904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3392908">filter</span>&nbsp;<span class="op" id="3392915">=</span>&nbsp;<span class="ident" id="3392917">ipv4only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3392927">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3392930">if</span>&nbsp;<span class="ident" id="3392933">net</span>&nbsp;<span class="op" id="3392937">!=</span>&nbsp;<span class="string" id="3392940">&#34;&#34;</span>&nbsp;<span class="op" id="3392943">&amp;&amp;</span>&nbsp;<span class="ident" id="3392946">net</span><span class="op" id="3392949">[</span><span class="builtinfunc" id="3392950">len</span><span class="op" id="3392953">(</span><span class="ident" id="3392954">net</span><span class="op" id="3392957">)</span><span class="op" id="3392958">-</span><span class="num" id="3392959">1</span><span class="op" id="3392960">]</span>&nbsp;<span class="op" id="3392962">==</span>&nbsp;<span class="string" id="3392965">&#39;6&#39;</span>&nbsp;<span class="op" id="3392969">||</span>&nbsp;<span class="ident" id="3392972">zone</span>&nbsp;<span class="op" id="3392977">!=</span>&nbsp;<span class="string" id="3392980">&#34;&#34;</span>&nbsp;<span class="op" id="3392983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3392987">filter</span>&nbsp;<span class="op" id="3392994">=</span>&nbsp;<span class="ident" id="3392996">ipv6only</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3393006">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3393009">return</span>&nbsp;<span class="ident" id="3393016">firstFavoriteAddr</span><span class="op" id="3393033">(</span><span class="ident" id="3393034">filter</span><span class="op" id="3393040">,</span>&nbsp;<span class="ident" id="3393042">ips</span><span class="op" id="3393045">,</span>&nbsp;<span class="ident" id="3393047">inetaddr</span><span class="op" id="3393055">)</span><br>
<span class="lineno"></span><span class="op" id="3393057">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3393060">func</span>&nbsp;<span class="ident" id="3393065">zoneToString</span><span class="op" id="3393077">(</span><span class="ident" id="3393078">zone</span>&nbsp;<span class="builtintype" id="3393083">int</span><span class="op" id="3393086">)</span>&nbsp;<span class="builtintype" id="3393088">string</span>&nbsp;<span class="op" id="3393095">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3393098">if</span>&nbsp;<span class="ident" id="3393101">zone</span>&nbsp;<span class="op" id="3393106">==</span>&nbsp;<span class="num" id="3393109">0</span>&nbsp;<span class="op" id="3393111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3393115">return</span>&nbsp;<span class="string" id="3393122">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3393126">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3393129">if</span>&nbsp;<span class="ident" id="3393132">ifi</span><span class="op" id="3393135">,</span>&nbsp;<span class="ident" id="3393137">err</span>&nbsp;<span class="op" id="3393141">:=</span>&nbsp;<span class="ident" id="3393144">InterfaceByIndex</span><span class="op" id="3393160">(</span><span class="ident" id="3393161">zone</span><span class="op" id="3393165">)</span><span class="op" id="3393166">;</span>&nbsp;<span class="ident" id="3393168">err</span>&nbsp;<span class="op" id="3393172">==</span>&nbsp;<span class="ident" id="3393175">nil</span>&nbsp;<span class="op" id="3393179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3393183">return</span>&nbsp;<span class="ident" id="3393190">ifi</span><span class="op" id="3393193">.</span><span class="ident" id="3393194">Name</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3393200">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3393203">return</span>&nbsp;<span class="ident" id="3393210">itod</span><span class="op" id="3393214">(</span><span class="builtintype" id="3393215">uint</span><span class="op" id="3393219">(</span><span class="ident" id="3393220">zone</span><span class="op" id="3393224">)</span><span class="op" id="3393225">)</span><br>
<span class="lineno"></span><span class="op" id="3393227">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3393230">func</span>&nbsp;<span class="ident" id="3393235">zoneToInt</span><span class="op" id="3393244">(</span><span class="ident" id="3393245">zone</span>&nbsp;<span class="builtintype" id="3393250">string</span><span class="op" id="3393256">)</span>&nbsp;<span class="builtintype" id="3393258">int</span>&nbsp;<span class="op" id="3393262">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3393265">if</span>&nbsp;<span class="ident" id="3393268">zone</span>&nbsp;<span class="op" id="3393273">==</span>&nbsp;<span class="string" id="3393276">&#34;&#34;</span>&nbsp;<span class="op" id="3393279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3393283">return</span>&nbsp;<span class="num" id="3393290">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3393293">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3393296">if</span>&nbsp;<span class="ident" id="3393299">ifi</span><span class="op" id="3393302">,</span>&nbsp;<span class="ident" id="3393304">err</span>&nbsp;<span class="op" id="3393308">:=</span>&nbsp;<span class="ident" id="3393311">InterfaceByName</span><span class="op" id="3393326">(</span><span class="ident" id="3393327">zone</span><span class="op" id="3393331">)</span><span class="op" id="3393332">;</span>&nbsp;<span class="ident" id="3393334">err</span>&nbsp;<span class="op" id="3393338">==</span>&nbsp;<span class="ident" id="3393341">nil</span>&nbsp;<span class="op" id="3393345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3393349">return</span>&nbsp;<span class="ident" id="3393356">ifi</span><span class="op" id="3393359">.</span><span class="ident" id="3393360">Index</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3393367">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3393370">n</span><span class="op" id="3393371">,</span>&nbsp;<span class="ident" id="3393373">_</span><span class="op" id="3393374">,</span>&nbsp;<span class="ident" id="3393376">_</span>&nbsp;<span class="op" id="3393378">:=</span>&nbsp;<span class="ident" id="3393381">dtoi</span><span class="op" id="3393385">(</span><span class="ident" id="3393386">zone</span><span class="op" id="3393390">,</span>&nbsp;<span class="num" id="3393392">0</span><span class="op" id="3393393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3393396">return</span>&nbsp;<span class="ident" id="3393403">n</span><br>
<span class="lineno"></span><span class="op" id="3393405">}</span>
</div>
</body>
</html>
