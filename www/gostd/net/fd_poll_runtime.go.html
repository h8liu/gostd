<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html" class="current">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3060152">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3060207">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3060261">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3060312">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;netbsd&nbsp;openbsd&nbsp;windows&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3060385">package</span>&nbsp;<span class="ident" id="3060393">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3060398">import</span>&nbsp;<span class="op" id="3060405">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3060408">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3060416">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3060427">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3060434">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="3060437">//&nbsp;runtimeNano&nbsp;returns&nbsp;the&nbsp;current&nbsp;value&nbsp;of&nbsp;the&nbsp;runtime&nbsp;clock&nbsp;in&nbsp;nanoseconds.</span><br>
<span class="lineno"></span><span class="keyword" id="3060515">func</span>&nbsp;<span class="ident" id="3060520">runtimeNano</span><span class="op" id="3060531">(</span><span class="op" id="3060532">)</span>&nbsp;<span class="ident" id="3060534">int64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3060541">func</span>&nbsp;<span class="ident" id="3060546">runtime_pollServerInit</span><span class="op" id="3060568">(</span><span class="op" id="3060569">)</span><br>
<span class="lineno"></span><span class="keyword" id="3060571">func</span>&nbsp;<span class="ident" id="3060576">runtime_pollOpen</span><span class="op" id="3060592">(</span><span class="ident" id="3060593">fd</span>&nbsp;<span class="builtintype" id="3060596">uintptr</span><span class="op" id="3060603">)</span>&nbsp;<span class="op" id="3060605">(</span><span class="builtintype" id="3060606">uintptr</span><span class="op" id="3060613">,</span>&nbsp;<span class="builtintype" id="3060615">int</span><span class="op" id="3060618">)</span><br>
<span class="lineno">20</span><span class="keyword" id="3060620">func</span>&nbsp;<span class="ident" id="3060625">runtime_pollClose</span><span class="op" id="3060642">(</span><span class="ident" id="3060643">ctx</span>&nbsp;<span class="builtintype" id="3060647">uintptr</span><span class="op" id="3060654">)</span><br>
<span class="lineno"></span><span class="keyword" id="3060656">func</span>&nbsp;<span class="ident" id="3060661">runtime_pollWait</span><span class="op" id="3060677">(</span><span class="ident" id="3060678">ctx</span>&nbsp;<span class="builtintype" id="3060682">uintptr</span><span class="op" id="3060689">,</span>&nbsp;<span class="ident" id="3060691">mode</span>&nbsp;<span class="builtintype" id="3060696">int</span><span class="op" id="3060699">)</span>&nbsp;<span class="builtintype" id="3060701">int</span><br>
<span class="lineno"></span><span class="keyword" id="3060705">func</span>&nbsp;<span class="ident" id="3060710">runtime_pollWaitCanceled</span><span class="op" id="3060734">(</span><span class="ident" id="3060735">ctx</span>&nbsp;<span class="builtintype" id="3060739">uintptr</span><span class="op" id="3060746">,</span>&nbsp;<span class="ident" id="3060748">mode</span>&nbsp;<span class="builtintype" id="3060753">int</span><span class="op" id="3060756">)</span>&nbsp;<span class="builtintype" id="3060758">int</span><br>
<span class="lineno"></span><span class="keyword" id="3060762">func</span>&nbsp;<span class="ident" id="3060767">runtime_pollReset</span><span class="op" id="3060784">(</span><span class="ident" id="3060785">ctx</span>&nbsp;<span class="builtintype" id="3060789">uintptr</span><span class="op" id="3060796">,</span>&nbsp;<span class="ident" id="3060798">mode</span>&nbsp;<span class="builtintype" id="3060803">int</span><span class="op" id="3060806">)</span>&nbsp;<span class="builtintype" id="3060808">int</span><br>
<span class="lineno"></span><span class="keyword" id="3060812">func</span>&nbsp;<span class="ident" id="3060817">runtime_pollSetDeadline</span><span class="op" id="3060840">(</span><span class="ident" id="3060841">ctx</span>&nbsp;<span class="builtintype" id="3060845">uintptr</span><span class="op" id="3060852">,</span>&nbsp;<span class="ident" id="3060854">d</span>&nbsp;<span class="ident" id="3060856">int64</span><span class="op" id="3060861">,</span>&nbsp;<span class="ident" id="3060863">mode</span>&nbsp;<span class="builtintype" id="3060868">int</span><span class="op" id="3060871">)</span><br>
<span class="lineno">25</span><span class="keyword" id="3060873">func</span>&nbsp;<span class="ident" id="3060878">runtime_pollUnblock</span><span class="op" id="3060897">(</span><span class="ident" id="3060898">ctx</span>&nbsp;<span class="builtintype" id="3060902">uintptr</span><span class="op" id="3060909">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3060912">type</span>&nbsp;<span class="ident" id="3060917">pollDesc</span>&nbsp;<span class="keyword" id="3060926">struct</span>&nbsp;<span class="op" id="3060933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3060936">runtimeCtx</span>&nbsp;<span class="builtintype" id="3060947">uintptr</span><br>
<span class="lineno"></span><span class="op" id="3060955">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="keyword" id="3060958">var</span>&nbsp;<span class="ident" id="3060962">serverInit</span>&nbsp;<span class="ident" id="3060973">sync</span><span class="op" id="3060977">.</span><span class="ident" id="3060978">Once</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3060984">func</span>&nbsp;<span class="op" id="3060989">(</span><span class="ident" id="3060990">pd</span>&nbsp;<span class="op" id="3060993">*</span><span class="ident" id="3060994">pollDesc</span><span class="op" id="3061002">)</span>&nbsp;<span class="ident" id="3061004">Init</span><span class="op" id="3061008">(</span><span class="ident" id="3061009">fd</span>&nbsp;<span class="op" id="3061012">*</span><span class="ident" id="3061013">netFD</span><span class="op" id="3061018">)</span>&nbsp;<span class="builtintype" id="3061020">error</span>&nbsp;<span class="op" id="3061026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3061029">serverInit</span><span class="op" id="3061039">.</span><span class="ident" id="3061040">Do</span><span class="op" id="3061042">(</span><span class="ident" id="3061043">runtime_pollServerInit</span><span class="op" id="3061065">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3061068">ctx</span><span class="op" id="3061071">,</span>&nbsp;<span class="ident" id="3061073">errno</span>&nbsp;<span class="op" id="3061079">:=</span>&nbsp;<span class="ident" id="3061082">runtime_pollOpen</span><span class="op" id="3061098">(</span><span class="builtintype" id="3061099">uintptr</span><span class="op" id="3061106">(</span><span class="ident" id="3061107">fd</span><span class="op" id="3061109">.</span><span class="ident" id="3061110">sysfd</span><span class="op" id="3061115">)</span><span class="op" id="3061116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3061119">if</span>&nbsp;<span class="ident" id="3061122">errno</span>&nbsp;<span class="op" id="3061128">!=</span>&nbsp;<span class="num" id="3061131">0</span>&nbsp;<span class="op" id="3061133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3061137">return</span>&nbsp;<span class="ident" id="3061144">syscall</span><span class="op" id="3061151">.</span><span class="ident" id="3061152">Errno</span><span class="op" id="3061157">(</span><span class="ident" id="3061158">errno</span><span class="op" id="3061163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3061166">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3061169">pd</span><span class="op" id="3061171">.</span><span class="ident" id="3061172">runtimeCtx</span>&nbsp;<span class="op" id="3061183">=</span>&nbsp;<span class="ident" id="3061185">ctx</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3061190">return</span>&nbsp;<span class="ident" id="3061197">nil</span><br>
<span class="lineno"></span><span class="op" id="3061201">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3061204">func</span>&nbsp;<span class="op" id="3061209">(</span><span class="ident" id="3061210">pd</span>&nbsp;<span class="op" id="3061213">*</span><span class="ident" id="3061214">pollDesc</span><span class="op" id="3061222">)</span>&nbsp;<span class="ident" id="3061224">Close</span><span class="op" id="3061229">(</span><span class="op" id="3061230">)</span>&nbsp;<span class="op" id="3061232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3061235">if</span>&nbsp;<span class="ident" id="3061238">pd</span><span class="op" id="3061240">.</span><span class="ident" id="3061241">runtimeCtx</span>&nbsp;<span class="op" id="3061252">==</span>&nbsp;<span class="num" id="3061255">0</span>&nbsp;<span class="op" id="3061257">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3061261">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3061269">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3061272">runtime_pollClose</span><span class="op" id="3061289">(</span><span class="ident" id="3061290">pd</span><span class="op" id="3061292">.</span><span class="ident" id="3061293">runtimeCtx</span><span class="op" id="3061303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3061306">pd</span><span class="op" id="3061308">.</span><span class="ident" id="3061309">runtimeCtx</span>&nbsp;<span class="op" id="3061320">=</span>&nbsp;<span class="num" id="3061322">0</span><br>
<span class="lineno"></span><span class="op" id="3061324">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="3061327">func</span>&nbsp;<span class="op" id="3061332">(</span><span class="ident" id="3061333">pd</span>&nbsp;<span class="op" id="3061336">*</span><span class="ident" id="3061337">pollDesc</span><span class="op" id="3061345">)</span>&nbsp;<span class="ident" id="3061347">Lock</span><span class="op" id="3061351">(</span><span class="op" id="3061352">)</span>&nbsp;<span class="op" id="3061354">{</span><br>
<span class="lineno"></span><span class="op" id="3061356">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3061359">func</span>&nbsp;<span class="op" id="3061364">(</span><span class="ident" id="3061365">pd</span>&nbsp;<span class="op" id="3061368">*</span><span class="ident" id="3061369">pollDesc</span><span class="op" id="3061377">)</span>&nbsp;<span class="ident" id="3061379">Unlock</span><span class="op" id="3061385">(</span><span class="op" id="3061386">)</span>&nbsp;<span class="op" id="3061388">{</span><br>
<span class="lineno">55</span><span class="op" id="3061390">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3061393">func</span>&nbsp;<span class="op" id="3061398">(</span><span class="ident" id="3061399">pd</span>&nbsp;<span class="op" id="3061402">*</span><span class="ident" id="3061403">pollDesc</span><span class="op" id="3061411">)</span>&nbsp;<span class="ident" id="3061413">Wakeup</span><span class="op" id="3061419">(</span><span class="op" id="3061420">)</span>&nbsp;<span class="op" id="3061422">{</span><br>
<span class="lineno"></span><span class="op" id="3061424">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="3061427">//&nbsp;Evict&nbsp;evicts&nbsp;fd&nbsp;from&nbsp;the&nbsp;pending&nbsp;list,&nbsp;unblocking&nbsp;any&nbsp;I/O&nbsp;running&nbsp;on&nbsp;fd.</span><br>
<span class="lineno"></span><span class="comment" id="3061503">//&nbsp;Return&nbsp;value&nbsp;is&nbsp;whether&nbsp;the&nbsp;pollServer&nbsp;should&nbsp;be&nbsp;woken&nbsp;up.</span><br>
<span class="lineno"></span><span class="keyword" id="3061565">func</span>&nbsp;<span class="op" id="3061570">(</span><span class="ident" id="3061571">pd</span>&nbsp;<span class="op" id="3061574">*</span><span class="ident" id="3061575">pollDesc</span><span class="op" id="3061583">)</span>&nbsp;<span class="ident" id="3061585">Evict</span><span class="op" id="3061590">(</span><span class="op" id="3061591">)</span>&nbsp;<span class="builtintype" id="3061593">bool</span>&nbsp;<span class="op" id="3061598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3061601">if</span>&nbsp;<span class="ident" id="3061604">pd</span><span class="op" id="3061606">.</span><span class="ident" id="3061607">runtimeCtx</span>&nbsp;<span class="op" id="3061618">==</span>&nbsp;<span class="num" id="3061621">0</span>&nbsp;<span class="op" id="3061623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3061627">return</span>&nbsp;<span class="builtintype" id="3061634">false</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3061641">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3061644">runtime_pollUnblock</span><span class="op" id="3061663">(</span><span class="ident" id="3061664">pd</span><span class="op" id="3061666">.</span><span class="ident" id="3061667">runtimeCtx</span><span class="op" id="3061677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3061680">return</span>&nbsp;<span class="builtintype" id="3061687">false</span><br>
<span class="lineno"></span><span class="op" id="3061693">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="3061696">func</span>&nbsp;<span class="op" id="3061701">(</span><span class="ident" id="3061702">pd</span>&nbsp;<span class="op" id="3061705">*</span><span class="ident" id="3061706">pollDesc</span><span class="op" id="3061714">)</span>&nbsp;<span class="ident" id="3061716">Prepare</span><span class="op" id="3061723">(</span><span class="ident" id="3061724">mode</span>&nbsp;<span class="builtintype" id="3061729">int</span><span class="op" id="3061732">)</span>&nbsp;<span class="builtintype" id="3061734">error</span>&nbsp;<span class="op" id="3061740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3061743">res</span>&nbsp;<span class="op" id="3061747">:=</span>&nbsp;<span class="ident" id="3061750">runtime_pollReset</span><span class="op" id="3061767">(</span><span class="ident" id="3061768">pd</span><span class="op" id="3061770">.</span><span class="ident" id="3061771">runtimeCtx</span><span class="op" id="3061781">,</span>&nbsp;<span class="ident" id="3061783">mode</span><span class="op" id="3061787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3061790">return</span>&nbsp;<span class="ident" id="3061797">convertErr</span><span class="op" id="3061807">(</span><span class="ident" id="3061808">res</span><span class="op" id="3061811">)</span><br>
<span class="lineno"></span><span class="op" id="3061813">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="3061816">func</span>&nbsp;<span class="op" id="3061821">(</span><span class="ident" id="3061822">pd</span>&nbsp;<span class="op" id="3061825">*</span><span class="ident" id="3061826">pollDesc</span><span class="op" id="3061834">)</span>&nbsp;<span class="ident" id="3061836">PrepareRead</span><span class="op" id="3061847">(</span><span class="op" id="3061848">)</span>&nbsp;<span class="builtintype" id="3061850">error</span>&nbsp;<span class="op" id="3061856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3061859">return</span>&nbsp;<span class="ident" id="3061866">pd</span><span class="op" id="3061868">.</span><span class="ident" id="3061869">Prepare</span><span class="op" id="3061876">(</span><span class="string" id="3061877">&#39;r&#39;</span><span class="op" id="3061880">)</span><br>
<span class="lineno"></span><span class="op" id="3061882">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3061885">func</span>&nbsp;<span class="op" id="3061890">(</span><span class="ident" id="3061891">pd</span>&nbsp;<span class="op" id="3061894">*</span><span class="ident" id="3061895">pollDesc</span><span class="op" id="3061903">)</span>&nbsp;<span class="ident" id="3061905">PrepareWrite</span><span class="op" id="3061917">(</span><span class="op" id="3061918">)</span>&nbsp;<span class="builtintype" id="3061920">error</span>&nbsp;<span class="op" id="3061926">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3061929">return</span>&nbsp;<span class="ident" id="3061936">pd</span><span class="op" id="3061938">.</span><span class="ident" id="3061939">Prepare</span><span class="op" id="3061946">(</span><span class="string" id="3061947">&#39;w&#39;</span><span class="op" id="3061950">)</span><br>
<span class="lineno"></span><span class="op" id="3061952">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3061955">func</span>&nbsp;<span class="op" id="3061960">(</span><span class="ident" id="3061961">pd</span>&nbsp;<span class="op" id="3061964">*</span><span class="ident" id="3061965">pollDesc</span><span class="op" id="3061973">)</span>&nbsp;<span class="ident" id="3061975">Wait</span><span class="op" id="3061979">(</span><span class="ident" id="3061980">mode</span>&nbsp;<span class="builtintype" id="3061985">int</span><span class="op" id="3061988">)</span>&nbsp;<span class="builtintype" id="3061990">error</span>&nbsp;<span class="op" id="3061996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3061999">res</span>&nbsp;<span class="op" id="3062003">:=</span>&nbsp;<span class="ident" id="3062006">runtime_pollWait</span><span class="op" id="3062022">(</span><span class="ident" id="3062023">pd</span><span class="op" id="3062025">.</span><span class="ident" id="3062026">runtimeCtx</span><span class="op" id="3062036">,</span>&nbsp;<span class="ident" id="3062038">mode</span><span class="op" id="3062042">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3062045">return</span>&nbsp;<span class="ident" id="3062052">convertErr</span><span class="op" id="3062062">(</span><span class="ident" id="3062063">res</span><span class="op" id="3062066">)</span><br>
<span class="lineno"></span><span class="op" id="3062068">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3062071">func</span>&nbsp;<span class="op" id="3062076">(</span><span class="ident" id="3062077">pd</span>&nbsp;<span class="op" id="3062080">*</span><span class="ident" id="3062081">pollDesc</span><span class="op" id="3062089">)</span>&nbsp;<span class="ident" id="3062091">WaitRead</span><span class="op" id="3062099">(</span><span class="op" id="3062100">)</span>&nbsp;<span class="builtintype" id="3062102">error</span>&nbsp;<span class="op" id="3062108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3062111">return</span>&nbsp;<span class="ident" id="3062118">pd</span><span class="op" id="3062120">.</span><span class="ident" id="3062121">Wait</span><span class="op" id="3062125">(</span><span class="string" id="3062126">&#39;r&#39;</span><span class="op" id="3062129">)</span><br>
<span class="lineno">90</span><span class="op" id="3062131">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3062134">func</span>&nbsp;<span class="op" id="3062139">(</span><span class="ident" id="3062140">pd</span>&nbsp;<span class="op" id="3062143">*</span><span class="ident" id="3062144">pollDesc</span><span class="op" id="3062152">)</span>&nbsp;<span class="ident" id="3062154">WaitWrite</span><span class="op" id="3062163">(</span><span class="op" id="3062164">)</span>&nbsp;<span class="builtintype" id="3062166">error</span>&nbsp;<span class="op" id="3062172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3062175">return</span>&nbsp;<span class="ident" id="3062182">pd</span><span class="op" id="3062184">.</span><span class="ident" id="3062185">Wait</span><span class="op" id="3062189">(</span><span class="string" id="3062190">&#39;w&#39;</span><span class="op" id="3062193">)</span><br>
<span class="lineno"></span><span class="op" id="3062195">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="keyword" id="3062198">func</span>&nbsp;<span class="op" id="3062203">(</span><span class="ident" id="3062204">pd</span>&nbsp;<span class="op" id="3062207">*</span><span class="ident" id="3062208">pollDesc</span><span class="op" id="3062216">)</span>&nbsp;<span class="ident" id="3062218">WaitCanceled</span><span class="op" id="3062230">(</span><span class="ident" id="3062231">mode</span>&nbsp;<span class="builtintype" id="3062236">int</span><span class="op" id="3062239">)</span>&nbsp;<span class="op" id="3062241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3062244">runtime_pollWaitCanceled</span><span class="op" id="3062268">(</span><span class="ident" id="3062269">pd</span><span class="op" id="3062271">.</span><span class="ident" id="3062272">runtimeCtx</span><span class="op" id="3062282">,</span>&nbsp;<span class="ident" id="3062284">mode</span><span class="op" id="3062288">)</span><br>
<span class="lineno"></span><span class="op" id="3062290">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="keyword" id="3062293">func</span>&nbsp;<span class="op" id="3062298">(</span><span class="ident" id="3062299">pd</span>&nbsp;<span class="op" id="3062302">*</span><span class="ident" id="3062303">pollDesc</span><span class="op" id="3062311">)</span>&nbsp;<span class="ident" id="3062313">WaitCanceledRead</span><span class="op" id="3062329">(</span><span class="op" id="3062330">)</span>&nbsp;<span class="op" id="3062332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3062335">pd</span><span class="op" id="3062337">.</span><span class="ident" id="3062338">WaitCanceled</span><span class="op" id="3062350">(</span><span class="string" id="3062351">&#39;r&#39;</span><span class="op" id="3062354">)</span><br>
<span class="lineno"></span><span class="op" id="3062356">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3062359">func</span>&nbsp;<span class="op" id="3062364">(</span><span class="ident" id="3062365">pd</span>&nbsp;<span class="op" id="3062368">*</span><span class="ident" id="3062369">pollDesc</span><span class="op" id="3062377">)</span>&nbsp;<span class="ident" id="3062379">WaitCanceledWrite</span><span class="op" id="3062396">(</span><span class="op" id="3062397">)</span>&nbsp;<span class="op" id="3062399">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3062402">pd</span><span class="op" id="3062404">.</span><span class="ident" id="3062405">WaitCanceled</span><span class="op" id="3062417">(</span><span class="string" id="3062418">&#39;w&#39;</span><span class="op" id="3062421">)</span><br>
<span class="lineno"></span><span class="op" id="3062423">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3062426">func</span>&nbsp;<span class="ident" id="3062431">convertErr</span><span class="op" id="3062441">(</span><span class="ident" id="3062442">res</span>&nbsp;<span class="builtintype" id="3062446">int</span><span class="op" id="3062449">)</span>&nbsp;<span class="builtintype" id="3062451">error</span>&nbsp;<span class="op" id="3062457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3062460">switch</span>&nbsp;<span class="ident" id="3062467">res</span>&nbsp;<span class="op" id="3062471">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3062474">case</span>&nbsp;<span class="num" id="3062479">0</span><span class="op" id="3062480">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3062484">return</span>&nbsp;<span class="ident" id="3062491">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3062496">case</span>&nbsp;<span class="num" id="3062501">1</span><span class="op" id="3062502">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3062506">return</span>&nbsp;<span class="ident" id="3062513">errClosing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3062525">case</span>&nbsp;<span class="num" id="3062530">2</span><span class="op" id="3062531">:</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3062535">return</span>&nbsp;<span class="ident" id="3062542">errTimeout</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3062554">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3062557">println</span><span class="op" id="3062564">(</span><span class="string" id="3062565">&#34;unreachable:&nbsp;&#34;</span><span class="op" id="3062580">,</span>&nbsp;<span class="ident" id="3062582">res</span><span class="op" id="3062585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3062588">panic</span><span class="op" id="3062593">(</span><span class="string" id="3062594">&#34;unreachable&#34;</span><span class="op" id="3062607">)</span><br>
<span class="lineno"></span><span class="op" id="3062609">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="keyword" id="3062612">func</span>&nbsp;<span class="op" id="3062617">(</span><span class="ident" id="3062618">fd</span>&nbsp;<span class="op" id="3062621">*</span><span class="ident" id="3062622">netFD</span><span class="op" id="3062627">)</span>&nbsp;<span class="ident" id="3062629">setDeadline</span><span class="op" id="3062640">(</span><span class="ident" id="3062641">t</span>&nbsp;<span class="ident" id="3062643">time</span><span class="op" id="3062647">.</span><span class="ident" id="3062648">Time</span><span class="op" id="3062652">)</span>&nbsp;<span class="builtintype" id="3062654">error</span>&nbsp;<span class="op" id="3062660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3062663">return</span>&nbsp;<span class="ident" id="3062670">setDeadlineImpl</span><span class="op" id="3062685">(</span><span class="ident" id="3062686">fd</span><span class="op" id="3062688">,</span>&nbsp;<span class="ident" id="3062690">t</span><span class="op" id="3062691">,</span>&nbsp;<span class="string" id="3062693">&#39;r&#39;</span><span class="op" id="3062696">+</span><span class="string" id="3062697">&#39;w&#39;</span><span class="op" id="3062700">)</span><br>
<span class="lineno"></span><span class="op" id="3062702">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="3062705">func</span>&nbsp;<span class="op" id="3062710">(</span><span class="ident" id="3062711">fd</span>&nbsp;<span class="op" id="3062714">*</span><span class="ident" id="3062715">netFD</span><span class="op" id="3062720">)</span>&nbsp;<span class="ident" id="3062722">setReadDeadline</span><span class="op" id="3062737">(</span><span class="ident" id="3062738">t</span>&nbsp;<span class="ident" id="3062740">time</span><span class="op" id="3062744">.</span><span class="ident" id="3062745">Time</span><span class="op" id="3062749">)</span>&nbsp;<span class="builtintype" id="3062751">error</span>&nbsp;<span class="op" id="3062757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3062760">return</span>&nbsp;<span class="ident" id="3062767">setDeadlineImpl</span><span class="op" id="3062782">(</span><span class="ident" id="3062783">fd</span><span class="op" id="3062785">,</span>&nbsp;<span class="ident" id="3062787">t</span><span class="op" id="3062788">,</span>&nbsp;<span class="string" id="3062790">&#39;r&#39;</span><span class="op" id="3062793">)</span><br>
<span class="lineno"></span><span class="op" id="3062795">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3062798">func</span>&nbsp;<span class="op" id="3062803">(</span><span class="ident" id="3062804">fd</span>&nbsp;<span class="op" id="3062807">*</span><span class="ident" id="3062808">netFD</span><span class="op" id="3062813">)</span>&nbsp;<span class="ident" id="3062815">setWriteDeadline</span><span class="op" id="3062831">(</span><span class="ident" id="3062832">t</span>&nbsp;<span class="ident" id="3062834">time</span><span class="op" id="3062838">.</span><span class="ident" id="3062839">Time</span><span class="op" id="3062843">)</span>&nbsp;<span class="builtintype" id="3062845">error</span>&nbsp;<span class="op" id="3062851">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3062854">return</span>&nbsp;<span class="ident" id="3062861">setDeadlineImpl</span><span class="op" id="3062876">(</span><span class="ident" id="3062877">fd</span><span class="op" id="3062879">,</span>&nbsp;<span class="ident" id="3062881">t</span><span class="op" id="3062882">,</span>&nbsp;<span class="string" id="3062884">&#39;w&#39;</span><span class="op" id="3062887">)</span><br>
<span class="lineno"></span><span class="op" id="3062889">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3062892">func</span>&nbsp;<span class="ident" id="3062897">setDeadlineImpl</span><span class="op" id="3062912">(</span><span class="ident" id="3062913">fd</span>&nbsp;<span class="op" id="3062916">*</span><span class="ident" id="3062917">netFD</span><span class="op" id="3062922">,</span>&nbsp;<span class="ident" id="3062924">t</span>&nbsp;<span class="ident" id="3062926">time</span><span class="op" id="3062930">.</span><span class="ident" id="3062931">Time</span><span class="op" id="3062935">,</span>&nbsp;<span class="ident" id="3062937">mode</span>&nbsp;<span class="builtintype" id="3062942">int</span><span class="op" id="3062945">)</span>&nbsp;<span class="builtintype" id="3062947">error</span>&nbsp;<span class="op" id="3062953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3062956">d</span>&nbsp;<span class="op" id="3062958">:=</span>&nbsp;<span class="ident" id="3062961">runtimeNano</span><span class="op" id="3062972">(</span><span class="op" id="3062973">)</span>&nbsp;<span class="op" id="3062975">+</span>&nbsp;<span class="ident" id="3062977">int64</span><span class="op" id="3062982">(</span><span class="ident" id="3062983">t</span><span class="op" id="3062984">.</span><span class="ident" id="3062985">Sub</span><span class="op" id="3062988">(</span><span class="ident" id="3062989">time</span><span class="op" id="3062993">.</span><span class="ident" id="3062994">Now</span><span class="op" id="3062997">(</span><span class="op" id="3062998">)</span><span class="op" id="3062999">)</span><span class="op" id="3063000">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3063003">if</span>&nbsp;<span class="ident" id="3063006">t</span><span class="op" id="3063007">.</span><span class="ident" id="3063008">IsZero</span><span class="op" id="3063014">(</span><span class="op" id="3063015">)</span>&nbsp;<span class="op" id="3063017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3063021">d</span>&nbsp;<span class="op" id="3063023">=</span>&nbsp;<span class="num" id="3063025">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3063028">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3063031">if</span>&nbsp;<span class="ident" id="3063034">err</span>&nbsp;<span class="op" id="3063038">:=</span>&nbsp;<span class="ident" id="3063041">fd</span><span class="op" id="3063043">.</span><span class="ident" id="3063044">incref</span><span class="op" id="3063050">(</span><span class="op" id="3063051">)</span><span class="op" id="3063052">;</span>&nbsp;<span class="ident" id="3063054">err</span>&nbsp;<span class="op" id="3063058">!=</span>&nbsp;<span class="ident" id="3063061">nil</span>&nbsp;<span class="op" id="3063065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3063069">return</span>&nbsp;<span class="ident" id="3063076">err</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3063081">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3063084">runtime_pollSetDeadline</span><span class="op" id="3063107">(</span><span class="ident" id="3063108">fd</span><span class="op" id="3063110">.</span><span class="ident" id="3063111">pd</span><span class="op" id="3063113">.</span><span class="ident" id="3063114">runtimeCtx</span><span class="op" id="3063124">,</span>&nbsp;<span class="ident" id="3063126">d</span><span class="op" id="3063127">,</span>&nbsp;<span class="ident" id="3063129">mode</span><span class="op" id="3063133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3063136">fd</span><span class="op" id="3063138">.</span><span class="ident" id="3063139">decref</span><span class="op" id="3063145">(</span><span class="op" id="3063146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3063149">return</span>&nbsp;<span class="ident" id="3063156">nil</span><br>
<span class="lineno"></span><span class="op" id="3063160">}</span>
</div>
</body>
</html>
