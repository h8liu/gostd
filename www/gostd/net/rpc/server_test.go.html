<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/rpc</h2>
<ul>
<li><a href="/gostd/net/rpc/client.go.html">client.go</a></li>
<li><a href="/gostd/net/rpc/client_test.go.html">client_test.go</a></li>
<li><a href="/gostd/net/rpc/debug.go.html">debug.go</a></li>
<li><a href="/gostd/net/rpc/server.go.html">server.go</a></li>
<li><a href="/gostd/net/rpc/server_test.go.html">server_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8428001">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8428056">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8428110">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8428161">package</span>&nbsp;<span class="ident" id="8428169">rpc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8428174">import</span>&nbsp;<span class="op" id="8428181">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8428184">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8428194">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8428201">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8428207">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8428214">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8428221">&#34;net/http/httptest&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8428242">&#34;runtime&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8428253">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8428264">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8428272">&#34;sync/atomic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8428287">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8428298">&#34;time&#34;</span><br>
<span class="lineno">20</span><span class="op" id="8428305">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8428308">var</span>&nbsp;<span class="op" id="8428312">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8428315">newServer</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8428341">*</span><span class="ident" id="8428342">Server</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8428350">serverAddr</span><span class="op" id="8428360">,</span>&nbsp;<span class="ident" id="8428362">newServerAddr</span>&nbsp;<span class="builtintype" id="8428376">string</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8428384">httpServerAddr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8428410">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8428418">once</span><span class="op" id="8428422">,</span>&nbsp;<span class="ident" id="8428424">newOnce</span><span class="op" id="8428431">,</span>&nbsp;<span class="ident" id="8428433">httpOnce</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="8428444">sync</span><span class="op" id="8428448">.</span><span class="ident" id="8428449">Once</span><br>
<span class="lineno"></span><span class="op" id="8428454">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8428457">const</span>&nbsp;<span class="op" id="8428463">(</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8428466">newHttpPath</span>&nbsp;<span class="op" id="8428478">=</span>&nbsp;<span class="string" id="8428480">&#34;/foo&#34;</span><br>
<span class="lineno"></span><span class="op" id="8428487">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8428490">type</span>&nbsp;<span class="ident" id="8428495">Args</span>&nbsp;<span class="keyword" id="8428500">struct</span>&nbsp;<span class="op" id="8428507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8428510">A</span><span class="op" id="8428511">,</span>&nbsp;<span class="ident" id="8428513">B</span>&nbsp;<span class="builtintype" id="8428515">int</span><br>
<span class="lineno">35</span><span class="op" id="8428519">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8428522">type</span>&nbsp;<span class="ident" id="8428527">Reply</span>&nbsp;<span class="keyword" id="8428533">struct</span>&nbsp;<span class="op" id="8428540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8428543">C</span>&nbsp;<span class="builtintype" id="8428545">int</span><br>
<span class="lineno"></span><span class="op" id="8428549">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="8428552">type</span>&nbsp;<span class="ident" id="8428557">Arith</span>&nbsp;<span class="builtintype" id="8428563">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8428568">//&nbsp;Some&nbsp;of&nbsp;Arith&#39;s&nbsp;methods&nbsp;have&nbsp;value&nbsp;args,&nbsp;some&nbsp;have&nbsp;pointer&nbsp;args.&nbsp;That&#39;s&nbsp;deliberate.</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="8428656">func</span>&nbsp;<span class="op" id="8428661">(</span><span class="ident" id="8428662">t</span>&nbsp;<span class="op" id="8428664">*</span><span class="ident" id="8428665">Arith</span><span class="op" id="8428670">)</span>&nbsp;<span class="ident" id="8428672">Add</span><span class="op" id="8428675">(</span><span class="ident" id="8428676">args</span>&nbsp;<span class="ident" id="8428681">Args</span><span class="op" id="8428685">,</span>&nbsp;<span class="ident" id="8428687">reply</span>&nbsp;<span class="op" id="8428693">*</span><span class="ident" id="8428694">Reply</span><span class="op" id="8428699">)</span>&nbsp;<span class="builtintype" id="8428701">error</span>&nbsp;<span class="op" id="8428707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8428710">reply</span><span class="op" id="8428715">.</span><span class="ident" id="8428716">C</span>&nbsp;<span class="op" id="8428718">=</span>&nbsp;<span class="ident" id="8428720">args</span><span class="op" id="8428724">.</span><span class="ident" id="8428725">A</span>&nbsp;<span class="op" id="8428727">+</span>&nbsp;<span class="ident" id="8428729">args</span><span class="op" id="8428733">.</span><span class="ident" id="8428734">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8428737">return</span>&nbsp;<span class="ident" id="8428744">nil</span><br>
<span class="lineno"></span><span class="op" id="8428748">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="keyword" id="8428751">func</span>&nbsp;<span class="op" id="8428756">(</span><span class="ident" id="8428757">t</span>&nbsp;<span class="op" id="8428759">*</span><span class="ident" id="8428760">Arith</span><span class="op" id="8428765">)</span>&nbsp;<span class="ident" id="8428767">Mul</span><span class="op" id="8428770">(</span><span class="ident" id="8428771">args</span>&nbsp;<span class="op" id="8428776">*</span><span class="ident" id="8428777">Args</span><span class="op" id="8428781">,</span>&nbsp;<span class="ident" id="8428783">reply</span>&nbsp;<span class="op" id="8428789">*</span><span class="ident" id="8428790">Reply</span><span class="op" id="8428795">)</span>&nbsp;<span class="builtintype" id="8428797">error</span>&nbsp;<span class="op" id="8428803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8428806">reply</span><span class="op" id="8428811">.</span><span class="ident" id="8428812">C</span>&nbsp;<span class="op" id="8428814">=</span>&nbsp;<span class="ident" id="8428816">args</span><span class="op" id="8428820">.</span><span class="ident" id="8428821">A</span>&nbsp;<span class="op" id="8428823">*</span>&nbsp;<span class="ident" id="8428825">args</span><span class="op" id="8428829">.</span><span class="ident" id="8428830">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8428833">return</span>&nbsp;<span class="ident" id="8428840">nil</span><br>
<span class="lineno"></span><span class="op" id="8428844">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="8428847">func</span>&nbsp;<span class="op" id="8428852">(</span><span class="ident" id="8428853">t</span>&nbsp;<span class="op" id="8428855">*</span><span class="ident" id="8428856">Arith</span><span class="op" id="8428861">)</span>&nbsp;<span class="ident" id="8428863">Div</span><span class="op" id="8428866">(</span><span class="ident" id="8428867">args</span>&nbsp;<span class="ident" id="8428872">Args</span><span class="op" id="8428876">,</span>&nbsp;<span class="ident" id="8428878">reply</span>&nbsp;<span class="op" id="8428884">*</span><span class="ident" id="8428885">Reply</span><span class="op" id="8428890">)</span>&nbsp;<span class="builtintype" id="8428892">error</span>&nbsp;<span class="op" id="8428898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8428901">if</span>&nbsp;<span class="ident" id="8428904">args</span><span class="op" id="8428908">.</span><span class="ident" id="8428909">B</span>&nbsp;<span class="op" id="8428911">==</span>&nbsp;<span class="num" id="8428914">0</span>&nbsp;<span class="op" id="8428916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8428920">return</span>&nbsp;<span class="ident" id="8428927">errors</span><span class="op" id="8428933">.</span><span class="ident" id="8428934">New</span><span class="op" id="8428937">(</span><span class="string" id="8428938">&#34;divide&nbsp;by&nbsp;zero&#34;</span><span class="op" id="8428954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8428957">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8428960">reply</span><span class="op" id="8428965">.</span><span class="ident" id="8428966">C</span>&nbsp;<span class="op" id="8428968">=</span>&nbsp;<span class="ident" id="8428970">args</span><span class="op" id="8428974">.</span><span class="ident" id="8428975">A</span>&nbsp;<span class="op" id="8428977">/</span>&nbsp;<span class="ident" id="8428979">args</span><span class="op" id="8428983">.</span><span class="ident" id="8428984">B</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8428987">return</span>&nbsp;<span class="ident" id="8428994">nil</span><br>
<span class="lineno"></span><span class="op" id="8428998">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8429001">func</span>&nbsp;<span class="op" id="8429006">(</span><span class="ident" id="8429007">t</span>&nbsp;<span class="op" id="8429009">*</span><span class="ident" id="8429010">Arith</span><span class="op" id="8429015">)</span>&nbsp;<span class="ident" id="8429017">String</span><span class="op" id="8429023">(</span><span class="ident" id="8429024">args</span>&nbsp;<span class="op" id="8429029">*</span><span class="ident" id="8429030">Args</span><span class="op" id="8429034">,</span>&nbsp;<span class="ident" id="8429036">reply</span>&nbsp;<span class="op" id="8429042">*</span><span class="builtintype" id="8429043">string</span><span class="op" id="8429049">)</span>&nbsp;<span class="builtintype" id="8429051">error</span>&nbsp;<span class="op" id="8429057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8429060">*</span><span class="ident" id="8429061">reply</span>&nbsp;<span class="op" id="8429067">=</span>&nbsp;<span class="ident" id="8429069">fmt</span><span class="op" id="8429072">.</span><span class="ident" id="8429073">Sprintf</span><span class="op" id="8429080">(</span><span class="string" id="8429081">&#34;%d+%d=%d&#34;</span><span class="op" id="8429091">,</span>&nbsp;<span class="ident" id="8429093">args</span><span class="op" id="8429097">.</span><span class="ident" id="8429098">A</span><span class="op" id="8429099">,</span>&nbsp;<span class="ident" id="8429101">args</span><span class="op" id="8429105">.</span><span class="ident" id="8429106">B</span><span class="op" id="8429107">,</span>&nbsp;<span class="ident" id="8429109">args</span><span class="op" id="8429113">.</span><span class="ident" id="8429114">A</span><span class="op" id="8429115">+</span><span class="ident" id="8429116">args</span><span class="op" id="8429120">.</span><span class="ident" id="8429121">B</span><span class="op" id="8429122">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8429125">return</span>&nbsp;<span class="ident" id="8429132">nil</span><br>
<span class="lineno"></span><span class="op" id="8429136">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8429139">func</span>&nbsp;<span class="op" id="8429144">(</span><span class="ident" id="8429145">t</span>&nbsp;<span class="op" id="8429147">*</span><span class="ident" id="8429148">Arith</span><span class="op" id="8429153">)</span>&nbsp;<span class="ident" id="8429155">Scan</span><span class="op" id="8429159">(</span><span class="ident" id="8429160">args</span>&nbsp;<span class="builtintype" id="8429165">string</span><span class="op" id="8429171">,</span>&nbsp;<span class="ident" id="8429173">reply</span>&nbsp;<span class="op" id="8429179">*</span><span class="ident" id="8429180">Reply</span><span class="op" id="8429185">)</span>&nbsp;<span class="op" id="8429187">(</span><span class="ident" id="8429188">err</span>&nbsp;<span class="builtintype" id="8429192">error</span><span class="op" id="8429197">)</span>&nbsp;<span class="op" id="8429199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8429202">_</span><span class="op" id="8429203">,</span>&nbsp;<span class="ident" id="8429205">err</span>&nbsp;<span class="op" id="8429209">=</span>&nbsp;<span class="ident" id="8429211">fmt</span><span class="op" id="8429214">.</span><span class="ident" id="8429215">Sscan</span><span class="op" id="8429220">(</span><span class="ident" id="8429221">args</span><span class="op" id="8429225">,</span>&nbsp;<span class="op" id="8429227">&amp;</span><span class="ident" id="8429228">reply</span><span class="op" id="8429233">.</span><span class="ident" id="8429234">C</span><span class="op" id="8429235">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8429238">return</span><br>
<span class="lineno"></span><span class="op" id="8429245">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8429248">func</span>&nbsp;<span class="op" id="8429253">(</span><span class="ident" id="8429254">t</span>&nbsp;<span class="op" id="8429256">*</span><span class="ident" id="8429257">Arith</span><span class="op" id="8429262">)</span>&nbsp;<span class="ident" id="8429264">Error</span><span class="op" id="8429269">(</span><span class="ident" id="8429270">args</span>&nbsp;<span class="op" id="8429275">*</span><span class="ident" id="8429276">Args</span><span class="op" id="8429280">,</span>&nbsp;<span class="ident" id="8429282">reply</span>&nbsp;<span class="op" id="8429288">*</span><span class="ident" id="8429289">Reply</span><span class="op" id="8429294">)</span>&nbsp;<span class="builtintype" id="8429296">error</span>&nbsp;<span class="op" id="8429302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8429305">panic</span><span class="op" id="8429310">(</span><span class="string" id="8429311">&#34;ERROR&#34;</span><span class="op" id="8429318">)</span><br>
<span class="lineno">75</span><span class="op" id="8429320">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8429323">func</span>&nbsp;<span class="ident" id="8429328">listenTCP</span><span class="op" id="8429337">(</span><span class="op" id="8429338">)</span>&nbsp;<span class="op" id="8429340">(</span><span class="ident" id="8429341">net</span><span class="op" id="8429344">.</span><span class="ident" id="8429345">Listener</span><span class="op" id="8429353">,</span>&nbsp;<span class="builtintype" id="8429355">string</span><span class="op" id="8429361">)</span>&nbsp;<span class="op" id="8429363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8429366">l</span><span class="op" id="8429367">,</span>&nbsp;<span class="ident" id="8429369">e</span>&nbsp;<span class="op" id="8429371">:=</span>&nbsp;<span class="ident" id="8429374">net</span><span class="op" id="8429377">.</span><span class="ident" id="8429378">Listen</span><span class="op" id="8429384">(</span><span class="string" id="8429385">&#34;tcp&#34;</span><span class="op" id="8429390">,</span>&nbsp;<span class="string" id="8429392">&#34;127.0.0.1:0&#34;</span><span class="op" id="8429405">)</span>&nbsp;<span class="comment" id="8429407">//&nbsp;any&nbsp;available&nbsp;address</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8429433">if</span>&nbsp;<span class="ident" id="8429436">e</span>&nbsp;<span class="op" id="8429438">!=</span>&nbsp;<span class="ident" id="8429441">nil</span>&nbsp;<span class="op" id="8429445">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8429449">log</span><span class="op" id="8429452">.</span><span class="ident" id="8429453">Fatalf</span><span class="op" id="8429459">(</span><span class="string" id="8429460">&#34;net.Listen&nbsp;tcp&nbsp;:0:&nbsp;%v&#34;</span><span class="op" id="8429483">,</span>&nbsp;<span class="ident" id="8429485">e</span><span class="op" id="8429486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8429489">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8429492">return</span>&nbsp;<span class="ident" id="8429499">l</span><span class="op" id="8429500">,</span>&nbsp;<span class="ident" id="8429502">l</span><span class="op" id="8429503">.</span><span class="ident" id="8429504">Addr</span><span class="op" id="8429508">(</span><span class="op" id="8429509">)</span><span class="op" id="8429510">.</span><span class="ident" id="8429511">String</span><span class="op" id="8429517">(</span><span class="op" id="8429518">)</span><br>
<span class="lineno"></span><span class="op" id="8429520">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="keyword" id="8429523">func</span>&nbsp;<span class="ident" id="8429528">startServer</span><span class="op" id="8429539">(</span><span class="op" id="8429540">)</span>&nbsp;<span class="op" id="8429542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8429545">Register</span><span class="op" id="8429553">(</span><span class="builtinfunc" id="8429554">new</span><span class="op" id="8429557">(</span><span class="ident" id="8429558">Arith</span><span class="op" id="8429563">)</span><span class="op" id="8429564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8429567">RegisterName</span><span class="op" id="8429579">(</span><span class="string" id="8429580">&#34;net.rpc.Arith&#34;</span><span class="op" id="8429595">,</span>&nbsp;<span class="builtinfunc" id="8429597">new</span><span class="op" id="8429600">(</span><span class="ident" id="8429601">Arith</span><span class="op" id="8429606">)</span><span class="op" id="8429607">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8429611">var</span>&nbsp;<span class="ident" id="8429615">l</span>&nbsp;<span class="ident" id="8429617">net</span><span class="op" id="8429620">.</span><span class="ident" id="8429621">Listener</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8429631">l</span><span class="op" id="8429632">,</span>&nbsp;<span class="ident" id="8429634">serverAddr</span>&nbsp;<span class="op" id="8429645">=</span>&nbsp;<span class="ident" id="8429647">listenTCP</span><span class="op" id="8429656">(</span><span class="op" id="8429657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8429660">log</span><span class="op" id="8429663">.</span><span class="ident" id="8429664">Println</span><span class="op" id="8429671">(</span><span class="string" id="8429672">&#34;Test&nbsp;RPC&nbsp;server&nbsp;listening&nbsp;on&#34;</span><span class="op" id="8429702">,</span>&nbsp;<span class="ident" id="8429704">serverAddr</span><span class="op" id="8429714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8429717">go</span>&nbsp;<span class="ident" id="8429720">Accept</span><span class="op" id="8429726">(</span><span class="ident" id="8429727">l</span><span class="op" id="8429728">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8429732">HandleHTTP</span><span class="op" id="8429742">(</span><span class="op" id="8429743">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8429746">httpOnce</span><span class="op" id="8429754">.</span><span class="ident" id="8429755">Do</span><span class="op" id="8429757">(</span><span class="ident" id="8429758">startHttpServer</span><span class="op" id="8429773">)</span><br>
<span class="lineno"></span><span class="op" id="8429775">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8429778">func</span>&nbsp;<span class="ident" id="8429783">startNewServer</span><span class="op" id="8429797">(</span><span class="op" id="8429798">)</span>&nbsp;<span class="op" id="8429800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8429803">newServer</span>&nbsp;<span class="op" id="8429813">=</span>&nbsp;<span class="ident" id="8429815">NewServer</span><span class="op" id="8429824">(</span><span class="op" id="8429825">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8429828">newServer</span><span class="op" id="8429837">.</span><span class="ident" id="8429838">Register</span><span class="op" id="8429846">(</span><span class="builtinfunc" id="8429847">new</span><span class="op" id="8429850">(</span><span class="ident" id="8429851">Arith</span><span class="op" id="8429856">)</span><span class="op" id="8429857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8429860">newServer</span><span class="op" id="8429869">.</span><span class="ident" id="8429870">RegisterName</span><span class="op" id="8429882">(</span><span class="string" id="8429883">&#34;net.rpc.Arith&#34;</span><span class="op" id="8429898">,</span>&nbsp;<span class="builtinfunc" id="8429900">new</span><span class="op" id="8429903">(</span><span class="ident" id="8429904">Arith</span><span class="op" id="8429909">)</span><span class="op" id="8429910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8429913">newServer</span><span class="op" id="8429922">.</span><span class="ident" id="8429923">RegisterName</span><span class="op" id="8429935">(</span><span class="string" id="8429936">&#34;newServer.Arith&#34;</span><span class="op" id="8429953">,</span>&nbsp;<span class="builtinfunc" id="8429955">new</span><span class="op" id="8429958">(</span><span class="ident" id="8429959">Arith</span><span class="op" id="8429964">)</span><span class="op" id="8429965">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8429969">var</span>&nbsp;<span class="ident" id="8429973">l</span>&nbsp;<span class="ident" id="8429975">net</span><span class="op" id="8429978">.</span><span class="ident" id="8429979">Listener</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8429989">l</span><span class="op" id="8429990">,</span>&nbsp;<span class="ident" id="8429992">newServerAddr</span>&nbsp;<span class="op" id="8430006">=</span>&nbsp;<span class="ident" id="8430008">listenTCP</span><span class="op" id="8430017">(</span><span class="op" id="8430018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8430021">log</span><span class="op" id="8430024">.</span><span class="ident" id="8430025">Println</span><span class="op" id="8430032">(</span><span class="string" id="8430033">&#34;NewServer&nbsp;test&nbsp;RPC&nbsp;server&nbsp;listening&nbsp;on&#34;</span><span class="op" id="8430073">,</span>&nbsp;<span class="ident" id="8430075">newServerAddr</span><span class="op" id="8430088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8430091">go</span>&nbsp;<span class="ident" id="8430094">newServer</span><span class="op" id="8430103">.</span><span class="ident" id="8430104">Accept</span><span class="op" id="8430110">(</span><span class="ident" id="8430111">l</span><span class="op" id="8430112">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8430116">newServer</span><span class="op" id="8430125">.</span><span class="ident" id="8430126">HandleHTTP</span><span class="op" id="8430136">(</span><span class="ident" id="8430137">newHttpPath</span><span class="op" id="8430148">,</span>&nbsp;<span class="string" id="8430150">&#34;/bar&#34;</span><span class="op" id="8430156">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8430159">httpOnce</span><span class="op" id="8430167">.</span><span class="ident" id="8430168">Do</span><span class="op" id="8430170">(</span><span class="ident" id="8430171">startHttpServer</span><span class="op" id="8430186">)</span><br>
<span class="lineno"></span><span class="op" id="8430188">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8430191">func</span>&nbsp;<span class="ident" id="8430196">startHttpServer</span><span class="op" id="8430211">(</span><span class="op" id="8430212">)</span>&nbsp;<span class="op" id="8430214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8430217">server</span>&nbsp;<span class="op" id="8430224">:=</span>&nbsp;<span class="ident" id="8430227">httptest</span><span class="op" id="8430235">.</span><span class="ident" id="8430236">NewServer</span><span class="op" id="8430245">(</span><span class="ident" id="8430246">nil</span><span class="op" id="8430249">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8430252">httpServerAddr</span>&nbsp;<span class="op" id="8430267">=</span>&nbsp;<span class="ident" id="8430269">server</span><span class="op" id="8430275">.</span><span class="ident" id="8430276">Listener</span><span class="op" id="8430284">.</span><span class="ident" id="8430285">Addr</span><span class="op" id="8430289">(</span><span class="op" id="8430290">)</span><span class="op" id="8430291">.</span><span class="ident" id="8430292">String</span><span class="op" id="8430298">(</span><span class="op" id="8430299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8430302">log</span><span class="op" id="8430305">.</span><span class="ident" id="8430306">Println</span><span class="op" id="8430313">(</span><span class="string" id="8430314">&#34;Test&nbsp;HTTP&nbsp;RPC&nbsp;server&nbsp;listening&nbsp;on&#34;</span><span class="op" id="8430349">,</span>&nbsp;<span class="ident" id="8430351">httpServerAddr</span><span class="op" id="8430365">)</span><br>
<span class="lineno"></span><span class="op" id="8430367">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8430370">func</span>&nbsp;<span class="ident" id="8430375">TestRPC</span><span class="op" id="8430382">(</span><span class="ident" id="8430383">t</span>&nbsp;<span class="op" id="8430385">*</span><span class="ident" id="8430386">testing</span><span class="op" id="8430393">.</span><span class="ident" id="8430394">T</span><span class="op" id="8430395">)</span>&nbsp;<span class="op" id="8430397">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8430400">once</span><span class="op" id="8430404">.</span><span class="ident" id="8430405">Do</span><span class="op" id="8430407">(</span><span class="ident" id="8430408">startServer</span><span class="op" id="8430419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8430422">testRPC</span><span class="op" id="8430429">(</span><span class="ident" id="8430430">t</span><span class="op" id="8430431">,</span>&nbsp;<span class="ident" id="8430433">serverAddr</span><span class="op" id="8430443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8430446">newOnce</span><span class="op" id="8430453">.</span><span class="ident" id="8430454">Do</span><span class="op" id="8430456">(</span><span class="ident" id="8430457">startNewServer</span><span class="op" id="8430471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8430474">testRPC</span><span class="op" id="8430481">(</span><span class="ident" id="8430482">t</span><span class="op" id="8430483">,</span>&nbsp;<span class="ident" id="8430485">newServerAddr</span><span class="op" id="8430498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8430501">testNewServerRPC</span><span class="op" id="8430517">(</span><span class="ident" id="8430518">t</span><span class="op" id="8430519">,</span>&nbsp;<span class="ident" id="8430521">newServerAddr</span><span class="op" id="8430534">)</span><br>
<span class="lineno">125</span><span class="op" id="8430536">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8430539">func</span>&nbsp;<span class="ident" id="8430544">testRPC</span><span class="op" id="8430551">(</span><span class="ident" id="8430552">t</span>&nbsp;<span class="op" id="8430554">*</span><span class="ident" id="8430555">testing</span><span class="op" id="8430562">.</span><span class="ident" id="8430563">T</span><span class="op" id="8430564">,</span>&nbsp;<span class="ident" id="8430566">addr</span>&nbsp;<span class="builtintype" id="8430571">string</span><span class="op" id="8430577">)</span>&nbsp;<span class="op" id="8430579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8430582">client</span><span class="op" id="8430588">,</span>&nbsp;<span class="ident" id="8430590">err</span>&nbsp;<span class="op" id="8430594">:=</span>&nbsp;<span class="ident" id="8430597">Dial</span><span class="op" id="8430601">(</span><span class="string" id="8430602">&#34;tcp&#34;</span><span class="op" id="8430607">,</span>&nbsp;<span class="ident" id="8430609">addr</span><span class="op" id="8430613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8430616">if</span>&nbsp;<span class="ident" id="8430619">err</span>&nbsp;<span class="op" id="8430623">!=</span>&nbsp;<span class="ident" id="8430626">nil</span>&nbsp;<span class="op" id="8430630">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8430634">t</span><span class="op" id="8430635">.</span><span class="ident" id="8430636">Fatal</span><span class="op" id="8430641">(</span><span class="string" id="8430642">&#34;dialing&#34;</span><span class="op" id="8430651">,</span>&nbsp;<span class="ident" id="8430653">err</span><span class="op" id="8430656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8430659">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8430662">defer</span>&nbsp;<span class="ident" id="8430668">client</span><span class="op" id="8430674">.</span><span class="ident" id="8430675">Close</span><span class="op" id="8430680">(</span><span class="op" id="8430681">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8430685">//&nbsp;Synchronous&nbsp;calls</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8430707">args</span>&nbsp;<span class="op" id="8430712">:=</span>&nbsp;<span class="op" id="8430715">&amp;</span><span class="ident" id="8430716">Args</span><span class="op" id="8430720">{</span><span class="num" id="8430721">7</span><span class="op" id="8430722">,</span>&nbsp;<span class="num" id="8430724">8</span><span class="op" id="8430725">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8430728">reply</span>&nbsp;<span class="op" id="8430734">:=</span>&nbsp;<span class="builtinfunc" id="8430737">new</span><span class="op" id="8430740">(</span><span class="ident" id="8430741">Reply</span><span class="op" id="8430746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8430749">err</span>&nbsp;<span class="op" id="8430753">=</span>&nbsp;<span class="ident" id="8430755">client</span><span class="op" id="8430761">.</span><span class="ident" id="8430762">Call</span><span class="op" id="8430766">(</span><span class="string" id="8430767">&#34;Arith.Add&#34;</span><span class="op" id="8430778">,</span>&nbsp;<span class="ident" id="8430780">args</span><span class="op" id="8430784">,</span>&nbsp;<span class="ident" id="8430786">reply</span><span class="op" id="8430791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8430794">if</span>&nbsp;<span class="ident" id="8430797">err</span>&nbsp;<span class="op" id="8430801">!=</span>&nbsp;<span class="ident" id="8430804">nil</span>&nbsp;<span class="op" id="8430808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8430812">t</span><span class="op" id="8430813">.</span><span class="ident" id="8430814">Errorf</span><span class="op" id="8430820">(</span><span class="string" id="8430821">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="8430863">,</span>&nbsp;<span class="ident" id="8430865">err</span><span class="op" id="8430868">.</span><span class="ident" id="8430869">Error</span><span class="op" id="8430874">(</span><span class="op" id="8430875">)</span><span class="op" id="8430876">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8430879">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8430882">if</span>&nbsp;<span class="ident" id="8430885">reply</span><span class="op" id="8430890">.</span><span class="ident" id="8430891">C</span>&nbsp;<span class="op" id="8430893">!=</span>&nbsp;<span class="ident" id="8430896">args</span><span class="op" id="8430900">.</span><span class="ident" id="8430901">A</span><span class="op" id="8430902">+</span><span class="ident" id="8430903">args</span><span class="op" id="8430907">.</span><span class="ident" id="8430908">B</span>&nbsp;<span class="op" id="8430910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8430914">t</span><span class="op" id="8430915">.</span><span class="ident" id="8430916">Errorf</span><span class="op" id="8430922">(</span><span class="string" id="8430923">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="8430948">,</span>&nbsp;<span class="ident" id="8430950">reply</span><span class="op" id="8430955">.</span><span class="ident" id="8430956">C</span><span class="op" id="8430957">,</span>&nbsp;<span class="ident" id="8430959">args</span><span class="op" id="8430963">.</span><span class="ident" id="8430964">A</span><span class="op" id="8430965">+</span><span class="ident" id="8430966">args</span><span class="op" id="8430970">.</span><span class="ident" id="8430971">B</span><span class="op" id="8430972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8430975">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8430979">//&nbsp;Nonexistent&nbsp;method</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8431002">args</span>&nbsp;<span class="op" id="8431007">=</span>&nbsp;<span class="op" id="8431009">&amp;</span><span class="ident" id="8431010">Args</span><span class="op" id="8431014">{</span><span class="num" id="8431015">7</span><span class="op" id="8431016">,</span>&nbsp;<span class="num" id="8431018">0</span><span class="op" id="8431019">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8431022">reply</span>&nbsp;<span class="op" id="8431028">=</span>&nbsp;<span class="builtinfunc" id="8431030">new</span><span class="op" id="8431033">(</span><span class="ident" id="8431034">Reply</span><span class="op" id="8431039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8431042">err</span>&nbsp;<span class="op" id="8431046">=</span>&nbsp;<span class="ident" id="8431048">client</span><span class="op" id="8431054">.</span><span class="ident" id="8431055">Call</span><span class="op" id="8431059">(</span><span class="string" id="8431060">&#34;Arith.BadOperation&#34;</span><span class="op" id="8431080">,</span>&nbsp;<span class="ident" id="8431082">args</span><span class="op" id="8431086">,</span>&nbsp;<span class="ident" id="8431088">reply</span><span class="op" id="8431093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8431096">//&nbsp;expect&nbsp;an&nbsp;error</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8431116">if</span>&nbsp;<span class="ident" id="8431119">err</span>&nbsp;<span class="op" id="8431123">==</span>&nbsp;<span class="ident" id="8431126">nil</span>&nbsp;<span class="op" id="8431130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8431134">t</span><span class="op" id="8431135">.</span><span class="ident" id="8431136">Error</span><span class="op" id="8431141">(</span><span class="string" id="8431142">&#34;BadOperation:&nbsp;expected&nbsp;error&#34;</span><span class="op" id="8431172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8431175">}</span>&nbsp;<span class="keyword" id="8431177">else</span>&nbsp;<span class="keyword" id="8431182">if</span>&nbsp;<span class="op" id="8431185">!</span><span class="ident" id="8431186">strings</span><span class="op" id="8431193">.</span><span class="ident" id="8431194">HasPrefix</span><span class="op" id="8431203">(</span><span class="ident" id="8431204">err</span><span class="op" id="8431207">.</span><span class="ident" id="8431208">Error</span><span class="op" id="8431213">(</span><span class="op" id="8431214">)</span><span class="op" id="8431215">,</span>&nbsp;<span class="string" id="8431217">&#34;rpc:&nbsp;can&#39;t&nbsp;find&nbsp;method&nbsp;&#34;</span><span class="op" id="8431242">)</span>&nbsp;<span class="op" id="8431244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8431248">t</span><span class="op" id="8431249">.</span><span class="ident" id="8431250">Errorf</span><span class="op" id="8431256">(</span><span class="string" id="8431257">&#34;BadOperation:&nbsp;expected&nbsp;can&#39;t&nbsp;find&nbsp;method&nbsp;error;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="8431313">,</span>&nbsp;<span class="ident" id="8431315">err</span><span class="op" id="8431318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8431321">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8431325">//&nbsp;Unknown&nbsp;service</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8431345">args</span>&nbsp;<span class="op" id="8431350">=</span>&nbsp;<span class="op" id="8431352">&amp;</span><span class="ident" id="8431353">Args</span><span class="op" id="8431357">{</span><span class="num" id="8431358">7</span><span class="op" id="8431359">,</span>&nbsp;<span class="num" id="8431361">8</span><span class="op" id="8431362">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8431365">reply</span>&nbsp;<span class="op" id="8431371">=</span>&nbsp;<span class="builtinfunc" id="8431373">new</span><span class="op" id="8431376">(</span><span class="ident" id="8431377">Reply</span><span class="op" id="8431382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8431385">err</span>&nbsp;<span class="op" id="8431389">=</span>&nbsp;<span class="ident" id="8431391">client</span><span class="op" id="8431397">.</span><span class="ident" id="8431398">Call</span><span class="op" id="8431402">(</span><span class="string" id="8431403">&#34;Arith.Unknown&#34;</span><span class="op" id="8431418">,</span>&nbsp;<span class="ident" id="8431420">args</span><span class="op" id="8431424">,</span>&nbsp;<span class="ident" id="8431426">reply</span><span class="op" id="8431431">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8431434">if</span>&nbsp;<span class="ident" id="8431437">err</span>&nbsp;<span class="op" id="8431441">==</span>&nbsp;<span class="ident" id="8431444">nil</span>&nbsp;<span class="op" id="8431448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8431452">t</span><span class="op" id="8431453">.</span><span class="ident" id="8431454">Error</span><span class="op" id="8431459">(</span><span class="string" id="8431460">&#34;expected&nbsp;error&nbsp;calling&nbsp;unknown&nbsp;service&#34;</span><span class="op" id="8431500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8431503">}</span>&nbsp;<span class="keyword" id="8431505">else</span>&nbsp;<span class="keyword" id="8431510">if</span>&nbsp;<span class="ident" id="8431513">strings</span><span class="op" id="8431520">.</span><span class="ident" id="8431521">Index</span><span class="op" id="8431526">(</span><span class="ident" id="8431527">err</span><span class="op" id="8431530">.</span><span class="ident" id="8431531">Error</span><span class="op" id="8431536">(</span><span class="op" id="8431537">)</span><span class="op" id="8431538">,</span>&nbsp;<span class="string" id="8431540">&#34;method&#34;</span><span class="op" id="8431548">)</span>&nbsp;<span class="op" id="8431550">&lt;</span>&nbsp;<span class="num" id="8431552">0</span>&nbsp;<span class="op" id="8431554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8431558">t</span><span class="op" id="8431559">.</span><span class="ident" id="8431560">Error</span><span class="op" id="8431565">(</span><span class="string" id="8431566">&#34;expected&nbsp;error&nbsp;about&nbsp;method;&nbsp;got&#34;</span><span class="op" id="8431600">,</span>&nbsp;<span class="ident" id="8431602">err</span><span class="op" id="8431605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8431608">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8431612">//&nbsp;Out&nbsp;of&nbsp;order.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8431630">args</span>&nbsp;<span class="op" id="8431635">=</span>&nbsp;<span class="op" id="8431637">&amp;</span><span class="ident" id="8431638">Args</span><span class="op" id="8431642">{</span><span class="num" id="8431643">7</span><span class="op" id="8431644">,</span>&nbsp;<span class="num" id="8431646">8</span><span class="op" id="8431647">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8431650">mulReply</span>&nbsp;<span class="op" id="8431659">:=</span>&nbsp;<span class="builtinfunc" id="8431662">new</span><span class="op" id="8431665">(</span><span class="ident" id="8431666">Reply</span><span class="op" id="8431671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8431674">mulCall</span>&nbsp;<span class="op" id="8431682">:=</span>&nbsp;<span class="ident" id="8431685">client</span><span class="op" id="8431691">.</span><span class="ident" id="8431692">Go</span><span class="op" id="8431694">(</span><span class="string" id="8431695">&#34;Arith.Mul&#34;</span><span class="op" id="8431706">,</span>&nbsp;<span class="ident" id="8431708">args</span><span class="op" id="8431712">,</span>&nbsp;<span class="ident" id="8431714">mulReply</span><span class="op" id="8431722">,</span>&nbsp;<span class="ident" id="8431724">nil</span><span class="op" id="8431727">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8431730">addReply</span>&nbsp;<span class="op" id="8431739">:=</span>&nbsp;<span class="builtinfunc" id="8431742">new</span><span class="op" id="8431745">(</span><span class="ident" id="8431746">Reply</span><span class="op" id="8431751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8431754">addCall</span>&nbsp;<span class="op" id="8431762">:=</span>&nbsp;<span class="ident" id="8431765">client</span><span class="op" id="8431771">.</span><span class="ident" id="8431772">Go</span><span class="op" id="8431774">(</span><span class="string" id="8431775">&#34;Arith.Add&#34;</span><span class="op" id="8431786">,</span>&nbsp;<span class="ident" id="8431788">args</span><span class="op" id="8431792">,</span>&nbsp;<span class="ident" id="8431794">addReply</span><span class="op" id="8431802">,</span>&nbsp;<span class="ident" id="8431804">nil</span><span class="op" id="8431807">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8431811">addCall</span>&nbsp;<span class="op" id="8431819">=</span>&nbsp;<span class="op" id="8431821">&lt;-</span><span class="ident" id="8431823">addCall</span><span class="op" id="8431830">.</span><span class="ident" id="8431831">Done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8431837">if</span>&nbsp;<span class="ident" id="8431840">addCall</span><span class="op" id="8431847">.</span><span class="ident" id="8431848">Error</span>&nbsp;<span class="op" id="8431854">!=</span>&nbsp;<span class="ident" id="8431857">nil</span>&nbsp;<span class="op" id="8431861">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8431865">t</span><span class="op" id="8431866">.</span><span class="ident" id="8431867">Errorf</span><span class="op" id="8431873">(</span><span class="string" id="8431874">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="8431916">,</span>&nbsp;<span class="ident" id="8431918">addCall</span><span class="op" id="8431925">.</span><span class="ident" id="8431926">Error</span><span class="op" id="8431931">.</span><span class="ident" id="8431932">Error</span><span class="op" id="8431937">(</span><span class="op" id="8431938">)</span><span class="op" id="8431939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8431942">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8431945">if</span>&nbsp;<span class="ident" id="8431948">addReply</span><span class="op" id="8431956">.</span><span class="ident" id="8431957">C</span>&nbsp;<span class="op" id="8431959">!=</span>&nbsp;<span class="ident" id="8431962">args</span><span class="op" id="8431966">.</span><span class="ident" id="8431967">A</span><span class="op" id="8431968">+</span><span class="ident" id="8431969">args</span><span class="op" id="8431973">.</span><span class="ident" id="8431974">B</span>&nbsp;<span class="op" id="8431976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8431980">t</span><span class="op" id="8431981">.</span><span class="ident" id="8431982">Errorf</span><span class="op" id="8431988">(</span><span class="string" id="8431989">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="8432014">,</span>&nbsp;<span class="ident" id="8432016">addReply</span><span class="op" id="8432024">.</span><span class="ident" id="8432025">C</span><span class="op" id="8432026">,</span>&nbsp;<span class="ident" id="8432028">args</span><span class="op" id="8432032">.</span><span class="ident" id="8432033">A</span><span class="op" id="8432034">+</span><span class="ident" id="8432035">args</span><span class="op" id="8432039">.</span><span class="ident" id="8432040">B</span><span class="op" id="8432041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8432044">}</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8432048">mulCall</span>&nbsp;<span class="op" id="8432056">=</span>&nbsp;<span class="op" id="8432058">&lt;-</span><span class="ident" id="8432060">mulCall</span><span class="op" id="8432067">.</span><span class="ident" id="8432068">Done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8432074">if</span>&nbsp;<span class="ident" id="8432077">mulCall</span><span class="op" id="8432084">.</span><span class="ident" id="8432085">Error</span>&nbsp;<span class="op" id="8432091">!=</span>&nbsp;<span class="ident" id="8432094">nil</span>&nbsp;<span class="op" id="8432098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8432102">t</span><span class="op" id="8432103">.</span><span class="ident" id="8432104">Errorf</span><span class="op" id="8432110">(</span><span class="string" id="8432111">&#34;Mul:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="8432153">,</span>&nbsp;<span class="ident" id="8432155">mulCall</span><span class="op" id="8432162">.</span><span class="ident" id="8432163">Error</span><span class="op" id="8432168">.</span><span class="ident" id="8432169">Error</span><span class="op" id="8432174">(</span><span class="op" id="8432175">)</span><span class="op" id="8432176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8432179">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8432182">if</span>&nbsp;<span class="ident" id="8432185">mulReply</span><span class="op" id="8432193">.</span><span class="ident" id="8432194">C</span>&nbsp;<span class="op" id="8432196">!=</span>&nbsp;<span class="ident" id="8432199">args</span><span class="op" id="8432203">.</span><span class="ident" id="8432204">A</span><span class="op" id="8432205">*</span><span class="ident" id="8432206">args</span><span class="op" id="8432210">.</span><span class="ident" id="8432211">B</span>&nbsp;<span class="op" id="8432213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8432217">t</span><span class="op" id="8432218">.</span><span class="ident" id="8432219">Errorf</span><span class="op" id="8432225">(</span><span class="string" id="8432226">&#34;Mul:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="8432251">,</span>&nbsp;<span class="ident" id="8432253">mulReply</span><span class="op" id="8432261">.</span><span class="ident" id="8432262">C</span><span class="op" id="8432263">,</span>&nbsp;<span class="ident" id="8432265">args</span><span class="op" id="8432269">.</span><span class="ident" id="8432270">A</span><span class="op" id="8432271">*</span><span class="ident" id="8432272">args</span><span class="op" id="8432276">.</span><span class="ident" id="8432277">B</span><span class="op" id="8432278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8432281">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8432285">//&nbsp;Error&nbsp;test</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8432300">args</span>&nbsp;<span class="op" id="8432305">=</span>&nbsp;<span class="op" id="8432307">&amp;</span><span class="ident" id="8432308">Args</span><span class="op" id="8432312">{</span><span class="num" id="8432313">7</span><span class="op" id="8432314">,</span>&nbsp;<span class="num" id="8432316">0</span><span class="op" id="8432317">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8432320">reply</span>&nbsp;<span class="op" id="8432326">=</span>&nbsp;<span class="builtinfunc" id="8432328">new</span><span class="op" id="8432331">(</span><span class="ident" id="8432332">Reply</span><span class="op" id="8432337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8432340">err</span>&nbsp;<span class="op" id="8432344">=</span>&nbsp;<span class="ident" id="8432346">client</span><span class="op" id="8432352">.</span><span class="ident" id="8432353">Call</span><span class="op" id="8432357">(</span><span class="string" id="8432358">&#34;Arith.Div&#34;</span><span class="op" id="8432369">,</span>&nbsp;<span class="ident" id="8432371">args</span><span class="op" id="8432375">,</span>&nbsp;<span class="ident" id="8432377">reply</span><span class="op" id="8432382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8432385">//&nbsp;expect&nbsp;an&nbsp;error:&nbsp;zero&nbsp;divide</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8432418">if</span>&nbsp;<span class="ident" id="8432421">err</span>&nbsp;<span class="op" id="8432425">==</span>&nbsp;<span class="ident" id="8432428">nil</span>&nbsp;<span class="op" id="8432432">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8432436">t</span><span class="op" id="8432437">.</span><span class="ident" id="8432438">Error</span><span class="op" id="8432443">(</span><span class="string" id="8432444">&#34;Div:&nbsp;expected&nbsp;error&#34;</span><span class="op" id="8432465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8432468">}</span>&nbsp;<span class="keyword" id="8432470">else</span>&nbsp;<span class="keyword" id="8432475">if</span>&nbsp;<span class="ident" id="8432478">err</span><span class="op" id="8432481">.</span><span class="ident" id="8432482">Error</span><span class="op" id="8432487">(</span><span class="op" id="8432488">)</span>&nbsp;<span class="op" id="8432490">!=</span>&nbsp;<span class="string" id="8432493">&#34;divide&nbsp;by&nbsp;zero&#34;</span>&nbsp;<span class="op" id="8432510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8432514">t</span><span class="op" id="8432515">.</span><span class="ident" id="8432516">Error</span><span class="op" id="8432521">(</span><span class="string" id="8432522">&#34;Div:&nbsp;expected&nbsp;divide&nbsp;by&nbsp;zero&nbsp;error;&nbsp;got&#34;</span><span class="op" id="8432563">,</span>&nbsp;<span class="ident" id="8432565">err</span><span class="op" id="8432568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8432571">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8432575">//&nbsp;Bad&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8432589">reply</span>&nbsp;<span class="op" id="8432595">=</span>&nbsp;<span class="builtinfunc" id="8432597">new</span><span class="op" id="8432600">(</span><span class="ident" id="8432601">Reply</span><span class="op" id="8432606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8432609">err</span>&nbsp;<span class="op" id="8432613">=</span>&nbsp;<span class="ident" id="8432615">client</span><span class="op" id="8432621">.</span><span class="ident" id="8432622">Call</span><span class="op" id="8432626">(</span><span class="string" id="8432627">&#34;Arith.Add&#34;</span><span class="op" id="8432638">,</span>&nbsp;<span class="ident" id="8432640">reply</span><span class="op" id="8432645">,</span>&nbsp;<span class="ident" id="8432647">reply</span><span class="op" id="8432652">)</span>&nbsp;<span class="comment" id="8432654">//&nbsp;args,&nbsp;reply&nbsp;would&nbsp;be&nbsp;the&nbsp;correct&nbsp;thing&nbsp;to&nbsp;use</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8432704">if</span>&nbsp;<span class="ident" id="8432707">err</span>&nbsp;<span class="op" id="8432711">==</span>&nbsp;<span class="ident" id="8432714">nil</span>&nbsp;<span class="op" id="8432718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8432722">t</span><span class="op" id="8432723">.</span><span class="ident" id="8432724">Error</span><span class="op" id="8432729">(</span><span class="string" id="8432730">&#34;expected&nbsp;error&nbsp;calling&nbsp;Arith.Add&nbsp;with&nbsp;wrong&nbsp;arg&nbsp;type&#34;</span><span class="op" id="8432784">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8432787">}</span>&nbsp;<span class="keyword" id="8432789">else</span>&nbsp;<span class="keyword" id="8432794">if</span>&nbsp;<span class="ident" id="8432797">strings</span><span class="op" id="8432804">.</span><span class="ident" id="8432805">Index</span><span class="op" id="8432810">(</span><span class="ident" id="8432811">err</span><span class="op" id="8432814">.</span><span class="ident" id="8432815">Error</span><span class="op" id="8432820">(</span><span class="op" id="8432821">)</span><span class="op" id="8432822">,</span>&nbsp;<span class="string" id="8432824">&#34;type&#34;</span><span class="op" id="8432830">)</span>&nbsp;<span class="op" id="8432832">&lt;</span>&nbsp;<span class="num" id="8432834">0</span>&nbsp;<span class="op" id="8432836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8432840">t</span><span class="op" id="8432841">.</span><span class="ident" id="8432842">Error</span><span class="op" id="8432847">(</span><span class="string" id="8432848">&#34;expected&nbsp;error&nbsp;about&nbsp;type;&nbsp;got&#34;</span><span class="op" id="8432880">,</span>&nbsp;<span class="ident" id="8432882">err</span><span class="op" id="8432885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8432888">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8432892">//&nbsp;Non-struct&nbsp;argument</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8432916">const</span>&nbsp;<span class="ident" id="8432922">Val</span>&nbsp;<span class="op" id="8432926">=</span>&nbsp;<span class="num" id="8432928">12345</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8432935">str</span>&nbsp;<span class="op" id="8432939">:=</span>&nbsp;<span class="ident" id="8432942">fmt</span><span class="op" id="8432945">.</span><span class="ident" id="8432946">Sprint</span><span class="op" id="8432952">(</span><span class="ident" id="8432953">Val</span><span class="op" id="8432956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8432959">reply</span>&nbsp;<span class="op" id="8432965">=</span>&nbsp;<span class="builtinfunc" id="8432967">new</span><span class="op" id="8432970">(</span><span class="ident" id="8432971">Reply</span><span class="op" id="8432976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8432979">err</span>&nbsp;<span class="op" id="8432983">=</span>&nbsp;<span class="ident" id="8432985">client</span><span class="op" id="8432991">.</span><span class="ident" id="8432992">Call</span><span class="op" id="8432996">(</span><span class="string" id="8432997">&#34;Arith.Scan&#34;</span><span class="op" id="8433009">,</span>&nbsp;<span class="op" id="8433011">&amp;</span><span class="ident" id="8433012">str</span><span class="op" id="8433015">,</span>&nbsp;<span class="ident" id="8433017">reply</span><span class="op" id="8433022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8433025">if</span>&nbsp;<span class="ident" id="8433028">err</span>&nbsp;<span class="op" id="8433032">!=</span>&nbsp;<span class="ident" id="8433035">nil</span>&nbsp;<span class="op" id="8433039">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8433043">t</span><span class="op" id="8433044">.</span><span class="ident" id="8433045">Errorf</span><span class="op" id="8433051">(</span><span class="string" id="8433052">&#34;Scan:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="8433095">,</span>&nbsp;<span class="ident" id="8433097">err</span><span class="op" id="8433100">.</span><span class="ident" id="8433101">Error</span><span class="op" id="8433106">(</span><span class="op" id="8433107">)</span><span class="op" id="8433108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8433111">}</span>&nbsp;<span class="keyword" id="8433113">else</span>&nbsp;<span class="keyword" id="8433118">if</span>&nbsp;<span class="ident" id="8433121">reply</span><span class="op" id="8433126">.</span><span class="ident" id="8433127">C</span>&nbsp;<span class="op" id="8433129">!=</span>&nbsp;<span class="ident" id="8433132">Val</span>&nbsp;<span class="op" id="8433136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8433140">t</span><span class="op" id="8433141">.</span><span class="ident" id="8433142">Errorf</span><span class="op" id="8433148">(</span><span class="string" id="8433149">&#34;Scan:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="8433175">,</span>&nbsp;<span class="ident" id="8433177">Val</span><span class="op" id="8433180">,</span>&nbsp;<span class="ident" id="8433182">reply</span><span class="op" id="8433187">.</span><span class="ident" id="8433188">C</span><span class="op" id="8433189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8433192">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8433196">//&nbsp;Non-struct&nbsp;reply</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8433217">args</span>&nbsp;<span class="op" id="8433222">=</span>&nbsp;<span class="op" id="8433224">&amp;</span><span class="ident" id="8433225">Args</span><span class="op" id="8433229">{</span><span class="num" id="8433230">27</span><span class="op" id="8433232">,</span>&nbsp;<span class="num" id="8433234">35</span><span class="op" id="8433236">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8433239">str</span>&nbsp;<span class="op" id="8433243">=</span>&nbsp;<span class="string" id="8433245">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8433249">err</span>&nbsp;<span class="op" id="8433253">=</span>&nbsp;<span class="ident" id="8433255">client</span><span class="op" id="8433261">.</span><span class="ident" id="8433262">Call</span><span class="op" id="8433266">(</span><span class="string" id="8433267">&#34;Arith.String&#34;</span><span class="op" id="8433281">,</span>&nbsp;<span class="ident" id="8433283">args</span><span class="op" id="8433287">,</span>&nbsp;<span class="op" id="8433289">&amp;</span><span class="ident" id="8433290">str</span><span class="op" id="8433293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8433296">if</span>&nbsp;<span class="ident" id="8433299">err</span>&nbsp;<span class="op" id="8433303">!=</span>&nbsp;<span class="ident" id="8433306">nil</span>&nbsp;<span class="op" id="8433310">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8433314">t</span><span class="op" id="8433315">.</span><span class="ident" id="8433316">Errorf</span><span class="op" id="8433322">(</span><span class="string" id="8433323">&#34;String:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="8433368">,</span>&nbsp;<span class="ident" id="8433370">err</span><span class="op" id="8433373">.</span><span class="ident" id="8433374">Error</span><span class="op" id="8433379">(</span><span class="op" id="8433380">)</span><span class="op" id="8433381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8433384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8433387">expect</span>&nbsp;<span class="op" id="8433394">:=</span>&nbsp;<span class="ident" id="8433397">fmt</span><span class="op" id="8433400">.</span><span class="ident" id="8433401">Sprintf</span><span class="op" id="8433408">(</span><span class="string" id="8433409">&#34;%d+%d=%d&#34;</span><span class="op" id="8433419">,</span>&nbsp;<span class="ident" id="8433421">args</span><span class="op" id="8433425">.</span><span class="ident" id="8433426">A</span><span class="op" id="8433427">,</span>&nbsp;<span class="ident" id="8433429">args</span><span class="op" id="8433433">.</span><span class="ident" id="8433434">B</span><span class="op" id="8433435">,</span>&nbsp;<span class="ident" id="8433437">args</span><span class="op" id="8433441">.</span><span class="ident" id="8433442">A</span><span class="op" id="8433443">+</span><span class="ident" id="8433444">args</span><span class="op" id="8433448">.</span><span class="ident" id="8433449">B</span><span class="op" id="8433450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8433453">if</span>&nbsp;<span class="ident" id="8433456">str</span>&nbsp;<span class="op" id="8433460">!=</span>&nbsp;<span class="ident" id="8433463">expect</span>&nbsp;<span class="op" id="8433470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8433474">t</span><span class="op" id="8433475">.</span><span class="ident" id="8433476">Errorf</span><span class="op" id="8433482">(</span><span class="string" id="8433483">&#34;String:&nbsp;expected&nbsp;%s&nbsp;got&nbsp;%s&#34;</span><span class="op" id="8433511">,</span>&nbsp;<span class="ident" id="8433513">expect</span><span class="op" id="8433519">,</span>&nbsp;<span class="ident" id="8433521">str</span><span class="op" id="8433524">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8433527">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8433531">args</span>&nbsp;<span class="op" id="8433536">=</span>&nbsp;<span class="op" id="8433538">&amp;</span><span class="ident" id="8433539">Args</span><span class="op" id="8433543">{</span><span class="num" id="8433544">7</span><span class="op" id="8433545">,</span>&nbsp;<span class="num" id="8433547">8</span><span class="op" id="8433548">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8433551">reply</span>&nbsp;<span class="op" id="8433557">=</span>&nbsp;<span class="builtinfunc" id="8433559">new</span><span class="op" id="8433562">(</span><span class="ident" id="8433563">Reply</span><span class="op" id="8433568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8433571">err</span>&nbsp;<span class="op" id="8433575">=</span>&nbsp;<span class="ident" id="8433577">client</span><span class="op" id="8433583">.</span><span class="ident" id="8433584">Call</span><span class="op" id="8433588">(</span><span class="string" id="8433589">&#34;Arith.Mul&#34;</span><span class="op" id="8433600">,</span>&nbsp;<span class="ident" id="8433602">args</span><span class="op" id="8433606">,</span>&nbsp;<span class="ident" id="8433608">reply</span><span class="op" id="8433613">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8433616">if</span>&nbsp;<span class="ident" id="8433619">err</span>&nbsp;<span class="op" id="8433623">!=</span>&nbsp;<span class="ident" id="8433626">nil</span>&nbsp;<span class="op" id="8433630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8433634">t</span><span class="op" id="8433635">.</span><span class="ident" id="8433636">Errorf</span><span class="op" id="8433642">(</span><span class="string" id="8433643">&#34;Mul:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="8433685">,</span>&nbsp;<span class="ident" id="8433687">err</span><span class="op" id="8433690">.</span><span class="ident" id="8433691">Error</span><span class="op" id="8433696">(</span><span class="op" id="8433697">)</span><span class="op" id="8433698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8433701">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8433704">if</span>&nbsp;<span class="ident" id="8433707">reply</span><span class="op" id="8433712">.</span><span class="ident" id="8433713">C</span>&nbsp;<span class="op" id="8433715">!=</span>&nbsp;<span class="ident" id="8433718">args</span><span class="op" id="8433722">.</span><span class="ident" id="8433723">A</span><span class="op" id="8433724">*</span><span class="ident" id="8433725">args</span><span class="op" id="8433729">.</span><span class="ident" id="8433730">B</span>&nbsp;<span class="op" id="8433732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8433736">t</span><span class="op" id="8433737">.</span><span class="ident" id="8433738">Errorf</span><span class="op" id="8433744">(</span><span class="string" id="8433745">&#34;Mul:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="8433770">,</span>&nbsp;<span class="ident" id="8433772">reply</span><span class="op" id="8433777">.</span><span class="ident" id="8433778">C</span><span class="op" id="8433779">,</span>&nbsp;<span class="ident" id="8433781">args</span><span class="op" id="8433785">.</span><span class="ident" id="8433786">A</span><span class="op" id="8433787">*</span><span class="ident" id="8433788">args</span><span class="op" id="8433792">.</span><span class="ident" id="8433793">B</span><span class="op" id="8433794">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8433797">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8433801">//&nbsp;ServiceName&nbsp;contain&nbsp;&#34;.&#34;&nbsp;character</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8433839">args</span>&nbsp;<span class="op" id="8433844">=</span>&nbsp;<span class="op" id="8433846">&amp;</span><span class="ident" id="8433847">Args</span><span class="op" id="8433851">{</span><span class="num" id="8433852">7</span><span class="op" id="8433853">,</span>&nbsp;<span class="num" id="8433855">8</span><span class="op" id="8433856">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8433859">reply</span>&nbsp;<span class="op" id="8433865">=</span>&nbsp;<span class="builtinfunc" id="8433867">new</span><span class="op" id="8433870">(</span><span class="ident" id="8433871">Reply</span><span class="op" id="8433876">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8433879">err</span>&nbsp;<span class="op" id="8433883">=</span>&nbsp;<span class="ident" id="8433885">client</span><span class="op" id="8433891">.</span><span class="ident" id="8433892">Call</span><span class="op" id="8433896">(</span><span class="string" id="8433897">&#34;net.rpc.Arith.Add&#34;</span><span class="op" id="8433916">,</span>&nbsp;<span class="ident" id="8433918">args</span><span class="op" id="8433922">,</span>&nbsp;<span class="ident" id="8433924">reply</span><span class="op" id="8433929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8433932">if</span>&nbsp;<span class="ident" id="8433935">err</span>&nbsp;<span class="op" id="8433939">!=</span>&nbsp;<span class="ident" id="8433942">nil</span>&nbsp;<span class="op" id="8433946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8433950">t</span><span class="op" id="8433951">.</span><span class="ident" id="8433952">Errorf</span><span class="op" id="8433958">(</span><span class="string" id="8433959">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="8434001">,</span>&nbsp;<span class="ident" id="8434003">err</span><span class="op" id="8434006">.</span><span class="ident" id="8434007">Error</span><span class="op" id="8434012">(</span><span class="op" id="8434013">)</span><span class="op" id="8434014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8434017">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8434020">if</span>&nbsp;<span class="ident" id="8434023">reply</span><span class="op" id="8434028">.</span><span class="ident" id="8434029">C</span>&nbsp;<span class="op" id="8434031">!=</span>&nbsp;<span class="ident" id="8434034">args</span><span class="op" id="8434038">.</span><span class="ident" id="8434039">A</span><span class="op" id="8434040">+</span><span class="ident" id="8434041">args</span><span class="op" id="8434045">.</span><span class="ident" id="8434046">B</span>&nbsp;<span class="op" id="8434048">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8434052">t</span><span class="op" id="8434053">.</span><span class="ident" id="8434054">Errorf</span><span class="op" id="8434060">(</span><span class="string" id="8434061">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="8434086">,</span>&nbsp;<span class="ident" id="8434088">reply</span><span class="op" id="8434093">.</span><span class="ident" id="8434094">C</span><span class="op" id="8434095">,</span>&nbsp;<span class="ident" id="8434097">args</span><span class="op" id="8434101">.</span><span class="ident" id="8434102">A</span><span class="op" id="8434103">+</span><span class="ident" id="8434104">args</span><span class="op" id="8434108">.</span><span class="ident" id="8434109">B</span><span class="op" id="8434110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8434113">}</span><br>
<span class="lineno"></span><span class="op" id="8434115">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8434118">func</span>&nbsp;<span class="ident" id="8434123">testNewServerRPC</span><span class="op" id="8434139">(</span><span class="ident" id="8434140">t</span>&nbsp;<span class="op" id="8434142">*</span><span class="ident" id="8434143">testing</span><span class="op" id="8434150">.</span><span class="ident" id="8434151">T</span><span class="op" id="8434152">,</span>&nbsp;<span class="ident" id="8434154">addr</span>&nbsp;<span class="builtintype" id="8434159">string</span><span class="op" id="8434165">)</span>&nbsp;<span class="op" id="8434167">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8434170">client</span><span class="op" id="8434176">,</span>&nbsp;<span class="ident" id="8434178">err</span>&nbsp;<span class="op" id="8434182">:=</span>&nbsp;<span class="ident" id="8434185">Dial</span><span class="op" id="8434189">(</span><span class="string" id="8434190">&#34;tcp&#34;</span><span class="op" id="8434195">,</span>&nbsp;<span class="ident" id="8434197">addr</span><span class="op" id="8434201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8434204">if</span>&nbsp;<span class="ident" id="8434207">err</span>&nbsp;<span class="op" id="8434211">!=</span>&nbsp;<span class="ident" id="8434214">nil</span>&nbsp;<span class="op" id="8434218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8434222">t</span><span class="op" id="8434223">.</span><span class="ident" id="8434224">Fatal</span><span class="op" id="8434229">(</span><span class="string" id="8434230">&#34;dialing&#34;</span><span class="op" id="8434239">,</span>&nbsp;<span class="ident" id="8434241">err</span><span class="op" id="8434244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8434247">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8434250">defer</span>&nbsp;<span class="ident" id="8434256">client</span><span class="op" id="8434262">.</span><span class="ident" id="8434263">Close</span><span class="op" id="8434268">(</span><span class="op" id="8434269">)</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8434273">//&nbsp;Synchronous&nbsp;calls</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8434295">args</span>&nbsp;<span class="op" id="8434300">:=</span>&nbsp;<span class="op" id="8434303">&amp;</span><span class="ident" id="8434304">Args</span><span class="op" id="8434308">{</span><span class="num" id="8434309">7</span><span class="op" id="8434310">,</span>&nbsp;<span class="num" id="8434312">8</span><span class="op" id="8434313">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8434316">reply</span>&nbsp;<span class="op" id="8434322">:=</span>&nbsp;<span class="builtinfunc" id="8434325">new</span><span class="op" id="8434328">(</span><span class="ident" id="8434329">Reply</span><span class="op" id="8434334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8434337">err</span>&nbsp;<span class="op" id="8434341">=</span>&nbsp;<span class="ident" id="8434343">client</span><span class="op" id="8434349">.</span><span class="ident" id="8434350">Call</span><span class="op" id="8434354">(</span><span class="string" id="8434355">&#34;newServer.Arith.Add&#34;</span><span class="op" id="8434376">,</span>&nbsp;<span class="ident" id="8434378">args</span><span class="op" id="8434382">,</span>&nbsp;<span class="ident" id="8434384">reply</span><span class="op" id="8434389">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8434392">if</span>&nbsp;<span class="ident" id="8434395">err</span>&nbsp;<span class="op" id="8434399">!=</span>&nbsp;<span class="ident" id="8434402">nil</span>&nbsp;<span class="op" id="8434406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8434410">t</span><span class="op" id="8434411">.</span><span class="ident" id="8434412">Errorf</span><span class="op" id="8434418">(</span><span class="string" id="8434419">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="8434461">,</span>&nbsp;<span class="ident" id="8434463">err</span><span class="op" id="8434466">.</span><span class="ident" id="8434467">Error</span><span class="op" id="8434472">(</span><span class="op" id="8434473">)</span><span class="op" id="8434474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8434477">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8434480">if</span>&nbsp;<span class="ident" id="8434483">reply</span><span class="op" id="8434488">.</span><span class="ident" id="8434489">C</span>&nbsp;<span class="op" id="8434491">!=</span>&nbsp;<span class="ident" id="8434494">args</span><span class="op" id="8434498">.</span><span class="ident" id="8434499">A</span><span class="op" id="8434500">+</span><span class="ident" id="8434501">args</span><span class="op" id="8434505">.</span><span class="ident" id="8434506">B</span>&nbsp;<span class="op" id="8434508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8434512">t</span><span class="op" id="8434513">.</span><span class="ident" id="8434514">Errorf</span><span class="op" id="8434520">(</span><span class="string" id="8434521">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="8434546">,</span>&nbsp;<span class="ident" id="8434548">reply</span><span class="op" id="8434553">.</span><span class="ident" id="8434554">C</span><span class="op" id="8434555">,</span>&nbsp;<span class="ident" id="8434557">args</span><span class="op" id="8434561">.</span><span class="ident" id="8434562">A</span><span class="op" id="8434563">+</span><span class="ident" id="8434564">args</span><span class="op" id="8434568">.</span><span class="ident" id="8434569">B</span><span class="op" id="8434570">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8434573">}</span><br>
<span class="lineno"></span><span class="op" id="8434575">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8434578">func</span>&nbsp;<span class="ident" id="8434583">TestHTTP</span><span class="op" id="8434591">(</span><span class="ident" id="8434592">t</span>&nbsp;<span class="op" id="8434594">*</span><span class="ident" id="8434595">testing</span><span class="op" id="8434602">.</span><span class="ident" id="8434603">T</span><span class="op" id="8434604">)</span>&nbsp;<span class="op" id="8434606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8434609">once</span><span class="op" id="8434613">.</span><span class="ident" id="8434614">Do</span><span class="op" id="8434616">(</span><span class="ident" id="8434617">startServer</span><span class="op" id="8434628">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8434631">testHTTPRPC</span><span class="op" id="8434642">(</span><span class="ident" id="8434643">t</span><span class="op" id="8434644">,</span>&nbsp;<span class="string" id="8434646">&#34;&#34;</span><span class="op" id="8434648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8434651">newOnce</span><span class="op" id="8434658">.</span><span class="ident" id="8434659">Do</span><span class="op" id="8434661">(</span><span class="ident" id="8434662">startNewServer</span><span class="op" id="8434676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8434679">testHTTPRPC</span><span class="op" id="8434690">(</span><span class="ident" id="8434691">t</span><span class="op" id="8434692">,</span>&nbsp;<span class="ident" id="8434694">newHttpPath</span><span class="op" id="8434705">)</span><br>
<span class="lineno"></span><span class="op" id="8434707">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span><span class="keyword" id="8434710">func</span>&nbsp;<span class="ident" id="8434715">testHTTPRPC</span><span class="op" id="8434726">(</span><span class="ident" id="8434727">t</span>&nbsp;<span class="op" id="8434729">*</span><span class="ident" id="8434730">testing</span><span class="op" id="8434737">.</span><span class="ident" id="8434738">T</span><span class="op" id="8434739">,</span>&nbsp;<span class="ident" id="8434741">path</span>&nbsp;<span class="builtintype" id="8434746">string</span><span class="op" id="8434752">)</span>&nbsp;<span class="op" id="8434754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8434757">var</span>&nbsp;<span class="ident" id="8434761">client</span>&nbsp;<span class="op" id="8434768">*</span><span class="ident" id="8434769">Client</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8434777">var</span>&nbsp;<span class="ident" id="8434781">err</span>&nbsp;<span class="builtintype" id="8434785">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8434792">if</span>&nbsp;<span class="ident" id="8434795">path</span>&nbsp;<span class="op" id="8434800">==</span>&nbsp;<span class="string" id="8434803">&#34;&#34;</span>&nbsp;<span class="op" id="8434806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8434810">client</span><span class="op" id="8434816">,</span>&nbsp;<span class="ident" id="8434818">err</span>&nbsp;<span class="op" id="8434822">=</span>&nbsp;<span class="ident" id="8434824">DialHTTP</span><span class="op" id="8434832">(</span><span class="string" id="8434833">&#34;tcp&#34;</span><span class="op" id="8434838">,</span>&nbsp;<span class="ident" id="8434840">httpServerAddr</span><span class="op" id="8434854">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8434857">}</span>&nbsp;<span class="keyword" id="8434859">else</span>&nbsp;<span class="op" id="8434864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8434868">client</span><span class="op" id="8434874">,</span>&nbsp;<span class="ident" id="8434876">err</span>&nbsp;<span class="op" id="8434880">=</span>&nbsp;<span class="ident" id="8434882">DialHTTPPath</span><span class="op" id="8434894">(</span><span class="string" id="8434895">&#34;tcp&#34;</span><span class="op" id="8434900">,</span>&nbsp;<span class="ident" id="8434902">httpServerAddr</span><span class="op" id="8434916">,</span>&nbsp;<span class="ident" id="8434918">path</span><span class="op" id="8434922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8434925">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8434928">if</span>&nbsp;<span class="ident" id="8434931">err</span>&nbsp;<span class="op" id="8434935">!=</span>&nbsp;<span class="ident" id="8434938">nil</span>&nbsp;<span class="op" id="8434942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8434946">t</span><span class="op" id="8434947">.</span><span class="ident" id="8434948">Fatal</span><span class="op" id="8434953">(</span><span class="string" id="8434954">&#34;dialing&#34;</span><span class="op" id="8434963">,</span>&nbsp;<span class="ident" id="8434965">err</span><span class="op" id="8434968">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8434971">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8434974">defer</span>&nbsp;<span class="ident" id="8434980">client</span><span class="op" id="8434986">.</span><span class="ident" id="8434987">Close</span><span class="op" id="8434992">(</span><span class="op" id="8434993">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8434997">//&nbsp;Synchronous&nbsp;calls</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8435019">args</span>&nbsp;<span class="op" id="8435024">:=</span>&nbsp;<span class="op" id="8435027">&amp;</span><span class="ident" id="8435028">Args</span><span class="op" id="8435032">{</span><span class="num" id="8435033">7</span><span class="op" id="8435034">,</span>&nbsp;<span class="num" id="8435036">8</span><span class="op" id="8435037">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8435040">reply</span>&nbsp;<span class="op" id="8435046">:=</span>&nbsp;<span class="builtinfunc" id="8435049">new</span><span class="op" id="8435052">(</span><span class="ident" id="8435053">Reply</span><span class="op" id="8435058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8435061">err</span>&nbsp;<span class="op" id="8435065">=</span>&nbsp;<span class="ident" id="8435067">client</span><span class="op" id="8435073">.</span><span class="ident" id="8435074">Call</span><span class="op" id="8435078">(</span><span class="string" id="8435079">&#34;Arith.Add&#34;</span><span class="op" id="8435090">,</span>&nbsp;<span class="ident" id="8435092">args</span><span class="op" id="8435096">,</span>&nbsp;<span class="ident" id="8435098">reply</span><span class="op" id="8435103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8435106">if</span>&nbsp;<span class="ident" id="8435109">err</span>&nbsp;<span class="op" id="8435113">!=</span>&nbsp;<span class="ident" id="8435116">nil</span>&nbsp;<span class="op" id="8435120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8435124">t</span><span class="op" id="8435125">.</span><span class="ident" id="8435126">Errorf</span><span class="op" id="8435132">(</span><span class="string" id="8435133">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="8435175">,</span>&nbsp;<span class="ident" id="8435177">err</span><span class="op" id="8435180">.</span><span class="ident" id="8435181">Error</span><span class="op" id="8435186">(</span><span class="op" id="8435187">)</span><span class="op" id="8435188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8435191">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8435194">if</span>&nbsp;<span class="ident" id="8435197">reply</span><span class="op" id="8435202">.</span><span class="ident" id="8435203">C</span>&nbsp;<span class="op" id="8435205">!=</span>&nbsp;<span class="ident" id="8435208">args</span><span class="op" id="8435212">.</span><span class="ident" id="8435213">A</span><span class="op" id="8435214">+</span><span class="ident" id="8435215">args</span><span class="op" id="8435219">.</span><span class="ident" id="8435220">B</span>&nbsp;<span class="op" id="8435222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8435226">t</span><span class="op" id="8435227">.</span><span class="ident" id="8435228">Errorf</span><span class="op" id="8435234">(</span><span class="string" id="8435235">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="8435260">,</span>&nbsp;<span class="ident" id="8435262">reply</span><span class="op" id="8435267">.</span><span class="ident" id="8435268">C</span><span class="op" id="8435269">,</span>&nbsp;<span class="ident" id="8435271">args</span><span class="op" id="8435275">.</span><span class="ident" id="8435276">A</span><span class="op" id="8435277">+</span><span class="ident" id="8435278">args</span><span class="op" id="8435282">.</span><span class="ident" id="8435283">B</span><span class="op" id="8435284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8435287">}</span><br>
<span class="lineno"></span><span class="op" id="8435289">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span><span class="comment" id="8435292">//&nbsp;CodecEmulator&nbsp;provides&nbsp;a&nbsp;client-like&nbsp;api&nbsp;and&nbsp;a&nbsp;ServerCodec&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment" id="8435365">//&nbsp;Can&nbsp;be&nbsp;used&nbsp;to&nbsp;test&nbsp;ServeRequest.</span><br>
<span class="lineno"></span><span class="keyword" id="8435402">type</span>&nbsp;<span class="ident" id="8435407">CodecEmulator</span>&nbsp;<span class="keyword" id="8435421">struct</span>&nbsp;<span class="op" id="8435428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8435431">server</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8435445">*</span><span class="ident" id="8435446">Server</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8435454">serviceMethod</span>&nbsp;<span class="builtintype" id="8435468">string</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8435476">args</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8435490">*</span><span class="ident" id="8435491">Args</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8435497">reply</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8435511">*</span><span class="ident" id="8435512">Reply</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8435519">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8435533">error</span><br>
<span class="lineno"></span><span class="op" id="8435539">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span><span class="keyword" id="8435542">func</span>&nbsp;<span class="op" id="8435547">(</span><span class="ident" id="8435548">codec</span>&nbsp;<span class="op" id="8435554">*</span><span class="ident" id="8435555">CodecEmulator</span><span class="op" id="8435568">)</span>&nbsp;<span class="ident" id="8435570">Call</span><span class="op" id="8435574">(</span><span class="ident" id="8435575">serviceMethod</span>&nbsp;<span class="builtintype" id="8435589">string</span><span class="op" id="8435595">,</span>&nbsp;<span class="ident" id="8435597">args</span>&nbsp;<span class="op" id="8435602">*</span><span class="ident" id="8435603">Args</span><span class="op" id="8435607">,</span>&nbsp;<span class="ident" id="8435609">reply</span>&nbsp;<span class="op" id="8435615">*</span><span class="ident" id="8435616">Reply</span><span class="op" id="8435621">)</span>&nbsp;<span class="builtintype" id="8435623">error</span>&nbsp;<span class="op" id="8435629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8435632">codec</span><span class="op" id="8435637">.</span><span class="ident" id="8435638">serviceMethod</span>&nbsp;<span class="op" id="8435652">=</span>&nbsp;<span class="ident" id="8435654">serviceMethod</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8435669">codec</span><span class="op" id="8435674">.</span><span class="ident" id="8435675">args</span>&nbsp;<span class="op" id="8435680">=</span>&nbsp;<span class="ident" id="8435682">args</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8435688">codec</span><span class="op" id="8435693">.</span><span class="ident" id="8435694">reply</span>&nbsp;<span class="op" id="8435700">=</span>&nbsp;<span class="ident" id="8435702">reply</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8435709">codec</span><span class="op" id="8435714">.</span><span class="ident" id="8435715">err</span>&nbsp;<span class="op" id="8435719">=</span>&nbsp;<span class="ident" id="8435721">nil</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8435726">var</span>&nbsp;<span class="ident" id="8435730">serverError</span>&nbsp;<span class="builtintype" id="8435742">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8435749">if</span>&nbsp;<span class="ident" id="8435752">codec</span><span class="op" id="8435757">.</span><span class="ident" id="8435758">server</span>&nbsp;<span class="op" id="8435765">==</span>&nbsp;<span class="ident" id="8435768">nil</span>&nbsp;<span class="op" id="8435772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8435776">serverError</span>&nbsp;<span class="op" id="8435788">=</span>&nbsp;<span class="ident" id="8435790">ServeRequest</span><span class="op" id="8435802">(</span><span class="ident" id="8435803">codec</span><span class="op" id="8435808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8435811">}</span>&nbsp;<span class="keyword" id="8435813">else</span>&nbsp;<span class="op" id="8435818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8435822">serverError</span>&nbsp;<span class="op" id="8435834">=</span>&nbsp;<span class="ident" id="8435836">codec</span><span class="op" id="8435841">.</span><span class="ident" id="8435842">server</span><span class="op" id="8435848">.</span><span class="ident" id="8435849">ServeRequest</span><span class="op" id="8435861">(</span><span class="ident" id="8435862">codec</span><span class="op" id="8435867">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8435870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8435873">if</span>&nbsp;<span class="ident" id="8435876">codec</span><span class="op" id="8435881">.</span><span class="ident" id="8435882">err</span>&nbsp;<span class="op" id="8435886">==</span>&nbsp;<span class="ident" id="8435889">nil</span>&nbsp;<span class="op" id="8435893">&amp;&amp;</span>&nbsp;<span class="ident" id="8435896">serverError</span>&nbsp;<span class="op" id="8435908">!=</span>&nbsp;<span class="ident" id="8435911">nil</span>&nbsp;<span class="op" id="8435915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8435919">codec</span><span class="op" id="8435924">.</span><span class="ident" id="8435925">err</span>&nbsp;<span class="op" id="8435929">=</span>&nbsp;<span class="ident" id="8435931">serverError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8435944">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8435947">return</span>&nbsp;<span class="ident" id="8435954">codec</span><span class="op" id="8435959">.</span><span class="ident" id="8435960">err</span><br>
<span class="lineno">330</span><span class="op" id="8435964">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8435967">func</span>&nbsp;<span class="op" id="8435972">(</span><span class="ident" id="8435973">codec</span>&nbsp;<span class="op" id="8435979">*</span><span class="ident" id="8435980">CodecEmulator</span><span class="op" id="8435993">)</span>&nbsp;<span class="ident" id="8435995">ReadRequestHeader</span><span class="op" id="8436012">(</span><span class="ident" id="8436013">req</span>&nbsp;<span class="op" id="8436017">*</span><span class="ident" id="8436018">Request</span><span class="op" id="8436025">)</span>&nbsp;<span class="builtintype" id="8436027">error</span>&nbsp;<span class="op" id="8436033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8436036">req</span><span class="op" id="8436039">.</span><span class="ident" id="8436040">ServiceMethod</span>&nbsp;<span class="op" id="8436054">=</span>&nbsp;<span class="ident" id="8436056">codec</span><span class="op" id="8436061">.</span><span class="ident" id="8436062">serviceMethod</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8436077">req</span><span class="op" id="8436080">.</span><span class="ident" id="8436081">Seq</span>&nbsp;<span class="op" id="8436085">=</span>&nbsp;<span class="num" id="8436087">0</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8436090">return</span>&nbsp;<span class="ident" id="8436097">nil</span><br>
<span class="lineno"></span><span class="op" id="8436101">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8436104">func</span>&nbsp;<span class="op" id="8436109">(</span><span class="ident" id="8436110">codec</span>&nbsp;<span class="op" id="8436116">*</span><span class="ident" id="8436117">CodecEmulator</span><span class="op" id="8436130">)</span>&nbsp;<span class="ident" id="8436132">ReadRequestBody</span><span class="op" id="8436147">(</span><span class="ident" id="8436148">argv</span>&nbsp;<span class="keyword" id="8436153">interface</span><span class="op" id="8436162">{</span><span class="op" id="8436163">}</span><span class="op" id="8436164">)</span>&nbsp;<span class="builtintype" id="8436166">error</span>&nbsp;<span class="op" id="8436172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8436175">if</span>&nbsp;<span class="ident" id="8436178">codec</span><span class="op" id="8436183">.</span><span class="ident" id="8436184">args</span>&nbsp;<span class="op" id="8436189">==</span>&nbsp;<span class="ident" id="8436192">nil</span>&nbsp;<span class="op" id="8436196">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8436200">return</span>&nbsp;<span class="ident" id="8436207">io</span><span class="op" id="8436209">.</span><span class="ident" id="8436210">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8436228">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8436231">*</span><span class="op" id="8436232">(</span><span class="ident" id="8436233">argv</span><span class="op" id="8436237">.</span><span class="op" id="8436238">(</span><span class="op" id="8436239">*</span><span class="ident" id="8436240">Args</span><span class="op" id="8436244">)</span><span class="op" id="8436245">)</span>&nbsp;<span class="op" id="8436247">=</span>&nbsp;<span class="op" id="8436249">*</span><span class="ident" id="8436250">codec</span><span class="op" id="8436255">.</span><span class="ident" id="8436256">args</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8436262">return</span>&nbsp;<span class="ident" id="8436269">nil</span><br>
<span class="lineno"></span><span class="op" id="8436273">}</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span><span class="keyword" id="8436276">func</span>&nbsp;<span class="op" id="8436281">(</span><span class="ident" id="8436282">codec</span>&nbsp;<span class="op" id="8436288">*</span><span class="ident" id="8436289">CodecEmulator</span><span class="op" id="8436302">)</span>&nbsp;<span class="ident" id="8436304">WriteResponse</span><span class="op" id="8436317">(</span><span class="ident" id="8436318">resp</span>&nbsp;<span class="op" id="8436323">*</span><span class="ident" id="8436324">Response</span><span class="op" id="8436332">,</span>&nbsp;<span class="ident" id="8436334">reply</span>&nbsp;<span class="keyword" id="8436340">interface</span><span class="op" id="8436349">{</span><span class="op" id="8436350">}</span><span class="op" id="8436351">)</span>&nbsp;<span class="builtintype" id="8436353">error</span>&nbsp;<span class="op" id="8436359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8436362">if</span>&nbsp;<span class="ident" id="8436365">resp</span><span class="op" id="8436369">.</span><span class="ident" id="8436370">Error</span>&nbsp;<span class="op" id="8436376">!=</span>&nbsp;<span class="string" id="8436379">&#34;&#34;</span>&nbsp;<span class="op" id="8436382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8436386">codec</span><span class="op" id="8436391">.</span><span class="ident" id="8436392">err</span>&nbsp;<span class="op" id="8436396">=</span>&nbsp;<span class="ident" id="8436398">errors</span><span class="op" id="8436404">.</span><span class="ident" id="8436405">New</span><span class="op" id="8436408">(</span><span class="ident" id="8436409">resp</span><span class="op" id="8436413">.</span><span class="ident" id="8436414">Error</span><span class="op" id="8436419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8436422">}</span>&nbsp;<span class="keyword" id="8436424">else</span>&nbsp;<span class="op" id="8436429">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8436433">*</span><span class="ident" id="8436434">codec</span><span class="op" id="8436439">.</span><span class="ident" id="8436440">reply</span>&nbsp;<span class="op" id="8436446">=</span>&nbsp;<span class="op" id="8436448">*</span><span class="op" id="8436449">(</span><span class="ident" id="8436450">reply</span><span class="op" id="8436455">.</span><span class="op" id="8436456">(</span><span class="op" id="8436457">*</span><span class="ident" id="8436458">Reply</span><span class="op" id="8436463">)</span><span class="op" id="8436464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8436467">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8436470">return</span>&nbsp;<span class="ident" id="8436477">nil</span><br>
<span class="lineno"></span><span class="op" id="8436481">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="keyword" id="8436484">func</span>&nbsp;<span class="op" id="8436489">(</span><span class="ident" id="8436490">codec</span>&nbsp;<span class="op" id="8436496">*</span><span class="ident" id="8436497">CodecEmulator</span><span class="op" id="8436510">)</span>&nbsp;<span class="ident" id="8436512">Close</span><span class="op" id="8436517">(</span><span class="op" id="8436518">)</span>&nbsp;<span class="builtintype" id="8436520">error</span>&nbsp;<span class="op" id="8436526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8436529">return</span>&nbsp;<span class="ident" id="8436536">nil</span><br>
<span class="lineno"></span><span class="op" id="8436540">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8436543">func</span>&nbsp;<span class="ident" id="8436548">TestServeRequest</span><span class="op" id="8436564">(</span><span class="ident" id="8436565">t</span>&nbsp;<span class="op" id="8436567">*</span><span class="ident" id="8436568">testing</span><span class="op" id="8436575">.</span><span class="ident" id="8436576">T</span><span class="op" id="8436577">)</span>&nbsp;<span class="op" id="8436579">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8436582">once</span><span class="op" id="8436586">.</span><span class="ident" id="8436587">Do</span><span class="op" id="8436589">(</span><span class="ident" id="8436590">startServer</span><span class="op" id="8436601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8436604">testServeRequest</span><span class="op" id="8436620">(</span><span class="ident" id="8436621">t</span><span class="op" id="8436622">,</span>&nbsp;<span class="ident" id="8436624">nil</span><span class="op" id="8436627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8436630">newOnce</span><span class="op" id="8436637">.</span><span class="ident" id="8436638">Do</span><span class="op" id="8436640">(</span><span class="ident" id="8436641">startNewServer</span><span class="op" id="8436655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8436658">testServeRequest</span><span class="op" id="8436674">(</span><span class="ident" id="8436675">t</span><span class="op" id="8436676">,</span>&nbsp;<span class="ident" id="8436678">newServer</span><span class="op" id="8436687">)</span><br>
<span class="lineno"></span><span class="op" id="8436689">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="keyword" id="8436692">func</span>&nbsp;<span class="ident" id="8436697">testServeRequest</span><span class="op" id="8436713">(</span><span class="ident" id="8436714">t</span>&nbsp;<span class="op" id="8436716">*</span><span class="ident" id="8436717">testing</span><span class="op" id="8436724">.</span><span class="ident" id="8436725">T</span><span class="op" id="8436726">,</span>&nbsp;<span class="ident" id="8436728">server</span>&nbsp;<span class="op" id="8436735">*</span><span class="ident" id="8436736">Server</span><span class="op" id="8436742">)</span>&nbsp;<span class="op" id="8436744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8436747">client</span>&nbsp;<span class="op" id="8436754">:=</span>&nbsp;<span class="ident" id="8436757">CodecEmulator</span><span class="op" id="8436770">{</span><span class="ident" id="8436771">server</span><span class="op" id="8436777">:</span>&nbsp;<span class="ident" id="8436779">server</span><span class="op" id="8436785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8436788">defer</span>&nbsp;<span class="ident" id="8436794">client</span><span class="op" id="8436800">.</span><span class="ident" id="8436801">Close</span><span class="op" id="8436806">(</span><span class="op" id="8436807">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8436811">args</span>&nbsp;<span class="op" id="8436816">:=</span>&nbsp;<span class="op" id="8436819">&amp;</span><span class="ident" id="8436820">Args</span><span class="op" id="8436824">{</span><span class="num" id="8436825">7</span><span class="op" id="8436826">,</span>&nbsp;<span class="num" id="8436828">8</span><span class="op" id="8436829">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8436832">reply</span>&nbsp;<span class="op" id="8436838">:=</span>&nbsp;<span class="builtinfunc" id="8436841">new</span><span class="op" id="8436844">(</span><span class="ident" id="8436845">Reply</span><span class="op" id="8436850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8436853">err</span>&nbsp;<span class="op" id="8436857">:=</span>&nbsp;<span class="ident" id="8436860">client</span><span class="op" id="8436866">.</span><span class="ident" id="8436867">Call</span><span class="op" id="8436871">(</span><span class="string" id="8436872">&#34;Arith.Add&#34;</span><span class="op" id="8436883">,</span>&nbsp;<span class="ident" id="8436885">args</span><span class="op" id="8436889">,</span>&nbsp;<span class="ident" id="8436891">reply</span><span class="op" id="8436896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8436899">if</span>&nbsp;<span class="ident" id="8436902">err</span>&nbsp;<span class="op" id="8436906">!=</span>&nbsp;<span class="ident" id="8436909">nil</span>&nbsp;<span class="op" id="8436913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8436917">t</span><span class="op" id="8436918">.</span><span class="ident" id="8436919">Errorf</span><span class="op" id="8436925">(</span><span class="string" id="8436926">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="8436968">,</span>&nbsp;<span class="ident" id="8436970">err</span><span class="op" id="8436973">.</span><span class="ident" id="8436974">Error</span><span class="op" id="8436979">(</span><span class="op" id="8436980">)</span><span class="op" id="8436981">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8436984">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8436987">if</span>&nbsp;<span class="ident" id="8436990">reply</span><span class="op" id="8436995">.</span><span class="ident" id="8436996">C</span>&nbsp;<span class="op" id="8436998">!=</span>&nbsp;<span class="ident" id="8437001">args</span><span class="op" id="8437005">.</span><span class="ident" id="8437006">A</span><span class="op" id="8437007">+</span><span class="ident" id="8437008">args</span><span class="op" id="8437012">.</span><span class="ident" id="8437013">B</span>&nbsp;<span class="op" id="8437015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8437019">t</span><span class="op" id="8437020">.</span><span class="ident" id="8437021">Errorf</span><span class="op" id="8437027">(</span><span class="string" id="8437028">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="8437053">,</span>&nbsp;<span class="ident" id="8437055">reply</span><span class="op" id="8437060">.</span><span class="ident" id="8437061">C</span><span class="op" id="8437062">,</span>&nbsp;<span class="ident" id="8437064">args</span><span class="op" id="8437068">.</span><span class="ident" id="8437069">A</span><span class="op" id="8437070">+</span><span class="ident" id="8437071">args</span><span class="op" id="8437075">.</span><span class="ident" id="8437076">B</span><span class="op" id="8437077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8437080">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8437084">err</span>&nbsp;<span class="op" id="8437088">=</span>&nbsp;<span class="ident" id="8437090">client</span><span class="op" id="8437096">.</span><span class="ident" id="8437097">Call</span><span class="op" id="8437101">(</span><span class="string" id="8437102">&#34;Arith.Add&#34;</span><span class="op" id="8437113">,</span>&nbsp;<span class="ident" id="8437115">nil</span><span class="op" id="8437118">,</span>&nbsp;<span class="ident" id="8437120">reply</span><span class="op" id="8437125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8437128">if</span>&nbsp;<span class="ident" id="8437131">err</span>&nbsp;<span class="op" id="8437135">==</span>&nbsp;<span class="ident" id="8437138">nil</span>&nbsp;<span class="op" id="8437142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8437146">t</span><span class="op" id="8437147">.</span><span class="ident" id="8437148">Errorf</span><span class="op" id="8437154">(</span><span class="string" id="8437155">&#34;expected&nbsp;error&nbsp;calling&nbsp;Arith.Add&nbsp;with&nbsp;nil&nbsp;arg&#34;</span><span class="op" id="8437202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8437205">}</span><br>
<span class="lineno"></span><span class="op" id="8437207">}</span><br>
<span class="lineno">385</span><br>
<span class="lineno"></span><span class="keyword" id="8437210">type</span>&nbsp;<span class="ident" id="8437215">ReplyNotPointer</span>&nbsp;<span class="builtintype" id="8437231">int</span><br>
<span class="lineno"></span><span class="keyword" id="8437235">type</span>&nbsp;<span class="ident" id="8437240">ArgNotPublic</span>&nbsp;<span class="builtintype" id="8437253">int</span><br>
<span class="lineno"></span><span class="keyword" id="8437257">type</span>&nbsp;<span class="ident" id="8437262">ReplyNotPublic</span>&nbsp;<span class="builtintype" id="8437277">int</span><br>
<span class="lineno"></span><span class="keyword" id="8437281">type</span>&nbsp;<span class="ident" id="8437286">NeedsPtrType</span>&nbsp;<span class="builtintype" id="8437299">int</span><br>
<span class="lineno">390</span><span class="keyword" id="8437303">type</span>&nbsp;<span class="ident" id="8437308">local</span>&nbsp;<span class="keyword" id="8437314">struct</span><span class="op" id="8437320">{</span><span class="op" id="8437321">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8437324">func</span>&nbsp;<span class="op" id="8437329">(</span><span class="ident" id="8437330">t</span>&nbsp;<span class="op" id="8437332">*</span><span class="ident" id="8437333">ReplyNotPointer</span><span class="op" id="8437348">)</span>&nbsp;<span class="ident" id="8437350">ReplyNotPointer</span><span class="op" id="8437365">(</span><span class="ident" id="8437366">args</span>&nbsp;<span class="op" id="8437371">*</span><span class="ident" id="8437372">Args</span><span class="op" id="8437376">,</span>&nbsp;<span class="ident" id="8437378">reply</span>&nbsp;<span class="ident" id="8437384">Reply</span><span class="op" id="8437389">)</span>&nbsp;<span class="builtintype" id="8437391">error</span>&nbsp;<span class="op" id="8437397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8437400">return</span>&nbsp;<span class="ident" id="8437407">nil</span><br>
<span class="lineno"></span><span class="op" id="8437411">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span><span class="keyword" id="8437414">func</span>&nbsp;<span class="op" id="8437419">(</span><span class="ident" id="8437420">t</span>&nbsp;<span class="op" id="8437422">*</span><span class="ident" id="8437423">ArgNotPublic</span><span class="op" id="8437435">)</span>&nbsp;<span class="ident" id="8437437">ArgNotPublic</span><span class="op" id="8437449">(</span><span class="ident" id="8437450">args</span>&nbsp;<span class="op" id="8437455">*</span><span class="ident" id="8437456">local</span><span class="op" id="8437461">,</span>&nbsp;<span class="ident" id="8437463">reply</span>&nbsp;<span class="op" id="8437469">*</span><span class="ident" id="8437470">Reply</span><span class="op" id="8437475">)</span>&nbsp;<span class="builtintype" id="8437477">error</span>&nbsp;<span class="op" id="8437483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8437486">return</span>&nbsp;<span class="ident" id="8437493">nil</span><br>
<span class="lineno"></span><span class="op" id="8437497">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span><span class="keyword" id="8437500">func</span>&nbsp;<span class="op" id="8437505">(</span><span class="ident" id="8437506">t</span>&nbsp;<span class="op" id="8437508">*</span><span class="ident" id="8437509">ReplyNotPublic</span><span class="op" id="8437523">)</span>&nbsp;<span class="ident" id="8437525">ReplyNotPublic</span><span class="op" id="8437539">(</span><span class="ident" id="8437540">args</span>&nbsp;<span class="op" id="8437545">*</span><span class="ident" id="8437546">Args</span><span class="op" id="8437550">,</span>&nbsp;<span class="ident" id="8437552">reply</span>&nbsp;<span class="op" id="8437558">*</span><span class="ident" id="8437559">local</span><span class="op" id="8437564">)</span>&nbsp;<span class="builtintype" id="8437566">error</span>&nbsp;<span class="op" id="8437572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8437575">return</span>&nbsp;<span class="ident" id="8437582">nil</span><br>
<span class="lineno"></span><span class="op" id="8437586">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8437589">func</span>&nbsp;<span class="op" id="8437594">(</span><span class="ident" id="8437595">t</span>&nbsp;<span class="op" id="8437597">*</span><span class="ident" id="8437598">NeedsPtrType</span><span class="op" id="8437610">)</span>&nbsp;<span class="ident" id="8437612">NeedsPtrType</span><span class="op" id="8437624">(</span><span class="ident" id="8437625">args</span>&nbsp;<span class="op" id="8437630">*</span><span class="ident" id="8437631">Args</span><span class="op" id="8437635">,</span>&nbsp;<span class="ident" id="8437637">reply</span>&nbsp;<span class="op" id="8437643">*</span><span class="ident" id="8437644">Reply</span><span class="op" id="8437649">)</span>&nbsp;<span class="builtintype" id="8437651">error</span>&nbsp;<span class="op" id="8437657">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8437660">return</span>&nbsp;<span class="ident" id="8437667">nil</span><br>
<span class="lineno"></span><span class="op" id="8437671">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8437674">//&nbsp;Check&nbsp;that&nbsp;registration&nbsp;handles&nbsp;lots&nbsp;of&nbsp;bad&nbsp;methods&nbsp;and&nbsp;a&nbsp;type&nbsp;with&nbsp;no&nbsp;suitable&nbsp;methods.</span><br>
<span class="lineno"></span><span class="keyword" id="8437766">func</span>&nbsp;<span class="ident" id="8437771">TestRegistrationError</span><span class="op" id="8437792">(</span><span class="ident" id="8437793">t</span>&nbsp;<span class="op" id="8437795">*</span><span class="ident" id="8437796">testing</span><span class="op" id="8437803">.</span><span class="ident" id="8437804">T</span><span class="op" id="8437805">)</span>&nbsp;<span class="op" id="8437807">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8437810">err</span>&nbsp;<span class="op" id="8437814">:=</span>&nbsp;<span class="ident" id="8437817">Register</span><span class="op" id="8437825">(</span><span class="builtinfunc" id="8437826">new</span><span class="op" id="8437829">(</span><span class="ident" id="8437830">ReplyNotPointer</span><span class="op" id="8437845">)</span><span class="op" id="8437846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8437849">if</span>&nbsp;<span class="ident" id="8437852">err</span>&nbsp;<span class="op" id="8437856">==</span>&nbsp;<span class="ident" id="8437859">nil</span>&nbsp;<span class="op" id="8437863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8437867">t</span><span class="op" id="8437868">.</span><span class="ident" id="8437869">Error</span><span class="op" id="8437874">(</span><span class="string" id="8437875">&#34;expected&nbsp;error&nbsp;registering&nbsp;ReplyNotPointer&#34;</span><span class="op" id="8437919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8437922">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8437925">err</span>&nbsp;<span class="op" id="8437929">=</span>&nbsp;<span class="ident" id="8437931">Register</span><span class="op" id="8437939">(</span><span class="builtinfunc" id="8437940">new</span><span class="op" id="8437943">(</span><span class="ident" id="8437944">ArgNotPublic</span><span class="op" id="8437956">)</span><span class="op" id="8437957">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8437960">if</span>&nbsp;<span class="ident" id="8437963">err</span>&nbsp;<span class="op" id="8437967">==</span>&nbsp;<span class="ident" id="8437970">nil</span>&nbsp;<span class="op" id="8437974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8437978">t</span><span class="op" id="8437979">.</span><span class="ident" id="8437980">Error</span><span class="op" id="8437985">(</span><span class="string" id="8437986">&#34;expected&nbsp;error&nbsp;registering&nbsp;ArgNotPublic&#34;</span><span class="op" id="8438027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8438030">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8438033">err</span>&nbsp;<span class="op" id="8438037">=</span>&nbsp;<span class="ident" id="8438039">Register</span><span class="op" id="8438047">(</span><span class="builtinfunc" id="8438048">new</span><span class="op" id="8438051">(</span><span class="ident" id="8438052">ReplyNotPublic</span><span class="op" id="8438066">)</span><span class="op" id="8438067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8438070">if</span>&nbsp;<span class="ident" id="8438073">err</span>&nbsp;<span class="op" id="8438077">==</span>&nbsp;<span class="ident" id="8438080">nil</span>&nbsp;<span class="op" id="8438084">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8438088">t</span><span class="op" id="8438089">.</span><span class="ident" id="8438090">Error</span><span class="op" id="8438095">(</span><span class="string" id="8438096">&#34;expected&nbsp;error&nbsp;registering&nbsp;ReplyNotPublic&#34;</span><span class="op" id="8438139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8438142">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8438145">err</span>&nbsp;<span class="op" id="8438149">=</span>&nbsp;<span class="ident" id="8438151">Register</span><span class="op" id="8438159">(</span><span class="ident" id="8438160">NeedsPtrType</span><span class="op" id="8438172">(</span><span class="num" id="8438173">0</span><span class="op" id="8438174">)</span><span class="op" id="8438175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8438178">if</span>&nbsp;<span class="ident" id="8438181">err</span>&nbsp;<span class="op" id="8438185">==</span>&nbsp;<span class="ident" id="8438188">nil</span>&nbsp;<span class="op" id="8438192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8438196">t</span><span class="op" id="8438197">.</span><span class="ident" id="8438198">Error</span><span class="op" id="8438203">(</span><span class="string" id="8438204">&#34;expected&nbsp;error&nbsp;registering&nbsp;NeedsPtrType&#34;</span><span class="op" id="8438245">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8438248">}</span>&nbsp;<span class="keyword" id="8438250">else</span>&nbsp;<span class="keyword" id="8438255">if</span>&nbsp;<span class="op" id="8438258">!</span><span class="ident" id="8438259">strings</span><span class="op" id="8438266">.</span><span class="ident" id="8438267">Contains</span><span class="op" id="8438275">(</span><span class="ident" id="8438276">err</span><span class="op" id="8438279">.</span><span class="ident" id="8438280">Error</span><span class="op" id="8438285">(</span><span class="op" id="8438286">)</span><span class="op" id="8438287">,</span>&nbsp;<span class="string" id="8438289">&#34;pointer&#34;</span><span class="op" id="8438298">)</span>&nbsp;<span class="op" id="8438300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8438304">t</span><span class="op" id="8438305">.</span><span class="ident" id="8438306">Error</span><span class="op" id="8438311">(</span><span class="string" id="8438312">&#34;expected&nbsp;hint&nbsp;when&nbsp;registering&nbsp;NeedsPtrType&#34;</span><span class="op" id="8438357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8438360">}</span><br>
<span class="lineno"></span><span class="op" id="8438362">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span><span class="keyword" id="8438365">type</span>&nbsp;<span class="ident" id="8438370">WriteFailCodec</span>&nbsp;<span class="builtintype" id="8438385">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8438390">func</span>&nbsp;<span class="op" id="8438395">(</span><span class="ident" id="8438396">WriteFailCodec</span><span class="op" id="8438410">)</span>&nbsp;<span class="ident" id="8438412">WriteRequest</span><span class="op" id="8438424">(</span><span class="op" id="8438425">*</span><span class="ident" id="8438426">Request</span><span class="op" id="8438433">,</span>&nbsp;<span class="keyword" id="8438435">interface</span><span class="op" id="8438444">{</span><span class="op" id="8438445">}</span><span class="op" id="8438446">)</span>&nbsp;<span class="builtintype" id="8438448">error</span>&nbsp;<span class="op" id="8438454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8438457">//&nbsp;the&nbsp;panic&nbsp;caused&nbsp;by&nbsp;this&nbsp;error&nbsp;used&nbsp;to&nbsp;not&nbsp;unlock&nbsp;a&nbsp;lock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8438519">return</span>&nbsp;<span class="ident" id="8438526">errors</span><span class="op" id="8438532">.</span><span class="ident" id="8438533">New</span><span class="op" id="8438536">(</span><span class="string" id="8438537">&#34;fail&#34;</span><span class="op" id="8438543">)</span><br>
<span class="lineno">435</span><span class="op" id="8438545">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8438548">func</span>&nbsp;<span class="op" id="8438553">(</span><span class="ident" id="8438554">WriteFailCodec</span><span class="op" id="8438568">)</span>&nbsp;<span class="ident" id="8438570">ReadResponseHeader</span><span class="op" id="8438588">(</span><span class="op" id="8438589">*</span><span class="ident" id="8438590">Response</span><span class="op" id="8438598">)</span>&nbsp;<span class="builtintype" id="8438600">error</span>&nbsp;<span class="op" id="8438606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8438609">select</span>&nbsp;<span class="op" id="8438616">{</span><span class="op" id="8438617">}</span><br>
<span class="lineno"></span><span class="op" id="8438619">}</span><br>
<span class="lineno">440</span><br>
<span class="lineno"></span><span class="keyword" id="8438622">func</span>&nbsp;<span class="op" id="8438627">(</span><span class="ident" id="8438628">WriteFailCodec</span><span class="op" id="8438642">)</span>&nbsp;<span class="ident" id="8438644">ReadResponseBody</span><span class="op" id="8438660">(</span><span class="keyword" id="8438661">interface</span><span class="op" id="8438670">{</span><span class="op" id="8438671">}</span><span class="op" id="8438672">)</span>&nbsp;<span class="builtintype" id="8438674">error</span>&nbsp;<span class="op" id="8438680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8438683">select</span>&nbsp;<span class="op" id="8438690">{</span><span class="op" id="8438691">}</span><br>
<span class="lineno"></span><span class="op" id="8438693">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">445</span><span class="keyword" id="8438696">func</span>&nbsp;<span class="op" id="8438701">(</span><span class="ident" id="8438702">WriteFailCodec</span><span class="op" id="8438716">)</span>&nbsp;<span class="ident" id="8438718">Close</span><span class="op" id="8438723">(</span><span class="op" id="8438724">)</span>&nbsp;<span class="builtintype" id="8438726">error</span>&nbsp;<span class="op" id="8438732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8438735">return</span>&nbsp;<span class="ident" id="8438742">nil</span><br>
<span class="lineno"></span><span class="op" id="8438746">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8438749">func</span>&nbsp;<span class="ident" id="8438754">TestSendDeadlock</span><span class="op" id="8438770">(</span><span class="ident" id="8438771">t</span>&nbsp;<span class="op" id="8438773">*</span><span class="ident" id="8438774">testing</span><span class="op" id="8438781">.</span><span class="ident" id="8438782">T</span><span class="op" id="8438783">)</span>&nbsp;<span class="op" id="8438785">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8438788">client</span>&nbsp;<span class="op" id="8438795">:=</span>&nbsp;<span class="ident" id="8438798">NewClientWithCodec</span><span class="op" id="8438816">(</span><span class="ident" id="8438817">WriteFailCodec</span><span class="op" id="8438831">(</span><span class="num" id="8438832">0</span><span class="op" id="8438833">)</span><span class="op" id="8438834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8438837">defer</span>&nbsp;<span class="ident" id="8438843">client</span><span class="op" id="8438849">.</span><span class="ident" id="8438850">Close</span><span class="op" id="8438855">(</span><span class="op" id="8438856">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8438860">done</span>&nbsp;<span class="op" id="8438865">:=</span>&nbsp;<span class="builtinfunc" id="8438868">make</span><span class="op" id="8438872">(</span><span class="keyword" id="8438873">chan</span>&nbsp;<span class="builtintype" id="8438878">bool</span><span class="op" id="8438882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8438885">go</span>&nbsp;<span class="keyword" id="8438888">func</span><span class="op" id="8438892">(</span><span class="op" id="8438893">)</span>&nbsp;<span class="op" id="8438895">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8438899">testSendDeadlock</span><span class="op" id="8438915">(</span><span class="ident" id="8438916">client</span><span class="op" id="8438922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8438926">testSendDeadlock</span><span class="op" id="8438942">(</span><span class="ident" id="8438943">client</span><span class="op" id="8438949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8438953">done</span>&nbsp;<span class="op" id="8438958">&lt;-</span>&nbsp;<span class="builtintype" id="8438961">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8438967">}</span><span class="op" id="8438968">(</span><span class="op" id="8438969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8438972">select</span>&nbsp;<span class="op" id="8438979">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8438982">case</span>&nbsp;<span class="op" id="8438987">&lt;-</span><span class="ident" id="8438989">done</span><span class="op" id="8438993">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8438997">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8439005">case</span>&nbsp;<span class="op" id="8439010">&lt;-</span><span class="ident" id="8439012">time</span><span class="op" id="8439016">.</span><span class="ident" id="8439017">After</span><span class="op" id="8439022">(</span><span class="num" id="8439023">5</span>&nbsp;<span class="op" id="8439025">*</span>&nbsp;<span class="ident" id="8439027">time</span><span class="op" id="8439031">.</span><span class="ident" id="8439032">Second</span><span class="op" id="8439038">)</span><span class="op" id="8439039">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8439043">t</span><span class="op" id="8439044">.</span><span class="ident" id="8439045">Fatal</span><span class="op" id="8439050">(</span><span class="string" id="8439051">&#34;deadlock&#34;</span><span class="op" id="8439061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8439064">}</span><br>
<span class="lineno">465</span><span class="op" id="8439066">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8439069">func</span>&nbsp;<span class="ident" id="8439074">testSendDeadlock</span><span class="op" id="8439090">(</span><span class="ident" id="8439091">client</span>&nbsp;<span class="op" id="8439098">*</span><span class="ident" id="8439099">Client</span><span class="op" id="8439105">)</span>&nbsp;<span class="op" id="8439107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8439110">defer</span>&nbsp;<span class="keyword" id="8439116">func</span><span class="op" id="8439120">(</span><span class="op" id="8439121">)</span>&nbsp;<span class="op" id="8439123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8439127">recover</span><span class="op" id="8439134">(</span><span class="op" id="8439135">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8439138">}</span><span class="op" id="8439139">(</span><span class="op" id="8439140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8439143">args</span>&nbsp;<span class="op" id="8439148">:=</span>&nbsp;<span class="op" id="8439151">&amp;</span><span class="ident" id="8439152">Args</span><span class="op" id="8439156">{</span><span class="num" id="8439157">7</span><span class="op" id="8439158">,</span>&nbsp;<span class="num" id="8439160">8</span><span class="op" id="8439161">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8439164">reply</span>&nbsp;<span class="op" id="8439170">:=</span>&nbsp;<span class="builtinfunc" id="8439173">new</span><span class="op" id="8439176">(</span><span class="ident" id="8439177">Reply</span><span class="op" id="8439182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8439185">client</span><span class="op" id="8439191">.</span><span class="ident" id="8439192">Call</span><span class="op" id="8439196">(</span><span class="string" id="8439197">&#34;Arith.Add&#34;</span><span class="op" id="8439208">,</span>&nbsp;<span class="ident" id="8439210">args</span><span class="op" id="8439214">,</span>&nbsp;<span class="ident" id="8439216">reply</span><span class="op" id="8439221">)</span><br>
<span class="lineno"></span><span class="op" id="8439223">}</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span><span class="keyword" id="8439226">func</span>&nbsp;<span class="ident" id="8439231">dialDirect</span><span class="op" id="8439241">(</span><span class="op" id="8439242">)</span>&nbsp;<span class="op" id="8439244">(</span><span class="op" id="8439245">*</span><span class="ident" id="8439246">Client</span><span class="op" id="8439252">,</span>&nbsp;<span class="builtintype" id="8439254">error</span><span class="op" id="8439259">)</span>&nbsp;<span class="op" id="8439261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8439264">return</span>&nbsp;<span class="ident" id="8439271">Dial</span><span class="op" id="8439275">(</span><span class="string" id="8439276">&#34;tcp&#34;</span><span class="op" id="8439281">,</span>&nbsp;<span class="ident" id="8439283">serverAddr</span><span class="op" id="8439293">)</span><br>
<span class="lineno"></span><span class="op" id="8439295">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">480</span><span class="keyword" id="8439298">func</span>&nbsp;<span class="ident" id="8439303">dialHTTP</span><span class="op" id="8439311">(</span><span class="op" id="8439312">)</span>&nbsp;<span class="op" id="8439314">(</span><span class="op" id="8439315">*</span><span class="ident" id="8439316">Client</span><span class="op" id="8439322">,</span>&nbsp;<span class="builtintype" id="8439324">error</span><span class="op" id="8439329">)</span>&nbsp;<span class="op" id="8439331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8439334">return</span>&nbsp;<span class="ident" id="8439341">DialHTTP</span><span class="op" id="8439349">(</span><span class="string" id="8439350">&#34;tcp&#34;</span><span class="op" id="8439355">,</span>&nbsp;<span class="ident" id="8439357">httpServerAddr</span><span class="op" id="8439371">)</span><br>
<span class="lineno"></span><span class="op" id="8439373">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8439376">func</span>&nbsp;<span class="ident" id="8439381">countMallocs</span><span class="op" id="8439393">(</span><span class="ident" id="8439394">dial</span>&nbsp;<span class="keyword" id="8439399">func</span><span class="op" id="8439403">(</span><span class="op" id="8439404">)</span>&nbsp;<span class="op" id="8439406">(</span><span class="op" id="8439407">*</span><span class="ident" id="8439408">Client</span><span class="op" id="8439414">,</span>&nbsp;<span class="builtintype" id="8439416">error</span><span class="op" id="8439421">)</span><span class="op" id="8439422">,</span>&nbsp;<span class="ident" id="8439424">t</span>&nbsp;<span class="op" id="8439426">*</span><span class="ident" id="8439427">testing</span><span class="op" id="8439434">.</span><span class="ident" id="8439435">T</span><span class="op" id="8439436">)</span>&nbsp;<span class="builtintype" id="8439438">float64</span>&nbsp;<span class="op" id="8439446">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8439449">once</span><span class="op" id="8439453">.</span><span class="ident" id="8439454">Do</span><span class="op" id="8439456">(</span><span class="ident" id="8439457">startServer</span><span class="op" id="8439468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8439471">client</span><span class="op" id="8439477">,</span>&nbsp;<span class="ident" id="8439479">err</span>&nbsp;<span class="op" id="8439483">:=</span>&nbsp;<span class="ident" id="8439486">dial</span><span class="op" id="8439490">(</span><span class="op" id="8439491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8439494">if</span>&nbsp;<span class="ident" id="8439497">err</span>&nbsp;<span class="op" id="8439501">!=</span>&nbsp;<span class="ident" id="8439504">nil</span>&nbsp;<span class="op" id="8439508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8439512">t</span><span class="op" id="8439513">.</span><span class="ident" id="8439514">Fatal</span><span class="op" id="8439519">(</span><span class="string" id="8439520">&#34;error&nbsp;dialing&#34;</span><span class="op" id="8439535">,</span>&nbsp;<span class="ident" id="8439537">err</span><span class="op" id="8439540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8439543">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8439546">defer</span>&nbsp;<span class="ident" id="8439552">client</span><span class="op" id="8439558">.</span><span class="ident" id="8439559">Close</span><span class="op" id="8439564">(</span><span class="op" id="8439565">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8439569">args</span>&nbsp;<span class="op" id="8439574">:=</span>&nbsp;<span class="op" id="8439577">&amp;</span><span class="ident" id="8439578">Args</span><span class="op" id="8439582">{</span><span class="num" id="8439583">7</span><span class="op" id="8439584">,</span>&nbsp;<span class="num" id="8439586">8</span><span class="op" id="8439587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8439590">reply</span>&nbsp;<span class="op" id="8439596">:=</span>&nbsp;<span class="builtinfunc" id="8439599">new</span><span class="op" id="8439602">(</span><span class="ident" id="8439603">Reply</span><span class="op" id="8439608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8439611">return</span>&nbsp;<span class="ident" id="8439618">testing</span><span class="op" id="8439625">.</span><span class="ident" id="8439626">AllocsPerRun</span><span class="op" id="8439638">(</span><span class="num" id="8439639">100</span><span class="op" id="8439642">,</span>&nbsp;<span class="keyword" id="8439644">func</span><span class="op" id="8439648">(</span><span class="op" id="8439649">)</span>&nbsp;<span class="op" id="8439651">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8439655">err</span>&nbsp;<span class="op" id="8439659">:=</span>&nbsp;<span class="ident" id="8439662">client</span><span class="op" id="8439668">.</span><span class="ident" id="8439669">Call</span><span class="op" id="8439673">(</span><span class="string" id="8439674">&#34;Arith.Add&#34;</span><span class="op" id="8439685">,</span>&nbsp;<span class="ident" id="8439687">args</span><span class="op" id="8439691">,</span>&nbsp;<span class="ident" id="8439693">reply</span><span class="op" id="8439698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8439702">if</span>&nbsp;<span class="ident" id="8439705">err</span>&nbsp;<span class="op" id="8439709">!=</span>&nbsp;<span class="ident" id="8439712">nil</span>&nbsp;<span class="op" id="8439716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8439721">t</span><span class="op" id="8439722">.</span><span class="ident" id="8439723">Errorf</span><span class="op" id="8439729">(</span><span class="string" id="8439730">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="8439772">,</span>&nbsp;<span class="ident" id="8439774">err</span><span class="op" id="8439777">.</span><span class="ident" id="8439778">Error</span><span class="op" id="8439783">(</span><span class="op" id="8439784">)</span><span class="op" id="8439785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8439789">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8439793">if</span>&nbsp;<span class="ident" id="8439796">reply</span><span class="op" id="8439801">.</span><span class="ident" id="8439802">C</span>&nbsp;<span class="op" id="8439804">!=</span>&nbsp;<span class="ident" id="8439807">args</span><span class="op" id="8439811">.</span><span class="ident" id="8439812">A</span><span class="op" id="8439813">+</span><span class="ident" id="8439814">args</span><span class="op" id="8439818">.</span><span class="ident" id="8439819">B</span>&nbsp;<span class="op" id="8439821">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8439826">t</span><span class="op" id="8439827">.</span><span class="ident" id="8439828">Errorf</span><span class="op" id="8439834">(</span><span class="string" id="8439835">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="8439860">,</span>&nbsp;<span class="ident" id="8439862">reply</span><span class="op" id="8439867">.</span><span class="ident" id="8439868">C</span><span class="op" id="8439869">,</span>&nbsp;<span class="ident" id="8439871">args</span><span class="op" id="8439875">.</span><span class="ident" id="8439876">A</span><span class="op" id="8439877">+</span><span class="ident" id="8439878">args</span><span class="op" id="8439882">.</span><span class="ident" id="8439883">B</span><span class="op" id="8439884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8439888">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8439891">}</span><span class="op" id="8439892">)</span><br>
<span class="lineno"></span><span class="op" id="8439894">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">505</span><span class="keyword" id="8439897">func</span>&nbsp;<span class="ident" id="8439902">TestCountMallocs</span><span class="op" id="8439918">(</span><span class="ident" id="8439919">t</span>&nbsp;<span class="op" id="8439921">*</span><span class="ident" id="8439922">testing</span><span class="op" id="8439929">.</span><span class="ident" id="8439930">T</span><span class="op" id="8439931">)</span>&nbsp;<span class="op" id="8439933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8439936">if</span>&nbsp;<span class="ident" id="8439939">testing</span><span class="op" id="8439946">.</span><span class="ident" id="8439947">Short</span><span class="op" id="8439952">(</span><span class="op" id="8439953">)</span>&nbsp;<span class="op" id="8439955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8439959">t</span><span class="op" id="8439960">.</span><span class="ident" id="8439961">Skip</span><span class="op" id="8439965">(</span><span class="string" id="8439966">&#34;skipping&nbsp;malloc&nbsp;count&nbsp;in&nbsp;short&nbsp;mode&#34;</span><span class="op" id="8440003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8440006">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8440009">if</span>&nbsp;<span class="ident" id="8440012">runtime</span><span class="op" id="8440019">.</span><span class="ident" id="8440020">GOMAXPROCS</span><span class="op" id="8440030">(</span><span class="num" id="8440031">0</span><span class="op" id="8440032">)</span>&nbsp;<span class="op" id="8440034">&gt;</span>&nbsp;<span class="num" id="8440036">1</span>&nbsp;<span class="op" id="8440038">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8440042">t</span><span class="op" id="8440043">.</span><span class="ident" id="8440044">Skip</span><span class="op" id="8440048">(</span><span class="string" id="8440049">&#34;skipping;&nbsp;GOMAXPROCS&gt;1&#34;</span><span class="op" id="8440073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8440076">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8440079">fmt</span><span class="op" id="8440082">.</span><span class="ident" id="8440083">Printf</span><span class="op" id="8440089">(</span><span class="string" id="8440090">&#34;mallocs&nbsp;per&nbsp;rpc&nbsp;round&nbsp;trip:&nbsp;%v\n&#34;</span><span class="op" id="8440124">,</span>&nbsp;<span class="ident" id="8440126">countMallocs</span><span class="op" id="8440138">(</span><span class="ident" id="8440139">dialDirect</span><span class="op" id="8440149">,</span>&nbsp;<span class="ident" id="8440151">t</span><span class="op" id="8440152">)</span><span class="op" id="8440153">)</span><br>
<span class="lineno"></span><span class="op" id="8440155">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span><span class="keyword" id="8440158">func</span>&nbsp;<span class="ident" id="8440163">TestCountMallocsOverHTTP</span><span class="op" id="8440187">(</span><span class="ident" id="8440188">t</span>&nbsp;<span class="op" id="8440190">*</span><span class="ident" id="8440191">testing</span><span class="op" id="8440198">.</span><span class="ident" id="8440199">T</span><span class="op" id="8440200">)</span>&nbsp;<span class="op" id="8440202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8440205">if</span>&nbsp;<span class="ident" id="8440208">testing</span><span class="op" id="8440215">.</span><span class="ident" id="8440216">Short</span><span class="op" id="8440221">(</span><span class="op" id="8440222">)</span>&nbsp;<span class="op" id="8440224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8440228">t</span><span class="op" id="8440229">.</span><span class="ident" id="8440230">Skip</span><span class="op" id="8440234">(</span><span class="string" id="8440235">&#34;skipping&nbsp;malloc&nbsp;count&nbsp;in&nbsp;short&nbsp;mode&#34;</span><span class="op" id="8440272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8440275">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8440278">if</span>&nbsp;<span class="ident" id="8440281">runtime</span><span class="op" id="8440288">.</span><span class="ident" id="8440289">GOMAXPROCS</span><span class="op" id="8440299">(</span><span class="num" id="8440300">0</span><span class="op" id="8440301">)</span>&nbsp;<span class="op" id="8440303">&gt;</span>&nbsp;<span class="num" id="8440305">1</span>&nbsp;<span class="op" id="8440307">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8440311">t</span><span class="op" id="8440312">.</span><span class="ident" id="8440313">Skip</span><span class="op" id="8440317">(</span><span class="string" id="8440318">&#34;skipping;&nbsp;GOMAXPROCS&gt;1&#34;</span><span class="op" id="8440342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8440345">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8440348">fmt</span><span class="op" id="8440351">.</span><span class="ident" id="8440352">Printf</span><span class="op" id="8440358">(</span><span class="string" id="8440359">&#34;mallocs&nbsp;per&nbsp;HTTP&nbsp;rpc&nbsp;round&nbsp;trip:&nbsp;%v\n&#34;</span><span class="op" id="8440398">,</span>&nbsp;<span class="ident" id="8440400">countMallocs</span><span class="op" id="8440412">(</span><span class="ident" id="8440413">dialHTTP</span><span class="op" id="8440421">,</span>&nbsp;<span class="ident" id="8440423">t</span><span class="op" id="8440424">)</span><span class="op" id="8440425">)</span><br>
<span class="lineno"></span><span class="op" id="8440427">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">525</span><span class="keyword" id="8440430">type</span>&nbsp;<span class="ident" id="8440435">writeCrasher</span>&nbsp;<span class="keyword" id="8440448">struct</span>&nbsp;<span class="op" id="8440455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8440458">done</span>&nbsp;<span class="keyword" id="8440463">chan</span>&nbsp;<span class="builtintype" id="8440468">bool</span><br>
<span class="lineno"></span><span class="op" id="8440473">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8440476">func</span>&nbsp;<span class="op" id="8440481">(</span><span class="ident" id="8440482">writeCrasher</span><span class="op" id="8440494">)</span>&nbsp;<span class="ident" id="8440496">Close</span><span class="op" id="8440501">(</span><span class="op" id="8440502">)</span>&nbsp;<span class="builtintype" id="8440504">error</span>&nbsp;<span class="op" id="8440510">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8440513">return</span>&nbsp;<span class="ident" id="8440520">nil</span><br>
<span class="lineno"></span><span class="op" id="8440524">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8440527">func</span>&nbsp;<span class="op" id="8440532">(</span><span class="ident" id="8440533">w</span>&nbsp;<span class="op" id="8440535">*</span><span class="ident" id="8440536">writeCrasher</span><span class="op" id="8440548">)</span>&nbsp;<span class="ident" id="8440550">Read</span><span class="op" id="8440554">(</span><span class="ident" id="8440555">p</span>&nbsp;<span class="op" id="8440557">[</span><span class="op" id="8440558">]</span><span class="builtintype" id="8440559">byte</span><span class="op" id="8440563">)</span>&nbsp;<span class="op" id="8440565">(</span><span class="builtintype" id="8440566">int</span><span class="op" id="8440569">,</span>&nbsp;<span class="builtintype" id="8440571">error</span><span class="op" id="8440576">)</span>&nbsp;<span class="op" id="8440578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8440581">&lt;-</span><span class="ident" id="8440583">w</span><span class="op" id="8440584">.</span><span class="ident" id="8440585">done</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8440591">return</span>&nbsp;<span class="num" id="8440598">0</span><span class="op" id="8440599">,</span>&nbsp;<span class="ident" id="8440601">io</span><span class="op" id="8440603">.</span><span class="ident" id="8440604">EOF</span><br>
<span class="lineno"></span><span class="op" id="8440608">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8440611">func</span>&nbsp;<span class="op" id="8440616">(</span><span class="ident" id="8440617">writeCrasher</span><span class="op" id="8440629">)</span>&nbsp;<span class="ident" id="8440631">Write</span><span class="op" id="8440636">(</span><span class="ident" id="8440637">p</span>&nbsp;<span class="op" id="8440639">[</span><span class="op" id="8440640">]</span><span class="builtintype" id="8440641">byte</span><span class="op" id="8440645">)</span>&nbsp;<span class="op" id="8440647">(</span><span class="builtintype" id="8440648">int</span><span class="op" id="8440651">,</span>&nbsp;<span class="builtintype" id="8440653">error</span><span class="op" id="8440658">)</span>&nbsp;<span class="op" id="8440660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8440663">return</span>&nbsp;<span class="num" id="8440670">0</span><span class="op" id="8440671">,</span>&nbsp;<span class="ident" id="8440673">errors</span><span class="op" id="8440679">.</span><span class="ident" id="8440680">New</span><span class="op" id="8440683">(</span><span class="string" id="8440684">&#34;fake&nbsp;write&nbsp;failure&#34;</span><span class="op" id="8440704">)</span><br>
<span class="lineno">540</span><span class="op" id="8440706">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8440709">func</span>&nbsp;<span class="ident" id="8440714">TestClientWriteError</span><span class="op" id="8440734">(</span><span class="ident" id="8440735">t</span>&nbsp;<span class="op" id="8440737">*</span><span class="ident" id="8440738">testing</span><span class="op" id="8440745">.</span><span class="ident" id="8440746">T</span><span class="op" id="8440747">)</span>&nbsp;<span class="op" id="8440749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8440752">w</span>&nbsp;<span class="op" id="8440754">:=</span>&nbsp;<span class="op" id="8440757">&amp;</span><span class="ident" id="8440758">writeCrasher</span><span class="op" id="8440770">{</span><span class="ident" id="8440771">done</span><span class="op" id="8440775">:</span>&nbsp;<span class="builtinfunc" id="8440777">make</span><span class="op" id="8440781">(</span><span class="keyword" id="8440782">chan</span>&nbsp;<span class="builtintype" id="8440787">bool</span><span class="op" id="8440791">)</span><span class="op" id="8440792">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8440795">c</span>&nbsp;<span class="op" id="8440797">:=</span>&nbsp;<span class="ident" id="8440800">NewClient</span><span class="op" id="8440809">(</span><span class="ident" id="8440810">w</span><span class="op" id="8440811">)</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8440814">defer</span>&nbsp;<span class="ident" id="8440820">c</span><span class="op" id="8440821">.</span><span class="ident" id="8440822">Close</span><span class="op" id="8440827">(</span><span class="op" id="8440828">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8440832">res</span>&nbsp;<span class="op" id="8440836">:=</span>&nbsp;<span class="builtintype" id="8440839">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8440846">err</span>&nbsp;<span class="op" id="8440850">:=</span>&nbsp;<span class="ident" id="8440853">c</span><span class="op" id="8440854">.</span><span class="ident" id="8440855">Call</span><span class="op" id="8440859">(</span><span class="string" id="8440860">&#34;foo&#34;</span><span class="op" id="8440865">,</span>&nbsp;<span class="num" id="8440867">1</span><span class="op" id="8440868">,</span>&nbsp;<span class="op" id="8440870">&amp;</span><span class="ident" id="8440871">res</span><span class="op" id="8440874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8440877">if</span>&nbsp;<span class="ident" id="8440880">err</span>&nbsp;<span class="op" id="8440884">==</span>&nbsp;<span class="ident" id="8440887">nil</span>&nbsp;<span class="op" id="8440891">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8440895">t</span><span class="op" id="8440896">.</span><span class="ident" id="8440897">Fatal</span><span class="op" id="8440902">(</span><span class="string" id="8440903">&#34;expected&nbsp;error&#34;</span><span class="op" id="8440919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8440922">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8440925">if</span>&nbsp;<span class="ident" id="8440928">err</span><span class="op" id="8440931">.</span><span class="ident" id="8440932">Error</span><span class="op" id="8440937">(</span><span class="op" id="8440938">)</span>&nbsp;<span class="op" id="8440940">!=</span>&nbsp;<span class="string" id="8440943">&#34;fake&nbsp;write&nbsp;failure&#34;</span>&nbsp;<span class="op" id="8440964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8440968">t</span><span class="op" id="8440969">.</span><span class="ident" id="8440970">Error</span><span class="op" id="8440975">(</span><span class="string" id="8440976">&#34;unexpected&nbsp;value&nbsp;of&nbsp;error:&#34;</span><span class="op" id="8441004">,</span>&nbsp;<span class="ident" id="8441006">err</span><span class="op" id="8441009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8441012">}</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8441015">w</span><span class="op" id="8441016">.</span><span class="ident" id="8441017">done</span>&nbsp;<span class="op" id="8441022">&lt;-</span>&nbsp;<span class="builtintype" id="8441025">true</span><br>
<span class="lineno"></span><span class="op" id="8441030">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8441033">func</span>&nbsp;<span class="ident" id="8441038">TestTCPClose</span><span class="op" id="8441050">(</span><span class="ident" id="8441051">t</span>&nbsp;<span class="op" id="8441053">*</span><span class="ident" id="8441054">testing</span><span class="op" id="8441061">.</span><span class="ident" id="8441062">T</span><span class="op" id="8441063">)</span>&nbsp;<span class="op" id="8441065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8441068">once</span><span class="op" id="8441072">.</span><span class="ident" id="8441073">Do</span><span class="op" id="8441075">(</span><span class="ident" id="8441076">startServer</span><span class="op" id="8441087">)</span><br>
<span class="lineno">560</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8441091">client</span><span class="op" id="8441097">,</span>&nbsp;<span class="ident" id="8441099">err</span>&nbsp;<span class="op" id="8441103">:=</span>&nbsp;<span class="ident" id="8441106">dialHTTP</span><span class="op" id="8441114">(</span><span class="op" id="8441115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8441118">if</span>&nbsp;<span class="ident" id="8441121">err</span>&nbsp;<span class="op" id="8441125">!=</span>&nbsp;<span class="ident" id="8441128">nil</span>&nbsp;<span class="op" id="8441132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8441136">t</span><span class="op" id="8441137">.</span><span class="ident" id="8441138">Fatalf</span><span class="op" id="8441144">(</span><span class="string" id="8441145">&#34;dialing:&nbsp;%v&#34;</span><span class="op" id="8441158">,</span>&nbsp;<span class="ident" id="8441160">err</span><span class="op" id="8441163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8441166">}</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8441169">defer</span>&nbsp;<span class="ident" id="8441175">client</span><span class="op" id="8441181">.</span><span class="ident" id="8441182">Close</span><span class="op" id="8441187">(</span><span class="op" id="8441188">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8441192">args</span>&nbsp;<span class="op" id="8441197">:=</span>&nbsp;<span class="ident" id="8441200">Args</span><span class="op" id="8441204">{</span><span class="num" id="8441205">17</span><span class="op" id="8441207">,</span>&nbsp;<span class="num" id="8441209">8</span><span class="op" id="8441210">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8441213">var</span>&nbsp;<span class="ident" id="8441217">reply</span>&nbsp;<span class="ident" id="8441223">Reply</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8441230">err</span>&nbsp;<span class="op" id="8441234">=</span>&nbsp;<span class="ident" id="8441236">client</span><span class="op" id="8441242">.</span><span class="ident" id="8441243">Call</span><span class="op" id="8441247">(</span><span class="string" id="8441248">&#34;Arith.Mul&#34;</span><span class="op" id="8441259">,</span>&nbsp;<span class="ident" id="8441261">args</span><span class="op" id="8441265">,</span>&nbsp;<span class="op" id="8441267">&amp;</span><span class="ident" id="8441268">reply</span><span class="op" id="8441273">)</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8441276">if</span>&nbsp;<span class="ident" id="8441279">err</span>&nbsp;<span class="op" id="8441283">!=</span>&nbsp;<span class="ident" id="8441286">nil</span>&nbsp;<span class="op" id="8441290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8441294">t</span><span class="op" id="8441295">.</span><span class="ident" id="8441296">Fatal</span><span class="op" id="8441301">(</span><span class="string" id="8441302">&#34;arith&nbsp;error:&#34;</span><span class="op" id="8441316">,</span>&nbsp;<span class="ident" id="8441318">err</span><span class="op" id="8441321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8441324">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8441327">t</span><span class="op" id="8441328">.</span><span class="ident" id="8441329">Logf</span><span class="op" id="8441333">(</span><span class="string" id="8441334">&#34;Arith:&nbsp;%d*%d=%d\n&#34;</span><span class="op" id="8441353">,</span>&nbsp;<span class="ident" id="8441355">args</span><span class="op" id="8441359">.</span><span class="ident" id="8441360">A</span><span class="op" id="8441361">,</span>&nbsp;<span class="ident" id="8441363">args</span><span class="op" id="8441367">.</span><span class="ident" id="8441368">B</span><span class="op" id="8441369">,</span>&nbsp;<span class="ident" id="8441371">reply</span><span class="op" id="8441376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8441379">if</span>&nbsp;<span class="ident" id="8441382">reply</span><span class="op" id="8441387">.</span><span class="ident" id="8441388">C</span>&nbsp;<span class="op" id="8441390">!=</span>&nbsp;<span class="ident" id="8441393">args</span><span class="op" id="8441397">.</span><span class="ident" id="8441398">A</span><span class="op" id="8441399">*</span><span class="ident" id="8441400">args</span><span class="op" id="8441404">.</span><span class="ident" id="8441405">B</span>&nbsp;<span class="op" id="8441407">{</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8441411">t</span><span class="op" id="8441412">.</span><span class="ident" id="8441413">Errorf</span><span class="op" id="8441419">(</span><span class="string" id="8441420">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="8441445">,</span>&nbsp;<span class="ident" id="8441447">reply</span><span class="op" id="8441452">.</span><span class="ident" id="8441453">C</span><span class="op" id="8441454">,</span>&nbsp;<span class="ident" id="8441456">args</span><span class="op" id="8441460">.</span><span class="ident" id="8441461">A</span><span class="op" id="8441462">*</span><span class="ident" id="8441463">args</span><span class="op" id="8441467">.</span><span class="ident" id="8441468">B</span><span class="op" id="8441469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8441472">}</span><br>
<span class="lineno"></span><span class="op" id="8441474">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8441477">func</span>&nbsp;<span class="ident" id="8441482">TestErrorAfterClientClose</span><span class="op" id="8441507">(</span><span class="ident" id="8441508">t</span>&nbsp;<span class="op" id="8441510">*</span><span class="ident" id="8441511">testing</span><span class="op" id="8441518">.</span><span class="ident" id="8441519">T</span><span class="op" id="8441520">)</span>&nbsp;<span class="op" id="8441522">{</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8441525">once</span><span class="op" id="8441529">.</span><span class="ident" id="8441530">Do</span><span class="op" id="8441532">(</span><span class="ident" id="8441533">startServer</span><span class="op" id="8441544">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8441548">client</span><span class="op" id="8441554">,</span>&nbsp;<span class="ident" id="8441556">err</span>&nbsp;<span class="op" id="8441560">:=</span>&nbsp;<span class="ident" id="8441563">dialHTTP</span><span class="op" id="8441571">(</span><span class="op" id="8441572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8441575">if</span>&nbsp;<span class="ident" id="8441578">err</span>&nbsp;<span class="op" id="8441582">!=</span>&nbsp;<span class="ident" id="8441585">nil</span>&nbsp;<span class="op" id="8441589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8441593">t</span><span class="op" id="8441594">.</span><span class="ident" id="8441595">Fatalf</span><span class="op" id="8441601">(</span><span class="string" id="8441602">&#34;dialing:&nbsp;%v&#34;</span><span class="op" id="8441615">,</span>&nbsp;<span class="ident" id="8441617">err</span><span class="op" id="8441620">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8441623">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8441626">err</span>&nbsp;<span class="op" id="8441630">=</span>&nbsp;<span class="ident" id="8441632">client</span><span class="op" id="8441638">.</span><span class="ident" id="8441639">Close</span><span class="op" id="8441644">(</span><span class="op" id="8441645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8441648">if</span>&nbsp;<span class="ident" id="8441651">err</span>&nbsp;<span class="op" id="8441655">!=</span>&nbsp;<span class="ident" id="8441658">nil</span>&nbsp;<span class="op" id="8441662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8441666">t</span><span class="op" id="8441667">.</span><span class="ident" id="8441668">Fatal</span><span class="op" id="8441673">(</span><span class="string" id="8441674">&#34;close&nbsp;error:&#34;</span><span class="op" id="8441688">,</span>&nbsp;<span class="ident" id="8441690">err</span><span class="op" id="8441693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8441696">}</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8441699">err</span>&nbsp;<span class="op" id="8441703">=</span>&nbsp;<span class="ident" id="8441705">client</span><span class="op" id="8441711">.</span><span class="ident" id="8441712">Call</span><span class="op" id="8441716">(</span><span class="string" id="8441717">&#34;Arith.Add&#34;</span><span class="op" id="8441728">,</span>&nbsp;<span class="op" id="8441730">&amp;</span><span class="ident" id="8441731">Args</span><span class="op" id="8441735">{</span><span class="num" id="8441736">7</span><span class="op" id="8441737">,</span>&nbsp;<span class="num" id="8441739">9</span><span class="op" id="8441740">}</span><span class="op" id="8441741">,</span>&nbsp;<span class="builtinfunc" id="8441743">new</span><span class="op" id="8441746">(</span><span class="ident" id="8441747">Reply</span><span class="op" id="8441752">)</span><span class="op" id="8441753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8441756">if</span>&nbsp;<span class="ident" id="8441759">err</span>&nbsp;<span class="op" id="8441763">!=</span>&nbsp;<span class="ident" id="8441766">ErrShutdown</span>&nbsp;<span class="op" id="8441778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8441782">t</span><span class="op" id="8441783">.</span><span class="ident" id="8441784">Errorf</span><span class="op" id="8441790">(</span><span class="string" id="8441791">&#34;Forever:&nbsp;expected&nbsp;ErrShutdown&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8441829">,</span>&nbsp;<span class="ident" id="8441831">err</span><span class="op" id="8441834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8441837">}</span><br>
<span class="lineno"></span><span class="op" id="8441839">}</span><br>
<span class="lineno">595</span><br>
<span class="lineno"></span><span class="keyword" id="8441842">func</span>&nbsp;<span class="ident" id="8441847">benchmarkEndToEnd</span><span class="op" id="8441864">(</span><span class="ident" id="8441865">dial</span>&nbsp;<span class="keyword" id="8441870">func</span><span class="op" id="8441874">(</span><span class="op" id="8441875">)</span>&nbsp;<span class="op" id="8441877">(</span><span class="op" id="8441878">*</span><span class="ident" id="8441879">Client</span><span class="op" id="8441885">,</span>&nbsp;<span class="builtintype" id="8441887">error</span><span class="op" id="8441892">)</span><span class="op" id="8441893">,</span>&nbsp;<span class="ident" id="8441895">b</span>&nbsp;<span class="op" id="8441897">*</span><span class="ident" id="8441898">testing</span><span class="op" id="8441905">.</span><span class="ident" id="8441906">B</span><span class="op" id="8441907">)</span>&nbsp;<span class="op" id="8441909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8441912">once</span><span class="op" id="8441916">.</span><span class="ident" id="8441917">Do</span><span class="op" id="8441919">(</span><span class="ident" id="8441920">startServer</span><span class="op" id="8441931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8441934">client</span><span class="op" id="8441940">,</span>&nbsp;<span class="ident" id="8441942">err</span>&nbsp;<span class="op" id="8441946">:=</span>&nbsp;<span class="ident" id="8441949">dial</span><span class="op" id="8441953">(</span><span class="op" id="8441954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8441957">if</span>&nbsp;<span class="ident" id="8441960">err</span>&nbsp;<span class="op" id="8441964">!=</span>&nbsp;<span class="ident" id="8441967">nil</span>&nbsp;<span class="op" id="8441971">{</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8441975">b</span><span class="op" id="8441976">.</span><span class="ident" id="8441977">Fatal</span><span class="op" id="8441982">(</span><span class="string" id="8441983">&#34;error&nbsp;dialing:&#34;</span><span class="op" id="8441999">,</span>&nbsp;<span class="ident" id="8442001">err</span><span class="op" id="8442004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8442007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8442010">defer</span>&nbsp;<span class="ident" id="8442016">client</span><span class="op" id="8442022">.</span><span class="ident" id="8442023">Close</span><span class="op" id="8442028">(</span><span class="op" id="8442029">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8442033">//&nbsp;Synchronous&nbsp;calls</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8442055">args</span>&nbsp;<span class="op" id="8442060">:=</span>&nbsp;<span class="op" id="8442063">&amp;</span><span class="ident" id="8442064">Args</span><span class="op" id="8442068">{</span><span class="num" id="8442069">7</span><span class="op" id="8442070">,</span>&nbsp;<span class="num" id="8442072">8</span><span class="op" id="8442073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8442076">b</span><span class="op" id="8442077">.</span><span class="ident" id="8442078">ResetTimer</span><span class="op" id="8442088">(</span><span class="op" id="8442089">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8442093">b</span><span class="op" id="8442094">.</span><span class="ident" id="8442095">RunParallel</span><span class="op" id="8442106">(</span><span class="keyword" id="8442107">func</span><span class="op" id="8442111">(</span><span class="ident" id="8442112">pb</span>&nbsp;<span class="op" id="8442115">*</span><span class="ident" id="8442116">testing</span><span class="op" id="8442123">.</span><span class="ident" id="8442124">PB</span><span class="op" id="8442126">)</span>&nbsp;<span class="op" id="8442128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8442132">reply</span>&nbsp;<span class="op" id="8442138">:=</span>&nbsp;<span class="builtinfunc" id="8442141">new</span><span class="op" id="8442144">(</span><span class="ident" id="8442145">Reply</span><span class="op" id="8442150">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8442154">for</span>&nbsp;<span class="ident" id="8442158">pb</span><span class="op" id="8442160">.</span><span class="ident" id="8442161">Next</span><span class="op" id="8442165">(</span><span class="op" id="8442166">)</span>&nbsp;<span class="op" id="8442168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8442173">err</span>&nbsp;<span class="op" id="8442177">:=</span>&nbsp;<span class="ident" id="8442180">client</span><span class="op" id="8442186">.</span><span class="ident" id="8442187">Call</span><span class="op" id="8442191">(</span><span class="string" id="8442192">&#34;Arith.Add&#34;</span><span class="op" id="8442203">,</span>&nbsp;<span class="ident" id="8442205">args</span><span class="op" id="8442209">,</span>&nbsp;<span class="ident" id="8442211">reply</span><span class="op" id="8442216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8442221">if</span>&nbsp;<span class="ident" id="8442224">err</span>&nbsp;<span class="op" id="8442228">!=</span>&nbsp;<span class="ident" id="8442231">nil</span>&nbsp;<span class="op" id="8442235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8442241">b</span><span class="op" id="8442242">.</span><span class="ident" id="8442243">Fatalf</span><span class="op" id="8442249">(</span><span class="string" id="8442250">&#34;rpc&nbsp;error:&nbsp;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="8442303">,</span>&nbsp;<span class="ident" id="8442305">err</span><span class="op" id="8442308">.</span><span class="ident" id="8442309">Error</span><span class="op" id="8442314">(</span><span class="op" id="8442315">)</span><span class="op" id="8442316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8442321">}</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8442326">if</span>&nbsp;<span class="ident" id="8442329">reply</span><span class="op" id="8442334">.</span><span class="ident" id="8442335">C</span>&nbsp;<span class="op" id="8442337">!=</span>&nbsp;<span class="ident" id="8442340">args</span><span class="op" id="8442344">.</span><span class="ident" id="8442345">A</span><span class="op" id="8442346">+</span><span class="ident" id="8442347">args</span><span class="op" id="8442351">.</span><span class="ident" id="8442352">B</span>&nbsp;<span class="op" id="8442354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8442360">b</span><span class="op" id="8442361">.</span><span class="ident" id="8442362">Fatalf</span><span class="op" id="8442368">(</span><span class="string" id="8442369">&#34;rpc&nbsp;error:&nbsp;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="8442405">,</span>&nbsp;<span class="ident" id="8442407">reply</span><span class="op" id="8442412">.</span><span class="ident" id="8442413">C</span><span class="op" id="8442414">,</span>&nbsp;<span class="ident" id="8442416">args</span><span class="op" id="8442420">.</span><span class="ident" id="8442421">A</span><span class="op" id="8442422">+</span><span class="ident" id="8442423">args</span><span class="op" id="8442427">.</span><span class="ident" id="8442428">B</span><span class="op" id="8442429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8442434">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8442438">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8442441">}</span><span class="op" id="8442442">)</span><br>
<span class="lineno">620</span><span class="op" id="8442444">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8442447">func</span>&nbsp;<span class="ident" id="8442452">benchmarkEndToEndAsync</span><span class="op" id="8442474">(</span><span class="ident" id="8442475">dial</span>&nbsp;<span class="keyword" id="8442480">func</span><span class="op" id="8442484">(</span><span class="op" id="8442485">)</span>&nbsp;<span class="op" id="8442487">(</span><span class="op" id="8442488">*</span><span class="ident" id="8442489">Client</span><span class="op" id="8442495">,</span>&nbsp;<span class="builtintype" id="8442497">error</span><span class="op" id="8442502">)</span><span class="op" id="8442503">,</span>&nbsp;<span class="ident" id="8442505">b</span>&nbsp;<span class="op" id="8442507">*</span><span class="ident" id="8442508">testing</span><span class="op" id="8442515">.</span><span class="ident" id="8442516">B</span><span class="op" id="8442517">)</span>&nbsp;<span class="op" id="8442519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8442522">const</span>&nbsp;<span class="ident" id="8442528">MaxConcurrentCalls</span>&nbsp;<span class="op" id="8442547">=</span>&nbsp;<span class="num" id="8442549">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8442554">once</span><span class="op" id="8442558">.</span><span class="ident" id="8442559">Do</span><span class="op" id="8442561">(</span><span class="ident" id="8442562">startServer</span><span class="op" id="8442573">)</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8442576">client</span><span class="op" id="8442582">,</span>&nbsp;<span class="ident" id="8442584">err</span>&nbsp;<span class="op" id="8442588">:=</span>&nbsp;<span class="ident" id="8442591">dial</span><span class="op" id="8442595">(</span><span class="op" id="8442596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8442599">if</span>&nbsp;<span class="ident" id="8442602">err</span>&nbsp;<span class="op" id="8442606">!=</span>&nbsp;<span class="ident" id="8442609">nil</span>&nbsp;<span class="op" id="8442613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8442617">b</span><span class="op" id="8442618">.</span><span class="ident" id="8442619">Fatal</span><span class="op" id="8442624">(</span><span class="string" id="8442625">&#34;error&nbsp;dialing:&#34;</span><span class="op" id="8442641">,</span>&nbsp;<span class="ident" id="8442643">err</span><span class="op" id="8442646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8442649">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8442652">defer</span>&nbsp;<span class="ident" id="8442658">client</span><span class="op" id="8442664">.</span><span class="ident" id="8442665">Close</span><span class="op" id="8442670">(</span><span class="op" id="8442671">)</span><br>
<span class="lineno">630</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8442675">//&nbsp;Asynchronous&nbsp;calls</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8442698">args</span>&nbsp;<span class="op" id="8442703">:=</span>&nbsp;<span class="op" id="8442706">&amp;</span><span class="ident" id="8442707">Args</span><span class="op" id="8442711">{</span><span class="num" id="8442712">7</span><span class="op" id="8442713">,</span>&nbsp;<span class="num" id="8442715">8</span><span class="op" id="8442716">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8442719">procs</span>&nbsp;<span class="op" id="8442725">:=</span>&nbsp;<span class="num" id="8442728">4</span>&nbsp;<span class="op" id="8442730">*</span>&nbsp;<span class="ident" id="8442732">runtime</span><span class="op" id="8442739">.</span><span class="ident" id="8442740">GOMAXPROCS</span><span class="op" id="8442750">(</span><span class="op" id="8442751">-</span><span class="num" id="8442752">1</span><span class="op" id="8442753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8442756">send</span>&nbsp;<span class="op" id="8442761">:=</span>&nbsp;<span class="builtintype" id="8442764">int32</span><span class="op" id="8442769">(</span><span class="ident" id="8442770">b</span><span class="op" id="8442771">.</span><span class="ident" id="8442772">N</span><span class="op" id="8442773">)</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8442776">recv</span>&nbsp;<span class="op" id="8442781">:=</span>&nbsp;<span class="builtintype" id="8442784">int32</span><span class="op" id="8442789">(</span><span class="ident" id="8442790">b</span><span class="op" id="8442791">.</span><span class="ident" id="8442792">N</span><span class="op" id="8442793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8442796">var</span>&nbsp;<span class="ident" id="8442800">wg</span>&nbsp;<span class="ident" id="8442803">sync</span><span class="op" id="8442807">.</span><span class="ident" id="8442808">WaitGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8442819">wg</span><span class="op" id="8442821">.</span><span class="ident" id="8442822">Add</span><span class="op" id="8442825">(</span><span class="ident" id="8442826">procs</span><span class="op" id="8442831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8442834">gate</span>&nbsp;<span class="op" id="8442839">:=</span>&nbsp;<span class="builtinfunc" id="8442842">make</span><span class="op" id="8442846">(</span><span class="keyword" id="8442847">chan</span>&nbsp;<span class="builtintype" id="8442852">bool</span><span class="op" id="8442856">,</span>&nbsp;<span class="ident" id="8442858">MaxConcurrentCalls</span><span class="op" id="8442876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8442879">res</span>&nbsp;<span class="op" id="8442883">:=</span>&nbsp;<span class="builtinfunc" id="8442886">make</span><span class="op" id="8442890">(</span><span class="keyword" id="8442891">chan</span>&nbsp;<span class="op" id="8442896">*</span><span class="ident" id="8442897">Call</span><span class="op" id="8442901">,</span>&nbsp;<span class="ident" id="8442903">MaxConcurrentCalls</span><span class="op" id="8442921">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8442924">b</span><span class="op" id="8442925">.</span><span class="ident" id="8442926">ResetTimer</span><span class="op" id="8442936">(</span><span class="op" id="8442937">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8442941">for</span>&nbsp;<span class="ident" id="8442945">p</span>&nbsp;<span class="op" id="8442947">:=</span>&nbsp;<span class="num" id="8442950">0</span><span class="op" id="8442951">;</span>&nbsp;<span class="ident" id="8442953">p</span>&nbsp;<span class="op" id="8442955">&lt;</span>&nbsp;<span class="ident" id="8442957">procs</span><span class="op" id="8442962">;</span>&nbsp;<span class="ident" id="8442964">p</span><span class="op" id="8442965">++</span>&nbsp;<span class="op" id="8442968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8442972">go</span>&nbsp;<span class="keyword" id="8442975">func</span><span class="op" id="8442979">(</span><span class="op" id="8442980">)</span>&nbsp;<span class="op" id="8442982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8442987">for</span>&nbsp;<span class="ident" id="8442991">atomic</span><span class="op" id="8442997">.</span><span class="ident" id="8442998">AddInt32</span><span class="op" id="8443006">(</span><span class="op" id="8443007">&amp;</span><span class="ident" id="8443008">send</span><span class="op" id="8443012">,</span>&nbsp;<span class="op" id="8443014">-</span><span class="num" id="8443015">1</span><span class="op" id="8443016">)</span>&nbsp;<span class="op" id="8443018">&gt;=</span>&nbsp;<span class="num" id="8443021">0</span>&nbsp;<span class="op" id="8443023">{</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8443029">gate</span>&nbsp;<span class="op" id="8443034">&lt;-</span>&nbsp;<span class="builtintype" id="8443037">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8443046">reply</span>&nbsp;<span class="op" id="8443052">:=</span>&nbsp;<span class="builtinfunc" id="8443055">new</span><span class="op" id="8443058">(</span><span class="ident" id="8443059">Reply</span><span class="op" id="8443064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8443070">client</span><span class="op" id="8443076">.</span><span class="ident" id="8443077">Go</span><span class="op" id="8443079">(</span><span class="string" id="8443080">&#34;Arith.Add&#34;</span><span class="op" id="8443091">,</span>&nbsp;<span class="ident" id="8443093">args</span><span class="op" id="8443097">,</span>&nbsp;<span class="ident" id="8443099">reply</span><span class="op" id="8443104">,</span>&nbsp;<span class="ident" id="8443106">res</span><span class="op" id="8443109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8443114">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8443118">}</span><span class="op" id="8443119">(</span><span class="op" id="8443120">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8443124">go</span>&nbsp;<span class="keyword" id="8443127">func</span><span class="op" id="8443131">(</span><span class="op" id="8443132">)</span>&nbsp;<span class="op" id="8443134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8443139">for</span>&nbsp;<span class="ident" id="8443143">call</span>&nbsp;<span class="op" id="8443148">:=</span>&nbsp;<span class="keyword" id="8443151">range</span>&nbsp;<span class="ident" id="8443157">res</span>&nbsp;<span class="op" id="8443161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8443167">A</span>&nbsp;<span class="op" id="8443169">:=</span>&nbsp;<span class="ident" id="8443172">call</span><span class="op" id="8443176">.</span><span class="ident" id="8443177">Args</span><span class="op" id="8443181">.</span><span class="op" id="8443182">(</span><span class="op" id="8443183">*</span><span class="ident" id="8443184">Args</span><span class="op" id="8443188">)</span><span class="op" id="8443189">.</span><span class="ident" id="8443190">A</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8443196">B</span>&nbsp;<span class="op" id="8443198">:=</span>&nbsp;<span class="ident" id="8443201">call</span><span class="op" id="8443205">.</span><span class="ident" id="8443206">Args</span><span class="op" id="8443210">.</span><span class="op" id="8443211">(</span><span class="op" id="8443212">*</span><span class="ident" id="8443213">Args</span><span class="op" id="8443217">)</span><span class="op" id="8443218">.</span><span class="ident" id="8443219">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8443225">C</span>&nbsp;<span class="op" id="8443227">:=</span>&nbsp;<span class="ident" id="8443230">call</span><span class="op" id="8443234">.</span><span class="ident" id="8443235">Reply</span><span class="op" id="8443240">.</span><span class="op" id="8443241">(</span><span class="op" id="8443242">*</span><span class="ident" id="8443243">Reply</span><span class="op" id="8443248">)</span><span class="op" id="8443249">.</span><span class="ident" id="8443250">C</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8443256">if</span>&nbsp;<span class="ident" id="8443259">A</span><span class="op" id="8443260">+</span><span class="ident" id="8443261">B</span>&nbsp;<span class="op" id="8443263">!=</span>&nbsp;<span class="ident" id="8443266">C</span>&nbsp;<span class="op" id="8443268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8443275">b</span><span class="op" id="8443276">.</span><span class="ident" id="8443277">Fatalf</span><span class="op" id="8443283">(</span><span class="string" id="8443284">&#34;incorrect&nbsp;reply:&nbsp;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="8443326">,</span>&nbsp;<span class="ident" id="8443328">A</span><span class="op" id="8443329">+</span><span class="ident" id="8443330">B</span><span class="op" id="8443331">,</span>&nbsp;<span class="ident" id="8443333">C</span><span class="op" id="8443334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8443340">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8443346">&lt;-</span><span class="ident" id="8443348">gate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8443357">if</span>&nbsp;<span class="ident" id="8443360">atomic</span><span class="op" id="8443366">.</span><span class="ident" id="8443367">AddInt32</span><span class="op" id="8443375">(</span><span class="op" id="8443376">&amp;</span><span class="ident" id="8443377">recv</span><span class="op" id="8443381">,</span>&nbsp;<span class="op" id="8443383">-</span><span class="num" id="8443384">1</span><span class="op" id="8443385">)</span>&nbsp;<span class="op" id="8443387">==</span>&nbsp;<span class="num" id="8443390">0</span>&nbsp;<span class="op" id="8443392">{</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8443399">close</span><span class="op" id="8443404">(</span><span class="ident" id="8443405">res</span><span class="op" id="8443408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8443414">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8443419">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8443424">wg</span><span class="op" id="8443426">.</span><span class="ident" id="8443427">Done</span><span class="op" id="8443431">(</span><span class="op" id="8443432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8443436">}</span><span class="op" id="8443437">(</span><span class="op" id="8443438">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8443441">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8443444">wg</span><span class="op" id="8443446">.</span><span class="ident" id="8443447">Wait</span><span class="op" id="8443451">(</span><span class="op" id="8443452">)</span><br>
<span class="lineno"></span><span class="op" id="8443454">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8443457">func</span>&nbsp;<span class="ident" id="8443462">BenchmarkEndToEnd</span><span class="op" id="8443479">(</span><span class="ident" id="8443480">b</span>&nbsp;<span class="op" id="8443482">*</span><span class="ident" id="8443483">testing</span><span class="op" id="8443490">.</span><span class="ident" id="8443491">B</span><span class="op" id="8443492">)</span>&nbsp;<span class="op" id="8443494">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8443497">benchmarkEndToEnd</span><span class="op" id="8443514">(</span><span class="ident" id="8443515">dialDirect</span><span class="op" id="8443525">,</span>&nbsp;<span class="ident" id="8443527">b</span><span class="op" id="8443528">)</span><br>
<span class="lineno"></span><span class="op" id="8443530">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8443533">func</span>&nbsp;<span class="ident" id="8443538">BenchmarkEndToEndHTTP</span><span class="op" id="8443559">(</span><span class="ident" id="8443560">b</span>&nbsp;<span class="op" id="8443562">*</span><span class="ident" id="8443563">testing</span><span class="op" id="8443570">.</span><span class="ident" id="8443571">B</span><span class="op" id="8443572">)</span>&nbsp;<span class="op" id="8443574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8443577">benchmarkEndToEnd</span><span class="op" id="8443594">(</span><span class="ident" id="8443595">dialHTTP</span><span class="op" id="8443603">,</span>&nbsp;<span class="ident" id="8443605">b</span><span class="op" id="8443606">)</span><br>
<span class="lineno">675</span><span class="op" id="8443608">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8443611">func</span>&nbsp;<span class="ident" id="8443616">BenchmarkEndToEndAsync</span><span class="op" id="8443638">(</span><span class="ident" id="8443639">b</span>&nbsp;<span class="op" id="8443641">*</span><span class="ident" id="8443642">testing</span><span class="op" id="8443649">.</span><span class="ident" id="8443650">B</span><span class="op" id="8443651">)</span>&nbsp;<span class="op" id="8443653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8443656">benchmarkEndToEndAsync</span><span class="op" id="8443678">(</span><span class="ident" id="8443679">dialDirect</span><span class="op" id="8443689">,</span>&nbsp;<span class="ident" id="8443691">b</span><span class="op" id="8443692">)</span><br>
<span class="lineno"></span><span class="op" id="8443694">}</span><br>
<span class="lineno">680</span><br>
<span class="lineno"></span><span class="keyword" id="8443697">func</span>&nbsp;<span class="ident" id="8443702">BenchmarkEndToEndAsyncHTTP</span><span class="op" id="8443728">(</span><span class="ident" id="8443729">b</span>&nbsp;<span class="op" id="8443731">*</span><span class="ident" id="8443732">testing</span><span class="op" id="8443739">.</span><span class="ident" id="8443740">B</span><span class="op" id="8443741">)</span>&nbsp;<span class="op" id="8443743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8443746">benchmarkEndToEndAsync</span><span class="op" id="8443768">(</span><span class="ident" id="8443769">dialHTTP</span><span class="op" id="8443777">,</span>&nbsp;<span class="ident" id="8443779">b</span><span class="op" id="8443780">)</span><br>
<span class="lineno"></span><span class="op" id="8443782">}</span>
</div>
</body>
</html>
