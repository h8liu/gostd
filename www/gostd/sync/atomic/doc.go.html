<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>sync/atomic</h2>
<ul>
<li><a href="/gostd/sync/atomic/atomic_test.go.html">atomic_test.go</a></li>
<li><a href="/gostd/sync/atomic/doc.go.html">doc.go</a></li>
<li><a href="/gostd/sync/atomic/value.go.html">value.go</a></li>
<li><a href="/gostd/sync/atomic/value_test.go.html">value_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1419396">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1419452">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1419506">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1419557">//&nbsp;Package&nbsp;atomic&nbsp;provides&nbsp;low-level&nbsp;atomic&nbsp;memory&nbsp;primitives</span><br>
<span class="lineno"></span><span class="comment" id="1419619">//&nbsp;useful&nbsp;for&nbsp;implementing&nbsp;synchronization&nbsp;algorithms.</span><br>
<span class="lineno"></span><span class="comment" id="1419674">//</span><br>
<span class="lineno"></span><span class="comment" id="1419677">//&nbsp;These&nbsp;functions&nbsp;require&nbsp;great&nbsp;care&nbsp;to&nbsp;be&nbsp;used&nbsp;correctly.</span><br>
<span class="lineno"></span><span class="comment" id="1419737">//&nbsp;Except&nbsp;for&nbsp;special,&nbsp;low-level&nbsp;applications,&nbsp;synchronization&nbsp;is&nbsp;better</span><br>
<span class="lineno">10</span><span class="comment" id="1419810">//&nbsp;done&nbsp;with&nbsp;channels&nbsp;or&nbsp;the&nbsp;facilities&nbsp;of&nbsp;the&nbsp;sync&nbsp;package.</span><br>
<span class="lineno"></span><span class="comment" id="1419871">//&nbsp;Share&nbsp;memory&nbsp;by&nbsp;communicating;</span><br>
<span class="lineno"></span><span class="comment" id="1419905">//&nbsp;don&#39;t&nbsp;communicate&nbsp;by&nbsp;sharing&nbsp;memory.</span><br>
<span class="lineno"></span><span class="comment" id="1419945">//</span><br>
<span class="lineno"></span><span class="comment" id="1419948">//&nbsp;The&nbsp;swap&nbsp;operation,&nbsp;implemented&nbsp;by&nbsp;the&nbsp;SwapT&nbsp;functions,&nbsp;is&nbsp;the&nbsp;atomic</span><br>
<span class="lineno">15</span><span class="comment" id="1420021">//&nbsp;equivalent&nbsp;of:</span><br>
<span class="lineno"></span><span class="comment" id="1420039">//</span><br>
<span class="lineno"></span><span class="comment" id="1420042">//&nbsp;&nbsp;&nbsp;&nbspold&nbsp;=&nbsp;*addr</span><br>
<span class="lineno"></span><span class="comment" id="1420057">//&nbsp;&nbsp;&nbsp;&nbsp*addr&nbsp;=&nbsp;new</span><br>
<span class="lineno"></span><span class="comment" id="1420072">//&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;old</span><br>
<span class="lineno">20</span><span class="comment" id="1420086">//</span><br>
<span class="lineno"></span><span class="comment" id="1420089">//&nbsp;The&nbsp;compare-and-swap&nbsp;operation,&nbsp;implemented&nbsp;by&nbsp;the&nbsp;CompareAndSwapT</span><br>
<span class="lineno"></span><span class="comment" id="1420159">//&nbsp;functions,&nbsp;is&nbsp;the&nbsp;atomic&nbsp;equivalent&nbsp;of:</span><br>
<span class="lineno"></span><span class="comment" id="1420202">//</span><br>
<span class="lineno"></span><span class="comment" id="1420205">//&nbsp;&nbsp;&nbsp;&nbspif&nbsp;*addr&nbsp;==&nbsp;old&nbsp;{</span><br>
<span class="lineno">25</span><span class="comment" id="1420226">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp*addr&nbsp;=&nbsp;new</span><br>
<span class="lineno"></span><span class="comment" id="1420242">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;true</span><br>
<span class="lineno"></span><span class="comment" id="1420258">//&nbsp;&nbsp;&nbsp;&nbsp}</span><br>
<span class="lineno"></span><span class="comment" id="1420263">//&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;false</span><br>
<span class="lineno"></span><span class="comment" id="1420279">//</span><br>
<span class="lineno">30</span><span class="comment" id="1420282">//&nbsp;The&nbsp;add&nbsp;operation,&nbsp;implemented&nbsp;by&nbsp;the&nbsp;AddT&nbsp;functions,&nbsp;is&nbsp;the&nbsp;atomic</span><br>
<span class="lineno"></span><span class="comment" id="1420353">//&nbsp;equivalent&nbsp;of:</span><br>
<span class="lineno"></span><span class="comment" id="1420371">//</span><br>
<span class="lineno"></span><span class="comment" id="1420374">//&nbsp;&nbsp;&nbsp;&nbsp*addr&nbsp;+=&nbsp;delta</span><br>
<span class="lineno"></span><span class="comment" id="1420392">//&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;*addr</span><br>
<span class="lineno">35</span><span class="comment" id="1420408">//</span><br>
<span class="lineno"></span><span class="comment" id="1420411">//&nbsp;The&nbsp;load&nbsp;and&nbsp;store&nbsp;operations,&nbsp;implemented&nbsp;by&nbsp;the&nbsp;LoadT&nbsp;and&nbsp;StoreT</span><br>
<span class="lineno"></span><span class="comment" id="1420481">//&nbsp;functions,&nbsp;are&nbsp;the&nbsp;atomic&nbsp;equivalents&nbsp;of&nbsp;&#34;return&nbsp;*addr&#34;&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="1420544">//&nbsp;&#34;*addr&nbsp;=&nbsp;val&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="1420562">//</span><br>
<span class="lineno">40</span><span class="keyword" id="1420565">package</span>&nbsp;<span class="ident" id="1420573">atomic</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1420581">import</span>&nbsp;<span class="op" id="1420588">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1420591">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="1420600">)</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="1420603">//&nbsp;BUG(rsc):&nbsp;On&nbsp;x86-32,&nbsp;the&nbsp;64-bit&nbsp;functions&nbsp;use&nbsp;instructions&nbsp;unavailable&nbsp;before&nbsp;the&nbsp;Pentium&nbsp;MMX.</span><br>
<span class="lineno"></span><span class="comment" id="1420701">//</span><br>
<span class="lineno"></span><span class="comment" id="1420704">//&nbsp;On&nbsp;non-Linux&nbsp;ARM,&nbsp;the&nbsp;64-bit&nbsp;functions&nbsp;use&nbsp;instructions&nbsp;unavailable&nbsp;before&nbsp;the&nbsp;ARMv6k&nbsp;core.</span><br>
<span class="lineno"></span><span class="comment" id="1420799">//</span><br>
<span class="lineno">50</span><span class="comment" id="1420802">//&nbsp;On&nbsp;both&nbsp;ARM&nbsp;and&nbsp;x86-32,&nbsp;it&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;arrange&nbsp;for&nbsp;64-bit</span><br>
<span class="lineno"></span><span class="comment" id="1420885">//&nbsp;alignment&nbsp;of&nbsp;64-bit&nbsp;words&nbsp;accessed&nbsp;atomically.&nbsp;The&nbsp;first&nbsp;word&nbsp;in&nbsp;a&nbsp;global</span><br>
<span class="lineno"></span><span class="comment" id="1420962">//&nbsp;variable&nbsp;or&nbsp;in&nbsp;an&nbsp;allocated&nbsp;struct&nbsp;or&nbsp;slice&nbsp;can&nbsp;be&nbsp;relied&nbsp;upon&nbsp;to&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="1421034">//&nbsp;64-bit&nbsp;aligned.</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="1421054">//&nbsp;SwapInt32&nbsp;atomically&nbsp;stores&nbsp;new&nbsp;into&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;previous&nbsp;*addr&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1421138">func</span>&nbsp;<span class="ident" id="1421143">SwapInt32</span><span class="op" id="1421152">(</span><span class="ident" id="1421153">addr</span>&nbsp;<span class="op" id="1421158">*</span><span class="builtintype" id="1421159">int32</span><span class="op" id="1421164">,</span>&nbsp;<span class="builtinfunc" id="1421166">new</span>&nbsp;<span class="builtintype" id="1421170">int32</span><span class="op" id="1421175">)</span>&nbsp;<span class="op" id="1421177">(</span><span class="ident" id="1421178">old</span>&nbsp;<span class="builtintype" id="1421182">int32</span><span class="op" id="1421187">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1421190">//&nbsp;SwapInt64&nbsp;atomically&nbsp;stores&nbsp;new&nbsp;into&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;previous&nbsp;*addr&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1421274">func</span>&nbsp;<span class="ident" id="1421279">SwapInt64</span><span class="op" id="1421288">(</span><span class="ident" id="1421289">addr</span>&nbsp;<span class="op" id="1421294">*</span><span class="ident" id="1421295">int64</span><span class="op" id="1421300">,</span>&nbsp;<span class="builtinfunc" id="1421302">new</span>&nbsp;<span class="ident" id="1421306">int64</span><span class="op" id="1421311">)</span>&nbsp;<span class="op" id="1421313">(</span><span class="ident" id="1421314">old</span>&nbsp;<span class="ident" id="1421318">int64</span><span class="op" id="1421323">)</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="comment" id="1421326">//&nbsp;SwapUint32&nbsp;atomically&nbsp;stores&nbsp;new&nbsp;into&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;previous&nbsp;*addr&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1421411">func</span>&nbsp;<span class="ident" id="1421416">SwapUint32</span><span class="op" id="1421426">(</span><span class="ident" id="1421427">addr</span>&nbsp;<span class="op" id="1421432">*</span><span class="builtintype" id="1421433">uint32</span><span class="op" id="1421439">,</span>&nbsp;<span class="builtinfunc" id="1421441">new</span>&nbsp;<span class="builtintype" id="1421445">uint32</span><span class="op" id="1421451">)</span>&nbsp;<span class="op" id="1421453">(</span><span class="ident" id="1421454">old</span>&nbsp;<span class="builtintype" id="1421458">uint32</span><span class="op" id="1421464">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1421467">//&nbsp;SwapUint64&nbsp;atomically&nbsp;stores&nbsp;new&nbsp;into&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;previous&nbsp;*addr&nbsp;value.</span><br>
<span class="lineno">65</span><span class="keyword" id="1421552">func</span>&nbsp;<span class="ident" id="1421557">SwapUint64</span><span class="op" id="1421567">(</span><span class="ident" id="1421568">addr</span>&nbsp;<span class="op" id="1421573">*</span><span class="ident" id="1421574">uint64</span><span class="op" id="1421580">,</span>&nbsp;<span class="builtinfunc" id="1421582">new</span>&nbsp;<span class="ident" id="1421586">uint64</span><span class="op" id="1421592">)</span>&nbsp;<span class="op" id="1421594">(</span><span class="ident" id="1421595">old</span>&nbsp;<span class="ident" id="1421599">uint64</span><span class="op" id="1421605">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1421608">//&nbsp;SwapUintptr&nbsp;atomically&nbsp;stores&nbsp;new&nbsp;into&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;previous&nbsp;*addr&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1421694">func</span>&nbsp;<span class="ident" id="1421699">SwapUintptr</span><span class="op" id="1421710">(</span><span class="ident" id="1421711">addr</span>&nbsp;<span class="op" id="1421716">*</span><span class="builtintype" id="1421717">uintptr</span><span class="op" id="1421724">,</span>&nbsp;<span class="builtinfunc" id="1421726">new</span>&nbsp;<span class="builtintype" id="1421730">uintptr</span><span class="op" id="1421737">)</span>&nbsp;<span class="op" id="1421739">(</span><span class="ident" id="1421740">old</span>&nbsp;<span class="builtintype" id="1421744">uintptr</span><span class="op" id="1421751">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="comment" id="1421754">//&nbsp;SwapPointer&nbsp;atomically&nbsp;stores&nbsp;new&nbsp;into&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;previous&nbsp;*addr&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1421840">func</span>&nbsp;<span class="ident" id="1421845">SwapPointer</span><span class="op" id="1421856">(</span><span class="ident" id="1421857">addr</span>&nbsp;<span class="op" id="1421862">*</span><span class="ident" id="1421863">unsafe</span><span class="op" id="1421869">.</span><span class="ident" id="1421870">Pointer</span><span class="op" id="1421877">,</span>&nbsp;<span class="builtinfunc" id="1421879">new</span>&nbsp;<span class="ident" id="1421883">unsafe</span><span class="op" id="1421889">.</span><span class="ident" id="1421890">Pointer</span><span class="op" id="1421897">)</span>&nbsp;<span class="op" id="1421899">(</span><span class="ident" id="1421900">old</span>&nbsp;<span class="ident" id="1421904">unsafe</span><span class="op" id="1421910">.</span><span class="ident" id="1421911">Pointer</span><span class="op" id="1421918">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1421921">//&nbsp;CompareAndSwapInt32&nbsp;executes&nbsp;the&nbsp;compare-and-swap&nbsp;operation&nbsp;for&nbsp;an&nbsp;int32&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1422004">func</span>&nbsp;<span class="ident" id="1422009">CompareAndSwapInt32</span><span class="op" id="1422028">(</span><span class="ident" id="1422029">addr</span>&nbsp;<span class="op" id="1422034">*</span><span class="builtintype" id="1422035">int32</span><span class="op" id="1422040">,</span>&nbsp;<span class="ident" id="1422042">old</span><span class="op" id="1422045">,</span>&nbsp;<span class="builtinfunc" id="1422047">new</span>&nbsp;<span class="builtintype" id="1422051">int32</span><span class="op" id="1422056">)</span>&nbsp;<span class="op" id="1422058">(</span><span class="ident" id="1422059">swapped</span>&nbsp;<span class="builtintype" id="1422067">bool</span><span class="op" id="1422071">)</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="comment" id="1422074">//&nbsp;CompareAndSwapInt64&nbsp;executes&nbsp;the&nbsp;compare-and-swap&nbsp;operation&nbsp;for&nbsp;an&nbsp;int64&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1422157">func</span>&nbsp;<span class="ident" id="1422162">CompareAndSwapInt64</span><span class="op" id="1422181">(</span><span class="ident" id="1422182">addr</span>&nbsp;<span class="op" id="1422187">*</span><span class="ident" id="1422188">int64</span><span class="op" id="1422193">,</span>&nbsp;<span class="ident" id="1422195">old</span><span class="op" id="1422198">,</span>&nbsp;<span class="builtinfunc" id="1422200">new</span>&nbsp;<span class="ident" id="1422204">int64</span><span class="op" id="1422209">)</span>&nbsp;<span class="op" id="1422211">(</span><span class="ident" id="1422212">swapped</span>&nbsp;<span class="builtintype" id="1422220">bool</span><span class="op" id="1422224">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1422227">//&nbsp;CompareAndSwapUint32&nbsp;executes&nbsp;the&nbsp;compare-and-swap&nbsp;operation&nbsp;for&nbsp;a&nbsp;uint32&nbsp;value.</span><br>
<span class="lineno">80</span><span class="keyword" id="1422311">func</span>&nbsp;<span class="ident" id="1422316">CompareAndSwapUint32</span><span class="op" id="1422336">(</span><span class="ident" id="1422337">addr</span>&nbsp;<span class="op" id="1422342">*</span><span class="builtintype" id="1422343">uint32</span><span class="op" id="1422349">,</span>&nbsp;<span class="ident" id="1422351">old</span><span class="op" id="1422354">,</span>&nbsp;<span class="builtinfunc" id="1422356">new</span>&nbsp;<span class="builtintype" id="1422360">uint32</span><span class="op" id="1422366">)</span>&nbsp;<span class="op" id="1422368">(</span><span class="ident" id="1422369">swapped</span>&nbsp;<span class="builtintype" id="1422377">bool</span><span class="op" id="1422381">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1422384">//&nbsp;CompareAndSwapUint64&nbsp;executes&nbsp;the&nbsp;compare-and-swap&nbsp;operation&nbsp;for&nbsp;a&nbsp;uint64&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1422468">func</span>&nbsp;<span class="ident" id="1422473">CompareAndSwapUint64</span><span class="op" id="1422493">(</span><span class="ident" id="1422494">addr</span>&nbsp;<span class="op" id="1422499">*</span><span class="ident" id="1422500">uint64</span><span class="op" id="1422506">,</span>&nbsp;<span class="ident" id="1422508">old</span><span class="op" id="1422511">,</span>&nbsp;<span class="builtinfunc" id="1422513">new</span>&nbsp;<span class="ident" id="1422517">uint64</span><span class="op" id="1422523">)</span>&nbsp;<span class="op" id="1422525">(</span><span class="ident" id="1422526">swapped</span>&nbsp;<span class="builtintype" id="1422534">bool</span><span class="op" id="1422538">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="comment" id="1422541">//&nbsp;CompareAndSwapUintptr&nbsp;executes&nbsp;the&nbsp;compare-and-swap&nbsp;operation&nbsp;for&nbsp;a&nbsp;uintptr&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1422627">func</span>&nbsp;<span class="ident" id="1422632">CompareAndSwapUintptr</span><span class="op" id="1422653">(</span><span class="ident" id="1422654">addr</span>&nbsp;<span class="op" id="1422659">*</span><span class="builtintype" id="1422660">uintptr</span><span class="op" id="1422667">,</span>&nbsp;<span class="ident" id="1422669">old</span><span class="op" id="1422672">,</span>&nbsp;<span class="builtinfunc" id="1422674">new</span>&nbsp;<span class="builtintype" id="1422678">uintptr</span><span class="op" id="1422685">)</span>&nbsp;<span class="op" id="1422687">(</span><span class="ident" id="1422688">swapped</span>&nbsp;<span class="builtintype" id="1422696">bool</span><span class="op" id="1422700">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1422703">//&nbsp;CompareAndSwapPointer&nbsp;executes&nbsp;the&nbsp;compare-and-swap&nbsp;operation&nbsp;for&nbsp;a&nbsp;unsafe.Pointer&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1422796">func</span>&nbsp;<span class="ident" id="1422801">CompareAndSwapPointer</span><span class="op" id="1422822">(</span><span class="ident" id="1422823">addr</span>&nbsp;<span class="op" id="1422828">*</span><span class="ident" id="1422829">unsafe</span><span class="op" id="1422835">.</span><span class="ident" id="1422836">Pointer</span><span class="op" id="1422843">,</span>&nbsp;<span class="ident" id="1422845">old</span><span class="op" id="1422848">,</span>&nbsp;<span class="builtinfunc" id="1422850">new</span>&nbsp;<span class="ident" id="1422854">unsafe</span><span class="op" id="1422860">.</span><span class="ident" id="1422861">Pointer</span><span class="op" id="1422868">)</span>&nbsp;<span class="op" id="1422870">(</span><span class="ident" id="1422871">swapped</span>&nbsp;<span class="builtintype" id="1422879">bool</span><span class="op" id="1422883">)</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="comment" id="1422886">//&nbsp;AddInt32&nbsp;atomically&nbsp;adds&nbsp;delta&nbsp;to&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1422956">func</span>&nbsp;<span class="ident" id="1422961">AddInt32</span><span class="op" id="1422969">(</span><span class="ident" id="1422970">addr</span>&nbsp;<span class="op" id="1422975">*</span><span class="builtintype" id="1422976">int32</span><span class="op" id="1422981">,</span>&nbsp;<span class="ident" id="1422983">delta</span>&nbsp;<span class="builtintype" id="1422989">int32</span><span class="op" id="1422994">)</span>&nbsp;<span class="op" id="1422996">(</span><span class="builtinfunc" id="1422997">new</span>&nbsp;<span class="builtintype" id="1423001">int32</span><span class="op" id="1423006">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1423009">//&nbsp;AddUint32&nbsp;atomically&nbsp;adds&nbsp;delta&nbsp;to&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;value.</span><br>
<span class="lineno">95</span><span class="comment" id="1423080">//&nbsp;To&nbsp;subtract&nbsp;a&nbsp;signed&nbsp;positive&nbsp;constant&nbsp;value&nbsp;c&nbsp;from&nbsp;x,&nbsp;do&nbsp;AddUint32(&amp;x,&nbsp;^uint32(c-1)).</span><br>
<span class="lineno"></span><span class="comment" id="1423170">//&nbsp;In&nbsp;particular,&nbsp;to&nbsp;decrement&nbsp;x,&nbsp;do&nbsp;AddUint32(&amp;x,&nbsp;^uint32(0)).</span><br>
<span class="lineno"></span><span class="keyword" id="1423234">func</span>&nbsp;<span class="ident" id="1423239">AddUint32</span><span class="op" id="1423248">(</span><span class="ident" id="1423249">addr</span>&nbsp;<span class="op" id="1423254">*</span><span class="builtintype" id="1423255">uint32</span><span class="op" id="1423261">,</span>&nbsp;<span class="ident" id="1423263">delta</span>&nbsp;<span class="builtintype" id="1423269">uint32</span><span class="op" id="1423275">)</span>&nbsp;<span class="op" id="1423277">(</span><span class="builtinfunc" id="1423278">new</span>&nbsp;<span class="builtintype" id="1423282">uint32</span><span class="op" id="1423288">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1423291">//&nbsp;AddInt64&nbsp;atomically&nbsp;adds&nbsp;delta&nbsp;to&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;value.</span><br>
<span class="lineno">100</span><span class="keyword" id="1423361">func</span>&nbsp;<span class="ident" id="1423366">AddInt64</span><span class="op" id="1423374">(</span><span class="ident" id="1423375">addr</span>&nbsp;<span class="op" id="1423380">*</span><span class="ident" id="1423381">int64</span><span class="op" id="1423386">,</span>&nbsp;<span class="ident" id="1423388">delta</span>&nbsp;<span class="ident" id="1423394">int64</span><span class="op" id="1423399">)</span>&nbsp;<span class="op" id="1423401">(</span><span class="builtinfunc" id="1423402">new</span>&nbsp;<span class="ident" id="1423406">int64</span><span class="op" id="1423411">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1423414">//&nbsp;AddUint64&nbsp;atomically&nbsp;adds&nbsp;delta&nbsp;to&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="1423485">//&nbsp;To&nbsp;subtract&nbsp;a&nbsp;signed&nbsp;positive&nbsp;constant&nbsp;value&nbsp;c&nbsp;from&nbsp;x,&nbsp;do&nbsp;AddUint64(&amp;x,&nbsp;^uint64(c-1)).</span><br>
<span class="lineno"></span><span class="comment" id="1423575">//&nbsp;In&nbsp;particular,&nbsp;to&nbsp;decrement&nbsp;x,&nbsp;do&nbsp;AddUint64(&amp;x,&nbsp;^uint64(0)).</span><br>
<span class="lineno">105</span><span class="keyword" id="1423639">func</span>&nbsp;<span class="ident" id="1423644">AddUint64</span><span class="op" id="1423653">(</span><span class="ident" id="1423654">addr</span>&nbsp;<span class="op" id="1423659">*</span><span class="ident" id="1423660">uint64</span><span class="op" id="1423666">,</span>&nbsp;<span class="ident" id="1423668">delta</span>&nbsp;<span class="ident" id="1423674">uint64</span><span class="op" id="1423680">)</span>&nbsp;<span class="op" id="1423682">(</span><span class="builtinfunc" id="1423683">new</span>&nbsp;<span class="ident" id="1423687">uint64</span><span class="op" id="1423693">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1423696">//&nbsp;AddUintptr&nbsp;atomically&nbsp;adds&nbsp;delta&nbsp;to&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1423768">func</span>&nbsp;<span class="ident" id="1423773">AddUintptr</span><span class="op" id="1423783">(</span><span class="ident" id="1423784">addr</span>&nbsp;<span class="op" id="1423789">*</span><span class="builtintype" id="1423790">uintptr</span><span class="op" id="1423797">,</span>&nbsp;<span class="ident" id="1423799">delta</span>&nbsp;<span class="builtintype" id="1423805">uintptr</span><span class="op" id="1423812">)</span>&nbsp;<span class="op" id="1423814">(</span><span class="builtinfunc" id="1423815">new</span>&nbsp;<span class="builtintype" id="1423819">uintptr</span><span class="op" id="1423826">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="1423829">//&nbsp;LoadInt32&nbsp;atomically&nbsp;loads&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1423866">func</span>&nbsp;<span class="ident" id="1423871">LoadInt32</span><span class="op" id="1423880">(</span><span class="ident" id="1423881">addr</span>&nbsp;<span class="op" id="1423886">*</span><span class="builtintype" id="1423887">int32</span><span class="op" id="1423892">)</span>&nbsp;<span class="op" id="1423894">(</span><span class="ident" id="1423895">val</span>&nbsp;<span class="builtintype" id="1423899">int32</span><span class="op" id="1423904">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1423907">//&nbsp;LoadInt64&nbsp;atomically&nbsp;loads&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1423944">func</span>&nbsp;<span class="ident" id="1423949">LoadInt64</span><span class="op" id="1423958">(</span><span class="ident" id="1423959">addr</span>&nbsp;<span class="op" id="1423964">*</span><span class="ident" id="1423965">int64</span><span class="op" id="1423970">)</span>&nbsp;<span class="op" id="1423972">(</span><span class="ident" id="1423973">val</span>&nbsp;<span class="ident" id="1423977">int64</span><span class="op" id="1423982">)</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="1423985">//&nbsp;LoadUint32&nbsp;atomically&nbsp;loads&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1424023">func</span>&nbsp;<span class="ident" id="1424028">LoadUint32</span><span class="op" id="1424038">(</span><span class="ident" id="1424039">addr</span>&nbsp;<span class="op" id="1424044">*</span><span class="builtintype" id="1424045">uint32</span><span class="op" id="1424051">)</span>&nbsp;<span class="op" id="1424053">(</span><span class="ident" id="1424054">val</span>&nbsp;<span class="builtintype" id="1424058">uint32</span><span class="op" id="1424064">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1424067">//&nbsp;LoadUint64&nbsp;atomically&nbsp;loads&nbsp;*addr.</span><br>
<span class="lineno">120</span><span class="keyword" id="1424105">func</span>&nbsp;<span class="ident" id="1424110">LoadUint64</span><span class="op" id="1424120">(</span><span class="ident" id="1424121">addr</span>&nbsp;<span class="op" id="1424126">*</span><span class="ident" id="1424127">uint64</span><span class="op" id="1424133">)</span>&nbsp;<span class="op" id="1424135">(</span><span class="ident" id="1424136">val</span>&nbsp;<span class="ident" id="1424140">uint64</span><span class="op" id="1424146">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1424149">//&nbsp;LoadUintptr&nbsp;atomically&nbsp;loads&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1424188">func</span>&nbsp;<span class="ident" id="1424193">LoadUintptr</span><span class="op" id="1424204">(</span><span class="ident" id="1424205">addr</span>&nbsp;<span class="op" id="1424210">*</span><span class="builtintype" id="1424211">uintptr</span><span class="op" id="1424218">)</span>&nbsp;<span class="op" id="1424220">(</span><span class="ident" id="1424221">val</span>&nbsp;<span class="builtintype" id="1424225">uintptr</span><span class="op" id="1424232">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment" id="1424235">//&nbsp;LoadPointer&nbsp;atomically&nbsp;loads&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1424274">func</span>&nbsp;<span class="ident" id="1424279">LoadPointer</span><span class="op" id="1424290">(</span><span class="ident" id="1424291">addr</span>&nbsp;<span class="op" id="1424296">*</span><span class="ident" id="1424297">unsafe</span><span class="op" id="1424303">.</span><span class="ident" id="1424304">Pointer</span><span class="op" id="1424311">)</span>&nbsp;<span class="op" id="1424313">(</span><span class="ident" id="1424314">val</span>&nbsp;<span class="ident" id="1424318">unsafe</span><span class="op" id="1424324">.</span><span class="ident" id="1424325">Pointer</span><span class="op" id="1424332">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1424335">//&nbsp;StoreInt32&nbsp;atomically&nbsp;stores&nbsp;val&nbsp;into&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1424383">func</span>&nbsp;<span class="ident" id="1424388">StoreInt32</span><span class="op" id="1424398">(</span><span class="ident" id="1424399">addr</span>&nbsp;<span class="op" id="1424404">*</span><span class="builtintype" id="1424405">int32</span><span class="op" id="1424410">,</span>&nbsp;<span class="ident" id="1424412">val</span>&nbsp;<span class="builtintype" id="1424416">int32</span><span class="op" id="1424421">)</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="1424424">//&nbsp;StoreInt64&nbsp;atomically&nbsp;stores&nbsp;val&nbsp;into&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1424472">func</span>&nbsp;<span class="ident" id="1424477">StoreInt64</span><span class="op" id="1424487">(</span><span class="ident" id="1424488">addr</span>&nbsp;<span class="op" id="1424493">*</span><span class="ident" id="1424494">int64</span><span class="op" id="1424499">,</span>&nbsp;<span class="ident" id="1424501">val</span>&nbsp;<span class="ident" id="1424505">int64</span><span class="op" id="1424510">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1424513">//&nbsp;StoreUint32&nbsp;atomically&nbsp;stores&nbsp;val&nbsp;into&nbsp;*addr.</span><br>
<span class="lineno">135</span><span class="keyword" id="1424562">func</span>&nbsp;<span class="ident" id="1424567">StoreUint32</span><span class="op" id="1424578">(</span><span class="ident" id="1424579">addr</span>&nbsp;<span class="op" id="1424584">*</span><span class="builtintype" id="1424585">uint32</span><span class="op" id="1424591">,</span>&nbsp;<span class="ident" id="1424593">val</span>&nbsp;<span class="builtintype" id="1424597">uint32</span><span class="op" id="1424603">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1424606">//&nbsp;StoreUint64&nbsp;atomically&nbsp;stores&nbsp;val&nbsp;into&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1424655">func</span>&nbsp;<span class="ident" id="1424660">StoreUint64</span><span class="op" id="1424671">(</span><span class="ident" id="1424672">addr</span>&nbsp;<span class="op" id="1424677">*</span><span class="ident" id="1424678">uint64</span><span class="op" id="1424684">,</span>&nbsp;<span class="ident" id="1424686">val</span>&nbsp;<span class="ident" id="1424690">uint64</span><span class="op" id="1424696">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span><span class="comment" id="1424699">//&nbsp;StoreUintptr&nbsp;atomically&nbsp;stores&nbsp;val&nbsp;into&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1424749">func</span>&nbsp;<span class="ident" id="1424754">StoreUintptr</span><span class="op" id="1424766">(</span><span class="ident" id="1424767">addr</span>&nbsp;<span class="op" id="1424772">*</span><span class="builtintype" id="1424773">uintptr</span><span class="op" id="1424780">,</span>&nbsp;<span class="ident" id="1424782">val</span>&nbsp;<span class="builtintype" id="1424786">uintptr</span><span class="op" id="1424793">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1424796">//&nbsp;StorePointer&nbsp;atomically&nbsp;stores&nbsp;val&nbsp;into&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1424846">func</span>&nbsp;<span class="ident" id="1424851">StorePointer</span><span class="op" id="1424863">(</span><span class="ident" id="1424864">addr</span>&nbsp;<span class="op" id="1424869">*</span><span class="ident" id="1424870">unsafe</span><span class="op" id="1424876">.</span><span class="ident" id="1424877">Pointer</span><span class="op" id="1424884">,</span>&nbsp;<span class="ident" id="1424886">val</span>&nbsp;<span class="ident" id="1424890">unsafe</span><span class="op" id="1424896">.</span><span class="ident" id="1424897">Pointer</span><span class="op" id="1424904">)</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="comment" id="1424907">//&nbsp;Helper&nbsp;for&nbsp;ARM.&nbsp;&nbsp;Linker&nbsp;will&nbsp;discard&nbsp;on&nbsp;other&nbsp;systems</span><br>
<span class="lineno"></span><span class="keyword" id="1424964">func</span>&nbsp;<span class="ident" id="1424969">panic64</span><span class="op" id="1424976">(</span><span class="op" id="1424977">)</span>&nbsp;<span class="op" id="1424979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1424982">panic</span><span class="op" id="1424987">(</span><span class="string" id="1424988">&#34;sync/atomic:&nbsp;broken&nbsp;64-bit&nbsp;atomic&nbsp;operations&nbsp;(buggy&nbsp;QEMU)&#34;</span><span class="op" id="1425047">)</span><br>
<span class="lineno"></span><span class="op" id="1425049">}</span>
</div>
</body>
</html>
