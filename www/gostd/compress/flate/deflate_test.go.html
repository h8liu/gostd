<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/flate</h2>
<ul>
<li><a href="/gostd/compress/flate/copy.go.html">copy.go</a></li>
<li><a href="/gostd/compress/flate/copy_test.go.html">copy_test.go</a></li>
<li><a href="/gostd/compress/flate/deflate.go.html">deflate.go</a></li>
<li><a href="/gostd/compress/flate/deflate_test.go.html" class="current">deflate_test.go</a></li>
<li><a href="/gostd/compress/flate/fixedhuff.go.html">fixedhuff.go</a></li>
<li><a href="/gostd/compress/flate/flate_test.go.html">flate_test.go</a></li>
<li><a href="/gostd/compress/flate/huffman_bit_writer.go.html">huffman_bit_writer.go</a></li>
<li><a href="/gostd/compress/flate/huffman_code.go.html">huffman_code.go</a></li>
<li><a href="/gostd/compress/flate/inflate.go.html">inflate.go</a></li>
<li><a href="/gostd/compress/flate/inflate_test.go.html">inflate_test.go</a></li>
<li><a href="/gostd/compress/flate/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/compress/flate/reverse_bits.go.html">reverse_bits.go</a></li>
<li><a href="/gostd/compress/flate/token.go.html">token.go</a></li>
<li><a href="/gostd/compress/flate/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8288592">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8288647">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8288701">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8288752">package</span>&nbsp;<span class="ident" id="8288760">flate</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8288767">import</span>&nbsp;<span class="op" id="8288774">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8288777">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8288786">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8288793">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8288799">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8288812">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8288823">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8288831">&#34;testing&#34;</span><br>
<span class="lineno">15</span><span class="op" id="8288841">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8288844">type</span>&nbsp;<span class="ident" id="8288849">deflateTest</span>&nbsp;<span class="keyword" id="8288861">struct</span>&nbsp;<span class="op" id="8288868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8288871">in</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8288877">[</span><span class="op" id="8288878">]</span><span class="builtintype" id="8288879">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8288885">level</span>&nbsp;<span class="builtintype" id="8288891">int</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8288896">out</span>&nbsp;&nbsp;&nbsp;<span class="op" id="8288902">[</span><span class="op" id="8288903">]</span><span class="builtintype" id="8288904">byte</span><br>
<span class="lineno"></span><span class="op" id="8288909">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8288912">type</span>&nbsp;<span class="ident" id="8288917">deflateInflateTest</span>&nbsp;<span class="keyword" id="8288936">struct</span>&nbsp;<span class="op" id="8288943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8288946">in</span>&nbsp;<span class="op" id="8288949">[</span><span class="op" id="8288950">]</span><span class="builtintype" id="8288951">byte</span><br>
<span class="lineno">25</span><span class="op" id="8288956">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8288959">type</span>&nbsp;<span class="ident" id="8288964">reverseBitsTest</span>&nbsp;<span class="keyword" id="8288980">struct</span>&nbsp;<span class="op" id="8288987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8288990">in</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8288999">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8289007">bitCount</span>&nbsp;<span class="builtintype" id="8289016">uint8</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8289023">out</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8289032">uint16</span><br>
<span class="lineno"></span><span class="op" id="8289039">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8289042">var</span>&nbsp;<span class="ident" id="8289046">deflateTests</span>&nbsp;<span class="op" id="8289059">=</span>&nbsp;<span class="op" id="8289061">[</span><span class="op" id="8289062">]</span><span class="op" id="8289063">*</span><span class="ident" id="8289064">deflateTest</span><span class="op" id="8289075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8289078">{</span><span class="op" id="8289079">[</span><span class="op" id="8289080">]</span><span class="builtintype" id="8289081">byte</span><span class="op" id="8289085">{</span><span class="op" id="8289086">}</span><span class="op" id="8289087">,</span>&nbsp;<span class="num" id="8289089">0</span><span class="op" id="8289090">,</span>&nbsp;<span class="op" id="8289092">[</span><span class="op" id="8289093">]</span><span class="builtintype" id="8289094">byte</span><span class="op" id="8289098">{</span><span class="num" id="8289099">1</span><span class="op" id="8289100">,</span>&nbsp;<span class="num" id="8289102">0</span><span class="op" id="8289103">,</span>&nbsp;<span class="num" id="8289105">0</span><span class="op" id="8289106">,</span>&nbsp;<span class="num" id="8289108">255</span><span class="op" id="8289111">,</span>&nbsp;<span class="num" id="8289113">255</span><span class="op" id="8289116">}</span><span class="op" id="8289117">}</span><span class="op" id="8289118">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8289121">{</span><span class="op" id="8289122">[</span><span class="op" id="8289123">]</span><span class="builtintype" id="8289124">byte</span><span class="op" id="8289128">{</span><span class="num" id="8289129">0x11</span><span class="op" id="8289133">}</span><span class="op" id="8289134">,</span>&nbsp;<span class="op" id="8289136">-</span><span class="num" id="8289137">1</span><span class="op" id="8289138">,</span>&nbsp;<span class="op" id="8289140">[</span><span class="op" id="8289141">]</span><span class="builtintype" id="8289142">byte</span><span class="op" id="8289146">{</span><span class="num" id="8289147">18</span><span class="op" id="8289149">,</span>&nbsp;<span class="num" id="8289151">4</span><span class="op" id="8289152">,</span>&nbsp;<span class="num" id="8289154">4</span><span class="op" id="8289155">,</span>&nbsp;<span class="num" id="8289157">0</span><span class="op" id="8289158">,</span>&nbsp;<span class="num" id="8289160">0</span><span class="op" id="8289161">,</span>&nbsp;<span class="num" id="8289163">255</span><span class="op" id="8289166">,</span>&nbsp;<span class="num" id="8289168">255</span><span class="op" id="8289171">}</span><span class="op" id="8289172">}</span><span class="op" id="8289173">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8289176">{</span><span class="op" id="8289177">[</span><span class="op" id="8289178">]</span><span class="builtintype" id="8289179">byte</span><span class="op" id="8289183">{</span><span class="num" id="8289184">0x11</span><span class="op" id="8289188">}</span><span class="op" id="8289189">,</span>&nbsp;<span class="ident" id="8289191">DefaultCompression</span><span class="op" id="8289209">,</span>&nbsp;<span class="op" id="8289211">[</span><span class="op" id="8289212">]</span><span class="builtintype" id="8289213">byte</span><span class="op" id="8289217">{</span><span class="num" id="8289218">18</span><span class="op" id="8289220">,</span>&nbsp;<span class="num" id="8289222">4</span><span class="op" id="8289223">,</span>&nbsp;<span class="num" id="8289225">4</span><span class="op" id="8289226">,</span>&nbsp;<span class="num" id="8289228">0</span><span class="op" id="8289229">,</span>&nbsp;<span class="num" id="8289231">0</span><span class="op" id="8289232">,</span>&nbsp;<span class="num" id="8289234">255</span><span class="op" id="8289237">,</span>&nbsp;<span class="num" id="8289239">255</span><span class="op" id="8289242">}</span><span class="op" id="8289243">}</span><span class="op" id="8289244">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8289247">{</span><span class="op" id="8289248">[</span><span class="op" id="8289249">]</span><span class="builtintype" id="8289250">byte</span><span class="op" id="8289254">{</span><span class="num" id="8289255">0x11</span><span class="op" id="8289259">}</span><span class="op" id="8289260">,</span>&nbsp;<span class="num" id="8289262">4</span><span class="op" id="8289263">,</span>&nbsp;<span class="op" id="8289265">[</span><span class="op" id="8289266">]</span><span class="builtintype" id="8289267">byte</span><span class="op" id="8289271">{</span><span class="num" id="8289272">18</span><span class="op" id="8289274">,</span>&nbsp;<span class="num" id="8289276">4</span><span class="op" id="8289277">,</span>&nbsp;<span class="num" id="8289279">4</span><span class="op" id="8289280">,</span>&nbsp;<span class="num" id="8289282">0</span><span class="op" id="8289283">,</span>&nbsp;<span class="num" id="8289285">0</span><span class="op" id="8289286">,</span>&nbsp;<span class="num" id="8289288">255</span><span class="op" id="8289291">,</span>&nbsp;<span class="num" id="8289293">255</span><span class="op" id="8289296">}</span><span class="op" id="8289297">}</span><span class="op" id="8289298">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8289302">{</span><span class="op" id="8289303">[</span><span class="op" id="8289304">]</span><span class="builtintype" id="8289305">byte</span><span class="op" id="8289309">{</span><span class="num" id="8289310">0x11</span><span class="op" id="8289314">}</span><span class="op" id="8289315">,</span>&nbsp;<span class="num" id="8289317">0</span><span class="op" id="8289318">,</span>&nbsp;<span class="op" id="8289320">[</span><span class="op" id="8289321">]</span><span class="builtintype" id="8289322">byte</span><span class="op" id="8289326">{</span><span class="num" id="8289327">0</span><span class="op" id="8289328">,</span>&nbsp;<span class="num" id="8289330">1</span><span class="op" id="8289331">,</span>&nbsp;<span class="num" id="8289333">0</span><span class="op" id="8289334">,</span>&nbsp;<span class="num" id="8289336">254</span><span class="op" id="8289339">,</span>&nbsp;<span class="num" id="8289341">255</span><span class="op" id="8289344">,</span>&nbsp;<span class="num" id="8289346">17</span><span class="op" id="8289348">,</span>&nbsp;<span class="num" id="8289350">1</span><span class="op" id="8289351">,</span>&nbsp;<span class="num" id="8289353">0</span><span class="op" id="8289354">,</span>&nbsp;<span class="num" id="8289356">0</span><span class="op" id="8289357">,</span>&nbsp;<span class="num" id="8289359">255</span><span class="op" id="8289362">,</span>&nbsp;<span class="num" id="8289364">255</span><span class="op" id="8289367">}</span><span class="op" id="8289368">}</span><span class="op" id="8289369">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8289372">{</span><span class="op" id="8289373">[</span><span class="op" id="8289374">]</span><span class="builtintype" id="8289375">byte</span><span class="op" id="8289379">{</span><span class="num" id="8289380">0x11</span><span class="op" id="8289384">,</span>&nbsp;<span class="num" id="8289386">0x12</span><span class="op" id="8289390">}</span><span class="op" id="8289391">,</span>&nbsp;<span class="num" id="8289393">0</span><span class="op" id="8289394">,</span>&nbsp;<span class="op" id="8289396">[</span><span class="op" id="8289397">]</span><span class="builtintype" id="8289398">byte</span><span class="op" id="8289402">{</span><span class="num" id="8289403">0</span><span class="op" id="8289404">,</span>&nbsp;<span class="num" id="8289406">2</span><span class="op" id="8289407">,</span>&nbsp;<span class="num" id="8289409">0</span><span class="op" id="8289410">,</span>&nbsp;<span class="num" id="8289412">253</span><span class="op" id="8289415">,</span>&nbsp;<span class="num" id="8289417">255</span><span class="op" id="8289420">,</span>&nbsp;<span class="num" id="8289422">17</span><span class="op" id="8289424">,</span>&nbsp;<span class="num" id="8289426">18</span><span class="op" id="8289428">,</span>&nbsp;<span class="num" id="8289430">1</span><span class="op" id="8289431">,</span>&nbsp;<span class="num" id="8289433">0</span><span class="op" id="8289434">,</span>&nbsp;<span class="num" id="8289436">0</span><span class="op" id="8289437">,</span>&nbsp;<span class="num" id="8289439">255</span><span class="op" id="8289442">,</span>&nbsp;<span class="num" id="8289444">255</span><span class="op" id="8289447">}</span><span class="op" id="8289448">}</span><span class="op" id="8289449">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8289452">{</span><span class="op" id="8289453">[</span><span class="op" id="8289454">]</span><span class="builtintype" id="8289455">byte</span><span class="op" id="8289459">{</span><span class="num" id="8289460">0x11</span><span class="op" id="8289464">,</span>&nbsp;<span class="num" id="8289466">0x11</span><span class="op" id="8289470">,</span>&nbsp;<span class="num" id="8289472">0x11</span><span class="op" id="8289476">,</span>&nbsp;<span class="num" id="8289478">0x11</span><span class="op" id="8289482">,</span>&nbsp;<span class="num" id="8289484">0x11</span><span class="op" id="8289488">,</span>&nbsp;<span class="num" id="8289490">0x11</span><span class="op" id="8289494">,</span>&nbsp;<span class="num" id="8289496">0x11</span><span class="op" id="8289500">,</span>&nbsp;<span class="num" id="8289502">0x11</span><span class="op" id="8289506">}</span><span class="op" id="8289507">,</span>&nbsp;<span class="num" id="8289509">0</span><span class="op" id="8289510">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8289514">[</span><span class="op" id="8289515">]</span><span class="builtintype" id="8289516">byte</span><span class="op" id="8289520">{</span><span class="num" id="8289521">0</span><span class="op" id="8289522">,</span>&nbsp;<span class="num" id="8289524">8</span><span class="op" id="8289525">,</span>&nbsp;<span class="num" id="8289527">0</span><span class="op" id="8289528">,</span>&nbsp;<span class="num" id="8289530">247</span><span class="op" id="8289533">,</span>&nbsp;<span class="num" id="8289535">255</span><span class="op" id="8289538">,</span>&nbsp;<span class="num" id="8289540">17</span><span class="op" id="8289542">,</span>&nbsp;<span class="num" id="8289544">17</span><span class="op" id="8289546">,</span>&nbsp;<span class="num" id="8289548">17</span><span class="op" id="8289550">,</span>&nbsp;<span class="num" id="8289552">17</span><span class="op" id="8289554">,</span>&nbsp;<span class="num" id="8289556">17</span><span class="op" id="8289558">,</span>&nbsp;<span class="num" id="8289560">17</span><span class="op" id="8289562">,</span>&nbsp;<span class="num" id="8289564">17</span><span class="op" id="8289566">,</span>&nbsp;<span class="num" id="8289568">17</span><span class="op" id="8289570">,</span>&nbsp;<span class="num" id="8289572">1</span><span class="op" id="8289573">,</span>&nbsp;<span class="num" id="8289575">0</span><span class="op" id="8289576">,</span>&nbsp;<span class="num" id="8289578">0</span><span class="op" id="8289579">,</span>&nbsp;<span class="num" id="8289581">255</span><span class="op" id="8289584">,</span>&nbsp;<span class="num" id="8289586">255</span><span class="op" id="8289589">}</span><span class="op" id="8289590">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8289593">}</span><span class="op" id="8289594">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8289597">{</span><span class="op" id="8289598">[</span><span class="op" id="8289599">]</span><span class="builtintype" id="8289600">byte</span><span class="op" id="8289604">{</span><span class="op" id="8289605">}</span><span class="op" id="8289606">,</span>&nbsp;<span class="num" id="8289608">1</span><span class="op" id="8289609">,</span>&nbsp;<span class="op" id="8289611">[</span><span class="op" id="8289612">]</span><span class="builtintype" id="8289613">byte</span><span class="op" id="8289617">{</span><span class="num" id="8289618">1</span><span class="op" id="8289619">,</span>&nbsp;<span class="num" id="8289621">0</span><span class="op" id="8289622">,</span>&nbsp;<span class="num" id="8289624">0</span><span class="op" id="8289625">,</span>&nbsp;<span class="num" id="8289627">255</span><span class="op" id="8289630">,</span>&nbsp;<span class="num" id="8289632">255</span><span class="op" id="8289635">}</span><span class="op" id="8289636">}</span><span class="op" id="8289637">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8289640">{</span><span class="op" id="8289641">[</span><span class="op" id="8289642">]</span><span class="builtintype" id="8289643">byte</span><span class="op" id="8289647">{</span><span class="num" id="8289648">0x11</span><span class="op" id="8289652">}</span><span class="op" id="8289653">,</span>&nbsp;<span class="num" id="8289655">1</span><span class="op" id="8289656">,</span>&nbsp;<span class="op" id="8289658">[</span><span class="op" id="8289659">]</span><span class="builtintype" id="8289660">byte</span><span class="op" id="8289664">{</span><span class="num" id="8289665">18</span><span class="op" id="8289667">,</span>&nbsp;<span class="num" id="8289669">4</span><span class="op" id="8289670">,</span>&nbsp;<span class="num" id="8289672">4</span><span class="op" id="8289673">,</span>&nbsp;<span class="num" id="8289675">0</span><span class="op" id="8289676">,</span>&nbsp;<span class="num" id="8289678">0</span><span class="op" id="8289679">,</span>&nbsp;<span class="num" id="8289681">255</span><span class="op" id="8289684">,</span>&nbsp;<span class="num" id="8289686">255</span><span class="op" id="8289689">}</span><span class="op" id="8289690">}</span><span class="op" id="8289691">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8289694">{</span><span class="op" id="8289695">[</span><span class="op" id="8289696">]</span><span class="builtintype" id="8289697">byte</span><span class="op" id="8289701">{</span><span class="num" id="8289702">0x11</span><span class="op" id="8289706">,</span>&nbsp;<span class="num" id="8289708">0x12</span><span class="op" id="8289712">}</span><span class="op" id="8289713">,</span>&nbsp;<span class="num" id="8289715">1</span><span class="op" id="8289716">,</span>&nbsp;<span class="op" id="8289718">[</span><span class="op" id="8289719">]</span><span class="builtintype" id="8289720">byte</span><span class="op" id="8289724">{</span><span class="num" id="8289725">18</span><span class="op" id="8289727">,</span>&nbsp;<span class="num" id="8289729">20</span><span class="op" id="8289731">,</span>&nbsp;<span class="num" id="8289733">2</span><span class="op" id="8289734">,</span>&nbsp;<span class="num" id="8289736">4</span><span class="op" id="8289737">,</span>&nbsp;<span class="num" id="8289739">0</span><span class="op" id="8289740">,</span>&nbsp;<span class="num" id="8289742">0</span><span class="op" id="8289743">,</span>&nbsp;<span class="num" id="8289745">255</span><span class="op" id="8289748">,</span>&nbsp;<span class="num" id="8289750">255</span><span class="op" id="8289753">}</span><span class="op" id="8289754">}</span><span class="op" id="8289755">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8289758">{</span><span class="op" id="8289759">[</span><span class="op" id="8289760">]</span><span class="builtintype" id="8289761">byte</span><span class="op" id="8289765">{</span><span class="num" id="8289766">0x11</span><span class="op" id="8289770">,</span>&nbsp;<span class="num" id="8289772">0x11</span><span class="op" id="8289776">,</span>&nbsp;<span class="num" id="8289778">0x11</span><span class="op" id="8289782">,</span>&nbsp;<span class="num" id="8289784">0x11</span><span class="op" id="8289788">,</span>&nbsp;<span class="num" id="8289790">0x11</span><span class="op" id="8289794">,</span>&nbsp;<span class="num" id="8289796">0x11</span><span class="op" id="8289800">,</span>&nbsp;<span class="num" id="8289802">0x11</span><span class="op" id="8289806">,</span>&nbsp;<span class="num" id="8289808">0x11</span><span class="op" id="8289812">}</span><span class="op" id="8289813">,</span>&nbsp;<span class="num" id="8289815">1</span><span class="op" id="8289816">,</span>&nbsp;<span class="op" id="8289818">[</span><span class="op" id="8289819">]</span><span class="builtintype" id="8289820">byte</span><span class="op" id="8289824">{</span><span class="num" id="8289825">18</span><span class="op" id="8289827">,</span>&nbsp;<span class="num" id="8289829">132</span><span class="op" id="8289832">,</span>&nbsp;<span class="num" id="8289834">2</span><span class="op" id="8289835">,</span>&nbsp;<span class="num" id="8289837">64</span><span class="op" id="8289839">,</span>&nbsp;<span class="num" id="8289841">0</span><span class="op" id="8289842">,</span>&nbsp;<span class="num" id="8289844">0</span><span class="op" id="8289845">,</span>&nbsp;<span class="num" id="8289847">0</span><span class="op" id="8289848">,</span>&nbsp;<span class="num" id="8289850">255</span><span class="op" id="8289853">,</span>&nbsp;<span class="num" id="8289855">255</span><span class="op" id="8289858">}</span><span class="op" id="8289859">}</span><span class="op" id="8289860">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8289863">{</span><span class="op" id="8289864">[</span><span class="op" id="8289865">]</span><span class="builtintype" id="8289866">byte</span><span class="op" id="8289870">{</span><span class="op" id="8289871">}</span><span class="op" id="8289872">,</span>&nbsp;<span class="num" id="8289874">9</span><span class="op" id="8289875">,</span>&nbsp;<span class="op" id="8289877">[</span><span class="op" id="8289878">]</span><span class="builtintype" id="8289879">byte</span><span class="op" id="8289883">{</span><span class="num" id="8289884">1</span><span class="op" id="8289885">,</span>&nbsp;<span class="num" id="8289887">0</span><span class="op" id="8289888">,</span>&nbsp;<span class="num" id="8289890">0</span><span class="op" id="8289891">,</span>&nbsp;<span class="num" id="8289893">255</span><span class="op" id="8289896">,</span>&nbsp;<span class="num" id="8289898">255</span><span class="op" id="8289901">}</span><span class="op" id="8289902">}</span><span class="op" id="8289903">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8289906">{</span><span class="op" id="8289907">[</span><span class="op" id="8289908">]</span><span class="builtintype" id="8289909">byte</span><span class="op" id="8289913">{</span><span class="num" id="8289914">0x11</span><span class="op" id="8289918">}</span><span class="op" id="8289919">,</span>&nbsp;<span class="num" id="8289921">9</span><span class="op" id="8289922">,</span>&nbsp;<span class="op" id="8289924">[</span><span class="op" id="8289925">]</span><span class="builtintype" id="8289926">byte</span><span class="op" id="8289930">{</span><span class="num" id="8289931">18</span><span class="op" id="8289933">,</span>&nbsp;<span class="num" id="8289935">4</span><span class="op" id="8289936">,</span>&nbsp;<span class="num" id="8289938">4</span><span class="op" id="8289939">,</span>&nbsp;<span class="num" id="8289941">0</span><span class="op" id="8289942">,</span>&nbsp;<span class="num" id="8289944">0</span><span class="op" id="8289945">,</span>&nbsp;<span class="num" id="8289947">255</span><span class="op" id="8289950">,</span>&nbsp;<span class="num" id="8289952">255</span><span class="op" id="8289955">}</span><span class="op" id="8289956">}</span><span class="op" id="8289957">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8289960">{</span><span class="op" id="8289961">[</span><span class="op" id="8289962">]</span><span class="builtintype" id="8289963">byte</span><span class="op" id="8289967">{</span><span class="num" id="8289968">0x11</span><span class="op" id="8289972">,</span>&nbsp;<span class="num" id="8289974">0x12</span><span class="op" id="8289978">}</span><span class="op" id="8289979">,</span>&nbsp;<span class="num" id="8289981">9</span><span class="op" id="8289982">,</span>&nbsp;<span class="op" id="8289984">[</span><span class="op" id="8289985">]</span><span class="builtintype" id="8289986">byte</span><span class="op" id="8289990">{</span><span class="num" id="8289991">18</span><span class="op" id="8289993">,</span>&nbsp;<span class="num" id="8289995">20</span><span class="op" id="8289997">,</span>&nbsp;<span class="num" id="8289999">2</span><span class="op" id="8290000">,</span>&nbsp;<span class="num" id="8290002">4</span><span class="op" id="8290003">,</span>&nbsp;<span class="num" id="8290005">0</span><span class="op" id="8290006">,</span>&nbsp;<span class="num" id="8290008">0</span><span class="op" id="8290009">,</span>&nbsp;<span class="num" id="8290011">255</span><span class="op" id="8290014">,</span>&nbsp;<span class="num" id="8290016">255</span><span class="op" id="8290019">}</span><span class="op" id="8290020">}</span><span class="op" id="8290021">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8290024">{</span><span class="op" id="8290025">[</span><span class="op" id="8290026">]</span><span class="builtintype" id="8290027">byte</span><span class="op" id="8290031">{</span><span class="num" id="8290032">0x11</span><span class="op" id="8290036">,</span>&nbsp;<span class="num" id="8290038">0x11</span><span class="op" id="8290042">,</span>&nbsp;<span class="num" id="8290044">0x11</span><span class="op" id="8290048">,</span>&nbsp;<span class="num" id="8290050">0x11</span><span class="op" id="8290054">,</span>&nbsp;<span class="num" id="8290056">0x11</span><span class="op" id="8290060">,</span>&nbsp;<span class="num" id="8290062">0x11</span><span class="op" id="8290066">,</span>&nbsp;<span class="num" id="8290068">0x11</span><span class="op" id="8290072">,</span>&nbsp;<span class="num" id="8290074">0x11</span><span class="op" id="8290078">}</span><span class="op" id="8290079">,</span>&nbsp;<span class="num" id="8290081">9</span><span class="op" id="8290082">,</span>&nbsp;<span class="op" id="8290084">[</span><span class="op" id="8290085">]</span><span class="builtintype" id="8290086">byte</span><span class="op" id="8290090">{</span><span class="num" id="8290091">18</span><span class="op" id="8290093">,</span>&nbsp;<span class="num" id="8290095">132</span><span class="op" id="8290098">,</span>&nbsp;<span class="num" id="8290100">2</span><span class="op" id="8290101">,</span>&nbsp;<span class="num" id="8290103">64</span><span class="op" id="8290105">,</span>&nbsp;<span class="num" id="8290107">0</span><span class="op" id="8290108">,</span>&nbsp;<span class="num" id="8290110">0</span><span class="op" id="8290111">,</span>&nbsp;<span class="num" id="8290113">0</span><span class="op" id="8290114">,</span>&nbsp;<span class="num" id="8290116">255</span><span class="op" id="8290119">,</span>&nbsp;<span class="num" id="8290121">255</span><span class="op" id="8290124">}</span><span class="op" id="8290125">}</span><span class="op" id="8290126">,</span><br>
<span class="lineno"></span><span class="op" id="8290128">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8290131">var</span>&nbsp;<span class="ident" id="8290135">deflateInflateTests</span>&nbsp;<span class="op" id="8290155">=</span>&nbsp;<span class="op" id="8290157">[</span><span class="op" id="8290158">]</span><span class="op" id="8290159">*</span><span class="ident" id="8290160">deflateInflateTest</span><span class="op" id="8290178">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8290181">{</span><span class="op" id="8290182">[</span><span class="op" id="8290183">]</span><span class="builtintype" id="8290184">byte</span><span class="op" id="8290188">{</span><span class="op" id="8290189">}</span><span class="op" id="8290190">}</span><span class="op" id="8290191">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8290194">{</span><span class="op" id="8290195">[</span><span class="op" id="8290196">]</span><span class="builtintype" id="8290197">byte</span><span class="op" id="8290201">{</span><span class="num" id="8290202">0x11</span><span class="op" id="8290206">}</span><span class="op" id="8290207">}</span><span class="op" id="8290208">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8290211">{</span><span class="op" id="8290212">[</span><span class="op" id="8290213">]</span><span class="builtintype" id="8290214">byte</span><span class="op" id="8290218">{</span><span class="num" id="8290219">0x11</span><span class="op" id="8290223">,</span>&nbsp;<span class="num" id="8290225">0x12</span><span class="op" id="8290229">}</span><span class="op" id="8290230">}</span><span class="op" id="8290231">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8290234">{</span><span class="op" id="8290235">[</span><span class="op" id="8290236">]</span><span class="builtintype" id="8290237">byte</span><span class="op" id="8290241">{</span><span class="num" id="8290242">0x11</span><span class="op" id="8290246">,</span>&nbsp;<span class="num" id="8290248">0x11</span><span class="op" id="8290252">,</span>&nbsp;<span class="num" id="8290254">0x11</span><span class="op" id="8290258">,</span>&nbsp;<span class="num" id="8290260">0x11</span><span class="op" id="8290264">,</span>&nbsp;<span class="num" id="8290266">0x11</span><span class="op" id="8290270">,</span>&nbsp;<span class="num" id="8290272">0x11</span><span class="op" id="8290276">,</span>&nbsp;<span class="num" id="8290278">0x11</span><span class="op" id="8290282">,</span>&nbsp;<span class="num" id="8290284">0x11</span><span class="op" id="8290288">}</span><span class="op" id="8290289">}</span><span class="op" id="8290290">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8290293">{</span><span class="op" id="8290294">[</span><span class="op" id="8290295">]</span><span class="builtintype" id="8290296">byte</span><span class="op" id="8290300">{</span><span class="num" id="8290301">0x11</span><span class="op" id="8290305">,</span>&nbsp;<span class="num" id="8290307">0x10</span><span class="op" id="8290311">,</span>&nbsp;<span class="num" id="8290313">0x13</span><span class="op" id="8290317">,</span>&nbsp;<span class="num" id="8290319">0x41</span><span class="op" id="8290323">,</span>&nbsp;<span class="num" id="8290325">0x21</span><span class="op" id="8290329">,</span>&nbsp;<span class="num" id="8290331">0x21</span><span class="op" id="8290335">,</span>&nbsp;<span class="num" id="8290337">0x41</span><span class="op" id="8290341">,</span>&nbsp;<span class="num" id="8290343">0x13</span><span class="op" id="8290347">,</span>&nbsp;<span class="num" id="8290349">0x87</span><span class="op" id="8290353">,</span>&nbsp;<span class="num" id="8290355">0x78</span><span class="op" id="8290359">,</span>&nbsp;<span class="num" id="8290361">0x13</span><span class="op" id="8290365">}</span><span class="op" id="8290366">}</span><span class="op" id="8290367">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8290370">{</span><span class="ident" id="8290371">largeDataChunk</span><span class="op" id="8290385">(</span><span class="op" id="8290386">)</span><span class="op" id="8290387">}</span><span class="op" id="8290388">,</span><br>
<span class="lineno"></span><span class="op" id="8290390">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8290393">var</span>&nbsp;<span class="ident" id="8290397">reverseBitsTests</span>&nbsp;<span class="op" id="8290414">=</span>&nbsp;<span class="op" id="8290416">[</span><span class="op" id="8290417">]</span><span class="op" id="8290418">*</span><span class="ident" id="8290419">reverseBitsTest</span><span class="op" id="8290434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8290437">{</span><span class="num" id="8290438">1</span><span class="op" id="8290439">,</span>&nbsp;<span class="num" id="8290441">1</span><span class="op" id="8290442">,</span>&nbsp;<span class="num" id="8290444">1</span><span class="op" id="8290445">}</span><span class="op" id="8290446">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8290449">{</span><span class="num" id="8290450">1</span><span class="op" id="8290451">,</span>&nbsp;<span class="num" id="8290453">2</span><span class="op" id="8290454">,</span>&nbsp;<span class="num" id="8290456">2</span><span class="op" id="8290457">}</span><span class="op" id="8290458">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8290461">{</span><span class="num" id="8290462">1</span><span class="op" id="8290463">,</span>&nbsp;<span class="num" id="8290465">3</span><span class="op" id="8290466">,</span>&nbsp;<span class="num" id="8290468">4</span><span class="op" id="8290469">}</span><span class="op" id="8290470">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8290473">{</span><span class="num" id="8290474">1</span><span class="op" id="8290475">,</span>&nbsp;<span class="num" id="8290477">4</span><span class="op" id="8290478">,</span>&nbsp;<span class="num" id="8290480">8</span><span class="op" id="8290481">}</span><span class="op" id="8290482">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8290485">{</span><span class="num" id="8290486">1</span><span class="op" id="8290487">,</span>&nbsp;<span class="num" id="8290489">5</span><span class="op" id="8290490">,</span>&nbsp;<span class="num" id="8290492">16</span><span class="op" id="8290494">}</span><span class="op" id="8290495">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8290498">{</span><span class="num" id="8290499">17</span><span class="op" id="8290501">,</span>&nbsp;<span class="num" id="8290503">5</span><span class="op" id="8290504">,</span>&nbsp;<span class="num" id="8290506">17</span><span class="op" id="8290508">}</span><span class="op" id="8290509">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8290512">{</span><span class="num" id="8290513">257</span><span class="op" id="8290516">,</span>&nbsp;<span class="num" id="8290518">9</span><span class="op" id="8290519">,</span>&nbsp;<span class="num" id="8290521">257</span><span class="op" id="8290524">}</span><span class="op" id="8290525">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8290528">{</span><span class="num" id="8290529">29</span><span class="op" id="8290531">,</span>&nbsp;<span class="num" id="8290533">5</span><span class="op" id="8290534">,</span>&nbsp;<span class="num" id="8290536">23</span><span class="op" id="8290538">}</span><span class="op" id="8290539">,</span><br>
<span class="lineno"></span><span class="op" id="8290541">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8290544">func</span>&nbsp;<span class="ident" id="8290549">largeDataChunk</span><span class="op" id="8290563">(</span><span class="op" id="8290564">)</span>&nbsp;<span class="op" id="8290566">[</span><span class="op" id="8290567">]</span><span class="builtintype" id="8290568">byte</span>&nbsp;<span class="op" id="8290573">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8290576">result</span>&nbsp;<span class="op" id="8290583">:=</span>&nbsp;<span class="builtinfunc" id="8290586">make</span><span class="op" id="8290590">(</span><span class="op" id="8290591">[</span><span class="op" id="8290592">]</span><span class="builtintype" id="8290593">byte</span><span class="op" id="8290597">,</span>&nbsp;<span class="num" id="8290599">100000</span><span class="op" id="8290605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8290608">for</span>&nbsp;<span class="ident" id="8290612">i</span>&nbsp;<span class="op" id="8290614">:=</span>&nbsp;<span class="keyword" id="8290617">range</span>&nbsp;<span class="ident" id="8290623">result</span>&nbsp;<span class="op" id="8290630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8290634">result</span><span class="op" id="8290640">[</span><span class="ident" id="8290641">i</span><span class="op" id="8290642">]</span>&nbsp;<span class="op" id="8290644">=</span>&nbsp;<span class="builtintype" id="8290646">byte</span><span class="op" id="8290650">(</span><span class="ident" id="8290651">i</span>&nbsp;<span class="op" id="8290653">*</span>&nbsp;<span class="ident" id="8290655">i</span>&nbsp;<span class="op" id="8290657">&amp;</span>&nbsp;<span class="num" id="8290659">0xFF</span><span class="op" id="8290663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8290666">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8290669">return</span>&nbsp;<span class="ident" id="8290676">result</span><br>
<span class="lineno">80</span><span class="op" id="8290683">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8290686">func</span>&nbsp;<span class="ident" id="8290691">TestDeflate</span><span class="op" id="8290702">(</span><span class="ident" id="8290703">t</span>&nbsp;<span class="op" id="8290705">*</span><span class="ident" id="8290706">testing</span><span class="op" id="8290713">.</span><span class="ident" id="8290714">T</span><span class="op" id="8290715">)</span>&nbsp;<span class="op" id="8290717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8290720">for</span>&nbsp;<span class="ident" id="8290724">_</span><span class="op" id="8290725">,</span>&nbsp;<span class="ident" id="8290727">h</span>&nbsp;<span class="op" id="8290729">:=</span>&nbsp;<span class="keyword" id="8290732">range</span>&nbsp;<span class="ident" id="8290738">deflateTests</span>&nbsp;<span class="op" id="8290751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8290755">var</span>&nbsp;<span class="ident" id="8290759">buf</span>&nbsp;<span class="ident" id="8290763">bytes</span><span class="op" id="8290768">.</span><span class="ident" id="8290769">Buffer</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8290778">w</span><span class="op" id="8290779">,</span>&nbsp;<span class="ident" id="8290781">err</span>&nbsp;<span class="op" id="8290785">:=</span>&nbsp;<span class="ident" id="8290788">NewWriter</span><span class="op" id="8290797">(</span><span class="op" id="8290798">&amp;</span><span class="ident" id="8290799">buf</span><span class="op" id="8290802">,</span>&nbsp;<span class="ident" id="8290804">h</span><span class="op" id="8290805">.</span><span class="ident" id="8290806">level</span><span class="op" id="8290811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8290815">if</span>&nbsp;<span class="ident" id="8290818">err</span>&nbsp;<span class="op" id="8290822">!=</span>&nbsp;<span class="builtintype" id="8290825">nil</span>&nbsp;<span class="op" id="8290829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8290834">t</span><span class="op" id="8290835">.</span><span class="ident" id="8290836">Errorf</span><span class="op" id="8290842">(</span><span class="string" id="8290843">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="8290858">,</span>&nbsp;<span class="ident" id="8290860">err</span><span class="op" id="8290863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8290868">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8290879">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8290883">w</span><span class="op" id="8290884">.</span><span class="ident" id="8290885">Write</span><span class="op" id="8290890">(</span><span class="ident" id="8290891">h</span><span class="op" id="8290892">.</span><span class="ident" id="8290893">in</span><span class="op" id="8290895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8290899">w</span><span class="op" id="8290900">.</span><span class="ident" id="8290901">Close</span><span class="op" id="8290906">(</span><span class="op" id="8290907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8290911">if</span>&nbsp;<span class="op" id="8290914">!</span><span class="ident" id="8290915">bytes</span><span class="op" id="8290920">.</span><span class="ident" id="8290921">Equal</span><span class="op" id="8290926">(</span><span class="ident" id="8290927">buf</span><span class="op" id="8290930">.</span><span class="ident" id="8290931">Bytes</span><span class="op" id="8290936">(</span><span class="op" id="8290937">)</span><span class="op" id="8290938">,</span>&nbsp;<span class="ident" id="8290940">h</span><span class="op" id="8290941">.</span><span class="ident" id="8290942">out</span><span class="op" id="8290945">)</span>&nbsp;<span class="op" id="8290947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8290952">t</span><span class="op" id="8290953">.</span><span class="ident" id="8290954">Errorf</span><span class="op" id="8290960">(</span><span class="string" id="8290961">&#34;Deflate(%d,&nbsp;%x)&nbsp;=&nbsp;%x,&nbsp;want&nbsp;%x&#34;</span><span class="op" id="8290992">,</span>&nbsp;<span class="ident" id="8290994">h</span><span class="op" id="8290995">.</span><span class="ident" id="8290996">level</span><span class="op" id="8291001">,</span>&nbsp;<span class="ident" id="8291003">h</span><span class="op" id="8291004">.</span><span class="ident" id="8291005">in</span><span class="op" id="8291007">,</span>&nbsp;<span class="ident" id="8291009">buf</span><span class="op" id="8291012">.</span><span class="ident" id="8291013">Bytes</span><span class="op" id="8291018">(</span><span class="op" id="8291019">)</span><span class="op" id="8291020">,</span>&nbsp;<span class="ident" id="8291022">h</span><span class="op" id="8291023">.</span><span class="ident" id="8291024">out</span><span class="op" id="8291027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8291031">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8291034">}</span><br>
<span class="lineno"></span><span class="op" id="8291036">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8291039">//&nbsp;A&nbsp;sparseReader&nbsp;returns&nbsp;a&nbsp;stream&nbsp;consisting&nbsp;of&nbsp;0s&nbsp;followed&nbsp;by&nbsp;1&lt;&lt;16&nbsp;1s.</span><br>
<span class="lineno"></span><span class="comment" id="8291113">//&nbsp;This&nbsp;tests&nbsp;missing&nbsp;hash&nbsp;references&nbsp;in&nbsp;a&nbsp;very&nbsp;large&nbsp;input.</span><br>
<span class="lineno">100</span><span class="keyword" id="8291174">type</span>&nbsp;<span class="ident" id="8291179">sparseReader</span>&nbsp;<span class="keyword" id="8291192">struct</span>&nbsp;<span class="op" id="8291199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8291202">l</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="8291206">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8291213">cur</span>&nbsp;<span class="ident" id="8291217">int64</span><br>
<span class="lineno"></span><span class="op" id="8291223">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="keyword" id="8291226">func</span>&nbsp;<span class="op" id="8291231">(</span><span class="ident" id="8291232">r</span>&nbsp;<span class="op" id="8291234">*</span><span class="ident" id="8291235">sparseReader</span><span class="op" id="8291247">)</span>&nbsp;<span class="ident" id="8291249">Read</span><span class="op" id="8291253">(</span><span class="ident" id="8291254">b</span>&nbsp;<span class="op" id="8291256">[</span><span class="op" id="8291257">]</span><span class="builtintype" id="8291258">byte</span><span class="op" id="8291262">)</span>&nbsp;<span class="op" id="8291264">(</span><span class="ident" id="8291265">n</span>&nbsp;<span class="builtintype" id="8291267">int</span><span class="op" id="8291270">,</span>&nbsp;<span class="ident" id="8291272">err</span>&nbsp;<span class="builtintype" id="8291276">error</span><span class="op" id="8291281">)</span>&nbsp;<span class="op" id="8291283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8291286">if</span>&nbsp;<span class="ident" id="8291289">r</span><span class="op" id="8291290">.</span><span class="ident" id="8291291">cur</span>&nbsp;<span class="op" id="8291295">&gt;=</span>&nbsp;<span class="ident" id="8291298">r</span><span class="op" id="8291299">.</span><span class="ident" id="8291300">l</span>&nbsp;<span class="op" id="8291302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8291306">return</span>&nbsp;<span class="num" id="8291313">0</span><span class="op" id="8291314">,</span>&nbsp;<span class="ident" id="8291316">io</span><span class="op" id="8291318">.</span><span class="ident" id="8291319">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8291324">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8291327">n</span>&nbsp;<span class="op" id="8291329">=</span>&nbsp;<span class="builtinfunc" id="8291331">len</span><span class="op" id="8291334">(</span><span class="ident" id="8291335">b</span><span class="op" id="8291336">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8291339">cur</span>&nbsp;<span class="op" id="8291343">:=</span>&nbsp;<span class="ident" id="8291346">r</span><span class="op" id="8291347">.</span><span class="ident" id="8291348">cur</span>&nbsp;<span class="op" id="8291352">+</span>&nbsp;<span class="ident" id="8291354">int64</span><span class="op" id="8291359">(</span><span class="ident" id="8291360">n</span><span class="op" id="8291361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8291364">if</span>&nbsp;<span class="ident" id="8291367">cur</span>&nbsp;<span class="op" id="8291371">&gt;</span>&nbsp;<span class="ident" id="8291373">r</span><span class="op" id="8291374">.</span><span class="ident" id="8291375">l</span>&nbsp;<span class="op" id="8291377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8291381">n</span>&nbsp;<span class="op" id="8291383">-=</span>&nbsp;<span class="builtintype" id="8291386">int</span><span class="op" id="8291389">(</span><span class="ident" id="8291390">cur</span>&nbsp;<span class="op" id="8291394">-</span>&nbsp;<span class="ident" id="8291396">r</span><span class="op" id="8291397">.</span><span class="ident" id="8291398">l</span><span class="op" id="8291399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8291403">cur</span>&nbsp;<span class="op" id="8291407">=</span>&nbsp;<span class="ident" id="8291409">r</span><span class="op" id="8291410">.</span><span class="ident" id="8291411">l</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8291414">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8291417">for</span>&nbsp;<span class="ident" id="8291421">i</span>&nbsp;<span class="op" id="8291423">:=</span>&nbsp;<span class="keyword" id="8291426">range</span>&nbsp;<span class="ident" id="8291432">b</span><span class="op" id="8291433">[</span><span class="num" id="8291434">0</span><span class="op" id="8291435">:</span><span class="ident" id="8291436">n</span><span class="op" id="8291437">]</span>&nbsp;<span class="op" id="8291439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8291443">if</span>&nbsp;<span class="ident" id="8291446">r</span><span class="op" id="8291447">.</span><span class="ident" id="8291448">cur</span><span class="op" id="8291451">+</span><span class="ident" id="8291452">int64</span><span class="op" id="8291457">(</span><span class="ident" id="8291458">i</span><span class="op" id="8291459">)</span>&nbsp;<span class="op" id="8291461">&gt;=</span>&nbsp;<span class="ident" id="8291464">r</span><span class="op" id="8291465">.</span><span class="ident" id="8291466">l</span><span class="op" id="8291467">-</span><span class="num" id="8291468">1</span><span class="op" id="8291469">&lt;&lt;</span><span class="num" id="8291471">16</span>&nbsp;<span class="op" id="8291474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8291479">b</span><span class="op" id="8291480">[</span><span class="ident" id="8291481">i</span><span class="op" id="8291482">]</span>&nbsp;<span class="op" id="8291484">=</span>&nbsp;<span class="num" id="8291486">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8291490">}</span>&nbsp;<span class="keyword" id="8291492">else</span>&nbsp;<span class="op" id="8291497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8291502">b</span><span class="op" id="8291503">[</span><span class="ident" id="8291504">i</span><span class="op" id="8291505">]</span>&nbsp;<span class="op" id="8291507">=</span>&nbsp;<span class="num" id="8291509">0</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8291513">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8291516">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8291519">r</span><span class="op" id="8291520">.</span><span class="ident" id="8291521">cur</span>&nbsp;<span class="op" id="8291525">=</span>&nbsp;<span class="ident" id="8291527">cur</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8291532">return</span><br>
<span class="lineno"></span><span class="op" id="8291539">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="keyword" id="8291542">func</span>&nbsp;<span class="ident" id="8291547">TestVeryLongSparseChunk</span><span class="op" id="8291570">(</span><span class="ident" id="8291571">t</span>&nbsp;<span class="op" id="8291573">*</span><span class="ident" id="8291574">testing</span><span class="op" id="8291581">.</span><span class="ident" id="8291582">T</span><span class="op" id="8291583">)</span>&nbsp;<span class="op" id="8291585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8291588">if</span>&nbsp;<span class="ident" id="8291591">testing</span><span class="op" id="8291598">.</span><span class="ident" id="8291599">Short</span><span class="op" id="8291604">(</span><span class="op" id="8291605">)</span>&nbsp;<span class="op" id="8291607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8291611">t</span><span class="op" id="8291612">.</span><span class="ident" id="8291613">Skip</span><span class="op" id="8291617">(</span><span class="string" id="8291618">&#34;skipping&nbsp;sparse&nbsp;chunk&nbsp;during&nbsp;short&nbsp;test&#34;</span><span class="op" id="8291659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8291662">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8291665">w</span><span class="op" id="8291666">,</span>&nbsp;<span class="ident" id="8291668">err</span>&nbsp;<span class="op" id="8291672">:=</span>&nbsp;<span class="ident" id="8291675">NewWriter</span><span class="op" id="8291684">(</span><span class="ident" id="8291685">ioutil</span><span class="op" id="8291691">.</span><span class="ident" id="8291692">Discard</span><span class="op" id="8291699">,</span>&nbsp;<span class="num" id="8291701">1</span><span class="op" id="8291702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8291705">if</span>&nbsp;<span class="ident" id="8291708">err</span>&nbsp;<span class="op" id="8291712">!=</span>&nbsp;<span class="builtintype" id="8291715">nil</span>&nbsp;<span class="op" id="8291719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8291723">t</span><span class="op" id="8291724">.</span><span class="ident" id="8291725">Errorf</span><span class="op" id="8291731">(</span><span class="string" id="8291732">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="8291747">,</span>&nbsp;<span class="ident" id="8291749">err</span><span class="op" id="8291752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8291756">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8291764">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8291767">if</span>&nbsp;<span class="ident" id="8291770">_</span><span class="op" id="8291771">,</span>&nbsp;<span class="ident" id="8291773">err</span>&nbsp;<span class="op" id="8291777">=</span>&nbsp;<span class="ident" id="8291779">io</span><span class="op" id="8291781">.</span><span class="ident" id="8291782">Copy</span><span class="op" id="8291786">(</span><span class="ident" id="8291787">w</span><span class="op" id="8291788">,</span>&nbsp;<span class="op" id="8291790">&amp;</span><span class="ident" id="8291791">sparseReader</span><span class="op" id="8291803">{</span><span class="ident" id="8291804">l</span><span class="op" id="8291805">:</span>&nbsp;<span class="num" id="8291807">23E8</span><span class="op" id="8291811">}</span><span class="op" id="8291812">)</span><span class="op" id="8291813">;</span>&nbsp;<span class="ident" id="8291815">err</span>&nbsp;<span class="op" id="8291819">!=</span>&nbsp;<span class="builtintype" id="8291822">nil</span>&nbsp;<span class="op" id="8291826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8291830">t</span><span class="op" id="8291831">.</span><span class="ident" id="8291832">Errorf</span><span class="op" id="8291838">(</span><span class="string" id="8291839">&#34;Compress&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8291860">,</span>&nbsp;<span class="ident" id="8291862">err</span><span class="op" id="8291865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8291869">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8291877">}</span><br>
<span class="lineno"></span><span class="op" id="8291879">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span><span class="keyword" id="8291882">type</span>&nbsp;<span class="ident" id="8291887">syncBuffer</span>&nbsp;<span class="keyword" id="8291898">struct</span>&nbsp;<span class="op" id="8291905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8291908">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8291915">bytes</span><span class="op" id="8291920">.</span><span class="ident" id="8291921">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8291929">mu</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8291936">sync</span><span class="op" id="8291940">.</span><span class="ident" id="8291941">RWMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8291950">closed</span>&nbsp;<span class="builtintype" id="8291957">bool</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8291963">ready</span>&nbsp;&nbsp;<span class="keyword" id="8291970">chan</span>&nbsp;<span class="builtintype" id="8291975">bool</span><br>
<span class="lineno"></span><span class="op" id="8291980">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8291983">func</span>&nbsp;<span class="ident" id="8291988">newSyncBuffer</span><span class="op" id="8292001">(</span><span class="op" id="8292002">)</span>&nbsp;<span class="op" id="8292004">*</span><span class="ident" id="8292005">syncBuffer</span>&nbsp;<span class="op" id="8292016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8292019">return</span>&nbsp;<span class="op" id="8292026">&amp;</span><span class="ident" id="8292027">syncBuffer</span><span class="op" id="8292037">{</span><span class="ident" id="8292038">ready</span><span class="op" id="8292043">:</span>&nbsp;<span class="builtinfunc" id="8292045">make</span><span class="op" id="8292049">(</span><span class="keyword" id="8292050">chan</span>&nbsp;<span class="builtintype" id="8292055">bool</span><span class="op" id="8292059">,</span>&nbsp;<span class="num" id="8292061">1</span><span class="op" id="8292062">)</span><span class="op" id="8292063">}</span><br>
<span class="lineno">150</span><span class="op" id="8292065">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8292068">func</span>&nbsp;<span class="op" id="8292073">(</span><span class="ident" id="8292074">b</span>&nbsp;<span class="op" id="8292076">*</span><span class="ident" id="8292077">syncBuffer</span><span class="op" id="8292087">)</span>&nbsp;<span class="ident" id="8292089">Read</span><span class="op" id="8292093">(</span><span class="ident" id="8292094">p</span>&nbsp;<span class="op" id="8292096">[</span><span class="op" id="8292097">]</span><span class="builtintype" id="8292098">byte</span><span class="op" id="8292102">)</span>&nbsp;<span class="op" id="8292104">(</span><span class="ident" id="8292105">n</span>&nbsp;<span class="builtintype" id="8292107">int</span><span class="op" id="8292110">,</span>&nbsp;<span class="ident" id="8292112">err</span>&nbsp;<span class="builtintype" id="8292116">error</span><span class="op" id="8292121">)</span>&nbsp;<span class="op" id="8292123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8292126">for</span>&nbsp;<span class="op" id="8292130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8292134">b</span><span class="op" id="8292135">.</span><span class="ident" id="8292136">mu</span><span class="op" id="8292138">.</span><span class="ident" id="8292139">RLock</span><span class="op" id="8292144">(</span><span class="op" id="8292145">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8292149">n</span><span class="op" id="8292150">,</span>&nbsp;<span class="ident" id="8292152">err</span>&nbsp;<span class="op" id="8292156">=</span>&nbsp;<span class="ident" id="8292158">b</span><span class="op" id="8292159">.</span><span class="ident" id="8292160">buf</span><span class="op" id="8292163">.</span><span class="ident" id="8292164">Read</span><span class="op" id="8292168">(</span><span class="ident" id="8292169">p</span><span class="op" id="8292170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8292174">b</span><span class="op" id="8292175">.</span><span class="ident" id="8292176">mu</span><span class="op" id="8292178">.</span><span class="ident" id="8292179">RUnlock</span><span class="op" id="8292186">(</span><span class="op" id="8292187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8292191">if</span>&nbsp;<span class="ident" id="8292194">n</span>&nbsp;<span class="op" id="8292196">&gt;</span>&nbsp;<span class="num" id="8292198">0</span>&nbsp;<span class="op" id="8292200">||</span>&nbsp;<span class="ident" id="8292203">b</span><span class="op" id="8292204">.</span><span class="ident" id="8292205">closed</span>&nbsp;<span class="op" id="8292212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8292217">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8292226">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8292230">&lt;-</span><span class="ident" id="8292232">b</span><span class="op" id="8292233">.</span><span class="ident" id="8292234">ready</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8292241">}</span><br>
<span class="lineno"></span><span class="op" id="8292243">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8292246">func</span>&nbsp;<span class="op" id="8292251">(</span><span class="ident" id="8292252">b</span>&nbsp;<span class="op" id="8292254">*</span><span class="ident" id="8292255">syncBuffer</span><span class="op" id="8292265">)</span>&nbsp;<span class="ident" id="8292267">signal</span><span class="op" id="8292273">(</span><span class="op" id="8292274">)</span>&nbsp;<span class="op" id="8292276">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8292279">select</span>&nbsp;<span class="op" id="8292286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8292289">case</span>&nbsp;<span class="ident" id="8292294">b</span><span class="op" id="8292295">.</span><span class="ident" id="8292296">ready</span>&nbsp;<span class="op" id="8292302">&lt;-</span>&nbsp;<span class="builtintype" id="8292305">true</span><span class="op" id="8292309">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8292312">default</span><span class="op" id="8292319">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8292322">}</span><br>
<span class="lineno"></span><span class="op" id="8292324">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="8292327">func</span>&nbsp;<span class="op" id="8292332">(</span><span class="ident" id="8292333">b</span>&nbsp;<span class="op" id="8292335">*</span><span class="ident" id="8292336">syncBuffer</span><span class="op" id="8292346">)</span>&nbsp;<span class="ident" id="8292348">Write</span><span class="op" id="8292353">(</span><span class="ident" id="8292354">p</span>&nbsp;<span class="op" id="8292356">[</span><span class="op" id="8292357">]</span><span class="builtintype" id="8292358">byte</span><span class="op" id="8292362">)</span>&nbsp;<span class="op" id="8292364">(</span><span class="ident" id="8292365">n</span>&nbsp;<span class="builtintype" id="8292367">int</span><span class="op" id="8292370">,</span>&nbsp;<span class="ident" id="8292372">err</span>&nbsp;<span class="builtintype" id="8292376">error</span><span class="op" id="8292381">)</span>&nbsp;<span class="op" id="8292383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8292386">n</span><span class="op" id="8292387">,</span>&nbsp;<span class="ident" id="8292389">err</span>&nbsp;<span class="op" id="8292393">=</span>&nbsp;<span class="ident" id="8292395">b</span><span class="op" id="8292396">.</span><span class="ident" id="8292397">buf</span><span class="op" id="8292400">.</span><span class="ident" id="8292401">Write</span><span class="op" id="8292406">(</span><span class="ident" id="8292407">p</span><span class="op" id="8292408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8292411">b</span><span class="op" id="8292412">.</span><span class="ident" id="8292413">signal</span><span class="op" id="8292419">(</span><span class="op" id="8292420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8292423">return</span><br>
<span class="lineno">175</span><span class="op" id="8292430">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8292433">func</span>&nbsp;<span class="op" id="8292438">(</span><span class="ident" id="8292439">b</span>&nbsp;<span class="op" id="8292441">*</span><span class="ident" id="8292442">syncBuffer</span><span class="op" id="8292452">)</span>&nbsp;<span class="ident" id="8292454">WriteMode</span><span class="op" id="8292463">(</span><span class="op" id="8292464">)</span>&nbsp;<span class="op" id="8292466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8292469">b</span><span class="op" id="8292470">.</span><span class="ident" id="8292471">mu</span><span class="op" id="8292473">.</span><span class="ident" id="8292474">Lock</span><span class="op" id="8292478">(</span><span class="op" id="8292479">)</span><br>
<span class="lineno"></span><span class="op" id="8292481">}</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span><span class="keyword" id="8292484">func</span>&nbsp;<span class="op" id="8292489">(</span><span class="ident" id="8292490">b</span>&nbsp;<span class="op" id="8292492">*</span><span class="ident" id="8292493">syncBuffer</span><span class="op" id="8292503">)</span>&nbsp;<span class="ident" id="8292505">ReadMode</span><span class="op" id="8292513">(</span><span class="op" id="8292514">)</span>&nbsp;<span class="op" id="8292516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8292519">b</span><span class="op" id="8292520">.</span><span class="ident" id="8292521">mu</span><span class="op" id="8292523">.</span><span class="ident" id="8292524">Unlock</span><span class="op" id="8292530">(</span><span class="op" id="8292531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8292534">b</span><span class="op" id="8292535">.</span><span class="ident" id="8292536">signal</span><span class="op" id="8292542">(</span><span class="op" id="8292543">)</span><br>
<span class="lineno"></span><span class="op" id="8292545">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span><span class="keyword" id="8292548">func</span>&nbsp;<span class="op" id="8292553">(</span><span class="ident" id="8292554">b</span>&nbsp;<span class="op" id="8292556">*</span><span class="ident" id="8292557">syncBuffer</span><span class="op" id="8292567">)</span>&nbsp;<span class="ident" id="8292569">Close</span><span class="op" id="8292574">(</span><span class="op" id="8292575">)</span>&nbsp;<span class="builtintype" id="8292577">error</span>&nbsp;<span class="op" id="8292583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8292586">b</span><span class="op" id="8292587">.</span><span class="ident" id="8292588">closed</span>&nbsp;<span class="op" id="8292595">=</span>&nbsp;<span class="builtintype" id="8292597">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8292603">b</span><span class="op" id="8292604">.</span><span class="ident" id="8292605">signal</span><span class="op" id="8292611">(</span><span class="op" id="8292612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8292615">return</span>&nbsp;<span class="builtintype" id="8292622">nil</span><br>
<span class="lineno">190</span><span class="op" id="8292626">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8292629">func</span>&nbsp;<span class="ident" id="8292634">testSync</span><span class="op" id="8292642">(</span><span class="ident" id="8292643">t</span>&nbsp;<span class="op" id="8292645">*</span><span class="ident" id="8292646">testing</span><span class="op" id="8292653">.</span><span class="ident" id="8292654">T</span><span class="op" id="8292655">,</span>&nbsp;<span class="ident" id="8292657">level</span>&nbsp;<span class="builtintype" id="8292663">int</span><span class="op" id="8292666">,</span>&nbsp;<span class="ident" id="8292668">input</span>&nbsp;<span class="op" id="8292674">[</span><span class="op" id="8292675">]</span><span class="builtintype" id="8292676">byte</span><span class="op" id="8292680">,</span>&nbsp;<span class="ident" id="8292682">name</span>&nbsp;<span class="builtintype" id="8292687">string</span><span class="op" id="8292693">)</span>&nbsp;<span class="op" id="8292695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8292698">if</span>&nbsp;<span class="builtinfunc" id="8292701">len</span><span class="op" id="8292704">(</span><span class="ident" id="8292705">input</span><span class="op" id="8292710">)</span>&nbsp;<span class="op" id="8292712">==</span>&nbsp;<span class="num" id="8292715">0</span>&nbsp;<span class="op" id="8292717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8292721">return</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8292729">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8292733">t</span><span class="op" id="8292734">.</span><span class="ident" id="8292735">Logf</span><span class="op" id="8292739">(</span><span class="string" id="8292740">&#34;--testSync&nbsp;%d,&nbsp;%d,&nbsp;%s&#34;</span><span class="op" id="8292763">,</span>&nbsp;<span class="ident" id="8292765">level</span><span class="op" id="8292770">,</span>&nbsp;<span class="builtinfunc" id="8292772">len</span><span class="op" id="8292775">(</span><span class="ident" id="8292776">input</span><span class="op" id="8292781">)</span><span class="op" id="8292782">,</span>&nbsp;<span class="ident" id="8292784">name</span><span class="op" id="8292788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8292791">buf</span>&nbsp;<span class="op" id="8292795">:=</span>&nbsp;<span class="ident" id="8292798">newSyncBuffer</span><span class="op" id="8292811">(</span><span class="op" id="8292812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8292815">buf1</span>&nbsp;<span class="op" id="8292820">:=</span>&nbsp;<span class="builtinfunc" id="8292823">new</span><span class="op" id="8292826">(</span><span class="ident" id="8292827">bytes</span><span class="op" id="8292832">.</span><span class="ident" id="8292833">Buffer</span><span class="op" id="8292839">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8292842">buf</span><span class="op" id="8292845">.</span><span class="ident" id="8292846">WriteMode</span><span class="op" id="8292855">(</span><span class="op" id="8292856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8292859">w</span><span class="op" id="8292860">,</span>&nbsp;<span class="ident" id="8292862">err</span>&nbsp;<span class="op" id="8292866">:=</span>&nbsp;<span class="ident" id="8292869">NewWriter</span><span class="op" id="8292878">(</span><span class="ident" id="8292879">io</span><span class="op" id="8292881">.</span><span class="ident" id="8292882">MultiWriter</span><span class="op" id="8292893">(</span><span class="ident" id="8292894">buf</span><span class="op" id="8292897">,</span>&nbsp;<span class="ident" id="8292899">buf1</span><span class="op" id="8292903">)</span><span class="op" id="8292904">,</span>&nbsp;<span class="ident" id="8292906">level</span><span class="op" id="8292911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8292914">if</span>&nbsp;<span class="ident" id="8292917">err</span>&nbsp;<span class="op" id="8292921">!=</span>&nbsp;<span class="builtintype" id="8292924">nil</span>&nbsp;<span class="op" id="8292928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8292932">t</span><span class="op" id="8292933">.</span><span class="ident" id="8292934">Errorf</span><span class="op" id="8292940">(</span><span class="string" id="8292941">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="8292956">,</span>&nbsp;<span class="ident" id="8292958">err</span><span class="op" id="8292961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8292965">return</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8292973">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8292976">r</span>&nbsp;<span class="op" id="8292978">:=</span>&nbsp;<span class="ident" id="8292981">NewReader</span><span class="op" id="8292990">(</span><span class="ident" id="8292991">buf</span><span class="op" id="8292994">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8292998">//&nbsp;Write&nbsp;half&nbsp;the&nbsp;input&nbsp;and&nbsp;read&nbsp;back.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8293038">for</span>&nbsp;<span class="ident" id="8293042">i</span>&nbsp;<span class="op" id="8293044">:=</span>&nbsp;<span class="num" id="8293047">0</span><span class="op" id="8293048">;</span>&nbsp;<span class="ident" id="8293050">i</span>&nbsp;<span class="op" id="8293052">&lt;</span>&nbsp;<span class="num" id="8293054">2</span><span class="op" id="8293055">;</span>&nbsp;<span class="ident" id="8293057">i</span><span class="op" id="8293058">++</span>&nbsp;<span class="op" id="8293061">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8293065">var</span>&nbsp;<span class="ident" id="8293069">lo</span><span class="op" id="8293071">,</span>&nbsp;<span class="ident" id="8293073">hi</span>&nbsp;<span class="builtintype" id="8293076">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8293082">if</span>&nbsp;<span class="ident" id="8293085">i</span>&nbsp;<span class="op" id="8293087">==</span>&nbsp;<span class="num" id="8293090">0</span>&nbsp;<span class="op" id="8293092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8293097">lo</span><span class="op" id="8293099">,</span>&nbsp;<span class="ident" id="8293101">hi</span>&nbsp;<span class="op" id="8293104">=</span>&nbsp;<span class="num" id="8293106">0</span><span class="op" id="8293107">,</span>&nbsp;<span class="op" id="8293109">(</span><span class="builtinfunc" id="8293110">len</span><span class="op" id="8293113">(</span><span class="ident" id="8293114">input</span><span class="op" id="8293119">)</span><span class="op" id="8293120">+</span><span class="num" id="8293121">1</span><span class="op" id="8293122">)</span><span class="op" id="8293123">/</span><span class="num" id="8293124">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8293128">}</span>&nbsp;<span class="keyword" id="8293130">else</span>&nbsp;<span class="op" id="8293135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8293140">lo</span><span class="op" id="8293142">,</span>&nbsp;<span class="ident" id="8293144">hi</span>&nbsp;<span class="op" id="8293147">=</span>&nbsp;<span class="op" id="8293149">(</span><span class="builtinfunc" id="8293150">len</span><span class="op" id="8293153">(</span><span class="ident" id="8293154">input</span><span class="op" id="8293159">)</span><span class="op" id="8293160">+</span><span class="num" id="8293161">1</span><span class="op" id="8293162">)</span><span class="op" id="8293163">/</span><span class="num" id="8293164">2</span><span class="op" id="8293165">,</span>&nbsp;<span class="builtinfunc" id="8293167">len</span><span class="op" id="8293170">(</span><span class="ident" id="8293171">input</span><span class="op" id="8293176">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8293180">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8293184">t</span><span class="op" id="8293185">.</span><span class="ident" id="8293186">Logf</span><span class="op" id="8293190">(</span><span class="string" id="8293191">&#34;#%d:&nbsp;write&nbsp;%d-%d&#34;</span><span class="op" id="8293209">,</span>&nbsp;<span class="ident" id="8293211">i</span><span class="op" id="8293212">,</span>&nbsp;<span class="ident" id="8293214">lo</span><span class="op" id="8293216">,</span>&nbsp;<span class="ident" id="8293218">hi</span><span class="op" id="8293220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8293224">if</span>&nbsp;<span class="ident" id="8293227">_</span><span class="op" id="8293228">,</span>&nbsp;<span class="ident" id="8293230">err</span>&nbsp;<span class="op" id="8293234">:=</span>&nbsp;<span class="ident" id="8293237">w</span><span class="op" id="8293238">.</span><span class="ident" id="8293239">Write</span><span class="op" id="8293244">(</span><span class="ident" id="8293245">input</span><span class="op" id="8293250">[</span><span class="ident" id="8293251">lo</span><span class="op" id="8293253">:</span><span class="ident" id="8293254">hi</span><span class="op" id="8293256">]</span><span class="op" id="8293257">)</span><span class="op" id="8293258">;</span>&nbsp;<span class="ident" id="8293260">err</span>&nbsp;<span class="op" id="8293264">!=</span>&nbsp;<span class="builtintype" id="8293267">nil</span>&nbsp;<span class="op" id="8293271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8293276">t</span><span class="op" id="8293277">.</span><span class="ident" id="8293278">Errorf</span><span class="op" id="8293284">(</span><span class="string" id="8293285">&#34;testSync:&nbsp;write:&nbsp;%v&#34;</span><span class="op" id="8293306">,</span>&nbsp;<span class="ident" id="8293308">err</span><span class="op" id="8293311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8293316">return</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8293325">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8293329">if</span>&nbsp;<span class="ident" id="8293332">i</span>&nbsp;<span class="op" id="8293334">==</span>&nbsp;<span class="num" id="8293337">0</span>&nbsp;<span class="op" id="8293339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8293344">if</span>&nbsp;<span class="ident" id="8293347">err</span>&nbsp;<span class="op" id="8293351">:=</span>&nbsp;<span class="ident" id="8293354">w</span><span class="op" id="8293355">.</span><span class="ident" id="8293356">Flush</span><span class="op" id="8293361">(</span><span class="op" id="8293362">)</span><span class="op" id="8293363">;</span>&nbsp;<span class="ident" id="8293365">err</span>&nbsp;<span class="op" id="8293369">!=</span>&nbsp;<span class="builtintype" id="8293372">nil</span>&nbsp;<span class="op" id="8293376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8293382">t</span><span class="op" id="8293383">.</span><span class="ident" id="8293384">Errorf</span><span class="op" id="8293390">(</span><span class="string" id="8293391">&#34;testSync:&nbsp;flush:&nbsp;%v&#34;</span><span class="op" id="8293412">,</span>&nbsp;<span class="ident" id="8293414">err</span><span class="op" id="8293417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8293423">return</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8293433">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8293437">}</span>&nbsp;<span class="keyword" id="8293439">else</span>&nbsp;<span class="op" id="8293444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8293449">if</span>&nbsp;<span class="ident" id="8293452">err</span>&nbsp;<span class="op" id="8293456">:=</span>&nbsp;<span class="ident" id="8293459">w</span><span class="op" id="8293460">.</span><span class="ident" id="8293461">Close</span><span class="op" id="8293466">(</span><span class="op" id="8293467">)</span><span class="op" id="8293468">;</span>&nbsp;<span class="ident" id="8293470">err</span>&nbsp;<span class="op" id="8293474">!=</span>&nbsp;<span class="builtintype" id="8293477">nil</span>&nbsp;<span class="op" id="8293481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8293487">t</span><span class="op" id="8293488">.</span><span class="ident" id="8293489">Errorf</span><span class="op" id="8293495">(</span><span class="string" id="8293496">&#34;testSync:&nbsp;close:&nbsp;%v&#34;</span><span class="op" id="8293517">,</span>&nbsp;<span class="ident" id="8293519">err</span><span class="op" id="8293522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8293527">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8293531">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8293535">buf</span><span class="op" id="8293538">.</span><span class="ident" id="8293539">ReadMode</span><span class="op" id="8293547">(</span><span class="op" id="8293548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8293552">out</span>&nbsp;<span class="op" id="8293556">:=</span>&nbsp;<span class="builtinfunc" id="8293559">make</span><span class="op" id="8293563">(</span><span class="op" id="8293564">[</span><span class="op" id="8293565">]</span><span class="builtintype" id="8293566">byte</span><span class="op" id="8293570">,</span>&nbsp;<span class="ident" id="8293572">hi</span><span class="op" id="8293574">-</span><span class="ident" id="8293575">lo</span><span class="op" id="8293577">+</span><span class="num" id="8293578">1</span><span class="op" id="8293579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8293583">m</span><span class="op" id="8293584">,</span>&nbsp;<span class="ident" id="8293586">err</span>&nbsp;<span class="op" id="8293590">:=</span>&nbsp;<span class="ident" id="8293593">io</span><span class="op" id="8293595">.</span><span class="ident" id="8293596">ReadAtLeast</span><span class="op" id="8293607">(</span><span class="ident" id="8293608">r</span><span class="op" id="8293609">,</span>&nbsp;<span class="ident" id="8293611">out</span><span class="op" id="8293614">,</span>&nbsp;<span class="ident" id="8293616">hi</span><span class="op" id="8293618">-</span><span class="ident" id="8293619">lo</span><span class="op" id="8293621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8293625">t</span><span class="op" id="8293626">.</span><span class="ident" id="8293627">Logf</span><span class="op" id="8293631">(</span><span class="string" id="8293632">&#34;#%d:&nbsp;read&nbsp;%d&#34;</span><span class="op" id="8293646">,</span>&nbsp;<span class="ident" id="8293648">i</span><span class="op" id="8293649">,</span>&nbsp;<span class="ident" id="8293651">m</span><span class="op" id="8293652">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8293656">if</span>&nbsp;<span class="ident" id="8293659">m</span>&nbsp;<span class="op" id="8293661">!=</span>&nbsp;<span class="ident" id="8293664">hi</span><span class="op" id="8293666">-</span><span class="ident" id="8293667">lo</span>&nbsp;<span class="op" id="8293670">||</span>&nbsp;<span class="ident" id="8293673">err</span>&nbsp;<span class="op" id="8293677">!=</span>&nbsp;<span class="builtintype" id="8293680">nil</span>&nbsp;<span class="op" id="8293684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8293689">t</span><span class="op" id="8293690">.</span><span class="ident" id="8293691">Errorf</span><span class="op" id="8293697">(</span><span class="string" id="8293698">&#34;testSync/%d&nbsp;(%d,&nbsp;%d,&nbsp;%s):&nbsp;read&nbsp;%d:&nbsp;%d,&nbsp;%v&nbsp;(%d&nbsp;left)&#34;</span><span class="op" id="8293751">,</span>&nbsp;<span class="ident" id="8293753">i</span><span class="op" id="8293754">,</span>&nbsp;<span class="ident" id="8293756">level</span><span class="op" id="8293761">,</span>&nbsp;<span class="builtinfunc" id="8293763">len</span><span class="op" id="8293766">(</span><span class="ident" id="8293767">input</span><span class="op" id="8293772">)</span><span class="op" id="8293773">,</span>&nbsp;<span class="ident" id="8293775">name</span><span class="op" id="8293779">,</span>&nbsp;<span class="ident" id="8293781">hi</span><span class="op" id="8293783">-</span><span class="ident" id="8293784">lo</span><span class="op" id="8293786">,</span>&nbsp;<span class="ident" id="8293788">m</span><span class="op" id="8293789">,</span>&nbsp;<span class="ident" id="8293791">err</span><span class="op" id="8293794">,</span>&nbsp;<span class="ident" id="8293796">buf</span><span class="op" id="8293799">.</span><span class="ident" id="8293800">buf</span><span class="op" id="8293803">.</span><span class="ident" id="8293804">Len</span><span class="op" id="8293807">(</span><span class="op" id="8293808">)</span><span class="op" id="8293809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8293814">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8293823">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8293827">if</span>&nbsp;<span class="op" id="8293830">!</span><span class="ident" id="8293831">bytes</span><span class="op" id="8293836">.</span><span class="ident" id="8293837">Equal</span><span class="op" id="8293842">(</span><span class="ident" id="8293843">input</span><span class="op" id="8293848">[</span><span class="ident" id="8293849">lo</span><span class="op" id="8293851">:</span><span class="ident" id="8293852">hi</span><span class="op" id="8293854">]</span><span class="op" id="8293855">,</span>&nbsp;<span class="ident" id="8293857">out</span><span class="op" id="8293860">[</span><span class="op" id="8293861">:</span><span class="ident" id="8293862">hi</span><span class="op" id="8293864">-</span><span class="ident" id="8293865">lo</span><span class="op" id="8293867">]</span><span class="op" id="8293868">)</span>&nbsp;<span class="op" id="8293870">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8293875">t</span><span class="op" id="8293876">.</span><span class="ident" id="8293877">Errorf</span><span class="op" id="8293883">(</span><span class="string" id="8293884">&#34;testSync/%d:&nbsp;read&nbsp;wrong&nbsp;bytes:&nbsp;%x&nbsp;vs&nbsp;%x&#34;</span><span class="op" id="8293925">,</span>&nbsp;<span class="ident" id="8293927">i</span><span class="op" id="8293928">,</span>&nbsp;<span class="ident" id="8293930">input</span><span class="op" id="8293935">[</span><span class="ident" id="8293936">lo</span><span class="op" id="8293938">:</span><span class="ident" id="8293939">hi</span><span class="op" id="8293941">]</span><span class="op" id="8293942">,</span>&nbsp;<span class="ident" id="8293944">out</span><span class="op" id="8293947">[</span><span class="op" id="8293948">:</span><span class="ident" id="8293949">hi</span><span class="op" id="8293951">-</span><span class="ident" id="8293952">lo</span><span class="op" id="8293954">]</span><span class="op" id="8293955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8293960">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8293969">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8293973">//&nbsp;This&nbsp;test&nbsp;originally&nbsp;checked&nbsp;that&nbsp;after&nbsp;reading</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8294026">//&nbsp;the&nbsp;first&nbsp;half&nbsp;of&nbsp;the&nbsp;input,&nbsp;there&nbsp;was&nbsp;nothing&nbsp;left</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8294083">//&nbsp;in&nbsp;the&nbsp;read&nbsp;buffer&nbsp;(buf.buf.Len()&nbsp;!=&nbsp;0)&nbsp;but&nbsp;that&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8294140">//&nbsp;not&nbsp;necessarily&nbsp;the&nbsp;case:&nbsp;the&nbsp;write&nbsp;Flush&nbsp;may&nbsp;emit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8294196">//&nbsp;some&nbsp;extra&nbsp;framing&nbsp;bits&nbsp;that&nbsp;are&nbsp;not&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8294248">//&nbsp;to&nbsp;process&nbsp;to&nbsp;obtain&nbsp;the&nbsp;first&nbsp;half&nbsp;of&nbsp;the&nbsp;uncompressed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8294309">//&nbsp;data.&nbsp;&nbsp;The&nbsp;test&nbsp;ran&nbsp;correctly&nbsp;most&nbsp;of&nbsp;the&nbsp;time,&nbsp;because</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8294370">//&nbsp;the&nbsp;background&nbsp;goroutine&nbsp;had&nbsp;usually&nbsp;read&nbsp;even</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8294422">//&nbsp;those&nbsp;extra&nbsp;bits&nbsp;by&nbsp;now,&nbsp;but&nbsp;it&#39;s&nbsp;not&nbsp;a&nbsp;useful&nbsp;thing&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8294483">//&nbsp;check.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8294495">buf</span><span class="op" id="8294498">.</span><span class="ident" id="8294499">WriteMode</span><span class="op" id="8294508">(</span><span class="op" id="8294509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8294512">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8294515">buf</span><span class="op" id="8294518">.</span><span class="ident" id="8294519">ReadMode</span><span class="op" id="8294527">(</span><span class="op" id="8294528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8294531">out</span>&nbsp;<span class="op" id="8294535">:=</span>&nbsp;<span class="builtinfunc" id="8294538">make</span><span class="op" id="8294542">(</span><span class="op" id="8294543">[</span><span class="op" id="8294544">]</span><span class="builtintype" id="8294545">byte</span><span class="op" id="8294549">,</span>&nbsp;<span class="num" id="8294551">10</span><span class="op" id="8294553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8294556">if</span>&nbsp;<span class="ident" id="8294559">n</span><span class="op" id="8294560">,</span>&nbsp;<span class="ident" id="8294562">err</span>&nbsp;<span class="op" id="8294566">:=</span>&nbsp;<span class="ident" id="8294569">r</span><span class="op" id="8294570">.</span><span class="ident" id="8294571">Read</span><span class="op" id="8294575">(</span><span class="ident" id="8294576">out</span><span class="op" id="8294579">)</span><span class="op" id="8294580">;</span>&nbsp;<span class="ident" id="8294582">n</span>&nbsp;<span class="op" id="8294584">&gt;</span>&nbsp;<span class="num" id="8294586">0</span>&nbsp;<span class="op" id="8294588">||</span>&nbsp;<span class="ident" id="8294591">err</span>&nbsp;<span class="op" id="8294595">!=</span>&nbsp;<span class="ident" id="8294598">io</span><span class="op" id="8294600">.</span><span class="ident" id="8294601">EOF</span>&nbsp;<span class="op" id="8294605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8294609">t</span><span class="op" id="8294610">.</span><span class="ident" id="8294611">Errorf</span><span class="op" id="8294617">(</span><span class="string" id="8294618">&#34;testSync&nbsp;(%d,&nbsp;%d,&nbsp;%s):&nbsp;final&nbsp;Read:&nbsp;%d,&nbsp;%v&nbsp;(hex:&nbsp;%x)&#34;</span><span class="op" id="8294671">,</span>&nbsp;<span class="ident" id="8294673">level</span><span class="op" id="8294678">,</span>&nbsp;<span class="builtinfunc" id="8294680">len</span><span class="op" id="8294683">(</span><span class="ident" id="8294684">input</span><span class="op" id="8294689">)</span><span class="op" id="8294690">,</span>&nbsp;<span class="ident" id="8294692">name</span><span class="op" id="8294696">,</span>&nbsp;<span class="ident" id="8294698">n</span><span class="op" id="8294699">,</span>&nbsp;<span class="ident" id="8294701">err</span><span class="op" id="8294704">,</span>&nbsp;<span class="ident" id="8294706">out</span><span class="op" id="8294709">[</span><span class="num" id="8294710">0</span><span class="op" id="8294711">:</span><span class="ident" id="8294712">n</span><span class="op" id="8294713">]</span><span class="op" id="8294714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8294717">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8294720">if</span>&nbsp;<span class="ident" id="8294723">buf</span><span class="op" id="8294726">.</span><span class="ident" id="8294727">buf</span><span class="op" id="8294730">.</span><span class="ident" id="8294731">Len</span><span class="op" id="8294734">(</span><span class="op" id="8294735">)</span>&nbsp;<span class="op" id="8294737">!=</span>&nbsp;<span class="num" id="8294740">0</span>&nbsp;<span class="op" id="8294742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8294746">t</span><span class="op" id="8294747">.</span><span class="ident" id="8294748">Errorf</span><span class="op" id="8294754">(</span><span class="string" id="8294755">&#34;testSync&nbsp;(%d,&nbsp;%d,&nbsp;%s):&nbsp;extra&nbsp;data&nbsp;at&nbsp;end&#34;</span><span class="op" id="8294797">,</span>&nbsp;<span class="ident" id="8294799">level</span><span class="op" id="8294804">,</span>&nbsp;<span class="builtinfunc" id="8294806">len</span><span class="op" id="8294809">(</span><span class="ident" id="8294810">input</span><span class="op" id="8294815">)</span><span class="op" id="8294816">,</span>&nbsp;<span class="ident" id="8294818">name</span><span class="op" id="8294822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8294825">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8294828">r</span><span class="op" id="8294829">.</span><span class="ident" id="8294830">Close</span><span class="op" id="8294835">(</span><span class="op" id="8294836">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8294840">//&nbsp;stream&nbsp;should&nbsp;work&nbsp;for&nbsp;ordinary&nbsp;reader&nbsp;too</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8294887">r</span>&nbsp;<span class="op" id="8294889">=</span>&nbsp;<span class="ident" id="8294891">NewReader</span><span class="op" id="8294900">(</span><span class="ident" id="8294901">buf1</span><span class="op" id="8294905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8294908">out</span><span class="op" id="8294911">,</span>&nbsp;<span class="ident" id="8294913">err</span>&nbsp;<span class="op" id="8294917">=</span>&nbsp;<span class="ident" id="8294919">ioutil</span><span class="op" id="8294925">.</span><span class="ident" id="8294926">ReadAll</span><span class="op" id="8294933">(</span><span class="ident" id="8294934">r</span><span class="op" id="8294935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8294938">if</span>&nbsp;<span class="ident" id="8294941">err</span>&nbsp;<span class="op" id="8294945">!=</span>&nbsp;<span class="builtintype" id="8294948">nil</span>&nbsp;<span class="op" id="8294952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8294956">t</span><span class="op" id="8294957">.</span><span class="ident" id="8294958">Errorf</span><span class="op" id="8294964">(</span><span class="string" id="8294965">&#34;testSync:&nbsp;read:&nbsp;%s&#34;</span><span class="op" id="8294985">,</span>&nbsp;<span class="ident" id="8294987">err</span><span class="op" id="8294990">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8294994">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8295002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8295005">r</span><span class="op" id="8295006">.</span><span class="ident" id="8295007">Close</span><span class="op" id="8295012">(</span><span class="op" id="8295013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8295016">if</span>&nbsp;<span class="op" id="8295019">!</span><span class="ident" id="8295020">bytes</span><span class="op" id="8295025">.</span><span class="ident" id="8295026">Equal</span><span class="op" id="8295031">(</span><span class="ident" id="8295032">input</span><span class="op" id="8295037">,</span>&nbsp;<span class="ident" id="8295039">out</span><span class="op" id="8295042">)</span>&nbsp;<span class="op" id="8295044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8295048">t</span><span class="op" id="8295049">.</span><span class="ident" id="8295050">Errorf</span><span class="op" id="8295056">(</span><span class="string" id="8295057">&#34;testSync:&nbsp;decompress(compress(data))&nbsp;!=&nbsp;data:&nbsp;level=%d&nbsp;input=%s&#34;</span><span class="op" id="8295122">,</span>&nbsp;<span class="ident" id="8295124">level</span><span class="op" id="8295129">,</span>&nbsp;<span class="ident" id="8295131">name</span><span class="op" id="8295135">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8295138">}</span><br>
<span class="lineno"></span><span class="op" id="8295140">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8295143">func</span>&nbsp;<span class="ident" id="8295148">testToFromWithLevelAndLimit</span><span class="op" id="8295175">(</span><span class="ident" id="8295176">t</span>&nbsp;<span class="op" id="8295178">*</span><span class="ident" id="8295179">testing</span><span class="op" id="8295186">.</span><span class="ident" id="8295187">T</span><span class="op" id="8295188">,</span>&nbsp;<span class="ident" id="8295190">level</span>&nbsp;<span class="builtintype" id="8295196">int</span><span class="op" id="8295199">,</span>&nbsp;<span class="ident" id="8295201">input</span>&nbsp;<span class="op" id="8295207">[</span><span class="op" id="8295208">]</span><span class="builtintype" id="8295209">byte</span><span class="op" id="8295213">,</span>&nbsp;<span class="ident" id="8295215">name</span>&nbsp;<span class="builtintype" id="8295220">string</span><span class="op" id="8295226">,</span>&nbsp;<span class="ident" id="8295228">limit</span>&nbsp;<span class="builtintype" id="8295234">int</span><span class="op" id="8295237">)</span>&nbsp;<span class="op" id="8295239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8295242">var</span>&nbsp;<span class="ident" id="8295246">buffer</span>&nbsp;<span class="ident" id="8295253">bytes</span><span class="op" id="8295258">.</span><span class="ident" id="8295259">Buffer</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8295267">w</span><span class="op" id="8295268">,</span>&nbsp;<span class="ident" id="8295270">err</span>&nbsp;<span class="op" id="8295274">:=</span>&nbsp;<span class="ident" id="8295277">NewWriter</span><span class="op" id="8295286">(</span><span class="op" id="8295287">&amp;</span><span class="ident" id="8295288">buffer</span><span class="op" id="8295294">,</span>&nbsp;<span class="ident" id="8295296">level</span><span class="op" id="8295301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8295304">if</span>&nbsp;<span class="ident" id="8295307">err</span>&nbsp;<span class="op" id="8295311">!=</span>&nbsp;<span class="builtintype" id="8295314">nil</span>&nbsp;<span class="op" id="8295318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8295322">t</span><span class="op" id="8295323">.</span><span class="ident" id="8295324">Errorf</span><span class="op" id="8295330">(</span><span class="string" id="8295331">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="8295346">,</span>&nbsp;<span class="ident" id="8295348">err</span><span class="op" id="8295351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8295355">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8295363">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8295366">w</span><span class="op" id="8295367">.</span><span class="ident" id="8295368">Write</span><span class="op" id="8295373">(</span><span class="ident" id="8295374">input</span><span class="op" id="8295379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8295382">w</span><span class="op" id="8295383">.</span><span class="ident" id="8295384">Close</span><span class="op" id="8295389">(</span><span class="op" id="8295390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8295393">if</span>&nbsp;<span class="ident" id="8295396">limit</span>&nbsp;<span class="op" id="8295402">&gt;</span>&nbsp;<span class="num" id="8295404">0</span>&nbsp;<span class="op" id="8295406">&amp;&amp;</span>&nbsp;<span class="ident" id="8295409">buffer</span><span class="op" id="8295415">.</span><span class="ident" id="8295416">Len</span><span class="op" id="8295419">(</span><span class="op" id="8295420">)</span>&nbsp;<span class="op" id="8295422">&gt;</span>&nbsp;<span class="ident" id="8295424">limit</span>&nbsp;<span class="op" id="8295430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8295434">t</span><span class="op" id="8295435">.</span><span class="ident" id="8295436">Errorf</span><span class="op" id="8295442">(</span><span class="string" id="8295443">&#34;level:&nbsp;%d,&nbsp;len(compress(data))&nbsp;=&nbsp;%d&nbsp;&gt;&nbsp;limit&nbsp;=&nbsp;%d&#34;</span><span class="op" id="8295493">,</span>&nbsp;<span class="ident" id="8295495">level</span><span class="op" id="8295500">,</span>&nbsp;<span class="ident" id="8295502">buffer</span><span class="op" id="8295508">.</span><span class="ident" id="8295509">Len</span><span class="op" id="8295512">(</span><span class="op" id="8295513">)</span><span class="op" id="8295514">,</span>&nbsp;<span class="ident" id="8295516">limit</span><span class="op" id="8295521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8295525">return</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8295533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8295536">r</span>&nbsp;<span class="op" id="8295538">:=</span>&nbsp;<span class="ident" id="8295541">NewReader</span><span class="op" id="8295550">(</span><span class="op" id="8295551">&amp;</span><span class="ident" id="8295552">buffer</span><span class="op" id="8295558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8295561">out</span><span class="op" id="8295564">,</span>&nbsp;<span class="ident" id="8295566">err</span>&nbsp;<span class="op" id="8295570">:=</span>&nbsp;<span class="ident" id="8295573">ioutil</span><span class="op" id="8295579">.</span><span class="ident" id="8295580">ReadAll</span><span class="op" id="8295587">(</span><span class="ident" id="8295588">r</span><span class="op" id="8295589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8295592">if</span>&nbsp;<span class="ident" id="8295595">err</span>&nbsp;<span class="op" id="8295599">!=</span>&nbsp;<span class="builtintype" id="8295602">nil</span>&nbsp;<span class="op" id="8295606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8295610">t</span><span class="op" id="8295611">.</span><span class="ident" id="8295612">Errorf</span><span class="op" id="8295618">(</span><span class="string" id="8295619">&#34;read:&nbsp;%s&#34;</span><span class="op" id="8295629">,</span>&nbsp;<span class="ident" id="8295631">err</span><span class="op" id="8295634">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8295638">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8295646">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8295649">r</span><span class="op" id="8295650">.</span><span class="ident" id="8295651">Close</span><span class="op" id="8295656">(</span><span class="op" id="8295657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8295660">if</span>&nbsp;<span class="op" id="8295663">!</span><span class="ident" id="8295664">bytes</span><span class="op" id="8295669">.</span><span class="ident" id="8295670">Equal</span><span class="op" id="8295675">(</span><span class="ident" id="8295676">input</span><span class="op" id="8295681">,</span>&nbsp;<span class="ident" id="8295683">out</span><span class="op" id="8295686">)</span>&nbsp;<span class="op" id="8295688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8295692">t</span><span class="op" id="8295693">.</span><span class="ident" id="8295694">Errorf</span><span class="op" id="8295700">(</span><span class="string" id="8295701">&#34;decompress(compress(data))&nbsp;!=&nbsp;data:&nbsp;level=%d&nbsp;input=%s&#34;</span><span class="op" id="8295756">,</span>&nbsp;<span class="ident" id="8295758">level</span><span class="op" id="8295763">,</span>&nbsp;<span class="ident" id="8295765">name</span><span class="op" id="8295769">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8295773">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8295781">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8295784">testSync</span><span class="op" id="8295792">(</span><span class="ident" id="8295793">t</span><span class="op" id="8295794">,</span>&nbsp;<span class="ident" id="8295796">level</span><span class="op" id="8295801">,</span>&nbsp;<span class="ident" id="8295803">input</span><span class="op" id="8295808">,</span>&nbsp;<span class="ident" id="8295810">name</span><span class="op" id="8295814">)</span><br>
<span class="lineno"></span><span class="op" id="8295816">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span><span class="keyword" id="8295819">func</span>&nbsp;<span class="ident" id="8295824">testToFromWithLimit</span><span class="op" id="8295843">(</span><span class="ident" id="8295844">t</span>&nbsp;<span class="op" id="8295846">*</span><span class="ident" id="8295847">testing</span><span class="op" id="8295854">.</span><span class="ident" id="8295855">T</span><span class="op" id="8295856">,</span>&nbsp;<span class="ident" id="8295858">input</span>&nbsp;<span class="op" id="8295864">[</span><span class="op" id="8295865">]</span><span class="builtintype" id="8295866">byte</span><span class="op" id="8295870">,</span>&nbsp;<span class="ident" id="8295872">name</span>&nbsp;<span class="builtintype" id="8295877">string</span><span class="op" id="8295883">,</span>&nbsp;<span class="ident" id="8295885">limit</span>&nbsp;<span class="op" id="8295891">[</span><span class="num" id="8295892">10</span><span class="op" id="8295894">]</span><span class="builtintype" id="8295895">int</span><span class="op" id="8295898">)</span>&nbsp;<span class="op" id="8295900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8295903">for</span>&nbsp;<span class="ident" id="8295907">i</span>&nbsp;<span class="op" id="8295909">:=</span>&nbsp;<span class="num" id="8295912">0</span><span class="op" id="8295913">;</span>&nbsp;<span class="ident" id="8295915">i</span>&nbsp;<span class="op" id="8295917">&lt;</span>&nbsp;<span class="num" id="8295919">10</span><span class="op" id="8295921">;</span>&nbsp;<span class="ident" id="8295923">i</span><span class="op" id="8295924">++</span>&nbsp;<span class="op" id="8295927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8295931">testToFromWithLevelAndLimit</span><span class="op" id="8295958">(</span><span class="ident" id="8295959">t</span><span class="op" id="8295960">,</span>&nbsp;<span class="ident" id="8295962">i</span><span class="op" id="8295963">,</span>&nbsp;<span class="ident" id="8295965">input</span><span class="op" id="8295970">,</span>&nbsp;<span class="ident" id="8295972">name</span><span class="op" id="8295976">,</span>&nbsp;<span class="ident" id="8295978">limit</span><span class="op" id="8295983">[</span><span class="ident" id="8295984">i</span><span class="op" id="8295985">]</span><span class="op" id="8295986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8295989">}</span><br>
<span class="lineno"></span><span class="op" id="8295991">}</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span><span class="keyword" id="8295994">func</span>&nbsp;<span class="ident" id="8295999">TestDeflateInflate</span><span class="op" id="8296017">(</span><span class="ident" id="8296018">t</span>&nbsp;<span class="op" id="8296020">*</span><span class="ident" id="8296021">testing</span><span class="op" id="8296028">.</span><span class="ident" id="8296029">T</span><span class="op" id="8296030">)</span>&nbsp;<span class="op" id="8296032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8296035">for</span>&nbsp;<span class="ident" id="8296039">i</span><span class="op" id="8296040">,</span>&nbsp;<span class="ident" id="8296042">h</span>&nbsp;<span class="op" id="8296044">:=</span>&nbsp;<span class="keyword" id="8296047">range</span>&nbsp;<span class="ident" id="8296053">deflateInflateTests</span>&nbsp;<span class="op" id="8296073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8296077">testToFromWithLimit</span><span class="op" id="8296096">(</span><span class="ident" id="8296097">t</span><span class="op" id="8296098">,</span>&nbsp;<span class="ident" id="8296100">h</span><span class="op" id="8296101">.</span><span class="ident" id="8296102">in</span><span class="op" id="8296104">,</span>&nbsp;<span class="ident" id="8296106">fmt</span><span class="op" id="8296109">.</span><span class="ident" id="8296110">Sprintf</span><span class="op" id="8296117">(</span><span class="string" id="8296118">&#34;#%d&#34;</span><span class="op" id="8296123">,</span>&nbsp;<span class="ident" id="8296125">i</span><span class="op" id="8296126">)</span><span class="op" id="8296127">,</span>&nbsp;<span class="op" id="8296129">[</span><span class="num" id="8296130">10</span><span class="op" id="8296132">]</span><span class="builtintype" id="8296133">int</span><span class="op" id="8296136">{</span><span class="op" id="8296137">}</span><span class="op" id="8296138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8296141">}</span><br>
<span class="lineno">315</span><span class="op" id="8296143">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8296146">func</span>&nbsp;<span class="ident" id="8296151">TestReverseBits</span><span class="op" id="8296166">(</span><span class="ident" id="8296167">t</span>&nbsp;<span class="op" id="8296169">*</span><span class="ident" id="8296170">testing</span><span class="op" id="8296177">.</span><span class="ident" id="8296178">T</span><span class="op" id="8296179">)</span>&nbsp;<span class="op" id="8296181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8296184">for</span>&nbsp;<span class="ident" id="8296188">_</span><span class="op" id="8296189">,</span>&nbsp;<span class="ident" id="8296191">h</span>&nbsp;<span class="op" id="8296193">:=</span>&nbsp;<span class="keyword" id="8296196">range</span>&nbsp;<span class="ident" id="8296202">reverseBitsTests</span>&nbsp;<span class="op" id="8296219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8296223">if</span>&nbsp;<span class="ident" id="8296226">v</span>&nbsp;<span class="op" id="8296228">:=</span>&nbsp;<span class="ident" id="8296231">reverseBits</span><span class="op" id="8296242">(</span><span class="ident" id="8296243">h</span><span class="op" id="8296244">.</span><span class="ident" id="8296245">in</span><span class="op" id="8296247">,</span>&nbsp;<span class="ident" id="8296249">h</span><span class="op" id="8296250">.</span><span class="ident" id="8296251">bitCount</span><span class="op" id="8296259">)</span><span class="op" id="8296260">;</span>&nbsp;<span class="ident" id="8296262">v</span>&nbsp;<span class="op" id="8296264">!=</span>&nbsp;<span class="ident" id="8296267">h</span><span class="op" id="8296268">.</span><span class="ident" id="8296269">out</span>&nbsp;<span class="op" id="8296273">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8296278">t</span><span class="op" id="8296279">.</span><span class="ident" id="8296280">Errorf</span><span class="op" id="8296286">(</span><span class="string" id="8296287">&#34;reverseBits(%v,%v)&nbsp;=&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="8296321">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8296327">h</span><span class="op" id="8296328">.</span><span class="ident" id="8296329">in</span><span class="op" id="8296331">,</span>&nbsp;<span class="ident" id="8296333">h</span><span class="op" id="8296334">.</span><span class="ident" id="8296335">bitCount</span><span class="op" id="8296343">,</span>&nbsp;<span class="ident" id="8296345">v</span><span class="op" id="8296346">,</span>&nbsp;<span class="ident" id="8296348">h</span><span class="op" id="8296349">.</span><span class="ident" id="8296350">out</span><span class="op" id="8296353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8296357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8296360">}</span><br>
<span class="lineno"></span><span class="op" id="8296362">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="keyword" id="8296365">type</span>&nbsp;<span class="ident" id="8296370">deflateInflateStringTest</span>&nbsp;<span class="keyword" id="8296395">struct</span>&nbsp;<span class="op" id="8296402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8296405">filename</span>&nbsp;<span class="builtintype" id="8296414">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8296422">label</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8296431">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8296439">limit</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8296448">[</span><span class="num" id="8296449">10</span><span class="op" id="8296451">]</span><span class="builtintype" id="8296452">int</span><br>
<span class="lineno">330</span><span class="op" id="8296456">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8296459">var</span>&nbsp;<span class="ident" id="8296463">deflateInflateStringTests</span>&nbsp;<span class="op" id="8296489">=</span>&nbsp;<span class="op" id="8296491">[</span><span class="op" id="8296492">]</span><span class="ident" id="8296493">deflateInflateStringTest</span><span class="op" id="8296517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8296520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8296524">&#34;../testdata/e.txt&#34;</span><span class="op" id="8296543">,</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8296547">&#34;2.718281828...&#34;</span><span class="op" id="8296563">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8296567">[</span><span class="op" id="8296568">...</span><span class="op" id="8296571">]</span><span class="builtintype" id="8296572">int</span><span class="op" id="8296575">{</span><span class="num" id="8296576">100018</span><span class="op" id="8296582">,</span>&nbsp;<span class="num" id="8296584">50650</span><span class="op" id="8296589">,</span>&nbsp;<span class="num" id="8296591">50960</span><span class="op" id="8296596">,</span>&nbsp;<span class="num" id="8296598">51150</span><span class="op" id="8296603">,</span>&nbsp;<span class="num" id="8296605">50930</span><span class="op" id="8296610">,</span>&nbsp;<span class="num" id="8296612">50790</span><span class="op" id="8296617">,</span>&nbsp;<span class="num" id="8296619">50790</span><span class="op" id="8296624">,</span>&nbsp;<span class="num" id="8296626">50790</span><span class="op" id="8296631">,</span>&nbsp;<span class="num" id="8296633">50790</span><span class="op" id="8296638">,</span>&nbsp;<span class="num" id="8296640">50790</span><span class="op" id="8296645">}</span><span class="op" id="8296646">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8296649">}</span><span class="op" id="8296650">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8296653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8296657">&#34;../testdata/Mark.Twain-Tom.Sawyer.txt&#34;</span><span class="op" id="8296696">,</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8296700">&#34;Mark.Twain-Tom.Sawyer&#34;</span><span class="op" id="8296723">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8296727">[</span><span class="op" id="8296728">...</span><span class="op" id="8296731">]</span><span class="builtintype" id="8296732">int</span><span class="op" id="8296735">{</span><span class="num" id="8296736">407330</span><span class="op" id="8296742">,</span>&nbsp;<span class="num" id="8296744">187598</span><span class="op" id="8296750">,</span>&nbsp;<span class="num" id="8296752">180361</span><span class="op" id="8296758">,</span>&nbsp;<span class="num" id="8296760">172974</span><span class="op" id="8296766">,</span>&nbsp;<span class="num" id="8296768">169160</span><span class="op" id="8296774">,</span>&nbsp;<span class="num" id="8296776">163476</span><span class="op" id="8296782">,</span>&nbsp;<span class="num" id="8296784">160936</span><span class="op" id="8296790">,</span>&nbsp;<span class="num" id="8296792">160506</span><span class="op" id="8296798">,</span>&nbsp;<span class="num" id="8296800">160295</span><span class="op" id="8296806">,</span>&nbsp;<span class="num" id="8296808">160295</span><span class="op" id="8296814">}</span><span class="op" id="8296815">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8296818">}</span><span class="op" id="8296819">,</span><br>
<span class="lineno"></span><span class="op" id="8296821">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span><span class="keyword" id="8296824">func</span>&nbsp;<span class="ident" id="8296829">TestDeflateInflateString</span><span class="op" id="8296853">(</span><span class="ident" id="8296854">t</span>&nbsp;<span class="op" id="8296856">*</span><span class="ident" id="8296857">testing</span><span class="op" id="8296864">.</span><span class="ident" id="8296865">T</span><span class="op" id="8296866">)</span>&nbsp;<span class="op" id="8296868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8296871">for</span>&nbsp;<span class="ident" id="8296875">_</span><span class="op" id="8296876">,</span>&nbsp;<span class="ident" id="8296878">test</span>&nbsp;<span class="op" id="8296883">:=</span>&nbsp;<span class="keyword" id="8296886">range</span>&nbsp;<span class="ident" id="8296892">deflateInflateStringTests</span>&nbsp;<span class="op" id="8296918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8296922">gold</span><span class="op" id="8296926">,</span>&nbsp;<span class="ident" id="8296928">err</span>&nbsp;<span class="op" id="8296932">:=</span>&nbsp;<span class="ident" id="8296935">ioutil</span><span class="op" id="8296941">.</span><span class="ident" id="8296942">ReadFile</span><span class="op" id="8296950">(</span><span class="ident" id="8296951">test</span><span class="op" id="8296955">.</span><span class="ident" id="8296956">filename</span><span class="op" id="8296964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8296968">if</span>&nbsp;<span class="ident" id="8296971">err</span>&nbsp;<span class="op" id="8296975">!=</span>&nbsp;<span class="builtintype" id="8296978">nil</span>&nbsp;<span class="op" id="8296982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8296987">t</span><span class="op" id="8296988">.</span><span class="ident" id="8296989">Error</span><span class="op" id="8296994">(</span><span class="ident" id="8296995">err</span><span class="op" id="8296998">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8297002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8297006">testToFromWithLimit</span><span class="op" id="8297025">(</span><span class="ident" id="8297026">t</span><span class="op" id="8297027">,</span>&nbsp;<span class="ident" id="8297029">gold</span><span class="op" id="8297033">,</span>&nbsp;<span class="ident" id="8297035">test</span><span class="op" id="8297039">.</span><span class="ident" id="8297040">label</span><span class="op" id="8297045">,</span>&nbsp;<span class="ident" id="8297047">test</span><span class="op" id="8297051">.</span><span class="ident" id="8297052">limit</span><span class="op" id="8297057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8297061">if</span>&nbsp;<span class="ident" id="8297064">testing</span><span class="op" id="8297071">.</span><span class="ident" id="8297072">Short</span><span class="op" id="8297077">(</span><span class="op" id="8297078">)</span>&nbsp;<span class="op" id="8297080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8297085">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8297093">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8297096">}</span><br>
<span class="lineno"></span><span class="op" id="8297098">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8297101">func</span>&nbsp;<span class="ident" id="8297106">TestReaderDict</span><span class="op" id="8297120">(</span><span class="ident" id="8297121">t</span>&nbsp;<span class="op" id="8297123">*</span><span class="ident" id="8297124">testing</span><span class="op" id="8297131">.</span><span class="ident" id="8297132">T</span><span class="op" id="8297133">)</span>&nbsp;<span class="op" id="8297135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8297138">const</span>&nbsp;<span class="op" id="8297144">(</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8297148">dict</span>&nbsp;<span class="op" id="8297153">=</span>&nbsp;<span class="string" id="8297155">&#34;hello&nbsp;world&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8297171">text</span>&nbsp;<span class="op" id="8297176">=</span>&nbsp;<span class="string" id="8297178">&#34;hello&nbsp;again&nbsp;world&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8297199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8297202">var</span>&nbsp;<span class="ident" id="8297206">b</span>&nbsp;<span class="ident" id="8297208">bytes</span><span class="op" id="8297213">.</span><span class="ident" id="8297214">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8297222">w</span><span class="op" id="8297223">,</span>&nbsp;<span class="ident" id="8297225">err</span>&nbsp;<span class="op" id="8297229">:=</span>&nbsp;<span class="ident" id="8297232">NewWriter</span><span class="op" id="8297241">(</span><span class="op" id="8297242">&amp;</span><span class="ident" id="8297243">b</span><span class="op" id="8297244">,</span>&nbsp;<span class="num" id="8297246">5</span><span class="op" id="8297247">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8297250">if</span>&nbsp;<span class="ident" id="8297253">err</span>&nbsp;<span class="op" id="8297257">!=</span>&nbsp;<span class="builtintype" id="8297260">nil</span>&nbsp;<span class="op" id="8297264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8297268">t</span><span class="op" id="8297269">.</span><span class="ident" id="8297270">Fatalf</span><span class="op" id="8297276">(</span><span class="string" id="8297277">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="8297292">,</span>&nbsp;<span class="ident" id="8297294">err</span><span class="op" id="8297297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8297300">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8297303">w</span><span class="op" id="8297304">.</span><span class="ident" id="8297305">Write</span><span class="op" id="8297310">(</span><span class="op" id="8297311">[</span><span class="op" id="8297312">]</span><span class="builtintype" id="8297313">byte</span><span class="op" id="8297317">(</span><span class="ident" id="8297318">dict</span><span class="op" id="8297322">)</span><span class="op" id="8297323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8297326">w</span><span class="op" id="8297327">.</span><span class="ident" id="8297328">Flush</span><span class="op" id="8297333">(</span><span class="op" id="8297334">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8297337">b</span><span class="op" id="8297338">.</span><span class="ident" id="8297339">Reset</span><span class="op" id="8297344">(</span><span class="op" id="8297345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8297348">w</span><span class="op" id="8297349">.</span><span class="ident" id="8297350">Write</span><span class="op" id="8297355">(</span><span class="op" id="8297356">[</span><span class="op" id="8297357">]</span><span class="builtintype" id="8297358">byte</span><span class="op" id="8297362">(</span><span class="ident" id="8297363">text</span><span class="op" id="8297367">)</span><span class="op" id="8297368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8297371">w</span><span class="op" id="8297372">.</span><span class="ident" id="8297373">Close</span><span class="op" id="8297378">(</span><span class="op" id="8297379">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8297383">r</span>&nbsp;<span class="op" id="8297385">:=</span>&nbsp;<span class="ident" id="8297388">NewReaderDict</span><span class="op" id="8297401">(</span><span class="op" id="8297402">&amp;</span><span class="ident" id="8297403">b</span><span class="op" id="8297404">,</span>&nbsp;<span class="op" id="8297406">[</span><span class="op" id="8297407">]</span><span class="builtintype" id="8297408">byte</span><span class="op" id="8297412">(</span><span class="ident" id="8297413">dict</span><span class="op" id="8297417">)</span><span class="op" id="8297418">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8297421">data</span><span class="op" id="8297425">,</span>&nbsp;<span class="ident" id="8297427">err</span>&nbsp;<span class="op" id="8297431">:=</span>&nbsp;<span class="ident" id="8297434">ioutil</span><span class="op" id="8297440">.</span><span class="ident" id="8297441">ReadAll</span><span class="op" id="8297448">(</span><span class="ident" id="8297449">r</span><span class="op" id="8297450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8297453">if</span>&nbsp;<span class="ident" id="8297456">err</span>&nbsp;<span class="op" id="8297460">!=</span>&nbsp;<span class="builtintype" id="8297463">nil</span>&nbsp;<span class="op" id="8297467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8297471">t</span><span class="op" id="8297472">.</span><span class="ident" id="8297473">Fatal</span><span class="op" id="8297478">(</span><span class="ident" id="8297479">err</span><span class="op" id="8297482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8297485">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8297488">if</span>&nbsp;<span class="builtintype" id="8297491">string</span><span class="op" id="8297497">(</span><span class="ident" id="8297498">data</span><span class="op" id="8297502">)</span>&nbsp;<span class="op" id="8297504">!=</span>&nbsp;<span class="string" id="8297507">&#34;hello&nbsp;again&nbsp;world&#34;</span>&nbsp;<span class="op" id="8297527">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8297531">t</span><span class="op" id="8297532">.</span><span class="ident" id="8297533">Fatalf</span><span class="op" id="8297539">(</span><span class="string" id="8297540">&#34;read&nbsp;returned&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8297566">,</span>&nbsp;<span class="builtintype" id="8297568">string</span><span class="op" id="8297574">(</span><span class="ident" id="8297575">data</span><span class="op" id="8297579">)</span><span class="op" id="8297580">,</span>&nbsp;<span class="ident" id="8297582">text</span><span class="op" id="8297586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8297589">}</span><br>
<span class="lineno"></span><span class="op" id="8297591">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8297594">func</span>&nbsp;<span class="ident" id="8297599">TestWriterDict</span><span class="op" id="8297613">(</span><span class="ident" id="8297614">t</span>&nbsp;<span class="op" id="8297616">*</span><span class="ident" id="8297617">testing</span><span class="op" id="8297624">.</span><span class="ident" id="8297625">T</span><span class="op" id="8297626">)</span>&nbsp;<span class="op" id="8297628">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8297631">const</span>&nbsp;<span class="op" id="8297637">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8297641">dict</span>&nbsp;<span class="op" id="8297646">=</span>&nbsp;<span class="string" id="8297648">&#34;hello&nbsp;world&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8297664">text</span>&nbsp;<span class="op" id="8297669">=</span>&nbsp;<span class="string" id="8297671">&#34;hello&nbsp;again&nbsp;world&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8297692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8297695">var</span>&nbsp;<span class="ident" id="8297699">b</span>&nbsp;<span class="ident" id="8297701">bytes</span><span class="op" id="8297706">.</span><span class="ident" id="8297707">Buffer</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8297715">w</span><span class="op" id="8297716">,</span>&nbsp;<span class="ident" id="8297718">err</span>&nbsp;<span class="op" id="8297722">:=</span>&nbsp;<span class="ident" id="8297725">NewWriter</span><span class="op" id="8297734">(</span><span class="op" id="8297735">&amp;</span><span class="ident" id="8297736">b</span><span class="op" id="8297737">,</span>&nbsp;<span class="num" id="8297739">5</span><span class="op" id="8297740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8297743">if</span>&nbsp;<span class="ident" id="8297746">err</span>&nbsp;<span class="op" id="8297750">!=</span>&nbsp;<span class="builtintype" id="8297753">nil</span>&nbsp;<span class="op" id="8297757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8297761">t</span><span class="op" id="8297762">.</span><span class="ident" id="8297763">Fatalf</span><span class="op" id="8297769">(</span><span class="string" id="8297770">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="8297785">,</span>&nbsp;<span class="ident" id="8297787">err</span><span class="op" id="8297790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8297793">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8297796">w</span><span class="op" id="8297797">.</span><span class="ident" id="8297798">Write</span><span class="op" id="8297803">(</span><span class="op" id="8297804">[</span><span class="op" id="8297805">]</span><span class="builtintype" id="8297806">byte</span><span class="op" id="8297810">(</span><span class="ident" id="8297811">dict</span><span class="op" id="8297815">)</span><span class="op" id="8297816">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8297819">w</span><span class="op" id="8297820">.</span><span class="ident" id="8297821">Flush</span><span class="op" id="8297826">(</span><span class="op" id="8297827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8297830">b</span><span class="op" id="8297831">.</span><span class="ident" id="8297832">Reset</span><span class="op" id="8297837">(</span><span class="op" id="8297838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8297841">w</span><span class="op" id="8297842">.</span><span class="ident" id="8297843">Write</span><span class="op" id="8297848">(</span><span class="op" id="8297849">[</span><span class="op" id="8297850">]</span><span class="builtintype" id="8297851">byte</span><span class="op" id="8297855">(</span><span class="ident" id="8297856">text</span><span class="op" id="8297860">)</span><span class="op" id="8297861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8297864">w</span><span class="op" id="8297865">.</span><span class="ident" id="8297866">Close</span><span class="op" id="8297871">(</span><span class="op" id="8297872">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8297876">var</span>&nbsp;<span class="ident" id="8297880">b1</span>&nbsp;<span class="ident" id="8297883">bytes</span><span class="op" id="8297888">.</span><span class="ident" id="8297889">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8297897">w</span><span class="op" id="8297898">,</span>&nbsp;<span class="ident" id="8297900">_</span>&nbsp;<span class="op" id="8297902">=</span>&nbsp;<span class="ident" id="8297904">NewWriterDict</span><span class="op" id="8297917">(</span><span class="op" id="8297918">&amp;</span><span class="ident" id="8297919">b1</span><span class="op" id="8297921">,</span>&nbsp;<span class="num" id="8297923">5</span><span class="op" id="8297924">,</span>&nbsp;<span class="op" id="8297926">[</span><span class="op" id="8297927">]</span><span class="builtintype" id="8297928">byte</span><span class="op" id="8297932">(</span><span class="ident" id="8297933">dict</span><span class="op" id="8297937">)</span><span class="op" id="8297938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8297941">w</span><span class="op" id="8297942">.</span><span class="ident" id="8297943">Write</span><span class="op" id="8297948">(</span><span class="op" id="8297949">[</span><span class="op" id="8297950">]</span><span class="builtintype" id="8297951">byte</span><span class="op" id="8297955">(</span><span class="ident" id="8297956">text</span><span class="op" id="8297960">)</span><span class="op" id="8297961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8297964">w</span><span class="op" id="8297965">.</span><span class="ident" id="8297966">Close</span><span class="op" id="8297971">(</span><span class="op" id="8297972">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8297976">if</span>&nbsp;<span class="op" id="8297979">!</span><span class="ident" id="8297980">bytes</span><span class="op" id="8297985">.</span><span class="ident" id="8297986">Equal</span><span class="op" id="8297991">(</span><span class="ident" id="8297992">b1</span><span class="op" id="8297994">.</span><span class="ident" id="8297995">Bytes</span><span class="op" id="8298000">(</span><span class="op" id="8298001">)</span><span class="op" id="8298002">,</span>&nbsp;<span class="ident" id="8298004">b</span><span class="op" id="8298005">.</span><span class="ident" id="8298006">Bytes</span><span class="op" id="8298011">(</span><span class="op" id="8298012">)</span><span class="op" id="8298013">)</span>&nbsp;<span class="op" id="8298015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8298019">t</span><span class="op" id="8298020">.</span><span class="ident" id="8298021">Fatalf</span><span class="op" id="8298027">(</span><span class="string" id="8298028">&#34;writer&nbsp;wrote&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8298053">,</span>&nbsp;<span class="ident" id="8298055">b1</span><span class="op" id="8298057">.</span><span class="ident" id="8298058">Bytes</span><span class="op" id="8298063">(</span><span class="op" id="8298064">)</span><span class="op" id="8298065">,</span>&nbsp;<span class="ident" id="8298067">b</span><span class="op" id="8298068">.</span><span class="ident" id="8298069">Bytes</span><span class="op" id="8298074">(</span><span class="op" id="8298075">)</span><span class="op" id="8298076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8298079">}</span><br>
<span class="lineno"></span><span class="op" id="8298081">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">410</span><span class="comment" id="8298084">//&nbsp;See&nbsp;http://code.google.com/p/go/issues/detail?id=2508</span><br>
<span class="lineno"></span><span class="keyword" id="8298141">func</span>&nbsp;<span class="ident" id="8298146">TestRegression2508</span><span class="op" id="8298164">(</span><span class="ident" id="8298165">t</span>&nbsp;<span class="op" id="8298167">*</span><span class="ident" id="8298168">testing</span><span class="op" id="8298175">.</span><span class="ident" id="8298176">T</span><span class="op" id="8298177">)</span>&nbsp;<span class="op" id="8298179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8298182">if</span>&nbsp;<span class="ident" id="8298185">testing</span><span class="op" id="8298192">.</span><span class="ident" id="8298193">Short</span><span class="op" id="8298198">(</span><span class="op" id="8298199">)</span>&nbsp;<span class="op" id="8298201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8298205">t</span><span class="op" id="8298206">.</span><span class="ident" id="8298207">Logf</span><span class="op" id="8298211">(</span><span class="string" id="8298212">&#34;test&nbsp;disabled&nbsp;with&nbsp;-short&#34;</span><span class="op" id="8298239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8298243">return</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8298251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8298254">w</span><span class="op" id="8298255">,</span>&nbsp;<span class="ident" id="8298257">err</span>&nbsp;<span class="op" id="8298261">:=</span>&nbsp;<span class="ident" id="8298264">NewWriter</span><span class="op" id="8298273">(</span><span class="ident" id="8298274">ioutil</span><span class="op" id="8298280">.</span><span class="ident" id="8298281">Discard</span><span class="op" id="8298288">,</span>&nbsp;<span class="num" id="8298290">1</span><span class="op" id="8298291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8298294">if</span>&nbsp;<span class="ident" id="8298297">err</span>&nbsp;<span class="op" id="8298301">!=</span>&nbsp;<span class="builtintype" id="8298304">nil</span>&nbsp;<span class="op" id="8298308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8298312">t</span><span class="op" id="8298313">.</span><span class="ident" id="8298314">Fatalf</span><span class="op" id="8298320">(</span><span class="string" id="8298321">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="8298336">,</span>&nbsp;<span class="ident" id="8298338">err</span><span class="op" id="8298341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8298344">}</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8298347">buf</span>&nbsp;<span class="op" id="8298351">:=</span>&nbsp;<span class="builtinfunc" id="8298354">make</span><span class="op" id="8298358">(</span><span class="op" id="8298359">[</span><span class="op" id="8298360">]</span><span class="builtintype" id="8298361">byte</span><span class="op" id="8298365">,</span>&nbsp;<span class="num" id="8298367">1024</span><span class="op" id="8298371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8298374">for</span>&nbsp;<span class="ident" id="8298378">i</span>&nbsp;<span class="op" id="8298380">:=</span>&nbsp;<span class="num" id="8298383">0</span><span class="op" id="8298384">;</span>&nbsp;<span class="ident" id="8298386">i</span>&nbsp;<span class="op" id="8298388">&lt;</span>&nbsp;<span class="num" id="8298390">131072</span><span class="op" id="8298396">;</span>&nbsp;<span class="ident" id="8298398">i</span><span class="op" id="8298399">++</span>&nbsp;<span class="op" id="8298402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8298406">if</span>&nbsp;<span class="ident" id="8298409">_</span><span class="op" id="8298410">,</span>&nbsp;<span class="ident" id="8298412">err</span>&nbsp;<span class="op" id="8298416">:=</span>&nbsp;<span class="ident" id="8298419">w</span><span class="op" id="8298420">.</span><span class="ident" id="8298421">Write</span><span class="op" id="8298426">(</span><span class="ident" id="8298427">buf</span><span class="op" id="8298430">)</span><span class="op" id="8298431">;</span>&nbsp;<span class="ident" id="8298433">err</span>&nbsp;<span class="op" id="8298437">!=</span>&nbsp;<span class="builtintype" id="8298440">nil</span>&nbsp;<span class="op" id="8298444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8298449">t</span><span class="op" id="8298450">.</span><span class="ident" id="8298451">Fatalf</span><span class="op" id="8298457">(</span><span class="string" id="8298458">&#34;writer&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8298477">,</span>&nbsp;<span class="ident" id="8298479">err</span><span class="op" id="8298482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8298486">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8298489">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8298492">w</span><span class="op" id="8298493">.</span><span class="ident" id="8298494">Close</span><span class="op" id="8298499">(</span><span class="op" id="8298500">)</span><br>
<span class="lineno"></span><span class="op" id="8298502">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8298505">func</span>&nbsp;<span class="ident" id="8298510">TestWriterReset</span><span class="op" id="8298525">(</span><span class="ident" id="8298526">t</span>&nbsp;<span class="op" id="8298528">*</span><span class="ident" id="8298529">testing</span><span class="op" id="8298536">.</span><span class="ident" id="8298537">T</span><span class="op" id="8298538">)</span>&nbsp;<span class="op" id="8298540">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8298543">for</span>&nbsp;<span class="ident" id="8298547">level</span>&nbsp;<span class="op" id="8298553">:=</span>&nbsp;<span class="num" id="8298556">0</span><span class="op" id="8298557">;</span>&nbsp;<span class="ident" id="8298559">level</span>&nbsp;<span class="op" id="8298565">&lt;=</span>&nbsp;<span class="num" id="8298568">9</span><span class="op" id="8298569">;</span>&nbsp;<span class="ident" id="8298571">level</span><span class="op" id="8298576">++</span>&nbsp;<span class="op" id="8298579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8298583">if</span>&nbsp;<span class="ident" id="8298586">testing</span><span class="op" id="8298593">.</span><span class="ident" id="8298594">Short</span><span class="op" id="8298599">(</span><span class="op" id="8298600">)</span>&nbsp;<span class="op" id="8298602">&amp;&amp;</span>&nbsp;<span class="ident" id="8298605">level</span>&nbsp;<span class="op" id="8298611">&gt;</span>&nbsp;<span class="num" id="8298613">1</span>&nbsp;<span class="op" id="8298615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8298620">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8298628">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8298632">w</span><span class="op" id="8298633">,</span>&nbsp;<span class="ident" id="8298635">err</span>&nbsp;<span class="op" id="8298639">:=</span>&nbsp;<span class="ident" id="8298642">NewWriter</span><span class="op" id="8298651">(</span><span class="ident" id="8298652">ioutil</span><span class="op" id="8298658">.</span><span class="ident" id="8298659">Discard</span><span class="op" id="8298666">,</span>&nbsp;<span class="ident" id="8298668">level</span><span class="op" id="8298673">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8298677">if</span>&nbsp;<span class="ident" id="8298680">err</span>&nbsp;<span class="op" id="8298684">!=</span>&nbsp;<span class="builtintype" id="8298687">nil</span>&nbsp;<span class="op" id="8298691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8298696">t</span><span class="op" id="8298697">.</span><span class="ident" id="8298698">Fatalf</span><span class="op" id="8298704">(</span><span class="string" id="8298705">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="8298720">,</span>&nbsp;<span class="ident" id="8298722">err</span><span class="op" id="8298725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8298729">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8298733">buf</span>&nbsp;<span class="op" id="8298737">:=</span>&nbsp;<span class="op" id="8298740">[</span><span class="op" id="8298741">]</span><span class="builtintype" id="8298742">byte</span><span class="op" id="8298746">(</span><span class="string" id="8298747">&#34;hello&nbsp;world&#34;</span><span class="op" id="8298760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8298764">for</span>&nbsp;<span class="ident" id="8298768">i</span>&nbsp;<span class="op" id="8298770">:=</span>&nbsp;<span class="num" id="8298773">0</span><span class="op" id="8298774">;</span>&nbsp;<span class="ident" id="8298776">i</span>&nbsp;<span class="op" id="8298778">&lt;</span>&nbsp;<span class="num" id="8298780">1024</span><span class="op" id="8298784">;</span>&nbsp;<span class="ident" id="8298786">i</span><span class="op" id="8298787">++</span>&nbsp;<span class="op" id="8298790">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8298795">w</span><span class="op" id="8298796">.</span><span class="ident" id="8298797">Write</span><span class="op" id="8298802">(</span><span class="ident" id="8298803">buf</span><span class="op" id="8298806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8298810">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8298814">w</span><span class="op" id="8298815">.</span><span class="ident" id="8298816">Reset</span><span class="op" id="8298821">(</span><span class="ident" id="8298822">ioutil</span><span class="op" id="8298828">.</span><span class="ident" id="8298829">Discard</span><span class="op" id="8298836">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8298841">wref</span><span class="op" id="8298845">,</span>&nbsp;<span class="ident" id="8298847">err</span>&nbsp;<span class="op" id="8298851">:=</span>&nbsp;<span class="ident" id="8298854">NewWriter</span><span class="op" id="8298863">(</span><span class="ident" id="8298864">ioutil</span><span class="op" id="8298870">.</span><span class="ident" id="8298871">Discard</span><span class="op" id="8298878">,</span>&nbsp;<span class="ident" id="8298880">level</span><span class="op" id="8298885">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8298889">if</span>&nbsp;<span class="ident" id="8298892">err</span>&nbsp;<span class="op" id="8298896">!=</span>&nbsp;<span class="builtintype" id="8298899">nil</span>&nbsp;<span class="op" id="8298903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8298908">t</span><span class="op" id="8298909">.</span><span class="ident" id="8298910">Fatalf</span><span class="op" id="8298916">(</span><span class="string" id="8298917">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="8298932">,</span>&nbsp;<span class="ident" id="8298934">err</span><span class="op" id="8298937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8298941">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8298946">//&nbsp;DeepEqual&nbsp;doesn&#39;t&nbsp;compare&nbsp;functions.</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8298988">w</span><span class="op" id="8298989">.</span><span class="ident" id="8298990">d</span><span class="op" id="8298991">.</span><span class="ident" id="8298992">fill</span><span class="op" id="8298996">,</span>&nbsp;<span class="ident" id="8298998">wref</span><span class="op" id="8299002">.</span><span class="ident" id="8299003">d</span><span class="op" id="8299004">.</span><span class="ident" id="8299005">fill</span>&nbsp;<span class="op" id="8299010">=</span>&nbsp;<span class="builtintype" id="8299012">nil</span><span class="op" id="8299015">,</span>&nbsp;<span class="builtintype" id="8299017">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8299023">w</span><span class="op" id="8299024">.</span><span class="ident" id="8299025">d</span><span class="op" id="8299026">.</span><span class="ident" id="8299027">step</span><span class="op" id="8299031">,</span>&nbsp;<span class="ident" id="8299033">wref</span><span class="op" id="8299037">.</span><span class="ident" id="8299038">d</span><span class="op" id="8299039">.</span><span class="ident" id="8299040">step</span>&nbsp;<span class="op" id="8299045">=</span>&nbsp;<span class="builtintype" id="8299047">nil</span><span class="op" id="8299050">,</span>&nbsp;<span class="builtintype" id="8299052">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8299058">if</span>&nbsp;<span class="op" id="8299061">!</span><span class="ident" id="8299062">reflect</span><span class="op" id="8299069">.</span><span class="ident" id="8299070">DeepEqual</span><span class="op" id="8299079">(</span><span class="ident" id="8299080">w</span><span class="op" id="8299081">,</span>&nbsp;<span class="ident" id="8299083">wref</span><span class="op" id="8299087">)</span>&nbsp;<span class="op" id="8299089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8299094">t</span><span class="op" id="8299095">.</span><span class="ident" id="8299096">Errorf</span><span class="op" id="8299102">(</span><span class="string" id="8299103">&#34;level&nbsp;%d&nbsp;Writer&nbsp;not&nbsp;reset&nbsp;after&nbsp;Reset&#34;</span><span class="op" id="8299142">,</span>&nbsp;<span class="ident" id="8299144">level</span><span class="op" id="8299149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8299153">}</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8299156">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8299159">testResetOutput</span><span class="op" id="8299174">(</span><span class="ident" id="8299175">t</span><span class="op" id="8299176">,</span>&nbsp;<span class="keyword" id="8299178">func</span><span class="op" id="8299182">(</span><span class="ident" id="8299183">w</span>&nbsp;<span class="ident" id="8299185">io</span><span class="op" id="8299187">.</span><span class="ident" id="8299188">Writer</span><span class="op" id="8299194">)</span>&nbsp;<span class="op" id="8299196">(</span><span class="op" id="8299197">*</span><span class="ident" id="8299198">Writer</span><span class="op" id="8299204">,</span>&nbsp;<span class="builtintype" id="8299206">error</span><span class="op" id="8299211">)</span>&nbsp;<span class="op" id="8299213">{</span>&nbsp;<span class="keyword" id="8299215">return</span>&nbsp;<span class="ident" id="8299222">NewWriter</span><span class="op" id="8299231">(</span><span class="ident" id="8299232">w</span><span class="op" id="8299233">,</span>&nbsp;<span class="ident" id="8299235">NoCompression</span><span class="op" id="8299248">)</span>&nbsp;<span class="op" id="8299250">}</span><span class="op" id="8299251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8299254">testResetOutput</span><span class="op" id="8299269">(</span><span class="ident" id="8299270">t</span><span class="op" id="8299271">,</span>&nbsp;<span class="keyword" id="8299273">func</span><span class="op" id="8299277">(</span><span class="ident" id="8299278">w</span>&nbsp;<span class="ident" id="8299280">io</span><span class="op" id="8299282">.</span><span class="ident" id="8299283">Writer</span><span class="op" id="8299289">)</span>&nbsp;<span class="op" id="8299291">(</span><span class="op" id="8299292">*</span><span class="ident" id="8299293">Writer</span><span class="op" id="8299299">,</span>&nbsp;<span class="builtintype" id="8299301">error</span><span class="op" id="8299306">)</span>&nbsp;<span class="op" id="8299308">{</span>&nbsp;<span class="keyword" id="8299310">return</span>&nbsp;<span class="ident" id="8299317">NewWriter</span><span class="op" id="8299326">(</span><span class="ident" id="8299327">w</span><span class="op" id="8299328">,</span>&nbsp;<span class="ident" id="8299330">DefaultCompression</span><span class="op" id="8299348">)</span>&nbsp;<span class="op" id="8299350">}</span><span class="op" id="8299351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8299354">testResetOutput</span><span class="op" id="8299369">(</span><span class="ident" id="8299370">t</span><span class="op" id="8299371">,</span>&nbsp;<span class="keyword" id="8299373">func</span><span class="op" id="8299377">(</span><span class="ident" id="8299378">w</span>&nbsp;<span class="ident" id="8299380">io</span><span class="op" id="8299382">.</span><span class="ident" id="8299383">Writer</span><span class="op" id="8299389">)</span>&nbsp;<span class="op" id="8299391">(</span><span class="op" id="8299392">*</span><span class="ident" id="8299393">Writer</span><span class="op" id="8299399">,</span>&nbsp;<span class="builtintype" id="8299401">error</span><span class="op" id="8299406">)</span>&nbsp;<span class="op" id="8299408">{</span>&nbsp;<span class="keyword" id="8299410">return</span>&nbsp;<span class="ident" id="8299417">NewWriter</span><span class="op" id="8299426">(</span><span class="ident" id="8299427">w</span><span class="op" id="8299428">,</span>&nbsp;<span class="ident" id="8299430">BestCompression</span><span class="op" id="8299445">)</span>&nbsp;<span class="op" id="8299447">}</span><span class="op" id="8299448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8299451">dict</span>&nbsp;<span class="op" id="8299456">:=</span>&nbsp;<span class="op" id="8299459">[</span><span class="op" id="8299460">]</span><span class="builtintype" id="8299461">byte</span><span class="op" id="8299465">(</span><span class="string" id="8299466">&#34;we&nbsp;are&nbsp;the&nbsp;world&#34;</span><span class="op" id="8299484">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8299487">testResetOutput</span><span class="op" id="8299502">(</span><span class="ident" id="8299503">t</span><span class="op" id="8299504">,</span>&nbsp;<span class="keyword" id="8299506">func</span><span class="op" id="8299510">(</span><span class="ident" id="8299511">w</span>&nbsp;<span class="ident" id="8299513">io</span><span class="op" id="8299515">.</span><span class="ident" id="8299516">Writer</span><span class="op" id="8299522">)</span>&nbsp;<span class="op" id="8299524">(</span><span class="op" id="8299525">*</span><span class="ident" id="8299526">Writer</span><span class="op" id="8299532">,</span>&nbsp;<span class="builtintype" id="8299534">error</span><span class="op" id="8299539">)</span>&nbsp;<span class="op" id="8299541">{</span>&nbsp;<span class="keyword" id="8299543">return</span>&nbsp;<span class="ident" id="8299550">NewWriterDict</span><span class="op" id="8299563">(</span><span class="ident" id="8299564">w</span><span class="op" id="8299565">,</span>&nbsp;<span class="ident" id="8299567">NoCompression</span><span class="op" id="8299580">,</span>&nbsp;<span class="ident" id="8299582">dict</span><span class="op" id="8299586">)</span>&nbsp;<span class="op" id="8299588">}</span><span class="op" id="8299589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8299592">testResetOutput</span><span class="op" id="8299607">(</span><span class="ident" id="8299608">t</span><span class="op" id="8299609">,</span>&nbsp;<span class="keyword" id="8299611">func</span><span class="op" id="8299615">(</span><span class="ident" id="8299616">w</span>&nbsp;<span class="ident" id="8299618">io</span><span class="op" id="8299620">.</span><span class="ident" id="8299621">Writer</span><span class="op" id="8299627">)</span>&nbsp;<span class="op" id="8299629">(</span><span class="op" id="8299630">*</span><span class="ident" id="8299631">Writer</span><span class="op" id="8299637">,</span>&nbsp;<span class="builtintype" id="8299639">error</span><span class="op" id="8299644">)</span>&nbsp;<span class="op" id="8299646">{</span>&nbsp;<span class="keyword" id="8299648">return</span>&nbsp;<span class="ident" id="8299655">NewWriterDict</span><span class="op" id="8299668">(</span><span class="ident" id="8299669">w</span><span class="op" id="8299670">,</span>&nbsp;<span class="ident" id="8299672">DefaultCompression</span><span class="op" id="8299690">,</span>&nbsp;<span class="ident" id="8299692">dict</span><span class="op" id="8299696">)</span>&nbsp;<span class="op" id="8299698">}</span><span class="op" id="8299699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8299702">testResetOutput</span><span class="op" id="8299717">(</span><span class="ident" id="8299718">t</span><span class="op" id="8299719">,</span>&nbsp;<span class="keyword" id="8299721">func</span><span class="op" id="8299725">(</span><span class="ident" id="8299726">w</span>&nbsp;<span class="ident" id="8299728">io</span><span class="op" id="8299730">.</span><span class="ident" id="8299731">Writer</span><span class="op" id="8299737">)</span>&nbsp;<span class="op" id="8299739">(</span><span class="op" id="8299740">*</span><span class="ident" id="8299741">Writer</span><span class="op" id="8299747">,</span>&nbsp;<span class="builtintype" id="8299749">error</span><span class="op" id="8299754">)</span>&nbsp;<span class="op" id="8299756">{</span>&nbsp;<span class="keyword" id="8299758">return</span>&nbsp;<span class="ident" id="8299765">NewWriterDict</span><span class="op" id="8299778">(</span><span class="ident" id="8299779">w</span><span class="op" id="8299780">,</span>&nbsp;<span class="ident" id="8299782">BestCompression</span><span class="op" id="8299797">,</span>&nbsp;<span class="ident" id="8299799">dict</span><span class="op" id="8299803">)</span>&nbsp;<span class="op" id="8299805">}</span><span class="op" id="8299806">)</span><br>
<span class="lineno"></span><span class="op" id="8299808">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">465</span><span class="keyword" id="8299811">func</span>&nbsp;<span class="ident" id="8299816">testResetOutput</span><span class="op" id="8299831">(</span><span class="ident" id="8299832">t</span>&nbsp;<span class="op" id="8299834">*</span><span class="ident" id="8299835">testing</span><span class="op" id="8299842">.</span><span class="ident" id="8299843">T</span><span class="op" id="8299844">,</span>&nbsp;<span class="ident" id="8299846">newWriter</span>&nbsp;<span class="keyword" id="8299856">func</span><span class="op" id="8299860">(</span><span class="ident" id="8299861">w</span>&nbsp;<span class="ident" id="8299863">io</span><span class="op" id="8299865">.</span><span class="ident" id="8299866">Writer</span><span class="op" id="8299872">)</span>&nbsp;<span class="op" id="8299874">(</span><span class="op" id="8299875">*</span><span class="ident" id="8299876">Writer</span><span class="op" id="8299882">,</span>&nbsp;<span class="builtintype" id="8299884">error</span><span class="op" id="8299889">)</span><span class="op" id="8299890">)</span>&nbsp;<span class="op" id="8299892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8299895">buf</span>&nbsp;<span class="op" id="8299899">:=</span>&nbsp;<span class="builtinfunc" id="8299902">new</span><span class="op" id="8299905">(</span><span class="ident" id="8299906">bytes</span><span class="op" id="8299911">.</span><span class="ident" id="8299912">Buffer</span><span class="op" id="8299918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8299921">w</span><span class="op" id="8299922">,</span>&nbsp;<span class="ident" id="8299924">err</span>&nbsp;<span class="op" id="8299928">:=</span>&nbsp;<span class="ident" id="8299931">newWriter</span><span class="op" id="8299940">(</span><span class="ident" id="8299941">buf</span><span class="op" id="8299944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8299947">if</span>&nbsp;<span class="ident" id="8299950">err</span>&nbsp;<span class="op" id="8299954">!=</span>&nbsp;<span class="builtintype" id="8299957">nil</span>&nbsp;<span class="op" id="8299961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8299965">t</span><span class="op" id="8299966">.</span><span class="ident" id="8299967">Fatalf</span><span class="op" id="8299973">(</span><span class="string" id="8299974">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="8299989">,</span>&nbsp;<span class="ident" id="8299991">err</span><span class="op" id="8299994">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8299997">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8300000">b</span>&nbsp;<span class="op" id="8300002">:=</span>&nbsp;<span class="op" id="8300005">[</span><span class="op" id="8300006">]</span><span class="builtintype" id="8300007">byte</span><span class="op" id="8300011">(</span><span class="string" id="8300012">&#34;hello&nbsp;world&#34;</span><span class="op" id="8300025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8300028">for</span>&nbsp;<span class="ident" id="8300032">i</span>&nbsp;<span class="op" id="8300034">:=</span>&nbsp;<span class="num" id="8300037">0</span><span class="op" id="8300038">;</span>&nbsp;<span class="ident" id="8300040">i</span>&nbsp;<span class="op" id="8300042">&lt;</span>&nbsp;<span class="num" id="8300044">1024</span><span class="op" id="8300048">;</span>&nbsp;<span class="ident" id="8300050">i</span><span class="op" id="8300051">++</span>&nbsp;<span class="op" id="8300054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8300058">w</span><span class="op" id="8300059">.</span><span class="ident" id="8300060">Write</span><span class="op" id="8300065">(</span><span class="ident" id="8300066">b</span><span class="op" id="8300067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8300070">}</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8300073">w</span><span class="op" id="8300074">.</span><span class="ident" id="8300075">Close</span><span class="op" id="8300080">(</span><span class="op" id="8300081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8300084">out1</span>&nbsp;<span class="op" id="8300089">:=</span>&nbsp;<span class="ident" id="8300092">buf</span><span class="op" id="8300095">.</span><span class="ident" id="8300096">String</span><span class="op" id="8300102">(</span><span class="op" id="8300103">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8300107">buf2</span>&nbsp;<span class="op" id="8300112">:=</span>&nbsp;<span class="builtinfunc" id="8300115">new</span><span class="op" id="8300118">(</span><span class="ident" id="8300119">bytes</span><span class="op" id="8300124">.</span><span class="ident" id="8300125">Buffer</span><span class="op" id="8300131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8300134">w</span><span class="op" id="8300135">.</span><span class="ident" id="8300136">Reset</span><span class="op" id="8300141">(</span><span class="ident" id="8300142">buf2</span><span class="op" id="8300146">)</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8300149">for</span>&nbsp;<span class="ident" id="8300153">i</span>&nbsp;<span class="op" id="8300155">:=</span>&nbsp;<span class="num" id="8300158">0</span><span class="op" id="8300159">;</span>&nbsp;<span class="ident" id="8300161">i</span>&nbsp;<span class="op" id="8300163">&lt;</span>&nbsp;<span class="num" id="8300165">1024</span><span class="op" id="8300169">;</span>&nbsp;<span class="ident" id="8300171">i</span><span class="op" id="8300172">++</span>&nbsp;<span class="op" id="8300175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8300179">w</span><span class="op" id="8300180">.</span><span class="ident" id="8300181">Write</span><span class="op" id="8300186">(</span><span class="ident" id="8300187">b</span><span class="op" id="8300188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8300191">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8300194">w</span><span class="op" id="8300195">.</span><span class="ident" id="8300196">Close</span><span class="op" id="8300201">(</span><span class="op" id="8300202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8300205">out2</span>&nbsp;<span class="op" id="8300210">:=</span>&nbsp;<span class="ident" id="8300213">buf2</span><span class="op" id="8300217">.</span><span class="ident" id="8300218">String</span><span class="op" id="8300224">(</span><span class="op" id="8300225">)</span><br>
<span class="lineno">485</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8300229">if</span>&nbsp;<span class="ident" id="8300232">out1</span>&nbsp;<span class="op" id="8300237">!=</span>&nbsp;<span class="ident" id="8300240">out2</span>&nbsp;<span class="op" id="8300245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8300249">t</span><span class="op" id="8300250">.</span><span class="ident" id="8300251">Errorf</span><span class="op" id="8300257">(</span><span class="string" id="8300258">&#34;got&nbsp;%q,&nbsp;expected&nbsp;%q&#34;</span><span class="op" id="8300279">,</span>&nbsp;<span class="ident" id="8300281">out2</span><span class="op" id="8300285">,</span>&nbsp;<span class="ident" id="8300287">out1</span><span class="op" id="8300291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8300294">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8300297">t</span><span class="op" id="8300298">.</span><span class="ident" id="8300299">Logf</span><span class="op" id="8300303">(</span><span class="string" id="8300304">&#34;got&nbsp;%d&nbsp;bytes&#34;</span><span class="op" id="8300318">,</span>&nbsp;<span class="builtinfunc" id="8300320">len</span><span class="op" id="8300323">(</span><span class="ident" id="8300324">out1</span><span class="op" id="8300328">)</span><span class="op" id="8300329">)</span><br>
<span class="lineno">490</span><span class="op" id="8300331">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
