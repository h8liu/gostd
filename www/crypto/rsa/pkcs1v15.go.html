<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4108762">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4108817">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4108871">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4108922">package</span>&nbsp;<span class="ident" id="4108930">rsa</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4108935">import</span>&nbsp;<span class="op" id="4108942">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4108945">&#34;crypto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4108955">&#34;crypto/subtle&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4108972">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4108982">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4108988">&#34;math/big&#34;</span><br>
<span class="lineno"></span><span class="op" id="4108999">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="4109002">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;encryption&nbsp;and&nbsp;decryption&nbsp;using&nbsp;PKCS#1&nbsp;v1.5&nbsp;padding.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4109080">//&nbsp;EncryptPKCS1v15&nbsp;encrypts&nbsp;the&nbsp;given&nbsp;message&nbsp;with&nbsp;RSA&nbsp;and&nbsp;the&nbsp;padding&nbsp;scheme&nbsp;from&nbsp;PKCS#1&nbsp;v1.5.</span><br>
<span class="lineno"></span><span class="comment" id="4109176">//&nbsp;The&nbsp;message&nbsp;must&nbsp;be&nbsp;no&nbsp;longer&nbsp;than&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;public&nbsp;modulus&nbsp;minus&nbsp;11&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="comment" id="4109263">//&nbsp;WARNING:&nbsp;use&nbsp;of&nbsp;this&nbsp;function&nbsp;to&nbsp;encrypt&nbsp;plaintexts&nbsp;other&nbsp;than&nbsp;session&nbsp;keys</span><br>
<span class="lineno">20</span><span class="comment" id="4109342">//&nbsp;is&nbsp;dangerous.&nbsp;Use&nbsp;RSA&nbsp;OAEP&nbsp;in&nbsp;new&nbsp;protocols.</span><br>
<span class="lineno"></span><span class="keyword" id="4109390">func</span>&nbsp;<span class="ident" id="4109395">EncryptPKCS1v15</span><span class="op" id="4109410">(</span><span class="ident" id="4109411">rand</span>&nbsp;<span class="ident" id="4109416"><a href="/crypto/rsa/pkcs1v15.go.html#4108982">io</a></span><span class="op" id="4109418">.</span><span class="ident" id="4109419">Reader</span><span class="op" id="4109425">,</span>&nbsp;<span class="ident" id="4109427">pub</span>&nbsp;<span class="op" id="4109431">*</span><span class="ident" id="4109432"><a href="/crypto/rsa/rsa.go.html#4127377">PublicKey</a></span><span class="op" id="4109441">,</span>&nbsp;<span class="ident" id="4109443">msg</span>&nbsp;<span class="op" id="4109447">[</span><span class="op" id="4109448">]</span><span class="builtintype" id="4109449">byte</span><span class="op" id="4109453">)</span>&nbsp;<span class="op" id="4109455">(</span><span class="ident" id="4109456">out</span>&nbsp;<span class="op" id="4109460">[</span><span class="op" id="4109461">]</span><span class="builtintype" id="4109462">byte</span><span class="op" id="4109466">,</span>&nbsp;<span class="ident" id="4109468">err</span>&nbsp;<span class="builtintype" id="4109472">error</span><span class="op" id="4109477">)</span>&nbsp;<span class="op" id="4109479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4109482">if</span>&nbsp;<span class="ident" id="4109485">err</span>&nbsp;<span class="op" id="4109489">:=</span>&nbsp;<span class="ident" id="4109492"><a href="/crypto/rsa/rsa.go.html#4127961">checkPub</a></span><span class="op" id="4109500">(</span><span class="ident" id="4109501"><a href="/crypto/rsa/pkcs1v15.go.html#4109427">pub</a></span><span class="op" id="4109504">)</span><span class="op" id="4109505">;</span>&nbsp;<span class="ident" id="4109507"><a href="/crypto/rsa/pkcs1v15.go.html#4109485">err</a></span>&nbsp;<span class="op" id="4109511">!=</span>&nbsp;<span class="ident" id="4109514">nil</span>&nbsp;<span class="op" id="4109518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4109522">return</span>&nbsp;<span class="ident" id="4109529">nil</span><span class="op" id="4109532">,</span>&nbsp;<span class="ident" id="4109534"><a href="/crypto/rsa/pkcs1v15.go.html#4109485">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4109539">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4109542">k</span>&nbsp;<span class="op" id="4109544">:=</span>&nbsp;<span class="op" id="4109547">(</span><span class="ident" id="4109548"><a href="/crypto/rsa/pkcs1v15.go.html#4109427">pub</a></span><span class="op" id="4109551">.</span><span class="ident" id="4109552">N</span><span class="op" id="4109553">.</span><span class="ident" id="4109554">BitLen</span><span class="op" id="4109560">(</span><span class="op" id="4109561">)</span>&nbsp;<span class="op" id="4109563">+</span>&nbsp;<span class="num" id="4109565">7</span><span class="op" id="4109566">)</span>&nbsp;<span class="op" id="4109568">/</span>&nbsp;<span class="num" id="4109570">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4109573">if</span>&nbsp;<span class="builtinfunc" id="4109576">len</span><span class="op" id="4109579">(</span><span class="ident" id="4109580"><a href="/crypto/rsa/pkcs1v15.go.html#4109443">msg</a></span><span class="op" id="4109583">)</span>&nbsp;<span class="op" id="4109585">&gt;</span>&nbsp;<span class="ident" id="4109587"><a href="/crypto/rsa/pkcs1v15.go.html#4109542">k</a></span><span class="op" id="4109588">-</span><span class="num" id="4109589">11</span>&nbsp;<span class="op" id="4109592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4109596"><a href="/crypto/rsa/pkcs1v15.go.html#4109468">err</a></span>&nbsp;<span class="op" id="4109600">=</span>&nbsp;<span class="ident" id="4109602"><a href="/crypto/rsa/rsa.go.html#4134992">ErrMessageTooLong</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4109622">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4109630">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4109634">//&nbsp;EM&nbsp;=&nbsp;0x00&nbsp;||&nbsp;0x02&nbsp;||&nbsp;PS&nbsp;||&nbsp;0x00&nbsp;||&nbsp;M</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4109675">em</span>&nbsp;<span class="op" id="4109678">:=</span>&nbsp;<span class="builtinfunc" id="4109681">make</span><span class="op" id="4109685">(</span><span class="op" id="4109686">[</span><span class="op" id="4109687">]</span><span class="builtintype" id="4109688">byte</span><span class="op" id="4109692">,</span>&nbsp;<span class="ident" id="4109694"><a href="/crypto/rsa/pkcs1v15.go.html#4109542">k</a></span><span class="op" id="4109695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4109698"><a href="/crypto/rsa/pkcs1v15.go.html#4109675">em</a></span><span class="op" id="4109700">[</span><span class="num" id="4109701">1</span><span class="op" id="4109702">]</span>&nbsp;<span class="op" id="4109704">=</span>&nbsp;<span class="num" id="4109706">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4109709">ps</span><span class="op" id="4109711">,</span>&nbsp;<span class="ident" id="4109713">mm</span>&nbsp;<span class="op" id="4109716">:=</span>&nbsp;<span class="ident" id="4109719"><a href="/crypto/rsa/pkcs1v15.go.html#4109675">em</a></span><span class="op" id="4109721">[</span><span class="num" id="4109722">2</span><span class="op" id="4109723">:</span><span class="builtinfunc" id="4109724">len</span><span class="op" id="4109727">(</span><span class="ident" id="4109728"><a href="/crypto/rsa/pkcs1v15.go.html#4109675">em</a></span><span class="op" id="4109730">)</span><span class="op" id="4109731">-</span><span class="builtinfunc" id="4109732">len</span><span class="op" id="4109735">(</span><span class="ident" id="4109736"><a href="/crypto/rsa/pkcs1v15.go.html#4109443">msg</a></span><span class="op" id="4109739">)</span><span class="op" id="4109740">-</span><span class="num" id="4109741">1</span><span class="op" id="4109742">]</span><span class="op" id="4109743">,</span>&nbsp;<span class="ident" id="4109745"><a href="/crypto/rsa/pkcs1v15.go.html#4109675">em</a></span><span class="op" id="4109747">[</span><span class="builtinfunc" id="4109748">len</span><span class="op" id="4109751">(</span><span class="ident" id="4109752"><a href="/crypto/rsa/pkcs1v15.go.html#4109675">em</a></span><span class="op" id="4109754">)</span><span class="op" id="4109755">-</span><span class="builtinfunc" id="4109756">len</span><span class="op" id="4109759">(</span><span class="ident" id="4109760"><a href="/crypto/rsa/pkcs1v15.go.html#4109443">msg</a></span><span class="op" id="4109763">)</span><span class="op" id="4109764">:</span><span class="op" id="4109765">]</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4109768"><a href="/crypto/rsa/pkcs1v15.go.html#4109468">err</a></span>&nbsp;<span class="op" id="4109772">=</span>&nbsp;<span class="ident" id="4109774"><a href="/crypto/rsa/pkcs1v15.go.html#4113832">nonZeroRandomBytes</a></span><span class="op" id="4109792">(</span><span class="ident" id="4109793"><a href="/crypto/rsa/pkcs1v15.go.html#4109709">ps</a></span><span class="op" id="4109795">,</span>&nbsp;<span class="ident" id="4109797"><a href="/crypto/rsa/pkcs1v15.go.html#4109411">rand</a></span><span class="op" id="4109801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4109804">if</span>&nbsp;<span class="ident" id="4109807"><a href="/crypto/rsa/pkcs1v15.go.html#4109468">err</a></span>&nbsp;<span class="op" id="4109811">!=</span>&nbsp;<span class="ident" id="4109814">nil</span>&nbsp;<span class="op" id="4109818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4109822">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4109830">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4109833"><a href="/crypto/rsa/pkcs1v15.go.html#4109675">em</a></span><span class="op" id="4109835">[</span><span class="builtinfunc" id="4109836">len</span><span class="op" id="4109839">(</span><span class="ident" id="4109840"><a href="/crypto/rsa/pkcs1v15.go.html#4109675">em</a></span><span class="op" id="4109842">)</span><span class="op" id="4109843">-</span><span class="builtinfunc" id="4109844">len</span><span class="op" id="4109847">(</span><span class="ident" id="4109848"><a href="/crypto/rsa/pkcs1v15.go.html#4109443">msg</a></span><span class="op" id="4109851">)</span><span class="op" id="4109852">-</span><span class="num" id="4109853">1</span><span class="op" id="4109854">]</span>&nbsp;<span class="op" id="4109856">=</span>&nbsp;<span class="num" id="4109858">0</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4109861">copy</span><span class="op" id="4109865">(</span><span class="ident" id="4109866"><a href="/crypto/rsa/pkcs1v15.go.html#4109713">mm</a></span><span class="op" id="4109868">,</span>&nbsp;<span class="ident" id="4109870"><a href="/crypto/rsa/pkcs1v15.go.html#4109443">msg</a></span><span class="op" id="4109873">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4109877">m</span>&nbsp;<span class="op" id="4109879">:=</span>&nbsp;<span class="builtinfunc" id="4109882">new</span><span class="op" id="4109885">(</span><span class="ident" id="4109886"><a href="/crypto/rsa/pkcs1v15.go.html#4108988">big</a></span><span class="op" id="4109889">.</span><span class="ident" id="4109890">Int</span><span class="op" id="4109893">)</span><span class="op" id="4109894">.</span><span class="ident" id="4109895">SetBytes</span><span class="op" id="4109903">(</span><span class="ident" id="4109904"><a href="/crypto/rsa/pkcs1v15.go.html#4109675">em</a></span><span class="op" id="4109906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4109909">c</span>&nbsp;<span class="op" id="4109911">:=</span>&nbsp;<span class="ident" id="4109914"><a href="/crypto/rsa/rsa.go.html#4135085">encrypt</a></span><span class="op" id="4109921">(</span><span class="builtinfunc" id="4109922">new</span><span class="op" id="4109925">(</span><span class="ident" id="4109926"><a href="/crypto/rsa/pkcs1v15.go.html#4108988">big</a></span><span class="op" id="4109929">.</span><span class="ident" id="4109930">Int</span><span class="op" id="4109933">)</span><span class="op" id="4109934">,</span>&nbsp;<span class="ident" id="4109936"><a href="/crypto/rsa/pkcs1v15.go.html#4109427">pub</a></span><span class="op" id="4109939">,</span>&nbsp;<span class="ident" id="4109941"><a href="/crypto/rsa/pkcs1v15.go.html#4109877">m</a></span><span class="op" id="4109942">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4109946"><a href="/crypto/rsa/pkcs1v15.go.html#4118229">copyWithLeftPad</a></span><span class="op" id="4109961">(</span><span class="ident" id="4109962"><a href="/crypto/rsa/pkcs1v15.go.html#4109675">em</a></span><span class="op" id="4109964">,</span>&nbsp;<span class="ident" id="4109966"><a href="/crypto/rsa/pkcs1v15.go.html#4109909">c</a></span><span class="op" id="4109967">.</span><span class="ident" id="4109968">Bytes</span><span class="op" id="4109973">(</span><span class="op" id="4109974">)</span><span class="op" id="4109975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4109978"><a href="/crypto/rsa/pkcs1v15.go.html#4109456">out</a></span>&nbsp;<span class="op" id="4109982">=</span>&nbsp;<span class="ident" id="4109984"><a href="/crypto/rsa/pkcs1v15.go.html#4109675">em</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4109988">return</span><br>
<span class="lineno"></span><span class="op" id="4109995">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="4109998">//&nbsp;DecryptPKCS1v15&nbsp;decrypts&nbsp;a&nbsp;plaintext&nbsp;using&nbsp;RSA&nbsp;and&nbsp;the&nbsp;padding&nbsp;scheme&nbsp;from&nbsp;PKCS#1&nbsp;v1.5.</span><br>
<span class="lineno"></span><span class="comment" id="4110089">//&nbsp;If&nbsp;rand&nbsp;!=&nbsp;nil,&nbsp;it&nbsp;uses&nbsp;RSA&nbsp;blinding&nbsp;to&nbsp;avoid&nbsp;timing&nbsp;side-channel&nbsp;attacks.</span><br>
<span class="lineno"></span><span class="keyword" id="4110167">func</span>&nbsp;<span class="ident" id="4110172">DecryptPKCS1v15</span><span class="op" id="4110187">(</span><span class="ident" id="4110188">rand</span>&nbsp;<span class="ident" id="4110193"><a href="/crypto/rsa/pkcs1v15.go.html#4108982">io</a></span><span class="op" id="4110195">.</span><span class="ident" id="4110196">Reader</span><span class="op" id="4110202">,</span>&nbsp;<span class="ident" id="4110204">priv</span>&nbsp;<span class="op" id="4110209">*</span><span class="ident" id="4110210"><a href="/crypto/rsa/rsa.go.html#4128208">PrivateKey</a></span><span class="op" id="4110220">,</span>&nbsp;<span class="ident" id="4110222">ciphertext</span>&nbsp;<span class="op" id="4110233">[</span><span class="op" id="4110234">]</span><span class="builtintype" id="4110235">byte</span><span class="op" id="4110239">)</span>&nbsp;<span class="op" id="4110241">(</span><span class="ident" id="4110242">out</span>&nbsp;<span class="op" id="4110246">[</span><span class="op" id="4110247">]</span><span class="builtintype" id="4110248">byte</span><span class="op" id="4110252">,</span>&nbsp;<span class="ident" id="4110254">err</span>&nbsp;<span class="builtintype" id="4110258">error</span><span class="op" id="4110263">)</span>&nbsp;<span class="op" id="4110265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4110268">if</span>&nbsp;<span class="ident" id="4110271">err</span>&nbsp;<span class="op" id="4110275">:=</span>&nbsp;<span class="ident" id="4110278"><a href="/crypto/rsa/rsa.go.html#4127961">checkPub</a></span><span class="op" id="4110286">(</span><span class="op" id="4110287">&amp;</span><span class="ident" id="4110288"><a href="/crypto/rsa/pkcs1v15.go.html#4110204">priv</a></span><span class="op" id="4110292">.</span><span class="ident" id="4110293">PublicKey</span><span class="op" id="4110302">)</span><span class="op" id="4110303">;</span>&nbsp;<span class="ident" id="4110305"><a href="/crypto/rsa/pkcs1v15.go.html#4110271">err</a></span>&nbsp;<span class="op" id="4110309">!=</span>&nbsp;<span class="ident" id="4110312">nil</span>&nbsp;<span class="op" id="4110316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4110320">return</span>&nbsp;<span class="ident" id="4110327">nil</span><span class="op" id="4110330">,</span>&nbsp;<span class="ident" id="4110332"><a href="/crypto/rsa/pkcs1v15.go.html#4110271">err</a></span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4110337">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4110340">valid</span><span class="op" id="4110345">,</span>&nbsp;<span class="ident" id="4110347"><a href="/crypto/rsa/pkcs1v15.go.html#4110242">out</a></span><span class="op" id="4110350">,</span>&nbsp;<span class="ident" id="4110352">index</span><span class="op" id="4110357">,</span>&nbsp;<span class="ident" id="4110359"><a href="/crypto/rsa/pkcs1v15.go.html#4110254">err</a></span>&nbsp;<span class="op" id="4110363">:=</span>&nbsp;<span class="ident" id="4110366"><a href="/crypto/rsa/pkcs1v15.go.html#4112517">decryptPKCS1v15</a></span><span class="op" id="4110381">(</span><span class="ident" id="4110382"><a href="/crypto/rsa/pkcs1v15.go.html#4110188">rand</a></span><span class="op" id="4110386">,</span>&nbsp;<span class="ident" id="4110388"><a href="/crypto/rsa/pkcs1v15.go.html#4110204">priv</a></span><span class="op" id="4110392">,</span>&nbsp;<span class="ident" id="4110394"><a href="/crypto/rsa/pkcs1v15.go.html#4110222">ciphertext</a></span><span class="op" id="4110404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4110407">if</span>&nbsp;<span class="ident" id="4110410"><a href="/crypto/rsa/pkcs1v15.go.html#4110254">err</a></span>&nbsp;<span class="op" id="4110414">!=</span>&nbsp;<span class="ident" id="4110417">nil</span>&nbsp;<span class="op" id="4110421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4110425">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4110433">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4110436">if</span>&nbsp;<span class="ident" id="4110439"><a href="/crypto/rsa/pkcs1v15.go.html#4110340">valid</a></span>&nbsp;<span class="op" id="4110445">==</span>&nbsp;<span class="num" id="4110448">0</span>&nbsp;<span class="op" id="4110450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4110454">return</span>&nbsp;<span class="ident" id="4110461">nil</span><span class="op" id="4110464">,</span>&nbsp;<span class="ident" id="4110466"><a href="/crypto/rsa/rsa.go.html#4136391">ErrDecryption</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4110481">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4110484"><a href="/crypto/rsa/pkcs1v15.go.html#4110242">out</a></span>&nbsp;<span class="op" id="4110488">=</span>&nbsp;<span class="ident" id="4110490"><a href="/crypto/rsa/pkcs1v15.go.html#4110242">out</a></span><span class="op" id="4110493">[</span><span class="ident" id="4110494"><a href="/crypto/rsa/pkcs1v15.go.html#4110352">index</a></span><span class="op" id="4110499">:</span><span class="op" id="4110500">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4110503">return</span><br>
<span class="lineno">65</span><span class="op" id="4110510">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4110513">//&nbsp;DecryptPKCS1v15SessionKey&nbsp;decrypts&nbsp;a&nbsp;session&nbsp;key&nbsp;using&nbsp;RSA&nbsp;and&nbsp;the&nbsp;padding&nbsp;scheme&nbsp;from&nbsp;PKCS#1&nbsp;v1.5.</span><br>
<span class="lineno"></span><span class="comment" id="4110616">//&nbsp;If&nbsp;rand&nbsp;!=&nbsp;nil,&nbsp;it&nbsp;uses&nbsp;RSA&nbsp;blinding&nbsp;to&nbsp;avoid&nbsp;timing&nbsp;side-channel&nbsp;attacks.</span><br>
<span class="lineno"></span><span class="comment" id="4110694">//&nbsp;It&nbsp;returns&nbsp;an&nbsp;error&nbsp;if&nbsp;the&nbsp;ciphertext&nbsp;is&nbsp;the&nbsp;wrong&nbsp;length&nbsp;or&nbsp;if&nbsp;the</span><br>
<span class="lineno">70</span><span class="comment" id="4110765">//&nbsp;ciphertext&nbsp;is&nbsp;greater&nbsp;than&nbsp;the&nbsp;public&nbsp;modulus.&nbsp;Otherwise,&nbsp;no&nbsp;error&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="4110838">//&nbsp;returned.&nbsp;If&nbsp;the&nbsp;padding&nbsp;is&nbsp;valid,&nbsp;the&nbsp;resulting&nbsp;plaintext&nbsp;message&nbsp;is&nbsp;copied</span><br>
<span class="lineno"></span><span class="comment" id="4110918">//&nbsp;into&nbsp;key.&nbsp;Otherwise,&nbsp;key&nbsp;is&nbsp;unchanged.&nbsp;These&nbsp;alternatives&nbsp;occur&nbsp;in&nbsp;constant</span><br>
<span class="lineno"></span><span class="comment" id="4110997">//&nbsp;time.&nbsp;It&nbsp;is&nbsp;intended&nbsp;that&nbsp;the&nbsp;user&nbsp;of&nbsp;this&nbsp;function&nbsp;generate&nbsp;a&nbsp;random</span><br>
<span class="lineno"></span><span class="comment" id="4111070">//&nbsp;session&nbsp;key&nbsp;beforehand&nbsp;and&nbsp;continue&nbsp;the&nbsp;protocol&nbsp;with&nbsp;the&nbsp;resulting&nbsp;value.</span><br>
<span class="lineno">75</span><span class="comment" id="4111148">//&nbsp;This&nbsp;will&nbsp;remove&nbsp;any&nbsp;possibility&nbsp;that&nbsp;an&nbsp;attacker&nbsp;can&nbsp;learn&nbsp;any&nbsp;information</span><br>
<span class="lineno"></span><span class="comment" id="4111227">//&nbsp;about&nbsp;the&nbsp;plaintext.</span><br>
<span class="lineno"></span><span class="comment" id="4111251">//&nbsp;See&nbsp;``Chosen&nbsp;Ciphertext&nbsp;Attacks&nbsp;Against&nbsp;Protocols&nbsp;Based&nbsp;on&nbsp;the&nbsp;RSA</span><br>
<span class="lineno"></span><span class="comment" id="4111321">//&nbsp;Encryption&nbsp;Standard&nbsp;PKCS&nbsp;#1&#39;&#39;,&nbsp;Daniel&nbsp;Bleichenbacher,&nbsp;Advances&nbsp;in&nbsp;Cryptology</span><br>
<span class="lineno"></span><span class="comment" id="4111401">//&nbsp;(Crypto&nbsp;&#39;98).</span><br>
<span class="lineno">80</span><span class="keyword" id="4111418">func</span>&nbsp;<span class="ident" id="4111423">DecryptPKCS1v15SessionKey</span><span class="op" id="4111448">(</span><span class="ident" id="4111449">rand</span>&nbsp;<span class="ident" id="4111454"><a href="/crypto/rsa/pkcs1v15.go.html#4108982">io</a></span><span class="op" id="4111456">.</span><span class="ident" id="4111457">Reader</span><span class="op" id="4111463">,</span>&nbsp;<span class="ident" id="4111465">priv</span>&nbsp;<span class="op" id="4111470">*</span><span class="ident" id="4111471"><a href="/crypto/rsa/rsa.go.html#4128208">PrivateKey</a></span><span class="op" id="4111481">,</span>&nbsp;<span class="ident" id="4111483">ciphertext</span>&nbsp;<span class="op" id="4111494">[</span><span class="op" id="4111495">]</span><span class="builtintype" id="4111496">byte</span><span class="op" id="4111500">,</span>&nbsp;<span class="ident" id="4111502">key</span>&nbsp;<span class="op" id="4111506">[</span><span class="op" id="4111507">]</span><span class="builtintype" id="4111508">byte</span><span class="op" id="4111512">)</span>&nbsp;<span class="op" id="4111514">(</span><span class="ident" id="4111515">err</span>&nbsp;<span class="builtintype" id="4111519">error</span><span class="op" id="4111524">)</span>&nbsp;<span class="op" id="4111526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4111529">if</span>&nbsp;<span class="ident" id="4111532">err</span>&nbsp;<span class="op" id="4111536">:=</span>&nbsp;<span class="ident" id="4111539"><a href="/crypto/rsa/rsa.go.html#4127961">checkPub</a></span><span class="op" id="4111547">(</span><span class="op" id="4111548">&amp;</span><span class="ident" id="4111549"><a href="/crypto/rsa/pkcs1v15.go.html#4111465">priv</a></span><span class="op" id="4111553">.</span><span class="ident" id="4111554">PublicKey</span><span class="op" id="4111563">)</span><span class="op" id="4111564">;</span>&nbsp;<span class="ident" id="4111566"><a href="/crypto/rsa/pkcs1v15.go.html#4111532">err</a></span>&nbsp;<span class="op" id="4111570">!=</span>&nbsp;<span class="ident" id="4111573">nil</span>&nbsp;<span class="op" id="4111577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4111581">return</span>&nbsp;<span class="ident" id="4111588"><a href="/crypto/rsa/pkcs1v15.go.html#4111532">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4111593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4111596">k</span>&nbsp;<span class="op" id="4111598">:=</span>&nbsp;<span class="op" id="4111601">(</span><span class="ident" id="4111602"><a href="/crypto/rsa/pkcs1v15.go.html#4111465">priv</a></span><span class="op" id="4111606">.</span><span class="ident" id="4111607">N</span><span class="op" id="4111608">.</span><span class="ident" id="4111609">BitLen</span><span class="op" id="4111615">(</span><span class="op" id="4111616">)</span>&nbsp;<span class="op" id="4111618">+</span>&nbsp;<span class="num" id="4111620">7</span><span class="op" id="4111621">)</span>&nbsp;<span class="op" id="4111623">/</span>&nbsp;<span class="num" id="4111625">8</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4111628">if</span>&nbsp;<span class="ident" id="4111631"><a href="/crypto/rsa/pkcs1v15.go.html#4111596">k</a></span><span class="op" id="4111632">-</span><span class="op" id="4111633">(</span><span class="builtinfunc" id="4111634">len</span><span class="op" id="4111637">(</span><span class="ident" id="4111638"><a href="/crypto/rsa/pkcs1v15.go.html#4111502">key</a></span><span class="op" id="4111641">)</span><span class="op" id="4111642">+</span><span class="num" id="4111643">3</span><span class="op" id="4111644">+</span><span class="num" id="4111645">8</span><span class="op" id="4111646">)</span>&nbsp;<span class="op" id="4111648">&lt;</span>&nbsp;<span class="num" id="4111650">0</span>&nbsp;<span class="op" id="4111652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4111656">return</span>&nbsp;<span class="ident" id="4111663"><a href="/crypto/rsa/rsa.go.html#4136391">ErrDecryption</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4111678">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4111682">valid</span><span class="op" id="4111687">,</span>&nbsp;<span class="ident" id="4111689">em</span><span class="op" id="4111691">,</span>&nbsp;<span class="ident" id="4111693">index</span><span class="op" id="4111698">,</span>&nbsp;<span class="ident" id="4111700"><a href="/crypto/rsa/pkcs1v15.go.html#4111515">err</a></span>&nbsp;<span class="op" id="4111704">:=</span>&nbsp;<span class="ident" id="4111707"><a href="/crypto/rsa/pkcs1v15.go.html#4112517">decryptPKCS1v15</a></span><span class="op" id="4111722">(</span><span class="ident" id="4111723"><a href="/crypto/rsa/pkcs1v15.go.html#4111449">rand</a></span><span class="op" id="4111727">,</span>&nbsp;<span class="ident" id="4111729"><a href="/crypto/rsa/pkcs1v15.go.html#4111465">priv</a></span><span class="op" id="4111733">,</span>&nbsp;<span class="ident" id="4111735"><a href="/crypto/rsa/pkcs1v15.go.html#4111483">ciphertext</a></span><span class="op" id="4111745">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4111748">if</span>&nbsp;<span class="ident" id="4111751"><a href="/crypto/rsa/pkcs1v15.go.html#4111515">err</a></span>&nbsp;<span class="op" id="4111755">!=</span>&nbsp;<span class="ident" id="4111758">nil</span>&nbsp;<span class="op" id="4111762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4111766">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4111774">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4111778">if</span>&nbsp;<span class="builtinfunc" id="4111781">len</span><span class="op" id="4111784">(</span><span class="ident" id="4111785"><a href="/crypto/rsa/pkcs1v15.go.html#4111689">em</a></span><span class="op" id="4111787">)</span>&nbsp;<span class="op" id="4111789">!=</span>&nbsp;<span class="ident" id="4111792"><a href="/crypto/rsa/pkcs1v15.go.html#4111596">k</a></span>&nbsp;<span class="op" id="4111794">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4111798">//&nbsp;This&nbsp;should&nbsp;be&nbsp;impossible&nbsp;because&nbsp;decryptPKCS1v15&nbsp;always</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4111860">//&nbsp;returns&nbsp;the&nbsp;full&nbsp;slice.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4111889">return</span>&nbsp;<span class="ident" id="4111896"><a href="/crypto/rsa/rsa.go.html#4136391">ErrDecryption</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4111911">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4111915"><a href="/crypto/rsa/pkcs1v15.go.html#4111682">valid</a></span>&nbsp;<span class="op" id="4111921">&amp;=</span>&nbsp;<span class="ident" id="4111924"><a href="/crypto/rsa/pkcs1v15.go.html#4108955">subtle</a></span><span class="op" id="4111930">.</span><span class="ident" id="4111931">ConstantTimeEq</span><span class="op" id="4111945">(</span><span class="builtintype" id="4111946">int32</span><span class="op" id="4111951">(</span><span class="builtinfunc" id="4111952">len</span><span class="op" id="4111955">(</span><span class="ident" id="4111956"><a href="/crypto/rsa/pkcs1v15.go.html#4111689">em</a></span><span class="op" id="4111958">)</span><span class="op" id="4111959">-</span><span class="ident" id="4111960"><a href="/crypto/rsa/pkcs1v15.go.html#4111693">index</a></span><span class="op" id="4111965">)</span><span class="op" id="4111966">,</span>&nbsp;<span class="builtintype" id="4111968">int32</span><span class="op" id="4111973">(</span><span class="builtinfunc" id="4111974">len</span><span class="op" id="4111977">(</span><span class="ident" id="4111978"><a href="/crypto/rsa/pkcs1v15.go.html#4111502">key</a></span><span class="op" id="4111981">)</span><span class="op" id="4111982">)</span><span class="op" id="4111983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4111986"><a href="/crypto/rsa/pkcs1v15.go.html#4108955">subtle</a></span><span class="op" id="4111992">.</span><span class="ident" id="4111993">ConstantTimeCopy</span><span class="op" id="4112009">(</span><span class="ident" id="4112010"><a href="/crypto/rsa/pkcs1v15.go.html#4111682">valid</a></span><span class="op" id="4112015">,</span>&nbsp;<span class="ident" id="4112017"><a href="/crypto/rsa/pkcs1v15.go.html#4111502">key</a></span><span class="op" id="4112020">,</span>&nbsp;<span class="ident" id="4112022"><a href="/crypto/rsa/pkcs1v15.go.html#4111689">em</a></span><span class="op" id="4112024">[</span><span class="builtinfunc" id="4112025">len</span><span class="op" id="4112028">(</span><span class="ident" id="4112029"><a href="/crypto/rsa/pkcs1v15.go.html#4111689">em</a></span><span class="op" id="4112031">)</span><span class="op" id="4112032">-</span><span class="builtinfunc" id="4112033">len</span><span class="op" id="4112036">(</span><span class="ident" id="4112037"><a href="/crypto/rsa/pkcs1v15.go.html#4111502">key</a></span><span class="op" id="4112040">)</span><span class="op" id="4112041">:</span><span class="op" id="4112042">]</span><span class="op" id="4112043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4112046">return</span><br>
<span class="lineno"></span><span class="op" id="4112053">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="4112056">//&nbsp;decryptPKCS1v15&nbsp;decrypts&nbsp;ciphertext&nbsp;using&nbsp;priv&nbsp;and&nbsp;blinds&nbsp;the&nbsp;operation&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="4112134">//&nbsp;rand&nbsp;is&nbsp;not&nbsp;nil.&nbsp;It&nbsp;returns&nbsp;one&nbsp;or&nbsp;zero&nbsp;in&nbsp;valid&nbsp;that&nbsp;indicates&nbsp;whether&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4112213">//&nbsp;plaintext&nbsp;was&nbsp;correctly&nbsp;structured.&nbsp;In&nbsp;either&nbsp;case,&nbsp;the&nbsp;plaintext&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="4112285">//&nbsp;returned&nbsp;in&nbsp;em&nbsp;so&nbsp;that&nbsp;it&nbsp;may&nbsp;be&nbsp;read&nbsp;independently&nbsp;of&nbsp;whether&nbsp;it&nbsp;was&nbsp;valid</span><br>
<span class="lineno"></span><span class="comment" id="4112364">//&nbsp;in&nbsp;order&nbsp;to&nbsp;maintain&nbsp;constant&nbsp;memory&nbsp;access&nbsp;patterns.&nbsp;If&nbsp;the&nbsp;plaintext&nbsp;was</span><br>
<span class="lineno">110</span><span class="comment" id="4112442">//&nbsp;valid&nbsp;then&nbsp;index&nbsp;contains&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;original&nbsp;message&nbsp;in&nbsp;em.</span><br>
<span class="lineno"></span><span class="keyword" id="4112512">func</span>&nbsp;<span class="ident" id="4112517">decryptPKCS1v15</span><span class="op" id="4112532">(</span><span class="ident" id="4112533">rand</span>&nbsp;<span class="ident" id="4112538"><a href="/crypto/rsa/pkcs1v15.go.html#4108982">io</a></span><span class="op" id="4112540">.</span><span class="ident" id="4112541">Reader</span><span class="op" id="4112547">,</span>&nbsp;<span class="ident" id="4112549">priv</span>&nbsp;<span class="op" id="4112554">*</span><span class="ident" id="4112555"><a href="/crypto/rsa/rsa.go.html#4128208">PrivateKey</a></span><span class="op" id="4112565">,</span>&nbsp;<span class="ident" id="4112567">ciphertext</span>&nbsp;<span class="op" id="4112578">[</span><span class="op" id="4112579">]</span><span class="builtintype" id="4112580">byte</span><span class="op" id="4112584">)</span>&nbsp;<span class="op" id="4112586">(</span><span class="ident" id="4112587">valid</span>&nbsp;<span class="builtintype" id="4112593">int</span><span class="op" id="4112596">,</span>&nbsp;<span class="ident" id="4112598">em</span>&nbsp;<span class="op" id="4112601">[</span><span class="op" id="4112602">]</span><span class="builtintype" id="4112603">byte</span><span class="op" id="4112607">,</span>&nbsp;<span class="ident" id="4112609">index</span>&nbsp;<span class="builtintype" id="4112615">int</span><span class="op" id="4112618">,</span>&nbsp;<span class="ident" id="4112620">err</span>&nbsp;<span class="builtintype" id="4112624">error</span><span class="op" id="4112629">)</span>&nbsp;<span class="op" id="4112631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4112634">k</span>&nbsp;<span class="op" id="4112636">:=</span>&nbsp;<span class="op" id="4112639">(</span><span class="ident" id="4112640"><a href="/crypto/rsa/pkcs1v15.go.html#4112549">priv</a></span><span class="op" id="4112644">.</span><span class="ident" id="4112645">N</span><span class="op" id="4112646">.</span><span class="ident" id="4112647">BitLen</span><span class="op" id="4112653">(</span><span class="op" id="4112654">)</span>&nbsp;<span class="op" id="4112656">+</span>&nbsp;<span class="num" id="4112658">7</span><span class="op" id="4112659">)</span>&nbsp;<span class="op" id="4112661">/</span>&nbsp;<span class="num" id="4112663">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4112666">if</span>&nbsp;<span class="ident" id="4112669"><a href="/crypto/rsa/pkcs1v15.go.html#4112634">k</a></span>&nbsp;<span class="op" id="4112671">&lt;</span>&nbsp;<span class="num" id="4112673">11</span>&nbsp;<span class="op" id="4112676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4112680"><a href="/crypto/rsa/pkcs1v15.go.html#4112620">err</a></span>&nbsp;<span class="op" id="4112684">=</span>&nbsp;<span class="ident" id="4112686"><a href="/crypto/rsa/rsa.go.html#4136391">ErrDecryption</a></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4112702">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4112710">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4112714">c</span>&nbsp;<span class="op" id="4112716">:=</span>&nbsp;<span class="builtinfunc" id="4112719">new</span><span class="op" id="4112722">(</span><span class="ident" id="4112723"><a href="/crypto/rsa/pkcs1v15.go.html#4108988">big</a></span><span class="op" id="4112726">.</span><span class="ident" id="4112727">Int</span><span class="op" id="4112730">)</span><span class="op" id="4112731">.</span><span class="ident" id="4112732">SetBytes</span><span class="op" id="4112740">(</span><span class="ident" id="4112741"><a href="/crypto/rsa/pkcs1v15.go.html#4112567">ciphertext</a></span><span class="op" id="4112751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4112754">m</span><span class="op" id="4112755">,</span>&nbsp;<span class="ident" id="4112757"><a href="/crypto/rsa/pkcs1v15.go.html#4112620">err</a></span>&nbsp;<span class="op" id="4112761">:=</span>&nbsp;<span class="ident" id="4112764"><a href="/crypto/rsa/rsa.go.html#4138388">decrypt</a></span><span class="op" id="4112771">(</span><span class="ident" id="4112772"><a href="/crypto/rsa/pkcs1v15.go.html#4112533">rand</a></span><span class="op" id="4112776">,</span>&nbsp;<span class="ident" id="4112778"><a href="/crypto/rsa/pkcs1v15.go.html#4112549">priv</a></span><span class="op" id="4112782">,</span>&nbsp;<span class="ident" id="4112784"><a href="/crypto/rsa/pkcs1v15.go.html#4112714">c</a></span><span class="op" id="4112785">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4112788">if</span>&nbsp;<span class="ident" id="4112791"><a href="/crypto/rsa/pkcs1v15.go.html#4112620">err</a></span>&nbsp;<span class="op" id="4112795">!=</span>&nbsp;<span class="ident" id="4112798">nil</span>&nbsp;<span class="op" id="4112802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4112806">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4112814">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4112818"><a href="/crypto/rsa/pkcs1v15.go.html#4112598">em</a></span>&nbsp;<span class="op" id="4112821">=</span>&nbsp;<span class="ident" id="4112823"><a href="/crypto/rsa/rsa.go.html#4142518">leftPad</a></span><span class="op" id="4112830">(</span><span class="ident" id="4112831"><a href="/crypto/rsa/pkcs1v15.go.html#4112754">m</a></span><span class="op" id="4112832">.</span><span class="ident" id="4112833">Bytes</span><span class="op" id="4112838">(</span><span class="op" id="4112839">)</span><span class="op" id="4112840">,</span>&nbsp;<span class="ident" id="4112842"><a href="/crypto/rsa/pkcs1v15.go.html#4112634">k</a></span><span class="op" id="4112843">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4112846">firstByteIsZero</span>&nbsp;<span class="op" id="4112862">:=</span>&nbsp;<span class="ident" id="4112865"><a href="/crypto/rsa/pkcs1v15.go.html#4108955">subtle</a></span><span class="op" id="4112871">.</span><span class="ident" id="4112872">ConstantTimeByteEq</span><span class="op" id="4112890">(</span><span class="ident" id="4112891"><a href="/crypto/rsa/pkcs1v15.go.html#4112598">em</a></span><span class="op" id="4112893">[</span><span class="num" id="4112894">0</span><span class="op" id="4112895">]</span><span class="op" id="4112896">,</span>&nbsp;<span class="num" id="4112898">0</span><span class="op" id="4112899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4112902">secondByteIsTwo</span>&nbsp;<span class="op" id="4112918">:=</span>&nbsp;<span class="ident" id="4112921"><a href="/crypto/rsa/pkcs1v15.go.html#4108955">subtle</a></span><span class="op" id="4112927">.</span><span class="ident" id="4112928">ConstantTimeByteEq</span><span class="op" id="4112946">(</span><span class="ident" id="4112947"><a href="/crypto/rsa/pkcs1v15.go.html#4112598">em</a></span><span class="op" id="4112949">[</span><span class="num" id="4112950">1</span><span class="op" id="4112951">]</span><span class="op" id="4112952">,</span>&nbsp;<span class="num" id="4112954">2</span><span class="op" id="4112955">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4112959">//&nbsp;The&nbsp;remainder&nbsp;of&nbsp;the&nbsp;plaintext&nbsp;must&nbsp;be&nbsp;a&nbsp;string&nbsp;of&nbsp;non-zero&nbsp;random</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4113030">//&nbsp;octets,&nbsp;followed&nbsp;by&nbsp;a&nbsp;0,&nbsp;followed&nbsp;by&nbsp;the&nbsp;message.</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4113084">//&nbsp;&nbsp;&nbsp;lookingForIndex:&nbsp;1&nbsp;iff&nbsp;we&nbsp;are&nbsp;still&nbsp;looking&nbsp;for&nbsp;the&nbsp;zero.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4113148">//&nbsp;&nbsp;&nbsp;index:&nbsp;the&nbsp;offset&nbsp;of&nbsp;the&nbsp;first&nbsp;zero&nbsp;byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4113196">lookingForIndex</span>&nbsp;<span class="op" id="4113212">:=</span>&nbsp;<span class="num" id="4113215">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4113219">for</span>&nbsp;<span class="ident" id="4113223">i</span>&nbsp;<span class="op" id="4113225">:=</span>&nbsp;<span class="num" id="4113228">2</span><span class="op" id="4113229">;</span>&nbsp;<span class="ident" id="4113231"><a href="/crypto/rsa/pkcs1v15.go.html#4113223">i</a></span>&nbsp;<span class="op" id="4113233">&lt;</span>&nbsp;<span class="builtinfunc" id="4113235">len</span><span class="op" id="4113238">(</span><span class="ident" id="4113239"><a href="/crypto/rsa/pkcs1v15.go.html#4112598">em</a></span><span class="op" id="4113241">)</span><span class="op" id="4113242">;</span>&nbsp;<span class="ident" id="4113244"><a href="/crypto/rsa/pkcs1v15.go.html#4113223">i</a></span><span class="op" id="4113245">++</span>&nbsp;<span class="op" id="4113248">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4113252">equals0</span>&nbsp;<span class="op" id="4113260">:=</span>&nbsp;<span class="ident" id="4113263"><a href="/crypto/rsa/pkcs1v15.go.html#4108955">subtle</a></span><span class="op" id="4113269">.</span><span class="ident" id="4113270">ConstantTimeByteEq</span><span class="op" id="4113288">(</span><span class="ident" id="4113289"><a href="/crypto/rsa/pkcs1v15.go.html#4112598">em</a></span><span class="op" id="4113291">[</span><span class="ident" id="4113292"><a href="/crypto/rsa/pkcs1v15.go.html#4113223">i</a></span><span class="op" id="4113293">]</span><span class="op" id="4113294">,</span>&nbsp;<span class="num" id="4113296">0</span><span class="op" id="4113297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4113301"><a href="/crypto/rsa/pkcs1v15.go.html#4112609">index</a></span>&nbsp;<span class="op" id="4113307">=</span>&nbsp;<span class="ident" id="4113309"><a href="/crypto/rsa/pkcs1v15.go.html#4108955">subtle</a></span><span class="op" id="4113315">.</span><span class="ident" id="4113316">ConstantTimeSelect</span><span class="op" id="4113334">(</span><span class="ident" id="4113335"><a href="/crypto/rsa/pkcs1v15.go.html#4113196">lookingForIndex</a></span><span class="op" id="4113350">&amp;</span><span class="ident" id="4113351"><a href="/crypto/rsa/pkcs1v15.go.html#4113252">equals0</a></span><span class="op" id="4113358">,</span>&nbsp;<span class="ident" id="4113360"><a href="/crypto/rsa/pkcs1v15.go.html#4113223">i</a></span><span class="op" id="4113361">,</span>&nbsp;<span class="ident" id="4113363"><a href="/crypto/rsa/pkcs1v15.go.html#4112609">index</a></span><span class="op" id="4113368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4113372"><a href="/crypto/rsa/pkcs1v15.go.html#4113196">lookingForIndex</a></span>&nbsp;<span class="op" id="4113388">=</span>&nbsp;<span class="ident" id="4113390"><a href="/crypto/rsa/pkcs1v15.go.html#4108955">subtle</a></span><span class="op" id="4113396">.</span><span class="ident" id="4113397">ConstantTimeSelect</span><span class="op" id="4113415">(</span><span class="ident" id="4113416"><a href="/crypto/rsa/pkcs1v15.go.html#4113252">equals0</a></span><span class="op" id="4113423">,</span>&nbsp;<span class="num" id="4113425">0</span><span class="op" id="4113426">,</span>&nbsp;<span class="ident" id="4113428"><a href="/crypto/rsa/pkcs1v15.go.html#4113196">lookingForIndex</a></span><span class="op" id="4113443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4113446">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4113450">//&nbsp;The&nbsp;PS&nbsp;padding&nbsp;must&nbsp;be&nbsp;at&nbsp;least&nbsp;8&nbsp;bytes&nbsp;long,&nbsp;and&nbsp;it&nbsp;starts&nbsp;two</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4113518">//&nbsp;bytes&nbsp;into&nbsp;em.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4113537">validPS</span>&nbsp;<span class="op" id="4113545">:=</span>&nbsp;<span class="ident" id="4113548"><a href="/crypto/rsa/pkcs1v15.go.html#4108955">subtle</a></span><span class="op" id="4113554">.</span><span class="ident" id="4113555">ConstantTimeLessOrEq</span><span class="op" id="4113575">(</span><span class="num" id="4113576">2</span><span class="op" id="4113577">+</span><span class="num" id="4113578">8</span><span class="op" id="4113579">,</span>&nbsp;<span class="ident" id="4113581"><a href="/crypto/rsa/pkcs1v15.go.html#4112609">index</a></span><span class="op" id="4113586">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4113590"><a href="/crypto/rsa/pkcs1v15.go.html#4112587">valid</a></span>&nbsp;<span class="op" id="4113596">=</span>&nbsp;<span class="ident" id="4113598"><a href="/crypto/rsa/pkcs1v15.go.html#4112846">firstByteIsZero</a></span>&nbsp;<span class="op" id="4113614">&amp;</span>&nbsp;<span class="ident" id="4113616"><a href="/crypto/rsa/pkcs1v15.go.html#4112902">secondByteIsTwo</a></span>&nbsp;<span class="op" id="4113632">&amp;</span>&nbsp;<span class="op" id="4113634">(</span><span class="op" id="4113635">^</span><span class="ident" id="4113636"><a href="/crypto/rsa/pkcs1v15.go.html#4113196">lookingForIndex</a></span>&nbsp;<span class="op" id="4113652">&amp;</span>&nbsp;<span class="num" id="4113654">1</span><span class="op" id="4113655">)</span>&nbsp;<span class="op" id="4113657">&amp;</span>&nbsp;<span class="ident" id="4113659"><a href="/crypto/rsa/pkcs1v15.go.html#4113537">validPS</a></span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4113668"><a href="/crypto/rsa/pkcs1v15.go.html#4112609">index</a></span>&nbsp;<span class="op" id="4113674">=</span>&nbsp;<span class="ident" id="4113676"><a href="/crypto/rsa/pkcs1v15.go.html#4108955">subtle</a></span><span class="op" id="4113682">.</span><span class="ident" id="4113683">ConstantTimeSelect</span><span class="op" id="4113701">(</span><span class="ident" id="4113702"><a href="/crypto/rsa/pkcs1v15.go.html#4112587">valid</a></span><span class="op" id="4113707">,</span>&nbsp;<span class="ident" id="4113709"><a href="/crypto/rsa/pkcs1v15.go.html#4112609">index</a></span><span class="op" id="4113714">+</span><span class="num" id="4113715">1</span><span class="op" id="4113716">,</span>&nbsp;<span class="num" id="4113718">0</span><span class="op" id="4113719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4113722">return</span>&nbsp;<span class="ident" id="4113729"><a href="/crypto/rsa/pkcs1v15.go.html#4112587">valid</a></span><span class="op" id="4113734">,</span>&nbsp;<span class="ident" id="4113736"><a href="/crypto/rsa/pkcs1v15.go.html#4112598">em</a></span><span class="op" id="4113738">,</span>&nbsp;<span class="ident" id="4113740"><a href="/crypto/rsa/pkcs1v15.go.html#4112609">index</a></span><span class="op" id="4113745">,</span>&nbsp;<span class="ident" id="4113747">nil</span><br>
<span class="lineno"></span><span class="op" id="4113751">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4113754">//&nbsp;nonZeroRandomBytes&nbsp;fills&nbsp;the&nbsp;given&nbsp;slice&nbsp;with&nbsp;non-zero&nbsp;random&nbsp;octets.</span><br>
<span class="lineno">150</span><span class="keyword" id="4113827">func</span>&nbsp;<span class="ident" id="4113832">nonZeroRandomBytes</span><span class="op" id="4113850">(</span><span class="ident" id="4113851">s</span>&nbsp;<span class="op" id="4113853">[</span><span class="op" id="4113854">]</span><span class="builtintype" id="4113855">byte</span><span class="op" id="4113859">,</span>&nbsp;<span class="ident" id="4113861">rand</span>&nbsp;<span class="ident" id="4113866"><a href="/crypto/rsa/pkcs1v15.go.html#4108982">io</a></span><span class="op" id="4113868">.</span><span class="ident" id="4113869">Reader</span><span class="op" id="4113875">)</span>&nbsp;<span class="op" id="4113877">(</span><span class="ident" id="4113878">err</span>&nbsp;<span class="builtintype" id="4113882">error</span><span class="op" id="4113887">)</span>&nbsp;<span class="op" id="4113889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4113892">_</span><span class="op" id="4113893">,</span>&nbsp;<span class="ident" id="4113895"><a href="/crypto/rsa/pkcs1v15.go.html#4113878">err</a></span>&nbsp;<span class="op" id="4113899">=</span>&nbsp;<span class="ident" id="4113901"><a href="/crypto/rsa/pkcs1v15.go.html#4108982">io</a></span><span class="op" id="4113903">.</span><span class="ident" id="4113904">ReadFull</span><span class="op" id="4113912">(</span><span class="ident" id="4113913"><a href="/crypto/rsa/pkcs1v15.go.html#4113861">rand</a></span><span class="op" id="4113917">,</span>&nbsp;<span class="ident" id="4113919"><a href="/crypto/rsa/pkcs1v15.go.html#4113851">s</a></span><span class="op" id="4113920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4113923">if</span>&nbsp;<span class="ident" id="4113926"><a href="/crypto/rsa/pkcs1v15.go.html#4113878">err</a></span>&nbsp;<span class="op" id="4113930">!=</span>&nbsp;<span class="ident" id="4113933">nil</span>&nbsp;<span class="op" id="4113937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4113941">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4113949">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4113953">for</span>&nbsp;<span class="ident" id="4113957">i</span>&nbsp;<span class="op" id="4113959">:=</span>&nbsp;<span class="num" id="4113962">0</span><span class="op" id="4113963">;</span>&nbsp;<span class="ident" id="4113965"><a href="/crypto/rsa/pkcs1v15.go.html#4113957">i</a></span>&nbsp;<span class="op" id="4113967">&lt;</span>&nbsp;<span class="builtinfunc" id="4113969">len</span><span class="op" id="4113972">(</span><span class="ident" id="4113973"><a href="/crypto/rsa/pkcs1v15.go.html#4113851">s</a></span><span class="op" id="4113974">)</span><span class="op" id="4113975">;</span>&nbsp;<span class="ident" id="4113977"><a href="/crypto/rsa/pkcs1v15.go.html#4113957">i</a></span><span class="op" id="4113978">++</span>&nbsp;<span class="op" id="4113981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4113985">for</span>&nbsp;<span class="ident" id="4113989"><a href="/crypto/rsa/pkcs1v15.go.html#4113851">s</a></span><span class="op" id="4113990">[</span><span class="ident" id="4113991"><a href="/crypto/rsa/pkcs1v15.go.html#4113957">i</a></span><span class="op" id="4113992">]</span>&nbsp;<span class="op" id="4113994">==</span>&nbsp;<span class="num" id="4113997">0</span>&nbsp;<span class="op" id="4113999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4114004">_</span><span class="op" id="4114005">,</span>&nbsp;<span class="ident" id="4114007"><a href="/crypto/rsa/pkcs1v15.go.html#4113878">err</a></span>&nbsp;<span class="op" id="4114011">=</span>&nbsp;<span class="ident" id="4114013"><a href="/crypto/rsa/pkcs1v15.go.html#4108982">io</a></span><span class="op" id="4114015">.</span><span class="ident" id="4114016">ReadFull</span><span class="op" id="4114024">(</span><span class="ident" id="4114025"><a href="/crypto/rsa/pkcs1v15.go.html#4113861">rand</a></span><span class="op" id="4114029">,</span>&nbsp;<span class="ident" id="4114031"><a href="/crypto/rsa/pkcs1v15.go.html#4113851">s</a></span><span class="op" id="4114032">[</span><span class="ident" id="4114033"><a href="/crypto/rsa/pkcs1v15.go.html#4113957">i</a></span><span class="op" id="4114034">:</span><span class="ident" id="4114035"><a href="/crypto/rsa/pkcs1v15.go.html#4113957">i</a></span><span class="op" id="4114036">+</span><span class="num" id="4114037">1</span><span class="op" id="4114038">]</span><span class="op" id="4114039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4114044">if</span>&nbsp;<span class="ident" id="4114047"><a href="/crypto/rsa/pkcs1v15.go.html#4113878">err</a></span>&nbsp;<span class="op" id="4114051">!=</span>&nbsp;<span class="ident" id="4114054">nil</span>&nbsp;<span class="op" id="4114058">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4114064">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4114074">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4114079">//&nbsp;In&nbsp;tests,&nbsp;the&nbsp;PRNG&nbsp;may&nbsp;return&nbsp;all&nbsp;zeros&nbsp;so&nbsp;we&nbsp;do</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4114134">//&nbsp;this&nbsp;to&nbsp;break&nbsp;the&nbsp;loop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4114164"><a href="/crypto/rsa/pkcs1v15.go.html#4113851">s</a></span><span class="op" id="4114165">[</span><span class="ident" id="4114166"><a href="/crypto/rsa/pkcs1v15.go.html#4113957">i</a></span><span class="op" id="4114167">]</span>&nbsp;<span class="op" id="4114169">^=</span>&nbsp;<span class="num" id="4114172">0x42</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4114179">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4114182">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4114186">return</span><br>
<span class="lineno"></span><span class="op" id="4114193">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="comment" id="4114196">//&nbsp;These&nbsp;are&nbsp;ASN1&nbsp;DER&nbsp;structures:</span><br>
<span class="lineno"></span><span class="comment" id="4114230">//&nbsp;&nbsp;&nbsp;DigestInfo&nbsp;::=&nbsp;SEQUENCE&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="4114261">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;digestAlgorithm&nbsp;AlgorithmIdentifier,</span><br>
<span class="lineno"></span><span class="comment" id="4114305">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;digest&nbsp;OCTET&nbsp;STRING</span><br>
<span class="lineno">175</span><span class="comment" id="4114332">//&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="4114339">//&nbsp;For&nbsp;performance,&nbsp;we&nbsp;don&#39;t&nbsp;use&nbsp;the&nbsp;generic&nbsp;ASN1&nbsp;encoder.&nbsp;Rather,&nbsp;we</span><br>
<span class="lineno"></span><span class="comment" id="4114409">//&nbsp;precompute&nbsp;a&nbsp;prefix&nbsp;of&nbsp;the&nbsp;digest&nbsp;value&nbsp;that&nbsp;makes&nbsp;a&nbsp;valid&nbsp;ASN1&nbsp;DER&nbsp;string</span><br>
<span class="lineno"></span><span class="comment" id="4114487">//&nbsp;with&nbsp;the&nbsp;correct&nbsp;contents.</span><br>
<span class="lineno"></span><span class="keyword" id="4114517">var</span>&nbsp;<span class="ident" id="4114521">hashPrefixes</span>&nbsp;<span class="op" id="4114534">=</span>&nbsp;<span class="keyword" id="4114536">map</span><span class="op" id="4114539">[</span><span class="ident" id="4114540"><a href="/crypto/rsa/pkcs1v15.go.html#4108945">crypto</a></span><span class="op" id="4114546">.</span><span class="ident" id="4114547">Hash</span><span class="op" id="4114551">]</span><span class="op" id="4114552">[</span><span class="op" id="4114553">]</span><span class="builtintype" id="4114554">byte</span><span class="op" id="4114558">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4114561"><a href="/crypto/rsa/pkcs1v15.go.html#4108945">crypto</a></span><span class="op" id="4114567">.</span><span class="ident" id="4114568">MD5</span><span class="op" id="4114571">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4114579">{</span><span class="num" id="4114580">0x30</span><span class="op" id="4114584">,</span>&nbsp;<span class="num" id="4114586">0x20</span><span class="op" id="4114590">,</span>&nbsp;<span class="num" id="4114592">0x30</span><span class="op" id="4114596">,</span>&nbsp;<span class="num" id="4114598">0x0c</span><span class="op" id="4114602">,</span>&nbsp;<span class="num" id="4114604">0x06</span><span class="op" id="4114608">,</span>&nbsp;<span class="num" id="4114610">0x08</span><span class="op" id="4114614">,</span>&nbsp;<span class="num" id="4114616">0x2a</span><span class="op" id="4114620">,</span>&nbsp;<span class="num" id="4114622">0x86</span><span class="op" id="4114626">,</span>&nbsp;<span class="num" id="4114628">0x48</span><span class="op" id="4114632">,</span>&nbsp;<span class="num" id="4114634">0x86</span><span class="op" id="4114638">,</span>&nbsp;<span class="num" id="4114640">0xf7</span><span class="op" id="4114644">,</span>&nbsp;<span class="num" id="4114646">0x0d</span><span class="op" id="4114650">,</span>&nbsp;<span class="num" id="4114652">0x02</span><span class="op" id="4114656">,</span>&nbsp;<span class="num" id="4114658">0x05</span><span class="op" id="4114662">,</span>&nbsp;<span class="num" id="4114664">0x05</span><span class="op" id="4114668">,</span>&nbsp;<span class="num" id="4114670">0x00</span><span class="op" id="4114674">,</span>&nbsp;<span class="num" id="4114676">0x04</span><span class="op" id="4114680">,</span>&nbsp;<span class="num" id="4114682">0x10</span><span class="op" id="4114686">}</span><span class="op" id="4114687">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4114690"><a href="/crypto/rsa/pkcs1v15.go.html#4108945">crypto</a></span><span class="op" id="4114696">.</span><span class="ident" id="4114697">SHA1</span><span class="op" id="4114701">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4114708">{</span><span class="num" id="4114709">0x30</span><span class="op" id="4114713">,</span>&nbsp;<span class="num" id="4114715">0x21</span><span class="op" id="4114719">,</span>&nbsp;<span class="num" id="4114721">0x30</span><span class="op" id="4114725">,</span>&nbsp;<span class="num" id="4114727">0x09</span><span class="op" id="4114731">,</span>&nbsp;<span class="num" id="4114733">0x06</span><span class="op" id="4114737">,</span>&nbsp;<span class="num" id="4114739">0x05</span><span class="op" id="4114743">,</span>&nbsp;<span class="num" id="4114745">0x2b</span><span class="op" id="4114749">,</span>&nbsp;<span class="num" id="4114751">0x0e</span><span class="op" id="4114755">,</span>&nbsp;<span class="num" id="4114757">0x03</span><span class="op" id="4114761">,</span>&nbsp;<span class="num" id="4114763">0x02</span><span class="op" id="4114767">,</span>&nbsp;<span class="num" id="4114769">0x1a</span><span class="op" id="4114773">,</span>&nbsp;<span class="num" id="4114775">0x05</span><span class="op" id="4114779">,</span>&nbsp;<span class="num" id="4114781">0x00</span><span class="op" id="4114785">,</span>&nbsp;<span class="num" id="4114787">0x04</span><span class="op" id="4114791">,</span>&nbsp;<span class="num" id="4114793">0x14</span><span class="op" id="4114797">}</span><span class="op" id="4114798">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4114801"><a href="/crypto/rsa/pkcs1v15.go.html#4108945">crypto</a></span><span class="op" id="4114807">.</span><span class="ident" id="4114808">SHA224</span><span class="op" id="4114814">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4114819">{</span><span class="num" id="4114820">0x30</span><span class="op" id="4114824">,</span>&nbsp;<span class="num" id="4114826">0x2d</span><span class="op" id="4114830">,</span>&nbsp;<span class="num" id="4114832">0x30</span><span class="op" id="4114836">,</span>&nbsp;<span class="num" id="4114838">0x0d</span><span class="op" id="4114842">,</span>&nbsp;<span class="num" id="4114844">0x06</span><span class="op" id="4114848">,</span>&nbsp;<span class="num" id="4114850">0x09</span><span class="op" id="4114854">,</span>&nbsp;<span class="num" id="4114856">0x60</span><span class="op" id="4114860">,</span>&nbsp;<span class="num" id="4114862">0x86</span><span class="op" id="4114866">,</span>&nbsp;<span class="num" id="4114868">0x48</span><span class="op" id="4114872">,</span>&nbsp;<span class="num" id="4114874">0x01</span><span class="op" id="4114878">,</span>&nbsp;<span class="num" id="4114880">0x65</span><span class="op" id="4114884">,</span>&nbsp;<span class="num" id="4114886">0x03</span><span class="op" id="4114890">,</span>&nbsp;<span class="num" id="4114892">0x04</span><span class="op" id="4114896">,</span>&nbsp;<span class="num" id="4114898">0x02</span><span class="op" id="4114902">,</span>&nbsp;<span class="num" id="4114904">0x04</span><span class="op" id="4114908">,</span>&nbsp;<span class="num" id="4114910">0x05</span><span class="op" id="4114914">,</span>&nbsp;<span class="num" id="4114916">0x00</span><span class="op" id="4114920">,</span>&nbsp;<span class="num" id="4114922">0x04</span><span class="op" id="4114926">,</span>&nbsp;<span class="num" id="4114928">0x1c</span><span class="op" id="4114932">}</span><span class="op" id="4114933">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4114936"><a href="/crypto/rsa/pkcs1v15.go.html#4108945">crypto</a></span><span class="op" id="4114942">.</span><span class="ident" id="4114943">SHA256</span><span class="op" id="4114949">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4114954">{</span><span class="num" id="4114955">0x30</span><span class="op" id="4114959">,</span>&nbsp;<span class="num" id="4114961">0x31</span><span class="op" id="4114965">,</span>&nbsp;<span class="num" id="4114967">0x30</span><span class="op" id="4114971">,</span>&nbsp;<span class="num" id="4114973">0x0d</span><span class="op" id="4114977">,</span>&nbsp;<span class="num" id="4114979">0x06</span><span class="op" id="4114983">,</span>&nbsp;<span class="num" id="4114985">0x09</span><span class="op" id="4114989">,</span>&nbsp;<span class="num" id="4114991">0x60</span><span class="op" id="4114995">,</span>&nbsp;<span class="num" id="4114997">0x86</span><span class="op" id="4115001">,</span>&nbsp;<span class="num" id="4115003">0x48</span><span class="op" id="4115007">,</span>&nbsp;<span class="num" id="4115009">0x01</span><span class="op" id="4115013">,</span>&nbsp;<span class="num" id="4115015">0x65</span><span class="op" id="4115019">,</span>&nbsp;<span class="num" id="4115021">0x03</span><span class="op" id="4115025">,</span>&nbsp;<span class="num" id="4115027">0x04</span><span class="op" id="4115031">,</span>&nbsp;<span class="num" id="4115033">0x02</span><span class="op" id="4115037">,</span>&nbsp;<span class="num" id="4115039">0x01</span><span class="op" id="4115043">,</span>&nbsp;<span class="num" id="4115045">0x05</span><span class="op" id="4115049">,</span>&nbsp;<span class="num" id="4115051">0x00</span><span class="op" id="4115055">,</span>&nbsp;<span class="num" id="4115057">0x04</span><span class="op" id="4115061">,</span>&nbsp;<span class="num" id="4115063">0x20</span><span class="op" id="4115067">}</span><span class="op" id="4115068">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4115071"><a href="/crypto/rsa/pkcs1v15.go.html#4108945">crypto</a></span><span class="op" id="4115077">.</span><span class="ident" id="4115078">SHA384</span><span class="op" id="4115084">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4115089">{</span><span class="num" id="4115090">0x30</span><span class="op" id="4115094">,</span>&nbsp;<span class="num" id="4115096">0x41</span><span class="op" id="4115100">,</span>&nbsp;<span class="num" id="4115102">0x30</span><span class="op" id="4115106">,</span>&nbsp;<span class="num" id="4115108">0x0d</span><span class="op" id="4115112">,</span>&nbsp;<span class="num" id="4115114">0x06</span><span class="op" id="4115118">,</span>&nbsp;<span class="num" id="4115120">0x09</span><span class="op" id="4115124">,</span>&nbsp;<span class="num" id="4115126">0x60</span><span class="op" id="4115130">,</span>&nbsp;<span class="num" id="4115132">0x86</span><span class="op" id="4115136">,</span>&nbsp;<span class="num" id="4115138">0x48</span><span class="op" id="4115142">,</span>&nbsp;<span class="num" id="4115144">0x01</span><span class="op" id="4115148">,</span>&nbsp;<span class="num" id="4115150">0x65</span><span class="op" id="4115154">,</span>&nbsp;<span class="num" id="4115156">0x03</span><span class="op" id="4115160">,</span>&nbsp;<span class="num" id="4115162">0x04</span><span class="op" id="4115166">,</span>&nbsp;<span class="num" id="4115168">0x02</span><span class="op" id="4115172">,</span>&nbsp;<span class="num" id="4115174">0x02</span><span class="op" id="4115178">,</span>&nbsp;<span class="num" id="4115180">0x05</span><span class="op" id="4115184">,</span>&nbsp;<span class="num" id="4115186">0x00</span><span class="op" id="4115190">,</span>&nbsp;<span class="num" id="4115192">0x04</span><span class="op" id="4115196">,</span>&nbsp;<span class="num" id="4115198">0x30</span><span class="op" id="4115202">}</span><span class="op" id="4115203">,</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4115206"><a href="/crypto/rsa/pkcs1v15.go.html#4108945">crypto</a></span><span class="op" id="4115212">.</span><span class="ident" id="4115213">SHA512</span><span class="op" id="4115219">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4115224">{</span><span class="num" id="4115225">0x30</span><span class="op" id="4115229">,</span>&nbsp;<span class="num" id="4115231">0x51</span><span class="op" id="4115235">,</span>&nbsp;<span class="num" id="4115237">0x30</span><span class="op" id="4115241">,</span>&nbsp;<span class="num" id="4115243">0x0d</span><span class="op" id="4115247">,</span>&nbsp;<span class="num" id="4115249">0x06</span><span class="op" id="4115253">,</span>&nbsp;<span class="num" id="4115255">0x09</span><span class="op" id="4115259">,</span>&nbsp;<span class="num" id="4115261">0x60</span><span class="op" id="4115265">,</span>&nbsp;<span class="num" id="4115267">0x86</span><span class="op" id="4115271">,</span>&nbsp;<span class="num" id="4115273">0x48</span><span class="op" id="4115277">,</span>&nbsp;<span class="num" id="4115279">0x01</span><span class="op" id="4115283">,</span>&nbsp;<span class="num" id="4115285">0x65</span><span class="op" id="4115289">,</span>&nbsp;<span class="num" id="4115291">0x03</span><span class="op" id="4115295">,</span>&nbsp;<span class="num" id="4115297">0x04</span><span class="op" id="4115301">,</span>&nbsp;<span class="num" id="4115303">0x02</span><span class="op" id="4115307">,</span>&nbsp;<span class="num" id="4115309">0x03</span><span class="op" id="4115313">,</span>&nbsp;<span class="num" id="4115315">0x05</span><span class="op" id="4115319">,</span>&nbsp;<span class="num" id="4115321">0x00</span><span class="op" id="4115325">,</span>&nbsp;<span class="num" id="4115327">0x04</span><span class="op" id="4115331">,</span>&nbsp;<span class="num" id="4115333">0x40</span><span class="op" id="4115337">}</span><span class="op" id="4115338">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4115341"><a href="/crypto/rsa/pkcs1v15.go.html#4108945">crypto</a></span><span class="op" id="4115347">.</span><span class="ident" id="4115348">MD5SHA1</span><span class="op" id="4115355">:</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4115359">{</span><span class="op" id="4115360">}</span><span class="op" id="4115361">,</span>&nbsp;<span class="comment" id="4115363">//&nbsp;A&nbsp;special&nbsp;TLS&nbsp;case&nbsp;which&nbsp;doesn&#39;t&nbsp;use&nbsp;an&nbsp;ASN1&nbsp;prefix.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4115420"><a href="/crypto/rsa/pkcs1v15.go.html#4108945">crypto</a></span><span class="op" id="4115426">.</span><span class="ident" id="4115427">RIPEMD160</span><span class="op" id="4115436">:</span>&nbsp;<span class="op" id="4115438">{</span><span class="num" id="4115439">0x30</span><span class="op" id="4115443">,</span>&nbsp;<span class="num" id="4115445">0x20</span><span class="op" id="4115449">,</span>&nbsp;<span class="num" id="4115451">0x30</span><span class="op" id="4115455">,</span>&nbsp;<span class="num" id="4115457">0x08</span><span class="op" id="4115461">,</span>&nbsp;<span class="num" id="4115463">0x06</span><span class="op" id="4115467">,</span>&nbsp;<span class="num" id="4115469">0x06</span><span class="op" id="4115473">,</span>&nbsp;<span class="num" id="4115475">0x28</span><span class="op" id="4115479">,</span>&nbsp;<span class="num" id="4115481">0xcf</span><span class="op" id="4115485">,</span>&nbsp;<span class="num" id="4115487">0x06</span><span class="op" id="4115491">,</span>&nbsp;<span class="num" id="4115493">0x03</span><span class="op" id="4115497">,</span>&nbsp;<span class="num" id="4115499">0x00</span><span class="op" id="4115503">,</span>&nbsp;<span class="num" id="4115505">0x31</span><span class="op" id="4115509">,</span>&nbsp;<span class="num" id="4115511">0x04</span><span class="op" id="4115515">,</span>&nbsp;<span class="num" id="4115517">0x14</span><span class="op" id="4115521">}</span><span class="op" id="4115522">,</span><br>
<span class="lineno"></span><span class="op" id="4115524">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="comment" id="4115527">//&nbsp;SignPKCS1v15&nbsp;calculates&nbsp;the&nbsp;signature&nbsp;of&nbsp;hashed&nbsp;using&nbsp;RSASSA-PKCS1-V1_5-SIGN&nbsp;from&nbsp;RSA&nbsp;PKCS#1&nbsp;v1.5.</span><br>
<span class="lineno"></span><span class="comment" id="4115629">//&nbsp;Note&nbsp;that&nbsp;hashed&nbsp;must&nbsp;be&nbsp;the&nbsp;result&nbsp;of&nbsp;hashing&nbsp;the&nbsp;input&nbsp;message&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4115707">//&nbsp;given&nbsp;hash&nbsp;function.&nbsp;If&nbsp;hash&nbsp;is&nbsp;zero,&nbsp;hashed&nbsp;is&nbsp;signed&nbsp;directly.&nbsp;This&nbsp;isn&#39;t</span><br>
<span class="lineno"></span><span class="comment" id="4115786">//&nbsp;advisable&nbsp;except&nbsp;for&nbsp;interoperability.</span><br>
<span class="lineno"></span><span class="keyword" id="4115828">func</span>&nbsp;<span class="ident" id="4115833">SignPKCS1v15</span><span class="op" id="4115845">(</span><span class="ident" id="4115846">rand</span>&nbsp;<span class="ident" id="4115851"><a href="/crypto/rsa/pkcs1v15.go.html#4108982">io</a></span><span class="op" id="4115853">.</span><span class="ident" id="4115854">Reader</span><span class="op" id="4115860">,</span>&nbsp;<span class="ident" id="4115862">priv</span>&nbsp;<span class="op" id="4115867">*</span><span class="ident" id="4115868"><a href="/crypto/rsa/rsa.go.html#4128208">PrivateKey</a></span><span class="op" id="4115878">,</span>&nbsp;<span class="ident" id="4115880">hash</span>&nbsp;<span class="ident" id="4115885"><a href="/crypto/rsa/pkcs1v15.go.html#4108945">crypto</a></span><span class="op" id="4115891">.</span><span class="ident" id="4115892">Hash</span><span class="op" id="4115896">,</span>&nbsp;<span class="ident" id="4115898">hashed</span>&nbsp;<span class="op" id="4115905">[</span><span class="op" id="4115906">]</span><span class="builtintype" id="4115907">byte</span><span class="op" id="4115911">)</span>&nbsp;<span class="op" id="4115913">(</span><span class="ident" id="4115914">s</span>&nbsp;<span class="op" id="4115916">[</span><span class="op" id="4115917">]</span><span class="builtintype" id="4115918">byte</span><span class="op" id="4115922">,</span>&nbsp;<span class="ident" id="4115924">err</span>&nbsp;<span class="builtintype" id="4115928">error</span><span class="op" id="4115933">)</span>&nbsp;<span class="op" id="4115935">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4115938">hashLen</span><span class="op" id="4115945">,</span>&nbsp;<span class="ident" id="4115947">prefix</span><span class="op" id="4115953">,</span>&nbsp;<span class="ident" id="4115955"><a href="/crypto/rsa/pkcs1v15.go.html#4115924">err</a></span>&nbsp;<span class="op" id="4115959">:=</span>&nbsp;<span class="ident" id="4115962"><a href="/crypto/rsa/pkcs1v15.go.html#4117664">pkcs1v15HashInfo</a></span><span class="op" id="4115978">(</span><span class="ident" id="4115979"><a href="/crypto/rsa/pkcs1v15.go.html#4115880">hash</a></span><span class="op" id="4115983">,</span>&nbsp;<span class="builtinfunc" id="4115985">len</span><span class="op" id="4115988">(</span><span class="ident" id="4115989"><a href="/crypto/rsa/pkcs1v15.go.html#4115898">hashed</a></span><span class="op" id="4115995">)</span><span class="op" id="4115996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4115999">if</span>&nbsp;<span class="ident" id="4116002"><a href="/crypto/rsa/pkcs1v15.go.html#4115924">err</a></span>&nbsp;<span class="op" id="4116006">!=</span>&nbsp;<span class="ident" id="4116009">nil</span>&nbsp;<span class="op" id="4116013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4116017">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4116025">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4116029">tLen</span>&nbsp;<span class="op" id="4116034">:=</span>&nbsp;<span class="builtinfunc" id="4116037">len</span><span class="op" id="4116040">(</span><span class="ident" id="4116041"><a href="/crypto/rsa/pkcs1v15.go.html#4115947">prefix</a></span><span class="op" id="4116047">)</span>&nbsp;<span class="op" id="4116049">+</span>&nbsp;<span class="ident" id="4116051"><a href="/crypto/rsa/pkcs1v15.go.html#4115938">hashLen</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4116060">k</span>&nbsp;<span class="op" id="4116062">:=</span>&nbsp;<span class="op" id="4116065">(</span><span class="ident" id="4116066"><a href="/crypto/rsa/pkcs1v15.go.html#4115862">priv</a></span><span class="op" id="4116070">.</span><span class="ident" id="4116071">N</span><span class="op" id="4116072">.</span><span class="ident" id="4116073">BitLen</span><span class="op" id="4116079">(</span><span class="op" id="4116080">)</span>&nbsp;<span class="op" id="4116082">+</span>&nbsp;<span class="num" id="4116084">7</span><span class="op" id="4116085">)</span>&nbsp;<span class="op" id="4116087">/</span>&nbsp;<span class="num" id="4116089">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4116092">if</span>&nbsp;<span class="ident" id="4116095"><a href="/crypto/rsa/pkcs1v15.go.html#4116060">k</a></span>&nbsp;<span class="op" id="4116097">&lt;</span>&nbsp;<span class="ident" id="4116099"><a href="/crypto/rsa/pkcs1v15.go.html#4116029">tLen</a></span><span class="op" id="4116103">+</span><span class="num" id="4116104">11</span>&nbsp;<span class="op" id="4116107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4116111">return</span>&nbsp;<span class="ident" id="4116118">nil</span><span class="op" id="4116121">,</span>&nbsp;<span class="ident" id="4116123"><a href="/crypto/rsa/rsa.go.html#4134992">ErrMessageTooLong</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4116142">}</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4116146">//&nbsp;EM&nbsp;=&nbsp;0x00&nbsp;||&nbsp;0x01&nbsp;||&nbsp;PS&nbsp;||&nbsp;0x00&nbsp;||&nbsp;T</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4116187">em</span>&nbsp;<span class="op" id="4116190">:=</span>&nbsp;<span class="builtinfunc" id="4116193">make</span><span class="op" id="4116197">(</span><span class="op" id="4116198">[</span><span class="op" id="4116199">]</span><span class="builtintype" id="4116200">byte</span><span class="op" id="4116204">,</span>&nbsp;<span class="ident" id="4116206"><a href="/crypto/rsa/pkcs1v15.go.html#4116060">k</a></span><span class="op" id="4116207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4116210"><a href="/crypto/rsa/pkcs1v15.go.html#4116187">em</a></span><span class="op" id="4116212">[</span><span class="num" id="4116213">1</span><span class="op" id="4116214">]</span>&nbsp;<span class="op" id="4116216">=</span>&nbsp;<span class="num" id="4116218">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4116221">for</span>&nbsp;<span class="ident" id="4116225">i</span>&nbsp;<span class="op" id="4116227">:=</span>&nbsp;<span class="num" id="4116230">2</span><span class="op" id="4116231">;</span>&nbsp;<span class="ident" id="4116233"><a href="/crypto/rsa/pkcs1v15.go.html#4116225">i</a></span>&nbsp;<span class="op" id="4116235">&lt;</span>&nbsp;<span class="ident" id="4116237"><a href="/crypto/rsa/pkcs1v15.go.html#4116060">k</a></span><span class="op" id="4116238">-</span><span class="ident" id="4116239"><a href="/crypto/rsa/pkcs1v15.go.html#4116029">tLen</a></span><span class="op" id="4116243">-</span><span class="num" id="4116244">1</span><span class="op" id="4116245">;</span>&nbsp;<span class="ident" id="4116247"><a href="/crypto/rsa/pkcs1v15.go.html#4116225">i</a></span><span class="op" id="4116248">++</span>&nbsp;<span class="op" id="4116251">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4116255"><a href="/crypto/rsa/pkcs1v15.go.html#4116187">em</a></span><span class="op" id="4116257">[</span><span class="ident" id="4116258"><a href="/crypto/rsa/pkcs1v15.go.html#4116225">i</a></span><span class="op" id="4116259">]</span>&nbsp;<span class="op" id="4116261">=</span>&nbsp;<span class="num" id="4116263">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4116269">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4116272">copy</span><span class="op" id="4116276">(</span><span class="ident" id="4116277"><a href="/crypto/rsa/pkcs1v15.go.html#4116187">em</a></span><span class="op" id="4116279">[</span><span class="ident" id="4116280"><a href="/crypto/rsa/pkcs1v15.go.html#4116060">k</a></span><span class="op" id="4116281">-</span><span class="ident" id="4116282"><a href="/crypto/rsa/pkcs1v15.go.html#4116029">tLen</a></span><span class="op" id="4116286">:</span><span class="ident" id="4116287"><a href="/crypto/rsa/pkcs1v15.go.html#4116060">k</a></span><span class="op" id="4116288">-</span><span class="ident" id="4116289"><a href="/crypto/rsa/pkcs1v15.go.html#4115938">hashLen</a></span><span class="op" id="4116296">]</span><span class="op" id="4116297">,</span>&nbsp;<span class="ident" id="4116299"><a href="/crypto/rsa/pkcs1v15.go.html#4115947">prefix</a></span><span class="op" id="4116305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4116308">copy</span><span class="op" id="4116312">(</span><span class="ident" id="4116313"><a href="/crypto/rsa/pkcs1v15.go.html#4116187">em</a></span><span class="op" id="4116315">[</span><span class="ident" id="4116316"><a href="/crypto/rsa/pkcs1v15.go.html#4116060">k</a></span><span class="op" id="4116317">-</span><span class="ident" id="4116318"><a href="/crypto/rsa/pkcs1v15.go.html#4115938">hashLen</a></span><span class="op" id="4116325">:</span><span class="ident" id="4116326"><a href="/crypto/rsa/pkcs1v15.go.html#4116060">k</a></span><span class="op" id="4116327">]</span><span class="op" id="4116328">,</span>&nbsp;<span class="ident" id="4116330"><a href="/crypto/rsa/pkcs1v15.go.html#4115898">hashed</a></span><span class="op" id="4116336">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4116340">m</span>&nbsp;<span class="op" id="4116342">:=</span>&nbsp;<span class="builtinfunc" id="4116345">new</span><span class="op" id="4116348">(</span><span class="ident" id="4116349"><a href="/crypto/rsa/pkcs1v15.go.html#4108988">big</a></span><span class="op" id="4116352">.</span><span class="ident" id="4116353">Int</span><span class="op" id="4116356">)</span><span class="op" id="4116357">.</span><span class="ident" id="4116358">SetBytes</span><span class="op" id="4116366">(</span><span class="ident" id="4116367"><a href="/crypto/rsa/pkcs1v15.go.html#4116187">em</a></span><span class="op" id="4116369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4116372">c</span><span class="op" id="4116373">,</span>&nbsp;<span class="ident" id="4116375"><a href="/crypto/rsa/pkcs1v15.go.html#4115924">err</a></span>&nbsp;<span class="op" id="4116379">:=</span>&nbsp;<span class="ident" id="4116382"><a href="/crypto/rsa/rsa.go.html#4138388">decrypt</a></span><span class="op" id="4116389">(</span><span class="ident" id="4116390"><a href="/crypto/rsa/pkcs1v15.go.html#4115846">rand</a></span><span class="op" id="4116394">,</span>&nbsp;<span class="ident" id="4116396"><a href="/crypto/rsa/pkcs1v15.go.html#4115862">priv</a></span><span class="op" id="4116400">,</span>&nbsp;<span class="ident" id="4116402"><a href="/crypto/rsa/pkcs1v15.go.html#4116340">m</a></span><span class="op" id="4116403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4116406">if</span>&nbsp;<span class="ident" id="4116409"><a href="/crypto/rsa/pkcs1v15.go.html#4115924">err</a></span>&nbsp;<span class="op" id="4116413">!=</span>&nbsp;<span class="ident" id="4116416">nil</span>&nbsp;<span class="op" id="4116420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4116424">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4116432">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4116436"><a href="/crypto/rsa/pkcs1v15.go.html#4118229">copyWithLeftPad</a></span><span class="op" id="4116451">(</span><span class="ident" id="4116452"><a href="/crypto/rsa/pkcs1v15.go.html#4116187">em</a></span><span class="op" id="4116454">,</span>&nbsp;<span class="ident" id="4116456"><a href="/crypto/rsa/pkcs1v15.go.html#4116372">c</a></span><span class="op" id="4116457">.</span><span class="ident" id="4116458">Bytes</span><span class="op" id="4116463">(</span><span class="op" id="4116464">)</span><span class="op" id="4116465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4116468"><a href="/crypto/rsa/pkcs1v15.go.html#4115914">s</a></span>&nbsp;<span class="op" id="4116470">=</span>&nbsp;<span class="ident" id="4116472"><a href="/crypto/rsa/pkcs1v15.go.html#4116187">em</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4116476">return</span><br>
<span class="lineno"></span><span class="op" id="4116483">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="comment" id="4116486">//&nbsp;VerifyPKCS1v15&nbsp;verifies&nbsp;an&nbsp;RSA&nbsp;PKCS#1&nbsp;v1.5&nbsp;signature.</span><br>
<span class="lineno"></span><span class="comment" id="4116543">//&nbsp;hashed&nbsp;is&nbsp;the&nbsp;result&nbsp;of&nbsp;hashing&nbsp;the&nbsp;input&nbsp;message&nbsp;using&nbsp;the&nbsp;given&nbsp;hash</span><br>
<span class="lineno"></span><span class="comment" id="4116617">//&nbsp;function&nbsp;and&nbsp;sig&nbsp;is&nbsp;the&nbsp;signature.&nbsp;A&nbsp;valid&nbsp;signature&nbsp;is&nbsp;indicated&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="4116689">//&nbsp;returning&nbsp;a&nbsp;nil&nbsp;error.&nbsp;If&nbsp;hash&nbsp;is&nbsp;zero&nbsp;then&nbsp;hashed&nbsp;is&nbsp;used&nbsp;directly.&nbsp;This</span><br>
<span class="lineno">230</span><span class="comment" id="4116766">//&nbsp;isn&#39;t&nbsp;advisable&nbsp;except&nbsp;for&nbsp;interoperability.</span><br>
<span class="lineno"></span><span class="keyword" id="4116814">func</span>&nbsp;<span class="ident" id="4116819">VerifyPKCS1v15</span><span class="op" id="4116833">(</span><span class="ident" id="4116834">pub</span>&nbsp;<span class="op" id="4116838">*</span><span class="ident" id="4116839"><a href="/crypto/rsa/rsa.go.html#4127377">PublicKey</a></span><span class="op" id="4116848">,</span>&nbsp;<span class="ident" id="4116850">hash</span>&nbsp;<span class="ident" id="4116855"><a href="/crypto/rsa/pkcs1v15.go.html#4108945">crypto</a></span><span class="op" id="4116861">.</span><span class="ident" id="4116862">Hash</span><span class="op" id="4116866">,</span>&nbsp;<span class="ident" id="4116868">hashed</span>&nbsp;<span class="op" id="4116875">[</span><span class="op" id="4116876">]</span><span class="builtintype" id="4116877">byte</span><span class="op" id="4116881">,</span>&nbsp;<span class="ident" id="4116883">sig</span>&nbsp;<span class="op" id="4116887">[</span><span class="op" id="4116888">]</span><span class="builtintype" id="4116889">byte</span><span class="op" id="4116893">)</span>&nbsp;<span class="op" id="4116895">(</span><span class="ident" id="4116896">err</span>&nbsp;<span class="builtintype" id="4116900">error</span><span class="op" id="4116905">)</span>&nbsp;<span class="op" id="4116907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4116910">hashLen</span><span class="op" id="4116917">,</span>&nbsp;<span class="ident" id="4116919">prefix</span><span class="op" id="4116925">,</span>&nbsp;<span class="ident" id="4116927"><a href="/crypto/rsa/pkcs1v15.go.html#4116896">err</a></span>&nbsp;<span class="op" id="4116931">:=</span>&nbsp;<span class="ident" id="4116934"><a href="/crypto/rsa/pkcs1v15.go.html#4117664">pkcs1v15HashInfo</a></span><span class="op" id="4116950">(</span><span class="ident" id="4116951"><a href="/crypto/rsa/pkcs1v15.go.html#4116850">hash</a></span><span class="op" id="4116955">,</span>&nbsp;<span class="builtinfunc" id="4116957">len</span><span class="op" id="4116960">(</span><span class="ident" id="4116961"><a href="/crypto/rsa/pkcs1v15.go.html#4116868">hashed</a></span><span class="op" id="4116967">)</span><span class="op" id="4116968">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4116971">if</span>&nbsp;<span class="ident" id="4116974"><a href="/crypto/rsa/pkcs1v15.go.html#4116896">err</a></span>&nbsp;<span class="op" id="4116978">!=</span>&nbsp;<span class="ident" id="4116981">nil</span>&nbsp;<span class="op" id="4116985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4116989">return</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4116997">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4117001">tLen</span>&nbsp;<span class="op" id="4117006">:=</span>&nbsp;<span class="builtinfunc" id="4117009">len</span><span class="op" id="4117012">(</span><span class="ident" id="4117013"><a href="/crypto/rsa/pkcs1v15.go.html#4116919">prefix</a></span><span class="op" id="4117019">)</span>&nbsp;<span class="op" id="4117021">+</span>&nbsp;<span class="ident" id="4117023"><a href="/crypto/rsa/pkcs1v15.go.html#4116910">hashLen</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4117032">k</span>&nbsp;<span class="op" id="4117034">:=</span>&nbsp;<span class="op" id="4117037">(</span><span class="ident" id="4117038"><a href="/crypto/rsa/pkcs1v15.go.html#4116834">pub</a></span><span class="op" id="4117041">.</span><span class="ident" id="4117042">N</span><span class="op" id="4117043">.</span><span class="ident" id="4117044">BitLen</span><span class="op" id="4117050">(</span><span class="op" id="4117051">)</span>&nbsp;<span class="op" id="4117053">+</span>&nbsp;<span class="num" id="4117055">7</span><span class="op" id="4117056">)</span>&nbsp;<span class="op" id="4117058">/</span>&nbsp;<span class="num" id="4117060">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4117063">if</span>&nbsp;<span class="ident" id="4117066"><a href="/crypto/rsa/pkcs1v15.go.html#4117032">k</a></span>&nbsp;<span class="op" id="4117068">&lt;</span>&nbsp;<span class="ident" id="4117070"><a href="/crypto/rsa/pkcs1v15.go.html#4117001">tLen</a></span><span class="op" id="4117074">+</span><span class="num" id="4117075">11</span>&nbsp;<span class="op" id="4117078">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4117082"><a href="/crypto/rsa/pkcs1v15.go.html#4116896">err</a></span>&nbsp;<span class="op" id="4117086">=</span>&nbsp;<span class="ident" id="4117088"><a href="/crypto/rsa/rsa.go.html#4136573">ErrVerification</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4117106">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4117114">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4117118">c</span>&nbsp;<span class="op" id="4117120">:=</span>&nbsp;<span class="builtinfunc" id="4117123">new</span><span class="op" id="4117126">(</span><span class="ident" id="4117127"><a href="/crypto/rsa/pkcs1v15.go.html#4108988">big</a></span><span class="op" id="4117130">.</span><span class="ident" id="4117131">Int</span><span class="op" id="4117134">)</span><span class="op" id="4117135">.</span><span class="ident" id="4117136">SetBytes</span><span class="op" id="4117144">(</span><span class="ident" id="4117145"><a href="/crypto/rsa/pkcs1v15.go.html#4116883">sig</a></span><span class="op" id="4117148">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4117151">m</span>&nbsp;<span class="op" id="4117153">:=</span>&nbsp;<span class="ident" id="4117156"><a href="/crypto/rsa/rsa.go.html#4135085">encrypt</a></span><span class="op" id="4117163">(</span><span class="builtinfunc" id="4117164">new</span><span class="op" id="4117167">(</span><span class="ident" id="4117168"><a href="/crypto/rsa/pkcs1v15.go.html#4108988">big</a></span><span class="op" id="4117171">.</span><span class="ident" id="4117172">Int</span><span class="op" id="4117175">)</span><span class="op" id="4117176">,</span>&nbsp;<span class="ident" id="4117178"><a href="/crypto/rsa/pkcs1v15.go.html#4116834">pub</a></span><span class="op" id="4117181">,</span>&nbsp;<span class="ident" id="4117183"><a href="/crypto/rsa/pkcs1v15.go.html#4117118">c</a></span><span class="op" id="4117184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4117187">em</span>&nbsp;<span class="op" id="4117190">:=</span>&nbsp;<span class="ident" id="4117193"><a href="/crypto/rsa/rsa.go.html#4142518">leftPad</a></span><span class="op" id="4117200">(</span><span class="ident" id="4117201"><a href="/crypto/rsa/pkcs1v15.go.html#4117151">m</a></span><span class="op" id="4117202">.</span><span class="ident" id="4117203">Bytes</span><span class="op" id="4117208">(</span><span class="op" id="4117209">)</span><span class="op" id="4117210">,</span>&nbsp;<span class="ident" id="4117212"><a href="/crypto/rsa/pkcs1v15.go.html#4117032">k</a></span><span class="op" id="4117213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4117216">//&nbsp;EM&nbsp;=&nbsp;0x00&nbsp;||&nbsp;0x01&nbsp;||&nbsp;PS&nbsp;||&nbsp;0x00&nbsp;||&nbsp;T</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4117258">ok</span>&nbsp;<span class="op" id="4117261">:=</span>&nbsp;<span class="ident" id="4117264"><a href="/crypto/rsa/pkcs1v15.go.html#4108955">subtle</a></span><span class="op" id="4117270">.</span><span class="ident" id="4117271">ConstantTimeByteEq</span><span class="op" id="4117289">(</span><span class="ident" id="4117290"><a href="/crypto/rsa/pkcs1v15.go.html#4117187">em</a></span><span class="op" id="4117292">[</span><span class="num" id="4117293">0</span><span class="op" id="4117294">]</span><span class="op" id="4117295">,</span>&nbsp;<span class="num" id="4117297">0</span><span class="op" id="4117298">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4117301"><a href="/crypto/rsa/pkcs1v15.go.html#4117258">ok</a></span>&nbsp;<span class="op" id="4117304">&amp;=</span>&nbsp;<span class="ident" id="4117307"><a href="/crypto/rsa/pkcs1v15.go.html#4108955">subtle</a></span><span class="op" id="4117313">.</span><span class="ident" id="4117314">ConstantTimeByteEq</span><span class="op" id="4117332">(</span><span class="ident" id="4117333"><a href="/crypto/rsa/pkcs1v15.go.html#4117187">em</a></span><span class="op" id="4117335">[</span><span class="num" id="4117336">1</span><span class="op" id="4117337">]</span><span class="op" id="4117338">,</span>&nbsp;<span class="num" id="4117340">1</span><span class="op" id="4117341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4117344"><a href="/crypto/rsa/pkcs1v15.go.html#4117258">ok</a></span>&nbsp;<span class="op" id="4117347">&amp;=</span>&nbsp;<span class="ident" id="4117350"><a href="/crypto/rsa/pkcs1v15.go.html#4108955">subtle</a></span><span class="op" id="4117356">.</span><span class="ident" id="4117357">ConstantTimeCompare</span><span class="op" id="4117376">(</span><span class="ident" id="4117377"><a href="/crypto/rsa/pkcs1v15.go.html#4117187">em</a></span><span class="op" id="4117379">[</span><span class="ident" id="4117380"><a href="/crypto/rsa/pkcs1v15.go.html#4117032">k</a></span><span class="op" id="4117381">-</span><span class="ident" id="4117382"><a href="/crypto/rsa/pkcs1v15.go.html#4116910">hashLen</a></span><span class="op" id="4117389">:</span><span class="ident" id="4117390"><a href="/crypto/rsa/pkcs1v15.go.html#4117032">k</a></span><span class="op" id="4117391">]</span><span class="op" id="4117392">,</span>&nbsp;<span class="ident" id="4117394"><a href="/crypto/rsa/pkcs1v15.go.html#4116868">hashed</a></span><span class="op" id="4117400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4117403"><a href="/crypto/rsa/pkcs1v15.go.html#4117258">ok</a></span>&nbsp;<span class="op" id="4117406">&amp;=</span>&nbsp;<span class="ident" id="4117409"><a href="/crypto/rsa/pkcs1v15.go.html#4108955">subtle</a></span><span class="op" id="4117415">.</span><span class="ident" id="4117416">ConstantTimeCompare</span><span class="op" id="4117435">(</span><span class="ident" id="4117436"><a href="/crypto/rsa/pkcs1v15.go.html#4117187">em</a></span><span class="op" id="4117438">[</span><span class="ident" id="4117439"><a href="/crypto/rsa/pkcs1v15.go.html#4117032">k</a></span><span class="op" id="4117440">-</span><span class="ident" id="4117441"><a href="/crypto/rsa/pkcs1v15.go.html#4117001">tLen</a></span><span class="op" id="4117445">:</span><span class="ident" id="4117446"><a href="/crypto/rsa/pkcs1v15.go.html#4117032">k</a></span><span class="op" id="4117447">-</span><span class="ident" id="4117448"><a href="/crypto/rsa/pkcs1v15.go.html#4116910">hashLen</a></span><span class="op" id="4117455">]</span><span class="op" id="4117456">,</span>&nbsp;<span class="ident" id="4117458"><a href="/crypto/rsa/pkcs1v15.go.html#4116919">prefix</a></span><span class="op" id="4117464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4117467"><a href="/crypto/rsa/pkcs1v15.go.html#4117258">ok</a></span>&nbsp;<span class="op" id="4117470">&amp;=</span>&nbsp;<span class="ident" id="4117473"><a href="/crypto/rsa/pkcs1v15.go.html#4108955">subtle</a></span><span class="op" id="4117479">.</span><span class="ident" id="4117480">ConstantTimeByteEq</span><span class="op" id="4117498">(</span><span class="ident" id="4117499"><a href="/crypto/rsa/pkcs1v15.go.html#4117187">em</a></span><span class="op" id="4117501">[</span><span class="ident" id="4117502"><a href="/crypto/rsa/pkcs1v15.go.html#4117032">k</a></span><span class="op" id="4117503">-</span><span class="ident" id="4117504"><a href="/crypto/rsa/pkcs1v15.go.html#4117001">tLen</a></span><span class="op" id="4117508">-</span><span class="num" id="4117509">1</span><span class="op" id="4117510">]</span><span class="op" id="4117511">,</span>&nbsp;<span class="num" id="4117513">0</span><span class="op" id="4117514">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4117518">for</span>&nbsp;<span class="ident" id="4117522">i</span>&nbsp;<span class="op" id="4117524">:=</span>&nbsp;<span class="num" id="4117527">2</span><span class="op" id="4117528">;</span>&nbsp;<span class="ident" id="4117530"><a href="/crypto/rsa/pkcs1v15.go.html#4117522">i</a></span>&nbsp;<span class="op" id="4117532">&lt;</span>&nbsp;<span class="ident" id="4117534"><a href="/crypto/rsa/pkcs1v15.go.html#4117032">k</a></span><span class="op" id="4117535">-</span><span class="ident" id="4117536"><a href="/crypto/rsa/pkcs1v15.go.html#4117001">tLen</a></span><span class="op" id="4117540">-</span><span class="num" id="4117541">1</span><span class="op" id="4117542">;</span>&nbsp;<span class="ident" id="4117544"><a href="/crypto/rsa/pkcs1v15.go.html#4117522">i</a></span><span class="op" id="4117545">++</span>&nbsp;<span class="op" id="4117548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4117552"><a href="/crypto/rsa/pkcs1v15.go.html#4117258">ok</a></span>&nbsp;<span class="op" id="4117555">&amp;=</span>&nbsp;<span class="ident" id="4117558"><a href="/crypto/rsa/pkcs1v15.go.html#4108955">subtle</a></span><span class="op" id="4117564">.</span><span class="ident" id="4117565">ConstantTimeByteEq</span><span class="op" id="4117583">(</span><span class="ident" id="4117584"><a href="/crypto/rsa/pkcs1v15.go.html#4117187">em</a></span><span class="op" id="4117586">[</span><span class="ident" id="4117587"><a href="/crypto/rsa/pkcs1v15.go.html#4117522">i</a></span><span class="op" id="4117588">]</span><span class="op" id="4117589">,</span>&nbsp;<span class="num" id="4117591">0xff</span><span class="op" id="4117595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4117598">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4117602">if</span>&nbsp;<span class="ident" id="4117605"><a href="/crypto/rsa/pkcs1v15.go.html#4117258">ok</a></span>&nbsp;<span class="op" id="4117608">!=</span>&nbsp;<span class="num" id="4117611">1</span>&nbsp;<span class="op" id="4117613">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4117617">return</span>&nbsp;<span class="ident" id="4117624"><a href="/crypto/rsa/rsa.go.html#4136573">ErrVerification</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4117641">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4117645">return</span>&nbsp;<span class="ident" id="4117652">nil</span><br>
<span class="lineno"></span><span class="op" id="4117656">}</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span><span class="keyword" id="4117659">func</span>&nbsp;<span class="ident" id="4117664">pkcs1v15HashInfo</span><span class="op" id="4117680">(</span><span class="ident" id="4117681">hash</span>&nbsp;<span class="ident" id="4117686"><a href="/crypto/rsa/pkcs1v15.go.html#4108945">crypto</a></span><span class="op" id="4117692">.</span><span class="ident" id="4117693">Hash</span><span class="op" id="4117697">,</span>&nbsp;<span class="ident" id="4117699">inLen</span>&nbsp;<span class="builtintype" id="4117705">int</span><span class="op" id="4117708">)</span>&nbsp;<span class="op" id="4117710">(</span><span class="ident" id="4117711">hashLen</span>&nbsp;<span class="builtintype" id="4117719">int</span><span class="op" id="4117722">,</span>&nbsp;<span class="ident" id="4117724">prefix</span>&nbsp;<span class="op" id="4117731">[</span><span class="op" id="4117732">]</span><span class="builtintype" id="4117733">byte</span><span class="op" id="4117737">,</span>&nbsp;<span class="ident" id="4117739">err</span>&nbsp;<span class="builtintype" id="4117743">error</span><span class="op" id="4117748">)</span>&nbsp;<span class="op" id="4117750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4117753">//&nbsp;Special&nbsp;case:&nbsp;crypto.Hash(0)&nbsp;is&nbsp;used&nbsp;to&nbsp;indicate&nbsp;that&nbsp;the&nbsp;data&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4117823">//&nbsp;signed&nbsp;directly.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4117844">if</span>&nbsp;<span class="ident" id="4117847"><a href="/crypto/rsa/pkcs1v15.go.html#4117681">hash</a></span>&nbsp;<span class="op" id="4117852">==</span>&nbsp;<span class="num" id="4117855">0</span>&nbsp;<span class="op" id="4117857">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4117861">return</span>&nbsp;<span class="ident" id="4117868"><a href="/crypto/rsa/pkcs1v15.go.html#4117699">inLen</a></span><span class="op" id="4117873">,</span>&nbsp;<span class="ident" id="4117875">nil</span><span class="op" id="4117878">,</span>&nbsp;<span class="ident" id="4117880">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4117885">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4117889"><a href="/crypto/rsa/pkcs1v15.go.html#4117711">hashLen</a></span>&nbsp;<span class="op" id="4117897">=</span>&nbsp;<span class="ident" id="4117899"><a href="/crypto/rsa/pkcs1v15.go.html#4117681">hash</a></span><span class="op" id="4117903">.</span><span class="ident" id="4117904">Size</span><span class="op" id="4117908">(</span><span class="op" id="4117909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4117912">if</span>&nbsp;<span class="ident" id="4117915"><a href="/crypto/rsa/pkcs1v15.go.html#4117699">inLen</a></span>&nbsp;<span class="op" id="4117921">!=</span>&nbsp;<span class="ident" id="4117924"><a href="/crypto/rsa/pkcs1v15.go.html#4117711">hashLen</a></span>&nbsp;<span class="op" id="4117932">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4117936">return</span>&nbsp;<span class="num" id="4117943">0</span><span class="op" id="4117944">,</span>&nbsp;<span class="ident" id="4117946">nil</span><span class="op" id="4117949">,</span>&nbsp;<span class="ident" id="4117951"><a href="/crypto/rsa/pkcs1v15.go.html#4108972">errors</a></span><span class="op" id="4117957">.</span><span class="ident" id="4117958">New</span><span class="op" id="4117961">(</span><span class="string" id="4117962">&#34;crypto/rsa:&nbsp;input&nbsp;must&nbsp;be&nbsp;hashed&nbsp;message&#34;</span><span class="op" id="4118004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4118007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4118010"><a href="/crypto/rsa/pkcs1v15.go.html#4117724">prefix</a></span><span class="op" id="4118016">,</span>&nbsp;<span class="ident" id="4118018">ok</span>&nbsp;<span class="op" id="4118021">:=</span>&nbsp;<span class="ident" id="4118024"><a href="/crypto/rsa/pkcs1v15.go.html#4114521">hashPrefixes</a></span><span class="op" id="4118036">[</span><span class="ident" id="4118037"><a href="/crypto/rsa/pkcs1v15.go.html#4117681">hash</a></span><span class="op" id="4118041">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4118044">if</span>&nbsp;<span class="op" id="4118047">!</span><span class="ident" id="4118048"><a href="/crypto/rsa/pkcs1v15.go.html#4118018">ok</a></span>&nbsp;<span class="op" id="4118051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4118055">return</span>&nbsp;<span class="num" id="4118062">0</span><span class="op" id="4118063">,</span>&nbsp;<span class="ident" id="4118065">nil</span><span class="op" id="4118068">,</span>&nbsp;<span class="ident" id="4118070"><a href="/crypto/rsa/pkcs1v15.go.html#4108972">errors</a></span><span class="op" id="4118076">.</span><span class="ident" id="4118077">New</span><span class="op" id="4118080">(</span><span class="string" id="4118081">&#34;crypto/rsa:&nbsp;unsupported&nbsp;hash&nbsp;function&#34;</span><span class="op" id="4118120">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4118123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4118126">return</span><br>
<span class="lineno"></span><span class="op" id="4118133">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4118136">//&nbsp;copyWithLeftPad&nbsp;copies&nbsp;src&nbsp;to&nbsp;the&nbsp;end&nbsp;of&nbsp;dest,&nbsp;padding&nbsp;with&nbsp;zero&nbsp;bytes&nbsp;as</span><br>
<span class="lineno">285</span><span class="comment" id="4118213">//&nbsp;needed.</span><br>
<span class="lineno"></span><span class="keyword" id="4118224">func</span>&nbsp;<span class="ident" id="4118229">copyWithLeftPad</span><span class="op" id="4118244">(</span><span class="ident" id="4118245">dest</span><span class="op" id="4118249">,</span>&nbsp;<span class="ident" id="4118251">src</span>&nbsp;<span class="op" id="4118255">[</span><span class="op" id="4118256">]</span><span class="builtintype" id="4118257">byte</span><span class="op" id="4118261">)</span>&nbsp;<span class="op" id="4118263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4118266">numPaddingBytes</span>&nbsp;<span class="op" id="4118282">:=</span>&nbsp;<span class="builtinfunc" id="4118285">len</span><span class="op" id="4118288">(</span><span class="ident" id="4118289"><a href="/crypto/rsa/pkcs1v15.go.html#4118245">dest</a></span><span class="op" id="4118293">)</span>&nbsp;<span class="op" id="4118295">-</span>&nbsp;<span class="builtinfunc" id="4118297">len</span><span class="op" id="4118300">(</span><span class="ident" id="4118301"><a href="/crypto/rsa/pkcs1v15.go.html#4118251">src</a></span><span class="op" id="4118304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4118307">for</span>&nbsp;<span class="ident" id="4118311">i</span>&nbsp;<span class="op" id="4118313">:=</span>&nbsp;<span class="num" id="4118316">0</span><span class="op" id="4118317">;</span>&nbsp;<span class="ident" id="4118319"><a href="/crypto/rsa/pkcs1v15.go.html#4118311">i</a></span>&nbsp;<span class="op" id="4118321">&lt;</span>&nbsp;<span class="ident" id="4118323"><a href="/crypto/rsa/pkcs1v15.go.html#4118266">numPaddingBytes</a></span><span class="op" id="4118338">;</span>&nbsp;<span class="ident" id="4118340"><a href="/crypto/rsa/pkcs1v15.go.html#4118311">i</a></span><span class="op" id="4118341">++</span>&nbsp;<span class="op" id="4118344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4118348"><a href="/crypto/rsa/pkcs1v15.go.html#4118245">dest</a></span><span class="op" id="4118352">[</span><span class="ident" id="4118353"><a href="/crypto/rsa/pkcs1v15.go.html#4118311">i</a></span><span class="op" id="4118354">]</span>&nbsp;<span class="op" id="4118356">=</span>&nbsp;<span class="num" id="4118358">0</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4118361">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4118364">copy</span><span class="op" id="4118368">(</span><span class="ident" id="4118369"><a href="/crypto/rsa/pkcs1v15.go.html#4118245">dest</a></span><span class="op" id="4118373">[</span><span class="ident" id="4118374"><a href="/crypto/rsa/pkcs1v15.go.html#4118266">numPaddingBytes</a></span><span class="op" id="4118389">:</span><span class="op" id="4118390">]</span><span class="op" id="4118391">,</span>&nbsp;<span class="ident" id="4118393"><a href="/crypto/rsa/pkcs1v15.go.html#4118251">src</a></span><span class="op" id="4118396">)</span><br>
<span class="lineno"></span><span class="op" id="4118398">}</span>
</div>
</body>
</html>
