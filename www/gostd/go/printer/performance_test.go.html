<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="8061034">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8061089">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8061143">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="8061194">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;a&nbsp;simple&nbsp;printer&nbsp;performance&nbsp;benchmark:</span><br>
<span class="lineno"></span><span class="comment" id="8061258">//&nbsp;go&nbsp;test&nbsp;-bench=BenchmarkPrint</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8061292">package</span>&nbsp;<span class="ident" id="8061300">printer</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="8061309">import</span>&nbsp;<span class="op" id="8061316">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8061319">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8061328">&#34;go/ast&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8061338">&#34;go/parser&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8061351">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8061357">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8061370">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8061377">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8061387">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="8061390">var</span>&nbsp;<span class="ident" id="8061394">testfile</span>&nbsp;<span class="op" id="8061403">*</span><span class="ident" id="8061404">ast</span><span class="op" id="8061407">.</span><span class="ident" id="8061408">File</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8061414">func</span>&nbsp;<span class="ident" id="8061419">testprint</span><span class="op" id="8061428">(</span><span class="ident" id="8061429">out</span>&nbsp;<span class="ident" id="8061433">io</span><span class="op" id="8061435">.</span><span class="ident" id="8061436">Writer</span><span class="op" id="8061442">,</span>&nbsp;<span class="ident" id="8061444">file</span>&nbsp;<span class="op" id="8061449">*</span><span class="ident" id="8061450">ast</span><span class="op" id="8061453">.</span><span class="ident" id="8061454">File</span><span class="op" id="8061458">)</span>&nbsp;<span class="op" id="8061460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8061463">if</span>&nbsp;<span class="ident" id="8061466">err</span>&nbsp;<span class="op" id="8061470">:=</span>&nbsp;<span class="op" id="8061473">(</span><span class="op" id="8061474">&amp;</span><span class="ident" id="8061475">Config</span><span class="op" id="8061481">{</span><span class="ident" id="8061482">TabIndent</span>&nbsp;<span class="op" id="8061492">|</span>&nbsp;<span class="ident" id="8061494">UseSpaces</span><span class="op" id="8061503">,</span>&nbsp;<span class="num" id="8061505">8</span><span class="op" id="8061506">,</span>&nbsp;<span class="num" id="8061508">0</span><span class="op" id="8061509">}</span><span class="op" id="8061510">)</span><span class="op" id="8061511">.</span><span class="ident" id="8061512">Fprint</span><span class="op" id="8061518">(</span><span class="ident" id="8061519">out</span><span class="op" id="8061522">,</span>&nbsp;<span class="ident" id="8061524">fset</span><span class="op" id="8061528">,</span>&nbsp;<span class="ident" id="8061530">file</span><span class="op" id="8061534">)</span><span class="op" id="8061535">;</span>&nbsp;<span class="ident" id="8061537">err</span>&nbsp;<span class="op" id="8061541">!=</span>&nbsp;<span class="ident" id="8061544">nil</span>&nbsp;<span class="op" id="8061548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8061552">log</span><span class="op" id="8061555">.</span><span class="ident" id="8061556">Fatalf</span><span class="op" id="8061562">(</span><span class="string" id="8061563">&#34;print&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="8061580">,</span>&nbsp;<span class="ident" id="8061582">err</span><span class="op" id="8061585">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8061588">}</span><br>
<span class="lineno"></span><span class="op" id="8061590">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8061593">//&nbsp;cannot&nbsp;initialize&nbsp;in&nbsp;init&nbsp;because&nbsp;(printer)&nbsp;Fprint&nbsp;launches&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="keyword" id="8061668">func</span>&nbsp;<span class="ident" id="8061673">initialize</span><span class="op" id="8061683">(</span><span class="op" id="8061684">)</span>&nbsp;<span class="op" id="8061686">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8061689">const</span>&nbsp;<span class="ident" id="8061695">filename</span>&nbsp;<span class="op" id="8061704">=</span>&nbsp;<span class="string" id="8061706">&#34;testdata/parser.go&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8061729">src</span><span class="op" id="8061732">,</span>&nbsp;<span class="ident" id="8061734">err</span>&nbsp;<span class="op" id="8061738">:=</span>&nbsp;<span class="ident" id="8061741">ioutil</span><span class="op" id="8061747">.</span><span class="ident" id="8061748">ReadFile</span><span class="op" id="8061756">(</span><span class="ident" id="8061757">filename</span><span class="op" id="8061765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8061768">if</span>&nbsp;<span class="ident" id="8061771">err</span>&nbsp;<span class="op" id="8061775">!=</span>&nbsp;<span class="ident" id="8061778">nil</span>&nbsp;<span class="op" id="8061782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8061786">log</span><span class="op" id="8061789">.</span><span class="ident" id="8061790">Fatalf</span><span class="op" id="8061796">(</span><span class="string" id="8061797">&#34;%s&#34;</span><span class="op" id="8061801">,</span>&nbsp;<span class="ident" id="8061803">err</span><span class="op" id="8061806">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8061809">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8061813">file</span><span class="op" id="8061817">,</span>&nbsp;<span class="ident" id="8061819">err</span>&nbsp;<span class="op" id="8061823">:=</span>&nbsp;<span class="ident" id="8061826">parser</span><span class="op" id="8061832">.</span><span class="ident" id="8061833">ParseFile</span><span class="op" id="8061842">(</span><span class="ident" id="8061843">fset</span><span class="op" id="8061847">,</span>&nbsp;<span class="ident" id="8061849">filename</span><span class="op" id="8061857">,</span>&nbsp;<span class="ident" id="8061859">src</span><span class="op" id="8061862">,</span>&nbsp;<span class="ident" id="8061864">parser</span><span class="op" id="8061870">.</span><span class="ident" id="8061871">ParseComments</span><span class="op" id="8061884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8061887">if</span>&nbsp;<span class="ident" id="8061890">err</span>&nbsp;<span class="op" id="8061894">!=</span>&nbsp;<span class="ident" id="8061897">nil</span>&nbsp;<span class="op" id="8061901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8061905">log</span><span class="op" id="8061908">.</span><span class="ident" id="8061909">Fatalf</span><span class="op" id="8061915">(</span><span class="string" id="8061916">&#34;%s&#34;</span><span class="op" id="8061920">,</span>&nbsp;<span class="ident" id="8061922">err</span><span class="op" id="8061925">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8061928">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8061932">var</span>&nbsp;<span class="ident" id="8061936">buf</span>&nbsp;<span class="ident" id="8061940">bytes</span><span class="op" id="8061945">.</span><span class="ident" id="8061946">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8061954">testprint</span><span class="op" id="8061963">(</span><span class="op" id="8061964">&amp;</span><span class="ident" id="8061965">buf</span><span class="op" id="8061968">,</span>&nbsp;<span class="ident" id="8061970">file</span><span class="op" id="8061974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8061977">if</span>&nbsp;<span class="op" id="8061980">!</span><span class="ident" id="8061981">bytes</span><span class="op" id="8061986">.</span><span class="ident" id="8061987">Equal</span><span class="op" id="8061992">(</span><span class="ident" id="8061993">buf</span><span class="op" id="8061996">.</span><span class="ident" id="8061997">Bytes</span><span class="op" id="8062002">(</span><span class="op" id="8062003">)</span><span class="op" id="8062004">,</span>&nbsp;<span class="ident" id="8062006">src</span><span class="op" id="8062009">)</span>&nbsp;<span class="op" id="8062011">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8062015">log</span><span class="op" id="8062018">.</span><span class="ident" id="8062019">Fatalf</span><span class="op" id="8062025">(</span><span class="string" id="8062026">&#34;print&nbsp;error:&nbsp;%s&nbsp;not&nbsp;idempotent&#34;</span><span class="op" id="8062058">,</span>&nbsp;<span class="ident" id="8062060">filename</span><span class="op" id="8062068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8062071">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8062075">testfile</span>&nbsp;<span class="op" id="8062084">=</span>&nbsp;<span class="ident" id="8062086">file</span><br>
<span class="lineno"></span><span class="op" id="8062091">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="8062094">func</span>&nbsp;<span class="ident" id="8062099">BenchmarkPrint</span><span class="op" id="8062113">(</span><span class="ident" id="8062114">b</span>&nbsp;<span class="op" id="8062116">*</span><span class="ident" id="8062117">testing</span><span class="op" id="8062124">.</span><span class="ident" id="8062125">B</span><span class="op" id="8062126">)</span>&nbsp;<span class="op" id="8062128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8062131">if</span>&nbsp;<span class="ident" id="8062134">testfile</span>&nbsp;<span class="op" id="8062143">==</span>&nbsp;<span class="ident" id="8062146">nil</span>&nbsp;<span class="op" id="8062150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8062154">initialize</span><span class="op" id="8062164">(</span><span class="op" id="8062165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8062168">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8062171">for</span>&nbsp;<span class="ident" id="8062175">i</span>&nbsp;<span class="op" id="8062177">:=</span>&nbsp;<span class="num" id="8062180">0</span><span class="op" id="8062181">;</span>&nbsp;<span class="ident" id="8062183">i</span>&nbsp;<span class="op" id="8062185">&lt;</span>&nbsp;<span class="ident" id="8062187">b</span><span class="op" id="8062188">.</span><span class="ident" id="8062189">N</span><span class="op" id="8062190">;</span>&nbsp;<span class="ident" id="8062192">i</span><span class="op" id="8062193">++</span>&nbsp;<span class="op" id="8062196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8062200">testprint</span><span class="op" id="8062209">(</span><span class="ident" id="8062210">ioutil</span><span class="op" id="8062216">.</span><span class="ident" id="8062217">Discard</span><span class="op" id="8062224">,</span>&nbsp;<span class="ident" id="8062226">testfile</span><span class="op" id="8062234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8062237">}</span><br>
<span class="lineno"></span><span class="op" id="8062239">}</span>
</div>
</body>
</html>
