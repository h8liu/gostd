<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4839870">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4839925">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4839979">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4840030">//&nbsp;Package&nbsp;tabwriter&nbsp;implements&nbsp;a&nbsp;write&nbsp;filter&nbsp;(tabwriter.Writer)&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="4840101">//&nbsp;translates&nbsp;tabbed&nbsp;columns&nbsp;in&nbsp;input&nbsp;into&nbsp;properly&nbsp;aligned&nbsp;text.</span><br>
<span class="lineno"></span><span class="comment" id="4840167">//</span><br>
<span class="lineno"></span><span class="comment" id="4840170">//&nbsp;The&nbsp;package&nbsp;is&nbsp;using&nbsp;the&nbsp;Elastic&nbsp;Tabstops&nbsp;algorithm&nbsp;described&nbsp;at</span><br>
<span class="lineno"></span><span class="comment" id="4840238">//&nbsp;http://nickgravgaard.com/elastictabstops/index.html.</span><br>
<span class="lineno">10</span><span class="comment" id="4840294">//</span><br>
<span class="lineno"></span><span class="keyword" id="4840297">package</span>&nbsp;<span class="ident" id="4840305">tabwriter</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4840316">import</span>&nbsp;<span class="op" id="4840323">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4840326">&#34;bytes&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4840335">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4840341">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="4840356">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4840359">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno">20</span><span class="comment" id="4840439">//&nbsp;Filter&nbsp;implementation</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4840465">//&nbsp;A&nbsp;cell&nbsp;represents&nbsp;a&nbsp;segment&nbsp;of&nbsp;text&nbsp;terminated&nbsp;by&nbsp;tabs&nbsp;or&nbsp;line&nbsp;breaks.</span><br>
<span class="lineno"></span><span class="comment" id="4840539">//&nbsp;The&nbsp;text&nbsp;itself&nbsp;is&nbsp;stored&nbsp;in&nbsp;a&nbsp;separate&nbsp;buffer;&nbsp;cell&nbsp;only&nbsp;describes&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4840614">//&nbsp;segment&#39;s&nbsp;size&nbsp;in&nbsp;bytes,&nbsp;its&nbsp;width&nbsp;in&nbsp;runes,&nbsp;and&nbsp;whether&nbsp;it&#39;s&nbsp;an&nbsp;htab</span><br>
<span class="lineno">25</span><span class="comment" id="4840687">//&nbsp;(&#39;\t&#39;)&nbsp;terminated&nbsp;cell.</span><br>
<span class="lineno"></span><span class="comment" id="4840714">//</span><br>
<span class="lineno"></span><span class="keyword" id="4840717">type</span>&nbsp;<span class="ident" id="4840722">cell</span>&nbsp;<span class="keyword" id="4840727">struct</span>&nbsp;<span class="op" id="4840734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4840737">size</span>&nbsp;&nbsp;<span class="builtintype" id="4840743">int</span>&nbsp;&nbsp;<span class="comment" id="4840748">//&nbsp;cell&nbsp;size&nbsp;in&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4840771">width</span>&nbsp;<span class="builtintype" id="4840777">int</span>&nbsp;&nbsp;<span class="comment" id="4840782">//&nbsp;cell&nbsp;width&nbsp;in&nbsp;runes</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4840806">htab</span>&nbsp;&nbsp;<span class="builtintype" id="4840812">bool</span>&nbsp;<span class="comment" id="4840817">//&nbsp;true&nbsp;if&nbsp;the&nbsp;cell&nbsp;is&nbsp;terminated&nbsp;by&nbsp;an&nbsp;htab&nbsp;(&#39;\t&#39;)</span><br>
<span class="lineno"></span><span class="op" id="4840869">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4840872">//&nbsp;A&nbsp;Writer&nbsp;is&nbsp;a&nbsp;filter&nbsp;that&nbsp;inserts&nbsp;padding&nbsp;around&nbsp;tab-delimited</span><br>
<span class="lineno"></span><span class="comment" id="4840938">//&nbsp;columns&nbsp;in&nbsp;its&nbsp;input&nbsp;to&nbsp;align&nbsp;them&nbsp;in&nbsp;the&nbsp;output.</span><br>
<span class="lineno">35</span><span class="comment" id="4840991">//</span><br>
<span class="lineno"></span><span class="comment" id="4840994">//&nbsp;The&nbsp;Writer&nbsp;treats&nbsp;incoming&nbsp;bytes&nbsp;as&nbsp;UTF-8&nbsp;encoded&nbsp;text&nbsp;consisting</span><br>
<span class="lineno"></span><span class="comment" id="4841063">//&nbsp;of&nbsp;cells&nbsp;terminated&nbsp;by&nbsp;(horizontal&nbsp;or&nbsp;vertical)&nbsp;tabs&nbsp;or&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="4841127">//&nbsp;breaks&nbsp;(newline&nbsp;or&nbsp;formfeed&nbsp;characters).&nbsp;Cells&nbsp;in&nbsp;adjacent&nbsp;lines</span><br>
<span class="lineno"></span><span class="comment" id="4841195">//&nbsp;constitute&nbsp;a&nbsp;column.&nbsp;The&nbsp;Writer&nbsp;inserts&nbsp;padding&nbsp;as&nbsp;needed&nbsp;to</span><br>
<span class="lineno">40</span><span class="comment" id="4841259">//&nbsp;make&nbsp;all&nbsp;cells&nbsp;in&nbsp;a&nbsp;column&nbsp;have&nbsp;the&nbsp;same&nbsp;width,&nbsp;effectively</span><br>
<span class="lineno"></span><span class="comment" id="4841322">//&nbsp;aligning&nbsp;the&nbsp;columns.&nbsp;It&nbsp;assumes&nbsp;that&nbsp;all&nbsp;characters&nbsp;have&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4841387">//&nbsp;same&nbsp;width&nbsp;except&nbsp;for&nbsp;tabs&nbsp;for&nbsp;which&nbsp;a&nbsp;tabwidth&nbsp;must&nbsp;be&nbsp;specified.</span><br>
<span class="lineno"></span><span class="comment" id="4841457">//&nbsp;Note&nbsp;that&nbsp;cells&nbsp;are&nbsp;tab-terminated,&nbsp;not&nbsp;tab-separated:&nbsp;trailing</span><br>
<span class="lineno"></span><span class="comment" id="4841524">//&nbsp;non-tab&nbsp;text&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;a&nbsp;line&nbsp;does&nbsp;not&nbsp;form&nbsp;a&nbsp;column&nbsp;cell.</span><br>
<span class="lineno">45</span><span class="comment" id="4841590">//</span><br>
<span class="lineno"></span><span class="comment" id="4841593">//&nbsp;The&nbsp;Writer&nbsp;assumes&nbsp;that&nbsp;all&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;have&nbsp;the&nbsp;same&nbsp;width;</span><br>
<span class="lineno"></span><span class="comment" id="4841665">//&nbsp;this&nbsp;may&nbsp;not&nbsp;be&nbsp;true&nbsp;in&nbsp;some&nbsp;fonts.</span><br>
<span class="lineno"></span><span class="comment" id="4841704">//</span><br>
<span class="lineno"></span><span class="comment" id="4841707">//&nbsp;If&nbsp;DiscardEmptyColumns&nbsp;is&nbsp;set,&nbsp;empty&nbsp;columns&nbsp;that&nbsp;are&nbsp;terminated</span><br>
<span class="lineno">50</span><span class="comment" id="4841775">//&nbsp;entirely&nbsp;by&nbsp;vertical&nbsp;(or&nbsp;&#34;soft&#34;)&nbsp;tabs&nbsp;are&nbsp;discarded.&nbsp;Columns</span><br>
<span class="lineno"></span><span class="comment" id="4841839">//&nbsp;terminated&nbsp;by&nbsp;horizontal&nbsp;(or&nbsp;&#34;hard&#34;)&nbsp;tabs&nbsp;are&nbsp;not&nbsp;affected&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="4841904">//&nbsp;this&nbsp;flag.</span><br>
<span class="lineno"></span><span class="comment" id="4841918">//</span><br>
<span class="lineno"></span><span class="comment" id="4841921">//&nbsp;If&nbsp;a&nbsp;Writer&nbsp;is&nbsp;configured&nbsp;to&nbsp;filter&nbsp;HTML,&nbsp;HTML&nbsp;tags&nbsp;and&nbsp;entities</span><br>
<span class="lineno">55</span><span class="comment" id="4841989">//&nbsp;are&nbsp;passed&nbsp;through.&nbsp;The&nbsp;widths&nbsp;of&nbsp;tags&nbsp;and&nbsp;entities&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="4842048">//&nbsp;assumed&nbsp;to&nbsp;be&nbsp;zero&nbsp;(tags)&nbsp;and&nbsp;one&nbsp;(entities)&nbsp;for&nbsp;formatting&nbsp;purposes.</span><br>
<span class="lineno"></span><span class="comment" id="4842121">//</span><br>
<span class="lineno"></span><span class="comment" id="4842124">//&nbsp;A&nbsp;segment&nbsp;of&nbsp;text&nbsp;may&nbsp;be&nbsp;escaped&nbsp;by&nbsp;bracketing&nbsp;it&nbsp;with&nbsp;Escape</span><br>
<span class="lineno"></span><span class="comment" id="4842189">//&nbsp;characters.&nbsp;The&nbsp;tabwriter&nbsp;passes&nbsp;escaped&nbsp;text&nbsp;segments&nbsp;through</span><br>
<span class="lineno">60</span><span class="comment" id="4842255">//&nbsp;unchanged.&nbsp;In&nbsp;particular,&nbsp;it&nbsp;does&nbsp;not&nbsp;interpret&nbsp;any&nbsp;tabs&nbsp;or&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="4842323">//&nbsp;breaks&nbsp;within&nbsp;the&nbsp;segment.&nbsp;If&nbsp;the&nbsp;StripEscape&nbsp;flag&nbsp;is&nbsp;set,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4842389">//&nbsp;Escape&nbsp;characters&nbsp;are&nbsp;stripped&nbsp;from&nbsp;the&nbsp;output;&nbsp;otherwise&nbsp;they</span><br>
<span class="lineno"></span><span class="comment" id="4842455">//&nbsp;are&nbsp;passed&nbsp;through&nbsp;as&nbsp;well.&nbsp;For&nbsp;the&nbsp;purpose&nbsp;of&nbsp;formatting,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4842521">//&nbsp;width&nbsp;of&nbsp;the&nbsp;escaped&nbsp;text&nbsp;is&nbsp;always&nbsp;computed&nbsp;excluding&nbsp;the&nbsp;Escape</span><br>
<span class="lineno">65</span><span class="comment" id="4842590">//&nbsp;characters.</span><br>
<span class="lineno"></span><span class="comment" id="4842605">//</span><br>
<span class="lineno"></span><span class="comment" id="4842608">//&nbsp;The&nbsp;formfeed&nbsp;character&nbsp;(&#39;\f&#39;)&nbsp;acts&nbsp;like&nbsp;a&nbsp;newline&nbsp;but&nbsp;it&nbsp;also</span><br>
<span class="lineno"></span><span class="comment" id="4842673">//&nbsp;terminates&nbsp;all&nbsp;columns&nbsp;in&nbsp;the&nbsp;current&nbsp;line&nbsp;(effectively&nbsp;calling</span><br>
<span class="lineno"></span><span class="comment" id="4842740">//&nbsp;Flush).&nbsp;Cells&nbsp;in&nbsp;the&nbsp;next&nbsp;line&nbsp;start&nbsp;new&nbsp;columns.&nbsp;Unless&nbsp;found</span><br>
<span class="lineno">70</span><span class="comment" id="4842806">//&nbsp;inside&nbsp;an&nbsp;HTML&nbsp;tag&nbsp;or&nbsp;inside&nbsp;an&nbsp;escaped&nbsp;text&nbsp;segment,&nbsp;formfeed</span><br>
<span class="lineno"></span><span class="comment" id="4842872">//&nbsp;characters&nbsp;appear&nbsp;as&nbsp;newlines&nbsp;in&nbsp;the&nbsp;output.</span><br>
<span class="lineno"></span><span class="comment" id="4842920">//</span><br>
<span class="lineno"></span><span class="comment" id="4842923">//&nbsp;The&nbsp;Writer&nbsp;must&nbsp;buffer&nbsp;input&nbsp;internally,&nbsp;because&nbsp;proper&nbsp;spacing</span><br>
<span class="lineno"></span><span class="comment" id="4842990">//&nbsp;of&nbsp;one&nbsp;line&nbsp;may&nbsp;depend&nbsp;on&nbsp;the&nbsp;cells&nbsp;in&nbsp;future&nbsp;lines.&nbsp;Clients&nbsp;must</span><br>
<span class="lineno">75</span><span class="comment" id="4843059">//&nbsp;call&nbsp;Flush&nbsp;when&nbsp;done&nbsp;calling&nbsp;Write.</span><br>
<span class="lineno"></span><span class="comment" id="4843098">//</span><br>
<span class="lineno"></span><span class="keyword" id="4843101">type</span>&nbsp;<span class="ident" id="4843106">Writer</span>&nbsp;<span class="keyword" id="4843113">struct</span>&nbsp;<span class="op" id="4843120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4843123">//&nbsp;configuration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4843141">output</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4843150">io</span><span class="op" id="4843152">.</span><span class="ident" id="4843153">Writer</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4843161">minwidth</span>&nbsp;<span class="builtintype" id="4843170">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4843175">tabwidth</span>&nbsp;<span class="builtintype" id="4843184">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4843189">padding</span>&nbsp;&nbsp;<span class="builtintype" id="4843198">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4843203">padbytes</span>&nbsp;<span class="op" id="4843212">[</span><span class="num" id="4843213">8</span><span class="op" id="4843214">]</span><span class="builtintype" id="4843215">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4843221">flags</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4843230">uint</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4843237">//&nbsp;current&nbsp;state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4843255">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4843263">bytes</span><span class="op" id="4843268">.</span><span class="ident" id="4843269">Buffer</span>&nbsp;<span class="comment" id="4843276">//&nbsp;collected&nbsp;text&nbsp;excluding&nbsp;tabs&nbsp;or&nbsp;line&nbsp;breaks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4843325">pos</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4843333">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4843346">//&nbsp;buffer&nbsp;position&nbsp;up&nbsp;to&nbsp;which&nbsp;cell.width&nbsp;of&nbsp;incomplete&nbsp;cell&nbsp;has&nbsp;been&nbsp;computed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4843426">cell</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4843434">cell</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4843447">//&nbsp;current&nbsp;incomplete&nbsp;cell;&nbsp;cell.width&nbsp;is&nbsp;up&nbsp;to&nbsp;buf[pos]&nbsp;excluding&nbsp;ignored&nbsp;sections</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4843532">endChar</span>&nbsp;<span class="builtintype" id="4843540">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4843553">//&nbsp;terminating&nbsp;char&nbsp;of&nbsp;escaped&nbsp;sequence&nbsp;(Escape&nbsp;for&nbsp;escapes,&nbsp;&#39;&gt;&#39;,&nbsp;&#39;;&#39;&nbsp;for&nbsp;HTML&nbsp;tags/entities,&nbsp;or&nbsp;0)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4843654">lines</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4843662">[</span><span class="op" id="4843663">]</span><span class="op" id="4843664">[</span><span class="op" id="4843665">]</span><span class="ident" id="4843666">cell</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4843675">//&nbsp;list&nbsp;of&nbsp;lines;&nbsp;each&nbsp;line&nbsp;is&nbsp;a&nbsp;list&nbsp;of&nbsp;cells</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4843723">widths</span>&nbsp;&nbsp;<span class="op" id="4843731">[</span><span class="op" id="4843732">]</span><span class="builtintype" id="4843733">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4843744">//&nbsp;list&nbsp;of&nbsp;column&nbsp;widths&nbsp;in&nbsp;runes&nbsp;-&nbsp;re-used&nbsp;during&nbsp;formatting</span><br>
<span class="lineno"></span><span class="op" id="4843806">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="4843809">func</span>&nbsp;<span class="op" id="4843814">(</span><span class="ident" id="4843815">b</span>&nbsp;<span class="op" id="4843817">*</span><span class="ident" id="4843818">Writer</span><span class="op" id="4843824">)</span>&nbsp;<span class="ident" id="4843826">addLine</span><span class="op" id="4843833">(</span><span class="op" id="4843834">)</span>&nbsp;<span class="op" id="4843836">{</span>&nbsp;<span class="ident" id="4843838">b</span><span class="op" id="4843839">.</span><span class="ident" id="4843840">lines</span>&nbsp;<span class="op" id="4843846">=</span>&nbsp;<span class="builtinfunc" id="4843848">append</span><span class="op" id="4843854">(</span><span class="ident" id="4843855">b</span><span class="op" id="4843856">.</span><span class="ident" id="4843857">lines</span><span class="op" id="4843862">,</span>&nbsp;<span class="op" id="4843864">[</span><span class="op" id="4843865">]</span><span class="ident" id="4843866">cell</span><span class="op" id="4843870">{</span><span class="op" id="4843871">}</span><span class="op" id="4843872">)</span>&nbsp;<span class="op" id="4843874">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4843877">//&nbsp;Reset&nbsp;the&nbsp;current&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="4843905">func</span>&nbsp;<span class="op" id="4843910">(</span><span class="ident" id="4843911">b</span>&nbsp;<span class="op" id="4843913">*</span><span class="ident" id="4843914">Writer</span><span class="op" id="4843920">)</span>&nbsp;<span class="ident" id="4843922">reset</span><span class="op" id="4843927">(</span><span class="op" id="4843928">)</span>&nbsp;<span class="op" id="4843930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4843933">b</span><span class="op" id="4843934">.</span><span class="ident" id="4843935">buf</span><span class="op" id="4843938">.</span><span class="ident" id="4843939">Reset</span><span class="op" id="4843944">(</span><span class="op" id="4843945">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4843948">b</span><span class="op" id="4843949">.</span><span class="ident" id="4843950">pos</span>&nbsp;<span class="op" id="4843954">=</span>&nbsp;<span class="num" id="4843956">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4843959">b</span><span class="op" id="4843960">.</span><span class="ident" id="4843961">cell</span>&nbsp;<span class="op" id="4843966">=</span>&nbsp;<span class="ident" id="4843968">cell</span><span class="op" id="4843972">{</span><span class="op" id="4843973">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4843976">b</span><span class="op" id="4843977">.</span><span class="ident" id="4843978">endChar</span>&nbsp;<span class="op" id="4843986">=</span>&nbsp;<span class="num" id="4843988">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4843991">b</span><span class="op" id="4843992">.</span><span class="ident" id="4843993">lines</span>&nbsp;<span class="op" id="4843999">=</span>&nbsp;<span class="ident" id="4844001">b</span><span class="op" id="4844002">.</span><span class="ident" id="4844003">lines</span><span class="op" id="4844008">[</span><span class="num" id="4844009">0</span><span class="op" id="4844010">:</span><span class="num" id="4844011">0</span><span class="op" id="4844012">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4844015">b</span><span class="op" id="4844016">.</span><span class="ident" id="4844017">widths</span>&nbsp;<span class="op" id="4844024">=</span>&nbsp;<span class="ident" id="4844026">b</span><span class="op" id="4844027">.</span><span class="ident" id="4844028">widths</span><span class="op" id="4844034">[</span><span class="num" id="4844035">0</span><span class="op" id="4844036">:</span><span class="num" id="4844037">0</span><span class="op" id="4844038">]</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4844041">b</span><span class="op" id="4844042">.</span><span class="ident" id="4844043">addLine</span><span class="op" id="4844050">(</span><span class="op" id="4844051">)</span><br>
<span class="lineno"></span><span class="op" id="4844053">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4844056">//&nbsp;Internal&nbsp;representation&nbsp;(current&nbsp;state):</span><br>
<span class="lineno"></span><span class="comment" id="4844100">//</span><br>
<span class="lineno">110</span><span class="comment" id="4844103">//&nbsp;-&nbsp;all&nbsp;text&nbsp;written&nbsp;is&nbsp;appended&nbsp;to&nbsp;buf;&nbsp;tabs&nbsp;and&nbsp;line&nbsp;breaks&nbsp;are&nbsp;stripped&nbsp;away</span><br>
<span class="lineno"></span><span class="comment" id="4844184">//&nbsp;-&nbsp;at&nbsp;any&nbsp;given&nbsp;time&nbsp;there&nbsp;is&nbsp;a&nbsp;(possibly&nbsp;empty)&nbsp;incomplete&nbsp;cell&nbsp;at&nbsp;the&nbsp;end</span><br>
<span class="lineno"></span><span class="comment" id="4844262">//&nbsp;&nbsp;&nbsp;(the&nbsp;cell&nbsp;starts&nbsp;after&nbsp;a&nbsp;tab&nbsp;or&nbsp;line&nbsp;break)</span><br>
<span class="lineno"></span><span class="comment" id="4844311">//&nbsp;-&nbsp;cell.size&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;belonging&nbsp;to&nbsp;the&nbsp;cell&nbsp;so&nbsp;far</span><br>
<span class="lineno"></span><span class="comment" id="4844378">//&nbsp;-&nbsp;cell.width&nbsp;is&nbsp;text&nbsp;width&nbsp;in&nbsp;runes&nbsp;of&nbsp;that&nbsp;cell&nbsp;from&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;cell&nbsp;to</span><br>
<span class="lineno">115</span><span class="comment" id="4844460">//&nbsp;&nbsp;&nbsp;position&nbsp;pos;&nbsp;html&nbsp;tags&nbsp;and&nbsp;entities&nbsp;are&nbsp;excluded&nbsp;from&nbsp;this&nbsp;width&nbsp;if&nbsp;html</span><br>
<span class="lineno"></span><span class="comment" id="4844539">//&nbsp;&nbsp;&nbsp;filtering&nbsp;is&nbsp;enabled</span><br>
<span class="lineno"></span><span class="comment" id="4844565">//&nbsp;-&nbsp;the&nbsp;sizes&nbsp;and&nbsp;widths&nbsp;of&nbsp;processed&nbsp;text&nbsp;are&nbsp;kept&nbsp;in&nbsp;the&nbsp;lines&nbsp;list</span><br>
<span class="lineno"></span><span class="comment" id="4844636">//&nbsp;&nbsp;&nbsp;which&nbsp;contains&nbsp;a&nbsp;list&nbsp;of&nbsp;cells&nbsp;for&nbsp;each&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="4844686">//&nbsp;-&nbsp;the&nbsp;widths&nbsp;list&nbsp;is&nbsp;a&nbsp;temporary&nbsp;list&nbsp;with&nbsp;current&nbsp;widths&nbsp;used&nbsp;during</span><br>
<span class="lineno">120</span><span class="comment" id="4844759">//&nbsp;&nbsp;&nbsp;formatting;&nbsp;it&nbsp;is&nbsp;kept&nbsp;in&nbsp;Writer&nbsp;because&nbsp;it&#39;s&nbsp;re-used</span><br>
<span class="lineno"></span><span class="comment" id="4844818">//</span><br>
<span class="lineno"></span><span class="comment" id="4844821">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&lt;----------&nbsp;size&nbsp;----------&gt;|</span><br>
<span class="lineno"></span><span class="comment" id="4844874">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span><br>
<span class="lineno"></span><span class="comment" id="4844927">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&lt;-&nbsp;width&nbsp;-&gt;|&lt;-&nbsp;ignored&nbsp;-&gt;|&nbsp;&nbsp;|</span><br>
<span class="lineno">125</span><span class="comment" id="4844980">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;|</span><br>
<span class="lineno"></span><span class="comment" id="4845033">//&nbsp;[---processed---tab------------&lt;tag&gt;...&lt;/tag&gt;...]</span><br>
<span class="lineno"></span><span class="comment" id="4845086">//&nbsp;^&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;^&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;^</span><br>
<span class="lineno"></span><span class="comment" id="4845136">//&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span><br>
<span class="lineno"></span><span class="comment" id="4845186">//&nbsp;buf&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;start&nbsp;of&nbsp;incomplete&nbsp;cell&nbsp;&nbsp;pos</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="4845239">//&nbsp;Formatting&nbsp;can&nbsp;be&nbsp;controlled&nbsp;with&nbsp;these&nbsp;flags.</span><br>
<span class="lineno"></span><span class="keyword" id="4845289">const</span>&nbsp;<span class="op" id="4845295">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4845298">//&nbsp;Ignore&nbsp;html&nbsp;tags&nbsp;and&nbsp;treat&nbsp;entities&nbsp;(starting&nbsp;with&nbsp;&#39;&amp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4845357">//&nbsp;and&nbsp;ending&nbsp;in&nbsp;&#39;;&#39;)&nbsp;as&nbsp;single&nbsp;characters&nbsp;(width&nbsp;=&nbsp;1).</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4845414">FilterHTML</span>&nbsp;<span class="builtintype" id="4845425">uint</span>&nbsp;<span class="op" id="4845430">=</span>&nbsp;<span class="num" id="4845432">1</span>&nbsp;<span class="op" id="4845434">&lt;&lt;</span>&nbsp;<span class="ident" id="4845437">iota</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4845444">//&nbsp;Strip&nbsp;Escape&nbsp;characters&nbsp;bracketing&nbsp;escaped&nbsp;text&nbsp;segments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4845505">//&nbsp;instead&nbsp;of&nbsp;passing&nbsp;them&nbsp;through&nbsp;unchanged&nbsp;with&nbsp;the&nbsp;text.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4845566">StripEscape</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4845580">//&nbsp;Force&nbsp;right-alignment&nbsp;of&nbsp;cell&nbsp;content.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4845623">//&nbsp;Default&nbsp;is&nbsp;left-alignment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4845654">AlignRight</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4845667">//&nbsp;Handle&nbsp;empty&nbsp;columns&nbsp;as&nbsp;if&nbsp;they&nbsp;were&nbsp;not&nbsp;present&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4845723">//&nbsp;the&nbsp;input&nbsp;in&nbsp;the&nbsp;first&nbsp;place.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4845757">DiscardEmptyColumns</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4845779">//&nbsp;Always&nbsp;use&nbsp;tabs&nbsp;for&nbsp;indentation&nbsp;columns&nbsp;(i.e.,&nbsp;padding&nbsp;of</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4845841">//&nbsp;leading&nbsp;empty&nbsp;cells&nbsp;on&nbsp;the&nbsp;left)&nbsp;independent&nbsp;of&nbsp;padchar.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4845902">TabIndent</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4845914">//&nbsp;Print&nbsp;a&nbsp;vertical&nbsp;bar&nbsp;(&#39;|&#39;)&nbsp;between&nbsp;columns&nbsp;(after&nbsp;formatting).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4845981">//&nbsp;Discarded&nbsp;columns&nbsp;appear&nbsp;as&nbsp;zero-width&nbsp;columns&nbsp;(&#34;||&#34;).</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4846040">Debug</span><br>
<span class="lineno"></span><span class="op" id="4846046">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4846049">//&nbsp;A&nbsp;Writer&nbsp;must&nbsp;be&nbsp;initialized&nbsp;with&nbsp;a&nbsp;call&nbsp;to&nbsp;Init.&nbsp;The&nbsp;first&nbsp;parameter&nbsp;(output)</span><br>
<span class="lineno"></span><span class="comment" id="4846131">//&nbsp;specifies&nbsp;the&nbsp;filter&nbsp;output.&nbsp;The&nbsp;remaining&nbsp;parameters&nbsp;control&nbsp;the&nbsp;formatting:</span><br>
<span class="lineno">160</span><span class="comment" id="4846212">//</span><br>
<span class="lineno"></span><span class="comment" id="4846215">//&nbsp;&nbsp;&nbsp;&nbspminwidth&nbsp;&nbsp;&nbsp;&nbspminimal&nbsp;cell&nbsp;width&nbsp;including&nbsp;any&nbsp;padding</span><br>
<span class="lineno"></span><span class="comment" id="4846268">//&nbsp;&nbsp;&nbsp;&nbsptabwidth&nbsp;&nbsp;&nbsp;&nbspwidth&nbsp;of&nbsp;tab&nbsp;characters&nbsp;(equivalent&nbsp;number&nbsp;of&nbsp;spaces)</span><br>
<span class="lineno"></span><span class="comment" id="4846334">//&nbsp;&nbsp;&nbsp;&nbsppadding&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsppadding&nbsp;added&nbsp;to&nbsp;a&nbsp;cell&nbsp;before&nbsp;computing&nbsp;its&nbsp;width</span><br>
<span class="lineno"></span><span class="comment" id="4846397">//&nbsp;&nbsp;&nbsp;&nbsppadchar&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspASCII&nbsp;char&nbsp;used&nbsp;for&nbsp;padding</span><br>
<span class="lineno">165</span><span class="comment" id="4846437">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspif&nbsp;padchar&nbsp;==&nbsp;&#39;\t&#39;,&nbsp;the&nbsp;Writer&nbsp;will&nbsp;assume&nbsp;that&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4846494">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspwidth&nbsp;of&nbsp;a&nbsp;&#39;\t&#39;&nbsp;in&nbsp;the&nbsp;formatted&nbsp;output&nbsp;is&nbsp;tabwidth,</span><br>
<span class="lineno"></span><span class="comment" id="4846552">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspand&nbsp;cells&nbsp;are&nbsp;left-aligned&nbsp;independent&nbsp;of&nbsp;align_left</span><br>
<span class="lineno"></span><span class="comment" id="4846610">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp(for&nbsp;correct-looking&nbsp;results,&nbsp;tabwidth&nbsp;must&nbsp;correspond</span><br>
<span class="lineno"></span><span class="comment" id="4846670">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspto&nbsp;the&nbsp;tab&nbsp;width&nbsp;in&nbsp;the&nbsp;viewer&nbsp;displaying&nbsp;the&nbsp;result)</span><br>
<span class="lineno">170</span><span class="comment" id="4846729">//&nbsp;&nbsp;&nbsp;&nbspflags&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspformatting&nbsp;control</span><br>
<span class="lineno"></span><span class="comment" id="4846758">//</span><br>
<span class="lineno"></span><span class="keyword" id="4846761">func</span>&nbsp;<span class="op" id="4846766">(</span><span class="ident" id="4846767">b</span>&nbsp;<span class="op" id="4846769">*</span><span class="ident" id="4846770">Writer</span><span class="op" id="4846776">)</span>&nbsp;<span class="ident" id="4846778">Init</span><span class="op" id="4846782">(</span><span class="ident" id="4846783">output</span>&nbsp;<span class="ident" id="4846790">io</span><span class="op" id="4846792">.</span><span class="ident" id="4846793">Writer</span><span class="op" id="4846799">,</span>&nbsp;<span class="ident" id="4846801">minwidth</span><span class="op" id="4846809">,</span>&nbsp;<span class="ident" id="4846811">tabwidth</span><span class="op" id="4846819">,</span>&nbsp;<span class="ident" id="4846821">padding</span>&nbsp;<span class="builtintype" id="4846829">int</span><span class="op" id="4846832">,</span>&nbsp;<span class="ident" id="4846834">padchar</span>&nbsp;<span class="builtintype" id="4846842">byte</span><span class="op" id="4846846">,</span>&nbsp;<span class="ident" id="4846848">flags</span>&nbsp;<span class="builtintype" id="4846854">uint</span><span class="op" id="4846858">)</span>&nbsp;<span class="op" id="4846860">*</span><span class="ident" id="4846861">Writer</span>&nbsp;<span class="op" id="4846868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4846871">if</span>&nbsp;<span class="ident" id="4846874">minwidth</span>&nbsp;<span class="op" id="4846883">&lt;</span>&nbsp;<span class="num" id="4846885">0</span>&nbsp;<span class="op" id="4846887">||</span>&nbsp;<span class="ident" id="4846890">tabwidth</span>&nbsp;<span class="op" id="4846899">&lt;</span>&nbsp;<span class="num" id="4846901">0</span>&nbsp;<span class="op" id="4846903">||</span>&nbsp;<span class="ident" id="4846906">padding</span>&nbsp;<span class="op" id="4846914">&lt;</span>&nbsp;<span class="num" id="4846916">0</span>&nbsp;<span class="op" id="4846918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4846922">panic</span><span class="op" id="4846927">(</span><span class="string" id="4846928">&#34;negative&nbsp;minwidth,&nbsp;tabwidth,&nbsp;or&nbsp;padding&#34;</span><span class="op" id="4846969">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4846972">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4846975">b</span><span class="op" id="4846976">.</span><span class="ident" id="4846977">output</span>&nbsp;<span class="op" id="4846984">=</span>&nbsp;<span class="ident" id="4846986">output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4846994">b</span><span class="op" id="4846995">.</span><span class="ident" id="4846996">minwidth</span>&nbsp;<span class="op" id="4847005">=</span>&nbsp;<span class="ident" id="4847007">minwidth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4847017">b</span><span class="op" id="4847018">.</span><span class="ident" id="4847019">tabwidth</span>&nbsp;<span class="op" id="4847028">=</span>&nbsp;<span class="ident" id="4847030">tabwidth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4847040">b</span><span class="op" id="4847041">.</span><span class="ident" id="4847042">padding</span>&nbsp;<span class="op" id="4847050">=</span>&nbsp;<span class="ident" id="4847052">padding</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4847061">for</span>&nbsp;<span class="ident" id="4847065">i</span>&nbsp;<span class="op" id="4847067">:=</span>&nbsp;<span class="keyword" id="4847070">range</span>&nbsp;<span class="ident" id="4847076">b</span><span class="op" id="4847077">.</span><span class="ident" id="4847078">padbytes</span>&nbsp;<span class="op" id="4847087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4847091">b</span><span class="op" id="4847092">.</span><span class="ident" id="4847093">padbytes</span><span class="op" id="4847101">[</span><span class="ident" id="4847102">i</span><span class="op" id="4847103">]</span>&nbsp;<span class="op" id="4847105">=</span>&nbsp;<span class="ident" id="4847107">padchar</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4847116">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4847119">if</span>&nbsp;<span class="ident" id="4847122">padchar</span>&nbsp;<span class="op" id="4847130">==</span>&nbsp;<span class="string" id="4847133">&#39;\t&#39;</span>&nbsp;<span class="op" id="4847138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4847142">//&nbsp;tab&nbsp;padding&nbsp;enforces&nbsp;left-alignment</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4847183">flags</span>&nbsp;<span class="op" id="4847189">&amp;^=</span>&nbsp;<span class="ident" id="4847193">AlignRight</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4847205">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4847208">b</span><span class="op" id="4847209">.</span><span class="ident" id="4847210">flags</span>&nbsp;<span class="op" id="4847216">=</span>&nbsp;<span class="ident" id="4847218">flags</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4847226">b</span><span class="op" id="4847227">.</span><span class="ident" id="4847228">reset</span><span class="op" id="4847233">(</span><span class="op" id="4847234">)</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4847238">return</span>&nbsp;<span class="ident" id="4847245">b</span><br>
<span class="lineno"></span><span class="op" id="4847247">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4847250">//&nbsp;debugging&nbsp;support&nbsp;(keep&nbsp;code&nbsp;around)</span><br>
<span class="lineno">195</span><span class="keyword" id="4847290">func</span>&nbsp;<span class="op" id="4847295">(</span><span class="ident" id="4847296">b</span>&nbsp;<span class="op" id="4847298">*</span><span class="ident" id="4847299">Writer</span><span class="op" id="4847305">)</span>&nbsp;<span class="ident" id="4847307">dump</span><span class="op" id="4847311">(</span><span class="op" id="4847312">)</span>&nbsp;<span class="op" id="4847314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4847317">pos</span>&nbsp;<span class="op" id="4847321">:=</span>&nbsp;<span class="num" id="4847324">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4847327">for</span>&nbsp;<span class="ident" id="4847331">i</span><span class="op" id="4847332">,</span>&nbsp;<span class="ident" id="4847334">line</span>&nbsp;<span class="op" id="4847339">:=</span>&nbsp;<span class="keyword" id="4847342">range</span>&nbsp;<span class="ident" id="4847348">b</span><span class="op" id="4847349">.</span><span class="ident" id="4847350">lines</span>&nbsp;<span class="op" id="4847356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4847360">print</span><span class="op" id="4847365">(</span><span class="string" id="4847366">&#34;(&#34;</span><span class="op" id="4847369">,</span>&nbsp;<span class="ident" id="4847371">i</span><span class="op" id="4847372">,</span>&nbsp;<span class="string" id="4847374">&#34;)&nbsp;&#34;</span><span class="op" id="4847378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4847382">for</span>&nbsp;<span class="ident" id="4847386">_</span><span class="op" id="4847387">,</span>&nbsp;<span class="ident" id="4847389">c</span>&nbsp;<span class="op" id="4847391">:=</span>&nbsp;<span class="keyword" id="4847394">range</span>&nbsp;<span class="ident" id="4847400">line</span>&nbsp;<span class="op" id="4847405">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4847410">print</span><span class="op" id="4847415">(</span><span class="string" id="4847416">&#34;[&#34;</span><span class="op" id="4847419">,</span>&nbsp;<span class="builtintype" id="4847421">string</span><span class="op" id="4847427">(</span><span class="ident" id="4847428">b</span><span class="op" id="4847429">.</span><span class="ident" id="4847430">buf</span><span class="op" id="4847433">.</span><span class="ident" id="4847434">Bytes</span><span class="op" id="4847439">(</span><span class="op" id="4847440">)</span><span class="op" id="4847441">[</span><span class="ident" id="4847442">pos</span><span class="op" id="4847445">:</span><span class="ident" id="4847446">pos</span><span class="op" id="4847449">+</span><span class="ident" id="4847450">c</span><span class="op" id="4847451">.</span><span class="ident" id="4847452">size</span><span class="op" id="4847456">]</span><span class="op" id="4847457">)</span><span class="op" id="4847458">,</span>&nbsp;<span class="string" id="4847460">&#34;]&#34;</span><span class="op" id="4847463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4847468">pos</span>&nbsp;<span class="op" id="4847472">+=</span>&nbsp;<span class="ident" id="4847475">c</span><span class="op" id="4847476">.</span><span class="ident" id="4847477">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4847484">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4847488">print</span><span class="op" id="4847493">(</span><span class="string" id="4847494">&#34;\n&#34;</span><span class="op" id="4847498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4847501">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4847504">print</span><span class="op" id="4847509">(</span><span class="string" id="4847510">&#34;\n&#34;</span><span class="op" id="4847514">)</span><br>
<span class="lineno"></span><span class="op" id="4847516">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4847519">//&nbsp;local&nbsp;error&nbsp;wrapper&nbsp;so&nbsp;we&nbsp;can&nbsp;distinguish&nbsp;errors&nbsp;we&nbsp;want&nbsp;to&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="4847589">//&nbsp;as&nbsp;errors&nbsp;from&nbsp;genuine&nbsp;panics&nbsp;(which&nbsp;we&nbsp;don&#39;t&nbsp;want&nbsp;to&nbsp;return&nbsp;as&nbsp;errors)</span><br>
<span class="lineno">210</span><span class="keyword" id="4847664">type</span>&nbsp;<span class="ident" id="4847669">osError</span>&nbsp;<span class="keyword" id="4847677">struct</span>&nbsp;<span class="op" id="4847684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4847687">err</span>&nbsp;<span class="builtintype" id="4847691">error</span><br>
<span class="lineno"></span><span class="op" id="4847697">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4847700">func</span>&nbsp;<span class="op" id="4847705">(</span><span class="ident" id="4847706">b</span>&nbsp;<span class="op" id="4847708">*</span><span class="ident" id="4847709">Writer</span><span class="op" id="4847715">)</span>&nbsp;<span class="ident" id="4847717">write0</span><span class="op" id="4847723">(</span><span class="ident" id="4847724">buf</span>&nbsp;<span class="op" id="4847728">[</span><span class="op" id="4847729">]</span><span class="builtintype" id="4847730">byte</span><span class="op" id="4847734">)</span>&nbsp;<span class="op" id="4847736">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4847739">n</span><span class="op" id="4847740">,</span>&nbsp;<span class="ident" id="4847742">err</span>&nbsp;<span class="op" id="4847746">:=</span>&nbsp;<span class="ident" id="4847749">b</span><span class="op" id="4847750">.</span><span class="ident" id="4847751">output</span><span class="op" id="4847757">.</span><span class="ident" id="4847758">Write</span><span class="op" id="4847763">(</span><span class="ident" id="4847764">buf</span><span class="op" id="4847767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4847770">if</span>&nbsp;<span class="ident" id="4847773">n</span>&nbsp;<span class="op" id="4847775">!=</span>&nbsp;<span class="builtinfunc" id="4847778">len</span><span class="op" id="4847781">(</span><span class="ident" id="4847782">buf</span><span class="op" id="4847785">)</span>&nbsp;<span class="op" id="4847787">&amp;&amp;</span>&nbsp;<span class="ident" id="4847790">err</span>&nbsp;<span class="op" id="4847794">==</span>&nbsp;<span class="ident" id="4847797">nil</span>&nbsp;<span class="op" id="4847801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4847805">err</span>&nbsp;<span class="op" id="4847809">=</span>&nbsp;<span class="ident" id="4847811">io</span><span class="op" id="4847813">.</span><span class="ident" id="4847814">ErrShortWrite</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4847829">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4847832">if</span>&nbsp;<span class="ident" id="4847835">err</span>&nbsp;<span class="op" id="4847839">!=</span>&nbsp;<span class="ident" id="4847842">nil</span>&nbsp;<span class="op" id="4847846">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4847850">panic</span><span class="op" id="4847855">(</span><span class="ident" id="4847856">osError</span><span class="op" id="4847863">{</span><span class="ident" id="4847864">err</span><span class="op" id="4847867">}</span><span class="op" id="4847868">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4847871">}</span><br>
<span class="lineno"></span><span class="op" id="4847873">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4847876">func</span>&nbsp;<span class="op" id="4847881">(</span><span class="ident" id="4847882">b</span>&nbsp;<span class="op" id="4847884">*</span><span class="ident" id="4847885">Writer</span><span class="op" id="4847891">)</span>&nbsp;<span class="ident" id="4847893">writeN</span><span class="op" id="4847899">(</span><span class="ident" id="4847900">src</span>&nbsp;<span class="op" id="4847904">[</span><span class="op" id="4847905">]</span><span class="builtintype" id="4847906">byte</span><span class="op" id="4847910">,</span>&nbsp;<span class="ident" id="4847912">n</span>&nbsp;<span class="builtintype" id="4847914">int</span><span class="op" id="4847917">)</span>&nbsp;<span class="op" id="4847919">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4847922">for</span>&nbsp;<span class="ident" id="4847926">n</span>&nbsp;<span class="op" id="4847928">&gt;</span>&nbsp;<span class="builtinfunc" id="4847930">len</span><span class="op" id="4847933">(</span><span class="ident" id="4847934">src</span><span class="op" id="4847937">)</span>&nbsp;<span class="op" id="4847939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4847943">b</span><span class="op" id="4847944">.</span><span class="ident" id="4847945">write0</span><span class="op" id="4847951">(</span><span class="ident" id="4847952">src</span><span class="op" id="4847955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4847959">n</span>&nbsp;<span class="op" id="4847961">-=</span>&nbsp;<span class="builtinfunc" id="4847964">len</span><span class="op" id="4847967">(</span><span class="ident" id="4847968">src</span><span class="op" id="4847971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4847974">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4847977">b</span><span class="op" id="4847978">.</span><span class="ident" id="4847979">write0</span><span class="op" id="4847985">(</span><span class="ident" id="4847986">src</span><span class="op" id="4847989">[</span><span class="num" id="4847990">0</span><span class="op" id="4847991">:</span><span class="ident" id="4847992">n</span><span class="op" id="4847993">]</span><span class="op" id="4847994">)</span><br>
<span class="lineno">230</span><span class="op" id="4847996">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4847999">var</span>&nbsp;<span class="op" id="4848003">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4848006">newline</span>&nbsp;<span class="op" id="4848014">=</span>&nbsp;<span class="op" id="4848016">[</span><span class="op" id="4848017">]</span><span class="builtintype" id="4848018">byte</span><span class="op" id="4848022">{</span><span class="string" id="4848023">&#39;\n&#39;</span><span class="op" id="4848027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4848030">tabs</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4848038">=</span>&nbsp;<span class="op" id="4848040">[</span><span class="op" id="4848041">]</span><span class="builtintype" id="4848042">byte</span><span class="op" id="4848046">(</span><span class="string" id="4848047">&#34;\t\t\t\t\t\t\t\t&#34;</span><span class="op" id="4848065">)</span><br>
<span class="lineno">235</span><span class="op" id="4848067">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4848070">func</span>&nbsp;<span class="op" id="4848075">(</span><span class="ident" id="4848076">b</span>&nbsp;<span class="op" id="4848078">*</span><span class="ident" id="4848079">Writer</span><span class="op" id="4848085">)</span>&nbsp;<span class="ident" id="4848087">writePadding</span><span class="op" id="4848099">(</span><span class="ident" id="4848100">textw</span><span class="op" id="4848105">,</span>&nbsp;<span class="ident" id="4848107">cellw</span>&nbsp;<span class="builtintype" id="4848113">int</span><span class="op" id="4848116">,</span>&nbsp;<span class="ident" id="4848118">useTabs</span>&nbsp;<span class="builtintype" id="4848126">bool</span><span class="op" id="4848130">)</span>&nbsp;<span class="op" id="4848132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4848135">if</span>&nbsp;<span class="ident" id="4848138">b</span><span class="op" id="4848139">.</span><span class="ident" id="4848140">padbytes</span><span class="op" id="4848148">[</span><span class="num" id="4848149">0</span><span class="op" id="4848150">]</span>&nbsp;<span class="op" id="4848152">==</span>&nbsp;<span class="string" id="4848155">&#39;\t&#39;</span>&nbsp;<span class="op" id="4848160">||</span>&nbsp;<span class="ident" id="4848163">useTabs</span>&nbsp;<span class="op" id="4848171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4848175">//&nbsp;padding&nbsp;is&nbsp;done&nbsp;with&nbsp;tabs</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4848206">if</span>&nbsp;<span class="ident" id="4848209">b</span><span class="op" id="4848210">.</span><span class="ident" id="4848211">tabwidth</span>&nbsp;<span class="op" id="4848220">==</span>&nbsp;<span class="num" id="4848223">0</span>&nbsp;<span class="op" id="4848225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4848230">return</span>&nbsp;<span class="comment" id="4848237">//&nbsp;tabs&nbsp;have&nbsp;no&nbsp;width&nbsp;-&nbsp;can&#39;t&nbsp;do&nbsp;any&nbsp;padding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4848284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4848288">//&nbsp;make&nbsp;cellw&nbsp;the&nbsp;smallest&nbsp;multiple&nbsp;of&nbsp;b.tabwidth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4848340">cellw</span>&nbsp;<span class="op" id="4848346">=</span>&nbsp;<span class="op" id="4848348">(</span><span class="ident" id="4848349">cellw</span>&nbsp;<span class="op" id="4848355">+</span>&nbsp;<span class="ident" id="4848357">b</span><span class="op" id="4848358">.</span><span class="ident" id="4848359">tabwidth</span>&nbsp;<span class="op" id="4848368">-</span>&nbsp;<span class="num" id="4848370">1</span><span class="op" id="4848371">)</span>&nbsp;<span class="op" id="4848373">/</span>&nbsp;<span class="ident" id="4848375">b</span><span class="op" id="4848376">.</span><span class="ident" id="4848377">tabwidth</span>&nbsp;<span class="op" id="4848386">*</span>&nbsp;<span class="ident" id="4848388">b</span><span class="op" id="4848389">.</span><span class="ident" id="4848390">tabwidth</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4848401">n</span>&nbsp;<span class="op" id="4848403">:=</span>&nbsp;<span class="ident" id="4848406">cellw</span>&nbsp;<span class="op" id="4848412">-</span>&nbsp;<span class="ident" id="4848414">textw</span>&nbsp;<span class="comment" id="4848420">//&nbsp;amount&nbsp;of&nbsp;padding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4848443">if</span>&nbsp;<span class="ident" id="4848446">n</span>&nbsp;<span class="op" id="4848448">&lt;</span>&nbsp;<span class="num" id="4848450">0</span>&nbsp;<span class="op" id="4848452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4848457">panic</span><span class="op" id="4848462">(</span><span class="string" id="4848463">&#34;internal&nbsp;error&#34;</span><span class="op" id="4848479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4848483">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4848487">b</span><span class="op" id="4848488">.</span><span class="ident" id="4848489">writeN</span><span class="op" id="4848495">(</span><span class="ident" id="4848496">tabs</span><span class="op" id="4848500">,</span>&nbsp;<span class="op" id="4848502">(</span><span class="ident" id="4848503">n</span><span class="op" id="4848504">+</span><span class="ident" id="4848505">b</span><span class="op" id="4848506">.</span><span class="ident" id="4848507">tabwidth</span><span class="op" id="4848515">-</span><span class="num" id="4848516">1</span><span class="op" id="4848517">)</span><span class="op" id="4848518">/</span><span class="ident" id="4848519">b</span><span class="op" id="4848520">.</span><span class="ident" id="4848521">tabwidth</span><span class="op" id="4848529">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4848533">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4848541">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4848545">//&nbsp;padding&nbsp;is&nbsp;done&nbsp;with&nbsp;non-tab&nbsp;characters</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4848589">b</span><span class="op" id="4848590">.</span><span class="ident" id="4848591">writeN</span><span class="op" id="4848597">(</span><span class="ident" id="4848598">b</span><span class="op" id="4848599">.</span><span class="ident" id="4848600">padbytes</span><span class="op" id="4848608">[</span><span class="num" id="4848609">0</span><span class="op" id="4848610">:</span><span class="op" id="4848611">]</span><span class="op" id="4848612">,</span>&nbsp;<span class="ident" id="4848614">cellw</span><span class="op" id="4848619">-</span><span class="ident" id="4848620">textw</span><span class="op" id="4848625">)</span><br>
<span class="lineno">255</span><span class="op" id="4848627">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4848630">var</span>&nbsp;<span class="ident" id="4848634">vbar</span>&nbsp;<span class="op" id="4848639">=</span>&nbsp;<span class="op" id="4848641">[</span><span class="op" id="4848642">]</span><span class="builtintype" id="4848643">byte</span><span class="op" id="4848647">{</span><span class="string" id="4848648">&#39;|&#39;</span><span class="op" id="4848651">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4848654">func</span>&nbsp;<span class="op" id="4848659">(</span><span class="ident" id="4848660">b</span>&nbsp;<span class="op" id="4848662">*</span><span class="ident" id="4848663">Writer</span><span class="op" id="4848669">)</span>&nbsp;<span class="ident" id="4848671">writeLines</span><span class="op" id="4848681">(</span><span class="ident" id="4848682">pos0</span>&nbsp;<span class="builtintype" id="4848687">int</span><span class="op" id="4848690">,</span>&nbsp;<span class="ident" id="4848692">line0</span><span class="op" id="4848697">,</span>&nbsp;<span class="ident" id="4848699">line1</span>&nbsp;<span class="builtintype" id="4848705">int</span><span class="op" id="4848708">)</span>&nbsp;<span class="op" id="4848710">(</span><span class="ident" id="4848711">pos</span>&nbsp;<span class="builtintype" id="4848715">int</span><span class="op" id="4848718">)</span>&nbsp;<span class="op" id="4848720">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4848723">pos</span>&nbsp;<span class="op" id="4848727">=</span>&nbsp;<span class="ident" id="4848729">pos0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4848735">for</span>&nbsp;<span class="ident" id="4848739">i</span>&nbsp;<span class="op" id="4848741">:=</span>&nbsp;<span class="ident" id="4848744">line0</span><span class="op" id="4848749">;</span>&nbsp;<span class="ident" id="4848751">i</span>&nbsp;<span class="op" id="4848753">&lt;</span>&nbsp;<span class="ident" id="4848755">line1</span><span class="op" id="4848760">;</span>&nbsp;<span class="ident" id="4848762">i</span><span class="op" id="4848763">++</span>&nbsp;<span class="op" id="4848766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4848770">line</span>&nbsp;<span class="op" id="4848775">:=</span>&nbsp;<span class="ident" id="4848778">b</span><span class="op" id="4848779">.</span><span class="ident" id="4848780">lines</span><span class="op" id="4848785">[</span><span class="ident" id="4848786">i</span><span class="op" id="4848787">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4848792">//&nbsp;if&nbsp;TabIndent&nbsp;is&nbsp;set,&nbsp;use&nbsp;tabs&nbsp;to&nbsp;pad&nbsp;leading&nbsp;empty&nbsp;cells</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4848854">useTabs</span>&nbsp;<span class="op" id="4848862">:=</span>&nbsp;<span class="ident" id="4848865">b</span><span class="op" id="4848866">.</span><span class="ident" id="4848867">flags</span><span class="op" id="4848872">&amp;</span><span class="ident" id="4848873">TabIndent</span>&nbsp;<span class="op" id="4848883">!=</span>&nbsp;<span class="num" id="4848886">0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4848891">for</span>&nbsp;<span class="ident" id="4848895">j</span><span class="op" id="4848896">,</span>&nbsp;<span class="ident" id="4848898">c</span>&nbsp;<span class="op" id="4848900">:=</span>&nbsp;<span class="keyword" id="4848903">range</span>&nbsp;<span class="ident" id="4848909">line</span>&nbsp;<span class="op" id="4848914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4848919">if</span>&nbsp;<span class="ident" id="4848922">j</span>&nbsp;<span class="op" id="4848924">&gt;</span>&nbsp;<span class="num" id="4848926">0</span>&nbsp;<span class="op" id="4848928">&amp;&amp;</span>&nbsp;<span class="ident" id="4848931">b</span><span class="op" id="4848932">.</span><span class="ident" id="4848933">flags</span><span class="op" id="4848938">&amp;</span><span class="ident" id="4848939">Debug</span>&nbsp;<span class="op" id="4848945">!=</span>&nbsp;<span class="num" id="4848948">0</span>&nbsp;<span class="op" id="4848950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4848956">//&nbsp;indicate&nbsp;column&nbsp;break</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4848985">b</span><span class="op" id="4848986">.</span><span class="ident" id="4848987">write0</span><span class="op" id="4848993">(</span><span class="ident" id="4848994">vbar</span><span class="op" id="4848998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4849003">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4849009">if</span>&nbsp;<span class="ident" id="4849012">c</span><span class="op" id="4849013">.</span><span class="ident" id="4849014">size</span>&nbsp;<span class="op" id="4849019">==</span>&nbsp;<span class="num" id="4849022">0</span>&nbsp;<span class="op" id="4849024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4849030">//&nbsp;empty&nbsp;cell</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4849048">if</span>&nbsp;<span class="ident" id="4849051">j</span>&nbsp;<span class="op" id="4849053">&lt;</span>&nbsp;<span class="builtinfunc" id="4849055">len</span><span class="op" id="4849058">(</span><span class="ident" id="4849059">b</span><span class="op" id="4849060">.</span><span class="ident" id="4849061">widths</span><span class="op" id="4849067">)</span>&nbsp;<span class="op" id="4849069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4849076">b</span><span class="op" id="4849077">.</span><span class="ident" id="4849078">writePadding</span><span class="op" id="4849090">(</span><span class="ident" id="4849091">c</span><span class="op" id="4849092">.</span><span class="ident" id="4849093">width</span><span class="op" id="4849098">,</span>&nbsp;<span class="ident" id="4849100">b</span><span class="op" id="4849101">.</span><span class="ident" id="4849102">widths</span><span class="op" id="4849108">[</span><span class="ident" id="4849109">j</span><span class="op" id="4849110">]</span><span class="op" id="4849111">,</span>&nbsp;<span class="ident" id="4849113">useTabs</span><span class="op" id="4849120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4849126">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4849131">}</span>&nbsp;<span class="keyword" id="4849133">else</span>&nbsp;<span class="op" id="4849138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4849144">//&nbsp;non-empty&nbsp;cell</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4849166">useTabs</span>&nbsp;<span class="op" id="4849174">=</span>&nbsp;<span class="ident" id="4849176">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4849186">if</span>&nbsp;<span class="ident" id="4849189">b</span><span class="op" id="4849190">.</span><span class="ident" id="4849191">flags</span><span class="op" id="4849196">&amp;</span><span class="ident" id="4849197">AlignRight</span>&nbsp;<span class="op" id="4849208">==</span>&nbsp;<span class="num" id="4849211">0</span>&nbsp;<span class="op" id="4849213">{</span>&nbsp;<span class="comment" id="4849215">//&nbsp;align&nbsp;left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4849234">b</span><span class="op" id="4849235">.</span><span class="ident" id="4849236">write0</span><span class="op" id="4849242">(</span><span class="ident" id="4849243">b</span><span class="op" id="4849244">.</span><span class="ident" id="4849245">buf</span><span class="op" id="4849248">.</span><span class="ident" id="4849249">Bytes</span><span class="op" id="4849254">(</span><span class="op" id="4849255">)</span><span class="op" id="4849256">[</span><span class="ident" id="4849257">pos</span>&nbsp;<span class="op" id="4849261">:</span>&nbsp;<span class="ident" id="4849263">pos</span><span class="op" id="4849266">+</span><span class="ident" id="4849267">c</span><span class="op" id="4849268">.</span><span class="ident" id="4849269">size</span><span class="op" id="4849273">]</span><span class="op" id="4849274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4849281">pos</span>&nbsp;<span class="op" id="4849285">+=</span>&nbsp;<span class="ident" id="4849288">c</span><span class="op" id="4849289">.</span><span class="ident" id="4849290">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4849300">if</span>&nbsp;<span class="ident" id="4849303">j</span>&nbsp;<span class="op" id="4849305">&lt;</span>&nbsp;<span class="builtinfunc" id="4849307">len</span><span class="op" id="4849310">(</span><span class="ident" id="4849311">b</span><span class="op" id="4849312">.</span><span class="ident" id="4849313">widths</span><span class="op" id="4849319">)</span>&nbsp;<span class="op" id="4849321">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4849329">b</span><span class="op" id="4849330">.</span><span class="ident" id="4849331">writePadding</span><span class="op" id="4849343">(</span><span class="ident" id="4849344">c</span><span class="op" id="4849345">.</span><span class="ident" id="4849346">width</span><span class="op" id="4849351">,</span>&nbsp;<span class="ident" id="4849353">b</span><span class="op" id="4849354">.</span><span class="ident" id="4849355">widths</span><span class="op" id="4849361">[</span><span class="ident" id="4849362">j</span><span class="op" id="4849363">]</span><span class="op" id="4849364">,</span>&nbsp;<span class="ident" id="4849366">false</span><span class="op" id="4849371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4849378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4849384">}</span>&nbsp;<span class="keyword" id="4849386">else</span>&nbsp;<span class="op" id="4849391">{</span>&nbsp;<span class="comment" id="4849393">//&nbsp;align&nbsp;right</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4849413">if</span>&nbsp;<span class="ident" id="4849416">j</span>&nbsp;<span class="op" id="4849418">&lt;</span>&nbsp;<span class="builtinfunc" id="4849420">len</span><span class="op" id="4849423">(</span><span class="ident" id="4849424">b</span><span class="op" id="4849425">.</span><span class="ident" id="4849426">widths</span><span class="op" id="4849432">)</span>&nbsp;<span class="op" id="4849434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4849442">b</span><span class="op" id="4849443">.</span><span class="ident" id="4849444">writePadding</span><span class="op" id="4849456">(</span><span class="ident" id="4849457">c</span><span class="op" id="4849458">.</span><span class="ident" id="4849459">width</span><span class="op" id="4849464">,</span>&nbsp;<span class="ident" id="4849466">b</span><span class="op" id="4849467">.</span><span class="ident" id="4849468">widths</span><span class="op" id="4849474">[</span><span class="ident" id="4849475">j</span><span class="op" id="4849476">]</span><span class="op" id="4849477">,</span>&nbsp;<span class="ident" id="4849479">false</span><span class="op" id="4849484">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4849491">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4849498">b</span><span class="op" id="4849499">.</span><span class="ident" id="4849500">write0</span><span class="op" id="4849506">(</span><span class="ident" id="4849507">b</span><span class="op" id="4849508">.</span><span class="ident" id="4849509">buf</span><span class="op" id="4849512">.</span><span class="ident" id="4849513">Bytes</span><span class="op" id="4849518">(</span><span class="op" id="4849519">)</span><span class="op" id="4849520">[</span><span class="ident" id="4849521">pos</span>&nbsp;<span class="op" id="4849525">:</span>&nbsp;<span class="ident" id="4849527">pos</span><span class="op" id="4849530">+</span><span class="ident" id="4849531">c</span><span class="op" id="4849532">.</span><span class="ident" id="4849533">size</span><span class="op" id="4849537">]</span><span class="op" id="4849538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4849545">pos</span>&nbsp;<span class="op" id="4849549">+=</span>&nbsp;<span class="ident" id="4849552">c</span><span class="op" id="4849553">.</span><span class="ident" id="4849554">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4849563">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4849568">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4849572">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4849577">if</span>&nbsp;<span class="ident" id="4849580">i</span><span class="op" id="4849581">+</span><span class="num" id="4849582">1</span>&nbsp;<span class="op" id="4849584">==</span>&nbsp;<span class="builtinfunc" id="4849587">len</span><span class="op" id="4849590">(</span><span class="ident" id="4849591">b</span><span class="op" id="4849592">.</span><span class="ident" id="4849593">lines</span><span class="op" id="4849598">)</span>&nbsp;<span class="op" id="4849600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4849605">//&nbsp;last&nbsp;buffered&nbsp;line&nbsp;-&nbsp;we&nbsp;don&#39;t&nbsp;have&nbsp;a&nbsp;newline,&nbsp;so&nbsp;just&nbsp;write</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4849671">//&nbsp;any&nbsp;outstanding&nbsp;buffered&nbsp;data</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4849707">b</span><span class="op" id="4849708">.</span><span class="ident" id="4849709">write0</span><span class="op" id="4849715">(</span><span class="ident" id="4849716">b</span><span class="op" id="4849717">.</span><span class="ident" id="4849718">buf</span><span class="op" id="4849721">.</span><span class="ident" id="4849722">Bytes</span><span class="op" id="4849727">(</span><span class="op" id="4849728">)</span><span class="op" id="4849729">[</span><span class="ident" id="4849730">pos</span>&nbsp;<span class="op" id="4849734">:</span>&nbsp;<span class="ident" id="4849736">pos</span><span class="op" id="4849739">+</span><span class="ident" id="4849740">b</span><span class="op" id="4849741">.</span><span class="ident" id="4849742">cell</span><span class="op" id="4849746">.</span><span class="ident" id="4849747">size</span><span class="op" id="4849751">]</span><span class="op" id="4849752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4849757">pos</span>&nbsp;<span class="op" id="4849761">+=</span>&nbsp;<span class="ident" id="4849764">b</span><span class="op" id="4849765">.</span><span class="ident" id="4849766">cell</span><span class="op" id="4849770">.</span><span class="ident" id="4849771">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4849778">}</span>&nbsp;<span class="keyword" id="4849780">else</span>&nbsp;<span class="op" id="4849785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4849790">//&nbsp;not&nbsp;the&nbsp;last&nbsp;line&nbsp;-&nbsp;write&nbsp;newline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4849830">b</span><span class="op" id="4849831">.</span><span class="ident" id="4849832">write0</span><span class="op" id="4849838">(</span><span class="ident" id="4849839">newline</span><span class="op" id="4849846">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4849850">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4849853">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4849856">return</span><br>
<span class="lineno"></span><span class="op" id="4849863">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span><span class="comment" id="4849866">//&nbsp;Format&nbsp;the&nbsp;text&nbsp;between&nbsp;line0&nbsp;and&nbsp;line1&nbsp;(excluding&nbsp;line1);&nbsp;pos</span><br>
<span class="lineno"></span><span class="comment" id="4849932">//&nbsp;is&nbsp;the&nbsp;buffer&nbsp;position&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;beginning&nbsp;of&nbsp;line0.</span><br>
<span class="lineno"></span><span class="comment" id="4849999">//&nbsp;Returns&nbsp;the&nbsp;buffer&nbsp;position&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;beginning&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4850064">//&nbsp;line1&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="comment" id="4850095">//</span><br>
<span class="lineno">315</span><span class="keyword" id="4850098">func</span>&nbsp;<span class="op" id="4850103">(</span><span class="ident" id="4850104">b</span>&nbsp;<span class="op" id="4850106">*</span><span class="ident" id="4850107">Writer</span><span class="op" id="4850113">)</span>&nbsp;<span class="ident" id="4850115">format</span><span class="op" id="4850121">(</span><span class="ident" id="4850122">pos0</span>&nbsp;<span class="builtintype" id="4850127">int</span><span class="op" id="4850130">,</span>&nbsp;<span class="ident" id="4850132">line0</span><span class="op" id="4850137">,</span>&nbsp;<span class="ident" id="4850139">line1</span>&nbsp;<span class="builtintype" id="4850145">int</span><span class="op" id="4850148">)</span>&nbsp;<span class="op" id="4850150">(</span><span class="ident" id="4850151">pos</span>&nbsp;<span class="builtintype" id="4850155">int</span><span class="op" id="4850158">)</span>&nbsp;<span class="op" id="4850160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4850163">pos</span>&nbsp;<span class="op" id="4850167">=</span>&nbsp;<span class="ident" id="4850169">pos0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4850175">column</span>&nbsp;<span class="op" id="4850182">:=</span>&nbsp;<span class="builtinfunc" id="4850185">len</span><span class="op" id="4850188">(</span><span class="ident" id="4850189">b</span><span class="op" id="4850190">.</span><span class="ident" id="4850191">widths</span><span class="op" id="4850197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4850200">for</span>&nbsp;<span class="ident" id="4850204">this</span>&nbsp;<span class="op" id="4850209">:=</span>&nbsp;<span class="ident" id="4850212">line0</span><span class="op" id="4850217">;</span>&nbsp;<span class="ident" id="4850219">this</span>&nbsp;<span class="op" id="4850224">&lt;</span>&nbsp;<span class="ident" id="4850226">line1</span><span class="op" id="4850231">;</span>&nbsp;<span class="ident" id="4850233">this</span><span class="op" id="4850237">++</span>&nbsp;<span class="op" id="4850240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4850244">line</span>&nbsp;<span class="op" id="4850249">:=</span>&nbsp;<span class="ident" id="4850252">b</span><span class="op" id="4850253">.</span><span class="ident" id="4850254">lines</span><span class="op" id="4850259">[</span><span class="ident" id="4850260">this</span><span class="op" id="4850264">]</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4850269">if</span>&nbsp;<span class="ident" id="4850272">column</span>&nbsp;<span class="op" id="4850279">&lt;</span>&nbsp;<span class="builtinfunc" id="4850281">len</span><span class="op" id="4850284">(</span><span class="ident" id="4850285">line</span><span class="op" id="4850289">)</span><span class="op" id="4850290">-</span><span class="num" id="4850291">1</span>&nbsp;<span class="op" id="4850293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4850298">//&nbsp;cell&nbsp;exists&nbsp;in&nbsp;this&nbsp;column&nbsp;=&gt;&nbsp;this&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4850344">//&nbsp;has&nbsp;more&nbsp;cells&nbsp;than&nbsp;the&nbsp;previous&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4850388">//&nbsp;(the&nbsp;last&nbsp;cell&nbsp;per&nbsp;line&nbsp;is&nbsp;ignored&nbsp;because&nbsp;cells&nbsp;are</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4850447">//&nbsp;tab-terminated;&nbsp;the&nbsp;last&nbsp;cell&nbsp;per&nbsp;line&nbsp;describes&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4850506">//&nbsp;text&nbsp;before&nbsp;the&nbsp;newline/formfeed&nbsp;and&nbsp;does&nbsp;not&nbsp;belong</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4850565">//&nbsp;to&nbsp;a&nbsp;column)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4850585">//&nbsp;print&nbsp;unprinted&nbsp;lines&nbsp;until&nbsp;beginning&nbsp;of&nbsp;block</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4850638">pos</span>&nbsp;<span class="op" id="4850642">=</span>&nbsp;<span class="ident" id="4850644">b</span><span class="op" id="4850645">.</span><span class="ident" id="4850646">writeLines</span><span class="op" id="4850656">(</span><span class="ident" id="4850657">pos</span><span class="op" id="4850660">,</span>&nbsp;<span class="ident" id="4850662">line0</span><span class="op" id="4850667">,</span>&nbsp;<span class="ident" id="4850669">this</span><span class="op" id="4850673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4850678">line0</span>&nbsp;<span class="op" id="4850684">=</span>&nbsp;<span class="ident" id="4850686">this</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4850695">//&nbsp;column&nbsp;block&nbsp;begin</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4850720">width</span>&nbsp;<span class="op" id="4850726">:=</span>&nbsp;<span class="ident" id="4850729">b</span><span class="op" id="4850730">.</span><span class="ident" id="4850731">minwidth</span>&nbsp;<span class="comment" id="4850740">//&nbsp;minimal&nbsp;column&nbsp;width</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4850767">discardable</span>&nbsp;<span class="op" id="4850779">:=</span>&nbsp;<span class="ident" id="4850782">true</span>&nbsp;<span class="comment" id="4850787">//&nbsp;true&nbsp;if&nbsp;all&nbsp;cells&nbsp;in&nbsp;this&nbsp;column&nbsp;are&nbsp;empty&nbsp;and&nbsp;&#34;soft&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4850847">for</span>&nbsp;<span class="op" id="4850851">;</span>&nbsp;<span class="ident" id="4850853">this</span>&nbsp;<span class="op" id="4850858">&lt;</span>&nbsp;<span class="ident" id="4850860">line1</span><span class="op" id="4850865">;</span>&nbsp;<span class="ident" id="4850867">this</span><span class="op" id="4850871">++</span>&nbsp;<span class="op" id="4850874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4850880">line</span>&nbsp;<span class="op" id="4850885">=</span>&nbsp;<span class="ident" id="4850887">b</span><span class="op" id="4850888">.</span><span class="ident" id="4850889">lines</span><span class="op" id="4850894">[</span><span class="ident" id="4850895">this</span><span class="op" id="4850899">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4850905">if</span>&nbsp;<span class="ident" id="4850908">column</span>&nbsp;<span class="op" id="4850915">&lt;</span>&nbsp;<span class="builtinfunc" id="4850917">len</span><span class="op" id="4850920">(</span><span class="ident" id="4850921">line</span><span class="op" id="4850925">)</span><span class="op" id="4850926">-</span><span class="num" id="4850927">1</span>&nbsp;<span class="op" id="4850929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4850936">//&nbsp;cell&nbsp;exists&nbsp;in&nbsp;this&nbsp;column</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4850971">c</span>&nbsp;<span class="op" id="4850973">:=</span>&nbsp;<span class="ident" id="4850976">line</span><span class="op" id="4850980">[</span><span class="ident" id="4850981">column</span><span class="op" id="4850987">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4850994">//&nbsp;update&nbsp;width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4851015">if</span>&nbsp;<span class="ident" id="4851018">w</span>&nbsp;<span class="op" id="4851020">:=</span>&nbsp;<span class="ident" id="4851023">c</span><span class="op" id="4851024">.</span><span class="ident" id="4851025">width</span>&nbsp;<span class="op" id="4851031">+</span>&nbsp;<span class="ident" id="4851033">b</span><span class="op" id="4851034">.</span><span class="ident" id="4851035">padding</span><span class="op" id="4851042">;</span>&nbsp;<span class="ident" id="4851044">w</span>&nbsp;<span class="op" id="4851046">&gt;</span>&nbsp;<span class="ident" id="4851048">width</span>&nbsp;<span class="op" id="4851054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4851062">width</span>&nbsp;<span class="op" id="4851068">=</span>&nbsp;<span class="ident" id="4851070">w</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4851077">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4851084">//&nbsp;update&nbsp;discardable</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4851111">if</span>&nbsp;<span class="ident" id="4851114">c</span><span class="op" id="4851115">.</span><span class="ident" id="4851116">width</span>&nbsp;<span class="op" id="4851122">&gt;</span>&nbsp;<span class="num" id="4851124">0</span>&nbsp;<span class="op" id="4851126">||</span>&nbsp;<span class="ident" id="4851129">c</span><span class="op" id="4851130">.</span><span class="ident" id="4851131">htab</span>&nbsp;<span class="op" id="4851136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4851144">discardable</span>&nbsp;<span class="op" id="4851156">=</span>&nbsp;<span class="ident" id="4851158">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4851169">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4851175">}</span>&nbsp;<span class="keyword" id="4851177">else</span>&nbsp;<span class="op" id="4851182">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4851189">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4851199">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4851204">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4851209">//&nbsp;column&nbsp;block&nbsp;end</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4851233">//&nbsp;discard&nbsp;empty&nbsp;columns&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4851274">if</span>&nbsp;<span class="ident" id="4851277">discardable</span>&nbsp;<span class="op" id="4851289">&amp;&amp;</span>&nbsp;<span class="ident" id="4851292">b</span><span class="op" id="4851293">.</span><span class="ident" id="4851294">flags</span><span class="op" id="4851299">&amp;</span><span class="ident" id="4851300">DiscardEmptyColumns</span>&nbsp;<span class="op" id="4851320">!=</span>&nbsp;<span class="num" id="4851323">0</span>&nbsp;<span class="op" id="4851325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4851331">width</span>&nbsp;<span class="op" id="4851337">=</span>&nbsp;<span class="num" id="4851339">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4851344">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4851350">//&nbsp;format&nbsp;and&nbsp;print&nbsp;all&nbsp;columns&nbsp;to&nbsp;the&nbsp;right&nbsp;of&nbsp;this&nbsp;column</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4851413">//&nbsp;(we&nbsp;know&nbsp;the&nbsp;widths&nbsp;of&nbsp;this&nbsp;column&nbsp;and&nbsp;all&nbsp;columns&nbsp;to&nbsp;the&nbsp;left)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4851483">b</span><span class="op" id="4851484">.</span><span class="ident" id="4851485">widths</span>&nbsp;<span class="op" id="4851492">=</span>&nbsp;<span class="builtinfunc" id="4851494">append</span><span class="op" id="4851500">(</span><span class="ident" id="4851501">b</span><span class="op" id="4851502">.</span><span class="ident" id="4851503">widths</span><span class="op" id="4851509">,</span>&nbsp;<span class="ident" id="4851511">width</span><span class="op" id="4851516">)</span>&nbsp;<span class="comment" id="4851518">//&nbsp;push&nbsp;width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4851535">pos</span>&nbsp;<span class="op" id="4851539">=</span>&nbsp;<span class="ident" id="4851541">b</span><span class="op" id="4851542">.</span><span class="ident" id="4851543">format</span><span class="op" id="4851549">(</span><span class="ident" id="4851550">pos</span><span class="op" id="4851553">,</span>&nbsp;<span class="ident" id="4851555">line0</span><span class="op" id="4851560">,</span>&nbsp;<span class="ident" id="4851562">this</span><span class="op" id="4851566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4851571">b</span><span class="op" id="4851572">.</span><span class="ident" id="4851573">widths</span>&nbsp;<span class="op" id="4851580">=</span>&nbsp;<span class="ident" id="4851582">b</span><span class="op" id="4851583">.</span><span class="ident" id="4851584">widths</span><span class="op" id="4851590">[</span><span class="num" id="4851591">0</span>&nbsp;<span class="op" id="4851593">:</span>&nbsp;<span class="builtinfunc" id="4851595">len</span><span class="op" id="4851598">(</span><span class="ident" id="4851599">b</span><span class="op" id="4851600">.</span><span class="ident" id="4851601">widths</span><span class="op" id="4851607">)</span><span class="op" id="4851608">-</span><span class="num" id="4851609">1</span><span class="op" id="4851610">]</span>&nbsp;<span class="comment" id="4851612">//&nbsp;pop&nbsp;width</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4851628">line0</span>&nbsp;<span class="op" id="4851634">=</span>&nbsp;<span class="ident" id="4851636">this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4851643">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4851646">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4851650">//&nbsp;print&nbsp;unprinted&nbsp;lines&nbsp;until&nbsp;end</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4851686">return</span>&nbsp;<span class="ident" id="4851693">b</span><span class="op" id="4851694">.</span><span class="ident" id="4851695">writeLines</span><span class="op" id="4851705">(</span><span class="ident" id="4851706">pos</span><span class="op" id="4851709">,</span>&nbsp;<span class="ident" id="4851711">line0</span><span class="op" id="4851716">,</span>&nbsp;<span class="ident" id="4851718">line1</span><span class="op" id="4851723">)</span><br>
<span class="lineno"></span><span class="op" id="4851725">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4851728">//&nbsp;Append&nbsp;text&nbsp;to&nbsp;current&nbsp;cell.</span><br>
<span class="lineno"></span><span class="keyword" id="4851760">func</span>&nbsp;<span class="op" id="4851765">(</span><span class="ident" id="4851766">b</span>&nbsp;<span class="op" id="4851768">*</span><span class="ident" id="4851769">Writer</span><span class="op" id="4851775">)</span>&nbsp;<span class="builtinfunc" id="4851777">append</span><span class="op" id="4851783">(</span><span class="ident" id="4851784">text</span>&nbsp;<span class="op" id="4851789">[</span><span class="op" id="4851790">]</span><span class="builtintype" id="4851791">byte</span><span class="op" id="4851795">)</span>&nbsp;<span class="op" id="4851797">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4851800">b</span><span class="op" id="4851801">.</span><span class="ident" id="4851802">buf</span><span class="op" id="4851805">.</span><span class="ident" id="4851806">Write</span><span class="op" id="4851811">(</span><span class="ident" id="4851812">text</span><span class="op" id="4851816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4851819">b</span><span class="op" id="4851820">.</span><span class="ident" id="4851821">cell</span><span class="op" id="4851825">.</span><span class="ident" id="4851826">size</span>&nbsp;<span class="op" id="4851831">+=</span>&nbsp;<span class="builtinfunc" id="4851834">len</span><span class="op" id="4851837">(</span><span class="ident" id="4851838">text</span><span class="op" id="4851842">)</span><br>
<span class="lineno"></span><span class="op" id="4851844">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4851847">//&nbsp;Update&nbsp;the&nbsp;cell&nbsp;width.</span><br>
<span class="lineno">380</span><span class="keyword" id="4851873">func</span>&nbsp;<span class="op" id="4851878">(</span><span class="ident" id="4851879">b</span>&nbsp;<span class="op" id="4851881">*</span><span class="ident" id="4851882">Writer</span><span class="op" id="4851888">)</span>&nbsp;<span class="ident" id="4851890">updateWidth</span><span class="op" id="4851901">(</span><span class="op" id="4851902">)</span>&nbsp;<span class="op" id="4851904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4851907">b</span><span class="op" id="4851908">.</span><span class="ident" id="4851909">cell</span><span class="op" id="4851913">.</span><span class="ident" id="4851914">width</span>&nbsp;<span class="op" id="4851920">+=</span>&nbsp;<span class="ident" id="4851923">utf8</span><span class="op" id="4851927">.</span><span class="ident" id="4851928">RuneCount</span><span class="op" id="4851937">(</span><span class="ident" id="4851938">b</span><span class="op" id="4851939">.</span><span class="ident" id="4851940">buf</span><span class="op" id="4851943">.</span><span class="ident" id="4851944">Bytes</span><span class="op" id="4851949">(</span><span class="op" id="4851950">)</span><span class="op" id="4851951">[</span><span class="ident" id="4851952">b</span><span class="op" id="4851953">.</span><span class="ident" id="4851954">pos</span><span class="op" id="4851957">:</span><span class="ident" id="4851958">b</span><span class="op" id="4851959">.</span><span class="ident" id="4851960">buf</span><span class="op" id="4851963">.</span><span class="ident" id="4851964">Len</span><span class="op" id="4851967">(</span><span class="op" id="4851968">)</span><span class="op" id="4851969">]</span><span class="op" id="4851970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4851973">b</span><span class="op" id="4851974">.</span><span class="ident" id="4851975">pos</span>&nbsp;<span class="op" id="4851979">=</span>&nbsp;<span class="ident" id="4851981">b</span><span class="op" id="4851982">.</span><span class="ident" id="4851983">buf</span><span class="op" id="4851986">.</span><span class="ident" id="4851987">Len</span><span class="op" id="4851990">(</span><span class="op" id="4851991">)</span><br>
<span class="lineno"></span><span class="op" id="4851993">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="comment" id="4851996">//&nbsp;To&nbsp;escape&nbsp;a&nbsp;text&nbsp;segment,&nbsp;bracket&nbsp;it&nbsp;with&nbsp;Escape&nbsp;characters.</span><br>
<span class="lineno"></span><span class="comment" id="4852060">//&nbsp;For&nbsp;instance,&nbsp;the&nbsp;tab&nbsp;in&nbsp;this&nbsp;string&nbsp;&#34;Ignore&nbsp;this&nbsp;tab:&nbsp;\xff\t\xff&#34;</span><br>
<span class="lineno"></span><span class="comment" id="4852130">//&nbsp;does&nbsp;not&nbsp;terminate&nbsp;a&nbsp;cell&nbsp;and&nbsp;constitutes&nbsp;a&nbsp;single&nbsp;character&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4852197">//&nbsp;width&nbsp;one&nbsp;for&nbsp;formatting&nbsp;purposes.</span><br>
<span class="lineno"></span><span class="comment" id="4852235">//</span><br>
<span class="lineno">390</span><span class="comment" id="4852238">//&nbsp;The&nbsp;value&nbsp;0xff&nbsp;was&nbsp;chosen&nbsp;because&nbsp;it&nbsp;cannot&nbsp;appear&nbsp;in&nbsp;a&nbsp;valid&nbsp;UTF-8&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="comment" id="4852319">//</span><br>
<span class="lineno"></span><span class="keyword" id="4852322">const</span>&nbsp;<span class="ident" id="4852328">Escape</span>&nbsp;<span class="op" id="4852335">=</span>&nbsp;<span class="string" id="4852337">&#39;\xff&#39;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4852345">//&nbsp;Start&nbsp;escaped&nbsp;mode.</span><br>
<span class="lineno">395</span><span class="keyword" id="4852368">func</span>&nbsp;<span class="op" id="4852373">(</span><span class="ident" id="4852374">b</span>&nbsp;<span class="op" id="4852376">*</span><span class="ident" id="4852377">Writer</span><span class="op" id="4852383">)</span>&nbsp;<span class="ident" id="4852385">startEscape</span><span class="op" id="4852396">(</span><span class="ident" id="4852397">ch</span>&nbsp;<span class="builtintype" id="4852400">byte</span><span class="op" id="4852404">)</span>&nbsp;<span class="op" id="4852406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4852409">switch</span>&nbsp;<span class="ident" id="4852416">ch</span>&nbsp;<span class="op" id="4852419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4852422">case</span>&nbsp;<span class="ident" id="4852427">Escape</span><span class="op" id="4852433">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4852437">b</span><span class="op" id="4852438">.</span><span class="ident" id="4852439">endChar</span>&nbsp;<span class="op" id="4852447">=</span>&nbsp;<span class="ident" id="4852449">Escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4852457">case</span>&nbsp;<span class="string" id="4852462">&#39;&lt;&#39;</span><span class="op" id="4852465">:</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4852469">b</span><span class="op" id="4852470">.</span><span class="ident" id="4852471">endChar</span>&nbsp;<span class="op" id="4852479">=</span>&nbsp;<span class="string" id="4852481">&#39;&gt;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4852486">case</span>&nbsp;<span class="string" id="4852491">&#39;&amp;&#39;</span><span class="op" id="4852494">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4852498">b</span><span class="op" id="4852499">.</span><span class="ident" id="4852500">endChar</span>&nbsp;<span class="op" id="4852508">=</span>&nbsp;<span class="string" id="4852510">&#39;;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4852515">}</span><br>
<span class="lineno"></span><span class="op" id="4852517">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="comment" id="4852520">//&nbsp;Terminate&nbsp;escaped&nbsp;mode.&nbsp;If&nbsp;the&nbsp;escaped&nbsp;text&nbsp;was&nbsp;an&nbsp;HTML&nbsp;tag,&nbsp;its&nbsp;width</span><br>
<span class="lineno"></span><span class="comment" id="4852594">//&nbsp;is&nbsp;assumed&nbsp;to&nbsp;be&nbsp;zero&nbsp;for&nbsp;formatting&nbsp;purposes;&nbsp;if&nbsp;it&nbsp;was&nbsp;an&nbsp;HTML&nbsp;entity,</span><br>
<span class="lineno"></span><span class="comment" id="4852670">//&nbsp;its&nbsp;width&nbsp;is&nbsp;assumed&nbsp;to&nbsp;be&nbsp;one.&nbsp;In&nbsp;all&nbsp;other&nbsp;cases,&nbsp;the&nbsp;width&nbsp;is&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4852742">//&nbsp;unicode&nbsp;width&nbsp;of&nbsp;the&nbsp;text.</span><br>
<span class="lineno">410</span><span class="comment" id="4852772">//</span><br>
<span class="lineno"></span><span class="keyword" id="4852775">func</span>&nbsp;<span class="op" id="4852780">(</span><span class="ident" id="4852781">b</span>&nbsp;<span class="op" id="4852783">*</span><span class="ident" id="4852784">Writer</span><span class="op" id="4852790">)</span>&nbsp;<span class="ident" id="4852792">endEscape</span><span class="op" id="4852801">(</span><span class="op" id="4852802">)</span>&nbsp;<span class="op" id="4852804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4852807">switch</span>&nbsp;<span class="ident" id="4852814">b</span><span class="op" id="4852815">.</span><span class="ident" id="4852816">endChar</span>&nbsp;<span class="op" id="4852824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4852827">case</span>&nbsp;<span class="ident" id="4852832">Escape</span><span class="op" id="4852838">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4852842">b</span><span class="op" id="4852843">.</span><span class="ident" id="4852844">updateWidth</span><span class="op" id="4852855">(</span><span class="op" id="4852856">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4852860">if</span>&nbsp;<span class="ident" id="4852863">b</span><span class="op" id="4852864">.</span><span class="ident" id="4852865">flags</span><span class="op" id="4852870">&amp;</span><span class="ident" id="4852871">StripEscape</span>&nbsp;<span class="op" id="4852883">==</span>&nbsp;<span class="num" id="4852886">0</span>&nbsp;<span class="op" id="4852888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4852893">b</span><span class="op" id="4852894">.</span><span class="ident" id="4852895">cell</span><span class="op" id="4852899">.</span><span class="ident" id="4852900">width</span>&nbsp;<span class="op" id="4852906">-=</span>&nbsp;<span class="num" id="4852909">2</span>&nbsp;<span class="comment" id="4852911">//&nbsp;don&#39;t&nbsp;count&nbsp;the&nbsp;Escape&nbsp;chars</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4852945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4852948">case</span>&nbsp;<span class="string" id="4852953">&#39;&gt;&#39;</span><span class="op" id="4852956">:</span>&nbsp;<span class="comment" id="4852958">//&nbsp;tag&nbsp;of&nbsp;zero&nbsp;width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4852980">case</span>&nbsp;<span class="string" id="4852985">&#39;;&#39;</span><span class="op" id="4852988">:</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4852992">b</span><span class="op" id="4852993">.</span><span class="ident" id="4852994">cell</span><span class="op" id="4852998">.</span><span class="ident" id="4852999">width</span><span class="op" id="4853004">++</span>&nbsp;<span class="comment" id="4853007">//&nbsp;entity,&nbsp;count&nbsp;as&nbsp;one&nbsp;rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4853037">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4853040">b</span><span class="op" id="4853041">.</span><span class="ident" id="4853042">pos</span>&nbsp;<span class="op" id="4853046">=</span>&nbsp;<span class="ident" id="4853048">b</span><span class="op" id="4853049">.</span><span class="ident" id="4853050">buf</span><span class="op" id="4853053">.</span><span class="ident" id="4853054">Len</span><span class="op" id="4853057">(</span><span class="op" id="4853058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4853061">b</span><span class="op" id="4853062">.</span><span class="ident" id="4853063">endChar</span>&nbsp;<span class="op" id="4853071">=</span>&nbsp;<span class="num" id="4853073">0</span><br>
<span class="lineno"></span><span class="op" id="4853075">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span><span class="comment" id="4853078">//&nbsp;Terminate&nbsp;the&nbsp;current&nbsp;cell&nbsp;by&nbsp;adding&nbsp;it&nbsp;to&nbsp;the&nbsp;list&nbsp;of&nbsp;cells&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4853149">//&nbsp;current&nbsp;line.&nbsp;Returns&nbsp;the&nbsp;number&nbsp;of&nbsp;cells&nbsp;in&nbsp;that&nbsp;line.</span><br>
<span class="lineno"></span><span class="comment" id="4853208">//</span><br>
<span class="lineno"></span><span class="keyword" id="4853211">func</span>&nbsp;<span class="op" id="4853216">(</span><span class="ident" id="4853217">b</span>&nbsp;<span class="op" id="4853219">*</span><span class="ident" id="4853220">Writer</span><span class="op" id="4853226">)</span>&nbsp;<span class="ident" id="4853228">terminateCell</span><span class="op" id="4853241">(</span><span class="ident" id="4853242">htab</span>&nbsp;<span class="builtintype" id="4853247">bool</span><span class="op" id="4853251">)</span>&nbsp;<span class="builtintype" id="4853253">int</span>&nbsp;<span class="op" id="4853257">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4853260">b</span><span class="op" id="4853261">.</span><span class="ident" id="4853262">cell</span><span class="op" id="4853266">.</span><span class="ident" id="4853267">htab</span>&nbsp;<span class="op" id="4853272">=</span>&nbsp;<span class="ident" id="4853274">htab</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4853280">line</span>&nbsp;<span class="op" id="4853285">:=</span>&nbsp;<span class="op" id="4853288">&amp;</span><span class="ident" id="4853289">b</span><span class="op" id="4853290">.</span><span class="ident" id="4853291">lines</span><span class="op" id="4853296">[</span><span class="builtinfunc" id="4853297">len</span><span class="op" id="4853300">(</span><span class="ident" id="4853301">b</span><span class="op" id="4853302">.</span><span class="ident" id="4853303">lines</span><span class="op" id="4853308">)</span><span class="op" id="4853309">-</span><span class="num" id="4853310">1</span><span class="op" id="4853311">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4853314">*</span><span class="ident" id="4853315">line</span>&nbsp;<span class="op" id="4853320">=</span>&nbsp;<span class="builtinfunc" id="4853322">append</span><span class="op" id="4853328">(</span><span class="op" id="4853329">*</span><span class="ident" id="4853330">line</span><span class="op" id="4853334">,</span>&nbsp;<span class="ident" id="4853336">b</span><span class="op" id="4853337">.</span><span class="ident" id="4853338">cell</span><span class="op" id="4853342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4853345">b</span><span class="op" id="4853346">.</span><span class="ident" id="4853347">cell</span>&nbsp;<span class="op" id="4853352">=</span>&nbsp;<span class="ident" id="4853354">cell</span><span class="op" id="4853358">{</span><span class="op" id="4853359">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4853362">return</span>&nbsp;<span class="builtinfunc" id="4853369">len</span><span class="op" id="4853372">(</span><span class="op" id="4853373">*</span><span class="ident" id="4853374">line</span><span class="op" id="4853378">)</span><br>
<span class="lineno">435</span><span class="op" id="4853380">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4853383">func</span>&nbsp;<span class="ident" id="4853388">handlePanic</span><span class="op" id="4853399">(</span><span class="ident" id="4853400">err</span>&nbsp;<span class="op" id="4853404">*</span><span class="builtintype" id="4853405">error</span><span class="op" id="4853410">,</span>&nbsp;<span class="ident" id="4853412">op</span>&nbsp;<span class="builtintype" id="4853415">string</span><span class="op" id="4853421">)</span>&nbsp;<span class="op" id="4853423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4853426">if</span>&nbsp;<span class="ident" id="4853429">e</span>&nbsp;<span class="op" id="4853431">:=</span>&nbsp;<span class="builtinfunc" id="4853434">recover</span><span class="op" id="4853441">(</span><span class="op" id="4853442">)</span><span class="op" id="4853443">;</span>&nbsp;<span class="ident" id="4853445">e</span>&nbsp;<span class="op" id="4853447">!=</span>&nbsp;<span class="ident" id="4853450">nil</span>&nbsp;<span class="op" id="4853454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4853458">if</span>&nbsp;<span class="ident" id="4853461">nerr</span><span class="op" id="4853465">,</span>&nbsp;<span class="ident" id="4853467">ok</span>&nbsp;<span class="op" id="4853470">:=</span>&nbsp;<span class="ident" id="4853473">e</span><span class="op" id="4853474">.</span><span class="op" id="4853475">(</span><span class="ident" id="4853476">osError</span><span class="op" id="4853483">)</span><span class="op" id="4853484">;</span>&nbsp;<span class="ident" id="4853486">ok</span>&nbsp;<span class="op" id="4853489">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4853494">*</span><span class="ident" id="4853495">err</span>&nbsp;<span class="op" id="4853499">=</span>&nbsp;<span class="ident" id="4853501">nerr</span><span class="op" id="4853505">.</span><span class="ident" id="4853506">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4853513">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4853522">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4853526">panic</span><span class="op" id="4853531">(</span><span class="string" id="4853532">&#34;tabwriter:&nbsp;panic&nbsp;during&nbsp;&#34;</span>&nbsp;<span class="op" id="4853559">+</span>&nbsp;<span class="ident" id="4853561">op</span><span class="op" id="4853563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4853566">}</span><br>
<span class="lineno">445</span><span class="op" id="4853568">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4853571">//&nbsp;Flush&nbsp;should&nbsp;be&nbsp;called&nbsp;after&nbsp;the&nbsp;last&nbsp;call&nbsp;to&nbsp;Write&nbsp;to&nbsp;ensure</span><br>
<span class="lineno"></span><span class="comment" id="4853636">//&nbsp;that&nbsp;any&nbsp;data&nbsp;buffered&nbsp;in&nbsp;the&nbsp;Writer&nbsp;is&nbsp;written&nbsp;to&nbsp;output.&nbsp;Any</span><br>
<span class="lineno"></span><span class="comment" id="4853702">//&nbsp;incomplete&nbsp;escape&nbsp;sequence&nbsp;at&nbsp;the&nbsp;end&nbsp;is&nbsp;considered</span><br>
<span class="lineno">450</span><span class="comment" id="4853757">//&nbsp;complete&nbsp;for&nbsp;formatting&nbsp;purposes.</span><br>
<span class="lineno"></span><span class="comment" id="4853794">//</span><br>
<span class="lineno"></span><span class="keyword" id="4853797">func</span>&nbsp;<span class="op" id="4853802">(</span><span class="ident" id="4853803">b</span>&nbsp;<span class="op" id="4853805">*</span><span class="ident" id="4853806">Writer</span><span class="op" id="4853812">)</span>&nbsp;<span class="ident" id="4853814">Flush</span><span class="op" id="4853819">(</span><span class="op" id="4853820">)</span>&nbsp;<span class="op" id="4853822">(</span><span class="ident" id="4853823">err</span>&nbsp;<span class="builtintype" id="4853827">error</span><span class="op" id="4853832">)</span>&nbsp;<span class="op" id="4853834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4853837">defer</span>&nbsp;<span class="ident" id="4853843">b</span><span class="op" id="4853844">.</span><span class="ident" id="4853845">reset</span><span class="op" id="4853850">(</span><span class="op" id="4853851">)</span>&nbsp;<span class="comment" id="4853853">//&nbsp;even&nbsp;in&nbsp;the&nbsp;presence&nbsp;of&nbsp;errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4853888">defer</span>&nbsp;<span class="ident" id="4853894">handlePanic</span><span class="op" id="4853905">(</span><span class="op" id="4853906">&amp;</span><span class="ident" id="4853907">err</span><span class="op" id="4853910">,</span>&nbsp;<span class="string" id="4853912">&#34;Flush&#34;</span><span class="op" id="4853919">)</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4853923">//&nbsp;add&nbsp;current&nbsp;cell&nbsp;if&nbsp;not&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4853957">if</span>&nbsp;<span class="ident" id="4853960">b</span><span class="op" id="4853961">.</span><span class="ident" id="4853962">cell</span><span class="op" id="4853966">.</span><span class="ident" id="4853967">size</span>&nbsp;<span class="op" id="4853972">&gt;</span>&nbsp;<span class="num" id="4853974">0</span>&nbsp;<span class="op" id="4853976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4853980">if</span>&nbsp;<span class="ident" id="4853983">b</span><span class="op" id="4853984">.</span><span class="ident" id="4853985">endChar</span>&nbsp;<span class="op" id="4853993">!=</span>&nbsp;<span class="num" id="4853996">0</span>&nbsp;<span class="op" id="4853998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4854003">//&nbsp;inside&nbsp;escape&nbsp;-&nbsp;terminate&nbsp;it&nbsp;even&nbsp;if&nbsp;incomplete</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4854057">b</span><span class="op" id="4854058">.</span><span class="ident" id="4854059">endEscape</span><span class="op" id="4854068">(</span><span class="op" id="4854069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4854073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4854077">b</span><span class="op" id="4854078">.</span><span class="ident" id="4854079">terminateCell</span><span class="op" id="4854092">(</span><span class="ident" id="4854093">false</span><span class="op" id="4854098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4854101">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4854105">//&nbsp;format&nbsp;contents&nbsp;of&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4854135">b</span><span class="op" id="4854136">.</span><span class="ident" id="4854137">format</span><span class="op" id="4854143">(</span><span class="num" id="4854144">0</span><span class="op" id="4854145">,</span>&nbsp;<span class="num" id="4854147">0</span><span class="op" id="4854148">,</span>&nbsp;<span class="builtinfunc" id="4854150">len</span><span class="op" id="4854153">(</span><span class="ident" id="4854154">b</span><span class="op" id="4854155">.</span><span class="ident" id="4854156">lines</span><span class="op" id="4854161">)</span><span class="op" id="4854162">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4854166">return</span><br>
<span class="lineno"></span><span class="op" id="4854173">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span><span class="keyword" id="4854176">var</span>&nbsp;<span class="ident" id="4854180">hbar</span>&nbsp;<span class="op" id="4854185">=</span>&nbsp;<span class="op" id="4854187">[</span><span class="op" id="4854188">]</span><span class="builtintype" id="4854189">byte</span><span class="op" id="4854193">(</span><span class="string" id="4854194">&#34;---\n&#34;</span><span class="op" id="4854201">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4854204">//&nbsp;Write&nbsp;writes&nbsp;buf&nbsp;to&nbsp;the&nbsp;writer&nbsp;b.</span><br>
<span class="lineno"></span><span class="comment" id="4854241">//&nbsp;The&nbsp;only&nbsp;errors&nbsp;returned&nbsp;are&nbsp;ones&nbsp;encountered</span><br>
<span class="lineno">475</span><span class="comment" id="4854290">//&nbsp;while&nbsp;writing&nbsp;to&nbsp;the&nbsp;underlying&nbsp;output&nbsp;stream.</span><br>
<span class="lineno"></span><span class="comment" id="4854340">//</span><br>
<span class="lineno"></span><span class="keyword" id="4854343">func</span>&nbsp;<span class="op" id="4854348">(</span><span class="ident" id="4854349">b</span>&nbsp;<span class="op" id="4854351">*</span><span class="ident" id="4854352">Writer</span><span class="op" id="4854358">)</span>&nbsp;<span class="ident" id="4854360">Write</span><span class="op" id="4854365">(</span><span class="ident" id="4854366">buf</span>&nbsp;<span class="op" id="4854370">[</span><span class="op" id="4854371">]</span><span class="builtintype" id="4854372">byte</span><span class="op" id="4854376">)</span>&nbsp;<span class="op" id="4854378">(</span><span class="ident" id="4854379">n</span>&nbsp;<span class="builtintype" id="4854381">int</span><span class="op" id="4854384">,</span>&nbsp;<span class="ident" id="4854386">err</span>&nbsp;<span class="builtintype" id="4854390">error</span><span class="op" id="4854395">)</span>&nbsp;<span class="op" id="4854397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4854400">defer</span>&nbsp;<span class="ident" id="4854406">handlePanic</span><span class="op" id="4854417">(</span><span class="op" id="4854418">&amp;</span><span class="ident" id="4854419">err</span><span class="op" id="4854422">,</span>&nbsp;<span class="string" id="4854424">&#34;Write&#34;</span><span class="op" id="4854431">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4854435">//&nbsp;split&nbsp;text&nbsp;into&nbsp;cells</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4854461">n</span>&nbsp;<span class="op" id="4854463">=</span>&nbsp;<span class="num" id="4854465">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4854468">for</span>&nbsp;<span class="ident" id="4854472">i</span><span class="op" id="4854473">,</span>&nbsp;<span class="ident" id="4854475">ch</span>&nbsp;<span class="op" id="4854478">:=</span>&nbsp;<span class="keyword" id="4854481">range</span>&nbsp;<span class="ident" id="4854487">buf</span>&nbsp;<span class="op" id="4854491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4854495">if</span>&nbsp;<span class="ident" id="4854498">b</span><span class="op" id="4854499">.</span><span class="ident" id="4854500">endChar</span>&nbsp;<span class="op" id="4854508">==</span>&nbsp;<span class="num" id="4854511">0</span>&nbsp;<span class="op" id="4854513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4854518">//&nbsp;outside&nbsp;escape</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4854539">switch</span>&nbsp;<span class="ident" id="4854546">ch</span>&nbsp;<span class="op" id="4854549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4854554">case</span>&nbsp;<span class="string" id="4854559">&#39;\t&#39;</span><span class="op" id="4854563">,</span>&nbsp;<span class="string" id="4854565">&#39;\v&#39;</span><span class="op" id="4854569">,</span>&nbsp;<span class="string" id="4854571">&#39;\n&#39;</span><span class="op" id="4854575">,</span>&nbsp;<span class="string" id="4854577">&#39;\f&#39;</span><span class="op" id="4854581">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4854587">//&nbsp;end&nbsp;of&nbsp;cell</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4854606">b</span><span class="op" id="4854607">.</span><span class="builtinfunc" id="4854608">append</span><span class="op" id="4854614">(</span><span class="ident" id="4854615">buf</span><span class="op" id="4854618">[</span><span class="ident" id="4854619">n</span><span class="op" id="4854620">:</span><span class="ident" id="4854621">i</span><span class="op" id="4854622">]</span><span class="op" id="4854623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4854629">b</span><span class="op" id="4854630">.</span><span class="ident" id="4854631">updateWidth</span><span class="op" id="4854642">(</span><span class="op" id="4854643">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4854649">n</span>&nbsp;<span class="op" id="4854651">=</span>&nbsp;<span class="ident" id="4854653">i</span>&nbsp;<span class="op" id="4854655">+</span>&nbsp;<span class="num" id="4854657">1</span>&nbsp;<span class="comment" id="4854659">//&nbsp;ch&nbsp;consumed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4854678">ncells</span>&nbsp;<span class="op" id="4854685">:=</span>&nbsp;<span class="ident" id="4854688">b</span><span class="op" id="4854689">.</span><span class="ident" id="4854690">terminateCell</span><span class="op" id="4854703">(</span><span class="ident" id="4854704">ch</span>&nbsp;<span class="op" id="4854707">==</span>&nbsp;<span class="string" id="4854710">&#39;\t&#39;</span><span class="op" id="4854714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4854720">if</span>&nbsp;<span class="ident" id="4854723">ch</span>&nbsp;<span class="op" id="4854726">==</span>&nbsp;<span class="string" id="4854729">&#39;\n&#39;</span>&nbsp;<span class="op" id="4854734">||</span>&nbsp;<span class="ident" id="4854737">ch</span>&nbsp;<span class="op" id="4854740">==</span>&nbsp;<span class="string" id="4854743">&#39;\f&#39;</span>&nbsp;<span class="op" id="4854748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4854755">//&nbsp;terminate&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4854778">b</span><span class="op" id="4854779">.</span><span class="ident" id="4854780">addLine</span><span class="op" id="4854787">(</span><span class="op" id="4854788">)</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4854795">if</span>&nbsp;<span class="ident" id="4854798">ch</span>&nbsp;<span class="op" id="4854801">==</span>&nbsp;<span class="string" id="4854804">&#39;\f&#39;</span>&nbsp;<span class="op" id="4854809">||</span>&nbsp;<span class="ident" id="4854812">ncells</span>&nbsp;<span class="op" id="4854819">==</span>&nbsp;<span class="num" id="4854822">1</span>&nbsp;<span class="op" id="4854824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4854832">//&nbsp;A&nbsp;&#39;\f&#39;&nbsp;always&nbsp;forces&nbsp;a&nbsp;flush.&nbsp;Otherwise,&nbsp;if&nbsp;the&nbsp;previous</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4854898">//&nbsp;line&nbsp;has&nbsp;only&nbsp;one&nbsp;cell&nbsp;which&nbsp;does&nbsp;not&nbsp;have&nbsp;an&nbsp;impact&nbsp;on</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4854963">//&nbsp;the&nbsp;formatting&nbsp;of&nbsp;the&nbsp;following&nbsp;lines&nbsp;(the&nbsp;last&nbsp;cell&nbsp;per</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4855029">//&nbsp;line&nbsp;is&nbsp;ignored&nbsp;by&nbsp;format()),&nbsp;thus&nbsp;we&nbsp;can&nbsp;flush&nbsp;the</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4855090">//&nbsp;Writer&nbsp;contents.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4855116">if</span>&nbsp;<span class="ident" id="4855119">err</span>&nbsp;<span class="op" id="4855123">=</span>&nbsp;<span class="ident" id="4855125">b</span><span class="op" id="4855126">.</span><span class="ident" id="4855127">Flush</span><span class="op" id="4855132">(</span><span class="op" id="4855133">)</span><span class="op" id="4855134">;</span>&nbsp;<span class="ident" id="4855136">err</span>&nbsp;<span class="op" id="4855140">!=</span>&nbsp;<span class="ident" id="4855143">nil</span>&nbsp;<span class="op" id="4855147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4855156">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4855169">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4855177">if</span>&nbsp;<span class="ident" id="4855180">ch</span>&nbsp;<span class="op" id="4855183">==</span>&nbsp;<span class="string" id="4855186">&#39;\f&#39;</span>&nbsp;<span class="op" id="4855191">&amp;&amp;</span>&nbsp;<span class="ident" id="4855194">b</span><span class="op" id="4855195">.</span><span class="ident" id="4855196">flags</span><span class="op" id="4855201">&amp;</span><span class="ident" id="4855202">Debug</span>&nbsp;<span class="op" id="4855208">!=</span>&nbsp;<span class="num" id="4855211">0</span>&nbsp;<span class="op" id="4855213">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4855222">//&nbsp;indicate&nbsp;section&nbsp;break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4855255">b</span><span class="op" id="4855256">.</span><span class="ident" id="4855257">write0</span><span class="op" id="4855263">(</span><span class="ident" id="4855264">hbar</span><span class="op" id="4855268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4855276">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4855283">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4855289">}</span><br>
<span class="lineno">510</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4855295">case</span>&nbsp;<span class="ident" id="4855300">Escape</span><span class="op" id="4855306">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4855312">//&nbsp;start&nbsp;of&nbsp;escaped&nbsp;sequence</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4855345">b</span><span class="op" id="4855346">.</span><span class="builtinfunc" id="4855347">append</span><span class="op" id="4855353">(</span><span class="ident" id="4855354">buf</span><span class="op" id="4855357">[</span><span class="ident" id="4855358">n</span><span class="op" id="4855359">:</span><span class="ident" id="4855360">i</span><span class="op" id="4855361">]</span><span class="op" id="4855362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4855368">b</span><span class="op" id="4855369">.</span><span class="ident" id="4855370">updateWidth</span><span class="op" id="4855381">(</span><span class="op" id="4855382">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4855388">n</span>&nbsp;<span class="op" id="4855390">=</span>&nbsp;<span class="ident" id="4855392">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4855398">if</span>&nbsp;<span class="ident" id="4855401">b</span><span class="op" id="4855402">.</span><span class="ident" id="4855403">flags</span><span class="op" id="4855408">&amp;</span><span class="ident" id="4855409">StripEscape</span>&nbsp;<span class="op" id="4855421">!=</span>&nbsp;<span class="num" id="4855424">0</span>&nbsp;<span class="op" id="4855426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4855433">n</span><span class="op" id="4855434">++</span>&nbsp;<span class="comment" id="4855437">//&nbsp;strip&nbsp;Escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4855457">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4855463">b</span><span class="op" id="4855464">.</span><span class="ident" id="4855465">startEscape</span><span class="op" id="4855476">(</span><span class="ident" id="4855477">Escape</span><span class="op" id="4855483">)</span><br>
<span class="lineno">520</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4855489">case</span>&nbsp;<span class="string" id="4855494">&#39;&lt;&#39;</span><span class="op" id="4855497">,</span>&nbsp;<span class="string" id="4855499">&#39;&amp;&#39;</span><span class="op" id="4855502">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4855508">//&nbsp;possibly&nbsp;an&nbsp;html&nbsp;tag/entity</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4855543">if</span>&nbsp;<span class="ident" id="4855546">b</span><span class="op" id="4855547">.</span><span class="ident" id="4855548">flags</span><span class="op" id="4855553">&amp;</span><span class="ident" id="4855554">FilterHTML</span>&nbsp;<span class="op" id="4855565">!=</span>&nbsp;<span class="num" id="4855568">0</span>&nbsp;<span class="op" id="4855570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4855577">//&nbsp;begin&nbsp;of&nbsp;tag/entity</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4855605">b</span><span class="op" id="4855606">.</span><span class="builtinfunc" id="4855607">append</span><span class="op" id="4855613">(</span><span class="ident" id="4855614">buf</span><span class="op" id="4855617">[</span><span class="ident" id="4855618">n</span><span class="op" id="4855619">:</span><span class="ident" id="4855620">i</span><span class="op" id="4855621">]</span><span class="op" id="4855622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4855629">b</span><span class="op" id="4855630">.</span><span class="ident" id="4855631">updateWidth</span><span class="op" id="4855642">(</span><span class="op" id="4855643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4855650">n</span>&nbsp;<span class="op" id="4855652">=</span>&nbsp;<span class="ident" id="4855654">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4855661">b</span><span class="op" id="4855662">.</span><span class="ident" id="4855663">startEscape</span><span class="op" id="4855674">(</span><span class="ident" id="4855675">ch</span><span class="op" id="4855677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4855683">}</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4855688">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4855693">}</span>&nbsp;<span class="keyword" id="4855695">else</span>&nbsp;<span class="op" id="4855700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4855705">//&nbsp;inside&nbsp;escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4855725">if</span>&nbsp;<span class="ident" id="4855728">ch</span>&nbsp;<span class="op" id="4855731">==</span>&nbsp;<span class="ident" id="4855734">b</span><span class="op" id="4855735">.</span><span class="ident" id="4855736">endChar</span>&nbsp;<span class="op" id="4855744">{</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4855750">//&nbsp;end&nbsp;of&nbsp;tag/entity</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4855775">j</span>&nbsp;<span class="op" id="4855777">:=</span>&nbsp;<span class="ident" id="4855780">i</span>&nbsp;<span class="op" id="4855782">+</span>&nbsp;<span class="num" id="4855784">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4855790">if</span>&nbsp;<span class="ident" id="4855793">ch</span>&nbsp;<span class="op" id="4855796">==</span>&nbsp;<span class="ident" id="4855799">Escape</span>&nbsp;<span class="op" id="4855806">&amp;&amp;</span>&nbsp;<span class="ident" id="4855809">b</span><span class="op" id="4855810">.</span><span class="ident" id="4855811">flags</span><span class="op" id="4855816">&amp;</span><span class="ident" id="4855817">StripEscape</span>&nbsp;<span class="op" id="4855829">!=</span>&nbsp;<span class="num" id="4855832">0</span>&nbsp;<span class="op" id="4855834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4855841">j</span>&nbsp;<span class="op" id="4855843">=</span>&nbsp;<span class="ident" id="4855845">i</span>&nbsp;<span class="comment" id="4855847">//&nbsp;strip&nbsp;Escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4855867">}</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4855873">b</span><span class="op" id="4855874">.</span><span class="builtinfunc" id="4855875">append</span><span class="op" id="4855881">(</span><span class="ident" id="4855882">buf</span><span class="op" id="4855885">[</span><span class="ident" id="4855886">n</span><span class="op" id="4855887">:</span><span class="ident" id="4855888">j</span><span class="op" id="4855889">]</span><span class="op" id="4855890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4855896">n</span>&nbsp;<span class="op" id="4855898">=</span>&nbsp;<span class="ident" id="4855900">i</span>&nbsp;<span class="op" id="4855902">+</span>&nbsp;<span class="num" id="4855904">1</span>&nbsp;<span class="comment" id="4855906">//&nbsp;ch&nbsp;consumed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4855925">b</span><span class="op" id="4855926">.</span><span class="ident" id="4855927">endEscape</span><span class="op" id="4855936">(</span><span class="op" id="4855937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4855942">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4855946">}</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4855949">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4855953">//&nbsp;append&nbsp;leftover&nbsp;text</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4855978">b</span><span class="op" id="4855979">.</span><span class="builtinfunc" id="4855980">append</span><span class="op" id="4855986">(</span><span class="ident" id="4855987">buf</span><span class="op" id="4855990">[</span><span class="ident" id="4855991">n</span><span class="op" id="4855992">:</span><span class="op" id="4855993">]</span><span class="op" id="4855994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4855997">n</span>&nbsp;<span class="op" id="4855999">=</span>&nbsp;<span class="builtinfunc" id="4856001">len</span><span class="op" id="4856004">(</span><span class="ident" id="4856005">buf</span><span class="op" id="4856008">)</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4856011">return</span><br>
<span class="lineno"></span><span class="op" id="4856018">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4856021">//&nbsp;NewWriter&nbsp;allocates&nbsp;and&nbsp;initializes&nbsp;a&nbsp;new&nbsp;tabwriter.Writer.</span><br>
<span class="lineno"></span><span class="comment" id="4856084">//&nbsp;The&nbsp;parameters&nbsp;are&nbsp;the&nbsp;same&nbsp;as&nbsp;for&nbsp;the&nbsp;Init&nbsp;function.</span><br>
<span class="lineno">555</span><span class="comment" id="4856141">//</span><br>
<span class="lineno"></span><span class="keyword" id="4856144">func</span>&nbsp;<span class="ident" id="4856149">NewWriter</span><span class="op" id="4856158">(</span><span class="ident" id="4856159">output</span>&nbsp;<span class="ident" id="4856166">io</span><span class="op" id="4856168">.</span><span class="ident" id="4856169">Writer</span><span class="op" id="4856175">,</span>&nbsp;<span class="ident" id="4856177">minwidth</span><span class="op" id="4856185">,</span>&nbsp;<span class="ident" id="4856187">tabwidth</span><span class="op" id="4856195">,</span>&nbsp;<span class="ident" id="4856197">padding</span>&nbsp;<span class="builtintype" id="4856205">int</span><span class="op" id="4856208">,</span>&nbsp;<span class="ident" id="4856210">padchar</span>&nbsp;<span class="builtintype" id="4856218">byte</span><span class="op" id="4856222">,</span>&nbsp;<span class="ident" id="4856224">flags</span>&nbsp;<span class="builtintype" id="4856230">uint</span><span class="op" id="4856234">)</span>&nbsp;<span class="op" id="4856236">*</span><span class="ident" id="4856237">Writer</span>&nbsp;<span class="op" id="4856244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4856247">return</span>&nbsp;<span class="builtinfunc" id="4856254">new</span><span class="op" id="4856257">(</span><span class="ident" id="4856258">Writer</span><span class="op" id="4856264">)</span><span class="op" id="4856265">.</span><span class="ident" id="4856266">Init</span><span class="op" id="4856270">(</span><span class="ident" id="4856271">output</span><span class="op" id="4856277">,</span>&nbsp;<span class="ident" id="4856279">minwidth</span><span class="op" id="4856287">,</span>&nbsp;<span class="ident" id="4856289">tabwidth</span><span class="op" id="4856297">,</span>&nbsp;<span class="ident" id="4856299">padding</span><span class="op" id="4856306">,</span>&nbsp;<span class="ident" id="4856308">padchar</span><span class="op" id="4856315">,</span>&nbsp;<span class="ident" id="4856317">flags</span><span class="op" id="4856322">)</span><br>
<span class="lineno"></span><span class="op" id="4856324">}</span>
</div>
</body>
</html>
