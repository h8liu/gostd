<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html" class="current">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4490240">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4490295">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4490349">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4490400">package</span>&nbsp;<span class="ident" id="4490408">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4490413">import</span>&nbsp;<span class="op" id="4490420">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4490423">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4490432">&#34;crypto&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4490442">&#34;crypto/ecdsa&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4490458">&#34;crypto/rsa&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4490472">&#34;crypto/subtle&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4490489">&#34;crypto/x509&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4490504">&#34;errors&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4490514">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4490521">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4490527">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4490534">&#34;strconv&#34;</span><br>
<span class="lineno"></span><span class="op" id="4490544">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="4490547">type</span>&nbsp;<span class="ident" id="4490552">clientHandshakeState</span>&nbsp;<span class="keyword" id="4490573">struct</span>&nbsp;<span class="op" id="4490580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4490583">c</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4490596">*</span><span class="ident" id="4490597"><a href="/gostd/crypto/tls/conn.go.html#4461903">Conn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4490603">serverHello</span>&nbsp;&nbsp;<span class="op" id="4490616">*</span><span class="ident" id="4490617"><a href="/gostd/crypto/tls/handshake_messages.go.html#4519382">serverHelloMsg</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4490633">hello</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4490646">*</span><span class="ident" id="4490647"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508266">clientHelloMsg</a></span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4490663">suite</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4490676">*</span><span class="ident" id="4490677"><a href="/gostd/crypto/tls/cipher_suites.go.html#4434677">cipherSuite</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4490690">finishedHash</span>&nbsp;<span class="ident" id="4490703"><a href="/gostd/crypto/tls/prf.go.html#4575783">finishedHash</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4490717">masterSecret</span>&nbsp;<span class="op" id="4490730">[</span><span class="op" id="4490731">]</span><span class="builtintype" id="4490732">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4490738">session</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4490751">*</span><span class="ident" id="4490752"><a href="/gostd/crypto/tls/common.go.html#4448159">ClientSessionState</a></span><br>
<span class="lineno"></span><span class="op" id="4490771">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="keyword" id="4490774">func</span>&nbsp;<span class="op" id="4490779">(</span><span class="ident" id="4490780">c</span>&nbsp;<span class="op" id="4490782">*</span><span class="ident" id="4490783"><a href="/gostd/crypto/tls/conn.go.html#4461903">Conn</a></span><span class="op" id="4490787">)</span>&nbsp;<span class="ident" id="4490789">clientHandshake</span><span class="op" id="4490804">(</span><span class="op" id="4490805">)</span>&nbsp;<span class="builtintype" id="4490807">error</span>&nbsp;<span class="op" id="4490813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4490816">if</span>&nbsp;<span class="ident" id="4490819"><a href="/gostd/crypto/tls/handshake_client.go.html#4490780">c</a></span><span class="op" id="4490820">.</span><span class="ident" id="4490821"><a href="/gostd/crypto/tls/conn.go.html#4462274">config</a></span>&nbsp;<span class="op" id="4490828">==</span>&nbsp;<span class="builtintype" id="4490831">nil</span>&nbsp;<span class="op" id="4490835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4490839"><a href="/gostd/crypto/tls/handshake_client.go.html#4490780">c</a></span><span class="op" id="4490840">.</span><span class="ident" id="4490841"><a href="/gostd/crypto/tls/conn.go.html#4462274">config</a></span>&nbsp;<span class="op" id="4490848">=</span>&nbsp;<span class="ident" id="4490850"><a href="/gostd/crypto/tls/common.go.html#4460898">defaultConfig</a></span><span class="op" id="4490863">(</span><span class="op" id="4490864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4490867">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4490871">if</span>&nbsp;<span class="builtinfunc" id="4490874">len</span><span class="op" id="4490877">(</span><span class="ident" id="4490878"><a href="/gostd/crypto/tls/handshake_client.go.html#4490780">c</a></span><span class="op" id="4490879">.</span><span class="ident" id="4490880"><a href="/gostd/crypto/tls/conn.go.html#4462274">config</a></span><span class="op" id="4490886">.</span><span class="ident" id="4490887"><a href="/gostd/crypto/tls/common.go.html#4452279">ServerName</a></span><span class="op" id="4490897">)</span>&nbsp;<span class="op" id="4490899">==</span>&nbsp;<span class="num" id="4490902">0</span>&nbsp;<span class="op" id="4490904">&amp;&amp;</span>&nbsp;<span class="op" id="4490907">!</span><span class="ident" id="4490908"><a href="/gostd/crypto/tls/handshake_client.go.html#4490780">c</a></span><span class="op" id="4490909">.</span><span class="ident" id="4490910"><a href="/gostd/crypto/tls/conn.go.html#4462274">config</a></span><span class="op" id="4490916">.</span><span class="ident" id="4490917"><a href="/gostd/crypto/tls/common.go.html#4452970">InsecureSkipVerify</a></span>&nbsp;<span class="op" id="4490936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4490940">return</span>&nbsp;<span class="ident" id="4490947"><a href="/gostd/crypto/tls/handshake_client.go.html#4490504">errors</a></span><span class="op" id="4490953">.</span><span class="ident" id="4490954"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4490957">(</span><span class="string" id="4490958">&#34;tls:&nbsp;either&nbsp;ServerName&nbsp;or&nbsp;InsecureSkipVerify&nbsp;must&nbsp;be&nbsp;specified&nbsp;in&nbsp;the&nbsp;tls.Config&#34;</span><span class="op" id="4491040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4491043">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4491047">nextProtosLength</span>&nbsp;<span class="op" id="4491064">:=</span>&nbsp;<span class="num" id="4491067">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4491070">for</span>&nbsp;<span class="ident" id="4491074">_</span><span class="op" id="4491075">,</span>&nbsp;<span class="ident" id="4491077">proto</span>&nbsp;<span class="op" id="4491083">:=</span>&nbsp;<span class="keyword" id="4491086">range</span>&nbsp;<span class="ident" id="4491092"><a href="/gostd/crypto/tls/handshake_client.go.html#4490780">c</a></span><span class="op" id="4491093">.</span><span class="ident" id="4491094"><a href="/gostd/crypto/tls/conn.go.html#4462274">config</a></span><span class="op" id="4491100">.</span><span class="ident" id="4491101"><a href="/gostd/crypto/tls/common.go.html#4452064">NextProtos</a></span>&nbsp;<span class="op" id="4491112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4491116">if</span>&nbsp;<span class="ident" id="4491119">l</span>&nbsp;<span class="op" id="4491121">:=</span>&nbsp;<span class="builtinfunc" id="4491124">len</span><span class="op" id="4491127">(</span><span class="ident" id="4491128"><a href="/gostd/crypto/tls/handshake_client.go.html#4491077">proto</a></span><span class="op" id="4491133">)</span><span class="op" id="4491134">;</span>&nbsp;<span class="ident" id="4491136"><a href="/gostd/crypto/tls/handshake_client.go.html#4491119">l</a></span>&nbsp;<span class="op" id="4491138">==</span>&nbsp;<span class="num" id="4491141">0</span>&nbsp;<span class="op" id="4491143">||</span>&nbsp;<span class="ident" id="4491146"><a href="/gostd/crypto/tls/handshake_client.go.html#4491119">l</a></span>&nbsp;<span class="op" id="4491148">&gt;</span>&nbsp;<span class="num" id="4491150">255</span>&nbsp;<span class="op" id="4491154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4491159">return</span>&nbsp;<span class="ident" id="4491166"><a href="/gostd/crypto/tls/handshake_client.go.html#4490504">errors</a></span><span class="op" id="4491172">.</span><span class="ident" id="4491173"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4491176">(</span><span class="string" id="4491177">&#34;tls:&nbsp;invalid&nbsp;NextProtos&nbsp;value&#34;</span><span class="op" id="4491208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4491212">}</span>&nbsp;<span class="keyword" id="4491214">else</span>&nbsp;<span class="op" id="4491219">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4491224"><a href="/gostd/crypto/tls/handshake_client.go.html#4491047">nextProtosLength</a></span>&nbsp;<span class="op" id="4491241">+=</span>&nbsp;<span class="num" id="4491244">1</span>&nbsp;<span class="op" id="4491246">+</span>&nbsp;<span class="ident" id="4491248"><a href="/gostd/crypto/tls/handshake_client.go.html#4491119">l</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4491252">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4491255">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4491258">if</span>&nbsp;<span class="ident" id="4491261"><a href="/gostd/crypto/tls/handshake_client.go.html#4491047">nextProtosLength</a></span>&nbsp;<span class="op" id="4491278">&gt;</span>&nbsp;<span class="num" id="4491280">0xffff</span>&nbsp;<span class="op" id="4491287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4491291">return</span>&nbsp;<span class="ident" id="4491298"><a href="/gostd/crypto/tls/handshake_client.go.html#4490504">errors</a></span><span class="op" id="4491304">.</span><span class="ident" id="4491305"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4491308">(</span><span class="string" id="4491309">&#34;tls:&nbsp;NextProtos&nbsp;values&nbsp;too&nbsp;large&#34;</span><span class="op" id="4491343">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4491346">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4491350">hello</span>&nbsp;<span class="op" id="4491356">:=</span>&nbsp;<span class="op" id="4491359">&amp;</span><span class="ident" id="4491360"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508266">clientHelloMsg</a></span><span class="op" id="4491374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4491378"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508319">vers</a></span><span class="op" id="4491382">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4491399"><a href="/gostd/crypto/tls/handshake_client.go.html#4490780">c</a></span><span class="op" id="4491400">.</span><span class="ident" id="4491401"><a href="/gostd/crypto/tls/conn.go.html#4462274">config</a></span><span class="op" id="4491407">.</span><span class="ident" id="4491408"><a href="/gostd/crypto/tls/common.go.html#4455539">maxVersion</a></span><span class="op" id="4491418">(</span><span class="op" id="4491419">)</span><span class="op" id="4491420">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4491424"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508433">compressionMethods</a></span><span class="op" id="4491442">:</span>&nbsp;&nbsp;<span class="op" id="4491445">[</span><span class="op" id="4491446">]</span><span class="builtintype" id="4491447">uint8</span><span class="op" id="4491452">{</span><span class="ident" id="4491453"><a href="/gostd/crypto/tls/common.go.html#4443628">compressionNone</a></span><span class="op" id="4491468">}</span><span class="op" id="4491469">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4491473"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508347">random</a></span><span class="op" id="4491479">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4491494">make</span><span class="op" id="4491498">(</span><span class="op" id="4491499">[</span><span class="op" id="4491500">]</span><span class="builtintype" id="4491501">byte</span><span class="op" id="4491505">,</span>&nbsp;<span class="num" id="4491507">32</span><span class="op" id="4491509">)</span><span class="op" id="4491510">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4491514"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508516">ocspStapling</a></span><span class="op" id="4491526">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4491535">true</span><span class="op" id="4491539">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4491543"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508488">serverName</a></span><span class="op" id="4491553">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4491564"><a href="/gostd/crypto/tls/handshake_client.go.html#4490780">c</a></span><span class="op" id="4491565">.</span><span class="ident" id="4491566"><a href="/gostd/crypto/tls/conn.go.html#4462274">config</a></span><span class="op" id="4491572">.</span><span class="ident" id="4491573"><a href="/gostd/crypto/tls/common.go.html#4452279">ServerName</a></span><span class="op" id="4491583">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4491587"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508542">supportedCurves</a></span><span class="op" id="4491602">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4491608"><a href="/gostd/crypto/tls/handshake_client.go.html#4490780">c</a></span><span class="op" id="4491609">.</span><span class="ident" id="4491610"><a href="/gostd/crypto/tls/conn.go.html#4462274">config</a></span><span class="op" id="4491616">.</span><span class="ident" id="4491617"><a href="/gostd/crypto/tls/common.go.html#4455735">curvePreferences</a></span><span class="op" id="4491633">(</span><span class="op" id="4491634">)</span><span class="op" id="4491635">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4491639"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508573">supportedPoints</a></span><span class="op" id="4491654">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4491660">[</span><span class="op" id="4491661">]</span><span class="builtintype" id="4491662">uint8</span><span class="op" id="4491667">{</span><span class="ident" id="4491668"><a href="/gostd/crypto/tls/common.go.html#4444571">pointFormatUncompressed</a></span><span class="op" id="4491691">}</span><span class="op" id="4491692">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4491696"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508462">nextProtoNeg</a></span><span class="op" id="4491708">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4491717">len</span><span class="op" id="4491720">(</span><span class="ident" id="4491721"><a href="/gostd/crypto/tls/handshake_client.go.html#4490780">c</a></span><span class="op" id="4491722">.</span><span class="ident" id="4491723"><a href="/gostd/crypto/tls/conn.go.html#4462274">config</a></span><span class="op" id="4491729">.</span><span class="ident" id="4491730"><a href="/gostd/crypto/tls/common.go.html#4452064">NextProtos</a></span><span class="op" id="4491740">)</span>&nbsp;<span class="op" id="4491742">&gt;</span>&nbsp;<span class="num" id="4491744">0</span><span class="op" id="4491745">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4491749"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508697">secureRenegotiation</a></span><span class="op" id="4491768">:</span>&nbsp;<span class="builtintype" id="4491770">true</span><span class="op" id="4491774">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4491778"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508723">alpnProtocols</a></span><span class="op" id="4491791">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4491799"><a href="/gostd/crypto/tls/handshake_client.go.html#4490780">c</a></span><span class="op" id="4491800">.</span><span class="ident" id="4491801"><a href="/gostd/crypto/tls/conn.go.html#4462274">config</a></span><span class="op" id="4491807">.</span><span class="ident" id="4491808"><a href="/gostd/crypto/tls/common.go.html#4452064">NextProtos</a></span><span class="op" id="4491818">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4491821">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4491825">possibleCipherSuites</span>&nbsp;<span class="op" id="4491846">:=</span>&nbsp;<span class="ident" id="4491849"><a href="/gostd/crypto/tls/handshake_client.go.html#4490780">c</a></span><span class="op" id="4491850">.</span><span class="ident" id="4491851"><a href="/gostd/crypto/tls/conn.go.html#4462274">config</a></span><span class="op" id="4491857">.</span><span class="ident" id="4491858"><a href="/gostd/crypto/tls/common.go.html#4455294">cipherSuites</a></span><span class="op" id="4491870">(</span><span class="op" id="4491871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4491874"><a href="/gostd/crypto/tls/handshake_client.go.html#4491350">hello</a></span><span class="op" id="4491879">.</span><span class="ident" id="4491880"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508403">cipherSuites</a></span>&nbsp;<span class="op" id="4491893">=</span>&nbsp;<span class="builtinfunc" id="4491895">make</span><span class="op" id="4491899">(</span><span class="op" id="4491900">[</span><span class="op" id="4491901">]</span><span class="builtintype" id="4491902">uint16</span><span class="op" id="4491908">,</span>&nbsp;<span class="num" id="4491910">0</span><span class="op" id="4491911">,</span>&nbsp;<span class="builtinfunc" id="4491913">len</span><span class="op" id="4491916">(</span><span class="ident" id="4491917"><a href="/gostd/crypto/tls/handshake_client.go.html#4491825">possibleCipherSuites</a></span><span class="op" id="4491937">)</span><span class="op" id="4491938">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="4491941">NextCipherSuite</span><span class="op" id="4491956">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4491959">for</span>&nbsp;<span class="ident" id="4491963">_</span><span class="op" id="4491964">,</span>&nbsp;<span class="ident" id="4491966">suiteId</span>&nbsp;<span class="op" id="4491974">:=</span>&nbsp;<span class="keyword" id="4491977">range</span>&nbsp;<span class="ident" id="4491983"><a href="/gostd/crypto/tls/handshake_client.go.html#4491825">possibleCipherSuites</a></span>&nbsp;<span class="op" id="4492004">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4492008">for</span>&nbsp;<span class="ident" id="4492012">_</span><span class="op" id="4492013">,</span>&nbsp;<span class="ident" id="4492015">suite</span>&nbsp;<span class="op" id="4492021">:=</span>&nbsp;<span class="keyword" id="4492024">range</span>&nbsp;<span class="ident" id="4492030"><a href="/gostd/crypto/tls/cipher_suites.go.html#4435091">cipherSuites</a></span>&nbsp;<span class="op" id="4492043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4492048">if</span>&nbsp;<span class="ident" id="4492051"><a href="/gostd/crypto/tls/handshake_client.go.html#4492015">suite</a></span><span class="op" id="4492056">.</span><span class="ident" id="4492057"><a href="/gostd/crypto/tls/cipher_suites.go.html#4434699">id</a></span>&nbsp;<span class="op" id="4492060">!=</span>&nbsp;<span class="ident" id="4492063"><a href="/gostd/crypto/tls/handshake_client.go.html#4491966">suiteId</a></span>&nbsp;<span class="op" id="4492071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4492077">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4492089">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4492094">//&nbsp;Don&#39;t&nbsp;advertise&nbsp;TLS&nbsp;1.2-only&nbsp;cipher&nbsp;suites&nbsp;unless</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4492150">//&nbsp;we&#39;re&nbsp;attempting&nbsp;TLS&nbsp;1.2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4492182">if</span>&nbsp;<span class="ident" id="4492185"><a href="/gostd/crypto/tls/handshake_client.go.html#4491350">hello</a></span><span class="op" id="4492190">.</span><span class="ident" id="4492191"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508319">vers</a></span>&nbsp;<span class="op" id="4492196">&lt;</span>&nbsp;<span class="ident" id="4492198"><a href="/gostd/crypto/tls/common.go.html#4442509">VersionTLS12</a></span>&nbsp;<span class="op" id="4492211">&amp;&amp;</span>&nbsp;<span class="ident" id="4492214"><a href="/gostd/crypto/tls/handshake_client.go.html#4492015">suite</a></span><span class="op" id="4492219">.</span><span class="ident" id="4492220"><a href="/gostd/crypto/tls/cipher_suites.go.html#4434914">flags</a></span><span class="op" id="4492225">&amp;</span><span class="ident" id="4492226"><a href="/gostd/crypto/tls/cipher_suites.go.html#4434515">suiteTLS12</a></span>&nbsp;<span class="op" id="4492237">!=</span>&nbsp;<span class="num" id="4492240">0</span>&nbsp;<span class="op" id="4492242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4492248">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4492260">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4492265"><a href="/gostd/crypto/tls/handshake_client.go.html#4491350">hello</a></span><span class="op" id="4492270">.</span><span class="ident" id="4492271"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508403">cipherSuites</a></span>&nbsp;<span class="op" id="4492284">=</span>&nbsp;<span class="builtinfunc" id="4492286">append</span><span class="op" id="4492292">(</span><span class="ident" id="4492293"><a href="/gostd/crypto/tls/handshake_client.go.html#4491350">hello</a></span><span class="op" id="4492298">.</span><span class="ident" id="4492299"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508403">cipherSuites</a></span><span class="op" id="4492311">,</span>&nbsp;<span class="ident" id="4492313"><a href="/gostd/crypto/tls/handshake_client.go.html#4491966">suiteId</a></span><span class="op" id="4492320">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4492325">continue</span>&nbsp;<span class="ident" id="4492334"><a href="/gostd/crypto/tls/handshake_client.go.html#4491941">NextCipherSuite</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4492352">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4492355">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4492359">_</span><span class="op" id="4492360">,</span>&nbsp;<span class="ident" id="4492362">err</span>&nbsp;<span class="op" id="4492366">:=</span>&nbsp;<span class="ident" id="4492369"><a href="/gostd/crypto/tls/handshake_client.go.html#4490521">io</a></span><span class="op" id="4492371">.</span><span class="ident" id="4492372"><a href="/gostd/io/io.go.html#1429706">ReadFull</a></span><span class="op" id="4492380">(</span><span class="ident" id="4492381"><a href="/gostd/crypto/tls/handshake_client.go.html#4490780">c</a></span><span class="op" id="4492382">.</span><span class="ident" id="4492383"><a href="/gostd/crypto/tls/conn.go.html#4462274">config</a></span><span class="op" id="4492389">.</span><span class="ident" id="4492390"><a href="/gostd/crypto/tls/common.go.html#4455096">rand</a></span><span class="op" id="4492394">(</span><span class="op" id="4492395">)</span><span class="op" id="4492396">,</span>&nbsp;<span class="ident" id="4492398"><a href="/gostd/crypto/tls/handshake_client.go.html#4491350">hello</a></span><span class="op" id="4492403">.</span><span class="ident" id="4492404"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508347">random</a></span><span class="op" id="4492410">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4492413">if</span>&nbsp;<span class="ident" id="4492416"><a href="/gostd/crypto/tls/handshake_client.go.html#4492362">err</a></span>&nbsp;<span class="op" id="4492420">!=</span>&nbsp;<span class="builtintype" id="4492423">nil</span>&nbsp;<span class="op" id="4492427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4492431"><a href="/gostd/crypto/tls/handshake_client.go.html#4490780">c</a></span><span class="op" id="4492432">.</span><span class="ident" id="4492433"><a href="/gostd/crypto/tls/conn.go.html#4480829">sendAlert</a></span><span class="op" id="4492442">(</span><span class="ident" id="4492443"><a href="/gostd/crypto/tls/alert.go.html#4431016">alertInternalError</a></span><span class="op" id="4492461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4492465">return</span>&nbsp;<span class="ident" id="4492472"><a href="/gostd/crypto/tls/handshake_client.go.html#4490504">errors</a></span><span class="op" id="4492478">.</span><span class="ident" id="4492479"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4492482">(</span><span class="string" id="4492483">&#34;tls:&nbsp;short&nbsp;read&nbsp;from&nbsp;Rand:&nbsp;&#34;</span>&nbsp;<span class="op" id="4492513">+</span>&nbsp;<span class="ident" id="4492515"><a href="/gostd/crypto/tls/handshake_client.go.html#4492362">err</a></span><span class="op" id="4492518">.</span><span class="ident" id="4492519">Error</span><span class="op" id="4492524">(</span><span class="op" id="4492525">)</span><span class="op" id="4492526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4492529">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4492533">if</span>&nbsp;<span class="ident" id="4492536"><a href="/gostd/crypto/tls/handshake_client.go.html#4491350">hello</a></span><span class="op" id="4492541">.</span><span class="ident" id="4492542"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508319">vers</a></span>&nbsp;<span class="op" id="4492547">&gt;=</span>&nbsp;<span class="ident" id="4492550"><a href="/gostd/crypto/tls/common.go.html#4442509">VersionTLS12</a></span>&nbsp;<span class="op" id="4492563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4492567"><a href="/gostd/crypto/tls/handshake_client.go.html#4491350">hello</a></span><span class="op" id="4492572">.</span><span class="ident" id="4492573"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508657">signatureAndHashes</a></span>&nbsp;<span class="op" id="4492592">=</span>&nbsp;<span class="ident" id="4492594"><a href="/gostd/crypto/tls/common.go.html#4445959">supportedSKXSignatureAlgorithms</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4492627">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4492631">var</span>&nbsp;<span class="ident" id="4492635">session</span>&nbsp;<span class="op" id="4492643">*</span><span class="ident" id="4492644"><a href="/gostd/crypto/tls/common.go.html#4448159">ClientSessionState</a></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4492664">var</span>&nbsp;<span class="ident" id="4492668">cacheKey</span>&nbsp;<span class="builtintype" id="4492677">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4492685">sessionCache</span>&nbsp;<span class="op" id="4492698">:=</span>&nbsp;<span class="ident" id="4492701"><a href="/gostd/crypto/tls/handshake_client.go.html#4490780">c</a></span><span class="op" id="4492702">.</span><span class="ident" id="4492703"><a href="/gostd/crypto/tls/conn.go.html#4462274">config</a></span><span class="op" id="4492709">.</span><span class="ident" id="4492710"><a href="/gostd/crypto/tls/common.go.html#4454124">ClientSessionCache</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4492730">if</span>&nbsp;<span class="ident" id="4492733"><a href="/gostd/crypto/tls/handshake_client.go.html#4490780">c</a></span><span class="op" id="4492734">.</span><span class="ident" id="4492735"><a href="/gostd/crypto/tls/conn.go.html#4462274">config</a></span><span class="op" id="4492741">.</span><span class="ident" id="4492742"><a href="/gostd/crypto/tls/common.go.html#4453556">SessionTicketsDisabled</a></span>&nbsp;<span class="op" id="4492765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4492769"><a href="/gostd/crypto/tls/handshake_client.go.html#4492685">sessionCache</a></span>&nbsp;<span class="op" id="4492782">=</span>&nbsp;<span class="builtintype" id="4492784">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4492789">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4492793">if</span>&nbsp;<span class="ident" id="4492796"><a href="/gostd/crypto/tls/handshake_client.go.html#4492685">sessionCache</a></span>&nbsp;<span class="op" id="4492809">!=</span>&nbsp;<span class="builtintype" id="4492812">nil</span>&nbsp;<span class="op" id="4492816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4492820"><a href="/gostd/crypto/tls/handshake_client.go.html#4491350">hello</a></span><span class="op" id="4492825">.</span><span class="ident" id="4492826"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508602">ticketSupported</a></span>&nbsp;<span class="op" id="4492842">=</span>&nbsp;<span class="builtintype" id="4492844">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4492852">//&nbsp;Try&nbsp;to&nbsp;resume&nbsp;a&nbsp;previously&nbsp;negotiated&nbsp;TLS&nbsp;session,&nbsp;if</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4492911">//&nbsp;available.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4492927"><a href="/gostd/crypto/tls/handshake_client.go.html#4492668">cacheKey</a></span>&nbsp;<span class="op" id="4492936">=</span>&nbsp;<span class="ident" id="4492938"><a href="/gostd/crypto/tls/handshake_client.go.html#4507418">clientSessionCacheKey</a></span><span class="op" id="4492959">(</span><span class="ident" id="4492960"><a href="/gostd/crypto/tls/handshake_client.go.html#4490780">c</a></span><span class="op" id="4492961">.</span><span class="ident" id="4492962"><a href="/gostd/crypto/tls/conn.go.html#4461931">conn</a></span><span class="op" id="4492966">.</span><span class="ident" id="4492967"><a href="/gostd/net/net.go.html#3335122">RemoteAddr</a></span><span class="op" id="4492977">(</span><span class="op" id="4492978">)</span><span class="op" id="4492979">,</span>&nbsp;<span class="ident" id="4492981"><a href="/gostd/crypto/tls/handshake_client.go.html#4490780">c</a></span><span class="op" id="4492982">.</span><span class="ident" id="4492983"><a href="/gostd/crypto/tls/conn.go.html#4462274">config</a></span><span class="op" id="4492989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4492993">candidateSession</span><span class="op" id="4493009">,</span>&nbsp;<span class="ident" id="4493011">ok</span>&nbsp;<span class="op" id="4493014">:=</span>&nbsp;<span class="ident" id="4493017"><a href="/gostd/crypto/tls/handshake_client.go.html#4492685">sessionCache</a></span><span class="op" id="4493029">.</span><span class="ident" id="4493030"><a href="/gostd/crypto/tls/common.go.html#4449041">Get</a></span><span class="op" id="4493033">(</span><span class="ident" id="4493034"><a href="/gostd/crypto/tls/handshake_client.go.html#4492668">cacheKey</a></span><span class="op" id="4493042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4493046">if</span>&nbsp;<span class="ident" id="4493049"><a href="/gostd/crypto/tls/handshake_client.go.html#4493011">ok</a></span>&nbsp;<span class="op" id="4493052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4493057">//&nbsp;Check&nbsp;that&nbsp;the&nbsp;ciphersuite/version&nbsp;used&nbsp;for&nbsp;the</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4493111">//&nbsp;previous&nbsp;session&nbsp;are&nbsp;still&nbsp;valid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4493151">cipherSuiteOk</span>&nbsp;<span class="op" id="4493165">:=</span>&nbsp;<span class="builtintype" id="4493168">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4493177">for</span>&nbsp;<span class="ident" id="4493181">_</span><span class="op" id="4493182">,</span>&nbsp;<span class="ident" id="4493184">id</span>&nbsp;<span class="op" id="4493187">:=</span>&nbsp;<span class="keyword" id="4493190">range</span>&nbsp;<span class="ident" id="4493196"><a href="/gostd/crypto/tls/handshake_client.go.html#4491350">hello</a></span><span class="op" id="4493201">.</span><span class="ident" id="4493202"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508403">cipherSuites</a></span>&nbsp;<span class="op" id="4493215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4493221">if</span>&nbsp;<span class="ident" id="4493224"><a href="/gostd/crypto/tls/handshake_client.go.html#4493184">id</a></span>&nbsp;<span class="op" id="4493227">==</span>&nbsp;<span class="ident" id="4493230"><a href="/gostd/crypto/tls/handshake_client.go.html#4492993">candidateSession</a></span><span class="op" id="4493246">.</span><span class="ident" id="4493247"><a href="/gostd/crypto/tls/common.go.html#4448374">cipherSuite</a></span>&nbsp;<span class="op" id="4493259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4493266"><a href="/gostd/crypto/tls/handshake_client.go.html#4493151">cipherSuiteOk</a></span>&nbsp;<span class="op" id="4493280">=</span>&nbsp;<span class="builtintype" id="4493282">true</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4493292">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4493302">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4493307">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4493313">versOk</span>&nbsp;<span class="op" id="4493320">:=</span>&nbsp;<span class="ident" id="4493323"><a href="/gostd/crypto/tls/handshake_client.go.html#4492993">candidateSession</a></span><span class="op" id="4493339">.</span><span class="ident" id="4493340"><a href="/gostd/crypto/tls/common.go.html#4448288">vers</a></span>&nbsp;<span class="op" id="4493345">&gt;=</span>&nbsp;<span class="ident" id="4493348"><a href="/gostd/crypto/tls/handshake_client.go.html#4490780">c</a></span><span class="op" id="4493349">.</span><span class="ident" id="4493350"><a href="/gostd/crypto/tls/conn.go.html#4462274">config</a></span><span class="op" id="4493356">.</span><span class="ident" id="4493357"><a href="/gostd/crypto/tls/common.go.html#4455417">minVersion</a></span><span class="op" id="4493367">(</span><span class="op" id="4493368">)</span>&nbsp;<span class="op" id="4493370">&amp;&amp;</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4493377"><a href="/gostd/crypto/tls/handshake_client.go.html#4492993">candidateSession</a></span><span class="op" id="4493393">.</span><span class="ident" id="4493394"><a href="/gostd/crypto/tls/common.go.html#4448288">vers</a></span>&nbsp;<span class="op" id="4493399">&lt;=</span>&nbsp;<span class="ident" id="4493402"><a href="/gostd/crypto/tls/handshake_client.go.html#4490780">c</a></span><span class="op" id="4493403">.</span><span class="ident" id="4493404"><a href="/gostd/crypto/tls/conn.go.html#4462274">config</a></span><span class="op" id="4493410">.</span><span class="ident" id="4493411"><a href="/gostd/crypto/tls/common.go.html#4455539">maxVersion</a></span><span class="op" id="4493421">(</span><span class="op" id="4493422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4493427">if</span>&nbsp;<span class="ident" id="4493430"><a href="/gostd/crypto/tls/handshake_client.go.html#4493313">versOk</a></span>&nbsp;<span class="op" id="4493437">&amp;&amp;</span>&nbsp;<span class="ident" id="4493440"><a href="/gostd/crypto/tls/handshake_client.go.html#4493151">cipherSuiteOk</a></span>&nbsp;<span class="op" id="4493454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4493460"><a href="/gostd/crypto/tls/handshake_client.go.html#4492635">session</a></span>&nbsp;<span class="op" id="4493468">=</span>&nbsp;<span class="ident" id="4493470"><a href="/gostd/crypto/tls/handshake_client.go.html#4492993">candidateSession</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4493490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4493494">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4493497">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4493501">if</span>&nbsp;<span class="ident" id="4493504"><a href="/gostd/crypto/tls/handshake_client.go.html#4492635">session</a></span>&nbsp;<span class="op" id="4493512">!=</span>&nbsp;<span class="builtintype" id="4493515">nil</span>&nbsp;<span class="op" id="4493519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4493523"><a href="/gostd/crypto/tls/handshake_client.go.html#4491350">hello</a></span><span class="op" id="4493528">.</span><span class="ident" id="4493529"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508628">sessionTicket</a></span>&nbsp;<span class="op" id="4493543">=</span>&nbsp;<span class="ident" id="4493545"><a href="/gostd/crypto/tls/handshake_client.go.html#4492635">session</a></span><span class="op" id="4493552">.</span><span class="ident" id="4493553"><a href="/gostd/crypto/tls/common.go.html#4448188">sessionTicket</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4493569">//&nbsp;A&nbsp;random&nbsp;session&nbsp;ID&nbsp;is&nbsp;used&nbsp;to&nbsp;detect&nbsp;when&nbsp;the</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4493621">//&nbsp;server&nbsp;accepted&nbsp;the&nbsp;ticket&nbsp;and&nbsp;is&nbsp;resuming&nbsp;a&nbsp;session</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4493679">//&nbsp;(see&nbsp;RFC&nbsp;5077).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4493700"><a href="/gostd/crypto/tls/handshake_client.go.html#4491350">hello</a></span><span class="op" id="4493705">.</span><span class="ident" id="4493706"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508375">sessionId</a></span>&nbsp;<span class="op" id="4493716">=</span>&nbsp;<span class="builtinfunc" id="4493718">make</span><span class="op" id="4493722">(</span><span class="op" id="4493723">[</span><span class="op" id="4493724">]</span><span class="builtintype" id="4493725">byte</span><span class="op" id="4493729">,</span>&nbsp;<span class="num" id="4493731">16</span><span class="op" id="4493733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4493737">if</span>&nbsp;<span class="ident" id="4493740">_</span><span class="op" id="4493741">,</span>&nbsp;<span class="ident" id="4493743">err</span>&nbsp;<span class="op" id="4493747">:=</span>&nbsp;<span class="ident" id="4493750"><a href="/gostd/crypto/tls/handshake_client.go.html#4490521">io</a></span><span class="op" id="4493752">.</span><span class="ident" id="4493753"><a href="/gostd/io/io.go.html#1429706">ReadFull</a></span><span class="op" id="4493761">(</span><span class="ident" id="4493762"><a href="/gostd/crypto/tls/handshake_client.go.html#4490780">c</a></span><span class="op" id="4493763">.</span><span class="ident" id="4493764"><a href="/gostd/crypto/tls/conn.go.html#4462274">config</a></span><span class="op" id="4493770">.</span><span class="ident" id="4493771"><a href="/gostd/crypto/tls/common.go.html#4455096">rand</a></span><span class="op" id="4493775">(</span><span class="op" id="4493776">)</span><span class="op" id="4493777">,</span>&nbsp;<span class="ident" id="4493779"><a href="/gostd/crypto/tls/handshake_client.go.html#4491350">hello</a></span><span class="op" id="4493784">.</span><span class="ident" id="4493785"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508375">sessionId</a></span><span class="op" id="4493794">)</span><span class="op" id="4493795">;</span>&nbsp;<span class="ident" id="4493797"><a href="/gostd/crypto/tls/handshake_client.go.html#4493743">err</a></span>&nbsp;<span class="op" id="4493801">!=</span>&nbsp;<span class="builtintype" id="4493804">nil</span>&nbsp;<span class="op" id="4493808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4493813"><a href="/gostd/crypto/tls/handshake_client.go.html#4490780">c</a></span><span class="op" id="4493814">.</span><span class="ident" id="4493815"><a href="/gostd/crypto/tls/conn.go.html#4480829">sendAlert</a></span><span class="op" id="4493824">(</span><span class="ident" id="4493825"><a href="/gostd/crypto/tls/alert.go.html#4431016">alertInternalError</a></span><span class="op" id="4493843">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4493848">return</span>&nbsp;<span class="ident" id="4493855"><a href="/gostd/crypto/tls/handshake_client.go.html#4490504">errors</a></span><span class="op" id="4493861">.</span><span class="ident" id="4493862"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4493865">(</span><span class="string" id="4493866">&#34;tls:&nbsp;short&nbsp;read&nbsp;from&nbsp;Rand:&nbsp;&#34;</span>&nbsp;<span class="op" id="4493896">+</span>&nbsp;<span class="ident" id="4493898"><a href="/gostd/crypto/tls/handshake_client.go.html#4493743">err</a></span><span class="op" id="4493901">.</span><span class="ident" id="4493902">Error</span><span class="op" id="4493907">(</span><span class="op" id="4493908">)</span><span class="op" id="4493909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4493913">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4493916">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4493920"><a href="/gostd/crypto/tls/handshake_client.go.html#4490780">c</a></span><span class="op" id="4493921">.</span><span class="ident" id="4493922"><a href="/gostd/crypto/tls/conn.go.html#4481088">writeRecord</a></span><span class="op" id="4493933">(</span><span class="ident" id="4493934"><a href="/gostd/crypto/tls/common.go.html#4443022">recordTypeHandshake</a></span><span class="op" id="4493953">,</span>&nbsp;<span class="ident" id="4493955"><a href="/gostd/crypto/tls/handshake_client.go.html#4491350">hello</a></span><span class="op" id="4493960">.</span><span class="ident" id="4493961"><a href="/gostd/crypto/tls/handshake_messages.go.html#4509641">marshal</a></span><span class="op" id="4493968">(</span><span class="op" id="4493969">)</span><span class="op" id="4493970">)</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4493974">msg</span><span class="op" id="4493977">,</span>&nbsp;<span class="ident" id="4493979"><a href="/gostd/crypto/tls/handshake_client.go.html#4492362">err</a></span>&nbsp;<span class="op" id="4493983">:=</span>&nbsp;<span class="ident" id="4493986"><a href="/gostd/crypto/tls/handshake_client.go.html#4490780">c</a></span><span class="op" id="4493987">.</span><span class="ident" id="4493988"><a href="/gostd/crypto/tls/conn.go.html#4483177">readHandshake</a></span><span class="op" id="4494001">(</span><span class="op" id="4494002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4494005">if</span>&nbsp;<span class="ident" id="4494008"><a href="/gostd/crypto/tls/handshake_client.go.html#4492362">err</a></span>&nbsp;<span class="op" id="4494012">!=</span>&nbsp;<span class="builtintype" id="4494015">nil</span>&nbsp;<span class="op" id="4494019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4494023">return</span>&nbsp;<span class="ident" id="4494030"><a href="/gostd/crypto/tls/handshake_client.go.html#4492362">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4494035">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4494038">serverHello</span><span class="op" id="4494049">,</span>&nbsp;<span class="ident" id="4494051">ok</span>&nbsp;<span class="op" id="4494054">:=</span>&nbsp;<span class="ident" id="4494057"><a href="/gostd/crypto/tls/handshake_client.go.html#4493974">msg</a></span><span class="op" id="4494060">.</span><span class="op" id="4494061">(</span><span class="op" id="4494062">*</span><span class="ident" id="4494063"><a href="/gostd/crypto/tls/handshake_messages.go.html#4519382">serverHelloMsg</a></span><span class="op" id="4494077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4494080">if</span>&nbsp;<span class="op" id="4494083">!</span><span class="ident" id="4494084"><a href="/gostd/crypto/tls/handshake_client.go.html#4494051">ok</a></span>&nbsp;<span class="op" id="4494087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4494091"><a href="/gostd/crypto/tls/handshake_client.go.html#4490780">c</a></span><span class="op" id="4494092">.</span><span class="ident" id="4494093"><a href="/gostd/crypto/tls/conn.go.html#4480829">sendAlert</a></span><span class="op" id="4494102">(</span><span class="ident" id="4494103"><a href="/gostd/crypto/tls/alert.go.html#4430296">alertUnexpectedMessage</a></span><span class="op" id="4494125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4494129">return</span>&nbsp;<span class="ident" id="4494136"><a href="/gostd/crypto/tls/common.go.html#4461311">unexpectedMessageError</a></span><span class="op" id="4494158">(</span><span class="ident" id="4494159"><a href="/gostd/crypto/tls/handshake_client.go.html#4494038">serverHello</a></span><span class="op" id="4494170">,</span>&nbsp;<span class="ident" id="4494172"><a href="/gostd/crypto/tls/handshake_client.go.html#4493974">msg</a></span><span class="op" id="4494175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4494178">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4494182">vers</span><span class="op" id="4494186">,</span>&nbsp;<span class="ident" id="4494188"><a href="/gostd/crypto/tls/handshake_client.go.html#4494051">ok</a></span>&nbsp;<span class="op" id="4494191">:=</span>&nbsp;<span class="ident" id="4494194"><a href="/gostd/crypto/tls/handshake_client.go.html#4490780">c</a></span><span class="op" id="4494195">.</span><span class="ident" id="4494196"><a href="/gostd/crypto/tls/conn.go.html#4462274">config</a></span><span class="op" id="4494202">.</span><span class="ident" id="4494203"><a href="/gostd/crypto/tls/common.go.html#4455994">mutualVersion</a></span><span class="op" id="4494216">(</span><span class="ident" id="4494217"><a href="/gostd/crypto/tls/handshake_client.go.html#4494038">serverHello</a></span><span class="op" id="4494228">.</span><span class="ident" id="4494229"><a href="/gostd/crypto/tls/handshake_messages.go.html#4519435">vers</a></span><span class="op" id="4494233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4494236">if</span>&nbsp;<span class="op" id="4494239">!</span><span class="ident" id="4494240"><a href="/gostd/crypto/tls/handshake_client.go.html#4494051">ok</a></span>&nbsp;<span class="op" id="4494243">||</span>&nbsp;<span class="ident" id="4494246"><a href="/gostd/crypto/tls/handshake_client.go.html#4494182">vers</a></span>&nbsp;<span class="op" id="4494251">&lt;</span>&nbsp;<span class="ident" id="4494253"><a href="/gostd/crypto/tls/common.go.html#4442463">VersionTLS10</a></span>&nbsp;<span class="op" id="4494266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4494270">//&nbsp;TLS&nbsp;1.0&nbsp;is&nbsp;the&nbsp;minimum&nbsp;version&nbsp;supported&nbsp;as&nbsp;a&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4494329"><a href="/gostd/crypto/tls/handshake_client.go.html#4490780">c</a></span><span class="op" id="4494330">.</span><span class="ident" id="4494331"><a href="/gostd/crypto/tls/conn.go.html#4480829">sendAlert</a></span><span class="op" id="4494340">(</span><span class="ident" id="4494341"><a href="/gostd/crypto/tls/alert.go.html#4430936">alertProtocolVersion</a></span><span class="op" id="4494361">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4494365">return</span>&nbsp;<span class="ident" id="4494372"><a href="/gostd/crypto/tls/handshake_client.go.html#4490514">fmt</a></span><span class="op" id="4494375">.</span><span class="ident" id="4494376"><a href="/gostd/fmt/print.go.html#2143886">Errorf</a></span><span class="op" id="4494382">(</span><span class="string" id="4494383">&#34;tls:&nbsp;server&nbsp;selected&nbsp;unsupported&nbsp;protocol&nbsp;version&nbsp;%x&#34;</span><span class="op" id="4494437">,</span>&nbsp;<span class="ident" id="4494439"><a href="/gostd/crypto/tls/handshake_client.go.html#4494038">serverHello</a></span><span class="op" id="4494450">.</span><span class="ident" id="4494451"><a href="/gostd/crypto/tls/handshake_messages.go.html#4519435">vers</a></span><span class="op" id="4494455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4494458">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4494461"><a href="/gostd/crypto/tls/handshake_client.go.html#4490780">c</a></span><span class="op" id="4494462">.</span><span class="ident" id="4494463"><a href="/gostd/crypto/tls/conn.go.html#4462168">vers</a></span>&nbsp;<span class="op" id="4494468">=</span>&nbsp;<span class="ident" id="4494470"><a href="/gostd/crypto/tls/handshake_client.go.html#4494182">vers</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4494476"><a href="/gostd/crypto/tls/handshake_client.go.html#4490780">c</a></span><span class="op" id="4494477">.</span><span class="ident" id="4494478"><a href="/gostd/crypto/tls/conn.go.html#4462213">haveVers</a></span>&nbsp;<span class="op" id="4494487">=</span>&nbsp;<span class="builtintype" id="4494489">true</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4494496">suite</span>&nbsp;<span class="op" id="4494502">:=</span>&nbsp;<span class="ident" id="4494505"><a href="/gostd/crypto/tls/cipher_suites.go.html#4440801">mutualCipherSuite</a></span><span class="op" id="4494522">(</span><span class="ident" id="4494523"><a href="/gostd/crypto/tls/handshake_client.go.html#4490780">c</a></span><span class="op" id="4494524">.</span><span class="ident" id="4494525"><a href="/gostd/crypto/tls/conn.go.html#4462274">config</a></span><span class="op" id="4494531">.</span><span class="ident" id="4494532"><a href="/gostd/crypto/tls/common.go.html#4455294">cipherSuites</a></span><span class="op" id="4494544">(</span><span class="op" id="4494545">)</span><span class="op" id="4494546">,</span>&nbsp;<span class="ident" id="4494548"><a href="/gostd/crypto/tls/handshake_client.go.html#4494038">serverHello</a></span><span class="op" id="4494559">.</span><span class="ident" id="4494560"><a href="/gostd/crypto/tls/handshake_messages.go.html#4519519">cipherSuite</a></span><span class="op" id="4494571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4494574">if</span>&nbsp;<span class="ident" id="4494577"><a href="/gostd/crypto/tls/handshake_client.go.html#4494496">suite</a></span>&nbsp;<span class="op" id="4494583">==</span>&nbsp;<span class="builtintype" id="4494586">nil</span>&nbsp;<span class="op" id="4494590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4494594"><a href="/gostd/crypto/tls/handshake_client.go.html#4490780">c</a></span><span class="op" id="4494595">.</span><span class="ident" id="4494596"><a href="/gostd/crypto/tls/conn.go.html#4480829">sendAlert</a></span><span class="op" id="4494605">(</span><span class="ident" id="4494606"><a href="/gostd/crypto/tls/alert.go.html#4430496">alertHandshakeFailure</a></span><span class="op" id="4494627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4494631">return</span>&nbsp;<span class="ident" id="4494638"><a href="/gostd/crypto/tls/handshake_client.go.html#4490514">fmt</a></span><span class="op" id="4494641">.</span><span class="ident" id="4494642"><a href="/gostd/fmt/print.go.html#2143886">Errorf</a></span><span class="op" id="4494648">(</span><span class="string" id="4494649">&#34;tls:&nbsp;server&nbsp;selected&nbsp;an&nbsp;unsupported&nbsp;cipher&nbsp;suite&#34;</span><span class="op" id="4494699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4494702">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4494706">hs</span>&nbsp;<span class="op" id="4494709">:=</span>&nbsp;<span class="op" id="4494712">&amp;</span><span class="ident" id="4494713"><a href="/gostd/crypto/tls/handshake_client.go.html#4490552">clientHandshakeState</a></span><span class="op" id="4494733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4494737"><a href="/gostd/crypto/tls/handshake_client.go.html#4490583">c</a></span><span class="op" id="4494738">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4494751"><a href="/gostd/crypto/tls/handshake_client.go.html#4490780">c</a></span><span class="op" id="4494752">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4494756"><a href="/gostd/crypto/tls/handshake_client.go.html#4490603">serverHello</a></span><span class="op" id="4494767">:</span>&nbsp;&nbsp;<span class="ident" id="4494770"><a href="/gostd/crypto/tls/handshake_client.go.html#4494038">serverHello</a></span><span class="op" id="4494781">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4494785"><a href="/gostd/crypto/tls/handshake_client.go.html#4490633">hello</a></span><span class="op" id="4494790">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4494799"><a href="/gostd/crypto/tls/handshake_client.go.html#4491350">hello</a></span><span class="op" id="4494804">,</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4494808"><a href="/gostd/crypto/tls/handshake_client.go.html#4490663">suite</a></span><span class="op" id="4494813">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4494822"><a href="/gostd/crypto/tls/handshake_client.go.html#4494496">suite</a></span><span class="op" id="4494827">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4494831"><a href="/gostd/crypto/tls/handshake_client.go.html#4490690">finishedHash</a></span><span class="op" id="4494843">:</span>&nbsp;<span class="ident" id="4494845"><a href="/gostd/crypto/tls/prf.go.html#4575432">newFinishedHash</a></span><span class="op" id="4494860">(</span><span class="ident" id="4494861"><a href="/gostd/crypto/tls/handshake_client.go.html#4490780">c</a></span><span class="op" id="4494862">.</span><span class="ident" id="4494863"><a href="/gostd/crypto/tls/conn.go.html#4462168">vers</a></span><span class="op" id="4494867">)</span><span class="op" id="4494868">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4494872"><a href="/gostd/crypto/tls/handshake_client.go.html#4490738">session</a></span><span class="op" id="4494879">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4494886"><a href="/gostd/crypto/tls/handshake_client.go.html#4492635">session</a></span><span class="op" id="4494893">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4494896">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4494900"><a href="/gostd/crypto/tls/handshake_client.go.html#4494706">hs</a></span><span class="op" id="4494902">.</span><span class="ident" id="4494903"><a href="/gostd/crypto/tls/handshake_client.go.html#4490690">finishedHash</a></span><span class="op" id="4494915">.</span><span class="ident" id="4494916"><a href="/gostd/crypto/tls/prf.go.html#4575984">Write</a></span><span class="op" id="4494921">(</span><span class="ident" id="4494922"><a href="/gostd/crypto/tls/handshake_client.go.html#4494706">hs</a></span><span class="op" id="4494924">.</span><span class="ident" id="4494925"><a href="/gostd/crypto/tls/handshake_client.go.html#4490633">hello</a></span><span class="op" id="4494930">.</span><span class="ident" id="4494931"><a href="/gostd/crypto/tls/handshake_messages.go.html#4509641">marshal</a></span><span class="op" id="4494938">(</span><span class="op" id="4494939">)</span><span class="op" id="4494940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4494943"><a href="/gostd/crypto/tls/handshake_client.go.html#4494706">hs</a></span><span class="op" id="4494945">.</span><span class="ident" id="4494946"><a href="/gostd/crypto/tls/handshake_client.go.html#4490690">finishedHash</a></span><span class="op" id="4494958">.</span><span class="ident" id="4494959"><a href="/gostd/crypto/tls/prf.go.html#4575984">Write</a></span><span class="op" id="4494964">(</span><span class="ident" id="4494965"><a href="/gostd/crypto/tls/handshake_client.go.html#4494706">hs</a></span><span class="op" id="4494967">.</span><span class="ident" id="4494968"><a href="/gostd/crypto/tls/handshake_client.go.html#4490603">serverHello</a></span><span class="op" id="4494979">.</span><span class="ident" id="4494980"><a href="/gostd/crypto/tls/handshake_messages.go.html#4520364">marshal</a></span><span class="op" id="4494987">(</span><span class="op" id="4494988">)</span><span class="op" id="4494989">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4494993">isResume</span><span class="op" id="4495001">,</span>&nbsp;<span class="ident" id="4495003"><a href="/gostd/crypto/tls/handshake_client.go.html#4492362">err</a></span>&nbsp;<span class="op" id="4495007">:=</span>&nbsp;<span class="ident" id="4495010"><a href="/gostd/crypto/tls/handshake_client.go.html#4494706">hs</a></span><span class="op" id="4495012">.</span><span class="ident" id="4495013"><a href="/gostd/crypto/tls/handshake_client.go.html#4503918">processServerHello</a></span><span class="op" id="4495031">(</span><span class="op" id="4495032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4495035">if</span>&nbsp;<span class="ident" id="4495038"><a href="/gostd/crypto/tls/handshake_client.go.html#4492362">err</a></span>&nbsp;<span class="op" id="4495042">!=</span>&nbsp;<span class="builtintype" id="4495045">nil</span>&nbsp;<span class="op" id="4495049">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4495053">return</span>&nbsp;<span class="ident" id="4495060"><a href="/gostd/crypto/tls/handshake_client.go.html#4492362">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4495065">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4495069">if</span>&nbsp;<span class="ident" id="4495072"><a href="/gostd/crypto/tls/handshake_client.go.html#4494993">isResume</a></span>&nbsp;<span class="op" id="4495081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4495085">if</span>&nbsp;<span class="ident" id="4495088">err</span>&nbsp;<span class="op" id="4495092">:=</span>&nbsp;<span class="ident" id="4495095"><a href="/gostd/crypto/tls/handshake_client.go.html#4494706">hs</a></span><span class="op" id="4495097">.</span><span class="ident" id="4495098"><a href="/gostd/crypto/tls/handshake_client.go.html#4502717">establishKeys</a></span><span class="op" id="4495111">(</span><span class="op" id="4495112">)</span><span class="op" id="4495113">;</span>&nbsp;<span class="ident" id="4495115"><a href="/gostd/crypto/tls/handshake_client.go.html#4495088">err</a></span>&nbsp;<span class="op" id="4495119">!=</span>&nbsp;<span class="builtintype" id="4495122">nil</span>&nbsp;<span class="op" id="4495126">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4495131">return</span>&nbsp;<span class="ident" id="4495138"><a href="/gostd/crypto/tls/handshake_client.go.html#4495088">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4495144">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4495148">if</span>&nbsp;<span class="ident" id="4495151">err</span>&nbsp;<span class="op" id="4495155">:=</span>&nbsp;<span class="ident" id="4495158"><a href="/gostd/crypto/tls/handshake_client.go.html#4494706">hs</a></span><span class="op" id="4495160">.</span><span class="ident" id="4495161"><a href="/gostd/crypto/tls/handshake_client.go.html#4505925">readSessionTicket</a></span><span class="op" id="4495178">(</span><span class="op" id="4495179">)</span><span class="op" id="4495180">;</span>&nbsp;<span class="ident" id="4495182"><a href="/gostd/crypto/tls/handshake_client.go.html#4495151">err</a></span>&nbsp;<span class="op" id="4495186">!=</span>&nbsp;<span class="builtintype" id="4495189">nil</span>&nbsp;<span class="op" id="4495193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4495198">return</span>&nbsp;<span class="ident" id="4495205"><a href="/gostd/crypto/tls/handshake_client.go.html#4495151">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4495211">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4495215">if</span>&nbsp;<span class="ident" id="4495218">err</span>&nbsp;<span class="op" id="4495222">:=</span>&nbsp;<span class="ident" id="4495225"><a href="/gostd/crypto/tls/handshake_client.go.html#4494706">hs</a></span><span class="op" id="4495227">.</span><span class="ident" id="4495228"><a href="/gostd/crypto/tls/handshake_client.go.html#4505171">readFinished</a></span><span class="op" id="4495240">(</span><span class="ident" id="4495241"><a href="/gostd/crypto/tls/handshake_client.go.html#4490780">c</a></span><span class="op" id="4495242">.</span><span class="ident" id="4495243"><a href="/gostd/crypto/tls/conn.go.html#4462937">firstFinished</a></span><span class="op" id="4495256">[</span><span class="op" id="4495257">:</span><span class="op" id="4495258">]</span><span class="op" id="4495259">)</span><span class="op" id="4495260">;</span>&nbsp;<span class="ident" id="4495262"><a href="/gostd/crypto/tls/handshake_client.go.html#4495218">err</a></span>&nbsp;<span class="op" id="4495266">!=</span>&nbsp;<span class="builtintype" id="4495269">nil</span>&nbsp;<span class="op" id="4495273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4495278">return</span>&nbsp;<span class="ident" id="4495285"><a href="/gostd/crypto/tls/handshake_client.go.html#4495218">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4495291">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4495295">if</span>&nbsp;<span class="ident" id="4495298">err</span>&nbsp;<span class="op" id="4495302">:=</span>&nbsp;<span class="ident" id="4495305"><a href="/gostd/crypto/tls/handshake_client.go.html#4494706">hs</a></span><span class="op" id="4495307">.</span><span class="ident" id="4495308"><a href="/gostd/crypto/tls/handshake_client.go.html#4506572">sendFinished</a></span><span class="op" id="4495320">(</span><span class="builtintype" id="4495321">nil</span><span class="op" id="4495324">)</span><span class="op" id="4495325">;</span>&nbsp;<span class="ident" id="4495327"><a href="/gostd/crypto/tls/handshake_client.go.html#4495298">err</a></span>&nbsp;<span class="op" id="4495331">!=</span>&nbsp;<span class="builtintype" id="4495334">nil</span>&nbsp;<span class="op" id="4495338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4495343">return</span>&nbsp;<span class="ident" id="4495350"><a href="/gostd/crypto/tls/handshake_client.go.html#4495298">err</a></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4495356">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4495359">}</span>&nbsp;<span class="keyword" id="4495361">else</span>&nbsp;<span class="op" id="4495366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4495370">if</span>&nbsp;<span class="ident" id="4495373">err</span>&nbsp;<span class="op" id="4495377">:=</span>&nbsp;<span class="ident" id="4495380"><a href="/gostd/crypto/tls/handshake_client.go.html#4494706">hs</a></span><span class="op" id="4495382">.</span><span class="ident" id="4495383"><a href="/gostd/crypto/tls/handshake_client.go.html#4495954">doFullHandshake</a></span><span class="op" id="4495398">(</span><span class="op" id="4495399">)</span><span class="op" id="4495400">;</span>&nbsp;<span class="ident" id="4495402"><a href="/gostd/crypto/tls/handshake_client.go.html#4495373">err</a></span>&nbsp;<span class="op" id="4495406">!=</span>&nbsp;<span class="builtintype" id="4495409">nil</span>&nbsp;<span class="op" id="4495413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4495418">return</span>&nbsp;<span class="ident" id="4495425"><a href="/gostd/crypto/tls/handshake_client.go.html#4495373">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4495431">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4495435">if</span>&nbsp;<span class="ident" id="4495438">err</span>&nbsp;<span class="op" id="4495442">:=</span>&nbsp;<span class="ident" id="4495445"><a href="/gostd/crypto/tls/handshake_client.go.html#4494706">hs</a></span><span class="op" id="4495447">.</span><span class="ident" id="4495448"><a href="/gostd/crypto/tls/handshake_client.go.html#4502717">establishKeys</a></span><span class="op" id="4495461">(</span><span class="op" id="4495462">)</span><span class="op" id="4495463">;</span>&nbsp;<span class="ident" id="4495465"><a href="/gostd/crypto/tls/handshake_client.go.html#4495438">err</a></span>&nbsp;<span class="op" id="4495469">!=</span>&nbsp;<span class="builtintype" id="4495472">nil</span>&nbsp;<span class="op" id="4495476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4495481">return</span>&nbsp;<span class="ident" id="4495488"><a href="/gostd/crypto/tls/handshake_client.go.html#4495438">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4495494">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4495498">if</span>&nbsp;<span class="ident" id="4495501">err</span>&nbsp;<span class="op" id="4495505">:=</span>&nbsp;<span class="ident" id="4495508"><a href="/gostd/crypto/tls/handshake_client.go.html#4494706">hs</a></span><span class="op" id="4495510">.</span><span class="ident" id="4495511"><a href="/gostd/crypto/tls/handshake_client.go.html#4506572">sendFinished</a></span><span class="op" id="4495523">(</span><span class="ident" id="4495524"><a href="/gostd/crypto/tls/handshake_client.go.html#4490780">c</a></span><span class="op" id="4495525">.</span><span class="ident" id="4495526"><a href="/gostd/crypto/tls/conn.go.html#4462937">firstFinished</a></span><span class="op" id="4495539">[</span><span class="op" id="4495540">:</span><span class="op" id="4495541">]</span><span class="op" id="4495542">)</span><span class="op" id="4495543">;</span>&nbsp;<span class="ident" id="4495545"><a href="/gostd/crypto/tls/handshake_client.go.html#4495501">err</a></span>&nbsp;<span class="op" id="4495549">!=</span>&nbsp;<span class="builtintype" id="4495552">nil</span>&nbsp;<span class="op" id="4495556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4495561">return</span>&nbsp;<span class="ident" id="4495568"><a href="/gostd/crypto/tls/handshake_client.go.html#4495501">err</a></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4495574">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4495578">if</span>&nbsp;<span class="ident" id="4495581">err</span>&nbsp;<span class="op" id="4495585">:=</span>&nbsp;<span class="ident" id="4495588"><a href="/gostd/crypto/tls/handshake_client.go.html#4494706">hs</a></span><span class="op" id="4495590">.</span><span class="ident" id="4495591"><a href="/gostd/crypto/tls/handshake_client.go.html#4505925">readSessionTicket</a></span><span class="op" id="4495608">(</span><span class="op" id="4495609">)</span><span class="op" id="4495610">;</span>&nbsp;<span class="ident" id="4495612"><a href="/gostd/crypto/tls/handshake_client.go.html#4495581">err</a></span>&nbsp;<span class="op" id="4495616">!=</span>&nbsp;<span class="builtintype" id="4495619">nil</span>&nbsp;<span class="op" id="4495623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4495628">return</span>&nbsp;<span class="ident" id="4495635"><a href="/gostd/crypto/tls/handshake_client.go.html#4495581">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4495641">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4495645">if</span>&nbsp;<span class="ident" id="4495648">err</span>&nbsp;<span class="op" id="4495652">:=</span>&nbsp;<span class="ident" id="4495655"><a href="/gostd/crypto/tls/handshake_client.go.html#4494706">hs</a></span><span class="op" id="4495657">.</span><span class="ident" id="4495658"><a href="/gostd/crypto/tls/handshake_client.go.html#4505171">readFinished</a></span><span class="op" id="4495670">(</span><span class="builtintype" id="4495671">nil</span><span class="op" id="4495674">)</span><span class="op" id="4495675">;</span>&nbsp;<span class="ident" id="4495677"><a href="/gostd/crypto/tls/handshake_client.go.html#4495648">err</a></span>&nbsp;<span class="op" id="4495681">!=</span>&nbsp;<span class="builtintype" id="4495684">nil</span>&nbsp;<span class="op" id="4495688">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4495693">return</span>&nbsp;<span class="ident" id="4495700"><a href="/gostd/crypto/tls/handshake_client.go.html#4495648">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4495706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4495709">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4495713">if</span>&nbsp;<span class="ident" id="4495716"><a href="/gostd/crypto/tls/handshake_client.go.html#4492685">sessionCache</a></span>&nbsp;<span class="op" id="4495729">!=</span>&nbsp;<span class="builtintype" id="4495732">nil</span>&nbsp;<span class="op" id="4495736">&amp;&amp;</span>&nbsp;<span class="ident" id="4495739"><a href="/gostd/crypto/tls/handshake_client.go.html#4494706">hs</a></span><span class="op" id="4495741">.</span><span class="ident" id="4495742"><a href="/gostd/crypto/tls/handshake_client.go.html#4490738">session</a></span>&nbsp;<span class="op" id="4495750">!=</span>&nbsp;<span class="builtintype" id="4495753">nil</span>&nbsp;<span class="op" id="4495757">&amp;&amp;</span>&nbsp;<span class="ident" id="4495760"><a href="/gostd/crypto/tls/handshake_client.go.html#4492635">session</a></span>&nbsp;<span class="op" id="4495768">!=</span>&nbsp;<span class="ident" id="4495771"><a href="/gostd/crypto/tls/handshake_client.go.html#4494706">hs</a></span><span class="op" id="4495773">.</span><span class="ident" id="4495774"><a href="/gostd/crypto/tls/handshake_client.go.html#4490738">session</a></span>&nbsp;<span class="op" id="4495782">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4495786"><a href="/gostd/crypto/tls/handshake_client.go.html#4492685">sessionCache</a></span><span class="op" id="4495798">.</span><span class="ident" id="4495799"><a href="/gostd/crypto/tls/common.go.html#4449174">Put</a></span><span class="op" id="4495802">(</span><span class="ident" id="4495803"><a href="/gostd/crypto/tls/handshake_client.go.html#4492668">cacheKey</a></span><span class="op" id="4495811">,</span>&nbsp;<span class="ident" id="4495813"><a href="/gostd/crypto/tls/handshake_client.go.html#4494706">hs</a></span><span class="op" id="4495815">.</span><span class="ident" id="4495816"><a href="/gostd/crypto/tls/handshake_client.go.html#4490738">session</a></span><span class="op" id="4495823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4495826">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4495830"><a href="/gostd/crypto/tls/handshake_client.go.html#4490780">c</a></span><span class="op" id="4495831">.</span><span class="ident" id="4495832"><a href="/gostd/crypto/tls/conn.go.html#4462367">didResume</a></span>&nbsp;<span class="op" id="4495842">=</span>&nbsp;<span class="ident" id="4495844"><a href="/gostd/crypto/tls/handshake_client.go.html#4494993">isResume</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4495854"><a href="/gostd/crypto/tls/handshake_client.go.html#4490780">c</a></span><span class="op" id="4495855">.</span><span class="ident" id="4495856"><a href="/gostd/crypto/tls/conn.go.html#4462343">handshakeComplete</a></span>&nbsp;<span class="op" id="4495874">=</span>&nbsp;<span class="builtintype" id="4495876">true</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4495882"><a href="/gostd/crypto/tls/handshake_client.go.html#4490780">c</a></span><span class="op" id="4495883">.</span><span class="ident" id="4495884"><a href="/gostd/crypto/tls/conn.go.html#4462443">cipherSuite</a></span>&nbsp;<span class="op" id="4495896">=</span>&nbsp;<span class="ident" id="4495898"><a href="/gostd/crypto/tls/handshake_client.go.html#4494496">suite</a></span><span class="op" id="4495903">.</span><span class="ident" id="4495904"><a href="/gostd/crypto/tls/cipher_suites.go.html#4434699">id</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4495908">return</span>&nbsp;<span class="builtintype" id="4495915">nil</span><br>
<span class="lineno"></span><span class="op" id="4495919">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4495922">func</span>&nbsp;<span class="op" id="4495927">(</span><span class="ident" id="4495928">hs</span>&nbsp;<span class="op" id="4495931">*</span><span class="ident" id="4495932"><a href="/gostd/crypto/tls/handshake_client.go.html#4490552">clientHandshakeState</a></span><span class="op" id="4495952">)</span>&nbsp;<span class="ident" id="4495954">doFullHandshake</span><span class="op" id="4495969">(</span><span class="op" id="4495970">)</span>&nbsp;<span class="builtintype" id="4495972">error</span>&nbsp;<span class="op" id="4495978">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4495981">c</span>&nbsp;<span class="op" id="4495983">:=</span>&nbsp;<span class="ident" id="4495986"><a href="/gostd/crypto/tls/handshake_client.go.html#4495928">hs</a></span><span class="op" id="4495988">.</span><span class="ident" id="4495989"><a href="/gostd/crypto/tls/handshake_client.go.html#4490583">c</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4495993">msg</span><span class="op" id="4495996">,</span>&nbsp;<span class="ident" id="4495998">err</span>&nbsp;<span class="op" id="4496002">:=</span>&nbsp;<span class="ident" id="4496005"><a href="/gostd/crypto/tls/handshake_client.go.html#4495981">c</a></span><span class="op" id="4496006">.</span><span class="ident" id="4496007"><a href="/gostd/crypto/tls/conn.go.html#4483177">readHandshake</a></span><span class="op" id="4496020">(</span><span class="op" id="4496021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4496024">if</span>&nbsp;<span class="ident" id="4496027"><a href="/gostd/crypto/tls/handshake_client.go.html#4495998">err</a></span>&nbsp;<span class="op" id="4496031">!=</span>&nbsp;<span class="builtintype" id="4496034">nil</span>&nbsp;<span class="op" id="4496038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4496042">return</span>&nbsp;<span class="ident" id="4496049"><a href="/gostd/crypto/tls/handshake_client.go.html#4495998">err</a></span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4496054">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4496057">certMsg</span><span class="op" id="4496064">,</span>&nbsp;<span class="ident" id="4496066">ok</span>&nbsp;<span class="op" id="4496069">:=</span>&nbsp;<span class="ident" id="4496072"><a href="/gostd/crypto/tls/handshake_client.go.html#4495993">msg</a></span><span class="op" id="4496075">.</span><span class="op" id="4496076">(</span><span class="op" id="4496077">*</span><span class="ident" id="4496078"><a href="/gostd/crypto/tls/handshake_messages.go.html#4524760">certificateMsg</a></span><span class="op" id="4496092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4496095">if</span>&nbsp;<span class="op" id="4496098">!</span><span class="ident" id="4496099"><a href="/gostd/crypto/tls/handshake_client.go.html#4496066">ok</a></span>&nbsp;<span class="op" id="4496102">||</span>&nbsp;<span class="builtinfunc" id="4496105">len</span><span class="op" id="4496108">(</span><span class="ident" id="4496109"><a href="/gostd/crypto/tls/handshake_client.go.html#4496057">certMsg</a></span><span class="op" id="4496116">.</span><span class="ident" id="4496117"><a href="/gostd/crypto/tls/handshake_messages.go.html#4524806">certificates</a></span><span class="op" id="4496129">)</span>&nbsp;<span class="op" id="4496131">==</span>&nbsp;<span class="num" id="4496134">0</span>&nbsp;<span class="op" id="4496136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4496140"><a href="/gostd/crypto/tls/handshake_client.go.html#4495981">c</a></span><span class="op" id="4496141">.</span><span class="ident" id="4496142"><a href="/gostd/crypto/tls/conn.go.html#4480829">sendAlert</a></span><span class="op" id="4496151">(</span><span class="ident" id="4496152"><a href="/gostd/crypto/tls/alert.go.html#4430296">alertUnexpectedMessage</a></span><span class="op" id="4496174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4496178">return</span>&nbsp;<span class="ident" id="4496185"><a href="/gostd/crypto/tls/common.go.html#4461311">unexpectedMessageError</a></span><span class="op" id="4496207">(</span><span class="ident" id="4496208"><a href="/gostd/crypto/tls/handshake_client.go.html#4496057">certMsg</a></span><span class="op" id="4496215">,</span>&nbsp;<span class="ident" id="4496217"><a href="/gostd/crypto/tls/handshake_client.go.html#4495993">msg</a></span><span class="op" id="4496220">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4496223">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4496226"><a href="/gostd/crypto/tls/handshake_client.go.html#4495928">hs</a></span><span class="op" id="4496228">.</span><span class="ident" id="4496229"><a href="/gostd/crypto/tls/handshake_client.go.html#4490690">finishedHash</a></span><span class="op" id="4496241">.</span><span class="ident" id="4496242"><a href="/gostd/crypto/tls/prf.go.html#4575984">Write</a></span><span class="op" id="4496247">(</span><span class="ident" id="4496248"><a href="/gostd/crypto/tls/handshake_client.go.html#4496057">certMsg</a></span><span class="op" id="4496255">.</span><span class="ident" id="4496256"><a href="/gostd/crypto/tls/handshake_messages.go.html#4525058">marshal</a></span><span class="op" id="4496263">(</span><span class="op" id="4496264">)</span><span class="op" id="4496265">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4496269">certs</span>&nbsp;<span class="op" id="4496275">:=</span>&nbsp;<span class="builtinfunc" id="4496278">make</span><span class="op" id="4496282">(</span><span class="op" id="4496283">[</span><span class="op" id="4496284">]</span><span class="op" id="4496285">*</span><span class="ident" id="4496286"><a href="/gostd/crypto/tls/handshake_client.go.html#4490489">x509</a></span><span class="op" id="4496290">.</span><span class="ident" id="4496291"><a href="/gostd/crypto/x509/x509.go.html#4659766">Certificate</a></span><span class="op" id="4496302">,</span>&nbsp;<span class="builtinfunc" id="4496304">len</span><span class="op" id="4496307">(</span><span class="ident" id="4496308"><a href="/gostd/crypto/tls/handshake_client.go.html#4496057">certMsg</a></span><span class="op" id="4496315">.</span><span class="ident" id="4496316"><a href="/gostd/crypto/tls/handshake_messages.go.html#4524806">certificates</a></span><span class="op" id="4496328">)</span><span class="op" id="4496329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4496332">for</span>&nbsp;<span class="ident" id="4496336">i</span><span class="op" id="4496337">,</span>&nbsp;<span class="ident" id="4496339">asn1Data</span>&nbsp;<span class="op" id="4496348">:=</span>&nbsp;<span class="keyword" id="4496351">range</span>&nbsp;<span class="ident" id="4496357"><a href="/gostd/crypto/tls/handshake_client.go.html#4496057">certMsg</a></span><span class="op" id="4496364">.</span><span class="ident" id="4496365"><a href="/gostd/crypto/tls/handshake_messages.go.html#4524806">certificates</a></span>&nbsp;<span class="op" id="4496378">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4496382">cert</span><span class="op" id="4496386">,</span>&nbsp;<span class="ident" id="4496388">err</span>&nbsp;<span class="op" id="4496392">:=</span>&nbsp;<span class="ident" id="4496395"><a href="/gostd/crypto/tls/handshake_client.go.html#4490489">x509</a></span><span class="op" id="4496399">.</span><span class="ident" id="4496400"><a href="/gostd/crypto/x509/x509.go.html#4679509">ParseCertificate</a></span><span class="op" id="4496416">(</span><span class="ident" id="4496417"><a href="/gostd/crypto/tls/handshake_client.go.html#4496339">asn1Data</a></span><span class="op" id="4496425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4496429">if</span>&nbsp;<span class="ident" id="4496432"><a href="/gostd/crypto/tls/handshake_client.go.html#4496388">err</a></span>&nbsp;<span class="op" id="4496436">!=</span>&nbsp;<span class="builtintype" id="4496439">nil</span>&nbsp;<span class="op" id="4496443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4496448"><a href="/gostd/crypto/tls/handshake_client.go.html#4495981">c</a></span><span class="op" id="4496449">.</span><span class="ident" id="4496450"><a href="/gostd/crypto/tls/conn.go.html#4480829">sendAlert</a></span><span class="op" id="4496459">(</span><span class="ident" id="4496460"><a href="/gostd/crypto/tls/alert.go.html#4430536">alertBadCertificate</a></span><span class="op" id="4496479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4496484">return</span>&nbsp;<span class="ident" id="4496491"><a href="/gostd/crypto/tls/handshake_client.go.html#4490504">errors</a></span><span class="op" id="4496497">.</span><span class="ident" id="4496498"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4496501">(</span><span class="string" id="4496502">&#34;tls:&nbsp;failed&nbsp;to&nbsp;parse&nbsp;certificate&nbsp;from&nbsp;server:&nbsp;&#34;</span>&nbsp;<span class="op" id="4496551">+</span>&nbsp;<span class="ident" id="4496553"><a href="/gostd/crypto/tls/handshake_client.go.html#4496388">err</a></span><span class="op" id="4496556">.</span><span class="ident" id="4496557">Error</span><span class="op" id="4496562">(</span><span class="op" id="4496563">)</span><span class="op" id="4496564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4496568">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4496572"><a href="/gostd/crypto/tls/handshake_client.go.html#4496269">certs</a></span><span class="op" id="4496577">[</span><span class="ident" id="4496578"><a href="/gostd/crypto/tls/handshake_client.go.html#4496336">i</a></span><span class="op" id="4496579">]</span>&nbsp;<span class="op" id="4496581">=</span>&nbsp;<span class="ident" id="4496583"><a href="/gostd/crypto/tls/handshake_client.go.html#4496382">cert</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4496589">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4496593">if</span>&nbsp;<span class="op" id="4496596">!</span><span class="ident" id="4496597"><a href="/gostd/crypto/tls/handshake_client.go.html#4495981">c</a></span><span class="op" id="4496598">.</span><span class="ident" id="4496599"><a href="/gostd/crypto/tls/conn.go.html#4462274">config</a></span><span class="op" id="4496605">.</span><span class="ident" id="4496606"><a href="/gostd/crypto/tls/common.go.html#4452970">InsecureSkipVerify</a></span>&nbsp;<span class="op" id="4496625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4496629">opts</span>&nbsp;<span class="op" id="4496634">:=</span>&nbsp;<span class="ident" id="4496637"><a href="/gostd/crypto/tls/handshake_client.go.html#4490489">x509</a></span><span class="op" id="4496641">.</span><span class="ident" id="4496642"><a href="/gostd/crypto/x509/verify.go.html#4635470">VerifyOptions</a></span><span class="op" id="4496655">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4496660"><a href="/gostd/crypto/x509/verify.go.html#4635541">Roots</a></span><span class="op" id="4496665">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4496675"><a href="/gostd/crypto/tls/handshake_client.go.html#4495981">c</a></span><span class="op" id="4496676">.</span><span class="ident" id="4496677"><a href="/gostd/crypto/tls/conn.go.html#4462274">config</a></span><span class="op" id="4496683">.</span><span class="ident" id="4496684"><a href="/gostd/crypto/tls/common.go.html#4451971">RootCAs</a></span><span class="op" id="4496691">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4496696"><a href="/gostd/crypto/x509/verify.go.html#4635603">CurrentTime</a></span><span class="op" id="4496707">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4496711"><a href="/gostd/crypto/tls/handshake_client.go.html#4495981">c</a></span><span class="op" id="4496712">.</span><span class="ident" id="4496713"><a href="/gostd/crypto/tls/conn.go.html#4462274">config</a></span><span class="op" id="4496719">.</span><span class="ident" id="4496720"><a href="/gostd/crypto/tls/common.go.html#4455197">time</a></span><span class="op" id="4496724">(</span><span class="op" id="4496725">)</span><span class="op" id="4496726">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4496731"><a href="/gostd/crypto/x509/verify.go.html#4635494">DNSName</a></span><span class="op" id="4496738">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4496746"><a href="/gostd/crypto/tls/handshake_client.go.html#4495981">c</a></span><span class="op" id="4496747">.</span><span class="ident" id="4496748"><a href="/gostd/crypto/tls/conn.go.html#4462274">config</a></span><span class="op" id="4496754">.</span><span class="ident" id="4496755"><a href="/gostd/crypto/tls/common.go.html#4452279">ServerName</a></span><span class="op" id="4496765">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4496770"><a href="/gostd/crypto/x509/verify.go.html#4635516">Intermediates</a></span><span class="op" id="4496783">:</span>&nbsp;<span class="ident" id="4496785"><a href="/gostd/crypto/tls/handshake_client.go.html#4490489">x509</a></span><span class="op" id="4496789">.</span><span class="ident" id="4496790"><a href="/gostd/crypto/x509/cert_pool.go.html#4613595">NewCertPool</a></span><span class="op" id="4496801">(</span><span class="op" id="4496802">)</span><span class="op" id="4496803">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4496807">}</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4496812">for</span>&nbsp;<span class="ident" id="4496816">i</span><span class="op" id="4496817">,</span>&nbsp;<span class="ident" id="4496819">cert</span>&nbsp;<span class="op" id="4496824">:=</span>&nbsp;<span class="keyword" id="4496827">range</span>&nbsp;<span class="ident" id="4496833"><a href="/gostd/crypto/tls/handshake_client.go.html#4496269">certs</a></span>&nbsp;<span class="op" id="4496839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4496844">if</span>&nbsp;<span class="ident" id="4496847"><a href="/gostd/crypto/tls/handshake_client.go.html#4496816">i</a></span>&nbsp;<span class="op" id="4496849">==</span>&nbsp;<span class="num" id="4496852">0</span>&nbsp;<span class="op" id="4496854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4496860">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4496872">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4496877"><a href="/gostd/crypto/tls/handshake_client.go.html#4496629">opts</a></span><span class="op" id="4496881">.</span><span class="ident" id="4496882"><a href="/gostd/crypto/x509/verify.go.html#4635516">Intermediates</a></span><span class="op" id="4496895">.</span><span class="ident" id="4496896"><a href="/gostd/crypto/x509/cert_pool.go.html#4614529">AddCert</a></span><span class="op" id="4496903">(</span><span class="ident" id="4496904"><a href="/gostd/crypto/tls/handshake_client.go.html#4496819">cert</a></span><span class="op" id="4496908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4496912">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4496916"><a href="/gostd/crypto/tls/handshake_client.go.html#4495981">c</a></span><span class="op" id="4496917">.</span><span class="ident" id="4496918"><a href="/gostd/crypto/tls/conn.go.html#4462677">verifiedChains</a></span><span class="op" id="4496932">,</span>&nbsp;<span class="ident" id="4496934"><a href="/gostd/crypto/tls/handshake_client.go.html#4495998">err</a></span>&nbsp;<span class="op" id="4496938">=</span>&nbsp;<span class="ident" id="4496940"><a href="/gostd/crypto/tls/handshake_client.go.html#4496269">certs</a></span><span class="op" id="4496945">[</span><span class="num" id="4496946">0</span><span class="op" id="4496947">]</span><span class="op" id="4496948">.</span><span class="ident" id="4496949"><a href="/gostd/crypto/x509/verify.go.html#4638730">Verify</a></span><span class="op" id="4496955">(</span><span class="ident" id="4496956"><a href="/gostd/crypto/tls/handshake_client.go.html#4496629">opts</a></span><span class="op" id="4496960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4496964">if</span>&nbsp;<span class="ident" id="4496967"><a href="/gostd/crypto/tls/handshake_client.go.html#4495998">err</a></span>&nbsp;<span class="op" id="4496971">!=</span>&nbsp;<span class="builtintype" id="4496974">nil</span>&nbsp;<span class="op" id="4496978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4496983"><a href="/gostd/crypto/tls/handshake_client.go.html#4495981">c</a></span><span class="op" id="4496984">.</span><span class="ident" id="4496985"><a href="/gostd/crypto/tls/conn.go.html#4480829">sendAlert</a></span><span class="op" id="4496994">(</span><span class="ident" id="4496995"><a href="/gostd/crypto/tls/alert.go.html#4430536">alertBadCertificate</a></span><span class="op" id="4497014">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4497019">return</span>&nbsp;<span class="ident" id="4497026"><a href="/gostd/crypto/tls/handshake_client.go.html#4495998">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4497032">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4497035">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4497039">switch</span>&nbsp;<span class="ident" id="4497046"><a href="/gostd/crypto/tls/handshake_client.go.html#4496269">certs</a></span><span class="op" id="4497051">[</span><span class="num" id="4497052">0</span><span class="op" id="4497053">]</span><span class="op" id="4497054">.</span><span class="ident" id="4497055"><a href="/gostd/crypto/x509/x509.go.html#4660263">PublicKey</a></span><span class="op" id="4497064">.</span><span class="op" id="4497065">(</span><span class="keyword" id="4497066">type</span><span class="op" id="4497070">)</span>&nbsp;<span class="op" id="4497072">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4497075">case</span>&nbsp;<span class="op" id="4497080">*</span><span class="ident" id="4497081"><a href="/gostd/crypto/tls/handshake_client.go.html#4490458">rsa</a></span><span class="op" id="4497084">.</span><span class="ident" id="4497085"><a href="/gostd/crypto/rsa/rsa.go.html#4742943">PublicKey</a></span><span class="op" id="4497094">,</span>&nbsp;<span class="op" id="4497096">*</span><span class="ident" id="4497097"><a href="/gostd/crypto/tls/handshake_client.go.html#4490442">ecdsa</a></span><span class="op" id="4497102">.</span><span class="ident" id="4497103"><a href="/gostd/crypto/ecdsa/ecdsa.go.html#3005409">PublicKey</a></span><span class="op" id="4497112">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4497116">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4497123">default</span><span class="op" id="4497130">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4497134"><a href="/gostd/crypto/tls/handshake_client.go.html#4495981">c</a></span><span class="op" id="4497135">.</span><span class="ident" id="4497136"><a href="/gostd/crypto/tls/conn.go.html#4480829">sendAlert</a></span><span class="op" id="4497145">(</span><span class="ident" id="4497146"><a href="/gostd/crypto/tls/alert.go.html#4430576">alertUnsupportedCertificate</a></span><span class="op" id="4497173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4497177">return</span>&nbsp;<span class="ident" id="4497184"><a href="/gostd/crypto/tls/handshake_client.go.html#4490514">fmt</a></span><span class="op" id="4497187">.</span><span class="ident" id="4497188"><a href="/gostd/fmt/print.go.html#2143886">Errorf</a></span><span class="op" id="4497194">(</span><span class="string" id="4497195">&#34;tls:&nbsp;server&#39;s&nbsp;certificate&nbsp;contains&nbsp;an&nbsp;unsupported&nbsp;type&nbsp;of&nbsp;public&nbsp;key:&nbsp;%T&#34;</span><span class="op" id="4497269">,</span>&nbsp;<span class="ident" id="4497271"><a href="/gostd/crypto/tls/handshake_client.go.html#4496269">certs</a></span><span class="op" id="4497276">[</span><span class="num" id="4497277">0</span><span class="op" id="4497278">]</span><span class="op" id="4497279">.</span><span class="ident" id="4497280"><a href="/gostd/crypto/x509/x509.go.html#4660263">PublicKey</a></span><span class="op" id="4497289">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4497292">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4497296"><a href="/gostd/crypto/tls/handshake_client.go.html#4495981">c</a></span><span class="op" id="4497297">.</span><span class="ident" id="4497298"><a href="/gostd/crypto/tls/conn.go.html#4462520">peerCertificates</a></span>&nbsp;<span class="op" id="4497315">=</span>&nbsp;<span class="ident" id="4497317"><a href="/gostd/crypto/tls/handshake_client.go.html#4496269">certs</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4497325">if</span>&nbsp;<span class="ident" id="4497328"><a href="/gostd/crypto/tls/handshake_client.go.html#4495928">hs</a></span><span class="op" id="4497330">.</span><span class="ident" id="4497331"><a href="/gostd/crypto/tls/handshake_client.go.html#4490603">serverHello</a></span><span class="op" id="4497342">.</span><span class="ident" id="4497343"><a href="/gostd/crypto/tls/handshake_messages.go.html#4519630">ocspStapling</a></span>&nbsp;<span class="op" id="4497356">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4497360"><a href="/gostd/crypto/tls/handshake_client.go.html#4495993">msg</a></span><span class="op" id="4497363">,</span>&nbsp;<span class="ident" id="4497365"><a href="/gostd/crypto/tls/handshake_client.go.html#4495998">err</a></span>&nbsp;<span class="op" id="4497369">=</span>&nbsp;<span class="ident" id="4497371"><a href="/gostd/crypto/tls/handshake_client.go.html#4495981">c</a></span><span class="op" id="4497372">.</span><span class="ident" id="4497373"><a href="/gostd/crypto/tls/conn.go.html#4483177">readHandshake</a></span><span class="op" id="4497386">(</span><span class="op" id="4497387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4497391">if</span>&nbsp;<span class="ident" id="4497394"><a href="/gostd/crypto/tls/handshake_client.go.html#4495998">err</a></span>&nbsp;<span class="op" id="4497398">!=</span>&nbsp;<span class="builtintype" id="4497401">nil</span>&nbsp;<span class="op" id="4497405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4497410">return</span>&nbsp;<span class="ident" id="4497417"><a href="/gostd/crypto/tls/handshake_client.go.html#4495998">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4497423">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4497427">cs</span><span class="op" id="4497429">,</span>&nbsp;<span class="ident" id="4497431">ok</span>&nbsp;<span class="op" id="4497434">:=</span>&nbsp;<span class="ident" id="4497437"><a href="/gostd/crypto/tls/handshake_client.go.html#4495993">msg</a></span><span class="op" id="4497440">.</span><span class="op" id="4497441">(</span><span class="op" id="4497442">*</span><span class="ident" id="4497443"><a href="/gostd/crypto/tls/handshake_messages.go.html#4527157">certificateStatusMsg</a></span><span class="op" id="4497463">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4497467">if</span>&nbsp;<span class="op" id="4497470">!</span><span class="ident" id="4497471"><a href="/gostd/crypto/tls/handshake_client.go.html#4497431">ok</a></span>&nbsp;<span class="op" id="4497474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4497479"><a href="/gostd/crypto/tls/handshake_client.go.html#4495981">c</a></span><span class="op" id="4497480">.</span><span class="ident" id="4497481"><a href="/gostd/crypto/tls/conn.go.html#4480829">sendAlert</a></span><span class="op" id="4497490">(</span><span class="ident" id="4497491"><a href="/gostd/crypto/tls/alert.go.html#4430296">alertUnexpectedMessage</a></span><span class="op" id="4497513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4497518">return</span>&nbsp;<span class="ident" id="4497525"><a href="/gostd/crypto/tls/common.go.html#4461311">unexpectedMessageError</a></span><span class="op" id="4497547">(</span><span class="ident" id="4497548"><a href="/gostd/crypto/tls/handshake_client.go.html#4497427">cs</a></span><span class="op" id="4497550">,</span>&nbsp;<span class="ident" id="4497552"><a href="/gostd/crypto/tls/handshake_client.go.html#4495993">msg</a></span><span class="op" id="4497555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4497559">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4497563"><a href="/gostd/crypto/tls/handshake_client.go.html#4495928">hs</a></span><span class="op" id="4497565">.</span><span class="ident" id="4497566"><a href="/gostd/crypto/tls/handshake_client.go.html#4490690">finishedHash</a></span><span class="op" id="4497578">.</span><span class="ident" id="4497579"><a href="/gostd/crypto/tls/prf.go.html#4575984">Write</a></span><span class="op" id="4497584">(</span><span class="ident" id="4497585"><a href="/gostd/crypto/tls/handshake_client.go.html#4497427">cs</a></span><span class="op" id="4497587">.</span><span class="ident" id="4497588"><a href="/gostd/crypto/tls/handshake_messages.go.html#4527517">marshal</a></span><span class="op" id="4497595">(</span><span class="op" id="4497596">)</span><span class="op" id="4497597">)</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4497602">if</span>&nbsp;<span class="ident" id="4497605"><a href="/gostd/crypto/tls/handshake_client.go.html#4497427">cs</a></span><span class="op" id="4497607">.</span><span class="ident" id="4497608"><a href="/gostd/crypto/tls/handshake_messages.go.html#4527207">statusType</a></span>&nbsp;<span class="op" id="4497619">==</span>&nbsp;<span class="ident" id="4497622"><a href="/gostd/crypto/tls/common.go.html#4444657">statusTypeOCSP</a></span>&nbsp;<span class="op" id="4497637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4497642"><a href="/gostd/crypto/tls/handshake_client.go.html#4495981">c</a></span><span class="op" id="4497643">.</span><span class="ident" id="4497644"><a href="/gostd/crypto/tls/conn.go.html#4462469">ocspResponse</a></span>&nbsp;<span class="op" id="4497657">=</span>&nbsp;<span class="ident" id="4497659"><a href="/gostd/crypto/tls/handshake_client.go.html#4497427">cs</a></span><span class="op" id="4497661">.</span><span class="ident" id="4497662"><a href="/gostd/crypto/tls/handshake_messages.go.html#4527225">response</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4497673">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4497676">}</span><br>
<span class="lineno">295</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4497680"><a href="/gostd/crypto/tls/handshake_client.go.html#4495993">msg</a></span><span class="op" id="4497683">,</span>&nbsp;<span class="ident" id="4497685"><a href="/gostd/crypto/tls/handshake_client.go.html#4495998">err</a></span>&nbsp;<span class="op" id="4497689">=</span>&nbsp;<span class="ident" id="4497691"><a href="/gostd/crypto/tls/handshake_client.go.html#4495981">c</a></span><span class="op" id="4497692">.</span><span class="ident" id="4497693"><a href="/gostd/crypto/tls/conn.go.html#4483177">readHandshake</a></span><span class="op" id="4497706">(</span><span class="op" id="4497707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4497710">if</span>&nbsp;<span class="ident" id="4497713"><a href="/gostd/crypto/tls/handshake_client.go.html#4495998">err</a></span>&nbsp;<span class="op" id="4497717">!=</span>&nbsp;<span class="builtintype" id="4497720">nil</span>&nbsp;<span class="op" id="4497724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4497728">return</span>&nbsp;<span class="ident" id="4497735"><a href="/gostd/crypto/tls/handshake_client.go.html#4495998">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4497740">}</span><br>
<span class="lineno">300</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4497744">keyAgreement</span>&nbsp;<span class="op" id="4497757">:=</span>&nbsp;<span class="ident" id="4497760"><a href="/gostd/crypto/tls/handshake_client.go.html#4495928">hs</a></span><span class="op" id="4497762">.</span><span class="ident" id="4497763"><a href="/gostd/crypto/tls/handshake_client.go.html#4490663">suite</a></span><span class="op" id="4497768">.</span><span class="ident" id="4497769"><a href="/gostd/crypto/tls/cipher_suites.go.html#4434820">ka</a></span><span class="op" id="4497771">(</span><span class="ident" id="4497772"><a href="/gostd/crypto/tls/handshake_client.go.html#4495981">c</a></span><span class="op" id="4497773">.</span><span class="ident" id="4497774"><a href="/gostd/crypto/tls/conn.go.html#4462168">vers</a></span><span class="op" id="4497778">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4497782">skx</span><span class="op" id="4497785">,</span>&nbsp;<span class="ident" id="4497787"><a href="/gostd/crypto/tls/handshake_client.go.html#4496066">ok</a></span>&nbsp;<span class="op" id="4497790">:=</span>&nbsp;<span class="ident" id="4497793"><a href="/gostd/crypto/tls/handshake_client.go.html#4495993">msg</a></span><span class="op" id="4497796">.</span><span class="op" id="4497797">(</span><span class="op" id="4497798">*</span><span class="ident" id="4497799"><a href="/gostd/crypto/tls/handshake_messages.go.html#4526463">serverKeyExchangeMsg</a></span><span class="op" id="4497819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4497822">if</span>&nbsp;<span class="ident" id="4497825"><a href="/gostd/crypto/tls/handshake_client.go.html#4496066">ok</a></span>&nbsp;<span class="op" id="4497828">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4497832"><a href="/gostd/crypto/tls/handshake_client.go.html#4495928">hs</a></span><span class="op" id="4497834">.</span><span class="ident" id="4497835"><a href="/gostd/crypto/tls/handshake_client.go.html#4490690">finishedHash</a></span><span class="op" id="4497847">.</span><span class="ident" id="4497848"><a href="/gostd/crypto/tls/prf.go.html#4575984">Write</a></span><span class="op" id="4497853">(</span><span class="ident" id="4497854"><a href="/gostd/crypto/tls/handshake_client.go.html#4497782">skx</a></span><span class="op" id="4497857">.</span><span class="ident" id="4497858"><a href="/gostd/crypto/tls/handshake_messages.go.html#4526746">marshal</a></span><span class="op" id="4497865">(</span><span class="op" id="4497866">)</span><span class="op" id="4497867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4497871"><a href="/gostd/crypto/tls/handshake_client.go.html#4495998">err</a></span>&nbsp;<span class="op" id="4497875">=</span>&nbsp;<span class="ident" id="4497877"><a href="/gostd/crypto/tls/handshake_client.go.html#4497744">keyAgreement</a></span><span class="op" id="4497889">.</span><span class="ident" id="4497890"><a href="/gostd/crypto/tls/cipher_suites.go.html#4433672">processServerKeyExchange</a></span><span class="op" id="4497914">(</span><span class="ident" id="4497915"><a href="/gostd/crypto/tls/handshake_client.go.html#4495981">c</a></span><span class="op" id="4497916">.</span><span class="ident" id="4497917"><a href="/gostd/crypto/tls/conn.go.html#4462274">config</a></span><span class="op" id="4497923">,</span>&nbsp;<span class="ident" id="4497925"><a href="/gostd/crypto/tls/handshake_client.go.html#4495928">hs</a></span><span class="op" id="4497927">.</span><span class="ident" id="4497928"><a href="/gostd/crypto/tls/handshake_client.go.html#4490633">hello</a></span><span class="op" id="4497933">,</span>&nbsp;<span class="ident" id="4497935"><a href="/gostd/crypto/tls/handshake_client.go.html#4495928">hs</a></span><span class="op" id="4497937">.</span><span class="ident" id="4497938"><a href="/gostd/crypto/tls/handshake_client.go.html#4490603">serverHello</a></span><span class="op" id="4497949">,</span>&nbsp;<span class="ident" id="4497951"><a href="/gostd/crypto/tls/handshake_client.go.html#4496269">certs</a></span><span class="op" id="4497956">[</span><span class="num" id="4497957">0</span><span class="op" id="4497958">]</span><span class="op" id="4497959">,</span>&nbsp;<span class="ident" id="4497961"><a href="/gostd/crypto/tls/handshake_client.go.html#4497782">skx</a></span><span class="op" id="4497964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4497968">if</span>&nbsp;<span class="ident" id="4497971"><a href="/gostd/crypto/tls/handshake_client.go.html#4495998">err</a></span>&nbsp;<span class="op" id="4497975">!=</span>&nbsp;<span class="builtintype" id="4497978">nil</span>&nbsp;<span class="op" id="4497982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4497987"><a href="/gostd/crypto/tls/handshake_client.go.html#4495981">c</a></span><span class="op" id="4497988">.</span><span class="ident" id="4497989"><a href="/gostd/crypto/tls/conn.go.html#4480829">sendAlert</a></span><span class="op" id="4497998">(</span><span class="ident" id="4497999"><a href="/gostd/crypto/tls/alert.go.html#4430296">alertUnexpectedMessage</a></span><span class="op" id="4498021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4498026">return</span>&nbsp;<span class="ident" id="4498033"><a href="/gostd/crypto/tls/handshake_client.go.html#4495998">err</a></span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4498039">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4498044"><a href="/gostd/crypto/tls/handshake_client.go.html#4495993">msg</a></span><span class="op" id="4498047">,</span>&nbsp;<span class="ident" id="4498049"><a href="/gostd/crypto/tls/handshake_client.go.html#4495998">err</a></span>&nbsp;<span class="op" id="4498053">=</span>&nbsp;<span class="ident" id="4498055"><a href="/gostd/crypto/tls/handshake_client.go.html#4495981">c</a></span><span class="op" id="4498056">.</span><span class="ident" id="4498057"><a href="/gostd/crypto/tls/conn.go.html#4483177">readHandshake</a></span><span class="op" id="4498070">(</span><span class="op" id="4498071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4498075">if</span>&nbsp;<span class="ident" id="4498078"><a href="/gostd/crypto/tls/handshake_client.go.html#4495998">err</a></span>&nbsp;<span class="op" id="4498082">!=</span>&nbsp;<span class="builtintype" id="4498085">nil</span>&nbsp;<span class="op" id="4498089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4498094">return</span>&nbsp;<span class="ident" id="4498101"><a href="/gostd/crypto/tls/handshake_client.go.html#4495998">err</a></span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4498107">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4498110">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4498114">var</span>&nbsp;<span class="ident" id="4498118">chainToSend</span>&nbsp;<span class="op" id="4498130">*</span><span class="ident" id="4498131"><a href="/gostd/crypto/tls/common.go.html#4457987">Certificate</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4498144">var</span>&nbsp;<span class="ident" id="4498148">certRequested</span>&nbsp;<span class="builtintype" id="4498162">bool</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4498168">certReq</span><span class="op" id="4498175">,</span>&nbsp;<span class="ident" id="4498177"><a href="/gostd/crypto/tls/handshake_client.go.html#4496066">ok</a></span>&nbsp;<span class="op" id="4498180">:=</span>&nbsp;<span class="ident" id="4498183"><a href="/gostd/crypto/tls/handshake_client.go.html#4495993">msg</a></span><span class="op" id="4498186">.</span><span class="op" id="4498187">(</span><span class="op" id="4498188">*</span><span class="ident" id="4498189"><a href="/gostd/crypto/tls/handshake_messages.go.html#4531305">certificateRequestMsg</a></span><span class="op" id="4498210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4498213">if</span>&nbsp;<span class="ident" id="4498216"><a href="/gostd/crypto/tls/handshake_client.go.html#4496066">ok</a></span>&nbsp;<span class="op" id="4498219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4498223"><a href="/gostd/crypto/tls/handshake_client.go.html#4498148">certRequested</a></span>&nbsp;<span class="op" id="4498237">=</span>&nbsp;<span class="builtintype" id="4498239">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4498247">//&nbsp;RFC&nbsp;4346&nbsp;on&nbsp;the&nbsp;certificateAuthorities&nbsp;field:</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4498298">//&nbsp;A&nbsp;list&nbsp;of&nbsp;the&nbsp;distinguished&nbsp;names&nbsp;of&nbsp;acceptable&nbsp;certificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4498363">//&nbsp;authorities.&nbsp;These&nbsp;distinguished&nbsp;names&nbsp;may&nbsp;specify&nbsp;a&nbsp;desired</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4498429">//&nbsp;distinguished&nbsp;name&nbsp;for&nbsp;a&nbsp;root&nbsp;CA&nbsp;or&nbsp;for&nbsp;a&nbsp;subordinate&nbsp;CA;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4498492">//&nbsp;thus,&nbsp;this&nbsp;message&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;describe&nbsp;both&nbsp;known&nbsp;roots</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4498557">//&nbsp;and&nbsp;a&nbsp;desired&nbsp;authorization&nbsp;space.&nbsp;If&nbsp;the</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4498604">//&nbsp;certificate_authorities&nbsp;list&nbsp;is&nbsp;empty&nbsp;then&nbsp;the&nbsp;client&nbsp;MAY</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4498667">//&nbsp;send&nbsp;any&nbsp;certificate&nbsp;of&nbsp;the&nbsp;appropriate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4498712">//&nbsp;ClientCertificateType,&nbsp;unless&nbsp;there&nbsp;is&nbsp;some&nbsp;external</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4498770">//&nbsp;arrangement&nbsp;to&nbsp;the&nbsp;contrary.</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4498805"><a href="/gostd/crypto/tls/handshake_client.go.html#4495928">hs</a></span><span class="op" id="4498807">.</span><span class="ident" id="4498808"><a href="/gostd/crypto/tls/handshake_client.go.html#4490690">finishedHash</a></span><span class="op" id="4498820">.</span><span class="ident" id="4498821"><a href="/gostd/crypto/tls/prf.go.html#4575984">Write</a></span><span class="op" id="4498826">(</span><span class="ident" id="4498827"><a href="/gostd/crypto/tls/handshake_client.go.html#4498168">certReq</a></span><span class="op" id="4498834">.</span><span class="ident" id="4498835"><a href="/gostd/crypto/tls/handshake_messages.go.html#4532035">marshal</a></span><span class="op" id="4498842">(</span><span class="op" id="4498843">)</span><span class="op" id="4498844">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4498849">var</span>&nbsp;<span class="ident" id="4498853">rsaAvail</span><span class="op" id="4498861">,</span>&nbsp;<span class="ident" id="4498863">ecdsaAvail</span>&nbsp;<span class="builtintype" id="4498874">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4498881">for</span>&nbsp;<span class="ident" id="4498885">_</span><span class="op" id="4498886">,</span>&nbsp;<span class="ident" id="4498888">certType</span>&nbsp;<span class="op" id="4498897">:=</span>&nbsp;<span class="keyword" id="4498900">range</span>&nbsp;<span class="ident" id="4498906"><a href="/gostd/crypto/tls/handshake_client.go.html#4498168">certReq</a></span><span class="op" id="4498913">.</span><span class="ident" id="4498914"><a href="/gostd/crypto/tls/handshake_messages.go.html#4531529">certificateTypes</a></span>&nbsp;<span class="op" id="4498931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4498936">switch</span>&nbsp;<span class="ident" id="4498943"><a href="/gostd/crypto/tls/handshake_client.go.html#4498888">certType</a></span>&nbsp;<span class="op" id="4498952">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4498957">case</span>&nbsp;<span class="ident" id="4498962"><a href="/gostd/crypto/tls/common.go.html#4444743">certTypeRSASign</a></span><span class="op" id="4498977">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4498983"><a href="/gostd/crypto/tls/handshake_client.go.html#4498853">rsaAvail</a></span>&nbsp;<span class="op" id="4498992">=</span>&nbsp;<span class="builtintype" id="4498994">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4499002">case</span>&nbsp;<span class="ident" id="4499007"><a href="/gostd/crypto/tls/common.go.html#4445041">certTypeECDSASign</a></span><span class="op" id="4499024">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4499030"><a href="/gostd/crypto/tls/handshake_client.go.html#4498863">ecdsaAvail</a></span>&nbsp;<span class="op" id="4499041">=</span>&nbsp;<span class="builtintype" id="4499043">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4499051">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4499055">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4499060">//&nbsp;We&nbsp;need&nbsp;to&nbsp;search&nbsp;our&nbsp;list&nbsp;of&nbsp;client&nbsp;certs&nbsp;for&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4499116">//&nbsp;where&nbsp;SignatureAlgorithm&nbsp;is&nbsp;acceptable&nbsp;to&nbsp;the&nbsp;server&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4499182">//&nbsp;Issuer&nbsp;is&nbsp;in&nbsp;certReq.certificateAuthorities</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4499230">findCert</span><span class="op" id="4499238">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4499242">for</span>&nbsp;<span class="ident" id="4499246">i</span><span class="op" id="4499247">,</span>&nbsp;<span class="ident" id="4499249">chain</span>&nbsp;<span class="op" id="4499255">:=</span>&nbsp;<span class="keyword" id="4499258">range</span>&nbsp;<span class="ident" id="4499264"><a href="/gostd/crypto/tls/handshake_client.go.html#4495981">c</a></span><span class="op" id="4499265">.</span><span class="ident" id="4499266"><a href="/gostd/crypto/tls/conn.go.html#4462274">config</a></span><span class="op" id="4499272">.</span><span class="ident" id="4499273"><a href="/gostd/crypto/tls/common.go.html#4451046">Certificates</a></span>&nbsp;<span class="op" id="4499286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4499291">if</span>&nbsp;<span class="op" id="4499294">!</span><span class="ident" id="4499295"><a href="/gostd/crypto/tls/handshake_client.go.html#4498853">rsaAvail</a></span>&nbsp;<span class="op" id="4499304">&amp;&amp;</span>&nbsp;<span class="op" id="4499307">!</span><span class="ident" id="4499308"><a href="/gostd/crypto/tls/handshake_client.go.html#4498863">ecdsaAvail</a></span>&nbsp;<span class="op" id="4499319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4499325">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4499337">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4499343">for</span>&nbsp;<span class="ident" id="4499347">j</span><span class="op" id="4499348">,</span>&nbsp;<span class="ident" id="4499350">cert</span>&nbsp;<span class="op" id="4499355">:=</span>&nbsp;<span class="keyword" id="4499358">range</span>&nbsp;<span class="ident" id="4499364"><a href="/gostd/crypto/tls/handshake_client.go.html#4499249">chain</a></span><span class="op" id="4499369">.</span><span class="ident" id="4499370"><a href="/gostd/crypto/tls/common.go.html#4458009">Certificate</a></span>&nbsp;<span class="op" id="4499382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4499388">x509Cert</span>&nbsp;<span class="op" id="4499397">:=</span>&nbsp;<span class="ident" id="4499400"><a href="/gostd/crypto/tls/handshake_client.go.html#4499249">chain</a></span><span class="op" id="4499405">.</span><span class="ident" id="4499406"><a href="/gostd/crypto/tls/common.go.html#4458738">Leaf</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4499415">//&nbsp;parse&nbsp;the&nbsp;certificate&nbsp;if&nbsp;this&nbsp;isn&#39;t&nbsp;the&nbsp;leaf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4499467">//&nbsp;node,&nbsp;or&nbsp;if&nbsp;chain.Leaf&nbsp;was&nbsp;nil</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4499505">if</span>&nbsp;<span class="ident" id="4499508"><a href="/gostd/crypto/tls/handshake_client.go.html#4499347">j</a></span>&nbsp;<span class="op" id="4499510">!=</span>&nbsp;<span class="num" id="4499513">0</span>&nbsp;<span class="op" id="4499515">||</span>&nbsp;<span class="ident" id="4499518"><a href="/gostd/crypto/tls/handshake_client.go.html#4499388">x509Cert</a></span>&nbsp;<span class="op" id="4499527">==</span>&nbsp;<span class="builtintype" id="4499530">nil</span>&nbsp;<span class="op" id="4499534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4499541">if</span>&nbsp;<span class="ident" id="4499544"><a href="/gostd/crypto/tls/handshake_client.go.html#4499388">x509Cert</a></span><span class="op" id="4499552">,</span>&nbsp;<span class="ident" id="4499554"><a href="/gostd/crypto/tls/handshake_client.go.html#4495998">err</a></span>&nbsp;<span class="op" id="4499558">=</span>&nbsp;<span class="ident" id="4499560"><a href="/gostd/crypto/tls/handshake_client.go.html#4490489">x509</a></span><span class="op" id="4499564">.</span><span class="ident" id="4499565"><a href="/gostd/crypto/x509/x509.go.html#4679509">ParseCertificate</a></span><span class="op" id="4499581">(</span><span class="ident" id="4499582"><a href="/gostd/crypto/tls/handshake_client.go.html#4499350">cert</a></span><span class="op" id="4499586">)</span><span class="op" id="4499587">;</span>&nbsp;<span class="ident" id="4499589"><a href="/gostd/crypto/tls/handshake_client.go.html#4495998">err</a></span>&nbsp;<span class="op" id="4499593">!=</span>&nbsp;<span class="builtintype" id="4499596">nil</span>&nbsp;<span class="op" id="4499600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4499608"><a href="/gostd/crypto/tls/handshake_client.go.html#4495981">c</a></span><span class="op" id="4499609">.</span><span class="ident" id="4499610"><a href="/gostd/crypto/tls/conn.go.html#4480829">sendAlert</a></span><span class="op" id="4499619">(</span><span class="ident" id="4499620"><a href="/gostd/crypto/tls/alert.go.html#4431016">alertInternalError</a></span><span class="op" id="4499638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4499646">return</span>&nbsp;<span class="ident" id="4499653"><a href="/gostd/crypto/tls/handshake_client.go.html#4490504">errors</a></span><span class="op" id="4499659">.</span><span class="ident" id="4499660"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4499663">(</span><span class="string" id="4499664">&#34;tls:&nbsp;failed&nbsp;to&nbsp;parse&nbsp;client&nbsp;certificate&nbsp;#&#34;</span>&nbsp;<span class="op" id="4499708">+</span>&nbsp;<span class="ident" id="4499710"><a href="/gostd/crypto/tls/handshake_client.go.html#4490534">strconv</a></span><span class="op" id="4499717">.</span><span class="ident" id="4499718"><a href="/gostd/strconv/itoa.go.html#2407288">Itoa</a></span><span class="op" id="4499722">(</span><span class="ident" id="4499723"><a href="/gostd/crypto/tls/handshake_client.go.html#4499246">i</a></span><span class="op" id="4499724">)</span>&nbsp;<span class="op" id="4499726">+</span>&nbsp;<span class="string" id="4499728">&#34;:&nbsp;&#34;</span>&nbsp;<span class="op" id="4499733">+</span>&nbsp;<span class="ident" id="4499735"><a href="/gostd/crypto/tls/handshake_client.go.html#4495998">err</a></span><span class="op" id="4499738">.</span><span class="ident" id="4499739">Error</span><span class="op" id="4499744">(</span><span class="op" id="4499745">)</span><span class="op" id="4499746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4499753">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4499759">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4499766">switch</span>&nbsp;<span class="op" id="4499773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4499779">case</span>&nbsp;<span class="ident" id="4499784"><a href="/gostd/crypto/tls/handshake_client.go.html#4498853">rsaAvail</a></span>&nbsp;<span class="op" id="4499793">&amp;&amp;</span>&nbsp;<span class="ident" id="4499796"><a href="/gostd/crypto/tls/handshake_client.go.html#4499388">x509Cert</a></span><span class="op" id="4499804">.</span><span class="ident" id="4499805"><a href="/gostd/crypto/x509/x509.go.html#4660224">PublicKeyAlgorithm</a></span>&nbsp;<span class="op" id="4499824">==</span>&nbsp;<span class="ident" id="4499827"><a href="/gostd/crypto/tls/handshake_client.go.html#4490489">x509</a></span><span class="op" id="4499831">.</span><span class="ident" id="4499832"><a href="/gostd/crypto/x509/x509.go.html#4649671">RSA</a></span><span class="op" id="4499835">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4499841">case</span>&nbsp;<span class="ident" id="4499846"><a href="/gostd/crypto/tls/handshake_client.go.html#4498863">ecdsaAvail</a></span>&nbsp;<span class="op" id="4499857">&amp;&amp;</span>&nbsp;<span class="ident" id="4499860"><a href="/gostd/crypto/tls/handshake_client.go.html#4499388">x509Cert</a></span><span class="op" id="4499868">.</span><span class="ident" id="4499869"><a href="/gostd/crypto/x509/x509.go.html#4660224">PublicKeyAlgorithm</a></span>&nbsp;<span class="op" id="4499888">==</span>&nbsp;<span class="ident" id="4499891"><a href="/gostd/crypto/tls/handshake_client.go.html#4490489">x509</a></span><span class="op" id="4499895">.</span><span class="ident" id="4499896"><a href="/gostd/crypto/x509/x509.go.html#4649681">ECDSA</a></span><span class="op" id="4499901">:</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4499907">default</span><span class="op" id="4499914">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4499921">continue</span>&nbsp;<span class="ident" id="4499930"><a href="/gostd/crypto/tls/handshake_client.go.html#4499230">findCert</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4499943">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4499950">if</span>&nbsp;<span class="builtinfunc" id="4499953">len</span><span class="op" id="4499956">(</span><span class="ident" id="4499957"><a href="/gostd/crypto/tls/handshake_client.go.html#4498168">certReq</a></span><span class="op" id="4499964">.</span><span class="ident" id="4499965"><a href="/gostd/crypto/tls/handshake_messages.go.html#4531603">certificateAuthorities</a></span><span class="op" id="4499987">)</span>&nbsp;<span class="op" id="4499989">==</span>&nbsp;<span class="num" id="4499992">0</span>&nbsp;<span class="op" id="4499994">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4500001">//&nbsp;they&nbsp;gave&nbsp;us&nbsp;an&nbsp;empty&nbsp;list,&nbsp;so&nbsp;just&nbsp;take&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4500054">//&nbsp;first&nbsp;cert&nbsp;from&nbsp;c.config.Certificates</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4500100"><a href="/gostd/crypto/tls/handshake_client.go.html#4498118">chainToSend</a></span>&nbsp;<span class="op" id="4500112">=</span>&nbsp;<span class="op" id="4500114">&amp;</span><span class="ident" id="4500115"><a href="/gostd/crypto/tls/handshake_client.go.html#4499249">chain</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4500126">break</span>&nbsp;<span class="ident" id="4500132"><a href="/gostd/crypto/tls/handshake_client.go.html#4499230">findCert</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4500145">}</span><br>
<span class="lineno">380</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4500152">for</span>&nbsp;<span class="ident" id="4500156">_</span><span class="op" id="4500157">,</span>&nbsp;<span class="ident" id="4500159">ca</span>&nbsp;<span class="op" id="4500162">:=</span>&nbsp;<span class="keyword" id="4500165">range</span>&nbsp;<span class="ident" id="4500171"><a href="/gostd/crypto/tls/handshake_client.go.html#4498168">certReq</a></span><span class="op" id="4500178">.</span><span class="ident" id="4500179"><a href="/gostd/crypto/tls/handshake_messages.go.html#4531603">certificateAuthorities</a></span>&nbsp;<span class="op" id="4500202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4500209">if</span>&nbsp;<span class="ident" id="4500212"><a href="/gostd/crypto/tls/handshake_client.go.html#4490423">bytes</a></span><span class="op" id="4500217">.</span><span class="ident" id="4500218"><a href="/gostd/bytes/bytes_decl.go.html#1414806">Equal</a></span><span class="op" id="4500223">(</span><span class="ident" id="4500224"><a href="/gostd/crypto/tls/handshake_client.go.html#4499388">x509Cert</a></span><span class="op" id="4500232">.</span><span class="ident" id="4500233"><a href="/gostd/crypto/x509/x509.go.html#4660102">RawIssuer</a></span><span class="op" id="4500242">,</span>&nbsp;<span class="ident" id="4500244"><a href="/gostd/crypto/tls/handshake_client.go.html#4500159">ca</a></span><span class="op" id="4500246">)</span>&nbsp;<span class="op" id="4500248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4500256"><a href="/gostd/crypto/tls/handshake_client.go.html#4498118">chainToSend</a></span>&nbsp;<span class="op" id="4500268">=</span>&nbsp;<span class="op" id="4500270">&amp;</span><span class="ident" id="4500271"><a href="/gostd/crypto/tls/handshake_client.go.html#4499249">chain</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4500283">break</span>&nbsp;<span class="ident" id="4500289"><a href="/gostd/crypto/tls/handshake_client.go.html#4499230">findCert</a></span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4500303">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4500309">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4500314">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4500318">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4500323"><a href="/gostd/crypto/tls/handshake_client.go.html#4495993">msg</a></span><span class="op" id="4500326">,</span>&nbsp;<span class="ident" id="4500328"><a href="/gostd/crypto/tls/handshake_client.go.html#4495998">err</a></span>&nbsp;<span class="op" id="4500332">=</span>&nbsp;<span class="ident" id="4500334"><a href="/gostd/crypto/tls/handshake_client.go.html#4495981">c</a></span><span class="op" id="4500335">.</span><span class="ident" id="4500336"><a href="/gostd/crypto/tls/conn.go.html#4483177">readHandshake</a></span><span class="op" id="4500349">(</span><span class="op" id="4500350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4500354">if</span>&nbsp;<span class="ident" id="4500357"><a href="/gostd/crypto/tls/handshake_client.go.html#4495998">err</a></span>&nbsp;<span class="op" id="4500361">!=</span>&nbsp;<span class="builtintype" id="4500364">nil</span>&nbsp;<span class="op" id="4500368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4500373">return</span>&nbsp;<span class="ident" id="4500380"><a href="/gostd/crypto/tls/handshake_client.go.html#4495998">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4500386">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4500389">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4500393">shd</span><span class="op" id="4500396">,</span>&nbsp;<span class="ident" id="4500398"><a href="/gostd/crypto/tls/handshake_client.go.html#4496066">ok</a></span>&nbsp;<span class="op" id="4500401">:=</span>&nbsp;<span class="ident" id="4500404"><a href="/gostd/crypto/tls/handshake_client.go.html#4495993">msg</a></span><span class="op" id="4500407">.</span><span class="op" id="4500408">(</span><span class="op" id="4500409">*</span><span class="ident" id="4500410"><a href="/gostd/crypto/tls/handshake_messages.go.html#4528418">serverHelloDoneMsg</a></span><span class="op" id="4500428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4500431">if</span>&nbsp;<span class="op" id="4500434">!</span><span class="ident" id="4500435"><a href="/gostd/crypto/tls/handshake_client.go.html#4496066">ok</a></span>&nbsp;<span class="op" id="4500438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4500442"><a href="/gostd/crypto/tls/handshake_client.go.html#4495981">c</a></span><span class="op" id="4500443">.</span><span class="ident" id="4500444"><a href="/gostd/crypto/tls/conn.go.html#4480829">sendAlert</a></span><span class="op" id="4500453">(</span><span class="ident" id="4500454"><a href="/gostd/crypto/tls/alert.go.html#4430296">alertUnexpectedMessage</a></span><span class="op" id="4500476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4500480">return</span>&nbsp;<span class="ident" id="4500487"><a href="/gostd/crypto/tls/common.go.html#4461311">unexpectedMessageError</a></span><span class="op" id="4500509">(</span><span class="ident" id="4500510"><a href="/gostd/crypto/tls/handshake_client.go.html#4500393">shd</a></span><span class="op" id="4500513">,</span>&nbsp;<span class="ident" id="4500515"><a href="/gostd/crypto/tls/handshake_client.go.html#4495993">msg</a></span><span class="op" id="4500518">)</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4500521">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4500524"><a href="/gostd/crypto/tls/handshake_client.go.html#4495928">hs</a></span><span class="op" id="4500526">.</span><span class="ident" id="4500527"><a href="/gostd/crypto/tls/handshake_client.go.html#4490690">finishedHash</a></span><span class="op" id="4500539">.</span><span class="ident" id="4500540"><a href="/gostd/crypto/tls/prf.go.html#4575984">Write</a></span><span class="op" id="4500545">(</span><span class="ident" id="4500546"><a href="/gostd/crypto/tls/handshake_client.go.html#4500393">shd</a></span><span class="op" id="4500549">.</span><span class="ident" id="4500550"><a href="/gostd/crypto/tls/handshake_messages.go.html#4528581">marshal</a></span><span class="op" id="4500557">(</span><span class="op" id="4500558">)</span><span class="op" id="4500559">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4500563">//&nbsp;If&nbsp;the&nbsp;server&nbsp;requested&nbsp;a&nbsp;certificate&nbsp;then&nbsp;we&nbsp;have&nbsp;to&nbsp;send&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4500628">//&nbsp;Certificate&nbsp;message,&nbsp;even&nbsp;if&nbsp;it&#39;s&nbsp;empty&nbsp;because&nbsp;we&nbsp;don&#39;t&nbsp;have&nbsp;a</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4500696">//&nbsp;certificate&nbsp;to&nbsp;send.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4500721">if</span>&nbsp;<span class="ident" id="4500724"><a href="/gostd/crypto/tls/handshake_client.go.html#4498148">certRequested</a></span>&nbsp;<span class="op" id="4500738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4500742"><a href="/gostd/crypto/tls/handshake_client.go.html#4496057">certMsg</a></span>&nbsp;<span class="op" id="4500750">=</span>&nbsp;<span class="builtinfunc" id="4500752">new</span><span class="op" id="4500755">(</span><span class="ident" id="4500756"><a href="/gostd/crypto/tls/handshake_messages.go.html#4524760">certificateMsg</a></span><span class="op" id="4500770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4500774">if</span>&nbsp;<span class="ident" id="4500777"><a href="/gostd/crypto/tls/handshake_client.go.html#4498118">chainToSend</a></span>&nbsp;<span class="op" id="4500789">!=</span>&nbsp;<span class="builtintype" id="4500792">nil</span>&nbsp;<span class="op" id="4500796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4500801"><a href="/gostd/crypto/tls/handshake_client.go.html#4496057">certMsg</a></span><span class="op" id="4500808">.</span><span class="ident" id="4500809"><a href="/gostd/crypto/tls/handshake_messages.go.html#4524806">certificates</a></span>&nbsp;<span class="op" id="4500822">=</span>&nbsp;<span class="ident" id="4500824"><a href="/gostd/crypto/tls/handshake_client.go.html#4498118">chainToSend</a></span><span class="op" id="4500835">.</span><span class="ident" id="4500836"><a href="/gostd/crypto/tls/common.go.html#4458009">Certificate</a></span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4500850">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4500854"><a href="/gostd/crypto/tls/handshake_client.go.html#4495928">hs</a></span><span class="op" id="4500856">.</span><span class="ident" id="4500857"><a href="/gostd/crypto/tls/handshake_client.go.html#4490690">finishedHash</a></span><span class="op" id="4500869">.</span><span class="ident" id="4500870"><a href="/gostd/crypto/tls/prf.go.html#4575984">Write</a></span><span class="op" id="4500875">(</span><span class="ident" id="4500876"><a href="/gostd/crypto/tls/handshake_client.go.html#4496057">certMsg</a></span><span class="op" id="4500883">.</span><span class="ident" id="4500884"><a href="/gostd/crypto/tls/handshake_messages.go.html#4525058">marshal</a></span><span class="op" id="4500891">(</span><span class="op" id="4500892">)</span><span class="op" id="4500893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4500897"><a href="/gostd/crypto/tls/handshake_client.go.html#4495981">c</a></span><span class="op" id="4500898">.</span><span class="ident" id="4500899"><a href="/gostd/crypto/tls/conn.go.html#4481088">writeRecord</a></span><span class="op" id="4500910">(</span><span class="ident" id="4500911"><a href="/gostd/crypto/tls/common.go.html#4443022">recordTypeHandshake</a></span><span class="op" id="4500930">,</span>&nbsp;<span class="ident" id="4500932"><a href="/gostd/crypto/tls/handshake_client.go.html#4496057">certMsg</a></span><span class="op" id="4500939">.</span><span class="ident" id="4500940"><a href="/gostd/crypto/tls/handshake_messages.go.html#4525058">marshal</a></span><span class="op" id="4500947">(</span><span class="op" id="4500948">)</span><span class="op" id="4500949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4500952">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4500956">preMasterSecret</span><span class="op" id="4500971">,</span>&nbsp;<span class="ident" id="4500973">ckx</span><span class="op" id="4500976">,</span>&nbsp;<span class="ident" id="4500978"><a href="/gostd/crypto/tls/handshake_client.go.html#4495998">err</a></span>&nbsp;<span class="op" id="4500982">:=</span>&nbsp;<span class="ident" id="4500985"><a href="/gostd/crypto/tls/handshake_client.go.html#4497744">keyAgreement</a></span><span class="op" id="4500997">.</span><span class="ident" id="4500998"><a href="/gostd/crypto/tls/cipher_suites.go.html#4433789">generateClientKeyExchange</a></span><span class="op" id="4501023">(</span><span class="ident" id="4501024"><a href="/gostd/crypto/tls/handshake_client.go.html#4495981">c</a></span><span class="op" id="4501025">.</span><span class="ident" id="4501026"><a href="/gostd/crypto/tls/conn.go.html#4462274">config</a></span><span class="op" id="4501032">,</span>&nbsp;<span class="ident" id="4501034"><a href="/gostd/crypto/tls/handshake_client.go.html#4495928">hs</a></span><span class="op" id="4501036">.</span><span class="ident" id="4501037"><a href="/gostd/crypto/tls/handshake_client.go.html#4490633">hello</a></span><span class="op" id="4501042">,</span>&nbsp;<span class="ident" id="4501044"><a href="/gostd/crypto/tls/handshake_client.go.html#4496269">certs</a></span><span class="op" id="4501049">[</span><span class="num" id="4501050">0</span><span class="op" id="4501051">]</span><span class="op" id="4501052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4501055">if</span>&nbsp;<span class="ident" id="4501058"><a href="/gostd/crypto/tls/handshake_client.go.html#4495998">err</a></span>&nbsp;<span class="op" id="4501062">!=</span>&nbsp;<span class="builtintype" id="4501065">nil</span>&nbsp;<span class="op" id="4501069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4501073"><a href="/gostd/crypto/tls/handshake_client.go.html#4495981">c</a></span><span class="op" id="4501074">.</span><span class="ident" id="4501075"><a href="/gostd/crypto/tls/conn.go.html#4480829">sendAlert</a></span><span class="op" id="4501084">(</span><span class="ident" id="4501085"><a href="/gostd/crypto/tls/alert.go.html#4431016">alertInternalError</a></span><span class="op" id="4501103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4501107">return</span>&nbsp;<span class="ident" id="4501114"><a href="/gostd/crypto/tls/handshake_client.go.html#4495998">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4501119">}</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4501122">if</span>&nbsp;<span class="ident" id="4501125"><a href="/gostd/crypto/tls/handshake_client.go.html#4500973">ckx</a></span>&nbsp;<span class="op" id="4501129">!=</span>&nbsp;<span class="builtintype" id="4501132">nil</span>&nbsp;<span class="op" id="4501136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4501140"><a href="/gostd/crypto/tls/handshake_client.go.html#4495928">hs</a></span><span class="op" id="4501142">.</span><span class="ident" id="4501143"><a href="/gostd/crypto/tls/handshake_client.go.html#4490690">finishedHash</a></span><span class="op" id="4501155">.</span><span class="ident" id="4501156"><a href="/gostd/crypto/tls/prf.go.html#4575984">Write</a></span><span class="op" id="4501161">(</span><span class="ident" id="4501162"><a href="/gostd/crypto/tls/handshake_client.go.html#4500973">ckx</a></span><span class="op" id="4501165">.</span><span class="ident" id="4501166"><a href="/gostd/crypto/tls/handshake_messages.go.html#4529064">marshal</a></span><span class="op" id="4501173">(</span><span class="op" id="4501174">)</span><span class="op" id="4501175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4501179"><a href="/gostd/crypto/tls/handshake_client.go.html#4495981">c</a></span><span class="op" id="4501180">.</span><span class="ident" id="4501181"><a href="/gostd/crypto/tls/conn.go.html#4481088">writeRecord</a></span><span class="op" id="4501192">(</span><span class="ident" id="4501193"><a href="/gostd/crypto/tls/common.go.html#4443022">recordTypeHandshake</a></span><span class="op" id="4501212">,</span>&nbsp;<span class="ident" id="4501214"><a href="/gostd/crypto/tls/handshake_client.go.html#4500973">ckx</a></span><span class="op" id="4501217">.</span><span class="ident" id="4501218"><a href="/gostd/crypto/tls/handshake_messages.go.html#4529064">marshal</a></span><span class="op" id="4501225">(</span><span class="op" id="4501226">)</span><span class="op" id="4501227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4501230">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4501234">if</span>&nbsp;<span class="ident" id="4501237"><a href="/gostd/crypto/tls/handshake_client.go.html#4498118">chainToSend</a></span>&nbsp;<span class="op" id="4501249">!=</span>&nbsp;<span class="builtintype" id="4501252">nil</span>&nbsp;<span class="op" id="4501256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4501260">var</span>&nbsp;<span class="ident" id="4501264">signed</span>&nbsp;<span class="op" id="4501271">[</span><span class="op" id="4501272">]</span><span class="builtintype" id="4501273">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4501280">certVerify</span>&nbsp;<span class="op" id="4501291">:=</span>&nbsp;<span class="op" id="4501294">&amp;</span><span class="ident" id="4501295"><a href="/gostd/crypto/tls/handshake_messages.go.html#4534730">certificateVerifyMsg</a></span><span class="op" id="4501315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4501320"><a href="/gostd/crypto/tls/handshake_messages.go.html#4534789">hasSignatureAndHash</a></span><span class="op" id="4501339">:</span>&nbsp;<span class="ident" id="4501341"><a href="/gostd/crypto/tls/handshake_client.go.html#4495981">c</a></span><span class="op" id="4501342">.</span><span class="ident" id="4501343"><a href="/gostd/crypto/tls/conn.go.html#4462168">vers</a></span>&nbsp;<span class="op" id="4501348">&gt;=</span>&nbsp;<span class="ident" id="4501351"><a href="/gostd/crypto/tls/common.go.html#4442509">VersionTLS12</a></span><span class="op" id="4501363">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4501367">}</span><br>
<span class="lineno">430</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4501372">key</span><span class="op" id="4501375">,</span>&nbsp;<span class="ident" id="4501377">ok</span>&nbsp;<span class="op" id="4501380">:=</span>&nbsp;<span class="ident" id="4501383"><a href="/gostd/crypto/tls/handshake_client.go.html#4498118">chainToSend</a></span><span class="op" id="4501394">.</span><span class="ident" id="4501395"><a href="/gostd/crypto/tls/common.go.html#4458333">PrivateKey</a></span><span class="op" id="4501405">.</span><span class="op" id="4501406">(</span><span class="ident" id="4501407"><a href="/gostd/crypto/tls/handshake_client.go.html#4490432">crypto</a></span><span class="op" id="4501413">.</span><span class="ident" id="4501414"><a href="/gostd/crypto/crypto.go.html#3012746">Signer</a></span><span class="op" id="4501420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4501424">if</span>&nbsp;<span class="op" id="4501427">!</span><span class="ident" id="4501428"><a href="/gostd/crypto/tls/handshake_client.go.html#4501377">ok</a></span>&nbsp;<span class="op" id="4501431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4501436"><a href="/gostd/crypto/tls/handshake_client.go.html#4495981">c</a></span><span class="op" id="4501437">.</span><span class="ident" id="4501438"><a href="/gostd/crypto/tls/conn.go.html#4480829">sendAlert</a></span><span class="op" id="4501447">(</span><span class="ident" id="4501448"><a href="/gostd/crypto/tls/alert.go.html#4431016">alertInternalError</a></span><span class="op" id="4501466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4501471">return</span>&nbsp;<span class="ident" id="4501478"><a href="/gostd/crypto/tls/handshake_client.go.html#4490514">fmt</a></span><span class="op" id="4501481">.</span><span class="ident" id="4501482"><a href="/gostd/fmt/print.go.html#2143886">Errorf</a></span><span class="op" id="4501488">(</span><span class="string" id="4501489">&#34;tls:&nbsp;client&nbsp;certificate&nbsp;private&nbsp;key&nbsp;of&nbsp;type&nbsp;%T&nbsp;does&nbsp;not&nbsp;implement&nbsp;crypto.Signer&#34;</span><span class="op" id="4501570">,</span>&nbsp;<span class="ident" id="4501572"><a href="/gostd/crypto/tls/handshake_client.go.html#4498118">chainToSend</a></span><span class="op" id="4501583">.</span><span class="ident" id="4501584"><a href="/gostd/crypto/tls/common.go.html#4458333">PrivateKey</a></span><span class="op" id="4501594">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4501598">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4501602">switch</span>&nbsp;<span class="ident" id="4501609"><a href="/gostd/crypto/tls/handshake_client.go.html#4501372">key</a></span><span class="op" id="4501612">.</span><span class="ident" id="4501613"><a href="/gostd/crypto/crypto.go.html#3012846">Public</a></span><span class="op" id="4501619">(</span><span class="op" id="4501620">)</span><span class="op" id="4501621">.</span><span class="op" id="4501622">(</span><span class="keyword" id="4501623">type</span><span class="op" id="4501627">)</span>&nbsp;<span class="op" id="4501629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4501633">case</span>&nbsp;<span class="op" id="4501638">*</span><span class="ident" id="4501639"><a href="/gostd/crypto/tls/handshake_client.go.html#4490442">ecdsa</a></span><span class="op" id="4501644">.</span><span class="ident" id="4501645"><a href="/gostd/crypto/ecdsa/ecdsa.go.html#3005409">PublicKey</a></span><span class="op" id="4501654">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4501659">digest</span><span class="op" id="4501665">,</span>&nbsp;<span class="ident" id="4501667">hashFunc</span><span class="op" id="4501675">,</span>&nbsp;<span class="ident" id="4501677">hashId</span>&nbsp;<span class="op" id="4501684">:=</span>&nbsp;<span class="ident" id="4501687"><a href="/gostd/crypto/tls/handshake_client.go.html#4495928">hs</a></span><span class="op" id="4501689">.</span><span class="ident" id="4501690"><a href="/gostd/crypto/tls/handshake_client.go.html#4490690">finishedHash</a></span><span class="op" id="4501702">.</span><span class="ident" id="4501703"><a href="/gostd/crypto/tls/prf.go.html#4578516">hashForClientCertificate</a></span><span class="op" id="4501727">(</span><span class="ident" id="4501728"><a href="/gostd/crypto/tls/common.go.html#4445618">signatureECDSA</a></span><span class="op" id="4501742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4501747"><a href="/gostd/crypto/tls/handshake_client.go.html#4501264">signed</a></span><span class="op" id="4501753">,</span>&nbsp;<span class="ident" id="4501755"><a href="/gostd/crypto/tls/handshake_client.go.html#4495998">err</a></span>&nbsp;<span class="op" id="4501759">=</span>&nbsp;<span class="ident" id="4501761"><a href="/gostd/crypto/tls/handshake_client.go.html#4501372">key</a></span><span class="op" id="4501764">.</span><span class="ident" id="4501765"><a href="/gostd/crypto/crypto.go.html#3013434">Sign</a></span><span class="op" id="4501769">(</span><span class="ident" id="4501770"><a href="/gostd/crypto/tls/handshake_client.go.html#4495981">c</a></span><span class="op" id="4501771">.</span><span class="ident" id="4501772"><a href="/gostd/crypto/tls/conn.go.html#4462274">config</a></span><span class="op" id="4501778">.</span><span class="ident" id="4501779"><a href="/gostd/crypto/tls/common.go.html#4455096">rand</a></span><span class="op" id="4501783">(</span><span class="op" id="4501784">)</span><span class="op" id="4501785">,</span>&nbsp;<span class="ident" id="4501787"><a href="/gostd/crypto/tls/handshake_client.go.html#4501659">digest</a></span><span class="op" id="4501793">,</span>&nbsp;<span class="ident" id="4501795"><a href="/gostd/crypto/tls/handshake_client.go.html#4501667">hashFunc</a></span><span class="op" id="4501803">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4501808"><a href="/gostd/crypto/tls/handshake_client.go.html#4501280">certVerify</a></span><span class="op" id="4501818">.</span><span class="ident" id="4501819"><a href="/gostd/crypto/tls/handshake_messages.go.html#4534815">signatureAndHash</a></span><span class="op" id="4501835">.</span><span class="ident" id="4501836"><a href="/gostd/crypto/tls/common.go.html#4445791">signature</a></span>&nbsp;<span class="op" id="4501846">=</span>&nbsp;<span class="ident" id="4501848"><a href="/gostd/crypto/tls/common.go.html#4445618">signatureECDSA</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4501866"><a href="/gostd/crypto/tls/handshake_client.go.html#4501280">certVerify</a></span><span class="op" id="4501876">.</span><span class="ident" id="4501877"><a href="/gostd/crypto/tls/handshake_messages.go.html#4534815">signatureAndHash</a></span><span class="op" id="4501893">.</span><span class="ident" id="4501894"><a href="/gostd/crypto/tls/common.go.html#4445785">hash</a></span>&nbsp;<span class="op" id="4501899">=</span>&nbsp;<span class="ident" id="4501901"><a href="/gostd/crypto/tls/handshake_client.go.html#4501677">hashId</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4501910">case</span>&nbsp;<span class="op" id="4501915">*</span><span class="ident" id="4501916"><a href="/gostd/crypto/tls/handshake_client.go.html#4490458">rsa</a></span><span class="op" id="4501919">.</span><span class="ident" id="4501920"><a href="/gostd/crypto/rsa/rsa.go.html#4742943">PublicKey</a></span><span class="op" id="4501929">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4501934">digest</span><span class="op" id="4501940">,</span>&nbsp;<span class="ident" id="4501942">hashFunc</span><span class="op" id="4501950">,</span>&nbsp;<span class="ident" id="4501952">hashId</span>&nbsp;<span class="op" id="4501959">:=</span>&nbsp;<span class="ident" id="4501962"><a href="/gostd/crypto/tls/handshake_client.go.html#4495928">hs</a></span><span class="op" id="4501964">.</span><span class="ident" id="4501965"><a href="/gostd/crypto/tls/handshake_client.go.html#4490690">finishedHash</a></span><span class="op" id="4501977">.</span><span class="ident" id="4501978"><a href="/gostd/crypto/tls/prf.go.html#4578516">hashForClientCertificate</a></span><span class="op" id="4502002">(</span><span class="ident" id="4502003"><a href="/gostd/crypto/tls/common.go.html#4445592">signatureRSA</a></span><span class="op" id="4502015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4502020"><a href="/gostd/crypto/tls/handshake_client.go.html#4501264">signed</a></span><span class="op" id="4502026">,</span>&nbsp;<span class="ident" id="4502028"><a href="/gostd/crypto/tls/handshake_client.go.html#4495998">err</a></span>&nbsp;<span class="op" id="4502032">=</span>&nbsp;<span class="ident" id="4502034"><a href="/gostd/crypto/tls/handshake_client.go.html#4501372">key</a></span><span class="op" id="4502037">.</span><span class="ident" id="4502038"><a href="/gostd/crypto/crypto.go.html#3013434">Sign</a></span><span class="op" id="4502042">(</span><span class="ident" id="4502043"><a href="/gostd/crypto/tls/handshake_client.go.html#4495981">c</a></span><span class="op" id="4502044">.</span><span class="ident" id="4502045"><a href="/gostd/crypto/tls/conn.go.html#4462274">config</a></span><span class="op" id="4502051">.</span><span class="ident" id="4502052"><a href="/gostd/crypto/tls/common.go.html#4455096">rand</a></span><span class="op" id="4502056">(</span><span class="op" id="4502057">)</span><span class="op" id="4502058">,</span>&nbsp;<span class="ident" id="4502060"><a href="/gostd/crypto/tls/handshake_client.go.html#4501934">digest</a></span><span class="op" id="4502066">,</span>&nbsp;<span class="ident" id="4502068"><a href="/gostd/crypto/tls/handshake_client.go.html#4501942">hashFunc</a></span><span class="op" id="4502076">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4502081"><a href="/gostd/crypto/tls/handshake_client.go.html#4501280">certVerify</a></span><span class="op" id="4502091">.</span><span class="ident" id="4502092"><a href="/gostd/crypto/tls/handshake_messages.go.html#4534815">signatureAndHash</a></span><span class="op" id="4502108">.</span><span class="ident" id="4502109"><a href="/gostd/crypto/tls/common.go.html#4445791">signature</a></span>&nbsp;<span class="op" id="4502119">=</span>&nbsp;<span class="ident" id="4502121"><a href="/gostd/crypto/tls/common.go.html#4445592">signatureRSA</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4502137"><a href="/gostd/crypto/tls/handshake_client.go.html#4501280">certVerify</a></span><span class="op" id="4502147">.</span><span class="ident" id="4502148"><a href="/gostd/crypto/tls/handshake_messages.go.html#4534815">signatureAndHash</a></span><span class="op" id="4502164">.</span><span class="ident" id="4502165"><a href="/gostd/crypto/tls/common.go.html#4445785">hash</a></span>&nbsp;<span class="op" id="4502170">=</span>&nbsp;<span class="ident" id="4502172"><a href="/gostd/crypto/tls/handshake_client.go.html#4501952">hashId</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4502181">default</span><span class="op" id="4502188">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4502193"><a href="/gostd/crypto/tls/handshake_client.go.html#4495998">err</a></span>&nbsp;<span class="op" id="4502197">=</span>&nbsp;<span class="ident" id="4502199"><a href="/gostd/crypto/tls/handshake_client.go.html#4490514">fmt</a></span><span class="op" id="4502202">.</span><span class="ident" id="4502203"><a href="/gostd/fmt/print.go.html#2143886">Errorf</a></span><span class="op" id="4502209">(</span><span class="string" id="4502210">&#34;tls:&nbsp;unknown&nbsp;client&nbsp;certificate&nbsp;key&nbsp;type:&nbsp;%T&#34;</span><span class="op" id="4502256">,</span>&nbsp;<span class="ident" id="4502258"><a href="/gostd/crypto/tls/handshake_client.go.html#4501372">key</a></span><span class="op" id="4502261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4502265">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4502269">if</span>&nbsp;<span class="ident" id="4502272"><a href="/gostd/crypto/tls/handshake_client.go.html#4495998">err</a></span>&nbsp;<span class="op" id="4502276">!=</span>&nbsp;<span class="builtintype" id="4502279">nil</span>&nbsp;<span class="op" id="4502283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4502288"><a href="/gostd/crypto/tls/handshake_client.go.html#4495981">c</a></span><span class="op" id="4502289">.</span><span class="ident" id="4502290"><a href="/gostd/crypto/tls/conn.go.html#4480829">sendAlert</a></span><span class="op" id="4502299">(</span><span class="ident" id="4502300"><a href="/gostd/crypto/tls/alert.go.html#4431016">alertInternalError</a></span><span class="op" id="4502318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4502323">return</span>&nbsp;<span class="ident" id="4502330"><a href="/gostd/crypto/tls/handshake_client.go.html#4490504">errors</a></span><span class="op" id="4502336">.</span><span class="ident" id="4502337"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4502340">(</span><span class="string" id="4502341">&#34;tls:&nbsp;failed&nbsp;to&nbsp;sign&nbsp;handshake&nbsp;with&nbsp;client&nbsp;certificate:&nbsp;&#34;</span>&nbsp;<span class="op" id="4502399">+</span>&nbsp;<span class="ident" id="4502401"><a href="/gostd/crypto/tls/handshake_client.go.html#4495998">err</a></span><span class="op" id="4502404">.</span><span class="ident" id="4502405">Error</span><span class="op" id="4502410">(</span><span class="op" id="4502411">)</span><span class="op" id="4502412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4502416">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4502420"><a href="/gostd/crypto/tls/handshake_client.go.html#4501280">certVerify</a></span><span class="op" id="4502430">.</span><span class="ident" id="4502431"><a href="/gostd/crypto/tls/handshake_messages.go.html#4534853">signature</a></span>&nbsp;<span class="op" id="4502441">=</span>&nbsp;<span class="ident" id="4502443"><a href="/gostd/crypto/tls/handshake_client.go.html#4501264">signed</a></span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4502453"><a href="/gostd/crypto/tls/handshake_client.go.html#4495928">hs</a></span><span class="op" id="4502455">.</span><span class="ident" id="4502456"><a href="/gostd/crypto/tls/handshake_client.go.html#4490690">finishedHash</a></span><span class="op" id="4502468">.</span><span class="ident" id="4502469"><a href="/gostd/crypto/tls/prf.go.html#4575984">Write</a></span><span class="op" id="4502474">(</span><span class="ident" id="4502475"><a href="/gostd/crypto/tls/handshake_client.go.html#4501280">certVerify</a></span><span class="op" id="4502485">.</span><span class="ident" id="4502486"><a href="/gostd/crypto/tls/handshake_messages.go.html#4535298">marshal</a></span><span class="op" id="4502493">(</span><span class="op" id="4502494">)</span><span class="op" id="4502495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4502499"><a href="/gostd/crypto/tls/handshake_client.go.html#4495981">c</a></span><span class="op" id="4502500">.</span><span class="ident" id="4502501"><a href="/gostd/crypto/tls/conn.go.html#4481088">writeRecord</a></span><span class="op" id="4502512">(</span><span class="ident" id="4502513"><a href="/gostd/crypto/tls/common.go.html#4443022">recordTypeHandshake</a></span><span class="op" id="4502532">,</span>&nbsp;<span class="ident" id="4502534"><a href="/gostd/crypto/tls/handshake_client.go.html#4501280">certVerify</a></span><span class="op" id="4502544">.</span><span class="ident" id="4502545"><a href="/gostd/crypto/tls/handshake_messages.go.html#4535298">marshal</a></span><span class="op" id="4502552">(</span><span class="op" id="4502553">)</span><span class="op" id="4502554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4502557">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4502561"><a href="/gostd/crypto/tls/handshake_client.go.html#4495928">hs</a></span><span class="op" id="4502563">.</span><span class="ident" id="4502564"><a href="/gostd/crypto/tls/handshake_client.go.html#4490717">masterSecret</a></span>&nbsp;<span class="op" id="4502577">=</span>&nbsp;<span class="ident" id="4502579"><a href="/gostd/crypto/tls/prf.go.html#4574003">masterFromPreMasterSecret</a></span><span class="op" id="4502604">(</span><span class="ident" id="4502605"><a href="/gostd/crypto/tls/handshake_client.go.html#4495981">c</a></span><span class="op" id="4502606">.</span><span class="ident" id="4502607"><a href="/gostd/crypto/tls/conn.go.html#4462168">vers</a></span><span class="op" id="4502611">,</span>&nbsp;<span class="ident" id="4502613"><a href="/gostd/crypto/tls/handshake_client.go.html#4500956">preMasterSecret</a></span><span class="op" id="4502628">,</span>&nbsp;<span class="ident" id="4502630"><a href="/gostd/crypto/tls/handshake_client.go.html#4495928">hs</a></span><span class="op" id="4502632">.</span><span class="ident" id="4502633"><a href="/gostd/crypto/tls/handshake_client.go.html#4490633">hello</a></span><span class="op" id="4502638">.</span><span class="ident" id="4502639"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508347">random</a></span><span class="op" id="4502645">,</span>&nbsp;<span class="ident" id="4502647"><a href="/gostd/crypto/tls/handshake_client.go.html#4495928">hs</a></span><span class="op" id="4502649">.</span><span class="ident" id="4502650"><a href="/gostd/crypto/tls/handshake_client.go.html#4490603">serverHello</a></span><span class="op" id="4502661">.</span><span class="ident" id="4502662"><a href="/gostd/crypto/tls/handshake_messages.go.html#4519463">random</a></span><span class="op" id="4502668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4502671">return</span>&nbsp;<span class="builtintype" id="4502678">nil</span><br>
<span class="lineno"></span><span class="op" id="4502682">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4502685">func</span>&nbsp;<span class="op" id="4502690">(</span><span class="ident" id="4502691">hs</span>&nbsp;<span class="op" id="4502694">*</span><span class="ident" id="4502695"><a href="/gostd/crypto/tls/handshake_client.go.html#4490552">clientHandshakeState</a></span><span class="op" id="4502715">)</span>&nbsp;<span class="ident" id="4502717">establishKeys</span><span class="op" id="4502730">(</span><span class="op" id="4502731">)</span>&nbsp;<span class="builtintype" id="4502733">error</span>&nbsp;<span class="op" id="4502739">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4502742">c</span>&nbsp;<span class="op" id="4502744">:=</span>&nbsp;<span class="ident" id="4502747"><a href="/gostd/crypto/tls/handshake_client.go.html#4502691">hs</a></span><span class="op" id="4502749">.</span><span class="ident" id="4502750"><a href="/gostd/crypto/tls/handshake_client.go.html#4490583">c</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4502754">clientMAC</span><span class="op" id="4502763">,</span>&nbsp;<span class="ident" id="4502765">serverMAC</span><span class="op" id="4502774">,</span>&nbsp;<span class="ident" id="4502776">clientKey</span><span class="op" id="4502785">,</span>&nbsp;<span class="ident" id="4502787">serverKey</span><span class="op" id="4502796">,</span>&nbsp;<span class="ident" id="4502798">clientIV</span><span class="op" id="4502806">,</span>&nbsp;<span class="ident" id="4502808">serverIV</span>&nbsp;<span class="op" id="4502817">:=</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4502822"><a href="/gostd/crypto/tls/prf.go.html#4574572">keysFromMasterSecret</a></span><span class="op" id="4502842">(</span><span class="ident" id="4502843"><a href="/gostd/crypto/tls/handshake_client.go.html#4502742">c</a></span><span class="op" id="4502844">.</span><span class="ident" id="4502845"><a href="/gostd/crypto/tls/conn.go.html#4462168">vers</a></span><span class="op" id="4502849">,</span>&nbsp;<span class="ident" id="4502851"><a href="/gostd/crypto/tls/handshake_client.go.html#4502691">hs</a></span><span class="op" id="4502853">.</span><span class="ident" id="4502854"><a href="/gostd/crypto/tls/handshake_client.go.html#4490717">masterSecret</a></span><span class="op" id="4502866">,</span>&nbsp;<span class="ident" id="4502868"><a href="/gostd/crypto/tls/handshake_client.go.html#4502691">hs</a></span><span class="op" id="4502870">.</span><span class="ident" id="4502871"><a href="/gostd/crypto/tls/handshake_client.go.html#4490633">hello</a></span><span class="op" id="4502876">.</span><span class="ident" id="4502877"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508347">random</a></span><span class="op" id="4502883">,</span>&nbsp;<span class="ident" id="4502885"><a href="/gostd/crypto/tls/handshake_client.go.html#4502691">hs</a></span><span class="op" id="4502887">.</span><span class="ident" id="4502888"><a href="/gostd/crypto/tls/handshake_client.go.html#4490603">serverHello</a></span><span class="op" id="4502899">.</span><span class="ident" id="4502900"><a href="/gostd/crypto/tls/handshake_messages.go.html#4519463">random</a></span><span class="op" id="4502906">,</span>&nbsp;<span class="ident" id="4502908"><a href="/gostd/crypto/tls/handshake_client.go.html#4502691">hs</a></span><span class="op" id="4502910">.</span><span class="ident" id="4502911"><a href="/gostd/crypto/tls/handshake_client.go.html#4490663">suite</a></span><span class="op" id="4502916">.</span><span class="ident" id="4502917"><a href="/gostd/crypto/tls/cipher_suites.go.html#4434796">macLen</a></span><span class="op" id="4502923">,</span>&nbsp;<span class="ident" id="4502925"><a href="/gostd/crypto/tls/handshake_client.go.html#4502691">hs</a></span><span class="op" id="4502927">.</span><span class="ident" id="4502928"><a href="/gostd/crypto/tls/handshake_client.go.html#4490663">suite</a></span><span class="op" id="4502933">.</span><span class="ident" id="4502934"><a href="/gostd/crypto/tls/cipher_suites.go.html#4434784">keyLen</a></span><span class="op" id="4502940">,</span>&nbsp;<span class="ident" id="4502942"><a href="/gostd/crypto/tls/handshake_client.go.html#4502691">hs</a></span><span class="op" id="4502944">.</span><span class="ident" id="4502945"><a href="/gostd/crypto/tls/handshake_client.go.html#4490663">suite</a></span><span class="op" id="4502950">.</span><span class="ident" id="4502951"><a href="/gostd/crypto/tls/cipher_suites.go.html#4434808">ivLen</a></span><span class="op" id="4502956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4502959">var</span>&nbsp;<span class="ident" id="4502963">clientCipher</span><span class="op" id="4502975">,</span>&nbsp;<span class="ident" id="4502977">serverCipher</span>&nbsp;<span class="keyword" id="4502990">interface</span><span class="op" id="4502999">{</span><span class="op" id="4503000">}</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4503003">var</span>&nbsp;<span class="ident" id="4503007">clientHash</span><span class="op" id="4503017">,</span>&nbsp;<span class="ident" id="4503019">serverHash</span>&nbsp;<span class="ident" id="4503030"><a href="/gostd/crypto/tls/cipher_suites.go.html#4437372">macFunction</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4503043">if</span>&nbsp;<span class="ident" id="4503046"><a href="/gostd/crypto/tls/handshake_client.go.html#4502691">hs</a></span><span class="op" id="4503048">.</span><span class="ident" id="4503049"><a href="/gostd/crypto/tls/handshake_client.go.html#4490663">suite</a></span><span class="op" id="4503054">.</span><span class="ident" id="4503055"><a href="/gostd/crypto/tls/cipher_suites.go.html#4434926">cipher</a></span>&nbsp;<span class="op" id="4503062">!=</span>&nbsp;<span class="builtintype" id="4503065">nil</span>&nbsp;<span class="op" id="4503069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4503073"><a href="/gostd/crypto/tls/handshake_client.go.html#4502963">clientCipher</a></span>&nbsp;<span class="op" id="4503086">=</span>&nbsp;<span class="ident" id="4503088"><a href="/gostd/crypto/tls/handshake_client.go.html#4502691">hs</a></span><span class="op" id="4503090">.</span><span class="ident" id="4503091"><a href="/gostd/crypto/tls/handshake_client.go.html#4490663">suite</a></span><span class="op" id="4503096">.</span><span class="ident" id="4503097"><a href="/gostd/crypto/tls/cipher_suites.go.html#4434926">cipher</a></span><span class="op" id="4503103">(</span><span class="ident" id="4503104"><a href="/gostd/crypto/tls/handshake_client.go.html#4502776">clientKey</a></span><span class="op" id="4503113">,</span>&nbsp;<span class="ident" id="4503115"><a href="/gostd/crypto/tls/handshake_client.go.html#4502798">clientIV</a></span><span class="op" id="4503123">,</span>&nbsp;<span class="builtintype" id="4503125">false</span>&nbsp;<span class="comment" id="4503131">/*&nbsp;not&nbsp;for&nbsp;reading&nbsp;*/</span><span class="op" id="4503152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4503156"><a href="/gostd/crypto/tls/handshake_client.go.html#4503007">clientHash</a></span>&nbsp;<span class="op" id="4503167">=</span>&nbsp;<span class="ident" id="4503169"><a href="/gostd/crypto/tls/handshake_client.go.html#4502691">hs</a></span><span class="op" id="4503171">.</span><span class="ident" id="4503172"><a href="/gostd/crypto/tls/handshake_client.go.html#4490663">suite</a></span><span class="op" id="4503177">.</span><span class="ident" id="4503178"><a href="/gostd/crypto/tls/cipher_suites.go.html#4434980">mac</a></span><span class="op" id="4503181">(</span><span class="ident" id="4503182"><a href="/gostd/crypto/tls/handshake_client.go.html#4502742">c</a></span><span class="op" id="4503183">.</span><span class="ident" id="4503184"><a href="/gostd/crypto/tls/conn.go.html#4462168">vers</a></span><span class="op" id="4503188">,</span>&nbsp;<span class="ident" id="4503190"><a href="/gostd/crypto/tls/handshake_client.go.html#4502754">clientMAC</a></span><span class="op" id="4503199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4503203"><a href="/gostd/crypto/tls/handshake_client.go.html#4502977">serverCipher</a></span>&nbsp;<span class="op" id="4503216">=</span>&nbsp;<span class="ident" id="4503218"><a href="/gostd/crypto/tls/handshake_client.go.html#4502691">hs</a></span><span class="op" id="4503220">.</span><span class="ident" id="4503221"><a href="/gostd/crypto/tls/handshake_client.go.html#4490663">suite</a></span><span class="op" id="4503226">.</span><span class="ident" id="4503227"><a href="/gostd/crypto/tls/cipher_suites.go.html#4434926">cipher</a></span><span class="op" id="4503233">(</span><span class="ident" id="4503234"><a href="/gostd/crypto/tls/handshake_client.go.html#4502787">serverKey</a></span><span class="op" id="4503243">,</span>&nbsp;<span class="ident" id="4503245"><a href="/gostd/crypto/tls/handshake_client.go.html#4502808">serverIV</a></span><span class="op" id="4503253">,</span>&nbsp;<span class="builtintype" id="4503255">true</span>&nbsp;<span class="comment" id="4503260">/*&nbsp;for&nbsp;reading&nbsp;*/</span><span class="op" id="4503277">)</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4503281"><a href="/gostd/crypto/tls/handshake_client.go.html#4503019">serverHash</a></span>&nbsp;<span class="op" id="4503292">=</span>&nbsp;<span class="ident" id="4503294"><a href="/gostd/crypto/tls/handshake_client.go.html#4502691">hs</a></span><span class="op" id="4503296">.</span><span class="ident" id="4503297"><a href="/gostd/crypto/tls/handshake_client.go.html#4490663">suite</a></span><span class="op" id="4503302">.</span><span class="ident" id="4503303"><a href="/gostd/crypto/tls/cipher_suites.go.html#4434980">mac</a></span><span class="op" id="4503306">(</span><span class="ident" id="4503307"><a href="/gostd/crypto/tls/handshake_client.go.html#4502742">c</a></span><span class="op" id="4503308">.</span><span class="ident" id="4503309"><a href="/gostd/crypto/tls/conn.go.html#4462168">vers</a></span><span class="op" id="4503313">,</span>&nbsp;<span class="ident" id="4503315"><a href="/gostd/crypto/tls/handshake_client.go.html#4502765">serverMAC</a></span><span class="op" id="4503324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4503327">}</span>&nbsp;<span class="keyword" id="4503329">else</span>&nbsp;<span class="op" id="4503334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4503338"><a href="/gostd/crypto/tls/handshake_client.go.html#4502963">clientCipher</a></span>&nbsp;<span class="op" id="4503351">=</span>&nbsp;<span class="ident" id="4503353"><a href="/gostd/crypto/tls/handshake_client.go.html#4502691">hs</a></span><span class="op" id="4503355">.</span><span class="ident" id="4503356"><a href="/gostd/crypto/tls/handshake_client.go.html#4490663">suite</a></span><span class="op" id="4503361">.</span><span class="ident" id="4503362"><a href="/gostd/crypto/tls/cipher_suites.go.html#4435036">aead</a></span><span class="op" id="4503366">(</span><span class="ident" id="4503367"><a href="/gostd/crypto/tls/handshake_client.go.html#4502776">clientKey</a></span><span class="op" id="4503376">,</span>&nbsp;<span class="ident" id="4503378"><a href="/gostd/crypto/tls/handshake_client.go.html#4502798">clientIV</a></span><span class="op" id="4503386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4503390"><a href="/gostd/crypto/tls/handshake_client.go.html#4502977">serverCipher</a></span>&nbsp;<span class="op" id="4503403">=</span>&nbsp;<span class="ident" id="4503405"><a href="/gostd/crypto/tls/handshake_client.go.html#4502691">hs</a></span><span class="op" id="4503407">.</span><span class="ident" id="4503408"><a href="/gostd/crypto/tls/handshake_client.go.html#4490663">suite</a></span><span class="op" id="4503413">.</span><span class="ident" id="4503414"><a href="/gostd/crypto/tls/cipher_suites.go.html#4435036">aead</a></span><span class="op" id="4503418">(</span><span class="ident" id="4503419"><a href="/gostd/crypto/tls/handshake_client.go.html#4502787">serverKey</a></span><span class="op" id="4503428">,</span>&nbsp;<span class="ident" id="4503430"><a href="/gostd/crypto/tls/handshake_client.go.html#4502808">serverIV</a></span><span class="op" id="4503438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4503441">}</span><br>
<span class="lineno">480</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4503445"><a href="/gostd/crypto/tls/handshake_client.go.html#4502742">c</a></span><span class="op" id="4503446">.</span><span class="ident" id="4503447"><a href="/gostd/crypto/tls/conn.go.html#4463040">in</a></span><span class="op" id="4503449">.</span><span class="ident" id="4503450"><a href="/gostd/crypto/tls/conn.go.html#4465357">prepareCipherSpec</a></span><span class="op" id="4503467">(</span><span class="ident" id="4503468"><a href="/gostd/crypto/tls/handshake_client.go.html#4502742">c</a></span><span class="op" id="4503469">.</span><span class="ident" id="4503470"><a href="/gostd/crypto/tls/conn.go.html#4462168">vers</a></span><span class="op" id="4503474">,</span>&nbsp;<span class="ident" id="4503476"><a href="/gostd/crypto/tls/handshake_client.go.html#4502977">serverCipher</a></span><span class="op" id="4503488">,</span>&nbsp;<span class="ident" id="4503490"><a href="/gostd/crypto/tls/handshake_client.go.html#4503019">serverHash</a></span><span class="op" id="4503500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4503503"><a href="/gostd/crypto/tls/handshake_client.go.html#4502742">c</a></span><span class="op" id="4503504">.</span><span class="ident" id="4503505"><a href="/gostd/crypto/tls/conn.go.html#4463044">out</a></span><span class="op" id="4503508">.</span><span class="ident" id="4503509"><a href="/gostd/crypto/tls/conn.go.html#4465357">prepareCipherSpec</a></span><span class="op" id="4503526">(</span><span class="ident" id="4503527"><a href="/gostd/crypto/tls/handshake_client.go.html#4502742">c</a></span><span class="op" id="4503528">.</span><span class="ident" id="4503529"><a href="/gostd/crypto/tls/conn.go.html#4462168">vers</a></span><span class="op" id="4503533">,</span>&nbsp;<span class="ident" id="4503535"><a href="/gostd/crypto/tls/handshake_client.go.html#4502963">clientCipher</a></span><span class="op" id="4503547">,</span>&nbsp;<span class="ident" id="4503549"><a href="/gostd/crypto/tls/handshake_client.go.html#4503007">clientHash</a></span><span class="op" id="4503559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4503562">return</span>&nbsp;<span class="builtintype" id="4503569">nil</span><br>
<span class="lineno"></span><span class="op" id="4503573">}</span><br>
<span class="lineno">485</span><br>
<span class="lineno"></span><span class="keyword" id="4503576">func</span>&nbsp;<span class="op" id="4503581">(</span><span class="ident" id="4503582">hs</span>&nbsp;<span class="op" id="4503585">*</span><span class="ident" id="4503586"><a href="/gostd/crypto/tls/handshake_client.go.html#4490552">clientHandshakeState</a></span><span class="op" id="4503606">)</span>&nbsp;<span class="ident" id="4503608">serverResumedSession</span><span class="op" id="4503628">(</span><span class="op" id="4503629">)</span>&nbsp;<span class="builtintype" id="4503631">bool</span>&nbsp;<span class="op" id="4503636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4503639">//&nbsp;If&nbsp;the&nbsp;server&nbsp;responded&nbsp;with&nbsp;the&nbsp;same&nbsp;sessionId&nbsp;then&nbsp;it&nbsp;means&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4503709">//&nbsp;sessionTicket&nbsp;is&nbsp;being&nbsp;used&nbsp;to&nbsp;resume&nbsp;a&nbsp;TLS&nbsp;session.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4503766">return</span>&nbsp;<span class="ident" id="4503773"><a href="/gostd/crypto/tls/handshake_client.go.html#4503582">hs</a></span><span class="op" id="4503775">.</span><span class="ident" id="4503776"><a href="/gostd/crypto/tls/handshake_client.go.html#4490738">session</a></span>&nbsp;<span class="op" id="4503784">!=</span>&nbsp;<span class="builtintype" id="4503787">nil</span>&nbsp;<span class="op" id="4503791">&amp;&amp;</span>&nbsp;<span class="ident" id="4503794"><a href="/gostd/crypto/tls/handshake_client.go.html#4503582">hs</a></span><span class="op" id="4503796">.</span><span class="ident" id="4503797"><a href="/gostd/crypto/tls/handshake_client.go.html#4490633">hello</a></span><span class="op" id="4503802">.</span><span class="ident" id="4503803"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508375">sessionId</a></span>&nbsp;<span class="op" id="4503813">!=</span>&nbsp;<span class="builtintype" id="4503816">nil</span>&nbsp;<span class="op" id="4503820">&amp;&amp;</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4503825"><a href="/gostd/crypto/tls/handshake_client.go.html#4490423">bytes</a></span><span class="op" id="4503830">.</span><span class="ident" id="4503831"><a href="/gostd/bytes/bytes_decl.go.html#1414806">Equal</a></span><span class="op" id="4503836">(</span><span class="ident" id="4503837"><a href="/gostd/crypto/tls/handshake_client.go.html#4503582">hs</a></span><span class="op" id="4503839">.</span><span class="ident" id="4503840"><a href="/gostd/crypto/tls/handshake_client.go.html#4490603">serverHello</a></span><span class="op" id="4503851">.</span><span class="ident" id="4503852"><a href="/gostd/crypto/tls/handshake_messages.go.html#4519491">sessionId</a></span><span class="op" id="4503861">,</span>&nbsp;<span class="ident" id="4503863"><a href="/gostd/crypto/tls/handshake_client.go.html#4503582">hs</a></span><span class="op" id="4503865">.</span><span class="ident" id="4503866"><a href="/gostd/crypto/tls/handshake_client.go.html#4490633">hello</a></span><span class="op" id="4503871">.</span><span class="ident" id="4503872"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508375">sessionId</a></span><span class="op" id="4503881">)</span><br>
<span class="lineno"></span><span class="op" id="4503883">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4503886">func</span>&nbsp;<span class="op" id="4503891">(</span><span class="ident" id="4503892">hs</span>&nbsp;<span class="op" id="4503895">*</span><span class="ident" id="4503896"><a href="/gostd/crypto/tls/handshake_client.go.html#4490552">clientHandshakeState</a></span><span class="op" id="4503916">)</span>&nbsp;<span class="ident" id="4503918">processServerHello</span><span class="op" id="4503936">(</span><span class="op" id="4503937">)</span>&nbsp;<span class="op" id="4503939">(</span><span class="builtintype" id="4503940">bool</span><span class="op" id="4503944">,</span>&nbsp;<span class="builtintype" id="4503946">error</span><span class="op" id="4503951">)</span>&nbsp;<span class="op" id="4503953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4503956">c</span>&nbsp;<span class="op" id="4503958">:=</span>&nbsp;<span class="ident" id="4503961"><a href="/gostd/crypto/tls/handshake_client.go.html#4503892">hs</a></span><span class="op" id="4503963">.</span><span class="ident" id="4503964"><a href="/gostd/crypto/tls/handshake_client.go.html#4490583">c</a></span><br>
<span class="lineno">495</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4503968">if</span>&nbsp;<span class="ident" id="4503971"><a href="/gostd/crypto/tls/handshake_client.go.html#4503892">hs</a></span><span class="op" id="4503973">.</span><span class="ident" id="4503974"><a href="/gostd/crypto/tls/handshake_client.go.html#4490603">serverHello</a></span><span class="op" id="4503985">.</span><span class="ident" id="4503986"><a href="/gostd/crypto/tls/handshake_messages.go.html#4519547">compressionMethod</a></span>&nbsp;<span class="op" id="4504004">!=</span>&nbsp;<span class="ident" id="4504007"><a href="/gostd/crypto/tls/common.go.html#4443628">compressionNone</a></span>&nbsp;<span class="op" id="4504023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4504027"><a href="/gostd/crypto/tls/handshake_client.go.html#4503956">c</a></span><span class="op" id="4504028">.</span><span class="ident" id="4504029"><a href="/gostd/crypto/tls/conn.go.html#4480829">sendAlert</a></span><span class="op" id="4504038">(</span><span class="ident" id="4504039"><a href="/gostd/crypto/tls/alert.go.html#4430296">alertUnexpectedMessage</a></span><span class="op" id="4504061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4504065">return</span>&nbsp;<span class="builtintype" id="4504072">false</span><span class="op" id="4504077">,</span>&nbsp;<span class="ident" id="4504079"><a href="/gostd/crypto/tls/handshake_client.go.html#4490504">errors</a></span><span class="op" id="4504085">.</span><span class="ident" id="4504086"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4504089">(</span><span class="string" id="4504090">&#34;tls:&nbsp;server&nbsp;selected&nbsp;unsupported&nbsp;compression&nbsp;format&#34;</span><span class="op" id="4504143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4504146">}</span><br>
<span class="lineno">500</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4504150">clientDidNPN</span>&nbsp;<span class="op" id="4504163">:=</span>&nbsp;<span class="ident" id="4504166"><a href="/gostd/crypto/tls/handshake_client.go.html#4503892">hs</a></span><span class="op" id="4504168">.</span><span class="ident" id="4504169"><a href="/gostd/crypto/tls/handshake_client.go.html#4490633">hello</a></span><span class="op" id="4504174">.</span><span class="ident" id="4504175"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508462">nextProtoNeg</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4504189">clientDidALPN</span>&nbsp;<span class="op" id="4504203">:=</span>&nbsp;<span class="builtinfunc" id="4504206">len</span><span class="op" id="4504209">(</span><span class="ident" id="4504210"><a href="/gostd/crypto/tls/handshake_client.go.html#4503892">hs</a></span><span class="op" id="4504212">.</span><span class="ident" id="4504213"><a href="/gostd/crypto/tls/handshake_client.go.html#4490633">hello</a></span><span class="op" id="4504218">.</span><span class="ident" id="4504219"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508723">alpnProtocols</a></span><span class="op" id="4504232">)</span>&nbsp;<span class="op" id="4504234">&gt;</span>&nbsp;<span class="num" id="4504236">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4504239">serverHasNPN</span>&nbsp;<span class="op" id="4504252">:=</span>&nbsp;<span class="ident" id="4504255"><a href="/gostd/crypto/tls/handshake_client.go.html#4503892">hs</a></span><span class="op" id="4504257">.</span><span class="ident" id="4504258"><a href="/gostd/crypto/tls/handshake_client.go.html#4490603">serverHello</a></span><span class="op" id="4504269">.</span><span class="ident" id="4504270"><a href="/gostd/crypto/tls/handshake_messages.go.html#4519574">nextProtoNeg</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4504284">serverHasALPN</span>&nbsp;<span class="op" id="4504298">:=</span>&nbsp;<span class="builtinfunc" id="4504301">len</span><span class="op" id="4504304">(</span><span class="ident" id="4504305"><a href="/gostd/crypto/tls/handshake_client.go.html#4503892">hs</a></span><span class="op" id="4504307">.</span><span class="ident" id="4504308"><a href="/gostd/crypto/tls/handshake_client.go.html#4490603">serverHello</a></span><span class="op" id="4504319">.</span><span class="ident" id="4504320"><a href="/gostd/crypto/tls/handshake_messages.go.html#4519708">alpnProtocol</a></span><span class="op" id="4504332">)</span>&nbsp;<span class="op" id="4504334">&gt;</span>&nbsp;<span class="num" id="4504336">0</span><br>
<span class="lineno">505</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4504340">if</span>&nbsp;<span class="op" id="4504343">!</span><span class="ident" id="4504344"><a href="/gostd/crypto/tls/handshake_client.go.html#4504150">clientDidNPN</a></span>&nbsp;<span class="op" id="4504357">&amp;&amp;</span>&nbsp;<span class="ident" id="4504360"><a href="/gostd/crypto/tls/handshake_client.go.html#4504239">serverHasNPN</a></span>&nbsp;<span class="op" id="4504373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4504377"><a href="/gostd/crypto/tls/handshake_client.go.html#4503956">c</a></span><span class="op" id="4504378">.</span><span class="ident" id="4504379"><a href="/gostd/crypto/tls/conn.go.html#4480829">sendAlert</a></span><span class="op" id="4504388">(</span><span class="ident" id="4504389"><a href="/gostd/crypto/tls/alert.go.html#4430496">alertHandshakeFailure</a></span><span class="op" id="4504410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4504414">return</span>&nbsp;<span class="builtintype" id="4504421">false</span><span class="op" id="4504426">,</span>&nbsp;<span class="ident" id="4504428"><a href="/gostd/crypto/tls/handshake_client.go.html#4490504">errors</a></span><span class="op" id="4504434">.</span><span class="ident" id="4504435"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4504438">(</span><span class="string" id="4504439">&#34;server&nbsp;advertised&nbsp;unrequested&nbsp;NPN&nbsp;extension&#34;</span><span class="op" id="4504484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4504487">}</span><br>
<span class="lineno">510</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4504491">if</span>&nbsp;<span class="op" id="4504494">!</span><span class="ident" id="4504495"><a href="/gostd/crypto/tls/handshake_client.go.html#4504189">clientDidALPN</a></span>&nbsp;<span class="op" id="4504509">&amp;&amp;</span>&nbsp;<span class="ident" id="4504512"><a href="/gostd/crypto/tls/handshake_client.go.html#4504284">serverHasALPN</a></span>&nbsp;<span class="op" id="4504526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4504530"><a href="/gostd/crypto/tls/handshake_client.go.html#4503956">c</a></span><span class="op" id="4504531">.</span><span class="ident" id="4504532"><a href="/gostd/crypto/tls/conn.go.html#4480829">sendAlert</a></span><span class="op" id="4504541">(</span><span class="ident" id="4504542"><a href="/gostd/crypto/tls/alert.go.html#4430496">alertHandshakeFailure</a></span><span class="op" id="4504563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4504567">return</span>&nbsp;<span class="builtintype" id="4504574">false</span><span class="op" id="4504579">,</span>&nbsp;<span class="ident" id="4504581"><a href="/gostd/crypto/tls/handshake_client.go.html#4490504">errors</a></span><span class="op" id="4504587">.</span><span class="ident" id="4504588"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4504591">(</span><span class="string" id="4504592">&#34;server&nbsp;advertised&nbsp;unrequested&nbsp;ALPN&nbsp;extension&#34;</span><span class="op" id="4504638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4504641">}</span><br>
<span class="lineno">515</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4504645">if</span>&nbsp;<span class="ident" id="4504648"><a href="/gostd/crypto/tls/handshake_client.go.html#4504239">serverHasNPN</a></span>&nbsp;<span class="op" id="4504661">&amp;&amp;</span>&nbsp;<span class="ident" id="4504664"><a href="/gostd/crypto/tls/handshake_client.go.html#4504284">serverHasALPN</a></span>&nbsp;<span class="op" id="4504678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4504682"><a href="/gostd/crypto/tls/handshake_client.go.html#4503956">c</a></span><span class="op" id="4504683">.</span><span class="ident" id="4504684"><a href="/gostd/crypto/tls/conn.go.html#4480829">sendAlert</a></span><span class="op" id="4504693">(</span><span class="ident" id="4504694"><a href="/gostd/crypto/tls/alert.go.html#4430496">alertHandshakeFailure</a></span><span class="op" id="4504715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4504719">return</span>&nbsp;<span class="builtintype" id="4504726">false</span><span class="op" id="4504731">,</span>&nbsp;<span class="ident" id="4504733"><a href="/gostd/crypto/tls/handshake_client.go.html#4490504">errors</a></span><span class="op" id="4504739">.</span><span class="ident" id="4504740"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4504743">(</span><span class="string" id="4504744">&#34;server&nbsp;advertised&nbsp;both&nbsp;NPN&nbsp;and&nbsp;ALPN&nbsp;extensions&#34;</span><span class="op" id="4504792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4504795">}</span><br>
<span class="lineno">520</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4504799">if</span>&nbsp;<span class="ident" id="4504802"><a href="/gostd/crypto/tls/handshake_client.go.html#4504284">serverHasALPN</a></span>&nbsp;<span class="op" id="4504816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4504820"><a href="/gostd/crypto/tls/handshake_client.go.html#4503956">c</a></span><span class="op" id="4504821">.</span><span class="ident" id="4504822"><a href="/gostd/crypto/tls/conn.go.html#4462962">clientProtocol</a></span>&nbsp;<span class="op" id="4504837">=</span>&nbsp;<span class="ident" id="4504839"><a href="/gostd/crypto/tls/handshake_client.go.html#4503892">hs</a></span><span class="op" id="4504841">.</span><span class="ident" id="4504842"><a href="/gostd/crypto/tls/handshake_client.go.html#4490603">serverHello</a></span><span class="op" id="4504853">.</span><span class="ident" id="4504854"><a href="/gostd/crypto/tls/handshake_messages.go.html#4519708">alpnProtocol</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4504869"><a href="/gostd/crypto/tls/handshake_client.go.html#4503956">c</a></span><span class="op" id="4504870">.</span><span class="ident" id="4504871"><a href="/gostd/crypto/tls/conn.go.html#4462993">clientProtocolFallback</a></span>&nbsp;<span class="op" id="4504894">=</span>&nbsp;<span class="builtintype" id="4504896">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4504903">}</span><br>
<span class="lineno">525</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4504907">if</span>&nbsp;<span class="ident" id="4504910"><a href="/gostd/crypto/tls/handshake_client.go.html#4503892">hs</a></span><span class="op" id="4504912">.</span><span class="ident" id="4504913"><a href="/gostd/crypto/tls/handshake_client.go.html#4503608">serverResumedSession</a></span><span class="op" id="4504933">(</span><span class="op" id="4504934">)</span>&nbsp;<span class="op" id="4504936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4504940">//&nbsp;Restore&nbsp;masterSecret&nbsp;and&nbsp;peerCerts&nbsp;from&nbsp;previous&nbsp;state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4505000"><a href="/gostd/crypto/tls/handshake_client.go.html#4503892">hs</a></span><span class="op" id="4505002">.</span><span class="ident" id="4505003"><a href="/gostd/crypto/tls/handshake_client.go.html#4490717">masterSecret</a></span>&nbsp;<span class="op" id="4505016">=</span>&nbsp;<span class="ident" id="4505018"><a href="/gostd/crypto/tls/handshake_client.go.html#4503892">hs</a></span><span class="op" id="4505020">.</span><span class="ident" id="4505021"><a href="/gostd/crypto/tls/handshake_client.go.html#4490738">session</a></span><span class="op" id="4505028">.</span><span class="ident" id="4505029"><a href="/gostd/crypto/tls/common.go.html#4448456">masterSecret</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4505044"><a href="/gostd/crypto/tls/handshake_client.go.html#4503956">c</a></span><span class="op" id="4505045">.</span><span class="ident" id="4505046"><a href="/gostd/crypto/tls/conn.go.html#4462520">peerCertificates</a></span>&nbsp;<span class="op" id="4505063">=</span>&nbsp;<span class="ident" id="4505065"><a href="/gostd/crypto/tls/handshake_client.go.html#4503892">hs</a></span><span class="op" id="4505067">.</span><span class="ident" id="4505068"><a href="/gostd/crypto/tls/handshake_client.go.html#4490738">session</a></span><span class="op" id="4505075">.</span><span class="ident" id="4505076"><a href="/gostd/crypto/tls/common.go.html#4448552">serverCertificates</a></span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4505097">return</span>&nbsp;<span class="builtintype" id="4505104">true</span><span class="op" id="4505108">,</span>&nbsp;<span class="builtintype" id="4505110">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4505115">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4505118">return</span>&nbsp;<span class="builtintype" id="4505125">false</span><span class="op" id="4505130">,</span>&nbsp;<span class="builtintype" id="4505132">nil</span><br>
<span class="lineno"></span><span class="op" id="4505136">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span><span class="keyword" id="4505139">func</span>&nbsp;<span class="op" id="4505144">(</span><span class="ident" id="4505145">hs</span>&nbsp;<span class="op" id="4505148">*</span><span class="ident" id="4505149"><a href="/gostd/crypto/tls/handshake_client.go.html#4490552">clientHandshakeState</a></span><span class="op" id="4505169">)</span>&nbsp;<span class="ident" id="4505171">readFinished</span><span class="op" id="4505183">(</span><span class="ident" id="4505184">out</span>&nbsp;<span class="op" id="4505188">[</span><span class="op" id="4505189">]</span><span class="builtintype" id="4505190">byte</span><span class="op" id="4505194">)</span>&nbsp;<span class="builtintype" id="4505196">error</span>&nbsp;<span class="op" id="4505202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4505205">c</span>&nbsp;<span class="op" id="4505207">:=</span>&nbsp;<span class="ident" id="4505210"><a href="/gostd/crypto/tls/handshake_client.go.html#4505145">hs</a></span><span class="op" id="4505212">.</span><span class="ident" id="4505213"><a href="/gostd/crypto/tls/handshake_client.go.html#4490583">c</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4505217"><a href="/gostd/crypto/tls/handshake_client.go.html#4505205">c</a></span><span class="op" id="4505218">.</span><span class="ident" id="4505219"><a href="/gostd/crypto/tls/conn.go.html#4475709">readRecord</a></span><span class="op" id="4505229">(</span><span class="ident" id="4505230"><a href="/gostd/crypto/tls/common.go.html#4442934">recordTypeChangeCipherSpec</a></span><span class="op" id="4505256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4505259">if</span>&nbsp;<span class="ident" id="4505262">err</span>&nbsp;<span class="op" id="4505266">:=</span>&nbsp;<span class="ident" id="4505269"><a href="/gostd/crypto/tls/handshake_client.go.html#4505205">c</a></span><span class="op" id="4505270">.</span><span class="ident" id="4505271"><a href="/gostd/crypto/tls/conn.go.html#4463040">in</a></span><span class="op" id="4505273">.</span><span class="builtintype" id="4505274"><a href="/gostd/crypto/tls/conn.go.html#4465163">error</a></span><span class="op" id="4505279">(</span><span class="op" id="4505280">)</span><span class="op" id="4505281">;</span>&nbsp;<span class="ident" id="4505283"><a href="/gostd/crypto/tls/handshake_client.go.html#4505262">err</a></span>&nbsp;<span class="op" id="4505287">!=</span>&nbsp;<span class="builtintype" id="4505290">nil</span>&nbsp;<span class="op" id="4505294">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4505298">return</span>&nbsp;<span class="ident" id="4505305"><a href="/gostd/crypto/tls/handshake_client.go.html#4505262">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4505310">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4505314">msg</span><span class="op" id="4505317">,</span>&nbsp;<span class="ident" id="4505319">err</span>&nbsp;<span class="op" id="4505323">:=</span>&nbsp;<span class="ident" id="4505326"><a href="/gostd/crypto/tls/handshake_client.go.html#4505205">c</a></span><span class="op" id="4505327">.</span><span class="ident" id="4505328"><a href="/gostd/crypto/tls/conn.go.html#4483177">readHandshake</a></span><span class="op" id="4505341">(</span><span class="op" id="4505342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4505345">if</span>&nbsp;<span class="ident" id="4505348"><a href="/gostd/crypto/tls/handshake_client.go.html#4505319">err</a></span>&nbsp;<span class="op" id="4505352">!=</span>&nbsp;<span class="builtintype" id="4505355">nil</span>&nbsp;<span class="op" id="4505359">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4505363">return</span>&nbsp;<span class="ident" id="4505370"><a href="/gostd/crypto/tls/handshake_client.go.html#4505319">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4505375">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4505378">serverFinished</span><span class="op" id="4505392">,</span>&nbsp;<span class="ident" id="4505394">ok</span>&nbsp;<span class="op" id="4505397">:=</span>&nbsp;<span class="ident" id="4505400"><a href="/gostd/crypto/tls/handshake_client.go.html#4505314">msg</a></span><span class="op" id="4505403">.</span><span class="op" id="4505404">(</span><span class="op" id="4505405">*</span><span class="ident" id="4505406"><a href="/gostd/crypto/tls/handshake_messages.go.html#4529593">finishedMsg</a></span><span class="op" id="4505417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4505420">if</span>&nbsp;<span class="op" id="4505423">!</span><span class="ident" id="4505424"><a href="/gostd/crypto/tls/handshake_client.go.html#4505394">ok</a></span>&nbsp;<span class="op" id="4505427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4505431"><a href="/gostd/crypto/tls/handshake_client.go.html#4505205">c</a></span><span class="op" id="4505432">.</span><span class="ident" id="4505433"><a href="/gostd/crypto/tls/conn.go.html#4480829">sendAlert</a></span><span class="op" id="4505442">(</span><span class="ident" id="4505443"><a href="/gostd/crypto/tls/alert.go.html#4430296">alertUnexpectedMessage</a></span><span class="op" id="4505465">)</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4505469">return</span>&nbsp;<span class="ident" id="4505476"><a href="/gostd/crypto/tls/common.go.html#4461311">unexpectedMessageError</a></span><span class="op" id="4505498">(</span><span class="ident" id="4505499"><a href="/gostd/crypto/tls/handshake_client.go.html#4505378">serverFinished</a></span><span class="op" id="4505513">,</span>&nbsp;<span class="ident" id="4505515"><a href="/gostd/crypto/tls/handshake_client.go.html#4505314">msg</a></span><span class="op" id="4505518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4505521">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4505525">verify</span>&nbsp;<span class="op" id="4505532">:=</span>&nbsp;<span class="ident" id="4505535"><a href="/gostd/crypto/tls/handshake_client.go.html#4505145">hs</a></span><span class="op" id="4505537">.</span><span class="ident" id="4505538"><a href="/gostd/crypto/tls/handshake_client.go.html#4490690">finishedHash</a></span><span class="op" id="4505550">.</span><span class="ident" id="4505551"><a href="/gostd/crypto/tls/prf.go.html#4577855">serverSum</a></span><span class="op" id="4505560">(</span><span class="ident" id="4505561"><a href="/gostd/crypto/tls/handshake_client.go.html#4505145">hs</a></span><span class="op" id="4505563">.</span><span class="ident" id="4505564"><a href="/gostd/crypto/tls/handshake_client.go.html#4490717">masterSecret</a></span><span class="op" id="4505576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4505579">if</span>&nbsp;<span class="builtinfunc" id="4505582">len</span><span class="op" id="4505585">(</span><span class="ident" id="4505586"><a href="/gostd/crypto/tls/handshake_client.go.html#4505525">verify</a></span><span class="op" id="4505592">)</span>&nbsp;<span class="op" id="4505594">!=</span>&nbsp;<span class="builtinfunc" id="4505597">len</span><span class="op" id="4505600">(</span><span class="ident" id="4505601"><a href="/gostd/crypto/tls/handshake_client.go.html#4505378">serverFinished</a></span><span class="op" id="4505615">.</span><span class="ident" id="4505616"><a href="/gostd/crypto/tls/handshake_messages.go.html#4529634">verifyData</a></span><span class="op" id="4505626">)</span>&nbsp;<span class="op" id="4505628">||</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4505633"><a href="/gostd/crypto/tls/handshake_client.go.html#4490472">subtle</a></span><span class="op" id="4505639">.</span><span class="ident" id="4505640"><a href="/gostd/crypto/subtle/constant_time.go.html#4428560">ConstantTimeCompare</a></span><span class="op" id="4505659">(</span><span class="ident" id="4505660"><a href="/gostd/crypto/tls/handshake_client.go.html#4505525">verify</a></span><span class="op" id="4505666">,</span>&nbsp;<span class="ident" id="4505668"><a href="/gostd/crypto/tls/handshake_client.go.html#4505378">serverFinished</a></span><span class="op" id="4505682">.</span><span class="ident" id="4505683"><a href="/gostd/crypto/tls/handshake_messages.go.html#4529634">verifyData</a></span><span class="op" id="4505693">)</span>&nbsp;<span class="op" id="4505695">!=</span>&nbsp;<span class="num" id="4505698">1</span>&nbsp;<span class="op" id="4505700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4505704"><a href="/gostd/crypto/tls/handshake_client.go.html#4505205">c</a></span><span class="op" id="4505705">.</span><span class="ident" id="4505706"><a href="/gostd/crypto/tls/conn.go.html#4480829">sendAlert</a></span><span class="op" id="4505715">(</span><span class="ident" id="4505716"><a href="/gostd/crypto/tls/alert.go.html#4430496">alertHandshakeFailure</a></span><span class="op" id="4505737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4505741">return</span>&nbsp;<span class="ident" id="4505748"><a href="/gostd/crypto/tls/handshake_client.go.html#4490504">errors</a></span><span class="op" id="4505754">.</span><span class="ident" id="4505755"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4505758">(</span><span class="string" id="4505759">&#34;tls:&nbsp;server&#39;s&nbsp;Finished&nbsp;message&nbsp;was&nbsp;incorrect&#34;</span><span class="op" id="4505805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4505808">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4505811"><a href="/gostd/crypto/tls/handshake_client.go.html#4505145">hs</a></span><span class="op" id="4505813">.</span><span class="ident" id="4505814"><a href="/gostd/crypto/tls/handshake_client.go.html#4490690">finishedHash</a></span><span class="op" id="4505826">.</span><span class="ident" id="4505827"><a href="/gostd/crypto/tls/prf.go.html#4575984">Write</a></span><span class="op" id="4505832">(</span><span class="ident" id="4505833"><a href="/gostd/crypto/tls/handshake_client.go.html#4505378">serverFinished</a></span><span class="op" id="4505847">.</span><span class="ident" id="4505848"><a href="/gostd/crypto/tls/handshake_messages.go.html#4529868">marshal</a></span><span class="op" id="4505855">(</span><span class="op" id="4505856">)</span><span class="op" id="4505857">)</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4505860">copy</span><span class="op" id="4505864">(</span><span class="ident" id="4505865"><a href="/gostd/crypto/tls/handshake_client.go.html#4505184">out</a></span><span class="op" id="4505868">,</span>&nbsp;<span class="ident" id="4505870"><a href="/gostd/crypto/tls/handshake_client.go.html#4505525">verify</a></span><span class="op" id="4505876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4505879">return</span>&nbsp;<span class="builtintype" id="4505886">nil</span><br>
<span class="lineno"></span><span class="op" id="4505890">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4505893">func</span>&nbsp;<span class="op" id="4505898">(</span><span class="ident" id="4505899">hs</span>&nbsp;<span class="op" id="4505902">*</span><span class="ident" id="4505903"><a href="/gostd/crypto/tls/handshake_client.go.html#4490552">clientHandshakeState</a></span><span class="op" id="4505923">)</span>&nbsp;<span class="ident" id="4505925">readSessionTicket</span><span class="op" id="4505942">(</span><span class="op" id="4505943">)</span>&nbsp;<span class="builtintype" id="4505945">error</span>&nbsp;<span class="op" id="4505951">{</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4505954">if</span>&nbsp;<span class="op" id="4505957">!</span><span class="ident" id="4505958"><a href="/gostd/crypto/tls/handshake_client.go.html#4505899">hs</a></span><span class="op" id="4505960">.</span><span class="ident" id="4505961"><a href="/gostd/crypto/tls/handshake_client.go.html#4490603">serverHello</a></span><span class="op" id="4505972">.</span><span class="ident" id="4505973"><a href="/gostd/crypto/tls/handshake_messages.go.html#4519656">ticketSupported</a></span>&nbsp;<span class="op" id="4505989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4505993">return</span>&nbsp;<span class="builtintype" id="4506000">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4506005">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4506009">c</span>&nbsp;<span class="op" id="4506011">:=</span>&nbsp;<span class="ident" id="4506014"><a href="/gostd/crypto/tls/handshake_client.go.html#4505899">hs</a></span><span class="op" id="4506016">.</span><span class="ident" id="4506017"><a href="/gostd/crypto/tls/handshake_client.go.html#4490583">c</a></span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4506020">msg</span><span class="op" id="4506023">,</span>&nbsp;<span class="ident" id="4506025">err</span>&nbsp;<span class="op" id="4506029">:=</span>&nbsp;<span class="ident" id="4506032"><a href="/gostd/crypto/tls/handshake_client.go.html#4506009">c</a></span><span class="op" id="4506033">.</span><span class="ident" id="4506034"><a href="/gostd/crypto/tls/conn.go.html#4483177">readHandshake</a></span><span class="op" id="4506047">(</span><span class="op" id="4506048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4506051">if</span>&nbsp;<span class="ident" id="4506054"><a href="/gostd/crypto/tls/handshake_client.go.html#4506025">err</a></span>&nbsp;<span class="op" id="4506058">!=</span>&nbsp;<span class="builtintype" id="4506061">nil</span>&nbsp;<span class="op" id="4506065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4506069">return</span>&nbsp;<span class="ident" id="4506076"><a href="/gostd/crypto/tls/handshake_client.go.html#4506025">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4506081">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4506084">sessionTicketMsg</span><span class="op" id="4506100">,</span>&nbsp;<span class="ident" id="4506102">ok</span>&nbsp;<span class="op" id="4506105">:=</span>&nbsp;<span class="ident" id="4506108"><a href="/gostd/crypto/tls/handshake_client.go.html#4506020">msg</a></span><span class="op" id="4506111">.</span><span class="op" id="4506112">(</span><span class="op" id="4506113">*</span><span class="ident" id="4506114"><a href="/gostd/crypto/tls/handshake_messages.go.html#4536457">newSessionTicketMsg</a></span><span class="op" id="4506133">)</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4506136">if</span>&nbsp;<span class="op" id="4506139">!</span><span class="ident" id="4506140"><a href="/gostd/crypto/tls/handshake_client.go.html#4506102">ok</a></span>&nbsp;<span class="op" id="4506143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4506147"><a href="/gostd/crypto/tls/handshake_client.go.html#4506009">c</a></span><span class="op" id="4506148">.</span><span class="ident" id="4506149"><a href="/gostd/crypto/tls/conn.go.html#4480829">sendAlert</a></span><span class="op" id="4506158">(</span><span class="ident" id="4506159"><a href="/gostd/crypto/tls/alert.go.html#4430296">alertUnexpectedMessage</a></span><span class="op" id="4506181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4506185">return</span>&nbsp;<span class="ident" id="4506192"><a href="/gostd/crypto/tls/common.go.html#4461311">unexpectedMessageError</a></span><span class="op" id="4506214">(</span><span class="ident" id="4506215"><a href="/gostd/crypto/tls/handshake_client.go.html#4506084">sessionTicketMsg</a></span><span class="op" id="4506231">,</span>&nbsp;<span class="ident" id="4506233"><a href="/gostd/crypto/tls/handshake_client.go.html#4506020">msg</a></span><span class="op" id="4506236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4506239">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4506242"><a href="/gostd/crypto/tls/handshake_client.go.html#4505899">hs</a></span><span class="op" id="4506244">.</span><span class="ident" id="4506245"><a href="/gostd/crypto/tls/handshake_client.go.html#4490690">finishedHash</a></span><span class="op" id="4506257">.</span><span class="ident" id="4506258"><a href="/gostd/crypto/tls/prf.go.html#4575984">Write</a></span><span class="op" id="4506263">(</span><span class="ident" id="4506264"><a href="/gostd/crypto/tls/handshake_client.go.html#4506084">sessionTicketMsg</a></span><span class="op" id="4506280">.</span><span class="ident" id="4506281"><a href="/gostd/crypto/tls/handshake_messages.go.html#4536748">marshal</a></span><span class="op" id="4506288">(</span><span class="op" id="4506289">)</span><span class="op" id="4506290">)</span><br>
<span class="lineno">580</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4506294"><a href="/gostd/crypto/tls/handshake_client.go.html#4505899">hs</a></span><span class="op" id="4506296">.</span><span class="ident" id="4506297"><a href="/gostd/crypto/tls/handshake_client.go.html#4490738">session</a></span>&nbsp;<span class="op" id="4506305">=</span>&nbsp;<span class="op" id="4506307">&amp;</span><span class="ident" id="4506308"><a href="/gostd/crypto/tls/common.go.html#4448159">ClientSessionState</a></span><span class="op" id="4506326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4506330"><a href="/gostd/crypto/tls/common.go.html#4448188">sessionTicket</a></span><span class="op" id="4506343">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4506350"><a href="/gostd/crypto/tls/handshake_client.go.html#4506084">sessionTicketMsg</a></span><span class="op" id="4506366">.</span><span class="ident" id="4506367"><a href="/gostd/crypto/tls/handshake_messages.go.html#4536502">ticket</a></span><span class="op" id="4506373">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4506377"><a href="/gostd/crypto/tls/common.go.html#4448288">vers</a></span><span class="op" id="4506381">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4506397"><a href="/gostd/crypto/tls/handshake_client.go.html#4506009">c</a></span><span class="op" id="4506398">.</span><span class="ident" id="4506399"><a href="/gostd/crypto/tls/conn.go.html#4462168">vers</a></span><span class="op" id="4506403">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4506407"><a href="/gostd/crypto/tls/common.go.html#4448374">cipherSuite</a></span><span class="op" id="4506418">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4506427"><a href="/gostd/crypto/tls/handshake_client.go.html#4505899">hs</a></span><span class="op" id="4506429">.</span><span class="ident" id="4506430"><a href="/gostd/crypto/tls/handshake_client.go.html#4490663">suite</a></span><span class="op" id="4506435">.</span><span class="ident" id="4506436"><a href="/gostd/crypto/tls/cipher_suites.go.html#4434699">id</a></span><span class="op" id="4506438">,</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4506442"><a href="/gostd/crypto/tls/common.go.html#4448456">masterSecret</a></span><span class="op" id="4506454">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4506462"><a href="/gostd/crypto/tls/handshake_client.go.html#4505899">hs</a></span><span class="op" id="4506464">.</span><span class="ident" id="4506465"><a href="/gostd/crypto/tls/handshake_client.go.html#4490717">masterSecret</a></span><span class="op" id="4506477">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4506481"><a href="/gostd/crypto/tls/common.go.html#4448552">serverCertificates</a></span><span class="op" id="4506499">:</span>&nbsp;<span class="ident" id="4506501"><a href="/gostd/crypto/tls/handshake_client.go.html#4506009">c</a></span><span class="op" id="4506502">.</span><span class="ident" id="4506503"><a href="/gostd/crypto/tls/conn.go.html#4462520">peerCertificates</a></span><span class="op" id="4506519">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4506522">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4506526">return</span>&nbsp;<span class="builtintype" id="4506533">nil</span><br>
<span class="lineno">590</span><span class="op" id="4506537">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4506540">func</span>&nbsp;<span class="op" id="4506545">(</span><span class="ident" id="4506546">hs</span>&nbsp;<span class="op" id="4506549">*</span><span class="ident" id="4506550"><a href="/gostd/crypto/tls/handshake_client.go.html#4490552">clientHandshakeState</a></span><span class="op" id="4506570">)</span>&nbsp;<span class="ident" id="4506572">sendFinished</span><span class="op" id="4506584">(</span><span class="ident" id="4506585">out</span>&nbsp;<span class="op" id="4506589">[</span><span class="op" id="4506590">]</span><span class="builtintype" id="4506591">byte</span><span class="op" id="4506595">)</span>&nbsp;<span class="builtintype" id="4506597">error</span>&nbsp;<span class="op" id="4506603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4506606">c</span>&nbsp;<span class="op" id="4506608">:=</span>&nbsp;<span class="ident" id="4506611"><a href="/gostd/crypto/tls/handshake_client.go.html#4506546">hs</a></span><span class="op" id="4506613">.</span><span class="ident" id="4506614"><a href="/gostd/crypto/tls/handshake_client.go.html#4490583">c</a></span><br>
<span class="lineno"></span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4506618"><a href="/gostd/crypto/tls/handshake_client.go.html#4506606">c</a></span><span class="op" id="4506619">.</span><span class="ident" id="4506620"><a href="/gostd/crypto/tls/conn.go.html#4481088">writeRecord</a></span><span class="op" id="4506631">(</span><span class="ident" id="4506632"><a href="/gostd/crypto/tls/common.go.html#4442934">recordTypeChangeCipherSpec</a></span><span class="op" id="4506658">,</span>&nbsp;<span class="op" id="4506660">[</span><span class="op" id="4506661">]</span><span class="builtintype" id="4506662">byte</span><span class="op" id="4506666">{</span><span class="num" id="4506667">1</span><span class="op" id="4506668">}</span><span class="op" id="4506669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4506672">if</span>&nbsp;<span class="ident" id="4506675"><a href="/gostd/crypto/tls/handshake_client.go.html#4506546">hs</a></span><span class="op" id="4506677">.</span><span class="ident" id="4506678"><a href="/gostd/crypto/tls/handshake_client.go.html#4490603">serverHello</a></span><span class="op" id="4506689">.</span><span class="ident" id="4506690"><a href="/gostd/crypto/tls/handshake_messages.go.html#4519574">nextProtoNeg</a></span>&nbsp;<span class="op" id="4506703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4506707">nextProto</span>&nbsp;<span class="op" id="4506717">:=</span>&nbsp;<span class="builtinfunc" id="4506720">new</span><span class="op" id="4506723">(</span><span class="ident" id="4506724"><a href="/gostd/crypto/tls/handshake_messages.go.html#4530220">nextProtoMsg</a></span><span class="op" id="4506736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4506740">proto</span><span class="op" id="4506745">,</span>&nbsp;<span class="ident" id="4506747">fallback</span>&nbsp;<span class="op" id="4506756">:=</span>&nbsp;<span class="ident" id="4506759"><a href="/gostd/crypto/tls/handshake_client.go.html#4507863">mutualProtocol</a></span><span class="op" id="4506773">(</span><span class="ident" id="4506774"><a href="/gostd/crypto/tls/handshake_client.go.html#4506606">c</a></span><span class="op" id="4506775">.</span><span class="ident" id="4506776"><a href="/gostd/crypto/tls/conn.go.html#4462274">config</a></span><span class="op" id="4506782">.</span><span class="ident" id="4506783"><a href="/gostd/crypto/tls/common.go.html#4452064">NextProtos</a></span><span class="op" id="4506793">,</span>&nbsp;<span class="ident" id="4506795"><a href="/gostd/crypto/tls/handshake_client.go.html#4506546">hs</a></span><span class="op" id="4506797">.</span><span class="ident" id="4506798"><a href="/gostd/crypto/tls/handshake_client.go.html#4490603">serverHello</a></span><span class="op" id="4506809">.</span><span class="ident" id="4506810"><a href="/gostd/crypto/tls/handshake_messages.go.html#4519600">nextProtos</a></span><span class="op" id="4506820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4506824"><a href="/gostd/crypto/tls/handshake_client.go.html#4506707">nextProto</a></span><span class="op" id="4506833">.</span><span class="ident" id="4506834"><a href="/gostd/crypto/tls/handshake_messages.go.html#4530257">proto</a></span>&nbsp;<span class="op" id="4506840">=</span>&nbsp;<span class="ident" id="4506842"><a href="/gostd/crypto/tls/handshake_client.go.html#4506740">proto</a></span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4506850"><a href="/gostd/crypto/tls/handshake_client.go.html#4506606">c</a></span><span class="op" id="4506851">.</span><span class="ident" id="4506852"><a href="/gostd/crypto/tls/conn.go.html#4462962">clientProtocol</a></span>&nbsp;<span class="op" id="4506867">=</span>&nbsp;<span class="ident" id="4506869"><a href="/gostd/crypto/tls/handshake_client.go.html#4506740">proto</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4506877"><a href="/gostd/crypto/tls/handshake_client.go.html#4506606">c</a></span><span class="op" id="4506878">.</span><span class="ident" id="4506879"><a href="/gostd/crypto/tls/conn.go.html#4462993">clientProtocolFallback</a></span>&nbsp;<span class="op" id="4506902">=</span>&nbsp;<span class="ident" id="4506904"><a href="/gostd/crypto/tls/handshake_client.go.html#4506747">fallback</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4506916"><a href="/gostd/crypto/tls/handshake_client.go.html#4506546">hs</a></span><span class="op" id="4506918">.</span><span class="ident" id="4506919"><a href="/gostd/crypto/tls/handshake_client.go.html#4490690">finishedHash</a></span><span class="op" id="4506931">.</span><span class="ident" id="4506932"><a href="/gostd/crypto/tls/prf.go.html#4575984">Write</a></span><span class="op" id="4506937">(</span><span class="ident" id="4506938"><a href="/gostd/crypto/tls/handshake_client.go.html#4506707">nextProto</a></span><span class="op" id="4506947">.</span><span class="ident" id="4506948"><a href="/gostd/crypto/tls/handshake_messages.go.html#4530468">marshal</a></span><span class="op" id="4506955">(</span><span class="op" id="4506956">)</span><span class="op" id="4506957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4506961"><a href="/gostd/crypto/tls/handshake_client.go.html#4506606">c</a></span><span class="op" id="4506962">.</span><span class="ident" id="4506963"><a href="/gostd/crypto/tls/conn.go.html#4481088">writeRecord</a></span><span class="op" id="4506974">(</span><span class="ident" id="4506975"><a href="/gostd/crypto/tls/common.go.html#4443022">recordTypeHandshake</a></span><span class="op" id="4506994">,</span>&nbsp;<span class="ident" id="4506996"><a href="/gostd/crypto/tls/handshake_client.go.html#4506707">nextProto</a></span><span class="op" id="4507005">.</span><span class="ident" id="4507006"><a href="/gostd/crypto/tls/handshake_messages.go.html#4530468">marshal</a></span><span class="op" id="4507013">(</span><span class="op" id="4507014">)</span><span class="op" id="4507015">)</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4507018">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4507022">finished</span>&nbsp;<span class="op" id="4507031">:=</span>&nbsp;<span class="builtinfunc" id="4507034">new</span><span class="op" id="4507037">(</span><span class="ident" id="4507038"><a href="/gostd/crypto/tls/handshake_messages.go.html#4529593">finishedMsg</a></span><span class="op" id="4507049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4507052"><a href="/gostd/crypto/tls/handshake_client.go.html#4507022">finished</a></span><span class="op" id="4507060">.</span><span class="ident" id="4507061"><a href="/gostd/crypto/tls/handshake_messages.go.html#4529634">verifyData</a></span>&nbsp;<span class="op" id="4507072">=</span>&nbsp;<span class="ident" id="4507074"><a href="/gostd/crypto/tls/handshake_client.go.html#4506546">hs</a></span><span class="op" id="4507076">.</span><span class="ident" id="4507077"><a href="/gostd/crypto/tls/handshake_client.go.html#4490690">finishedHash</a></span><span class="op" id="4507089">.</span><span class="ident" id="4507090"><a href="/gostd/crypto/tls/prf.go.html#4577233">clientSum</a></span><span class="op" id="4507099">(</span><span class="ident" id="4507100"><a href="/gostd/crypto/tls/handshake_client.go.html#4506546">hs</a></span><span class="op" id="4507102">.</span><span class="ident" id="4507103"><a href="/gostd/crypto/tls/handshake_client.go.html#4490717">masterSecret</a></span><span class="op" id="4507115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4507118"><a href="/gostd/crypto/tls/handshake_client.go.html#4506546">hs</a></span><span class="op" id="4507120">.</span><span class="ident" id="4507121"><a href="/gostd/crypto/tls/handshake_client.go.html#4490690">finishedHash</a></span><span class="op" id="4507133">.</span><span class="ident" id="4507134"><a href="/gostd/crypto/tls/prf.go.html#4575984">Write</a></span><span class="op" id="4507139">(</span><span class="ident" id="4507140"><a href="/gostd/crypto/tls/handshake_client.go.html#4507022">finished</a></span><span class="op" id="4507148">.</span><span class="ident" id="4507149"><a href="/gostd/crypto/tls/handshake_messages.go.html#4529868">marshal</a></span><span class="op" id="4507156">(</span><span class="op" id="4507157">)</span><span class="op" id="4507158">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4507161"><a href="/gostd/crypto/tls/handshake_client.go.html#4506606">c</a></span><span class="op" id="4507162">.</span><span class="ident" id="4507163"><a href="/gostd/crypto/tls/conn.go.html#4481088">writeRecord</a></span><span class="op" id="4507174">(</span><span class="ident" id="4507175"><a href="/gostd/crypto/tls/common.go.html#4443022">recordTypeHandshake</a></span><span class="op" id="4507194">,</span>&nbsp;<span class="ident" id="4507196"><a href="/gostd/crypto/tls/handshake_client.go.html#4507022">finished</a></span><span class="op" id="4507204">.</span><span class="ident" id="4507205"><a href="/gostd/crypto/tls/handshake_messages.go.html#4529868">marshal</a></span><span class="op" id="4507212">(</span><span class="op" id="4507213">)</span><span class="op" id="4507214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4507217">copy</span><span class="op" id="4507221">(</span><span class="ident" id="4507222"><a href="/gostd/crypto/tls/handshake_client.go.html#4506585">out</a></span><span class="op" id="4507225">,</span>&nbsp;<span class="ident" id="4507227"><a href="/gostd/crypto/tls/handshake_client.go.html#4507022">finished</a></span><span class="op" id="4507235">.</span><span class="ident" id="4507236"><a href="/gostd/crypto/tls/handshake_messages.go.html#4529634">verifyData</a></span><span class="op" id="4507246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4507249">return</span>&nbsp;<span class="builtintype" id="4507256">nil</span><br>
<span class="lineno"></span><span class="op" id="4507260">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">615</span><span class="comment" id="4507263">//&nbsp;clientSessionCacheKey&nbsp;returns&nbsp;a&nbsp;key&nbsp;used&nbsp;to&nbsp;cache&nbsp;sessionTickets&nbsp;that&nbsp;could</span><br>
<span class="lineno"></span><span class="comment" id="4507342">//&nbsp;be&nbsp;used&nbsp;to&nbsp;resume&nbsp;previously&nbsp;negotiated&nbsp;TLS&nbsp;sessions&nbsp;with&nbsp;a&nbsp;server.</span><br>
<span class="lineno"></span><span class="keyword" id="4507413">func</span>&nbsp;<span class="ident" id="4507418">clientSessionCacheKey</span><span class="op" id="4507439">(</span><span class="ident" id="4507440">serverAddr</span>&nbsp;<span class="ident" id="4507451"><a href="/gostd/crypto/tls/handshake_client.go.html#4490527">net</a></span><span class="op" id="4507454">.</span><span class="ident" id="4507455"><a href="/gostd/net/net.go.html#3334179">Addr</a></span><span class="op" id="4507459">,</span>&nbsp;<span class="ident" id="4507461">config</span>&nbsp;<span class="op" id="4507468">*</span><span class="ident" id="4507469"><a href="/gostd/crypto/tls/common.go.html#4450481">Config</a></span><span class="op" id="4507475">)</span>&nbsp;<span class="builtintype" id="4507477">string</span>&nbsp;<span class="op" id="4507484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4507487">if</span>&nbsp;<span class="builtinfunc" id="4507490">len</span><span class="op" id="4507493">(</span><span class="ident" id="4507494"><a href="/gostd/crypto/tls/handshake_client.go.html#4507461">config</a></span><span class="op" id="4507500">.</span><span class="ident" id="4507501"><a href="/gostd/crypto/tls/common.go.html#4452279">ServerName</a></span><span class="op" id="4507511">)</span>&nbsp;<span class="op" id="4507513">&gt;</span>&nbsp;<span class="num" id="4507515">0</span>&nbsp;<span class="op" id="4507517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4507521">return</span>&nbsp;<span class="ident" id="4507528"><a href="/gostd/crypto/tls/handshake_client.go.html#4507461">config</a></span><span class="op" id="4507534">.</span><span class="ident" id="4507535"><a href="/gostd/crypto/tls/common.go.html#4452279">ServerName</a></span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4507547">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4507550">return</span>&nbsp;<span class="ident" id="4507557"><a href="/gostd/crypto/tls/handshake_client.go.html#4507440">serverAddr</a></span><span class="op" id="4507567">.</span><span class="ident" id="4507568"><a href="/gostd/net/net.go.html#3334238">String</a></span><span class="op" id="4507574">(</span><span class="op" id="4507575">)</span><br>
<span class="lineno"></span><span class="op" id="4507577">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4507580">//&nbsp;mutualProtocol&nbsp;finds&nbsp;the&nbsp;mutual&nbsp;Next&nbsp;Protocol&nbsp;Negotiation&nbsp;or&nbsp;ALPN&nbsp;protocol</span><br>
<span class="lineno">625</span><span class="comment" id="4507658">//&nbsp;given&nbsp;list&nbsp;of&nbsp;possible&nbsp;protocols&nbsp;and&nbsp;a&nbsp;list&nbsp;of&nbsp;the&nbsp;preference&nbsp;order.&nbsp;The</span><br>
<span class="lineno"></span><span class="comment" id="4507734">//&nbsp;first&nbsp;list&nbsp;must&nbsp;not&nbsp;be&nbsp;empty.&nbsp;It&nbsp;returns&nbsp;the&nbsp;resulting&nbsp;protocol&nbsp;and&nbsp;flag</span><br>
<span class="lineno"></span><span class="comment" id="4507810">//&nbsp;indicating&nbsp;if&nbsp;the&nbsp;fallback&nbsp;case&nbsp;was&nbsp;reached.</span><br>
<span class="lineno"></span><span class="keyword" id="4507858">func</span>&nbsp;<span class="ident" id="4507863">mutualProtocol</span><span class="op" id="4507877">(</span><span class="ident" id="4507878">protos</span><span class="op" id="4507884">,</span>&nbsp;<span class="ident" id="4507886">preferenceProtos</span>&nbsp;<span class="op" id="4507903">[</span><span class="op" id="4507904">]</span><span class="builtintype" id="4507905">string</span><span class="op" id="4507911">)</span>&nbsp;<span class="op" id="4507913">(</span><span class="builtintype" id="4507914">string</span><span class="op" id="4507920">,</span>&nbsp;<span class="builtintype" id="4507922">bool</span><span class="op" id="4507926">)</span>&nbsp;<span class="op" id="4507928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4507931">for</span>&nbsp;<span class="ident" id="4507935">_</span><span class="op" id="4507936">,</span>&nbsp;<span class="ident" id="4507938">s</span>&nbsp;<span class="op" id="4507940">:=</span>&nbsp;<span class="keyword" id="4507943">range</span>&nbsp;<span class="ident" id="4507949"><a href="/gostd/crypto/tls/handshake_client.go.html#4507886">preferenceProtos</a></span>&nbsp;<span class="op" id="4507966">{</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4507970">for</span>&nbsp;<span class="ident" id="4507974">_</span><span class="op" id="4507975">,</span>&nbsp;<span class="ident" id="4507977">c</span>&nbsp;<span class="op" id="4507979">:=</span>&nbsp;<span class="keyword" id="4507982">range</span>&nbsp;<span class="ident" id="4507988"><a href="/gostd/crypto/tls/handshake_client.go.html#4507878">protos</a></span>&nbsp;<span class="op" id="4507995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4508000">if</span>&nbsp;<span class="ident" id="4508003"><a href="/gostd/crypto/tls/handshake_client.go.html#4507938">s</a></span>&nbsp;<span class="op" id="4508005">==</span>&nbsp;<span class="ident" id="4508008"><a href="/gostd/crypto/tls/handshake_client.go.html#4507977">c</a></span>&nbsp;<span class="op" id="4508010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4508016">return</span>&nbsp;<span class="ident" id="4508023"><a href="/gostd/crypto/tls/handshake_client.go.html#4507938">s</a></span><span class="op" id="4508024">,</span>&nbsp;<span class="builtintype" id="4508026">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4508035">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4508039">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4508042">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4508046">return</span>&nbsp;<span class="ident" id="4508053"><a href="/gostd/crypto/tls/handshake_client.go.html#4507878">protos</a></span><span class="op" id="4508059">[</span><span class="num" id="4508060">0</span><span class="op" id="4508061">]</span><span class="op" id="4508062">,</span>&nbsp;<span class="builtintype" id="4508064">true</span><br>
<span class="lineno"></span><span class="op" id="4508069">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
