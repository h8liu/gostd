<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html" class="current">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3174004">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3174060">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3174114">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3174165">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;netbsd&nbsp;openbsd&nbsp;solaris&nbsp;windows</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3174238">package</span>&nbsp;<span class="ident" id="3174246">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3174251">import</span>&nbsp;<span class="op" id="3174258">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3174261">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3174267">&#34;syscall&#34;</span><br>
<span class="lineno"></span><span class="op" id="3174277">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3174280">//&nbsp;Boolean&nbsp;to&nbsp;int.</span><br>
<span class="lineno">15</span><span class="keyword" id="3174299">func</span>&nbsp;<span class="ident" id="3174304">boolint</span><span class="op" id="3174311">(</span><span class="ident" id="3174312">b</span>&nbsp;<span class="builtintype" id="3174314">bool</span><span class="op" id="3174318">)</span>&nbsp;<span class="builtintype" id="3174320">int</span>&nbsp;<span class="op" id="3174324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3174327">if</span>&nbsp;<span class="ident" id="3174330">b</span>&nbsp;<span class="op" id="3174332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3174336">return</span>&nbsp;<span class="num" id="3174343">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3174346">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3174349">return</span>&nbsp;<span class="num" id="3174356">0</span><br>
<span class="lineno">20</span><span class="op" id="3174358">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3174361">func</span>&nbsp;<span class="ident" id="3174366">ipv4AddrToInterface</span><span class="op" id="3174385">(</span><span class="ident" id="3174386">ip</span>&nbsp;<span class="ident" id="3174389">IP</span><span class="op" id="3174391">)</span>&nbsp;<span class="op" id="3174393">(</span><span class="op" id="3174394">*</span><span class="ident" id="3174395">Interface</span><span class="op" id="3174404">,</span>&nbsp;<span class="builtintype" id="3174406">error</span><span class="op" id="3174411">)</span>&nbsp;<span class="op" id="3174413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3174416">ift</span><span class="op" id="3174419">,</span>&nbsp;<span class="ident" id="3174421">err</span>&nbsp;<span class="op" id="3174425">:=</span>&nbsp;<span class="ident" id="3174428">Interfaces</span><span class="op" id="3174438">(</span><span class="op" id="3174439">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3174442">if</span>&nbsp;<span class="ident" id="3174445">err</span>&nbsp;<span class="op" id="3174449">!=</span>&nbsp;<span class="ident" id="3174452">nil</span>&nbsp;<span class="op" id="3174456">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3174460">return</span>&nbsp;<span class="ident" id="3174467">nil</span><span class="op" id="3174470">,</span>&nbsp;<span class="ident" id="3174472">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3174477">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3174480">for</span>&nbsp;<span class="ident" id="3174484">_</span><span class="op" id="3174485">,</span>&nbsp;<span class="ident" id="3174487">ifi</span>&nbsp;<span class="op" id="3174491">:=</span>&nbsp;<span class="keyword" id="3174494">range</span>&nbsp;<span class="ident" id="3174500">ift</span>&nbsp;<span class="op" id="3174504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3174508">ifat</span><span class="op" id="3174512">,</span>&nbsp;<span class="ident" id="3174514">err</span>&nbsp;<span class="op" id="3174518">:=</span>&nbsp;<span class="ident" id="3174521">ifi</span><span class="op" id="3174524">.</span><span class="ident" id="3174525">Addrs</span><span class="op" id="3174530">(</span><span class="op" id="3174531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3174535">if</span>&nbsp;<span class="ident" id="3174538">err</span>&nbsp;<span class="op" id="3174542">!=</span>&nbsp;<span class="ident" id="3174545">nil</span>&nbsp;<span class="op" id="3174549">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3174554">return</span>&nbsp;<span class="ident" id="3174561">nil</span><span class="op" id="3174564">,</span>&nbsp;<span class="ident" id="3174566">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3174572">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3174576">for</span>&nbsp;<span class="ident" id="3174580">_</span><span class="op" id="3174581">,</span>&nbsp;<span class="ident" id="3174583">ifa</span>&nbsp;<span class="op" id="3174587">:=</span>&nbsp;<span class="keyword" id="3174590">range</span>&nbsp;<span class="ident" id="3174596">ifat</span>&nbsp;<span class="op" id="3174601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3174606">switch</span>&nbsp;<span class="ident" id="3174613">v</span>&nbsp;<span class="op" id="3174615">:=</span>&nbsp;<span class="ident" id="3174618">ifa</span><span class="op" id="3174621">.</span><span class="op" id="3174622">(</span><span class="keyword" id="3174623">type</span><span class="op" id="3174627">)</span>&nbsp;<span class="op" id="3174629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3174634">case</span>&nbsp;<span class="op" id="3174639">*</span><span class="ident" id="3174640">IPAddr</span><span class="op" id="3174646">:</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3174652">if</span>&nbsp;<span class="ident" id="3174655">ip</span><span class="op" id="3174657">.</span><span class="ident" id="3174658">Equal</span><span class="op" id="3174663">(</span><span class="ident" id="3174664">v</span><span class="op" id="3174665">.</span><span class="ident" id="3174666">IP</span><span class="op" id="3174668">)</span>&nbsp;<span class="op" id="3174670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3174677">return</span>&nbsp;<span class="op" id="3174684">&amp;</span><span class="ident" id="3174685">ifi</span><span class="op" id="3174688">,</span>&nbsp;<span class="ident" id="3174690">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3174698">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3174703">case</span>&nbsp;<span class="op" id="3174708">*</span><span class="ident" id="3174709">IPNet</span><span class="op" id="3174714">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3174720">if</span>&nbsp;<span class="ident" id="3174723">ip</span><span class="op" id="3174725">.</span><span class="ident" id="3174726">Equal</span><span class="op" id="3174731">(</span><span class="ident" id="3174732">v</span><span class="op" id="3174733">.</span><span class="ident" id="3174734">IP</span><span class="op" id="3174736">)</span>&nbsp;<span class="op" id="3174738">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3174745">return</span>&nbsp;<span class="op" id="3174752">&amp;</span><span class="ident" id="3174753">ifi</span><span class="op" id="3174756">,</span>&nbsp;<span class="ident" id="3174758">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3174766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3174771">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3174775">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3174778">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3174781">if</span>&nbsp;<span class="ident" id="3174784">ip</span><span class="op" id="3174786">.</span><span class="ident" id="3174787">Equal</span><span class="op" id="3174792">(</span><span class="ident" id="3174793">IPv4zero</span><span class="op" id="3174801">)</span>&nbsp;<span class="op" id="3174803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3174807">return</span>&nbsp;<span class="ident" id="3174814">nil</span><span class="op" id="3174817">,</span>&nbsp;<span class="ident" id="3174819">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3174824">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3174827">return</span>&nbsp;<span class="ident" id="3174834">nil</span><span class="op" id="3174837">,</span>&nbsp;<span class="ident" id="3174839">errNoSuchInterface</span><br>
<span class="lineno"></span><span class="op" id="3174858">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="3174861">func</span>&nbsp;<span class="ident" id="3174866">interfaceToIPv4Addr</span><span class="op" id="3174885">(</span><span class="ident" id="3174886">ifi</span>&nbsp;<span class="op" id="3174890">*</span><span class="ident" id="3174891">Interface</span><span class="op" id="3174900">)</span>&nbsp;<span class="op" id="3174902">(</span><span class="ident" id="3174903">IP</span><span class="op" id="3174905">,</span>&nbsp;<span class="builtintype" id="3174907">error</span><span class="op" id="3174912">)</span>&nbsp;<span class="op" id="3174914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3174917">if</span>&nbsp;<span class="ident" id="3174920">ifi</span>&nbsp;<span class="op" id="3174924">==</span>&nbsp;<span class="ident" id="3174927">nil</span>&nbsp;<span class="op" id="3174931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3174935">return</span>&nbsp;<span class="ident" id="3174942">IPv4zero</span><span class="op" id="3174950">,</span>&nbsp;<span class="ident" id="3174952">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3174957">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3174960">ifat</span><span class="op" id="3174964">,</span>&nbsp;<span class="ident" id="3174966">err</span>&nbsp;<span class="op" id="3174970">:=</span>&nbsp;<span class="ident" id="3174973">ifi</span><span class="op" id="3174976">.</span><span class="ident" id="3174977">Addrs</span><span class="op" id="3174982">(</span><span class="op" id="3174983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3174986">if</span>&nbsp;<span class="ident" id="3174989">err</span>&nbsp;<span class="op" id="3174993">!=</span>&nbsp;<span class="ident" id="3174996">nil</span>&nbsp;<span class="op" id="3175000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3175004">return</span>&nbsp;<span class="ident" id="3175011">nil</span><span class="op" id="3175014">,</span>&nbsp;<span class="ident" id="3175016">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3175021">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3175024">for</span>&nbsp;<span class="ident" id="3175028">_</span><span class="op" id="3175029">,</span>&nbsp;<span class="ident" id="3175031">ifa</span>&nbsp;<span class="op" id="3175035">:=</span>&nbsp;<span class="keyword" id="3175038">range</span>&nbsp;<span class="ident" id="3175044">ifat</span>&nbsp;<span class="op" id="3175049">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3175053">switch</span>&nbsp;<span class="ident" id="3175060">v</span>&nbsp;<span class="op" id="3175062">:=</span>&nbsp;<span class="ident" id="3175065">ifa</span><span class="op" id="3175068">.</span><span class="op" id="3175069">(</span><span class="keyword" id="3175070">type</span><span class="op" id="3175074">)</span>&nbsp;<span class="op" id="3175076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3175080">case</span>&nbsp;<span class="op" id="3175085">*</span><span class="ident" id="3175086">IPAddr</span><span class="op" id="3175092">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3175097">if</span>&nbsp;<span class="ident" id="3175100">v</span><span class="op" id="3175101">.</span><span class="ident" id="3175102">IP</span><span class="op" id="3175104">.</span><span class="ident" id="3175105">To4</span><span class="op" id="3175108">(</span><span class="op" id="3175109">)</span>&nbsp;<span class="op" id="3175111">!=</span>&nbsp;<span class="ident" id="3175114">nil</span>&nbsp;<span class="op" id="3175118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3175124">return</span>&nbsp;<span class="ident" id="3175131">v</span><span class="op" id="3175132">.</span><span class="ident" id="3175133">IP</span><span class="op" id="3175135">,</span>&nbsp;<span class="ident" id="3175137">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3175144">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3175148">case</span>&nbsp;<span class="op" id="3175153">*</span><span class="ident" id="3175154">IPNet</span><span class="op" id="3175159">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3175164">if</span>&nbsp;<span class="ident" id="3175167">v</span><span class="op" id="3175168">.</span><span class="ident" id="3175169">IP</span><span class="op" id="3175171">.</span><span class="ident" id="3175172">To4</span><span class="op" id="3175175">(</span><span class="op" id="3175176">)</span>&nbsp;<span class="op" id="3175178">!=</span>&nbsp;<span class="ident" id="3175181">nil</span>&nbsp;<span class="op" id="3175185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3175191">return</span>&nbsp;<span class="ident" id="3175198">v</span><span class="op" id="3175199">.</span><span class="ident" id="3175200">IP</span><span class="op" id="3175202">,</span>&nbsp;<span class="ident" id="3175204">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3175211">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3175215">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3175218">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3175221">return</span>&nbsp;<span class="ident" id="3175228">nil</span><span class="op" id="3175231">,</span>&nbsp;<span class="ident" id="3175233">errNoSuchInterface</span><br>
<span class="lineno"></span><span class="op" id="3175252">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3175255">func</span>&nbsp;<span class="ident" id="3175260">setIPv4MreqToInterface</span><span class="op" id="3175282">(</span><span class="ident" id="3175283">mreq</span>&nbsp;<span class="op" id="3175288">*</span><span class="ident" id="3175289">syscall</span><span class="op" id="3175296">.</span><span class="ident" id="3175297">IPMreq</span><span class="op" id="3175303">,</span>&nbsp;<span class="ident" id="3175305">ifi</span>&nbsp;<span class="op" id="3175309">*</span><span class="ident" id="3175310">Interface</span><span class="op" id="3175319">)</span>&nbsp;<span class="builtintype" id="3175321">error</span>&nbsp;<span class="op" id="3175327">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3175330">if</span>&nbsp;<span class="ident" id="3175333">ifi</span>&nbsp;<span class="op" id="3175337">==</span>&nbsp;<span class="ident" id="3175340">nil</span>&nbsp;<span class="op" id="3175344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3175348">return</span>&nbsp;<span class="ident" id="3175355">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3175360">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3175363">ifat</span><span class="op" id="3175367">,</span>&nbsp;<span class="ident" id="3175369">err</span>&nbsp;<span class="op" id="3175373">:=</span>&nbsp;<span class="ident" id="3175376">ifi</span><span class="op" id="3175379">.</span><span class="ident" id="3175380">Addrs</span><span class="op" id="3175385">(</span><span class="op" id="3175386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3175389">if</span>&nbsp;<span class="ident" id="3175392">err</span>&nbsp;<span class="op" id="3175396">!=</span>&nbsp;<span class="ident" id="3175399">nil</span>&nbsp;<span class="op" id="3175403">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3175407">return</span>&nbsp;<span class="ident" id="3175414">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3175419">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3175422">for</span>&nbsp;<span class="ident" id="3175426">_</span><span class="op" id="3175427">,</span>&nbsp;<span class="ident" id="3175429">ifa</span>&nbsp;<span class="op" id="3175433">:=</span>&nbsp;<span class="keyword" id="3175436">range</span>&nbsp;<span class="ident" id="3175442">ifat</span>&nbsp;<span class="op" id="3175447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3175451">switch</span>&nbsp;<span class="ident" id="3175458">v</span>&nbsp;<span class="op" id="3175460">:=</span>&nbsp;<span class="ident" id="3175463">ifa</span><span class="op" id="3175466">.</span><span class="op" id="3175467">(</span><span class="keyword" id="3175468">type</span><span class="op" id="3175472">)</span>&nbsp;<span class="op" id="3175474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3175478">case</span>&nbsp;<span class="op" id="3175483">*</span><span class="ident" id="3175484">IPAddr</span><span class="op" id="3175490">:</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3175495">if</span>&nbsp;<span class="ident" id="3175498">a</span>&nbsp;<span class="op" id="3175500">:=</span>&nbsp;<span class="ident" id="3175503">v</span><span class="op" id="3175504">.</span><span class="ident" id="3175505">IP</span><span class="op" id="3175507">.</span><span class="ident" id="3175508">To4</span><span class="op" id="3175511">(</span><span class="op" id="3175512">)</span><span class="op" id="3175513">;</span>&nbsp;<span class="ident" id="3175515">a</span>&nbsp;<span class="op" id="3175517">!=</span>&nbsp;<span class="ident" id="3175520">nil</span>&nbsp;<span class="op" id="3175524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3175530">copy</span><span class="op" id="3175534">(</span><span class="ident" id="3175535">mreq</span><span class="op" id="3175539">.</span><span class="ident" id="3175540">Interface</span><span class="op" id="3175549">[</span><span class="op" id="3175550">:</span><span class="op" id="3175551">]</span><span class="op" id="3175552">,</span>&nbsp;<span class="ident" id="3175554">a</span><span class="op" id="3175555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3175561">goto</span>&nbsp;<span class="ident" id="3175566">done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3175574">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3175578">case</span>&nbsp;<span class="op" id="3175583">*</span><span class="ident" id="3175584">IPNet</span><span class="op" id="3175589">:</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3175594">if</span>&nbsp;<span class="ident" id="3175597">a</span>&nbsp;<span class="op" id="3175599">:=</span>&nbsp;<span class="ident" id="3175602">v</span><span class="op" id="3175603">.</span><span class="ident" id="3175604">IP</span><span class="op" id="3175606">.</span><span class="ident" id="3175607">To4</span><span class="op" id="3175610">(</span><span class="op" id="3175611">)</span><span class="op" id="3175612">;</span>&nbsp;<span class="ident" id="3175614">a</span>&nbsp;<span class="op" id="3175616">!=</span>&nbsp;<span class="ident" id="3175619">nil</span>&nbsp;<span class="op" id="3175623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3175629">copy</span><span class="op" id="3175633">(</span><span class="ident" id="3175634">mreq</span><span class="op" id="3175638">.</span><span class="ident" id="3175639">Interface</span><span class="op" id="3175648">[</span><span class="op" id="3175649">:</span><span class="op" id="3175650">]</span><span class="op" id="3175651">,</span>&nbsp;<span class="ident" id="3175653">a</span><span class="op" id="3175654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3175660">goto</span>&nbsp;<span class="ident" id="3175665">done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3175673">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3175677">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3175680">}</span><br>
<span class="lineno"></span><span class="ident" id="3175682">done</span><span class="op" id="3175686">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3175689">if</span>&nbsp;<span class="ident" id="3175692">bytesEqual</span><span class="op" id="3175702">(</span><span class="ident" id="3175703">mreq</span><span class="op" id="3175707">.</span><span class="ident" id="3175708">Multiaddr</span><span class="op" id="3175717">[</span><span class="op" id="3175718">:</span><span class="op" id="3175719">]</span><span class="op" id="3175720">,</span>&nbsp;<span class="ident" id="3175722">IPv4zero</span><span class="op" id="3175730">.</span><span class="ident" id="3175731">To4</span><span class="op" id="3175734">(</span><span class="op" id="3175735">)</span><span class="op" id="3175736">)</span>&nbsp;<span class="op" id="3175738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3175742">return</span>&nbsp;<span class="ident" id="3175749">errNoSuchMulticastInterface</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3175778">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3175781">return</span>&nbsp;<span class="ident" id="3175788">nil</span><br>
<span class="lineno"></span><span class="op" id="3175792">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3175795">func</span>&nbsp;<span class="ident" id="3175800">setReadBuffer</span><span class="op" id="3175813">(</span><span class="ident" id="3175814">fd</span>&nbsp;<span class="op" id="3175817">*</span><span class="ident" id="3175818">netFD</span><span class="op" id="3175823">,</span>&nbsp;<span class="ident" id="3175825">bytes</span>&nbsp;<span class="builtintype" id="3175831">int</span><span class="op" id="3175834">)</span>&nbsp;<span class="builtintype" id="3175836">error</span>&nbsp;<span class="op" id="3175842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3175845">if</span>&nbsp;<span class="ident" id="3175848">err</span>&nbsp;<span class="op" id="3175852">:=</span>&nbsp;<span class="ident" id="3175855">fd</span><span class="op" id="3175857">.</span><span class="ident" id="3175858">incref</span><span class="op" id="3175864">(</span><span class="op" id="3175865">)</span><span class="op" id="3175866">;</span>&nbsp;<span class="ident" id="3175868">err</span>&nbsp;<span class="op" id="3175872">!=</span>&nbsp;<span class="ident" id="3175875">nil</span>&nbsp;<span class="op" id="3175879">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3175883">return</span>&nbsp;<span class="ident" id="3175890">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3175895">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3175898">defer</span>&nbsp;<span class="ident" id="3175904">fd</span><span class="op" id="3175906">.</span><span class="ident" id="3175907">decref</span><span class="op" id="3175913">(</span><span class="op" id="3175914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3175917">return</span>&nbsp;<span class="ident" id="3175924">os</span><span class="op" id="3175926">.</span><span class="ident" id="3175927">NewSyscallError</span><span class="op" id="3175942">(</span><span class="string" id="3175943">&#34;setsockopt&#34;</span><span class="op" id="3175955">,</span>&nbsp;<span class="ident" id="3175957">syscall</span><span class="op" id="3175964">.</span><span class="ident" id="3175965">SetsockoptInt</span><span class="op" id="3175978">(</span><span class="ident" id="3175979">fd</span><span class="op" id="3175981">.</span><span class="ident" id="3175982">sysfd</span><span class="op" id="3175987">,</span>&nbsp;<span class="ident" id="3175989">syscall</span><span class="op" id="3175996">.</span><span class="ident" id="3175997">SOL_SOCKET</span><span class="op" id="3176007">,</span>&nbsp;<span class="ident" id="3176009">syscall</span><span class="op" id="3176016">.</span><span class="ident" id="3176017">SO_RCVBUF</span><span class="op" id="3176026">,</span>&nbsp;<span class="ident" id="3176028">bytes</span><span class="op" id="3176033">)</span><span class="op" id="3176034">)</span><br>
<span class="lineno"></span><span class="op" id="3176036">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="keyword" id="3176039">func</span>&nbsp;<span class="ident" id="3176044">setWriteBuffer</span><span class="op" id="3176058">(</span><span class="ident" id="3176059">fd</span>&nbsp;<span class="op" id="3176062">*</span><span class="ident" id="3176063">netFD</span><span class="op" id="3176068">,</span>&nbsp;<span class="ident" id="3176070">bytes</span>&nbsp;<span class="builtintype" id="3176076">int</span><span class="op" id="3176079">)</span>&nbsp;<span class="builtintype" id="3176081">error</span>&nbsp;<span class="op" id="3176087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3176090">if</span>&nbsp;<span class="ident" id="3176093">err</span>&nbsp;<span class="op" id="3176097">:=</span>&nbsp;<span class="ident" id="3176100">fd</span><span class="op" id="3176102">.</span><span class="ident" id="3176103">incref</span><span class="op" id="3176109">(</span><span class="op" id="3176110">)</span><span class="op" id="3176111">;</span>&nbsp;<span class="ident" id="3176113">err</span>&nbsp;<span class="op" id="3176117">!=</span>&nbsp;<span class="ident" id="3176120">nil</span>&nbsp;<span class="op" id="3176124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3176128">return</span>&nbsp;<span class="ident" id="3176135">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3176140">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3176143">defer</span>&nbsp;<span class="ident" id="3176149">fd</span><span class="op" id="3176151">.</span><span class="ident" id="3176152">decref</span><span class="op" id="3176158">(</span><span class="op" id="3176159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3176162">return</span>&nbsp;<span class="ident" id="3176169">os</span><span class="op" id="3176171">.</span><span class="ident" id="3176172">NewSyscallError</span><span class="op" id="3176187">(</span><span class="string" id="3176188">&#34;setsockopt&#34;</span><span class="op" id="3176200">,</span>&nbsp;<span class="ident" id="3176202">syscall</span><span class="op" id="3176209">.</span><span class="ident" id="3176210">SetsockoptInt</span><span class="op" id="3176223">(</span><span class="ident" id="3176224">fd</span><span class="op" id="3176226">.</span><span class="ident" id="3176227">sysfd</span><span class="op" id="3176232">,</span>&nbsp;<span class="ident" id="3176234">syscall</span><span class="op" id="3176241">.</span><span class="ident" id="3176242">SOL_SOCKET</span><span class="op" id="3176252">,</span>&nbsp;<span class="ident" id="3176254">syscall</span><span class="op" id="3176261">.</span><span class="ident" id="3176262">SO_SNDBUF</span><span class="op" id="3176271">,</span>&nbsp;<span class="ident" id="3176273">bytes</span><span class="op" id="3176278">)</span><span class="op" id="3176279">)</span><br>
<span class="lineno"></span><span class="op" id="3176281">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3176284">func</span>&nbsp;<span class="ident" id="3176289">setKeepAlive</span><span class="op" id="3176301">(</span><span class="ident" id="3176302">fd</span>&nbsp;<span class="op" id="3176305">*</span><span class="ident" id="3176306">netFD</span><span class="op" id="3176311">,</span>&nbsp;<span class="ident" id="3176313">keepalive</span>&nbsp;<span class="builtintype" id="3176323">bool</span><span class="op" id="3176327">)</span>&nbsp;<span class="builtintype" id="3176329">error</span>&nbsp;<span class="op" id="3176335">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3176338">if</span>&nbsp;<span class="ident" id="3176341">err</span>&nbsp;<span class="op" id="3176345">:=</span>&nbsp;<span class="ident" id="3176348">fd</span><span class="op" id="3176350">.</span><span class="ident" id="3176351">incref</span><span class="op" id="3176357">(</span><span class="op" id="3176358">)</span><span class="op" id="3176359">;</span>&nbsp;<span class="ident" id="3176361">err</span>&nbsp;<span class="op" id="3176365">!=</span>&nbsp;<span class="ident" id="3176368">nil</span>&nbsp;<span class="op" id="3176372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3176376">return</span>&nbsp;<span class="ident" id="3176383">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3176388">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3176391">defer</span>&nbsp;<span class="ident" id="3176397">fd</span><span class="op" id="3176399">.</span><span class="ident" id="3176400">decref</span><span class="op" id="3176406">(</span><span class="op" id="3176407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3176410">return</span>&nbsp;<span class="ident" id="3176417">os</span><span class="op" id="3176419">.</span><span class="ident" id="3176420">NewSyscallError</span><span class="op" id="3176435">(</span><span class="string" id="3176436">&#34;setsockopt&#34;</span><span class="op" id="3176448">,</span>&nbsp;<span class="ident" id="3176450">syscall</span><span class="op" id="3176457">.</span><span class="ident" id="3176458">SetsockoptInt</span><span class="op" id="3176471">(</span><span class="ident" id="3176472">fd</span><span class="op" id="3176474">.</span><span class="ident" id="3176475">sysfd</span><span class="op" id="3176480">,</span>&nbsp;<span class="ident" id="3176482">syscall</span><span class="op" id="3176489">.</span><span class="ident" id="3176490">SOL_SOCKET</span><span class="op" id="3176500">,</span>&nbsp;<span class="ident" id="3176502">syscall</span><span class="op" id="3176509">.</span><span class="ident" id="3176510">SO_KEEPALIVE</span><span class="op" id="3176522">,</span>&nbsp;<span class="ident" id="3176524">boolint</span><span class="op" id="3176531">(</span><span class="ident" id="3176532">keepalive</span><span class="op" id="3176541">)</span><span class="op" id="3176542">)</span><span class="op" id="3176543">)</span><br>
<span class="lineno">125</span><span class="op" id="3176545">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3176548">func</span>&nbsp;<span class="ident" id="3176553">setLinger</span><span class="op" id="3176562">(</span><span class="ident" id="3176563">fd</span>&nbsp;<span class="op" id="3176566">*</span><span class="ident" id="3176567">netFD</span><span class="op" id="3176572">,</span>&nbsp;<span class="ident" id="3176574">sec</span>&nbsp;<span class="builtintype" id="3176578">int</span><span class="op" id="3176581">)</span>&nbsp;<span class="builtintype" id="3176583">error</span>&nbsp;<span class="op" id="3176589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3176592">var</span>&nbsp;<span class="ident" id="3176596">l</span>&nbsp;<span class="ident" id="3176598">syscall</span><span class="op" id="3176605">.</span><span class="ident" id="3176606">Linger</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3176614">if</span>&nbsp;<span class="ident" id="3176617">sec</span>&nbsp;<span class="op" id="3176621">&gt;=</span>&nbsp;<span class="num" id="3176624">0</span>&nbsp;<span class="op" id="3176626">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3176630">l</span><span class="op" id="3176631">.</span><span class="ident" id="3176632">Onoff</span>&nbsp;<span class="op" id="3176638">=</span>&nbsp;<span class="num" id="3176640">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3176644">l</span><span class="op" id="3176645">.</span><span class="ident" id="3176646">Linger</span>&nbsp;<span class="op" id="3176653">=</span>&nbsp;<span class="builtintype" id="3176655">int32</span><span class="op" id="3176660">(</span><span class="ident" id="3176661">sec</span><span class="op" id="3176664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3176667">}</span>&nbsp;<span class="keyword" id="3176669">else</span>&nbsp;<span class="op" id="3176674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3176678">l</span><span class="op" id="3176679">.</span><span class="ident" id="3176680">Onoff</span>&nbsp;<span class="op" id="3176686">=</span>&nbsp;<span class="num" id="3176688">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3176692">l</span><span class="op" id="3176693">.</span><span class="ident" id="3176694">Linger</span>&nbsp;<span class="op" id="3176701">=</span>&nbsp;<span class="num" id="3176703">0</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3176706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3176709">if</span>&nbsp;<span class="ident" id="3176712">err</span>&nbsp;<span class="op" id="3176716">:=</span>&nbsp;<span class="ident" id="3176719">fd</span><span class="op" id="3176721">.</span><span class="ident" id="3176722">incref</span><span class="op" id="3176728">(</span><span class="op" id="3176729">)</span><span class="op" id="3176730">;</span>&nbsp;<span class="ident" id="3176732">err</span>&nbsp;<span class="op" id="3176736">!=</span>&nbsp;<span class="ident" id="3176739">nil</span>&nbsp;<span class="op" id="3176743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3176747">return</span>&nbsp;<span class="ident" id="3176754">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3176759">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3176762">defer</span>&nbsp;<span class="ident" id="3176768">fd</span><span class="op" id="3176770">.</span><span class="ident" id="3176771">decref</span><span class="op" id="3176777">(</span><span class="op" id="3176778">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3176781">return</span>&nbsp;<span class="ident" id="3176788">os</span><span class="op" id="3176790">.</span><span class="ident" id="3176791">NewSyscallError</span><span class="op" id="3176806">(</span><span class="string" id="3176807">&#34;setsockopt&#34;</span><span class="op" id="3176819">,</span>&nbsp;<span class="ident" id="3176821">syscall</span><span class="op" id="3176828">.</span><span class="ident" id="3176829">SetsockoptLinger</span><span class="op" id="3176845">(</span><span class="ident" id="3176846">fd</span><span class="op" id="3176848">.</span><span class="ident" id="3176849">sysfd</span><span class="op" id="3176854">,</span>&nbsp;<span class="ident" id="3176856">syscall</span><span class="op" id="3176863">.</span><span class="ident" id="3176864">SOL_SOCKET</span><span class="op" id="3176874">,</span>&nbsp;<span class="ident" id="3176876">syscall</span><span class="op" id="3176883">.</span><span class="ident" id="3176884">SO_LINGER</span><span class="op" id="3176893">,</span>&nbsp;<span class="op" id="3176895">&amp;</span><span class="ident" id="3176896">l</span><span class="op" id="3176897">)</span><span class="op" id="3176898">)</span><br>
<span class="lineno"></span><span class="op" id="3176900">}</span>
</div>
</body>
</html>
