<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/gif</h2>
<ul>
<li><a href="/gostd/image/gif/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/gif/reader_test.go.html" class="current">reader_test.go</a></li>
<li><a href="/gostd/image/gif/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/gif/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7934390">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7934445">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7934499">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7934550">package</span>&nbsp;<span class="ident" id="7934558">gif</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7934563">import</span>&nbsp;<span class="op" id="7934570">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7934573">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7934582">&#34;compress/lzw&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7934598">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7934607">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7934622">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7934633">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7934643">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="7934646">//&nbsp;header,&nbsp;palette&nbsp;and&nbsp;trailer&nbsp;are&nbsp;parts&nbsp;of&nbsp;a&nbsp;valid&nbsp;2x1&nbsp;GIF&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="7934713">const</span>&nbsp;<span class="op" id="7934719">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7934722">headerStr</span>&nbsp;<span class="op" id="7934732">=</span>&nbsp;<span class="string" id="7934734">&#34;GIF89a&#34;</span>&nbsp;<span class="op" id="7934743">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7934747">&#34;\x02\x00\x01\x00&#34;</span>&nbsp;<span class="op" id="7934766">+</span>&nbsp;<span class="comment" id="7934768">//&nbsp;width=2,&nbsp;height=1</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7934791">&#34;\x80\x00\x00&#34;</span>&nbsp;<span class="comment" id="7934806">//&nbsp;headerFields=(a&nbsp;color&nbsp;map&nbsp;of&nbsp;2&nbsp;pixels),&nbsp;backgroundIndex,&nbsp;aspect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7934874">paletteStr</span>&nbsp;<span class="op" id="7934885">=</span>&nbsp;<span class="string" id="7934887">&#34;\x10\x20\x30\x40\x50\x60&#34;</span>&nbsp;<span class="comment" id="7934914">//&nbsp;the&nbsp;color&nbsp;map,&nbsp;also&nbsp;known&nbsp;as&nbsp;a&nbsp;palette</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7934957">trailerStr</span>&nbsp;<span class="op" id="7934968">=</span>&nbsp;<span class="string" id="7934970">&#34;\x3b&#34;</span><br>
<span class="lineno"></span><span class="op" id="7934977">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="7934980">//&nbsp;lzwEncode&nbsp;returns&nbsp;an&nbsp;LZW&nbsp;encoding&nbsp;(with&nbsp;2-bit&nbsp;literals)&nbsp;of&nbsp;n&nbsp;zeroes.</span><br>
<span class="lineno"></span><span class="keyword" id="7935052">func</span>&nbsp;<span class="ident" id="7935057">lzwEncode</span><span class="op" id="7935066">(</span><span class="ident" id="7935067">n</span>&nbsp;<span class="builtintype" id="7935069">int</span><span class="op" id="7935072">)</span>&nbsp;<span class="op" id="7935074">[</span><span class="op" id="7935075">]</span><span class="builtintype" id="7935076">byte</span>&nbsp;<span class="op" id="7935081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7935084">b</span>&nbsp;<span class="op" id="7935086">:=</span>&nbsp;<span class="op" id="7935089">&amp;</span><span class="ident" id="7935090">bytes</span><span class="op" id="7935095">.</span><span class="ident" id="7935096">Buffer</span><span class="op" id="7935102">{</span><span class="op" id="7935103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7935106">w</span>&nbsp;<span class="op" id="7935108">:=</span>&nbsp;<span class="ident" id="7935111">lzw</span><span class="op" id="7935114">.</span><span class="ident" id="7935115">NewWriter</span><span class="op" id="7935124">(</span><span class="ident" id="7935125">b</span><span class="op" id="7935126">,</span>&nbsp;<span class="ident" id="7935128">lzw</span><span class="op" id="7935131">.</span><span class="ident" id="7935132">LSB</span><span class="op" id="7935135">,</span>&nbsp;<span class="num" id="7935137">2</span><span class="op" id="7935138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7935141">w</span><span class="op" id="7935142">.</span><span class="ident" id="7935143">Write</span><span class="op" id="7935148">(</span><span class="builtinfunc" id="7935149">make</span><span class="op" id="7935153">(</span><span class="op" id="7935154">[</span><span class="op" id="7935155">]</span><span class="builtintype" id="7935156">byte</span><span class="op" id="7935160">,</span>&nbsp;<span class="ident" id="7935162">n</span><span class="op" id="7935163">)</span><span class="op" id="7935164">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7935167">w</span><span class="op" id="7935168">.</span><span class="ident" id="7935169">Close</span><span class="op" id="7935174">(</span><span class="op" id="7935175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7935178">return</span>&nbsp;<span class="ident" id="7935185">b</span><span class="op" id="7935186">.</span><span class="ident" id="7935187">Bytes</span><span class="op" id="7935192">(</span><span class="op" id="7935193">)</span><br>
<span class="lineno"></span><span class="op" id="7935195">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7935198">func</span>&nbsp;<span class="ident" id="7935203">TestDecode</span><span class="op" id="7935213">(</span><span class="ident" id="7935214">t</span>&nbsp;<span class="op" id="7935216">*</span><span class="ident" id="7935217">testing</span><span class="op" id="7935224">.</span><span class="ident" id="7935225">T</span><span class="op" id="7935226">)</span>&nbsp;<span class="op" id="7935228">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7935231">testCases</span>&nbsp;<span class="op" id="7935241">:=</span>&nbsp;<span class="op" id="7935244">[</span><span class="op" id="7935245">]</span><span class="keyword" id="7935246">struct</span>&nbsp;<span class="op" id="7935253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7935257">nPix</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7935265">int</span>&nbsp;&nbsp;<span class="comment" id="7935270">//&nbsp;The&nbsp;number&nbsp;of&nbsp;pixels&nbsp;in&nbsp;the&nbsp;image&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7935315">extra</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7935323">bool</span>&nbsp;<span class="comment" id="7935328">//&nbsp;Whether&nbsp;to&nbsp;write&nbsp;an&nbsp;extra&nbsp;block&nbsp;after&nbsp;the&nbsp;LZW-encoded&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7935393">wantErr</span>&nbsp;<span class="builtintype" id="7935401">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7935408">}</span><span class="op" id="7935409">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7935413">{</span><span class="num" id="7935414">0</span><span class="op" id="7935415">,</span>&nbsp;<span class="builtintype" id="7935417">false</span><span class="op" id="7935422">,</span>&nbsp;<span class="ident" id="7935424">errNotEnough</span><span class="op" id="7935436">}</span><span class="op" id="7935437">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7935441">{</span><span class="num" id="7935442">1</span><span class="op" id="7935443">,</span>&nbsp;<span class="builtintype" id="7935445">false</span><span class="op" id="7935450">,</span>&nbsp;<span class="ident" id="7935452">errNotEnough</span><span class="op" id="7935464">}</span><span class="op" id="7935465">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7935469">{</span><span class="num" id="7935470">2</span><span class="op" id="7935471">,</span>&nbsp;<span class="builtintype" id="7935473">false</span><span class="op" id="7935478">,</span>&nbsp;<span class="ident" id="7935480">nil</span><span class="op" id="7935483">}</span><span class="op" id="7935484">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7935488">{</span><span class="num" id="7935489">2</span><span class="op" id="7935490">,</span>&nbsp;<span class="builtintype" id="7935492">true</span><span class="op" id="7935496">,</span>&nbsp;<span class="ident" id="7935498">errTooMuch</span><span class="op" id="7935508">}</span><span class="op" id="7935509">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7935513">{</span><span class="num" id="7935514">3</span><span class="op" id="7935515">,</span>&nbsp;<span class="builtintype" id="7935517">false</span><span class="op" id="7935522">,</span>&nbsp;<span class="ident" id="7935524">errTooMuch</span><span class="op" id="7935534">}</span><span class="op" id="7935535">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7935538">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7935541">for</span>&nbsp;<span class="ident" id="7935545">_</span><span class="op" id="7935546">,</span>&nbsp;<span class="ident" id="7935548">tc</span>&nbsp;<span class="op" id="7935551">:=</span>&nbsp;<span class="keyword" id="7935554">range</span>&nbsp;<span class="ident" id="7935560">testCases</span>&nbsp;<span class="op" id="7935570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7935574">b</span>&nbsp;<span class="op" id="7935576">:=</span>&nbsp;<span class="op" id="7935579">&amp;</span><span class="ident" id="7935580">bytes</span><span class="op" id="7935585">.</span><span class="ident" id="7935586">Buffer</span><span class="op" id="7935592">{</span><span class="op" id="7935593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7935597">b</span><span class="op" id="7935598">.</span><span class="ident" id="7935599">WriteString</span><span class="op" id="7935610">(</span><span class="ident" id="7935611">headerStr</span><span class="op" id="7935620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7935624">b</span><span class="op" id="7935625">.</span><span class="ident" id="7935626">WriteString</span><span class="op" id="7935637">(</span><span class="ident" id="7935638">paletteStr</span><span class="op" id="7935648">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7935652">//&nbsp;Write&nbsp;an&nbsp;image&nbsp;with&nbsp;bounds&nbsp;2x1&nbsp;but&nbsp;tc.nPix&nbsp;pixels.&nbsp;If&nbsp;tc.nPix&nbsp;!=&nbsp;2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7935724">//&nbsp;then&nbsp;this&nbsp;should&nbsp;result&nbsp;in&nbsp;an&nbsp;invalid&nbsp;GIF&nbsp;image.&nbsp;First,&nbsp;write&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7935793">//&nbsp;magic&nbsp;0x2c&nbsp;(image&nbsp;descriptor)&nbsp;byte,&nbsp;bounds=(0,0)-(2,1),&nbsp;a&nbsp;flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7935862">//&nbsp;byte,&nbsp;and&nbsp;2-bit&nbsp;LZW&nbsp;literals.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7935897">b</span><span class="op" id="7935898">.</span><span class="ident" id="7935899">WriteString</span><span class="op" id="7935910">(</span><span class="string" id="7935911">&#34;\x2c\x00\x00\x00\x00\x02\x00\x01\x00\x00\x02&#34;</span><span class="op" id="7935957">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7935961">if</span>&nbsp;<span class="ident" id="7935964">tc</span><span class="op" id="7935966">.</span><span class="ident" id="7935967">nPix</span>&nbsp;<span class="op" id="7935972">&gt;</span>&nbsp;<span class="num" id="7935974">0</span>&nbsp;<span class="op" id="7935976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7935981">enc</span>&nbsp;<span class="op" id="7935985">:=</span>&nbsp;<span class="ident" id="7935988">lzwEncode</span><span class="op" id="7935997">(</span><span class="ident" id="7935998">tc</span><span class="op" id="7936000">.</span><span class="ident" id="7936001">nPix</span><span class="op" id="7936005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7936010">if</span>&nbsp;<span class="builtinfunc" id="7936013">len</span><span class="op" id="7936016">(</span><span class="ident" id="7936017">enc</span><span class="op" id="7936020">)</span>&nbsp;<span class="op" id="7936022">&gt;</span>&nbsp;<span class="num" id="7936024">0xff</span>&nbsp;<span class="op" id="7936029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7936035">t</span><span class="op" id="7936036">.</span><span class="ident" id="7936037">Errorf</span><span class="op" id="7936043">(</span><span class="string" id="7936044">&#34;nPix=%d,&nbsp;extra=%t:&nbsp;compressed&nbsp;length&nbsp;%d&nbsp;is&nbsp;too&nbsp;large&#34;</span><span class="op" id="7936098">,</span>&nbsp;<span class="ident" id="7936100">tc</span><span class="op" id="7936102">.</span><span class="ident" id="7936103">nPix</span><span class="op" id="7936107">,</span>&nbsp;<span class="ident" id="7936109">tc</span><span class="op" id="7936111">.</span><span class="ident" id="7936112">extra</span><span class="op" id="7936117">,</span>&nbsp;<span class="builtinfunc" id="7936119">len</span><span class="op" id="7936122">(</span><span class="ident" id="7936123">enc</span><span class="op" id="7936126">)</span><span class="op" id="7936127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7936133">continue</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7936145">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7936150">b</span><span class="op" id="7936151">.</span><span class="ident" id="7936152">WriteByte</span><span class="op" id="7936161">(</span><span class="builtintype" id="7936162">byte</span><span class="op" id="7936166">(</span><span class="builtinfunc" id="7936167">len</span><span class="op" id="7936170">(</span><span class="ident" id="7936171">enc</span><span class="op" id="7936174">)</span><span class="op" id="7936175">)</span><span class="op" id="7936176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7936181">b</span><span class="op" id="7936182">.</span><span class="ident" id="7936183">Write</span><span class="op" id="7936188">(</span><span class="ident" id="7936189">enc</span><span class="op" id="7936192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7936196">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7936200">if</span>&nbsp;<span class="ident" id="7936203">tc</span><span class="op" id="7936205">.</span><span class="ident" id="7936206">extra</span>&nbsp;<span class="op" id="7936212">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7936217">b</span><span class="op" id="7936218">.</span><span class="ident" id="7936219">WriteString</span><span class="op" id="7936230">(</span><span class="string" id="7936231">&#34;\x01\x02&#34;</span><span class="op" id="7936241">)</span>&nbsp;<span class="comment" id="7936243">//&nbsp;A&nbsp;1-byte&nbsp;payload&nbsp;with&nbsp;an&nbsp;0x02&nbsp;byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7936284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7936288">b</span><span class="op" id="7936289">.</span><span class="ident" id="7936290">WriteByte</span><span class="op" id="7936299">(</span><span class="num" id="7936300">0x00</span><span class="op" id="7936304">)</span>&nbsp;<span class="comment" id="7936306">//&nbsp;An&nbsp;empty&nbsp;block&nbsp;signifies&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;image&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7936363">b</span><span class="op" id="7936364">.</span><span class="ident" id="7936365">WriteString</span><span class="op" id="7936376">(</span><span class="ident" id="7936377">trailerStr</span><span class="op" id="7936387">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7936392">got</span><span class="op" id="7936395">,</span>&nbsp;<span class="ident" id="7936397">err</span>&nbsp;<span class="op" id="7936401">:=</span>&nbsp;<span class="ident" id="7936404">Decode</span><span class="op" id="7936410">(</span><span class="ident" id="7936411">b</span><span class="op" id="7936412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7936416">if</span>&nbsp;<span class="ident" id="7936419">err</span>&nbsp;<span class="op" id="7936423">!=</span>&nbsp;<span class="ident" id="7936426">tc</span><span class="op" id="7936428">.</span><span class="ident" id="7936429">wantErr</span>&nbsp;<span class="op" id="7936437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7936442">t</span><span class="op" id="7936443">.</span><span class="ident" id="7936444">Errorf</span><span class="op" id="7936450">(</span><span class="string" id="7936451">&#34;nPix=%d,&nbsp;extra=%t\ngot&nbsp;&nbsp;%v\nwant&nbsp;%v&#34;</span><span class="op" id="7936488">,</span>&nbsp;<span class="ident" id="7936490">tc</span><span class="op" id="7936492">.</span><span class="ident" id="7936493">nPix</span><span class="op" id="7936497">,</span>&nbsp;<span class="ident" id="7936499">tc</span><span class="op" id="7936501">.</span><span class="ident" id="7936502">extra</span><span class="op" id="7936507">,</span>&nbsp;<span class="ident" id="7936509">err</span><span class="op" id="7936512">,</span>&nbsp;<span class="ident" id="7936514">tc</span><span class="op" id="7936516">.</span><span class="ident" id="7936517">wantErr</span><span class="op" id="7936524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7936528">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7936533">if</span>&nbsp;<span class="ident" id="7936536">tc</span><span class="op" id="7936538">.</span><span class="ident" id="7936539">wantErr</span>&nbsp;<span class="op" id="7936547">!=</span>&nbsp;<span class="ident" id="7936550">nil</span>&nbsp;<span class="op" id="7936554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7936559">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7936570">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7936574">want</span>&nbsp;<span class="op" id="7936579">:=</span>&nbsp;<span class="op" id="7936582">&amp;</span><span class="ident" id="7936583">image</span><span class="op" id="7936588">.</span><span class="ident" id="7936589">Paletted</span><span class="op" id="7936597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7936602">Pix</span><span class="op" id="7936605">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7936610">[</span><span class="op" id="7936611">]</span><span class="builtintype" id="7936612">uint8</span><span class="op" id="7936617">{</span><span class="num" id="7936618">0</span><span class="op" id="7936619">,</span>&nbsp;<span class="num" id="7936621">0</span><span class="op" id="7936622">}</span><span class="op" id="7936623">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7936628">Stride</span><span class="op" id="7936634">:</span>&nbsp;<span class="num" id="7936636">2</span><span class="op" id="7936637">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7936642">Rect</span><span class="op" id="7936646">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7936650">image</span><span class="op" id="7936655">.</span><span class="ident" id="7936656">Rect</span><span class="op" id="7936660">(</span><span class="num" id="7936661">0</span><span class="op" id="7936662">,</span>&nbsp;<span class="num" id="7936664">0</span><span class="op" id="7936665">,</span>&nbsp;<span class="num" id="7936667">2</span><span class="op" id="7936668">,</span>&nbsp;<span class="num" id="7936670">1</span><span class="op" id="7936671">)</span><span class="op" id="7936672">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7936677">Palette</span><span class="op" id="7936684">:</span>&nbsp;<span class="ident" id="7936686">color</span><span class="op" id="7936691">.</span><span class="ident" id="7936692">Palette</span><span class="op" id="7936699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7936705">color</span><span class="op" id="7936710">.</span><span class="ident" id="7936711">RGBA</span><span class="op" id="7936715">{</span><span class="num" id="7936716">0x10</span><span class="op" id="7936720">,</span>&nbsp;<span class="num" id="7936722">0x20</span><span class="op" id="7936726">,</span>&nbsp;<span class="num" id="7936728">0x30</span><span class="op" id="7936732">,</span>&nbsp;<span class="num" id="7936734">0xff</span><span class="op" id="7936738">}</span><span class="op" id="7936739">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7936745">color</span><span class="op" id="7936750">.</span><span class="ident" id="7936751">RGBA</span><span class="op" id="7936755">{</span><span class="num" id="7936756">0x40</span><span class="op" id="7936760">,</span>&nbsp;<span class="num" id="7936762">0x50</span><span class="op" id="7936766">,</span>&nbsp;<span class="num" id="7936768">0x60</span><span class="op" id="7936772">,</span>&nbsp;<span class="num" id="7936774">0xff</span><span class="op" id="7936778">}</span><span class="op" id="7936779">,</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7936784">}</span><span class="op" id="7936785">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7936789">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7936793">if</span>&nbsp;<span class="op" id="7936796">!</span><span class="ident" id="7936797">reflect</span><span class="op" id="7936804">.</span><span class="ident" id="7936805">DeepEqual</span><span class="op" id="7936814">(</span><span class="ident" id="7936815">got</span><span class="op" id="7936818">,</span>&nbsp;<span class="ident" id="7936820">want</span><span class="op" id="7936824">)</span>&nbsp;<span class="op" id="7936826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7936831">t</span><span class="op" id="7936832">.</span><span class="ident" id="7936833">Errorf</span><span class="op" id="7936839">(</span><span class="string" id="7936840">&#34;nPix=%d,&nbsp;extra=%t\ngot&nbsp;&nbsp;%v\nwant&nbsp;%v&#34;</span><span class="op" id="7936877">,</span>&nbsp;<span class="ident" id="7936879">tc</span><span class="op" id="7936881">.</span><span class="ident" id="7936882">nPix</span><span class="op" id="7936886">,</span>&nbsp;<span class="ident" id="7936888">tc</span><span class="op" id="7936890">.</span><span class="ident" id="7936891">extra</span><span class="op" id="7936896">,</span>&nbsp;<span class="ident" id="7936898">got</span><span class="op" id="7936901">,</span>&nbsp;<span class="ident" id="7936903">want</span><span class="op" id="7936907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7936911">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7936914">}</span><br>
<span class="lineno"></span><span class="op" id="7936916">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7936919">func</span>&nbsp;<span class="ident" id="7936924">TestTransparentIndex</span><span class="op" id="7936944">(</span><span class="ident" id="7936945">t</span>&nbsp;<span class="op" id="7936947">*</span><span class="ident" id="7936948">testing</span><span class="op" id="7936955">.</span><span class="ident" id="7936956">T</span><span class="op" id="7936957">)</span>&nbsp;<span class="op" id="7936959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7936962">b</span>&nbsp;<span class="op" id="7936964">:=</span>&nbsp;<span class="op" id="7936967">&amp;</span><span class="ident" id="7936968">bytes</span><span class="op" id="7936973">.</span><span class="ident" id="7936974">Buffer</span><span class="op" id="7936980">{</span><span class="op" id="7936981">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7936984">b</span><span class="op" id="7936985">.</span><span class="ident" id="7936986">WriteString</span><span class="op" id="7936997">(</span><span class="ident" id="7936998">headerStr</span><span class="op" id="7937007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7937010">b</span><span class="op" id="7937011">.</span><span class="ident" id="7937012">WriteString</span><span class="op" id="7937023">(</span><span class="ident" id="7937024">paletteStr</span><span class="op" id="7937034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7937037">for</span>&nbsp;<span class="ident" id="7937041">transparentIndex</span>&nbsp;<span class="op" id="7937058">:=</span>&nbsp;<span class="num" id="7937061">0</span><span class="op" id="7937062">;</span>&nbsp;<span class="ident" id="7937064">transparentIndex</span>&nbsp;<span class="op" id="7937081">&lt;</span>&nbsp;<span class="num" id="7937083">3</span><span class="op" id="7937084">;</span>&nbsp;<span class="ident" id="7937086">transparentIndex</span><span class="op" id="7937102">++</span>&nbsp;<span class="op" id="7937105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7937109">if</span>&nbsp;<span class="ident" id="7937112">transparentIndex</span>&nbsp;<span class="op" id="7937129">&lt;</span>&nbsp;<span class="num" id="7937131">2</span>&nbsp;<span class="op" id="7937133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7937138">//&nbsp;Write&nbsp;the&nbsp;graphic&nbsp;control&nbsp;for&nbsp;the&nbsp;transparent&nbsp;index.</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7937197">b</span><span class="op" id="7937198">.</span><span class="ident" id="7937199">WriteString</span><span class="op" id="7937210">(</span><span class="string" id="7937211">&#34;\x21\xf9\x00\x01\x00\x00&#34;</span><span class="op" id="7937237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7937242">b</span><span class="op" id="7937243">.</span><span class="ident" id="7937244">WriteByte</span><span class="op" id="7937253">(</span><span class="builtintype" id="7937254">byte</span><span class="op" id="7937258">(</span><span class="ident" id="7937259">transparentIndex</span><span class="op" id="7937275">)</span><span class="op" id="7937276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7937281">b</span><span class="op" id="7937282">.</span><span class="ident" id="7937283">WriteByte</span><span class="op" id="7937292">(</span><span class="num" id="7937293">0</span><span class="op" id="7937294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7937298">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7937302">//&nbsp;Write&nbsp;an&nbsp;image&nbsp;with&nbsp;bounds&nbsp;2x1,&nbsp;as&nbsp;per&nbsp;TestDecode.</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7937358">b</span><span class="op" id="7937359">.</span><span class="ident" id="7937360">WriteString</span><span class="op" id="7937371">(</span><span class="string" id="7937372">&#34;\x2c\x00\x00\x00\x00\x02\x00\x01\x00\x00\x02&#34;</span><span class="op" id="7937418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7937422">enc</span>&nbsp;<span class="op" id="7937426">:=</span>&nbsp;<span class="ident" id="7937429">lzwEncode</span><span class="op" id="7937438">(</span><span class="num" id="7937439">2</span><span class="op" id="7937440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7937444">if</span>&nbsp;<span class="builtinfunc" id="7937447">len</span><span class="op" id="7937450">(</span><span class="ident" id="7937451">enc</span><span class="op" id="7937454">)</span>&nbsp;<span class="op" id="7937456">&gt;</span>&nbsp;<span class="num" id="7937458">0xff</span>&nbsp;<span class="op" id="7937463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7937468">t</span><span class="op" id="7937469">.</span><span class="ident" id="7937470">Fatalf</span><span class="op" id="7937476">(</span><span class="string" id="7937477">&#34;compressed&nbsp;length&nbsp;%d&nbsp;is&nbsp;too&nbsp;large&#34;</span><span class="op" id="7937512">,</span>&nbsp;<span class="builtinfunc" id="7937514">len</span><span class="op" id="7937517">(</span><span class="ident" id="7937518">enc</span><span class="op" id="7937521">)</span><span class="op" id="7937522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7937526">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7937530">b</span><span class="op" id="7937531">.</span><span class="ident" id="7937532">WriteByte</span><span class="op" id="7937541">(</span><span class="builtintype" id="7937542">byte</span><span class="op" id="7937546">(</span><span class="builtinfunc" id="7937547">len</span><span class="op" id="7937550">(</span><span class="ident" id="7937551">enc</span><span class="op" id="7937554">)</span><span class="op" id="7937555">)</span><span class="op" id="7937556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7937560">b</span><span class="op" id="7937561">.</span><span class="ident" id="7937562">Write</span><span class="op" id="7937567">(</span><span class="ident" id="7937568">enc</span><span class="op" id="7937571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7937575">b</span><span class="op" id="7937576">.</span><span class="ident" id="7937577">WriteByte</span><span class="op" id="7937586">(</span><span class="num" id="7937587">0x00</span><span class="op" id="7937591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7937594">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7937597">b</span><span class="op" id="7937598">.</span><span class="ident" id="7937599">WriteString</span><span class="op" id="7937610">(</span><span class="ident" id="7937611">trailerStr</span><span class="op" id="7937621">)</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7937625">g</span><span class="op" id="7937626">,</span>&nbsp;<span class="ident" id="7937628">err</span>&nbsp;<span class="op" id="7937632">:=</span>&nbsp;<span class="ident" id="7937635">DecodeAll</span><span class="op" id="7937644">(</span><span class="ident" id="7937645">b</span><span class="op" id="7937646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7937649">if</span>&nbsp;<span class="ident" id="7937652">err</span>&nbsp;<span class="op" id="7937656">!=</span>&nbsp;<span class="ident" id="7937659">nil</span>&nbsp;<span class="op" id="7937663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7937667">t</span><span class="op" id="7937668">.</span><span class="ident" id="7937669">Fatalf</span><span class="op" id="7937675">(</span><span class="string" id="7937676">&#34;DecodeAll:&nbsp;%v&#34;</span><span class="op" id="7937691">,</span>&nbsp;<span class="ident" id="7937693">err</span><span class="op" id="7937696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7937699">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7937702">c0</span>&nbsp;<span class="op" id="7937705">:=</span>&nbsp;<span class="ident" id="7937708">color</span><span class="op" id="7937713">.</span><span class="ident" id="7937714">RGBA</span><span class="op" id="7937718">{</span><span class="ident" id="7937719">paletteStr</span><span class="op" id="7937729">[</span><span class="num" id="7937730">0</span><span class="op" id="7937731">]</span><span class="op" id="7937732">,</span>&nbsp;<span class="ident" id="7937734">paletteStr</span><span class="op" id="7937744">[</span><span class="num" id="7937745">1</span><span class="op" id="7937746">]</span><span class="op" id="7937747">,</span>&nbsp;<span class="ident" id="7937749">paletteStr</span><span class="op" id="7937759">[</span><span class="num" id="7937760">2</span><span class="op" id="7937761">]</span><span class="op" id="7937762">,</span>&nbsp;<span class="num" id="7937764">0xff</span><span class="op" id="7937768">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7937771">c1</span>&nbsp;<span class="op" id="7937774">:=</span>&nbsp;<span class="ident" id="7937777">color</span><span class="op" id="7937782">.</span><span class="ident" id="7937783">RGBA</span><span class="op" id="7937787">{</span><span class="ident" id="7937788">paletteStr</span><span class="op" id="7937798">[</span><span class="num" id="7937799">3</span><span class="op" id="7937800">]</span><span class="op" id="7937801">,</span>&nbsp;<span class="ident" id="7937803">paletteStr</span><span class="op" id="7937813">[</span><span class="num" id="7937814">4</span><span class="op" id="7937815">]</span><span class="op" id="7937816">,</span>&nbsp;<span class="ident" id="7937818">paletteStr</span><span class="op" id="7937828">[</span><span class="num" id="7937829">5</span><span class="op" id="7937830">]</span><span class="op" id="7937831">,</span>&nbsp;<span class="num" id="7937833">0xff</span><span class="op" id="7937837">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7937840">cz</span>&nbsp;<span class="op" id="7937843">:=</span>&nbsp;<span class="ident" id="7937846">color</span><span class="op" id="7937851">.</span><span class="ident" id="7937852">RGBA</span><span class="op" id="7937856">{</span><span class="op" id="7937857">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7937860">wants</span>&nbsp;<span class="op" id="7937866">:=</span>&nbsp;<span class="op" id="7937869">[</span><span class="op" id="7937870">]</span><span class="ident" id="7937871">color</span><span class="op" id="7937876">.</span><span class="ident" id="7937877">Palette</span><span class="op" id="7937884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7937888">{</span><span class="ident" id="7937889">cz</span><span class="op" id="7937891">,</span>&nbsp;<span class="ident" id="7937893">c1</span><span class="op" id="7937895">}</span><span class="op" id="7937896">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7937900">{</span><span class="ident" id="7937901">c0</span><span class="op" id="7937903">,</span>&nbsp;<span class="ident" id="7937905">cz</span><span class="op" id="7937907">}</span><span class="op" id="7937908">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7937912">{</span><span class="ident" id="7937913">c0</span><span class="op" id="7937915">,</span>&nbsp;<span class="ident" id="7937917">c1</span><span class="op" id="7937919">}</span><span class="op" id="7937920">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7937923">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7937926">if</span>&nbsp;<span class="builtinfunc" id="7937929">len</span><span class="op" id="7937932">(</span><span class="ident" id="7937933">g</span><span class="op" id="7937934">.</span><span class="ident" id="7937935">Image</span><span class="op" id="7937940">)</span>&nbsp;<span class="op" id="7937942">!=</span>&nbsp;<span class="builtinfunc" id="7937945">len</span><span class="op" id="7937948">(</span><span class="ident" id="7937949">wants</span><span class="op" id="7937954">)</span>&nbsp;<span class="op" id="7937956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7937960">t</span><span class="op" id="7937961">.</span><span class="ident" id="7937962">Fatalf</span><span class="op" id="7937968">(</span><span class="string" id="7937969">&#34;got&nbsp;%d&nbsp;images,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7937993">,</span>&nbsp;<span class="builtinfunc" id="7937995">len</span><span class="op" id="7937998">(</span><span class="ident" id="7937999">g</span><span class="op" id="7938000">.</span><span class="ident" id="7938001">Image</span><span class="op" id="7938006">)</span><span class="op" id="7938007">,</span>&nbsp;<span class="builtinfunc" id="7938009">len</span><span class="op" id="7938012">(</span><span class="ident" id="7938013">wants</span><span class="op" id="7938018">)</span><span class="op" id="7938019">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7938022">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7938025">for</span>&nbsp;<span class="ident" id="7938029">i</span><span class="op" id="7938030">,</span>&nbsp;<span class="ident" id="7938032">want</span>&nbsp;<span class="op" id="7938037">:=</span>&nbsp;<span class="keyword" id="7938040">range</span>&nbsp;<span class="ident" id="7938046">wants</span>&nbsp;<span class="op" id="7938052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7938056">got</span>&nbsp;<span class="op" id="7938060">:=</span>&nbsp;<span class="ident" id="7938063">g</span><span class="op" id="7938064">.</span><span class="ident" id="7938065">Image</span><span class="op" id="7938070">[</span><span class="ident" id="7938071">i</span><span class="op" id="7938072">]</span><span class="op" id="7938073">.</span><span class="ident" id="7938074">Palette</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7938084">if</span>&nbsp;<span class="op" id="7938087">!</span><span class="ident" id="7938088">reflect</span><span class="op" id="7938095">.</span><span class="ident" id="7938096">DeepEqual</span><span class="op" id="7938105">(</span><span class="ident" id="7938106">got</span><span class="op" id="7938109">,</span>&nbsp;<span class="ident" id="7938111">want</span><span class="op" id="7938115">)</span>&nbsp;<span class="op" id="7938117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7938122">t</span><span class="op" id="7938123">.</span><span class="ident" id="7938124">Errorf</span><span class="op" id="7938130">(</span><span class="string" id="7938131">&#34;palette&nbsp;#%d:\ngot&nbsp;&nbsp;%v\nwant&nbsp;%v&#34;</span><span class="op" id="7938163">,</span>&nbsp;<span class="ident" id="7938165">i</span><span class="op" id="7938166">,</span>&nbsp;<span class="ident" id="7938168">got</span><span class="op" id="7938171">,</span>&nbsp;<span class="ident" id="7938173">want</span><span class="op" id="7938177">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7938181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7938184">}</span><br>
<span class="lineno"></span><span class="op" id="7938186">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7938189">//&nbsp;testGIF&nbsp;is&nbsp;a&nbsp;simple&nbsp;GIF&nbsp;that&nbsp;we&nbsp;can&nbsp;modify&nbsp;to&nbsp;test&nbsp;different&nbsp;scenarios.</span><br>
<span class="lineno">140</span><span class="keyword" id="7938264">var</span>&nbsp;<span class="ident" id="7938268">testGIF</span>&nbsp;<span class="op" id="7938276">=</span>&nbsp;<span class="op" id="7938278">[</span><span class="op" id="7938279">]</span><span class="builtintype" id="7938280">byte</span><span class="op" id="7938284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7938287">&#39;G&#39;</span><span class="op" id="7938290">,</span>&nbsp;<span class="string" id="7938292">&#39;I&#39;</span><span class="op" id="7938295">,</span>&nbsp;<span class="string" id="7938297">&#39;F&#39;</span><span class="op" id="7938300">,</span>&nbsp;<span class="string" id="7938302">&#39;8&#39;</span><span class="op" id="7938305">,</span>&nbsp;<span class="string" id="7938307">&#39;9&#39;</span><span class="op" id="7938310">,</span>&nbsp;<span class="string" id="7938312">&#39;a&#39;</span><span class="op" id="7938315">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7938318">1</span><span class="op" id="7938319">,</span>&nbsp;<span class="num" id="7938321">0</span><span class="op" id="7938322">,</span>&nbsp;<span class="num" id="7938324">1</span><span class="op" id="7938325">,</span>&nbsp;<span class="num" id="7938327">0</span><span class="op" id="7938328">,</span>&nbsp;<span class="comment" id="7938330">//&nbsp;w=1,&nbsp;h=1&nbsp;(6)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7938347">128</span><span class="op" id="7938350">,</span>&nbsp;<span class="num" id="7938352">0</span><span class="op" id="7938353">,</span>&nbsp;<span class="num" id="7938355">0</span><span class="op" id="7938356">,</span>&nbsp;<span class="comment" id="7938358">//&nbsp;headerFields,&nbsp;bg,&nbsp;aspect&nbsp;(10)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7938392">0</span><span class="op" id="7938393">,</span>&nbsp;<span class="num" id="7938395">0</span><span class="op" id="7938396">,</span>&nbsp;<span class="num" id="7938398">0</span><span class="op" id="7938399">,</span>&nbsp;<span class="num" id="7938401">1</span><span class="op" id="7938402">,</span>&nbsp;<span class="num" id="7938404">1</span><span class="op" id="7938405">,</span>&nbsp;<span class="num" id="7938407">1</span><span class="op" id="7938408">,</span>&nbsp;<span class="comment" id="7938410">//&nbsp;color&nbsp;map&nbsp;and&nbsp;graphics&nbsp;control&nbsp;(13)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7938450">0x21</span><span class="op" id="7938454">,</span>&nbsp;<span class="num" id="7938456">0xf9</span><span class="op" id="7938460">,</span>&nbsp;<span class="num" id="7938462">0x04</span><span class="op" id="7938466">,</span>&nbsp;<span class="num" id="7938468">0x00</span><span class="op" id="7938472">,</span>&nbsp;<span class="num" id="7938474">0x00</span><span class="op" id="7938478">,</span>&nbsp;<span class="num" id="7938480">0x00</span><span class="op" id="7938484">,</span>&nbsp;<span class="num" id="7938486">0xff</span><span class="op" id="7938490">,</span>&nbsp;<span class="num" id="7938492">0x00</span><span class="op" id="7938496">,</span>&nbsp;<span class="comment" id="7938498">//&nbsp;(19)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7938507">//&nbsp;frame&nbsp;1&nbsp;(0,0&nbsp;-&nbsp;1,1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7938531">0x2c</span><span class="op" id="7938535">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7938538">0x00</span><span class="op" id="7938542">,</span>&nbsp;<span class="num" id="7938544">0x00</span><span class="op" id="7938548">,</span>&nbsp;<span class="num" id="7938550">0x00</span><span class="op" id="7938554">,</span>&nbsp;<span class="num" id="7938556">0x00</span><span class="op" id="7938560">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7938563">0x01</span><span class="op" id="7938567">,</span>&nbsp;<span class="num" id="7938569">0x00</span><span class="op" id="7938573">,</span>&nbsp;<span class="num" id="7938575">0x01</span><span class="op" id="7938579">,</span>&nbsp;<span class="num" id="7938581">0x00</span><span class="op" id="7938585">,</span>&nbsp;<span class="comment" id="7938587">//&nbsp;(32)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7938596">0x00</span><span class="op" id="7938600">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7938603">0x02</span><span class="op" id="7938607">,</span>&nbsp;<span class="num" id="7938609">0x02</span><span class="op" id="7938613">,</span>&nbsp;<span class="num" id="7938615">0x4c</span><span class="op" id="7938619">,</span>&nbsp;<span class="num" id="7938621">0x01</span><span class="op" id="7938625">,</span>&nbsp;<span class="num" id="7938627">0x00</span><span class="op" id="7938631">,</span>&nbsp;<span class="comment" id="7938633">//&nbsp;lzw&nbsp;pixels</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7938648">//&nbsp;trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7938660">0x3b</span><span class="op" id="7938664">,</span><br>
<span class="lineno"></span><span class="op" id="7938666">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="keyword" id="7938669">func</span>&nbsp;<span class="ident" id="7938674">try</span><span class="op" id="7938677">(</span><span class="ident" id="7938678">t</span>&nbsp;<span class="op" id="7938680">*</span><span class="ident" id="7938681">testing</span><span class="op" id="7938688">.</span><span class="ident" id="7938689">T</span><span class="op" id="7938690">,</span>&nbsp;<span class="ident" id="7938692">b</span>&nbsp;<span class="op" id="7938694">[</span><span class="op" id="7938695">]</span><span class="builtintype" id="7938696">byte</span><span class="op" id="7938700">,</span>&nbsp;<span class="ident" id="7938702">want</span>&nbsp;<span class="builtintype" id="7938707">string</span><span class="op" id="7938713">)</span>&nbsp;<span class="op" id="7938715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7938718">_</span><span class="op" id="7938719">,</span>&nbsp;<span class="ident" id="7938721">err</span>&nbsp;<span class="op" id="7938725">:=</span>&nbsp;<span class="ident" id="7938728">DecodeAll</span><span class="op" id="7938737">(</span><span class="ident" id="7938738">bytes</span><span class="op" id="7938743">.</span><span class="ident" id="7938744">NewReader</span><span class="op" id="7938753">(</span><span class="ident" id="7938754">b</span><span class="op" id="7938755">)</span><span class="op" id="7938756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7938759">var</span>&nbsp;<span class="ident" id="7938763">got</span>&nbsp;<span class="builtintype" id="7938767">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7938775">if</span>&nbsp;<span class="ident" id="7938778">err</span>&nbsp;<span class="op" id="7938782">!=</span>&nbsp;<span class="ident" id="7938785">nil</span>&nbsp;<span class="op" id="7938789">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7938793">got</span>&nbsp;<span class="op" id="7938797">=</span>&nbsp;<span class="ident" id="7938799">err</span><span class="op" id="7938802">.</span><span class="ident" id="7938803">Error</span><span class="op" id="7938808">(</span><span class="op" id="7938809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7938812">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7938815">if</span>&nbsp;<span class="ident" id="7938818">got</span>&nbsp;<span class="op" id="7938822">!=</span>&nbsp;<span class="ident" id="7938825">want</span>&nbsp;<span class="op" id="7938830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7938834">t</span><span class="op" id="7938835">.</span><span class="ident" id="7938836">Fatalf</span><span class="op" id="7938842">(</span><span class="string" id="7938843">&#34;got&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7938860">,</span>&nbsp;<span class="ident" id="7938862">got</span><span class="op" id="7938865">,</span>&nbsp;<span class="ident" id="7938867">want</span><span class="op" id="7938871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7938874">}</span><br>
<span class="lineno">165</span><span class="op" id="7938876">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7938879">func</span>&nbsp;<span class="ident" id="7938884">TestBounds</span><span class="op" id="7938894">(</span><span class="ident" id="7938895">t</span>&nbsp;<span class="op" id="7938897">*</span><span class="ident" id="7938898">testing</span><span class="op" id="7938905">.</span><span class="ident" id="7938906">T</span><span class="op" id="7938907">)</span>&nbsp;<span class="op" id="7938909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7938912">//&nbsp;Make&nbsp;a&nbsp;local&nbsp;copy&nbsp;of&nbsp;testGIF.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7938946">gif</span>&nbsp;<span class="op" id="7938950">:=</span>&nbsp;<span class="builtinfunc" id="7938953">make</span><span class="op" id="7938957">(</span><span class="op" id="7938958">[</span><span class="op" id="7938959">]</span><span class="builtintype" id="7938960">byte</span><span class="op" id="7938964">,</span>&nbsp;<span class="builtinfunc" id="7938966">len</span><span class="op" id="7938969">(</span><span class="ident" id="7938970">testGIF</span><span class="op" id="7938977">)</span><span class="op" id="7938978">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7938981">copy</span><span class="op" id="7938985">(</span><span class="ident" id="7938986">gif</span><span class="op" id="7938989">,</span>&nbsp;<span class="ident" id="7938991">testGIF</span><span class="op" id="7938998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7939001">//&nbsp;Make&nbsp;the&nbsp;bounds&nbsp;too&nbsp;big,&nbsp;just&nbsp;by&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7939043">gif</span><span class="op" id="7939046">[</span><span class="num" id="7939047">32</span><span class="op" id="7939049">]</span>&nbsp;<span class="op" id="7939051">=</span>&nbsp;<span class="num" id="7939053">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7939056">want</span>&nbsp;<span class="op" id="7939061">:=</span>&nbsp;<span class="string" id="7939064">&#34;gif:&nbsp;frame&nbsp;bounds&nbsp;larger&nbsp;than&nbsp;image&nbsp;bounds&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7939110">try</span><span class="op" id="7939113">(</span><span class="ident" id="7939114">t</span><span class="op" id="7939115">,</span>&nbsp;<span class="ident" id="7939117">gif</span><span class="op" id="7939120">,</span>&nbsp;<span class="ident" id="7939122">want</span><span class="op" id="7939126">)</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7939130">//&nbsp;Make&nbsp;the&nbsp;bounds&nbsp;too&nbsp;small;&nbsp;does&nbsp;not&nbsp;trigger&nbsp;bounds</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7939185">//&nbsp;check,&nbsp;but&nbsp;now&nbsp;there&#39;s&nbsp;too&nbsp;much&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7939227">gif</span><span class="op" id="7939230">[</span><span class="num" id="7939231">32</span><span class="op" id="7939233">]</span>&nbsp;<span class="op" id="7939235">=</span>&nbsp;<span class="num" id="7939237">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7939240">want</span>&nbsp;<span class="op" id="7939245">=</span>&nbsp;<span class="string" id="7939247">&#34;gif:&nbsp;too&nbsp;much&nbsp;image&nbsp;data&#34;</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7939275">try</span><span class="op" id="7939278">(</span><span class="ident" id="7939279">t</span><span class="op" id="7939280">,</span>&nbsp;<span class="ident" id="7939282">gif</span><span class="op" id="7939285">,</span>&nbsp;<span class="ident" id="7939287">want</span><span class="op" id="7939291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7939294">gif</span><span class="op" id="7939297">[</span><span class="num" id="7939298">32</span><span class="op" id="7939300">]</span>&nbsp;<span class="op" id="7939302">=</span>&nbsp;<span class="num" id="7939304">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7939308">//&nbsp;Make&nbsp;the&nbsp;bounds&nbsp;really&nbsp;big,&nbsp;expect&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7939357">want</span>&nbsp;<span class="op" id="7939362">=</span>&nbsp;<span class="string" id="7939364">&#34;gif:&nbsp;frame&nbsp;bounds&nbsp;larger&nbsp;than&nbsp;image&nbsp;bounds&#34;</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7939410">for</span>&nbsp;<span class="ident" id="7939414">i</span>&nbsp;<span class="op" id="7939416">:=</span>&nbsp;<span class="num" id="7939419">0</span><span class="op" id="7939420">;</span>&nbsp;<span class="ident" id="7939422">i</span>&nbsp;<span class="op" id="7939424">&lt;</span>&nbsp;<span class="num" id="7939426">4</span><span class="op" id="7939427">;</span>&nbsp;<span class="ident" id="7939429">i</span><span class="op" id="7939430">++</span>&nbsp;<span class="op" id="7939433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7939437">gif</span><span class="op" id="7939440">[</span><span class="num" id="7939441">32</span><span class="op" id="7939443">+</span><span class="ident" id="7939444">i</span><span class="op" id="7939445">]</span>&nbsp;<span class="op" id="7939447">=</span>&nbsp;<span class="num" id="7939449">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7939455">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7939458">try</span><span class="op" id="7939461">(</span><span class="ident" id="7939462">t</span><span class="op" id="7939463">,</span>&nbsp;<span class="ident" id="7939465">gif</span><span class="op" id="7939468">,</span>&nbsp;<span class="ident" id="7939470">want</span><span class="op" id="7939474">)</span><br>
<span class="lineno"></span><span class="op" id="7939476">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="keyword" id="7939479">func</span>&nbsp;<span class="ident" id="7939484">TestNoPalette</span><span class="op" id="7939497">(</span><span class="ident" id="7939498">t</span>&nbsp;<span class="op" id="7939500">*</span><span class="ident" id="7939501">testing</span><span class="op" id="7939508">.</span><span class="ident" id="7939509">T</span><span class="op" id="7939510">)</span>&nbsp;<span class="op" id="7939512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7939515">b</span>&nbsp;<span class="op" id="7939517">:=</span>&nbsp;<span class="op" id="7939520">&amp;</span><span class="ident" id="7939521">bytes</span><span class="op" id="7939526">.</span><span class="ident" id="7939527">Buffer</span><span class="op" id="7939533">{</span><span class="op" id="7939534">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7939538">//&nbsp;Manufacture&nbsp;a&nbsp;GIF&nbsp;with&nbsp;no&nbsp;palette,&nbsp;so&nbsp;any&nbsp;pixel&nbsp;at&nbsp;all</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7939597">//&nbsp;will&nbsp;be&nbsp;invalid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7939618">b</span><span class="op" id="7939619">.</span><span class="ident" id="7939620">WriteString</span><span class="op" id="7939631">(</span><span class="ident" id="7939632">headerStr</span><span class="op" id="7939641">[</span><span class="op" id="7939642">:</span><span class="builtinfunc" id="7939643">len</span><span class="op" id="7939646">(</span><span class="ident" id="7939647">headerStr</span><span class="op" id="7939656">)</span><span class="op" id="7939657">-</span><span class="num" id="7939658">3</span><span class="op" id="7939659">]</span><span class="op" id="7939660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7939663">b</span><span class="op" id="7939664">.</span><span class="ident" id="7939665">WriteString</span><span class="op" id="7939676">(</span><span class="string" id="7939677">&#34;\x00\x00\x00&#34;</span><span class="op" id="7939691">)</span>&nbsp;<span class="comment" id="7939693">//&nbsp;No&nbsp;global&nbsp;palette.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7939717">//&nbsp;Image&nbsp;descriptor:&nbsp;2x1,&nbsp;no&nbsp;local&nbsp;palette.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7939762">b</span><span class="op" id="7939763">.</span><span class="ident" id="7939764">WriteString</span><span class="op" id="7939775">(</span><span class="string" id="7939776">&#34;\x2c\x00\x00\x00\x00\x02\x00\x01\x00\x00\x02&#34;</span><span class="op" id="7939822">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7939826">//&nbsp;Encode&nbsp;the&nbsp;pixels:&nbsp;neither&nbsp;is&nbsp;in&nbsp;range,&nbsp;because&nbsp;there&nbsp;is&nbsp;no&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7939899">pix</span>&nbsp;<span class="op" id="7939903">:=</span>&nbsp;<span class="op" id="7939906">[</span><span class="op" id="7939907">]</span><span class="builtintype" id="7939908">byte</span><span class="op" id="7939912">{</span><span class="num" id="7939913">0</span><span class="op" id="7939914">,</span>&nbsp;<span class="num" id="7939916">128</span><span class="op" id="7939919">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7939922">enc</span>&nbsp;<span class="op" id="7939926">:=</span>&nbsp;<span class="op" id="7939929">&amp;</span><span class="ident" id="7939930">bytes</span><span class="op" id="7939935">.</span><span class="ident" id="7939936">Buffer</span><span class="op" id="7939942">{</span><span class="op" id="7939943">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7939946">w</span>&nbsp;<span class="op" id="7939948">:=</span>&nbsp;<span class="ident" id="7939951">lzw</span><span class="op" id="7939954">.</span><span class="ident" id="7939955">NewWriter</span><span class="op" id="7939964">(</span><span class="ident" id="7939965">enc</span><span class="op" id="7939968">,</span>&nbsp;<span class="ident" id="7939970">lzw</span><span class="op" id="7939973">.</span><span class="ident" id="7939974">LSB</span><span class="op" id="7939977">,</span>&nbsp;<span class="num" id="7939979">2</span><span class="op" id="7939980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7939983">w</span><span class="op" id="7939984">.</span><span class="ident" id="7939985">Write</span><span class="op" id="7939990">(</span><span class="ident" id="7939991">pix</span><span class="op" id="7939994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7939997">w</span><span class="op" id="7939998">.</span><span class="ident" id="7939999">Close</span><span class="op" id="7940004">(</span><span class="op" id="7940005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7940008">b</span><span class="op" id="7940009">.</span><span class="ident" id="7940010">WriteByte</span><span class="op" id="7940019">(</span><span class="builtintype" id="7940020">byte</span><span class="op" id="7940024">(</span><span class="builtinfunc" id="7940025">len</span><span class="op" id="7940028">(</span><span class="ident" id="7940029">enc</span><span class="op" id="7940032">.</span><span class="ident" id="7940033">Bytes</span><span class="op" id="7940038">(</span><span class="op" id="7940039">)</span><span class="op" id="7940040">)</span><span class="op" id="7940041">)</span><span class="op" id="7940042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7940045">b</span><span class="op" id="7940046">.</span><span class="ident" id="7940047">Write</span><span class="op" id="7940052">(</span><span class="ident" id="7940053">enc</span><span class="op" id="7940056">.</span><span class="ident" id="7940057">Bytes</span><span class="op" id="7940062">(</span><span class="op" id="7940063">)</span><span class="op" id="7940064">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7940067">b</span><span class="op" id="7940068">.</span><span class="ident" id="7940069">WriteByte</span><span class="op" id="7940078">(</span><span class="num" id="7940079">0x00</span><span class="op" id="7940083">)</span>&nbsp;<span class="comment" id="7940085">//&nbsp;An&nbsp;empty&nbsp;block&nbsp;signifies&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;image&nbsp;data.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7940142">b</span><span class="op" id="7940143">.</span><span class="ident" id="7940144">WriteString</span><span class="op" id="7940155">(</span><span class="ident" id="7940156">trailerStr</span><span class="op" id="7940166">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7940170">try</span><span class="op" id="7940173">(</span><span class="ident" id="7940174">t</span><span class="op" id="7940175">,</span>&nbsp;<span class="ident" id="7940177">b</span><span class="op" id="7940178">.</span><span class="ident" id="7940179">Bytes</span><span class="op" id="7940184">(</span><span class="op" id="7940185">)</span><span class="op" id="7940186">,</span>&nbsp;<span class="string" id="7940188">&#34;gif:&nbsp;invalid&nbsp;pixel&nbsp;value&#34;</span><span class="op" id="7940214">)</span><br>
<span class="lineno">215</span><span class="op" id="7940216">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7940219">func</span>&nbsp;<span class="ident" id="7940224">TestPixelOutsidePaletteRange</span><span class="op" id="7940252">(</span><span class="ident" id="7940253">t</span>&nbsp;<span class="op" id="7940255">*</span><span class="ident" id="7940256">testing</span><span class="op" id="7940263">.</span><span class="ident" id="7940264">T</span><span class="op" id="7940265">)</span>&nbsp;<span class="op" id="7940267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7940270">for</span>&nbsp;<span class="ident" id="7940274">_</span><span class="op" id="7940275">,</span>&nbsp;<span class="ident" id="7940277">pval</span>&nbsp;<span class="op" id="7940282">:=</span>&nbsp;<span class="keyword" id="7940285">range</span>&nbsp;<span class="op" id="7940291">[</span><span class="op" id="7940292">]</span><span class="builtintype" id="7940293">byte</span><span class="op" id="7940297">{</span><span class="num" id="7940298">0</span><span class="op" id="7940299">,</span>&nbsp;<span class="num" id="7940301">1</span><span class="op" id="7940302">,</span>&nbsp;<span class="num" id="7940304">2</span><span class="op" id="7940305">,</span>&nbsp;<span class="num" id="7940307">3</span><span class="op" id="7940308">,</span>&nbsp;<span class="num" id="7940310">255</span><span class="op" id="7940313">}</span>&nbsp;<span class="op" id="7940315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7940319">b</span>&nbsp;<span class="op" id="7940321">:=</span>&nbsp;<span class="op" id="7940324">&amp;</span><span class="ident" id="7940325">bytes</span><span class="op" id="7940330">.</span><span class="ident" id="7940331">Buffer</span><span class="op" id="7940337">{</span><span class="op" id="7940338">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7940343">//&nbsp;Manufacture&nbsp;a&nbsp;GIF&nbsp;with&nbsp;a&nbsp;2&nbsp;color&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7940390">b</span><span class="op" id="7940391">.</span><span class="ident" id="7940392">WriteString</span><span class="op" id="7940403">(</span><span class="ident" id="7940404">headerStr</span><span class="op" id="7940413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7940417">b</span><span class="op" id="7940418">.</span><span class="ident" id="7940419">WriteString</span><span class="op" id="7940430">(</span><span class="ident" id="7940431">paletteStr</span><span class="op" id="7940441">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7940446">//&nbsp;Image&nbsp;descriptor:&nbsp;2x1,&nbsp;no&nbsp;local&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7940492">b</span><span class="op" id="7940493">.</span><span class="ident" id="7940494">WriteString</span><span class="op" id="7940505">(</span><span class="string" id="7940506">&#34;\x2c\x00\x00\x00\x00\x02\x00\x01\x00\x00\x02&#34;</span><span class="op" id="7940552">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7940557">//&nbsp;Encode&nbsp;the&nbsp;pixels;&nbsp;some&nbsp;pvals&nbsp;trigger&nbsp;the&nbsp;expected&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7940620">pix</span>&nbsp;<span class="op" id="7940624">:=</span>&nbsp;<span class="op" id="7940627">[</span><span class="op" id="7940628">]</span><span class="builtintype" id="7940629">byte</span><span class="op" id="7940633">{</span><span class="ident" id="7940634">pval</span><span class="op" id="7940638">,</span>&nbsp;<span class="ident" id="7940640">pval</span><span class="op" id="7940644">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7940648">enc</span>&nbsp;<span class="op" id="7940652">:=</span>&nbsp;<span class="op" id="7940655">&amp;</span><span class="ident" id="7940656">bytes</span><span class="op" id="7940661">.</span><span class="ident" id="7940662">Buffer</span><span class="op" id="7940668">{</span><span class="op" id="7940669">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7940673">w</span>&nbsp;<span class="op" id="7940675">:=</span>&nbsp;<span class="ident" id="7940678">lzw</span><span class="op" id="7940681">.</span><span class="ident" id="7940682">NewWriter</span><span class="op" id="7940691">(</span><span class="ident" id="7940692">enc</span><span class="op" id="7940695">,</span>&nbsp;<span class="ident" id="7940697">lzw</span><span class="op" id="7940700">.</span><span class="ident" id="7940701">LSB</span><span class="op" id="7940704">,</span>&nbsp;<span class="num" id="7940706">2</span><span class="op" id="7940707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7940711">w</span><span class="op" id="7940712">.</span><span class="ident" id="7940713">Write</span><span class="op" id="7940718">(</span><span class="ident" id="7940719">pix</span><span class="op" id="7940722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7940726">w</span><span class="op" id="7940727">.</span><span class="ident" id="7940728">Close</span><span class="op" id="7940733">(</span><span class="op" id="7940734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7940738">b</span><span class="op" id="7940739">.</span><span class="ident" id="7940740">WriteByte</span><span class="op" id="7940749">(</span><span class="builtintype" id="7940750">byte</span><span class="op" id="7940754">(</span><span class="builtinfunc" id="7940755">len</span><span class="op" id="7940758">(</span><span class="ident" id="7940759">enc</span><span class="op" id="7940762">.</span><span class="ident" id="7940763">Bytes</span><span class="op" id="7940768">(</span><span class="op" id="7940769">)</span><span class="op" id="7940770">)</span><span class="op" id="7940771">)</span><span class="op" id="7940772">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7940776">b</span><span class="op" id="7940777">.</span><span class="ident" id="7940778">Write</span><span class="op" id="7940783">(</span><span class="ident" id="7940784">enc</span><span class="op" id="7940787">.</span><span class="ident" id="7940788">Bytes</span><span class="op" id="7940793">(</span><span class="op" id="7940794">)</span><span class="op" id="7940795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7940799">b</span><span class="op" id="7940800">.</span><span class="ident" id="7940801">WriteByte</span><span class="op" id="7940810">(</span><span class="num" id="7940811">0x00</span><span class="op" id="7940815">)</span>&nbsp;<span class="comment" id="7940817">//&nbsp;An&nbsp;empty&nbsp;block&nbsp;signifies&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;image&nbsp;data.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7940875">b</span><span class="op" id="7940876">.</span><span class="ident" id="7940877">WriteString</span><span class="op" id="7940888">(</span><span class="ident" id="7940889">trailerStr</span><span class="op" id="7940899">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7940904">//&nbsp;No&nbsp;error&nbsp;expected,&nbsp;unless&nbsp;the&nbsp;pixels&nbsp;are&nbsp;beyond&nbsp;the&nbsp;2&nbsp;color&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7940978">want</span>&nbsp;<span class="op" id="7940983">:=</span>&nbsp;<span class="string" id="7940986">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7940991">if</span>&nbsp;<span class="ident" id="7940994">pval</span>&nbsp;<span class="op" id="7940999">&gt;=</span>&nbsp;<span class="num" id="7941002">2</span>&nbsp;<span class="op" id="7941004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7941009">want</span>&nbsp;<span class="op" id="7941014">=</span>&nbsp;<span class="string" id="7941016">&#34;gif:&nbsp;invalid&nbsp;pixel&nbsp;value&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7941045">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7941049">try</span><span class="op" id="7941052">(</span><span class="ident" id="7941053">t</span><span class="op" id="7941054">,</span>&nbsp;<span class="ident" id="7941056">b</span><span class="op" id="7941057">.</span><span class="ident" id="7941058">Bytes</span><span class="op" id="7941063">(</span><span class="op" id="7941064">)</span><span class="op" id="7941065">,</span>&nbsp;<span class="ident" id="7941067">want</span><span class="op" id="7941071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7941074">}</span><br>
<span class="lineno"></span><span class="op" id="7941076">}</span>
</div>
</body>
</html>
