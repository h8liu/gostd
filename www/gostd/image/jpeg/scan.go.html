<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/jpeg</h2>
<ul>
<li><a href="/gostd/image/jpeg/dct_test.go.html">dct_test.go</a></li>
<li><a href="/gostd/image/jpeg/fdct.go.html">fdct.go</a></li>
<li><a href="/gostd/image/jpeg/huffman.go.html">huffman.go</a></li>
<li><a href="/gostd/image/jpeg/idct.go.html">idct.go</a></li>
<li><a href="/gostd/image/jpeg/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/jpeg/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/jpeg/scan.go.html" class="current">scan.go</a></li>
<li><a href="/gostd/image/jpeg/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/jpeg/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5595672">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5595727">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5595781">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5595832">package</span>&nbsp;<span class="ident" id="5595840">jpeg</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5595846">import</span>&nbsp;<span class="op" id="5595853">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5595856">&#34;image&#34;</span><br>
<span class="lineno"></span><span class="op" id="5595864">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="5595867">//&nbsp;makeImg&nbsp;allocates&nbsp;and&nbsp;initializes&nbsp;the&nbsp;destination&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5595927">func</span>&nbsp;<span class="op" id="5595932">(</span><span class="ident" id="5595933">d</span>&nbsp;<span class="op" id="5595935">*</span><span class="ident" id="5595936">decoder</span><span class="op" id="5595943">)</span>&nbsp;<span class="ident" id="5595945">makeImg</span><span class="op" id="5595952">(</span><span class="ident" id="5595953">h0</span><span class="op" id="5595955">,</span>&nbsp;<span class="ident" id="5595957">v0</span><span class="op" id="5595959">,</span>&nbsp;<span class="ident" id="5595961">mxx</span><span class="op" id="5595964">,</span>&nbsp;<span class="ident" id="5595966">myy</span>&nbsp;<span class="builtintype" id="5595970">int</span><span class="op" id="5595973">)</span>&nbsp;<span class="op" id="5595975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5595978">if</span>&nbsp;<span class="ident" id="5595981">d</span><span class="op" id="5595982">.</span><span class="ident" id="5595983">nComp</span>&nbsp;<span class="op" id="5595989">==</span>&nbsp;<span class="ident" id="5595992">nGrayComponent</span>&nbsp;<span class="op" id="5596007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5596011">m</span>&nbsp;<span class="op" id="5596013">:=</span>&nbsp;<span class="ident" id="5596016">image</span><span class="op" id="5596021">.</span><span class="ident" id="5596022">NewGray</span><span class="op" id="5596029">(</span><span class="ident" id="5596030">image</span><span class="op" id="5596035">.</span><span class="ident" id="5596036">Rect</span><span class="op" id="5596040">(</span><span class="num" id="5596041">0</span><span class="op" id="5596042">,</span>&nbsp;<span class="num" id="5596044">0</span><span class="op" id="5596045">,</span>&nbsp;<span class="num" id="5596047">8</span><span class="op" id="5596048">*</span><span class="ident" id="5596049">mxx</span><span class="op" id="5596052">,</span>&nbsp;<span class="num" id="5596054">8</span><span class="op" id="5596055">*</span><span class="ident" id="5596056">myy</span><span class="op" id="5596059">)</span><span class="op" id="5596060">)</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5596064">d</span><span class="op" id="5596065">.</span><span class="ident" id="5596066">img1</span>&nbsp;<span class="op" id="5596071">=</span>&nbsp;<span class="ident" id="5596073">m</span><span class="op" id="5596074">.</span><span class="ident" id="5596075">SubImage</span><span class="op" id="5596083">(</span><span class="ident" id="5596084">image</span><span class="op" id="5596089">.</span><span class="ident" id="5596090">Rect</span><span class="op" id="5596094">(</span><span class="num" id="5596095">0</span><span class="op" id="5596096">,</span>&nbsp;<span class="num" id="5596098">0</span><span class="op" id="5596099">,</span>&nbsp;<span class="ident" id="5596101">d</span><span class="op" id="5596102">.</span><span class="ident" id="5596103">width</span><span class="op" id="5596108">,</span>&nbsp;<span class="ident" id="5596110">d</span><span class="op" id="5596111">.</span><span class="ident" id="5596112">height</span><span class="op" id="5596118">)</span><span class="op" id="5596119">)</span><span class="op" id="5596120">.</span><span class="op" id="5596121">(</span><span class="op" id="5596122">*</span><span class="ident" id="5596123">image</span><span class="op" id="5596128">.</span><span class="ident" id="5596129">Gray</span><span class="op" id="5596133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5596137">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5596145">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5596148">var</span>&nbsp;<span class="ident" id="5596152">subsampleRatio</span>&nbsp;<span class="ident" id="5596167">image</span><span class="op" id="5596172">.</span><span class="ident" id="5596173">YCbCrSubsampleRatio</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5596194">switch</span>&nbsp;<span class="op" id="5596201">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5596204">case</span>&nbsp;<span class="ident" id="5596209">h0</span>&nbsp;<span class="op" id="5596212">==</span>&nbsp;<span class="num" id="5596215">1</span>&nbsp;<span class="op" id="5596217">&amp;&amp;</span>&nbsp;<span class="ident" id="5596220">v0</span>&nbsp;<span class="op" id="5596223">==</span>&nbsp;<span class="num" id="5596226">1</span><span class="op" id="5596227">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5596231">subsampleRatio</span>&nbsp;<span class="op" id="5596246">=</span>&nbsp;<span class="ident" id="5596248">image</span><span class="op" id="5596253">.</span><span class="ident" id="5596254">YCbCrSubsampleRatio444</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5596278">case</span>&nbsp;<span class="ident" id="5596283">h0</span>&nbsp;<span class="op" id="5596286">==</span>&nbsp;<span class="num" id="5596289">1</span>&nbsp;<span class="op" id="5596291">&amp;&amp;</span>&nbsp;<span class="ident" id="5596294">v0</span>&nbsp;<span class="op" id="5596297">==</span>&nbsp;<span class="num" id="5596300">2</span><span class="op" id="5596301">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5596305">subsampleRatio</span>&nbsp;<span class="op" id="5596320">=</span>&nbsp;<span class="ident" id="5596322">image</span><span class="op" id="5596327">.</span><span class="ident" id="5596328">YCbCrSubsampleRatio440</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5596352">case</span>&nbsp;<span class="ident" id="5596357">h0</span>&nbsp;<span class="op" id="5596360">==</span>&nbsp;<span class="num" id="5596363">2</span>&nbsp;<span class="op" id="5596365">&amp;&amp;</span>&nbsp;<span class="ident" id="5596368">v0</span>&nbsp;<span class="op" id="5596371">==</span>&nbsp;<span class="num" id="5596374">1</span><span class="op" id="5596375">:</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5596379">subsampleRatio</span>&nbsp;<span class="op" id="5596394">=</span>&nbsp;<span class="ident" id="5596396">image</span><span class="op" id="5596401">.</span><span class="ident" id="5596402">YCbCrSubsampleRatio422</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5596426">case</span>&nbsp;<span class="ident" id="5596431">h0</span>&nbsp;<span class="op" id="5596434">==</span>&nbsp;<span class="num" id="5596437">2</span>&nbsp;<span class="op" id="5596439">&amp;&amp;</span>&nbsp;<span class="ident" id="5596442">v0</span>&nbsp;<span class="op" id="5596445">==</span>&nbsp;<span class="num" id="5596448">2</span><span class="op" id="5596449">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5596453">subsampleRatio</span>&nbsp;<span class="op" id="5596468">=</span>&nbsp;<span class="ident" id="5596470">image</span><span class="op" id="5596475">.</span><span class="ident" id="5596476">YCbCrSubsampleRatio420</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5596500">default</span><span class="op" id="5596507">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5596511">panic</span><span class="op" id="5596516">(</span><span class="string" id="5596517">&#34;unreachable&#34;</span><span class="op" id="5596530">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5596533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5596536">m</span>&nbsp;<span class="op" id="5596538">:=</span>&nbsp;<span class="ident" id="5596541">image</span><span class="op" id="5596546">.</span><span class="ident" id="5596547">NewYCbCr</span><span class="op" id="5596555">(</span><span class="ident" id="5596556">image</span><span class="op" id="5596561">.</span><span class="ident" id="5596562">Rect</span><span class="op" id="5596566">(</span><span class="num" id="5596567">0</span><span class="op" id="5596568">,</span>&nbsp;<span class="num" id="5596570">0</span><span class="op" id="5596571">,</span>&nbsp;<span class="num" id="5596573">8</span><span class="op" id="5596574">*</span><span class="ident" id="5596575">h0</span><span class="op" id="5596577">*</span><span class="ident" id="5596578">mxx</span><span class="op" id="5596581">,</span>&nbsp;<span class="num" id="5596583">8</span><span class="op" id="5596584">*</span><span class="ident" id="5596585">v0</span><span class="op" id="5596587">*</span><span class="ident" id="5596588">myy</span><span class="op" id="5596591">)</span><span class="op" id="5596592">,</span>&nbsp;<span class="ident" id="5596594">subsampleRatio</span><span class="op" id="5596608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5596611">d</span><span class="op" id="5596612">.</span><span class="ident" id="5596613">img3</span>&nbsp;<span class="op" id="5596618">=</span>&nbsp;<span class="ident" id="5596620">m</span><span class="op" id="5596621">.</span><span class="ident" id="5596622">SubImage</span><span class="op" id="5596630">(</span><span class="ident" id="5596631">image</span><span class="op" id="5596636">.</span><span class="ident" id="5596637">Rect</span><span class="op" id="5596641">(</span><span class="num" id="5596642">0</span><span class="op" id="5596643">,</span>&nbsp;<span class="num" id="5596645">0</span><span class="op" id="5596646">,</span>&nbsp;<span class="ident" id="5596648">d</span><span class="op" id="5596649">.</span><span class="ident" id="5596650">width</span><span class="op" id="5596655">,</span>&nbsp;<span class="ident" id="5596657">d</span><span class="op" id="5596658">.</span><span class="ident" id="5596659">height</span><span class="op" id="5596665">)</span><span class="op" id="5596666">)</span><span class="op" id="5596667">.</span><span class="op" id="5596668">(</span><span class="op" id="5596669">*</span><span class="ident" id="5596670">image</span><span class="op" id="5596675">.</span><span class="ident" id="5596676">YCbCr</span><span class="op" id="5596681">)</span><br>
<span class="lineno"></span><span class="op" id="5596683">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="5596686">//&nbsp;Specified&nbsp;in&nbsp;section&nbsp;B.2.3.</span><br>
<span class="lineno"></span><span class="keyword" id="5596717">func</span>&nbsp;<span class="op" id="5596722">(</span><span class="ident" id="5596723">d</span>&nbsp;<span class="op" id="5596725">*</span><span class="ident" id="5596726">decoder</span><span class="op" id="5596733">)</span>&nbsp;<span class="ident" id="5596735">processSOS</span><span class="op" id="5596745">(</span><span class="ident" id="5596746">n</span>&nbsp;<span class="builtintype" id="5596748">int</span><span class="op" id="5596751">)</span>&nbsp;<span class="builtintype" id="5596753">error</span>&nbsp;<span class="op" id="5596759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5596762">if</span>&nbsp;<span class="ident" id="5596765">d</span><span class="op" id="5596766">.</span><span class="ident" id="5596767">nComp</span>&nbsp;<span class="op" id="5596773">==</span>&nbsp;<span class="num" id="5596776">0</span>&nbsp;<span class="op" id="5596778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5596782">return</span>&nbsp;<span class="ident" id="5596789">FormatError</span><span class="op" id="5596800">(</span><span class="string" id="5596801">&#34;missing&nbsp;SOF&nbsp;marker&#34;</span><span class="op" id="5596821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5596824">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5596827">if</span>&nbsp;<span class="ident" id="5596830">n</span>&nbsp;<span class="op" id="5596832">&lt;</span>&nbsp;<span class="num" id="5596834">6</span>&nbsp;<span class="op" id="5596836">||</span>&nbsp;<span class="num" id="5596839">4</span><span class="op" id="5596840">+</span><span class="num" id="5596841">2</span><span class="op" id="5596842">*</span><span class="ident" id="5596843">d</span><span class="op" id="5596844">.</span><span class="ident" id="5596845">nComp</span>&nbsp;<span class="op" id="5596851">&lt;</span>&nbsp;<span class="ident" id="5596853">n</span>&nbsp;<span class="op" id="5596855">||</span>&nbsp;<span class="ident" id="5596858">n</span><span class="op" id="5596859">%</span><span class="num" id="5596860">2</span>&nbsp;<span class="op" id="5596862">!=</span>&nbsp;<span class="num" id="5596865">0</span>&nbsp;<span class="op" id="5596867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5596871">return</span>&nbsp;<span class="ident" id="5596878">FormatError</span><span class="op" id="5596889">(</span><span class="string" id="5596890">&#34;SOS&nbsp;has&nbsp;wrong&nbsp;length&#34;</span><span class="op" id="5596912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5596915">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5596918">if</span>&nbsp;<span class="ident" id="5596921">err</span>&nbsp;<span class="op" id="5596925">:=</span>&nbsp;<span class="ident" id="5596928">d</span><span class="op" id="5596929">.</span><span class="ident" id="5596930">readFull</span><span class="op" id="5596938">(</span><span class="ident" id="5596939">d</span><span class="op" id="5596940">.</span><span class="ident" id="5596941">tmp</span><span class="op" id="5596944">[</span><span class="op" id="5596945">:</span><span class="ident" id="5596946">n</span><span class="op" id="5596947">]</span><span class="op" id="5596948">)</span><span class="op" id="5596949">;</span>&nbsp;<span class="ident" id="5596951">err</span>&nbsp;<span class="op" id="5596955">!=</span>&nbsp;<span class="builtintype" id="5596958">nil</span>&nbsp;<span class="op" id="5596962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5596966">return</span>&nbsp;<span class="ident" id="5596973">err</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5596978">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5596981">nComp</span>&nbsp;<span class="op" id="5596987">:=</span>&nbsp;<span class="builtintype" id="5596990">int</span><span class="op" id="5596993">(</span><span class="ident" id="5596994">d</span><span class="op" id="5596995">.</span><span class="ident" id="5596996">tmp</span><span class="op" id="5596999">[</span><span class="num" id="5597000">0</span><span class="op" id="5597001">]</span><span class="op" id="5597002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5597005">if</span>&nbsp;<span class="ident" id="5597008">n</span>&nbsp;<span class="op" id="5597010">!=</span>&nbsp;<span class="num" id="5597013">4</span><span class="op" id="5597014">+</span><span class="num" id="5597015">2</span><span class="op" id="5597016">*</span><span class="ident" id="5597017">nComp</span>&nbsp;<span class="op" id="5597023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5597027">return</span>&nbsp;<span class="ident" id="5597034">FormatError</span><span class="op" id="5597045">(</span><span class="string" id="5597046">&#34;SOS&nbsp;length&nbsp;inconsistent&nbsp;with&nbsp;number&nbsp;of&nbsp;components&#34;</span><span class="op" id="5597097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5597100">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5597103">var</span>&nbsp;<span class="ident" id="5597107">scan</span>&nbsp;<span class="op" id="5597112">[</span><span class="ident" id="5597113">nColorComponent</span><span class="op" id="5597128">]</span><span class="keyword" id="5597129">struct</span>&nbsp;<span class="op" id="5597136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5597140">compIndex</span>&nbsp;<span class="builtintype" id="5597150">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5597158">td</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5597168">uint8</span>&nbsp;<span class="comment" id="5597174">//&nbsp;DC&nbsp;table&nbsp;selector.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5597198">ta</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5597208">uint8</span>&nbsp;<span class="comment" id="5597214">//&nbsp;AC&nbsp;table&nbsp;selector.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5597237">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5597240">for</span>&nbsp;<span class="ident" id="5597244">i</span>&nbsp;<span class="op" id="5597246">:=</span>&nbsp;<span class="num" id="5597249">0</span><span class="op" id="5597250">;</span>&nbsp;<span class="ident" id="5597252">i</span>&nbsp;<span class="op" id="5597254">&lt;</span>&nbsp;<span class="ident" id="5597256">nComp</span><span class="op" id="5597261">;</span>&nbsp;<span class="ident" id="5597263">i</span><span class="op" id="5597264">++</span>&nbsp;<span class="op" id="5597267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5597271">cs</span>&nbsp;<span class="op" id="5597274">:=</span>&nbsp;<span class="ident" id="5597277">d</span><span class="op" id="5597278">.</span><span class="ident" id="5597279">tmp</span><span class="op" id="5597282">[</span><span class="num" id="5597283">1</span><span class="op" id="5597284">+</span><span class="num" id="5597285">2</span><span class="op" id="5597286">*</span><span class="ident" id="5597287">i</span><span class="op" id="5597288">]</span>&nbsp;<span class="comment" id="5597290">//&nbsp;Component&nbsp;selector.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5597315">compIndex</span>&nbsp;<span class="op" id="5597325">:=</span>&nbsp;<span class="op" id="5597328">-</span><span class="num" id="5597329">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5597333">for</span>&nbsp;<span class="ident" id="5597337">j</span><span class="op" id="5597338">,</span>&nbsp;<span class="ident" id="5597340">comp</span>&nbsp;<span class="op" id="5597345">:=</span>&nbsp;<span class="keyword" id="5597348">range</span>&nbsp;<span class="ident" id="5597354">d</span><span class="op" id="5597355">.</span><span class="ident" id="5597356">comp</span>&nbsp;<span class="op" id="5597361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5597366">if</span>&nbsp;<span class="ident" id="5597369">cs</span>&nbsp;<span class="op" id="5597372">==</span>&nbsp;<span class="ident" id="5597375">comp</span><span class="op" id="5597379">.</span><span class="ident" id="5597380">c</span>&nbsp;<span class="op" id="5597382">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5597388">compIndex</span>&nbsp;<span class="op" id="5597398">=</span>&nbsp;<span class="ident" id="5597400">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5597405">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5597409">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5597413">if</span>&nbsp;<span class="ident" id="5597416">compIndex</span>&nbsp;<span class="op" id="5597426">&lt;</span>&nbsp;<span class="num" id="5597428">0</span>&nbsp;<span class="op" id="5597430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5597435">return</span>&nbsp;<span class="ident" id="5597442">FormatError</span><span class="op" id="5597453">(</span><span class="string" id="5597454">&#34;unknown&nbsp;component&nbsp;selector&#34;</span><span class="op" id="5597482">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5597486">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5597490">scan</span><span class="op" id="5597494">[</span><span class="ident" id="5597495">i</span><span class="op" id="5597496">]</span><span class="op" id="5597497">.</span><span class="ident" id="5597498">compIndex</span>&nbsp;<span class="op" id="5597508">=</span>&nbsp;<span class="builtintype" id="5597510">uint8</span><span class="op" id="5597515">(</span><span class="ident" id="5597516">compIndex</span><span class="op" id="5597525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5597529">scan</span><span class="op" id="5597533">[</span><span class="ident" id="5597534">i</span><span class="op" id="5597535">]</span><span class="op" id="5597536">.</span><span class="ident" id="5597537">td</span>&nbsp;<span class="op" id="5597540">=</span>&nbsp;<span class="ident" id="5597542">d</span><span class="op" id="5597543">.</span><span class="ident" id="5597544">tmp</span><span class="op" id="5597547">[</span><span class="num" id="5597548">2</span><span class="op" id="5597549">+</span><span class="num" id="5597550">2</span><span class="op" id="5597551">*</span><span class="ident" id="5597552">i</span><span class="op" id="5597553">]</span>&nbsp;<span class="op" id="5597555">&gt;&gt;</span>&nbsp;<span class="num" id="5597558">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5597562">if</span>&nbsp;<span class="ident" id="5597565">scan</span><span class="op" id="5597569">[</span><span class="ident" id="5597570">i</span><span class="op" id="5597571">]</span><span class="op" id="5597572">.</span><span class="ident" id="5597573">td</span>&nbsp;<span class="op" id="5597576">&gt;</span>&nbsp;<span class="ident" id="5597578">maxTh</span>&nbsp;<span class="op" id="5597584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5597589">return</span>&nbsp;<span class="ident" id="5597596">FormatError</span><span class="op" id="5597607">(</span><span class="string" id="5597608">&#34;bad&nbsp;Td&nbsp;value&#34;</span><span class="op" id="5597622">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5597626">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5597630">scan</span><span class="op" id="5597634">[</span><span class="ident" id="5597635">i</span><span class="op" id="5597636">]</span><span class="op" id="5597637">.</span><span class="ident" id="5597638">ta</span>&nbsp;<span class="op" id="5597641">=</span>&nbsp;<span class="ident" id="5597643">d</span><span class="op" id="5597644">.</span><span class="ident" id="5597645">tmp</span><span class="op" id="5597648">[</span><span class="num" id="5597649">2</span><span class="op" id="5597650">+</span><span class="num" id="5597651">2</span><span class="op" id="5597652">*</span><span class="ident" id="5597653">i</span><span class="op" id="5597654">]</span>&nbsp;<span class="op" id="5597656">&amp;</span>&nbsp;<span class="num" id="5597658">0x0f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5597665">if</span>&nbsp;<span class="ident" id="5597668">scan</span><span class="op" id="5597672">[</span><span class="ident" id="5597673">i</span><span class="op" id="5597674">]</span><span class="op" id="5597675">.</span><span class="ident" id="5597676">ta</span>&nbsp;<span class="op" id="5597679">&gt;</span>&nbsp;<span class="ident" id="5597681">maxTh</span>&nbsp;<span class="op" id="5597687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5597692">return</span>&nbsp;<span class="ident" id="5597699">FormatError</span><span class="op" id="5597710">(</span><span class="string" id="5597711">&#34;bad&nbsp;Ta&nbsp;value&#34;</span><span class="op" id="5597725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5597729">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5597732">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5597736">//&nbsp;zigStart&nbsp;and&nbsp;zigEnd&nbsp;are&nbsp;the&nbsp;spectral&nbsp;selection&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5597795">//&nbsp;ah&nbsp;and&nbsp;al&nbsp;are&nbsp;the&nbsp;successive&nbsp;approximation&nbsp;high&nbsp;and&nbsp;low&nbsp;values.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5597863">//&nbsp;The&nbsp;spec&nbsp;calls&nbsp;these&nbsp;values&nbsp;Ss,&nbsp;Se,&nbsp;Ah&nbsp;and&nbsp;Al.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5597914">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5597918">//&nbsp;For&nbsp;progressive&nbsp;JPEGs,&nbsp;these&nbsp;are&nbsp;the&nbsp;two&nbsp;more-or-less&nbsp;independent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5597988">//&nbsp;aspects&nbsp;of&nbsp;progression.&nbsp;Spectral&nbsp;selection&nbsp;progression&nbsp;is&nbsp;when&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5598059">//&nbsp;all&nbsp;of&nbsp;a&nbsp;block&#39;s&nbsp;64&nbsp;DCT&nbsp;coefficients&nbsp;are&nbsp;transmitted&nbsp;in&nbsp;one&nbsp;pass.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5598129">//&nbsp;For&nbsp;example,&nbsp;three&nbsp;passes&nbsp;could&nbsp;transmit&nbsp;coefficient&nbsp;0&nbsp;(the&nbsp;DC</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5598196">//&nbsp;component),&nbsp;coefficients&nbsp;1-5,&nbsp;and&nbsp;coefficients&nbsp;6-63,&nbsp;in&nbsp;zig-zag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5598264">//&nbsp;order.&nbsp;Successive&nbsp;approximation&nbsp;is&nbsp;when&nbsp;not&nbsp;all&nbsp;of&nbsp;the&nbsp;bits&nbsp;of&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5598333">//&nbsp;band&nbsp;of&nbsp;coefficients&nbsp;are&nbsp;transmitted&nbsp;in&nbsp;one&nbsp;pass.&nbsp;For&nbsp;example,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5598400">//&nbsp;three&nbsp;passes&nbsp;could&nbsp;transmit&nbsp;the&nbsp;6&nbsp;most&nbsp;significant&nbsp;bits,&nbsp;followed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5598470">//&nbsp;by&nbsp;the&nbsp;second-least&nbsp;significant&nbsp;bit,&nbsp;followed&nbsp;by&nbsp;the&nbsp;least</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5598533">//&nbsp;significant&nbsp;bit.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5598554">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5598558">//&nbsp;For&nbsp;baseline&nbsp;JPEGs,&nbsp;these&nbsp;parameters&nbsp;are&nbsp;hard-coded&nbsp;to&nbsp;0/63/0/0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5598627">zigStart</span><span class="op" id="5598635">,</span>&nbsp;<span class="ident" id="5598637">zigEnd</span><span class="op" id="5598643">,</span>&nbsp;<span class="ident" id="5598645">ah</span><span class="op" id="5598647">,</span>&nbsp;<span class="ident" id="5598649">al</span>&nbsp;<span class="op" id="5598652">:=</span>&nbsp;<span class="builtintype" id="5598655">int32</span><span class="op" id="5598660">(</span><span class="num" id="5598661">0</span><span class="op" id="5598662">)</span><span class="op" id="5598663">,</span>&nbsp;<span class="builtintype" id="5598665">int32</span><span class="op" id="5598670">(</span><span class="ident" id="5598671">blockSize</span><span class="op" id="5598680">-</span><span class="num" id="5598681">1</span><span class="op" id="5598682">)</span><span class="op" id="5598683">,</span>&nbsp;<span class="builtintype" id="5598685">uint32</span><span class="op" id="5598691">(</span><span class="num" id="5598692">0</span><span class="op" id="5598693">)</span><span class="op" id="5598694">,</span>&nbsp;<span class="builtintype" id="5598696">uint32</span><span class="op" id="5598702">(</span><span class="num" id="5598703">0</span><span class="op" id="5598704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5598707">if</span>&nbsp;<span class="ident" id="5598710">d</span><span class="op" id="5598711">.</span><span class="ident" id="5598712">progressive</span>&nbsp;<span class="op" id="5598724">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5598728">zigStart</span>&nbsp;<span class="op" id="5598737">=</span>&nbsp;<span class="builtintype" id="5598739">int32</span><span class="op" id="5598744">(</span><span class="ident" id="5598745">d</span><span class="op" id="5598746">.</span><span class="ident" id="5598747">tmp</span><span class="op" id="5598750">[</span><span class="num" id="5598751">1</span><span class="op" id="5598752">+</span><span class="num" id="5598753">2</span><span class="op" id="5598754">*</span><span class="ident" id="5598755">nComp</span><span class="op" id="5598760">]</span><span class="op" id="5598761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5598765">zigEnd</span>&nbsp;<span class="op" id="5598772">=</span>&nbsp;<span class="builtintype" id="5598774">int32</span><span class="op" id="5598779">(</span><span class="ident" id="5598780">d</span><span class="op" id="5598781">.</span><span class="ident" id="5598782">tmp</span><span class="op" id="5598785">[</span><span class="num" id="5598786">2</span><span class="op" id="5598787">+</span><span class="num" id="5598788">2</span><span class="op" id="5598789">*</span><span class="ident" id="5598790">nComp</span><span class="op" id="5598795">]</span><span class="op" id="5598796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5598800">ah</span>&nbsp;<span class="op" id="5598803">=</span>&nbsp;<span class="builtintype" id="5598805">uint32</span><span class="op" id="5598811">(</span><span class="ident" id="5598812">d</span><span class="op" id="5598813">.</span><span class="ident" id="5598814">tmp</span><span class="op" id="5598817">[</span><span class="num" id="5598818">3</span><span class="op" id="5598819">+</span><span class="num" id="5598820">2</span><span class="op" id="5598821">*</span><span class="ident" id="5598822">nComp</span><span class="op" id="5598827">]</span>&nbsp;<span class="op" id="5598829">&gt;&gt;</span>&nbsp;<span class="num" id="5598832">4</span><span class="op" id="5598833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5598837">al</span>&nbsp;<span class="op" id="5598840">=</span>&nbsp;<span class="builtintype" id="5598842">uint32</span><span class="op" id="5598848">(</span><span class="ident" id="5598849">d</span><span class="op" id="5598850">.</span><span class="ident" id="5598851">tmp</span><span class="op" id="5598854">[</span><span class="num" id="5598855">3</span><span class="op" id="5598856">+</span><span class="num" id="5598857">2</span><span class="op" id="5598858">*</span><span class="ident" id="5598859">nComp</span><span class="op" id="5598864">]</span>&nbsp;<span class="op" id="5598866">&amp;</span>&nbsp;<span class="num" id="5598868">0x0f</span><span class="op" id="5598872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5598876">if</span>&nbsp;<span class="op" id="5598879">(</span><span class="ident" id="5598880">zigStart</span>&nbsp;<span class="op" id="5598889">==</span>&nbsp;<span class="num" id="5598892">0</span>&nbsp;<span class="op" id="5598894">&amp;&amp;</span>&nbsp;<span class="ident" id="5598897">zigEnd</span>&nbsp;<span class="op" id="5598904">!=</span>&nbsp;<span class="num" id="5598907">0</span><span class="op" id="5598908">)</span>&nbsp;<span class="op" id="5598910">||</span>&nbsp;<span class="ident" id="5598913">zigStart</span>&nbsp;<span class="op" id="5598922">&gt;</span>&nbsp;<span class="ident" id="5598924">zigEnd</span>&nbsp;<span class="op" id="5598931">||</span>&nbsp;<span class="ident" id="5598934">blockSize</span>&nbsp;<span class="op" id="5598944">&lt;=</span>&nbsp;<span class="ident" id="5598947">zigEnd</span>&nbsp;<span class="op" id="5598954">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5598959">return</span>&nbsp;<span class="ident" id="5598966">FormatError</span><span class="op" id="5598977">(</span><span class="string" id="5598978">&#34;bad&nbsp;spectral&nbsp;selection&nbsp;bounds&#34;</span><span class="op" id="5599009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5599013">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5599017">if</span>&nbsp;<span class="ident" id="5599020">zigStart</span>&nbsp;<span class="op" id="5599029">!=</span>&nbsp;<span class="num" id="5599032">0</span>&nbsp;<span class="op" id="5599034">&amp;&amp;</span>&nbsp;<span class="ident" id="5599037">nComp</span>&nbsp;<span class="op" id="5599043">!=</span>&nbsp;<span class="num" id="5599046">1</span>&nbsp;<span class="op" id="5599048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5599053">return</span>&nbsp;<span class="ident" id="5599060">FormatError</span><span class="op" id="5599071">(</span><span class="string" id="5599072">&#34;progressive&nbsp;AC&nbsp;coefficients&nbsp;for&nbsp;more&nbsp;than&nbsp;one&nbsp;component&#34;</span><span class="op" id="5599129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5599133">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5599137">if</span>&nbsp;<span class="ident" id="5599140">ah</span>&nbsp;<span class="op" id="5599143">!=</span>&nbsp;<span class="num" id="5599146">0</span>&nbsp;<span class="op" id="5599148">&amp;&amp;</span>&nbsp;<span class="ident" id="5599151">ah</span>&nbsp;<span class="op" id="5599154">!=</span>&nbsp;<span class="ident" id="5599157">al</span><span class="op" id="5599159">+</span><span class="num" id="5599160">1</span>&nbsp;<span class="op" id="5599162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5599167">return</span>&nbsp;<span class="ident" id="5599174">FormatError</span><span class="op" id="5599185">(</span><span class="string" id="5599186">&#34;bad&nbsp;successive&nbsp;approximation&nbsp;values&#34;</span><span class="op" id="5599223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5599227">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5599230">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5599234">//&nbsp;mxx&nbsp;and&nbsp;myy&nbsp;are&nbsp;the&nbsp;number&nbsp;of&nbsp;MCUs&nbsp;(Minimum&nbsp;Coded&nbsp;Units)&nbsp;in&nbsp;the&nbsp;image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5599309">h0</span><span class="op" id="5599311">,</span>&nbsp;<span class="ident" id="5599313">v0</span>&nbsp;<span class="op" id="5599316">:=</span>&nbsp;<span class="ident" id="5599319">d</span><span class="op" id="5599320">.</span><span class="ident" id="5599321">comp</span><span class="op" id="5599325">[</span><span class="num" id="5599326">0</span><span class="op" id="5599327">]</span><span class="op" id="5599328">.</span><span class="ident" id="5599329">h</span><span class="op" id="5599330">,</span>&nbsp;<span class="ident" id="5599332">d</span><span class="op" id="5599333">.</span><span class="ident" id="5599334">comp</span><span class="op" id="5599338">[</span><span class="num" id="5599339">0</span><span class="op" id="5599340">]</span><span class="op" id="5599341">.</span><span class="ident" id="5599342">v</span>&nbsp;<span class="comment" id="5599344">//&nbsp;The&nbsp;h&nbsp;and&nbsp;v&nbsp;values&nbsp;from&nbsp;the&nbsp;Y&nbsp;components.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5599390">mxx</span>&nbsp;<span class="op" id="5599394">:=</span>&nbsp;<span class="op" id="5599397">(</span><span class="ident" id="5599398">d</span><span class="op" id="5599399">.</span><span class="ident" id="5599400">width</span>&nbsp;<span class="op" id="5599406">+</span>&nbsp;<span class="num" id="5599408">8</span><span class="op" id="5599409">*</span><span class="ident" id="5599410">h0</span>&nbsp;<span class="op" id="5599413">-</span>&nbsp;<span class="num" id="5599415">1</span><span class="op" id="5599416">)</span>&nbsp;<span class="op" id="5599418">/</span>&nbsp;<span class="op" id="5599420">(</span><span class="num" id="5599421">8</span>&nbsp;<span class="op" id="5599423">*</span>&nbsp;<span class="ident" id="5599425">h0</span><span class="op" id="5599427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5599430">myy</span>&nbsp;<span class="op" id="5599434">:=</span>&nbsp;<span class="op" id="5599437">(</span><span class="ident" id="5599438">d</span><span class="op" id="5599439">.</span><span class="ident" id="5599440">height</span>&nbsp;<span class="op" id="5599447">+</span>&nbsp;<span class="num" id="5599449">8</span><span class="op" id="5599450">*</span><span class="ident" id="5599451">v0</span>&nbsp;<span class="op" id="5599454">-</span>&nbsp;<span class="num" id="5599456">1</span><span class="op" id="5599457">)</span>&nbsp;<span class="op" id="5599459">/</span>&nbsp;<span class="op" id="5599461">(</span><span class="num" id="5599462">8</span>&nbsp;<span class="op" id="5599464">*</span>&nbsp;<span class="ident" id="5599466">v0</span><span class="op" id="5599468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5599471">if</span>&nbsp;<span class="ident" id="5599474">d</span><span class="op" id="5599475">.</span><span class="ident" id="5599476">img1</span>&nbsp;<span class="op" id="5599481">==</span>&nbsp;<span class="builtintype" id="5599484">nil</span>&nbsp;<span class="op" id="5599488">&amp;&amp;</span>&nbsp;<span class="ident" id="5599491">d</span><span class="op" id="5599492">.</span><span class="ident" id="5599493">img3</span>&nbsp;<span class="op" id="5599498">==</span>&nbsp;<span class="builtintype" id="5599501">nil</span>&nbsp;<span class="op" id="5599505">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5599509">d</span><span class="op" id="5599510">.</span><span class="ident" id="5599511">makeImg</span><span class="op" id="5599518">(</span><span class="ident" id="5599519">h0</span><span class="op" id="5599521">,</span>&nbsp;<span class="ident" id="5599523">v0</span><span class="op" id="5599525">,</span>&nbsp;<span class="ident" id="5599527">mxx</span><span class="op" id="5599530">,</span>&nbsp;<span class="ident" id="5599532">myy</span><span class="op" id="5599535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5599538">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5599541">if</span>&nbsp;<span class="ident" id="5599544">d</span><span class="op" id="5599545">.</span><span class="ident" id="5599546">progressive</span>&nbsp;<span class="op" id="5599558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5599562">for</span>&nbsp;<span class="ident" id="5599566">i</span>&nbsp;<span class="op" id="5599568">:=</span>&nbsp;<span class="num" id="5599571">0</span><span class="op" id="5599572">;</span>&nbsp;<span class="ident" id="5599574">i</span>&nbsp;<span class="op" id="5599576">&lt;</span>&nbsp;<span class="ident" id="5599578">nComp</span><span class="op" id="5599583">;</span>&nbsp;<span class="ident" id="5599585">i</span><span class="op" id="5599586">++</span>&nbsp;<span class="op" id="5599589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5599594">compIndex</span>&nbsp;<span class="op" id="5599604">:=</span>&nbsp;<span class="ident" id="5599607">scan</span><span class="op" id="5599611">[</span><span class="ident" id="5599612">i</span><span class="op" id="5599613">]</span><span class="op" id="5599614">.</span><span class="ident" id="5599615">compIndex</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5599628">if</span>&nbsp;<span class="ident" id="5599631">d</span><span class="op" id="5599632">.</span><span class="ident" id="5599633">progCoeffs</span><span class="op" id="5599643">[</span><span class="ident" id="5599644">compIndex</span><span class="op" id="5599653">]</span>&nbsp;<span class="op" id="5599655">==</span>&nbsp;<span class="builtintype" id="5599658">nil</span>&nbsp;<span class="op" id="5599662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5599668">d</span><span class="op" id="5599669">.</span><span class="ident" id="5599670">progCoeffs</span><span class="op" id="5599680">[</span><span class="ident" id="5599681">compIndex</span><span class="op" id="5599690">]</span>&nbsp;<span class="op" id="5599692">=</span>&nbsp;<span class="builtinfunc" id="5599694">make</span><span class="op" id="5599698">(</span><span class="op" id="5599699">[</span><span class="op" id="5599700">]</span><span class="ident" id="5599701">block</span><span class="op" id="5599706">,</span>&nbsp;<span class="ident" id="5599708">mxx</span><span class="op" id="5599711">*</span><span class="ident" id="5599712">myy</span><span class="op" id="5599715">*</span><span class="ident" id="5599716">d</span><span class="op" id="5599717">.</span><span class="ident" id="5599718">comp</span><span class="op" id="5599722">[</span><span class="ident" id="5599723">compIndex</span><span class="op" id="5599732">]</span><span class="op" id="5599733">.</span><span class="ident" id="5599734">h</span><span class="op" id="5599735">*</span><span class="ident" id="5599736">d</span><span class="op" id="5599737">.</span><span class="ident" id="5599738">comp</span><span class="op" id="5599742">[</span><span class="ident" id="5599743">compIndex</span><span class="op" id="5599752">]</span><span class="op" id="5599753">.</span><span class="ident" id="5599754">v</span><span class="op" id="5599755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5599760">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5599764">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5599767">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5599771">d</span><span class="op" id="5599772">.</span><span class="ident" id="5599773">bits</span>&nbsp;<span class="op" id="5599778">=</span>&nbsp;<span class="ident" id="5599780">bits</span><span class="op" id="5599784">{</span><span class="op" id="5599785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5599788">mcu</span><span class="op" id="5599791">,</span>&nbsp;<span class="ident" id="5599793">expectedRST</span>&nbsp;<span class="op" id="5599805">:=</span>&nbsp;<span class="num" id="5599808">0</span><span class="op" id="5599809">,</span>&nbsp;<span class="builtintype" id="5599811">uint8</span><span class="op" id="5599816">(</span><span class="ident" id="5599817">rst0Marker</span><span class="op" id="5599827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5599830">var</span>&nbsp;<span class="op" id="5599834">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5599838">//&nbsp;b&nbsp;is&nbsp;the&nbsp;decoded&nbsp;coefficients,&nbsp;in&nbsp;natural&nbsp;(not&nbsp;zig-zag)&nbsp;order.</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5599906">b</span>&nbsp;&nbsp;<span class="ident" id="5599909">block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5599917">dc</span>&nbsp;<span class="op" id="5599920">[</span><span class="ident" id="5599921">nColorComponent</span><span class="op" id="5599936">]</span><span class="builtintype" id="5599937">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5599945">//&nbsp;bx&nbsp;and&nbsp;by&nbsp;are&nbsp;the&nbsp;location&nbsp;of&nbsp;the&nbsp;current&nbsp;(in&nbsp;terms&nbsp;of&nbsp;8x8&nbsp;blocks).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5600018">//&nbsp;For&nbsp;example,&nbsp;with&nbsp;4:2:0&nbsp;chroma&nbsp;subsampling,&nbsp;the&nbsp;block&nbsp;whose&nbsp;top&nbsp;left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5600092">//&nbsp;pixel&nbsp;co-ordinates&nbsp;are&nbsp;(16,&nbsp;8)&nbsp;is&nbsp;the&nbsp;third&nbsp;block&nbsp;in&nbsp;the&nbsp;first&nbsp;row:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5600165">//&nbsp;bx&nbsp;is&nbsp;2&nbsp;and&nbsp;by&nbsp;is&nbsp;0,&nbsp;even&nbsp;though&nbsp;the&nbsp;pixel&nbsp;is&nbsp;in&nbsp;the&nbsp;second&nbsp;MCU.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5600235">bx</span><span class="op" id="5600237">,</span>&nbsp;<span class="ident" id="5600239">by</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5600246">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5600252">blockCount</span>&nbsp;<span class="builtintype" id="5600263">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5600268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5600271">for</span>&nbsp;<span class="ident" id="5600275">my</span>&nbsp;<span class="op" id="5600278">:=</span>&nbsp;<span class="num" id="5600281">0</span><span class="op" id="5600282">;</span>&nbsp;<span class="ident" id="5600284">my</span>&nbsp;<span class="op" id="5600287">&lt;</span>&nbsp;<span class="ident" id="5600289">myy</span><span class="op" id="5600292">;</span>&nbsp;<span class="ident" id="5600294">my</span><span class="op" id="5600296">++</span>&nbsp;<span class="op" id="5600299">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5600303">for</span>&nbsp;<span class="ident" id="5600307">mx</span>&nbsp;<span class="op" id="5600310">:=</span>&nbsp;<span class="num" id="5600313">0</span><span class="op" id="5600314">;</span>&nbsp;<span class="ident" id="5600316">mx</span>&nbsp;<span class="op" id="5600319">&lt;</span>&nbsp;<span class="ident" id="5600321">mxx</span><span class="op" id="5600324">;</span>&nbsp;<span class="ident" id="5600326">mx</span><span class="op" id="5600328">++</span>&nbsp;<span class="op" id="5600331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5600336">for</span>&nbsp;<span class="ident" id="5600340">i</span>&nbsp;<span class="op" id="5600342">:=</span>&nbsp;<span class="num" id="5600345">0</span><span class="op" id="5600346">;</span>&nbsp;<span class="ident" id="5600348">i</span>&nbsp;<span class="op" id="5600350">&lt;</span>&nbsp;<span class="ident" id="5600352">nComp</span><span class="op" id="5600357">;</span>&nbsp;<span class="ident" id="5600359">i</span><span class="op" id="5600360">++</span>&nbsp;<span class="op" id="5600363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5600369">compIndex</span>&nbsp;<span class="op" id="5600379">:=</span>&nbsp;<span class="ident" id="5600382">scan</span><span class="op" id="5600386">[</span><span class="ident" id="5600387">i</span><span class="op" id="5600388">]</span><span class="op" id="5600389">.</span><span class="ident" id="5600390">compIndex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5600404">qt</span>&nbsp;<span class="op" id="5600407">:=</span>&nbsp;<span class="op" id="5600410">&amp;</span><span class="ident" id="5600411">d</span><span class="op" id="5600412">.</span><span class="ident" id="5600413">quant</span><span class="op" id="5600418">[</span><span class="ident" id="5600419">d</span><span class="op" id="5600420">.</span><span class="ident" id="5600421">comp</span><span class="op" id="5600425">[</span><span class="ident" id="5600426">compIndex</span><span class="op" id="5600435">]</span><span class="op" id="5600436">.</span><span class="ident" id="5600437">tq</span><span class="op" id="5600439">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5600445">for</span>&nbsp;<span class="ident" id="5600449">j</span>&nbsp;<span class="op" id="5600451">:=</span>&nbsp;<span class="num" id="5600454">0</span><span class="op" id="5600455">;</span>&nbsp;<span class="ident" id="5600457">j</span>&nbsp;<span class="op" id="5600459">&lt;</span>&nbsp;<span class="ident" id="5600461">d</span><span class="op" id="5600462">.</span><span class="ident" id="5600463">comp</span><span class="op" id="5600467">[</span><span class="ident" id="5600468">compIndex</span><span class="op" id="5600477">]</span><span class="op" id="5600478">.</span><span class="ident" id="5600479">h</span><span class="op" id="5600480">*</span><span class="ident" id="5600481">d</span><span class="op" id="5600482">.</span><span class="ident" id="5600483">comp</span><span class="op" id="5600487">[</span><span class="ident" id="5600488">compIndex</span><span class="op" id="5600497">]</span><span class="op" id="5600498">.</span><span class="ident" id="5600499">v</span><span class="op" id="5600500">;</span>&nbsp;<span class="ident" id="5600502">j</span><span class="op" id="5600503">++</span>&nbsp;<span class="op" id="5600506">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5600513">//&nbsp;The&nbsp;blocks&nbsp;are&nbsp;traversed&nbsp;one&nbsp;MCU&nbsp;at&nbsp;a&nbsp;time.&nbsp;For&nbsp;4:2:0&nbsp;chroma</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5600582">//&nbsp;subsampling,&nbsp;there&nbsp;are&nbsp;four&nbsp;Y&nbsp;8x8&nbsp;blocks&nbsp;in&nbsp;every&nbsp;16x16&nbsp;MCU.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5600651">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5600659">//&nbsp;For&nbsp;a&nbsp;baseline&nbsp;32x16&nbsp;pixel&nbsp;image,&nbsp;the&nbsp;Y&nbsp;blocks&nbsp;visiting&nbsp;order&nbsp;is:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5600733">//&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;1&nbsp;4&nbsp;5</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5600749">//&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;3&nbsp;6&nbsp;7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5600765">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5600773">//&nbsp;For&nbsp;progressive&nbsp;images,&nbsp;the&nbsp;interleaved&nbsp;scans&nbsp;(those&nbsp;with&nbsp;nComp&nbsp;&gt;&nbsp;1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5600850">//&nbsp;are&nbsp;traversed&nbsp;as&nbsp;above,&nbsp;but&nbsp;non-interleaved&nbsp;scans&nbsp;are&nbsp;traversed&nbsp;left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5600927">//&nbsp;to&nbsp;right,&nbsp;top&nbsp;to&nbsp;bottom:</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5600960">//&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;1&nbsp;2&nbsp;3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5600976">//&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;5&nbsp;6&nbsp;7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5600992">//&nbsp;Only&nbsp;DC&nbsp;scans&nbsp;(zigStart&nbsp;==&nbsp;0)&nbsp;can&nbsp;be&nbsp;interleaved.&nbsp;AC&nbsp;scans&nbsp;must&nbsp;have</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5601069">//&nbsp;only&nbsp;one&nbsp;component.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5601097">//</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5601105">//&nbsp;To&nbsp;further&nbsp;complicate&nbsp;matters,&nbsp;for&nbsp;non-interleaved&nbsp;scans,&nbsp;there&nbsp;is&nbsp;no</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5601183">//&nbsp;data&nbsp;for&nbsp;any&nbsp;blocks&nbsp;that&nbsp;are&nbsp;inside&nbsp;the&nbsp;image&nbsp;at&nbsp;the&nbsp;MCU&nbsp;level&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5601258">//&nbsp;outside&nbsp;the&nbsp;image&nbsp;at&nbsp;the&nbsp;pixel&nbsp;level.&nbsp;For&nbsp;example,&nbsp;a&nbsp;24x16&nbsp;pixel&nbsp;4:2:0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5601337">//&nbsp;progressive&nbsp;image&nbsp;consists&nbsp;of&nbsp;two&nbsp;16x16&nbsp;MCUs.&nbsp;The&nbsp;interleaved&nbsp;scans</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5601413">//&nbsp;will&nbsp;process&nbsp;8&nbsp;Y&nbsp;blocks:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5601446">//&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;1&nbsp;4&nbsp;5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5601462">//&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;3&nbsp;6&nbsp;7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5601478">//&nbsp;The&nbsp;non-interleaved&nbsp;scans&nbsp;will&nbsp;process&nbsp;only&nbsp;6&nbsp;Y&nbsp;blocks:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5601542">//&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;1&nbsp;2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5601556">//&nbsp;&nbsp;&nbsp;&nbsp;3&nbsp;4&nbsp;5</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5601570">if</span>&nbsp;<span class="ident" id="5601573">nComp</span>&nbsp;<span class="op" id="5601579">!=</span>&nbsp;<span class="num" id="5601582">1</span>&nbsp;<span class="op" id="5601584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5601592">bx</span><span class="op" id="5601594">,</span>&nbsp;<span class="ident" id="5601596">by</span>&nbsp;<span class="op" id="5601599">=</span>&nbsp;<span class="ident" id="5601601">d</span><span class="op" id="5601602">.</span><span class="ident" id="5601603">comp</span><span class="op" id="5601607">[</span><span class="ident" id="5601608">compIndex</span><span class="op" id="5601617">]</span><span class="op" id="5601618">.</span><span class="ident" id="5601619">h</span><span class="op" id="5601620">*</span><span class="ident" id="5601621">mx</span><span class="op" id="5601623">,</span>&nbsp;<span class="ident" id="5601625">d</span><span class="op" id="5601626">.</span><span class="ident" id="5601627">comp</span><span class="op" id="5601631">[</span><span class="ident" id="5601632">compIndex</span><span class="op" id="5601641">]</span><span class="op" id="5601642">.</span><span class="ident" id="5601643">v</span><span class="op" id="5601644">*</span><span class="ident" id="5601645">my</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5601654">if</span>&nbsp;<span class="ident" id="5601657">h0</span>&nbsp;<span class="op" id="5601660">==</span>&nbsp;<span class="num" id="5601663">1</span>&nbsp;<span class="op" id="5601665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5601674">by</span>&nbsp;<span class="op" id="5601677">+=</span>&nbsp;<span class="ident" id="5601680">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5601688">}</span>&nbsp;<span class="keyword" id="5601690">else</span>&nbsp;<span class="op" id="5601695">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5601704">bx</span>&nbsp;<span class="op" id="5601707">+=</span>&nbsp;<span class="ident" id="5601710">j</span>&nbsp;<span class="op" id="5601712">%</span>&nbsp;<span class="num" id="5601714">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5601723">by</span>&nbsp;<span class="op" id="5601726">+=</span>&nbsp;<span class="ident" id="5601729">j</span>&nbsp;<span class="op" id="5601731">/</span>&nbsp;<span class="num" id="5601733">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5601741">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5601748">}</span>&nbsp;<span class="keyword" id="5601750">else</span>&nbsp;<span class="op" id="5601755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5601763">q</span>&nbsp;<span class="op" id="5601765">:=</span>&nbsp;<span class="ident" id="5601768">mxx</span>&nbsp;<span class="op" id="5601772">*</span>&nbsp;<span class="ident" id="5601774">d</span><span class="op" id="5601775">.</span><span class="ident" id="5601776">comp</span><span class="op" id="5601780">[</span><span class="ident" id="5601781">compIndex</span><span class="op" id="5601790">]</span><span class="op" id="5601791">.</span><span class="ident" id="5601792">h</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5601800">bx</span>&nbsp;<span class="op" id="5601803">=</span>&nbsp;<span class="ident" id="5601805">blockCount</span>&nbsp;<span class="op" id="5601816">%</span>&nbsp;<span class="ident" id="5601818">q</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5601826">by</span>&nbsp;<span class="op" id="5601829">=</span>&nbsp;<span class="ident" id="5601831">blockCount</span>&nbsp;<span class="op" id="5601842">/</span>&nbsp;<span class="ident" id="5601844">q</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5601852">blockCount</span><span class="op" id="5601862">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5601871">if</span>&nbsp;<span class="ident" id="5601874">bx</span><span class="op" id="5601876">*</span><span class="num" id="5601877">8</span>&nbsp;<span class="op" id="5601879">&gt;=</span>&nbsp;<span class="ident" id="5601882">d</span><span class="op" id="5601883">.</span><span class="ident" id="5601884">width</span>&nbsp;<span class="op" id="5601890">||</span>&nbsp;<span class="ident" id="5601893">by</span><span class="op" id="5601895">*</span><span class="num" id="5601896">8</span>&nbsp;<span class="op" id="5601898">&gt;=</span>&nbsp;<span class="ident" id="5601901">d</span><span class="op" id="5601902">.</span><span class="ident" id="5601903">height</span>&nbsp;<span class="op" id="5601910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5601919">continue</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5601934">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5601941">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5601949">//&nbsp;Load&nbsp;the&nbsp;previous&nbsp;partially&nbsp;decoded&nbsp;coefficients,&nbsp;if&nbsp;applicable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5602022">if</span>&nbsp;<span class="ident" id="5602025">d</span><span class="op" id="5602026">.</span><span class="ident" id="5602027">progressive</span>&nbsp;<span class="op" id="5602039">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5602047">b</span>&nbsp;<span class="op" id="5602049">=</span>&nbsp;<span class="ident" id="5602051">d</span><span class="op" id="5602052">.</span><span class="ident" id="5602053">progCoeffs</span><span class="op" id="5602063">[</span><span class="ident" id="5602064">compIndex</span><span class="op" id="5602073">]</span><span class="op" id="5602074">[</span><span class="ident" id="5602075">by</span><span class="op" id="5602077">*</span><span class="ident" id="5602078">mxx</span><span class="op" id="5602081">*</span><span class="ident" id="5602082">d</span><span class="op" id="5602083">.</span><span class="ident" id="5602084">comp</span><span class="op" id="5602088">[</span><span class="ident" id="5602089">compIndex</span><span class="op" id="5602098">]</span><span class="op" id="5602099">.</span><span class="ident" id="5602100">h</span><span class="op" id="5602101">+</span><span class="ident" id="5602102">bx</span><span class="op" id="5602104">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5602111">}</span>&nbsp;<span class="keyword" id="5602113">else</span>&nbsp;<span class="op" id="5602118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5602126">b</span>&nbsp;<span class="op" id="5602128">=</span>&nbsp;<span class="ident" id="5602130">block</span><span class="op" id="5602135">{</span><span class="op" id="5602136">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5602143">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5602151">if</span>&nbsp;<span class="ident" id="5602154">ah</span>&nbsp;<span class="op" id="5602157">!=</span>&nbsp;<span class="num" id="5602160">0</span>&nbsp;<span class="op" id="5602162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5602170">if</span>&nbsp;<span class="ident" id="5602173">err</span>&nbsp;<span class="op" id="5602177">:=</span>&nbsp;<span class="ident" id="5602180">d</span><span class="op" id="5602181">.</span><span class="ident" id="5602182">refine</span><span class="op" id="5602188">(</span><span class="op" id="5602189">&amp;</span><span class="ident" id="5602190">b</span><span class="op" id="5602191">,</span>&nbsp;<span class="op" id="5602193">&amp;</span><span class="ident" id="5602194">d</span><span class="op" id="5602195">.</span><span class="ident" id="5602196">huff</span><span class="op" id="5602200">[</span><span class="ident" id="5602201">acTable</span><span class="op" id="5602208">]</span><span class="op" id="5602209">[</span><span class="ident" id="5602210">scan</span><span class="op" id="5602214">[</span><span class="ident" id="5602215">i</span><span class="op" id="5602216">]</span><span class="op" id="5602217">.</span><span class="ident" id="5602218">ta</span><span class="op" id="5602220">]</span><span class="op" id="5602221">,</span>&nbsp;<span class="ident" id="5602223">zigStart</span><span class="op" id="5602231">,</span>&nbsp;<span class="ident" id="5602233">zigEnd</span><span class="op" id="5602239">,</span>&nbsp;<span class="num" id="5602241">1</span><span class="op" id="5602242">&lt;&lt;</span><span class="ident" id="5602244">al</span><span class="op" id="5602246">)</span><span class="op" id="5602247">;</span>&nbsp;<span class="ident" id="5602249">err</span>&nbsp;<span class="op" id="5602253">!=</span>&nbsp;<span class="builtintype" id="5602256">nil</span>&nbsp;<span class="op" id="5602260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5602269">return</span>&nbsp;<span class="ident" id="5602276">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5602286">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5602293">}</span>&nbsp;<span class="keyword" id="5602295">else</span>&nbsp;<span class="op" id="5602300">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5602308">zig</span>&nbsp;<span class="op" id="5602312">:=</span>&nbsp;<span class="ident" id="5602315">zigStart</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5602330">if</span>&nbsp;<span class="ident" id="5602333">zig</span>&nbsp;<span class="op" id="5602337">==</span>&nbsp;<span class="num" id="5602340">0</span>&nbsp;<span class="op" id="5602342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5602351">zig</span><span class="op" id="5602354">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5602364">//&nbsp;Decode&nbsp;the&nbsp;DC&nbsp;coefficient,&nbsp;as&nbsp;specified&nbsp;in&nbsp;section&nbsp;F.2.2.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5602434">value</span><span class="op" id="5602439">,</span>&nbsp;<span class="ident" id="5602441">err</span>&nbsp;<span class="op" id="5602445">:=</span>&nbsp;<span class="ident" id="5602448">d</span><span class="op" id="5602449">.</span><span class="ident" id="5602450">decodeHuffman</span><span class="op" id="5602463">(</span><span class="op" id="5602464">&amp;</span><span class="ident" id="5602465">d</span><span class="op" id="5602466">.</span><span class="ident" id="5602467">huff</span><span class="op" id="5602471">[</span><span class="ident" id="5602472">dcTable</span><span class="op" id="5602479">]</span><span class="op" id="5602480">[</span><span class="ident" id="5602481">scan</span><span class="op" id="5602485">[</span><span class="ident" id="5602486">i</span><span class="op" id="5602487">]</span><span class="op" id="5602488">.</span><span class="ident" id="5602489">td</span><span class="op" id="5602491">]</span><span class="op" id="5602492">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5602501">if</span>&nbsp;<span class="ident" id="5602504">err</span>&nbsp;<span class="op" id="5602508">!=</span>&nbsp;<span class="builtintype" id="5602511">nil</span>&nbsp;<span class="op" id="5602515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5602525">return</span>&nbsp;<span class="ident" id="5602532">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5602543">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5602552">if</span>&nbsp;<span class="ident" id="5602555">value</span>&nbsp;<span class="op" id="5602561">&gt;</span>&nbsp;<span class="num" id="5602563">16</span>&nbsp;<span class="op" id="5602566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5602576">return</span>&nbsp;<span class="ident" id="5602583">UnsupportedError</span><span class="op" id="5602599">(</span><span class="string" id="5602600">&#34;excessive&nbsp;DC&nbsp;component&#34;</span><span class="op" id="5602624">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5602633">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5602642">dcDelta</span><span class="op" id="5602649">,</span>&nbsp;<span class="ident" id="5602651">err</span>&nbsp;<span class="op" id="5602655">:=</span>&nbsp;<span class="ident" id="5602658">d</span><span class="op" id="5602659">.</span><span class="ident" id="5602660">receiveExtend</span><span class="op" id="5602673">(</span><span class="ident" id="5602674">value</span><span class="op" id="5602679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5602688">if</span>&nbsp;<span class="ident" id="5602691">err</span>&nbsp;<span class="op" id="5602695">!=</span>&nbsp;<span class="builtintype" id="5602698">nil</span>&nbsp;<span class="op" id="5602702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5602712">return</span>&nbsp;<span class="ident" id="5602719">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5602730">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5602739">dc</span><span class="op" id="5602741">[</span><span class="ident" id="5602742">compIndex</span><span class="op" id="5602751">]</span>&nbsp;<span class="op" id="5602753">+=</span>&nbsp;<span class="ident" id="5602756">dcDelta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5602771">b</span><span class="op" id="5602772">[</span><span class="num" id="5602773">0</span><span class="op" id="5602774">]</span>&nbsp;<span class="op" id="5602776">=</span>&nbsp;<span class="ident" id="5602778">dc</span><span class="op" id="5602780">[</span><span class="ident" id="5602781">compIndex</span><span class="op" id="5602790">]</span>&nbsp;<span class="op" id="5602792">&lt;&lt;</span>&nbsp;<span class="ident" id="5602795">al</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5602804">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5602813">if</span>&nbsp;<span class="ident" id="5602816">zig</span>&nbsp;<span class="op" id="5602820">&lt;=</span>&nbsp;<span class="ident" id="5602823">zigEnd</span>&nbsp;<span class="op" id="5602830">&amp;&amp;</span>&nbsp;<span class="ident" id="5602833">d</span><span class="op" id="5602834">.</span><span class="ident" id="5602835">eobRun</span>&nbsp;<span class="op" id="5602842">&gt;</span>&nbsp;<span class="num" id="5602844">0</span>&nbsp;<span class="op" id="5602846">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5602855">d</span><span class="op" id="5602856">.</span><span class="ident" id="5602857">eobRun</span><span class="op" id="5602863">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5602872">}</span>&nbsp;<span class="keyword" id="5602874">else</span>&nbsp;<span class="op" id="5602879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5602888">//&nbsp;Decode&nbsp;the&nbsp;AC&nbsp;coefficients,&nbsp;as&nbsp;specified&nbsp;in&nbsp;section&nbsp;F.2.2.2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5602959">huff</span>&nbsp;<span class="op" id="5602964">:=</span>&nbsp;<span class="op" id="5602967">&amp;</span><span class="ident" id="5602968">d</span><span class="op" id="5602969">.</span><span class="ident" id="5602970">huff</span><span class="op" id="5602974">[</span><span class="ident" id="5602975">acTable</span><span class="op" id="5602982">]</span><span class="op" id="5602983">[</span><span class="ident" id="5602984">scan</span><span class="op" id="5602988">[</span><span class="ident" id="5602989">i</span><span class="op" id="5602990">]</span><span class="op" id="5602991">.</span><span class="ident" id="5602992">ta</span><span class="op" id="5602994">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5603003">for</span>&nbsp;<span class="op" id="5603007">;</span>&nbsp;<span class="ident" id="5603009">zig</span>&nbsp;<span class="op" id="5603013">&lt;=</span>&nbsp;<span class="ident" id="5603016">zigEnd</span><span class="op" id="5603022">;</span>&nbsp;<span class="ident" id="5603024">zig</span><span class="op" id="5603027">++</span>&nbsp;<span class="op" id="5603030">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5603040">value</span><span class="op" id="5603045">,</span>&nbsp;<span class="ident" id="5603047">err</span>&nbsp;<span class="op" id="5603051">:=</span>&nbsp;<span class="ident" id="5603054">d</span><span class="op" id="5603055">.</span><span class="ident" id="5603056">decodeHuffman</span><span class="op" id="5603069">(</span><span class="ident" id="5603070">huff</span><span class="op" id="5603074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5603084">if</span>&nbsp;<span class="ident" id="5603087">err</span>&nbsp;<span class="op" id="5603091">!=</span>&nbsp;<span class="builtintype" id="5603094">nil</span>&nbsp;<span class="op" id="5603098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5603109">return</span>&nbsp;<span class="ident" id="5603116">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5603128">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5603138">val0</span>&nbsp;<span class="op" id="5603143">:=</span>&nbsp;<span class="ident" id="5603146">value</span>&nbsp;<span class="op" id="5603152">&gt;&gt;</span>&nbsp;<span class="num" id="5603155">4</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5603165">val1</span>&nbsp;<span class="op" id="5603170">:=</span>&nbsp;<span class="ident" id="5603173">value</span>&nbsp;<span class="op" id="5603179">&amp;</span>&nbsp;<span class="num" id="5603181">0x0f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5603194">if</span>&nbsp;<span class="ident" id="5603197">val1</span>&nbsp;<span class="op" id="5603202">!=</span>&nbsp;<span class="num" id="5603205">0</span>&nbsp;<span class="op" id="5603207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5603218">zig</span>&nbsp;<span class="op" id="5603222">+=</span>&nbsp;<span class="builtintype" id="5603225">int32</span><span class="op" id="5603230">(</span><span class="ident" id="5603231">val0</span><span class="op" id="5603235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5603246">if</span>&nbsp;<span class="ident" id="5603249">zig</span>&nbsp;<span class="op" id="5603253">&gt;</span>&nbsp;<span class="ident" id="5603255">zigEnd</span>&nbsp;<span class="op" id="5603262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5603274">break</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5603289">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5603300">ac</span><span class="op" id="5603302">,</span>&nbsp;<span class="ident" id="5603304">err</span>&nbsp;<span class="op" id="5603308">:=</span>&nbsp;<span class="ident" id="5603311">d</span><span class="op" id="5603312">.</span><span class="ident" id="5603313">receiveExtend</span><span class="op" id="5603326">(</span><span class="ident" id="5603327">val1</span><span class="op" id="5603331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5603342">if</span>&nbsp;<span class="ident" id="5603345">err</span>&nbsp;<span class="op" id="5603349">!=</span>&nbsp;<span class="builtintype" id="5603352">nil</span>&nbsp;<span class="op" id="5603356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5603368">return</span>&nbsp;<span class="ident" id="5603375">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5603388">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5603399">b</span><span class="op" id="5603400">[</span><span class="ident" id="5603401">unzig</span><span class="op" id="5603406">[</span><span class="ident" id="5603407">zig</span><span class="op" id="5603410">]</span><span class="op" id="5603411">]</span>&nbsp;<span class="op" id="5603413">=</span>&nbsp;<span class="ident" id="5603415">ac</span>&nbsp;<span class="op" id="5603418">&lt;&lt;</span>&nbsp;<span class="ident" id="5603421">al</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5603432">}</span>&nbsp;<span class="keyword" id="5603434">else</span>&nbsp;<span class="op" id="5603439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5603450">if</span>&nbsp;<span class="ident" id="5603453">val0</span>&nbsp;<span class="op" id="5603458">!=</span>&nbsp;<span class="num" id="5603461">0x0f</span>&nbsp;<span class="op" id="5603466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5603478">d</span><span class="op" id="5603479">.</span><span class="ident" id="5603480">eobRun</span>&nbsp;<span class="op" id="5603487">=</span>&nbsp;<span class="builtintype" id="5603489">uint16</span><span class="op" id="5603495">(</span><span class="num" id="5603496">1</span>&nbsp;<span class="op" id="5603498">&lt;&lt;</span>&nbsp;<span class="ident" id="5603501">val0</span><span class="op" id="5603505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5603517">if</span>&nbsp;<span class="ident" id="5603520">val0</span>&nbsp;<span class="op" id="5603525">!=</span>&nbsp;<span class="num" id="5603528">0</span>&nbsp;<span class="op" id="5603530">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5603543">bits</span><span class="op" id="5603547">,</span>&nbsp;<span class="ident" id="5603549">err</span>&nbsp;<span class="op" id="5603553">:=</span>&nbsp;<span class="ident" id="5603556">d</span><span class="op" id="5603557">.</span><span class="ident" id="5603558">decodeBits</span><span class="op" id="5603568">(</span><span class="builtintype" id="5603569">int32</span><span class="op" id="5603574">(</span><span class="ident" id="5603575">val0</span><span class="op" id="5603579">)</span><span class="op" id="5603580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5603593">if</span>&nbsp;<span class="ident" id="5603596">err</span>&nbsp;<span class="op" id="5603600">!=</span>&nbsp;<span class="builtintype" id="5603603">nil</span>&nbsp;<span class="op" id="5603607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5603621">return</span>&nbsp;<span class="ident" id="5603628">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5603643">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5603656">d</span><span class="op" id="5603657">.</span><span class="ident" id="5603658">eobRun</span>&nbsp;<span class="op" id="5603665">|=</span>&nbsp;<span class="builtintype" id="5603668">uint16</span><span class="op" id="5603674">(</span><span class="ident" id="5603675">bits</span><span class="op" id="5603679">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5603691">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5603703">d</span><span class="op" id="5603704">.</span><span class="ident" id="5603705">eobRun</span><span class="op" id="5603711">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5603724">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5603739">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5603750">zig</span>&nbsp;<span class="op" id="5603754">+=</span>&nbsp;<span class="num" id="5603757">0x0f</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5603770">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5603779">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5603787">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5603794">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5603802">if</span>&nbsp;<span class="ident" id="5603805">d</span><span class="op" id="5603806">.</span><span class="ident" id="5603807">progressive</span>&nbsp;<span class="op" id="5603819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5603827">if</span>&nbsp;<span class="ident" id="5603830">zigEnd</span>&nbsp;<span class="op" id="5603837">!=</span>&nbsp;<span class="ident" id="5603840">blockSize</span><span class="op" id="5603849">-</span><span class="num" id="5603850">1</span>&nbsp;<span class="op" id="5603852">||</span>&nbsp;<span class="ident" id="5603855">al</span>&nbsp;<span class="op" id="5603858">!=</span>&nbsp;<span class="num" id="5603861">0</span>&nbsp;<span class="op" id="5603863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5603872">//&nbsp;We&nbsp;haven&#39;t&nbsp;completely&nbsp;decoded&nbsp;this&nbsp;8x8&nbsp;block.&nbsp;Save&nbsp;the&nbsp;coefficients.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5603951">d</span><span class="op" id="5603952">.</span><span class="ident" id="5603953">progCoeffs</span><span class="op" id="5603963">[</span><span class="ident" id="5603964">compIndex</span><span class="op" id="5603973">]</span><span class="op" id="5603974">[</span><span class="ident" id="5603975">by</span><span class="op" id="5603977">*</span><span class="ident" id="5603978">mxx</span><span class="op" id="5603981">*</span><span class="ident" id="5603982">d</span><span class="op" id="5603983">.</span><span class="ident" id="5603984">comp</span><span class="op" id="5603988">[</span><span class="ident" id="5603989">compIndex</span><span class="op" id="5603998">]</span><span class="op" id="5603999">.</span><span class="ident" id="5604000">h</span><span class="op" id="5604001">+</span><span class="ident" id="5604002">bx</span><span class="op" id="5604004">]</span>&nbsp;<span class="op" id="5604006">=</span>&nbsp;<span class="ident" id="5604008">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5604017">//&nbsp;At&nbsp;this&nbsp;point,&nbsp;we&nbsp;could&nbsp;execute&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;loop&nbsp;body&nbsp;to&nbsp;dequantize&nbsp;and</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5604103">//&nbsp;perform&nbsp;the&nbsp;inverse&nbsp;DCT,&nbsp;to&nbsp;save&nbsp;early&nbsp;stages&nbsp;of&nbsp;a&nbsp;progressive&nbsp;image&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5604189">//&nbsp;*image.YCbCr&nbsp;buffers&nbsp;(the&nbsp;whole&nbsp;point&nbsp;of&nbsp;progressive&nbsp;encoding),&nbsp;but&nbsp;in&nbsp;Go,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5604274">//&nbsp;the&nbsp;jpeg.Decode&nbsp;function&nbsp;does&nbsp;not&nbsp;return&nbsp;until&nbsp;the&nbsp;entire&nbsp;image&nbsp;is&nbsp;decoded,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5604360">//&nbsp;so&nbsp;we&nbsp;&#34;continue&#34;&nbsp;here&nbsp;to&nbsp;avoid&nbsp;wasted&nbsp;computation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5604421">continue</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5604436">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5604443">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5604451">//&nbsp;Dequantize,&nbsp;perform&nbsp;the&nbsp;inverse&nbsp;DCT&nbsp;and&nbsp;store&nbsp;the&nbsp;block&nbsp;to&nbsp;the&nbsp;image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5604529">for</span>&nbsp;<span class="ident" id="5604533">zig</span>&nbsp;<span class="op" id="5604537">:=</span>&nbsp;<span class="num" id="5604540">0</span><span class="op" id="5604541">;</span>&nbsp;<span class="ident" id="5604543">zig</span>&nbsp;<span class="op" id="5604547">&lt;</span>&nbsp;<span class="ident" id="5604549">blockSize</span><span class="op" id="5604558">;</span>&nbsp;<span class="ident" id="5604560">zig</span><span class="op" id="5604563">++</span>&nbsp;<span class="op" id="5604566">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5604574">b</span><span class="op" id="5604575">[</span><span class="ident" id="5604576">unzig</span><span class="op" id="5604581">[</span><span class="ident" id="5604582">zig</span><span class="op" id="5604585">]</span><span class="op" id="5604586">]</span>&nbsp;<span class="op" id="5604588">*=</span>&nbsp;<span class="ident" id="5604591">qt</span><span class="op" id="5604593">[</span><span class="ident" id="5604594">zig</span><span class="op" id="5604597">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5604604">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5604611">idct</span><span class="op" id="5604615">(</span><span class="op" id="5604616">&amp;</span><span class="ident" id="5604617">b</span><span class="op" id="5604618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5604625">dst</span><span class="op" id="5604628">,</span>&nbsp;<span class="ident" id="5604630">stride</span>&nbsp;<span class="op" id="5604637">:=</span>&nbsp;<span class="op" id="5604640">[</span><span class="op" id="5604641">]</span><span class="builtintype" id="5604642">byte</span><span class="op" id="5604646">(</span><span class="builtintype" id="5604647">nil</span><span class="op" id="5604650">)</span><span class="op" id="5604651">,</span>&nbsp;<span class="num" id="5604653">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5604660">if</span>&nbsp;<span class="ident" id="5604663">d</span><span class="op" id="5604664">.</span><span class="ident" id="5604665">nComp</span>&nbsp;<span class="op" id="5604671">==</span>&nbsp;<span class="ident" id="5604674">nGrayComponent</span>&nbsp;<span class="op" id="5604689">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5604697">dst</span><span class="op" id="5604700">,</span>&nbsp;<span class="ident" id="5604702">stride</span>&nbsp;<span class="op" id="5604709">=</span>&nbsp;<span class="ident" id="5604711">d</span><span class="op" id="5604712">.</span><span class="ident" id="5604713">img1</span><span class="op" id="5604717">.</span><span class="ident" id="5604718">Pix</span><span class="op" id="5604721">[</span><span class="num" id="5604722">8</span><span class="op" id="5604723">*</span><span class="op" id="5604724">(</span><span class="ident" id="5604725">by</span><span class="op" id="5604727">*</span><span class="ident" id="5604728">d</span><span class="op" id="5604729">.</span><span class="ident" id="5604730">img1</span><span class="op" id="5604734">.</span><span class="ident" id="5604735">Stride</span><span class="op" id="5604741">+</span><span class="ident" id="5604742">bx</span><span class="op" id="5604744">)</span><span class="op" id="5604745">:</span><span class="op" id="5604746">]</span><span class="op" id="5604747">,</span>&nbsp;<span class="ident" id="5604749">d</span><span class="op" id="5604750">.</span><span class="ident" id="5604751">img1</span><span class="op" id="5604755">.</span><span class="ident" id="5604756">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5604768">}</span>&nbsp;<span class="keyword" id="5604770">else</span>&nbsp;<span class="op" id="5604775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5604783">switch</span>&nbsp;<span class="ident" id="5604790">compIndex</span>&nbsp;<span class="op" id="5604800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5604808">case</span>&nbsp;<span class="num" id="5604813">0</span><span class="op" id="5604814">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5604823">dst</span><span class="op" id="5604826">,</span>&nbsp;<span class="ident" id="5604828">stride</span>&nbsp;<span class="op" id="5604835">=</span>&nbsp;<span class="ident" id="5604837">d</span><span class="op" id="5604838">.</span><span class="ident" id="5604839">img3</span><span class="op" id="5604843">.</span><span class="ident" id="5604844">Y</span><span class="op" id="5604845">[</span><span class="num" id="5604846">8</span><span class="op" id="5604847">*</span><span class="op" id="5604848">(</span><span class="ident" id="5604849">by</span><span class="op" id="5604851">*</span><span class="ident" id="5604852">d</span><span class="op" id="5604853">.</span><span class="ident" id="5604854">img3</span><span class="op" id="5604858">.</span><span class="ident" id="5604859">YStride</span><span class="op" id="5604866">+</span><span class="ident" id="5604867">bx</span><span class="op" id="5604869">)</span><span class="op" id="5604870">:</span><span class="op" id="5604871">]</span><span class="op" id="5604872">,</span>&nbsp;<span class="ident" id="5604874">d</span><span class="op" id="5604875">.</span><span class="ident" id="5604876">img3</span><span class="op" id="5604880">.</span><span class="ident" id="5604881">YStride</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5604895">case</span>&nbsp;<span class="num" id="5604900">1</span><span class="op" id="5604901">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5604910">dst</span><span class="op" id="5604913">,</span>&nbsp;<span class="ident" id="5604915">stride</span>&nbsp;<span class="op" id="5604922">=</span>&nbsp;<span class="ident" id="5604924">d</span><span class="op" id="5604925">.</span><span class="ident" id="5604926">img3</span><span class="op" id="5604930">.</span><span class="ident" id="5604931">Cb</span><span class="op" id="5604933">[</span><span class="num" id="5604934">8</span><span class="op" id="5604935">*</span><span class="op" id="5604936">(</span><span class="ident" id="5604937">by</span><span class="op" id="5604939">*</span><span class="ident" id="5604940">d</span><span class="op" id="5604941">.</span><span class="ident" id="5604942">img3</span><span class="op" id="5604946">.</span><span class="ident" id="5604947">CStride</span><span class="op" id="5604954">+</span><span class="ident" id="5604955">bx</span><span class="op" id="5604957">)</span><span class="op" id="5604958">:</span><span class="op" id="5604959">]</span><span class="op" id="5604960">,</span>&nbsp;<span class="ident" id="5604962">d</span><span class="op" id="5604963">.</span><span class="ident" id="5604964">img3</span><span class="op" id="5604968">.</span><span class="ident" id="5604969">CStride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5604983">case</span>&nbsp;<span class="num" id="5604988">2</span><span class="op" id="5604989">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5604998">dst</span><span class="op" id="5605001">,</span>&nbsp;<span class="ident" id="5605003">stride</span>&nbsp;<span class="op" id="5605010">=</span>&nbsp;<span class="ident" id="5605012">d</span><span class="op" id="5605013">.</span><span class="ident" id="5605014">img3</span><span class="op" id="5605018">.</span><span class="ident" id="5605019">Cr</span><span class="op" id="5605021">[</span><span class="num" id="5605022">8</span><span class="op" id="5605023">*</span><span class="op" id="5605024">(</span><span class="ident" id="5605025">by</span><span class="op" id="5605027">*</span><span class="ident" id="5605028">d</span><span class="op" id="5605029">.</span><span class="ident" id="5605030">img3</span><span class="op" id="5605034">.</span><span class="ident" id="5605035">CStride</span><span class="op" id="5605042">+</span><span class="ident" id="5605043">bx</span><span class="op" id="5605045">)</span><span class="op" id="5605046">:</span><span class="op" id="5605047">]</span><span class="op" id="5605048">,</span>&nbsp;<span class="ident" id="5605050">d</span><span class="op" id="5605051">.</span><span class="ident" id="5605052">img3</span><span class="op" id="5605056">.</span><span class="ident" id="5605057">CStride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5605071">default</span><span class="op" id="5605078">:</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5605087">return</span>&nbsp;<span class="ident" id="5605094">UnsupportedError</span><span class="op" id="5605110">(</span><span class="string" id="5605111">&#34;too&nbsp;many&nbsp;components&#34;</span><span class="op" id="5605132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5605140">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5605147">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5605154">//&nbsp;Level&nbsp;shift&nbsp;by&nbsp;+128,&nbsp;clip&nbsp;to&nbsp;[0,&nbsp;255],&nbsp;and&nbsp;write&nbsp;to&nbsp;dst.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5605219">for</span>&nbsp;<span class="ident" id="5605223">y</span>&nbsp;<span class="op" id="5605225">:=</span>&nbsp;<span class="num" id="5605228">0</span><span class="op" id="5605229">;</span>&nbsp;<span class="ident" id="5605231">y</span>&nbsp;<span class="op" id="5605233">&lt;</span>&nbsp;<span class="num" id="5605235">8</span><span class="op" id="5605236">;</span>&nbsp;<span class="ident" id="5605238">y</span><span class="op" id="5605239">++</span>&nbsp;<span class="op" id="5605242">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5605250">y8</span>&nbsp;<span class="op" id="5605253">:=</span>&nbsp;<span class="ident" id="5605256">y</span>&nbsp;<span class="op" id="5605258">*</span>&nbsp;<span class="num" id="5605260">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5605268">yStride</span>&nbsp;<span class="op" id="5605276">:=</span>&nbsp;<span class="ident" id="5605279">y</span>&nbsp;<span class="op" id="5605281">*</span>&nbsp;<span class="ident" id="5605283">stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5605296">for</span>&nbsp;<span class="ident" id="5605300">x</span>&nbsp;<span class="op" id="5605302">:=</span>&nbsp;<span class="num" id="5605305">0</span><span class="op" id="5605306">;</span>&nbsp;<span class="ident" id="5605308">x</span>&nbsp;<span class="op" id="5605310">&lt;</span>&nbsp;<span class="num" id="5605312">8</span><span class="op" id="5605313">;</span>&nbsp;<span class="ident" id="5605315">x</span><span class="op" id="5605316">++</span>&nbsp;<span class="op" id="5605319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5605328">c</span>&nbsp;<span class="op" id="5605330">:=</span>&nbsp;<span class="ident" id="5605333">b</span><span class="op" id="5605334">[</span><span class="ident" id="5605335">y8</span><span class="op" id="5605337">+</span><span class="ident" id="5605338">x</span><span class="op" id="5605339">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5605348">if</span>&nbsp;<span class="ident" id="5605351">c</span>&nbsp;<span class="op" id="5605353">&lt;</span>&nbsp;<span class="op" id="5605355">-</span><span class="num" id="5605356">128</span>&nbsp;<span class="op" id="5605360">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5605370">c</span>&nbsp;<span class="op" id="5605372">=</span>&nbsp;<span class="num" id="5605374">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5605383">}</span>&nbsp;<span class="keyword" id="5605385">else</span>&nbsp;<span class="keyword" id="5605390">if</span>&nbsp;<span class="ident" id="5605393">c</span>&nbsp;<span class="op" id="5605395">&gt;</span>&nbsp;<span class="num" id="5605397">127</span>&nbsp;<span class="op" id="5605401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5605411">c</span>&nbsp;<span class="op" id="5605413">=</span>&nbsp;<span class="num" id="5605415">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5605426">}</span>&nbsp;<span class="keyword" id="5605428">else</span>&nbsp;<span class="op" id="5605433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5605443">c</span>&nbsp;<span class="op" id="5605445">+=</span>&nbsp;<span class="num" id="5605448">128</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5605459">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5605468">dst</span><span class="op" id="5605471">[</span><span class="ident" id="5605472">yStride</span><span class="op" id="5605479">+</span><span class="ident" id="5605480">x</span><span class="op" id="5605481">]</span>&nbsp;<span class="op" id="5605483">=</span>&nbsp;<span class="builtintype" id="5605485">uint8</span><span class="op" id="5605490">(</span><span class="ident" id="5605491">c</span><span class="op" id="5605492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5605500">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5605507">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5605513">}</span>&nbsp;<span class="comment" id="5605515">//&nbsp;for&nbsp;j</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5605527">}</span>&nbsp;<span class="comment" id="5605529">//&nbsp;for&nbsp;i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5605541">mcu</span><span class="op" id="5605544">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5605550">if</span>&nbsp;<span class="ident" id="5605553">d</span><span class="op" id="5605554">.</span><span class="ident" id="5605555">ri</span>&nbsp;<span class="op" id="5605558">&gt;</span>&nbsp;<span class="num" id="5605560">0</span>&nbsp;<span class="op" id="5605562">&amp;&amp;</span>&nbsp;<span class="ident" id="5605565">mcu</span><span class="op" id="5605568">%</span><span class="ident" id="5605569">d</span><span class="op" id="5605570">.</span><span class="ident" id="5605571">ri</span>&nbsp;<span class="op" id="5605574">==</span>&nbsp;<span class="num" id="5605577">0</span>&nbsp;<span class="op" id="5605579">&amp;&amp;</span>&nbsp;<span class="ident" id="5605582">mcu</span>&nbsp;<span class="op" id="5605586">&lt;</span>&nbsp;<span class="ident" id="5605588">mxx</span><span class="op" id="5605591">*</span><span class="ident" id="5605592">myy</span>&nbsp;<span class="op" id="5605596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5605602">//&nbsp;A&nbsp;more&nbsp;sophisticated&nbsp;decoder&nbsp;could&nbsp;use&nbsp;RST[0-7]&nbsp;markers&nbsp;to&nbsp;resynchronize&nbsp;from&nbsp;corrupt&nbsp;input,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5605702">//&nbsp;but&nbsp;this&nbsp;one&nbsp;assumes&nbsp;well-formed&nbsp;input,&nbsp;and&nbsp;hence&nbsp;the&nbsp;restart&nbsp;marker&nbsp;follows&nbsp;immediately.</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5605799">if</span>&nbsp;<span class="ident" id="5605802">err</span>&nbsp;<span class="op" id="5605806">:=</span>&nbsp;<span class="ident" id="5605809">d</span><span class="op" id="5605810">.</span><span class="ident" id="5605811">readFull</span><span class="op" id="5605819">(</span><span class="ident" id="5605820">d</span><span class="op" id="5605821">.</span><span class="ident" id="5605822">tmp</span><span class="op" id="5605825">[</span><span class="op" id="5605826">:</span><span class="num" id="5605827">2</span><span class="op" id="5605828">]</span><span class="op" id="5605829">)</span><span class="op" id="5605830">;</span>&nbsp;<span class="ident" id="5605832">err</span>&nbsp;<span class="op" id="5605836">!=</span>&nbsp;<span class="builtintype" id="5605839">nil</span>&nbsp;<span class="op" id="5605843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5605850">return</span>&nbsp;<span class="ident" id="5605857">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5605865">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5605871">if</span>&nbsp;<span class="ident" id="5605874">d</span><span class="op" id="5605875">.</span><span class="ident" id="5605876">tmp</span><span class="op" id="5605879">[</span><span class="num" id="5605880">0</span><span class="op" id="5605881">]</span>&nbsp;<span class="op" id="5605883">!=</span>&nbsp;<span class="num" id="5605886">0xff</span>&nbsp;<span class="op" id="5605891">||</span>&nbsp;<span class="ident" id="5605894">d</span><span class="op" id="5605895">.</span><span class="ident" id="5605896">tmp</span><span class="op" id="5605899">[</span><span class="num" id="5605900">1</span><span class="op" id="5605901">]</span>&nbsp;<span class="op" id="5605903">!=</span>&nbsp;<span class="ident" id="5605906">expectedRST</span>&nbsp;<span class="op" id="5605918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5605925">return</span>&nbsp;<span class="ident" id="5605932">FormatError</span><span class="op" id="5605943">(</span><span class="string" id="5605944">&#34;bad&nbsp;RST&nbsp;marker&#34;</span><span class="op" id="5605960">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5605966">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5605972">expectedRST</span><span class="op" id="5605983">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5605990">if</span>&nbsp;<span class="ident" id="5605993">expectedRST</span>&nbsp;<span class="op" id="5606005">==</span>&nbsp;<span class="ident" id="5606008">rst7Marker</span><span class="op" id="5606018">+</span><span class="num" id="5606019">1</span>&nbsp;<span class="op" id="5606021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5606028">expectedRST</span>&nbsp;<span class="op" id="5606040">=</span>&nbsp;<span class="ident" id="5606042">rst0Marker</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5606057">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5606063">//&nbsp;Reset&nbsp;the&nbsp;Huffman&nbsp;decoder.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5606097">d</span><span class="op" id="5606098">.</span><span class="ident" id="5606099">bits</span>&nbsp;<span class="op" id="5606104">=</span>&nbsp;<span class="ident" id="5606106">bits</span><span class="op" id="5606110">{</span><span class="op" id="5606111">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5606117">//&nbsp;Reset&nbsp;the&nbsp;DC&nbsp;components,&nbsp;as&nbsp;per&nbsp;section&nbsp;F.2.1.3.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5606175">dc</span>&nbsp;<span class="op" id="5606178">=</span>&nbsp;<span class="op" id="5606180">[</span><span class="ident" id="5606181">nColorComponent</span><span class="op" id="5606196">]</span><span class="builtintype" id="5606197">int32</span><span class="op" id="5606202">{</span><span class="op" id="5606203">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5606209">//&nbsp;Reset&nbsp;the&nbsp;progressive&nbsp;decoder&nbsp;state,&nbsp;as&nbsp;per&nbsp;section&nbsp;G.1.2.2.</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5606277">d</span><span class="op" id="5606278">.</span><span class="ident" id="5606279">eobRun</span>&nbsp;<span class="op" id="5606286">=</span>&nbsp;<span class="num" id="5606288">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5606293">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5606297">}</span>&nbsp;<span class="comment" id="5606299">//&nbsp;for&nbsp;mx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5606310">}</span>&nbsp;<span class="comment" id="5606312">//&nbsp;for&nbsp;my</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5606324">return</span>&nbsp;<span class="builtintype" id="5606331">nil</span><br>
<span class="lineno"></span><span class="op" id="5606335">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5606338">//&nbsp;refine&nbsp;decodes&nbsp;a&nbsp;successive&nbsp;approximation&nbsp;refinement&nbsp;block,&nbsp;as&nbsp;specified&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="5606417">//&nbsp;section&nbsp;G.1.2.</span><br>
<span class="lineno">340</span><span class="keyword" id="5606435">func</span>&nbsp;<span class="op" id="5606440">(</span><span class="ident" id="5606441">d</span>&nbsp;<span class="op" id="5606443">*</span><span class="ident" id="5606444">decoder</span><span class="op" id="5606451">)</span>&nbsp;<span class="ident" id="5606453">refine</span><span class="op" id="5606459">(</span><span class="ident" id="5606460">b</span>&nbsp;<span class="op" id="5606462">*</span><span class="ident" id="5606463">block</span><span class="op" id="5606468">,</span>&nbsp;<span class="ident" id="5606470">h</span>&nbsp;<span class="op" id="5606472">*</span><span class="ident" id="5606473">huffman</span><span class="op" id="5606480">,</span>&nbsp;<span class="ident" id="5606482">zigStart</span><span class="op" id="5606490">,</span>&nbsp;<span class="ident" id="5606492">zigEnd</span><span class="op" id="5606498">,</span>&nbsp;<span class="ident" id="5606500">delta</span>&nbsp;<span class="builtintype" id="5606506">int32</span><span class="op" id="5606511">)</span>&nbsp;<span class="builtintype" id="5606513">error</span>&nbsp;<span class="op" id="5606519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5606522">//&nbsp;Refining&nbsp;a&nbsp;DC&nbsp;component&nbsp;is&nbsp;trivial.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5606562">if</span>&nbsp;<span class="ident" id="5606565">zigStart</span>&nbsp;<span class="op" id="5606574">==</span>&nbsp;<span class="num" id="5606577">0</span>&nbsp;<span class="op" id="5606579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5606583">if</span>&nbsp;<span class="ident" id="5606586">zigEnd</span>&nbsp;<span class="op" id="5606593">!=</span>&nbsp;<span class="num" id="5606596">0</span>&nbsp;<span class="op" id="5606598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5606603">panic</span><span class="op" id="5606608">(</span><span class="string" id="5606609">&#34;unreachable&#34;</span><span class="op" id="5606622">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5606626">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5606630">bit</span><span class="op" id="5606633">,</span>&nbsp;<span class="ident" id="5606635">err</span>&nbsp;<span class="op" id="5606639">:=</span>&nbsp;<span class="ident" id="5606642">d</span><span class="op" id="5606643">.</span><span class="ident" id="5606644">decodeBit</span><span class="op" id="5606653">(</span><span class="op" id="5606654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5606658">if</span>&nbsp;<span class="ident" id="5606661">err</span>&nbsp;<span class="op" id="5606665">!=</span>&nbsp;<span class="builtintype" id="5606668">nil</span>&nbsp;<span class="op" id="5606672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5606677">return</span>&nbsp;<span class="ident" id="5606684">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5606690">}</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5606694">if</span>&nbsp;<span class="ident" id="5606697">bit</span>&nbsp;<span class="op" id="5606701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5606706">b</span><span class="op" id="5606707">[</span><span class="num" id="5606708">0</span><span class="op" id="5606709">]</span>&nbsp;<span class="op" id="5606711">|=</span>&nbsp;<span class="ident" id="5606714">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5606722">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5606726">return</span>&nbsp;<span class="builtintype" id="5606733">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5606738">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5606742">//&nbsp;Refining&nbsp;AC&nbsp;components&nbsp;is&nbsp;more&nbsp;complicated;&nbsp;see&nbsp;sections&nbsp;G.1.2.2&nbsp;and&nbsp;G.1.2.3.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5606824">zig</span>&nbsp;<span class="op" id="5606828">:=</span>&nbsp;<span class="ident" id="5606831">zigStart</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5606841">if</span>&nbsp;<span class="ident" id="5606844">d</span><span class="op" id="5606845">.</span><span class="ident" id="5606846">eobRun</span>&nbsp;<span class="op" id="5606853">==</span>&nbsp;<span class="num" id="5606856">0</span>&nbsp;<span class="op" id="5606858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5606861">loop</span><span class="op" id="5606865">:</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5606869">for</span>&nbsp;<span class="op" id="5606873">;</span>&nbsp;<span class="ident" id="5606875">zig</span>&nbsp;<span class="op" id="5606879">&lt;=</span>&nbsp;<span class="ident" id="5606882">zigEnd</span><span class="op" id="5606888">;</span>&nbsp;<span class="ident" id="5606890">zig</span><span class="op" id="5606893">++</span>&nbsp;<span class="op" id="5606896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5606901">z</span>&nbsp;<span class="op" id="5606903">:=</span>&nbsp;<span class="builtintype" id="5606906">int32</span><span class="op" id="5606911">(</span><span class="num" id="5606912">0</span><span class="op" id="5606913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5606918">value</span><span class="op" id="5606923">,</span>&nbsp;<span class="ident" id="5606925">err</span>&nbsp;<span class="op" id="5606929">:=</span>&nbsp;<span class="ident" id="5606932">d</span><span class="op" id="5606933">.</span><span class="ident" id="5606934">decodeHuffman</span><span class="op" id="5606947">(</span><span class="ident" id="5606948">h</span><span class="op" id="5606949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5606954">if</span>&nbsp;<span class="ident" id="5606957">err</span>&nbsp;<span class="op" id="5606961">!=</span>&nbsp;<span class="builtintype" id="5606964">nil</span>&nbsp;<span class="op" id="5606968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5606974">return</span>&nbsp;<span class="ident" id="5606981">err</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5606988">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5606993">val0</span>&nbsp;<span class="op" id="5606998">:=</span>&nbsp;<span class="ident" id="5607001">value</span>&nbsp;<span class="op" id="5607007">&gt;&gt;</span>&nbsp;<span class="num" id="5607010">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5607015">val1</span>&nbsp;<span class="op" id="5607020">:=</span>&nbsp;<span class="ident" id="5607023">value</span>&nbsp;<span class="op" id="5607029">&amp;</span>&nbsp;<span class="num" id="5607031">0x0f</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5607040">switch</span>&nbsp;<span class="ident" id="5607047">val1</span>&nbsp;<span class="op" id="5607052">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5607057">case</span>&nbsp;<span class="num" id="5607062">0</span><span class="op" id="5607063">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5607069">if</span>&nbsp;<span class="ident" id="5607072">val0</span>&nbsp;<span class="op" id="5607077">!=</span>&nbsp;<span class="num" id="5607080">0x0f</span>&nbsp;<span class="op" id="5607085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5607092">d</span><span class="op" id="5607093">.</span><span class="ident" id="5607094">eobRun</span>&nbsp;<span class="op" id="5607101">=</span>&nbsp;<span class="builtintype" id="5607103">uint16</span><span class="op" id="5607109">(</span><span class="num" id="5607110">1</span>&nbsp;<span class="op" id="5607112">&lt;&lt;</span>&nbsp;<span class="ident" id="5607115">val0</span><span class="op" id="5607119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5607126">if</span>&nbsp;<span class="ident" id="5607129">val0</span>&nbsp;<span class="op" id="5607134">!=</span>&nbsp;<span class="num" id="5607137">0</span>&nbsp;<span class="op" id="5607139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5607147">bits</span><span class="op" id="5607151">,</span>&nbsp;<span class="ident" id="5607153">err</span>&nbsp;<span class="op" id="5607157">:=</span>&nbsp;<span class="ident" id="5607160">d</span><span class="op" id="5607161">.</span><span class="ident" id="5607162">decodeBits</span><span class="op" id="5607172">(</span><span class="builtintype" id="5607173">int32</span><span class="op" id="5607178">(</span><span class="ident" id="5607179">val0</span><span class="op" id="5607183">)</span><span class="op" id="5607184">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5607192">if</span>&nbsp;<span class="ident" id="5607195">err</span>&nbsp;<span class="op" id="5607199">!=</span>&nbsp;<span class="builtintype" id="5607202">nil</span>&nbsp;<span class="op" id="5607206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5607215">return</span>&nbsp;<span class="ident" id="5607222">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5607232">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5607240">d</span><span class="op" id="5607241">.</span><span class="ident" id="5607242">eobRun</span>&nbsp;<span class="op" id="5607249">|=</span>&nbsp;<span class="builtintype" id="5607252">uint16</span><span class="op" id="5607258">(</span><span class="ident" id="5607259">bits</span><span class="op" id="5607263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5607270">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5607277">break</span>&nbsp;<span class="ident" id="5607283">loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5607292">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5607297">case</span>&nbsp;<span class="num" id="5607302">1</span><span class="op" id="5607303">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5607309">z</span>&nbsp;<span class="op" id="5607311">=</span>&nbsp;<span class="ident" id="5607313">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5607323">bit</span><span class="op" id="5607326">,</span>&nbsp;<span class="ident" id="5607328">err</span>&nbsp;<span class="op" id="5607332">:=</span>&nbsp;<span class="ident" id="5607335">d</span><span class="op" id="5607336">.</span><span class="ident" id="5607337">decodeBit</span><span class="op" id="5607346">(</span><span class="op" id="5607347">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5607353">if</span>&nbsp;<span class="ident" id="5607356">err</span>&nbsp;<span class="op" id="5607360">!=</span>&nbsp;<span class="builtintype" id="5607363">nil</span>&nbsp;<span class="op" id="5607367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5607374">return</span>&nbsp;<span class="ident" id="5607381">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5607389">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5607395">if</span>&nbsp;<span class="op" id="5607398">!</span><span class="ident" id="5607399">bit</span>&nbsp;<span class="op" id="5607403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5607410">z</span>&nbsp;<span class="op" id="5607412">=</span>&nbsp;<span class="op" id="5607414">-</span><span class="ident" id="5607415">z</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5607421">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5607426">default</span><span class="op" id="5607433">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5607439">return</span>&nbsp;<span class="ident" id="5607446">FormatError</span><span class="op" id="5607457">(</span><span class="string" id="5607458">&#34;unexpected&nbsp;Huffman&nbsp;code&#34;</span><span class="op" id="5607483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5607488">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5607494">zig</span><span class="op" id="5607497">,</span>&nbsp;<span class="ident" id="5607499">err</span>&nbsp;<span class="op" id="5607503">=</span>&nbsp;<span class="ident" id="5607505">d</span><span class="op" id="5607506">.</span><span class="ident" id="5607507">refineNonZeroes</span><span class="op" id="5607522">(</span><span class="ident" id="5607523">b</span><span class="op" id="5607524">,</span>&nbsp;<span class="ident" id="5607526">zig</span><span class="op" id="5607529">,</span>&nbsp;<span class="ident" id="5607531">zigEnd</span><span class="op" id="5607537">,</span>&nbsp;<span class="builtintype" id="5607539">int32</span><span class="op" id="5607544">(</span><span class="ident" id="5607545">val0</span><span class="op" id="5607549">)</span><span class="op" id="5607550">,</span>&nbsp;<span class="ident" id="5607552">delta</span><span class="op" id="5607557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5607562">if</span>&nbsp;<span class="ident" id="5607565">err</span>&nbsp;<span class="op" id="5607569">!=</span>&nbsp;<span class="builtintype" id="5607572">nil</span>&nbsp;<span class="op" id="5607576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5607582">return</span>&nbsp;<span class="ident" id="5607589">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5607596">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5607601">if</span>&nbsp;<span class="ident" id="5607604">zig</span>&nbsp;<span class="op" id="5607608">&gt;</span>&nbsp;<span class="ident" id="5607610">zigEnd</span>&nbsp;<span class="op" id="5607617">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5607623">return</span>&nbsp;<span class="ident" id="5607630">FormatError</span><span class="op" id="5607641">(</span><span class="string" id="5607642">&#34;too&nbsp;many&nbsp;coefficients&#34;</span><span class="op" id="5607665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5607670">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5607675">if</span>&nbsp;<span class="ident" id="5607678">z</span>&nbsp;<span class="op" id="5607680">!=</span>&nbsp;<span class="num" id="5607683">0</span>&nbsp;<span class="op" id="5607685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5607691">b</span><span class="op" id="5607692">[</span><span class="ident" id="5607693">unzig</span><span class="op" id="5607698">[</span><span class="ident" id="5607699">zig</span><span class="op" id="5607702">]</span><span class="op" id="5607703">]</span>&nbsp;<span class="op" id="5607705">=</span>&nbsp;<span class="ident" id="5607707">z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5607712">}</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5607716">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5607719">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5607722">if</span>&nbsp;<span class="ident" id="5607725">d</span><span class="op" id="5607726">.</span><span class="ident" id="5607727">eobRun</span>&nbsp;<span class="op" id="5607734">&gt;</span>&nbsp;<span class="num" id="5607736">0</span>&nbsp;<span class="op" id="5607738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5607742">d</span><span class="op" id="5607743">.</span><span class="ident" id="5607744">eobRun</span><span class="op" id="5607750">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5607755">if</span>&nbsp;<span class="ident" id="5607758">_</span><span class="op" id="5607759">,</span>&nbsp;<span class="ident" id="5607761">err</span>&nbsp;<span class="op" id="5607765">:=</span>&nbsp;<span class="ident" id="5607768">d</span><span class="op" id="5607769">.</span><span class="ident" id="5607770">refineNonZeroes</span><span class="op" id="5607785">(</span><span class="ident" id="5607786">b</span><span class="op" id="5607787">,</span>&nbsp;<span class="ident" id="5607789">zig</span><span class="op" id="5607792">,</span>&nbsp;<span class="ident" id="5607794">zigEnd</span><span class="op" id="5607800">,</span>&nbsp;<span class="op" id="5607802">-</span><span class="num" id="5607803">1</span><span class="op" id="5607804">,</span>&nbsp;<span class="ident" id="5607806">delta</span><span class="op" id="5607811">)</span><span class="op" id="5607812">;</span>&nbsp;<span class="ident" id="5607814">err</span>&nbsp;<span class="op" id="5607818">!=</span>&nbsp;<span class="builtintype" id="5607821">nil</span>&nbsp;<span class="op" id="5607825">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5607830">return</span>&nbsp;<span class="ident" id="5607837">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5607843">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5607846">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5607849">return</span>&nbsp;<span class="builtintype" id="5607856">nil</span><br>
<span class="lineno"></span><span class="op" id="5607860">}</span><br>
<span class="lineno">415</span><br>
<span class="lineno"></span><span class="comment" id="5607863">//&nbsp;refineNonZeroes&nbsp;refines&nbsp;non-zero&nbsp;entries&nbsp;of&nbsp;b&nbsp;in&nbsp;zig-zag&nbsp;order.&nbsp;If&nbsp;nz&nbsp;&gt;=&nbsp;0,</span><br>
<span class="lineno"></span><span class="comment" id="5607942">//&nbsp;the&nbsp;first&nbsp;nz&nbsp;zero&nbsp;entries&nbsp;are&nbsp;skipped&nbsp;over.</span><br>
<span class="lineno"></span><span class="keyword" id="5607989">func</span>&nbsp;<span class="op" id="5607994">(</span><span class="ident" id="5607995">d</span>&nbsp;<span class="op" id="5607997">*</span><span class="ident" id="5607998">decoder</span><span class="op" id="5608005">)</span>&nbsp;<span class="ident" id="5608007">refineNonZeroes</span><span class="op" id="5608022">(</span><span class="ident" id="5608023">b</span>&nbsp;<span class="op" id="5608025">*</span><span class="ident" id="5608026">block</span><span class="op" id="5608031">,</span>&nbsp;<span class="ident" id="5608033">zig</span><span class="op" id="5608036">,</span>&nbsp;<span class="ident" id="5608038">zigEnd</span><span class="op" id="5608044">,</span>&nbsp;<span class="ident" id="5608046">nz</span><span class="op" id="5608048">,</span>&nbsp;<span class="ident" id="5608050">delta</span>&nbsp;<span class="builtintype" id="5608056">int32</span><span class="op" id="5608061">)</span>&nbsp;<span class="op" id="5608063">(</span><span class="builtintype" id="5608064">int32</span><span class="op" id="5608069">,</span>&nbsp;<span class="builtintype" id="5608071">error</span><span class="op" id="5608076">)</span>&nbsp;<span class="op" id="5608078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5608081">for</span>&nbsp;<span class="op" id="5608085">;</span>&nbsp;<span class="ident" id="5608087">zig</span>&nbsp;<span class="op" id="5608091">&lt;=</span>&nbsp;<span class="ident" id="5608094">zigEnd</span><span class="op" id="5608100">;</span>&nbsp;<span class="ident" id="5608102">zig</span><span class="op" id="5608105">++</span>&nbsp;<span class="op" id="5608108">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5608112">u</span>&nbsp;<span class="op" id="5608114">:=</span>&nbsp;<span class="ident" id="5608117">unzig</span><span class="op" id="5608122">[</span><span class="ident" id="5608123">zig</span><span class="op" id="5608126">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5608130">if</span>&nbsp;<span class="ident" id="5608133">b</span><span class="op" id="5608134">[</span><span class="ident" id="5608135">u</span><span class="op" id="5608136">]</span>&nbsp;<span class="op" id="5608138">==</span>&nbsp;<span class="num" id="5608141">0</span>&nbsp;<span class="op" id="5608143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5608148">if</span>&nbsp;<span class="ident" id="5608151">nz</span>&nbsp;<span class="op" id="5608154">==</span>&nbsp;<span class="num" id="5608157">0</span>&nbsp;<span class="op" id="5608159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5608165">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5608174">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5608179">nz</span><span class="op" id="5608181">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5608187">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5608198">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5608202">bit</span><span class="op" id="5608205">,</span>&nbsp;<span class="ident" id="5608207">err</span>&nbsp;<span class="op" id="5608211">:=</span>&nbsp;<span class="ident" id="5608214">d</span><span class="op" id="5608215">.</span><span class="ident" id="5608216">decodeBit</span><span class="op" id="5608225">(</span><span class="op" id="5608226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5608230">if</span>&nbsp;<span class="ident" id="5608233">err</span>&nbsp;<span class="op" id="5608237">!=</span>&nbsp;<span class="builtintype" id="5608240">nil</span>&nbsp;<span class="op" id="5608244">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5608249">return</span>&nbsp;<span class="num" id="5608256">0</span><span class="op" id="5608257">,</span>&nbsp;<span class="ident" id="5608259">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5608265">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5608269">if</span>&nbsp;<span class="op" id="5608272">!</span><span class="ident" id="5608273">bit</span>&nbsp;<span class="op" id="5608277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5608282">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5608293">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5608297">if</span>&nbsp;<span class="ident" id="5608300">b</span><span class="op" id="5608301">[</span><span class="ident" id="5608302">u</span><span class="op" id="5608303">]</span>&nbsp;<span class="op" id="5608305">&gt;=</span>&nbsp;<span class="num" id="5608308">0</span>&nbsp;<span class="op" id="5608310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5608315">b</span><span class="op" id="5608316">[</span><span class="ident" id="5608317">u</span><span class="op" id="5608318">]</span>&nbsp;<span class="op" id="5608320">+=</span>&nbsp;<span class="ident" id="5608323">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5608331">}</span>&nbsp;<span class="keyword" id="5608333">else</span>&nbsp;<span class="op" id="5608338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5608343">b</span><span class="op" id="5608344">[</span><span class="ident" id="5608345">u</span><span class="op" id="5608346">]</span>&nbsp;<span class="op" id="5608348">-=</span>&nbsp;<span class="ident" id="5608351">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5608359">}</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5608362">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5608365">return</span>&nbsp;<span class="ident" id="5608372">zig</span><span class="op" id="5608375">,</span>&nbsp;<span class="builtintype" id="5608377">nil</span><br>
<span class="lineno"></span><span class="op" id="5608381">}</span>
</div>
</body>
</html>
